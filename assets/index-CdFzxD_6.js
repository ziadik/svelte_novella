(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();const ul=!1;var Is=Array.isArray,Lu=Array.prototype.indexOf,Sa=Array.from,ua=Object.defineProperty,Oi=Object.getOwnPropertyDescriptor,cl=Object.getOwnPropertyDescriptors,$u=Object.prototype,Fu=Array.prototype,Ca=Object.getPrototypeOf,mo=Object.isExtensible;function Du(n){return n()}function ms(n){for(var e=0;e<n.length;e++)n[e]()}function Uu(){var n,e,t=new Promise((r,a)=>{n=r,e=a});return{promise:t,resolve:n,reject:e}}const Zt=2,xa=4,Ps=8,pi=16,Xn=32,$r=64,hl=128,ln=256,ys=512,It=1024,un=2048,vr=4096,En=8192,gi=16384,Ta=32768,Ia=65536,yo=1<<17,Nu=1<<18,Vi=1<<19,dl=1<<20,ca=1<<21,Pa=1<<22,Or=1<<23,hr=Symbol("$state"),Ra=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Bu(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Wu(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Vu(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function qu(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Hu(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function zu(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Gu(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ku(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Yu(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ju(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Rs=1,Os=2,fl=4,Xu=8,Qu=16,Zu=1,ec=2,yt=Symbol(),tc="http://www.w3.org/1999/xhtml";function nc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let rc=!1;function vl(n){return n===this.v}function pl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function ic(n,e){return n!==e}function gl(n){return!pl(n,this.v)}let qi=!1,sc=!1;function ac(){qi=!0}let ht=null;function ws(n){ht=n}function Hi(n,e=!1,t){ht={p:ht,c:null,e:null,s:n,x:null,l:qi&&!e?{s:null,u:null,$:[]}:null}}function zi(n){var e=ht,t=e.e;if(t!==null){e.e=null;for(var r of t)Pl(r)}return ht=e.p,{}}function _i(){return!qi||ht!==null&&ht.l===null}const oc=new WeakMap;function lc(n){var e=Me;if(e===null)return Oe.f|=Or,n;if((e.f&Ta)===0){if((e.f&hl)===0)throw!e.parent&&n instanceof Error&&_l(n),n;e.b.error(n)}else Oa(n,e)}function Oa(n,e){for(;e!==null;){if((e.f&hl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&_l(n),n}function _l(n){const e=oc.get(n);e&&(ua(n,"message",{value:e.message}),ua(n,"stack",{value:e.stack}))}let Di=[],ha=[];function ml(){var n=Di;Di=[],ms(n)}function uc(){var n=ha;ha=[],ms(n)}function Ma(n){Di.length===0&&queueMicrotask(ml),Di.push(n)}function cc(){Di.length>0&&ml(),ha.length>0&&uc()}function hc(){for(var n=Me.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&Bu(),n}function Ms(n){var e=Zt|un,t=Oe!==null&&(Oe.f&Zt)!==0?Oe:null;return Me===null||t!==null&&(t.f&ln)!==0?e|=ln:Me.f|=Vi,{ctx:ht,deps:null,effects:null,equals:vl,f:e,fn:n,reactions:null,rv:0,v:yt,wv:0,parent:t??Me,ac:null}}function dc(n,e){let t=Me;t===null&&Vu();var r=t.b,a=void 0,l=Ui(yt),c=null,f=!Oe;return Sc(()=>{try{var v=n();c&&Promise.resolve(v).catch(()=>{})}catch(g){v=Promise.reject(g)}var _=()=>v;a=c?.then(_,_)??Promise.resolve(v),c=a;var y=Qe,E=r.pending;f&&(r.update_pending_count(1),E||y.increment());const k=(g,x=void 0)=>{c=null,E||y.activate(),x?x!==Ra&&(l.f|=Or,Ni(l,x)):((l.f&Or)!==0&&(l.f^=Or),Ni(l,g)),f&&(r.update_pending_count(-1),E||y.decrement()),El()};if(a.then(k,g=>k(null,g||"unknown")),y)return()=>{queueMicrotask(()=>y.neuter())}}),new Promise(v=>{function _(y){function E(){y===a?v(l):_(a)}y.then(E,E)}_(a)})}function ai(n){const e=Ms(n);return Dl(e),e}function yl(n){const e=Ms(n);return e.equals=gl,e}function wl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Jn(e[t])}}function fc(n){for(var e=n.parent;e!==null;){if((e.f&Zt)===0)return e;e=e.parent}return null}function La(n){var e,t=Me;fr(fc(n));try{wl(n),e=Wl(n)}finally{fr(t)}return e}function bl(n){var e=La(n);if(n.equals(e)||(n.v=e,n.wv=Nl()),!mi){var t=(cr||(n.f&ln)!==0)&&n.deps!==null?vr:It;Nt(n,t)}}function vc(n,e,t){const r=_i()?Ms:yl;if(e.length===0){t(n.map(r));return}var a=Qe,l=Me,c=pc(),f=hc();Promise.all(e.map(v=>dc(v))).then(v=>{a?.activate(),c();try{t([...n.map(r),...v])}catch(_){(l.f&gi)===0&&Oa(_,l)}a?.deactivate(),El()}).catch(v=>{f.error(v)})}function pc(){var n=Me,e=Oe,t=ht,r=Qe;return function(){fr(n),Fn(e),ws(t),r?.activate()}}function El(){fr(null),Fn(null),ws(null)}const Js=new Set;let Qe=null,ps=null,wo=new Set,bs=[];function Al(){const n=bs.shift();bs.length>0&&queueMicrotask(Al),n()}let Lr=[],Ls=null,da=!1,gs=!1;class hi{current=new Map;#n=new Map;#t=new Set;#e=0;#r=null;#i=!1;#a=[];#l=[];#o=[];#s=[];#u=[];#h=[];#d=[];skipped_effects=new Set;process(e){Lr=[],ps=null;for(const a of e)this.#v(a);if(this.#a.length===0&&this.#e===0){this.#f();var t=this.#o,r=this.#s;this.#o=[],this.#s=[],this.#u=[],ps=Qe,Qe=null,bo(t),bo(r),Qe===null?Qe=this:Js.delete(this),this.#r?.resolve()}else this.#c(this.#o),this.#c(this.#s),this.#c(this.#u);for(const a of this.#a)ci(a);for(const a of this.#l)ci(a);this.#a=[],this.#l=[]}#v(e){e.f^=It;for(var t=e.first;t!==null;){var r=t.f,a=(r&(Xn|$r))!==0,l=a&&(r&It)!==0,c=l||(r&En)!==0||this.skipped_effects.has(t);if(!c&&t.fn!==null){if(a)t.f^=It;else if((r&xa)!==0)this.#s.push(t);else if((r&It)===0)if((r&Pa)!==0){var f=t.b?.pending?this.#l:this.#a;f.push(t)}else Us(t)&&((t.f&pi)!==0&&this.#u.push(t),ci(t));var v=t.first;if(v!==null){t=v;continue}}var _=t.parent;for(t=t.next;t===null&&_!==null;)t=_.next,_=_.parent}}#c(e){for(const t of e)((t.f&un)!==0?this.#h:this.#d).push(t),Nt(t,It);e.length=0}capture(e,t){this.#n.has(e)||this.#n.set(e,t),this.current.set(e,e.v)}activate(){Qe=this}deactivate(){Qe=null,ps=null;for(const e of wo)if(wo.delete(e),e(),Qe!==null)break}neuter(){this.#i=!0}flush(){Lr.length>0?kl():this.#f(),Qe===this&&(this.#e===0&&Js.delete(this),this.deactivate())}#f(){if(!this.#i)for(const e of this.#t)e();this.#t.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#h)Nt(e,un),di(e);for(const e of this.#d)Nt(e,vr),di(e);this.#o=[],this.#s=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#r??=Uu()).promise}static ensure(){if(Qe===null){const e=Qe=new hi;Js.add(Qe),gs||hi.enqueue(()=>{Qe===e&&e.flush()})}return Qe}static enqueue(e){bs.length===0&&queueMicrotask(Al),bs.unshift(e)}}function gc(n){var e=gs;gs=!0;try{for(var t;;){if(cc(),Lr.length===0&&(Qe?.flush(),Lr.length===0))return Ls=null,t;kl()}}finally{gs=e}}function kl(){var n=ui;da=!0;try{var e=0;for(jo(!0);Lr.length>0;){var t=hi.ensure();if(e++>1e3){var r,a;_c()}t.process(Lr),dr.clear()}}finally{da=!1,jo(n),Ls=null}}function _c(){try{Gu()}catch(n){Oa(n,Ls)}}let Ir=null;function bo(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(gi|En))===0&&Us(r)&&(Ir=[],ci(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Ll(r):r.fn=null),Ir?.length>0)){dr.clear();for(const a of Ir)ci(a);Ir=[]}}Ir=null}}function di(n){for(var e=Ls=n;e.parent!==null;){e=e.parent;var t=e.f;if(da&&e===Me&&(t&pi)!==0)return;if((t&($r|Xn))!==0){if((t&It)===0)return;e.f^=It}}Lr.push(e)}const dr=new Map;function Ui(n,e){var t={f:0,v:n,reactions:null,equals:vl,rv:0,wv:0};return t}function Ze(n,e){const t=Ui(n);return Dl(t),t}function mc(n,e=!1,t=!0){const r=Ui(n);return e||(r.equals=gl),qi&&t&&ht!==null&&ht.l!==null&&(ht.l.s??=[]).push(r),r}function he(n,e,t=!1){Oe!==null&&(!Mn||(Oe.f&yo)!==0)&&_i()&&(Oe.f&(Zt|pi|Pa|yo))!==0&&!Yn?.includes(n)&&Ju();let r=t?$n(e):e;return Ni(n,r)}function Ni(n,e){if(!n.equals(e)){var t=n.v;mi?dr.set(n,e):dr.set(n,t),n.v=e;var r=hi.ensure();r.capture(n,t),(n.f&Zt)!==0&&((n.f&un)!==0&&La(n),Nt(n,(n.f&ln)===0?It:vr)),n.wv=Nl(),jl(n,un),_i()&&Me!==null&&(Me.f&It)!==0&&(Me.f&(Xn|$r))===0&&(on===null?Tc([n]):on.push(n))}return e}function Xs(n){he(n,n.v+1)}function jl(n,e){var t=n.reactions;if(t!==null)for(var r=_i(),a=t.length,l=0;l<a;l++){var c=t[l],f=c.f;if(!(!r&&c===Me)){var v=(f&un)===0;v&&Nt(c,e),(f&Zt)!==0?jl(c,vr):v&&((f&pi)!==0&&Ir!==null&&Ir.push(c),di(c))}}}function $n(n){if(typeof n!="object"||n===null||hr in n)return n;const e=Ca(n);if(e!==$u&&e!==Fu)return n;var t=new Map,r=Is(n),a=Ze(0),l=Mr,c=f=>{if(Mr===l)return f();var v=Oe,_=Mr;Fn(null),Co(l);var y=f();return Fn(v),Co(_),y};return r&&t.set("length",Ze(n.length)),new Proxy(n,{defineProperty(f,v,_){(!("value"in _)||_.configurable===!1||_.enumerable===!1||_.writable===!1)&&Ku();var y=t.get(v);return y===void 0?y=c(()=>{var E=Ze(_.value);return t.set(v,E),E}):he(y,_.value,!0),!0},deleteProperty(f,v){var _=t.get(v);if(_===void 0){if(v in f){const y=c(()=>Ze(yt));t.set(v,y),Xs(a)}}else he(_,yt),Xs(a);return!0},get(f,v,_){if(v===hr)return n;var y=t.get(v),E=v in f;if(y===void 0&&(!E||Oi(f,v)?.writable)&&(y=c(()=>{var g=$n(E?f[v]:yt),x=Ze(g);return x}),t.set(v,y)),y!==void 0){var k=A(y);return k===yt?void 0:k}return Reflect.get(f,v,_)},getOwnPropertyDescriptor(f,v){var _=Reflect.getOwnPropertyDescriptor(f,v);if(_&&"value"in _){var y=t.get(v);y&&(_.value=A(y))}else if(_===void 0){var E=t.get(v),k=E?.v;if(E!==void 0&&k!==yt)return{enumerable:!0,configurable:!0,value:k,writable:!0}}return _},has(f,v){if(v===hr)return!0;var _=t.get(v),y=_!==void 0&&_.v!==yt||Reflect.has(f,v);if(_!==void 0||Me!==null&&(!y||Oi(f,v)?.writable)){_===void 0&&(_=c(()=>{var k=y?$n(f[v]):yt,g=Ze(k);return g}),t.set(v,_));var E=A(_);if(E===yt)return!1}return y},set(f,v,_,y){var E=t.get(v),k=v in f;if(r&&v==="length")for(var g=_;g<E.v;g+=1){var x=t.get(g+"");x!==void 0?he(x,yt):g in f&&(x=c(()=>Ze(yt)),t.set(g+"",x))}if(E===void 0)(!k||Oi(f,v)?.writable)&&(E=c(()=>Ze(void 0)),he(E,$n(_)),t.set(v,E));else{k=E.v!==yt;var L=c(()=>$n(_));he(E,L)}var F=Reflect.getOwnPropertyDescriptor(f,v);if(F?.set&&F.set.call(y,_),!k){if(r&&typeof v=="string"){var K=t.get("length"),Y=Number(v);Number.isInteger(Y)&&Y>=K.v&&he(K,Y+1)}Xs(a)}return!0},ownKeys(f){A(a);var v=Reflect.ownKeys(f).filter(E=>{var k=t.get(E);return k===void 0||k.v!==yt});for(var[_,y]of t)y.v!==yt&&!(_ in f)&&v.push(_);return v},setPrototypeOf(){Yu()}})}function Eo(n){try{if(n!==null&&typeof n=="object"&&hr in n)return n[hr]}catch{}return n}function yc(n,e){return Object.is(Eo(n),Eo(e))}var Ao,Sl,Cl,xl;function wc(){if(Ao===void 0){Ao=window,Sl=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Cl=Oi(e,"firstChild").get,xl=Oi(e,"nextSibling").get,mo(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),mo(t)&&(t.__t=void 0)}}function Fr(n=""){return document.createTextNode(n)}function Es(n){return Cl.call(n)}function $s(n){return xl.call(n)}function D(n,e){return Es(n)}function Qt(n,e){{var t=Es(n);return t instanceof Comment&&t.data===""?$s(t):t}}function W(n,e=1,t=!1){let r=n;for(;e--;)r=$s(r);return r}function bc(n){n.textContent=""}function $a(){return!1}let ko=!1;function Ec(){ko||(ko=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Fs(n){var e=Oe,t=Me;Fn(null),fr(null);try{return n()}finally{Fn(e),fr(t)}}function Fa(n,e,t,r=t){n.addEventListener(e,()=>Fs(t));const a=n.__on_r;a?n.__on_r=()=>{a(),r(!0)}:n.__on_r=()=>r(!0),Ec()}function Tl(n){Me===null&&Oe===null&&zu(),Oe!==null&&(Oe.f&ln)!==0&&Me===null&&Hu(),mi&&qu()}function Ac(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Dn(n,e,t,r=!0){var a=Me;a!==null&&(a.f&En)!==0&&(n|=En);var l={ctx:ht,deps:null,nodes_start:null,nodes_end:null,f:n|un,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{ci(l),l.f|=Ta}catch(v){throw Jn(l),v}else e!==null&&di(l);if(r){var c=l;if(t&&c.deps===null&&c.teardown===null&&c.nodes_start===null&&c.first===c.last&&(c.f&Vi)===0&&(c=c.first),c!==null&&(c.parent=a,a!==null&&Ac(c,a),Oe!==null&&(Oe.f&Zt)!==0&&(n&$r)===0)){var f=Oe;(f.effects??=[]).push(c)}}return l}function Il(n){const e=Dn(Ps,null,!1);return Nt(e,It),e.teardown=n,e}function As(n){Tl();var e=Me.f,t=!Oe&&(e&Xn)!==0&&(e&Ta)===0;if(t){var r=ht;(r.e??=[]).push(n)}else return Pl(n)}function Pl(n){return Dn(xa|dl,n,!1)}function kc(n){return Tl(),Dn(Ps|dl,n,!0)}function jc(n){hi.ensure();const e=Dn($r|Vi,n,!0);return(t={})=>new Promise(r=>{t.outro?Ds(e,()=>{Jn(e),r(void 0)}):(Jn(e),r(void 0))})}function Rl(n){return Dn(xa,n,!1)}function Sc(n){return Dn(Pa|Vi,n,!0)}function Da(n,e=0){return Dn(Ps|e,n,!0)}function it(n,e=[],t=[]){vc(e,t,r=>{Dn(Ps,()=>n(...r.map(A)),!0)})}function Ua(n,e=0){var t=Dn(pi|e,n,!0);return t}function fi(n,e=!0){return Dn(Xn|Vi,n,!0,e)}function Ol(n){var e=n.teardown;if(e!==null){const t=mi,r=Oe;So(!0),Fn(null);try{e.call(null)}finally{So(t),Fn(r)}}}function Ml(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const a=t.ac;a!==null&&Fs(()=>{a.abort(Ra)});var r=t.next;(t.f&$r)!==0?t.parent=null:Jn(t,e),t=r}}function Cc(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Xn)===0&&Jn(e),e=t}}function Jn(n,e=!0){var t=!1;(e||(n.f&Nu)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(xc(n.nodes_start,n.nodes_end),t=!0),Ml(n,e&&!t),ks(n,0),Nt(n,gi);var r=n.transitions;if(r!==null)for(const l of r)l.stop();Ol(n);var a=n.parent;a!==null&&a.first!==null&&Ll(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function xc(n,e){for(;n!==null;){var t=n===e?null:$s(n);n.remove(),n=t}}function Ll(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ds(n,e){var t=[];Na(n,t,!0),$l(t,()=>{Jn(n),e&&e()})}function $l(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var a of n)a.out(r)}else e()}function Na(n,e,t){if((n.f&En)===0){if(n.f^=En,n.transitions!==null)for(const c of n.transitions)(c.is_global||t)&&e.push(c);for(var r=n.first;r!==null;){var a=r.next,l=(r.f&Ia)!==0||(r.f&Xn)!==0;Na(r,e,l?t:!1),r=a}}}function Ba(n){Fl(n,!0)}function Fl(n,e){if((n.f&En)!==0){n.f^=En,(n.f&It)===0&&(Nt(n,un),di(n));for(var t=n.first;t!==null;){var r=t.next,a=(t.f&Ia)!==0||(t.f&Xn)!==0;Fl(t,a?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let ui=!1;function jo(n){ui=n}let mi=!1;function So(n){mi=n}let Oe=null,Mn=!1;function Fn(n){Oe=n}let Me=null;function fr(n){Me=n}let Yn=null;function Dl(n){Oe!==null&&(Yn===null?Yn=[n]:Yn.push(n))}let $t=null,Xt=0,on=null;function Tc(n){on=n}let Ul=1,Bi=0,Mr=Bi;function Co(n){Mr=n}let cr=!1;function Nl(){return++Ul}function Us(n){var e=n.f;if((e&un)!==0)return!0;if((e&vr)!==0){var t=n.deps,r=(e&ln)!==0;if(t!==null){var a,l,c=(e&ys)!==0,f=r&&Me!==null&&!cr,v=t.length;if((c||f)&&(Me===null||(Me.f&gi)===0)){var _=n,y=_.parent;for(a=0;a<v;a++)l=t[a],(c||!l?.reactions?.includes(_))&&(l.reactions??=[]).push(_);c&&(_.f^=ys),f&&y!==null&&(y.f&ln)===0&&(_.f^=ln)}for(a=0;a<v;a++)if(l=t[a],Us(l)&&bl(l),l.wv>n.wv)return!0}(!r||Me!==null&&!cr)&&Nt(n,It)}return!1}function Bl(n,e,t=!0){var r=n.reactions;if(r!==null&&!Yn?.includes(n))for(var a=0;a<r.length;a++){var l=r[a];(l.f&Zt)!==0?Bl(l,e,!1):e===l&&(t?Nt(l,un):(l.f&It)!==0&&Nt(l,vr),di(l))}}function Wl(n){var e=$t,t=Xt,r=on,a=Oe,l=cr,c=Yn,f=ht,v=Mn,_=Mr,y=n.f;$t=null,Xt=0,on=null,cr=(y&ln)!==0&&(Mn||!ui||Oe===null),Oe=(y&(Xn|$r))===0?n:null,Yn=null,ws(n.ctx),Mn=!1,Mr=++Bi,n.ac!==null&&(Fs(()=>{n.ac.abort(Ra)}),n.ac=null);try{n.f|=ca;var E=n.fn,k=E(),g=n.deps;if($t!==null){var x;if(ks(n,Xt),g!==null&&Xt>0)for(g.length=Xt+$t.length,x=0;x<$t.length;x++)g[Xt+x]=$t[x];else n.deps=g=$t;if(!cr||(y&Zt)!==0&&n.reactions!==null)for(x=Xt;x<g.length;x++)(g[x].reactions??=[]).push(n)}else g!==null&&Xt<g.length&&(ks(n,Xt),g.length=Xt);if(_i()&&on!==null&&!Mn&&g!==null&&(n.f&(Zt|vr|un))===0)for(x=0;x<on.length;x++)Bl(on[x],n);return a!==null&&a!==n&&(Bi++,on!==null&&(r===null?r=on:r.push(...on))),(n.f&Or)!==0&&(n.f^=Or),k}catch(L){return lc(L)}finally{n.f^=ca,$t=e,Xt=t,on=r,Oe=a,cr=l,Yn=c,ws(f),Mn=v,Mr=_}}function Ic(n,e){let t=e.reactions;if(t!==null){var r=Lu.call(t,n);if(r!==-1){var a=t.length-1;a===0?t=e.reactions=null:(t[r]=t[a],t.pop())}}t===null&&(e.f&Zt)!==0&&($t===null||!$t.includes(e))&&(Nt(e,vr),(e.f&(ln|ys))===0&&(e.f^=ys),wl(e),ks(e,0))}function ks(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Ic(n,t[r])}function ci(n){var e=n.f;if((e&gi)===0){Nt(n,It);var t=Me,r=ui;Me=n,ui=!0;try{(e&pi)!==0?Cc(n):Ml(n),Ol(n);var a=Wl(n);n.teardown=typeof a=="function"?a:null,n.wv=Ul;var l;ul&&sc&&(n.f&un)!==0&&n.deps}finally{ui=r,Me=t}}}async function Pc(){await Promise.resolve(),gc()}function A(n){var e=n.f,t=(e&Zt)!==0;if(Oe!==null&&!Mn){var r=Me!==null&&(Me.f&gi)!==0;if(!r&&!Yn?.includes(n)){var a=Oe.deps;if((Oe.f&ca)!==0)n.rv<Bi&&(n.rv=Bi,$t===null&&a!==null&&a[Xt]===n?Xt++:$t===null?$t=[n]:(!cr||!$t.includes(n))&&$t.push(n));else{(Oe.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[Oe]:l.includes(Oe)||l.push(Oe)}}}else if(t&&n.deps===null&&n.effects===null){var c=n,f=c.parent;f!==null&&(f.f&ln)===0&&(c.f^=ln)}if(mi){if(dr.has(n))return dr.get(n);if(t){c=n;var v=c.v;return((c.f&It)===0&&c.reactions!==null||Vl(c))&&(v=La(c)),dr.set(c,v),v}}else t&&(c=n,Us(c)&&bl(c));if((n.f&Or)!==0)throw n.v;return n.v}function Vl(n){if(n.v===yt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(dr.has(e)||(e.f&Zt)!==0&&Vl(e))return!0;return!1}function Gi(n){var e=Mn;try{return Mn=!0,n()}finally{Mn=e}}const Rc=-7169;function Nt(n,e){n.f=n.f&Rc|e}function Oc(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(hr in n)fa(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&hr in t&&fa(t)}}}function fa(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{fa(n[r],e)}catch{}const t=Ca(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=cl(t);for(let a in r){const l=r[a].get;if(l)try{l.call(n)}catch{}}}}}const Mc=["touchstart","touchmove"];function Lc(n){return Mc.includes(n)}const ql=new Set,va=new Set;function $c(n,e,t,r={}){function a(l){if(r.capture||Pi.call(e,l),!l.cancelBubble)return Fs(()=>t?.call(this,l))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Ma(()=>{e.addEventListener(n,a,r)}):e.addEventListener(n,a,r),a}function xo(n,e,t,r,a){var l={capture:r,passive:a},c=$c(n,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Il(()=>{e.removeEventListener(n,c,l)})}function Hl(n){for(var e=0;e<n.length;e++)ql.add(n[e]);for(var t of va)t(n)}let To=null;function Pi(n){var e=this,t=e.ownerDocument,r=n.type,a=n.composedPath?.()||[],l=a[0]||n.target;To=n;var c=0,f=To===n&&n.__root;if(f){var v=a.indexOf(f);if(v!==-1&&(e===document||e===window)){n.__root=e;return}var _=a.indexOf(e);if(_===-1)return;v<=_&&(c=v)}if(l=a[c]||n.target,l!==e){ua(n,"currentTarget",{configurable:!0,get(){return l||t}});var y=Oe,E=Me;Fn(null),fr(null);try{for(var k,g=[];l!==null;){var x=l.assignedSlot||l.parentNode||l.host||null;try{var L=l["__"+r];if(L!=null&&(!l.disabled||n.target===l))if(Is(L)){var[F,...K]=L;F.apply(l,[n,...K])}else L.call(l,n)}catch(Y){k?g.push(Y):k=Y}if(n.cancelBubble||x===e||x===null)break;l=x}if(k){for(let Y of g)queueMicrotask(()=>{throw Y});throw k}}finally{n.__root=e,delete n.currentTarget,Fn(y),fr(E)}}}function Fc(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function js(n,e){var t=Me;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function _e(n,e){var t=(e&Zu)!==0,r=(e&ec)!==0,a,l=!n.startsWith("<!>");return()=>{a===void 0&&(a=Fc(l?n:"<!>"+n),t||(a=Es(a)));var c=r||Sl?document.importNode(a,!0):a.cloneNode(!0);if(t){var f=Es(c),v=c.lastChild;js(f,v)}else js(c,c);return c}}function Qs(n=""){{var e=Fr(n+"");return js(e,e),e}}function Ln(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Fr();return n.append(e,t),js(e,t),n}function ae(n,e){n!==null&&n.before(e)}function qe(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Dc(n,e){return Uc(n,e)}const Yr=new Map;function Uc(n,{target:e,anchor:t,props:r={},events:a,context:l,intro:c=!0}){wc();var f=new Set,v=E=>{for(var k=0;k<E.length;k++){var g=E[k];if(!f.has(g)){f.add(g);var x=Lc(g);e.addEventListener(g,Pi,{passive:x});var L=Yr.get(g);L===void 0?(document.addEventListener(g,Pi,{passive:x}),Yr.set(g,1)):Yr.set(g,L+1)}}};v(Sa(ql)),va.add(v);var _=void 0,y=jc(()=>{var E=t??e.appendChild(Fr());return fi(()=>{if(l){Hi({});var k=ht;k.c=l}a&&(r.$$events=a),_=n(E,r)||{},l&&zi()}),()=>{for(var k of f){e.removeEventListener(k,Pi);var g=Yr.get(k);--g===0?(document.removeEventListener(k,Pi),Yr.delete(k)):Yr.set(k,g)}va.delete(v),E!==t&&E.parentNode?.removeChild(E)}});return Nc.set(_,y),_}let Nc=new WeakMap;function Ge(n,e,t=!1){var r=n,a=null,l=null,c=yt,f=t?Ia:0,v=!1;const _=(g,x=!0)=>{v=!0,k(x,g)};var y=null;function E(){y!==null&&(y.lastChild.remove(),r.before(y),y=null);var g=c?a:l,x=c?l:a;g&&Ba(g),x&&Ds(x,()=>{c?l=null:a=null})}const k=(g,x)=>{if(c!==(c=g)){var L=$a(),F=r;if(L&&(y=document.createDocumentFragment(),y.append(F=Fr())),c?a??=x&&fi(()=>x(F)):l??=x&&fi(()=>x(F)),L){var K=Qe,Y=c?a:l,q=c?l:a;Y&&K.skipped_effects.delete(Y),q&&K.skipped_effects.add(q),K.add_callback(E)}else E()}};Ua(()=>{v=!1,e(_),v||k(null,null)},f)}function Io(n,e,t){var r=n,a=yt,l,c,f=null,v=_i()?ic:pl;function _(){l&&Ds(l),f!==null&&(f.lastChild.remove(),r.before(f),f=null),l=c}Ua(()=>{if(v(a,a=e())){var y=r,E=$a();E&&(f=document.createDocumentFragment(),f.append(y=Fr())),c=fi(()=>t(y)),E?Qe.add_callback(_):_()}})}function an(n,e){return e}function Bc(n,e,t){for(var r=n.items,a=[],l=e.length,c=0;c<l;c++)Na(e[c].e,a,!0);var f=l>0&&a.length===0&&t!==null;if(f){var v=t.parentNode;bc(v),v.append(t),r.clear(),Rn(n,e[0].prev,e[l-1].next)}$l(a,()=>{for(var _=0;_<l;_++){var y=e[_];f||(r.delete(y.k),Rn(n,y.prev,y.next)),Jn(y.e,!f)}})}function Tt(n,e,t,r,a,l=null){var c=n,f={flags:e,items:new Map,first:null},v=(e&fl)!==0;if(v){var _=n;c=_.appendChild(Fr())}var y=null,E=!1,k=new Map,g=yl(()=>{var K=t();return Is(K)?K:K==null?[]:Sa(K)}),x,L;function F(){Wc(L,x,f,k,c,a,e,r,t),l!==null&&(x.length===0?y?Ba(y):y=fi(()=>l(c)):y!==null&&Ds(y,()=>{y=null}))}Ua(()=>{L??=Me,x=A(g);var K=x.length;if(!(E&&K===0)){E=K===0;var Y,q,J,X;if($a()){var P=new Set,M=Qe;for(q=0;q<K;q+=1){J=x[q],X=r(J,q);var oe=f.items.get(X)??k.get(X);oe?(e&(Rs|Os))!==0&&zl(oe,J,q,e):(Y=Gl(null,f,null,null,J,X,q,a,e,t,!0),k.set(X,Y)),P.add(X)}for(const[ce,fe]of f.items)P.has(ce)||M.skipped_effects.add(fe.e);M.add_callback(F)}else F();A(g)}})}function Wc(n,e,t,r,a,l,c,f,v){var _=(c&Xu)!==0,y=(c&(Rs|Os))!==0,E=e.length,k=t.items,g=t.first,x=g,L,F=null,K,Y=[],q=[],J,X,P,M;if(_)for(M=0;M<E;M+=1)J=e[M],X=f(J,M),P=k.get(X),P!==void 0&&(P.a?.measure(),(K??=new Set).add(P));for(M=0;M<E;M+=1){if(J=e[M],X=f(J,M),P=k.get(X),P===void 0){var oe=r.get(X);if(oe!==void 0){r.delete(X),k.set(X,oe);var ce=F?F.next:x;Rn(t,F,oe),Rn(t,oe,ce),Zs(oe,ce,a),F=oe}else{var fe=x?x.e.nodes_start:a;F=Gl(fe,t,F,F===null?t.first:F.next,J,X,M,l,c,v)}k.set(X,F),Y=[],q=[],x=F.next;continue}if(y&&zl(P,J,M,c),(P.e.f&En)!==0&&(Ba(P.e),_&&(P.a?.unfix(),(K??=new Set).delete(P))),P!==x){if(L!==void 0&&L.has(P)){if(Y.length<q.length){var Z=q[0],ge;F=Z.prev;var Ue=Y[0],et=Y[Y.length-1];for(ge=0;ge<Y.length;ge+=1)Zs(Y[ge],Z,a);for(ge=0;ge<q.length;ge+=1)L.delete(q[ge]);Rn(t,Ue.prev,et.next),Rn(t,F,Ue),Rn(t,et,Z),x=Z,F=et,M-=1,Y=[],q=[]}else L.delete(P),Zs(P,x,a),Rn(t,P.prev,P.next),Rn(t,P,F===null?t.first:F.next),Rn(t,F,P),F=P;continue}for(Y=[],q=[];x!==null&&x.k!==X;)(x.e.f&En)===0&&(L??=new Set).add(x),q.push(x),x=x.next;if(x===null)continue;P=x}Y.push(P),F=P,x=P.next}if(x!==null||L!==void 0){for(var Ke=L===void 0?[]:Sa(L);x!==null;)(x.e.f&En)===0&&Ke.push(x),x=x.next;var vt=Ke.length;if(vt>0){var ke=(c&fl)!==0&&E===0?a:null;if(_){for(M=0;M<vt;M+=1)Ke[M].a?.measure();for(M=0;M<vt;M+=1)Ke[M].a?.fix()}Bc(t,Ke,ke)}}_&&Ma(()=>{if(K!==void 0)for(P of K)P.a?.apply()}),n.first=t.first&&t.first.e,n.last=F&&F.e;for(var cn of r.values())Jn(cn.e);r.clear()}function zl(n,e,t,r){(r&Rs)!==0&&Ni(n.v,e),(r&Os)!==0?Ni(n.i,t):n.i=t}function Gl(n,e,t,r,a,l,c,f,v,_,y){var E=(v&Rs)!==0,k=(v&Qu)===0,g=E?k?mc(a,!1,!1):Ui(a):a,x=(v&Os)===0?c:Ui(c),L={i:x,v:g,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var F=document.createDocumentFragment();F.append(n=Fr())}return L.e=fi(()=>f(n,g,x,_),rc),L.e.prev=t&&t.e,L.e.next=r&&r.e,t===null?y||(e.first=L):(t.next=L,t.e.next=L.e),r!==null&&(r.prev=L,r.e.prev=L.e),L}finally{}}function Zs(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,a=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var c=$s(l);a.before(l),l=c}}function Rn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Vc(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Ii(n,e,t,r,a,l){var c=n.__className;if(c!==t||c===void 0){var f=Vc(t,r);f==null?n.removeAttribute("class"):n.className=f,n.__className=t}return l}function Kl(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Is(e))return nc();for(var r of n.options)r.selected=e.includes(Mi(r));return}for(r of n.options){var a=Mi(r);if(yc(a,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function qc(n){var e=new MutationObserver(()=>{Kl(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Il(()=>{e.disconnect()})}function sr(n,e,t=e){var r=!0;Fa(n,"change",a=>{var l=a?"[selected]":":checked",c;if(n.multiple)c=[].map.call(n.querySelectorAll(l),Mi);else{var f=n.querySelector(l)??n.querySelector("option:not([disabled])");c=f&&Mi(f)}t(c)}),Rl(()=>{var a=e();if(Kl(n,a,r),r&&a===void 0){var l=n.querySelector(":checked");l!==null&&(a=Mi(l),t(a))}n.__value=a,r=!1}),qc(n)}function Mi(n){return"__value"in n?n.__value:n.value}const Hc=Symbol("is custom element"),zc=Symbol("is html");function Po(n,e,t,r){var a=Gc(n);a[e]!==(a[e]=t)&&(t==null?n.removeAttribute(e):typeof t!="string"&&Kc(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Gc(n){return n.__attributes??={[Hc]:n.nodeName.includes("-"),[zc]:n.namespaceURI===tc}}var Ro=new Map;function Kc(n){var e=n.getAttribute("is")||n.nodeName,t=Ro.get(e);if(t)return t;Ro.set(e,t=[]);for(var r,a=n,l=Element.prototype;l!==a;){r=cl(a);for(var c in r)r[c].set&&t.push(c);a=Ca(a)}return t}function Pn(n,e,t=e){var r=new WeakSet;Fa(n,"input",async a=>{var l=a?n.defaultValue:n.value;if(l=ea(n)?ta(l):l,t(l),Qe!==null&&r.add(Qe),await Pc(),l!==(l=e())){var c=n.selectionStart,f=n.selectionEnd;n.value=l??"",f!==null&&(n.selectionStart=c,n.selectionEnd=Math.min(f,n.value.length))}}),Gi(e)==null&&n.value&&(t(ea(n)?ta(n.value):n.value),Qe!==null&&r.add(Qe)),Da(()=>{var a=e();if(n===document.activeElement){var l=ps??Qe;if(r.has(l))return}ea(n)&&a===ta(n.value)||n.type==="date"&&!a&&!n.value||a!==n.value&&(n.value=a??"")})}function Oo(n,e,t=e){Fa(n,"change",r=>{var a=r?n.defaultChecked:n.checked;t(a)}),Gi(e)==null&&t(n.checked),Da(()=>{var r=e();n.checked=!!r})}function ea(n){var e=n.type;return e==="number"||e==="range"}function ta(n){return n===""?null:+n}function Mo(n,e){return n===e||n?.[hr]===e}function Yc(n={},e,t,r){return Rl(()=>{var a,l;return Da(()=>{a=l,l=[],Gi(()=>{n!==t(...l)&&(e(n,...l),a&&Mo(t(...a),n)&&e(null,...a))})}),()=>{Ma(()=>{l&&Mo(t(...l),n)&&e(null,...l)})}}),n}function Jc(n=!1){const e=ht,t=e.l.u;if(!t)return;let r=()=>Oc(e.s);if(n){let a=0,l={};const c=Ms(()=>{let f=!1;const v=e.s;for(const _ in v)v[_]!==l[_]&&(l[_]=v[_],f=!0);return f&&a++,a});r=()=>A(c)}t.b.length&&kc(()=>{Lo(e,r),ms(t.b)}),As(()=>{const a=Gi(()=>t.m.map(Du));return()=>{for(const l of a)typeof l=="function"&&l()}}),t.a.length&&As(()=>{Lo(e,r),ms(t.a)})}function Lo(n,e){if(n.l.s)for(const t of n.l.s)A(t);e()}function Wa(n){ht===null&&Wu(),qi&&ht.l!==null?Xc(ht).m.push(n):As(()=>{const e=Gi(n);if(typeof e=="function")return e})}function Xc(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Qc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Qc);ac();class Zc{#n=Ze($n({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return A(this.#n)}set player(e){he(this.#n,e,!0)}#t=Ze(null);get storyData(){return A(this.#t)}set storyData(e){he(this.#t,e,!0)}#e=Ze("0");get currentDialogueId(){return A(this.#e)}set currentDialogueId(e){he(this.#e,e,!0)}#r=Ze(!0);get isLoading(){return A(this.#r)}set isLoading(e){he(this.#r,e,!0)}#i=Ze("");get error(){return A(this.#i)}set error(e){he(this.#i,e,!0)}async loadStory(e){this.isLoading=!0;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.storyData=await t.json(),this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){this.error="Ошибка загрузки: "+t.message,console.error(t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}runActions(e){e&&e.forEach(t=>{t.type==="add_item"&&t.id&&this.addItem(t.id),t.type==="stat_change"&&t.stat&&t.value!==void 0&&(this.player.stats[t.stat]+=t.value)})}goToDialogue(e){this.currentDialogueId=e}}const Ut=new Zc;function eh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function th(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var a=!1;try{a=this instanceof r}catch{}return a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var a=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return n[r]}})}),t}var _s={exports:{}},nh=_s.exports,$o;function rh(){return $o||($o=1,(function(n,e){(function(r,a){n.exports=a()})(nh,()=>(()=>{var t=[,((c,f,v)=>{v.r(f),v.d(f,{default:()=>y});var _=(()=>{var E=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(k={}){var g=k,x,L;g.ready=new Promise((i,s)=>{x=i,L=s});function F(){function i(j){const I=d;u=s=0,d=new Map,I.forEach(R=>{try{R(j)}catch(T){console.error(T)}}),this.pb(),m&&m.Tb()}let s=0,u=0,d=new Map,m=null,b=null;this.requestAnimationFrame=function(j){s||(s=requestAnimationFrame(i.bind(this)));const I=++u;return d.set(I,j),I},this.cancelAnimationFrame=function(j){d.delete(j),s&&d.size==0&&(cancelAnimationFrame(s),s=0)},this.Rb=function(j){b&&(document.body.remove(b),b=null),j||(b=document.createElement("div"),b.style.backgroundColor="black",b.style.position="fixed",b.style.right=0,b.style.top=0,b.style.color="white",b.style.padding="4px",b.innerHTML="RIVE FPS",j=function(I){b.innerHTML="RIVE FPS "+I.toFixed(1)},document.body.appendChild(b)),m=new function(){let I=0,R=0;this.Tb=function(){var T=performance.now();R?(++I,T-=R,1e3<T&&(j(1e3*I/T),I=R=0)):(R=T,I=0)}}},this.Ob=function(){b&&(document.body.remove(b),b=null),m=null},this.pb=function(){}}function K(i){console.assert(!0);const s=new Map;let u=-1/0;this.push=function(d){return d=d+((1<<i)-1)>>i,s.has(d)&&clearTimeout(s.get(d)),s.set(d,setTimeout(function(){s.delete(d),s.length==0?u=-1/0:d==u&&(u=Math.max(...s.keys()),console.assert(u<d))},1e3)),u=Math.max(d,u),u<<i}}const Y=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){Y&&Y();let i=g.decodeAudio;g.decodeAudio=function(m,b){m=i(m),b(m)};let s=g.decodeFont;g.decodeFont=function(m,b){m=s(m),b(m)};const u=g.FileAssetLoader;g.ptrToAsset=m=>{let b=g.ptrToFileAsset(m);return b.isImage?g.ptrToImageAsset(m):b.isFont?g.ptrToFontAsset(m):b.isAudio?g.ptrToAudioAsset(m):b},g.CustomFileAssetLoader=u.extend("CustomFileAssetLoader",{__construct:function({loadContents:m}){this.__parent.__construct.call(this),this.Gb=m},loadContents:function(m,b){return m=g.ptrToAsset(m),this.Gb(m,b)}}),g.CDNFileAssetLoader=u.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(m){let b=g.ptrToAsset(m);return m=b.cdnUuid,m===""?!1:((function(j,I){var R=new XMLHttpRequest;R.responseType="arraybuffer",R.onreadystatechange=function(){R.readyState==4&&R.status==200&&I(R)},R.open("GET",j,!0),R.send(null)})(b.cdnBaseUrl+"/"+m,j=>{b.decode(new Uint8Array(j.response))}),!0)}}),g.FallbackFileAssetLoader=u.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(m){this.lb.push(m)},loadContents:function(m,b){for(let j of this.lb)if(j.loadContents(m,b))return!0;return!1}});let d=g.computeAlignment;g.computeAlignment=function(m,b,j,I,R=1){return d.call(this,m,b,j,I,R)}};const q="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),J=new function(){function i(){if(!s){let be=function(Ae,Q,Xe){if(Q=B.createShader(Q),B.shaderSource(Q,Xe),B.compileShader(Q),Xe=B.getShaderInfoLog(Q),0<(Xe||"").length)throw Xe;B.attachShader(Ae,Q)};var S=document.createElement("canvas"),V={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let B;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(B=S.getContext("webgl",V),u=1,!B)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(B=S.getContext("webgl2",V))u=2;else if(B=S.getContext("webgl",V))u=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(B=new Proxy(B,{get(Ae,Q){if(Ae.isContextLost()){if(R||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Q),R=!0),typeof Ae[Q]=="function")return function(){}}else return typeof Ae[Q]=="function"?function(...Xe){return Ae[Q].apply(Ae,Xe)}:Ae[Q]},set(Ae,Q,Xe){if(Ae.isContextLost())R||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Q),R=!0);else return Ae[Q]=Xe,!0}}),d=Math.min(B.getParameter(B.MAX_RENDERBUFFER_SIZE),B.getParameter(B.MAX_TEXTURE_SIZE)),S=B.createProgram(),be(S,B.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),be(S,B.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),B.bindAttribLocation(S,0,"vertex"),B.bindAttribLocation(S,1,"uv"),B.linkProgram(S),V=B.getProgramInfoLog(S),0<(V||"").trim().length)throw V;m=B.getUniformLocation(S,"mat"),b=B.getUniformLocation(S,"translate"),B.useProgram(S),B.bindBuffer(B.ARRAY_BUFFER,B.createBuffer()),B.enableVertexAttribArray(0),B.enableVertexAttribArray(1),B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,B.createBuffer()),B.uniform1i(B.getUniformLocation(S,"image"),0),B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s=B}return!0}let s=null,u=0,d=0,m=null,b=null,j=0,I=0,R=!1;i(),this.hc=function(){return i(),d},this.Mb=function(S){s.deleteTexture&&s.deleteTexture(S)},this.Lb=function(S){if(!i())return null;const V=s.createTexture();return V?(s.bindTexture(s.TEXTURE_2D,V),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,S),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),u==2?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),V):null};const T=new K(8),H=new K(8),G=new K(10),ne=new K(10);this.Qb=function(S,V,B,be,Ae){if(i()){var Q=T.push(S),Xe=H.push(V);if(s.canvas){(s.canvas.width!=Q||s.canvas.height!=Xe)&&(s.canvas.width=Q,s.canvas.height=Xe),s.viewport(0,Xe-V,S,V),s.disable(s.SCISSOR_TEST),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.enable(s.SCISSOR_TEST),B.sort((Pe,In)=>In.xb-Pe.xb),Q=G.push(be),j!=Q&&(s.bufferData(s.ARRAY_BUFFER,8*Q,s.DYNAMIC_DRAW),j=Q),Q=0;for(var bt of B)s.bufferSubData(s.ARRAY_BUFFER,Q,bt.Ua),Q+=4*bt.Ua.length;console.assert(Q==4*be);for(var Tn of B)s.bufferSubData(s.ARRAY_BUFFER,Q,Tn.Db),Q+=4*Tn.Db.length;console.assert(Q==8*be),Q=ne.push(Ae),I!=Q&&(s.bufferData(s.ELEMENT_ARRAY_BUFFER,2*Q,s.DYNAMIC_DRAW),I=Q),bt=0;for(var kr of B)s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,bt,kr.indices),bt+=2*kr.indices.length;console.assert(bt==2*Ae),kr=0,Tn=!0,Q=bt=0;for(const Pe of B){Pe.image.Ka!=kr&&(s.bindTexture(s.TEXTURE_2D,Pe.image.Ja||null),kr=Pe.image.Ka),Pe.mc?(s.scissor(Pe.Za,Xe-Pe.$a-Pe.kb,Pe.Ac,Pe.kb),Tn=!0):Tn&&(s.scissor(0,Xe-V,S,V),Tn=!1),B=2/S;const In=-2/V;s.uniform4f(m,Pe.ha[0]*B*Pe.Ba,Pe.ha[1]*In*Pe.Ca,Pe.ha[2]*B*Pe.Ba,Pe.ha[3]*In*Pe.Ca),s.uniform2f(b,Pe.ha[4]*B*Pe.Ba+B*(Pe.Za-Pe.ic*Pe.Ba)-1,Pe.ha[5]*In*Pe.Ca+In*(Pe.$a-Pe.jc*Pe.Ca)+1),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,Q),s.vertexAttribPointer(1,2,s.FLOAT,!1,0,Q+4*be),s.drawElements(s.TRIANGLES,Pe.indices.length,s.UNSIGNED_SHORT,bt),Q+=4*Pe.Ua.length,bt+=2*Pe.indices.length}console.assert(Q==4*be),console.assert(bt==2*Ae)}}},this.canvas=function(){return i()&&s.canvas}},X=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(N){switch(N){case T.srcOver:return"source-over";case T.screen:return"screen";case T.overlay:return"overlay";case T.darken:return"darken";case T.lighten:return"lighten";case T.colorDodge:return"color-dodge";case T.colorBurn:return"color-burn";case T.hardLight:return"hard-light";case T.softLight:return"soft-light";case T.difference:return"difference";case T.exclusion:return"exclusion";case T.multiply:return"multiply";case T.hue:return"hue";case T.saturation:return"saturation";case T.color:return"color";case T.luminosity:return"luminosity"}}function s(N){return"rgba("+((16711680&N)>>>16)+","+((65280&N)>>>8)+","+((255&N)>>>0)+","+((4278190080&N)>>>24)/255+")"}function u(){0<Xe.length&&(J.Qb(Q.drawWidth(),Q.drawHeight(),Xe,bt,Tn),Xe=[],Tn=bt=0,Q.reset(512,512));for(const N of Ae){for(const ee of N.H)ee();N.H=[]}Ae.clear()}X&&X();var d=g.RenderPaintStyle;const m=g.RenderPath,b=g.RenderPaint,j=g.Renderer,I=g.StrokeCap,R=g.StrokeJoin,T=g.BlendMode,H=d.fill,G=d.stroke,ne=g.FillRule.evenOdd;let S=1;var V=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:N,xa:ee}={}){this.__parent.__construct.call(this),this.Ka=S,S=S+1&2147483647||1,this.la=N,this.xa=ee},__destruct:function(){this.Ja&&(J.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(N){var ee=this;ee.xa&&ee.xa(ee);var xe=new Image;ee.Xa=URL.createObjectURL(new Blob([N],{type:"image/png"})),xe.onload=function(){ee.Fb=xe,ee.Ja=J.Lb(xe),ee.size(xe.width,xe.height),ee.la&&ee.la(ee)},xe.src=ee.Xa}}),B=m.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(N,ee,xe,Re,Ee,Te,$e){var De=this.T,yn=De.addPath;N=N.T;const gt=new DOMMatrix;gt.a=ee,gt.b=xe,gt.c=Re,gt.d=Ee,gt.e=Te,gt.f=$e,yn.call(De,N,gt)},fillRule:function(N){this.Wa=N},moveTo:function(N,ee){this.T.moveTo(N,ee)},lineTo:function(N,ee){this.T.lineTo(N,ee)},cubicTo:function(N,ee,xe,Re,Ee,Te){this.T.bezierCurveTo(N,ee,xe,Re,Ee,Te)},close:function(){this.T.closePath()}}),be=b.extend("CanvasRenderPaint",{color:function(N){this.Ya=s(N)},thickness:function(N){this.Ib=N},join:function(N){switch(N){case R.miter:this.Ia="miter";break;case R.round:this.Ia="round";break;case R.bevel:this.Ia="bevel"}},cap:function(N){switch(N){case I.butt:this.Ha="butt";break;case I.round:this.Ha="round";break;case I.square:this.Ha="square"}},style:function(N){this.Hb=N},blendMode:function(N){this.Eb=i(N)},clearGradient:function(){this.ja=null},linearGradient:function(N,ee,xe,Re){this.ja={zb:N,Ab:ee,cb:xe,eb:Re,Ra:[]}},radialGradient:function(N,ee,xe,Re){this.ja={zb:N,Ab:ee,cb:xe,eb:Re,Ra:[],ec:!0}},addStop:function(N,ee){this.ja.Ra.push({color:N,stop:ee})},completeGradient:function(){},draw:function(N,ee,xe){let Re=this.Hb;var Ee=this.Ya,Te=this.ja;if(N.globalCompositeOperation=this.Eb,Te!=null){Ee=Te.zb;var $e=Te.Ab;const yn=Te.cb;var De=Te.eb;const gt=Te.Ra;Te.ec?(Te=yn-Ee,De-=$e,Ee=N.createRadialGradient(Ee,$e,0,Ee,$e,Math.sqrt(Te*Te+De*De))):Ee=N.createLinearGradient(Ee,$e,yn,De);for(let sn=0,_t=gt.length;sn<_t;sn++)$e=gt[sn],Ee.addColorStop($e.stop,s($e.color));this.Ya=Ee,this.ja=null}switch(Re){case G:N.strokeStyle=Ee,N.lineWidth=this.Ib,N.lineCap=this.Ha,N.lineJoin=this.Ia,N.stroke(ee);break;case H:N.fillStyle=Ee,N.fill(ee,xe)}}});const Ae=new Set;let Q=null,Xe=[],bt=0,Tn=0;var kr=g.CanvasRenderer=j.extend("Renderer",{__construct:function(N){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=N.getContext("2d"),this.Va=N,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const N=this.S.length-6;if(6>N)throw"restore() called without matching save().";this.S.splice(N),this.H.push(this.C.restore.bind(this.C))},transform:function(N,ee,xe,Re,Ee,Te){const $e=this.S,De=$e.length-6;$e.splice(De,6,$e[De]*N+$e[De+2]*ee,$e[De+1]*N+$e[De+3]*ee,$e[De]*xe+$e[De+2]*Re,$e[De+1]*xe+$e[De+3]*Re,$e[De]*Ee+$e[De+2]*Te+$e[De+4],$e[De+1]*Ee+$e[De+3]*Te+$e[De+5]),this.H.push(this.C.transform.bind(this.C,N,ee,xe,Re,Ee,Te))},rotate:function(N){const ee=Math.sin(N);N=Math.cos(N),this.transform(N,ee,-ee,N,0,0)},_drawPath:function(N,ee){this.H.push(ee.draw.bind(ee,this.C,N.T,N.Wa===ne?"evenodd":"nonzero"))},_drawRiveImage:function(N,ee,xe,Re){var Ee=N.Fb;if(Ee){var Te=this.C,$e=i(xe);this.H.push(function(){Te.globalCompositeOperation=$e,Te.globalAlpha=Re,Te.drawImage(Ee,0,0),Te.globalAlpha=1})}},_getMatrix:function(N){const ee=this.S,xe=ee.length-6;for(let Re=0;6>Re;++Re)N[Re]=ee[xe+Re]},_drawImageMesh:function(N,ee,xe,Re,Ee,Te,$e,De,yn,gt,sn){ee=this.C.canvas.width;var _t=this.C.canvas.height;const fo=gt-De,vo=sn-yn;De=Math.max(De,0),yn=Math.max(yn,0),gt=Math.min(gt,ee),sn=Math.min(sn,_t);const xi=gt-De,Ti=sn-yn;if(console.assert(xi<=Math.min(fo,ee)),console.assert(Ti<=Math.min(vo,_t)),!(0>=xi||0>=Ti)){gt=xi<fo||Ti<vo,ee=sn=1;var jr=Math.ceil(xi*sn),Sr=Math.ceil(Ti*ee);_t=J.hc(),jr>_t&&(sn*=_t/jr,jr=_t),Sr>_t&&(ee*=_t/Sr,Sr=_t),Q||(Q=new g.DynamicRectanizer(_t),Q.reset(512,512)),_t=Q.addRect(jr,Sr),0>_t&&(u(),Ae.add(this),_t=Q.addRect(jr,Sr),console.assert(0<=_t));var po=_t&65535,go=_t>>16;Xe.push({ha:this.S.slice(this.S.length-6),image:N,Za:po,$a:go,ic:De,jc:yn,Ac:jr,kb:Sr,Ba:sn,Ca:ee,Ua:new Float32Array(Ee),Db:new Float32Array(Te),indices:new Uint16Array($e),mc:gt,xb:N.Ka<<1|(gt?1:0)}),bt+=Ee.length,Tn+=$e.length;var Kr=this.C,Mu=i(xe);this.H.push(function(){Kr.save(),Kr.resetTransform(),Kr.globalCompositeOperation=Mu,Kr.globalAlpha=Re;const _o=J.canvas();_o&&Kr.drawImage(_o,po,go,jr,Sr,De,yn,xi,Ti),Kr.restore()})}},_clipPath:function(N){this.H.push(this.C.clip.bind(this.C,N.T,N.Wa===ne?"evenodd":"nonzero"))},clear:function(){Ae.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(N,ee){this.transform(1,0,0,1,N,ee)}});g.makeRenderer=function(N){const ee=new kr(N),xe=ee.C;return new Proxy(ee,{get(Re,Ee){if(typeof Re[Ee]=="function")return function(...Te){return Re[Ee].apply(Re,Te)};if(typeof xe[Ee]=="function"){if(-1<q.indexOf(Ee))throw Error("RiveException: Method call to '"+Ee+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Te){ee.H.push(xe[Ee].bind(xe,...Te))}}return Re[Ee]},set(Re,Ee,Te){if(Ee in xe)return ee.H.push(()=>{xe[Ee]=Te}),!0}})},g.decodeImage=function(N,ee){new V({la:ee}).decode(N)},g.renderFactory={makeRenderPaint:function(){return new be},makeRenderPath:function(){return new B},makeRenderImage:function(){let N=In;return new V({xa:()=>{N.total++},la:()=>{if(N.loaded++,N.loaded===N.total){const ee=N.ready;ee&&(ee(),N.ready=null)}}})}};let Pe=g.load,In=null;g.load=function(N,ee,xe=!0){const Re=new g.FallbackFileAssetLoader;return ee!==void 0&&Re.addLoader(ee),xe&&(ee=new g.CDNFileAssetLoader,Re.addLoader(ee)),new Promise(function(Ee){let Te=null;In={total:0,loaded:0,ready:function(){Ee(Te)}},Te=Pe(N,Re),In.total==0&&Ee(Te)})};let Ou=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(N,ee,xe,Re,Ee=1){Ou.call(this,N,ee,xe,Re,Ee)},d=new F,g.requestAnimationFrame=d.requestAnimationFrame.bind(d),g.cancelAnimationFrame=d.cancelAnimationFrame.bind(d),g.enableFPSCounter=d.Rb.bind(d),g.disableFPSCounter=d.Ob,d.pb=u,g.resolveAnimationFrame=u,g.cleanup=function(){Q&&Q.delete()}};var P=Object.assign({},g),M="./this.program",oe=typeof window=="object",ce=typeof importScripts=="function",fe="",Z,ge;(oe||ce)&&(ce?fe=self.location.href:typeof document<"u"&&document.currentScript&&(fe=document.currentScript.src),E&&(fe=E),fe.indexOf("blob:")!==0?fe=fe.substr(0,fe.replace(/[?#].*/,"").lastIndexOf("/")+1):fe="",ce&&(ge=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Z=(i,s,u)=>{var d=new XMLHttpRequest;d.open("GET",i,!0),d.responseType="arraybuffer",d.onload=()=>{d.status==200||d.status==0&&d.response?s(d.response):u()},d.onerror=u,d.send(null)});var Ue=g.print||console.log.bind(console),et=g.printErr||console.error.bind(console);Object.assign(g,P),P=null,g.thisProgram&&(M=g.thisProgram);var Ke;g.wasmBinary&&(Ke=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&vn("no native wasm support detected");var vt,ke,cn=!1,ot,Ye,lt,Ft,je,Ie,Bt,Le;function Et(){var i=vt.buffer;g.HEAP8=ot=new Int8Array(i),g.HEAP16=lt=new Int16Array(i),g.HEAP32=je=new Int32Array(i),g.HEAPU8=Ye=new Uint8Array(i),g.HEAPU16=Ft=new Uint16Array(i),g.HEAPU32=Ie=new Uint32Array(i),g.HEAPF32=Bt=new Float32Array(i),g.HEAPF64=Le=new Float64Array(i)}var tt,hn=[],dn=[],fn=[];function Un(){var i=g.preRun.shift();hn.unshift(i)}var At=0,Wt=null;function vn(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",et(i),cn=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),L(i),i}function Qn(i){return i.startsWith("data:application/octet-stream;base64,")}var Vt;if(Vt="canvas_advanced.wasm",!Qn(Vt)){var gr=Vt;Vt=g.locateFile?g.locateFile(gr,fe):fe+gr}function Pt(i){if(i==Vt&&Ke)return new Uint8Array(Ke);if(ge)return ge(i);throw"both async and sync fetching of the wasm failed"}function wi(i){if(!Ke&&(oe||ce)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw"failed to load wasm binary file at '"+i+"'";return s.arrayBuffer()}).catch(()=>Pt(i));if(Z)return new Promise((s,u)=>{Z(i,d=>s(new Uint8Array(d)),u)})}return Promise.resolve().then(()=>Pt(i))}function Ur(i,s,u){return wi(i).then(d=>WebAssembly.instantiate(d,s)).then(d=>d).then(u,d=>{et("failed to asynchronously prepare wasm: "+d),vn(d)})}function bi(i,s){var u=Vt;return Ke||typeof WebAssembly.instantiateStreaming!="function"||Qn(u)||u.startsWith("file://")||typeof fetch!="function"?Ur(u,i,s):fetch(u,{credentials:"same-origin"}).then(d=>WebAssembly.instantiateStreaming(d,i).then(s,function(m){return et("wasm streaming compile failed: "+m),et("falling back to ArrayBuffer instantiation"),Ur(u,i,s)}))}var An,p,o={460492:(i,s,u,d,m)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=s,window.h.I.La=u,window.h.ga={},window.h.ga.stopped=d,window.h.ga.yb=m;let b=window.h;b.D=[],b.yc=function(j){for(var I=0;I<b.D.length;++I)if(b.D[I]==null)return b.D[I]=j,I;return b.D.push(j),b.D.length-1},b.Cb=function(j){for(b.D[j]=null;0<b.D.length&&b.D[b.D.length-1]==null;)b.D.pop()},b.Sc=function(j){for(var I=0;I<b.D.length;++I)if(b.D[I]==j)return b.Cb(I)},b.ra=function(j){return b.D[j]},b.Ta=["touchend","click"],b.unlock=function(){for(var j=0;j<b.D.length;++j){var I=b.D[j];I!=null&&I.J!=null&&I.state===b.ga.yb&&I.J.resume().then(()=>{oo(I.qb)},R=>{console.error("Failed to resume audiocontext",R)})}b.Ta.map(function(R){document.removeEventListener(R,b.unlock,!0)})},b.Ta.map(function(j){document.addEventListener(j,b.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),s=i.sampleRate;return i.close(),s}catch{return 0}},463249:(i,s,u,d,m,b)=>{if(typeof window.h>"u")return-1;var j={},I={};return i==window.h.I.ya&&u!=0&&(I.sampleRate=u),j.J=new(window.AudioContext||window.webkitAudioContext)(I),j.J.suspend(),j.state=window.h.ga.stopped,u=0,i!=window.h.I.ya&&(u=s),j.Z=j.J.createScriptProcessor(d,u,s),j.Z.onaudioprocess=function(R){if((j.sa==null||j.sa.length==0)&&(j.sa=new Float32Array(Bt.buffer,m,d*s)),i==window.h.I.capture||i==window.h.I.La){for(var T=0;T<s;T+=1)for(var H=R.inputBuffer.getChannelData(T),G=j.sa,ne=0;ne<d;ne+=1)G[ne*s+T]=H[ne];lo(b,d,m)}if(i==window.h.I.ya||i==window.h.I.La)for(uo(b,d,m),T=0;T<R.outputBuffer.numberOfChannels;++T)for(H=R.outputBuffer.getChannelData(T),G=j.sa,ne=0;ne<d;ne+=1)H[ne]=G[ne*s+T];else for(T=0;T<R.outputBuffer.numberOfChannels;++T)R.outputBuffer.getChannelData(T).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(R){j.Da=j.J.createMediaStreamSource(R),j.Da.connect(j.Z),j.Z.connect(j.J.destination)}).catch(function(R){console.log("Failed to get user media: "+R)}),i==window.h.I.ya&&j.Z.connect(j.J.destination),j.qb=b,window.h.yc(j)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},h=i=>{for(;0<i.length;)i.shift()(g)},w=(i,s)=>{for(var u=0,d=i.length-1;0<=d;d--){var m=i[d];m==="."?i.splice(d,1):m===".."?(i.splice(d,1),u++):u&&(i.splice(d,1),u--)}if(s)for(;u;u--)i.unshift("..");return i},C=i=>{var s=i.charAt(0)==="/",u=i.substr(-1)==="/";return(i=w(i.split("/").filter(d=>!!d),!s).join("/"))||s||(i="."),i&&u&&(i+="/"),(s?"/":"")+i},O=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},U=i=>{if(i==="/")return"/";i=C(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},le=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);vn("initRandomDevice")},pe=i=>(pe=le())(i);function re(){for(var i="",s=!1,u=arguments.length-1;-1<=u&&!s;u--){if(s=0<=u?arguments[u]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=w(i.split("/").filter(d=>!!d),!s).join("/"),(s?"/":"")+i||"."}var $=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,z=(i,s,u)=>{var d=s+u;for(u=s;i[u]&&!(u>=d);)++u;if(16<u-s&&i.buffer&&$)return $.decode(i.subarray(s,u));for(d="";s<u;){var m=i[s++];if(m&128){var b=i[s++]&63;if((m&224)==192)d+=String.fromCharCode((m&31)<<6|b);else{var j=i[s++]&63;m=(m&240)==224?(m&15)<<12|b<<6|j:(m&7)<<18|b<<12|j<<6|i[s++]&63,65536>m?d+=String.fromCharCode(m):(m-=65536,d+=String.fromCharCode(55296|m>>10,56320|m&1023))}}else d+=String.fromCharCode(m)}return d},ie=[],ve=i=>{for(var s=0,u=0;u<i.length;++u){var d=i.charCodeAt(u);127>=d?s++:2047>=d?s+=2:55296<=d&&57343>=d?(s+=4,++u):s+=3}return s},Ne=(i,s,u,d)=>{if(!(0<d))return 0;var m=u;d=u+d-1;for(var b=0;b<i.length;++b){var j=i.charCodeAt(b);if(55296<=j&&57343>=j){var I=i.charCodeAt(++b);j=65536+((j&1023)<<10)|I&1023}if(127>=j){if(u>=d)break;s[u++]=j}else{if(2047>=j){if(u+1>=d)break;s[u++]=192|j>>6}else{if(65535>=j){if(u+2>=d)break;s[u++]=224|j>>12}else{if(u+3>=d)break;s[u++]=240|j>>18,s[u++]=128|j>>12&63}s[u++]=128|j>>6&63}s[u++]=128|j&63}}return s[u]=0,u-m};function Fe(i,s){var u=Array(ve(i)+1);return i=Ne(i,u,0,u.length),s&&(u.length=i),u}var He=[];function nt(i,s){He[i]={input:[],F:[],V:s},yr(i,kt)}var kt={open:function(i){var s=He[i.node.za];if(!s)throw new te(43);i.s=s,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,s,u,d){if(!i.s||!i.s.V.jb)throw new te(60);for(var m=0,b=0;b<d;b++){try{var j=i.s.V.jb(i.s)}catch{throw new te(29)}if(j===void 0&&m===0)throw new te(6);if(j==null)break;m++,s[u+b]=j}return m&&(i.node.timestamp=Date.now()),m},write:function(i,s,u,d){if(!i.s||!i.s.V.Oa)throw new te(60);try{for(var m=0;m<d;m++)i.s.V.Oa(i.s,s[u+m])}catch{throw new te(29)}return d&&(i.node.timestamp=Date.now()),m}},jt={jb:function(){e:{if(!ie.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}ie=Fe(i,!0)}i=ie.shift()}return i},Oa:function(i,s){s===null||s===10?(Ue(z(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(Ue(z(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},We={Oa:function(i,s){s===null||s===10?(et(z(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(et(z(i.F,0)),i.F=[])}};function pt(i,s){var u=i.j?i.j.length:0;u>=s||(s=Math.max(s,u*(1048576>u?2:1.125)>>>0),u!=0&&(s=Math.max(s,256)),u=i.j,i.j=new Uint8Array(s),0<i.v&&i.j.set(u.subarray(0,i.v),0))}var ue={O:null,U(){return ue.createNode(null,"/",16895,0)},createNode(i,s,u,d){if((u&61440)===24576||(u&61440)===4096)throw new te(63);return ue.O||(ue.O={dir:{node:{Y:ue.l.Y,P:ue.l.P,ka:ue.l.ka,va:ue.l.va,vb:ue.l.vb,Bb:ue.l.Bb,wb:ue.l.wb,tb:ue.l.tb,Ea:ue.l.Ea},stream:{ba:ue.m.ba}},file:{node:{Y:ue.l.Y,P:ue.l.P},stream:{ba:ue.m.ba,read:ue.m.read,write:ue.m.write,pa:ue.m.pa,mb:ue.m.mb,ob:ue.m.ob}},link:{node:{Y:ue.l.Y,P:ue.l.P,ma:ue.l.ma},stream:{}},ab:{node:{Y:ue.l.Y,P:ue.l.P},stream:qr}}),u=Wn(i,s,u,d),(u.mode&61440)===16384?(u.l=ue.O.dir.node,u.m=ue.O.dir.stream,u.j={}):(u.mode&61440)===32768?(u.l=ue.O.file.node,u.m=ue.O.file.stream,u.v=0,u.j=null):(u.mode&61440)===40960?(u.l=ue.O.link.node,u.m=ue.O.link.stream):(u.mode&61440)===8192&&(u.l=ue.O.ab.node,u.m=ue.O.ab.stream),u.timestamp=Date.now(),i&&(i.j[s]=u,i.timestamp=u.timestamp),u},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var s={};return s.Jc=(i.mode&61440)===8192?i.id:1,s.Mc=i.id,s.mode=i.mode,s.Oc=1,s.uid=0,s.Lc=0,s.za=i.za,(i.mode&61440)===16384?s.size=4096:(i.mode&61440)===32768?s.size=i.v:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.Bc=new Date(i.timestamp),s.Nc=new Date(i.timestamp),s.Ic=new Date(i.timestamp),s.Jb=4096,s.Cc=Math.ceil(s.size/s.Jb),s},P(i,s){if(s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&(s=s.size,i.v!=s))if(s==0)i.j=null,i.v=0;else{var u=i.j;i.j=new Uint8Array(s),u&&i.j.set(u.subarray(0,Math.min(s,i.v))),i.v=s}},ka(){throw Nn[44]},va(i,s,u,d){return ue.createNode(i,s,u,d)},vb(i,s,u){if((i.mode&61440)===16384){try{var d=Bn(s,u)}catch{}if(d)for(var m in d.j)throw new te(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=u,s.j[u]=i,s.timestamp=i.parent.timestamp,i.parent=s},Bb(i,s){delete i.j[s],i.timestamp=Date.now()},wb(i,s){var u=Bn(i,s),d;for(d in u.j)throw new te(55);delete i.j[s],i.timestamp=Date.now()},tb(i){var s=[".",".."],u;for(u in i.j)i.j.hasOwnProperty(u)&&s.push(u);return s},Ea(i,s,u){return i=ue.createNode(i,s,41471,0),i.link=u,i},ma(i){if((i.mode&61440)!==40960)throw new te(28);return i.link}},m:{read(i,s,u,d,m){var b=i.node.j;if(m>=i.node.v)return 0;if(i=Math.min(i.node.v-m,d),8<i&&b.subarray)s.set(b.subarray(m,m+i),u);else for(d=0;d<i;d++)s[u+d]=b[m+d];return i},write(i,s,u,d,m,b){if(s.buffer===ot.buffer&&(b=!1),!d)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.j||i.j.subarray)){if(b)return i.j=s.subarray(u,u+d),i.v=d;if(i.v===0&&m===0)return i.j=s.slice(u,u+d),i.v=d;if(m+d<=i.v)return i.j.set(s.subarray(u,u+d),m),d}if(pt(i,m+d),i.j.subarray&&s.subarray)i.j.set(s.subarray(u,u+d),m);else for(b=0;b<d;b++)i.j[m+b]=s[u+b];return i.v=Math.max(i.v,m+d),d},ba(i,s,u){if(u===1?s+=i.position:u===2&&(i.node.mode&61440)===32768&&(s+=i.node.v),0>s)throw new te(28);return s},pa(i,s,u){pt(i.node,s+u),i.node.v=Math.max(i.node.v,s+u)},mb(i,s,u,d,m){if((i.node.mode&61440)!==32768)throw new te(43);if(i=i.node.j,m&2||i.buffer!==ot.buffer){if((0<u||u+s<i.length)&&(i.subarray?i=i.subarray(u,u+s):i=Array.prototype.slice.call(i,u,u+s)),u=!0,vn(),s=void 0,!s)throw new te(48);ot.set(i,s)}else u=!1,s=i.byteOffset;return{o:s,M:u}},ob(i,s,u,d){return ue.m.write(i,s,0,d,u,!1),0}}};function Se(i,s){var u=0;return i&&(u|=365),s&&(u|=146),u}var Rt=null,_r={},Zn=[],Nr=1,pn=null,mr=!0,te=null,Nn={},qt=(i,s={})=>{if(i=re(i),!i)return{path:"",node:null};if(s=Object.assign({hb:!0,Qa:0},s),8<s.Qa)throw new te(32);i=i.split("/").filter(j=>!!j);for(var u=Rt,d="/",m=0;m<i.length;m++){var b=m===i.length-1;if(b&&s.parent)break;if(u=Bn(u,i[m]),d=C(d+"/"+i[m]),u.wa&&(!b||b&&s.hb)&&(u=u.wa.root),!b||s.gb){for(b=0;(u.mode&61440)===40960;)if(u=st(d),d=re(O(d),u),u=qt(d,{Qa:s.Qa+1}).node,40<b++)throw new te(32)}}return{path:d,node:u}},Br=i=>{for(var s;;){if(i===i.parent)return i=i.U.nb,s?i[i.length-1]!=="/"?`${i}/${s}`:i+s:i;s=s?`${i.name}/${s}`:i.name,i=i.parent}},Wr=(i,s)=>{for(var u=0,d=0;d<s.length;d++)u=(u<<5)-u+s.charCodeAt(d)|0;return(i+u>>>0)%pn.length},Bn=(i,s)=>{var u;if(u=(u=er(i,"x"))?u:i.l.ka?0:2)throw new te(u,i);for(u=pn[Wr(i.id,s)];u;u=u.lc){var d=u.name;if(u.parent.id===i.id&&d===s)return u}return i.l.ka(i,s)},Wn=(i,s,u,d)=>(i=new ro(i,s,u,d),s=Wr(i.parent.id,i.name),i.lc=pn[s],pn[s]=i),Vn=i=>{var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},er=(i,s)=>{if(mr)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},tr=(i,s)=>{try{return Bn(i,s),20}catch{}return er(i,"wx")},Ei=()=>{for(var i=0;4096>=i;i++)if(!Zn[i])return i;throw new te(33)},Dt=i=>{if(i=Zn[i],!i)throw new te(8);return i},Vr=(i,s=-1)=>(jn||(jn=function(){this.h={}},jn.prototype={},Object.defineProperties(jn.prototype,{object:{get(){return this.node},set(u){this.node=u}},flags:{get(){return this.h.flags},set(u){this.h.flags=u}},position:{get(){return this.h.position},set(u){this.h.position=u}}})),i=Object.assign(new jn,i),s==-1&&(s=Ei()),i.X=s,Zn[s]=i),qr={open:i=>{i.m=_r[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new te(70)}},yr=(i,s)=>{_r[i]={m:s}},wr=(i,s)=>{var u=s==="/",d=!s;if(u&&Rt)throw new te(10);if(!u&&!d){var m=qt(s,{hb:!1});if(s=m.path,m=m.node,m.wa)throw new te(10);if((m.mode&61440)!==16384)throw new te(54)}s={type:i,Qc:{},nb:s,kc:[]},i=i.U(s),i.U=s,s.root=i,u?Rt=i:m&&(m.wa=s,m.U&&m.U.kc.push(s))},we=(i,s,u)=>{var d=qt(i,{parent:!0}).node;if(i=U(i),!i||i==="."||i==="..")throw new te(28);var m=tr(d,i);if(m)throw new te(m);if(!d.l.va)throw new te(63);return d.l.va(d,i,s,u)},se=(i,s,u)=>{typeof u>"u"&&(u=s,s=438),we(i,s|8192,u)},me=(i,s)=>{if(!re(i))throw new te(44);var u=qt(s,{parent:!0}).node;if(!u)throw new te(44);s=U(s);var d=tr(u,s);if(d)throw new te(d);if(!u.l.Ea)throw new te(63);u.l.Ea(u,s,i)},st=i=>{if(i=qt(i).node,!i)throw new te(44);if(!i.l.ma)throw new te(28);return re(Br(i.parent),i.l.ma(i))},Be=(i,s,u)=>{if(i==="")throw new te(44);if(typeof s=="string"){var d={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[s];if(typeof d>"u")throw Error(`Unknown file open mode: ${s}`);s=d}if(u=s&64?(typeof u>"u"?438:u)&4095|32768:0,typeof i=="object")var m=i;else{i=C(i);try{m=qt(i,{gb:!(s&131072)}).node}catch{}}if(d=!1,s&64)if(m){if(s&128)throw new te(20)}else m=we(i,u,0),d=!0;if(!m)throw new te(44);if((m.mode&61440)===8192&&(s&=-513),s&65536&&(m.mode&61440)!==16384)throw new te(54);if(!d&&(u=m?(m.mode&61440)===40960?32:(m.mode&61440)===16384&&(Vn(s)!=="r"||s&512)?31:er(m,Vn(s)):44))throw new te(u);if(s&512&&!d){if(u=m,u=typeof u=="string"?qt(u,{gb:!0}).node:u,!u.l.P)throw new te(63);if((u.mode&61440)===16384)throw new te(31);if((u.mode&61440)!==32768)throw new te(28);if(d=er(u,"w"))throw new te(d);u.l.P(u,{size:0,timestamp:Date.now()})}return s&=-131713,m=Vr({node:m,path:Br(m),flags:s,seekable:!0,position:0,m:m.m,zc:[],error:!1}),m.m.open&&m.m.open(m),!g.logReadFiles||s&1||(ut||(ut={}),i in ut||(ut[i]=1)),m},Ht=(i,s,u)=>{if(i.X===null)throw new te(8);if(!i.seekable||!i.m.ba)throw new te(70);if(u!=0&&u!=1&&u!=2)throw new te(28);i.position=i.m.ba(i,s,u),i.zc=[]},kn=()=>{te||(te=function(i,s){this.name="ErrnoError",this.node=s,this.pc=function(u){this.aa=u},this.pc(i),this.message="FS error"},te.prototype=Error(),te.prototype.constructor=te,[44].forEach(i=>{Nn[i]=new te(i),Nn[i].stack="<generic error, no stack>"}))},gn,zt=(i,s,u)=>{i=C("/dev/"+i);var d=Se(!!s,!!u);en||(en=64);var m=en++<<8|0;yr(m,{open:b=>{b.seekable=!1},close:()=>{u&&u.buffer&&u.buffer.length&&u(10)},read:(b,j,I,R)=>{for(var T=0,H=0;H<R;H++){try{var G=s()}catch{throw new te(29)}if(G===void 0&&T===0)throw new te(6);if(G==null)break;T++,j[I+H]=G}return T&&(b.node.timestamp=Date.now()),T},write:(b,j,I,R)=>{for(var T=0;T<R;T++)try{u(j[I+T])}catch{throw new te(29)}return R&&(b.node.timestamp=Date.now()),T}}),se(i,d,m)},en,Gt={},jn,ut,_n=void 0;function Je(){return _n+=4,je[_n-4>>2]}function tn(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var s=i.charCodeAt(0);return 48<=s&&57>=s?`_${i}`:i}function nn(i,s){return i=tn(i),{[i]:function(){return s.apply(this,arguments)}}[i]}function Hr(){this.M=[void 0],this.ib=[]}var wt=new Hr,Ot=void 0;function de(i){throw new Ot(i)}var Mt=i=>(i||de("Cannot use deleted val. handle = "+i),wt.get(i).value),Kt=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return wt.pa({ub:1,value:i})}};function Ai(i){var s=Error,u=nn(i,function(d){this.name=i,this.message=d,d=Error(d).stack,d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},u}var ki=void 0,Ji=void 0;function rt(i){for(var s="";Ye[i];)s+=Ji[Ye[i++]];return s}var br=[];function ji(){for(;br.length;){var i=br.pop();i.g.fa=!1,i.delete()}}var Er=void 0,mn={};function Si(i,s){for(s===void 0&&de("ptr should not be undefined");i.A;)s=i.na(s),i=i.A;return s}var Sn={};function Ci(i){i=co(i);var s=rt(i);return zn(i),s}function nr(i,s){var u=Sn[i];return u===void 0&&de(s+" has unknown type "+Ci(i)),u}function zr(){}var Gr=!1;function Xi(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function Qi(i,s,u){return s===u?i:u.A===void 0?null:(i=Qi(i,s,u.A),i===null?null:u.Pb(i))}var Zi={};function Ve(i,s){return s=Si(i,s),mn[s]}var ct=void 0;function at(i){throw new ct(i)}function St(i,s){return s.u&&s.o||at("makeClassHandle requires ptr and ptrType"),!!s.L!=!!s.G&&at("Both smartPtrType and smartPtr must be specified"),s.count={value:1},Ct(Object.create(i,{g:{value:s}}))}function Ct(i){return typeof FinalizationRegistry>"u"?(Ct=s=>s,i):(Gr=new FinalizationRegistry(s=>{Xi(s.g)}),Ct=s=>{var u=s.g;return u.G&&Gr.register(s,{g:u},s),s},zr=s=>{Gr.unregister(s)},Ct(i))}var rn={};function Yt(i){for(;i.length;){var s=i.pop();i.pop()(s)}}function Cn(i){return this.fromWireType(je[i>>2])}var rr={},Ar={};function Jt(i,s,u){function d(I){I=u(I),I.length!==i.length&&at("Mismatched type converter count");for(var R=0;R<i.length;++R)xn(i[R],I[R])}i.forEach(function(I){Ar[I]=s});var m=Array(s.length),b=[],j=0;s.forEach((I,R)=>{Sn.hasOwnProperty(I)?m[R]=Sn[I]:(b.push(I),rr.hasOwnProperty(I)||(rr[I]=[]),rr[I].push(()=>{m[R]=Sn[I],++j,j===b.length&&d(m)}))}),b.length===0&&d(m)}function es(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function vu(i,s,u={}){var d=s.name;if(i||de(`type "${d}" must have a positive integer typeid pointer`),Sn.hasOwnProperty(i)){if(u.$b)return;de(`Cannot register type '${d}' twice`)}Sn[i]=s,delete Ar[i],rr.hasOwnProperty(i)&&(s=rr[i],delete rr[i],s.forEach(m=>m()))}function xn(i,s,u={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");vu(i,s,u)}function Bs(i){de(i.g.u.i.name+" instance already deleted")}function ir(){}function Ws(i,s,u){if(i[s].B===void 0){var d=i[s];i[s]=function(){return i[s].B.hasOwnProperty(arguments.length)||de(`Function '${u}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[s].B})!`),i[s].B[arguments.length].apply(this,arguments)},i[s].B=[],i[s].B[d.ea]=d}}function Vs(i,s,u){g.hasOwnProperty(i)?((u===void 0||g[i].B!==void 0&&g[i].B[u]!==void 0)&&de(`Cannot register public name '${i}' twice`),Ws(g,i,i),g.hasOwnProperty(u)&&de(`Cannot register multiple overloads of a function with the same number of arguments (${u})!`),g[i].B[u]=s):(g[i]=s,u!==void 0&&(g[i].Pc=u))}function pu(i,s,u,d,m,b,j,I){this.name=i,this.constructor=s,this.N=u,this.W=d,this.A=m,this.Ub=b,this.na=j,this.Pb=I,this.rb=[]}function ts(i,s,u){for(;s!==u;)s.na||de(`Expected null or instance of ${u.name}, got an instance of ${s.name}`),i=s.na(i),s=s.A;return i}function gu(i,s){return s===null?(this.Na&&de(`null is not a valid ${this.name}`),0):(s.g||de(`Cannot pass "${Hs(s)}" as a ${this.name}`),s.g.o||de(`Cannot pass deleted object as a pointer of type ${this.name}`),ts(s.g.o,s.g.u.i,this.i))}function _u(i,s){if(s===null){if(this.Na&&de(`null is not a valid ${this.name}`),this.ua){var u=this.Pa();return i!==null&&i.push(this.W,u),u}return 0}if(s.g||de(`Cannot pass "${Hs(s)}" as a ${this.name}`),s.g.o||de(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&s.g.u.ta&&de(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`),u=ts(s.g.o,s.g.u.i,this.i),this.ua)switch(s.g.G===void 0&&de("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:s.g.L===this?u=s.g.G:de(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`);break;case 1:u=s.g.G;break;case 2:if(s.g.L===this)u=s.g.G;else{var d=s.clone();u=this.oc(u,Kt(function(){d.delete()})),i!==null&&i.push(this.W,u)}break;default:de("Unsupporting sharing policy")}return u}function mu(i,s){return s===null?(this.Na&&de(`null is not a valid ${this.name}`),0):(s.g||de(`Cannot pass "${Hs(s)}" as a ${this.name}`),s.g.o||de(`Cannot pass deleted object as a pointer of type ${this.name}`),s.g.u.ta&&de(`Cannot convert argument of type ${s.g.u.name} to parameter type ${this.name}`),ts(s.g.o,s.g.u.i,this.i))}function qn(i,s,u,d){this.name=i,this.i=s,this.Na=u,this.ta=d,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,s.A!==void 0?this.toWireType=_u:(this.toWireType=d?gu:mu,this.K=null)}function Ka(i,s,u){g.hasOwnProperty(i)||at("Replacing nonexistant public symbol"),g[i].B!==void 0&&u!==void 0?g[i].B[u]=s:(g[i]=s,g[i].ea=u)}var ns=[],Ya=i=>{var s=ns[i];return s||(i>=ns.length&&(ns.length=i+1),ns[i]=s=tt.get(i)),s},yu=(i,s)=>{var u=[];return function(){if(u.length=0,Object.assign(u,arguments),i.includes("j")){var d=g["dynCall_"+i];d=u&&u.length?d.apply(null,[s].concat(u)):d.call(null,s)}else d=Ya(s).apply(null,u);return d}};function xt(i,s){i=rt(i);var u=i.includes("j")?yu(i,s):Ya(s);return typeof u!="function"&&de(`unknown function pointer with signature ${i}: ${s}`),u}var Ja=void 0;function Hn(i,s){function u(b){m[b]||Sn[b]||(Ar[b]?Ar[b].forEach(u):(d.push(b),m[b]=!0))}var d=[],m={};throw s.forEach(u),new Ja(`${i}: `+d.map(Ci).join([", "]))}function rs(i,s,u,d,m){var b=s.length;2>b&&de("argTypes array size mismatch! Must at least get return value and 'this' types!");var j=s[1]!==null&&u!==null,I=!1;for(u=1;u<s.length;++u)if(s[u]!==null&&s[u].K===void 0){I=!0;break}var R=s[0].name!=="void",T=b-2,H=Array(T),G=[],ne=[];return function(){if(arguments.length!==T&&de(`function ${i} called with ${arguments.length} arguments, expected ${T} args!`),ne.length=0,G.length=j?2:1,G[0]=m,j){var S=s[1].toWireType(ne,this);G[1]=S}for(var V=0;V<T;++V)H[V]=s[V+2].toWireType(ne,arguments[V]),G.push(H[V]);if(V=d.apply(null,G),I)Yt(ne);else for(var B=j?1:2;B<s.length;B++){var be=B===1?S:H[B-2];s[B].K!==null&&s[B].K(be)}return S=R?s[0].fromWireType(V):void 0,S}}function is(i,s){for(var u=[],d=0;d<i;d++)u.push(Ie[s+4*d>>2]);return u}function Xa(i,s,u){return i instanceof Object||de(`${u} with invalid "this": ${i}`),i instanceof s.i.constructor||de(`${u} incompatible with "this" of type ${i.constructor.name}`),i.g.o||de(`cannot call emscripten binding method ${u} on deleted object`),ts(i.g.o,i.g.u.i,s.i)}function qs(i){i>=wt.h&&--wt.get(i).ub===0&&wt.Zb(i)}function wu(i,s,u){switch(s){case 0:return function(d){return this.fromWireType((u?ot:Ye)[d])};case 1:return function(d){return this.fromWireType((u?lt:Ft)[d>>1])};case 2:return function(d){return this.fromWireType((u?je:Ie)[d>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Hs(i){if(i===null)return"null";var s=typeof i;return s==="object"||s==="array"||s==="function"?i.toString():""+i}function bu(i,s){switch(s){case 2:return function(u){return this.fromWireType(Bt[u>>2])};case 3:return function(u){return this.fromWireType(Le[u>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Eu(i,s,u){switch(s){case 0:return u?function(d){return ot[d]}:function(d){return Ye[d]};case 1:return u?function(d){return lt[d>>1]}:function(d){return Ft[d>>1]};case 2:return u?function(d){return je[d>>2]}:function(d){return Ie[d>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var Qa=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Au=(i,s)=>{for(var u=i>>1,d=u+s/2;!(u>=d)&&Ft[u];)++u;if(u<<=1,32<u-i&&Qa)return Qa.decode(Ye.subarray(i,u));for(u="",d=0;!(d>=s/2);++d){var m=lt[i+2*d>>1];if(m==0)break;u+=String.fromCharCode(m)}return u},ku=(i,s,u)=>{if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var d=s;u=u<2*i.length?u/2:i.length;for(var m=0;m<u;++m)lt[s>>1]=i.charCodeAt(m),s+=2;return lt[s>>1]=0,s-d},ju=i=>2*i.length,Su=(i,s)=>{for(var u=0,d="";!(u>=s/4);){var m=je[i+4*u>>2];if(m==0)break;++u,65536<=m?(m-=65536,d+=String.fromCharCode(55296|m>>10,56320|m&1023)):d+=String.fromCharCode(m)}return d},Cu=(i,s,u)=>{if(u===void 0&&(u=2147483647),4>u)return 0;var d=s;u=d+u-4;for(var m=0;m<i.length;++m){var b=i.charCodeAt(m);if(55296<=b&&57343>=b){var j=i.charCodeAt(++m);b=65536+((b&1023)<<10)|j&1023}if(je[s>>2]=b,s+=4,s+4>u)break}return je[s>>2]=0,s-d},xu=i=>{for(var s=0,u=0;u<i.length;++u){var d=i.charCodeAt(u);55296<=d&&57343>=d&&++u,s+=4}return s},Tu={};function ss(i){var s=Tu[i];return s===void 0?rt(i):s}var as=[];function Iu(i){var s=as.length;return as.push(i),s}function Pu(i,s){for(var u=Array(i),d=0;d<i;++d)u[d]=nr(Ie[s+4*d>>2],"parameter "+d);return u}var Za=[],zs=[],Gs={},eo=()=>{if(!Ks){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:M||"./this.program"},s;for(s in Gs)Gs[s]===void 0?delete i[s]:i[s]=Gs[s];var u=[];for(s in i)u.push(`${s}=${i[s]}`);Ks=u}return Ks},Ks,os=i=>i%4===0&&(i%100!==0||i%400===0),to=[31,29,31,30,31,30,31,31,30,31,30,31],no=[31,28,31,30,31,30,31,31,30,31,30,31],Ru=(i,s,u,d)=>{function m(S,V,B){for(S=typeof S=="number"?S.toString():S||"";S.length<V;)S=B[0]+S;return S}function b(S,V){return m(S,V,"0")}function j(S,V){function B(Ae){return 0>Ae?-1:0<Ae?1:0}var be;return(be=B(S.getFullYear()-V.getFullYear()))===0&&(be=B(S.getMonth()-V.getMonth()))===0&&(be=B(S.getDate()-V.getDate())),be}function I(S){switch(S.getDay()){case 0:return new Date(S.getFullYear()-1,11,29);case 1:return S;case 2:return new Date(S.getFullYear(),0,3);case 3:return new Date(S.getFullYear(),0,2);case 4:return new Date(S.getFullYear(),0,1);case 5:return new Date(S.getFullYear()-1,11,31);case 6:return new Date(S.getFullYear()-1,11,30)}}function R(S){var V=S.ca;for(S=new Date(new Date(S.da+1900,0,1).getTime());0<V;){var B=S.getMonth(),be=(os(S.getFullYear())?to:no)[B];if(V>be-S.getDate())V-=be-S.getDate()+1,S.setDate(1),11>B?S.setMonth(B+1):(S.setMonth(0),S.setFullYear(S.getFullYear()+1));else{S.setDate(S.getDate()+V);break}}return B=new Date(S.getFullYear()+1,0,4),V=I(new Date(S.getFullYear(),0,4)),B=I(B),0>=j(V,S)?0>=j(B,S)?S.getFullYear()+1:S.getFullYear():S.getFullYear()-1}var T=je[d+40>>2];d={wc:je[d>>2],vc:je[d+4>>2],Fa:je[d+8>>2],Sa:je[d+12>>2],Ga:je[d+16>>2],da:je[d+20>>2],R:je[d+24>>2],ca:je[d+28>>2],Rc:je[d+32>>2],uc:je[d+36>>2],xc:T&&T?z(Ye,T):""},u=u?z(Ye,u):"",T={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var H in T)u=u.replace(new RegExp(H,"g"),T[H]);var G="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ne="January February March April May June July August September October November December".split(" ");T={"%a":S=>G[S.R].substring(0,3),"%A":S=>G[S.R],"%b":S=>ne[S.Ga].substring(0,3),"%B":S=>ne[S.Ga],"%C":S=>b((S.da+1900)/100|0,2),"%d":S=>b(S.Sa,2),"%e":S=>m(S.Sa,2," "),"%g":S=>R(S).toString().substring(2),"%G":S=>R(S),"%H":S=>b(S.Fa,2),"%I":S=>(S=S.Fa,S==0?S=12:12<S&&(S-=12),b(S,2)),"%j":S=>{for(var V=0,B=0;B<=S.Ga-1;V+=(os(S.da+1900)?to:no)[B++]);return b(S.Sa+V,3)},"%m":S=>b(S.Ga+1,2),"%M":S=>b(S.vc,2),"%n":()=>`
`,"%p":S=>0<=S.Fa&&12>S.Fa?"AM":"PM","%S":S=>b(S.wc,2),"%t":()=>"	","%u":S=>S.R||7,"%U":S=>b(Math.floor((S.ca+7-S.R)/7),2),"%V":S=>{var V=Math.floor((S.ca+7-(S.R+6)%7)/7);if(2>=(S.R+371-S.ca-2)%7&&V++,V)V==53&&(B=(S.R+371-S.ca)%7,B==4||B==3&&os(S.da)||(V=1));else{V=52;var B=(S.R+7-S.ca-1)%7;(B==4||B==5&&os(S.da%400-1))&&V++}return b(V,2)},"%w":S=>S.R,"%W":S=>b(Math.floor((S.ca+7-(S.R+6)%7)/7),2),"%y":S=>(S.da+1900).toString().substring(2),"%Y":S=>S.da+1900,"%z":S=>{S=S.uc;var V=0<=S;return S=Math.abs(S)/60,(V?"+":"-")+("0000"+(S/60*100+S%60)).slice(-4)},"%Z":S=>S.xc,"%%":()=>"%"},u=u.replace(/%%/g,"\0\0");for(H in T)u.includes(H)&&(u=u.replace(new RegExp(H,"g"),T[H](d)));return u=u.replace(/\0\0/g,"%"),H=Fe(u,!1),H.length>s?0:(ot.set(H,i),H.length-1)};function ro(i,s,u,d){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Nr++,this.name=s,this.mode=u,this.l={},this.m={},this.za=d}Object.defineProperties(ro.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),kn(),pn=Array(4096),wr(ue,"/"),we("/tmp",16895,0),we("/home",16895,0),we("/home/web_user",16895,0),(()=>{we("/dev",16895,0),yr(259,{read:()=>0,write:(d,m,b,j)=>j}),se("/dev/null",259),nt(1280,jt),nt(1536,We),se("/dev/tty",1280),se("/dev/tty1",1536);var i=new Uint8Array(1024),s=0,u=()=>(s===0&&(s=pe(i).byteLength),i[--s]);zt("random",u),zt("urandom",u),we("/dev/shm",16895,0),we("/dev/shm/tmp",16895,0)})(),(()=>{we("/proc",16895,0);var i=we("/proc/self",16895,0);we("/proc/self/fd",16895,0),wr({U:()=>{var s=Wn(i,"fd",16895,73);return s.l={ka:(u,d)=>{var m=Dt(+d);return u={parent:null,U:{nb:"fake"},l:{ma:()=>m.path}},u.parent=u}},s}},"/proc/self/fd")})(),Object.assign(Hr.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var s=this.ib.pop()||this.M.length;return this.M[s]=i,s},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Ot=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},wt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),wt.h=wt.M.length,g.count_emval_handles=function(){for(var i=0,s=wt.h;s<wt.M.length;++s)wt.M[s]!==void 0&&++i;return i},ki=g.PureVirtualError=Ai("PureVirtualError");for(var io=Array(256),ls=0;256>ls;++ls)io[ls]=String.fromCharCode(ls);Ji=io,g.getInheritedInstanceCount=function(){return Object.keys(mn).length},g.getLiveInheritedInstances=function(){var i=[],s;for(s in mn)mn.hasOwnProperty(s)&&i.push(mn[s]);return i},g.flushPendingDeletes=ji,g.setDelayFunction=function(i){Er=i,br.length&&Er&&Er(ji)},ct=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},ir.prototype.isAliasOf=function(i){if(!(this instanceof ir&&i instanceof ir))return!1;var s=this.g.u.i,u=this.g.o,d=i.g.u.i;for(i=i.g.o;s.A;)u=s.na(u),s=s.A;for(;d.A;)i=d.na(i),d=d.A;return s===d&&u===i},ir.prototype.clone=function(){if(this.g.o||Bs(this),this.g.ia)return this.g.count.value+=1,this;var i=Ct,s=Object,u=s.create,d=Object.getPrototypeOf(this),m=this.g;return i=i(u.call(s,d,{g:{value:{count:m.count,fa:m.fa,ia:m.ia,o:m.o,u:m.u,G:m.G,L:m.L}}})),i.g.count.value+=1,i.g.fa=!1,i},ir.prototype.delete=function(){this.g.o||Bs(this),this.g.fa&&!this.g.ia&&de("Object already scheduled for deletion"),zr(this),Xi(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},ir.prototype.isDeleted=function(){return!this.g.o},ir.prototype.deleteLater=function(){return this.g.o||Bs(this),this.g.fa&&!this.g.ia&&de("Object already scheduled for deletion"),br.push(this),br.length===1&&Er&&Er(ji),this.g.fa=!0,this},qn.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},qn.prototype.bb=function(i){this.W&&this.W(i)},qn.prototype.argPackAdvance=8,qn.prototype.readValueFromPointer=Cn,qn.prototype.deleteObject=function(i){i!==null&&i.delete()},qn.prototype.fromWireType=function(i){function s(){return this.ua?St(this.i.N,{u:this.nc,o:u,L:this,G:i}):St(this.i.N,{u:this,o:i})}var u=this.Vb(i);if(!u)return this.bb(i),null;var d=Ve(this.i,u);if(d!==void 0)return d.g.count.value===0?(d.g.o=u,d.g.G=i,d.clone()):(d=d.clone(),this.bb(i),d);if(d=this.i.Ub(u),d=Zi[d],!d)return s.call(this);d=this.ta?d.Kb:d.pointerType;var m=Qi(u,this.i,d.i);return m===null?s.call(this):this.ua?St(d.i.N,{u:d,o:m,L:this,G:i}):St(d.i.N,{u:d,o:m})},Ja=g.UnboundTypeError=Ai("UnboundTypeError");var so={__syscall_fcntl64:function(i,s,u){_n=u;try{var d=Dt(i);switch(s){case 0:var m=Je();return 0>m?-28:Vr(d,m).X;case 1:case 2:return 0;case 3:return d.flags;case 4:return m=Je(),d.flags|=m,0;case 5:return m=Je(),lt[m+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return je[ao()>>2]=28,-1;default:return-28}}catch(b){if(typeof Gt>"u"||b.name!=="ErrnoError")throw b;return-b.aa}},__syscall_ioctl:function(i,s,u){_n=u;try{var d=Dt(i);switch(s){case 21509:return d.s?0:-59;case 21505:if(!d.s)return-59;if(d.s.V.bc){s=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var m=Je();je[m>>2]=25856,je[m+4>>2]=5,je[m+8>>2]=191,je[m+12>>2]=35387;for(var b=0;32>b;b++)ot[m+b+17>>0]=s[b]||0}return 0;case 21510:case 21511:case 21512:return d.s?0:-59;case 21506:case 21507:case 21508:if(!d.s)return-59;if(d.s.V.cc)for(m=Je(),s=[],b=0;32>b;b++)s.push(ot[m+b+17>>0]);return 0;case 21519:return d.s?(m=Je(),je[m>>2]=0):-59;case 21520:return d.s?-28:-59;case 21531:if(m=Je(),!d.m.ac)throw new te(59);return d.m.ac(d,s,m);case 21523:return d.s?(d.s.V.dc&&(b=[24,80],m=Je(),lt[m>>1]=b[0],lt[m+2>>1]=b[1]),0):-59;case 21524:return d.s?0:-59;case 21515:return d.s?0:-59;default:return-28}}catch(j){if(typeof Gt>"u"||j.name!=="ErrnoError")throw j;return-j.aa}},__syscall_openat:function(i,s,u,d){_n=d;try{s=s?z(Ye,s):"";var m=s;if(m.charAt(0)==="/")s=m;else{var b=i===-100?"/":Dt(i).path;if(m.length==0)throw new te(44);s=C(b+"/"+m)}var j=d?Je():0;return Be(s,u,j).X}catch(I){if(typeof Gt>"u"||I.name!=="ErrnoError")throw I;return-I.aa}},_embind_create_inheriting_constructor:function(i,s,u){i=rt(i),s=nr(s,"wrapper"),u=Mt(u);var d=[].slice,m=s.i,b=m.N,j=m.A.N,I=m.A.constructor;i=nn(i,function(){m.A.rb.forEach((function(T){if(this[T]===j[T])throw new ki(`Pure virtual function ${T} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:b}),this.__construct.apply(this,d.call(arguments))}),b.__construct=function(){this===b&&de("Pass correct 'this' to __construct");var T=I.implement.apply(void 0,[this].concat(d.call(arguments)));zr(T);var H=T.g;T.notifyOnDestruction(),H.ia=!0,Object.defineProperties(this,{g:{value:H}}),Ct(this),T=H.o,T=Si(m,T),mn.hasOwnProperty(T)?de(`Tried to register registered instance: ${T}`):mn[T]=this},b.__destruct=function(){this===b&&de("Pass correct 'this' to __destruct"),zr(this);var T=this.g.o;T=Si(m,T),mn.hasOwnProperty(T)?delete mn[T]:de(`Tried to unregister unregistered instance: ${T}`)},i.prototype=Object.create(b);for(var R in u)i.prototype[R]=u[R];return Kt(i)},_embind_finalize_value_object:function(i){var s=rn[i];delete rn[i];var u=s.Pa,d=s.W,m=s.fb,b=m.map(j=>j.Yb).concat(m.map(j=>j.rc));Jt([i],b,j=>{var I={};return m.forEach((R,T)=>{var H=j[T],G=R.Wb,ne=R.Xb,S=j[T+m.length],V=R.qc,B=R.sc;I[R.Sb]={read:be=>H.fromWireType(G(ne,be)),write:(be,Ae)=>{var Q=[];V(B,be,S.toWireType(Q,Ae)),Yt(Q)}}}),[{name:s.name,fromWireType:function(R){var T={},H;for(H in I)T[H]=I[H].read(R);return d(R),T},toWireType:function(R,T){for(var H in I)if(!(H in T))throw new TypeError(`Missing field: "${H}"`);var G=u();for(H in I)I[H].write(G,T[H]);return R!==null&&R.push(d,G),G},argPackAdvance:8,readValueFromPointer:Cn,K:d}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,s,u,d,m){var b=es(u);s=rt(s),xn(i,{name:s,fromWireType:function(j){return!!j},toWireType:function(j,I){return I?d:m},argPackAdvance:8,readValueFromPointer:function(j){if(u===1)var I=ot;else if(u===2)I=lt;else if(u===4)I=je;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(I[j>>b])},K:null})},_embind_register_class:function(i,s,u,d,m,b,j,I,R,T,H,G,ne){H=rt(H),b=xt(m,b),I&&(I=xt(j,I)),T&&(T=xt(R,T)),ne=xt(G,ne);var S=tn(H);Vs(S,function(){Hn(`Cannot construct ${H} due to unbound types`,[d])}),Jt([i,s,u],d?[d]:[],function(V){if(V=V[0],d)var B=V.i,be=B.N;else be=ir.prototype;V=nn(S,function(){if(Object.getPrototypeOf(this)!==Ae)throw new Ot("Use 'new' to construct "+H);if(Q.$===void 0)throw new Ot(H+" has no accessible constructor");var bt=Q.$[arguments.length];if(bt===void 0)throw new Ot(`Tried to invoke ctor of ${H} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Q.$).toString()}) parameters instead!`);return bt.apply(this,arguments)});var Ae=Object.create(be,{constructor:{value:V}});V.prototype=Ae;var Q=new pu(H,V,Ae,ne,B,b,I,T);Q.A&&(Q.A.oa===void 0&&(Q.A.oa=[]),Q.A.oa.push(Q)),B=new qn(H,Q,!0,!1),be=new qn(H+"*",Q,!1,!1);var Xe=new qn(H+" const*",Q,!1,!0);return Zi[i]={pointerType:be,Kb:Xe},Ka(S,V),[B,be,Xe]})},_embind_register_class_class_function:function(i,s,u,d,m,b,j){var I=is(u,d);s=rt(s),b=xt(m,b),Jt([],[i],function(R){function T(){Hn(`Cannot call ${H} due to unbound types`,I)}R=R[0];var H=`${R.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]);var G=R.i.constructor;return G[s]===void 0?(T.ea=u-1,G[s]=T):(Ws(G,s,H),G[s].B[u-1]=T),Jt([],I,function(ne){if(ne=rs(H,[ne[0],null].concat(ne.slice(1)),null,b,j),G[s].B===void 0?(ne.ea=u-1,G[s]=ne):G[s].B[u-1]=ne,R.i.oa)for(const S of R.i.oa)S.constructor.hasOwnProperty(s)||(S.constructor[s]=ne);return[]}),[]})},_embind_register_class_class_property:function(i,s,u,d,m,b,j,I){s=rt(s),b=xt(m,b),Jt([],[i],function(R){R=R[0];var T=`${R.name}.${s}`,H={get(){Hn(`Cannot access ${T} due to unbound types`,[u])},enumerable:!0,configurable:!0};return H.set=I?()=>{Hn(`Cannot access ${T} due to unbound types`,[u])}:()=>{de(`${T} is a read-only property`)},Object.defineProperty(R.i.constructor,s,H),Jt([],[u],function(G){G=G[0];var ne={get(){return G.fromWireType(b(d))},enumerable:!0};return I&&(I=xt(j,I),ne.set=S=>{var V=[];I(d,G.toWireType(V,S)),Yt(V)}),Object.defineProperty(R.i.constructor,s,ne),[]}),[]})},_embind_register_class_constructor:function(i,s,u,d,m,b){var j=is(s,u);m=xt(d,m),Jt([],[i],function(I){I=I[0];var R=`constructor ${I.name}`;if(I.i.$===void 0&&(I.i.$=[]),I.i.$[s-1]!==void 0)throw new Ot(`Cannot register multiple constructors with identical number of parameters (${s-1}) for class '${I.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return I.i.$[s-1]=()=>{Hn(`Cannot construct ${I.name} due to unbound types`,j)},Jt([],j,function(T){return T.splice(1,0,null),I.i.$[s-1]=rs(R,T,null,m,b),[]}),[]})},_embind_register_class_function:function(i,s,u,d,m,b,j,I){var R=is(u,d);s=rt(s),b=xt(m,b),Jt([],[i],function(T){function H(){Hn(`Cannot call ${G} due to unbound types`,R)}T=T[0];var G=`${T.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),I&&T.i.rb.push(s);var ne=T.i.N,S=ne[s];return S===void 0||S.B===void 0&&S.className!==T.name&&S.ea===u-2?(H.ea=u-2,H.className=T.name,ne[s]=H):(Ws(ne,s,G),ne[s].B[u-2]=H),Jt([],R,function(V){return V=rs(G,V,T,b,j),ne[s].B===void 0?(V.ea=u-2,ne[s]=V):ne[s].B[u-2]=V,[]}),[]})},_embind_register_class_property:function(i,s,u,d,m,b,j,I,R,T){s=rt(s),m=xt(d,m),Jt([],[i],function(H){H=H[0];var G=`${H.name}.${s}`,ne={get(){Hn(`Cannot access ${G} due to unbound types`,[u,j])},enumerable:!0,configurable:!0};return ne.set=R?()=>{Hn(`Cannot access ${G} due to unbound types`,[u,j])}:()=>{de(G+" is a read-only property")},Object.defineProperty(H.i.N,s,ne),Jt([],R?[u,j]:[u],function(S){var V=S[0],B={get(){var Ae=Xa(this,H,G+" getter");return V.fromWireType(m(b,Ae))},enumerable:!0};if(R){R=xt(I,R);var be=S[1];B.set=function(Ae){var Q=Xa(this,H,G+" setter"),Xe=[];R(T,Q,be.toWireType(Xe,Ae)),Yt(Xe)}}return Object.defineProperty(H.i.N,s,B),[]}),[]})},_embind_register_emval:function(i,s){s=rt(s),xn(i,{name:s,fromWireType:function(u){var d=Mt(u);return qs(u),d},toWireType:function(u,d){return Kt(d)},argPackAdvance:8,readValueFromPointer:Cn,K:null})},_embind_register_enum:function(i,s,u,d){function m(){}u=es(u),s=rt(s),m.values={},xn(i,{name:s,constructor:m,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,j){return j.value},argPackAdvance:8,readValueFromPointer:wu(s,u,d),K:null}),Vs(s,m)},_embind_register_enum_value:function(i,s,u){var d=nr(i,"enum");s=rt(s),i=d.constructor,d=Object.create(d.constructor.prototype,{value:{value:u},constructor:{value:nn(`${d.name}_${s}`,function(){})}}),i.values[u]=d,i[s]=d},_embind_register_float:function(i,s,u){u=es(u),s=rt(s),xn(i,{name:s,fromWireType:function(d){return d},toWireType:function(d,m){return m},argPackAdvance:8,readValueFromPointer:bu(s,u),K:null})},_embind_register_function:function(i,s,u,d,m,b){var j=is(s,u);i=rt(i),m=xt(d,m),Vs(i,function(){Hn(`Cannot call ${i} due to unbound types`,j)},s-1),Jt([],j,function(I){return Ka(i,rs(i,[I[0],null].concat(I.slice(1)),null,m,b),s-1),[]})},_embind_register_integer:function(i,s,u,d,m){s=rt(s),m===-1&&(m=4294967295),m=es(u);var b=I=>I;if(d===0){var j=32-8*u;b=I=>I<<j>>>j}u=s.includes("unsigned")?function(I,R){return R>>>0}:function(I,R){return R},xn(i,{name:s,fromWireType:b,toWireType:u,argPackAdvance:8,readValueFromPointer:Eu(s,m,d!==0),K:null})},_embind_register_memory_view:function(i,s,u){function d(b){b>>=2;var j=Ie;return new m(j.buffer,j[b+1],j[b])}var m=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];u=rt(u),xn(i,{name:u,fromWireType:d,argPackAdvance:8,readValueFromPointer:d},{$b:!0})},_embind_register_std_string:function(i,s){s=rt(s);var u=s==="std::string";xn(i,{name:s,fromWireType:function(d){var m=Ie[d>>2],b=d+4;if(u)for(var j=b,I=0;I<=m;++I){var R=b+I;if(I==m||Ye[R]==0){if(j=j?z(Ye,j,R-j):"",T===void 0)var T=j;else T+="\0",T+=j;j=R+1}}else{for(T=Array(m),I=0;I<m;++I)T[I]=String.fromCharCode(Ye[b+I]);T=T.join("")}return zn(d),T},toWireType:function(d,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var b=typeof m=="string";b||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||de("Cannot pass non-string to std::string");var j=u&&b?ve(m):m.length,I=Ys(4+j+1),R=I+4;if(Ie[I>>2]=j,u&&b)Ne(m,Ye,R,j+1);else if(b)for(b=0;b<j;++b){var T=m.charCodeAt(b);255<T&&(zn(R),de("String has UTF-16 code units that do not fit in 8 bits")),Ye[R+b]=T}else for(b=0;b<j;++b)Ye[R+b]=m[b];return d!==null&&d.push(zn,I),I},argPackAdvance:8,readValueFromPointer:Cn,K:function(d){zn(d)}})},_embind_register_std_wstring:function(i,s,u){if(u=rt(u),s===2)var d=Au,m=ku,b=ju,j=()=>Ft,I=1;else s===4&&(d=Su,m=Cu,b=xu,j=()=>Ie,I=2);xn(i,{name:u,fromWireType:function(R){for(var T=Ie[R>>2],H=j(),G,ne=R+4,S=0;S<=T;++S){var V=R+4+S*s;(S==T||H[V>>I]==0)&&(ne=d(ne,V-ne),G===void 0?G=ne:(G+="\0",G+=ne),ne=V+s)}return zn(R),G},toWireType:function(R,T){typeof T!="string"&&de(`Cannot pass non-string to C++ string type ${u}`);var H=b(T),G=Ys(4+H+s);return Ie[G>>2]=H>>I,m(T,G+4,H+s),R!==null&&R.push(zn,G),G},argPackAdvance:8,readValueFromPointer:Cn,K:function(R){zn(R)}})},_embind_register_value_object:function(i,s,u,d,m,b){rn[i]={name:rt(s),Pa:xt(u,d),W:xt(m,b),fb:[]}},_embind_register_value_object_field:function(i,s,u,d,m,b,j,I,R,T){rn[i].fb.push({Sb:rt(s),Yb:u,Wb:xt(d,m),Xb:b,rc:j,qc:xt(I,R),sc:T})},_embind_register_void:function(i,s){s=rt(s),xn(i,{fc:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,s,u){i=Mt(i),s=nr(s,"emval::as");var d=[],m=Kt(d);return Ie[u>>2]=m,s.toWireType(d,i)},_emval_call_method:function(i,s,u,d,m){i=as[i],s=Mt(s),u=ss(u);var b=[];return Ie[d>>2]=Kt(b),i(s,u,b,m)},_emval_call_void_method:function(i,s,u,d){i=as[i],s=Mt(s),u=ss(u),i(s,u,null,d)},_emval_decref:qs,_emval_get_method_caller:function(i,s){var u=Pu(i,s),d=u[0];s=d.name+"_$"+u.slice(1).map(function(j){return j.name}).join("_")+"$";var m=Za[s];if(m!==void 0)return m;var b=Array(i-1);return m=Iu((j,I,R,T)=>{for(var H=0,G=0;G<i-1;++G)b[G]=u[G+1].readValueFromPointer(T+H),H+=u[G+1].argPackAdvance;for(j=j[I].apply(j,b),G=0;G<i-1;++G)u[G+1].Nb&&u[G+1].Nb(b[G]);if(!d.fc)return d.toWireType(R,j)}),Za[s]=m},_emval_get_module_property:function(i){return i=ss(i),Kt(g[i])},_emval_get_property:function(i,s){return i=Mt(i),s=Mt(s),Kt(i[s])},_emval_incref:function(i){4<i&&(wt.get(i).ub+=1)},_emval_new_array:function(){return Kt([])},_emval_new_cstring:function(i){return Kt(ss(i))},_emval_new_object:function(){return Kt({})},_emval_run_destructors:function(i){var s=Mt(i);Yt(s),qs(i)},_emval_set_property:function(i,s,u){i=Mt(i),s=Mt(s),u=Mt(u),i[s]=u},_emval_take_value:function(i,s){return i=nr(i,"_emval_take_value"),i=i.readValueFromPointer(s),Kt(i)},abort:()=>{vn("")},emscripten_asm_const_int:(i,s,u)=>{zs.length=0;var d;for(u>>=2;d=Ye[s++];)u+=d!=105&u,zs.push(d==105?je[u]:Le[u++>>1]),++u;return o[i].apply(null,zs)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,s,u)=>Ye.copyWithin(i,s,s+u),emscripten_resize_heap:i=>{var s=Ye.length;if(i>>>=0,2147483648<i)return!1;for(var u=1;4>=u;u*=2){var d=s*(1+.2/u);d=Math.min(d,i+100663296);var m=Math;d=Math.max(i,d);e:{m=m.min.call(m,2147483648,d+(65536-d%65536)%65536)-vt.buffer.byteLength+65535>>>16;try{vt.grow(m),Et();var b=1;break e}catch{}b=void 0}if(b)return!0}return!1},environ_get:(i,s)=>{var u=0;return eo().forEach(function(d,m){var b=s+u;for(m=Ie[i+4*m>>2]=b,b=0;b<d.length;++b)ot[m++>>0]=d.charCodeAt(b);ot[m>>0]=0,u+=d.length+1}),0},environ_sizes_get:(i,s)=>{var u=eo();Ie[i>>2]=u.length;var d=0;return u.forEach(function(m){d+=m.length+1}),Ie[s>>2]=d,0},fd_close:function(i){try{var s=Dt(i);if(s.X===null)throw new te(8);s.Ma&&(s.Ma=null);try{s.m.close&&s.m.close(s)}catch(u){throw u}finally{Zn[s.X]=null}return s.X=null,0}catch(u){if(typeof Gt>"u"||u.name!=="ErrnoError")throw u;return u.aa}},fd_read:function(i,s,u,d){try{e:{var m=Dt(i);i=s;for(var b,j=s=0;j<u;j++){var I=Ie[i>>2],R=Ie[i+4>>2];i+=8;var T=m,H=I,G=R,ne=b,S=ot;if(0>G||0>ne)throw new te(28);if(T.X===null)throw new te(8);if((T.flags&2097155)===1)throw new te(8);if((T.node.mode&61440)===16384)throw new te(31);if(!T.m.read)throw new te(28);var V=typeof ne<"u";if(!V)ne=T.position;else if(!T.seekable)throw new te(70);var B=T.m.read(T,S,H,G,ne);V||(T.position+=B);var be=B;if(0>be){var Ae=-1;break e}if(s+=be,be<R)break;typeof b<"u"&&(b+=be)}Ae=s}return Ie[d>>2]=Ae,0}catch(Q){if(typeof Gt>"u"||Q.name!=="ErrnoError")throw Q;return Q.aa}},fd_seek:function(i,s,u,d,m){s=u+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*u:NaN;try{if(isNaN(s))return 61;var b=Dt(i);return Ht(b,s,d),p=[b.position>>>0,(An=b.position,1<=+Math.abs(An)?0<An?+Math.floor(An/4294967296)>>>0:~~+Math.ceil((An-+(~~An>>>0))/4294967296)>>>0:0)],je[m>>2]=p[0],je[m+4>>2]=p[1],b.Ma&&s===0&&d===0&&(b.Ma=null),0}catch(j){if(typeof Gt>"u"||j.name!=="ErrnoError")throw j;return j.aa}},fd_write:function(i,s,u,d){try{e:{var m=Dt(i);i=s;for(var b,j=s=0;j<u;j++){var I=Ie[i>>2],R=Ie[i+4>>2];i+=8;var T=m,H=I,G=R,ne=b,S=ot;if(0>G||0>ne)throw new te(28);if(T.X===null)throw new te(8);if((T.flags&2097155)===0)throw new te(8);if((T.node.mode&61440)===16384)throw new te(31);if(!T.m.write)throw new te(28);T.seekable&&T.flags&1024&&Ht(T,0,2);var V=typeof ne<"u";if(!V)ne=T.position;else if(!T.seekable)throw new te(70);var B=T.m.write(T,S,H,G,ne,void 0);V||(T.position+=B);var be=B;if(0>be){var Ae=-1;break e}s+=be,typeof b<"u"&&(b+=be)}Ae=s}return Ie[d>>2]=Ae,0}catch(Q){if(typeof Gt>"u"||Q.name!=="ErrnoError")throw Q;return Q.aa}},strftime_l:(i,s,u,d)=>Ru(i,s,u,d)};(function(){function i(u){if(ke=u=u.exports,vt=ke.memory,Et(),tt=ke.__indirect_function_table,dn.unshift(ke.__wasm_call_ctors),At--,g.monitorRunDependencies&&g.monitorRunDependencies(At),At==0&&Wt){var d=Wt;Wt=null,d()}return u}var s={env:so,wasi_snapshot_preview1:so};if(At++,g.monitorRunDependencies&&g.monitorRunDependencies(At),g.instantiateWasm)try{return g.instantiateWasm(s,i)}catch(u){et("Module.instantiateWasm callback failed with error: "+u),L(u)}return bi(s,function(u){i(u.instance)}).catch(L),{}})();var zn=i=>(zn=ke.free)(i),Ys=i=>(Ys=ke.malloc)(i),ao=()=>(ao=ke.__errno_location)(),oo=g._ma_device__on_notification_unlocked=i=>(oo=g._ma_device__on_notification_unlocked=ke.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,s)=>(g._ma_malloc_emscripten=ke.ma_malloc_emscripten)(i,s),g._ma_free_emscripten=(i,s)=>(g._ma_free_emscripten=ke.ma_free_emscripten)(i,s);var lo=g._ma_device_process_pcm_frames_capture__webaudio=(i,s,u)=>(lo=g._ma_device_process_pcm_frames_capture__webaudio=ke.ma_device_process_pcm_frames_capture__webaudio)(i,s,u),uo=g._ma_device_process_pcm_frames_playback__webaudio=(i,s,u)=>(uo=g._ma_device_process_pcm_frames_playback__webaudio=ke.ma_device_process_pcm_frames_playback__webaudio)(i,s,u),co=i=>(co=ke.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=ke._embind_initialize_bindings)(),g.dynCall_iiji=(i,s,u,d,m)=>(g.dynCall_iiji=ke.dynCall_iiji)(i,s,u,d,m),g.dynCall_jiji=(i,s,u,d,m)=>(g.dynCall_jiji=ke.dynCall_jiji)(i,s,u,d,m),g.dynCall_iiiji=(i,s,u,d,m,b)=>(g.dynCall_iiiji=ke.dynCall_iiiji)(i,s,u,d,m,b),g.dynCall_iij=(i,s,u,d)=>(g.dynCall_iij=ke.dynCall_iij)(i,s,u,d),g.dynCall_jii=(i,s,u)=>(g.dynCall_jii=ke.dynCall_jii)(i,s,u),g.dynCall_viijii=(i,s,u,d,m,b,j)=>(g.dynCall_viijii=ke.dynCall_viijii)(i,s,u,d,m,b,j),g.dynCall_iiiiij=(i,s,u,d,m,b,j)=>(g.dynCall_iiiiij=ke.dynCall_iiiiij)(i,s,u,d,m,b,j),g.dynCall_iiiiijj=(i,s,u,d,m,b,j,I,R)=>(g.dynCall_iiiiijj=ke.dynCall_iiiiijj)(i,s,u,d,m,b,j,I,R),g.dynCall_iiiiiijj=(i,s,u,d,m,b,j,I,R,T)=>(g.dynCall_iiiiiijj=ke.dynCall_iiiiiijj)(i,s,u,d,m,b,j,I,R,T);var us;Wt=function i(){us||ho(),us||(Wt=i)};function ho(){function i(){if(!us&&(us=!0,g.calledRun=!0,!cn)){if(g.noFSInit||gn||(gn=!0,kn(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?zt("stdin",g.stdin):me("/dev/tty","/dev/stdin"),g.stdout?zt("stdout",null,g.stdout):me("/dev/tty","/dev/stdout"),g.stderr?zt("stderr",null,g.stderr):me("/dev/tty1","/dev/stderr"),Be("/dev/stdin",0),Be("/dev/stdout",1),Be("/dev/stderr",1)),mr=!1,h(dn),x(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var s=g.postRun.shift();fn.unshift(s)}h(fn)}}if(!(0<At)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Un();h(hn),0<At||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return ho(),k.ready})})();const y=_}),(c=>{c.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>_.Animation});var _=v(4)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>_});var _=(function(){function y(E,k,g,x){this.animation=E,this.artboard=k,this.playing=x,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(E,k)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"time",{get:function(){return this.instance.time},set:function(E){this.instance.time=E},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),y.prototype.advance=function(E){this.scrubTo===null?this.instance.advance(E):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},y.prototype.apply=function(E){this.instance.apply(E)},y.prototype.cleanup=function(){this.instance.delete()},y})()}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>E.AudioAssetWrapper,AudioWrapper:()=>E.AudioWrapper,BLANK_URL:()=>y.BLANK_URL,CustomFileAssetLoaderWrapper:()=>E.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>E.FileAssetWrapper,Finalizable:()=>E.Finalizable,FontAssetWrapper:()=>E.FontAssetWrapper,FontWrapper:()=>E.FontWrapper,ImageAssetWrapper:()=>E.ImageAssetWrapper,ImageWrapper:()=>E.ImageWrapper,finalizationRegistry:()=>E.finalizationRegistry,registerTouchInteractions:()=>_.registerTouchInteractions,sanitizeUrl:()=>y.sanitizeUrl});var _=v(6),y=v(7),E=v(8)}),((c,f,v)=>{v.r(f),v.d(f,{registerTouchInteractions:()=>E});var _=void 0,y=function(k,g){var x,L;return["touchstart","touchmove"].indexOf(k.type)>-1&&(!((x=k.touches)===null||x===void 0)&&x.length)?(g||k.preventDefault(),{clientX:k.touches[0].clientX,clientY:k.touches[0].clientY}):k.type==="touchend"&&(!((L=k.changedTouches)===null||L===void 0)&&L.length)?{clientX:k.changedTouches[0].clientX,clientY:k.changedTouches[0].clientY}:{clientX:k.clientX,clientY:k.clientY}},E=function(k){var g=k.canvas,x=k.artboard,L=k.stateMachines,F=L===void 0?[]:L,K=k.renderer,Y=k.rive,q=k.fit,J=k.alignment,X=k.isTouchScrollEnabled,P=X===void 0?!1:X,M=k.layoutScaleFactor,oe=M===void 0?1:M;if(!g||!F.length||!K||!Y||!x||typeof window>"u")return null;var ce=null,fe=!1,Z=function(Ue){if(fe&&Ue instanceof MouseEvent){Ue.type=="mouseup"&&(fe=!1);return}fe=P&&Ue.type==="touchend"&&ce==="touchstart",ce=Ue.type;var et=Ue.currentTarget.getBoundingClientRect(),Ke=y(Ue,P),vt=Ke.clientX,ke=Ke.clientY;if(!(!vt&&!ke)){var cn=vt-et.left,ot=ke-et.top,Ye=Y.computeAlignment(q,J,{minX:0,minY:0,maxX:et.width,maxY:et.height},x.bounds,oe),lt=new Y.Mat2D;Ye.invert(lt);var Ft=new Y.Vec2D(cn,ot),je=Y.mapXY(lt,Ft),Ie=je.x(),Bt=je.y();switch(je.delete(),lt.delete(),Ft.delete(),Ye.delete(),Ue.type){case"mouseout":for(var Le=0,Et=F;Le<Et.length;Le++){var tt=Et[Le];tt.pointerMove(Ie,Bt)}break;case"touchmove":case"mouseover":case"mousemove":{for(var hn=0,dn=F;hn<dn.length;hn++){var tt=dn[hn];tt.pointerMove(Ie,Bt)}break}case"touchstart":case"mousedown":{for(var fn=0,Un=F;fn<Un.length;fn++){var tt=Un[fn];tt.pointerDown(Ie,Bt)}break}case"touchend":case"mouseup":{for(var At=0,Wt=F;At<Wt.length;At++){var tt=Wt[At];tt.pointerUp(Ie,Bt)}break}}}},ge=Z.bind(_);return g.addEventListener("mouseover",ge),g.addEventListener("mouseout",ge),g.addEventListener("mousemove",ge),g.addEventListener("mousedown",ge),g.addEventListener("mouseup",ge),g.addEventListener("touchmove",ge,{passive:P}),g.addEventListener("touchstart",ge,{passive:P}),g.addEventListener("touchend",ge),function(){g.removeEventListener("mouseover",ge),g.removeEventListener("mouseout",ge),g.removeEventListener("mousemove",ge),g.removeEventListener("mousedown",ge),g.removeEventListener("mouseup",ge),g.removeEventListener("touchmove",ge),g.removeEventListener("touchstart",ge),g.removeEventListener("touchend",ge)}}}),((c,f,v)=>{v.r(f),v.d(f,{BLANK_URL:()=>L,sanitizeUrl:()=>Y});var _=/^([^\w]*)(javascript|data|vbscript)/im,y=/&#(\w+)(^\w|;)?/g,E=/&(newline|tab);/gi,k=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,x=[".","/"],L="about:blank";function F(q){return x.indexOf(q[0])>-1}function K(q){var J=q.replace(k,"");return J.replace(y,function(X,P){return String.fromCharCode(P)})}function Y(q){if(!q)return L;var J=K(q).replace(E,"").replace(k,"").trim();if(!J)return L;if(F(J))return J;var X=J.match(g);if(!X)return J;var P=X[0];return _.test(P)?L:J}}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>K,AudioWrapper:()=>k,CustomFileAssetLoaderWrapper:()=>x,FileAssetWrapper:()=>L,Finalizable:()=>y,FontAssetWrapper:()=>Y,FontWrapper:()=>g,ImageAssetWrapper:()=>F,ImageWrapper:()=>E,finalizationRegistry:()=>X});var _=(function(){var P=function(M,oe){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ce,fe){ce.__proto__=fe}||function(ce,fe){for(var Z in fe)Object.prototype.hasOwnProperty.call(fe,Z)&&(ce[Z]=fe[Z])},P(M,oe)};return function(M,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Class extends value "+String(oe)+" is not a constructor or null");P(M,oe);function ce(){this.constructor=M}M.prototype=oe===null?Object.create(oe):(ce.prototype=oe.prototype,new ce)}})(),y=(function(){function P(){this.selfUnref=!1}return P})(),E=(function(P){_(M,P);function M(oe){var ce=P.call(this)||this;return ce._nativeImage=oe,ce}return Object.defineProperty(M.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},M})(y),k=(function(P){_(M,P);function M(oe){var ce=P.call(this)||this;return ce._nativeAudio=oe,ce}return Object.defineProperty(M.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},M})(y),g=(function(P){_(M,P);function M(oe){var ce=P.call(this)||this;return ce._nativeFont=oe,ce}return Object.defineProperty(M.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},M})(y),x=(function(){function P(M,oe){this._assetLoaderCallback=oe,this.assetLoader=new M.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return P.prototype.loadContents=function(M,oe){var ce;return M.isImage?ce=new F(M):M.isAudio?ce=new K(M):M.isFont&&(ce=new Y(M)),this._assetLoaderCallback(ce,oe)},P})(),L=(function(){function P(M){this._nativeFileAsset=M}return P.prototype.decode=function(M){this._nativeFileAsset.decode(M)},Object.defineProperty(P.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),P})(),F=(function(P){_(M,P);function M(){return P!==null&&P.apply(this,arguments)||this}return M.prototype.setRenderImage=function(oe){this._nativeFileAsset.setRenderImage(oe.nativeImage)},M})(L),K=(function(P){_(M,P);function M(){return P!==null&&P.apply(this,arguments)||this}return M.prototype.setAudioSource=function(oe){this._nativeFileAsset.setAudioSource(oe.nativeAudio)},M})(L),Y=(function(P){_(M,P);function M(){return P!==null&&P.apply(this,arguments)||this}return M.prototype.setFont=function(oe){this._nativeFileAsset.setFont(oe.nativeFont)},M})(L),q=(function(){function P(M){}return P.prototype.register=function(M){M.selfUnref=!0},P.prototype.unregister=function(M){},P})(),J=typeof FinalizationRegistry<"u"?FinalizationRegistry:q,X=new J(function(P){P.unref()})})],r={};function a(c){var f=r[c];if(f!==void 0)return f.exports;var v=r[c]={exports:{}};return t[c](v,v.exports,a),v.exports}a.d=(c,f)=>{for(var v in f)a.o(f,v)&&!a.o(c,v)&&Object.defineProperty(c,v,{enumerable:!0,get:f[v]})},a.o=(c,f)=>Object.prototype.hasOwnProperty.call(c,f),a.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})};var l={};return(()=>{a.r(l),a.d(l,{Alignment:()=>Y,DataEnum:()=>Bt,EventType:()=>Z,Fit:()=>K,Layout:()=>q,LoopType:()=>ge,Rive:()=>je,RiveEventType:()=>M,RiveFile:()=>Ft,RuntimeLoader:()=>J,StateMachineInput:()=>P,StateMachineInputType:()=>X,Testing:()=>wi,ViewModel:()=>Ie,ViewModelInstance:()=>Et,ViewModelInstanceArtboard:()=>Vt,ViewModelInstanceAssetImage:()=>Qn,ViewModelInstanceBoolean:()=>fn,ViewModelInstanceColor:()=>vn,ViewModelInstanceEnum:()=>At,ViewModelInstanceList:()=>Wt,ViewModelInstanceNumber:()=>dn,ViewModelInstanceString:()=>hn,ViewModelInstanceTrigger:()=>Un,ViewModelInstanceValue:()=>tt,decodeAudio:()=>Ur,decodeFont:()=>An,decodeImage:()=>bi});var c=a(1),f=a(2),v=a(3),_=a(5),y=(function(){var p=function(o,h){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,C){w.__proto__=C}||function(w,C){for(var O in C)Object.prototype.hasOwnProperty.call(C,O)&&(w[O]=C[O])},p(o,h)};return function(o,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");p(o,h);function w(){this.constructor=o}o.prototype=h===null?Object.create(h):(w.prototype=h.prototype,new w)}})(),E=function(){return E=Object.assign||function(p){for(var o,h=1,w=arguments.length;h<w;h++){o=arguments[h];for(var C in o)Object.prototype.hasOwnProperty.call(o,C)&&(p[C]=o[C])}return p},E.apply(this,arguments)},k=function(p,o,h,w){function C(O){return O instanceof h?O:new h(function(U){U(O)})}return new(h||(h=Promise))(function(O,U){function le($){try{re(w.next($))}catch(z){U(z)}}function pe($){try{re(w.throw($))}catch(z){U(z)}}function re($){$.done?O($.value):C($.value).then(le,pe)}re((w=w.apply(p,o||[])).next())})},g=function(p,o){var h={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},w,C,O,U=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return U.next=le(0),U.throw=le(1),U.return=le(2),typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function le(re){return function($){return pe([re,$])}}function pe(re){if(w)throw new TypeError("Generator is already executing.");for(;U&&(U=0,re[0]&&(h=0)),h;)try{if(w=1,C&&(O=re[0]&2?C.return:re[0]?C.throw||((O=C.return)&&O.call(C),0):C.next)&&!(O=O.call(C,re[1])).done)return O;switch(C=0,O&&(re=[re[0]&2,O.value]),re[0]){case 0:case 1:O=re;break;case 4:return h.label++,{value:re[1],done:!1};case 5:h.label++,C=re[1],re=[0];continue;case 7:re=h.ops.pop(),h.trys.pop();continue;default:if(O=h.trys,!(O=O.length>0&&O[O.length-1])&&(re[0]===6||re[0]===2)){h=0;continue}if(re[0]===3&&(!O||re[1]>O[0]&&re[1]<O[3])){h.label=re[1];break}if(re[0]===6&&h.label<O[1]){h.label=O[1],O=re;break}if(O&&h.label<O[2]){h.label=O[2],h.ops.push(re);break}O[2]&&h.ops.pop(),h.trys.pop();continue}re=o.call(p,h)}catch($){re=[6,$],C=0}finally{w=O=0}if(re[0]&5)throw re[1];return{value:re[0]?re[1]:void 0,done:!0}}},x=function(p,o,h){if(h||arguments.length===2)for(var w=0,C=o.length,O;w<C;w++)(O||!(w in o))&&(O||(O=Array.prototype.slice.call(o,0,w)),O[w]=o[w]);return p.concat(O||Array.prototype.slice.call(o))},L=(function(p){y(o,p);function o(){var h=p!==null&&p.apply(this,arguments)||this;return h.isHandledError=!0,h}return o})(Error),F=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},K;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(K||(K={}));var Y;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(Y||(Y={}));var q=(function(){function p(o){var h,w,C,O,U,le,pe;this.fit=(h=o?.fit)!==null&&h!==void 0?h:K.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:Y.Center,this.layoutScaleFactor=(C=o?.layoutScaleFactor)!==null&&C!==void 0?C:1,this.minX=(O=o?.minX)!==null&&O!==void 0?O:0,this.minY=(U=o?.minY)!==null&&U!==void 0?U:0,this.maxX=(le=o?.maxX)!==null&&le!==void 0?le:0,this.maxY=(pe=o?.maxY)!==null&&pe!==void 0?pe:0}return p.new=function(o){var h=o.fit,w=o.alignment,C=o.minX,O=o.minY,U=o.maxX,le=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:h,alignment:w,minX:C,minY:O,maxX:U,maxY:le})},p.prototype.copyWith=function(o){var h=o.fit,w=o.alignment,C=o.layoutScaleFactor,O=o.minX,U=o.minY,le=o.maxX,pe=o.maxY;return new p({fit:h??this.fit,alignment:w??this.alignment,layoutScaleFactor:C??this.layoutScaleFactor,minX:O??this.minX,minY:U??this.minY,maxX:le??this.maxX,maxY:pe??this.maxY})},p.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var h;return this.fit===K.Cover?h=o.Fit.cover:this.fit===K.Contain?h=o.Fit.contain:this.fit===K.Fill?h=o.Fit.fill:this.fit===K.FitWidth?h=o.Fit.fitWidth:this.fit===K.FitHeight?h=o.Fit.fitHeight:this.fit===K.ScaleDown?h=o.Fit.scaleDown:this.fit===K.Layout?h=o.Fit.layout:h=o.Fit.none,this.cachedRuntimeFit=h,h},p.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var h;return this.alignment===Y.TopLeft?h=o.Alignment.topLeft:this.alignment===Y.TopCenter?h=o.Alignment.topCenter:this.alignment===Y.TopRight?h=o.Alignment.topRight:this.alignment===Y.CenterLeft?h=o.Alignment.centerLeft:this.alignment===Y.CenterRight?h=o.Alignment.centerRight:this.alignment===Y.BottomLeft?h=o.Alignment.bottomLeft:this.alignment===Y.BottomCenter?h=o.Alignment.bottomCenter:this.alignment===Y.BottomRight?h=o.Alignment.bottomRight:h=o.Alignment.center,this.cachedRuntimeAlignment=h,h},p})(),J=(function(){function p(){}return p.loadRuntime=function(){c.default({locateFile:function(){return p.wasmURL}}).then(function(o){var h;for(p.runtime=o;p.callBackQueue.length>0;)(h=p.callBackQueue.shift())===null||h===void 0||h(p.runtime)}).catch(function(o){var h={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",h);var w="https://cdn.jsdelivr.net/npm/".concat(f.name,"@").concat(f.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(h.message,"), trying jsdelivr as a backup")),p.setWasmUrl(w),p.loadRuntime();else{var C=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(h.type),"- Message: ".concat(h.message),"- WebAssembly-specific error: ".concat(h.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(C)}})},p.getInstance=function(o){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?o(p.runtime):p.callBackQueue.push(o)},p.awaitInstance=function(){return new Promise(function(o){return p.getInstance(function(h){return o(h)})})},p.setWasmUrl=function(o){p.wasmURL=o},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(f.name,"@").concat(f.version,"/rive.wasm"),p})(),X;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(X||(X={}));var P=(function(){function p(o,h){this.type=o,this.runtimeInput=h}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===X.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),M;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(M||(M={}));var oe=(function(){function p(o){this.nativeArtboard=o}return p})(),ce=(function(){function p(o,h,w,C){this.stateMachine=o,this.playing=w,this.artboard=C,this.inputs=[],this.instance=new h.StateMachineInstance(o,C),this.initInputs(h)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var o=[],h=0;h<this.instance.stateChangedCount();h++)o.push(this.instance.stateChangedNameByIndex(h));return o},enumerable:!1,configurable:!0}),p.prototype.advance=function(o){this.instance.advance(o)},p.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},p.prototype.initInputs=function(o){for(var h=0;h<this.instance.inputCount();h++){var w=this.instance.input(h);this.inputs.push(this.mapRuntimeInput(w,o))}},p.prototype.mapRuntimeInput=function(o,h){if(o.type===h.SMIInput.bool)return new P(X.Boolean,o.asBool());if(o.type===h.SMIInput.number)return new P(X.Number,o.asNumber());if(o.type===h.SMIInput.trigger)return new P(X.Trigger,o.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},p})(),fe=(function(){function p(o,h,w,C,O){C===void 0&&(C=[]),O===void 0&&(O=[]),this.runtime=o,this.artboard=h,this.eventManager=w,this.animations=C,this.stateMachines=O}return p.prototype.add=function(o,h,w){if(w===void 0&&(w=!0),o=Pt(o),o.length===0)this.animations.forEach(function(ve){return ve.playing=h}),this.stateMachines.forEach(function(ve){return ve.playing=h});else for(var C=this.animations.map(function(ve){return ve.name}),O=this.stateMachines.map(function(ve){return ve.name}),U=0;U<o.length;U++){var le=C.indexOf(o[U]),pe=O.indexOf(o[U]);if(le>=0||pe>=0)le>=0?this.animations[le].playing=h:this.stateMachines[pe].playing=h;else{var re=this.artboard.animationByName(o[U]);if(re){var $=new v.Animation(re,this.artboard,this.runtime,h);$.advance(0),$.apply(1),this.animations.push($)}else{var z=this.artboard.stateMachineByName(o[U]);if(z){var ie=new ce(z,this.runtime,h,this.artboard);this.stateMachines.push(ie)}}}}return w&&(h?this.eventManager.fire({type:Z.Play,data:this.playing}):this.eventManager.fire({type:Z.Pause,data:this.paused})),h?this.playing:this.paused},p.prototype.initLinearAnimations=function(o,h){for(var w=this.animations.map(function(pe){return pe.name}),C=0;C<o.length;C++){var O=w.indexOf(o[C]);if(O>=0)this.animations[O].playing=h;else{var U=this.artboard.animationByName(o[C]);if(U){var le=new v.Animation(U,this.artboard,this.runtime,h);le.advance(0),le.apply(1),this.animations.push(le)}else console.error("Animation with name ".concat(o[C]," not found."))}}},p.prototype.initStateMachines=function(o,h){for(var w=this.stateMachines.map(function(pe){return pe.name}),C=0;C<o.length;C++){var O=w.indexOf(o[C]);if(O>=0)this.stateMachines[O].playing=h;else{var U=this.artboard.stateMachineByName(o[C]);if(U){var le=new ce(U,this.runtime,h,this.artboard);this.stateMachines.push(le),h||le.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[C]," not found.")),this.initLinearAnimations([o[C]],h)}}},p.prototype.play=function(o){return this.add(o,!0)},p.prototype.pause=function(o){return this.add(o,!1)},p.prototype.scrub=function(o,h){var w=this.animations.filter(function(C){return o.includes(C.name)});return w.forEach(function(C){return C.scrubTo=h}),w.map(function(C){return C.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(o){var h=this;o=Pt(o);var w=[];if(o.length===0)w=this.animations.map(function(U){return U.name}).concat(this.stateMachines.map(function(U){return U.name})),this.animations.forEach(function(U){return U.cleanup()}),this.stateMachines.forEach(function(U){return U.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var C=this.animations.filter(function(U){return o.includes(U.name)});C.forEach(function(U){U.cleanup(),h.animations.splice(h.animations.indexOf(U),1)});var O=this.stateMachines.filter(function(U){return o.includes(U.name)});O.forEach(function(U){U.cleanup(),h.stateMachines.splice(h.stateMachines.indexOf(U),1)}),w=C.map(function(U){return U.name}).concat(O.map(function(U){return U.name}))}return this.eventManager.fire({type:Z.Stop,data:w}),w},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,h){return o||h.playing},!1)||this.stateMachines.reduce(function(o,h){return o||h.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(o,h){h===void 0&&(h=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,h):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,h)),w},p.prototype.handleLooping=function(){for(var o=0,h=this.animations.filter(function(C){return C.playing});o<h.length;o++){var w=h[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:Z.Loop,data:{animation:w.name,type:ge.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:Z.Loop,data:{animation:w.name,type:ge.PingPong}}),w.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var o=[],h=0,w=this.stateMachines.filter(function(O){return O.playing});h<w.length;h++){var C=w[h];o.push.apply(o,C.statesChanged)}o.length>0&&this.eventManager.fire({type:Z.StateChange,data:o})},p.prototype.handleAdvancing=function(o){this.eventManager.fire({type:Z.Advance,data:o})},p})(),Z;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(Z||(Z={}));var ge;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(ge||(ge={}));var Ue=(function(){function p(o){o===void 0&&(o=[]),this.listeners=o}return p.prototype.getListeners=function(o){return this.listeners.filter(function(h){return h.type===o})},p.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},p.prototype.remove=function(o){for(var h=0;h<this.listeners.length;h++){var w=this.listeners[h];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(h,1);break}}},p.prototype.removeAll=function(o){var h=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return h.remove(w)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(o){var h=this.getListeners(o.type);h.forEach(function(w){return w.callback(o)})},p})(),et=(function(){function p(o){this.eventManager=o,this.queue=[]}return p.prototype.add=function(o){this.queue.push(o)},p.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},p})(),Ke;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(Ke||(Ke={}));var vt=(function(p){y(o,p);function o(){var h=p!==null&&p.apply(this,arguments)||this;return h._started=!1,h._enabled=!1,h._status=Ke.UNAVAILABLE,h}return o.prototype.delay=function(h){return k(this,void 0,void 0,function(){return g(this,function(w){return[2,new Promise(function(C){return setTimeout(C,h)})]})})},o.prototype.timeout=function(){return k(this,void 0,void 0,function(){return g(this,function(h){return[2,new Promise(function(w,C){return setTimeout(C,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:Z.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(h){return this._enabled||(this._enabled=!0,this._status=Ke.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(h){switch(h.label){case 0:if(!(this._status===Ke.UNAVAILABLE&&this._audioContext!==null))return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return h.sent(),this.enableAudio(),[3,4];case 3:return h.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(h){switch(h.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),h.label=2;case 2:return this._status!==Ke.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return h.sent(),[4,this.delay(1e3)];case 4:return h.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var h=this,w=function(){return k(h,void 0,void 0,function(){return g(this,function(C){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(h){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===Ke.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(Ue),ke=new vt,cn=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),ot=globalThis.ResizeObserver||cn,Ye=(function(){function p(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(h){var w=o._elementsMap.get(h.target);w!==null?w.onResize(h.target.clientWidth==0||h.target.clientHeight==0):o._resizeObserver.unobserve(h.target)},this._onObserved=function(h){h.forEach(o._onObservedEntry)},this._resizeObserver=new ot(this._onObserved)}return p.prototype.add=function(o,h){var w={onResize:h,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},p.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},p})(),lt=new Ye,Ft=(function(){function p(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new Ue,o.onLoad&&this.on(Z.Load,o.onLoad),o.onLoadError&&this.on(Z.LoadError,o.onLoadError)}return p.prototype.initData=function(){return k(this,void 0,void 0,function(){var o,h,w,C,O;return g(this,function(U){switch(U.label){case 0:return this.src?(o=this,[4,gr(this.src)]):[3,2];case 1:o.buffer=U.sent(),U.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new _.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),h=w.assetLoader),C=this,[4,this.runtime.load(new Uint8Array(this.buffer),h,this.enableRiveAssetCDN)]);case 3:return C.file=U.sent(),this.destroyed?((O=this.file)===null||O===void 0||O.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Z.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return k(this,void 0,void 0,function(){var o,h;return g(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,J.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return h=w.sent(),this.fireLoadError(h instanceof Error?h.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:Z.LoadError,data:o}),new Error(o)},p.prototype.on=function(o,h){this.eventManager.add({type:o,callback:h})},p.prototype.off=function(o,h){this.eventManager.remove({type:o,callback:h})},p.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(o){var h=this.file.artboardByName(o);return h!=null?new oe(h):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),je=(function(){function p(o){var h=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(C){var O=h._hasZeroSize!==C;h._hasZeroSize=C,C?(!h._layout.maxX||!h._layout.maxY)&&h.resizeToCanvas():O&&h.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=lt.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new q,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new Ue,o.onLoad&&this.on(Z.Load,o.onLoad),o.onLoadError&&this.on(Z.LoadError,o.onLoadError),o.onPlay&&this.on(Z.Play,o.onPlay),o.onPause&&this.on(Z.Pause,o.onPause),o.onStop&&this.on(Z.Stop,o.onStop),o.onLoop&&this.on(Z.Loop,o.onLoop),o.onStateChange&&this.on(Z.StateChange,o.onStateChange),o.onAdvance&&this.on(Z.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(Z.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(Z.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(Z.Play,o.onplay),o.onpause&&!o.onPause&&this.on(Z.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(Z.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(Z.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(Z.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new et(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(o)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(o){var h=this,w=o.src,C=o.buffer,O=o.riveFile,U=o.animations,le=o.stateMachines,pe=o.artboard,re=o.autoplay,$=re===void 0?!1:re,z=o.useOffscreenRenderer,ie=z===void 0?!1:z,ve=o.autoBind,Ne=ve===void 0?!1:ve;if(!this.destroyed){if(this.src=w,this.buffer=C,this.riveFile=O,!this.src&&!this.buffer&&!this.riveFile)throw new L(p.missingErrorMessage);var Fe=Pt(U),He=Pt(le);this.loaded=!1,this.readyForPlaying=!1,J.awaitInstance().then(function(nt){h.destroyed||(h.runtime=nt,h.removeRiveListeners(),h.deleteRiveRenderer(),h.renderer=h.runtime.makeRenderer(h.canvas,ie),h.canvas.width||h.canvas.height||h.resizeDrawingSurfaceToCanvas(),h.initData(pe,Fe,He,$,Ne).then(function(kt){if(kt)return h.setupRiveListeners()}).catch(function(kt){console.error(kt)}))}).catch(function(nt){console.error(nt)})}},p.prototype.setupRiveListeners=function(o){var h=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(O){return O.playing&&h.runtime.hasListeners(O.instance)}).map(function(O){return O.instance}),C=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(C=o.isTouchScrollEnabled),this.eventCleanup=(0,_.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:C,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var o=this,h;ke.status==Ke.UNAVAILABLE&&!((h=this.artboard)===null||h===void 0)&&h.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Z.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},ke.add(this._audioEventListener),ke.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(o,h,w,C,O){return k(this,void 0,void 0,function(){var U,le,pe,re;return g(this,function($){switch($.label){case 0:return $.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(U=new Ft({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=U,[4,U.init()]);case 1:if($.sent(),this.destroyed)return U.destroyIfUnused(),[2,!1];$.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,h,w,C,O),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Z.Load,data:(re=this.src)!==null&&re!==void 0?re:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return le=$.sent(),pe=F(le),console.warn(pe),this.eventManager.fire({type:Z.LoadError,data:pe}),[2,Promise.reject(pe)];case 4:return[2]}})})},p.prototype.initArtboard=function(o,h,w,C,O){if(this.file){var U=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!U){var le="Invalid artboard name or no default artboard";console.warn(le),this.eventManager.fire({type:Z.LoadError,data:le});return}if(this.artboard=U,U.volume=this._volume*ke.systemVolume,this.artboard.animationCount()<1){var le="Artboard has no animations";throw this.eventManager.fire({type:Z.LoadError,data:le}),le}this.animator=new fe(this.runtime,this.artboard,this.eventManager);var pe;if(h.length>0||w.length>0?(pe=h.concat(w),this.animator.initLinearAnimations(h,C),this.animator.initStateMachines(w,C)):pe=[this.animator.atLeastOne(C,!1)],this.taskQueue.add({event:{type:C?Z.Play:Z.Pause,data:pe}}),O){var re=this.file.defaultArtboardViewModel(U);if(re!==null){var $=re.defaultInstance();if($!==null){var z=new Et($,null);this.bindViewModelInstance(z)}}}}},p.prototype.drawFrame=function(){var o,h;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(h=this.runtime)===null||h===void 0||h.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(o,h){var w;this.frameRequestId=null;var C=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,h?.());var O=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var U=this.animator.animations.filter(function(Rt){return Rt.playing||Rt.needsScrub}).sort(function(Rt){return Rt.needsScrub?-1:1}),le=0,pe=U;le<pe.length;le++){var re=pe[le];re.advance(O),re.instance.didLoop&&(re.loopCount+=1),re.apply(1)}for(var $=this.animator.stateMachines.filter(function(Rt){return Rt.playing}),z=0,ie=$;z<ie.length;z++){var ve=ie[z],Ne=ve.reportedEventCount();if(Ne)for(var Fe=0;Fe<Ne;Fe++){var He=ve.reportedEventAt(Fe);if(He)if(He.type===M.OpenUrl){if(this.eventManager.fire({type:Z.RiveEvent,data:He}),this.automaticallyHandleEvents){var nt=document.createElement("a"),kt=He,jt=kt.url,We=kt.target,pt=(0,_.sanitizeUrl)(jt);jt&&nt.setAttribute("href",pt),We&&nt.setAttribute("target",We),pt&&pt!==_.BLANK_URL&&nt.click()}}else this.eventManager.fire({type:Z.RiveEvent,data:He})}ve.advanceAndApply(O)}this.animator.stateMachines.length==0&&this.artboard.advance(O);var ue=this.renderer;ue.clear(),ue.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(ue),ue.restore(),ue.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(O),this.frameCount++;var Se=performance.now();for(this.frameTimes.push(Se),this.durations.push(Se-C);this.frameTimes[0]<=Se-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var o=this,h=o.renderer,w=o.runtime,C=o._layout,O=o.artboard;h.align(C.runtimeFit(w),C.runtimeAlignment(w),{minX:C.minX,minY:C.minY,maxX:C.maxX,maxY:C.maxY},O.bounds,this._devicePixelRatioUsed*C.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,h){return o+h},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var o,h;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&lt.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ke.remove(this._audioEventListener),this._audioEventListener=null),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(o){var h;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((h=this.artboard)===null||h===void 0?void 0:h.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},p.prototype.getTextRunValue=function(o){var h=this.retrieveTextRun(o);return h?h.text:void 0},p.prototype.setTextRunValue=function(o,h){var w=this.retrieveTextRun(o);w&&(w.text=h)},p.prototype.play=function(o,h){var w=this;if(o=Pt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,h)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(o){var h=this;if(o=Pt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},p.prototype.scrub=function(o,h){var w=this;if(o=Pt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,h)}});return}this.animator.scrub(o,h||0),this.drawFrame()},p.prototype.stop=function(o){var h=this;if(o=Pt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(o){var h,w,C=o?.artboard,O=Pt(o?.animations),U=Pt(o?.stateMachines),le=(h=o?.autoplay)!==null&&h!==void 0?h:!1,pe=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(C,O,U,le,pe),this.taskQueue.process()},p.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var h=this.canvas.getBoundingClientRect(),w=h.width,C=h.height,O=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=O,this.canvas.width=O*w,this.canvas.height=O*C,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===K.Layout){var U=this._layout.layoutScaleFactor;this.artboard.width=w/U,this.artboard.height=C/U}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],h=0;h<this.artboard.animationCount();h++)o.push(this.artboard.animationByIndex(h).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],h=0;h<this.artboard.stateMachineCount();h++)o.push(this.artboard.stateMachineByIndex(h).name);return o},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(o){if(this.loaded){var h=this.animator.stateMachines.find(function(w){return w.name===o});return h?.inputs}},p.prototype.retrieveInputAtPath=function(o,h){if(!o){console.warn("No input name provided for path '".concat(h,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(h,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,h);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(h,"'"));return}return w},p.prototype.setBooleanStateAtPath=function(o,h,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===X.Boolean?C.asBool().value=h:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(o,h,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===X.Number?C.asNumber().value=h:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},p.prototype.fireStateAtPath=function(o,h){var w=this.retrieveInputAtPath(o,h);w&&(w.type===X.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(h,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(o,h){if(!o){console.warn("No text name provided for path '".concat(h,"'"));return}if(!h){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(h,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,h);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(h,"'"));return}return w},p.prototype.getTextRunValueAtPath=function(o,h){var w=this.retrieveTextAtPath(o,h);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(h,"'"));return}return w.text},p.prototype.setTextRunValueAtPath=function(o,h,w){var C=this.retrieveTextAtPath(o,w);if(!C){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}C.text=h},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(o,h){this.eventManager.add({type:o,callback:h})},p.prototype.off=function(o,h){this.eventManager.remove({type:o,callback:h})},p.prototype.unsubscribe=function(o,h){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,h)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},h=0;h<this.file.artboardCount();h++){for(var w=this.file.artboardByIndex(h),C={name:w.name,animations:[],stateMachines:[]},O=0;O<w.animationCount();O++){var U=w.animationByIndex(O);C.animations.push(U.name)}for(var le=0;le<w.stateMachineCount();le++){for(var pe=w.stateMachineByIndex(le),re=pe.name,$=new this.runtime.StateMachineInstance(pe,w),z=[],ie=0;ie<$.inputCount();ie++){var ve=$.input(ie);z.push({name:ve.name,type:ve.type})}C.stateMachines.push({name:re,inputs:z})}o.artboards.push(C)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*ke.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(o){var h;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(o){var h=this.file.viewModelByIndex(o);return h!==null?new Ie(h):null},p.prototype.viewModelByName=function(o){var h=this.file.viewModelByName(o);return h!==null?new Ie(h):null},p.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(h){return new Bt(h)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Ie(o)}return null},p.prototype.getArtboard=function(o){var h,w;return(w=(h=this.riveFile)===null||h===void 0?void 0:h.getArtboard(o))!==null&&w!==void 0?w:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),Ie=(function(){function p(o){this._viewModel=o}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(o){var h=this._viewModel.instanceByIndex(o);return h!==null?new Et(h,null):null},p.prototype.instanceByName=function(o){var h=this._viewModel.instanceByName(o);return h!==null?new Et(h,null):null},p.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new Et(o,null):null},p.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new Et(o,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),Bt=(function(){function p(o){this._dataEnum=o}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),Le;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(Le||(Le={}));var Et=(function(){function p(o,h){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,h!==null&&this._parents.push(h)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},p.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},p.prototype.removeParent=function(o){var h=this._parents.indexOf(o);if(h!==-1){var w=this._parents[h];w.removeFromViewModelCallbacks(this),this._parents.splice(h,1)}},p.prototype.addToPropertyCallbacks=function(o){var h=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(h)}))},p.prototype.removeFromPropertyCallbacks=function(o){var h=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(h)}))},p.prototype.addToViewModelCallbacks=function(o){var h=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(h)}))},p.prototype.removeFromViewModelCallbacks=function(o){var h=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(h)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},p.prototype.propertyFromPath=function(o,h){var w=o.split("/");return this.propertyFromPathSegments(w,0,h)},p.prototype.viewModelFromPathSegments=function(o,h){var w=this.internalViewModelInstance(o[h]);return w!==null?h==o.length-1?w:w.viewModelFromPathSegments(o,h++):null},p.prototype.propertyFromPathSegments=function(o,h,w){var C,O,U,le,pe,re,$,z,ie,ve,Ne,Fe,He,nt,kt,jt,We,pt;if(h<o.length-1){var ue=this.internalViewModelInstance(o[h]);return ue!==null?ue.propertyFromPathSegments(o,h+1,w):null}var Se=null;switch(w){case Le.Number:if(Se=(O=(C=this._runtimeInstance)===null||C===void 0?void 0:C.number(o[h]))!==null&&O!==void 0?O:null,Se!==null)return new dn(Se,this);break;case Le.String:if(Se=(le=(U=this._runtimeInstance)===null||U===void 0?void 0:U.string(o[h]))!==null&&le!==void 0?le:null,Se!==null)return new hn(Se,this);break;case Le.Boolean:if(Se=(re=(pe=this._runtimeInstance)===null||pe===void 0?void 0:pe.boolean(o[h]))!==null&&re!==void 0?re:null,Se!==null)return new fn(Se,this);break;case Le.Color:if(Se=(z=($=this._runtimeInstance)===null||$===void 0?void 0:$.color(o[h]))!==null&&z!==void 0?z:null,Se!==null)return new vn(Se,this);break;case Le.Trigger:if(Se=(ve=(ie=this._runtimeInstance)===null||ie===void 0?void 0:ie.trigger(o[h]))!==null&&ve!==void 0?ve:null,Se!==null)return new Un(Se,this);break;case Le.Enum:if(Se=(Fe=(Ne=this._runtimeInstance)===null||Ne===void 0?void 0:Ne.enum(o[h]))!==null&&Fe!==void 0?Fe:null,Se!==null)return new At(Se,this);break;case Le.List:if(Se=(nt=(He=this._runtimeInstance)===null||He===void 0?void 0:He.list(o[h]))!==null&&nt!==void 0?nt:null,Se!==null)return new Wt(Se,this);break;case Le.Image:if(Se=(jt=(kt=this._runtimeInstance)===null||kt===void 0?void 0:kt.image(o[h]))!==null&&jt!==void 0?jt:null,Se!==null)return new Qn(Se,this);break;case Le.Artboard:if(Se=(pt=(We=this._runtimeInstance)===null||We===void 0?void 0:We.artboard(o[h]))!==null&&pt!==void 0?pt:null,Se!==null)return new Vt(Se,this);break}return null},p.prototype.internalViewModelInstance=function(o){var h;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(h=this._runtimeInstance)===null||h===void 0?void 0:h.viewModel(o);if(w!==null){var C=new p(w,this);return C.internalIncrementReferenceCount(),this._viewModelInstances.set(o,C),C}return null},p.prototype.number=function(o){var h=this.propertyFromPath(o,Le.Number);return h},p.prototype.string=function(o){var h=this.propertyFromPath(o,Le.String);return h},p.prototype.boolean=function(o){var h=this.propertyFromPath(o,Le.Boolean);return h},p.prototype.color=function(o){var h=this.propertyFromPath(o,Le.Color);return h},p.prototype.trigger=function(o){var h=this.propertyFromPath(o,Le.Trigger);return h},p.prototype.enum=function(o){var h=this.propertyFromPath(o,Le.Enum);return h},p.prototype.list=function(o){var h=this.propertyFromPath(o,Le.List);return h},p.prototype.image=function(o){var h=this.propertyFromPath(o,Le.Image);return h},p.prototype.artboard=function(o){var h=this.propertyFromPath(o,Le.Artboard);return h},p.prototype.viewModel=function(o){var h=o.split("/"),w=h.length>1?this.viewModelFromPathSegments(h.slice(0,h.length-1),0):this;return w!=null?w.internalViewModelInstance(h[h.length-1]):null},p.prototype.internalReplaceViewModel=function(o,h){var w;if(h.runtimeInstance!==null){var C=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,h.runtimeInstance))||!1;if(C){h.internalIncrementReferenceCount();var O=this.internalViewModelInstance(o);O!==null&&(O.removeParent(this),this._children.includes(O)&&(this._children=this._children.filter(function(U){return U!==O})),O.cleanup()),this._viewModelInstances.set(o,h),h.addParent(this)}return C}return!1},p.prototype.replaceViewModel=function(o,h){var w,C=o.split("/"),O=C.length>1?this.viewModelFromPathSegments(C.slice(0,C.length-1),0):this;return(w=O?.internalReplaceViewModel(C[C.length-1],h))!==null&&w!==void 0?w:!1},p.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(h){return E({},h)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(C){C.cleanup()}),this._viewModelInstances.clear();var h=x([],this._children,!0);this._children.length=0;var w=x([],this._parents,!0);this._parents.length=0,h.forEach(function(C){C.removeParent(o)}),w.forEach(function(C){C.removeFromViewModelCallbacks(o)})}},p})(),tt=(function(){function p(o,h){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=h}return p.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(h){return h!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(o){},p.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(h){o.internalHandleCallback(h)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),hn=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h(this.value)},o})(tt),dn=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h(this.value)},o})(tt),fn=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h(this.value)},o})(tt),Un=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(h){h()},o})(tt),At=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(h){this._viewModelInstanceValue.valueIndex=h},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h(this.value)},o})(tt),Wt=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(h.runtimeInstance),h.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(h,w){return h.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(h.runtimeInstance,w)?(h.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(h.runtimeInstance),h.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(h){this._viewModelInstanceValue.removeInstanceAt(h)},o.prototype.instanceAt=function(h){var w=this._viewModelInstanceValue.instanceAt(h);if(w!=null){var C=new Et(w,this._parentViewModel);return C}return null},o.prototype.swap=function(h,w){this._viewModelInstanceValue.swap(h,w)},o.prototype.internalHandleCallback=function(h){h()},o})(tt),vn=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),o.prototype.rgb=function(h,w,C){this._viewModelInstanceValue.rgb(h,w,C)},o.prototype.rgba=function(h,w,C,O){this._viewModelInstanceValue.argb(O,h,w,C)},o.prototype.argb=function(h,w,C,O){this._viewModelInstanceValue.argb(h,w,C,O)},o.prototype.alpha=function(h){this._viewModelInstanceValue.alpha(h)},o.prototype.opacity=function(h){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,h))*255))},o.prototype.internalHandleCallback=function(h){h(this.value)},o})(tt),Qn=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(h){var w;this._viewModelInstanceValue.value((w=h?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h()},o})(tt),Vt=(function(p){y(o,p);function o(h,w){return p.call(this,h,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(h){var w;this._viewModelInstanceValue.value((w=h?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(h){h()},o})(tt),gr=function(p){return k(void 0,void 0,void 0,function(){var o,h,w;return g(this,function(C){switch(C.label){case 0:return o=new Request(p),[4,fetch(o)];case 1:return h=C.sent(),[4,h.arrayBuffer()];case 2:return w=C.sent(),[2,w]}})})},Pt=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},wi={EventManager:Ue,TaskQueueManager:et},Ur=function(p){return k(void 0,void 0,void 0,function(){var o,h,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(O){return J.getInstance(function(U){U.decodeAudio(p,O)})}),[4,o];case 1:return h=C.sent(),w=new _.AudioWrapper(h),_.finalizationRegistry.register(w,h),[2,w]}})})},bi=function(p){return k(void 0,void 0,void 0,function(){var o,h,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(O){return J.getInstance(function(U){U.decodeImage(p,O)})}),[4,o];case 1:return h=C.sent(),w=new _.ImageWrapper(h),_.finalizationRegistry.register(w,h),[2,w]}})})},An=function(p){return k(void 0,void 0,void 0,function(){var o,h,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(O){return J.getInstance(function(U){U.decodeFont(p,O)})}),[4,o];case 1:return h=C.sent(),w=new _.FontWrapper(h),_.finalizationRegistry.register(w,h),[2,w]}})})}})(),l})())})(_s)),_s.exports}var ih=rh();const Ss="dracula",sh="dracula_story_v3.json",Cs="https://vycjpmuyscfygstjjied.supabase.co";var ah=_e('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Fo(n,e){Hi(e,!0);let t=Ze(void 0);Wa(()=>{if(!A(t))return;const l=new ih.Rive({src:`${Cs}/storage/v1/object/public/${Ss}/${e.fileName}`,canvas:A(t),autoplay:!0,stateMachines:"SM1"});return()=>{l.cleanup()}});var r=ah(),a=D(r);Yc(a,l=>he(t,l),()=>A(t)),ae(n,r),zi()}function oh(n,e){A(e)?.nextDialogueId&&Ut.goToDialogue(A(e).nextDialogueId)}var lh=_e('<img alt="BG" class="background-image svelte-ik8jti"/>'),uh=_e('<div class="background-media svelte-ik8jti"><!></div>'),ch=_e('<img alt="Char" class="character-image svelte-ik8jti"/>'),hh=_e('<div class="character-media svelte-ik8jti"><!></div>'),dh=(n,e,t)=>e(A(t)),fh=_e('<button class="option-button svelte-ik8jti"> </button>'),vh=_e('<div class="options-container svelte-ik8jti"></div>'),ph=_e('<div class="next-container svelte-ik8jti"><button class="next-button svelte-ik8jti">Далее...</button></div>'),gh=_e('<div class="dialogue-container svelte-ik8jti"><!> <!> <div class="dialogue-content svelte-ik8jti"><div class="dialogue-text svelte-ik8jti"> </div> <!></div></div>'),_h=_e("<p> </p>");function Yl(n,e){Hi(e,!0);const t=ai(()=>e.dialogue||Ut.findDialogue(Ut.currentDialogueId));As(()=>{A(t)?.onEnter&&Ut.runActions(A(t).onEnter)});function r(_){if(_.actions&&Ut.runActions(_.actions),_.miniGame){console.log("Запуск мини-игры:",_.miniGame.id),Ut.goToDialogue(_.miniGame.onWinDialogueId);return}_.nextDialogueId&&Ut.goToDialogue(_.nextDialogueId)}function a(_){return _.visibleIf&&_.visibleIf.hasItem?Ut.hasItem(_.visibleIf.hasItem):!0}var l=Ln(),c=Qt(l);{var f=_=>{var y=gh(),E=D(y);{var k=X=>{var P=uh(),M=D(P);{var oe=fe=>{var Z=Ln(),ge=Qt(Z);Io(ge,()=>A(t).backgroundImage,Ue=>{Fo(Ue,{get fileName(){return A(t).backgroundImage}})}),ae(fe,Z)},ce=fe=>{var Z=lh();it(()=>Po(Z,"src",`${Cs}/storage/v1/object/public/${Ss}/${A(t).backgroundImage}`)),ae(fe,Z)};Ge(M,fe=>{A(t).backgroundImage.endsWith(".riv")?fe(oe):fe(ce,!1)})}ae(X,P)};Ge(E,X=>{A(t).backgroundImage&&X(k)})}var g=W(E,2);{var x=X=>{var P=hh(),M=D(P);{var oe=fe=>{var Z=Ln(),ge=Qt(Z);Io(ge,()=>A(t).characterImage,Ue=>{Fo(Ue,{get fileName(){return A(t).characterImage}})}),ae(fe,Z)},ce=fe=>{var Z=ch();it(()=>Po(Z,"src",`${Cs}/storage/v1/object/public/${Ss}/${A(t).characterImage}`)),ae(fe,Z)};Ge(M,fe=>{A(t).characterImage.endsWith(".riv")?fe(oe):fe(ce,!1)})}ae(X,P)};Ge(g,X=>{A(t).characterImage&&X(x)})}var L=W(g,2),F=D(L),K=D(F),Y=W(F,2);{var q=X=>{var P=vh();Tt(P,21,()=>A(t).options,M=>M.text,(M,oe)=>{var ce=Ln(),fe=Qt(ce);{var Z=ge=>{var Ue=fh();Ue.__click=[dh,r,oe];var et=D(Ue);it(()=>qe(et,A(oe).text)),ae(ge,Ue)};Ge(fe,ge=>{a(A(oe))&&ge(Z)})}ae(M,ce)}),ae(X,P)},J=X=>{var P=Ln(),M=Qt(P);{var oe=ce=>{var fe=ph(),Z=D(fe);Z.__click=[oh,t],ae(ce,fe)};Ge(M,ce=>{A(t).nextDialogueId&&ce(oe)},!0)}ae(X,P)};Ge(Y,X=>{A(t).options&&A(t).options.length>0?X(q):X(J,!1)})}it(()=>qe(K,A(t).text)),ae(_,y)},v=_=>{var y=_h(),E=D(y);it(()=>qe(E,`Диалог не найден (ID: ${Ut.currentDialogueId??""})`)),ae(_,y)};Ge(c,_=>{A(t)?_(f):_(v,!1)})}ae(n,l),zi()}Hl(["click"]);var mh=_e('<div class="loading svelte-fgmugb"><p>🔄 Загрузка истории...</p></div>'),yh=_e('<div class="error svelte-fgmugb"> </div>'),wh=_e('<div class="dialogues-container svelte-fgmugb"><!></div>'),bh=_e('<div class="app svelte-fgmugb"><!></div>');function Eh(n,e){Hi(e,!1);let t=`${Cs}/storage/v1/object/public/${Ss}/${sh}`;Wa(async()=>{console.log("Загружаем историю из:",t),await Ut.loadStory(t)}),Jc();var r=bh(),a=D(r);{var l=f=>{var v=mh();ae(f,v)},c=f=>{var v=Ln(),_=Qt(v);{var y=k=>{var g=yh(),x=D(g);it(()=>qe(x,`⚠️ ${Ut.error??""}`)),ae(k,g)},E=k=>{var g=wh(),x=D(g);{var L=F=>{Yl(F,{})};Ge(x,F=>{Ut.storyData&&F(L)})}ae(k,g)};Ge(_,k=>{Ut.error?k(y):k(E,!1)},!0)}ae(f,v)};Ge(a,f=>{Ut.isLoading?f(l):f(c,!1)})}ae(n,r),zi()}const Ah="modulepreload",kh=function(n,e){return new URL(n,e).href},Do={},Ki=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){let _=function(y){return Promise.all(y.map(E=>Promise.resolve(E).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),v=f?.nonce||f?.getAttribute("nonce");a=_(t.map(y=>{if(y=kh(y,r),y in Do)return;Do[y]=!0;const E=y.endsWith(".css"),k=E?'[rel="stylesheet"]':"";if(!!r)for(let L=c.length-1;L>=0;L--){const F=c[L];if(F.href===y&&(!E||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${k}`))return;const x=document.createElement("link");if(x.rel=E?"stylesheet":Ah,E||(x.as="script"),x.crossOrigin="",x.href=y,v&&x.setAttribute("nonce",v),document.head.appendChild(x),E)return new Promise((L,F)=>{x.addEventListener("load",L),x.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${y}`)))})}))}function l(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return a.then(c=>{for(const f of c||[])f.status==="rejected"&&l(f.reason);return e().catch(l)})},jh=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ki(async()=>{const{default:r}=await Promise.resolve().then(()=>yi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Va extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Sh extends Va{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Uo extends Va{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class No extends Va{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var pa;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(pa||(pa={}));var Ch=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class xh{constructor(e,{headers:t={},customFetch:r,region:a=pa.Any}={}){this.url=e,this.headers=t,this.region=a,this.fetch=jh(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ch(this,void 0,void 0,function*(){try{const{headers:a,method:l,body:c}=t;let f={},{region:v}=t;v||(v=this.region);const _=new URL(`${this.url}/${e}`);v&&v!=="any"&&(f["x-region"]=v,_.searchParams.set("forceFunctionRegion",v));let y;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(f["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(f["Content-Type"]="application/json",y=JSON.stringify(c)));const E=yield this.fetch(_.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:y}).catch(L=>{throw new Sh(L)}),k=E.headers.get("x-relay-error");if(k&&k==="true")throw new Uo(E);if(!E.ok)throw new No(E);let g=((r=E.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),x;return g==="application/json"?x=yield E.json():g==="application/octet-stream"?x=yield E.blob():g==="text/event-stream"?x=E:g==="multipart/form-data"?x=yield E.formData():x=yield E.text(),{data:x,error:null,response:E}}catch(a){return{data:null,error:a,response:a instanceof No||a instanceof Uo?a.context:void 0}}})}}var mt={},Jr={},Xr={},Qr={},Zr={},ei={},Th=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},vi=Th();const Ih=vi.fetch,Jl=vi.fetch.bind(vi),Xl=vi.Headers,Ph=vi.Request,Rh=vi.Response,yi=Object.freeze(Object.defineProperty({__proto__:null,Headers:Xl,Request:Ph,Response:Rh,default:Jl,fetch:Ih},Symbol.toStringTag,{value:"Module"})),Oh=th(yi);var cs={},Bo;function Ql(){if(Bo)return cs;Bo=1,Object.defineProperty(cs,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return cs.default=n,cs}var Wo;function Zl(){if(Wo)return ei;Wo=1;var n=ei&&ei.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ei,"__esModule",{value:!0});const e=n(Oh),t=n(Ql());class r{constructor(l){var c,f;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(c=l.shouldThrowOnError)!==null&&c!==void 0?c:!1,this.signal=l.signal,this.isMaybeSingle=(f=l.isMaybeSingle)!==null&&f!==void 0?f:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,c){return this.headers=new Headers(this.headers),this.headers.set(l,c),this}then(l,c){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let v=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async _=>{var y,E,k,g;let x=null,L=null,F=null,K=_.status,Y=_.statusText;if(_.ok){if(this.method!=="HEAD"){const P=await _.text();P===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((y=this.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?L=P:L=JSON.parse(P))}const J=(E=this.headers.get("Prefer"))===null||E===void 0?void 0:E.match(/count=(exact|planned|estimated)/),X=(k=_.headers.get("content-range"))===null||k===void 0?void 0:k.split("/");J&&X&&X.length>1&&(F=parseInt(X[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(L)&&(L.length>1?(x={code:"PGRST116",details:`Results contain ${L.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},L=null,F=null,K=406,Y="Not Acceptable"):L.length===1?L=L[0]:L=null)}else{const J=await _.text();try{x=JSON.parse(J),Array.isArray(x)&&_.status===404&&(L=[],x=null,K=200,Y="OK")}catch{_.status===404&&J===""?(K=204,Y="No Content"):x={message:J}}if(x&&this.isMaybeSingle&&(!((g=x?.details)===null||g===void 0)&&g.includes("0 rows"))&&(x=null,K=200,Y="OK"),x&&this.shouldThrowOnError)throw new t.default(x)}return{error:x,data:L,count:F,status:K,statusText:Y}});return this.shouldThrowOnError||(v=v.catch(_=>{var y,E,k;return{error:{message:`${(y=_?.name)!==null&&y!==void 0?y:"FetchError"}: ${_?.message}`,details:`${(E=_?.stack)!==null&&E!==void 0?E:""}`,hint:"",code:`${(k=_?.code)!==null&&k!==void 0?k:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,c)}returns(){return this}overrideTypes(){return this}}return ei.default=r,ei}var Vo;function eu(){if(Vo)return Zr;Vo=1;var n=Zr&&Zr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Zr,"__esModule",{value:!0});const e=n(Zl());class t extends e.default{select(a){let l=!1;const c=(a??"*").split("").map(f=>/\s/.test(f)&&!l?"":(f==='"'&&(l=!l),f)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:l=!0,nullsFirst:c,foreignTable:f,referencedTable:v=f}={}){const _=v?`${v}.order`:"order",y=this.url.searchParams.get(_);return this.url.searchParams.set(_,`${y?`${y},`:""}${a}.${l?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:l,referencedTable:c=l}={}){const f=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(f,`${a}`),this}range(a,l,{foreignTable:c,referencedTable:f=c}={}){const v=typeof f>"u"?"offset":`${f}.offset`,_=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(v,`${a}`),this.url.searchParams.set(_,`${l-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:l=!1,settings:c=!1,buffers:f=!1,wal:v=!1,format:_="text"}={}){var y;const E=[a?"analyze":null,l?"verbose":null,c?"settings":null,f?"buffers":null,v?"wal":null].filter(Boolean).join("|"),k=(y=this.headers.get("Accept"))!==null&&y!==void 0?y:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${_}; for="${k}"; options=${E};`),_==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}return Zr.default=t,Zr}var qo;function qa(){if(qo)return Qr;qo=1;var n=Qr&&Qr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Qr,"__esModule",{value:!0});const e=n(eu());class t extends e.default{eq(a,l){return this.url.searchParams.append(a,`eq.${l}`),this}neq(a,l){return this.url.searchParams.append(a,`neq.${l}`),this}gt(a,l){return this.url.searchParams.append(a,`gt.${l}`),this}gte(a,l){return this.url.searchParams.append(a,`gte.${l}`),this}lt(a,l){return this.url.searchParams.append(a,`lt.${l}`),this}lte(a,l){return this.url.searchParams.append(a,`lte.${l}`),this}like(a,l){return this.url.searchParams.append(a,`like.${l}`),this}likeAllOf(a,l){return this.url.searchParams.append(a,`like(all).{${l.join(",")}}`),this}likeAnyOf(a,l){return this.url.searchParams.append(a,`like(any).{${l.join(",")}}`),this}ilike(a,l){return this.url.searchParams.append(a,`ilike.${l}`),this}ilikeAllOf(a,l){return this.url.searchParams.append(a,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(a,l){return this.url.searchParams.append(a,`ilike(any).{${l.join(",")}}`),this}is(a,l){return this.url.searchParams.append(a,`is.${l}`),this}in(a,l){const c=Array.from(new Set(l)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(a,`in.(${c})`),this}contains(a,l){return typeof l=="string"?this.url.searchParams.append(a,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(a,`cs.{${l.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(l)}`),this}containedBy(a,l){return typeof l=="string"?this.url.searchParams.append(a,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(a,`cd.{${l.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(l)}`),this}rangeGt(a,l){return this.url.searchParams.append(a,`sr.${l}`),this}rangeGte(a,l){return this.url.searchParams.append(a,`nxl.${l}`),this}rangeLt(a,l){return this.url.searchParams.append(a,`sl.${l}`),this}rangeLte(a,l){return this.url.searchParams.append(a,`nxr.${l}`),this}rangeAdjacent(a,l){return this.url.searchParams.append(a,`adj.${l}`),this}overlaps(a,l){return typeof l=="string"?this.url.searchParams.append(a,`ov.${l}`):this.url.searchParams.append(a,`ov.{${l.join(",")}}`),this}textSearch(a,l,{config:c,type:f}={}){let v="";f==="plain"?v="pl":f==="phrase"?v="ph":f==="websearch"&&(v="w");const _=c===void 0?"":`(${c})`;return this.url.searchParams.append(a,`${v}fts${_}.${l}`),this}match(a){return Object.entries(a).forEach(([l,c])=>{this.url.searchParams.append(l,`eq.${c}`)}),this}not(a,l,c){return this.url.searchParams.append(a,`not.${l}.${c}`),this}or(a,{foreignTable:l,referencedTable:c=l}={}){const f=c?`${c}.or`:"or";return this.url.searchParams.append(f,`(${a})`),this}filter(a,l,c){return this.url.searchParams.append(a,`${l}.${c}`),this}}return Qr.default=t,Qr}var Ho;function tu(){if(Ho)return Xr;Ho=1;var n=Xr&&Xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Xr,"__esModule",{value:!0});const e=n(qa());class t{constructor(a,{headers:l={},schema:c,fetch:f}){this.url=a,this.headers=new Headers(l),this.schema=c,this.fetch=f}select(a,{head:l=!1,count:c}={}){const f=l?"HEAD":"GET";let v=!1;const _=(a??"*").split("").map(y=>/\s/.test(y)&&!v?"":(y==='"'&&(v=!v),y)).join("");return this.url.searchParams.set("select",_),c&&this.headers.append("Prefer",`count=${c}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:l,defaultToNull:c=!0}={}){var f;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const _=a.reduce((y,E)=>y.concat(Object.keys(E)),[]);if(_.length>0){const y=[...new Set(_)].map(E=>`"${E}"`);this.url.searchParams.set("columns",y.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(a,{onConflict:l,ignoreDuplicates:c=!1,count:f,defaultToNull:v=!0}={}){var _;const y="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),f&&this.headers.append("Prefer",`count=${f}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const E=a.reduce((k,g)=>k.concat(Object.keys(g)),[]);if(E.length>0){const k=[...new Set(E)].map(g=>`"${g}"`);this.url.searchParams.set("columns",k.join(","))}}return new e.default({method:y,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}update(a,{count:l}={}){var c;const f="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:a}={}){var l;const c="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Xr.default=t,Xr}var zo;function Mh(){if(zo)return Jr;zo=1;var n=Jr&&Jr.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Jr,"__esModule",{value:!0});const e=n(tu()),t=n(qa());class r{constructor(l,{headers:c={},schema:f,fetch:v}={}){this.url=l,this.headers=new Headers(c),this.schemaName=f,this.fetch=v}from(l){const c=new URL(`${this.url}/${l}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:f=!1,get:v=!1,count:_}={}){var y;let E;const k=new URL(`${this.url}/rpc/${l}`);let g;f||v?(E=f?"HEAD":"GET",Object.entries(c).filter(([L,F])=>F!==void 0).map(([L,F])=>[L,Array.isArray(F)?`{${F.join(",")}}`:`${F}`]).forEach(([L,F])=>{k.searchParams.append(L,F)})):(E="POST",g=c);const x=new Headers(this.headers);return _&&x.set("Prefer",`count=${_}`),new t.default({method:E,url:k,headers:x,schema:this.schemaName,body:g,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}}return Jr.default=r,Jr}var Go;function Lh(){if(Go)return mt;Go=1;var n=mt&&mt.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(mt,"__esModule",{value:!0}),mt.PostgrestError=mt.PostgrestBuilder=mt.PostgrestTransformBuilder=mt.PostgrestFilterBuilder=mt.PostgrestQueryBuilder=mt.PostgrestClient=void 0;const e=n(Mh());mt.PostgrestClient=e.default;const t=n(tu());mt.PostgrestQueryBuilder=t.default;const r=n(qa());mt.PostgrestFilterBuilder=r.default;const a=n(eu());mt.PostgrestTransformBuilder=a.default;const l=n(Zl());mt.PostgrestBuilder=l.default;const c=n(Ql());return mt.PostgrestError=c.default,mt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default},mt}var $h=Lh();const Fh=eh($h),{PostgrestClient:Dh,PostgrestQueryBuilder:Av,PostgrestFilterBuilder:kv,PostgrestTransformBuilder:jv,PostgrestBuilder:Sv,PostgrestError:Cv}=Fh;class Uh{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Nh="2.15.1",Bh=`realtime-js/${Nh}`,Wh="1.0.0",ga=1e4,Vh=1e3,qh=100;var Li;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Li||(Li={}));var dt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(dt||(dt={}));var bn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(bn||(bn={}));var _a;(function(n){n.websocket="websocket"})(_a||(_a={}));var Pr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Pr||(Pr={}));class Hh{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const a=t.getUint8(1),l=t.getUint8(2);let c=this.HEADER_LENGTH+2;const f=r.decode(e.slice(c,c+a));c=c+a;const v=r.decode(e.slice(c,c+l));c=c+l;const _=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{ref:null,topic:f,event:v,payload:_}}}class nu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ze;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ze||(ze={}));const Ko=(n,e,t={})=>{var r;const a=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,c)=>(l[c]=zh(c,n,e,a),l),{})},zh=(n,e,t,r)=>{const a=e.find(f=>f.name===n),l=a?.type,c=t[n];return l&&!r.includes(l)?ru(l,c):ma(c)},ru=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Jh(e,t)}switch(n){case ze.bool:return Gh(e);case ze.float4:case ze.float8:case ze.int2:case ze.int4:case ze.int8:case ze.numeric:case ze.oid:return Kh(e);case ze.json:case ze.jsonb:return Yh(e);case ze.timestamp:return Xh(e);case ze.abstime:case ze.date:case ze.daterange:case ze.int4range:case ze.int8range:case ze.money:case ze.reltime:case ze.text:case ze.time:case ze.timestamptz:case ze.timetz:case ze.tsrange:case ze.tstzrange:return ma(e);default:return ma(e)}},ma=n=>n,Gh=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Kh=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Yh=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Jh=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const c=n.slice(1,t);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(f=>ru(e,f))}return n},Xh=n=>typeof n=="string"?n.replace(" ","T"):n,iu=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class na{constructor(e,t,r={},a=ga){this.channel=e,this.event=t,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Yo;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Yo||(Yo={}));class $i{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:l,onLeave:c,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=$i.syncState(this.state,a,l,c),this.pendingDiffs.forEach(v=>{this.state=$i.syncDiff(this.state,v,l,c)}),this.pendingDiffs=[],f()}),this.channel._on(r.diff,{},a=>{const{onJoin:l,onLeave:c,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=$i.syncDiff(this.state,a,l,c),f())}),this.onJoin((a,l,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:l,newPresences:c})}),this.onLeave((a,l,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,a){const l=this.cloneDeep(e),c=this.transformState(t),f={},v={};return this.map(l,(_,y)=>{c[_]||(v[_]=y)}),this.map(c,(_,y)=>{const E=l[_];if(E){const k=y.map(F=>F.presence_ref),g=E.map(F=>F.presence_ref),x=y.filter(F=>g.indexOf(F.presence_ref)<0),L=E.filter(F=>k.indexOf(F.presence_ref)<0);x.length>0&&(f[_]=x),L.length>0&&(v[_]=L)}else f[_]=y}),this.syncDiff(l,{joins:f,leaves:v},r,a)}static syncDiff(e,t,r,a){const{joins:l,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(l,(f,v)=>{var _;const y=(_=e[f])!==null&&_!==void 0?_:[];if(e[f]=this.cloneDeep(v),y.length>0){const E=e[f].map(g=>g.presence_ref),k=y.filter(g=>E.indexOf(g.presence_ref)<0);e[f].unshift(...k)}r(f,y,v)}),this.map(c,(f,v)=>{let _=e[f];if(!_)return;const y=v.map(E=>E.presence_ref);_=_.filter(E=>y.indexOf(E.presence_ref)<0),e[f]=_,a(f,_,v),_.length===0&&delete e[f]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const a=e[r];return"metas"in a?t[r]=a.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Jo;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Jo||(Jo={}));var Fi;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Fi||(Fi={}));var Kn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Kn||(Kn={}));class Ha{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=dt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new na(this,bn.join,this.params,this.timeout),this.rejoinTimer=new nu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dt.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(bn.reply,{},(a,l)=>{this._trigger(this._replyEventName(l),a)}),this.presence=new $i(this),this.broadcastEndpointURL=iu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==dt.closed){const{config:{broadcast:l,presence:c,private:f}}=this.params,v=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(k=>k.filter))!==null&&a!==void 0?a:[],_=!!this.bindings[Fi.PRESENCE]&&this.bindings[Fi.PRESENCE].length>0,y={},E={broadcast:l,presence:Object.assign(Object.assign({},c),{enabled:_}),postgres_changes:v,private:f};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(k=>e?.(Kn.CHANNEL_ERROR,k)),this._onClose(()=>e?.(Kn.CLOSED)),this.updateJoinPayload(Object.assign({config:E},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:k})=>{var g;if(this.socket.setAuth(),k===void 0){e?.(Kn.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,L=(g=x?.length)!==null&&g!==void 0?g:0,F=[];for(let K=0;K<L;K++){const Y=x[K],{filter:{event:q,schema:J,table:X,filter:P}}=Y,M=k&&k[K];if(M&&M.event===q&&M.schema===J&&M.table===X&&M.filter===P)F.push(Object.assign(Object.assign({},Y),{id:M.id}));else{this.unsubscribe(),this.state=dt.errored,e?.(Kn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=F,e&&e(Kn.SUBSCRIBED);return}}).receive("error",k=>{this.state=dt.errored,e?.(Kn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(k).join(", ")||"error")))}).receive("timeout",()=>{e?.(Kn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===dt.joined&&e===Fi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:c}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const _=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=_.body)===null||a===void 0?void 0:a.cancel()),_.ok?"ok":"error"}catch(_){return _.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,f,v;const _=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(f=(c=this.params)===null||c===void 0?void 0:c.config)===null||f===void 0?void 0:f.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),_.receive("ok",()=>l("ok")),_.receive("error",()=>l("error")),_.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=dt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(bn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new na(this,bn.leave,{},e),r.receive("ok",()=>{t(),a("ok")}).receive("timeout",()=>{t(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const a=new AbortController,l=setTimeout(()=>a.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(l),c}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new na(this,e,t,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>qh){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var a,l;const c=e.toLocaleLowerCase(),{close:f,error:v,leave:_,join:y}=bn;if(r&&[f,v,_,y].indexOf(c)>=0&&r!==this._joinRef())return;let k=this._onMessage(c,t,r);if(t&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(g=>{var x,L,F;return((x=g.filter)===null||x===void 0?void 0:x.event)==="*"||((F=(L=g.filter)===null||L===void 0?void 0:L.event)===null||F===void 0?void 0:F.toLocaleLowerCase())===c}).map(g=>g.callback(k,r)):(l=this.bindings[c])===null||l===void 0||l.filter(g=>{var x,L,F,K,Y,q;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in g){const J=g.id,X=(x=g.filter)===null||x===void 0?void 0:x.event;return J&&((L=t.ids)===null||L===void 0?void 0:L.includes(J))&&(X==="*"||X?.toLocaleLowerCase()===((F=t.data)===null||F===void 0?void 0:F.type.toLocaleLowerCase()))}else{const J=(Y=(K=g?.filter)===null||K===void 0?void 0:K.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase();return J==="*"||J===((q=t?.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===c}).map(g=>{if(typeof k=="object"&&"ids"in k){const x=k.data,{schema:L,table:F,commit_timestamp:K,type:Y,errors:q}=x;k=Object.assign(Object.assign({},{schema:L,table:F,commit_timestamp:K,eventType:Y,new:{},old:{},errors:q}),this._getPayloadRecords(x))}g.callback(k,r)})}_isClosed(){return this.state===dt.closed}_isJoined(){return this.state===dt.joined}_isJoining(){return this.state===dt.joining}_isLeaving(){return this.state===dt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const a=e.toLocaleLowerCase(),l={type:a,filter:t,callback:r};return this.bindings[a]?this.bindings[a].push(l):this.bindings[a]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var l;return!(((l=a.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Ha.isEqual(a.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(bn.close,{},e)}_onError(e){this._on(bn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ko(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ko(e.columns,e.old_record)),t}}const Xo=()=>{},hs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Qh=[1e3,2e3,5e3,1e4],Zh=1e4,ed=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class td{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ga,this.transport=null,this.heartbeatIntervalMs=hs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xo,this.ref=0,this.reconnectTimer=null,this.logger=Xo,this.conn=null,this.sendBuffer=[],this.serializer=new Hh,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let l;return a?l=a:typeof fetch>"u"?l=(...c)=>Ki(async()=>{const{default:f}=await Promise.resolve().then(()=>yi);return{default:f}},void 0,import.meta.url).then(({default:f})=>f(...c)).catch(f=>{throw new Error(`Failed to load @supabase/node-fetch: ${f.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...c)=>l(...c)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${_a.websocket}`,this.httpEndpoint=iu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Uh.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Wh}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Li.connecting:return Pr.Connecting;case Li.open:return Pr.Open;case Li.closing:return Pr.Closing;default:return Pr.Closed}}isConnected(){return this.connectionState()===Pr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(l=>l.topic===r);if(a)return a;{const l=new Ha(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:a,ref:l}=e,c=()=>{this.encode(e,f=>{var v;(v=this.conn)===null||v===void 0||v.send(f)})};this.log("push",`${t} ${r} (${l})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Vh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},hs.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:l,ref:c}=t,f=c?`(${c})`:"",v=l.status||"";this.log("receive",`${v} ${r} ${a} ${f}`.trim(),l),this.channels.filter(_=>_._isMember(r)).forEach(_=>_._trigger(a,l,c)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(bn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return`${e}${r}${a}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([ed],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const a={access_token:t,version:Bh};t&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(bn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new nu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},hs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,a,l,c,f,v,_;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:ga,this.heartbeatIntervalMs=(a=e?.heartbeatIntervalMs)!==null&&a!==void 0?a:hs.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(y=>Qh[y-1]||Zh),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((y,E)=>E(JSON.stringify(y))),this.decode=(_=e?.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class za extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ft(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class nd extends za{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ya extends za{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var rd=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const su=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ki(async()=>{const{default:r}=await Promise.resolve().then(()=>yi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},id=()=>rd(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ki(()=>Promise.resolve().then(()=>yi),void 0,import.meta.url)).Response:Response}),wa=n=>{if(Array.isArray(n))return n.map(t=>wa(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const a=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[a]=wa(r)}),e},sd=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Dr=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const ra=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ad=(n,e,t)=>Dr(void 0,void 0,void 0,function*(){const r=yield id();n instanceof r&&!t?.noResolveJson?n.json().then(a=>{const l=n.status||500,c=a?.statusCode||l+"";e(new nd(ra(a),l,c))}).catch(a=>{e(new ya(ra(a),a))}):e(new ya(ra(n),n))}),od=(n,e,t,r)=>{const a={method:n,headers:e?.headers||{}};return n==="GET"||!r?a:(sd(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(r)):a.body=r,e?.duplex&&(a.duplex=e.duplex),Object.assign(Object.assign({},a),t))};function Yi(n,e,t,r,a,l){return Dr(this,void 0,void 0,function*(){return new Promise((c,f)=>{n(t,od(e,r,a,l)).then(v=>{if(!v.ok)throw v;return r?.noResolveJson?v:v.json()}).then(v=>c(v)).catch(v=>ad(v,f,r))})})}function xs(n,e,t,r){return Dr(this,void 0,void 0,function*(){return Yi(n,"GET",e,t,r)})}function On(n,e,t,r,a){return Dr(this,void 0,void 0,function*(){return Yi(n,"POST",e,r,a,t)})}function ba(n,e,t,r,a){return Dr(this,void 0,void 0,function*(){return Yi(n,"PUT",e,r,a,t)})}function ld(n,e,t,r){return Dr(this,void 0,void 0,function*(){return Yi(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function au(n,e,t,r,a){return Dr(this,void 0,void 0,function*(){return Yi(n,"DELETE",e,r,a,t)})}var Lt=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const ud={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Qo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class cd{constructor(e,t={},r,a){this.url=e,this.headers=t,this.bucketId=r,this.fetch=su(a)}uploadOrUpdate(e,t,r,a){return Lt(this,void 0,void 0,function*(){try{let l;const c=Object.assign(Object.assign({},Qo),a);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const v=c.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=r,f["cache-control"]=`max-age=${c.cacheControl}`,f["content-type"]=c.contentType,v&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),a?.headers&&(f=Object.assign(Object.assign({},f),a.headers));const _=this._removeEmptyFolders(t),y=this._getFinalPath(_),E=yield(e=="PUT"?ba:On)(this.fetch,`${this.url}/object/${y}`,l,Object.assign({headers:f},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:_,id:E.Id,fullPath:E.Key},error:null}}catch(l){if(ft(l))return{data:null,error:l};throw l}})}upload(e,t,r){return Lt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,a){return Lt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),f=new URL(this.url+`/object/upload/sign/${c}`);f.searchParams.set("token",t);try{let v;const _=Object.assign({upsert:Qo.upsert},a),y=Object.assign(Object.assign({},this.headers),{"x-upsert":String(_.upsert)});typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",_.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",_.cacheControl)):(v=r,y["cache-control"]=`max-age=${_.cacheControl}`,y["content-type"]=_.contentType);const E=yield ba(this.fetch,f.toString(),v,{headers:y});return{data:{path:l,fullPath:E.Key},error:null}}catch(v){if(ft(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return Lt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const a=Object.assign({},this.headers);t?.upsert&&(a["x-upsert"]="true");const l=yield On(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),c=new URL(this.url+l.url),f=c.searchParams.get("token");if(!f)throw new za("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:f},error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}update(e,t,r){return Lt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Lt(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}copy(e,t,r){return Lt(this,void 0,void 0,function*(){try{return{data:{path:(yield On(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}createSignedUrl(e,t,r){return Lt(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),l=yield On(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${c}`)},{data:l,error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}createSignedUrls(e,t,r){return Lt(this,void 0,void 0,function*(){try{const a=yield On(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${l}`):null})),error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}download(e,t){return Lt(this,void 0,void 0,function*(){const a=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),c=l?`?${l}`:"";try{const f=this._getFinalPath(e);return{data:yield(yield xs(this.fetch,`${this.url}/${a}/${f}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(f){if(ft(f))return{data:null,error:f};throw f}})}info(e){return Lt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield xs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:wa(r),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}exists(e){return Lt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield ld(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(ft(r)&&r instanceof ya){const a=r.originalError;if([400,404].includes(a?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),a=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&a.push(l);const f=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&a.push(v);let _=a.join("&");return _!==""&&(_=`?${_}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${_}`)}}}remove(e){return Lt(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}list(e,t,r){return Lt(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},ud),t),{prefix:e||""});return{data:yield On(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}})}listV2(e,t){return Lt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield On(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const hd="2.11.0",dd={"X-Client-Info":`storage-js/${hd}`};var ti=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class fd{constructor(e,t={},r,a){const l=new URL(e);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},dd),t),this.fetch=su(r)}listBuckets(){return ti(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ft(e))return{data:null,error:e};throw e}})}getBucket(e){return ti(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ti(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ti(this,void 0,void 0,function*(){try{return{data:yield ba(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ft(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ti(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ti(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ft(t))return{data:null,error:t};throw t}})}}class vd extends fd{constructor(e,t={},r,a){super(e,t,r,a)}from(e){return new cd(this.url,this.headers,e,this.fetch)}}const pd="2.56.0";let Ri="";typeof Deno<"u"?Ri="deno":typeof document<"u"?Ri="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ri="react-native":Ri="node";const gd={"X-Client-Info":`supabase-js-${Ri}/${pd}`},_d={headers:gd},md={schema:"public"},yd={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wd={};var bd=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const Ed=n=>{let e;return n?e=n:typeof fetch>"u"?e=Jl:e=fetch,(...t)=>e(...t)},Ad=()=>typeof Headers>"u"?Xl:Headers,kd=(n,e,t)=>{const r=Ed(t),a=Ad();return(l,c)=>bd(void 0,void 0,void 0,function*(){var f;const v=(f=yield e())!==null&&f!==void 0?f:n;let _=new a(c?.headers);return _.has("apikey")||_.set("apikey",n),_.has("Authorization")||_.set("Authorization",`Bearer ${v}`),r(l,Object.assign(Object.assign({},c),{headers:_}))})};var jd=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};function Sd(n){return n.endsWith("/")?n:n+"/"}function Cd(n,e){var t,r;const{db:a,auth:l,realtime:c,global:f}=n,{db:v,auth:_,realtime:y,global:E}=e,k={db:Object.assign(Object.assign({},v),a),auth:Object.assign(Object.assign({},_),l),realtime:Object.assign(Object.assign({},y),c),storage:{},global:Object.assign(Object.assign(Object.assign({},E),f),{headers:Object.assign(Object.assign({},(t=E?.headers)!==null&&t!==void 0?t:{}),(r=f?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>jd(this,void 0,void 0,function*(){return""})};return n.accessToken?k.accessToken=n.accessToken:delete k.accessToken,k}const ou="2.71.1",oi=30*1e3,Ea=3,ia=Ea*oi,xd="http://localhost:9999",Td="supabase.auth.token",Id={"X-Client-Info":`gotrue-js/${ou}`},Aa="X-Supabase-Api-Version",lu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Pd=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Rd=600*1e3;class Ga extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ye(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Od extends Ga{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Md(n){return ye(n)&&n.name==="AuthApiError"}class uu extends Ga{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class pr extends Ga{constructor(e,t,r,a){super(e,r,a),this.name=t,this.status=r}}class or extends pr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ld(n){return ye(n)&&n.name==="AuthSessionMissingError"}class ds extends pr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fs extends pr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vs extends pr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function $d(n){return ye(n)&&n.name==="AuthImplicitGrantRedirectError"}class Zo extends pr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ka extends pr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function sa(n){return ye(n)&&n.name==="AuthRetryableFetchError"}class el extends pr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ja extends pr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),tl=` 	
\r=`.split(""),Fd=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<tl.length;e+=1)n[tl[e].charCodeAt(0)]=-2;for(let e=0;e<Ts.length;e+=1)n[Ts[e].charCodeAt(0)]=e;return n})();function nl(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ts[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ts[r]),e.queuedBits-=6}}function cu(n,e,t){const r=Fd[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function rl(n){const e=[],t=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},l=c=>{Nd(c,r,t)};for(let c=0;c<n.length;c+=1)cu(n.charCodeAt(c),a,l);return e.join("")}function Dd(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Ud(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|a)+65536,t+=1}Dd(r,e)}}function Nd(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Bd(n){const e=[],t={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<n.length;a+=1)cu(n.charCodeAt(a),t,r);return new Uint8Array(e)}function Wd(n){const e=[];return Ud(n,t=>e.push(t)),new Uint8Array(e)}function Vd(n){const e=[],t={queue:0,queuedBits:0},r=a=>{e.push(a)};return n.forEach(a=>nl(a,t,r)),nl(null,t,r),e.join("")}function qd(n){return Math.round(Date.now()/1e3)+n}function Hd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const wn=()=>typeof window<"u"&&typeof document<"u",Cr={tested:!1,writable:!1},hu=()=>{if(!wn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Cr.tested)return Cr.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Cr.tested=!0,Cr.writable=!0}catch{Cr.tested=!0,Cr.writable=!1}return Cr.writable};function zd(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((a,l)=>{e[l]=a})}catch{}return t.searchParams.forEach((r,a)=>{e[a]=r}),e}const du=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ki(async()=>{const{default:r}=await Promise.resolve().then(()=>yi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Gd=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",li=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},xr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ar=async(n,e)=>{await n.removeItem(e)};class Ns{constructor(){this.promise=new Ns.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ns.promiseConstructor=Promise;function aa(n){const e=n.split(".");if(e.length!==3)throw new ja("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Pd.test(e[r]))throw new ja("JWT not in base64url format");return{header:JSON.parse(rl(e[0])),payload:JSON.parse(rl(e[1])),signature:Bd(e[2]),raw:{header:e[0],payload:e[1]}}}async function Kd(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Yd(n,e){return new Promise((r,a)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await n(l);if(!e(l,null,c)){r(c);return}}catch(c){if(!e(l,c)){a(c);return}}})()})}function Jd(n){return("0"+n.toString(16)).substr(-2)}function Xd(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let a="";for(let l=0;l<56;l++)a+=t.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,Jd).join("")}async function Qd(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),a=new Uint8Array(r);return Array.from(a).map(l=>String.fromCharCode(l)).join("")}async function Zd(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Qd(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ni(n,e,t=!1){const r=Xd();let a=r;t&&(a+="/PASSWORD_RECOVERY"),await li(n,`${e}-code-verifier`,a);const l=await Zd(r);return[l,r===l?"plain":"s256"]}const ef=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function tf(n){const e=n.headers.get(Aa);if(!e||!e.match(ef))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function nf(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function rf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const sf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ri(n){if(!sf.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function oa(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function il(n){return JSON.parse(JSON.stringify(n))}var af=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t};const Tr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),of=[502,503,504];async function sl(n){var e;if(!Gd(n))throw new ka(Tr(n),0);if(of.includes(n.status))throw new ka(Tr(n),n.status);let t;try{t=await n.json()}catch(l){throw new uu(Tr(l),l)}let r;const a=tf(n);if(a&&a.getTime()>=lu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new el(Tr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new or}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new el(Tr(t),n.status,t.weak_password.reasons);throw new Od(Tr(t),n.status||500,r)}const lf=(n,e,t,r)=>{const a={method:n,headers:e?.headers||{}};return n==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),t))};async function Ce(n,e,t,r){var a;const l=Object.assign({},r?.headers);l[Aa]||(l[Aa]=lu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const c=(a=r?.query)!==null&&a!==void 0?a:{};r?.redirectTo&&(c.redirect_to=r.redirectTo);const f=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",v=await uf(n,e,t+f,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(v):{data:Object.assign({},v),error:null}}async function uf(n,e,t,r,a,l){const c=lf(e,r,a,l);let f;try{f=await n(t,Object.assign({},c))}catch(v){throw console.error(v),new ka(Tr(v),0)}if(f.ok||await sl(f),r?.noResolveJson)return f;try{return await f.json()}catch(v){await sl(v)}}function Gn(n){var e;let t=null;ff(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=qd(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function al(n){const e=Gn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function lr(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function cf(n){return{data:n,error:null}}function hf(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:l}=n,c=af(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:t,hashed_token:r,redirect_to:a,verification_type:l},v=Object.assign({},c);return{data:{properties:f,user:v},error:null}}function df(n){return n}function ff(n){return n.access_token&&n.refresh_token&&n.expires_in}const la=["global","local","others"];var vf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t};class pf{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=du(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=la[0]){if(la.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${la.join(", ")}`);try{return await Ce(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Ce(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:lr})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=vf(e,["options"]),a=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(a.new_email=r?.newEmail,delete a.newEmail),await Ce(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:hf,redirectTo:t?.redirectTo})}catch(t){if(ye(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ce(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:lr})}catch(t){if(ye(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,a,l,c,f,v;try{const _={nextPage:null,lastPage:0,total:0},y=await Ce(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&l!==void 0?l:""},xform:df});if(y.error)throw y.error;const E=await y.json(),k=(c=y.headers.get("x-total-count"))!==null&&c!==void 0?c:0,g=(v=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&v!==void 0?v:[];return g.length>0&&(g.forEach(x=>{const L=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),F=JSON.parse(x.split(";")[1].split("=")[1]);_[`${F}Page`]=L}),_.total=parseInt(k)),{data:Object.assign(Object.assign({},E),_),error:null}}catch(_){if(ye(_))return{data:{users:[]},error:_};throw _}}async getUserById(e){ri(e);try{return await Ce(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:lr})}catch(t){if(ye(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ri(e);try{return await Ce(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:lr})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ri(e);try{return await Ce(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:lr})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ri(e.userId);try{const{data:t,error:r}=await Ce(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:t,error:r}}catch(t){if(ye(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ri(e.userId),ri(e.id);try{return{data:await Ce(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}}}function ol(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function gf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ii={debug:!!(globalThis&&hu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _f extends fu{}async function mf(n,e,t){ii.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ii.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){ii.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,a.name);try{return await t()}finally{ii.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,a.name)}}else{if(e===0)throw ii.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new _f(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ii.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}gf();const yf={url:xd,storageKey:Td,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Id,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ll(n,e,t){return await t()}const si={};class Wi{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Wi.nextInstanceID,Wi.nextInstanceID+=1,this.instanceID>0&&wn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},yf),e);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new pf({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=du(a.fetch),this.lock=a.lock||ll,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:wn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=mf:this.lock=ll,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:hu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ol(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=ol(this.memoryStorage)),wn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=si[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){si[this.storageKey]=Object.assign(Object.assign({},si[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=si[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){si[this.storageKey]=Object.assign(Object.assign({},si[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ou}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=zd(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),wn()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),$d(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:c,redirectType:f}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",f),await this._saveSession(c),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ye(t)?{error:t}:{error:new uu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,a;try{const l=await Ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e?.options)===null||a===void 0?void 0:a.captchaToken}},xform:Gn}),{data:c,error:f}=l;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,_=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(l){if(ye(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,a;try{let l;if("email"in e){const{email:y,password:E,options:k}=e;let g=null,x=null;this.flowType==="pkce"&&([g,x]=await ni(this.storage,this.storageKey)),l=await Ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:k?.emailRedirectTo,body:{email:y,password:E,data:(t=k?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:k?.captchaToken},code_challenge:g,code_challenge_method:x},xform:Gn})}else if("phone"in e){const{phone:y,password:E,options:k}=e;l=await Ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:E,data:(r=k?.data)!==null&&r!==void 0?r:{},channel:(a=k?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:k?.captchaToken}},xform:Gn})}else throw new fs("You must provide either an email or phone number and a password");const{data:c,error:f}=l;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,_=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(l){if(ye(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:c,options:f}=e;t=await Ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:al})}else if("phone"in e){const{phone:l,password:c,options:f}=e;t=await Ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:al})}else throw new fs("You must provide either an email or phone number and a password");const{data:r,error:a}=t;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ds}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(t){if(ye(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,a,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,a,l,c,f,v,_,y,E,k,g;let x,L;if("message"in e)x=e.message,L=e.signature;else{const{chain:F,wallet:K,statement:Y,options:q}=e;let J;if(wn())if(typeof K=="object")J=K;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))J=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof K!="object"||!q?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");J=K}const X=new URL((t=q?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in J&&J.signIn){const P=await J.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},q?.signInWithSolana),{version:"1",domain:X.host,uri:X.href}),Y?{statement:Y}:null));let M;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")M=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)M=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)x=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),L=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in J)||typeof J.signMessage!="function"||!("publicKey"in J)||typeof J!="object"||!J.publicKey||!("toBase58"in J.publicKey)||typeof J.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${X.host} wants you to sign in with your Solana account:`,J.publicKey.toBase58(),...Y?["",Y,""]:[""],"Version: 1",`URI: ${X.href}`,`Issued At: ${(a=(r=q?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((l=q?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...!((c=q?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...!((f=q?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...!((v=q?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...!((_=q?.signInWithSolana)===null||_===void 0)&&_.requestId?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...!((E=(y=q?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||E===void 0)&&E.length?["Resources",...q.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const P=await J.signMessage(new TextEncoder().encode(x),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");L=P}}try{const{data:F,error:K}=await Ce(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:Vd(L)},!((k=e.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Gn});if(K)throw K;return!F||!F.session||!F.user?{data:{user:null,session:null},error:new ds}:(F.session&&(await this._saveSession(F.session),await this._notifyAllSubscribers("SIGNED_IN",F.session)),{data:Object.assign({},F),error:K})}catch(F){if(ye(F))return{data:{user:null,session:null},error:F};throw F}}async _exchangeCodeForSession(e){const t=await xr(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(t??"").split("/");try{const{data:l,error:c}=await Ce(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Gn});if(await ar(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new ds}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:a??null}),error:c})}catch(l){if(ye(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:a,access_token:l,nonce:c}=e,f=await Ce(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Gn}),{data:v,error:_}=f;return _?{data:{user:null,session:null},error:_}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new ds}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:_})}catch(t){if(ye(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,a,l,c;try{if("email"in e){const{email:f,options:v}=e;let _=null,y=null;this.flowType==="pkce"&&([_,y]=await ni(this.storage,this.storageKey));const{error:E}=await Ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(r=v?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:_,code_challenge_method:y},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:E}}if("phone"in e){const{phone:f,options:v}=e,{data:_,error:y}=await Ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(a=v?.data)!==null&&a!==void 0?a:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(c=v?.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:_?.message_id},error:y}}throw new fs("You must provide either an email or phone number.")}catch(f){if(ye(f))return{data:{user:null,session:null},error:f};throw f}}async verifyOtp(e){var t,r;try{let a,l;"options"in e&&(a=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:f}=await Ce(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:a,xform:Gn});if(f)throw f;if(!c)throw new Error("An error occurred on token verification.");const v=c.session,_=c.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(a){if(ye(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var t,r,a;try{let l=null,c=null;return this.flowType==="pkce"&&([l,c]=await ni(this.storage,this.storageKey)),await Ce(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:cf})}catch(l){if(ye(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new or;const{error:a}=await Ce(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(ye(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:l}=e,{error:c}=await Ce(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:r,type:a,options:l}=e,{data:c,error:f}=await Ce(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:c?.message_id},error:f}}throw new fs("You must provide either an email or phone number and a type")}catch(t){if(ye(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await xr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ia:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await xr(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=oa()}if(this.storage.isServer&&e.user){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,_,y)=>(!c&&_==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,_,y))})}return{data:{session:e},error:null}}const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:lr}):await this._useSession(async t=>{var r,a,l;const{data:c,error:f}=t;if(f)throw f;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new or}:await Ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&l!==void 0?l:void 0,xform:lr})})}catch(t){if(ye(t))return Ld(t)&&(await this._removeSession(),await ar(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:a,error:l}=r;if(l)throw l;if(!a.session)throw new or;const c=a.session;let f=null,v=null;this.flowType==="pkce"&&e.email!=null&&([f,v]=await ni(this.storage,this.storageKey));const{data:_,error:y}=await Ce(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:v}),jwt:c.access_token,xform:lr});if(y)throw y;return c.user=_.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(r){if(ye(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new or;const t=Date.now()/1e3;let r=t,a=!0,l=null;const{payload:c}=aa(e.access_token);if(c.exp&&(r=c.exp,a=r<=t),a){const{session:f,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!f)return{data:{user:null,session:null},error:null};l=f}else{const{data:f,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(ye(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:c,error:f}=t;if(f)throw f;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new or;const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ye(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!wn())throw new vs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Zo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Zo("No code detected.");const{data:Y,error:q}=await this._exchangeCodeForSession(e.code);if(q)throw q;const J=new URL(window.location.href);return J.searchParams.delete("code"),window.history.replaceState(window.history.state,"",J.toString()),{data:{session:Y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:l,refresh_token:c,expires_in:f,expires_at:v,token_type:_}=e;if(!l||!f||!c||!_)throw new vs("No session defined in URL");const y=Math.round(Date.now()/1e3),E=parseInt(f);let k=y+E;v&&(k=parseInt(v));const g=k-y;g*1e3<=oi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${E}s`);const x=k-E;y-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,k,y):y-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,k,y);const{data:L,error:F}=await this._getUser(l);if(F)throw F;const K={provider_token:r,provider_refresh_token:a,access_token:l,expires_in:E,expires_at:k,refresh_token:c,token_type:_,user:L.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:K,redirectType:e.type},error:null}}catch(r){if(ye(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await xr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:a,error:l}=t;if(l)return{error:l};const c=(r=a.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:f}=await this.admin.signOut(c,e);if(f&&!(Md(f)&&(f.status===404||f.status===401||f.status===403)))return{error:f}}return e!=="others"&&(await this._removeSession(),await ar(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Hd(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,a;try{const{data:{session:l},error:c}=t;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await ni(this.storage,this.storageKey,!0));try{return await Ce(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(ye(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ye(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:a}=await this._useSession(async l=>{var c,f,v,_,y;const{data:E,error:k}=l;if(k)throw k;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await Ce(this.fetch,"GET",g,{headers:this.headers,jwt:(y=(_=E.session)===null||_===void 0?void 0:_.access_token)!==null&&y!==void 0?y:void 0})});if(a)throw a;return wn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ye(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,a;const{data:l,error:c}=t;if(c)throw c;return await Ce(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(t){if(ye(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Yd(async a=>(a>0&&await Kd(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await Ce(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Gn})),(a,l)=>{const c=200*Math.pow(2,a);return l&&sa(l)&&Date.now()+c-r<oi})}catch(r){if(this._debug(t,"error",r),ye(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),wn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await xr(this.storage,this.storageKey);if(a&&this.userStorage){let c=await xr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await li(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c?.user)!==null&&e!==void 0?e:oa()}else if(a&&!a.user&&!a.user){const c=await xr(this.storage,this.storageKey+"-user");c&&c?.user?(a.user=c.user,await ar(this.storage,this.storageKey+"-user"),await li(this.storage,this.storageKey,a)):a.user=oa()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const l=((t=a.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ia;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${ia}s`),l){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),sa(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:f}=await this._getUser(a.access_token);!f&&c?.user?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new or;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Ns;const{data:l,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!l.session)throw new or;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const f={session:l.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(l){if(this._debug(a,"error",l),ye(l)){const c={session:null,error:l};return sa(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(c),l.length>0){for(let f=0;f<l.length;f+=1)console.error(l[f]);throw l[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await li(this.userStorage,this.storageKey+"-user",{user:t.user});const a=Object.assign({},t);delete a.user;const l=il(a);await li(this.storage,this.storageKey,l)}else{const a=il(t);await li(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await ar(this.storage,this.storageKey),await ar(this.storage,this.storageKey+"-code-verifier"),await ar(this.storage,this.storageKey+"-user"),this.userStorage&&await ar(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&wn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),oi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/oi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${oi}ms, refresh threshold is ${Ea} ticks`),a<=Ea&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!wn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const a=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,c]=await ni(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(f.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);a.push(l.toString())}return r?.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:a,error:l}=t;return l?{data:null,error:l}:await Ce(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ye(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,a;const{data:l,error:c}=t;if(c)return{data:null,error:c};const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:_}=await Ce(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return _?{data:null,error:_}:(e.factorType==="totp"&&(!((a=v?.totp)===null||a===void 0)&&a.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(ye(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:l}=t;if(l)return{data:null,error:l};const{data:c,error:f}=await Ce(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:f})})}catch(t){if(ye(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:a,error:l}=t;return l?{data:null,error:l}:await Ce(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ye(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],a=r.filter(c=>c.factor_type==="totp"&&c.status==="verified"),l=r.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:r,totp:a,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:a},error:l}=e;if(l)return{data:null,error:l};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=aa(a.access_token);let f=null;c.aal&&(f=c.aal);let v=f;((r=(t=a.user.factors)===null||t===void 0?void 0:t.filter(E=>E.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(v="aal2");const y=c.amr||[];return{data:{currentLevel:f,nextLevel:v,currentAuthenticationMethods:y},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(f=>f.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(f=>f.kid===e),r&&this.jwks_cached_at+Rd>a)return r;const{data:l,error:c}=await Ce(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=a,r=l.keys.find(f=>f.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:x}=await this.getSession();if(x||!g.session)return{data:null,error:x};r=g.session.access_token}const{header:a,payload:l,signature:c,raw:{header:f,payload:v}}=aa(r);t?.allowExpired||nf(l.exp);const _=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!_){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:l,header:a,signature:c},error:null}}const y=rf(a.alg),E=await crypto.subtle.importKey("jwk",_,y,!0,["verify"]);if(!await crypto.subtle.verify(y,E,c,Wd(`${f}.${v}`)))throw new ja("Invalid JWT signature");return{data:{claims:l,header:a,signature:c},error:null}}catch(r){if(ye(r))return{data:null,error:r};throw r}}}Wi.nextInstanceID=0;const wf=Wi;class bf extends wf{constructor(e){super(e)}}var Ef=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(E){c(E)}}function v(y){try{_(r.throw(y))}catch(E){c(E)}}function _(y){y.done?l(y.value):a(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class Af{constructor(e,t,r){var a,l,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=Sd(e),v=new URL(f);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const _=`sb-${v.hostname.split(".")[0]}-auth-token`,y={db:md,realtime:wd,auth:Object.assign(Object.assign({},yd),{storageKey:_}),global:_d},E=Cd(r??{},y);this.storageKey=(a=E.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(l=E.global.headers)!==null&&l!==void 0?l:{},E.accessToken?(this.accessToken=E.accessToken,this.auth=new Proxy({},{get:(k,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=E.auth)!==null&&c!==void 0?c:{},this.headers,E.global.fetch),this.fetch=kd(t,this._getAccessToken.bind(this),E.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},E.realtime)),this.rest=new Dh(new URL("rest/v1",v).href,{headers:this.headers,schema:E.db.schema,fetch:this.fetch}),this.storage=new vd(this.storageUrl.href,this.headers,this.fetch,r?.storage),E.accessToken||this._listenForAuthEvents()}get functions(){return new xh(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ef(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,storageKey:l,flowType:c,lock:f,debug:v},_,y){const E={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bf({url:this.authUrl.href,headers:Object.assign(Object.assign({},E),_),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:a,flowType:c,lock:f,debug:v,fetch:y,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new td(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const kf=(n,e,t)=>new Af(n,e,t);function jf(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}jf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Sf="https://vycjpmuyscfygstjjied.supabase.co",Cf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",ur="dracula",Rr=kf(Sf,Cf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}});async function xf(n,e,t,r){const a=prompt("Введите имя файла истории:","new_story.json");if(!a)return;const l={meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1"}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},c=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),{error:f}=await Rr.storage.from(ur).upload(a,c);f?he(e,{type:"error",text:"Ошибка создания: "+f.message},!0):(await t(),await r(a))}async function Tf(n,e,t,r){if(!A(e))return;he(t,{type:"loading",text:"Сохранение..."},!0);const a=new Blob([JSON.stringify(A(e),null,2)],{type:"application/json"}),{error:l}=await Rr.storage.from(ur).upload(A(r),a,{upsert:!0});he(t,{type:l?"error":"success",text:l?"Ошибка сохранения":"Сохранено!"},!0)}async function If(n,e,t){const r=n.target;if(!r.files||r.files.length===0)return;const a=r.files[0];he(e,{type:"loading",text:"Загрузка файла..."},!0);const{error:l}=await Rr.storage.from(ur).upload(a.name,a,{upsert:!0});l?he(e,{type:"error",text:"Ошибка загрузки"},!0):(he(e,{type:"success",text:"Файл загружен"},!0),await t())}function Pf(n,e,t){if(!A(e)||!A(e).chapters)return;const r="ch_"+Date.now();A(e).chapters.push({id:r,title:"Новая глава"}),he(t,r)}function Rf(n,e,t){if(!A(e))return;A(e).items||(A(e).items=[]);const r={id:"item_"+Date.now(),name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};A(e).items.push(r),he(t,A(e).items.length-1)}function Of(n,e,t,r){if(!A(e)||!A(t))return;const a="d_"+Date.now();A(e).dialogues.push({id:a,chapterId:A(t),text:"Новый текст...",options:[]}),he(r,a)}var Mf=(n,e)=>e(n.target.value),Lf=_e("<option> </option>"),$f=(n,e,t)=>he(e,A(t).id,!0),Ff=_e("<div> </div>"),Df=(n,e,t)=>he(e,A(t).id,!0),Uf=_e('<div><span class="id-badge svelte-17amxsj"> </span> <span class="preview-text svelte-17amxsj"> </span></div>'),Nf=_e("<div> </div>"),Bf=(n,e)=>he(e,!A(e)),Wf=(n,e)=>A(e).icon=n.target.value,Vf=_e("<option> </option>"),qf=_e('<div class="item-edit-form svelte-17amxsj"><div class="edit-grid svelte-17amxsj"><div class="form-group full-width-edit svelte-17amxsj"><label class="svelte-17amxsj">ID предмета</label> <input type="text" class="input svelte-17amxsj"/></div> <div class="form-group full-width-edit svelte-17amxsj"><label class="svelte-17amxsj">Название</label> <input type="text" class="input svelte-17amxsj"/></div> <div class="form-group full-width-edit svelte-17amxsj"><label class="svelte-17amxsj">Описание</label> <textarea class="textarea svelte-17amxsj" rows="2"></textarea></div> <div class="form-group full-width-edit svelte-17amxsj"><label class="svelte-17amxsj">Иконка (Файл)</label> <div class="input-group svelte-17amxsj"><input type="text" class="input svelte-17amxsj" placeholder="icon.png"/> <select class="input select svelte-17amxsj" style="max-width: 150px;"><option>-- Выбрать --</option><!></select></div></div> <div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Тип</label> <select class="item-type-select svelte-17amxsj"><option>Инструмент</option><option>Ключ</option><option>Расходуемый</option><option>Квестовый</option><option>Разное</option></select></div></div></div>'),Hf=_e('<div><div class="item-info svelte-17amxsj"><div class="item-main svelte-17amxsj"><span class="item-id-badge svelte-17amxsj"> </span> <span class="item-name-preview svelte-17amxsj"> </span></div> <div class="item-desc-preview svelte-17amxsj"> </div></div> <div class="item-actions"><button class="btn-icon svelte-17amxsj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-17amxsj" title="Удалить">×</button></div> <!></div>'),zf=_e('<p class="empty-hint svelte-17amxsj">Нет предметов. Нажмите "+" чтобы добавить.</p>'),Gf=_e('<div class="items-list svelte-17amxsj"><!> <button class="btn primary small svelte-17amxsj" style="margin-top:10px; width:100%">+ Добавить предмет</button></div>'),Kf=_e("<option> </option>"),Yf=_e("<option> </option>"),Jf=_e("<option> </option>"),Xf=_e("<option> </option>"),Qf=(n,e,t)=>e(A(t)),Zf=_e("<option> </option>"),ev=_e("<option> </option>"),tv=_e("<option> </option>"),nv=_e('<div class="form-group full-width svelte-17amxsj"><label class="svelte-17amxsj">Предмет</label> <select class="input select svelte-17amxsj"><option>-- Выберите предмет --</option><!></select></div>'),rv=_e('<div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Стата</label> <input type="text" class="input svelte-17amxsj" placeholder="knowledge"/></div> <div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Значение ></label> <input type="number" class="input svelte-17amxsj"/></div>',1),iv=_e('<div class="form-group full-width svelte-17amxsj"><label class="svelte-17amxsj">Имя флага</label> <input type="text" class="input svelte-17amxsj" placeholder="metDracula"/></div>'),sv=_e('<div class="option-details svelte-17amxsj"><div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Текст кнопки</label><input type="text" class="input svelte-17amxsj"/></div> <div class="form-row svelte-17amxsj"><div class="form-group full-width svelte-17amxsj"><label class="svelte-17amxsj">Переход</label> <select class="input select svelte-17amxsj"><option>-- Конец ветки --</option><!></select></div></div> <div class="options-settings-grid svelte-17amxsj"><div class="setting-col svelte-17amxsj"><label class="checkbox-row svelte-17amxsj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-17amxsj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-17amxsj"><label class="checkbox-row svelte-17amxsj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-17amxsj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-17amxsj"><div class="form-row svelte-17amxsj"><div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Условие видимости</label> <select class="input select svelte-17amxsj"></select></div> <!> <!> <!></div></div></div>'),av=_e('<div><div class="option-header svelte-17amxsj"><span class="status-icons svelte-17amxsj"><!></span> <span> </span> <button class="btn-icon danger svelte-17amxsj">×</button></div> <!></div>'),ov=_e("<option> </option>"),lv=(n,e,t)=>e(A(t).nextDialogueId),uv=_e('<div class="link-row svelte-17amxsj"><span class="link-type svelte-17amxsj">Auto:</span> <span class="link-id svelte-17amxsj"> </span> <button class="btn-link svelte-17amxsj">Перейти →</button></div>'),cv=(n,e,t)=>e(A(t).nextDialogueId),hv=_e('<div class="link-row svelte-17amxsj"><span class="link-type svelte-17amxsj">Opt:</span> <span class="link-id svelte-17amxsj"> </span> <button class="btn-link svelte-17amxsj">Перейти →</button></div>'),dv=(n,e,t)=>e(A(t).id),fv=_e('<div class="dialogue-form svelte-17amxsj"><div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">ID диалога</label><input type="text" class="input svelte-17amxsj"/></div> <div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Текст</label><textarea class="textarea svelte-17amxsj" rows="3"></textarea></div> <div class="media-section svelte-17amxsj"><h4 class="svelte-17amxsj">Медиа ресурсы</h4> <div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Фон</label> <div class="input-group svelte-17amxsj"><select class="input select svelte-17amxsj"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-17amxsj">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-17amxsj"><label class="svelte-17amxsj">Персонаж</label> <div class="input-group svelte-17amxsj"><select class="input select svelte-17amxsj"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-17amxsj"><div class="section-header svelte-17amxsj"><h4 class="svelte-17amxsj">Варианты ответов</h4><button class="btn small svelte-17amxsj">+ Добавить</button></div> <!></div> <div class="links-section svelte-17amxsj"><h4 class="svelte-17amxsj">Авто-переход</h4> <select class="input select svelte-17amxsj"><option>-- Нет --</option><!></select></div> <div class="infographic-section svelte-17amxsj"><h4 class="svelte-17amxsj">Связи и переходы</h4> <div class="info-block svelte-17amxsj"><div class="info-title svelte-17amxsj">👉 Куда ведет:</div> <!> <!></div></div> <div class="form-actions svelte-17amxsj"><button class="btn danger svelte-17amxsj">Удалить сцену</button></div></div>'),vv=_e('<div class="empty-state svelte-17amxsj">Выберите сцену</div>'),pv=(n,e)=>he(e,null),gv=_e('<div class="empty-preview svelte-17amxsj">Выберите сцену</div>'),_v=_e('<div class="editor-container svelte-17amxsj"><header class="toolbar svelte-17amxsj"><div class="logo svelte-17amxsj"><h2 class="svelte-17amxsj">Story Editor v3.1</h2></div> <div class="stories-control svelte-17amxsj"><select class="story-select svelte-17amxsj"></select> <button class="btn primary small svelte-17amxsj">+ Новая</button> <button class="btn success small svelte-17amxsj">💾 Сохранить</button> <button class="btn small svelte-17amxsj">📋 Копия</button></div></header> <div class="main-workspace svelte-17amxsj"><aside class="sidebar svelte-17amxsj"><div class="sidebar-section svelte-17amxsj"><div class="section-header svelte-17amxsj"><h3>Главы</h3><button class="btn-icon svelte-17amxsj">+</button></div> <div class="chapter-list svelte-17amxsj"></div></div> <div class="sidebar-section flex-1 svelte-17amxsj"><div class="section-header svelte-17amxsj"><h3> </h3><button class="btn-icon svelte-17amxsj">+</button></div> <div class="dialogue-list svelte-17amxsj"></div></div> <div class="status-box svelte-17amxsj"><!></div></aside> <main class="editor-area svelte-17amxsj"><div class="items-manager svelte-17amxsj"><div class="section-header svelte-17amxsj"><h4 class="svelte-17amxsj"> </h4> <span class="toggle-icon svelte-17amxsj"> </span></div> <!></div> <!></main> <aside class="preview-panel svelte-17amxsj"><div class="preview-header svelte-17amxsj"><h3 class="svelte-17amxsj">Предпросмотр</h3> <button class="btn-link small svelte-17amxsj">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-17amxsj"><!></div></aside></div></div>');function mv(n,e){Hi(e,!0);let t=Ze($n({meta:{version:"3.1",title:"Untitled"},chapters:[],dialogues:[]})),r=Ze(null),a=Ze(null),l=Ze(null),c=Ze(null),f=Ze($n([])),v=Ze($n({type:"",text:""})),_=Ze($n([])),y=Ze("dracula_story_v3.json"),E=Ze(!1);Wa(async()=>{await k(),await x(A(y)),await L()});async function k(){const{data:$,error:z}=await Rr.storage.from(ur).list("",{search:".json"});!z&&$&&he(_,$.map(ie=>ie.name).filter(ie=>ie!==".emptyFolderPlaceholder"),!0)}async function g(){if(!A(t))return;const $=A(y).replace(".json",""),z=new Date().getTime();let ie=`${$}_copy_${z}.json`.trim();const ve=prompt("Введите имя для копии:",ie);if(!ve)return;ie=ve.trim(),ie.endsWith(".json")||(ie+=".json"),he(v,{type:"loading",text:"Создание копии..."},!0);const Ne=new Blob([JSON.stringify(A(t),null,2)],{type:"application/json"}),{error:Fe}=await Rr.storage.from(ur).upload(ie,Ne,{upsert:!0});Fe?he(v,{type:"error",text:`Ошибка копии: ${Fe.message}`},!0):(await k(),he(v,{type:"success",text:"Копия сохранена!"},!0))}async function x($){he(v,{type:"loading",text:"Загрузка..."},!0),he(y,$,!0);try{const{data:z,error:ie}=await Rr.storage.from(ur).download($);if(ie)throw ie;let ve=JSON.parse(await z.text());console.log(ur),console.log($),console.log(JSON.stringify(ve.chapters,2)),ve.dialogues&&ve.dialogues.forEach(Ne=>{Ne.options&&Ne.options.forEach(Fe=>{typeof Fe.enabled>"u"&&(Fe.enabled=!0),typeof Fe.visible>"u"&&(Fe.visible=!0),Fe.visibleIf&&!Fe.visibilityCondition&&(Fe.visibilityCondition={type:"has_item",itemId:Fe.visibleIf.hasItem})})}),ve.chapters||(ve.chapters=[{id:"main",title:"Основная история"}],ve.dialogues&&ve.dialogues.forEach(Ne=>{Ne.chapterId||(Ne.chapterId="main")})),he(t,ve,!0),A(t).chapters&&A(t).chapters.length>0&&he(r,A(t).chapters[0].id,!0),A(t).dialogues&&A(t).dialogues.length>0&&he(a,A(t).dialogues[0].id,!0),he(v,{type:"success",text:"Загружено!"},!0)}catch(z){console.error(z),he(v,{type:"error",text:"Ошибка загрузки: "+z.message},!0)}}async function L(){const{data:$}=await Rr.storage.from(ur).list();$&&he(f,$.filter(z=>z.name!==".emptyFolderPlaceholder"&&!z.name.endsWith(".json")),!0)}function F($){A(c)===$?he(c,null):he(c,$,!0)}function K($){confirm("Удалить предмет?")&&(!A(t)||!A(t).items||(A(t).items.splice($,1),he(c,null)))}function Y($){$.visibilityCondition||($.visibilityCondition={type:"always"})}function q($){$.options||($.options=[]);const z={text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}};$.options.push(z),he(l,$.options.length-1),Y(z)}function J($,z){if(A(l)===$)he(l,null);else{he(l,$,!0);const ie=z.options[$];Y(ie)}}function X($){confirm("Удалить диалог "+$+"?")&&A(t)&&(A(t).dialogues=A(t).dialogues.filter(z=>z.id!==$),A(t).dialogues.forEach(z=>{z.nextDialogueId===$&&(z.nextDialogueId=""),z.options&&z.options.forEach(ie=>{ie.nextDialogueId===$&&(ie.nextDialogueId="")})}),A(a)===$&&he(a,null))}let P=ai(()=>A(t)?.dialogues.find($=>$.id===A(a))),M=ai(()=>A(t)?A(t).dialogues.filter($=>$.chapterId===A(r)):[]),oe=ai(()=>A(f).filter($=>$.name.match(/\.(png|jpg|jpeg|webp|gif)$/i))),ce=ai(()=>A(f).filter($=>$.name.endsWith(".riv"))),fe=ai(()=>A(t)?.items||[]);function Z($){const z=A(t)?.dialogues.find(ie=>ie.id===$);z&&(he(r,z.chapterId,!0),he(a,$,!0))}const ge=["always","has_item","stat_greater","flag_true"];var Ue=_v(),et=D(Ue),Ke=W(D(et),2),vt=D(Ke);vt.__change=[Mf,x],Tt(vt,21,()=>A(_),an,($,z)=>{var ie=Lf(),ve=D(ie),Ne={};it(()=>{qe(ve,A(z)),Ne!==(Ne=A(z))&&(ie.value=(ie.__value=A(z))??"")}),ae($,ie)});var ke=W(vt,2);ke.__click=[xf,v,k,x];var cn=W(ke,2);cn.__click=[Tf,t,v,y];var ot=W(cn,2);ot.__click=g;var Ye=W(et,2),lt=D(Ye),Ft=D(lt),je=D(Ft),Ie=W(D(je));Ie.__click=[Pf,t,r];var Bt=W(je,2);Tt(Bt,21,()=>A(t)?.chapters||[],$=>$.id,($,z)=>{var ie=Ff();ie.__click=[$f,r,z];var ve=D(ie);it(()=>{Ii(ie,1,`chapter-item ${A(r)===A(z).id?"active":""}`,"svelte-17amxsj"),qe(ve,A(z).title)}),ae($,ie)});var Le=W(Ft,2),Et=D(Le),tt=D(Et),hn=D(tt),dn=W(tt);dn.__click=[Of,t,r,a];var fn=W(Et,2);Tt(fn,21,()=>A(M),$=>$.id,($,z)=>{var ie=Uf();ie.__click=[Df,a,z];var ve=D(ie),Ne=D(ve),Fe=W(ve,2),He=D(Fe);it(nt=>{Ii(ie,1,`dialogue-item ${A(a)===A(z).id?"active":""}`,"svelte-17amxsj"),qe(Ne,A(z).id),qe(He,`${nt??""}...`)},[()=>A(z).text.substring(0,25)]),ae($,ie)});var Un=W(Le,2),At=D(Un);{var Wt=$=>{var z=Nf(),ie=D(z);it(()=>{Ii(z,1,`alert ${A(v).type??""}`,"svelte-17amxsj"),qe(ie,A(v).text)}),ae($,z)};Ge(At,$=>{A(v).text&&$(Wt)})}var vn=W(lt,2),Qn=D(vn),Vt=D(Qn);Vt.__click=[Bf,E];var gr=D(Vt),Pt=D(gr),wi=W(gr,2),Ur=D(wi),bi=W(Vt,2);{var An=$=>{var z=Gf(),ie=D(z);{var ve=He=>{var nt=Ln(),kt=Qt(nt);Tt(kt,19,()=>A(t).items,jt=>jt.id,(jt,We,pt)=>{var ue=Hf(),Se=D(ue),Rt=D(Se),_r=D(Rt),Zn=D(_r),Nr=W(_r,2),pn=D(Nr),mr=W(Rt,2),te=D(mr),Nn=W(Se,2),qt=D(Nn);qt.__click=()=>F(A(pt));var Br=W(qt,2);Br.__click=()=>K(A(pt));var Wr=W(Nn,2);{var Bn=Wn=>{var Vn=qf(),er=D(Vn),tr=D(er),Ei=W(D(tr),2),Dt=W(tr,2),Vr=W(D(Dt),2),qr=W(Dt,2),yr=W(D(qr),2),wr=W(qr,2),we=W(D(wr),2),se=D(we),me=W(se,2);me.__change=[Wf,We];var st=D(me);st.value=st.__value="";var Be=W(st);Tt(Be,17,()=>A(f).filter(ut=>ut.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),an,(ut,_n)=>{var Je=Vf(),tn=D(Je),nn={};it(()=>{qe(tn,A(_n).name),nn!==(nn=A(_n).name)&&(Je.value=(Je.__value=A(_n).name)??"")}),ae(ut,Je)});var Ht=W(wr,2),kn=W(D(Ht),2),gn=D(kn);gn.value=gn.__value="tool";var zt=W(gn);zt.value=zt.__value="key";var en=W(zt);en.value=en.__value="consumable";var Gt=W(en);Gt.value=Gt.__value="quest";var jn=W(Gt);jn.value=jn.__value="misc",Pn(Ei,()=>A(We).id,ut=>A(We).id=ut),Pn(Vr,()=>A(We).name,ut=>A(We).name=ut),Pn(yr,()=>A(We).description,ut=>A(We).description=ut),Pn(se,()=>A(We).icon,ut=>A(We).icon=ut),sr(kn,()=>A(We).type,ut=>A(We).type=ut),ae(Wn,Vn)};Ge(Wr,Wn=>{A(c)===A(pt)&&Wn(Bn)})}it(()=>{Ii(ue,1,`item-row ${A(c)===A(pt)?"editing":""}`,"svelte-17amxsj"),qe(Zn,A(We).id),qe(pn,A(We).name),qe(te,A(We).description)}),ae(jt,ue)}),ae(He,nt)},Ne=He=>{var nt=zf();ae(He,nt)};Ge(ie,He=>{A(t)?.items?He(ve):He(Ne,!1)})}var Fe=W(ie,2);Fe.__click=[Rf,t,c],ae($,z)};Ge(bi,$=>{A(E)&&$(An)})}var p=W(Qn,2);{var o=$=>{var z=fv(),ie=D(z),ve=W(D(ie)),Ne=W(ie,2),Fe=W(D(Ne)),He=W(Ne,2),nt=W(D(He),2),kt=W(D(nt),2),jt=D(kt),We=D(jt);We.value=We.__value="";var pt=W(We);Tt(pt,17,()=>A(oe),an,(we,se)=>{var me=Kf(),st=D(me),Be={};it(()=>{qe(st,A(se).name),Be!==(Be=A(se).name)&&(me.value=(me.__value=A(se).name)??"")}),ae(we,me)});var ue=W(pt);Tt(ue,17,()=>A(ce),an,(we,se)=>{var me=Yf(),st=D(me),Be={};it(()=>{qe(st,`${A(se).name??""} (Rive)`),Be!==(Be=A(se).name)&&(me.value=(me.__value=A(se).name)??"")}),ae(we,me)});var Se=W(jt,2),Rt=W(D(Se));Rt.__change=[If,v,L];var _r=W(nt,2),Zn=W(D(_r),2),Nr=D(Zn),pn=D(Nr);pn.value=pn.__value="";var mr=W(pn);Tt(mr,17,()=>A(oe),an,(we,se)=>{var me=Jf(),st=D(me),Be={};it(()=>{qe(st,A(se).name),Be!==(Be=A(se).name)&&(me.value=(me.__value=A(se).name)??"")}),ae(we,me)});var te=W(mr);Tt(te,17,()=>A(ce),an,(we,se)=>{var me=Xf(),st=D(me),Be={};it(()=>{qe(st,`${A(se).name??""} (Rive)`),Be!==(Be=A(se).name)&&(me.value=(me.__value=A(se).name)??"")}),ae(we,me)});var Nn=W(He,2),qt=D(Nn),Br=W(D(qt));Br.__click=[Qf,q,P];var Wr=W(qt,2);Tt(Wr,17,()=>A(P).options||[],an,(we,se,me)=>{var st=av(),Be=D(st);Be.__click=()=>J(me,A(P));var Ht=D(Be),kn=D(Ht);{var gn=Je=>{var tn=Qs("👁️‍🗨️");ae(Je,tn)},zt=Je=>{var tn=Ln(),nn=Qt(tn);{var Hr=Ot=>{var de=Qs("🔒");ae(Ot,de)},wt=Ot=>{var de=Qs("✅");ae(Ot,de)};Ge(nn,Ot=>{A(se).enabled?Ot(wt,!1):Ot(Hr)},!0)}ae(Je,tn)};Ge(kn,Je=>{A(se).visible?Je(zt,!1):Je(gn)})}var en=W(Ht,2),Gt=D(en),jn=W(en,2);jn.__click=()=>A(P).options.splice(me,1);var ut=W(Be,2);{var _n=Je=>{var tn=sv(),nn=D(tn),Hr=W(D(nn)),wt=W(nn,2),Ot=D(wt),de=W(D(Ot),2),Mt=D(de);Mt.value=Mt.__value="";var Kt=W(Mt);Tt(Kt,17,()=>A(t).dialogues,an,(Ve,ct)=>{var at=Zf(),St=D(at),Ct={};it(rn=>{qe(St,`${A(ct).id??""}: ${rn??""}...`),Ct!==(Ct=A(ct).id)&&(at.value=(at.__value=A(ct).id)??"")},[()=>A(ct).text.substring(0,30)]),ae(Ve,at)});var Ai=W(wt,2),ki=D(Ai),Ji=D(ki),rt=D(Ji),br=W(ki,2),ji=D(br),Er=D(ji),mn=W(Ai,2),Si=D(mn),Sn=D(Si),Ci=W(D(Sn),2);Tt(Ci,21,()=>ge,an,(Ve,ct)=>{var at=ev(),St=D(at),Ct={};it(()=>{qe(St,A(ct)),Ct!==(Ct=A(ct))&&(at.value=(at.__value=A(ct))??"")}),ae(Ve,at)});var nr=W(Sn,2);{var zr=Ve=>{var ct=nv(),at=W(D(ct),2),St=D(at);St.value=St.__value="";var Ct=W(St);Tt(Ct,17,()=>A(fe),an,(rn,Yt)=>{var Cn=tv(),rr=D(Cn),Ar={};it(()=>{qe(rr,A(Yt).name),Ar!==(Ar=A(Yt).id)&&(Cn.value=(Cn.__value=A(Yt).id)??"")}),ae(rn,Cn)}),sr(at,()=>A(se).visibilityCondition.itemId,rn=>A(se).visibilityCondition.itemId=rn),ae(Ve,ct)};Ge(nr,Ve=>{A(se).visibilityCondition.type==="has_item"&&Ve(zr)})}var Gr=W(nr,2);{var Xi=Ve=>{var ct=rv(),at=Qt(ct),St=W(D(at),2),Ct=W(at,2),rn=W(D(Ct),2);Pn(St,()=>A(se).visibilityCondition.statName,Yt=>A(se).visibilityCondition.statName=Yt),Pn(rn,()=>A(se).visibilityCondition.statValue,Yt=>A(se).visibilityCondition.statValue=Yt),ae(Ve,ct)};Ge(Gr,Ve=>{A(se).visibilityCondition.type==="stat_greater"&&Ve(Xi)})}var Qi=W(Gr,2);{var Zi=Ve=>{var ct=iv(),at=W(D(ct),2);Pn(at,()=>A(se).visibilityCondition.flagName,St=>A(se).visibilityCondition.flagName=St),ae(Ve,ct)};Ge(Qi,Ve=>{A(se).visibilityCondition.type==="flag_true"&&Ve(Zi)})}Pn(Hr,()=>A(se).text,Ve=>A(se).text=Ve),sr(de,()=>A(se).nextDialogueId,Ve=>A(se).nextDialogueId=Ve),Oo(rt,()=>A(se).enabled,Ve=>A(se).enabled=Ve),Oo(Er,()=>A(se).visible,Ve=>A(se).visible=Ve),sr(Ci,()=>A(se).visibilityCondition.type,Ve=>A(se).visibilityCondition.type=Ve),ae(Je,tn)};Ge(ut,Je=>{A(l)===me&&Je(_n)})}it(()=>{Ii(st,1,`option-card ${A(l)===me?"editing":""}`,"svelte-17amxsj"),qe(Gt,`#${me+1} ${A(se).text??""}`)}),ae(we,st)});var Bn=W(Nn,2),Wn=W(D(Bn),2),Vn=D(Wn);Vn.value=Vn.__value="";var er=W(Vn);Tt(er,17,()=>A(t).dialogues,an,(we,se)=>{var me=ov(),st=D(me),Be={};it(Ht=>{qe(st,`${A(se).id??""}: ${Ht??""}...`),Be!==(Be=A(se).id)&&(me.value=(me.__value=A(se).id)??"")},[()=>A(se).text.substring(0,30)]),ae(we,me)});var tr=W(Bn,2),Ei=W(D(tr),2),Dt=W(D(Ei),2);{var Vr=we=>{var se=uv(),me=W(D(se),2),st=D(me),Be=W(me,2);Be.__click=[lv,Z,P],it(()=>qe(st,A(P).nextDialogueId)),ae(we,se)};Ge(Dt,we=>{A(P).nextDialogueId&&we(Vr)})}var qr=W(Dt,2);Tt(qr,17,()=>A(P).options||[],an,(we,se)=>{var me=Ln(),st=Qt(me);{var Be=Ht=>{var kn=hv(),gn=W(D(kn),2),zt=D(gn),en=W(gn,2);en.__click=[cv,Z,se],it(()=>qe(zt,A(se).nextDialogueId)),ae(Ht,kn)};Ge(st,Ht=>{A(se).nextDialogueId&&Ht(Be)})}ae(we,me)});var yr=W(tr,2),wr=D(yr);wr.__click=[dv,X,P],Pn(ve,()=>A(P).id,we=>A(P).id=we),Pn(Fe,()=>A(P).text,we=>A(P).text=we),sr(jt,()=>A(P).backgroundImage,we=>A(P).backgroundImage=we),sr(Nr,()=>A(P).characterImage,we=>A(P).characterImage=we),sr(Wn,()=>A(P).nextDialogueId,we=>A(P).nextDialogueId=we),ae($,z)},h=$=>{var z=vv();ae($,z)};Ge(p,$=>{A(P)?$(o):$(h,!1)})}var w=W(vn,2),C=D(w),O=W(D(C),2);O.__click=[pv,l];var U=W(C,2),le=D(U);{var pe=$=>{Yl($,{get dialogue(){return A(P)},index:0})},re=$=>{var z=gv();ae($,z)};Ge(le,$=>{A(P)?$(pe):$(re,!1)})}it(()=>{qe(hn,`Сцены (${A(M).length??""})`),dn.disabled=!A(r),qe(Pt,`📦 Предметы (${(A(t)?.items?.length||0)??""})`),qe(Ur,A(E)?"▼":"▶")}),sr(vt,()=>A(y),$=>he(y,$)),ae(n,Ue),zi()}Hl(["change","click"]);var yv=_e('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),wv=_e('<button style="position:fixed; bottom:10px; right:10px; z-index:9999;">Редактор</button> <!>',1);function bv(n){let e=Ze(!1);var t=Ln(),r=Qt(t);{var a=c=>{var f=yv(),v=Qt(f),_=W(v,2);mv(_,{}),xo("click",v,()=>he(e,!1)),ae(c,f)},l=c=>{var f=wv(),v=Qt(f),_=W(v,2);Eh(_,{}),xo("click",v,()=>he(e,!0)),ae(c,f)};Ge(r,c=>{A(e)?c(a):c(l,!1)})}ae(n,t)}Dc(bv,{target:document.getElementById("app")});
