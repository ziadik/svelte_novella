(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=t(o);fetch(o.href,u)}})();const Ya=!1;var zs=Array.isArray,Cl=Array.prototype.indexOf,Gs=Array.from,Ss=Object.defineProperty,Dr=Object.getOwnPropertyDescriptor,Ja=Object.getOwnPropertyDescriptors,Tl=Object.prototype,Pl=Array.prototype,Ks=Object.getPrototypeOf,sa=Object.isExtensible;function Il(n){return n()}function Ii(n){for(var e=0;e<n.length;e++)n[e]()}function Rl(){var n,e,t=new Promise((r,o)=>{n=r,e=o});return{promise:t,resolve:n,reject:e}}const bt=2,Ys=4,Ni=8,_r=16,dn=32,Vn=64,Xa=128,Pt=256,Ri=512,ut=1024,It=2048,Sn=4096,Ut=8192,yr=16384,Js=32768,Xs=65536,oa=1<<17,Ol=1<<18,Gr=1<<19,Qa=1<<20,Cs=1<<21,Qs=1<<22,Nn=1<<23,hr=Symbol("$state"),Zs=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function jl(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function xl(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ml(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ll(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Fl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $l(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Dl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ul(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Nl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Bl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Bi=1,Wi=2,Za=4,Wl=8,Vl=16,ql=1,Hl=2,nt=Symbol(),zl="http://www.w3.org/1999/xhtml";let Gl=!1;function eu(n){return n===this.v}function tu(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Kl(n,e){return n!==e}function nu(n){return!tu(n,this.v)}let Kr=!1,Yl=!1;function Jl(){Kr=!0}let Ke=null;function Oi(n){Ke=n}function Yr(n,e=!1,t){Ke={p:Ke,c:null,e:null,s:n,x:null,l:Kr&&!e?{s:null,u:null,$:[]}:null}}function Jr(n){var e=Ke,t=e.e;if(t!==null){e.e=null;for(var r of t)mu(r)}return Ke=e.p,{}}function wr(){return!Kr||Ke!==null&&Ke.l===null}const Xl=new WeakMap;function Ql(n){var e=Te;if(e===null)return Ce.f|=Nn,n;if((e.f&Js)===0){if((e.f&Xa)===0)throw!e.parent&&n instanceof Error&&ru(n),n;e.b.error(n)}else eo(n,e)}function eo(n,e){for(;e!==null;){if((e.f&Xa)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&ru(n),n}function ru(n){const e=Xl.get(n);e&&(Ss(n,"message",{value:e.message}),Ss(n,"stack",{value:e.stack}))}let Wr=[],Ts=[];function iu(){var n=Wr;Wr=[],Ii(n)}function Zl(){var n=Ts;Ts=[],Ii(n)}function to(n){Wr.length===0&&queueMicrotask(iu),Wr.push(n)}function ec(){Wr.length>0&&iu(),Ts.length>0&&Zl()}function tc(){for(var n=Te.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&jl(),n}function Vi(n){var e=bt|It,t=Ce!==null&&(Ce.f&bt)!==0?Ce:null;return Te===null||t!==null&&(t.f&Pt)!==0?e|=Pt:Te.f|=Gr,{ctx:Ke,deps:null,effects:null,equals:eu,f:e,fn:n,reactions:null,rv:0,v:nt,wv:0,parent:t??Te,ac:null}}function nc(n,e){let t=Te;t===null&&Ml();var r=t.b,o=void 0,u=Vr(nt),c=null,f=!Ce;return _c(()=>{try{var v=n();c&&Promise.resolve(v).catch(()=>{})}catch(g){v=Promise.reject(g)}var m=()=>v;o=c?.then(m,m)??Promise.resolve(v),c=o;var y=Ue,E=r.pending;f&&(r.update_pending_count(1),E||y.increment());const A=(g,T=void 0)=>{c=null,E||y.activate(),T?T!==Zs&&(u.f|=Nn,qr(u,T)):((u.f&Nn)!==0&&(u.f^=Nn),qr(u,g)),f&&(r.update_pending_count(-1),E||y.decrement()),lu()};if(o.then(A,g=>A(null,g||"unknown")),y)return()=>{queueMicrotask(()=>y.neuter())}}),new Promise(v=>{function m(y){function E(){y===o?v(u):m(o)}y.then(E,E)}m(o)})}function su(n){const e=Vi(n);return ku(e),e}function ou(n){const e=Vi(n);return e.equals=nu,e}function au(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)hn(e[t])}}function rc(n){for(var e=n.parent;e!==null;){if((e.f&bt)===0)return e;e=e.parent}return null}function no(n){var e,t=Te;kn(rc(n));try{au(n),e=Pu(n)}finally{kn(t)}return e}function uu(n){var e=no(n);if(n.equals(e)||(n.v=e,n.wv=Cu()),!Er){var t=(bn||(n.f&Pt)!==0)&&n.deps!==null?Sn:ut;gt(n,t)}}function ic(n,e,t){const r=wr()?Vi:ou;if(e.length===0){t(n.map(r));return}var o=Ue,u=Te,c=sc(),f=tc();Promise.all(e.map(v=>nc(v))).then(v=>{o?.activate(),c();try{t([...n.map(r),...v])}catch(m){(u.f&yr)===0&&eo(m,u)}o?.deactivate(),lu()}).catch(v=>{f.error(v)})}function sc(){var n=Te,e=Ce,t=Ke,r=Ue;return function(){kn(n),Xt(e),Oi(t),r?.activate()}}function lu(){kn(null),Xt(null),Oi(null)}const fs=new Set;let Ue=null,Ci=null,aa=new Set,ji=[];function cu(){const n=ji.shift();ji.length>0&&queueMicrotask(cu),n()}let Wn=[],qi=null,Ps=!1,Ti=!1;class vr{current=new Map;#n=new Map;#t=new Set;#e=0;#r=null;#i=!1;#o=[];#u=[];#a=[];#s=[];#l=[];#h=[];#d=[];skipped_effects=new Set;process(e){Wn=[],Ci=null;for(const o of e)this.#v(o);if(this.#o.length===0&&this.#e===0){this.#f();var t=this.#a,r=this.#s;this.#a=[],this.#s=[],this.#l=[],Ci=Ue,Ue=null,ua(t),ua(r),Ue===null?Ue=this:fs.delete(this),this.#r?.resolve()}else this.#c(this.#a),this.#c(this.#s),this.#c(this.#l);for(const o of this.#o)fr(o);for(const o of this.#u)fr(o);this.#o=[],this.#u=[]}#v(e){e.f^=ut;for(var t=e.first;t!==null;){var r=t.f,o=(r&(dn|Vn))!==0,u=o&&(r&ut)!==0,c=u||(r&Ut)!==0||this.skipped_effects.has(t);if(!c&&t.fn!==null){if(o)t.f^=ut;else if((r&Ys)!==0)this.#s.push(t);else if((r&ut)===0)if((r&Qs)!==0){var f=t.b?.pending?this.#u:this.#o;f.push(t)}else Ki(t)&&((t.f&_r)!==0&&this.#l.push(t),fr(t));var v=t.first;if(v!==null){t=v;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&It)!==0?this.#h:this.#d).push(t),gt(t,ut);e.length=0}capture(e,t){this.#n.has(e)||this.#n.set(e,t),this.current.set(e,e.v)}activate(){Ue=this}deactivate(){Ue=null,Ci=null;for(const e of aa)if(aa.delete(e),e(),Ue!==null)break}neuter(){this.#i=!0}flush(){Wn.length>0?hu():this.#f(),Ue===this&&(this.#e===0&&fs.delete(this),this.deactivate())}#f(){if(!this.#i)for(const e of this.#t)e();this.#t.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#h)gt(e,It),pr(e);for(const e of this.#d)gt(e,Sn),pr(e);this.#a=[],this.#s=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#r??=Rl()).promise}static ensure(){if(Ue===null){const e=Ue=new vr;fs.add(Ue),Ti||vr.enqueue(()=>{Ue===e&&e.flush()})}return Ue}static enqueue(e){ji.length===0&&queueMicrotask(cu),ji.unshift(e)}}function oc(n){var e=Ti;Ti=!0;try{for(var t;;){if(ec(),Wn.length===0&&(Ue?.flush(),Wn.length===0))return qi=null,t;hu()}}finally{Ti=e}}function hu(){var n=dr;Ps=!0;try{var e=0;for(ha(!0);Wn.length>0;){var t=vr.ensure();if(e++>1e3){var r,o;ac()}t.process(Wn),An.clear()}}finally{Ps=!1,ha(n),qi=null}}function ac(){try{Dl()}catch(n){eo(n,qi)}}let $n=null;function ua(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(yr|Ut))===0&&Ki(r)&&($n=[],fr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?bu(r):r.fn=null),$n?.length>0)){An.clear();for(const o of $n)fr(o);$n=[]}}$n=null}}function pr(n){for(var e=qi=n;e.parent!==null;){e=e.parent;var t=e.f;if(Ps&&e===Te&&(t&_r)!==0)return;if((t&(Vn|dn))!==0){if((t&ut)===0)return;e.f^=ut}}Wn.push(e)}const An=new Map;function Vr(n,e){var t={f:0,v:n,reactions:null,equals:eu,rv:0,wv:0};return t}function Xe(n,e){const t=Vr(n);return ku(t),t}function uc(n,e=!1,t=!0){const r=Vr(n);return e||(r.equals=nu),Kr&&t&&Ke!==null&&Ke.l!==null&&(Ke.l.s??=[]).push(r),r}function Me(n,e,t=!1){Ce!==null&&(!Jt||(Ce.f&oa)!==0)&&wr()&&(Ce.f&(bt|_r|Qs|oa))!==0&&!cn?.includes(n)&&Bl();let r=t?wn(e):e;return qr(n,r)}function qr(n,e){if(!n.equals(e)){var t=n.v;Er?An.set(n,e):An.set(n,t),n.v=e;var r=vr.ensure();r.capture(n,t),(n.f&bt)!==0&&((n.f&It)!==0&&no(n),gt(n,(n.f&Pt)===0?ut:Sn)),n.wv=Cu(),du(n,It),wr()&&Te!==null&&(Te.f&ut)!==0&&(Te.f&(dn|Vn))===0&&(Tt===null?bc([n]):Tt.push(n))}return e}function vs(n){Me(n,n.v+1)}function du(n,e){var t=n.reactions;if(t!==null)for(var r=wr(),o=t.length,u=0;u<o;u++){var c=t[u],f=c.f;if(!(!r&&c===Te)){var v=(f&It)===0;v&&gt(c,e),(f&bt)!==0?du(c,Sn):v&&((f&_r)!==0&&$n!==null&&$n.push(c),pr(c))}}}function wn(n){if(typeof n!="object"||n===null||hr in n)return n;const e=Ks(n);if(e!==Tl&&e!==Pl)return n;var t=new Map,r=zs(n),o=Xe(0),u=Bn,c=f=>{if(Bn===u)return f();var v=Ce,m=Bn;Xt(null),fa(u);var y=f();return Xt(v),fa(m),y};return r&&t.set("length",Xe(n.length)),new Proxy(n,{defineProperty(f,v,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ul();var y=t.get(v);return y===void 0?y=c(()=>{var E=Xe(m.value);return t.set(v,E),E}):Me(y,m.value,!0),!0},deleteProperty(f,v){var m=t.get(v);if(m===void 0){if(v in f){const y=c(()=>Xe(nt));t.set(v,y),vs(o)}}else Me(m,nt),vs(o);return!0},get(f,v,m){if(v===hr)return n;var y=t.get(v),E=v in f;if(y===void 0&&(!E||Dr(f,v)?.writable)&&(y=c(()=>{var g=wn(E?f[v]:nt),T=Xe(g);return T}),t.set(v,y)),y!==void 0){var A=V(y);return A===nt?void 0:A}return Reflect.get(f,v,m)},getOwnPropertyDescriptor(f,v){var m=Reflect.getOwnPropertyDescriptor(f,v);if(m&&"value"in m){var y=t.get(v);y&&(m.value=V(y))}else if(m===void 0){var E=t.get(v),A=E?.v;if(E!==void 0&&A!==nt)return{enumerable:!0,configurable:!0,value:A,writable:!0}}return m},has(f,v){if(v===hr)return!0;var m=t.get(v),y=m!==void 0&&m.v!==nt||Reflect.has(f,v);if(m!==void 0||Te!==null&&(!y||Dr(f,v)?.writable)){m===void 0&&(m=c(()=>{var A=y?wn(f[v]):nt,g=Xe(A);return g}),t.set(v,m));var E=V(m);if(E===nt)return!1}return y},set(f,v,m,y){var E=t.get(v),A=v in f;if(r&&v==="length")for(var g=m;g<E.v;g+=1){var T=t.get(g+"");T!==void 0?Me(T,nt):g in f&&(T=c(()=>Xe(nt)),t.set(g+"",T))}if(E===void 0)(!A||Dr(f,v)?.writable)&&(E=c(()=>Xe(void 0)),Me(E,wn(m)),t.set(v,E));else{A=E.v!==nt;var M=c(()=>wn(m));Me(E,M)}var L=Reflect.getOwnPropertyDescriptor(f,v);if(L?.set&&L.set.call(y,m),!A){if(r&&typeof v=="string"){var q=t.get("length"),H=Number(v);Number.isInteger(H)&&H>=q.v&&Me(q,H+1)}vs(o)}return!0},ownKeys(f){V(o);var v=Reflect.ownKeys(f).filter(E=>{var A=t.get(E);return A===void 0||A.v!==nt});for(var[m,y]of t)y.v!==nt&&!(m in f)&&v.push(m);return v},setPrototypeOf(){Nl()}})}var la,fu,vu,pu;function lc(){if(la===void 0){la=window,fu=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;vu=Dr(e,"firstChild").get,pu=Dr(e,"nextSibling").get,sa(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),sa(t)&&(t.__t=void 0)}}function br(n=""){return document.createTextNode(n)}function xi(n){return vu.call(n)}function Hi(n){return pu.call(n)}function ce(n,e){return xi(n)}function un(n,e){{var t=xi(n);return t instanceof Comment&&t.data===""?Hi(t):t}}function Oe(n,e=1,t=!1){let r=n;for(;e--;)r=Hi(r);return r}function cc(n){n.textContent=""}function ro(){return!1}let ca=!1;function hc(){ca||(ca=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function zi(n){var e=Ce,t=Te;Xt(null),kn(null);try{return n()}finally{Xt(e),kn(t)}}function dc(n,e,t,r=t){n.addEventListener(e,()=>zi(t));const o=n.__on_r;o?n.__on_r=()=>{o(),r(!0)}:n.__on_r=()=>r(!0),hc()}function gu(n){Te===null&&Ce===null&&$l(),Ce!==null&&(Ce.f&Pt)!==0&&Te===null&&Fl(),Er&&Ll()}function fc(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Qt(n,e,t,r=!0){var o=Te;o!==null&&(o.f&Ut)!==0&&(n|=Ut);var u={ctx:Ke,deps:null,nodes_start:null,nodes_end:null,f:n|It,first:null,fn:e,last:null,next:null,parent:o,b:o&&o.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{fr(u),u.f|=Js}catch(v){throw hn(u),v}else e!==null&&pr(u);if(r){var c=u;if(t&&c.deps===null&&c.teardown===null&&c.nodes_start===null&&c.first===c.last&&(c.f&Gr)===0&&(c=c.first),c!==null&&(c.parent=o,o!==null&&fc(c,o),Ce!==null&&(Ce.f&bt)!==0&&(n&Vn)===0)){var f=Ce;(f.effects??=[]).push(c)}}return u}function vc(n){const e=Qt(Ni,null,!1);return gt(e,ut),e.teardown=n,e}function Mi(n){gu();var e=Te.f,t=!Ce&&(e&dn)!==0&&(e&Js)===0;if(t){var r=Ke;(r.e??=[]).push(n)}else return mu(n)}function mu(n){return Qt(Ys|Qa,n,!1)}function pc(n){return gu(),Qt(Ni|Qa,n,!0)}function gc(n){vr.ensure();const e=Qt(Vn|Gr,n,!0);return(t={})=>new Promise(r=>{t.outro?Gi(e,()=>{hn(e),r(void 0)}):(hn(e),r(void 0))})}function mc(n){return Qt(Ys,n,!1)}function _c(n){return Qt(Qs|Gr,n,!0)}function _u(n,e=0){return Qt(Ni|e,n,!0)}function ln(n,e=[],t=[]){ic(e,t,r=>{Qt(Ni,()=>n(...r.map(V)),!0)})}function io(n,e=0){var t=Qt(_r|e,n,!0);return t}function gr(n,e=!0){return Qt(dn|Gr,n,!0,e)}function yu(n){var e=n.teardown;if(e!==null){const t=Er,r=Ce;da(!0),Xt(null);try{e.call(null)}finally{da(t),Xt(r)}}}function wu(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const o=t.ac;o!==null&&zi(()=>{o.abort(Zs)});var r=t.next;(t.f&Vn)!==0?t.parent=null:hn(t,e),t=r}}function yc(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&dn)===0&&hn(e),e=t}}function hn(n,e=!0){var t=!1;(e||(n.f&Ol)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(wc(n.nodes_start,n.nodes_end),t=!0),wu(n,e&&!t),Li(n,0),gt(n,yr);var r=n.transitions;if(r!==null)for(const u of r)u.stop();yu(n);var o=n.parent;o!==null&&o.first!==null&&bu(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function wc(n,e){for(;n!==null;){var t=n===e?null:Hi(n);n.remove(),n=t}}function bu(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Gi(n,e){var t=[];so(n,t,!0),Eu(t,()=>{hn(n),e&&e()})}function Eu(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var o of n)o.out(r)}else e()}function so(n,e,t){if((n.f&Ut)===0){if(n.f^=Ut,n.transitions!==null)for(const c of n.transitions)(c.is_global||t)&&e.push(c);for(var r=n.first;r!==null;){var o=r.next,u=(r.f&Xs)!==0||(r.f&dn)!==0;so(r,e,u?t:!1),r=o}}}function oo(n){Au(n,!0)}function Au(n,e){if((n.f&Ut)!==0){n.f^=Ut,(n.f&ut)===0&&(gt(n,It),pr(n));for(var t=n.first;t!==null;){var r=t.next,o=(t.f&Xs)!==0||(t.f&dn)!==0;Au(t,o?e:!1),t=r}if(n.transitions!==null)for(const u of n.transitions)(u.is_global||e)&&u.in()}}let dr=!1;function ha(n){dr=n}let Er=!1;function da(n){Er=n}let Ce=null,Jt=!1;function Xt(n){Ce=n}let Te=null;function kn(n){Te=n}let cn=null;function ku(n){Ce!==null&&(cn===null?cn=[n]:cn.push(n))}let ht=null,wt=0,Tt=null;function bc(n){Tt=n}let Su=1,Hr=0,Bn=Hr;function fa(n){Bn=n}let bn=!1;function Cu(){return++Su}function Ki(n){var e=n.f;if((e&It)!==0)return!0;if((e&Sn)!==0){var t=n.deps,r=(e&Pt)!==0;if(t!==null){var o,u,c=(e&Ri)!==0,f=r&&Te!==null&&!bn,v=t.length;if((c||f)&&(Te===null||(Te.f&yr)===0)){var m=n,y=m.parent;for(o=0;o<v;o++)u=t[o],(c||!u?.reactions?.includes(m))&&(u.reactions??=[]).push(m);c&&(m.f^=Ri),f&&y!==null&&(y.f&Pt)===0&&(m.f^=Pt)}for(o=0;o<v;o++)if(u=t[o],Ki(u)&&uu(u),u.wv>n.wv)return!0}(!r||Te!==null&&!bn)&&gt(n,ut)}return!1}function Tu(n,e,t=!0){var r=n.reactions;if(r!==null&&!cn?.includes(n))for(var o=0;o<r.length;o++){var u=r[o];(u.f&bt)!==0?Tu(u,e,!1):e===u&&(t?gt(u,It):(u.f&ut)!==0&&gt(u,Sn),pr(u))}}function Pu(n){var e=ht,t=wt,r=Tt,o=Ce,u=bn,c=cn,f=Ke,v=Jt,m=Bn,y=n.f;ht=null,wt=0,Tt=null,bn=(y&Pt)!==0&&(Jt||!dr||Ce===null),Ce=(y&(dn|Vn))===0?n:null,cn=null,Oi(n.ctx),Jt=!1,Bn=++Hr,n.ac!==null&&(zi(()=>{n.ac.abort(Zs)}),n.ac=null);try{n.f|=Cs;var E=n.fn,A=E(),g=n.deps;if(ht!==null){var T;if(Li(n,wt),g!==null&&wt>0)for(g.length=wt+ht.length,T=0;T<ht.length;T++)g[wt+T]=ht[T];else n.deps=g=ht;if(!bn||(y&bt)!==0&&n.reactions!==null)for(T=wt;T<g.length;T++)(g[T].reactions??=[]).push(n)}else g!==null&&wt<g.length&&(Li(n,wt),g.length=wt);if(wr()&&Tt!==null&&!Jt&&g!==null&&(n.f&(bt|Sn|It))===0)for(T=0;T<Tt.length;T++)Tu(Tt[T],n);return o!==null&&o!==n&&(Hr++,Tt!==null&&(r===null?r=Tt:r.push(...Tt))),(n.f&Nn)!==0&&(n.f^=Nn),A}catch(M){return Ql(M)}finally{n.f^=Cs,ht=e,wt=t,Tt=r,Ce=o,bn=u,cn=c,Oi(f),Jt=v,Bn=m}}function Ec(n,e){let t=e.reactions;if(t!==null){var r=Cl.call(t,n);if(r!==-1){var o=t.length-1;o===0?t=e.reactions=null:(t[r]=t[o],t.pop())}}t===null&&(e.f&bt)!==0&&(ht===null||!ht.includes(e))&&(gt(e,Sn),(e.f&(Pt|Ri))===0&&(e.f^=Ri),au(e),Li(e,0))}function Li(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Ec(n,t[r])}function fr(n){var e=n.f;if((e&yr)===0){gt(n,ut);var t=Te,r=dr;Te=n,dr=!0;try{(e&_r)!==0?yc(n):wu(n),yu(n);var o=Pu(n);n.teardown=typeof o=="function"?o:null,n.wv=Su;var u;Ya&&Yl&&(n.f&It)!==0&&n.deps}finally{dr=r,Te=t}}}async function Ac(){await Promise.resolve(),oc()}function V(n){var e=n.f,t=(e&bt)!==0;if(Ce!==null&&!Jt){var r=Te!==null&&(Te.f&yr)!==0;if(!r&&!cn?.includes(n)){var o=Ce.deps;if((Ce.f&Cs)!==0)n.rv<Hr&&(n.rv=Hr,ht===null&&o!==null&&o[wt]===n?wt++:ht===null?ht=[n]:(!bn||!ht.includes(n))&&ht.push(n));else{(Ce.deps??=[]).push(n);var u=n.reactions;u===null?n.reactions=[Ce]:u.includes(Ce)||u.push(Ce)}}}else if(t&&n.deps===null&&n.effects===null){var c=n,f=c.parent;f!==null&&(f.f&Pt)===0&&(c.f^=Pt)}if(Er){if(An.has(n))return An.get(n);if(t){c=n;var v=c.v;return((c.f&ut)===0&&c.reactions!==null||Iu(c))&&(v=no(c)),An.set(c,v),v}}else t&&(c=n,Ki(c)&&uu(c));if((n.f&Nn)!==0)throw n.v;return n.v}function Iu(n){if(n.v===nt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(An.has(e)||(e.f&bt)!==0&&Iu(e))return!0;return!1}function Yi(n){var e=Jt;try{return Jt=!0,n()}finally{Jt=e}}const kc=-7169;function gt(n,e){n.f=n.f&kc|e}function Sc(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(hr in n)Is(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&hr in t&&Is(t)}}}function Is(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Is(n[r],e)}catch{}const t=Ks(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Ja(t);for(let o in r){const u=r[o].get;if(u)try{u.call(n)}catch{}}}}}const Cc=["touchstart","touchmove"];function Tc(n){return Cc.includes(n)}const Ru=new Set,Rs=new Set;function Pc(n,e,t,r={}){function o(u){if(r.capture||Fr.call(e,u),!u.cancelBubble)return zi(()=>t?.call(this,u))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?to(()=>{e.addEventListener(n,o,r)}):e.addEventListener(n,o,r),o}function va(n,e,t,r,o){var u={capture:r,passive:o},c=Pc(n,e,t,u);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&vc(()=>{e.removeEventListener(n,c,u)})}function Ou(n){for(var e=0;e<n.length;e++)Ru.add(n[e]);for(var t of Rs)t(n)}let pa=null;function Fr(n){var e=this,t=e.ownerDocument,r=n.type,o=n.composedPath?.()||[],u=o[0]||n.target;pa=n;var c=0,f=pa===n&&n.__root;if(f){var v=o.indexOf(f);if(v!==-1&&(e===document||e===window)){n.__root=e;return}var m=o.indexOf(e);if(m===-1)return;v<=m&&(c=v)}if(u=o[c]||n.target,u!==e){Ss(n,"currentTarget",{configurable:!0,get(){return u||t}});var y=Ce,E=Te;Xt(null),kn(null);try{for(var A,g=[];u!==null;){var T=u.assignedSlot||u.parentNode||u.host||null;try{var M=u["__"+r];if(M!=null&&(!u.disabled||n.target===u))if(zs(M)){var[L,...q]=M;L.apply(u,[n,...q])}else M.call(u,n)}catch(H){A?g.push(H):A=H}if(n.cancelBubble||T===e||T===null)break;u=T}if(A){for(let H of g)queueMicrotask(()=>{throw H});throw A}}finally{n.__root=e,delete n.currentTarget,Xt(y),kn(E)}}}function Ic(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Os(n,e){var t=Te;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function Ne(n,e){var t=(e&ql)!==0,r=(e&Hl)!==0,o,u=!n.startsWith("<!>");return()=>{o===void 0&&(o=Ic(u?n:"<!>"+n),t||(o=xi(o)));var c=r||fu?document.importNode(o,!0):o.cloneNode(!0);if(t){var f=xi(c),v=c.lastChild;Os(f,v)}else Os(c,c);return c}}function Dn(){var n=document.createDocumentFragment(),e=document.createComment(""),t=br();return n.append(e,t),Os(e,t),n}function Pe(n,e){n!==null&&n.before(e)}function En(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Rc(n,e){return Oc(n,e)}const Xn=new Map;function Oc(n,{target:e,anchor:t,props:r={},events:o,context:u,intro:c=!0}){lc();var f=new Set,v=E=>{for(var A=0;A<E.length;A++){var g=E[A];if(!f.has(g)){f.add(g);var T=Tc(g);e.addEventListener(g,Fr,{passive:T});var M=Xn.get(g);M===void 0?(document.addEventListener(g,Fr,{passive:T}),Xn.set(g,1)):Xn.set(g,M+1)}}};v(Gs(Ru)),Rs.add(v);var m=void 0,y=gc(()=>{var E=t??e.appendChild(br());return gr(()=>{if(u){Yr({});var A=Ke;A.c=u}o&&(r.$$events=o),m=n(E,r)||{},u&&Jr()}),()=>{for(var A of f){e.removeEventListener(A,Fr);var g=Xn.get(A);--g===0?(document.removeEventListener(A,Fr),Xn.delete(A)):Xn.set(A,g)}Rs.delete(v),E!==t&&E.parentNode?.removeChild(E)}});return jc.set(m,y),m}let jc=new WeakMap;function at(n,e,t=!1){var r=n,o=null,u=null,c=nt,f=t?Xs:0,v=!1;const m=(g,T=!0)=>{v=!0,A(T,g)};var y=null;function E(){y!==null&&(y.lastChild.remove(),r.before(y),y=null);var g=c?o:u,T=c?u:o;g&&oo(g),T&&Gi(T,()=>{c?u=null:o=null})}const A=(g,T)=>{if(c!==(c=g)){var M=ro(),L=r;if(M&&(y=document.createDocumentFragment(),y.append(L=br())),c?o??=T&&gr(()=>T(L)):u??=T&&gr(()=>T(L)),M){var q=Ue,H=c?o:u,N=c?u:o;H&&q.skipped_effects.delete(H),N&&q.skipped_effects.add(N),q.add_callback(E)}else E()}};io(()=>{v=!1,e(m),v||A(null,null)},f)}function ga(n,e,t){var r=n,o=nt,u,c,f=null,v=wr()?Kl:tu;function m(){u&&Gi(u),f!==null&&(f.lastChild.remove(),r.before(f),f=null),u=c}io(()=>{if(v(o,o=e())){var y=r,E=ro();E&&(f=document.createDocumentFragment(),f.append(y=br())),c=gr(()=>t(y)),E?Ue.add_callback(m):m()}})}function xc(n,e){return e}function Mc(n,e,t){for(var r=n.items,o=[],u=e.length,c=0;c<u;c++)so(e[c].e,o,!0);var f=u>0&&o.length===0&&t!==null;if(f){var v=t.parentNode;cc(v),v.append(t),r.clear(),Kt(n,e[0].prev,e[u-1].next)}Eu(o,()=>{for(var m=0;m<u;m++){var y=e[m];f||(r.delete(y.k),Kt(n,y.prev,y.next)),hn(y.e,!f)}})}function js(n,e,t,r,o,u=null){var c=n,f={flags:e,items:new Map,first:null},v=(e&Za)!==0;if(v){var m=n;c=m.appendChild(br())}var y=null,E=!1,A=new Map,g=ou(()=>{var q=t();return zs(q)?q:q==null?[]:Gs(q)}),T,M;function L(){Lc(M,T,f,A,c,o,e,r,t),u!==null&&(T.length===0?y?oo(y):y=gr(()=>u(c)):y!==null&&Gi(y,()=>{y=null}))}io(()=>{M??=Te,T=V(g);var q=T.length;if(!(E&&q===0)){E=q===0;var H,N,z,G;if(ro()){var R=new Set,x=Ue;for(N=0;N<q;N+=1){z=T[N],G=r(z,N);var ne=f.items.get(G)??A.get(G);ne?(e&(Bi|Wi))!==0&&ju(ne,z,N,e):(H=xu(null,f,null,null,z,G,N,o,e,t,!0),A.set(G,H)),R.add(G)}for(const[re,ie]of f.items)R.has(re)||x.skipped_effects.add(ie.e);x.add_callback(L)}else L();V(g)}})}function Lc(n,e,t,r,o,u,c,f,v){var m=(c&Wl)!==0,y=(c&(Bi|Wi))!==0,E=e.length,A=t.items,g=t.first,T=g,M,L=null,q,H=[],N=[],z,G,R,x;if(m)for(x=0;x<E;x+=1)z=e[x],G=f(z,x),R=A.get(G),R!==void 0&&(R.a?.measure(),(q??=new Set).add(R));for(x=0;x<E;x+=1){if(z=e[x],G=f(z,x),R=A.get(G),R===void 0){var ne=r.get(G);if(ne!==void 0){r.delete(G),A.set(G,ne);var re=L?L.next:T;Kt(t,L,ne),Kt(t,ne,re),ps(ne,re,o),L=ne}else{var ie=T?T.e.nodes_start:o;L=xu(ie,t,L,L===null?t.first:L.next,z,G,x,u,c,v)}A.set(G,L),H=[],N=[],T=L.next;continue}if(y&&ju(R,z,x,c),(R.e.f&Ut)!==0&&(oo(R.e),m&&(R.a?.unfix(),(q??=new Set).delete(R))),R!==T){if(M!==void 0&&M.has(R)){if(H.length<N.length){var Y=N[0],ue;L=Y.prev;var xe=H[0],Ve=H[H.length-1];for(ue=0;ue<H.length;ue+=1)ps(H[ue],Y,o);for(ue=0;ue<N.length;ue+=1)M.delete(N[ue]);Kt(t,xe.prev,Ve.next),Kt(t,L,xe),Kt(t,Ve,Y),T=Y,L=Ve,x-=1,H=[],N=[]}else M.delete(R),ps(R,T,o),Kt(t,R.prev,R.next),Kt(t,R,L===null?t.first:L.next),Kt(t,L,R),L=R;continue}for(H=[],N=[];T!==null&&T.k!==G;)(T.e.f&Ut)===0&&(M??=new Set).add(T),N.push(T),T=T.next;if(T===null)continue;R=T}H.push(R),L=R,T=R.next}if(T!==null||M!==void 0){for(var $e=M===void 0?[]:Gs(M);T!==null;)(T.e.f&Ut)===0&&$e.push(T),T=T.next;var lt=$e.length;if(lt>0){var _e=(c&Za)!==0&&E===0?o:null;if(m){for(x=0;x<lt;x+=1)$e[x].a?.measure();for(x=0;x<lt;x+=1)$e[x].a?.fix()}Mc(t,$e,_e)}}m&&to(()=>{if(q!==void 0)for(R of q)R.a?.apply()}),n.first=t.first&&t.first.e,n.last=L&&L.e;for(var Nt of r.values())hn(Nt.e);r.clear()}function ju(n,e,t,r){(r&Bi)!==0&&qr(n.v,e),(r&Wi)!==0?qr(n.i,t):n.i=t}function xu(n,e,t,r,o,u,c,f,v,m,y){var E=(v&Bi)!==0,A=(v&Vl)===0,g=E?A?uc(o,!1,!1):Vr(o):o,T=(v&Wi)===0?c:Vr(c),M={i:T,v:g,k:u,a:null,e:null,prev:t,next:r};try{if(n===null){var L=document.createDocumentFragment();L.append(n=br())}return M.e=gr(()=>f(n,g,T,m),Gl),M.e.prev=t&&t.e,M.e.next=r&&r.e,t===null?y||(e.first=M):(t.next=M,t.e.next=M.e),r!==null&&(r.prev=M,r.e.prev=M.e),M}finally{}}function ps(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,o=e?e.e.nodes_start:t,u=n.e.nodes_start;u!==null&&u!==r;){var c=Hi(u);o.before(u),u=c}}function Kt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Fc(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function ma(n,e,t,r,o,u){var c=n.__className;if(c!==t||c===void 0){var f=Fc(t,r);f==null?n.removeAttribute("class"):n.className=f,n.__className=t}return u}const $c=Symbol("is custom element"),Dc=Symbol("is html");function _a(n,e,t,r){var o=Uc(n);o[e]!==(o[e]=t)&&(t==null?n.removeAttribute(e):typeof t!="string"&&Nc(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Uc(n){return n.__attributes??={[$c]:n.nodeName.includes("-"),[Dc]:n.namespaceURI===zl}}var ya=new Map;function Nc(n){var e=n.getAttribute("is")||n.nodeName,t=ya.get(e);if(t)return t;ya.set(e,t=[]);for(var r,o=n,u=Element.prototype;u!==o;){r=Ja(o);for(var c in r)r[c].set&&t.push(c);o=Ks(o)}return t}function Qn(n,e,t=e){var r=new WeakSet;dc(n,"input",async o=>{var u=o?n.defaultValue:n.value;if(u=gs(n)?ms(u):u,t(u),Ue!==null&&r.add(Ue),await Ac(),u!==(u=e())){var c=n.selectionStart,f=n.selectionEnd;n.value=u??"",f!==null&&(n.selectionStart=c,n.selectionEnd=Math.min(f,n.value.length))}}),Yi(e)==null&&n.value&&(t(gs(n)?ms(n.value):n.value),Ue!==null&&r.add(Ue)),_u(()=>{var o=e();if(n===document.activeElement){var u=Ci??Ue;if(r.has(u))return}gs(n)&&o===ms(n.value)||n.type==="date"&&!o&&!n.value||o!==n.value&&(n.value=o??"")})}function gs(n){var e=n.type;return e==="number"||e==="range"}function ms(n){return n===""?null:+n}function wa(n,e){return n===e||n?.[hr]===e}function Bc(n={},e,t,r){return mc(()=>{var o,u;return _u(()=>{o=u,u=[],Yi(()=>{n!==t(...u)&&(e(n,...u),o&&wa(t(...o),n)&&e(null,...o))})}),()=>{to(()=>{u&&wa(t(...u),n)&&e(null,...u)})}}),n}function Wc(n=!1){const e=Ke,t=e.l.u;if(!t)return;let r=()=>Sc(e.s);if(n){let o=0,u={};const c=Vi(()=>{let f=!1;const v=e.s;for(const m in v)v[m]!==u[m]&&(u[m]=v[m],f=!0);return f&&o++,o});r=()=>V(c)}t.b.length&&pc(()=>{ba(e,r),Ii(t.b)}),Mi(()=>{const o=Yi(()=>t.m.map(Il));return()=>{for(const u of o)typeof u=="function"&&u()}}),t.a.length&&Mi(()=>{ba(e,r),Ii(t.a)})}function ba(n,e){if(n.l.s)for(const t of n.l.s)V(t);e()}function ao(n){Ke===null&&xl(),Kr&&Ke.l!==null?Vc(Ke).m.push(n):Mi(()=>{const e=Yi(n);if(typeof e=="function")return e})}function Vc(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const qc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(qc);Jl();class Hc{#n=Xe(wn({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return V(this.#n)}set player(e){Me(this.#n,e,!0)}#t=Xe(null);get storyData(){return V(this.#t)}set storyData(e){Me(this.#t,e,!0)}#e=Xe("0");get currentDialogueId(){return V(this.#e)}set currentDialogueId(e){Me(this.#e,e,!0)}#r=Xe(!0);get isLoading(){return V(this.#r)}set isLoading(e){Me(this.#r,e,!0)}#i=Xe("");get error(){return V(this.#i)}set error(e){Me(this.#i,e,!0)}async loadStory(e){this.isLoading=!0;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.storyData=await t.json(),this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){this.error="Ошибка загрузки: "+t.message,console.error(t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}runActions(e){e&&e.forEach(t=>{t.type==="add_item"&&t.id&&this.addItem(t.id),t.type==="stat_change"&&t.stat&&t.value!==void 0&&(this.player.stats[t.stat]+=t.value)})}goToDialogue(e){this.currentDialogueId=e}}const pt=new Hc;function zc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Gc(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),t}var Pi={exports:{}},Kc=Pi.exports,Ea;function Yc(){return Ea||(Ea=1,(function(n,e){(function(r,o){n.exports=o()})(Kc,()=>(()=>{var t=[,((c,f,v)=>{v.r(f),v.d(f,{default:()=>y});var m=(()=>{var E=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(A={}){var g=A,T,M;g.ready=new Promise((i,s)=>{T=i,M=s});function L(){function i(k){const I=d;l=s=0,d=new Map,I.forEach(O=>{try{O(k)}catch(P){console.error(P)}}),this.pb(),_&&_.Tb()}let s=0,l=0,d=new Map,_=null,b=null;this.requestAnimationFrame=function(k){s||(s=requestAnimationFrame(i.bind(this)));const I=++l;return d.set(I,k),I},this.cancelAnimationFrame=function(k){d.delete(k),s&&d.size==0&&(cancelAnimationFrame(s),s=0)},this.Rb=function(k){b&&(document.body.remove(b),b=null),k||(b=document.createElement("div"),b.style.backgroundColor="black",b.style.position="fixed",b.style.right=0,b.style.top=0,b.style.color="white",b.style.padding="4px",b.innerHTML="RIVE FPS",k=function(I){b.innerHTML="RIVE FPS "+I.toFixed(1)},document.body.appendChild(b)),_=new function(){let I=0,O=0;this.Tb=function(){var P=performance.now();O?(++I,P-=O,1e3<P&&(k(1e3*I/P),I=O=0)):(O=P,I=0)}}},this.Ob=function(){b&&(document.body.remove(b),b=null),_=null},this.pb=function(){}}function q(i){console.assert(!0);const s=new Map;let l=-1/0;this.push=function(d){return d=d+((1<<i)-1)>>i,s.has(d)&&clearTimeout(s.get(d)),s.set(d,setTimeout(function(){s.delete(d),s.length==0?l=-1/0:d==l&&(l=Math.max(...s.keys()),console.assert(l<d))},1e3)),l=Math.max(d,l),l<<i}}const H=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){H&&H();let i=g.decodeAudio;g.decodeAudio=function(_,b){_=i(_),b(_)};let s=g.decodeFont;g.decodeFont=function(_,b){_=s(_),b(_)};const l=g.FileAssetLoader;g.ptrToAsset=_=>{let b=g.ptrToFileAsset(_);return b.isImage?g.ptrToImageAsset(_):b.isFont?g.ptrToFontAsset(_):b.isAudio?g.ptrToAudioAsset(_):b},g.CustomFileAssetLoader=l.extend("CustomFileAssetLoader",{__construct:function({loadContents:_}){this.__parent.__construct.call(this),this.Gb=_},loadContents:function(_,b){return _=g.ptrToAsset(_),this.Gb(_,b)}}),g.CDNFileAssetLoader=l.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(_){let b=g.ptrToAsset(_);return _=b.cdnUuid,_===""?!1:((function(k,I){var O=new XMLHttpRequest;O.responseType="arraybuffer",O.onreadystatechange=function(){O.readyState==4&&O.status==200&&I(O)},O.open("GET",k,!0),O.send(null)})(b.cdnBaseUrl+"/"+_,k=>{b.decode(new Uint8Array(k.response))}),!0)}}),g.FallbackFileAssetLoader=l.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(_){this.lb.push(_)},loadContents:function(_,b){for(let k of this.lb)if(k.loadContents(_,b))return!0;return!1}});let d=g.computeAlignment;g.computeAlignment=function(_,b,k,I,O=1){return d.call(this,_,b,k,I,O)}};const N="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function i(){if(!s){let ve=function(ge,K,De){if(K=D.createShader(K),D.shaderSource(K,De),D.compileShader(K),De=D.getShaderInfoLog(K),0<(De||"").length)throw De;D.attachShader(ge,K)};var S=document.createElement("canvas"),U={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let D;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(D=S.getContext("webgl",U),l=1,!D)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(D=S.getContext("webgl2",U))l=2;else if(D=S.getContext("webgl",U))l=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(D=new Proxy(D,{get(ge,K){if(ge.isContextLost()){if(O||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",K),O=!0),typeof ge[K]=="function")return function(){}}else return typeof ge[K]=="function"?function(...De){return ge[K].apply(ge,De)}:ge[K]},set(ge,K,De){if(ge.isContextLost())O||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+K),O=!0);else return ge[K]=De,!0}}),d=Math.min(D.getParameter(D.MAX_RENDERBUFFER_SIZE),D.getParameter(D.MAX_TEXTURE_SIZE)),S=D.createProgram(),ve(S,D.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),ve(S,D.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),D.bindAttribLocation(S,0,"vertex"),D.bindAttribLocation(S,1,"uv"),D.linkProgram(S),U=D.getProgramInfoLog(S),0<(U||"").trim().length)throw U;_=D.getUniformLocation(S,"mat"),b=D.getUniformLocation(S,"translate"),D.useProgram(S),D.bindBuffer(D.ARRAY_BUFFER,D.createBuffer()),D.enableVertexAttribArray(0),D.enableVertexAttribArray(1),D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,D.createBuffer()),D.uniform1i(D.getUniformLocation(S,"image"),0),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s=D}return!0}let s=null,l=0,d=0,_=null,b=null,k=0,I=0,O=!1;i(),this.hc=function(){return i(),d},this.Mb=function(S){s.deleteTexture&&s.deleteTexture(S)},this.Lb=function(S){if(!i())return null;const U=s.createTexture();return U?(s.bindTexture(s.TEXTURE_2D,U),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,S),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),l==2?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),U):null};const P=new q(8),B=new q(8),W=new q(10),X=new q(10);this.Qb=function(S,U,D,ve,ge){if(i()){var K=P.push(S),De=B.push(U);if(s.canvas){(s.canvas.width!=K||s.canvas.height!=De)&&(s.canvas.width=K,s.canvas.height=De),s.viewport(0,De-U,S,U),s.disable(s.SCISSOR_TEST),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.enable(s.SCISSOR_TEST),D.sort((Ae,Gt)=>Gt.xb-Ae.xb),K=W.push(ve),k!=K&&(s.bufferData(s.ARRAY_BUFFER,8*K,s.DYNAMIC_DRAW),k=K),K=0;for(var rt of D)s.bufferSubData(s.ARRAY_BUFFER,K,rt.Ua),K+=4*rt.Ua.length;console.assert(K==4*ve);for(var zt of D)s.bufferSubData(s.ARRAY_BUFFER,K,zt.Db),K+=4*zt.Db.length;console.assert(K==8*ve),K=X.push(ge),I!=K&&(s.bufferData(s.ELEMENT_ARRAY_BUFFER,2*K,s.DYNAMIC_DRAW),I=K),rt=0;for(var On of D)s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,rt,On.indices),rt+=2*On.indices.length;console.assert(rt==2*ge),On=0,zt=!0,K=rt=0;for(const Ae of D){Ae.image.Ka!=On&&(s.bindTexture(s.TEXTURE_2D,Ae.image.Ja||null),On=Ae.image.Ka),Ae.mc?(s.scissor(Ae.Za,De-Ae.$a-Ae.kb,Ae.Ac,Ae.kb),zt=!0):zt&&(s.scissor(0,De-U,S,U),zt=!1),D=2/S;const Gt=-2/U;s.uniform4f(_,Ae.ha[0]*D*Ae.Ba,Ae.ha[1]*Gt*Ae.Ca,Ae.ha[2]*D*Ae.Ba,Ae.ha[3]*Gt*Ae.Ca),s.uniform2f(b,Ae.ha[4]*D*Ae.Ba+D*(Ae.Za-Ae.ic*Ae.Ba)-1,Ae.ha[5]*Gt*Ae.Ca+Gt*(Ae.$a-Ae.jc*Ae.Ca)+1),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,K),s.vertexAttribPointer(1,2,s.FLOAT,!1,0,K+4*ve),s.drawElements(s.TRIANGLES,Ae.indices.length,s.UNSIGNED_SHORT,rt),K+=4*Ae.Ua.length,rt+=2*Ae.indices.length}console.assert(K==4*ve),console.assert(rt==2*ge)}}},this.canvas=function(){return i()&&s.canvas}},G=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i($){switch($){case P.srcOver:return"source-over";case P.screen:return"screen";case P.overlay:return"overlay";case P.darken:return"darken";case P.lighten:return"lighten";case P.colorDodge:return"color-dodge";case P.colorBurn:return"color-burn";case P.hardLight:return"hard-light";case P.softLight:return"soft-light";case P.difference:return"difference";case P.exclusion:return"exclusion";case P.multiply:return"multiply";case P.hue:return"hue";case P.saturation:return"saturation";case P.color:return"color";case P.luminosity:return"luminosity"}}function s($){return"rgba("+((16711680&$)>>>16)+","+((65280&$)>>>8)+","+((255&$)>>>0)+","+((4278190080&$)>>>24)/255+")"}function l(){0<De.length&&(z.Qb(K.drawWidth(),K.drawHeight(),De,rt,zt),De=[],zt=rt=0,K.reset(512,512));for(const $ of ge){for(const J of $.H)J();$.H=[]}ge.clear()}G&&G();var d=g.RenderPaintStyle;const _=g.RenderPath,b=g.RenderPaint,k=g.Renderer,I=g.StrokeCap,O=g.StrokeJoin,P=g.BlendMode,B=d.fill,W=d.stroke,X=g.FillRule.evenOdd;let S=1;var U=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:$,xa:J}={}){this.__parent.__construct.call(this),this.Ka=S,S=S+1&2147483647||1,this.la=$,this.xa=J},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function($){var J=this;J.xa&&J.xa(J);var be=new Image;J.Xa=URL.createObjectURL(new Blob([$],{type:"image/png"})),be.onload=function(){J.Fb=be,J.Ja=z.Lb(be),J.size(be.width,be.height),J.la&&J.la(J)},be.src=J.Xa}}),D=_.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function($,J,be,ke,pe,Ee,Re){var je=this.T,Ft=je.addPath;$=$.T;const Ze=new DOMMatrix;Ze.a=J,Ze.b=be,Ze.c=ke,Ze.d=pe,Ze.e=Ee,Ze.f=Re,Ft.call(je,$,Ze)},fillRule:function($){this.Wa=$},moveTo:function($,J){this.T.moveTo($,J)},lineTo:function($,J){this.T.lineTo($,J)},cubicTo:function($,J,be,ke,pe,Ee){this.T.bezierCurveTo($,J,be,ke,pe,Ee)},close:function(){this.T.closePath()}}),ve=b.extend("CanvasRenderPaint",{color:function($){this.Ya=s($)},thickness:function($){this.Ib=$},join:function($){switch($){case O.miter:this.Ia="miter";break;case O.round:this.Ia="round";break;case O.bevel:this.Ia="bevel"}},cap:function($){switch($){case I.butt:this.Ha="butt";break;case I.round:this.Ha="round";break;case I.square:this.Ha="square"}},style:function($){this.Hb=$},blendMode:function($){this.Eb=i($)},clearGradient:function(){this.ja=null},linearGradient:function($,J,be,ke){this.ja={zb:$,Ab:J,cb:be,eb:ke,Ra:[]}},radialGradient:function($,J,be,ke){this.ja={zb:$,Ab:J,cb:be,eb:ke,Ra:[],ec:!0}},addStop:function($,J){this.ja.Ra.push({color:$,stop:J})},completeGradient:function(){},draw:function($,J,be){let ke=this.Hb;var pe=this.Ya,Ee=this.ja;if($.globalCompositeOperation=this.Eb,Ee!=null){pe=Ee.zb;var Re=Ee.Ab;const Ft=Ee.cb;var je=Ee.eb;const Ze=Ee.Ra;Ee.ec?(Ee=Ft-pe,je-=Re,pe=$.createRadialGradient(pe,Re,0,pe,Re,Math.sqrt(Ee*Ee+je*je))):pe=$.createLinearGradient(pe,Re,Ft,je);for(let Ct=0,et=Ze.length;Ct<et;Ct++)Re=Ze[Ct],pe.addColorStop(Re.stop,s(Re.color));this.Ya=pe,this.ja=null}switch(ke){case W:$.strokeStyle=pe,$.lineWidth=this.Ib,$.lineCap=this.Ha,$.lineJoin=this.Ia,$.stroke(J);break;case B:$.fillStyle=pe,$.fill(J,be)}}});const ge=new Set;let K=null,De=[],rt=0,zt=0;var On=g.CanvasRenderer=k.extend("Renderer",{__construct:function($){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=$.getContext("2d"),this.Va=$,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const $=this.S.length-6;if(6>$)throw"restore() called without matching save().";this.S.splice($),this.H.push(this.C.restore.bind(this.C))},transform:function($,J,be,ke,pe,Ee){const Re=this.S,je=Re.length-6;Re.splice(je,6,Re[je]*$+Re[je+2]*J,Re[je+1]*$+Re[je+3]*J,Re[je]*be+Re[je+2]*ke,Re[je+1]*be+Re[je+3]*ke,Re[je]*pe+Re[je+2]*Ee+Re[je+4],Re[je+1]*pe+Re[je+3]*Ee+Re[je+5]),this.H.push(this.C.transform.bind(this.C,$,J,be,ke,pe,Ee))},rotate:function($){const J=Math.sin($);$=Math.cos($),this.transform($,J,-J,$,0,0)},_drawPath:function($,J){this.H.push(J.draw.bind(J,this.C,$.T,$.Wa===X?"evenodd":"nonzero"))},_drawRiveImage:function($,J,be,ke){var pe=$.Fb;if(pe){var Ee=this.C,Re=i(be);this.H.push(function(){Ee.globalCompositeOperation=Re,Ee.globalAlpha=ke,Ee.drawImage(pe,0,0),Ee.globalAlpha=1})}},_getMatrix:function($){const J=this.S,be=J.length-6;for(let ke=0;6>ke;++ke)$[ke]=J[be+ke]},_drawImageMesh:function($,J,be,ke,pe,Ee,Re,je,Ft,Ze,Ct){J=this.C.canvas.width;var et=this.C.canvas.height;const ea=Ze-je,ta=Ct-Ft;je=Math.max(je,0),Ft=Math.max(Ft,0),Ze=Math.min(Ze,J),Ct=Math.min(Ct,et);const Mr=Ze-je,Lr=Ct-Ft;if(console.assert(Mr<=Math.min(ea,J)),console.assert(Lr<=Math.min(ta,et)),!(0>=Mr||0>=Lr)){Ze=Mr<ea||Lr<ta,J=Ct=1;var jn=Math.ceil(Mr*Ct),xn=Math.ceil(Lr*J);et=z.hc(),jn>et&&(Ct*=et/jn,jn=et),xn>et&&(J*=et/xn,xn=et),K||(K=new g.DynamicRectanizer(et),K.reset(512,512)),et=K.addRect(jn,xn),0>et&&(l(),ge.add(this),et=K.addRect(jn,xn),console.assert(0<=et));var na=et&65535,ra=et>>16;De.push({ha:this.S.slice(this.S.length-6),image:$,Za:na,$a:ra,ic:je,jc:Ft,Ac:jn,kb:xn,Ba:Ct,Ca:J,Ua:new Float32Array(pe),Db:new Float32Array(Ee),indices:new Uint16Array(Re),mc:Ze,xb:$.Ka<<1|(Ze?1:0)}),rt+=pe.length,zt+=Re.length;var Jn=this.C,Sl=i(be);this.H.push(function(){Jn.save(),Jn.resetTransform(),Jn.globalCompositeOperation=Sl,Jn.globalAlpha=ke;const ia=z.canvas();ia&&Jn.drawImage(ia,na,ra,jn,xn,je,Ft,Mr,Lr),Jn.restore()})}},_clipPath:function($){this.H.push(this.C.clip.bind(this.C,$.T,$.Wa===X?"evenodd":"nonzero"))},clear:function(){ge.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function($,J){this.transform(1,0,0,1,$,J)}});g.makeRenderer=function($){const J=new On($),be=J.C;return new Proxy(J,{get(ke,pe){if(typeof ke[pe]=="function")return function(...Ee){return ke[pe].apply(ke,Ee)};if(typeof be[pe]=="function"){if(-1<N.indexOf(pe))throw Error("RiveException: Method call to '"+pe+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ee){J.H.push(be[pe].bind(be,...Ee))}}return ke[pe]},set(ke,pe,Ee){if(pe in be)return J.H.push(()=>{be[pe]=Ee}),!0}})},g.decodeImage=function($,J){new U({la:J}).decode($)},g.renderFactory={makeRenderPaint:function(){return new ve},makeRenderPath:function(){return new D},makeRenderImage:function(){let $=Gt;return new U({xa:()=>{$.total++},la:()=>{if($.loaded++,$.loaded===$.total){const J=$.ready;J&&(J(),$.ready=null)}}})}};let Ae=g.load,Gt=null;g.load=function($,J,be=!0){const ke=new g.FallbackFileAssetLoader;return J!==void 0&&ke.addLoader(J),be&&(J=new g.CDNFileAssetLoader,ke.addLoader(J)),new Promise(function(pe){let Ee=null;Gt={total:0,loaded:0,ready:function(){pe(Ee)}},Ee=Ae($,ke),Gt.total==0&&pe(Ee)})};let kl=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function($,J,be,ke,pe=1){kl.call(this,$,J,be,ke,pe)},d=new L,g.requestAnimationFrame=d.requestAnimationFrame.bind(d),g.cancelAnimationFrame=d.cancelAnimationFrame.bind(d),g.enableFPSCounter=d.Rb.bind(d),g.disableFPSCounter=d.Ob,d.pb=l,g.resolveAnimationFrame=l,g.cleanup=function(){K&&K.delete()}};var R=Object.assign({},g),x="./this.program",ne=typeof window=="object",re=typeof importScripts=="function",ie="",Y,ue;(ne||re)&&(re?ie=self.location.href:typeof document<"u"&&document.currentScript&&(ie=document.currentScript.src),E&&(ie=E),ie.indexOf("blob:")!==0?ie=ie.substr(0,ie.replace(/[?#].*/,"").lastIndexOf("/")+1):ie="",re&&(ue=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Y=(i,s,l)=>{var d=new XMLHttpRequest;d.open("GET",i,!0),d.responseType="arraybuffer",d.onload=()=>{d.status==200||d.status==0&&d.response?s(d.response):l()},d.onerror=l,d.send(null)});var xe=g.print||console.log.bind(console),Ve=g.printErr||console.error.bind(console);Object.assign(g,R),R=null,g.thisProgram&&(x=g.thisProgram);var $e;g.wasmBinary&&($e=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&Wt("no native wasm support detected");var lt,_e,Nt=!1,ze,Z,se,Le,oe,de,He,we;function Ge(){var i=lt.buffer;g.HEAP8=ze=new Int8Array(i),g.HEAP16=se=new Int16Array(i),g.HEAP32=oe=new Int32Array(i),g.HEAPU8=Z=new Uint8Array(i),g.HEAPU16=Le=new Uint16Array(i),g.HEAPU32=de=new Uint32Array(i),g.HEAPF32=He=new Float32Array(i),g.HEAPF64=we=new Float64Array(i)}var Be,Et=[],Bt=[],Rt=[];function Zt(){var i=g.preRun.shift();Et.unshift(i)}var it=0,dt=null;function Wt(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",Ve(i),Nt=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),M(i),i}function Tn(i){return i.startsWith("data:application/octet-stream;base64,")}var Ot;if(Ot="canvas_advanced.wasm",!Tn(Ot)){var Hn=Ot;Ot=g.locateFile?g.locateFile(Hn,ie):ie+Hn}function st(i){if(i==Ot&&$e)return new Uint8Array($e);if(ue)return ue(i);throw"both async and sync fetching of the wasm failed"}function kr(i){if(!$e&&(ne||re)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw"failed to load wasm binary file at '"+i+"'";return s.arrayBuffer()}).catch(()=>st(i));if(Y)return new Promise((s,l)=>{Y(i,d=>s(new Uint8Array(d)),l)})}return Promise.resolve().then(()=>st(i))}function zn(i,s,l){return kr(i).then(d=>WebAssembly.instantiate(d,s)).then(d=>d).then(l,d=>{Ve("failed to asynchronously prepare wasm: "+d),Wt(d)})}function mt(i,s){var l=Ot;return $e||typeof WebAssembly.instantiateStreaming!="function"||Tn(l)||l.startsWith("file://")||typeof fetch!="function"?zn(l,i,s):fetch(l,{credentials:"same-origin"}).then(d=>WebAssembly.instantiateStreaming(d,i).then(s,function(_){return Ve("wasm streaming compile failed: "+_),Ve("falling back to ArrayBuffer instantiation"),zn(l,i,s)}))}var _t,p,a={460492:(i,s,l,d,_)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=s,window.h.I.La=l,window.h.ga={},window.h.ga.stopped=d,window.h.ga.yb=_;let b=window.h;b.D=[],b.yc=function(k){for(var I=0;I<b.D.length;++I)if(b.D[I]==null)return b.D[I]=k,I;return b.D.push(k),b.D.length-1},b.Cb=function(k){for(b.D[k]=null;0<b.D.length&&b.D[b.D.length-1]==null;)b.D.pop()},b.Sc=function(k){for(var I=0;I<b.D.length;++I)if(b.D[I]==k)return b.Cb(I)},b.ra=function(k){return b.D[k]},b.Ta=["touchend","click"],b.unlock=function(){for(var k=0;k<b.D.length;++k){var I=b.D[k];I!=null&&I.J!=null&&I.state===b.ga.yb&&I.J.resume().then(()=>{Yo(I.qb)},O=>{console.error("Failed to resume audiocontext",O)})}b.Ta.map(function(O){document.removeEventListener(O,b.unlock,!0)})},b.Ta.map(function(k){document.addEventListener(k,b.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),s=i.sampleRate;return i.close(),s}catch{return 0}},463249:(i,s,l,d,_,b)=>{if(typeof window.h>"u")return-1;var k={},I={};return i==window.h.I.ya&&l!=0&&(I.sampleRate=l),k.J=new(window.AudioContext||window.webkitAudioContext)(I),k.J.suspend(),k.state=window.h.ga.stopped,l=0,i!=window.h.I.ya&&(l=s),k.Z=k.J.createScriptProcessor(d,l,s),k.Z.onaudioprocess=function(O){if((k.sa==null||k.sa.length==0)&&(k.sa=new Float32Array(He.buffer,_,d*s)),i==window.h.I.capture||i==window.h.I.La){for(var P=0;P<s;P+=1)for(var B=O.inputBuffer.getChannelData(P),W=k.sa,X=0;X<d;X+=1)W[X*s+P]=B[X];Jo(b,d,_)}if(i==window.h.I.ya||i==window.h.I.La)for(Xo(b,d,_),P=0;P<O.outputBuffer.numberOfChannels;++P)for(B=O.outputBuffer.getChannelData(P),W=k.sa,X=0;X<d;X+=1)B[X]=W[X*s+P];else for(P=0;P<O.outputBuffer.numberOfChannels;++P)O.outputBuffer.getChannelData(P).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(O){k.Da=k.J.createMediaStreamSource(O),k.Da.connect(k.Z),k.Z.connect(k.J.destination)}).catch(function(O){console.log("Failed to get user media: "+O)}),i==window.h.I.ya&&k.Z.connect(k.J.destination),k.qb=b,window.h.yc(k)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},h=i=>{for(;0<i.length;)i.shift()(g)},w=(i,s)=>{for(var l=0,d=i.length-1;0<=d;d--){var _=i[d];_==="."?i.splice(d,1):_===".."?(i.splice(d,1),l++):l&&(i.splice(d,1),l--)}if(s)for(;l;l--)i.unshift("..");return i},C=i=>{var s=i.charAt(0)==="/",l=i.substr(-1)==="/";return(i=w(i.split("/").filter(d=>!!d),!s).join("/"))||s||(i="."),i&&l&&(i+="/"),(s?"/":"")+i},j=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},F=i=>{if(i==="/")return"/";i=C(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},te=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Wt("initRandomDevice")},le=i=>(le=te())(i);function ee(){for(var i="",s=!1,l=arguments.length-1;-1<=l&&!s;l--){if(s=0<=l?arguments[l]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=w(i.split("/").filter(d=>!!d),!s).join("/"),(s?"/":"")+i||"."}var me=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ie=(i,s,l)=>{var d=s+l;for(l=s;i[l]&&!(l>=d);)++l;if(16<l-s&&i.buffer&&me)return me.decode(i.subarray(s,l));for(d="";s<l;){var _=i[s++];if(_&128){var b=i[s++]&63;if((_&224)==192)d+=String.fromCharCode((_&31)<<6|b);else{var k=i[s++]&63;_=(_&240)==224?(_&15)<<12|b<<6|k:(_&7)<<18|b<<12|k<<6|i[s++]&63,65536>_?d+=String.fromCharCode(_):(_-=65536,d+=String.fromCharCode(55296|_>>10,56320|_&1023))}}else d+=String.fromCharCode(_)}return d},Qe=[],We=i=>{for(var s=0,l=0;l<i.length;++l){var d=i.charCodeAt(l);127>=d?s++:2047>=d?s+=2:55296<=d&&57343>=d?(s+=4,++l):s+=3}return s},jt=(i,s,l,d)=>{if(!(0<d))return 0;var _=l;d=l+d-1;for(var b=0;b<i.length;++b){var k=i.charCodeAt(b);if(55296<=k&&57343>=k){var I=i.charCodeAt(++b);k=65536+((k&1023)<<10)|I&1023}if(127>=k){if(l>=d)break;s[l++]=k}else{if(2047>=k){if(l+1>=d)break;s[l++]=192|k>>6}else{if(65535>=k){if(l+2>=d)break;s[l++]=224|k>>12}else{if(l+3>=d)break;s[l++]=240|k>>18,s[l++]=128|k>>12&63}s[l++]=128|k>>6&63}s[l++]=128|k&63}}return s[l]=0,l-_};function At(i,s){var l=Array(We(i)+1);return i=jt(i,l,0,l.length),s&&(l.length=i),l}var ft=[];function vt(i,s){ft[i]={input:[],F:[],V:s},Qi(i,kt)}var kt={open:function(i){var s=ft[i.node.za];if(!s)throw new Q(43);i.s=s,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,s,l,d){if(!i.s||!i.s.V.jb)throw new Q(60);for(var _=0,b=0;b<d;b++){try{var k=i.s.V.jb(i.s)}catch{throw new Q(29)}if(k===void 0&&_===0)throw new Q(6);if(k==null)break;_++,s[l+b]=k}return _&&(i.node.timestamp=Date.now()),_},write:function(i,s,l,d){if(!i.s||!i.s.V.Oa)throw new Q(60);try{for(var _=0;_<d;_++)i.s.V.Oa(i.s,s[l+_])}catch{throw new Q(29)}return d&&(i.node.timestamp=Date.now()),_}},fn={jb:function(){e:{if(!Qe.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}Qe=At(i,!0)}i=Qe.shift()}return i},Oa:function(i,s){s===null||s===10?(xe(Ie(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(xe(Ie(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},vn={Oa:function(i,s){s===null||s===10?(Ve(Ie(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(Ve(Ie(i.F,0)),i.F=[])}};function Vt(i,s){var l=i.j?i.j.length:0;l>=s||(s=Math.max(s,l*(1048576>l?2:1.125)>>>0),l!=0&&(s=Math.max(s,256)),l=i.j,i.j=new Uint8Array(s),0<i.v&&i.j.set(l.subarray(0,i.v),0))}var ae={O:null,U(){return ae.createNode(null,"/",16895,0)},createNode(i,s,l,d){if((l&61440)===24576||(l&61440)===4096)throw new Q(63);return ae.O||(ae.O={dir:{node:{Y:ae.l.Y,P:ae.l.P,ka:ae.l.ka,va:ae.l.va,vb:ae.l.vb,Bb:ae.l.Bb,wb:ae.l.wb,tb:ae.l.tb,Ea:ae.l.Ea},stream:{ba:ae.m.ba}},file:{node:{Y:ae.l.Y,P:ae.l.P},stream:{ba:ae.m.ba,read:ae.m.read,write:ae.m.write,pa:ae.m.pa,mb:ae.m.mb,ob:ae.m.ob}},link:{node:{Y:ae.l.Y,P:ae.l.P,ma:ae.l.ma},stream:{}},ab:{node:{Y:ae.l.Y,P:ae.l.P},stream:nl}}),l=_o(i,s,l,d),(l.mode&61440)===16384?(l.l=ae.O.dir.node,l.m=ae.O.dir.stream,l.j={}):(l.mode&61440)===32768?(l.l=ae.O.file.node,l.m=ae.O.file.stream,l.v=0,l.j=null):(l.mode&61440)===40960?(l.l=ae.O.link.node,l.m=ae.O.link.stream):(l.mode&61440)===8192&&(l.l=ae.O.ab.node,l.m=ae.O.ab.stream),l.timestamp=Date.now(),i&&(i.j[s]=l,i.timestamp=l.timestamp),l},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var s={};return s.Jc=(i.mode&61440)===8192?i.id:1,s.Mc=i.id,s.mode=i.mode,s.Oc=1,s.uid=0,s.Lc=0,s.za=i.za,(i.mode&61440)===16384?s.size=4096:(i.mode&61440)===32768?s.size=i.v:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.Bc=new Date(i.timestamp),s.Nc=new Date(i.timestamp),s.Ic=new Date(i.timestamp),s.Jb=4096,s.Cc=Math.ceil(s.size/s.Jb),s},P(i,s){if(s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&(s=s.size,i.v!=s))if(s==0)i.j=null,i.v=0;else{var l=i.j;i.j=new Uint8Array(s),l&&i.j.set(l.subarray(0,Math.min(s,i.v))),i.v=s}},ka(){throw Xi[44]},va(i,s,l,d){return ae.createNode(i,s,l,d)},vb(i,s,l){if((i.mode&61440)===16384){try{var d=ei(s,l)}catch{}if(d)for(var _ in d.j)throw new Q(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=l,s.j[l]=i,s.timestamp=i.parent.timestamp,i.parent=s},Bb(i,s){delete i.j[s],i.timestamp=Date.now()},wb(i,s){var l=ei(i,s),d;for(d in l.j)throw new Q(55);delete i.j[s],i.timestamp=Date.now()},tb(i){var s=[".",".."],l;for(l in i.j)i.j.hasOwnProperty(l)&&s.push(l);return s},Ea(i,s,l){return i=ae.createNode(i,s,41471,0),i.link=l,i},ma(i){if((i.mode&61440)!==40960)throw new Q(28);return i.link}},m:{read(i,s,l,d,_){var b=i.node.j;if(_>=i.node.v)return 0;if(i=Math.min(i.node.v-_,d),8<i&&b.subarray)s.set(b.subarray(_,_+i),l);else for(d=0;d<i;d++)s[l+d]=b[_+d];return i},write(i,s,l,d,_,b){if(s.buffer===ze.buffer&&(b=!1),!d)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.j||i.j.subarray)){if(b)return i.j=s.subarray(l,l+d),i.v=d;if(i.v===0&&_===0)return i.j=s.slice(l,l+d),i.v=d;if(_+d<=i.v)return i.j.set(s.subarray(l,l+d),_),d}if(Vt(i,_+d),i.j.subarray&&s.subarray)i.j.set(s.subarray(l,l+d),_);else for(b=0;b<d;b++)i.j[_+b]=s[l+b];return i.v=Math.max(i.v,_+d),d},ba(i,s,l){if(l===1?s+=i.position:l===2&&(i.node.mode&61440)===32768&&(s+=i.node.v),0>s)throw new Q(28);return s},pa(i,s,l){Vt(i.node,s+l),i.node.v=Math.max(i.node.v,s+l)},mb(i,s,l,d,_){if((i.node.mode&61440)!==32768)throw new Q(43);if(i=i.node.j,_&2||i.buffer!==ze.buffer){if((0<l||l+s<i.length)&&(i.subarray?i=i.subarray(l,l+s):i=Array.prototype.slice.call(i,l,l+s)),l=!0,Wt(),s=void 0,!s)throw new Q(48);ze.set(i,s)}else l=!1,s=i.byteOffset;return{o:s,M:l}},ob(i,s,l,d){return ae.m.write(i,s,0,d,l,!1),0}}};function Se(i,s){var l=0;return i&&(l|=365),s&&(l|=146),l}var qt=null,vo={},Zr=[],el=1,Sr=null,po=!0,Q=null,Xi={},Pn=(i,s={})=>{if(i=ee(i),!i)return{path:"",node:null};if(s=Object.assign({hb:!0,Qa:0},s),8<s.Qa)throw new Q(32);i=i.split("/").filter(k=>!!k);for(var l=qt,d="/",_=0;_<i.length;_++){var b=_===i.length-1;if(b&&s.parent)break;if(l=ei(l,i[_]),d=C(d+"/"+i[_]),l.wa&&(!b||b&&s.hb)&&(l=l.wa.root),!b||s.gb){for(b=0;(l.mode&61440)===40960;)if(l=rl(d),d=ee(j(d),l),l=Pn(d,{Qa:s.Qa+1}).node,40<b++)throw new Q(32)}}return{path:d,node:l}},go=i=>{for(var s;;){if(i===i.parent)return i=i.U.nb,s?i[i.length-1]!=="/"?`${i}/${s}`:i+s:i;s=s?`${i.name}/${s}`:i.name,i=i.parent}},mo=(i,s)=>{for(var l=0,d=0;d<s.length;d++)l=(l<<5)-l+s.charCodeAt(d)|0;return(i+l>>>0)%Sr.length},ei=(i,s)=>{var l;if(l=(l=ti(i,"x"))?l:i.l.ka?0:2)throw new Q(l,i);for(l=Sr[mo(i.id,s)];l;l=l.lc){var d=l.name;if(l.parent.id===i.id&&d===s)return l}return i.l.ka(i,s)},_o=(i,s,l,d)=>(i=new Ho(i,s,l,d),s=mo(i.parent.id,i.name),i.lc=Sr[s],Sr[s]=i),yo=i=>{var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},ti=(i,s)=>{if(po)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},wo=(i,s)=>{try{return ei(i,s),20}catch{}return ti(i,"wx")},tl=()=>{for(var i=0;4096>=i;i++)if(!Zr[i])return i;throw new Q(33)},pn=i=>{if(i=Zr[i],!i)throw new Q(8);return i},bo=(i,s=-1)=>(Tr||(Tr=function(){this.h={}},Tr.prototype={},Object.defineProperties(Tr.prototype,{object:{get(){return this.node},set(l){this.node=l}},flags:{get(){return this.h.flags},set(l){this.h.flags=l}},position:{get(){return this.h.position},set(l){this.h.position=l}}})),i=Object.assign(new Tr,i),s==-1&&(s=tl()),i.X=s,Zr[s]=i),nl={open:i=>{i.m=vo[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new Q(70)}},Qi=(i,s)=>{vo[i]={m:s}},Eo=(i,s)=>{var l=s==="/",d=!s;if(l&&qt)throw new Q(10);if(!l&&!d){var _=Pn(s,{hb:!1});if(s=_.path,_=_.node,_.wa)throw new Q(10);if((_.mode&61440)!==16384)throw new Q(54)}s={type:i,Qc:{},nb:s,kc:[]},i=i.U(s),i.U=s,s.root=i,l?qt=i:_&&(_.wa=s,_.U&&_.U.kc.push(s))},xt=(i,s,l)=>{var d=Pn(i,{parent:!0}).node;if(i=F(i),!i||i==="."||i==="..")throw new Q(28);var _=wo(d,i);if(_)throw new Q(_);if(!d.l.va)throw new Q(63);return d.l.va(d,i,s,l)},ni=(i,s,l)=>{typeof l>"u"&&(l=s,s=438),xt(i,s|8192,l)},Zi=(i,s)=>{if(!ee(i))throw new Q(44);var l=Pn(s,{parent:!0}).node;if(!l)throw new Q(44);s=F(s);var d=wo(l,s);if(d)throw new Q(d);if(!l.l.Ea)throw new Q(63);l.l.Ea(l,s,i)},rl=i=>{if(i=Pn(i).node,!i)throw new Q(44);if(!i.l.ma)throw new Q(28);return ee(go(i.parent),i.l.ma(i))},ri=(i,s,l)=>{if(i==="")throw new Q(44);if(typeof s=="string"){var d={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[s];if(typeof d>"u")throw Error(`Unknown file open mode: ${s}`);s=d}if(l=s&64?(typeof l>"u"?438:l)&4095|32768:0,typeof i=="object")var _=i;else{i=C(i);try{_=Pn(i,{gb:!(s&131072)}).node}catch{}}if(d=!1,s&64)if(_){if(s&128)throw new Q(20)}else _=xt(i,l,0),d=!0;if(!_)throw new Q(44);if((_.mode&61440)===8192&&(s&=-513),s&65536&&(_.mode&61440)!==16384)throw new Q(54);if(!d&&(l=_?(_.mode&61440)===40960?32:(_.mode&61440)===16384&&(yo(s)!=="r"||s&512)?31:ti(_,yo(s)):44))throw new Q(l);if(s&512&&!d){if(l=_,l=typeof l=="string"?Pn(l,{gb:!0}).node:l,!l.l.P)throw new Q(63);if((l.mode&61440)===16384)throw new Q(31);if((l.mode&61440)!==32768)throw new Q(28);if(d=ti(l,"w"))throw new Q(d);l.l.P(l,{size:0,timestamp:Date.now()})}return s&=-131713,_=bo({node:_,path:go(_),flags:s,seekable:!0,position:0,m:_.m,zc:[],error:!1}),_.m.open&&_.m.open(_),!g.logReadFiles||s&1||(ii||(ii={}),i in ii||(ii[i]=1)),_},Ao=(i,s,l)=>{if(i.X===null)throw new Q(8);if(!i.seekable||!i.m.ba)throw new Q(70);if(l!=0&&l!=1&&l!=2)throw new Q(28);i.position=i.m.ba(i,s,l),i.zc=[]},ko=()=>{Q||(Q=function(i,s){this.name="ErrnoError",this.node=s,this.pc=function(l){this.aa=l},this.pc(i),this.message="FS error"},Q.prototype=Error(),Q.prototype.constructor=Q,[44].forEach(i=>{Xi[i]=new Q(i),Xi[i].stack="<generic error, no stack>"}))},So,Cr=(i,s,l)=>{i=C("/dev/"+i);var d=Se(!!s,!!l);es||(es=64);var _=es++<<8|0;Qi(_,{open:b=>{b.seekable=!1},close:()=>{l&&l.buffer&&l.buffer.length&&l(10)},read:(b,k,I,O)=>{for(var P=0,B=0;B<O;B++){try{var W=s()}catch{throw new Q(29)}if(W===void 0&&P===0)throw new Q(6);if(W==null)break;P++,k[I+B]=W}return P&&(b.node.timestamp=Date.now()),P},write:(b,k,I,O)=>{for(var P=0;P<O;P++)try{l(k[I+P])}catch{throw new Q(29)}return O&&(b.node.timestamp=Date.now()),P}}),ni(i,d,_)},es,In={},Tr,ii,Pr=void 0;function en(){return Pr+=4,oe[Pr-4>>2]}function Co(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var s=i.charCodeAt(0);return 48<=s&&57>=s?`_${i}`:i}function si(i,s){return i=Co(i),{[i]:function(){return s.apply(this,arguments)}}[i]}function To(){this.M=[void 0],this.ib=[]}var St=new To,Gn=void 0;function fe(i){throw new Gn(i)}var Mt=i=>(i||fe("Cannot use deleted val. handle = "+i),St.get(i).value),Lt=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return St.pa({ub:1,value:i})}};function Po(i){var s=Error,l=si(i,function(d){this.name=i,this.message=d,d=Error(d).stack,d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(s.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},l}var Io=void 0,Ro=void 0;function qe(i){for(var s="";Z[i];)s+=Ro[Z[i++]];return s}var Ir=[];function ts(){for(;Ir.length;){var i=Ir.pop();i.g.fa=!1,i.delete()}}var Rr=void 0,tn={};function ns(i,s){for(s===void 0&&fe("ptr should not be undefined");i.A;)s=i.na(s),i=i.A;return s}var Rn={};function Oo(i){i=Qo(i);var s=qe(i);return sn(i),s}function Or(i,s){var l=Rn[i];return l===void 0&&fe(s+" has unknown type "+Oo(i)),l}function oi(){}var rs=!1;function jo(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function xo(i,s,l){return s===l?i:l.A===void 0?null:(i=xo(i,s,l.A),i===null?null:l.Pb(i))}var Mo={};function il(i,s){return s=ns(i,s),tn[s]}var Lo=void 0;function ai(i){throw new Lo(i)}function ui(i,s){return s.u&&s.o||ai("makeClassHandle requires ptr and ptrType"),!!s.L!=!!s.G&&ai("Both smartPtrType and smartPtr must be specified"),s.count={value:1},Kn(Object.create(i,{g:{value:s}}))}function Kn(i){return typeof FinalizationRegistry>"u"?(Kn=s=>s,i):(rs=new FinalizationRegistry(s=>{jo(s.g)}),Kn=s=>{var l=s.g;return l.G&&rs.register(s,{g:l},s),s},oi=s=>{rs.unregister(s)},Kn(i))}var li={};function jr(i){for(;i.length;){var s=i.pop();i.pop()(s)}}function xr(i){return this.fromWireType(oe[i>>2])}var Yn={},ci={};function yt(i,s,l){function d(I){I=l(I),I.length!==i.length&&ai("Mismatched type converter count");for(var O=0;O<i.length;++O)Ht(i[O],I[O])}i.forEach(function(I){ci[I]=s});var _=Array(s.length),b=[],k=0;s.forEach((I,O)=>{Rn.hasOwnProperty(I)?_[O]=Rn[I]:(b.push(I),Yn.hasOwnProperty(I)||(Yn[I]=[]),Yn[I].push(()=>{_[O]=Rn[I],++k,k===b.length&&d(_)}))}),b.length===0&&d(_)}function hi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function sl(i,s,l={}){var d=s.name;if(i||fe(`type "${d}" must have a positive integer typeid pointer`),Rn.hasOwnProperty(i)){if(l.$b)return;fe(`Cannot register type '${d}' twice`)}Rn[i]=s,delete ci[i],Yn.hasOwnProperty(i)&&(s=Yn[i],delete Yn[i],s.forEach(_=>_()))}function Ht(i,s,l={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");sl(i,s,l)}function is(i){fe(i.g.u.i.name+" instance already deleted")}function gn(){}function ss(i,s,l){if(i[s].B===void 0){var d=i[s];i[s]=function(){return i[s].B.hasOwnProperty(arguments.length)||fe(`Function '${l}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[s].B})!`),i[s].B[arguments.length].apply(this,arguments)},i[s].B=[],i[s].B[d.ea]=d}}function os(i,s,l){g.hasOwnProperty(i)?((l===void 0||g[i].B!==void 0&&g[i].B[l]!==void 0)&&fe(`Cannot register public name '${i}' twice`),ss(g,i,i),g.hasOwnProperty(l)&&fe(`Cannot register multiple overloads of a function with the same number of arguments (${l})!`),g[i].B[l]=s):(g[i]=s,l!==void 0&&(g[i].Pc=l))}function ol(i,s,l,d,_,b,k,I){this.name=i,this.constructor=s,this.N=l,this.W=d,this.A=_,this.Ub=b,this.na=k,this.Pb=I,this.rb=[]}function di(i,s,l){for(;s!==l;)s.na||fe(`Expected null or instance of ${l.name}, got an instance of ${s.name}`),i=s.na(i),s=s.A;return i}function al(i,s){return s===null?(this.Na&&fe(`null is not a valid ${this.name}`),0):(s.g||fe(`Cannot pass "${us(s)}" as a ${this.name}`),s.g.o||fe(`Cannot pass deleted object as a pointer of type ${this.name}`),di(s.g.o,s.g.u.i,this.i))}function ul(i,s){if(s===null){if(this.Na&&fe(`null is not a valid ${this.name}`),this.ua){var l=this.Pa();return i!==null&&i.push(this.W,l),l}return 0}if(s.g||fe(`Cannot pass "${us(s)}" as a ${this.name}`),s.g.o||fe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&s.g.u.ta&&fe(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`),l=di(s.g.o,s.g.u.i,this.i),this.ua)switch(s.g.G===void 0&&fe("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:s.g.L===this?l=s.g.G:fe(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`);break;case 1:l=s.g.G;break;case 2:if(s.g.L===this)l=s.g.G;else{var d=s.clone();l=this.oc(l,Lt(function(){d.delete()})),i!==null&&i.push(this.W,l)}break;default:fe("Unsupporting sharing policy")}return l}function ll(i,s){return s===null?(this.Na&&fe(`null is not a valid ${this.name}`),0):(s.g||fe(`Cannot pass "${us(s)}" as a ${this.name}`),s.g.o||fe(`Cannot pass deleted object as a pointer of type ${this.name}`),s.g.u.ta&&fe(`Cannot convert argument of type ${s.g.u.name} to parameter type ${this.name}`),di(s.g.o,s.g.u.i,this.i))}function nn(i,s,l,d){this.name=i,this.i=s,this.Na=l,this.ta=d,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,s.A!==void 0?this.toWireType=ul:(this.toWireType=d?al:ll,this.K=null)}function Fo(i,s,l){g.hasOwnProperty(i)||ai("Replacing nonexistant public symbol"),g[i].B!==void 0&&l!==void 0?g[i].B[l]=s:(g[i]=s,g[i].ea=l)}var fi=[],$o=i=>{var s=fi[i];return s||(i>=fi.length&&(fi.length=i+1),fi[i]=s=Be.get(i)),s},cl=(i,s)=>{var l=[];return function(){if(l.length=0,Object.assign(l,arguments),i.includes("j")){var d=g["dynCall_"+i];d=l&&l.length?d.apply(null,[s].concat(l)):d.call(null,s)}else d=$o(s).apply(null,l);return d}};function ot(i,s){i=qe(i);var l=i.includes("j")?cl(i,s):$o(s);return typeof l!="function"&&fe(`unknown function pointer with signature ${i}: ${s}`),l}var Do=void 0;function rn(i,s){function l(b){_[b]||Rn[b]||(ci[b]?ci[b].forEach(l):(d.push(b),_[b]=!0))}var d=[],_={};throw s.forEach(l),new Do(`${i}: `+d.map(Oo).join([", "]))}function vi(i,s,l,d,_){var b=s.length;2>b&&fe("argTypes array size mismatch! Must at least get return value and 'this' types!");var k=s[1]!==null&&l!==null,I=!1;for(l=1;l<s.length;++l)if(s[l]!==null&&s[l].K===void 0){I=!0;break}var O=s[0].name!=="void",P=b-2,B=Array(P),W=[],X=[];return function(){if(arguments.length!==P&&fe(`function ${i} called with ${arguments.length} arguments, expected ${P} args!`),X.length=0,W.length=k?2:1,W[0]=_,k){var S=s[1].toWireType(X,this);W[1]=S}for(var U=0;U<P;++U)B[U]=s[U+2].toWireType(X,arguments[U]),W.push(B[U]);if(U=d.apply(null,W),I)jr(X);else for(var D=k?1:2;D<s.length;D++){var ve=D===1?S:B[D-2];s[D].K!==null&&s[D].K(ve)}return S=O?s[0].fromWireType(U):void 0,S}}function pi(i,s){for(var l=[],d=0;d<i;d++)l.push(de[s+4*d>>2]);return l}function Uo(i,s,l){return i instanceof Object||fe(`${l} with invalid "this": ${i}`),i instanceof s.i.constructor||fe(`${l} incompatible with "this" of type ${i.constructor.name}`),i.g.o||fe(`cannot call emscripten binding method ${l} on deleted object`),di(i.g.o,i.g.u.i,s.i)}function as(i){i>=St.h&&--St.get(i).ub===0&&St.Zb(i)}function hl(i,s,l){switch(s){case 0:return function(d){return this.fromWireType((l?ze:Z)[d])};case 1:return function(d){return this.fromWireType((l?se:Le)[d>>1])};case 2:return function(d){return this.fromWireType((l?oe:de)[d>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function us(i){if(i===null)return"null";var s=typeof i;return s==="object"||s==="array"||s==="function"?i.toString():""+i}function dl(i,s){switch(s){case 2:return function(l){return this.fromWireType(He[l>>2])};case 3:return function(l){return this.fromWireType(we[l>>3])};default:throw new TypeError("Unknown float type: "+i)}}function fl(i,s,l){switch(s){case 0:return l?function(d){return ze[d]}:function(d){return Z[d]};case 1:return l?function(d){return se[d>>1]}:function(d){return Le[d>>1]};case 2:return l?function(d){return oe[d>>2]}:function(d){return de[d>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var No=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,vl=(i,s)=>{for(var l=i>>1,d=l+s/2;!(l>=d)&&Le[l];)++l;if(l<<=1,32<l-i&&No)return No.decode(Z.subarray(i,l));for(l="",d=0;!(d>=s/2);++d){var _=se[i+2*d>>1];if(_==0)break;l+=String.fromCharCode(_)}return l},pl=(i,s,l)=>{if(l===void 0&&(l=2147483647),2>l)return 0;l-=2;var d=s;l=l<2*i.length?l/2:i.length;for(var _=0;_<l;++_)se[s>>1]=i.charCodeAt(_),s+=2;return se[s>>1]=0,s-d},gl=i=>2*i.length,ml=(i,s)=>{for(var l=0,d="";!(l>=s/4);){var _=oe[i+4*l>>2];if(_==0)break;++l,65536<=_?(_-=65536,d+=String.fromCharCode(55296|_>>10,56320|_&1023)):d+=String.fromCharCode(_)}return d},_l=(i,s,l)=>{if(l===void 0&&(l=2147483647),4>l)return 0;var d=s;l=d+l-4;for(var _=0;_<i.length;++_){var b=i.charCodeAt(_);if(55296<=b&&57343>=b){var k=i.charCodeAt(++_);b=65536+((b&1023)<<10)|k&1023}if(oe[s>>2]=b,s+=4,s+4>l)break}return oe[s>>2]=0,s-d},yl=i=>{for(var s=0,l=0;l<i.length;++l){var d=i.charCodeAt(l);55296<=d&&57343>=d&&++l,s+=4}return s},wl={};function gi(i){var s=wl[i];return s===void 0?qe(i):s}var mi=[];function bl(i){var s=mi.length;return mi.push(i),s}function El(i,s){for(var l=Array(i),d=0;d<i;++d)l[d]=Or(de[s+4*d>>2],"parameter "+d);return l}var Bo=[],ls=[],cs={},Wo=()=>{if(!hs){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:x||"./this.program"},s;for(s in cs)cs[s]===void 0?delete i[s]:i[s]=cs[s];var l=[];for(s in i)l.push(`${s}=${i[s]}`);hs=l}return hs},hs,_i=i=>i%4===0&&(i%100!==0||i%400===0),Vo=[31,29,31,30,31,30,31,31,30,31,30,31],qo=[31,28,31,30,31,30,31,31,30,31,30,31],Al=(i,s,l,d)=>{function _(S,U,D){for(S=typeof S=="number"?S.toString():S||"";S.length<U;)S=D[0]+S;return S}function b(S,U){return _(S,U,"0")}function k(S,U){function D(ge){return 0>ge?-1:0<ge?1:0}var ve;return(ve=D(S.getFullYear()-U.getFullYear()))===0&&(ve=D(S.getMonth()-U.getMonth()))===0&&(ve=D(S.getDate()-U.getDate())),ve}function I(S){switch(S.getDay()){case 0:return new Date(S.getFullYear()-1,11,29);case 1:return S;case 2:return new Date(S.getFullYear(),0,3);case 3:return new Date(S.getFullYear(),0,2);case 4:return new Date(S.getFullYear(),0,1);case 5:return new Date(S.getFullYear()-1,11,31);case 6:return new Date(S.getFullYear()-1,11,30)}}function O(S){var U=S.ca;for(S=new Date(new Date(S.da+1900,0,1).getTime());0<U;){var D=S.getMonth(),ve=(_i(S.getFullYear())?Vo:qo)[D];if(U>ve-S.getDate())U-=ve-S.getDate()+1,S.setDate(1),11>D?S.setMonth(D+1):(S.setMonth(0),S.setFullYear(S.getFullYear()+1));else{S.setDate(S.getDate()+U);break}}return D=new Date(S.getFullYear()+1,0,4),U=I(new Date(S.getFullYear(),0,4)),D=I(D),0>=k(U,S)?0>=k(D,S)?S.getFullYear()+1:S.getFullYear():S.getFullYear()-1}var P=oe[d+40>>2];d={wc:oe[d>>2],vc:oe[d+4>>2],Fa:oe[d+8>>2],Sa:oe[d+12>>2],Ga:oe[d+16>>2],da:oe[d+20>>2],R:oe[d+24>>2],ca:oe[d+28>>2],Rc:oe[d+32>>2],uc:oe[d+36>>2],xc:P&&P?Ie(Z,P):""},l=l?Ie(Z,l):"",P={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var B in P)l=l.replace(new RegExp(B,"g"),P[B]);var W="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),X="January February March April May June July August September October November December".split(" ");P={"%a":S=>W[S.R].substring(0,3),"%A":S=>W[S.R],"%b":S=>X[S.Ga].substring(0,3),"%B":S=>X[S.Ga],"%C":S=>b((S.da+1900)/100|0,2),"%d":S=>b(S.Sa,2),"%e":S=>_(S.Sa,2," "),"%g":S=>O(S).toString().substring(2),"%G":S=>O(S),"%H":S=>b(S.Fa,2),"%I":S=>(S=S.Fa,S==0?S=12:12<S&&(S-=12),b(S,2)),"%j":S=>{for(var U=0,D=0;D<=S.Ga-1;U+=(_i(S.da+1900)?Vo:qo)[D++]);return b(S.Sa+U,3)},"%m":S=>b(S.Ga+1,2),"%M":S=>b(S.vc,2),"%n":()=>`
`,"%p":S=>0<=S.Fa&&12>S.Fa?"AM":"PM","%S":S=>b(S.wc,2),"%t":()=>"	","%u":S=>S.R||7,"%U":S=>b(Math.floor((S.ca+7-S.R)/7),2),"%V":S=>{var U=Math.floor((S.ca+7-(S.R+6)%7)/7);if(2>=(S.R+371-S.ca-2)%7&&U++,U)U==53&&(D=(S.R+371-S.ca)%7,D==4||D==3&&_i(S.da)||(U=1));else{U=52;var D=(S.R+7-S.ca-1)%7;(D==4||D==5&&_i(S.da%400-1))&&U++}return b(U,2)},"%w":S=>S.R,"%W":S=>b(Math.floor((S.ca+7-(S.R+6)%7)/7),2),"%y":S=>(S.da+1900).toString().substring(2),"%Y":S=>S.da+1900,"%z":S=>{S=S.uc;var U=0<=S;return S=Math.abs(S)/60,(U?"+":"-")+("0000"+(S/60*100+S%60)).slice(-4)},"%Z":S=>S.xc,"%%":()=>"%"},l=l.replace(/%%/g,"\0\0");for(B in P)l.includes(B)&&(l=l.replace(new RegExp(B,"g"),P[B](d)));return l=l.replace(/\0\0/g,"%"),B=At(l,!1),B.length>s?0:(ze.set(B,i),B.length-1)};function Ho(i,s,l,d){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=el++,this.name=s,this.mode=l,this.l={},this.m={},this.za=d}Object.defineProperties(Ho.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),ko(),Sr=Array(4096),Eo(ae,"/"),xt("/tmp",16895,0),xt("/home",16895,0),xt("/home/web_user",16895,0),(()=>{xt("/dev",16895,0),Qi(259,{read:()=>0,write:(d,_,b,k)=>k}),ni("/dev/null",259),vt(1280,fn),vt(1536,vn),ni("/dev/tty",1280),ni("/dev/tty1",1536);var i=new Uint8Array(1024),s=0,l=()=>(s===0&&(s=le(i).byteLength),i[--s]);Cr("random",l),Cr("urandom",l),xt("/dev/shm",16895,0),xt("/dev/shm/tmp",16895,0)})(),(()=>{xt("/proc",16895,0);var i=xt("/proc/self",16895,0);xt("/proc/self/fd",16895,0),Eo({U:()=>{var s=_o(i,"fd",16895,73);return s.l={ka:(l,d)=>{var _=pn(+d);return l={parent:null,U:{nb:"fake"},l:{ma:()=>_.path}},l.parent=l}},s}},"/proc/self/fd")})(),Object.assign(To.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var s=this.ib.pop()||this.M.length;return this.M[s]=i,s},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Gn=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},St.M.push({value:void 0},{value:null},{value:!0},{value:!1}),St.h=St.M.length,g.count_emval_handles=function(){for(var i=0,s=St.h;s<St.M.length;++s)St.M[s]!==void 0&&++i;return i},Io=g.PureVirtualError=Po("PureVirtualError");for(var zo=Array(256),yi=0;256>yi;++yi)zo[yi]=String.fromCharCode(yi);Ro=zo,g.getInheritedInstanceCount=function(){return Object.keys(tn).length},g.getLiveInheritedInstances=function(){var i=[],s;for(s in tn)tn.hasOwnProperty(s)&&i.push(tn[s]);return i},g.flushPendingDeletes=ts,g.setDelayFunction=function(i){Rr=i,Ir.length&&Rr&&Rr(ts)},Lo=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},gn.prototype.isAliasOf=function(i){if(!(this instanceof gn&&i instanceof gn))return!1;var s=this.g.u.i,l=this.g.o,d=i.g.u.i;for(i=i.g.o;s.A;)l=s.na(l),s=s.A;for(;d.A;)i=d.na(i),d=d.A;return s===d&&l===i},gn.prototype.clone=function(){if(this.g.o||is(this),this.g.ia)return this.g.count.value+=1,this;var i=Kn,s=Object,l=s.create,d=Object.getPrototypeOf(this),_=this.g;return i=i(l.call(s,d,{g:{value:{count:_.count,fa:_.fa,ia:_.ia,o:_.o,u:_.u,G:_.G,L:_.L}}})),i.g.count.value+=1,i.g.fa=!1,i},gn.prototype.delete=function(){this.g.o||is(this),this.g.fa&&!this.g.ia&&fe("Object already scheduled for deletion"),oi(this),jo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},gn.prototype.isDeleted=function(){return!this.g.o},gn.prototype.deleteLater=function(){return this.g.o||is(this),this.g.fa&&!this.g.ia&&fe("Object already scheduled for deletion"),Ir.push(this),Ir.length===1&&Rr&&Rr(ts),this.g.fa=!0,this},nn.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},nn.prototype.bb=function(i){this.W&&this.W(i)},nn.prototype.argPackAdvance=8,nn.prototype.readValueFromPointer=xr,nn.prototype.deleteObject=function(i){i!==null&&i.delete()},nn.prototype.fromWireType=function(i){function s(){return this.ua?ui(this.i.N,{u:this.nc,o:l,L:this,G:i}):ui(this.i.N,{u:this,o:i})}var l=this.Vb(i);if(!l)return this.bb(i),null;var d=il(this.i,l);if(d!==void 0)return d.g.count.value===0?(d.g.o=l,d.g.G=i,d.clone()):(d=d.clone(),this.bb(i),d);if(d=this.i.Ub(l),d=Mo[d],!d)return s.call(this);d=this.ta?d.Kb:d.pointerType;var _=xo(l,this.i,d.i);return _===null?s.call(this):this.ua?ui(d.i.N,{u:d,o:_,L:this,G:i}):ui(d.i.N,{u:d,o:_})},Do=g.UnboundTypeError=Po("UnboundTypeError");var Go={__syscall_fcntl64:function(i,s,l){Pr=l;try{var d=pn(i);switch(s){case 0:var _=en();return 0>_?-28:bo(d,_).X;case 1:case 2:return 0;case 3:return d.flags;case 4:return _=en(),d.flags|=_,0;case 5:return _=en(),se[_+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return oe[Ko()>>2]=28,-1;default:return-28}}catch(b){if(typeof In>"u"||b.name!=="ErrnoError")throw b;return-b.aa}},__syscall_ioctl:function(i,s,l){Pr=l;try{var d=pn(i);switch(s){case 21509:return d.s?0:-59;case 21505:if(!d.s)return-59;if(d.s.V.bc){s=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var _=en();oe[_>>2]=25856,oe[_+4>>2]=5,oe[_+8>>2]=191,oe[_+12>>2]=35387;for(var b=0;32>b;b++)ze[_+b+17>>0]=s[b]||0}return 0;case 21510:case 21511:case 21512:return d.s?0:-59;case 21506:case 21507:case 21508:if(!d.s)return-59;if(d.s.V.cc)for(_=en(),s=[],b=0;32>b;b++)s.push(ze[_+b+17>>0]);return 0;case 21519:return d.s?(_=en(),oe[_>>2]=0):-59;case 21520:return d.s?-28:-59;case 21531:if(_=en(),!d.m.ac)throw new Q(59);return d.m.ac(d,s,_);case 21523:return d.s?(d.s.V.dc&&(b=[24,80],_=en(),se[_>>1]=b[0],se[_+2>>1]=b[1]),0):-59;case 21524:return d.s?0:-59;case 21515:return d.s?0:-59;default:return-28}}catch(k){if(typeof In>"u"||k.name!=="ErrnoError")throw k;return-k.aa}},__syscall_openat:function(i,s,l,d){Pr=d;try{s=s?Ie(Z,s):"";var _=s;if(_.charAt(0)==="/")s=_;else{var b=i===-100?"/":pn(i).path;if(_.length==0)throw new Q(44);s=C(b+"/"+_)}var k=d?en():0;return ri(s,l,k).X}catch(I){if(typeof In>"u"||I.name!=="ErrnoError")throw I;return-I.aa}},_embind_create_inheriting_constructor:function(i,s,l){i=qe(i),s=Or(s,"wrapper"),l=Mt(l);var d=[].slice,_=s.i,b=_.N,k=_.A.N,I=_.A.constructor;i=si(i,function(){_.A.rb.forEach((function(P){if(this[P]===k[P])throw new Io(`Pure virtual function ${P} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:b}),this.__construct.apply(this,d.call(arguments))}),b.__construct=function(){this===b&&fe("Pass correct 'this' to __construct");var P=I.implement.apply(void 0,[this].concat(d.call(arguments)));oi(P);var B=P.g;P.notifyOnDestruction(),B.ia=!0,Object.defineProperties(this,{g:{value:B}}),Kn(this),P=B.o,P=ns(_,P),tn.hasOwnProperty(P)?fe(`Tried to register registered instance: ${P}`):tn[P]=this},b.__destruct=function(){this===b&&fe("Pass correct 'this' to __destruct"),oi(this);var P=this.g.o;P=ns(_,P),tn.hasOwnProperty(P)?delete tn[P]:fe(`Tried to unregister unregistered instance: ${P}`)},i.prototype=Object.create(b);for(var O in l)i.prototype[O]=l[O];return Lt(i)},_embind_finalize_value_object:function(i){var s=li[i];delete li[i];var l=s.Pa,d=s.W,_=s.fb,b=_.map(k=>k.Yb).concat(_.map(k=>k.rc));yt([i],b,k=>{var I={};return _.forEach((O,P)=>{var B=k[P],W=O.Wb,X=O.Xb,S=k[P+_.length],U=O.qc,D=O.sc;I[O.Sb]={read:ve=>B.fromWireType(W(X,ve)),write:(ve,ge)=>{var K=[];U(D,ve,S.toWireType(K,ge)),jr(K)}}}),[{name:s.name,fromWireType:function(O){var P={},B;for(B in I)P[B]=I[B].read(O);return d(O),P},toWireType:function(O,P){for(var B in I)if(!(B in P))throw new TypeError(`Missing field: "${B}"`);var W=l();for(B in I)I[B].write(W,P[B]);return O!==null&&O.push(d,W),W},argPackAdvance:8,readValueFromPointer:xr,K:d}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,s,l,d,_){var b=hi(l);s=qe(s),Ht(i,{name:s,fromWireType:function(k){return!!k},toWireType:function(k,I){return I?d:_},argPackAdvance:8,readValueFromPointer:function(k){if(l===1)var I=ze;else if(l===2)I=se;else if(l===4)I=oe;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(I[k>>b])},K:null})},_embind_register_class:function(i,s,l,d,_,b,k,I,O,P,B,W,X){B=qe(B),b=ot(_,b),I&&(I=ot(k,I)),P&&(P=ot(O,P)),X=ot(W,X);var S=Co(B);os(S,function(){rn(`Cannot construct ${B} due to unbound types`,[d])}),yt([i,s,l],d?[d]:[],function(U){if(U=U[0],d)var D=U.i,ve=D.N;else ve=gn.prototype;U=si(S,function(){if(Object.getPrototypeOf(this)!==ge)throw new Gn("Use 'new' to construct "+B);if(K.$===void 0)throw new Gn(B+" has no accessible constructor");var rt=K.$[arguments.length];if(rt===void 0)throw new Gn(`Tried to invoke ctor of ${B} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(K.$).toString()}) parameters instead!`);return rt.apply(this,arguments)});var ge=Object.create(ve,{constructor:{value:U}});U.prototype=ge;var K=new ol(B,U,ge,X,D,b,I,P);K.A&&(K.A.oa===void 0&&(K.A.oa=[]),K.A.oa.push(K)),D=new nn(B,K,!0,!1),ve=new nn(B+"*",K,!1,!1);var De=new nn(B+" const*",K,!1,!0);return Mo[i]={pointerType:ve,Kb:De},Fo(S,U),[D,ve,De]})},_embind_register_class_class_function:function(i,s,l,d,_,b,k){var I=pi(l,d);s=qe(s),b=ot(_,b),yt([],[i],function(O){function P(){rn(`Cannot call ${B} due to unbound types`,I)}O=O[0];var B=`${O.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]);var W=O.i.constructor;return W[s]===void 0?(P.ea=l-1,W[s]=P):(ss(W,s,B),W[s].B[l-1]=P),yt([],I,function(X){if(X=vi(B,[X[0],null].concat(X.slice(1)),null,b,k),W[s].B===void 0?(X.ea=l-1,W[s]=X):W[s].B[l-1]=X,O.i.oa)for(const S of O.i.oa)S.constructor.hasOwnProperty(s)||(S.constructor[s]=X);return[]}),[]})},_embind_register_class_class_property:function(i,s,l,d,_,b,k,I){s=qe(s),b=ot(_,b),yt([],[i],function(O){O=O[0];var P=`${O.name}.${s}`,B={get(){rn(`Cannot access ${P} due to unbound types`,[l])},enumerable:!0,configurable:!0};return B.set=I?()=>{rn(`Cannot access ${P} due to unbound types`,[l])}:()=>{fe(`${P} is a read-only property`)},Object.defineProperty(O.i.constructor,s,B),yt([],[l],function(W){W=W[0];var X={get(){return W.fromWireType(b(d))},enumerable:!0};return I&&(I=ot(k,I),X.set=S=>{var U=[];I(d,W.toWireType(U,S)),jr(U)}),Object.defineProperty(O.i.constructor,s,X),[]}),[]})},_embind_register_class_constructor:function(i,s,l,d,_,b){var k=pi(s,l);_=ot(d,_),yt([],[i],function(I){I=I[0];var O=`constructor ${I.name}`;if(I.i.$===void 0&&(I.i.$=[]),I.i.$[s-1]!==void 0)throw new Gn(`Cannot register multiple constructors with identical number of parameters (${s-1}) for class '${I.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return I.i.$[s-1]=()=>{rn(`Cannot construct ${I.name} due to unbound types`,k)},yt([],k,function(P){return P.splice(1,0,null),I.i.$[s-1]=vi(O,P,null,_,b),[]}),[]})},_embind_register_class_function:function(i,s,l,d,_,b,k,I){var O=pi(l,d);s=qe(s),b=ot(_,b),yt([],[i],function(P){function B(){rn(`Cannot call ${W} due to unbound types`,O)}P=P[0];var W=`${P.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),I&&P.i.rb.push(s);var X=P.i.N,S=X[s];return S===void 0||S.B===void 0&&S.className!==P.name&&S.ea===l-2?(B.ea=l-2,B.className=P.name,X[s]=B):(ss(X,s,W),X[s].B[l-2]=B),yt([],O,function(U){return U=vi(W,U,P,b,k),X[s].B===void 0?(U.ea=l-2,X[s]=U):X[s].B[l-2]=U,[]}),[]})},_embind_register_class_property:function(i,s,l,d,_,b,k,I,O,P){s=qe(s),_=ot(d,_),yt([],[i],function(B){B=B[0];var W=`${B.name}.${s}`,X={get(){rn(`Cannot access ${W} due to unbound types`,[l,k])},enumerable:!0,configurable:!0};return X.set=O?()=>{rn(`Cannot access ${W} due to unbound types`,[l,k])}:()=>{fe(W+" is a read-only property")},Object.defineProperty(B.i.N,s,X),yt([],O?[l,k]:[l],function(S){var U=S[0],D={get(){var ge=Uo(this,B,W+" getter");return U.fromWireType(_(b,ge))},enumerable:!0};if(O){O=ot(I,O);var ve=S[1];D.set=function(ge){var K=Uo(this,B,W+" setter"),De=[];O(P,K,ve.toWireType(De,ge)),jr(De)}}return Object.defineProperty(B.i.N,s,D),[]}),[]})},_embind_register_emval:function(i,s){s=qe(s),Ht(i,{name:s,fromWireType:function(l){var d=Mt(l);return as(l),d},toWireType:function(l,d){return Lt(d)},argPackAdvance:8,readValueFromPointer:xr,K:null})},_embind_register_enum:function(i,s,l,d){function _(){}l=hi(l),s=qe(s),_.values={},Ht(i,{name:s,constructor:_,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,k){return k.value},argPackAdvance:8,readValueFromPointer:hl(s,l,d),K:null}),os(s,_)},_embind_register_enum_value:function(i,s,l){var d=Or(i,"enum");s=qe(s),i=d.constructor,d=Object.create(d.constructor.prototype,{value:{value:l},constructor:{value:si(`${d.name}_${s}`,function(){})}}),i.values[l]=d,i[s]=d},_embind_register_float:function(i,s,l){l=hi(l),s=qe(s),Ht(i,{name:s,fromWireType:function(d){return d},toWireType:function(d,_){return _},argPackAdvance:8,readValueFromPointer:dl(s,l),K:null})},_embind_register_function:function(i,s,l,d,_,b){var k=pi(s,l);i=qe(i),_=ot(d,_),os(i,function(){rn(`Cannot call ${i} due to unbound types`,k)},s-1),yt([],k,function(I){return Fo(i,vi(i,[I[0],null].concat(I.slice(1)),null,_,b),s-1),[]})},_embind_register_integer:function(i,s,l,d,_){s=qe(s),_===-1&&(_=4294967295),_=hi(l);var b=I=>I;if(d===0){var k=32-8*l;b=I=>I<<k>>>k}l=s.includes("unsigned")?function(I,O){return O>>>0}:function(I,O){return O},Ht(i,{name:s,fromWireType:b,toWireType:l,argPackAdvance:8,readValueFromPointer:fl(s,_,d!==0),K:null})},_embind_register_memory_view:function(i,s,l){function d(b){b>>=2;var k=de;return new _(k.buffer,k[b+1],k[b])}var _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];l=qe(l),Ht(i,{name:l,fromWireType:d,argPackAdvance:8,readValueFromPointer:d},{$b:!0})},_embind_register_std_string:function(i,s){s=qe(s);var l=s==="std::string";Ht(i,{name:s,fromWireType:function(d){var _=de[d>>2],b=d+4;if(l)for(var k=b,I=0;I<=_;++I){var O=b+I;if(I==_||Z[O]==0){if(k=k?Ie(Z,k,O-k):"",P===void 0)var P=k;else P+="\0",P+=k;k=O+1}}else{for(P=Array(_),I=0;I<_;++I)P[I]=String.fromCharCode(Z[b+I]);P=P.join("")}return sn(d),P},toWireType:function(d,_){_ instanceof ArrayBuffer&&(_=new Uint8Array(_));var b=typeof _=="string";b||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int8Array||fe("Cannot pass non-string to std::string");var k=l&&b?We(_):_.length,I=ds(4+k+1),O=I+4;if(de[I>>2]=k,l&&b)jt(_,Z,O,k+1);else if(b)for(b=0;b<k;++b){var P=_.charCodeAt(b);255<P&&(sn(O),fe("String has UTF-16 code units that do not fit in 8 bits")),Z[O+b]=P}else for(b=0;b<k;++b)Z[O+b]=_[b];return d!==null&&d.push(sn,I),I},argPackAdvance:8,readValueFromPointer:xr,K:function(d){sn(d)}})},_embind_register_std_wstring:function(i,s,l){if(l=qe(l),s===2)var d=vl,_=pl,b=gl,k=()=>Le,I=1;else s===4&&(d=ml,_=_l,b=yl,k=()=>de,I=2);Ht(i,{name:l,fromWireType:function(O){for(var P=de[O>>2],B=k(),W,X=O+4,S=0;S<=P;++S){var U=O+4+S*s;(S==P||B[U>>I]==0)&&(X=d(X,U-X),W===void 0?W=X:(W+="\0",W+=X),X=U+s)}return sn(O),W},toWireType:function(O,P){typeof P!="string"&&fe(`Cannot pass non-string to C++ string type ${l}`);var B=b(P),W=ds(4+B+s);return de[W>>2]=B>>I,_(P,W+4,B+s),O!==null&&O.push(sn,W),W},argPackAdvance:8,readValueFromPointer:xr,K:function(O){sn(O)}})},_embind_register_value_object:function(i,s,l,d,_,b){li[i]={name:qe(s),Pa:ot(l,d),W:ot(_,b),fb:[]}},_embind_register_value_object_field:function(i,s,l,d,_,b,k,I,O,P){li[i].fb.push({Sb:qe(s),Yb:l,Wb:ot(d,_),Xb:b,rc:k,qc:ot(I,O),sc:P})},_embind_register_void:function(i,s){s=qe(s),Ht(i,{fc:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,s,l){i=Mt(i),s=Or(s,"emval::as");var d=[],_=Lt(d);return de[l>>2]=_,s.toWireType(d,i)},_emval_call_method:function(i,s,l,d,_){i=mi[i],s=Mt(s),l=gi(l);var b=[];return de[d>>2]=Lt(b),i(s,l,b,_)},_emval_call_void_method:function(i,s,l,d){i=mi[i],s=Mt(s),l=gi(l),i(s,l,null,d)},_emval_decref:as,_emval_get_method_caller:function(i,s){var l=El(i,s),d=l[0];s=d.name+"_$"+l.slice(1).map(function(k){return k.name}).join("_")+"$";var _=Bo[s];if(_!==void 0)return _;var b=Array(i-1);return _=bl((k,I,O,P)=>{for(var B=0,W=0;W<i-1;++W)b[W]=l[W+1].readValueFromPointer(P+B),B+=l[W+1].argPackAdvance;for(k=k[I].apply(k,b),W=0;W<i-1;++W)l[W+1].Nb&&l[W+1].Nb(b[W]);if(!d.fc)return d.toWireType(O,k)}),Bo[s]=_},_emval_get_module_property:function(i){return i=gi(i),Lt(g[i])},_emval_get_property:function(i,s){return i=Mt(i),s=Mt(s),Lt(i[s])},_emval_incref:function(i){4<i&&(St.get(i).ub+=1)},_emval_new_array:function(){return Lt([])},_emval_new_cstring:function(i){return Lt(gi(i))},_emval_new_object:function(){return Lt({})},_emval_run_destructors:function(i){var s=Mt(i);jr(s),as(i)},_emval_set_property:function(i,s,l){i=Mt(i),s=Mt(s),l=Mt(l),i[s]=l},_emval_take_value:function(i,s){return i=Or(i,"_emval_take_value"),i=i.readValueFromPointer(s),Lt(i)},abort:()=>{Wt("")},emscripten_asm_const_int:(i,s,l)=>{ls.length=0;var d;for(l>>=2;d=Z[s++];)l+=d!=105&l,ls.push(d==105?oe[l]:we[l++>>1]),++l;return a[i].apply(null,ls)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,s,l)=>Z.copyWithin(i,s,s+l),emscripten_resize_heap:i=>{var s=Z.length;if(i>>>=0,2147483648<i)return!1;for(var l=1;4>=l;l*=2){var d=s*(1+.2/l);d=Math.min(d,i+100663296);var _=Math;d=Math.max(i,d);e:{_=_.min.call(_,2147483648,d+(65536-d%65536)%65536)-lt.buffer.byteLength+65535>>>16;try{lt.grow(_),Ge();var b=1;break e}catch{}b=void 0}if(b)return!0}return!1},environ_get:(i,s)=>{var l=0;return Wo().forEach(function(d,_){var b=s+l;for(_=de[i+4*_>>2]=b,b=0;b<d.length;++b)ze[_++>>0]=d.charCodeAt(b);ze[_>>0]=0,l+=d.length+1}),0},environ_sizes_get:(i,s)=>{var l=Wo();de[i>>2]=l.length;var d=0;return l.forEach(function(_){d+=_.length+1}),de[s>>2]=d,0},fd_close:function(i){try{var s=pn(i);if(s.X===null)throw new Q(8);s.Ma&&(s.Ma=null);try{s.m.close&&s.m.close(s)}catch(l){throw l}finally{Zr[s.X]=null}return s.X=null,0}catch(l){if(typeof In>"u"||l.name!=="ErrnoError")throw l;return l.aa}},fd_read:function(i,s,l,d){try{e:{var _=pn(i);i=s;for(var b,k=s=0;k<l;k++){var I=de[i>>2],O=de[i+4>>2];i+=8;var P=_,B=I,W=O,X=b,S=ze;if(0>W||0>X)throw new Q(28);if(P.X===null)throw new Q(8);if((P.flags&2097155)===1)throw new Q(8);if((P.node.mode&61440)===16384)throw new Q(31);if(!P.m.read)throw new Q(28);var U=typeof X<"u";if(!U)X=P.position;else if(!P.seekable)throw new Q(70);var D=P.m.read(P,S,B,W,X);U||(P.position+=D);var ve=D;if(0>ve){var ge=-1;break e}if(s+=ve,ve<O)break;typeof b<"u"&&(b+=ve)}ge=s}return de[d>>2]=ge,0}catch(K){if(typeof In>"u"||K.name!=="ErrnoError")throw K;return K.aa}},fd_seek:function(i,s,l,d,_){s=l+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*l:NaN;try{if(isNaN(s))return 61;var b=pn(i);return Ao(b,s,d),p=[b.position>>>0,(_t=b.position,1<=+Math.abs(_t)?0<_t?+Math.floor(_t/4294967296)>>>0:~~+Math.ceil((_t-+(~~_t>>>0))/4294967296)>>>0:0)],oe[_>>2]=p[0],oe[_+4>>2]=p[1],b.Ma&&s===0&&d===0&&(b.Ma=null),0}catch(k){if(typeof In>"u"||k.name!=="ErrnoError")throw k;return k.aa}},fd_write:function(i,s,l,d){try{e:{var _=pn(i);i=s;for(var b,k=s=0;k<l;k++){var I=de[i>>2],O=de[i+4>>2];i+=8;var P=_,B=I,W=O,X=b,S=ze;if(0>W||0>X)throw new Q(28);if(P.X===null)throw new Q(8);if((P.flags&2097155)===0)throw new Q(8);if((P.node.mode&61440)===16384)throw new Q(31);if(!P.m.write)throw new Q(28);P.seekable&&P.flags&1024&&Ao(P,0,2);var U=typeof X<"u";if(!U)X=P.position;else if(!P.seekable)throw new Q(70);var D=P.m.write(P,S,B,W,X,void 0);U||(P.position+=D);var ve=D;if(0>ve){var ge=-1;break e}s+=ve,typeof b<"u"&&(b+=ve)}ge=s}return de[d>>2]=ge,0}catch(K){if(typeof In>"u"||K.name!=="ErrnoError")throw K;return K.aa}},strftime_l:(i,s,l,d)=>Al(i,s,l,d)};(function(){function i(l){if(_e=l=l.exports,lt=_e.memory,Ge(),Be=_e.__indirect_function_table,Bt.unshift(_e.__wasm_call_ctors),it--,g.monitorRunDependencies&&g.monitorRunDependencies(it),it==0&&dt){var d=dt;dt=null,d()}return l}var s={env:Go,wasi_snapshot_preview1:Go};if(it++,g.monitorRunDependencies&&g.monitorRunDependencies(it),g.instantiateWasm)try{return g.instantiateWasm(s,i)}catch(l){Ve("Module.instantiateWasm callback failed with error: "+l),M(l)}return mt(s,function(l){i(l.instance)}).catch(M),{}})();var sn=i=>(sn=_e.free)(i),ds=i=>(ds=_e.malloc)(i),Ko=()=>(Ko=_e.__errno_location)(),Yo=g._ma_device__on_notification_unlocked=i=>(Yo=g._ma_device__on_notification_unlocked=_e.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,s)=>(g._ma_malloc_emscripten=_e.ma_malloc_emscripten)(i,s),g._ma_free_emscripten=(i,s)=>(g._ma_free_emscripten=_e.ma_free_emscripten)(i,s);var Jo=g._ma_device_process_pcm_frames_capture__webaudio=(i,s,l)=>(Jo=g._ma_device_process_pcm_frames_capture__webaudio=_e.ma_device_process_pcm_frames_capture__webaudio)(i,s,l),Xo=g._ma_device_process_pcm_frames_playback__webaudio=(i,s,l)=>(Xo=g._ma_device_process_pcm_frames_playback__webaudio=_e.ma_device_process_pcm_frames_playback__webaudio)(i,s,l),Qo=i=>(Qo=_e.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=_e._embind_initialize_bindings)(),g.dynCall_iiji=(i,s,l,d,_)=>(g.dynCall_iiji=_e.dynCall_iiji)(i,s,l,d,_),g.dynCall_jiji=(i,s,l,d,_)=>(g.dynCall_jiji=_e.dynCall_jiji)(i,s,l,d,_),g.dynCall_iiiji=(i,s,l,d,_,b)=>(g.dynCall_iiiji=_e.dynCall_iiiji)(i,s,l,d,_,b),g.dynCall_iij=(i,s,l,d)=>(g.dynCall_iij=_e.dynCall_iij)(i,s,l,d),g.dynCall_jii=(i,s,l)=>(g.dynCall_jii=_e.dynCall_jii)(i,s,l),g.dynCall_viijii=(i,s,l,d,_,b,k)=>(g.dynCall_viijii=_e.dynCall_viijii)(i,s,l,d,_,b,k),g.dynCall_iiiiij=(i,s,l,d,_,b,k)=>(g.dynCall_iiiiij=_e.dynCall_iiiiij)(i,s,l,d,_,b,k),g.dynCall_iiiiijj=(i,s,l,d,_,b,k,I,O)=>(g.dynCall_iiiiijj=_e.dynCall_iiiiijj)(i,s,l,d,_,b,k,I,O),g.dynCall_iiiiiijj=(i,s,l,d,_,b,k,I,O,P)=>(g.dynCall_iiiiiijj=_e.dynCall_iiiiiijj)(i,s,l,d,_,b,k,I,O,P);var wi;dt=function i(){wi||Zo(),wi||(dt=i)};function Zo(){function i(){if(!wi&&(wi=!0,g.calledRun=!0,!Nt)){if(g.noFSInit||So||(So=!0,ko(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?Cr("stdin",g.stdin):Zi("/dev/tty","/dev/stdin"),g.stdout?Cr("stdout",null,g.stdout):Zi("/dev/tty","/dev/stdout"),g.stderr?Cr("stderr",null,g.stderr):Zi("/dev/tty1","/dev/stderr"),ri("/dev/stdin",0),ri("/dev/stdout",1),ri("/dev/stderr",1)),po=!1,h(Bt),T(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var s=g.postRun.shift();Rt.unshift(s)}h(Rt)}}if(!(0<it)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Zt();h(Et),0<it||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Zo(),A.ready})})();const y=m}),(c=>{c.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>m.Animation});var m=v(4)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>m});var m=(function(){function y(E,A,g,T){this.animation=E,this.artboard=A,this.playing=T,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(E,A)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"time",{get:function(){return this.instance.time},set:function(E){this.instance.time=E},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),y.prototype.advance=function(E){this.scrubTo===null?this.instance.advance(E):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},y.prototype.apply=function(E){this.instance.apply(E)},y.prototype.cleanup=function(){this.instance.delete()},y})()}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>E.AudioAssetWrapper,AudioWrapper:()=>E.AudioWrapper,BLANK_URL:()=>y.BLANK_URL,CustomFileAssetLoaderWrapper:()=>E.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>E.FileAssetWrapper,Finalizable:()=>E.Finalizable,FontAssetWrapper:()=>E.FontAssetWrapper,FontWrapper:()=>E.FontWrapper,ImageAssetWrapper:()=>E.ImageAssetWrapper,ImageWrapper:()=>E.ImageWrapper,finalizationRegistry:()=>E.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>y.sanitizeUrl});var m=v(6),y=v(7),E=v(8)}),((c,f,v)=>{v.r(f),v.d(f,{registerTouchInteractions:()=>E});var m=void 0,y=function(A,g){var T,M;return["touchstart","touchmove"].indexOf(A.type)>-1&&(!((T=A.touches)===null||T===void 0)&&T.length)?(g||A.preventDefault(),{clientX:A.touches[0].clientX,clientY:A.touches[0].clientY}):A.type==="touchend"&&(!((M=A.changedTouches)===null||M===void 0)&&M.length)?{clientX:A.changedTouches[0].clientX,clientY:A.changedTouches[0].clientY}:{clientX:A.clientX,clientY:A.clientY}},E=function(A){var g=A.canvas,T=A.artboard,M=A.stateMachines,L=M===void 0?[]:M,q=A.renderer,H=A.rive,N=A.fit,z=A.alignment,G=A.isTouchScrollEnabled,R=G===void 0?!1:G,x=A.layoutScaleFactor,ne=x===void 0?1:x;if(!g||!L.length||!q||!H||!T||typeof window>"u")return null;var re=null,ie=!1,Y=function(xe){if(ie&&xe instanceof MouseEvent){xe.type=="mouseup"&&(ie=!1);return}ie=R&&xe.type==="touchend"&&re==="touchstart",re=xe.type;var Ve=xe.currentTarget.getBoundingClientRect(),$e=y(xe,R),lt=$e.clientX,_e=$e.clientY;if(!(!lt&&!_e)){var Nt=lt-Ve.left,ze=_e-Ve.top,Z=H.computeAlignment(N,z,{minX:0,minY:0,maxX:Ve.width,maxY:Ve.height},T.bounds,ne),se=new H.Mat2D;Z.invert(se);var Le=new H.Vec2D(Nt,ze),oe=H.mapXY(se,Le),de=oe.x(),He=oe.y();switch(oe.delete(),se.delete(),Le.delete(),Z.delete(),xe.type){case"mouseout":for(var we=0,Ge=L;we<Ge.length;we++){var Be=Ge[we];Be.pointerMove(de,He)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Et=0,Bt=L;Et<Bt.length;Et++){var Be=Bt[Et];Be.pointerMove(de,He)}break}case"touchstart":case"mousedown":{for(var Rt=0,Zt=L;Rt<Zt.length;Rt++){var Be=Zt[Rt];Be.pointerDown(de,He)}break}case"touchend":case"mouseup":{for(var it=0,dt=L;it<dt.length;it++){var Be=dt[it];Be.pointerUp(de,He)}break}}}},ue=Y.bind(m);return g.addEventListener("mouseover",ue),g.addEventListener("mouseout",ue),g.addEventListener("mousemove",ue),g.addEventListener("mousedown",ue),g.addEventListener("mouseup",ue),g.addEventListener("touchmove",ue,{passive:R}),g.addEventListener("touchstart",ue,{passive:R}),g.addEventListener("touchend",ue),function(){g.removeEventListener("mouseover",ue),g.removeEventListener("mouseout",ue),g.removeEventListener("mousemove",ue),g.removeEventListener("mousedown",ue),g.removeEventListener("mouseup",ue),g.removeEventListener("touchmove",ue),g.removeEventListener("touchstart",ue),g.removeEventListener("touchend",ue)}}}),((c,f,v)=>{v.r(f),v.d(f,{BLANK_URL:()=>M,sanitizeUrl:()=>H});var m=/^([^\w]*)(javascript|data|vbscript)/im,y=/&#(\w+)(^\w|;)?/g,E=/&(newline|tab);/gi,A=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,T=[".","/"],M="about:blank";function L(N){return T.indexOf(N[0])>-1}function q(N){var z=N.replace(A,"");return z.replace(y,function(G,R){return String.fromCharCode(R)})}function H(N){if(!N)return M;var z=q(N).replace(E,"").replace(A,"").trim();if(!z)return M;if(L(z))return z;var G=z.match(g);if(!G)return z;var R=G[0];return m.test(R)?M:z}}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>q,AudioWrapper:()=>A,CustomFileAssetLoaderWrapper:()=>T,FileAssetWrapper:()=>M,Finalizable:()=>y,FontAssetWrapper:()=>H,FontWrapper:()=>g,ImageAssetWrapper:()=>L,ImageWrapper:()=>E,finalizationRegistry:()=>G});var m=(function(){var R=function(x,ne){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(re,ie){re.__proto__=ie}||function(re,ie){for(var Y in ie)Object.prototype.hasOwnProperty.call(ie,Y)&&(re[Y]=ie[Y])},R(x,ne)};return function(x,ne){if(typeof ne!="function"&&ne!==null)throw new TypeError("Class extends value "+String(ne)+" is not a constructor or null");R(x,ne);function re(){this.constructor=x}x.prototype=ne===null?Object.create(ne):(re.prototype=ne.prototype,new re)}})(),y=(function(){function R(){this.selfUnref=!1}return R})(),E=(function(R){m(x,R);function x(ne){var re=R.call(this)||this;return re._nativeImage=ne,re}return Object.defineProperty(x.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},x})(y),A=(function(R){m(x,R);function x(ne){var re=R.call(this)||this;return re._nativeAudio=ne,re}return Object.defineProperty(x.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},x})(y),g=(function(R){m(x,R);function x(ne){var re=R.call(this)||this;return re._nativeFont=ne,re}return Object.defineProperty(x.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},x})(y),T=(function(){function R(x,ne){this._assetLoaderCallback=ne,this.assetLoader=new x.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return R.prototype.loadContents=function(x,ne){var re;return x.isImage?re=new L(x):x.isAudio?re=new q(x):x.isFont&&(re=new H(x)),this._assetLoaderCallback(re,ne)},R})(),M=(function(){function R(x){this._nativeFileAsset=x}return R.prototype.decode=function(x){this._nativeFileAsset.decode(x)},Object.defineProperty(R.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),R})(),L=(function(R){m(x,R);function x(){return R!==null&&R.apply(this,arguments)||this}return x.prototype.setRenderImage=function(ne){this._nativeFileAsset.setRenderImage(ne.nativeImage)},x})(M),q=(function(R){m(x,R);function x(){return R!==null&&R.apply(this,arguments)||this}return x.prototype.setAudioSource=function(ne){this._nativeFileAsset.setAudioSource(ne.nativeAudio)},x})(M),H=(function(R){m(x,R);function x(){return R!==null&&R.apply(this,arguments)||this}return x.prototype.setFont=function(ne){this._nativeFileAsset.setFont(ne.nativeFont)},x})(M),N=(function(){function R(x){}return R.prototype.register=function(x){x.selfUnref=!0},R.prototype.unregister=function(x){},R})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:N,G=new z(function(R){R.unref()})})],r={};function o(c){var f=r[c];if(f!==void 0)return f.exports;var v=r[c]={exports:{}};return t[c](v,v.exports,o),v.exports}o.d=(c,f)=>{for(var v in f)o.o(f,v)&&!o.o(c,v)&&Object.defineProperty(c,v,{enumerable:!0,get:f[v]})},o.o=(c,f)=>Object.prototype.hasOwnProperty.call(c,f),o.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})};var u={};return(()=>{o.r(u),o.d(u,{Alignment:()=>H,DataEnum:()=>He,EventType:()=>Y,Fit:()=>q,Layout:()=>N,LoopType:()=>ue,Rive:()=>oe,RiveEventType:()=>x,RiveFile:()=>Le,RuntimeLoader:()=>z,StateMachineInput:()=>R,StateMachineInputType:()=>G,Testing:()=>kr,ViewModel:()=>de,ViewModelInstance:()=>Ge,ViewModelInstanceArtboard:()=>Ot,ViewModelInstanceAssetImage:()=>Tn,ViewModelInstanceBoolean:()=>Rt,ViewModelInstanceColor:()=>Wt,ViewModelInstanceEnum:()=>it,ViewModelInstanceList:()=>dt,ViewModelInstanceNumber:()=>Bt,ViewModelInstanceString:()=>Et,ViewModelInstanceTrigger:()=>Zt,ViewModelInstanceValue:()=>Be,decodeAudio:()=>zn,decodeFont:()=>_t,decodeImage:()=>mt});var c=o(1),f=o(2),v=o(3),m=o(5),y=(function(){var p=function(a,h){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,C){w.__proto__=C}||function(w,C){for(var j in C)Object.prototype.hasOwnProperty.call(C,j)&&(w[j]=C[j])},p(a,h)};return function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");p(a,h);function w(){this.constructor=a}a.prototype=h===null?Object.create(h):(w.prototype=h.prototype,new w)}})(),E=function(){return E=Object.assign||function(p){for(var a,h=1,w=arguments.length;h<w;h++){a=arguments[h];for(var C in a)Object.prototype.hasOwnProperty.call(a,C)&&(p[C]=a[C])}return p},E.apply(this,arguments)},A=function(p,a,h,w){function C(j){return j instanceof h?j:new h(function(F){F(j)})}return new(h||(h=Promise))(function(j,F){function te(me){try{ee(w.next(me))}catch(Ie){F(Ie)}}function le(me){try{ee(w.throw(me))}catch(Ie){F(Ie)}}function ee(me){me.done?j(me.value):C(me.value).then(te,le)}ee((w=w.apply(p,a||[])).next())})},g=function(p,a){var h={label:0,sent:function(){if(j[0]&1)throw j[1];return j[1]},trys:[],ops:[]},w,C,j,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=te(0),F.throw=te(1),F.return=te(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function te(ee){return function(me){return le([ee,me])}}function le(ee){if(w)throw new TypeError("Generator is already executing.");for(;F&&(F=0,ee[0]&&(h=0)),h;)try{if(w=1,C&&(j=ee[0]&2?C.return:ee[0]?C.throw||((j=C.return)&&j.call(C),0):C.next)&&!(j=j.call(C,ee[1])).done)return j;switch(C=0,j&&(ee=[ee[0]&2,j.value]),ee[0]){case 0:case 1:j=ee;break;case 4:return h.label++,{value:ee[1],done:!1};case 5:h.label++,C=ee[1],ee=[0];continue;case 7:ee=h.ops.pop(),h.trys.pop();continue;default:if(j=h.trys,!(j=j.length>0&&j[j.length-1])&&(ee[0]===6||ee[0]===2)){h=0;continue}if(ee[0]===3&&(!j||ee[1]>j[0]&&ee[1]<j[3])){h.label=ee[1];break}if(ee[0]===6&&h.label<j[1]){h.label=j[1],j=ee;break}if(j&&h.label<j[2]){h.label=j[2],h.ops.push(ee);break}j[2]&&h.ops.pop(),h.trys.pop();continue}ee=a.call(p,h)}catch(me){ee=[6,me],C=0}finally{w=j=0}if(ee[0]&5)throw ee[1];return{value:ee[0]?ee[1]:void 0,done:!0}}},T=function(p,a,h){if(h||arguments.length===2)for(var w=0,C=a.length,j;w<C;w++)(j||!(w in a))&&(j||(j=Array.prototype.slice.call(a,0,w)),j[w]=a[w]);return p.concat(j||Array.prototype.slice.call(a))},M=(function(p){y(a,p);function a(){var h=p!==null&&p.apply(this,arguments)||this;return h.isHandledError=!0,h}return a})(Error),L=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},q;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(q||(q={}));var H;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(H||(H={}));var N=(function(){function p(a){var h,w,C,j,F,te,le;this.fit=(h=a?.fit)!==null&&h!==void 0?h:q.Contain,this.alignment=(w=a?.alignment)!==null&&w!==void 0?w:H.Center,this.layoutScaleFactor=(C=a?.layoutScaleFactor)!==null&&C!==void 0?C:1,this.minX=(j=a?.minX)!==null&&j!==void 0?j:0,this.minY=(F=a?.minY)!==null&&F!==void 0?F:0,this.maxX=(te=a?.maxX)!==null&&te!==void 0?te:0,this.maxY=(le=a?.maxY)!==null&&le!==void 0?le:0}return p.new=function(a){var h=a.fit,w=a.alignment,C=a.minX,j=a.minY,F=a.maxX,te=a.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:h,alignment:w,minX:C,minY:j,maxX:F,maxY:te})},p.prototype.copyWith=function(a){var h=a.fit,w=a.alignment,C=a.layoutScaleFactor,j=a.minX,F=a.minY,te=a.maxX,le=a.maxY;return new p({fit:h??this.fit,alignment:w??this.alignment,layoutScaleFactor:C??this.layoutScaleFactor,minX:j??this.minX,minY:F??this.minY,maxX:te??this.maxX,maxY:le??this.maxY})},p.prototype.runtimeFit=function(a){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var h;return this.fit===q.Cover?h=a.Fit.cover:this.fit===q.Contain?h=a.Fit.contain:this.fit===q.Fill?h=a.Fit.fill:this.fit===q.FitWidth?h=a.Fit.fitWidth:this.fit===q.FitHeight?h=a.Fit.fitHeight:this.fit===q.ScaleDown?h=a.Fit.scaleDown:this.fit===q.Layout?h=a.Fit.layout:h=a.Fit.none,this.cachedRuntimeFit=h,h},p.prototype.runtimeAlignment=function(a){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var h;return this.alignment===H.TopLeft?h=a.Alignment.topLeft:this.alignment===H.TopCenter?h=a.Alignment.topCenter:this.alignment===H.TopRight?h=a.Alignment.topRight:this.alignment===H.CenterLeft?h=a.Alignment.centerLeft:this.alignment===H.CenterRight?h=a.Alignment.centerRight:this.alignment===H.BottomLeft?h=a.Alignment.bottomLeft:this.alignment===H.BottomCenter?h=a.Alignment.bottomCenter:this.alignment===H.BottomRight?h=a.Alignment.bottomRight:h=a.Alignment.center,this.cachedRuntimeAlignment=h,h},p})(),z=(function(){function p(){}return p.loadRuntime=function(){c.default({locateFile:function(){return p.wasmURL}}).then(function(a){var h;for(p.runtime=a;p.callBackQueue.length>0;)(h=p.callBackQueue.shift())===null||h===void 0||h(p.runtime)}).catch(function(a){var h={message:a?.message||"Unknown error",type:a?.name||"Error",wasmError:a instanceof WebAssembly.CompileError||a instanceof WebAssembly.RuntimeError,originalError:a};console.debug("Rive WASM load error details:",h);var w="https://cdn.jsdelivr.net/npm/".concat(f.name,"@").concat(f.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(h.message,"), trying jsdelivr as a backup")),p.setWasmUrl(w),p.loadRuntime();else{var C=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(h.type),"- Message: ".concat(h.message),"- WebAssembly-specific error: ".concat(h.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(C)}})},p.getInstance=function(a){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?a(p.runtime):p.callBackQueue.push(a)},p.awaitInstance=function(){return new Promise(function(a){return p.getInstance(function(h){return a(h)})})},p.setWasmUrl=function(a){p.wasmURL=a},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(f.name,"@").concat(f.version,"/rive.wasm"),p})(),G;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(G||(G={}));var R=(function(){function p(a,h){this.type=a,this.runtimeInput=h}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(a){this.runtimeInput.value=a},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===G.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),x;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(x||(x={}));var ne=(function(){function p(a){this.nativeArtboard=a}return p})(),re=(function(){function p(a,h,w,C){this.stateMachine=a,this.playing=w,this.artboard=C,this.inputs=[],this.instance=new h.StateMachineInstance(a,C),this.initInputs(h)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var a=[],h=0;h<this.instance.stateChangedCount();h++)a.push(this.instance.stateChangedNameByIndex(h));return a},enumerable:!1,configurable:!0}),p.prototype.advance=function(a){this.instance.advance(a)},p.prototype.advanceAndApply=function(a){this.instance.advanceAndApply(a)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(a){return this.instance.reportedEventAt(a)},p.prototype.initInputs=function(a){for(var h=0;h<this.instance.inputCount();h++){var w=this.instance.input(h);this.inputs.push(this.mapRuntimeInput(w,a))}},p.prototype.mapRuntimeInput=function(a,h){if(a.type===h.SMIInput.bool)return new R(G.Boolean,a.asBool());if(a.type===h.SMIInput.number)return new R(G.Number,a.asNumber());if(a.type===h.SMIInput.trigger)return new R(G.Trigger,a.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(a){a.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(a){a.runtimeInstance!=null&&this.instance.bindViewModelInstance(a.runtimeInstance)},p})(),ie=(function(){function p(a,h,w,C,j){C===void 0&&(C=[]),j===void 0&&(j=[]),this.runtime=a,this.artboard=h,this.eventManager=w,this.animations=C,this.stateMachines=j}return p.prototype.add=function(a,h,w){if(w===void 0&&(w=!0),a=st(a),a.length===0)this.animations.forEach(function(We){return We.playing=h}),this.stateMachines.forEach(function(We){return We.playing=h});else for(var C=this.animations.map(function(We){return We.name}),j=this.stateMachines.map(function(We){return We.name}),F=0;F<a.length;F++){var te=C.indexOf(a[F]),le=j.indexOf(a[F]);if(te>=0||le>=0)te>=0?this.animations[te].playing=h:this.stateMachines[le].playing=h;else{var ee=this.artboard.animationByName(a[F]);if(ee){var me=new v.Animation(ee,this.artboard,this.runtime,h);me.advance(0),me.apply(1),this.animations.push(me)}else{var Ie=this.artboard.stateMachineByName(a[F]);if(Ie){var Qe=new re(Ie,this.runtime,h,this.artboard);this.stateMachines.push(Qe)}}}}return w&&(h?this.eventManager.fire({type:Y.Play,data:this.playing}):this.eventManager.fire({type:Y.Pause,data:this.paused})),h?this.playing:this.paused},p.prototype.initLinearAnimations=function(a,h){for(var w=this.animations.map(function(le){return le.name}),C=0;C<a.length;C++){var j=w.indexOf(a[C]);if(j>=0)this.animations[j].playing=h;else{var F=this.artboard.animationByName(a[C]);if(F){var te=new v.Animation(F,this.artboard,this.runtime,h);te.advance(0),te.apply(1),this.animations.push(te)}else console.error("Animation with name ".concat(a[C]," not found."))}}},p.prototype.initStateMachines=function(a,h){for(var w=this.stateMachines.map(function(le){return le.name}),C=0;C<a.length;C++){var j=w.indexOf(a[C]);if(j>=0)this.stateMachines[j].playing=h;else{var F=this.artboard.stateMachineByName(a[C]);if(F){var te=new re(F,this.runtime,h,this.artboard);this.stateMachines.push(te),h||te.advanceAndApply(0)}else console.warn("State Machine with name ".concat(a[C]," not found.")),this.initLinearAnimations([a[C]],h)}}},p.prototype.play=function(a){return this.add(a,!0)},p.prototype.pause=function(a){return this.add(a,!1)},p.prototype.scrub=function(a,h){var w=this.animations.filter(function(C){return a.includes(C.name)});return w.forEach(function(C){return C.scrubTo=h}),w.map(function(C){return C.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(a){return a.playing}).map(function(a){return a.name}).concat(this.stateMachines.filter(function(a){return a.playing}).map(function(a){return a.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(a){return!a.playing}).map(function(a){return a.name}).concat(this.stateMachines.filter(function(a){return!a.playing}).map(function(a){return a.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(a){var h=this;a=st(a);var w=[];if(a.length===0)w=this.animations.map(function(F){return F.name}).concat(this.stateMachines.map(function(F){return F.name})),this.animations.forEach(function(F){return F.cleanup()}),this.stateMachines.forEach(function(F){return F.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var C=this.animations.filter(function(F){return a.includes(F.name)});C.forEach(function(F){F.cleanup(),h.animations.splice(h.animations.indexOf(F),1)});var j=this.stateMachines.filter(function(F){return a.includes(F.name)});j.forEach(function(F){F.cleanup(),h.stateMachines.splice(h.stateMachines.indexOf(F),1)}),w=C.map(function(F){return F.name}).concat(j.map(function(F){return F.name}))}return this.eventManager.fire({type:Y.Stop,data:w}),w},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(a,h){return a||h.playing},!1)||this.stateMachines.reduce(function(a,h){return a||h.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(a,h){h===void 0&&(h=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],a,h):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],a,h)),w},p.prototype.handleLooping=function(){for(var a=0,h=this.animations.filter(function(C){return C.playing});a<h.length;a++){var w=h[a];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:Y.Loop,data:{animation:w.name,type:ue.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:Y.Loop,data:{animation:w.name,type:ue.PingPong}}),w.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var a=[],h=0,w=this.stateMachines.filter(function(j){return j.playing});h<w.length;h++){var C=w[h];a.push.apply(a,C.statesChanged)}a.length>0&&this.eventManager.fire({type:Y.StateChange,data:a})},p.prototype.handleAdvancing=function(a){this.eventManager.fire({type:Y.Advance,data:a})},p})(),Y;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(Y||(Y={}));var ue;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(ue||(ue={}));var xe=(function(){function p(a){a===void 0&&(a=[]),this.listeners=a}return p.prototype.getListeners=function(a){return this.listeners.filter(function(h){return h.type===a})},p.prototype.add=function(a){this.listeners.includes(a)||this.listeners.push(a)},p.prototype.remove=function(a){for(var h=0;h<this.listeners.length;h++){var w=this.listeners[h];if(w.type===a.type&&w.callback===a.callback){this.listeners.splice(h,1);break}}},p.prototype.removeAll=function(a){var h=this;a?this.listeners.filter(function(w){return w.type===a}).forEach(function(w){return h.remove(w)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(a){var h=this.getListeners(a.type);h.forEach(function(w){return w.callback(a)})},p})(),Ve=(function(){function p(a){this.eventManager=a,this.queue=[]}return p.prototype.add=function(a){this.queue.push(a)},p.prototype.process=function(){for(;this.queue.length>0;){var a=this.queue.shift();a?.action&&a.action(),a?.event&&this.eventManager.fire(a.event)}},p})(),$e;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})($e||($e={}));var lt=(function(p){y(a,p);function a(){var h=p!==null&&p.apply(this,arguments)||this;return h._started=!1,h._enabled=!1,h._status=$e.UNAVAILABLE,h}return a.prototype.delay=function(h){return A(this,void 0,void 0,function(){return g(this,function(w){return[2,new Promise(function(C){return setTimeout(C,h)})]})})},a.prototype.timeout=function(){return A(this,void 0,void 0,function(){return g(this,function(h){return[2,new Promise(function(w,C){return setTimeout(C,50)})]})})},a.prototype.reportToListeners=function(){this.fire({type:Y.AudioStatusChange}),this.removeAll()},a.prototype.enableAudio=function(){return A(this,void 0,void 0,function(){return g(this,function(h){return this._enabled||(this._enabled=!0,this._status=$e.AVAILABLE,this.reportToListeners()),[2]})})},a.prototype.testAudio=function(){return A(this,void 0,void 0,function(){return g(this,function(h){switch(h.label){case 0:if(!(this._status===$e.UNAVAILABLE&&this._audioContext!==null))return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return h.sent(),this.enableAudio(),[3,4];case 3:return h.sent(),[3,4];case 4:return[2]}})})},a.prototype._establishAudio=function(){return A(this,void 0,void 0,function(){return g(this,function(h){switch(h.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),h.label=2;case 2:return this._status!==$e.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return h.sent(),[4,this.delay(1e3)];case 4:return h.sent(),[3,2];case 5:return[2]}})})},a.prototype.listenForUserAction=function(){var h=this,w=function(){return A(h,void 0,void 0,function(){return g(this,function(C){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},a.prototype.establishAudio=function(){return A(this,void 0,void 0,function(){return g(this,function(h){return this._establishAudio(),[2]})})},Object.defineProperty(a.prototype,"systemVolume",{get:function(){return this._status===$e.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),a})(xe),_e=new lt,Nt=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),ze=globalThis.ResizeObserver||Nt,Z=(function(){function p(){var a=this;this._elementsMap=new Map,this._onObservedEntry=function(h){var w=a._elementsMap.get(h.target);w!==null?w.onResize(h.target.clientWidth==0||h.target.clientHeight==0):a._resizeObserver.unobserve(h.target)},this._onObserved=function(h){h.forEach(a._onObservedEntry)},this._resizeObserver=new ze(this._onObserved)}return p.prototype.add=function(a,h){var w={onResize:h,element:a};return this._elementsMap.set(a,w),this._resizeObserver.observe(a),w},p.prototype.remove=function(a){this._resizeObserver.unobserve(a.element),this._elementsMap.delete(a.element)},p})(),se=new Z,Le=(function(){function p(a){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=a.src,this.buffer=a.buffer,a.assetLoader&&(this.assetLoader=a.assetLoader),this.enableRiveAssetCDN=typeof a.enableRiveAssetCDN=="boolean"?a.enableRiveAssetCDN:!0,this.eventManager=new xe,a.onLoad&&this.on(Y.Load,a.onLoad),a.onLoadError&&this.on(Y.LoadError,a.onLoadError)}return p.prototype.initData=function(){return A(this,void 0,void 0,function(){var a,h,w,C,j;return g(this,function(F){switch(F.label){case 0:return this.src?(a=this,[4,Hn(this.src)]):[3,2];case 1:a.buffer=F.sent(),F.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),h=w.assetLoader),C=this,[4,this.runtime.load(new Uint8Array(this.buffer),h,this.enableRiveAssetCDN)]);case 3:return C.file=F.sent(),this.destroyed?((j=this.file)===null||j===void 0||j.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Y.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return A(this,void 0,void 0,function(){var a,h;return g(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),a=this,[4,z.awaitInstance()];case 2:return a.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return h=w.sent(),this.fireLoadError(h instanceof Error?h.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(a){throw this.eventManager.fire({type:Y.LoadError,data:a}),new Error(a)},p.prototype.on=function(a,h){this.eventManager.add({type:a,callback:h})},p.prototype.off=function(a,h){this.eventManager.remove({type:a,callback:h})},p.prototype.cleanup=function(){var a;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(a=this.file)===null||a===void 0||a.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(a){this.eventManager.removeAll(a)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(a){var h=this.file.artboardByName(a);return h!=null?new ne(h):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),oe=(function(){function p(a){var h=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(C){var j=h._hasZeroSize!==C;h._hasZeroSize=C,C?(!h._layout.maxX||!h._layout.maxY)&&h.resizeToCanvas():j&&h.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=a.canvas,a.canvas.constructor===HTMLCanvasElement&&(this._observed=se.add(this.canvas,this.onCanvasResize)),this.src=a.src,this.buffer=a.buffer,this.riveFile=a.riveFile,this.layout=(w=a.layout)!==null&&w!==void 0?w:new N,this.shouldDisableRiveListeners=!!a.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!a.isTouchScrollEnabled,this.automaticallyHandleEvents=!!a.automaticallyHandleEvents,this.enableRiveAssetCDN=a.enableRiveAssetCDN===void 0?!0:a.enableRiveAssetCDN,this.eventManager=new xe,a.onLoad&&this.on(Y.Load,a.onLoad),a.onLoadError&&this.on(Y.LoadError,a.onLoadError),a.onPlay&&this.on(Y.Play,a.onPlay),a.onPause&&this.on(Y.Pause,a.onPause),a.onStop&&this.on(Y.Stop,a.onStop),a.onLoop&&this.on(Y.Loop,a.onLoop),a.onStateChange&&this.on(Y.StateChange,a.onStateChange),a.onAdvance&&this.on(Y.Advance,a.onAdvance),a.onload&&!a.onLoad&&this.on(Y.Load,a.onload),a.onloaderror&&!a.onLoadError&&this.on(Y.LoadError,a.onloaderror),a.onplay&&!a.onPlay&&this.on(Y.Play,a.onplay),a.onpause&&!a.onPause&&this.on(Y.Pause,a.onpause),a.onstop&&!a.onStop&&this.on(Y.Stop,a.onstop),a.onloop&&!a.onLoop&&this.on(Y.Loop,a.onloop),a.onstatechange&&!a.onStateChange&&this.on(Y.StateChange,a.onstatechange),a.assetLoader&&(this.assetLoader=a.assetLoader),this.taskQueue=new Ve(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:a.autoplay,autoBind:a.autoBind,animations:a.animations,stateMachines:a.stateMachines,artboard:a.artboard,useOffscreenRenderer:a.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(a){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(a)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(a){var h=this,w=a.src,C=a.buffer,j=a.riveFile,F=a.animations,te=a.stateMachines,le=a.artboard,ee=a.autoplay,me=ee===void 0?!1:ee,Ie=a.useOffscreenRenderer,Qe=Ie===void 0?!1:Ie,We=a.autoBind,jt=We===void 0?!1:We;if(!this.destroyed){if(this.src=w,this.buffer=C,this.riveFile=j,!this.src&&!this.buffer&&!this.riveFile)throw new M(p.missingErrorMessage);var At=st(F),ft=st(te);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(vt){h.destroyed||(h.runtime=vt,h.removeRiveListeners(),h.deleteRiveRenderer(),h.renderer=h.runtime.makeRenderer(h.canvas,Qe),h.canvas.width||h.canvas.height||h.resizeDrawingSurfaceToCanvas(),h.initData(le,At,ft,me,jt).then(function(kt){if(kt)return h.setupRiveListeners()}).catch(function(kt){console.error(kt)}))}).catch(function(vt){console.error(vt)})}},p.prototype.setupRiveListeners=function(a){var h=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(j){return j.playing&&h.runtime.hasListeners(j.instance)}).map(function(j){return j.instance}),C=this.isTouchScrollEnabled;a&&"isTouchScrollEnabled"in a&&(C=a.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:C,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var a=this,h;_e.status==$e.UNAVAILABLE&&!((h=this.artboard)===null||h===void 0)&&h.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Y.AudioStatusChange,callback:function(){return a.onSystemAudioChanged()}},_e.add(this._audioEventListener),_e.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(a,h,w,C,j){return A(this,void 0,void 0,function(){var F,te,le,ee;return g(this,function(me){switch(me.label){case 0:return me.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(F=new Le({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=F,[4,F.init()]);case 1:if(me.sent(),this.destroyed)return F.destroyIfUnused(),[2,!1];me.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(a,h,w,C,j),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Y.Load,data:(ee=this.src)!==null&&ee!==void 0?ee:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return te=me.sent(),le=L(te),console.warn(le),this.eventManager.fire({type:Y.LoadError,data:le}),[2,Promise.reject(le)];case 4:return[2]}})})},p.prototype.initArtboard=function(a,h,w,C,j){if(this.file){var F=a?this.file.artboardByName(a):this.file.defaultArtboard();if(!F){var te="Invalid artboard name or no default artboard";console.warn(te),this.eventManager.fire({type:Y.LoadError,data:te});return}if(this.artboard=F,F.volume=this._volume*_e.systemVolume,this.artboard.animationCount()<1){var te="Artboard has no animations";throw this.eventManager.fire({type:Y.LoadError,data:te}),te}this.animator=new ie(this.runtime,this.artboard,this.eventManager);var le;if(h.length>0||w.length>0?(le=h.concat(w),this.animator.initLinearAnimations(h,C),this.animator.initStateMachines(w,C)):le=[this.animator.atLeastOne(C,!1)],this.taskQueue.add({event:{type:C?Y.Play:Y.Pause,data:le}}),j){var ee=this.file.defaultArtboardViewModel(F);if(ee!==null){var me=ee.defaultInstance();if(me!==null){var Ie=new Ge(me,null);this.bindViewModelInstance(Ie)}}}}},p.prototype.drawFrame=function(){var a,h;!((a=document?.timeline)===null||a===void 0)&&a.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(h=this.runtime)===null||h===void 0||h.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(a,h){var w;this.frameRequestId=null;var C=performance.now();this.lastRenderTime||(this.lastRenderTime=a),this.renderSecondTimer+=a-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,h?.());var j=(a-this.lastRenderTime)/1e3;this.lastRenderTime=a;for(var F=this.animator.animations.filter(function(qt){return qt.playing||qt.needsScrub}).sort(function(qt){return qt.needsScrub?-1:1}),te=0,le=F;te<le.length;te++){var ee=le[te];ee.advance(j),ee.instance.didLoop&&(ee.loopCount+=1),ee.apply(1)}for(var me=this.animator.stateMachines.filter(function(qt){return qt.playing}),Ie=0,Qe=me;Ie<Qe.length;Ie++){var We=Qe[Ie],jt=We.reportedEventCount();if(jt)for(var At=0;At<jt;At++){var ft=We.reportedEventAt(At);if(ft)if(ft.type===x.OpenUrl){if(this.eventManager.fire({type:Y.RiveEvent,data:ft}),this.automaticallyHandleEvents){var vt=document.createElement("a"),kt=ft,fn=kt.url,vn=kt.target,Vt=(0,m.sanitizeUrl)(fn);fn&&vt.setAttribute("href",Vt),vn&&vt.setAttribute("target",vn),Vt&&Vt!==m.BLANK_URL&&vt.click()}}else this.eventManager.fire({type:Y.RiveEvent,data:ft})}We.advanceAndApply(j)}this.animator.stateMachines.length==0&&this.artboard.advance(j);var ae=this.renderer;ae.clear(),ae.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(ae),ae.restore(),ae.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(j),this.frameCount++;var Se=performance.now();for(this.frameTimes.push(Se),this.durations.push(Se-C);this.frameTimes[0]<=Se-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var a=this,h=a.renderer,w=a.runtime,C=a._layout,j=a.artboard;h.align(C.runtimeFit(w),C.runtimeAlignment(w),{minX:C.minX,minY:C.minY,maxX:C.maxX,maxY:C.maxY},j.bounds,this._devicePixelRatioUsed*C.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(a,h){return a+h},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var a,h;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&se.remove(this._observed),this.removeRiveListeners(),this.file&&((a=this.riveFile)===null||a===void 0||a.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(_e.remove(this._audioEventListener),this._audioEventListener=null),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var a;(a=this.renderer)===null||a===void 0||a.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(a){var h;if(!a){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(a);if(!w){console.warn("Could not access a text run with name '".concat(a,"' in the '").concat((h=this.artboard)===null||h===void 0?void 0:h.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},p.prototype.getTextRunValue=function(a){var h=this.retrieveTextRun(a);return h?h.text:void 0},p.prototype.setTextRunValue=function(a,h){var w=this.retrieveTextRun(a);w&&(w.text=h)},p.prototype.play=function(a,h){var w=this;if(a=st(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(a,h)}});return}this.animator.play(a),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(a){var h=this;if(a=st(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.pause(a)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(a)},p.prototype.scrub=function(a,h){var w=this;if(a=st(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(a,h)}});return}this.animator.scrub(a,h||0),this.drawFrame()},p.prototype.stop=function(a){var h=this;if(a=st(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.stop(a)}});return}this.animator&&this.animator.stop(a),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(a){var h,w,C=a?.artboard,j=st(a?.animations),F=st(a?.stateMachines),te=(h=a?.autoplay)!==null&&h!==void 0?h:!1,le=(w=a?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(C,j,F,te,le),this.taskQueue.process()},p.prototype.load=function(a){this.file=null,this.stop(),this.init(a)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(a){this._layout=a,(!a.maxX||!a.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(a){if(this.canvas instanceof HTMLCanvasElement&&window){var h=this.canvas.getBoundingClientRect(),w=h.width,C=h.height,j=a||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=j,this.canvas.width=j*w,this.canvas.height=j*C,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===q.Layout){var F=this._layout.layoutScaleFactor;this.artboard.width=w/F,this.artboard.height=C/F}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var a=[],h=0;h<this.artboard.animationCount();h++)a.push(this.artboard.animationByIndex(h).name);return a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var a=[],h=0;h<this.artboard.stateMachineCount();h++)a.push(this.artboard.stateMachineByIndex(h).name);return a},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(a){if(this.loaded){var h=this.animator.stateMachines.find(function(w){return w.name===a});return h?.inputs}},p.prototype.retrieveInputAtPath=function(a,h){if(!a){console.warn("No input name provided for path '".concat(h,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(a,"', at path: '").concat(h,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(a,h);if(!w){console.warn("Could not access an input with name: '".concat(a,"', at path:'").concat(h,"'"));return}return w},p.prototype.setBooleanStateAtPath=function(a,h,w){var C=this.retrieveInputAtPath(a,w);C&&(C.type===G.Boolean?C.asBool().value=h:console.warn("Input with name: '".concat(a,"', at path:'").concat(w,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(a,h,w){var C=this.retrieveInputAtPath(a,w);C&&(C.type===G.Number?C.asNumber().value=h:console.warn("Input with name: '".concat(a,"', at path:'").concat(w,"' is not a number")))},p.prototype.fireStateAtPath=function(a,h){var w=this.retrieveInputAtPath(a,h);w&&(w.type===G.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(a,"', at path:'").concat(h,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(a,h){if(!a){console.warn("No text name provided for path '".concat(h,"'"));return}if(!h){console.warn("No path provided for text '".concat(a,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(a,"', at path: '").concat(h,"', but the Artboard is null"));return}var w=this.artboard.textByPath(a,h);if(!w){console.warn("Could not access text with name: '".concat(a,"', at path:'").concat(h,"'"));return}return w},p.prototype.getTextRunValueAtPath=function(a,h){var w=this.retrieveTextAtPath(a,h);if(!w){console.warn("Could not get text with name: '".concat(a,"', at path:'").concat(h,"'"));return}return w.text},p.prototype.setTextRunValueAtPath=function(a,h,w){var C=this.retrieveTextAtPath(a,w);if(!C){console.warn("Could not set text with name: '".concat(a,"', at path:'").concat(w,"'"));return}C.text=h},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(a){return a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(a){return a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(a){return!a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(a){return!a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(a,h){this.eventManager.add({type:a,callback:h})},p.prototype.off=function(a,h){this.eventManager.remove({type:a,callback:h})},p.prototype.unsubscribe=function(a,h){console.warn("This function is deprecated: please use `off()` instead."),this.off(a,h)},p.prototype.removeAllRiveEventListeners=function(a){this.eventManager.removeAll(a)},p.prototype.unsubscribeAll=function(a){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(a)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(a){this.runtime.enableFPSCounter(a)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var a={artboards:[]},h=0;h<this.file.artboardCount();h++){for(var w=this.file.artboardByIndex(h),C={name:w.name,animations:[],stateMachines:[]},j=0;j<w.animationCount();j++){var F=w.animationByIndex(j);C.animations.push(F.name)}for(var te=0;te<w.stateMachineCount();te++){for(var le=w.stateMachineByIndex(te),ee=le.name,me=new this.runtime.StateMachineInstance(le,w),Ie=[],Qe=0;Qe<me.inputCount();Qe++){var We=me.input(Qe);Ie.push({name:We.name,type:We.type})}C.stateMachines.push({name:ee,inputs:Ie})}a.artboards.push(C)}return a}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(a){this._volume=a,this.artboard&&(this.artboard.volume=a*_e.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var a;return this.artboard?this.artboard.width:(a=this._artboardWidth)!==null&&a!==void 0?a:0},set:function(a){this._artboardWidth=a,this.artboard&&(this.artboard.width=a)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var a;return this.artboard?this.artboard.height:(a=this._artboardHeight)!==null&&a!==void 0?a:0},set:function(a){this._artboardHeight=a,this.artboard&&(this.artboard.height=a)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(a){this._devicePixelRatioUsed=a},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(a){var h;this.artboard&&!this.destroyed&&a&&a.runtimeInstance&&(a.internalIncrementReferenceCount(),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=a,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(a)}):this.artboard.bindViewModelInstance(a.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(a){var h=this.file.viewModelByIndex(a);return h!==null?new de(h):null},p.prototype.viewModelByName=function(a){var h=this.file.viewModelByName(a);return h!==null?new de(h):null},p.prototype.enums=function(){if(this._dataEnums===null){var a=this.file.enums();this._dataEnums=a.map(function(h){return new He(h)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var a=this.file.defaultArtboardViewModel(this.artboard);if(a)return new de(a)}return null},p.prototype.getArtboard=function(a){var h,w;return(w=(h=this.riveFile)===null||h===void 0?void 0:h.getArtboard(a))!==null&&w!==void 0?w:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),de=(function(){function p(a){this._viewModel=a}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(a){var h=this._viewModel.instanceByIndex(a);return h!==null?new Ge(h,null):null},p.prototype.instanceByName=function(a){var h=this._viewModel.instanceByName(a);return h!==null?new Ge(h,null):null},p.prototype.defaultInstance=function(){var a=this._viewModel.defaultInstance();return a!==null?new Ge(a,null):null},p.prototype.instance=function(){var a=this._viewModel.instance();return a!==null?new Ge(a,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),He=(function(){function p(a){this._dataEnum=a}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),we;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(we||(we={}));var Ge=(function(){function p(a,h){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=a,h!==null&&this._parents.push(h)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(a){a.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(a){a.clearChanges()})),this._children.forEach(function(a){return a.handleCallbacks()})},p.prototype.addParent=function(a){this._parents.includes(a)||(this._parents.push(a),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&a.addToViewModelCallbacks(this))},p.prototype.removeParent=function(a){var h=this._parents.indexOf(a);if(h!==-1){var w=this._parents[h];w.removeFromViewModelCallbacks(this),this._parents.splice(h,1)}},p.prototype.addToPropertyCallbacks=function(a){var h=this;this._propertiesWithCallbacks.includes(a)||(this._propertiesWithCallbacks.push(a),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(h)}))},p.prototype.removeFromPropertyCallbacks=function(a){var h=this;this._propertiesWithCallbacks.includes(a)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==a}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(h)}))},p.prototype.addToViewModelCallbacks=function(a){var h=this;this._children.includes(a)||(this._children.push(a),this._parents.forEach(function(w){w.addToViewModelCallbacks(h)}))},p.prototype.removeFromViewModelCallbacks=function(a){var h=this;this._children.includes(a)&&(this._children=this._children.filter(function(w){return w!==a}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(h)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(a){a.clearCallbacks()})},p.prototype.propertyFromPath=function(a,h){var w=a.split("/");return this.propertyFromPathSegments(w,0,h)},p.prototype.viewModelFromPathSegments=function(a,h){var w=this.internalViewModelInstance(a[h]);return w!==null?h==a.length-1?w:w.viewModelFromPathSegments(a,h++):null},p.prototype.propertyFromPathSegments=function(a,h,w){var C,j,F,te,le,ee,me,Ie,Qe,We,jt,At,ft,vt,kt,fn,vn,Vt;if(h<a.length-1){var ae=this.internalViewModelInstance(a[h]);return ae!==null?ae.propertyFromPathSegments(a,h+1,w):null}var Se=null;switch(w){case we.Number:if(Se=(j=(C=this._runtimeInstance)===null||C===void 0?void 0:C.number(a[h]))!==null&&j!==void 0?j:null,Se!==null)return new Bt(Se,this);break;case we.String:if(Se=(te=(F=this._runtimeInstance)===null||F===void 0?void 0:F.string(a[h]))!==null&&te!==void 0?te:null,Se!==null)return new Et(Se,this);break;case we.Boolean:if(Se=(ee=(le=this._runtimeInstance)===null||le===void 0?void 0:le.boolean(a[h]))!==null&&ee!==void 0?ee:null,Se!==null)return new Rt(Se,this);break;case we.Color:if(Se=(Ie=(me=this._runtimeInstance)===null||me===void 0?void 0:me.color(a[h]))!==null&&Ie!==void 0?Ie:null,Se!==null)return new Wt(Se,this);break;case we.Trigger:if(Se=(We=(Qe=this._runtimeInstance)===null||Qe===void 0?void 0:Qe.trigger(a[h]))!==null&&We!==void 0?We:null,Se!==null)return new Zt(Se,this);break;case we.Enum:if(Se=(At=(jt=this._runtimeInstance)===null||jt===void 0?void 0:jt.enum(a[h]))!==null&&At!==void 0?At:null,Se!==null)return new it(Se,this);break;case we.List:if(Se=(vt=(ft=this._runtimeInstance)===null||ft===void 0?void 0:ft.list(a[h]))!==null&&vt!==void 0?vt:null,Se!==null)return new dt(Se,this);break;case we.Image:if(Se=(fn=(kt=this._runtimeInstance)===null||kt===void 0?void 0:kt.image(a[h]))!==null&&fn!==void 0?fn:null,Se!==null)return new Tn(Se,this);break;case we.Artboard:if(Se=(Vt=(vn=this._runtimeInstance)===null||vn===void 0?void 0:vn.artboard(a[h]))!==null&&Vt!==void 0?Vt:null,Se!==null)return new Ot(Se,this);break}return null},p.prototype.internalViewModelInstance=function(a){var h;if(this._viewModelInstances.has(a))return this._viewModelInstances.get(a);var w=(h=this._runtimeInstance)===null||h===void 0?void 0:h.viewModel(a);if(w!==null){var C=new p(w,this);return C.internalIncrementReferenceCount(),this._viewModelInstances.set(a,C),C}return null},p.prototype.number=function(a){var h=this.propertyFromPath(a,we.Number);return h},p.prototype.string=function(a){var h=this.propertyFromPath(a,we.String);return h},p.prototype.boolean=function(a){var h=this.propertyFromPath(a,we.Boolean);return h},p.prototype.color=function(a){var h=this.propertyFromPath(a,we.Color);return h},p.prototype.trigger=function(a){var h=this.propertyFromPath(a,we.Trigger);return h},p.prototype.enum=function(a){var h=this.propertyFromPath(a,we.Enum);return h},p.prototype.list=function(a){var h=this.propertyFromPath(a,we.List);return h},p.prototype.image=function(a){var h=this.propertyFromPath(a,we.Image);return h},p.prototype.artboard=function(a){var h=this.propertyFromPath(a,we.Artboard);return h},p.prototype.viewModel=function(a){var h=a.split("/"),w=h.length>1?this.viewModelFromPathSegments(h.slice(0,h.length-1),0):this;return w!=null?w.internalViewModelInstance(h[h.length-1]):null},p.prototype.internalReplaceViewModel=function(a,h){var w;if(h.runtimeInstance!==null){var C=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(a,h.runtimeInstance))||!1;if(C){h.internalIncrementReferenceCount();var j=this.internalViewModelInstance(a);j!==null&&(j.removeParent(this),this._children.includes(j)&&(this._children=this._children.filter(function(F){return F!==j})),j.cleanup()),this._viewModelInstances.set(a,h),h.addParent(this)}return C}return!1},p.prototype.replaceViewModel=function(a,h){var w,C=a.split("/"),j=C.length>1?this.viewModelFromPathSegments(C.slice(0,C.length-1),0):this;return(w=j?.internalReplaceViewModel(C[C.length-1],h))!==null&&w!==void 0?w:!1},p.prototype.incrementReferenceCount=function(){var a;this._referenceCount++,(a=this._runtimeInstance)===null||a===void 0||a.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var a;this._referenceCount--,(a=this._runtimeInstance)===null||a===void 0||a.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var a;return((a=this._runtimeInstance)===null||a===void 0?void 0:a.getProperties().map(function(h){return E({},h)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var a=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(C){C.cleanup()}),this._viewModelInstances.clear();var h=T([],this._children,!0);this._children.length=0;var w=T([],this._parents,!0);this._parents.length=0,h.forEach(function(C){C.removeParent(a)}),w.forEach(function(C){C.removeFromViewModelCallbacks(a)})}},p})(),Be=(function(){function p(a,h){this.callbacks=[],this._viewModelInstanceValue=a,this._parentViewModel=h}return p.prototype.on=function(a){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(a)||(this.callbacks.push(a),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(a){a?this.callbacks=this.callbacks.filter(function(h){return h!==a}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(a){},p.prototype.handleCallbacks=function(){var a=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(h){a.internalHandleCallback(h)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),Et=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h(this.value)},a})(Be),Bt=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h(this.value)},a})(Be),Rt=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h(this.value)},a})(Be),Zt=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return a.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},a.prototype.internalHandleCallback=function(h){h()},a})(Be),it=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(h){this._viewModelInstanceValue.valueIndex=h},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h(this.value)},a})(Be),dt=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),a.prototype.addInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(h.runtimeInstance),h.addParent(this._parentViewModel))},a.prototype.addInstanceAt=function(h,w){return h.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(h.runtimeInstance,w)?(h.addParent(this._parentViewModel),!0):!1},a.prototype.removeInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(h.runtimeInstance),h.removeParent(this._parentViewModel))},a.prototype.removeInstanceAt=function(h){this._viewModelInstanceValue.removeInstanceAt(h)},a.prototype.instanceAt=function(h){var w=this._viewModelInstanceValue.instanceAt(h);if(w!=null){var C=new Ge(w,this._parentViewModel);return C}return null},a.prototype.swap=function(h,w){this._viewModelInstanceValue.swap(h,w)},a.prototype.internalHandleCallback=function(h){h()},a})(Be),Wt=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),a.prototype.rgb=function(h,w,C){this._viewModelInstanceValue.rgb(h,w,C)},a.prototype.rgba=function(h,w,C,j){this._viewModelInstanceValue.argb(j,h,w,C)},a.prototype.argb=function(h,w,C,j){this._viewModelInstanceValue.argb(h,w,C,j)},a.prototype.alpha=function(h){this._viewModelInstanceValue.alpha(h)},a.prototype.opacity=function(h){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,h))*255))},a.prototype.internalHandleCallback=function(h){h(this.value)},a})(Be),Tn=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{set:function(h){var w;this._viewModelInstanceValue.value((w=h?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h()},a})(Be),Ot=(function(p){y(a,p);function a(h,w){return p.call(this,h,w)||this}return Object.defineProperty(a.prototype,"value",{set:function(h){var w;this._viewModelInstanceValue.value((w=h?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(h){h()},a})(Be),Hn=function(p){return A(void 0,void 0,void 0,function(){var a,h,w;return g(this,function(C){switch(C.label){case 0:return a=new Request(p),[4,fetch(a)];case 1:return h=C.sent(),[4,h.arrayBuffer()];case 2:return w=C.sent(),[2,w]}})})},st=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},kr={EventManager:xe,TaskQueueManager:Ve},zn=function(p){return A(void 0,void 0,void 0,function(){var a,h,w;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(j){return z.getInstance(function(F){F.decodeAudio(p,j)})}),[4,a];case 1:return h=C.sent(),w=new m.AudioWrapper(h),m.finalizationRegistry.register(w,h),[2,w]}})})},mt=function(p){return A(void 0,void 0,void 0,function(){var a,h,w;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(j){return z.getInstance(function(F){F.decodeImage(p,j)})}),[4,a];case 1:return h=C.sent(),w=new m.ImageWrapper(h),m.finalizationRegistry.register(w,h),[2,w]}})})},_t=function(p){return A(void 0,void 0,void 0,function(){var a,h,w;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(j){return z.getInstance(function(F){F.decodeFont(p,j)})}),[4,a];case 1:return h=C.sent(),w=new m.FontWrapper(h),m.finalizationRegistry.register(w,h),[2,w]}})})}})(),u})())})(Pi)),Pi.exports}var Jc=Yc();const Fi="dracula",$i="https://vycjpmuyscfygstjjied.supabase.co";var Xc=Ne('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Aa(n,e){Yr(e,!0);let t=Xe(void 0);ao(()=>{if(!V(t))return;const u=new Jc.Rive({src:`${$i}/storage/v1/object/public/${Fi}/${e.fileName}`,canvas:V(t),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var r=Xc(),o=ce(r);Bc(o,u=>Me(t,u),()=>V(t)),Pe(n,r),Jr()}function Qc(n,e){V(e)?.nextDialogueId&&pt.goToDialogue(V(e).nextDialogueId)}var Zc=Ne('<img alt="BG" class="background-image svelte-ik8jti"/>'),eh=Ne('<div class="background-media svelte-ik8jti"><!></div>'),th=Ne('<img alt="Char" class="character-image svelte-ik8jti"/>'),nh=Ne('<div class="character-media svelte-ik8jti"><!></div>'),rh=(n,e,t)=>e(V(t)),ih=Ne('<button class="option-button svelte-ik8jti"> </button>'),sh=Ne('<div class="options-container svelte-ik8jti"></div>'),oh=Ne('<div class="next-container svelte-ik8jti"><button class="next-button svelte-ik8jti">Далее...</button></div>'),ah=Ne('<div class="dialogue-container svelte-ik8jti"><!> <!> <div class="dialogue-content svelte-ik8jti"><div class="dialogue-text svelte-ik8jti"> </div> <!></div></div>'),uh=Ne("<p> </p>");function Mu(n,e){Yr(e,!0);const t=su(()=>e.dialogue||pt.findDialogue(pt.currentDialogueId));Mi(()=>{V(t)?.onEnter&&pt.runActions(V(t).onEnter)});function r(m){if(m.actions&&pt.runActions(m.actions),m.miniGame){console.log("Запуск мини-игры:",m.miniGame.id),pt.goToDialogue(m.miniGame.onWinDialogueId);return}m.nextDialogueId&&pt.goToDialogue(m.nextDialogueId)}function o(m){return m.visibleIf&&m.visibleIf.hasItem?pt.hasItem(m.visibleIf.hasItem):!0}var u=Dn(),c=un(u);{var f=m=>{var y=ah(),E=ce(y);{var A=G=>{var R=eh(),x=ce(R);{var ne=ie=>{var Y=Dn(),ue=un(Y);ga(ue,()=>V(t).backgroundImage,xe=>{Aa(xe,{get fileName(){return V(t).backgroundImage}})}),Pe(ie,Y)},re=ie=>{var Y=Zc();ln(()=>_a(Y,"src",`${$i}/storage/v1/object/public/${Fi}/${V(t).backgroundImage}`)),Pe(ie,Y)};at(x,ie=>{V(t).backgroundImage.endsWith(".riv")?ie(ne):ie(re,!1)})}Pe(G,R)};at(E,G=>{V(t).backgroundImage&&G(A)})}var g=Oe(E,2);{var T=G=>{var R=nh(),x=ce(R);{var ne=ie=>{var Y=Dn(),ue=un(Y);ga(ue,()=>V(t).characterImage,xe=>{Aa(xe,{get fileName(){return V(t).characterImage}})}),Pe(ie,Y)},re=ie=>{var Y=th();ln(()=>_a(Y,"src",`${$i}/storage/v1/object/public/${Fi}/${V(t).characterImage}`)),Pe(ie,Y)};at(x,ie=>{V(t).characterImage.endsWith(".riv")?ie(ne):ie(re,!1)})}Pe(G,R)};at(g,G=>{V(t).characterImage&&G(T)})}var M=Oe(g,2),L=ce(M),q=ce(L),H=Oe(L,2);{var N=G=>{var R=sh();js(R,21,()=>V(t).options,x=>x.text,(x,ne)=>{var re=Dn(),ie=un(re);{var Y=ue=>{var xe=ih();xe.__click=[rh,r,ne];var Ve=ce(xe);ln(()=>En(Ve,V(ne).text)),Pe(ue,xe)};at(ie,ue=>{o(V(ne))&&ue(Y)})}Pe(x,re)}),Pe(G,R)},z=G=>{var R=Dn(),x=un(R);{var ne=re=>{var ie=oh(),Y=ce(ie);Y.__click=[Qc,t],Pe(re,ie)};at(x,re=>{V(t).nextDialogueId&&re(ne)},!0)}Pe(G,R)};at(H,G=>{V(t).options&&V(t).options.length>0?G(N):G(z,!1)})}ln(()=>En(q,V(t).text)),Pe(m,y)},v=m=>{var y=uh(),E=ce(y);ln(()=>En(E,`Диалог не найден (ID: ${pt.currentDialogueId??""})`)),Pe(m,y)};at(c,m=>{V(t)?m(f):m(v,!1)})}Pe(n,u),Jr()}Ou(["click"]);var lh=Ne('<div class="loading svelte-fgmugb"><p>🔄 Загрузка истории...</p></div>'),ch=Ne('<div class="error svelte-fgmugb"> </div>'),hh=Ne('<div class="dialogues-container svelte-fgmugb"><!></div>'),dh=Ne('<div class="app svelte-fgmugb"><!></div>');function fh(n,e){Yr(e,!1);let t=`${$i}/storage/v1/object/public/${Fi}/dracula_story_v2.json`;ao(async()=>{console.log("Загружаем историю из:",t),await pt.loadStory(t)}),Wc();var r=dh(),o=ce(r);{var u=f=>{var v=lh();Pe(f,v)},c=f=>{var v=Dn(),m=un(v);{var y=A=>{var g=ch(),T=ce(g);ln(()=>En(T,`⚠️ ${pt.error??""}`)),Pe(A,g)},E=A=>{var g=hh(),T=ce(g);{var M=L=>{Mu(L,{})};at(T,L=>{pt.storyData&&L(M)})}Pe(A,g)};at(m,A=>{pt.error?A(y):A(E,!1)},!0)}Pe(f,v)};at(o,f=>{pt.isLoading?f(u):f(c,!1)})}Pe(n,r),Jr()}const vh="modulepreload",ph=function(n,e){return new URL(n,e).href},ka={},Xr=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){let m=function(y){return Promise.all(y.map(E=>Promise.resolve(E).then(A=>({status:"fulfilled",value:A}),A=>({status:"rejected",reason:A}))))};const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),v=f?.nonce||f?.getAttribute("nonce");o=m(t.map(y=>{if(y=ph(y,r),y in ka)return;ka[y]=!0;const E=y.endsWith(".css"),A=E?'[rel="stylesheet"]':"";if(!!r)for(let M=c.length-1;M>=0;M--){const L=c[M];if(L.href===y&&(!E||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${A}`))return;const T=document.createElement("link");if(T.rel=E?"stylesheet":vh,E||(T.as="script"),T.crossOrigin="",T.href=y,v&&T.setAttribute("nonce",v),document.head.appendChild(T),E)return new Promise((M,L)=>{T.addEventListener("load",M),T.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${y}`)))})}))}function u(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return o.then(c=>{for(const f of c||[])f.status==="rejected"&&u(f.reason);return e().catch(u)})},gh=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xr(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class uo extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class mh extends uo{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Sa extends uo{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ca extends uo{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xs;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(xs||(xs={}));var _h=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};class yh{constructor(e,{headers:t={},customFetch:r,region:o=xs.Any}={}){this.url=e,this.headers=t,this.region=o,this.fetch=gh(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return _h(this,void 0,void 0,function*(){try{const{headers:o,method:u,body:c}=t;let f={},{region:v}=t;v||(v=this.region);const m=new URL(`${this.url}/${e}`);v&&v!=="any"&&(f["x-region"]=v,m.searchParams.set("forceFunctionRegion",v));let y;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(f["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(f["Content-Type"]="application/json",y=JSON.stringify(c)));const E=yield this.fetch(m.toString(),{method:u||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),o),body:y}).catch(M=>{throw new mh(M)}),A=E.headers.get("x-relay-error");if(A&&A==="true")throw new Sa(E);if(!E.ok)throw new Ca(E);let g=((r=E.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),T;return g==="application/json"?T=yield E.json():g==="application/octet-stream"?T=yield E.blob():g==="text/event-stream"?T=E:g==="multipart/form-data"?T=yield E.formData():T=yield E.text(),{data:T,error:null,response:E}}catch(o){return{data:null,error:o,response:o instanceof Ca||o instanceof Sa?o.context:void 0}}})}}var tt={},Zn={},er={},tr={},nr={},rr={},wh=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mr=wh();const bh=mr.fetch,Lu=mr.fetch.bind(mr),Fu=mr.Headers,Eh=mr.Request,Ah=mr.Response,Ar=Object.freeze(Object.defineProperty({__proto__:null,Headers:Fu,Request:Eh,Response:Ah,default:Lu,fetch:bh},Symbol.toStringTag,{value:"Module"})),kh=Gc(Ar);var bi={},Ta;function $u(){if(Ta)return bi;Ta=1,Object.defineProperty(bi,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return bi.default=n,bi}var Pa;function Du(){if(Pa)return rr;Pa=1;var n=rr&&rr.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(rr,"__esModule",{value:!0});const e=n(kh),t=n($u());class r{constructor(u){var c,f;this.shouldThrowOnError=!1,this.method=u.method,this.url=u.url,this.headers=new Headers(u.headers),this.schema=u.schema,this.body=u.body,this.shouldThrowOnError=(c=u.shouldThrowOnError)!==null&&c!==void 0?c:!1,this.signal=u.signal,this.isMaybeSingle=(f=u.isMaybeSingle)!==null&&f!==void 0?f:!1,u.fetch?this.fetch=u.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(u,c){return this.headers=new Headers(this.headers),this.headers.set(u,c),this}then(u,c){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let v=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var y,E,A,g;let T=null,M=null,L=null,q=m.status,H=m.statusText;if(m.ok){if(this.method!=="HEAD"){const R=await m.text();R===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((y=this.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?M=R:M=JSON.parse(R))}const z=(E=this.headers.get("Prefer"))===null||E===void 0?void 0:E.match(/count=(exact|planned|estimated)/),G=(A=m.headers.get("content-range"))===null||A===void 0?void 0:A.split("/");z&&G&&G.length>1&&(L=parseInt(G[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(M)&&(M.length>1?(T={code:"PGRST116",details:`Results contain ${M.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},M=null,L=null,q=406,H="Not Acceptable"):M.length===1?M=M[0]:M=null)}else{const z=await m.text();try{T=JSON.parse(z),Array.isArray(T)&&m.status===404&&(M=[],T=null,q=200,H="OK")}catch{m.status===404&&z===""?(q=204,H="No Content"):T={message:z}}if(T&&this.isMaybeSingle&&(!((g=T?.details)===null||g===void 0)&&g.includes("0 rows"))&&(T=null,q=200,H="OK"),T&&this.shouldThrowOnError)throw new t.default(T)}return{error:T,data:M,count:L,status:q,statusText:H}});return this.shouldThrowOnError||(v=v.catch(m=>{var y,E,A;return{error:{message:`${(y=m?.name)!==null&&y!==void 0?y:"FetchError"}: ${m?.message}`,details:`${(E=m?.stack)!==null&&E!==void 0?E:""}`,hint:"",code:`${(A=m?.code)!==null&&A!==void 0?A:""}`},data:null,count:null,status:0,statusText:""}})),v.then(u,c)}returns(){return this}overrideTypes(){return this}}return rr.default=r,rr}var Ia;function Uu(){if(Ia)return nr;Ia=1;var n=nr&&nr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(nr,"__esModule",{value:!0});const e=n(Du());class t extends e.default{select(o){let u=!1;const c=(o??"*").split("").map(f=>/\s/.test(f)&&!u?"":(f==='"'&&(u=!u),f)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:u=!0,nullsFirst:c,foreignTable:f,referencedTable:v=f}={}){const m=v?`${v}.order`:"order",y=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${y?`${y},`:""}${o}.${u?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:u,referencedTable:c=u}={}){const f=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(f,`${o}`),this}range(o,u,{foreignTable:c,referencedTable:f=c}={}){const v=typeof f>"u"?"offset":`${f}.offset`,m=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(v,`${o}`),this.url.searchParams.set(m,`${u-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:u=!1,settings:c=!1,buffers:f=!1,wal:v=!1,format:m="text"}={}){var y;const E=[o?"analyze":null,u?"verbose":null,c?"settings":null,f?"buffers":null,v?"wal":null].filter(Boolean).join("|"),A=(y=this.headers.get("Accept"))!==null&&y!==void 0?y:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${A}"; options=${E};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}}return nr.default=t,nr}var Ra;function lo(){if(Ra)return tr;Ra=1;var n=tr&&tr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tr,"__esModule",{value:!0});const e=n(Uu());class t extends e.default{eq(o,u){return this.url.searchParams.append(o,`eq.${u}`),this}neq(o,u){return this.url.searchParams.append(o,`neq.${u}`),this}gt(o,u){return this.url.searchParams.append(o,`gt.${u}`),this}gte(o,u){return this.url.searchParams.append(o,`gte.${u}`),this}lt(o,u){return this.url.searchParams.append(o,`lt.${u}`),this}lte(o,u){return this.url.searchParams.append(o,`lte.${u}`),this}like(o,u){return this.url.searchParams.append(o,`like.${u}`),this}likeAllOf(o,u){return this.url.searchParams.append(o,`like(all).{${u.join(",")}}`),this}likeAnyOf(o,u){return this.url.searchParams.append(o,`like(any).{${u.join(",")}}`),this}ilike(o,u){return this.url.searchParams.append(o,`ilike.${u}`),this}ilikeAllOf(o,u){return this.url.searchParams.append(o,`ilike(all).{${u.join(",")}}`),this}ilikeAnyOf(o,u){return this.url.searchParams.append(o,`ilike(any).{${u.join(",")}}`),this}is(o,u){return this.url.searchParams.append(o,`is.${u}`),this}in(o,u){const c=Array.from(new Set(u)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(o,`in.(${c})`),this}contains(o,u){return typeof u=="string"?this.url.searchParams.append(o,`cs.${u}`):Array.isArray(u)?this.url.searchParams.append(o,`cs.{${u.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(u)}`),this}containedBy(o,u){return typeof u=="string"?this.url.searchParams.append(o,`cd.${u}`):Array.isArray(u)?this.url.searchParams.append(o,`cd.{${u.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(u)}`),this}rangeGt(o,u){return this.url.searchParams.append(o,`sr.${u}`),this}rangeGte(o,u){return this.url.searchParams.append(o,`nxl.${u}`),this}rangeLt(o,u){return this.url.searchParams.append(o,`sl.${u}`),this}rangeLte(o,u){return this.url.searchParams.append(o,`nxr.${u}`),this}rangeAdjacent(o,u){return this.url.searchParams.append(o,`adj.${u}`),this}overlaps(o,u){return typeof u=="string"?this.url.searchParams.append(o,`ov.${u}`):this.url.searchParams.append(o,`ov.{${u.join(",")}}`),this}textSearch(o,u,{config:c,type:f}={}){let v="";f==="plain"?v="pl":f==="phrase"?v="ph":f==="websearch"&&(v="w");const m=c===void 0?"":`(${c})`;return this.url.searchParams.append(o,`${v}fts${m}.${u}`),this}match(o){return Object.entries(o).forEach(([u,c])=>{this.url.searchParams.append(u,`eq.${c}`)}),this}not(o,u,c){return this.url.searchParams.append(o,`not.${u}.${c}`),this}or(o,{foreignTable:u,referencedTable:c=u}={}){const f=c?`${c}.or`:"or";return this.url.searchParams.append(f,`(${o})`),this}filter(o,u,c){return this.url.searchParams.append(o,`${u}.${c}`),this}}return tr.default=t,tr}var Oa;function Nu(){if(Oa)return er;Oa=1;var n=er&&er.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(er,"__esModule",{value:!0});const e=n(lo());class t{constructor(o,{headers:u={},schema:c,fetch:f}){this.url=o,this.headers=new Headers(u),this.schema=c,this.fetch=f}select(o,{head:u=!1,count:c}={}){const f=u?"HEAD":"GET";let v=!1;const m=(o??"*").split("").map(y=>/\s/.test(y)&&!v?"":(y==='"'&&(v=!v),y)).join("");return this.url.searchParams.set("select",m),c&&this.headers.append("Prefer",`count=${c}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:u,defaultToNull:c=!0}={}){var f;const v="POST";if(u&&this.headers.append("Prefer",`count=${u}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const m=o.reduce((y,E)=>y.concat(Object.keys(E)),[]);if(m.length>0){const y=[...new Set(m)].map(E=>`"${E}"`);this.url.searchParams.set("columns",y.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(o,{onConflict:u,ignoreDuplicates:c=!1,count:f,defaultToNull:v=!0}={}){var m;const y="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),u!==void 0&&this.url.searchParams.set("on_conflict",u),f&&this.headers.append("Prefer",`count=${f}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const E=o.reduce((A,g)=>A.concat(Object.keys(g)),[]);if(E.length>0){const A=[...new Set(E)].map(g=>`"${g}"`);this.url.searchParams.set("columns",A.join(","))}}return new e.default({method:y,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(o,{count:u}={}){var c;const f="PATCH";return u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:o}={}){var u;const c="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return er.default=t,er}var ja;function Sh(){if(ja)return Zn;ja=1;var n=Zn&&Zn.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Zn,"__esModule",{value:!0});const e=n(Nu()),t=n(lo());class r{constructor(u,{headers:c={},schema:f,fetch:v}={}){this.url=u,this.headers=new Headers(c),this.schemaName=f,this.fetch=v}from(u){const c=new URL(`${this.url}/${u}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(u){return new r(this.url,{headers:this.headers,schema:u,fetch:this.fetch})}rpc(u,c={},{head:f=!1,get:v=!1,count:m}={}){var y;let E;const A=new URL(`${this.url}/rpc/${u}`);let g;f||v?(E=f?"HEAD":"GET",Object.entries(c).filter(([M,L])=>L!==void 0).map(([M,L])=>[M,Array.isArray(L)?`{${L.join(",")}}`:`${L}`]).forEach(([M,L])=>{A.searchParams.append(M,L)})):(E="POST",g=c);const T=new Headers(this.headers);return m&&T.set("Prefer",`count=${m}`),new t.default({method:E,url:A,headers:T,schema:this.schemaName,body:g,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}}return Zn.default=r,Zn}var xa;function Ch(){if(xa)return tt;xa=1;var n=tt&&tt.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.PostgrestError=tt.PostgrestBuilder=tt.PostgrestTransformBuilder=tt.PostgrestFilterBuilder=tt.PostgrestQueryBuilder=tt.PostgrestClient=void 0;const e=n(Sh());tt.PostgrestClient=e.default;const t=n(Nu());tt.PostgrestQueryBuilder=t.default;const r=n(lo());tt.PostgrestFilterBuilder=r.default;const o=n(Uu());tt.PostgrestTransformBuilder=o.default;const u=n(Du());tt.PostgrestBuilder=u.default;const c=n($u());return tt.PostgrestError=c.default,tt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:u.default,PostgrestError:c.default},tt}var Th=Ch();const Ph=zc(Th),{PostgrestClient:Ih,PostgrestQueryBuilder:Uf,PostgrestFilterBuilder:Nf,PostgrestTransformBuilder:Bf,PostgrestBuilder:Wf,PostgrestError:Vf}=Ph;class Rh{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Oh="2.15.1",jh=`realtime-js/${Oh}`,xh="1.0.0",Ms=1e4,Mh=1e3,Lh=100;var Ur;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ur||(Ur={}));var Ye;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Ye||(Ye={}));var Dt;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Dt||(Dt={}));var Ls;(function(n){n.websocket="websocket"})(Ls||(Ls={}));var Un;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Un||(Un={}));class Fh{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const o=t.getUint8(1),u=t.getUint8(2);let c=this.HEADER_LENGTH+2;const f=r.decode(e.slice(c,c+o));c=c+o;const v=r.decode(e.slice(c,c+u));c=c+u;const m=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{ref:null,topic:f,event:v,payload:m}}}class Bu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Fe;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Fe||(Fe={}));const Ma=(n,e,t={})=>{var r;const o=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((u,c)=>(u[c]=$h(c,n,e,o),u),{})},$h=(n,e,t,r)=>{const o=e.find(f=>f.name===n),u=o?.type,c=t[n];return u&&!r.includes(u)?Wu(u,c):Fs(c)},Wu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Bh(e,t)}switch(n){case Fe.bool:return Dh(e);case Fe.float4:case Fe.float8:case Fe.int2:case Fe.int4:case Fe.int8:case Fe.numeric:case Fe.oid:return Uh(e);case Fe.json:case Fe.jsonb:return Nh(e);case Fe.timestamp:return Wh(e);case Fe.abstime:case Fe.date:case Fe.daterange:case Fe.int4range:case Fe.int8range:case Fe.money:case Fe.reltime:case Fe.text:case Fe.time:case Fe.timestamptz:case Fe.timetz:case Fe.tsrange:case Fe.tstzrange:return Fs(e);default:return Fs(e)}},Fs=n=>n,Dh=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Uh=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Nh=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Bh=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let u;const c=n.slice(1,t);try{u=JSON.parse("["+c+"]")}catch{u=c?c.split(","):[]}return u.map(f=>Wu(e,f))}return n},Wh=n=>typeof n=="string"?n.replace(" ","T"):n,Vu=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class _s{constructor(e,t,r={},o=Ms){this.channel=e,this.event=t,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var La;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(La||(La={}));class Nr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:u,onLeave:c,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Nr.syncState(this.state,o,u,c),this.pendingDiffs.forEach(v=>{this.state=Nr.syncDiff(this.state,v,u,c)}),this.pendingDiffs=[],f()}),this.channel._on(r.diff,{},o=>{const{onJoin:u,onLeave:c,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Nr.syncDiff(this.state,o,u,c),f())}),this.onJoin((o,u,c)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:c})}),this.onLeave((o,u,c)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,o){const u=this.cloneDeep(e),c=this.transformState(t),f={},v={};return this.map(u,(m,y)=>{c[m]||(v[m]=y)}),this.map(c,(m,y)=>{const E=u[m];if(E){const A=y.map(L=>L.presence_ref),g=E.map(L=>L.presence_ref),T=y.filter(L=>g.indexOf(L.presence_ref)<0),M=E.filter(L=>A.indexOf(L.presence_ref)<0);T.length>0&&(f[m]=T),M.length>0&&(v[m]=M)}else f[m]=y}),this.syncDiff(u,{joins:f,leaves:v},r,o)}static syncDiff(e,t,r,o){const{joins:u,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(u,(f,v)=>{var m;const y=(m=e[f])!==null&&m!==void 0?m:[];if(e[f]=this.cloneDeep(v),y.length>0){const E=e[f].map(g=>g.presence_ref),A=y.filter(g=>E.indexOf(g.presence_ref)<0);e[f].unshift(...A)}r(f,y,v)}),this.map(c,(f,v)=>{let m=e[f];if(!m)return;const y=v.map(E=>E.presence_ref);m=m.filter(E=>y.indexOf(E.presence_ref)<0),e[f]=m,o(f,m,v),m.length===0&&delete e[f]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const o=e[r];return"metas"in o?t[r]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):t[r]=o,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Fa;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Fa||(Fa={}));var Br;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Br||(Br={}));var an;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(an||(an={}));class co{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Ye.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new _s(this,Dt.join,this.params,this.timeout),this.rejoinTimer=new Bu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ye.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ye.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ye.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ye.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ye.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Dt.reply,{},(o,u)=>{this._trigger(this._replyEventName(u),o)}),this.presence=new Nr(this),this.broadcastEndpointURL=Vu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Ye.closed){const{config:{broadcast:u,presence:c,private:f}}=this.params,v=(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(A=>A.filter))!==null&&o!==void 0?o:[],m=!!this.bindings[Br.PRESENCE]&&this.bindings[Br.PRESENCE].length>0,y={},E={broadcast:u,presence:Object.assign(Object.assign({},c),{enabled:m}),postgres_changes:v,private:f};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(A=>e?.(an.CHANNEL_ERROR,A)),this._onClose(()=>e?.(an.CLOSED)),this.updateJoinPayload(Object.assign({config:E},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:A})=>{var g;if(this.socket.setAuth(),A===void 0){e?.(an.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,M=(g=T?.length)!==null&&g!==void 0?g:0,L=[];for(let q=0;q<M;q++){const H=T[q],{filter:{event:N,schema:z,table:G,filter:R}}=H,x=A&&A[q];if(x&&x.event===N&&x.schema===z&&x.table===G&&x.filter===R)L.push(Object.assign(Object.assign({},H),{id:x.id}));else{this.unsubscribe(),this.state=Ye.errored,e?.(an.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=L,e&&e(an.SUBSCRIBED);return}}).receive("error",A=>{this.state=Ye.errored,e?.(an.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(A).join(", ")||"error")))}).receive("timeout",()=>{e?.(an.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===Ye.joined&&e===Br.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:u,payload:c}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:c,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var c,f,v;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(f=(c=this.params)===null||c===void 0?void 0:c.config)===null||f===void 0?void 0:f.broadcast)===null||v===void 0)&&v.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ye.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Dt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new _s(this,Dt.leave,{},e),r.receive("ok",()=>{t(),o("ok")}).receive("timeout",()=>{t(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ye.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const o=new AbortController,u=setTimeout(()=>o.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:o.signal}));return clearTimeout(u),c}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new _s(this,e,t,r);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Lh){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var o,u;const c=e.toLocaleLowerCase(),{close:f,error:v,leave:m,join:y}=Dt;if(r&&[f,v,m,y].indexOf(c)>=0&&r!==this._joinRef())return;let A=this._onMessage(c,t,r);if(t&&!A)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(g=>{var T,M,L;return((T=g.filter)===null||T===void 0?void 0:T.event)==="*"||((L=(M=g.filter)===null||M===void 0?void 0:M.event)===null||L===void 0?void 0:L.toLocaleLowerCase())===c}).map(g=>g.callback(A,r)):(u=this.bindings[c])===null||u===void 0||u.filter(g=>{var T,M,L,q,H,N;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in g){const z=g.id,G=(T=g.filter)===null||T===void 0?void 0:T.event;return z&&((M=t.ids)===null||M===void 0?void 0:M.includes(z))&&(G==="*"||G?.toLocaleLowerCase()===((L=t.data)===null||L===void 0?void 0:L.type.toLocaleLowerCase()))}else{const z=(H=(q=g?.filter)===null||q===void 0?void 0:q.event)===null||H===void 0?void 0:H.toLocaleLowerCase();return z==="*"||z===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===c}).map(g=>{if(typeof A=="object"&&"ids"in A){const T=A.data,{schema:M,table:L,commit_timestamp:q,type:H,errors:N}=T;A=Object.assign(Object.assign({},{schema:M,table:L,commit_timestamp:q,eventType:H,new:{},old:{},errors:N}),this._getPayloadRecords(T))}g.callback(A,r)})}_isClosed(){return this.state===Ye.closed}_isJoined(){return this.state===Ye.joined}_isJoining(){return this.state===Ye.joining}_isLeaving(){return this.state===Ye.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const o=e.toLocaleLowerCase(),u={type:o,filter:t,callback:r};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===r&&co.isEqual(o.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Dt.close,{},e)}_onError(e){this._on(Dt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ye.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ma(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ma(e.columns,e.old_record)),t}}const $a=()=>{},Ei={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Vh=[1e3,2e3,5e3,1e4],qh=1e4,Hh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class zh{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ms,this.transport=null,this.heartbeatIntervalMs=Ei.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$a,this.ref=0,this.reconnectTimer=null,this.logger=$a,this.conn=null,this.sendBuffer=[],this.serializer=new Fh,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>{let u;return o?u=o:typeof fetch>"u"?u=(...c)=>Xr(async()=>{const{default:f}=await Promise.resolve().then(()=>Ar);return{default:f}},void 0,import.meta.url).then(({default:f})=>f(...c)).catch(f=>{throw new Error(`Failed to load @supabase/node-fetch: ${f.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):u=fetch,(...c)=>u(...c)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ls.websocket}`,this.httpEndpoint=Vu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Rh.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:xh}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ur.connecting:return Un.Connecting;case Ur.open:return Un.Open;case Ur.closing:return Un.Closing;default:return Un.Closed}}isConnected(){return this.connectionState()===Un.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(u=>u.topic===r);if(o)return o;{const u=new co(`realtime:${e}`,t,this);return this.channels.push(u),u}}push(e){const{topic:t,event:r,payload:o,ref:u}=e,c=()=>{this.encode(e,f=>{var v;(v=this.conn)===null||v===void 0||v.send(f)})};this.log("push",`${t} ${r} (${u})`,o),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Mh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ei.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:o,payload:u,ref:c}=t,f=c?`(${c})`:"",v=u.status||"";this.log("receive",`${v} ${r} ${o} ${f}`.trim(),u),this.channels.filter(m=>m._isMember(r)).forEach(m=>m._trigger(o,u,c)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Dt.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(t);return`${e}${r}${o}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Hh],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const o={access_token:t,version:jh};t&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(Dt.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(o){this.log("error",`error in ${e} callback`,o)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Bu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ei.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,o,u,c,f,v,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Ms,this.heartbeatIntervalMs=(o=e?.heartbeatIntervalMs)!==null&&o!==void 0?o:Ei.HEARTBEAT_INTERVAL,this.worker=(u=e?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(y=>Vh[y-1]||qh),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((y,E)=>E(JSON.stringify(y))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class ho extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Je(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Gh extends ho{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $s extends ho{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Kh=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};const qu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xr(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Yh=()=>Kh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Xr(()=>Promise.resolve().then(()=>Ar),void 0,import.meta.url)).Response:Response}),Ds=n=>{if(Array.isArray(n))return n.map(t=>Ds(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const o=t.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));e[o]=Ds(r)}),e},Jh=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var qn=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};const ys=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Xh=(n,e,t)=>qn(void 0,void 0,void 0,function*(){const r=yield Yh();n instanceof r&&!t?.noResolveJson?n.json().then(o=>{const u=n.status||500,c=o?.statusCode||u+"";e(new Gh(ys(o),u,c))}).catch(o=>{e(new $s(ys(o),o))}):e(new $s(ys(n),n))}),Qh=(n,e,t,r)=>{const o={method:n,headers:e?.headers||{}};return n==="GET"||!r?o:(Jh(r)?(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),o.body=JSON.stringify(r)):o.body=r,e?.duplex&&(o.duplex=e.duplex),Object.assign(Object.assign({},o),t))};function Qr(n,e,t,r,o,u){return qn(this,void 0,void 0,function*(){return new Promise((c,f)=>{n(t,Qh(e,r,o,u)).then(v=>{if(!v.ok)throw v;return r?.noResolveJson?v:v.json()}).then(v=>c(v)).catch(v=>Xh(v,f,r))})})}function Di(n,e,t,r){return qn(this,void 0,void 0,function*(){return Qr(n,"GET",e,t,r)})}function Yt(n,e,t,r,o){return qn(this,void 0,void 0,function*(){return Qr(n,"POST",e,r,o,t)})}function Us(n,e,t,r,o){return qn(this,void 0,void 0,function*(){return Qr(n,"PUT",e,r,o,t)})}function Zh(n,e,t,r){return qn(this,void 0,void 0,function*(){return Qr(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Hu(n,e,t,r,o){return qn(this,void 0,void 0,function*(){return Qr(n,"DELETE",e,r,o,t)})}var ct=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};const ed={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Da={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class td{constructor(e,t={},r,o){this.url=e,this.headers=t,this.bucketId=r,this.fetch=qu(o)}uploadOrUpdate(e,t,r,o){return ct(this,void 0,void 0,function*(){try{let u;const c=Object.assign(Object.assign({},Da),o);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const v=c.metadata;typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",c.cacheControl),v&&u.append("metadata",this.encodeMetadata(v)),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.append("cacheControl",c.cacheControl),v&&u.append("metadata",this.encodeMetadata(v))):(u=r,f["cache-control"]=`max-age=${c.cacheControl}`,f["content-type"]=c.contentType,v&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),o?.headers&&(f=Object.assign(Object.assign({},f),o.headers));const m=this._removeEmptyFolders(t),y=this._getFinalPath(m),E=yield(e=="PUT"?Us:Yt)(this.fetch,`${this.url}/object/${y}`,u,Object.assign({headers:f},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:m,id:E.Id,fullPath:E.Key},error:null}}catch(u){if(Je(u))return{data:null,error:u};throw u}})}upload(e,t,r){return ct(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,o){return ct(this,void 0,void 0,function*(){const u=this._removeEmptyFolders(e),c=this._getFinalPath(u),f=new URL(this.url+`/object/upload/sign/${c}`);f.searchParams.set("token",t);try{let v;const m=Object.assign({upsert:Da.upsert},o),y=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",m.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",m.cacheControl)):(v=r,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType);const E=yield Us(this.fetch,f.toString(),v,{headers:y});return{data:{path:u,fullPath:E.Key},error:null}}catch(v){if(Je(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return ct(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);t?.upsert&&(o["x-upsert"]="true");const u=yield Yt(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),c=new URL(this.url+u.url),f=c.searchParams.get("token");if(!f)throw new ho("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:f},error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}})}update(e,t,r){return ct(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ct(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Je(o))return{data:null,error:o};throw o}})}copy(e,t,r){return ct(this,void 0,void 0,function*(){try{return{data:{path:(yield Yt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Je(o))return{data:null,error:o};throw o}})}createSignedUrl(e,t,r){return ct(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),u=yield Yt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r?.download?`&download=${r.download===!0?"":r.download}`:"";return u={signedUrl:encodeURI(`${this.url}${u.signedURL}${c}`)},{data:u,error:null}}catch(o){if(Je(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,r){return ct(this,void 0,void 0,function*(){try{const o=yield Yt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${u}`):null})),error:null}}catch(o){if(Je(o))return{data:null,error:o};throw o}})}download(e,t){return ct(this,void 0,void 0,function*(){const o=typeof t?.transform<"u"?"render/image/authenticated":"object",u=this.transformOptsToQueryString(t?.transform||{}),c=u?`?${u}`:"";try{const f=this._getFinalPath(e);return{data:yield(yield Di(this.fetch,`${this.url}/${o}/${f}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(f){if(Je(f))return{data:null,error:f};throw f}})}info(e){return ct(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Di(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ds(r),error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}})}exists(e){return ct(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Zh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Je(r)&&r instanceof $s){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),o=[],u=t?.download?`download=${t.download===!0?"":t.download}`:"";u!==""&&o.push(u);const f=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&o.push(v);let m=o.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${m}`)}}}remove(e){return ct(this,void 0,void 0,function*(){try{return{data:yield Hu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Je(t))return{data:null,error:t};throw t}})}list(e,t,r){return ct(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},ed),t),{prefix:e||""});return{data:yield Yt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Je(o))return{data:null,error:o};throw o}})}listV2(e,t){return ct(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Yt(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const nd="2.11.0",rd={"X-Client-Info":`storage-js/${nd}`};var ir=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};class id{constructor(e,t={},r,o){const u=new URL(e);o?.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href,this.headers=Object.assign(Object.assign({},rd),t),this.fetch=qu(r)}listBuckets(){return ir(this,void 0,void 0,function*(){try{return{data:yield Di(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Je(e))return{data:null,error:e};throw e}})}getBucket(e){return ir(this,void 0,void 0,function*(){try{return{data:yield Di(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Je(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ir(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ir(this,void 0,void 0,function*(){try{return{data:yield Us(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ir(this,void 0,void 0,function*(){try{return{data:yield Yt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Je(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ir(this,void 0,void 0,function*(){try{return{data:yield Hu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Je(t))return{data:null,error:t};throw t}})}}class sd extends id{constructor(e,t={},r,o){super(e,t,r,o)}from(e){return new td(this.url,this.headers,e,this.fetch)}}const od="2.56.0";let $r="";typeof Deno<"u"?$r="deno":typeof document<"u"?$r="web":typeof navigator<"u"&&navigator.product==="ReactNative"?$r="react-native":$r="node";const ad={"X-Client-Info":`supabase-js-${$r}/${od}`},ud={headers:ad},ld={schema:"public"},cd={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},hd={};var dd=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};const fd=n=>{let e;return n?e=n:typeof fetch>"u"?e=Lu:e=fetch,(...t)=>e(...t)},vd=()=>typeof Headers>"u"?Fu:Headers,pd=(n,e,t)=>{const r=fd(t),o=vd();return(u,c)=>dd(void 0,void 0,void 0,function*(){var f;const v=(f=yield e())!==null&&f!==void 0?f:n;let m=new o(c?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${v}`),r(u,Object.assign(Object.assign({},c),{headers:m}))})};var gd=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};function md(n){return n.endsWith("/")?n:n+"/"}function _d(n,e){var t,r;const{db:o,auth:u,realtime:c,global:f}=n,{db:v,auth:m,realtime:y,global:E}=e,A={db:Object.assign(Object.assign({},v),o),auth:Object.assign(Object.assign({},m),u),realtime:Object.assign(Object.assign({},y),c),storage:{},global:Object.assign(Object.assign(Object.assign({},E),f),{headers:Object.assign(Object.assign({},(t=E?.headers)!==null&&t!==void 0?t:{}),(r=f?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>gd(this,void 0,void 0,function*(){return""})};return n.accessToken?A.accessToken=n.accessToken:delete A.accessToken,A}const zu="2.71.1",lr=30*1e3,Ns=3,ws=Ns*lr,yd="http://localhost:9999",wd="supabase.auth.token",bd={"X-Client-Info":`gotrue-js/${zu}`},Bs="X-Supabase-Api-Version",Gu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ed=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ad=600*1e3;class fo extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function he(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class kd extends fo{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Sd(n){return he(n)&&n.name==="AuthApiError"}class Ku extends fo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Cn extends fo{constructor(e,t,r,o){super(e,r,o),this.name=t,this.status=r}}class _n extends Cn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Cd(n){return he(n)&&n.name==="AuthSessionMissingError"}class Ai extends Cn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ki extends Cn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Si extends Cn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Td(n){return he(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ua extends Cn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ws extends Cn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function bs(n){return he(n)&&n.name==="AuthRetryableFetchError"}class Na extends Cn{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Vs extends Cn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ui="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ba=` 	
\r=`.split(""),Pd=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ba.length;e+=1)n[Ba[e].charCodeAt(0)]=-2;for(let e=0;e<Ui.length;e+=1)n[Ui[e].charCodeAt(0)]=e;return n})();function Wa(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ui[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ui[r]),e.queuedBits-=6}}function Yu(n,e,t){const r=Pd[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Va(n){const e=[],t=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=c=>{Od(c,r,t)};for(let c=0;c<n.length;c+=1)Yu(n.charCodeAt(c),o,u);return e.join("")}function Id(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Rd(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|o)+65536,t+=1}Id(r,e)}}function Od(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function jd(n){const e=[],t={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<n.length;o+=1)Yu(n.charCodeAt(o),t,r);return new Uint8Array(e)}function xd(n){const e=[];return Rd(n,t=>e.push(t)),new Uint8Array(e)}function Md(n){const e=[],t={queue:0,queuedBits:0},r=o=>{e.push(o)};return n.forEach(o=>Wa(o,t,r)),Wa(null,t,r),e.join("")}function Ld(n){return Math.round(Date.now()/1e3)+n}function Fd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const $t=()=>typeof window<"u"&&typeof document<"u",Mn={tested:!1,writable:!1},Ju=()=>{if(!$t())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mn.tested)return Mn.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Mn.tested=!0,Mn.writable=!0}catch{Mn.tested=!0,Mn.writable=!1}return Mn.writable};function $d(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((o,u)=>{e[u]=o})}catch{}return t.searchParams.forEach((r,o)=>{e[o]=r}),e}const Xu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xr(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Dd=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",cr=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ln=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},mn=async(n,e)=>{await n.removeItem(e)};class Ji{constructor(){this.promise=new Ji.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ji.promiseConstructor=Promise;function Es(n){const e=n.split(".");if(e.length!==3)throw new Vs("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Ed.test(e[r]))throw new Vs("JWT not in base64url format");return{header:JSON.parse(Va(e[0])),payload:JSON.parse(Va(e[1])),signature:jd(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ud(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Nd(n,e){return new Promise((r,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const c=await n(u);if(!e(u,null,c)){r(c);return}}catch(c){if(!e(u,c)){o(c);return}}})()})}function Bd(n){return("0"+n.toString(16)).substr(-2)}function Wd(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let o="";for(let u=0;u<56;u++)o+=t.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,Bd).join("")}async function Vd(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),o=new Uint8Array(r);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function qd(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Vd(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function sr(n,e,t=!1){const r=Wd();let o=r;t&&(o+="/PASSWORD_RECOVERY"),await cr(n,`${e}-code-verifier`,o);const u=await qd(r);return[u,r===u?"plain":"s256"]}const Hd=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function zd(n){const e=n.headers.get(Bs);if(!e||!e.match(Hd))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Gd(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Kd(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Yd=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function or(n){if(!Yd.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function As(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function qa(n){return JSON.parse(JSON.stringify(n))}var Jd=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};const Fn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Xd=[502,503,504];async function Ha(n){var e;if(!Dd(n))throw new Ws(Fn(n),0);if(Xd.includes(n.status))throw new Ws(Fn(n),n.status);let t;try{t=await n.json()}catch(u){throw new Ku(Fn(u),u)}let r;const o=zd(n);if(o&&o.getTime()>=Gu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Na(Fn(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new _n}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((u,c)=>u&&typeof c=="string",!0))throw new Na(Fn(t),n.status,t.weak_password.reasons);throw new kd(Fn(t),n.status||500,r)}const Qd=(n,e,t,r)=>{const o={method:n,headers:e?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),t))};async function ye(n,e,t,r){var o;const u=Object.assign({},r?.headers);u[Bs]||(u[Bs]=Gu["2024-01-01"].name),r?.jwt&&(u.Authorization=`Bearer ${r.jwt}`);const c=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(c.redirect_to=r.redirectTo);const f=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",v=await Zd(n,e,t+f,{headers:u,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(v):{data:Object.assign({},v),error:null}}async function Zd(n,e,t,r,o,u){const c=Qd(e,r,o,u);let f;try{f=await n(t,Object.assign({},c))}catch(v){throw console.error(v),new Ws(Fn(v),0)}if(f.ok||await Ha(f),r?.noResolveJson)return f;try{return await f.json()}catch(v){await Ha(v)}}function on(n){var e;let t=null;rf(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Ld(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function za(n){const e=on(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function yn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function ef(n){return{data:n,error:null}}function tf(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:u}=n,c=Jd(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:u},v=Object.assign({},c);return{data:{properties:f,user:v},error:null}}function nf(n){return n}function rf(n){return n.access_token&&n.refresh_token&&n.expires_in}const ks=["global","local","others"];var sf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};class of{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Xu(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ks[0]){if(ks.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ks.join(", ")}`);try{return await ye(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(he(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ye(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:yn})}catch(r){if(he(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=sf(e,["options"]),o=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await ye(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:tf,redirectTo:t?.redirectTo})}catch(t){if(he(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ye(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:yn})}catch(t){if(he(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,o,u,c,f,v;try{const m={nextPage:null,lastPage:0,total:0},y=await ye(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(u=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:nf});if(y.error)throw y.error;const E=await y.json(),A=(c=y.headers.get("x-total-count"))!==null&&c!==void 0?c:0,g=(v=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&v!==void 0?v:[];return g.length>0&&(g.forEach(T=>{const M=parseInt(T.split(";")[0].split("=")[1].substring(0,1)),L=JSON.parse(T.split(";")[1].split("=")[1]);m[`${L}Page`]=M}),m.total=parseInt(A)),{data:Object.assign(Object.assign({},E),m),error:null}}catch(m){if(he(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){or(e);try{return await ye(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:yn})}catch(t){if(he(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){or(e);try{return await ye(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:yn})}catch(r){if(he(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){or(e);try{return await ye(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:yn})}catch(r){if(he(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){or(e.userId);try{const{data:t,error:r}=await ye(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:t,error:r}}catch(t){if(he(t))return{data:null,error:t};throw t}}async _deleteFactor(e){or(e.userId),or(e.id);try{return{data:await ye(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(he(t))return{data:null,error:t};throw t}}}function Ga(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function af(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ar={debug:!!(globalThis&&Ju()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Qu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class uf extends Qu{}async function lf(n,e,t){ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ar.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await t()}finally{ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(e===0)throw ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new uf(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ar.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}af();const cf={url:yd,storageKey:wd,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bd,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ka(n,e,t){return await t()}const ur={};class zr{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=zr.nextInstanceID,zr.nextInstanceID+=1,this.instanceID>0&&$t()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},cf),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new of({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Xu(o.fetch),this.lock=o.lock||Ka,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:$t()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=lf:this.lock=Ka,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Ju()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ga(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Ga(this.memoryStorage)),$t()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(u){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",u)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async u=>{this._debug("received broadcast notification from other tab or client",u),await this._notifyAllSubscribers(u.data.event,u.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=ur[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){ur[this.storageKey]=Object.assign(Object.assign({},ur[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=ur[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ur[this.storageKey]=Object.assign(Object.assign({},ur[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${zu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=$d(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),$t()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:u}=await this._getSessionFromURL(t,r);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),Td(u)){const v=(e=u.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:c,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",c,"redirect type",f),await this._saveSession(c),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return he(t)?{error:t}:{error:new Ku("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,o;try{const u=await ye(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:on}),{data:c,error:f}=u;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,m=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(u){if(he(u))return{data:{user:null,session:null},error:u};throw u}}async signUp(e){var t,r,o;try{let u;if("email"in e){const{email:y,password:E,options:A}=e;let g=null,T=null;this.flowType==="pkce"&&([g,T]=await sr(this.storage,this.storageKey)),u=await ye(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:A?.emailRedirectTo,body:{email:y,password:E,data:(t=A?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:A?.captchaToken},code_challenge:g,code_challenge_method:T},xform:on})}else if("phone"in e){const{phone:y,password:E,options:A}=e;u=await ye(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:E,data:(r=A?.data)!==null&&r!==void 0?r:{},channel:(o=A?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:A?.captchaToken}},xform:on})}else throw new ki("You must provide either an email or phone number and a password");const{data:c,error:f}=u;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,m=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(u){if(he(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithPassword(e){try{let t;if("email"in e){const{email:u,password:c,options:f}=e;t=await ye(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:za})}else if("phone"in e){const{phone:u,password:c,options:f}=e;t=await ye(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:za})}else throw new ki("You must provide either an email or phone number and a password");const{data:r,error:o}=t;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ai}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(t){if(he(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,o,u;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=e.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,o,u,c,f,v,m,y,E,A,g;let T,M;if("message"in e)T=e.message,M=e.signature;else{const{chain:L,wallet:q,statement:H,options:N}=e;let z;if($t())if(typeof q=="object")z=q;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))z=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof q!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=q}const G=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const R=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:G.host,uri:G.href}),H?{statement:H}:null));let x;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")x=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)x=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in x&&"signature"in x&&(typeof x.signedMessage=="string"||x.signedMessage instanceof Uint8Array)&&x.signature instanceof Uint8Array)T=typeof x.signedMessage=="string"?x.signedMessage:new TextDecoder().decode(x.signedMessage),M=x.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");T=[`${G.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${G.href}`,`Issued At: ${(o=(r=N?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=N?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((c=N?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((f=N?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((v=N?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((m=N?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((E=(y=N?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||E===void 0)&&E.length?["Resources",...N.signInWithSolana.resources.map(x=>`- ${x}`)]:[]].join(`
`);const R=await z.signMessage(new TextEncoder().encode(T),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");M=R}}try{const{data:L,error:q}=await ye(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:T,signature:Md(M)},!((A=e.options)===null||A===void 0)&&A.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:on});if(q)throw q;return!L||!L.session||!L.user?{data:{user:null,session:null},error:new Ai}:(L.session&&(await this._saveSession(L.session),await this._notifyAllSubscribers("SIGNED_IN",L.session)),{data:Object.assign({},L),error:q})}catch(L){if(he(L))return{data:{user:null,session:null},error:L};throw L}}async _exchangeCodeForSession(e){const t=await Ln(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(t??"").split("/");try{const{data:u,error:c}=await ye(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:on});if(await mn(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!u||!u.session||!u.user?{data:{user:null,session:null,redirectType:null},error:new Ai}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:c})}catch(u){if(he(u))return{data:{user:null,session:null,redirectType:null},error:u};throw u}}async signInWithIdToken(e){try{const{options:t,provider:r,token:o,access_token:u,nonce:c}=e,f=await ye(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:u,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:on}),{data:v,error:m}=f;return m?{data:{user:null,session:null},error:m}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new Ai}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:m})}catch(t){if(he(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,o,u,c;try{if("email"in e){const{email:f,options:v}=e;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await sr(this.storage,this.storageKey));const{error:E}=await ye(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(r=v?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:E}}if("phone"in e){const{phone:f,options:v}=e,{data:m,error:y}=await ye(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=v?.data)!==null&&o!==void 0?o:{},create_user:(u=v?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(c=v?.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:y}}throw new ki("You must provide either an email or phone number.")}catch(f){if(he(f))return{data:{user:null,session:null},error:f};throw f}}async verifyOtp(e){var t,r;try{let o,u;"options"in e&&(o=(t=e.options)===null||t===void 0?void 0:t.redirectTo,u=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:f}=await ye(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:on});if(f)throw f;if(!c)throw new Error("An error occurred on token verification.");const v=c.session,m=c.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(o){if(he(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var t,r,o;try{let u=null,c=null;return this.flowType==="pkce"&&([u,c]=await sr(this.storage,this.storageKey)),await ye(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:c}),headers:this.headers,xform:ef})}catch(u){if(he(u))return{data:null,error:u};throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new _n;const{error:o}=await ye(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(he(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:u}=e,{error:c}=await ye(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:r,type:o,options:u}=e,{data:c,error:f}=await ye(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return{data:{user:null,session:null,messageId:c?.message_id},error:f}}throw new ki("You must provide either an email or phone number and a type")}catch(t){if(he(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ln(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ws:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await Ln(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=As()}if(this.storage.isServer&&e.user){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,m,y)=>(!c&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,m,y))})}return{data:{session:e},error:null}}const{session:o,error:u}=await this._callRefreshToken(e.refresh_token);return u?{data:{session:null},error:u}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ye(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:yn}):await this._useSession(async t=>{var r,o,u;const{data:c,error:f}=t;if(f)throw f;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _n}:await ye(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=c.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:yn})})}catch(t){if(he(t))return Cd(t)&&(await this._removeSession(),await mn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:o,error:u}=r;if(u)throw u;if(!o.session)throw new _n;const c=o.session;let f=null,v=null;this.flowType==="pkce"&&e.email!=null&&([f,v]=await sr(this.storage,this.storageKey));const{data:m,error:y}=await ye(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:v}),jwt:c.access_token,xform:yn});if(y)throw y;return c.user=m.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(r){if(he(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new _n;const t=Date.now()/1e3;let r=t,o=!0,u=null;const{payload:c}=Es(e.access_token);if(c.exp&&(r=c.exp,o=r<=t),o){const{session:f,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:v}=await this._getUser(e.access_token);if(v)throw v;u={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return{data:{user:u.user,session:u},error:null}}catch(t){if(he(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:c,error:f}=t;if(f)throw f;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new _n;const{session:o,error:u}=await this._callRefreshToken(e.refresh_token);return u?{data:{user:null,session:null},error:u}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(he(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!$t())throw new Si("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Si(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ua("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Si("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ua("No code detected.");const{data:H,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:u,refresh_token:c,expires_in:f,expires_at:v,token_type:m}=e;if(!u||!f||!c||!m)throw new Si("No session defined in URL");const y=Math.round(Date.now()/1e3),E=parseInt(f);let A=y+E;v&&(A=parseInt(v));const g=A-y;g*1e3<=lr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${E}s`);const T=A-E;y-T>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",T,A,y):y-T<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",T,A,y);const{data:M,error:L}=await this._getUser(u);if(L)throw L;const q={provider_token:r,provider_refresh_token:o,access_token:u,expires_in:E,expires_at:A,refresh_token:c,token_type:m,user:M.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:q,redirectType:e.type},error:null}}catch(r){if(he(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ln(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:o,error:u}=t;if(u)return{error:u};const c=(r=o.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:f}=await this.admin.signOut(c,e);if(f&&!(Sd(f)&&(f.status===404||f.status===401||f.status===403)))return{error:f}}return e!=="others"&&(await this._removeSession(),await mn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Fd(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,o;try{const{data:{session:u},error:c}=t;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",e,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",u),console.error(u)}})}async resetPasswordForEmail(e,t={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await sr(this.storage,this.storageKey,!0));try{return await ye(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(u){if(he(u))return{data:null,error:u};throw u}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(he(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:o}=await this._useSession(async u=>{var c,f,v,m,y;const{data:E,error:A}=u;if(A)throw A;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await ye(this.fetch,"GET",g,{headers:this.headers,jwt:(y=(m=E.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return $t()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(he(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,o;const{data:u,error:c}=t;if(c)throw c;return await ye(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=u.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(t){if(he(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Nd(async o=>(o>0&&await Ud(200*Math.pow(2,o-1)),this._debug(t,"refreshing attempt",o),await ye(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:on})),(o,u)=>{const c=200*Math.pow(2,o);return u&&bs(u)&&Date.now()+c-r<lr})}catch(r){if(this._debug(t,"error",r),he(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),$t()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await Ln(this.storage,this.storageKey);if(o&&this.userStorage){let c=await Ln(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:o.user},await cr(this.userStorage,this.storageKey+"-user",c)),o.user=(e=c?.user)!==null&&e!==void 0?e:As()}else if(o&&!o.user&&!o.user){const c=await Ln(this.storage,this.storageKey+"-user");c&&c?.user?(o.user=c.user,await mn(this.storage,this.storageKey+"-user"),await cr(this.storage,this.storageKey,o)):o.user=As()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const u=((t=o.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ws;if(this._debug(r,`session has${u?"":" not"} expired with margin of ${ws}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:c}=await this._callRefreshToken(o.refresh_token);c&&(console.error(c),bs(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:f}=await this._getUser(o.access_token);!f&&c?.user?(o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new _n;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ji;const{data:u,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!u.session)throw new _n;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={session:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(o,"error",u),he(u)){const c={session:null,error:u};return bs(u)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,t,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const u=[],c=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,t)}catch(v){u.push(v)}});if(await Promise.all(c),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await cr(this.userStorage,this.storageKey+"-user",{user:t.user});const o=Object.assign({},t);delete o.user;const u=qa(o);await cr(this.storage,this.storageKey,u)}else{const o=qa(t);await cr(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await mn(this.storage,this.storageKey),await mn(this.storage,this.storageKey+"-code-verifier"),await mn(this.storage,this.storageKey+"-user"),this.userStorage&&await mn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&$t()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),lr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/lr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${lr}ms, refresh threshold is ${Ns} ticks`),o<=Ns&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Qu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$t()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const o=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[u,c]=await sr(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(c)}`});o.push(f.toString())}if(r?.queryParams){const u=new URLSearchParams(r.queryParams);o.push(u.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:o,error:u}=t;return u?{data:null,error:u}:await ye(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(he(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,o;const{data:u,error:c}=t;if(c)return{data:null,error:c};const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:m}=await ye(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(r=u?.session)===null||r===void 0?void 0:r.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((o=v?.totp)===null||o===void 0)&&o.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(he(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:u}=t;if(u)return{data:null,error:u};const{data:c,error:f}=await ye(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:f})})}catch(t){if(he(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:u}=t;return u?{data:null,error:u}:await ye(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(he(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],o=r.filter(c=>c.factor_type==="totp"&&c.status==="verified"),u=r.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:r,totp:o,phone:u},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:o},error:u}=e;if(u)return{data:null,error:u};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=Es(o.access_token);let f=null;c.aal&&(f=c.aal);let v=f;((r=(t=o.user.factors)===null||t===void 0?void 0:t.filter(E=>E.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(v="aal2");const y=c.amr||[];return{data:{currentLevel:f,nextLevel:v,currentAuthenticationMethods:y},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(f=>f.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(f=>f.kid===e),r&&this.jwks_cached_at+Ad>o)return r;const{data:u,error:c}=await ye(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,r=u.keys.find(f=>f.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:T}=await this.getSession();if(T||!g.session)return{data:null,error:T};r=g.session.access_token}const{header:o,payload:u,signature:c,raw:{header:f,payload:v}}=Es(r);t?.allowExpired||Gd(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:u,header:o,signature:c},error:null}}const y=Kd(o.alg),E=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,E,c,xd(`${f}.${v}`)))throw new Vs("Invalid JWT signature");return{data:{claims:u,header:o,signature:c},error:null}}catch(r){if(he(r))return{data:null,error:r};throw r}}}zr.nextInstanceID=0;const hf=zr;class df extends hf{constructor(e){super(e)}}var ff=function(n,e,t,r){function o(u){return u instanceof t?u:new t(function(c){c(u)})}return new(t||(t=Promise))(function(u,c){function f(y){try{m(r.next(y))}catch(E){c(E)}}function v(y){try{m(r.throw(y))}catch(E){c(E)}}function m(y){y.done?u(y.value):o(y.value).then(f,v)}m((r=r.apply(n,e||[])).next())})};class vf{constructor(e,t,r){var o,u,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=md(e),v=new URL(f);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const m=`sb-${v.hostname.split(".")[0]}-auth-token`,y={db:ld,realtime:hd,auth:Object.assign(Object.assign({},cd),{storageKey:m}),global:ud},E=_d(r??{},y);this.storageKey=(o=E.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(u=E.global.headers)!==null&&u!==void 0?u:{},E.accessToken?(this.accessToken=E.accessToken,this.auth=new Proxy({},{get:(A,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=E.auth)!==null&&c!==void 0?c:{},this.headers,E.global.fetch),this.fetch=pd(t,this._getAccessToken.bind(this),E.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},E.realtime)),this.rest=new Ih(new URL("rest/v1",v).href,{headers:this.headers,schema:E.db.schema,fetch:this.fetch}),this.storage=new sd(this.storageUrl.href,this.headers,this.fetch,r?.storage),E.accessToken||this._listenForAuthEvents()}get functions(){return new yh(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ff(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,storageKey:u,flowType:c,lock:f,debug:v},m,y){const E={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new df({url:this.authUrl.href,headers:Object.assign(Object.assign({},E),m),storageKey:u,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,flowType:c,lock:f,debug:v,fetch:y,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new zh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const pf=(n,e,t)=>new vf(n,e,t);function gf(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}gf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mf="https://vycjpmuyscfygstjjied.supabase.co",_f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",qs="dracula",Zu="dracula_story_v2.json",Hs=pf(mf,_f,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}});async function yf(n,e,t){if(V(e)){Me(t,{type:"loading",text:"Сохранение..."},!0);try{const r=new Blob([JSON.stringify(V(e),null,2)],{type:"application/json"}),{error:o}=await Hs.storage.from(qs).upload(Zu,r,{upsert:!0});if(o)throw o;Me(t,{type:"success",text:"Сохранено!"},!0)}catch(r){console.error(r),Me(t,{type:"error",text:"Ошибка сохранения"},!0)}}}function wf(n,e,t){if(!V(e))return;const r="new_"+Date.now();V(e).dialogues.push({id:r,text:"Новый текст...",options:[]}),V(e).dialogues.sort((o,u)=>o.id.localeCompare(u.id)),Me(t,r)}var bf=(n,e,t)=>Me(e,V(t).id,!0),Ef=Ne('<div><span class="id-badge svelte-ldq30s"> </span> <span class="preview-text svelte-ldq30s"> </span></div>'),Af=Ne("<div> </div>"),kf=Ne('<div class="alert loading svelte-ldq30s">Загрузка файлов...</div>'),Sf=(n,e)=>e(n,"bg"),Cf=(n,e)=>e(n,"char"),Tf=(n,e,t)=>e(V(t)),Pf=Ne('<div class="option-card svelte-ldq30s"><div class="form-row svelte-ldq30s"><input type="text" placeholder="Текст кнопки" class="input svelte-ldq30s"/> <button class="btn danger small svelte-ldq30s">×</button></div> <div class="form-row svelte-ldq30s"><input type="text" placeholder="ID перехода" class="input svelte-ldq30s"/></div></div>'),If=Ne('<div class="dialogue-form svelte-ldq30s"><div class="form-row svelte-ldq30s"><div class="form-group full-width svelte-ldq30s"><label class="svelte-ldq30s">ID диалога</label> <input type="text" class="input svelte-ldq30s"/></div></div> <div class="form-group svelte-ldq30s"><label class="svelte-ldq30s">Текст</label> <textarea class="textarea svelte-ldq30s" rows="4"></textarea></div> <div class="media-section svelte-ldq30s"><div class="form-group svelte-ldq30s"><div class="label-row svelte-ldq30s"><label class="svelte-ldq30s">Фон (Background)</label> <label class="file-label svelte-ldq30s">📁 Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div> <input type="text" class="input svelte-ldq30s" placeholder="back.png"/></div> <div class="form-group svelte-ldq30s"><div class="label-row svelte-ldq30s"><label class="svelte-ldq30s">Персонаж (Character)</label> <label class="file-label svelte-ldq30s">📁 Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div> <input type="text" class="input svelte-ldq30s" placeholder="dracula.riv"/></div></div> <div class="options-section svelte-ldq30s"><div class="section-header"><h4>Варианты ответов</h4> <button class="btn small svelte-ldq30s">+ Добавить</button></div> <!></div></div>'),Rf=Ne('<div class="empty-state svelte-ldq30s">Выберите сцену</div>'),Of=Ne('<div class="game-preview-container svelte-ldq30s"><!></div>'),jf=Ne('<div class="empty-preview svelte-ldq30s">Нет выбранной сцены</div>'),xf=Ne('<div class="editor-container svelte-ldq30s"><header class="toolbar svelte-ldq30s"><div class="logo svelte-ldq30s"><h2 class="svelte-ldq30s">Story Editor</h2></div> <div class="actions"><button class="btn success svelte-ldq30s">💾 Сохранить</button></div></header> <div class="main-workspace svelte-ldq30s"><aside class="sidebar svelte-ldq30s"><div class="sidebar-header svelte-ldq30s"><h3 class="svelte-ldq30s"> </h3> <button class="btn small primary svelte-ldq30s">+</button></div> <div class="dialogue-list svelte-ldq30s"></div> <div class="status-footer svelte-ldq30s"><!> <!></div></aside> <main class="editor-area svelte-ldq30s"><!></main> <aside class="preview-panel svelte-ldq30s"><h3 class="svelte-ldq30s">Предпросмотр (Live)</h3> <div class="preview-wrapper svelte-ldq30s"><!></div></aside></div></div>');function Mf(n,e){Yr(e,!0);let t=Xe(null),r=Xe(null),o=Xe(wn({type:"",text:""})),u=Xe(wn([])),c=!1;ao(async()=>{await f()});async function f(){Me(o,{type:"loading",text:"Загрузка..."},!0);try{const{data:Z,error:se}=await Hs.storage.from(qs).download(Zu);if(se)throw se;Me(t,JSON.parse(await Z.text()),!0),Me(o,{type:"success",text:"Загружено!"},!0)}catch(Z){console.error(Z),Me(o,{type:"error",text:"Ошибка: "+Z.message},!0),Me(t,{dialogues:[],meta:{version:"2.0",title:"New Story"}},!0)}}async function v(Z,se){const Le=Z.target;if(!Le.files||Le.files.length===0)return;const oe=Le.files[0],de={id:Math.random().toString(36).substr(2,9),file:oe,type:se,status:"uploading"};Me(u,[...V(u),de],!0);try{const{error:He}=await Hs.storage.from(qs).upload(oe.name,oe,{upsert:!0});if(He)throw He;if(de.status="done",V(r)){const we=V(t).dialogues.find(Ge=>Ge.id===V(r));we&&(se==="bg"&&(we.backgroundImage=oe.name),se==="char"&&(we.characterImage=oe.name))}Me(o,{type:"success",text:`Файл ${oe.name} загружен`},!0)}catch(He){de.status="error",de.error=He.message,Me(o,{type:"error",text:"Ошибка загрузки"},!0)}}function m(Z){Z.options||(Z.options=[]),Z.options.push({text:"Новый вариант",nextDialogueId:"0"})}let y=su(()=>V(t)?.dialogues.find(Z=>Z.id===V(r)));var E=xf(),A=ce(E),g=Oe(ce(A),2),T=ce(g);T.__click=[yf,t,o],T.disabled=c;var M=Oe(A,2),L=ce(M),q=ce(L),H=ce(q),N=ce(H),z=Oe(H,2);z.__click=[wf,t,r];var G=Oe(q,2);js(G,21,()=>V(t)?.dialogues||[],Z=>Z.id,(Z,se)=>{var Le=Ef();Le.__click=[bf,r,se];var oe=ce(Le),de=ce(oe),He=Oe(oe,2),we=ce(He);ln(Ge=>{ma(Le,1,`dialogue-item ${V(r)===V(se).id?"active":""}`,"svelte-ldq30s"),En(de,V(se).id),En(we,`${Ge??""}...`)},[()=>V(se).text.substring(0,25)]),Pe(Z,Le)});var R=Oe(G,2),x=ce(R);{var ne=Z=>{var se=Af(),Le=ce(se);ln(()=>{ma(se,1,`alert ${V(o).type??""}`,"svelte-ldq30s"),En(Le,V(o).text)}),Pe(Z,se)};at(x,Z=>{V(o).text&&Z(ne)})}var re=Oe(x,2);{var ie=Z=>{var se=kf();Pe(Z,se)};at(re,Z=>{V(u).some(se=>se.status==="uploading")&&Z(ie)})}var Y=Oe(L,2),ue=ce(Y);{var xe=Z=>{var se=If(),Le=ce(se),oe=ce(Le),de=Oe(ce(oe),2),He=Oe(Le,2),we=Oe(ce(He),2),Ge=Oe(He,2),Be=ce(Ge),Et=ce(Be),Bt=Oe(ce(Et),2),Rt=Oe(ce(Bt));Rt.__change=[Sf,v];var Zt=Oe(Et,2),it=Oe(Be,2),dt=ce(it),Wt=Oe(ce(dt),2),Tn=Oe(ce(Wt));Tn.__change=[Cf,v];var Ot=Oe(dt,2),Hn=Oe(Ge,2),st=ce(Hn),kr=Oe(ce(st),2);kr.__click=[Tf,m,y];var zn=Oe(st,2);js(zn,17,()=>V(y).options||[],xc,(mt,_t,p)=>{var a=Pf(),h=ce(a),w=ce(h),C=Oe(w,2);C.__click=()=>V(y).options.splice(p,1);var j=Oe(h,2),F=ce(j);Qn(w,()=>V(_t).text,te=>V(_t).text=te),Qn(F,()=>V(_t).nextDialogueId,te=>V(_t).nextDialogueId=te),Pe(mt,a)}),Qn(de,()=>V(y).id,mt=>V(y).id=mt),Qn(we,()=>V(y).text,mt=>V(y).text=mt),Qn(Zt,()=>V(y).backgroundImage,mt=>V(y).backgroundImage=mt),Qn(Ot,()=>V(y).characterImage,mt=>V(y).characterImage=mt),Pe(Z,se)},Ve=Z=>{var se=Rf();Pe(Z,se)};at(ue,Z=>{V(y)?Z(xe):Z(Ve,!1)})}var $e=Oe(Y,2),lt=Oe(ce($e),2),_e=ce(lt);{var Nt=Z=>{var se=Of(),Le=ce(se);Mu(Le,{get dialogue(){return V(y)},index:0}),Pe(Z,se)},ze=Z=>{var se=jf();Pe(Z,se)};at(_e,Z=>{V(y)?Z(Nt):Z(ze,!1)})}ln(()=>En(N,`Сцены (${(V(t)?.dialogues.length||0)??""})`)),Pe(n,E),Jr()}Ou(["click","change"]);var Lf=Ne('<button style="position:fixed; top:10px; right:10px; z-index:9999;">Закрыть редактор</button> <!>',1),Ff=Ne('<button style="position:fixed; bottom:10px; right:10px; z-index:9999;">Редактор</button> <!>',1);function $f(n){let e=Xe(!1);var t=Dn(),r=un(t);{var o=c=>{var f=Lf(),v=un(f),m=Oe(v,2);Mf(m,{}),va("click",v,()=>Me(e,!1)),Pe(c,f)},u=c=>{var f=Ff(),v=un(f),m=Oe(v,2);fh(m,{}),va("click",v,()=>Me(e,!0)),Pe(c,f)};at(r,c=>{V(e)?c(o):c(u,!1)})}Pe(n,t)}Rc($f,{target:document.getElementById("app")});
