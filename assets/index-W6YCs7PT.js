(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const DEV=!1;var is_array=Array.isArray,index_of=Array.prototype.indexOf,includes=Array.prototype.includes,array_from=Array.from,define_property=Object.defineProperty,get_descriptor=Object.getOwnPropertyDescriptor,get_descriptors=Object.getOwnPropertyDescriptors,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf,is_extensible=Object.isExtensible;function is_function(r){return typeof r=="function"}const noop$2=()=>{};function run(r){return r()}function run_all(r){for(var e=0;e<r.length;e++)r[e]()}function deferred(){var r,e,t=new Promise((n,i)=>{r=n,e=i});return{promise:t,resolve:r,reject:e}}const DERIVED=2,EFFECT=4,RENDER_EFFECT=8,MANAGED_EFFECT=1<<24,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,CONNECTED=512,CLEAN=1024,DIRTY=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,REACTION_RAN=32768,EFFECT_TRANSPARENT=65536,EAGER_EFFECT=1<<17,HEAD_EFFECT=1<<18,EFFECT_PRESERVED=1<<19,USER_EFFECT=1<<20,EFFECT_OFFSCREEN=1<<25,WAS_MARKED=65536,REACTION_IS_UPDATING=1<<21,ASYNC=1<<22,ERROR_VALUE=1<<23,STATE_SYMBOL=Symbol("$state"),LEGACY_PROPS=Symbol("legacy props"),LOADING_ATTR_SYMBOL=Symbol(""),STALE_REACTION=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"},IS_XHTML=!!globalThis.document?.contentType&&globalThis.document.contentType.includes("xml");function lifecycle_outside_component(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function async_derived_orphan(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function each_key_duplicate(r,e,t){throw new Error("https://svelte.dev/e/each_key_duplicate")}function effect_in_teardown(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function effect_in_unowned_derived(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function effect_orphan(r){throw new Error("https://svelte.dev/e/effect_orphan")}function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function props_invalid_value(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function svelte_boundary_reset_onerror(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const EACH_ITEM_REACTIVE=1,EACH_INDEX_REACTIVE=2,EACH_IS_CONTROLLED=4,EACH_IS_ANIMATED=8,EACH_ITEM_IMMUTABLE=16,PROPS_IS_IMMUTABLE=1,PROPS_IS_RUNES=2,PROPS_IS_UPDATED=4,PROPS_IS_BINDABLE=8,PROPS_IS_LAZY_INITIAL=16,TRANSITION_GLOBAL=4,TEMPLATE_FRAGMENT=1,TEMPLATE_USE_IMPORT_NODE=2,UNINITIALIZED=Symbol(),NAMESPACE_HTML="http://www.w3.org/1999/xhtml";function select_multiple_invalid_value(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function svelte_boundary_reset_noop(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function equals$1(r){return r===this.v}function safe_not_equal(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function safe_equals(r){return!safe_not_equal(r,this.v)}let legacy_mode_flag=!1,tracing_mode_flag=!1;function enable_legacy_mode_flag(){legacy_mode_flag=!0}let component_context=null;function set_component_context(r){component_context=r}function push(r,e=!1,t){component_context={p:component_context,i:!1,c:null,e:null,s:r,x:null,l:legacy_mode_flag&&!e?{s:null,u:null,$:[]}:null}}function pop(r){var e=component_context,t=e.e;if(t!==null){e.e=null;for(var n of t)create_user_effect(n)}return e.i=!0,component_context=e.p,{}}function is_runes(){return!legacy_mode_flag||component_context!==null&&component_context.l===null}let micro_tasks=[];function run_micro_tasks(){var r=micro_tasks;micro_tasks=[],run_all(r)}function queue_micro_task(r){if(micro_tasks.length===0&&!is_flushing_sync){var e=micro_tasks;queueMicrotask(()=>{e===micro_tasks&&run_micro_tasks()})}micro_tasks.push(r)}function flush_tasks(){for(;micro_tasks.length>0;)run_micro_tasks()}function handle_error(r){var e=active_effect;if(e===null)return active_reaction.f|=ERROR_VALUE,r;if((e.f&REACTION_RAN)===0&&(e.f&EFFECT)===0)throw r;invoke_error_boundary(r,e)}function invoke_error_boundary(r,e){for(;e!==null;){if((e.f&BOUNDARY_EFFECT)!==0){if((e.f&REACTION_RAN)===0)throw r;try{e.b.error(r);return}catch(t){r=t}}e=e.parent}throw r}const STATUS_MASK=-7169;function set_signal_status(r,e){r.f=r.f&STATUS_MASK|e}function update_derived_status(r){(r.f&CONNECTED)!==0||r.deps===null?set_signal_status(r,CLEAN):set_signal_status(r,MAYBE_DIRTY)}function clear_marked(r){if(r!==null)for(const e of r)(e.f&DERIVED)===0||(e.f&WAS_MARKED)===0||(e.f^=WAS_MARKED,clear_marked(e.deps))}function defer_effect(r,e,t){(r.f&DIRTY)!==0?e.add(r):(r.f&MAYBE_DIRTY)!==0&&t.add(r),clear_marked(r.deps),set_signal_status(r,CLEAN)}const batches=new Set;let current_batch=null,previous_batch=null,batch_values=null,queued_root_effects=[],last_scheduled_effect=null,is_flushing_sync=!1,collected_effects=null;class Batch{current=new Map;previous=new Map;#e=new Set;#a=new Set;#t=0;#o=0;#r=null;#s=new Set;#n=new Set;#i=new Map;is_fork=!1;#l=!1;#u(){return this.is_fork||this.#o>0}skip_effect(e){this.#i.has(e)||this.#i.set(e,{d:[],m:[]})}unskip_effect(e){var t=this.#i.get(e);if(t){this.#i.delete(e);for(var n of t.d)set_signal_status(n,DIRTY),schedule_effect(n);for(n of t.m)set_signal_status(n,MAYBE_DIRTY),schedule_effect(n)}}process(e){queued_root_effects=[],this.apply();var t=collected_effects=[],n=[];for(const i of e)this.#c(i,t,n);if(collected_effects=null,this.#u()){this.#d(n),this.#d(t);for(const[i,s]of this.#i)reset_branch(i,s)}else{previous_batch=this,current_batch=null;for(const i of this.#e)i(this);this.#e.clear(),this.#t===0&&this.#f(),flush_queued_effects(n),flush_queued_effects(t),this.#s.clear(),this.#n.clear(),previous_batch=null,this.#r?.resolve()}batch_values=null}#c(e,t,n){e.f^=CLEAN;for(var i=e.first;i!==null;){var s=i.f,o=(s&(BRANCH_EFFECT|ROOT_EFFECT))!==0,c=o&&(s&CLEAN)!==0,f=c||(s&INERT)!==0||this.#i.has(i);if(!f&&i.fn!==null){o?i.f^=CLEAN:(s&EFFECT)!==0?t.push(i):is_dirty(i)&&((s&BLOCK_EFFECT)!==0&&this.#n.add(i),update_effect(i));var v=i.first;if(v!==null){i=v;continue}}for(;i!==null;){var h=i.next;if(h!==null){i=h;break}i=i.parent}}}#d(e){for(var t=0;t<e.length;t+=1)defer_effect(e[t],this.#s,this.#n)}capture(e,t){t!==UNINITIALIZED&&!this.previous.has(e)&&this.previous.set(e,t),(e.f&ERROR_VALUE)===0&&(this.current.set(e,e.v),batch_values?.set(e,e.v))}activate(){current_batch=this,this.apply()}deactivate(){current_batch===this&&(current_batch=null,batch_values=null)}flush(){if(queued_root_effects.length>0)current_batch=this,flush_effects();else if(this.#t===0&&!this.is_fork){for(const e of this.#e)e(this);this.#e.clear(),this.#f(),this.#r?.resolve()}this.deactivate()}discard(){for(const e of this.#a)e(this);this.#a.clear()}#f(){if(batches.size>1){this.previous.clear();var e=current_batch,t=batch_values,n=!0;for(const s of batches){if(s===this){n=!1;continue}const o=[];for(const[f,v]of this.current){if(s.current.has(f))if(n&&v!==s.current.get(f))s.current.set(f,v);else continue;o.push(f)}if(o.length===0)continue;const c=[...s.current.keys()].filter(f=>!this.current.has(f));if(c.length>0){var i=queued_root_effects;queued_root_effects=[];const f=new Set,v=new Map;for(const h of o)mark_effects(h,c,f,v);if(queued_root_effects.length>0){current_batch=s,s.apply();for(const h of queued_root_effects)s.#c(h,[],[]);s.deactivate()}queued_root_effects=i}}current_batch=e,batch_values=t}this.#i.clear(),batches.delete(this)}increment(e){this.#t+=1,e&&(this.#o+=1)}decrement(e){this.#t-=1,e&&(this.#o-=1),!this.#l&&(this.#l=!0,queue_micro_task(()=>{this.#l=!1,this.#u()?queued_root_effects.length>0&&this.flush():this.revive()}))}revive(){for(const e of this.#s)this.#n.delete(e),set_signal_status(e,DIRTY),schedule_effect(e);for(const e of this.#n)set_signal_status(e,MAYBE_DIRTY),schedule_effect(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#a.add(e)}settled(){return(this.#r??=deferred()).promise}static ensure(){if(current_batch===null){const e=current_batch=new Batch;batches.add(current_batch),is_flushing_sync||queue_micro_task(()=>{current_batch===e&&e.flush()})}return current_batch}apply(){}}function flushSync(r){var e=is_flushing_sync;is_flushing_sync=!0;try{for(var t;;){if(flush_tasks(),queued_root_effects.length===0&&(current_batch?.flush(),queued_root_effects.length===0))return last_scheduled_effect=null,t;flush_effects()}}finally{is_flushing_sync=e}}function flush_effects(){var r=null;try{for(var e=0;queued_root_effects.length>0;){var t=Batch.ensure();if(e++>1e3){var n,i;infinite_loop_guard()}t.process(queued_root_effects),old_values.clear()}}finally{queued_root_effects=[],last_scheduled_effect=null,collected_effects=null}}function infinite_loop_guard(){try{effect_update_depth_exceeded()}catch(r){invoke_error_boundary(r,last_scheduled_effect)}}let eager_block_effects=null;function flush_queued_effects(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(DESTROYED|INERT))===0&&is_dirty(n)&&(eager_block_effects=new Set,update_effect(n),n.deps===null&&n.first===null&&n.nodes===null&&n.teardown===null&&n.ac===null&&unlink_effect(n),eager_block_effects?.size>0)){old_values.clear();for(const i of eager_block_effects){if((i.f&(DESTROYED|INERT))!==0)continue;const s=[i];let o=i.parent;for(;o!==null;)eager_block_effects.has(o)&&(eager_block_effects.delete(o),s.push(o)),o=o.parent;for(let c=s.length-1;c>=0;c--){const f=s[c];(f.f&(DESTROYED|INERT))===0&&update_effect(f)}}eager_block_effects.clear()}}eager_block_effects=null}}function mark_effects(r,e,t,n){if(!t.has(r)&&(t.add(r),r.reactions!==null))for(const i of r.reactions){const s=i.f;(s&DERIVED)!==0?mark_effects(i,e,t,n):(s&(ASYNC|BLOCK_EFFECT))!==0&&(s&DIRTY)===0&&depends_on(i,e,n)&&(set_signal_status(i,DIRTY),schedule_effect(i))}}function depends_on(r,e,t){const n=t.get(r);if(n!==void 0)return n;if(r.deps!==null)for(const i of r.deps){if(includes.call(e,i))return!0;if((i.f&DERIVED)!==0&&depends_on(i,e,t))return t.set(i,!0),!0}return t.set(r,!1),!1}function schedule_effect(r){var e=last_scheduled_effect=r,t=e.b;if(t?.is_pending&&(r.f&(EFFECT|RENDER_EFFECT|MANAGED_EFFECT))!==0&&(r.f&REACTION_RAN)===0){t.defer_effect(r);return}for(;e.parent!==null;){e=e.parent;var n=e.f;if(collected_effects!==null&&e===active_effect&&(r.f&RENDER_EFFECT)===0)return;if((n&(ROOT_EFFECT|BRANCH_EFFECT))!==0){if((n&CLEAN)===0)return;e.f^=CLEAN}}queued_root_effects.push(e)}function reset_branch(r,e){if(!((r.f&BRANCH_EFFECT)!==0&&(r.f&CLEAN)!==0)){(r.f&DIRTY)!==0?e.d.push(r):(r.f&MAYBE_DIRTY)!==0&&e.m.push(r),set_signal_status(r,CLEAN);for(var t=r.first;t!==null;)reset_branch(t,e),t=t.next}}function createSubscriber(r){let e=0,t=source(0),n;return()=>{effect_tracking()&&(get$2(t),render_effect(()=>(e===0&&(n=untrack(()=>r(()=>increment(t)))),e+=1,()=>{queue_micro_task(()=>{e-=1,e===0&&(n?.(),n=void 0,increment(t))})})))}}var flags=EFFECT_TRANSPARENT|EFFECT_PRESERVED;function boundary(r,e,t,n){new Boundary(r,e,t,n)}class Boundary{parent;is_pending=!1;transform_error;#e;#a=null;#t;#o;#r;#s=null;#n=null;#i=null;#l=null;#u=0;#c=0;#d=!1;#f=new Set;#v=new Set;#h=null;#b=createSubscriber(()=>(this.#h=source(this.#u),()=>{this.#h=null}));constructor(e,t,n,i){this.#e=e,this.#t=t,this.#o=s=>{var o=active_effect;o.b=this,o.f|=BOUNDARY_EFFECT,n(s)},this.parent=active_effect.b,this.transform_error=i??this.parent?.transform_error??(s=>s),this.#r=block(()=>{this.#_()},flags)}#y(){try{this.#s=branch(()=>this.#o(this.#e))}catch(e){this.error(e)}}#w(e){const t=this.#t.failed;t&&(this.#i=branch(()=>{t(this.#e,()=>e,()=>()=>{})}))}#$(){const e=this.#t.pending;e&&(this.is_pending=!0,this.#n=branch(()=>e(this.#e)),queue_micro_task(()=>{var t=this.#l=document.createDocumentFragment(),n=create_text();t.append(n),this.#s=this.#p(()=>(Batch.ensure(),branch(()=>this.#o(n)))),this.#c===0&&(this.#e.before(t),this.#l=null,pause_effect(this.#n,()=>{this.#n=null}),this.#g())}))}#_(){try{if(this.is_pending=this.has_pending_snippet(),this.#c=0,this.#u=0,this.#s=branch(()=>{this.#o(this.#e)}),this.#c>0){var e=this.#l=document.createDocumentFragment();move_effect(this.#s,e);const t=this.#t.pending;this.#n=branch(()=>t(this.#e))}else this.#g()}catch(t){this.error(t)}}#g(){this.is_pending=!1;for(const e of this.#f)set_signal_status(e,DIRTY),schedule_effect(e);for(const e of this.#v)set_signal_status(e,MAYBE_DIRTY),schedule_effect(e);this.#f.clear(),this.#v.clear()}defer_effect(e){defer_effect(e,this.#f,this.#v)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#p(e){var t=active_effect,n=active_reaction,i=component_context;set_active_effect(this.#r),set_active_reaction(this.#r),set_component_context(this.#r.ctx);try{return e()}catch(s){return handle_error(s),null}finally{set_active_effect(t),set_active_reaction(n),set_component_context(i)}}#m(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#m(e);return}this.#c+=e,this.#c===0&&(this.#g(),this.#n&&pause_effect(this.#n,()=>{this.#n=null}),this.#l&&(this.#e.before(this.#l),this.#l=null))}update_pending_count(e){this.#m(e),this.#u+=e,!(!this.#h||this.#d)&&(this.#d=!0,queue_micro_task(()=>{this.#d=!1,this.#h&&internal_set(this.#h,this.#u)}))}get_effect_pending(){return this.#b(),get$2(this.#h)}error(e){var t=this.#t.onerror;let n=this.#t.failed;if(!t&&!n)throw e;this.#s&&(destroy_effect(this.#s),this.#s=null),this.#n&&(destroy_effect(this.#n),this.#n=null),this.#i&&(destroy_effect(this.#i),this.#i=null);var i=!1,s=!1;const o=()=>{if(i){svelte_boundary_reset_noop();return}i=!0,s&&svelte_boundary_reset_onerror(),this.#i!==null&&pause_effect(this.#i,()=>{this.#i=null}),this.#p(()=>{Batch.ensure(),this.#_()})},c=f=>{try{s=!0,t?.(f,o),s=!1}catch(v){invoke_error_boundary(v,this.#r&&this.#r.parent)}n&&(this.#i=this.#p(()=>{Batch.ensure();try{return branch(()=>{var v=active_effect;v.b=this,v.f|=BOUNDARY_EFFECT,n(this.#e,()=>f,()=>o)})}catch(v){return invoke_error_boundary(v,this.#r.parent),null}}))};queue_micro_task(()=>{var f;try{f=this.transform_error(e)}catch(v){invoke_error_boundary(v,this.#r&&this.#r.parent);return}f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(c,v=>invoke_error_boundary(v,this.#r&&this.#r.parent)):c(f)})}}function flatten(r,e,t,n){const i=is_runes()?derived:derived_safe_equal;var s=r.filter(m=>!m.settled);if(t.length===0&&s.length===0){n(e.map(i));return}var o=active_effect,c=capture(),f=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(m=>m.promise)):null;function v(m){c();try{n(m)}catch(y){(o.f&DESTROYED)===0&&invoke_error_boundary(y,o)}unset_context()}if(t.length===0){f.then(()=>v(e.map(i)));return}function h(){c(),Promise.all(t.map(m=>async_derived(m))).then(m=>v([...e.map(i),...m])).catch(m=>invoke_error_boundary(m,o))}f?f.then(h):h()}function capture(){var r=active_effect,e=active_reaction,t=component_context,n=current_batch;return function(s=!0){set_active_effect(r),set_active_reaction(e),set_component_context(t),s&&n?.activate()}}function unset_context(r=!0){set_active_effect(null),set_active_reaction(null),set_component_context(null),r&&current_batch?.deactivate()}function increment_pending(){var r=active_effect.b,e=current_batch,t=r.is_rendered();return r.update_pending_count(1),e.increment(t),()=>{r.update_pending_count(-1),e.decrement(t)}}function derived(r){var e=DERIVED|DIRTY,t=active_reaction!==null&&(active_reaction.f&DERIVED)!==0?active_reaction:null;return active_effect!==null&&(active_effect.f|=EFFECT_PRESERVED),{ctx:component_context,deps:null,effects:null,equals:equals$1,f:e,fn:r,reactions:null,rv:0,v:UNINITIALIZED,wv:0,parent:t??active_effect,ac:null}}function async_derived(r,e,t){active_effect===null&&async_derived_orphan();var i=void 0,s=source(UNINITIALIZED),o=!active_reaction,c=new Map;return async_effect(()=>{var f=deferred();i=f.promise;try{Promise.resolve(r()).then(f.resolve,f.reject).finally(unset_context)}catch(y){f.reject(y),unset_context()}var v=current_batch;if(o){var h=increment_pending();c.get(v)?.reject(STALE_REACTION),c.delete(v),c.set(v,f)}const m=(y,g=void 0)=>{if(v.activate(),g)g!==STALE_REACTION&&(s.f|=ERROR_VALUE,internal_set(s,g));else{(s.f&ERROR_VALUE)!==0&&(s.f^=ERROR_VALUE),internal_set(s,y);for(const[w,k]of c){if(c.delete(w),w===v)break;k.reject(STALE_REACTION)}}h&&h()};f.promise.then(m,y=>m(null,y||"unknown"))}),teardown(()=>{for(const f of c.values())f.reject(STALE_REACTION)}),new Promise(f=>{function v(h){function m(){h===i?f(s):v(i)}h.then(m,m)}v(i)})}function user_derived(r){const e=derived(r);return push_reaction_value(e),e}function derived_safe_equal(r){const e=derived(r);return e.equals=safe_equals,e}function destroy_derived_effects(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)destroy_effect(e[t])}}function get_derived_parent_effect(r){for(var e=r.parent;e!==null;){if((e.f&DERIVED)===0)return(e.f&DESTROYED)===0?e:null;e=e.parent}return null}function execute_derived(r){var e,t=active_effect;set_active_effect(get_derived_parent_effect(r));try{r.f&=~WAS_MARKED,destroy_derived_effects(r),e=update_reaction(r)}finally{set_active_effect(t)}return e}function update_derived(r){var e=execute_derived(r);if(!r.equals(e)&&(r.wv=increment_write_version(),(!current_batch?.is_fork||r.deps===null)&&(r.v=e,r.deps===null))){set_signal_status(r,CLEAN);return}is_destroying_effect||(batch_values!==null?(effect_tracking()||current_batch?.is_fork)&&batch_values.set(r,e):update_derived_status(r))}function freeze_derived_effects(r){if(r.effects!==null)for(const e of r.effects)(e.teardown||e.ac)&&(e.teardown?.(),e.ac?.abort(STALE_REACTION),e.teardown=noop$2,e.ac=null,remove_reactions(e,0),destroy_effect_children(e))}function unfreeze_derived_effects(r){if(r.effects!==null)for(const e of r.effects)e.teardown&&update_effect(e)}let eager_effects=new Set;const old_values=new Map;let eager_effects_deferred=!1;function source(r,e){var t={f:0,v:r,reactions:null,equals:equals$1,rv:0,wv:0};return t}function state(r,e){const t=source(r);return push_reaction_value(t),t}function mutable_source(r,e=!1,t=!0){const n=source(r);return e||(n.equals=safe_equals),legacy_mode_flag&&t&&component_context!==null&&component_context.l!==null&&(component_context.l.s??=[]).push(n),n}function set(r,e,t=!1){active_reaction!==null&&(!untracking||(active_reaction.f&EAGER_EFFECT)!==0)&&is_runes()&&(active_reaction.f&(DERIVED|BLOCK_EFFECT|ASYNC|EAGER_EFFECT))!==0&&(current_sources===null||!includes.call(current_sources,r))&&state_unsafe_mutation();let n=t?proxy(e):e;return internal_set(r,n)}function internal_set(r,e){if(!r.equals(e)){var t=r.v;is_destroying_effect?old_values.set(r,e):old_values.set(r,t),r.v=e;var n=Batch.ensure();if(n.capture(r,t),(r.f&DERIVED)!==0){const i=r;(r.f&DIRTY)!==0&&execute_derived(i),update_derived_status(i)}r.wv=increment_write_version(),mark_reactions(r,DIRTY),is_runes()&&active_effect!==null&&(active_effect.f&CLEAN)!==0&&(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))===0&&(untracked_writes===null?set_untracked_writes([r]):untracked_writes.push(r)),!n.is_fork&&eager_effects.size>0&&!eager_effects_deferred&&flush_eager_effects()}return e}function flush_eager_effects(){eager_effects_deferred=!1;for(const r of eager_effects)(r.f&CLEAN)!==0&&set_signal_status(r,MAYBE_DIRTY),is_dirty(r)&&update_effect(r);eager_effects.clear()}function update(r,e=1){var t=get$2(r),n=e===1?t++:t--;return set(r,t),n}function increment(r){set(r,r.v+1)}function mark_reactions(r,e){var t=r.reactions;if(t!==null)for(var n=is_runes(),i=t.length,s=0;s<i;s++){var o=t[s],c=o.f;if(!(!n&&o===active_effect)){var f=(c&DIRTY)===0;if(f&&set_signal_status(o,e),(c&DERIVED)!==0){var v=o;batch_values?.delete(v),(c&WAS_MARKED)===0&&(c&CONNECTED&&(o.f|=WAS_MARKED),mark_reactions(v,MAYBE_DIRTY))}else f&&((c&BLOCK_EFFECT)!==0&&eager_block_effects!==null&&eager_block_effects.add(o),schedule_effect(o))}}}function proxy(r){if(typeof r!="object"||r===null||STATE_SYMBOL in r)return r;const e=get_prototype_of(r);if(e!==object_prototype&&e!==array_prototype)return r;var t=new Map,n=is_array(r),i=state(0),s=update_version,o=c=>{if(update_version===s)return c();var f=active_reaction,v=update_version;set_active_reaction(null),set_update_version(s);var h=c();return set_active_reaction(f),set_update_version(v),h};return n&&t.set("length",state(r.length)),new Proxy(r,{defineProperty(c,f,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&state_descriptors_fixed();var h=t.get(f);return h===void 0?o(()=>{var m=state(v.value);return t.set(f,m),m}):set(h,v.value,!0),!0},deleteProperty(c,f){var v=t.get(f);if(v===void 0){if(f in c){const h=o(()=>state(UNINITIALIZED));t.set(f,h),increment(i)}}else set(v,UNINITIALIZED),increment(i);return!0},get(c,f,v){if(f===STATE_SYMBOL)return r;var h=t.get(f),m=f in c;if(h===void 0&&(!m||get_descriptor(c,f)?.writable)&&(h=o(()=>{var g=proxy(m?c[f]:UNINITIALIZED),w=state(g);return w}),t.set(f,h)),h!==void 0){var y=get$2(h);return y===UNINITIALIZED?void 0:y}return Reflect.get(c,f,v)},getOwnPropertyDescriptor(c,f){var v=Reflect.getOwnPropertyDescriptor(c,f);if(v&&"value"in v){var h=t.get(f);h&&(v.value=get$2(h))}else if(v===void 0){var m=t.get(f),y=m?.v;if(m!==void 0&&y!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:y,writable:!0}}return v},has(c,f){if(f===STATE_SYMBOL)return!0;var v=t.get(f),h=v!==void 0&&v.v!==UNINITIALIZED||Reflect.has(c,f);if(v!==void 0||active_effect!==null&&(!h||get_descriptor(c,f)?.writable)){v===void 0&&(v=o(()=>{var y=h?proxy(c[f]):UNINITIALIZED,g=state(y);return g}),t.set(f,v));var m=get$2(v);if(m===UNINITIALIZED)return!1}return h},set(c,f,v,h){var m=t.get(f),y=f in c;if(n&&f==="length")for(var g=v;g<m.v;g+=1){var w=t.get(g+"");w!==void 0?set(w,UNINITIALIZED):g in c&&(w=o(()=>state(UNINITIALIZED)),t.set(g+"",w))}if(m===void 0)(!y||get_descriptor(c,f)?.writable)&&(m=o(()=>state(void 0)),set(m,proxy(v)),t.set(f,m));else{y=m.v!==UNINITIALIZED;var k=o(()=>proxy(v));set(m,k)}var I=Reflect.getOwnPropertyDescriptor(c,f);if(I?.set&&I.set.call(h,v),!y){if(n&&typeof f=="string"){var O=t.get("length"),B=Number(f);Number.isInteger(B)&&B>=O.v&&set(O,B+1)}increment(i)}return!0},ownKeys(c){get$2(i);var f=Reflect.ownKeys(c).filter(m=>{var y=t.get(m);return y===void 0||y.v!==UNINITIALIZED});for(var[v,h]of t)h.v!==UNINITIALIZED&&!(v in c)&&f.push(v);return f},setPrototypeOf(){state_prototype_fixed()}})}function get_proxied_value(r){try{if(r!==null&&typeof r=="object"&&STATE_SYMBOL in r)return r[STATE_SYMBOL]}catch{}return r}function is(r,e){return Object.is(get_proxied_value(r),get_proxied_value(e))}var $window,is_firefox,first_child_getter,next_sibling_getter;function init_operations(){if($window===void 0){$window=window,is_firefox=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;first_child_getter=get_descriptor(e,"firstChild").get,next_sibling_getter=get_descriptor(e,"nextSibling").get,is_extensible(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),is_extensible(t)&&(t.__t=void 0)}}function create_text(r=""){return document.createTextNode(r)}function get_first_child(r){return first_child_getter.call(r)}function get_next_sibling(r){return next_sibling_getter.call(r)}function child(r,e){return get_first_child(r)}function first_child(r,e=!1){{var t=get_first_child(r);return t instanceof Comment&&t.data===""?get_next_sibling(t):t}}function sibling(r,e=1,t=!1){let n=r;for(;e--;)n=get_next_sibling(n);return n}function clear_text_content(r){r.textContent=""}function should_defer_append(){return!1}function create_element(r,e,t){return document.createElementNS(NAMESPACE_HTML,r,void 0)}let listening_to_form_reset=!1;function add_form_reset_listener(){listening_to_form_reset||(listening_to_form_reset=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function without_reactive_context(r){var e=active_reaction,t=active_effect;set_active_reaction(null),set_active_effect(null);try{return r()}finally{set_active_reaction(e),set_active_effect(t)}}function listen_to_event_and_reset_event(r,e,t,n=t){r.addEventListener(e,()=>without_reactive_context(t));const i=r.__on_r;i?r.__on_r=()=>{i(),n(!0)}:r.__on_r=()=>n(!0),add_form_reset_listener()}function validate_effect(r){active_effect===null&&(active_reaction===null&&effect_orphan(),effect_in_unowned_derived()),is_destroying_effect&&effect_in_teardown()}function push_effect(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function create_effect(r,e){var t=active_effect;t!==null&&(t.f&INERT)!==0&&(r|=INERT);var n={ctx:component_context,deps:null,nodes:null,f:r|DIRTY|CONNECTED,first:null,fn:e,last:null,next:null,parent:t,b:t&&t.b,prev:null,teardown:null,wv:0,ac:null},i=n;if((r&EFFECT)!==0)collected_effects!==null?collected_effects.push(n):schedule_effect(n);else if(e!==null){try{update_effect(n)}catch(o){throw destroy_effect(n),o}i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&EFFECT_PRESERVED)===0&&(i=i.first,(r&BLOCK_EFFECT)!==0&&(r&EFFECT_TRANSPARENT)!==0&&i!==null&&(i.f|=EFFECT_TRANSPARENT))}if(i!==null&&(i.parent=t,t!==null&&push_effect(i,t),active_reaction!==null&&(active_reaction.f&DERIVED)!==0&&(r&ROOT_EFFECT)===0)){var s=active_reaction;(s.effects??=[]).push(i)}return n}function effect_tracking(){return active_reaction!==null&&!untracking}function teardown(r){const e=create_effect(RENDER_EFFECT,null);return set_signal_status(e,CLEAN),e.teardown=r,e}function user_effect(r){validate_effect();var e=active_effect.f,t=!active_reaction&&(e&BRANCH_EFFECT)!==0&&(e&REACTION_RAN)===0;if(t){var n=component_context;(n.e??=[]).push(r)}else return create_user_effect(r)}function create_user_effect(r){return create_effect(EFFECT|USER_EFFECT,r)}function user_pre_effect(r){return validate_effect(),create_effect(RENDER_EFFECT|USER_EFFECT,r)}function component_root(r){Batch.ensure();const e=create_effect(ROOT_EFFECT|EFFECT_PRESERVED,r);return(t={})=>new Promise(n=>{t.outro?pause_effect(e,()=>{destroy_effect(e),n(void 0)}):(destroy_effect(e),n(void 0))})}function effect(r){return create_effect(EFFECT,r)}function async_effect(r){return create_effect(ASYNC|EFFECT_PRESERVED,r)}function render_effect(r,e=0){return create_effect(RENDER_EFFECT|e,r)}function template_effect(r,e=[],t=[],n=[]){flatten(n,e,t,i=>{create_effect(RENDER_EFFECT,()=>r(...i.map(get$2)))})}function block(r,e=0){var t=create_effect(BLOCK_EFFECT|e,r);return t}function branch(r){return create_effect(BRANCH_EFFECT|EFFECT_PRESERVED,r)}function execute_effect_teardown(r){var e=r.teardown;if(e!==null){const t=is_destroying_effect,n=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{e.call(null)}finally{set_is_destroying_effect(t),set_active_reaction(n)}}}function destroy_effect_children(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const i=t.ac;i!==null&&without_reactive_context(()=>{i.abort(STALE_REACTION)});var n=t.next;(t.f&ROOT_EFFECT)!==0?t.parent=null:destroy_effect(t,e),t=n}}function destroy_block_effect_children(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&BRANCH_EFFECT)===0&&destroy_effect(e),e=t}}function destroy_effect(r,e=!0){var t=!1;(e||(r.f&HEAD_EFFECT)!==0)&&r.nodes!==null&&r.nodes.end!==null&&(remove_effect_dom(r.nodes.start,r.nodes.end),t=!0),destroy_effect_children(r,e&&!t),remove_reactions(r,0),set_signal_status(r,DESTROYED);var n=r.nodes&&r.nodes.t;if(n!==null)for(const s of n)s.stop();execute_effect_teardown(r);var i=r.parent;i!==null&&i.first!==null&&unlink_effect(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes=r.ac=null}function remove_effect_dom(r,e){for(;r!==null;){var t=r===e?null:get_next_sibling(r);r.remove(),r=t}}function unlink_effect(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function pause_effect(r,e,t=!0){var n=[];pause_children(r,n,!0);var i=()=>{t&&destroy_effect(r),e&&e()},s=n.length;if(s>0){var o=()=>--s||i();for(var c of n)c.out(o)}else i()}function pause_children(r,e,t){if((r.f&INERT)===0){r.f^=INERT;var n=r.nodes&&r.nodes.t;if(n!==null)for(const c of n)(c.is_global||t)&&e.push(c);for(var i=r.first;i!==null;){var s=i.next,o=(i.f&EFFECT_TRANSPARENT)!==0||(i.f&BRANCH_EFFECT)!==0&&(r.f&BLOCK_EFFECT)!==0;pause_children(i,e,o?t:!1),i=s}}}function resume_effect(r){resume_children(r,!0)}function resume_children(r,e){if((r.f&INERT)!==0){r.f^=INERT,(r.f&CLEAN)===0&&(set_signal_status(r,DIRTY),schedule_effect(r));for(var t=r.first;t!==null;){var n=t.next,i=(t.f&EFFECT_TRANSPARENT)!==0||(t.f&BRANCH_EFFECT)!==0;resume_children(t,i?e:!1),t=n}var s=r.nodes&&r.nodes.t;if(s!==null)for(const o of s)(o.is_global||e)&&o.in()}}function move_effect(r,e){if(r.nodes)for(var t=r.nodes.start,n=r.nodes.end;t!==null;){var i=t===n?null:get_next_sibling(t);e.append(t),t=i}}let captured_signals=null;function capture_signals(r){var e=captured_signals;try{if(captured_signals=new Set,untrack(r),e!==null)for(var t of captured_signals)e.add(t);return captured_signals}finally{captured_signals=e}}function invalidate_inner_signals(r){for(var e of capture_signals(r))internal_set(e,e.v)}let is_updating_effect=!1,is_destroying_effect=!1;function set_is_destroying_effect(r){is_destroying_effect=r}let active_reaction=null,untracking=!1;function set_active_reaction(r){active_reaction=r}let active_effect=null;function set_active_effect(r){active_effect=r}let current_sources=null;function push_reaction_value(r){active_reaction!==null&&(current_sources===null?current_sources=[r]:current_sources.push(r))}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(r){untracked_writes=r}let write_version=1,read_version=0,update_version=read_version;function set_update_version(r){update_version=r}function increment_write_version(){return++write_version}function is_dirty(r){var e=r.f;if((e&DIRTY)!==0)return!0;if(e&DERIVED&&(r.f&=~WAS_MARKED),(e&MAYBE_DIRTY)!==0){for(var t=r.deps,n=t.length,i=0;i<n;i++){var s=t[i];if(is_dirty(s)&&update_derived(s),s.wv>r.wv)return!0}(e&CONNECTED)!==0&&batch_values===null&&set_signal_status(r,CLEAN)}return!1}function schedule_possible_effect_self_invalidation(r,e,t=!0){var n=r.reactions;if(n!==null&&!(current_sources!==null&&includes.call(current_sources,r)))for(var i=0;i<n.length;i++){var s=n[i];(s.f&DERIVED)!==0?schedule_possible_effect_self_invalidation(s,e,!1):e===s&&(t?set_signal_status(s,DIRTY):(s.f&CLEAN)!==0&&set_signal_status(s,MAYBE_DIRTY),schedule_effect(s))}}function update_reaction(r){var e=new_deps,t=skipped_deps,n=untracked_writes,i=active_reaction,s=current_sources,o=component_context,c=untracking,f=update_version,v=r.f;new_deps=null,skipped_deps=0,untracked_writes=null,active_reaction=(v&(BRANCH_EFFECT|ROOT_EFFECT))===0?r:null,current_sources=null,set_component_context(r.ctx),untracking=!1,update_version=++read_version,r.ac!==null&&(without_reactive_context(()=>{r.ac.abort(STALE_REACTION)}),r.ac=null);try{r.f|=REACTION_IS_UPDATING;var h=r.fn,m=h();r.f|=REACTION_RAN;var y=r.deps,g=current_batch?.is_fork;if(new_deps!==null){var w;if(g||remove_reactions(r,skipped_deps),y!==null&&skipped_deps>0)for(y.length=skipped_deps+new_deps.length,w=0;w<new_deps.length;w++)y[skipped_deps+w]=new_deps[w];else r.deps=y=new_deps;if(effect_tracking()&&(r.f&CONNECTED)!==0)for(w=skipped_deps;w<y.length;w++)(y[w].reactions??=[]).push(r)}else!g&&y!==null&&skipped_deps<y.length&&(remove_reactions(r,skipped_deps),y.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!untracking&&y!==null&&(r.f&(DERIVED|MAYBE_DIRTY|DIRTY))===0)for(w=0;w<untracked_writes.length;w++)schedule_possible_effect_self_invalidation(untracked_writes[w],r);if(i!==null&&i!==r){if(read_version++,i.deps!==null)for(let k=0;k<t;k+=1)i.deps[k].rv=read_version;if(e!==null)for(const k of e)k.rv=read_version;untracked_writes!==null&&(n===null?n=untracked_writes:n.push(...untracked_writes))}return(r.f&ERROR_VALUE)!==0&&(r.f^=ERROR_VALUE),m}catch(k){return handle_error(k)}finally{r.f^=REACTION_IS_UPDATING,new_deps=e,skipped_deps=t,untracked_writes=n,active_reaction=i,current_sources=s,set_component_context(o),untracking=c,update_version=f}}function remove_reaction(r,e){let t=e.reactions;if(t!==null){var n=index_of.call(t,r);if(n!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[n]=t[i],t.pop())}}if(t===null&&(e.f&DERIVED)!==0&&(new_deps===null||!includes.call(new_deps,e))){var s=e;(s.f&CONNECTED)!==0&&(s.f^=CONNECTED,s.f&=~WAS_MARKED),update_derived_status(s),freeze_derived_effects(s),remove_reactions(s,0)}}function remove_reactions(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)remove_reaction(r,t[n])}function update_effect(r){var e=r.f;if((e&DESTROYED)===0){set_signal_status(r,CLEAN);var t=active_effect,n=is_updating_effect;active_effect=r,is_updating_effect=!0;try{(e&(BLOCK_EFFECT|MANAGED_EFFECT))!==0?destroy_block_effect_children(r):destroy_effect_children(r),execute_effect_teardown(r);var i=update_reaction(r);r.teardown=typeof i=="function"?i:null,r.wv=write_version;var s;DEV&&tracing_mode_flag&&(r.f&DIRTY)!==0&&r.deps}finally{is_updating_effect=n,active_effect=t}}}async function tick(){await Promise.resolve(),flushSync()}function get$2(r){var e=r.f,t=(e&DERIVED)!==0;if(captured_signals?.add(r),active_reaction!==null&&!untracking){var n=active_effect!==null&&(active_effect.f&DESTROYED)!==0;if(!n&&(current_sources===null||!includes.call(current_sources,r))){var i=active_reaction.deps;if((active_reaction.f&REACTION_IS_UPDATING)!==0)r.rv<read_version&&(r.rv=read_version,new_deps===null&&i!==null&&i[skipped_deps]===r?skipped_deps++:new_deps===null?new_deps=[r]:new_deps.push(r));else{(active_reaction.deps??=[]).push(r);var s=r.reactions;s===null?r.reactions=[active_reaction]:includes.call(s,active_reaction)||s.push(active_reaction)}}}if(is_destroying_effect&&old_values.has(r))return old_values.get(r);if(t){var o=r;if(is_destroying_effect){var c=o.v;return((o.f&CLEAN)===0&&o.reactions!==null||depends_on_old_values(o))&&(c=execute_derived(o)),old_values.set(o,c),c}var f=(o.f&CONNECTED)===0&&!untracking&&active_reaction!==null&&(is_updating_effect||(active_reaction.f&CONNECTED)!==0),v=(o.f&REACTION_RAN)===0;is_dirty(o)&&(f&&(o.f|=CONNECTED),update_derived(o)),f&&!v&&(unfreeze_derived_effects(o),reconnect(o))}if(batch_values?.has(r))return batch_values.get(r);if((r.f&ERROR_VALUE)!==0)throw r.v;return r.v}function reconnect(r){if(r.f|=CONNECTED,r.deps!==null)for(const e of r.deps)(e.reactions??=[]).push(r),(e.f&DERIVED)!==0&&(e.f&CONNECTED)===0&&(unfreeze_derived_effects(e),reconnect(e))}function depends_on_old_values(r){if(r.v===UNINITIALIZED)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(old_values.has(e)||(e.f&DERIVED)!==0&&depends_on_old_values(e))return!0;return!1}function untrack(r){var e=untracking;try{return untracking=!0,r()}finally{untracking=e}}function deep_read_state(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(STATE_SYMBOL in r)deep_read(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&STATE_SYMBOL in t&&deep_read(t)}}}function deep_read(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{deep_read(r[n],e)}catch{}const t=get_prototype_of(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=get_descriptors(t);for(let i in n){const s=n[i].get;if(s)try{s.call(r)}catch{}}}}}const PASSIVE_EVENTS=["touchstart","touchmove"];function is_passive_event(r){return PASSIVE_EVENTS.includes(r)}const event_symbol=Symbol("events"),all_registered_events=new Set,root_event_handles=new Set;function create_event(r,e,t,n={}){function i(s){if(n.capture||handle_event_propagation.call(e,s),!s.cancelBubble)return without_reactive_context(()=>t?.call(this,s))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?queue_micro_task(()=>{e.addEventListener(r,i,n)}):e.addEventListener(r,i,n),i}function event(r,e,t,n,i){var s={capture:n,passive:i},o=create_event(r,e,t,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&teardown(()=>{e.removeEventListener(r,o,s)})}function delegated(r,e,t){(e[event_symbol]??={})[r]=t}function delegate(r){for(var e=0;e<r.length;e++)all_registered_events.add(r[e]);for(var t of root_event_handles)t(r)}let last_propagated_event=null;function handle_event_propagation(r){var e=this,t=e.ownerDocument,n=r.type,i=r.composedPath?.()||[],s=i[0]||r.target;last_propagated_event=r;var o=0,c=last_propagated_event===r&&r[event_symbol];if(c){var f=i.indexOf(c);if(f!==-1&&(e===document||e===window)){r[event_symbol]=e;return}var v=i.indexOf(e);if(v===-1)return;f<=v&&(o=f)}if(s=i[o]||r.target,s!==e){define_property(r,"currentTarget",{configurable:!0,get(){return s||t}});var h=active_reaction,m=active_effect;set_active_reaction(null),set_active_effect(null);try{for(var y,g=[];s!==null;){var w=s.assignedSlot||s.parentNode||s.host||null;try{var k=s[event_symbol]?.[n];k!=null&&(!s.disabled||r.target===s)&&k.call(s,r)}catch(I){y?g.push(I):y=I}if(r.cancelBubble||w===e||w===null)break;s=w}if(y){for(let I of g)queueMicrotask(()=>{throw I});throw y}}finally{r[event_symbol]=e,delete r.currentTarget,set_active_reaction(h),set_active_effect(m)}}}const policy=globalThis?.window?.trustedTypes&&globalThis.window.trustedTypes.createPolicy("svelte-trusted-html",{createHTML:r=>r});function create_trusted_html(r){return policy?.createHTML(r)??r}function create_fragment_from_html(r){var e=create_element("template");return e.innerHTML=create_trusted_html(r.replaceAll("<!>","<!---->")),e.content}function assign_nodes(r,e){var t=active_effect;t.nodes===null&&(t.nodes={start:r,end:e,a:null,t:null})}function from_html(r,e){var t=(e&TEMPLATE_FRAGMENT)!==0,n=(e&TEMPLATE_USE_IMPORT_NODE)!==0,i,s=!r.startsWith("<!>");return()=>{i===void 0&&(i=create_fragment_from_html(s?r:"<!>"+r),t||(i=get_first_child(i)));var o=n||is_firefox?document.importNode(i,!0):i.cloneNode(!0);if(t){var c=get_first_child(o),f=o.lastChild;assign_nodes(c,f)}else assign_nodes(o,o);return o}}function from_namespace(r,e,t="svg"){var n=!r.startsWith("<!>"),i=`<${t}>${n?r:"<!>"+r}</${t}>`,s;return()=>{if(!s){var o=create_fragment_from_html(i),c=get_first_child(o);s=get_first_child(c)}var f=s.cloneNode(!0);return assign_nodes(f,f),f}}function from_svg(r,e){return from_namespace(r,e,"svg")}function text(r=""){{var e=create_text(r+"");return assign_nodes(e,e),e}}function comment(){var r=document.createDocumentFragment(),e=document.createComment(""),t=create_text();return r.append(e,t),assign_nodes(e,t),r}function append(r,e){r!==null&&r.before(e)}let should_intro=!0;function set_text(r,e){var t=e==null?"":typeof e=="object"?`${e}`:e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=`${t}`)}function mount(r,e){return _mount(r,e)}const listeners=new Map;function _mount(r,{target:e,anchor:t,props:n={},events:i,context:s,intro:o=!0,transformError:c}){init_operations();var f=void 0,v=component_root(()=>{var h=t??e.appendChild(create_text());boundary(h,{pending:()=>{}},g=>{push({});var w=component_context;s&&(w.c=s),i&&(n.$$events=i),should_intro=o,f=r(g,n)||{},should_intro=!0,pop()},c);var m=new Set,y=g=>{for(var w=0;w<g.length;w++){var k=g[w];if(!m.has(k)){m.add(k);var I=is_passive_event(k);for(const P of[e,document]){var O=listeners.get(P);O===void 0&&(O=new Map,listeners.set(P,O));var B=O.get(k);B===void 0?(P.addEventListener(k,handle_event_propagation,{passive:I}),O.set(k,1)):O.set(k,B+1)}}}};return y(array_from(all_registered_events)),root_event_handles.add(y),()=>{for(var g of m)for(const I of[e,document]){var w=listeners.get(I),k=w.get(g);--k==0?(I.removeEventListener(g,handle_event_propagation),w.delete(g),w.size===0&&listeners.delete(I)):w.set(g,k)}root_event_handles.delete(y),h!==t&&h.parentNode?.removeChild(h)}});return mounted_components.set(f,v),f}let mounted_components=new WeakMap;class BranchManager{anchor;#e=new Map;#a=new Map;#t=new Map;#o=new Set;#r=!0;constructor(e,t=!0){this.anchor=e,this.#r=t}#s=e=>{if(this.#e.has(e)){var t=this.#e.get(e),n=this.#a.get(t);if(n)resume_effect(n),this.#o.delete(t);else{var i=this.#t.get(t);i&&(this.#a.set(t,i.effect),this.#t.delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),n=i.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const c=this.#t.get(o);c&&(destroy_effect(c.effect),this.#t.delete(o))}for(const[s,o]of this.#a){if(s===t||this.#o.has(s))continue;const c=()=>{if(Array.from(this.#e.values()).includes(s)){var v=document.createDocumentFragment();move_effect(o,v),v.append(create_text()),this.#t.set(s,{effect:o,fragment:v})}else destroy_effect(o);this.#o.delete(s),this.#a.delete(s)};this.#r||!n?(this.#o.add(s),pause_effect(o,c,!1)):c()}}};#n=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[n,i]of this.#t)t.includes(n)||(destroy_effect(i.effect),this.#t.delete(n))};ensure(e,t){var n=current_batch,i=should_defer_append();if(t&&!this.#a.has(e)&&!this.#t.has(e))if(i){var s=document.createDocumentFragment(),o=create_text();s.append(o),this.#t.set(e,{effect:branch(()=>t(o)),fragment:s})}else this.#a.set(e,branch(()=>t(this.anchor)));if(this.#e.set(n,e),i){for(const[c,f]of this.#a)c===e?n.unskip_effect(f):n.skip_effect(f);for(const[c,f]of this.#t)c===e?n.unskip_effect(f.effect):n.skip_effect(f.effect);n.oncommit(this.#s),n.ondiscard(this.#n)}else this.#s(n)}}function if_block(r,e,t=!1){var n=new BranchManager(r),i=t?EFFECT_TRANSPARENT:0;function s(o,c){n.ensure(o,c)}block(()=>{var o=!1;e((c,f=0)=>{o=!0,s(f,c)}),o||s(!1,null)},i)}const NAN=Symbol("NaN");function key(r,e,t){var n=new BranchManager(r),i=!is_runes();block(()=>{var s=e();s!==s&&(s=NAN),i&&s!==null&&typeof s=="object"&&(s={}),n.ensure(s,t)})}function index$1(r,e){return e}function pause_effects(r,e,t){for(var n=[],i=e.length,s,o=e.length,c=0;c<i;c++){let m=e[c];pause_effect(m,()=>{if(s){if(s.pending.delete(m),s.done.add(m),s.pending.size===0){var y=r.outrogroups;destroy_effects(array_from(s.done)),y.delete(s),y.size===0&&(r.outrogroups=null)}}else o-=1},!1)}if(o===0){var f=n.length===0&&t!==null;if(f){var v=t,h=v.parentNode;clear_text_content(h),h.append(v),r.items.clear()}destroy_effects(e,!f)}else s={pending:new Set(e),done:new Set},(r.outrogroups??=new Set).add(s)}function destroy_effects(r,e=!0){for(var t=0;t<r.length;t++)destroy_effect(r[t],e)}var offscreen_anchor;function each(r,e,t,n,i,s=null){var o=r,c=new Map,f=(e&EACH_IS_CONTROLLED)!==0;if(f){var v=r;o=v.appendChild(create_text())}var h=null,m=derived_safe_equal(()=>{var O=t();return is_array(O)?O:O==null?[]:array_from(O)}),y,g=!0;function w(){I.fallback=h,reconcile(I,y,o,e,n),h!==null&&(y.length===0?(h.f&EFFECT_OFFSCREEN)===0?resume_effect(h):(h.f^=EFFECT_OFFSCREEN,move(h,null,o)):pause_effect(h,()=>{h=null}))}var k=block(()=>{y=get$2(m);for(var O=y.length,B=new Set,P=current_batch,G=should_defer_append(),Y=0;Y<O;Y+=1){var M=y[Y],T=n(M,Y),x=g?null:c.get(T);x?(x.v&&internal_set(x.v,M),x.i&&internal_set(x.i,Y),G&&P.unskip_effect(x.e)):(x=create_item(c,g?o:offscreen_anchor??=create_text(),M,T,Y,i,e,t),g||(x.e.f|=EFFECT_OFFSCREEN),c.set(T,x)),B.add(T)}if(O===0&&s&&!h&&(g?h=branch(()=>s(o)):(h=branch(()=>s(offscreen_anchor??=create_text())),h.f|=EFFECT_OFFSCREEN)),O>B.size&&each_key_duplicate(),!g)if(G){for(const[D,N]of c)B.has(D)||P.skip_effect(N.e);P.oncommit(w),P.ondiscard(()=>{})}else w();get$2(m)}),I={effect:k,items:c,outrogroups:null,fallback:h};g=!1}function skip_to_branch(r){for(;r!==null&&(r.f&BRANCH_EFFECT)===0;)r=r.next;return r}function reconcile(r,e,t,n,i){var s=(n&EACH_IS_ANIMATED)!==0,o=e.length,c=r.items,f=skip_to_branch(r.effect.first),v,h=null,m,y=[],g=[],w,k,I,O;if(s)for(O=0;O<o;O+=1)w=e[O],k=i(w,O),I=c.get(k).e,(I.f&EFFECT_OFFSCREEN)===0&&(I.nodes?.a?.measure(),(m??=new Set).add(I));for(O=0;O<o;O+=1){if(w=e[O],k=i(w,O),I=c.get(k).e,r.outrogroups!==null)for(const N of r.outrogroups)N.pending.delete(I),N.done.delete(I);if((I.f&EFFECT_OFFSCREEN)!==0)if(I.f^=EFFECT_OFFSCREEN,I===f)move(I,null,t);else{var B=h?h.next:f;I===r.effect.last&&(r.effect.last=I.prev),I.prev&&(I.prev.next=I.next),I.next&&(I.next.prev=I.prev),link(r,h,I),link(r,I,B),move(I,B,t),h=I,y=[],g=[],f=skip_to_branch(h.next);continue}if((I.f&INERT)!==0&&(resume_effect(I),s&&(I.nodes?.a?.unfix(),(m??=new Set).delete(I))),I!==f){if(v!==void 0&&v.has(I)){if(y.length<g.length){var P=g[0],G;h=P.prev;var Y=y[0],M=y[y.length-1];for(G=0;G<y.length;G+=1)move(y[G],P,t);for(G=0;G<g.length;G+=1)v.delete(g[G]);link(r,Y.prev,M.next),link(r,h,Y),link(r,M,P),f=P,h=M,O-=1,y=[],g=[]}else v.delete(I),move(I,f,t),link(r,I.prev,I.next),link(r,I,h===null?r.effect.first:h.next),link(r,h,I),h=I;continue}for(y=[],g=[];f!==null&&f!==I;)(v??=new Set).add(f),g.push(f),f=skip_to_branch(f.next);if(f===null)continue}(I.f&EFFECT_OFFSCREEN)===0&&y.push(I),h=I,f=skip_to_branch(I.next)}if(r.outrogroups!==null){for(const N of r.outrogroups)N.pending.size===0&&(destroy_effects(array_from(N.done)),r.outrogroups?.delete(N));r.outrogroups.size===0&&(r.outrogroups=null)}if(f!==null||v!==void 0){var T=[];if(v!==void 0)for(I of v)(I.f&INERT)===0&&T.push(I);for(;f!==null;)(f.f&INERT)===0&&f!==r.fallback&&T.push(f),f=skip_to_branch(f.next);var x=T.length;if(x>0){var D=(n&EACH_IS_CONTROLLED)!==0&&o===0?t:null;if(s){for(O=0;O<x;O+=1)T[O].nodes?.a?.measure();for(O=0;O<x;O+=1)T[O].nodes?.a?.fix()}pause_effects(r,T,D)}}s&&queue_micro_task(()=>{if(m!==void 0)for(I of m)I.nodes?.a?.apply()})}function create_item(r,e,t,n,i,s,o,c){var f=(o&EACH_ITEM_REACTIVE)!==0?(o&EACH_ITEM_IMMUTABLE)===0?mutable_source(t,!1,!1):source(t):null,v=(o&EACH_INDEX_REACTIVE)!==0?source(i):null;return{v:f,i:v,e:branch(()=>(s(e,f??t,v??i,c),()=>{r.delete(n)}))}}function move(r,e,t){if(r.nodes)for(var n=r.nodes.start,i=r.nodes.end,s=e&&(e.f&EFFECT_OFFSCREEN)===0?e.nodes.start:t;n!==null;){var o=get_next_sibling(n);if(s.before(n),n===i)return;n=o}}function link(r,e,t){e===null?r.effect.first=t:e.next=t,t===null?r.effect.last=e:t.prev=e}function snippet(r,e,...t){var n=new BranchManager(r);block(()=>{const i=e()??null;n.ensure(i,i&&(s=>i(s,...t)))},EFFECT_TRANSPARENT)}function component(r,e,t){var n=new BranchManager(r);block(()=>{var i=e()??null;n.ensure(i,i&&(s=>t(s,i)))},EFFECT_TRANSPARENT)}const now=()=>performance.now(),raf={tick:r=>requestAnimationFrame(r),now:()=>now(),tasks:new Set};function run_tasks(){const r=raf.now();raf.tasks.forEach(e=>{e.c(r)||(raf.tasks.delete(e),e.f())}),raf.tasks.size!==0&&raf.tick(run_tasks)}function loop(r){let e;return raf.tasks.size===0&&raf.tick(run_tasks),{promise:new Promise(t=>{raf.tasks.add(e={c:r,f:t})}),abort(){raf.tasks.delete(e)}}}function dispatch_event(r,e){without_reactive_context(()=>{r.dispatchEvent(new CustomEvent(e))})}function css_property_to_camelcase(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function css_to_keyframe(r){const e={},t=r.split(";");for(const n of t){const[i,s]=n.split(":");if(!i||s===void 0)break;const o=css_property_to_camelcase(i.trim());e[o]=s.trim()}return e}const linear=r=>r;function transition(r,e,t,n){var i=(r&TRANSITION_GLOBAL)!==0,s="in",o,c=e.inert,f=e.style.overflow,v,h;function m(){return without_reactive_context(()=>o??=t()(e,n?.()??{},{direction:s}))}var y={is_global:i,in(){e.inert=c,v?.abort(),v=animate(e,m(),h,1,()=>{dispatch_event(e,"introend"),v?.abort(),v=o=void 0,e.style.overflow=f})},out(I){{I?.(),o=void 0;return}},stop:()=>{v?.abort()}},g=active_effect;if((g.nodes.t??=[]).push(y),should_intro){var w=i;if(!w){for(var k=g.parent;k&&(k.f&EFFECT_TRANSPARENT)!==0;)for(;(k=k.parent)&&(k.f&BLOCK_EFFECT)===0;);w=!k||(k.f&REACTION_RAN)!==0}w&&effect(()=>{untrack(()=>y.in())})}}function animate(r,e,t,n,i){if(is_function(e)){var s,o=!1;return queue_micro_task(()=>{if(!o){var k=e({direction:"in"});s=animate(r,k,t,n,i)}}),{abort:()=>{o=!0,s?.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(!e?.duration&&!e?.delay)return dispatch_event(r,"introstart"),i(),{abort:noop$2,deactivate:noop$2,reset:noop$2,t:()=>n};const{delay:c=0,css:f,tick:v,easing:h=linear}=e;var m=[];if(v&&v(0,1),f){var y=css_to_keyframe(f(0,1));m.push(y,y)}var g=()=>1-n,w=r.animate(m,{duration:c,fill:"forwards"});return w.onfinish=()=>{w.cancel(),dispatch_event(r,"introstart");var k=1-n,I=n-k,O=e.duration*Math.abs(I),B=[];if(O>0){var P=!1;if(f)for(var G=Math.ceil(O/16.666666666666668),Y=0;Y<=G;Y+=1){var M=k+I*h(Y/G),T=css_to_keyframe(f(M,1-M));B.push(T),P||=T.overflow==="hidden"}P&&(r.style.overflow="hidden"),g=()=>{var x=w.currentTime;return k+I*h(x/O)},v&&loop(()=>{if(w.playState!=="running")return!1;var x=g();return v(x,1-x),!0})}w=r.animate(B,{duration:O,fill:"forwards"}),w.onfinish=()=>{g=()=>n,v?.(n,1-n),i()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=noop$2)},deactivate:()=>{i=noop$2},reset:()=>{},t:()=>g()}}const whitespace=[...` 	
\r\f\v\uFEFF`];function to_class(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var i of Object.keys(t))if(t[i])n=n?n+" "+i:i;else if(n.length)for(var s=i.length,o=0;(o=n.indexOf(i,o))>=0;){var c=o+s;(o===0||whitespace.includes(n[o-1]))&&(c===n.length||whitespace.includes(n[c]))?n=(o===0?"":n.substring(0,o))+n.substring(c+1):o=c}}return n===""?null:n}function to_style(r,e){return r==null?null:String(r)}function set_class(r,e,t,n,i,s){var o=r.__className;if(o!==t||o===void 0){var c=to_class(t,n,s);c==null?r.removeAttribute("class"):r.className=c,r.__className=t}else if(s&&i!==s)for(var f in s){var v=!!s[f];(i==null||v!==!!i[f])&&r.classList.toggle(f,v)}return s}function set_style(r,e,t,n){var i=r.__style;if(i!==e){var s=to_style(e);s==null?r.removeAttribute("style"):r.style.cssText=s,r.__style=e}return n}function select_option(r,e,t=!1){if(r.multiple){if(e==null)return;if(!is_array(e))return select_multiple_invalid_value();for(var n of r.options)n.selected=e.includes(get_option_value(n));return}for(n of r.options){var i=get_option_value(n);if(is(i,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function init_select(r){var e=new MutationObserver(()=>{select_option(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),teardown(()=>{e.disconnect()})}function bind_select_value(r,e,t=e){var n=new WeakSet,i=!0;listen_to_event_and_reset_event(r,"change",s=>{var o=s?"[selected]":":checked",c;if(r.multiple)c=[].map.call(r.querySelectorAll(o),get_option_value);else{var f=r.querySelector(o)??r.querySelector("option:not([disabled])");c=f&&get_option_value(f)}t(c),current_batch!==null&&n.add(current_batch)}),effect(()=>{var s=e();if(r===document.activeElement){var o=previous_batch??current_batch;if(n.has(o))return}if(select_option(r,s,i),i&&s===void 0){var c=r.querySelector(":checked");c!==null&&(s=get_option_value(c),t(s))}r.__value=s,i=!1}),init_select(r)}function get_option_value(r){return"__value"in r?r.__value:r.value}const IS_CUSTOM_ELEMENT=Symbol("is custom element"),IS_HTML=Symbol("is html"),PROGRESS_TAG=IS_XHTML?"progress":"PROGRESS";function set_value(r,e){var t=get_attributes(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!==PROGRESS_TAG)||(r.value=e??"")}function set_checked(r,e){var t=get_attributes(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function set_attribute(r,e,t,n){var i=get_attributes(r);i[e]!==(i[e]=t)&&(e==="loading"&&(r[LOADING_ATTR_SYMBOL]=t),t==null?r.removeAttribute(e):typeof t!="string"&&get_setters(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function get_attributes(r){return r.__attributes??={[IS_CUSTOM_ELEMENT]:r.nodeName.includes("-"),[IS_HTML]:r.namespaceURI===NAMESPACE_HTML}}var setters_cache=new Map;function get_setters(r){var e=r.getAttribute("is")||r.nodeName,t=setters_cache.get(e);if(t)return t;setters_cache.set(e,t=[]);for(var n,i=r,s=Element.prototype;s!==i;){n=get_descriptors(i);for(var o in n)n[o].set&&t.push(o);i=get_prototype_of(i)}return t}function bind_value(r,e,t=e){var n=new WeakSet;listen_to_event_and_reset_event(r,"input",async i=>{var s=i?r.defaultValue:r.value;if(s=is_numberlike_input(r)?to_number(s):s,t(s),current_batch!==null&&n.add(current_batch),await tick(),s!==(s=e())){var o=r.selectionStart,c=r.selectionEnd,f=r.value.length;if(r.value=s??"",c!==null){var v=r.value.length;o===c&&c===f&&v>f?(r.selectionStart=v,r.selectionEnd=v):(r.selectionStart=o,r.selectionEnd=Math.min(c,v))}}}),untrack(e)==null&&r.value&&(t(is_numberlike_input(r)?to_number(r.value):r.value),current_batch!==null&&n.add(current_batch)),render_effect(()=>{var i=e();if(r===document.activeElement){var s=previous_batch??current_batch;if(n.has(s))return}is_numberlike_input(r)&&i===to_number(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function bind_checked(r,e,t=e){listen_to_event_and_reset_event(r,"change",n=>{var i=n?r.defaultChecked:r.checked;t(i)}),untrack(e)==null&&t(r.checked),render_effect(()=>{var n=e();r.checked=!!n})}function is_numberlike_input(r){var e=r.type;return e==="number"||e==="range"}function to_number(r){return r===""?null:+r}function is_bound_this(r,e){return r===e||r?.[STATE_SYMBOL]===e}function bind_this(r={},e,t,n){return effect(()=>{var i,s;return render_effect(()=>{i=s,s=[],untrack(()=>{r!==t(...s)&&(e(r,...s),i&&is_bound_this(t(...i),r)&&e(null,...i))})}),()=>{queue_micro_task(()=>{s&&is_bound_this(t(...s),r)&&e(null,...s)})}}),r}function init(r=!1){const e=component_context,t=e.l.u;if(!t)return;let n=()=>deep_read_state(e.s);if(r){let i=0,s={};const o=derived(()=>{let c=!1;const f=e.s;for(const v in f)f[v]!==s[v]&&(s[v]=f[v],c=!0);return c&&i++,i});n=()=>get$2(o)}t.b.length&&user_pre_effect(()=>{observe_all(e,n),run_all(t.b)}),user_effect(()=>{const i=untrack(()=>t.m.map(run));return()=>{for(const s of i)typeof s=="function"&&s()}}),t.a.length&&user_effect(()=>{observe_all(e,n),run_all(t.a)})}function observe_all(r,e){if(r.l.s)for(const t of r.l.s)get$2(t);e()}function reactive_import(r){var e=source(0);return function(){return arguments.length===1?(set(e,get$2(e)+1),arguments[0]):(get$2(e),r())}}function subscribe_to_store(r,e,t){if(r==null)return e(void 0),noop$2;const n=untrack(()=>r.subscribe(e,t));return n.unsubscribe?()=>n.unsubscribe():n}const subscriber_queue=[];function writable(r,e=noop$2){let t=null;const n=new Set;function i(c){if(safe_not_equal(r,c)&&(r=c,t)){const f=!subscriber_queue.length;for(const v of n)v[1](),subscriber_queue.push(v,r);if(f){for(let v=0;v<subscriber_queue.length;v+=2)subscriber_queue[v][0](subscriber_queue[v+1]);subscriber_queue.length=0}}}function s(c){i(c(r))}function o(c,f=noop$2){const v=[c,f];return n.add(v),n.size===1&&(t=e(i,s)||noop$2),c(r),()=>{n.delete(v),n.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:o}}function get$1(r){let e;return subscribe_to_store(r,t=>e=t)(),e}let is_store_binding=!1;function capture_store_binding(r){var e=is_store_binding;try{return is_store_binding=!1,[r(),is_store_binding]}finally{is_store_binding=e}}function prop(r,e,t,n){var i=!legacy_mode_flag||(t&PROPS_IS_RUNES)!==0,s=(t&PROPS_IS_BINDABLE)!==0,o=(t&PROPS_IS_LAZY_INITIAL)!==0,c=n,f=!0,v=()=>(f&&(f=!1,c=o?untrack(n):n),c),h;if(s){var m=STATE_SYMBOL in r||LEGACY_PROPS in r;h=get_descriptor(r,e)?.set??(m&&e in r?P=>r[e]=P:void 0)}var y,g=!1;s?[y,g]=capture_store_binding(()=>r[e]):y=r[e],y===void 0&&n!==void 0&&(y=v(),h&&(i&&props_invalid_value(),h(y)));var w;if(i?w=()=>{var P=r[e];return P===void 0?v():(f=!0,P)}:w=()=>{var P=r[e];return P!==void 0&&(c=void 0),P===void 0?c:P},i&&(t&PROPS_IS_UPDATED)===0)return w;if(h){var k=r.$$legacy;return(function(P,G){return arguments.length>0?((!i||!G||k||g)&&h(G?w():P),P):w()})}var I=!1,O=((t&PROPS_IS_IMMUTABLE)!==0?derived:derived_safe_equal)(()=>(I=!1,w()));s&&get$2(O);var B=active_effect;return(function(P,G){if(arguments.length>0){const Y=G?get$2(O):i&&s?proxy(P):P;return set(O,Y),I=!0,c!==void 0&&(c=Y),P}return is_destroying_effect&&I||(B.f&DESTROYED)!==0?O.v:get$2(O)})}function onMount(r){component_context===null&&lifecycle_outside_component(),legacy_mode_flag&&component_context.l!==null?init_update_callbacks(component_context).m.push(r):user_effect(()=>{const e=untrack(r);if(typeof e=="function")return e})}function onDestroy(r){component_context===null&&lifecycle_outside_component(),onMount(()=>()=>untrack(r))}function init_update_callbacks(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const PUBLIC_VERSION="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(PUBLIC_VERSION);enable_legacy_mode_flag();const editor=proxy({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,manualStorySelected:!1,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:" "},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),editorDerived={get currentDialogue(){return editor.data?.dialogues.find(r=>r.id===editor.selectedDialogueId)},get currentChapter(){return editor.data?.chapters?.find(r=>r.id===editor.selectedChapterId)},get currentEditingChapter(){return editor.data?.chapters?.find(r=>r.id===editor.editingChapterId)},get currentEditingOption(){return editorDerived.currentDialogue&&editor.editingOptionIndex!==null?editorDerived.currentDialogue.options?.[editor.editingOptionIndex]:void 0},get chapterDialogues(){return!editor.data?.dialogues||!editor.selectedChapterId?[]:editor.data.dialogues.filter(r=>r.chapterId===editor.selectedChapterId)},get imageResources(){return editor.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return editor.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return editor.data?.items||[]},get backlinks(){return!editor.data||!editor.selectedDialogueId?[]:editor.data.dialogues.filter(r=>r.nextDialogueId===editor.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===editor.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},editorActions={toggleEditor(){editor.showEditor=!editor.showEditor},toggleItemsPanel(){editor.showItems=!editor.showItems},setStatus(r,e){editor.statusMessage={type:r,text:e}},clearStatus(){editor.statusMessage={type:"",text:""}},selectBucket(r){editor.selectedBucket=r,editor.data={meta:{version:"3.1",title:" "},dialogues:[],chapters:[],items:[],miniGames:[]},editor.storedFiles=[],editor.storiesList=[],editor.selectedChapterId=null,editor.selectedDialogueId=null},updateBucketsList(r){editor.availableBuckets=r},selectChapter(r){editor.selectedChapterId=r,editor.selectedDialogueId=null},selectDialogue(r){editor.selectedDialogueId=r},selectOption(r){editor.editingOptionIndex=r},selectItem(r){editor.editingItemIndex=r},updateStoryData(r){editor.data=r},updateStoredFiles(r){editor.storedFiles=r},updateStoriesList(r){editor.storiesList=r},setCurrentFileName(r){editor.currentFileName=r},addDialogue(r){editor.data.dialogues=[...editor.data.dialogues,r]},updateDialogue(r,e){editor.data.dialogues=editor.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null)},addChapter(r){editor.data.chapters=[...editor.data.chapters||[],r]},updateChapter(r,e){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.map(t=>t.id===r?{...t,...e}:t))},selectEditingChapter(r){editor.editingChapterId=r},deleteChapter(r){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.filter(e=>e.id!==r),editor.selectedChapterId===r&&(editor.selectedChapterId=null,editor.selectedDialogueId=null))},addItem(r){editor.data.items=[...editor.data.items||[],r]},updateItem(r,e){editor.data.items&&(editor.data.items=editor.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){editor.data.items&&(editor.data.items=editor.data.items.filter(e=>e.id!==r))},reset(){editor.showEditor=!1,editor.showItems=!1,editor.editingOptionIndex=null,editor.editingItemIndex=null,editor.selectedChapterId=null,editor.selectedDialogueId=null,editor.statusMessage={type:"",text:""}}},scriptRel="modulepreload",assetsURL=function(r,e){return new URL(r,e).href},seen={},__vitePreload=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let v=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const o=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");i=v(t.map(h=>{if(h=assetsURL(h,n),h in seen)return;seen[h]=!0;const m=h.endsWith(".css"),y=m?'[rel="stylesheet"]':"";if(n)for(let w=o.length-1;w>=0;w--){const k=o[w];if(k.href===h&&(!m||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${y}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":scriptRel,m||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),m)return new Promise((w,k)=>{g.addEventListener("load",w),g.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return i.then(o=>{for(const c of o||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},resolveFetch$3=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:n}=await Promise.resolve().then(()=>browser);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class FunctionsError extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class FunctionsFetchError extends FunctionsError{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class FunctionsRelayError extends FunctionsError{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FunctionsHttpError extends FunctionsError{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var FunctionRegion;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));var __awaiter$7=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};class FunctionsClient{constructor(e,{headers:t={},customFetch:n,region:i=FunctionRegion.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=resolveFetch$3(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return __awaiter$7(this,void 0,void 0,function*(){try{const{headers:i,method:s,body:o}=t;let c={},{region:f}=t;f||(f=this.region);const v=new URL(`${this.url}/${e}`);f&&f!=="any"&&(c["x-region"]=f,v.searchParams.set("forceFunctionRegion",f));let h;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(c["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(c["Content-Type"]="application/json",h=JSON.stringify(o)));const m=yield this.fetch(v.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:h}).catch(k=>{throw new FunctionsFetchError(k)}),y=m.headers.get("x-relay-error");if(y&&y==="true")throw new FunctionsRelayError(m);if(!m.ok)throw new FunctionsHttpError(m);let g=((n=m.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),w;return g==="application/json"?w=yield m.json():g==="application/octet-stream"?w=yield m.blob():g==="text/event-stream"?w=m:g==="multipart/form-data"?w=yield m.formData():w=yield m.text(),{data:w,error:null,response:m}}catch(i){return{data:null,error:i,response:i instanceof FunctionsHttpError||i instanceof FunctionsRelayError?i.context:void 0}}})}}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var cjs={},PostgrestClient$1={},PostgrestQueryBuilder$1={},PostgrestFilterBuilder$1={},PostgrestTransformBuilder$1={},PostgrestBuilder$1={},getGlobal=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},globalObject=getGlobal();const fetch$1=globalObject.fetch,nodeFetch=globalObject.fetch.bind(globalObject),Headers$1=globalObject.Headers,Request$1=globalObject.Request,Response$1=globalObject.Response,browser=Object.freeze(Object.defineProperty({__proto__:null,Headers:Headers$1,Request:Request$1,Response:Response$1,default:nodeFetch,fetch:fetch$1},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(browser);var PostgrestError$1={},hasRequiredPostgrestError;function requirePostgrestError(){if(hasRequiredPostgrestError)return PostgrestError$1;hasRequiredPostgrestError=1,Object.defineProperty(PostgrestError$1,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return PostgrestError$1.default=r,PostgrestError$1}var hasRequiredPostgrestBuilder;function requirePostgrestBuilder(){if(hasRequiredPostgrestBuilder)return PostgrestBuilder$1;hasRequiredPostgrestBuilder=1;var r=PostgrestBuilder$1&&PostgrestBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestBuilder$1,"__esModule",{value:!0});const e=r(require$$0),t=r(requirePostgrestError());class n{constructor(s){var o,c;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(c=s.isMaybeSingle)!==null&&c!==void 0?c:!1,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let f=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var h,m,y,g;let w=null,k=null,I=null,O=v.status,B=v.statusText;if(v.ok){if(this.method!=="HEAD"){const M=await v.text();M===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?k=M:k=JSON.parse(M))}const G=(m=this.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),Y=(y=v.headers.get("content-range"))===null||y===void 0?void 0:y.split("/");G&&Y&&Y.length>1&&(I=parseInt(Y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(k)&&(k.length>1?(w={code:"PGRST116",details:`Results contain ${k.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},k=null,I=null,O=406,B="Not Acceptable"):k.length===1?k=k[0]:k=null)}else{const G=await v.text();try{w=JSON.parse(G),Array.isArray(w)&&v.status===404&&(k=[],w=null,O=200,B="OK")}catch{v.status===404&&G===""?(O=204,B="No Content"):w={message:G}}if(w&&this.isMaybeSingle&&(!((g=w?.details)===null||g===void 0)&&g.includes("0 rows"))&&(w=null,O=200,B="OK"),w&&this.shouldThrowOnError)throw new t.default(w)}return{error:w,data:k,count:I,status:O,statusText:B}});return this.shouldThrowOnError||(f=f.catch(v=>{var h,m,y;return{error:{message:`${(h=v?.name)!==null&&h!==void 0?h:"FetchError"}: ${v?.message}`,details:`${(m=v?.stack)!==null&&m!==void 0?m:""}`,hint:"",code:`${(y=v?.code)!==null&&y!==void 0?y:""}`},data:null,count:null,status:0,statusText:""}})),f.then(s,o)}returns(){return this}overrideTypes(){return this}}return PostgrestBuilder$1.default=n,PostgrestBuilder$1}var hasRequiredPostgrestTransformBuilder;function requirePostgrestTransformBuilder(){if(hasRequiredPostgrestTransformBuilder)return PostgrestTransformBuilder$1;hasRequiredPostgrestTransformBuilder=1;var r=PostgrestTransformBuilder$1&&PostgrestTransformBuilder$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestTransformBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestBuilder());class t extends e.default{select(i){let s=!1;const o=(i??"*").split("").map(c=>/\s/.test(c)&&!s?"":(c==='"'&&(s=!s),c)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:s=!0,nullsFirst:o,foreignTable:c,referencedTable:f=c}={}){const v=f?`${f}.order`:"order",h=this.url.searchParams.get(v);return this.url.searchParams.set(v,`${h?`${h},`:""}${i}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:s,referencedTable:o=s}={}){const c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${i}`),this}range(i,s,{foreignTable:o,referencedTable:c=o}={}){const f=typeof c>"u"?"offset":`${c}.offset`,v=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(f,`${i}`),this.url.searchParams.set(v,`${s-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:s=!1,settings:o=!1,buffers:c=!1,wal:f=!1,format:v="text"}={}){var h;const m=[i?"analyze":null,s?"verbose":null,o?"settings":null,c?"buffers":null,f?"wal":null].filter(Boolean).join("|"),y=(h=this.headers.get("Accept"))!==null&&h!==void 0?h:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${v}; for="${y}"; options=${m};`),v==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return PostgrestTransformBuilder$1.default=t,PostgrestTransformBuilder$1}var hasRequiredPostgrestFilterBuilder;function requirePostgrestFilterBuilder(){if(hasRequiredPostgrestFilterBuilder)return PostgrestFilterBuilder$1;hasRequiredPostgrestFilterBuilder=1;var r=PostgrestFilterBuilder$1&&PostgrestFilterBuilder$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestFilterBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestTransformBuilder());class t extends e.default{eq(i,s){return this.url.searchParams.append(i,`eq.${s}`),this}neq(i,s){return this.url.searchParams.append(i,`neq.${s}`),this}gt(i,s){return this.url.searchParams.append(i,`gt.${s}`),this}gte(i,s){return this.url.searchParams.append(i,`gte.${s}`),this}lt(i,s){return this.url.searchParams.append(i,`lt.${s}`),this}lte(i,s){return this.url.searchParams.append(i,`lte.${s}`),this}like(i,s){return this.url.searchParams.append(i,`like.${s}`),this}likeAllOf(i,s){return this.url.searchParams.append(i,`like(all).{${s.join(",")}}`),this}likeAnyOf(i,s){return this.url.searchParams.append(i,`like(any).{${s.join(",")}}`),this}ilike(i,s){return this.url.searchParams.append(i,`ilike.${s}`),this}ilikeAllOf(i,s){return this.url.searchParams.append(i,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(i,s){return this.url.searchParams.append(i,`ilike(any).{${s.join(",")}}`),this}is(i,s){return this.url.searchParams.append(i,`is.${s}`),this}in(i,s){const o=Array.from(new Set(s)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${o})`),this}contains(i,s){return typeof s=="string"?this.url.searchParams.append(i,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(i,`cs.{${s.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(s)}`),this}containedBy(i,s){return typeof s=="string"?this.url.searchParams.append(i,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(i,`cd.{${s.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(s)}`),this}rangeGt(i,s){return this.url.searchParams.append(i,`sr.${s}`),this}rangeGte(i,s){return this.url.searchParams.append(i,`nxl.${s}`),this}rangeLt(i,s){return this.url.searchParams.append(i,`sl.${s}`),this}rangeLte(i,s){return this.url.searchParams.append(i,`nxr.${s}`),this}rangeAdjacent(i,s){return this.url.searchParams.append(i,`adj.${s}`),this}overlaps(i,s){return typeof s=="string"?this.url.searchParams.append(i,`ov.${s}`):this.url.searchParams.append(i,`ov.{${s.join(",")}}`),this}textSearch(i,s,{config:o,type:c}={}){let f="";c==="plain"?f="pl":c==="phrase"?f="ph":c==="websearch"&&(f="w");const v=o===void 0?"":`(${o})`;return this.url.searchParams.append(i,`${f}fts${v}.${s}`),this}match(i){return Object.entries(i).forEach(([s,o])=>{this.url.searchParams.append(s,`eq.${o}`)}),this}not(i,s,o){return this.url.searchParams.append(i,`not.${s}.${o}`),this}or(i,{foreignTable:s,referencedTable:o=s}={}){const c=o?`${o}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,s,o){return this.url.searchParams.append(i,`${s}.${o}`),this}}return PostgrestFilterBuilder$1.default=t,PostgrestFilterBuilder$1}var hasRequiredPostgrestQueryBuilder;function requirePostgrestQueryBuilder(){if(hasRequiredPostgrestQueryBuilder)return PostgrestQueryBuilder$1;hasRequiredPostgrestQueryBuilder=1;var r=PostgrestQueryBuilder$1&&PostgrestQueryBuilder$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestQueryBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestFilterBuilder());class t{constructor(i,{headers:s={},schema:o,fetch:c}){this.url=i,this.headers=new Headers(s),this.schema=o,this.fetch=c}select(i,{head:s=!1,count:o}={}){const c=s?"HEAD":"GET";let f=!1;const v=(i??"*").split("").map(h=>/\s/.test(h)&&!f?"":(h==='"'&&(f=!f),h)).join("");return this.url.searchParams.set("select",v),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:s,defaultToNull:o=!0}={}){var c;const f="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const v=i.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(v.length>0){const h=[...new Set(v)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}upsert(i,{onConflict:s,ignoreDuplicates:o=!1,count:c,defaultToNull:f=!0}={}){var v;const h="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),c&&this.headers.append("Prefer",`count=${c}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const m=i.reduce((y,g)=>y.concat(Object.keys(g)),[]);if(m.length>0){const y=[...new Set(m)].map(g=>`"${g}"`);this.url.searchParams.set("columns",y.join(","))}}return new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}update(i,{count:s}={}){var o;const c="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:i}={}){var s;const o="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return PostgrestQueryBuilder$1.default=t,PostgrestQueryBuilder$1}var hasRequiredPostgrestClient;function requirePostgrestClient(){if(hasRequiredPostgrestClient)return PostgrestClient$1;hasRequiredPostgrestClient=1;var r=PostgrestClient$1&&PostgrestClient$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestClient$1,"__esModule",{value:!0});const e=r(requirePostgrestQueryBuilder()),t=r(requirePostgrestFilterBuilder());class n{constructor(s,{headers:o={},schema:c,fetch:f}={}){this.url=s,this.headers=new Headers(o),this.schemaName=c,this.fetch=f}from(s){const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new n(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:c=!1,get:f=!1,count:v}={}){var h;let m;const y=new URL(`${this.url}/rpc/${s}`);let g;c||f?(m=c?"HEAD":"GET",Object.entries(o).filter(([k,I])=>I!==void 0).map(([k,I])=>[k,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([k,I])=>{y.searchParams.append(k,I)})):(m="POST",g=o);const w=new Headers(this.headers);return v&&w.set("Prefer",`count=${v}`),new t.default({method:m,url:y,headers:w,schema:this.schemaName,body:g,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return PostgrestClient$1.default=n,PostgrestClient$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var r=cjs&&cjs.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(cjs,"__esModule",{value:!0}),cjs.PostgrestError=cjs.PostgrestBuilder=cjs.PostgrestTransformBuilder=cjs.PostgrestFilterBuilder=cjs.PostgrestQueryBuilder=cjs.PostgrestClient=void 0;const e=r(requirePostgrestClient());cjs.PostgrestClient=e.default;const t=r(requirePostgrestQueryBuilder());cjs.PostgrestQueryBuilder=t.default;const n=r(requirePostgrestFilterBuilder());cjs.PostgrestFilterBuilder=n.default;const i=r(requirePostgrestTransformBuilder());cjs.PostgrestTransformBuilder=i.default;const s=r(requirePostgrestBuilder());cjs.PostgrestBuilder=s.default;const o=r(requirePostgrestError());return cjs.PostgrestError=o.default,cjs.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:s.default,PostgrestError:o.default},cjs}var cjsExports=requireCjs();const index=getDefaultExportFromCjs(cjsExports),{PostgrestClient,PostgrestQueryBuilder,PostgrestFilterBuilder,PostgrestTransformBuilder,PostgrestBuilder,PostgrestError}=index;class WebSocketFactory{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const version$3="2.15.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(r){r.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const i=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const c=n.decode(e.slice(o,o+i));o=o+i;const f=n.decode(e.slice(o,o+s));o=o+s;const v=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:f,payload:v}}}class Timer{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(r,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,o)=>(s[o]=convertColumn(o,r,e,i),s),{})},convertColumn=(r,e,t,n)=>{const i=e.find(c=>c.name===r),s=i?.type,o=t[r];return s&&!n.includes(s)?convertCell(s,o):noop$1(o)},convertCell=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return toArray(e,t)}switch(r){case PostgresTypes.bool:return toBoolean(e);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(e);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(e);case PostgresTypes.timestamp:return toTimestampString(e);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(e);default:return noop$1(e)}},noop$1=r=>r,toBoolean=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},toNumber=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},toJson=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},toArray=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let s;const o=r.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(c=>convertCell(e,c))}return r},toTimestampString=r=>typeof r=="string"?r.replace(" ","T"):r,httpEndpointURL=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Push{constructor(e,t,n={},i=DEFAULT_TIMEOUT){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,i,s,o),this.pendingDiffs.forEach(f=>{this.state=RealtimePresence.syncDiff(this.state,f,s,o)}),this.pendingDiffs=[],c()}),this.channel._on(n.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=RealtimePresence.syncDiff(this.state,i,s,o),c())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const s=this.cloneDeep(e),o=this.transformState(t),c={},f={};return this.map(s,(v,h)=>{o[v]||(f[v]=h)}),this.map(o,(v,h)=>{const m=s[v];if(m){const y=h.map(I=>I.presence_ref),g=m.map(I=>I.presence_ref),w=h.filter(I=>g.indexOf(I.presence_ref)<0),k=m.filter(I=>y.indexOf(I.presence_ref)<0);w.length>0&&(c[v]=w),k.length>0&&(f[v]=k)}else c[v]=h}),this.syncDiff(s,{joins:c,leaves:f},n,i)}static syncDiff(e,t,n,i){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(c,f)=>{var v;const h=(v=e[c])!==null&&v!==void 0?v:[];if(e[c]=this.cloneDeep(f),h.length>0){const m=e[c].map(g=>g.presence_ref),y=h.filter(g=>m.indexOf(g.presence_ref)<0);e[c].unshift(...y)}n(c,h,f)}),this.map(o,(c,f)=>{let v=e[c];if(!v)return;const h=f.map(m=>m.presence_ref);v=v.filter(m=>h.indexOf(m.presence_ref)<0),e[c]=v,i(c,v,f),v.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(i,s)=>{this._trigger(this._replyEventName(s),i)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:s,presence:o,private:c}}=this.params,f=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(y=>y.filter))!==null&&i!==void 0?i:[],v=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0,h={},m={broadcast:s,presence:Object.assign(Object.assign({},o),{enabled:v}),postgres_changes:f,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(y=>e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,y)),this._onClose(()=>e?.(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:m},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:y})=>{var g;if(this.socket.setAuth(),y===void 0){e?.(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,k=(g=w?.length)!==null&&g!==void 0?g:0,I=[];for(let O=0;O<k;O++){const B=w[O],{filter:{event:P,schema:G,table:Y,filter:M}}=B,T=y&&y[O];if(T&&T.event===P&&T.schema===G&&T.table===Y&&T.filter===M)I.push(Object.assign(Object.assign({},B),{id:T.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=I,e&&e(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",y=>{this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(y).join(", ")||"error")))}).receive("timeout",()=>{e?.(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===CHANNEL_STATES.joined&&e===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:o}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=v.body)===null||i===void 0?void 0:i.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,c,f;const v=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(c=(o=this.params)===null||o===void 0?void 0:o.config)===null||c===void 0?void 0:c.broadcast)===null||f===void 0)&&f.ack)&&s("ok"),v.receive("ok",()=>s("ok")),v.receive("error",()=>s("error")),v.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=CHANNEL_STATES.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new Push(this,CHANNEL_EVENTS.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,s=setTimeout(()=>i.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(s),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Push(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,s;const o=e.toLocaleLowerCase(),{close:c,error:f,leave:v,join:h}=CHANNEL_EVENTS;if(n&&[c,f,v,h].indexOf(o)>=0&&n!==this._joinRef())return;let y=this._onMessage(o,t,n);if(t&&!y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var w,k,I;return((w=g.filter)===null||w===void 0?void 0:w.event)==="*"||((I=(k=g.filter)===null||k===void 0?void 0:k.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===o}).map(g=>g.callback(y,n)):(s=this.bindings[o])===null||s===void 0||s.filter(g=>{var w,k,I,O,B,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const G=g.id,Y=(w=g.filter)===null||w===void 0?void 0:w.event;return G&&((k=t.ids)===null||k===void 0?void 0:k.includes(G))&&(Y==="*"||Y?.toLocaleLowerCase()===((I=t.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{const G=(B=(O=g?.filter)===null||O===void 0?void 0:O.event)===null||B===void 0?void 0:B.toLocaleLowerCase();return G==="*"||G===((P=t?.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof y=="object"&&"ids"in y){const w=y.data,{schema:k,table:I,commit_timestamp:O,type:B,errors:P}=w;y=Object.assign(Object.assign({},{schema:k,table:I,commit_timestamp:O,eventType:B,new:{},old:{},errors:P}),this._getPayloadRecords(w))}g.callback(y,n)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&RealtimeChannel.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(CHANNEL_EVENTS.close,{},e)}_onError(e){this._on(CHANNEL_EVENTS.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=convertChangeData(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=convertChangeData(e.columns,e.old_record)),t}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...o)=>__vitePreload(async()=>{const{default:c}=await Promise.resolve().then(()=>browser);return{default:c}},void 0,import.meta.url).then(({default:c})=>c(...o)).catch(c=>{throw new Error(`Failed to load @supabase/node-fetch: ${c.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...o)=>s(...o)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===n);if(i)return i;{const s=new RealtimeChannel(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:n,payload:i,ref:s}=e,o=()=>{this.encode(e,c=>{var f;(f=this.conn)===null||f===void 0||f.send(c)})};this.log("push",`${t} ${n} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:s,ref:o}=t,c=o?`(${o})`:"",f=s.status||"";this.log("receive",`${f} ${n} ${i} ${c}`.trim(),s),this.channels.filter(v=>v._isMember(n)).forEach(v=>v._trigger(i,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(CHANNEL_EVENTS.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([WORKER_SCRIPT],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:DEFAULT_VERSION};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(CHANNEL_EVENTS.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,s,o,c,f,v;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(s=e?.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(h=>RECONNECT_INTERVALS[h-1]||DEFAULT_RECONNECT_FALLBACK),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((h,m)=>m(JSON.stringify(h))),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class StorageError extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class StorageApiError extends StorageError{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class StorageUnknownError extends StorageError{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var __awaiter$6=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};const resolveFetch$2=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:n}=await Promise.resolve().then(()=>browser);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},resolveResponse=()=>__awaiter$6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield __vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url)).Response:Response}),recursiveToCamel=r=>{if(Array.isArray(r))return r.map(t=>recursiveToCamel(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=recursiveToCamel(n)}),e},isPlainObject=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var __awaiter$5=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};const _getErrorMessage$1=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),handleError$1=(r,e,t)=>__awaiter$5(void 0,void 0,void 0,function*(){const n=yield resolveResponse();r instanceof n&&!t?.noResolveJson?r.json().then(i=>{const s=r.status||500,o=i?.statusCode||s+"";e(new StorageApiError(_getErrorMessage$1(i),s,o))}).catch(i=>{e(new StorageUnknownError(_getErrorMessage$1(i),i))}):e(new StorageUnknownError(_getErrorMessage$1(r),r))}),_getRequestParams$1=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"||!n?i:(isPlainObject(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function _handleRequest$1(r,e,t,n,i,s){return __awaiter$5(this,void 0,void 0,function*(){return new Promise((o,c)=>{r(t,_getRequestParams$1(e,n,i,s)).then(f=>{if(!f.ok)throw f;return n?.noResolveJson?f:f.json()}).then(f=>o(f)).catch(f=>handleError$1(f,c,n))})})}function get(r,e,t,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"GET",e,t,n)})}function post(r,e,t,n,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"POST",e,n,i,t)})}function put(r,e,t,n,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"PUT",e,n,i,t)})}function head(r,e,t,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function remove(r,e,t,n,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"DELETE",e,n,i,t)})}var __awaiter$4=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(e,t={},n,i){this.url=e,this.headers=t,this.bucketId=n,this.fetch=resolveFetch$2(i)}uploadOrUpdate(e,t,n,i){return __awaiter$4(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),i);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const f=o.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),f&&s.append("metadata",this.encodeMetadata(f)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",o.cacheControl),f&&s.append("metadata",this.encodeMetadata(f))):(s=n,c["cache-control"]=`max-age=${o.cacheControl}`,c["content-type"]=o.contentType,f&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),i?.headers&&(c=Object.assign(Object.assign({},c),i.headers));const v=this._removeEmptyFolders(t),h=this._getFinalPath(v),m=yield(e=="PUT"?put:post)(this.fetch,`${this.url}/object/${h}`,s,Object.assign({headers:c},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:v,id:m.Id,fullPath:m.Key},error:null}}catch(s){if(isStorageError(s))return{data:null,error:s};throw s}})}upload(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return __awaiter$4(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),c=new URL(this.url+`/object/upload/sign/${o}`);c.searchParams.set("token",t);try{let f;const v=Object.assign({upsert:DEFAULT_FILE_OPTIONS.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(v.upsert)});typeof Blob<"u"&&n instanceof Blob?(f=new FormData,f.append("cacheControl",v.cacheControl),f.append("",n)):typeof FormData<"u"&&n instanceof FormData?(f=n,f.append("cacheControl",v.cacheControl)):(f=n,h["cache-control"]=`max-age=${v.cacheControl}`,h["content-type"]=v.contentType);const m=yield put(this.fetch,c.toString(),f,{headers:h});return{data:{path:s,fullPath:m.Key},error:null}}catch(f){if(isStorageError(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const s=yield post(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),o=new URL(this.url+s.url),c=o.searchParams.get("token");if(!c)throw new StorageError("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:c},error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}update(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}copy(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield post(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){try{const i=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}download(e,t){return __awaiter$4(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(t?.transform||{}),o=s?`?${s}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield get(this.fetch,`${this.url}/${i}/${c}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(isStorageError(c))return{data:null,error:c};throw c}})}info(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield get(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:recursiveToCamel(n),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}exists(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield head(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(isStorageError(n)&&n instanceof StorageUnknownError){const i=n.originalError;if([400,404].includes(i?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),i=[],s=t?.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&i.push(s);const c=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&i.push(f);let v=i.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${n}${v}`)}}}remove(e){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}list(e,t,n){return __awaiter$4(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),t),{prefix:e||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}listV2(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield post(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const version$2="2.11.0",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var __awaiter$3=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};class StorageBucketApi{constructor(e,t={},n,i){const s=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),t),this.fetch=resolveFetch$2(n)}listBuckets(){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(isStorageError(e))return{data:null,error:e};throw e}})}getBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}emptyBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}deleteBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}}class StorageClient extends StorageBucketApi{constructor(e,t={},n,i){super(e,t,n,i)}from(e){return new StorageFileApi(this.url,this.headers,e,this.fetch)}}const version$1="2.56.0";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";const DEFAULT_HEADERS$1={"X-Client-Info":`supabase-js-${JS_ENV}/${version$1}`},DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS$1},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};var __awaiter$2=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};const resolveFetch$1=r=>{let e;return r?e=r:typeof fetch>"u"?e=nodeFetch:e=fetch,(...t)=>e(...t)},resolveHeadersConstructor=()=>typeof Headers>"u"?Headers$1:Headers,fetchWithAuth=(r,e,t)=>{const n=resolveFetch$1(t),i=resolveHeadersConstructor();return(s,o)=>__awaiter$2(void 0,void 0,void 0,function*(){var c;const f=(c=yield e())!==null&&c!==void 0?c:r;let v=new i(o?.headers);return v.has("apikey")||v.set("apikey",r),v.has("Authorization")||v.set("Authorization",`Bearer ${f}`),n(s,Object.assign(Object.assign({},o),{headers:v}))})};var __awaiter$1=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};function ensureTrailingSlash(r){return r.endsWith("/")?r:r+"/"}function applySettingDefaults(r,e){var t,n;const{db:i,auth:s,realtime:o,global:c}=r,{db:f,auth:v,realtime:h,global:m}=e,y={db:Object.assign(Object.assign({},f),i),auth:Object.assign(Object.assign({},v),s),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),c),{headers:Object.assign(Object.assign({},(t=m?.headers)!==null&&t!==void 0?t:{}),(n=c?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>__awaiter$1(this,void 0,void 0,function*(){return""})};return r.accessToken?y.accessToken=r.accessToken:delete y.accessToken,y}const version="2.71.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=600*1e3;class AuthError extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function isAuthError(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class AuthApiError extends AuthError{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function isAuthApiError(r){return isAuthError(r)&&r.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class CustomAuthError extends AuthError{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(r){return isAuthError(r)&&r.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(r){return isAuthError(r)&&r.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function isAuthRetryableFetchError(r){return isAuthError(r)&&r.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class AuthInvalidJwtError extends CustomAuthError{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<IGNORE_BASE64URL.length;e+=1)r[IGNORE_BASE64URL[e].charCodeAt(0)]=-2;for(let e=0;e<TO_BASE64URL.length;e+=1)r[TO_BASE64URL[e].charCodeAt(0)]=e;return r})();function byteToBase64URL(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[n]),e.queuedBits-=6}}function byteFromBase64URL(r,e,t){const n=FROM_BASE64URL[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function stringFromBase64URL(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{stringFromUTF8(o,n,t)};for(let o=0;o<r.length;o+=1)byteFromBase64URL(r.charCodeAt(o),i,s);return e.join("")}function codepointToUTF8(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function stringToUTF8(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}codepointToUTF8(n,e)}}function stringFromUTF8(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function base64UrlToUint8Array(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)byteFromBase64URL(r.charCodeAt(i),t,n);return new Uint8Array(e)}function stringToUint8Array(r){const e=[];return stringToUTF8(r,t=>e.push(t)),new Uint8Array(e)}function bytesToBase64URL(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return r.forEach(i=>byteToBase64URL(i,t,n)),byteToBase64URL(null,t,n),e.join("")}function expiresAt(r){return Math.round(Date.now()/1e3)+r}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const resolveFetch=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:n}=await Promise.resolve().then(()=>browser);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},looksLikeFetchResponse=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",setItemAsync=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},getItemAsync=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},removeItemAsync=async(r,e)=>{await r.removeItem(e)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Deferred.promiseConstructor=Promise;function decodeJWT(r){const e=r.split(".");if(e.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!BASE64URL_REGEX.test(e[n]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(e[0])),payload:JSON.parse(stringFromBase64URL(e[1])),signature:base64UrlToUint8Array(e[2]),raw:{header:e[0],payload:e[1]}}}async function sleep(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function retryable(r,e){return new Promise((n,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await r(s);if(!e(s,null,o)){n(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function dec2hex(r){return("0"+r.toString(16)).substr(-2)}function generatePKCEVerifier(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,dec2hex).join("")}async function sha256(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function generatePKCEChallenge(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await sha256(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(r,e,t=!1){const n=generatePKCEVerifier();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await setItemAsync(r,`${e}-code-verifier`,i);const s=await generatePKCEChallenge(n);return[s,n===s?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(r){const e=r.headers.get(API_VERSION_HEADER_NAME);if(!e||!e.match(API_VERSION_REGEX))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function validateExp(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function getAlgorithm(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(r){if(!UUID_REGEX.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function deepClone(r){return JSON.parse(JSON.stringify(r))}var __rest$1=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const _getErrorMessage=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),NETWORK_ERROR_CODES=[502,503,504];async function handleError(r){var e;if(!looksLikeFetchResponse(r))throw new AuthRetryableFetchError(_getErrorMessage(r),0);if(NETWORK_ERROR_CODES.includes(r.status))throw new AuthRetryableFetchError(_getErrorMessage(r),r.status);let t;try{t=await r.json()}catch(s){throw new AuthUnknownError(_getErrorMessage(s),s)}let n;const i=parseResponseAPIVersion(r);if(i&&i.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new AuthSessionMissingError}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,t.weak_password.reasons);throw new AuthApiError(_getErrorMessage(t),r.status||500,n)}const _getRequestParams=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function _request(r,e,t,n){var i;const s=Object.assign({},n?.headers);s[API_VERSION_HEADER_NAME]||(s[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const o=(i=n?.query)!==null&&i!==void 0?i:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const c=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",f=await _handleRequest(r,e,t+c,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(f):{data:Object.assign({},f),error:null}}async function _handleRequest(r,e,t,n,i,s){const o=_getRequestParams(e,n,i,s);let c;try{c=await r(t,Object.assign({},o))}catch(f){throw console.error(f),new AuthRetryableFetchError(_getErrorMessage(f),0)}if(c.ok||await handleError(c),n?.noResolveJson)return c;try{return await c.json()}catch(f){await handleError(f)}}function _sessionResponse(r){var e;let t=null;hasSession(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=expiresAt(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function _sessionResponsePassword(r){const e=_sessionResponse(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function _userResponse(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function _ssoResponse(r){return{data:r,error:null}}function _generateLinkResponse(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s}=r,o=__rest$1(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s},f=Object.assign({},o);return{data:{properties:c,user:f},error:null}}function _noResolveJsonResponse(r){return r}function hasSession(r){return r.access_token&&r.refresh_token&&r.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];var __rest=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class GoTrueAdminApi{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=resolveFetch(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(isAuthError(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_userResponse})}catch(n){if(isAuthError(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=__rest(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n?.newEmail,delete i.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:_generateLinkResponse,redirectTo:t?.redirectTo})}catch(t){if(isAuthError(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,s,o,c,f;try{const v={nextPage:null,lastPage:0,total:0},h=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:_noResolveJsonResponse});if(h.error)throw h.error;const m=await h.json(),y=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(f=(c=h.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&f!==void 0?f:[];return g.length>0&&(g.forEach(w=>{const k=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(w.split(";")[1].split("=")[1]);v[`${I}Page`]=k}),v.total=parseInt(y)),{data:Object.assign(Object.assign({},m),v),error:null}}catch(v){if(isAuthError(v))return{data:{users:[]},error:v};throw v}}async getUserById(e){validateUUID(e);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){validateUUID(e);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_userResponse})}catch(n){if(isAuthError(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){validateUUID(e);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_userResponse})}catch(n){if(isAuthError(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){validateUUID(e.userId);try{const{data:t,error:n}=await _request(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _deleteFactor(e){validateUUID(e.userId),validateUUID(e.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}}function memoryLocalStorageAdapter(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(r,e,t){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(internals.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lockNoOp(r,e,t){return await t()}const GLOBAL_JWKS={};class GoTrueClient{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&isBrowser()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},DEFAULT_OPTIONS),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new GoTrueAdminApi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=resolveFetch(i.fetch),this.lock=i.lock||lockNoOp,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:isBrowser()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${version}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=parseParametersFromURL(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),isBrowser()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),isAuthImplicitGrantRedirectError(s)){const f=(e=s.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:c}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",c),await this._saveSession(o),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return isAuthError(t)?{error:t}:{error:new AuthUnknownError("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const s=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:_sessionResponse}),{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const f=o.session,v=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:v,session:f},error:null}}catch(s){if(isAuthError(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var t,n,i;try{let s;if("email"in e){const{email:h,password:m,options:y}=e;let g=null,w=null;this.flowType==="pkce"&&([g,w]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),s=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:y?.emailRedirectTo,body:{email:h,password:m,data:(t=y?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:y?.captchaToken},code_challenge:g,code_challenge_method:w},xform:_sessionResponse})}else if("phone"in e){const{phone:h,password:m,options:y}=e;s=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:m,data:(n=y?.data)!==null&&n!==void 0?n:{},channel:(i=y?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:y?.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:o,error:c}=s;if(c||!o)return{data:{user:null,session:null},error:c};const f=o.session,v=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:v,session:f},error:null}}catch(s){if(isAuthError(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:o,options:c}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in e){const{phone:s,password:o,options:c}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,i,s,o,c,f,v,h,m,y,g;let w,k;if("message"in e)w=e.message,k=e.signature;else{const{chain:I,wallet:O,statement:B,options:P}=e;let G;if(isBrowser())if(typeof O=="object")G=O;else{const M=window;if("solana"in M&&typeof M.solana=="object"&&("signIn"in M.solana&&typeof M.solana.signIn=="function"||"signMessage"in M.solana&&typeof M.solana.signMessage=="function"))G=M.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof O!="object"||!P?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");G=O}const Y=new URL((t=P?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in G&&G.signIn){const M=await G.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},P?.signInWithSolana),{version:"1",domain:Y.host,uri:Y.href}),B?{statement:B}:null));let T;if(Array.isArray(M)&&M[0]&&typeof M[0]=="object")T=M[0];else if(M&&typeof M=="object"&&"signedMessage"in M&&"signature"in M)T=M;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)w=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),k=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in G)||typeof G.signMessage!="function"||!("publicKey"in G)||typeof G!="object"||!G.publicKey||!("toBase58"in G.publicKey)||typeof G.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${Y.host} wants you to sign in with your Solana account:`,G.publicKey.toBase58(),...B?["",B,""]:[""],"Version: 1",`URI: ${Y.href}`,`Issued At: ${(i=(n=P?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=P?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${P.signInWithSolana.notBefore}`]:[],...!((o=P?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${P.signInWithSolana.expirationTime}`]:[],...!((c=P?.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${P.signInWithSolana.chainId}`]:[],...!((f=P?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${P.signInWithSolana.nonce}`]:[],...!((v=P?.signInWithSolana)===null||v===void 0)&&v.requestId?[`Request ID: ${P.signInWithSolana.requestId}`]:[],...!((m=(h=P?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||m===void 0)&&m.length?["Resources",...P.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const M=await G.signMessage(new TextEncoder().encode(w),"utf8");if(!M||!(M instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");k=M}}try{const{data:I,error:O}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:bytesToBase64URL(k)},!((y=e.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:_sessionResponse});if(O)throw O;return!I||!I.session||!I.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),{data:Object.assign({},I),error:O})}catch(I){if(isAuthError(I))return{data:{user:null,session:null},error:I};throw I}}async _exchangeCodeForSession(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{const{data:s,error:o}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new AuthInvalidTokenResponseError}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(isAuthError(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:s,nonce:o}=e,c=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:_sessionResponse}),{data:f,error:v}=c;return v?{data:{user:null,session:null},error:v}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:v})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,s,o;try{if("email"in e){const{email:c,options:f}=e;let v=null,h=null;this.flowType==="pkce"&&([v,h]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:m}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(n=f?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:v,code_challenge_method:h},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){const{phone:c,options:f}=e,{data:v,error:h}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(i=f?.data)!==null&&i!==void 0?i:{},create_user:(s=f?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:v?.message_id},error:h}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(c){if(isAuthError(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,n;try{let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:c}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:_sessionResponse});if(c)throw c;if(!o)throw new Error("An error occurred on token verification.");const f=o.session,v=o.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:v,session:f},error:null}}catch(i){if(isAuthError(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let s=null,o=null;return this.flowType==="pkce"&&([s,o]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:o}),headers:this.headers,xform:_ssoResponse})}catch(s){if(isAuthError(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new AuthSessionMissingError;const{error:i}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(isAuthError(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:s}=e,{error:o}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:i,options:s}=e,{data:o,error:c}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:c}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await getItemAsync(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=userNotAvailableProxy()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,v,h)=>(!o&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,v,h))})}return{data:{session:e},error:null}}const{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_userResponse}):await this._useSession(async t=>{var n,i,s;const{data:o,error:c}=t;if(c)throw c;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:_userResponse})})}catch(t){if(isAuthError(t))return isAuthSessionMissingError(t)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new AuthSessionMissingError;const o=i.session;let c=null,f=null;this.flowType==="pkce"&&e.email!=null&&([c,f]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:v,error:h}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:f}),jwt:o.access_token,xform:_userResponse});if(h)throw h;return o.user=v.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(isAuthError(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new AuthSessionMissingError;const t=Date.now()/1e3;let n=t,i=!0,s=null;const{payload:o}=decodeJWT(e.access_token);if(o.exp&&(n=o.exp,i=n<=t),i){const{session:c,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!c)return{data:{user:null,session:null},error:null};s=c}else{const{data:c,error:f}=await this._getUser(e.access_token);if(f)throw f;s={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(isAuthError(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:c}=t;if(c)throw c;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new AuthSessionMissingError;const{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(e.error||e.error_description||e.error_code)throw new AuthImplicitGrantRedirectError(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:B,error:P}=await this._exchangeCodeForSession(e.code);if(P)throw P;const G=new URL(window.location.href);return G.searchParams.delete("code"),window.history.replaceState(window.history.state,"",G.toString()),{data:{session:B.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:c,expires_at:f,token_type:v}=e;if(!s||!c||!o||!v)throw new AuthImplicitGrantRedirectError("No session defined in URL");const h=Math.round(Date.now()/1e3),m=parseInt(c);let y=h+m;f&&(y=parseInt(f));const g=y-h;g*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${m}s`);const w=y-m;h-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,y,h):h-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,y,h);const{data:k,error:I}=await this._getUser(s);if(I)throw I;const O={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:m,expires_at:y,refresh_token:o,token_type:v,user:k.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:O,redirectType:e.type},error:null}}catch(n){if(isAuthError(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:s}=t;if(s)return{error:s};const o=(n=i.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:c}=await this.admin.signOut(o,e);if(c&&!(isAuthApiError(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=uuid(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:s},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(isAuthError(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:i}=await this._useSession(async s=>{var o,c,f,v,h;const{data:m,error:y}=s;if(y)throw y;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",g,{headers:this.headers,jwt:(h=(v=m.session)===null||v===void 0?void 0:v.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return isBrowser()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(isAuthError(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:s,error:o}=t;if(o)throw o;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await retryable(async i=>(i>0&&await sleep(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_sessionResponse})),(i,s)=>{const o=200*Math.pow(2,i);return s&&isAuthRetryableFetchError(s)&&Date.now()+o-n<AUTO_REFRESH_TICK_DURATION_MS})}catch(n){if(this._debug(t,"error",n),isAuthError(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),isBrowser()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await getItemAsync(this.storage,this.storageKey);if(i&&this.userStorage){let o=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await setItemAsync(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o?.user)!==null&&e!==void 0?e:userNotAvailableProxy()}else if(i&&!i.user&&!i.user){const o=await getItemAsync(this.storage,this.storageKey+"-user");o&&o?.user?(i.user=o.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,i)):i.user=userNotAvailableProxy()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const s=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),isAuthRetryableFetchError(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:c}=await this._getUser(i.access_token);!c&&o?.user?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Deferred;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new AuthSessionMissingError;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const c={session:s.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(s){if(this._debug(i,"error",s),isAuthError(s)){const o={session:null,error:s};return isAuthRetryableFetchError(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(f){s.push(f)}});if(await Promise.all(o),s.length>0){for(let c=0;c<s.length;c+=1)console.error(s[c]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const s=deepClone(i);await setItemAsync(this.storage,this.storageKey,s)}else{const i=deepClone(t);await setItemAsync(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&isBrowser()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),i<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,o]=await getCodeChallengeAndMethod(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(c.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);i.push(s.toString())}return n?.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;return s?{data:null,error:s}:await _request(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:s,error:o}=t;if(o)return{data:null,error:o};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:v}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return v?{data:null,error:v}:(e.factorType==="totp"&&(!((i=f?.totp)===null||i===void 0)&&i.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;if(s)return{data:null,error:s};const{data:o,error:c}=await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;return s?{data:null,error:s}:await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],i=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),s=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=decodeJWT(i.access_token);let c=null;o.aal&&(c=o.aal);let f=c;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(m=>m.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(f="aal2");const h=o.amr||[];return{data:{currentLevel:c,nextLevel:f,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(c=>c.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(c=>c.kid===e),n&&this.jwks_cached_at+JWKS_TTL>i)return n;const{data:s,error:o}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,n=s.keys.find(c=>c.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:g,error:w}=await this.getSession();if(w||!g.session)return{data:null,error:w};n=g.session.access_token}const{header:i,payload:s,signature:o,raw:{header:c,payload:f}}=decodeJWT(n);t?.allowExpired||validateExp(s.exp);const v=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!v){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:s,header:i,signature:o},error:null}}const h=getAlgorithm(i.alg),m=await crypto.subtle.importKey("jwk",v,h,!0,["verify"]);if(!await crypto.subtle.verify(h,m,o,stringToUint8Array(`${c}.${f}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(n){if(isAuthError(n))return{data:null,error:n};throw n}}}GoTrueClient.nextInstanceID=0;const AuthClient=GoTrueClient;class SupabaseAuthClient extends AuthClient{constructor(e){super(e)}}var __awaiter=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(h){try{v(n.next(h))}catch(m){o(m)}}function f(h){try{v(n.throw(h))}catch(m){o(m)}}function v(h){h.done?s(h.value):i(h.value).then(c,f)}v((n=n.apply(r,e||[])).next())})};class SupabaseClient{constructor(e,t,n){var i,s,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=ensureTrailingSlash(e),f=new URL(c);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const v=`sb-${f.hostname.split(".")[0]}-auth-token`,h={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},DEFAULT_AUTH_OPTIONS),{storageKey:v}),global:DEFAULT_GLOBAL_OPTIONS},m=applySettingDefaults(n??{},h);this.storageKey=(i=m.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=m.global.headers)!==null&&s!==void 0?s:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:(y,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=m.auth)!==null&&o!==void 0?o:{},this.headers,m.global.fetch),this.fetch=fetchWithAuth(t,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new PostgrestClient(new URL("rest/v1",f).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,n?.storage),m.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return __awaiter(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,storageKey:s,flowType:o,lock:c,debug:f},v,h){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),v),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,flowType:o,lock:c,debug:f,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const createClient=(r,e,t)=>new SupabaseClient(r,e,t);function shouldShowDeprecationWarning(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl="https://vycjpmuyscfygstjjied.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",customFetch=async(r,e)=>{const t=typeof r=="string"?r:r instanceof URL?r.href:r.url,n=e?.method||"GET";console.log(`[Supabase] ${n} ${t}`);const i=performance.now();try{const s=await fetch(r,e),o=(performance.now()-i).toFixed(2);return console.log(`[Supabase] ${n} ${t} - ${s.status} (${o}ms)`),s}catch(s){const o=(performance.now()-i).toFixed(2);throw console.error(`[Supabase] ${n} ${t} - ERROR (${o}ms)`,s),s}},supabase=createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:customFetch,headers:{"Content-Type":"application/json"}}}),resourceActions={async loadStoriesList(){if(!editor.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore]     bucket: ${editor.selectedBucket}`);const r=`${editor.selectedBucket}_story.json`,{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).list("",{search:r});console.log(`[ResourceStore]   ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(editor.storiesList=[r],console.log(`[ResourceStore]  : ${r}`)):(editor.storiesList=[],console.warn(`[ResourceStore]  ${r}  `))},async loadStoredResources(){if(!editor.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await supabase.storage.from(editor.selectedBucket).list();r&&(editor.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!editor.selectedBucket){editorActions.setStatus("error","  ");return}const t=e.files[0];editorActions.setStatus("loading"," ...");const n=await t.arrayBuffer(),i=new Uint8Array(n),{error:s}=await supabase.storage.from(editor.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});s?editorActions.setStatus("error"," "):(editorActions.setStatus("success"," "),await this.loadStoredResources())},async deleteFile(r){if(!editor.selectedBucket){editorActions.setStatus("error","  ");return}const{error:e}=await supabase.storage.from(editor.selectedBucket).remove([r]);e?editorActions.setStatus("error","  "):(editorActions.setStatus("success"," "),await this.loadStoredResources())}};function migrateStoryData(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:" ",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function createNewOption(){return{text:" ",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const storyActions={async createNewStory(){if(!editor.selectedBucket){editorActions.setStatus("error","   (bucket)");return}const r=prompt("   :","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:" 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:s}=await supabase.storage.from(editor.selectedBucket).upload(r,i,{contentType:"application/json"});s?editorActions.setStatus("error"," : "+s.message):(await resourceActions.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!editor.selectedBucket){editorActions.setStatus("error","   (bucket)");return}console.log(`[StoryStore]  : ${r}  bucket: ${editor.selectedBucket}`),editorActions.setStatus("loading","..."),editor.currentFileName=r;try{const{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).download(r);console.log("[StoryStore]   (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore]  download,   URL:",t);const s=supabase.storage.from(editor.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore]  URL: ${s}`);const o=await fetch(s);if(!o.ok)throw new Error(`   : ${o.statusText}`);n=await o.text(),console.log(`[StoryStore]     URL, : ${n.length}`)}else n=await e.text(),console.log(`[StoryStore]    download, : ${n.length}`);let i=JSON.parse(n);console.log("[StoryStore]  :",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=migrateStoryData(i),console.log("[StoryStore]    editor.data"),editor.data=i,console.log("[StoryStore] editor.data :",{chapters:editor.data.chapters?.length,dialogues:editor.data.dialogues?.length}),editor.data.chapters&&editor.data.chapters.length>0&&(editor.selectedChapterId=editor.data.chapters[0].id,console.log(`[StoryStore]  : ${editor.selectedChapterId}`)),editor.data.dialogues&&editor.data.dialogues.length>0&&(editor.selectedDialogueId=editor.data.dialogues[0].id,console.log(`[StoryStore]  : ${editor.selectedDialogueId}`)),console.log("[StoryStore]   "),editorActions.setStatus("success","!")}catch(e){console.error("[StoryStore]  :",e),editorActions.setStatus("error"," : "+e.message)}},async saveCurrentStory(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","   (bucket)");return}editorActions.setStatus("loading","...");const r=JSON.stringify(editor.data,null,2);console.log(`[StoryStore]  : ${editor.currentFileName}, : ${r.length} `);const t=new TextEncoder().encode(r),{error:n}=await supabase.storage.from(editor.selectedBucket).update(editor.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore]   (update):",n),console.log("[StoryStore]  upload  update");const i=await supabase.storage.from(editor.selectedBucket).upload(editor.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore]   (upload):",i.error),editorActions.setStatus("error"," : "+i.error.message)):(console.log("[StoryStore]     upload"),editorActions.setStatus("success","!"))}else console.log("[StoryStore]     update"),editorActions.setStatus("success","!")},async saveStoryCopy(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","   (bucket)");return}const r=editor.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("   :",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),editorActions.setStatus("loading"," ...");const i=JSON.stringify(editor.data,null,2),o=new TextEncoder().encode(i),{error:c}=await supabase.storage.from(editor.selectedBucket).upload(t,o,{upsert:!0,contentType:"application/json"});c?editorActions.setStatus("error",` : ${c.message}`):(await resourceActions.loadStoriesList(),editorActions.setStatus("success"," !"))},addChapter(){if(!editor.data||!editor.data.chapters)return;const r="ch_"+Date.now();editor.data.chapters.push({id:r,title:" ",description:""}),editor.selectedChapterId=r,console.log(`[StoryStore]   : ${r}`)},addDialogue(){if(!editor.data||!editor.selectedChapterId)return;const r="d_"+Date.now();editor.data.dialogues.push({id:r,chapterId:editor.selectedChapterId,text:" ...",options:[]}),editor.selectedDialogueId=r},deleteDialogue(r){confirm("  "+r+"?")&&editor.data&&(editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null))},jumpTo(r){const e=editor.data?.dialogues.find(t=>t.id===r);e&&(editor.selectedChapterId=e.chapterId,editor.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var $$_import_editorDerived$1=reactive_import(()=>editorDerived),root_1$A=from_html('<div class="chapter-form svelte-18vh899"><div class="form-header svelte-18vh899"><h4 class="svelte-18vh899"> </h4> <div class="header-actions svelte-18vh899"><button class="btn-icon danger svelte-18vh899" title=" "></button></div></div> <div class="form-group svelte-18vh899"><label for="chapter-title" class="svelte-18vh899"> </label> <input type="text" id="chapter-title" class="input svelte-18vh899" placeholder=" "/></div> <div class="form-group svelte-18vh899"><label for="chapter-description" class="svelte-18vh899"> </label> <textarea id="chapter-description" class="textarea svelte-18vh899" rows="4" placeholder=" ..."></textarea></div> <div class="form-actions svelte-18vh899"><button class="btn svelte-18vh899"></button> <button class="btn primary svelte-18vh899"></button></div></div>');function ChapterForm(r,e){push(e,!1);function t(){$$_import_editorDerived$1().currentEditingChapter&&(editorActions.updateChapter($$_import_editorDerived$1().currentEditingChapter.id,{title:$$_import_editorDerived$1().currentEditingChapter.title,description:$$_import_editorDerived$1().currentEditingChapter.description}),editorActions.selectEditingChapter(null))}function n(){editorActions.selectEditingChapter(null)}function i(){$$_import_editorDerived$1().currentEditingChapter&&confirm(`  "${$$_import_editorDerived$1().currentEditingChapter.title}"?`)&&(editorActions.deleteChapter($$_import_editorDerived$1().currentEditingChapter.id),editorActions.selectEditingChapter(null))}init();var s=comment(),o=first_child(s);{var c=f=>{var v=root_1$A(),h=child(v),m=sibling(child(h),2),y=child(m),g=sibling(h,2),w=sibling(child(g),2),k=sibling(g,2),I=sibling(child(k),2),O=sibling(k,2),B=child(O),P=sibling(B,2);delegated("click",y,i),bind_value(w,()=>$$_import_editorDerived$1().currentEditingChapter.title,G=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.title=G)),bind_value(I,()=>$$_import_editorDerived$1().currentEditingChapter.description,G=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.description=G)),delegated("click",B,n),delegated("click",P,t),append(f,v)};if_block(o,f=>{$$_import_editorDerived$1().currentEditingChapter&&f(c)})}append(r,s),pop()}delegate(["click"]);var $$_import_editor$3=reactive_import(()=>editor),root_2$s=from_html('<div class="chapter-form-container svelte-1o831wl"><!></div>'),root_1$z=from_html('<div class="chapter-row svelte-1o831wl"><button type="button"><span class="chapter-title svelte-1o831wl"> </span></button> <button type="button" class="edit-chapter-btn svelte-1o831wl" title=" "></button></div> <!>',1),root_3$x=from_html('<button type="button"><span class="id-badge svelte-1o831wl"> </span> <span class="preview-text svelte-1o831wl"> </span></button>'),root_4$s=from_html("<div> </div>"),root$h=from_html('<aside class="sidebar svelte-1o831wl"><div class="sidebar-section svelte-1o831wl"><div class="section-header"><h3></h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-1o831wl"></div></div> <div class="sidebar-section flex-1 svelte-1o831wl"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-1o831wl"></div></div> <div class="status-box svelte-1o831wl"><!></div></aside>');function EditorSidebar(r,e){push(e,!1);function t(O){editorActions.selectEditingChapter(O)}init();var n=root$h(),i=child(n),s=child(i),o=sibling(child(s),2),c=sibling(s,2);each(c,5,()=>$$_import_editor$3().data?.chapters||[],O=>O.id,(O,B)=>{var P=root_1$z(),G=first_child(P),Y=child(G);let M;var T=child(Y),x=child(T),D=sibling(Y,2),N=sibling(G,2);{var q=ie=>{var K=root_2$s(),se=child(K);ChapterForm(se,{}),append(ie,K)};if_block(N,ie=>{$$_import_editor$3().editingChapterId===get$2(B).id&&ie(q)})}template_effect(()=>{M=set_class(Y,1,"chapter-item svelte-1o831wl",null,M,{active:$$_import_editor$3().selectedChapterId===get$2(B).id}),set_attribute(Y,"aria-pressed",$$_import_editor$3().selectedChapterId===get$2(B).id),set_attribute(Y,"title",get$2(B).description||" "),set_text(x,get$2(B).title)}),delegated("click",Y,()=>$$_import_editor$3($$_import_editor$3().selectedChapterId=get$2(B).id)),delegated("click",D,()=>t(get$2(B).id)),append(O,P)});var f=sibling(i,2),v=child(f),h=child(v),m=child(h),y=sibling(h,2),g=sibling(v,2);each(g,5,()=>editorDerived.chapterDialogues,O=>O.id,(O,B)=>{var P=root_3$x();let G;var Y=child(P),M=child(Y),T=sibling(Y,2),x=child(T);template_effect(D=>{G=set_class(P,1,"dialogue-item svelte-1o831wl",null,G,{active:$$_import_editor$3().selectedDialogueId===get$2(B).id}),set_attribute(P,"aria-pressed",$$_import_editor$3().selectedDialogueId===get$2(B).id),set_text(M,get$2(B).id),set_text(x,`${D??""}...`)},[()=>get$2(B).text.substring(0,25)]),delegated("click",P,()=>$$_import_editor$3($$_import_editor$3().selectedDialogueId=get$2(B).id)),append(O,P)});var w=sibling(f,2),k=child(w);{var I=O=>{var B=root_4$s(),P=child(B);template_effect(()=>{set_class(B,1,`alert ${$$_import_editor$3().statusMessage.type??""}`,"svelte-1o831wl"),set_text(P,$$_import_editor$3().statusMessage.text)}),append(O,B)};if_block(k,O=>{$$_import_editor$3().statusMessage.text&&O(I)})}template_effect(()=>{set_text(m,` (${editorDerived.chapterDialogues.length??""})`),y.disabled=!$$_import_editor$3().selectedChapterId}),delegated("click",o,function(...O){storyActions.addChapter?.apply(this,O)}),delegated("click",y,function(...O){storyActions.addDialogue?.apply(this,O)}),append(r,n),pop()}delegate(["click"]);var root$g=from_html('<div class="body-wrapper svelte-1nxg5ck"><!></div>');function BodyWrapper(r,e){var t=root$g(),n=child(t);snippet(n,()=>e.children),append(r,t)}var root_1$y=from_html('<button class="btn btn-info svelte-17rh6eq"> </button>'),root_2$r=from_html('<button class="btn btn-secondary svelte-17rh6eq"> </button>'),root_4$r=from_html('<button class="btn btn-danger svelte-17rh6eq"> </button>'),root$f=from_html('<div id="game-header" class="svelte-17rh6eq"><!> <!> <!> <!></div>');function GameHeader(r,e){let t=prop(e,"showGiveUp",3,!1),n=prop(e,"extraContent",3,null),i=prop(e,"onShowRules",3,null);var s=root$f(),o=child(s);{var c=w=>{var k=root_1$y();delegated("click",k,function(...I){i()?.apply(this,I)}),append(w,k)};if_block(o,w=>{i()&&w(c)})}var f=sibling(o,2);{var v=w=>{var k=root_2$r();delegated("click",k,function(...I){e.onRestart?.apply(this,I)}),append(w,k)};if_block(f,w=>{e.onRestart&&w(v)})}var h=sibling(f,2);{var m=w=>{var k=comment(),I=first_child(k);snippet(I,n),append(w,k)};if_block(h,w=>{n()&&w(m)})}var y=sibling(h,2);{var g=w=>{var k=root_4$r();delegated("click",k,function(...I){e.onGiveUp?.apply(this,I)}),append(w,k)};if_block(y,w=>{t()&&e.onGiveUp&&w(g)})}append(r,s)}delegate(["click"]);var root_2$q=from_html('<div class="item-icon reward-glow svelte-ou4r90"><img class="icon-preview svelte-ou4r90" height="64px"/></div>'),root_1$x=from_html('<div id="reward-panel" class="svelte-ou4r90"><!> <div class="reward-info svelte-ou4r90"><div class="reward-label svelte-ou4r90"> </div> <div class="reward-name svelte-ou4r90"> </div></div></div>');function RewardPanel(r,e){push(e,!0);let t=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),i=prop(e,"bucketName",3,"dracula"),s=prop(e,"label",3,"");function o(){if(!t()||!n()||n().length===0)return null;const g=typeof t()=="string"?t():t()?.id;return g&&n().find(w=>w.id===g)||null}let c=user_derived(o),f=user_derived(()=>typeof t()=="object"&&t()?.name?t().name:null);function v(g){const w=g.target;w.style.display="none"}var h=comment(),m=first_child(h);{var y=g=>{var w=root_1$x(),k=child(w);{var I=M=>{var T=root_2$q(),x=child(T);template_effect(()=>{set_attribute(x,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${i()}/${get$2(c)?.icon||(typeof t()=="object"?t().icon:"")}`),set_attribute(x,"alt",get$2(c)?.name||get$2(f)||"")}),event("error",x,v),append(M,T)};if_block(k,M=>{(get$2(c)?.icon||typeof t()=="object"&&t().icon)&&M(I)})}var O=sibling(k,2),B=child(O),P=child(B),G=sibling(B,2),Y=child(G);template_effect(()=>{set_text(P,`${s()??""}:`),set_text(Y,get$2(c)?.name||get$2(f)||" ")}),append(g,w)};if_block(m,g=>{(get$2(c)||get$2(f))&&g(y)})}append(r,h),pop()}var root$e=from_html('<div id="game-footer" class="svelte-123k9nw"><!> <!></div>');function GameFooter(r,e){let t=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),i=prop(e,"bucketName",3,"dracula");var s=root$e(),o=child(s);RewardPanel(o,{get rewardItem(){return t()},get items(){return n()},get bucketName(){return i()}});var c=sibling(o,2);{var f=v=>{var h=comment(),m=first_child(h);snippet(m,()=>e.children),append(v,h)};if_block(c,v=>{e.children&&v(f)})}append(r,s)}var root_2$p=from_html("<button> </button>"),root_1$w=from_html('<div id="modal-overlay"><div class="modal-content svelte-xyr56x"><div class="modal-title svelte-xyr56x"> </div> <div class="modal-text svelte-xyr56x"> </div> <div class="modal-buttons svelte-xyr56x"></div></div></div>');function MinigameModal(r,e){push(e,!0);let t=prop(e,"modal",7);var n=comment(),i=first_child(n);{var s=o=>{var c=root_1$w();let f;var v=child(c),h=child(v),m=child(h),y=sibling(h,2),g=child(y),w=sibling(y,2);each(w,21,()=>t().actions,k=>k.text,(k,I)=>{var O=root_2$p();let B;var P=child(O);template_effect(()=>{B=set_class(O,1,"btn",null,B,{"btn-secondary":get$2(I).class==="btn-secondary"}),set_text(P,get$2(I).text)}),delegated("click",O,function(...G){get$2(I).action?.apply(this,G)}),append(k,O)}),template_effect(()=>{f=set_class(c,1,"svelte-xyr56x",null,f,{active:t().show}),set_text(m,t().title),set_text(g,t().text)}),append(o,c)};if_block(i,o=>{t().show&&o(s)})}append(r,n),pop()}delegate(["click"]);var root_3$w=from_html('<button type="button"><div class="card-inner svelte-1x5wsyh"><div class="card-front svelte-1x5wsyh"> </div> <div class="card-back svelte-1x5wsyh">?</div></div></button>'),root_5$p=from_html('<span class="cooldown-timer svelte-1x5wsyh"> </span>'),root_4$q=from_html('<div class="footer-stats svelte-1x5wsyh"><span class="tiles-counter svelte-1x5wsyh">: <strong class="svelte-1x5wsyh"> </strong></span> <button> <!></button></div>'),root_1$v=from_html('<!> <div id="game-container" class="svelte-1x5wsyh"><div id="grid" class="svelte-1x5wsyh"></div></div> <!> <!>',1);function MemoMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=4,c=4,f=5,v=1e3,h=["","","","","","","","","","","","","","","","","",""];let m=state(proxy([])),y=state(proxy([])),g=state(proxy([])),w=state(proxy([])),k=state(null),I=state(!1),O=state(!1),B=state(0),P=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>{T()});function G(){let z=0;for(let V=0;V<o;V++)for(let oe=0;oe<c;oe++)get$2(y)[V]?.[oe]||z++;return z}let Y=user_derived(G),M=user_derived(()=>get$2(B)<1);function T(){set(m,[],!0),set(y,[],!0),set(g,[],!0),set(k,null),set(I,!1),set(O,!1),set(w,[],!0),set(B,0),se();let z=[...new Set(h)];for(;z.length<o*c/2;)z=[...z,...z];let V=z.sort(()=>.5-Math.random()).slice(0,o*c/2),oe=[];V.forEach(j=>oe.push(j,j)),oe.sort(()=>Math.random()-.5);let U=0;for(let j=0;j<o;j++){let ne=[],te=[],fe=[];for(let ce=0;ce<c;ce++)ne.push(oe[U++]),te.push(!1),fe.push(!1);get$2(m).push(ne),get$2(y).push(te),get$2(g).push(fe)}}async function x(z,V){if(!(get$2(I)||get$2(y)[z]?.[V]||get$2(O))){if(get$2(k)&&get$2(k).r===z&&get$2(k).c===V){get$2(g)[z][V]=!1,set(k,null);return}if(!get$2(g)[z]?.[V])if(get$2(w).length>0&&set(w,[],!0),get$2(g)[z][V]=!0,!get$2(k))set(k,{r:z,c:V},!0);else{set(I,!0);const oe={r:z,c:V},U=get$2(m)[get$2(k).r][get$2(k).c],j=get$2(m)[oe.r][oe.c];U===j?setTimeout(()=>{get$2(y)[get$2(k).r][get$2(k).c]=!0,get$2(y)[oe.r][oe.c]=!0,get$2(g)[get$2(k).r][get$2(k).c]=!1,get$2(g)[oe.r][oe.c]=!1,set(k,null),set(I,!1),D(),q()},600):setTimeout(()=>{get$2(g)[get$2(k).r][get$2(k).c]=!1,get$2(g)[oe.r][oe.c]=!1,set(k,null),set(I,!1)},1e3)}}}function D(){set(B,f);const z=setInterval(()=>{update(B,-1),get$2(B)<=0&&clearInterval(z)},1e3)}function N(){if(!(get$2(I)||get$2(O)||!get$2(M)))for(let z=0;z<o;z++)for(let V=0;V<c;V++){if(get$2(y)[z]?.[V]||get$2(g)[z]?.[V])continue;let oe=get$2(m)[z][V];for(let U=0;U<o;U++)for(let j=0;j<c;j++)if(!(z===U&&V===j)&&!(get$2(y)[U]?.[j]||get$2(g)[U]?.[j])&&get$2(m)[U][j]===oe){set(w,[{r:z,c:V},{r:U,c:j}],!0),setTimeout(()=>set(w,[],!0),1500);return}}}function q(){get$2(Y)===0&&(set(O,!0),t()?(K(" !","  !",[]),setTimeout(()=>{se(),e.onWin?.()},v)):K(" !","  !",[{text:" ",action:T}]))}function ie(){t()?(K(" "," ...",[]),setTimeout(()=>{se(),e.onLose?.()},v)):K("","  !",[{text:" ",action:T}])}function K(z,V,oe){set(P,{show:!0,title:z,text:V,actions:oe},!0)}function se(){get$2(P).show=!1}function me(){K(" ",`  :

 :     .

   ,   .

       .

      .

      .

  ( )   ,   .`,[{text:"",action:se}])}BodyWrapper(r,{children:(z,V)=>{var oe=root_1$v(),U=first_child(oe);{let ce=user_derived(()=>t()?ie:void 0);GameHeader(U,{onRestart:T,get onGiveUp(){return get$2(ce)},get showGiveUp(){return t()},onShowRules:me})}var j=sibling(U,2),ne=child(j);set_style(ne,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),each(ne,21,()=>get$2(m),index$1,(ce,we,$e)=>{var he=comment(),ue=first_child(he);each(ue,17,()=>get$2(we),index$1,(Z,ge,Se)=>{var ae=root_3$w();let H;set_attribute(ae,"aria-label",` ${$e}, ${Se}`);var F=child(ae),W=child(F),X=child(W);template_effect(le=>{H=set_class(ae,1,"cell svelte-1x5wsyh",null,H,le),set_text(X,get$2(ge))},[()=>({flipped:get$2(g)[$e]?.[Se],matched:get$2(y)[$e]?.[Se],selected:get$2(k)?.r===$e&&get$2(k)?.c===Se,"hint-glow":get$2(w).some(le=>le.r===$e&&le.c===Se)})]),delegated("click",ae,()=>x($e,Se)),append(Z,ae)}),append(ce,he)});var te=sibling(j,2);GameFooter(te,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ce,we)=>{var $e=root_4$q(),he=child($e),ue=sibling(child(he)),Z=child(ue),ge=sibling(he,2);let Se;var ae=sibling(child(ge));{var H=F=>{var W=root_5$p(),X=child(W);template_effect(()=>set_text(X,`(${get$2(B)??""})`)),append(F,W)};if_block(ae,F=>{get$2(B)>0&&F(H)})}template_effect(()=>{set_text(Z,get$2(Y)),Se=set_class(ge,1,"btn btn-secondary svelte-1x5wsyh",null,Se,{disabled:!get$2(M),"cooldown-active":get$2(B)>0}),ge.disabled=!get$2(M)}),delegated("click",ge,N),append(ce,$e)},$$slots:{default:!0}});var fe=sibling(te,2);MinigameModal(fe,{get modal(){return get$2(P)}}),append(z,oe)}}),pop()}delegate(["click"]);var root_3$v=from_html('<div role="button" tabindex="0"> </div>'),root_5$o=from_svg('<polyline class="connection-line svelte-1c1tf5n" vector-effect="non-scaling-stroke"></polyline>'),root_7$f=from_html('<span class="cooldown-timer svelte-1c1tf5n"> </span>'),root_6$i=from_html('<div class="footer-stats svelte-1c1tf5n"><span class="tiles-counter svelte-1c1tf5n">: <strong class="svelte-1c1tf5n"> </strong></span> <button> <!></button></div>'),root_1$u=from_html('<!> <div id="game-container" class="svelte-1c1tf5n"><div id="grid" class="svelte-1c1tf5n"></div> <svg id="line-layer" class="svelte-1c1tf5n"><!></svg></div> <!> <!>',1);function OnetMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=8,c=6,f=5,v=1e3,h=["","","","","","","","","","","","","","","","","","","","","","","","","","","",""];let m=state(proxy([])),y=state(proxy([])),g=state(proxy({})),w=state(proxy([])),k=state(null),I=state(!1),O=state(!1),B=state(""),P=state(0),G=state(0),Y=state(proxy({show:!1,title:"",text:"",actions:[]})),M,T;onMount(()=>{q()});function x(){if(!get$2(y)||get$2(y).length===0)return 0;let he=0;for(let ue=0;ue<o;ue++)for(let Z=0;Z<c;Z++)get$2(y)[ue]&&!get$2(y)[ue][Z]&&he++;return he}let D=user_derived(x),N=user_derived(()=>get$2(G)<1);function q(){set(m,[],!0),set(y,[],!0),set(k,null),set(I,!1),set(O,!1),set(g,{},!0),set(w,[],!0),set(B,""),set(G,0),ce();let he=[...new Set(h)];for(;he.length<o*c/2;)he=[...he,...he];let ue=he.sort(()=>.5-Math.random()).slice(0,o*c/2),Z=[];ue.forEach(Se=>Z.push(Se,Se)),Z.sort(()=>Math.random()-.5);let ge=0;for(let Se=0;Se<o;Se++){let ae=[],H=[];for(let F=0;F<c;F++)ae.push(Z[ge++]),H.push(!1);get$2(m).push(ae),get$2(y).push(H)}setTimeout(z,500)}async function ie(he,ue){if(get$2(I)||get$2(y)[he][ue]||get$2(O))return;if(get$2(w).length>0&&set(w,[],!0),!get$2(k)){set(k,{r:he,c:ue},!0);return}if(get$2(k).r===he&&get$2(k).c===ue){set(k,null);return}const Z=get$2(m)[get$2(k).r][get$2(k).c],ge=get$2(m)[he][ue];if(Z===ge){const Se=ne(get$2(k).r,get$2(k).c,he,ue);if(Se){set(I,!0),await te(Se),get$2(y)[get$2(k).r][get$2(k).c]=!0,get$2(y)[he][ue]=!0,set(k,null),set(I,!1),se(),z();return}}set(k,{r:he,c:ue},!0)}async function K(he,ue,Z){(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),await ie(he,ue))}function se(){set(G,f);const he=setInterval(()=>{update(G,-1),get$2(G)<=0&&clearInterval(he)},1e3)}function me(){if(get$2(I)||get$2(O)||!get$2(N))return;let he=[];for(let Z=0;Z<o;Z++)for(let ge=0;ge<c;ge++)get$2(y)[Z][ge]||he.push({r:Z,c:ge,icon:get$2(m)[Z][ge]});let ue={};he.forEach(Z=>{ue[Z.icon]||(ue[Z.icon]=[]),ue[Z.icon].push(Z)});for(const Z in ue){const ge=ue[Z];if(!(ge.length<2))for(let Se=0;Se<ge.length;Se++)for(let ae=Se+1;ae<ge.length;ae++){const H=ge[Se],F=ge[ae];if(ne(H.r,H.c,F.r,F.c)){set(w,[H,F],!0),setTimeout(()=>set(w,[],!0),1500);return}}}}function z(){if(get$2(D)===0){set(O,!0),t()?(fe(" !","  !",[]),setTimeout(()=>{ce(),e.onWin?.()},v)):fe(" !","  !",[{text:" ",action:q}]);return}V()||(t()?setTimeout(()=>oe(),1e3):fe(" !","  . ?",[{text:"",action:()=>{ce(),oe()}},{text:"",action:()=>{fe("","  !",[{text:"",action:q}])}}]))}function V(){let he=[];for(let Z=0;Z<o;Z++)for(let ge=0;ge<c;ge++)get$2(y)[Z][ge]||he.push({r:Z,c:ge,icon:get$2(m)[Z][ge]});let ue={};he.forEach(Z=>{ue[Z.icon]||(ue[Z.icon]=[]),ue[Z.icon].push(Z)});for(const Z in ue){const ge=ue[Z];if(!(ge.length<2)){for(let Se=0;Se<ge.length;Se++)for(let ae=Se+1;ae<ge.length;ae++)if(ne(ge[Se].r,ge[Se].c,ge[ae].r,ge[ae].c))return!0}}return!1}function oe(){let he=[],ue=[];for(let Z=0;Z<o;Z++)for(let ge=0;ge<c;ge++)get$2(y)[Z][ge]||(he.push(get$2(m)[Z][ge]),ue.push({r:Z,c:ge}));he.length!==0&&(he.sort(()=>Math.random()-.5),ue.forEach((Z,ge)=>{get$2(m)[Z.r][Z.c]=he[ge],get$2(g)[`${Z.r},${Z.c}`]=!0}),setTimeout(()=>{set(g,{},!0),V()?set(O,!1):oe()},500))}function U(he,ue){return he<0||he>=o||ue<0||ue>=c?!0:get$2(y)[he][ue]}function j(he,ue,Z,ge){if(he!==Z&&ue!==ge)return!1;if(he===Z){const Se=Math.min(ue,ge),ae=Math.max(ue,ge);for(let H=Se+1;H<ae;H++)if(!U(he,H))return!1}else{const Se=Math.min(he,Z),ae=Math.max(he,Z);for(let H=Se+1;H<ae;H++)if(!U(H,ue))return!1}return!0}function ne(he,ue,Z,ge){if(j(he,ue,Z,ge))return[{r:he,c:ue},{r:Z,c:ge}];const Se={r:he,c:ge};if(U(Se.r,Se.c)&&j(he,ue,Se.r,Se.c)&&j(Se.r,Se.c,Z,ge))return[{r:he,c:ue},Se,{r:Z,c:ge}];const ae={r:Z,c:ue};if(U(ae.r,ae.c)&&j(he,ue,ae.r,ae.c)&&j(ae.r,ae.c,Z,ge))return[{r:he,c:ue},ae,{r:Z,c:ge}];for(let H=-1;H<=o;H++){if(H===he||H===Z)continue;const F={r:H,c:ue},W={r:H,c:ge};if(U(F.r,F.c)&&U(W.r,W.c)&&j(he,ue,F.r,F.c)&&j(F.r,F.c,W.r,W.c)&&j(W.r,W.c,Z,ge))return[{r:he,c:ue},F,W,{r:Z,c:ge}]}for(let H=-1;H<=c;H++){if(H===ue||H===ge)continue;const F={r:he,c:H},W={r:Z,c:H};if(U(F.r,F.c)&&U(W.r,W.c)&&j(he,ue,F.r,F.c)&&j(F.r,F.c,W.r,W.c)&&j(W.r,W.c,Z,ge))return[{r:he,c:ue},F,W,{r:Z,c:ge}]}return null}async function te(he){if(await tick(),!M||!T)return;const ue=M.getBoundingClientRect(),Z=T.getBoundingClientRect(),ge=T.querySelector(".cell:not(.matched)");if(!ge)return;const Se=ge.offsetWidth,ae=ge.offsetHeight,H=window.getComputedStyle(T),F=parseFloat(H.gap)||4,W=Z.left-ue.left,X=Z.top-ue.top,le=he.map(Ee=>{let Q,ye;if(Ee.r>=0&&Ee.r<o&&Ee.c>=0&&Ee.c<c){const ke=T.children[Ee.r*c+Ee.c].getBoundingClientRect();Q=ke.left-ue.left+ke.width/2,ye=ke.top-ue.top+ke.height/2}else{const be=Ee.c*(Se+F)+Se/2,ke=Ee.r*(ae+F)+ae/2;Q=W+be,ye=X+ke}return`${Q.toFixed(1)},${ye.toFixed(1)}`}).join(" ");return set(B,le,!0),update(P),new Promise(Ee=>{setTimeout(()=>{set(B,""),Ee()},350)})}function fe(he,ue,Z){set(Y,{show:!0,title:he,text:ue,actions:Z},!0)}function ce(){get$2(Y).show=!1}function we(){fe(" ",` :

 :     .

     .

      2  ().

       .

        .

      ( ).`,[{text:"",action:ce}])}function $e(){t()?(fe(" "," ...",[]),setTimeout(()=>{ce(),e.onLose?.()},v)):fe("","  !",[{text:"",action:q}])}BodyWrapper(r,{children:(he,ue)=>{var Z=root_1$u(),ge=first_child(Z);{let le=user_derived(()=>t()?$e:void 0);GameHeader(ge,{onRestart:q,get onGiveUp(){return get$2(le)},get showGiveUp(){return t()},onShowRules:we})}var Se=sibling(ge,2),ae=child(Se);set_style(ae,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),each(ae,21,()=>get$2(m),index$1,(le,Ee,Q)=>{var ye=comment(),be=first_child(ye);each(be,17,()=>get$2(Ee),index$1,(ke,Me,E)=>{var d=root_3$v();let p;var A=child(d);template_effect(L=>{p=set_class(d,1,"cell svelte-1c1tf5n",null,p,L),set_text(A,get$2(Me))},[()=>({selected:get$2(k)?.r===Q&&get$2(k)?.c===E,matched:get$2(y)[Q][E],shuffling:get$2(g)[`${Q},${E}`],"hint-glow":get$2(w).some(L=>L.r===Q&&L.c===E)})]),delegated("click",d,()=>ie(Q,E)),delegated("keydown",d,L=>K(Q,E,L)),append(ke,d)}),append(le,ye)}),bind_this(ae,le=>T=le,()=>T);var H=sibling(ae,2),F=child(H);key(F,()=>get$2(P),le=>{var Ee=comment(),Q=first_child(Ee);{var ye=be=>{var ke=root_5$o();template_effect(()=>set_attribute(ke,"points",get$2(B))),append(be,ke)};if_block(Q,be=>{get$2(B)&&be(ye)})}append(le,Ee)}),bind_this(Se,le=>M=le,()=>M);var W=sibling(Se,2);GameFooter(W,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(le,Ee)=>{var Q=root_6$i(),ye=child(Q),be=sibling(child(ye)),ke=child(be),Me=sibling(ye,2);let E;var d=sibling(child(Me));{var p=A=>{var L=root_7$f(),ee=child(L);template_effect(()=>set_text(ee,`(${get$2(G)??""})`)),append(A,L)};if_block(d,A=>{get$2(G)>0&&A(p)})}template_effect(()=>{set_text(ke,get$2(D)),E=set_class(Me,1,"btn btn-secondary svelte-1c1tf5n",null,E,{disabled:!get$2(N),"cooldown-active":get$2(G)>0}),Me.disabled=!get$2(N)}),delegated("click",Me,me),append(le,Q)},$$slots:{default:!0}});var X=sibling(W,2);MinigameModal(X,{get modal(){return get$2(Y)}}),append(he,Z)}}),pop()}delegate(["click","keydown"]);var root_3$u=from_html('<div role="button" tabindex="0"> </div>'),root_5$n=from_svg('<polyline class="connection-line svelte-m54bkq" vector-effect="non-scaling-stroke"></polyline>'),root_7$e=from_html('<span class="cooldown-timer svelte-m54bkq"> </span>'),root_6$h=from_html('<div class="footer-stats svelte-m54bkq"><div class="size-selector svelte-m54bkq"><button title=" (  )"></button> <button title="16x9">169</button> <button title="16x16">1616</button></div> <span class="tiles-counter svelte-m54bkq">: <strong class="svelte-m54bkq"> </strong></span> <button> <!></button></div>'),root_1$t=from_html('<!> <div id="game-container" class="svelte-m54bkq"><div id="grid" class="svelte-m54bkq"></div> <svg id="line-layer" class="svelte-m54bkq"><!></svg></div> <!> <!>',1);function OnetMonsters144(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=5,c=1e3;let f=state("auto"),v=state(!0);function h(){typeof window<"u"&&set(v,window.innerWidth>window.innerHeight)}const m=user_derived(()=>get$2(f)==="16x9"?9:get$2(f)==="16x16"?16:get$2(v)?9:16),y=user_derived(()=>get$2(f)==="16x9"||get$2(f)==="16x16"||get$2(v)?16:9),g=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];let w=state(proxy([])),k=state(proxy([])),I=state(proxy({})),O=state(proxy([])),B=state(null),P=state(!1),G=state(!1),Y=state(""),M=state(0),T=state(0),x=state(proxy({show:!1,title:"",text:"",actions:[]})),D,N;onMount(()=>(h(),window.addEventListener("resize",h),window.addEventListener("orientationchange",h),z(),()=>{window.removeEventListener("resize",h),window.removeEventListener("orientationchange",h)}));function q(){if(!get$2(k)||get$2(k).length===0)return 0;let ae=0;const H=get$2(m),F=get$2(y);for(let W=0;W<H;W++)for(let X=0;X<F;X++)get$2(k)[W]&&!get$2(k)[W][X]&&ae++;return ae}let ie=user_derived(q),K=user_derived(()=>get$2(T)<1),se=state(!0);user_effect(()=>{get$2(f)==="auto"&&get$2(se)!==get$2(v)&&get$2(w).length>0&&z(),set(se,get$2(v),!0)});function me(ae){set(f,ae,!0),z()}function z(){set(w,[],!0),set(k,[],!0),set(B,null),set(P,!1),set(G,!1),set(I,{},!0),set(O,[],!0),set(Y,""),set(T,0),Z();const ae=get$2(m),H=get$2(y),F=ae*H;let W=[...new Set(g)];for(;W.length<F/2;)W=[...W,...W];let X=W.sort(()=>.5-Math.random()).slice(0,F/2),le=[];X.forEach(Q=>le.push(Q,Q)),le.sort(()=>Math.random()-.5);let Ee=0;for(let Q=0;Q<ae;Q++){let ye=[],be=[];for(let ke=0;ke<H;ke++)ye.push(le[Ee++]),be.push(!1);get$2(w).push(ye),get$2(k).push(be)}setTimeout(ne,500)}async function V(ae,H){if(get$2(P)||get$2(k)[ae][H]||get$2(G))return;if(get$2(O).length>0&&set(O,[],!0),!get$2(B)){set(B,{r:ae,c:H},!0);return}if(get$2(B).r===ae&&get$2(B).c===H){set(B,null);return}const F=get$2(w)[get$2(B).r][get$2(B).c],W=get$2(w)[ae][H];if(F===W){const X=$e(get$2(B).r,get$2(B).c,ae,H);if(X){set(P,!0),await he(X),get$2(k)[get$2(B).r][get$2(B).c]=!0,get$2(k)[ae][H]=!0,set(B,null),set(P,!1),U(),ne();return}}set(B,{r:ae,c:H},!0)}async function oe(ae,H,F){(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),await V(ae,H))}function U(){set(T,o);const ae=setInterval(()=>{update(T,-1),get$2(T)<=0&&clearInterval(ae)},1e3)}function j(){if(get$2(P)||get$2(G)||!get$2(K))return;const ae=get$2(m),H=get$2(y);let F=[];for(let X=0;X<ae;X++)for(let le=0;le<H;le++)get$2(k)[X][le]||F.push({r:X,c:le,icon:get$2(w)[X][le]});let W={};F.forEach(X=>{W[X.icon]||(W[X.icon]=[]),W[X.icon].push(X)});for(const X in W){const le=W[X];if(!(le.length<2))for(let Ee=0;Ee<le.length;Ee++)for(let Q=Ee+1;Q<le.length;Q++){const ye=le[Ee],be=le[Q];if($e(ye.r,ye.c,be.r,be.c)){set(O,[ye,be],!0),setTimeout(()=>set(O,[],!0),1500);return}}}}function ne(){if(get$2(ie)===0){set(G,!0),t()?(ue(" !","  !",[]),setTimeout(()=>{Z(),e.onWin?.()},c)):ue(" !","  !",[{text:" ",action:z}]);return}te()||(t()?setTimeout(()=>fe(),1e3):ue(" !","  . ?",[{text:"",action:()=>{Z(),fe()}},{text:"",action:()=>{ue("","  !",[{text:"",action:z}])}}]))}function te(){const ae=get$2(m),H=get$2(y);let F=[];for(let X=0;X<ae;X++)for(let le=0;le<H;le++)get$2(k)[X][le]||F.push({r:X,c:le,icon:get$2(w)[X][le]});let W={};F.forEach(X=>{W[X.icon]||(W[X.icon]=[]),W[X.icon].push(X)});for(const X in W){const le=W[X];if(!(le.length<2)){for(let Ee=0;Ee<le.length;Ee++)for(let Q=Ee+1;Q<le.length;Q++)if($e(le[Ee].r,le[Ee].c,le[Q].r,le[Q].c))return!0}}return!1}function fe(){const ae=get$2(m),H=get$2(y);let F=[],W=[];for(let X=0;X<ae;X++)for(let le=0;le<H;le++)get$2(k)[X][le]||(F.push(get$2(w)[X][le]),W.push({r:X,c:le}));F.length!==0&&(F.sort(()=>Math.random()-.5),W.forEach((X,le)=>{get$2(w)[X.r][X.c]=F[le],get$2(I)[`${X.r},${X.c}`]=!0}),setTimeout(()=>{set(I,{},!0),te()?set(G,!1):fe()},500))}function ce(ae,H){const F=get$2(m),W=get$2(y);return ae<0||ae>=F||H<0||H>=W?!0:get$2(k)[ae][H]}function we(ae,H,F,W){if(ae!==F&&H!==W)return!1;if(ae===F){const X=Math.min(H,W),le=Math.max(H,W);for(let Ee=X+1;Ee<le;Ee++)if(!ce(ae,Ee))return!1}else{const X=Math.min(ae,F),le=Math.max(ae,F);for(let Ee=X+1;Ee<le;Ee++)if(!ce(Ee,H))return!1}return!0}function $e(ae,H,F,W){if(we(ae,H,F,W))return[{r:ae,c:H},{r:F,c:W}];const X={r:ae,c:W};if(ce(X.r,X.c)&&we(ae,H,X.r,X.c)&&we(X.r,X.c,F,W))return[{r:ae,c:H},X,{r:F,c:W}];const le={r:F,c:H};if(ce(le.r,le.c)&&we(ae,H,le.r,le.c)&&we(le.r,le.c,F,W))return[{r:ae,c:H},le,{r:F,c:W}];const Ee=get$2(m),Q=get$2(y);for(let ye=-1;ye<=Ee;ye++){if(ye===ae||ye===F)continue;const be={r:ye,c:H},ke={r:ye,c:W};if(ce(be.r,be.c)&&ce(ke.r,ke.c)&&we(ae,H,be.r,be.c)&&we(be.r,be.c,ke.r,ke.c)&&we(ke.r,ke.c,F,W))return[{r:ae,c:H},be,ke,{r:F,c:W}]}for(let ye=-1;ye<=Q;ye++){if(ye===H||ye===W)continue;const be={r:ae,c:ye},ke={r:F,c:ye};if(ce(be.r,be.c)&&ce(ke.r,ke.c)&&we(ae,H,be.r,be.c)&&we(be.r,be.c,ke.r,ke.c)&&we(ke.r,ke.c,F,W))return[{r:ae,c:H},be,ke,{r:F,c:W}]}return null}async function he(ae){if(await tick(),!D||!N)return;const H=D.getBoundingClientRect(),F=N.getBoundingClientRect(),W=N.querySelector(".cell:not(.matched)");if(!W)return;const X=W.offsetWidth,le=W.offsetHeight,Ee=window.getComputedStyle(N),Q=parseFloat(Ee.gap)||4,ye=F.left-H.left,be=F.top-H.top,ke=get$2(m),Me=get$2(y),E=ae.map(d=>{let p,A;if(d.r>=0&&d.r<ke&&d.c>=0&&d.c<Me){const ee=N.children[d.r*Me+d.c].getBoundingClientRect();p=ee.left-H.left+ee.width/2,A=ee.top-H.top+ee.height/2}else{const L=d.c*(X+Q)+X/2,ee=d.r*(le+Q)+le/2;p=ye+L,A=be+ee}return`${p.toFixed(1)},${A.toFixed(1)}`}).join(" ");return set(Y,E,!0),update(M),new Promise(d=>{setTimeout(()=>{set(Y,""),d()},350)})}function ue(ae,H,F){set(x,{show:!0,title:ae,text:H,actions:F},!0)}function Z(){get$2(x).show=!1}function ge(){ue(" ",` :

 :     .

     .

      2  ().

       .

        .

      ( ).`,[{text:"",action:Z}])}function Se(){t()?(ue(" "," ...",[]),setTimeout(()=>{Z(),e.onLose?.()},c)):ue("","  !",[{text:"",action:z}])}BodyWrapper(r,{children:(ae,H)=>{var F=root_1$t(),W=first_child(F);{let ke=user_derived(()=>t()?Se:void 0);GameHeader(W,{onRestart:z,get onGiveUp(){return get$2(ke)},get showGiveUp(){return t()},onShowRules:ge})}var X=sibling(W,2),le=child(X);each(le,21,()=>get$2(w),index$1,(ke,Me,E)=>{var d=comment(),p=first_child(d);each(p,17,()=>get$2(Me),index$1,(A,L,ee)=>{var pe=root_3$u();let Ce;var Oe=child(pe);template_effect(Te=>{Ce=set_class(pe,1,"cell svelte-m54bkq",null,Ce,Te),set_text(Oe,get$2(L))},[()=>({selected:get$2(B)?.r===E&&get$2(B)?.c===ee,matched:get$2(k)[E][ee],shuffling:get$2(I)[`${E},${ee}`],"hint-glow":get$2(O).some(Te=>Te.r===E&&Te.c===ee)})]),delegated("click",pe,()=>V(E,ee)),delegated("keydown",pe,Te=>oe(E,ee,Te)),append(A,pe)}),append(ke,d)}),bind_this(le,ke=>N=ke,()=>N);var Ee=sibling(le,2),Q=child(Ee);key(Q,()=>get$2(M),ke=>{var Me=comment(),E=first_child(Me);{var d=p=>{var A=root_5$n();template_effect(()=>set_attribute(A,"points",get$2(Y))),append(p,A)};if_block(E,p=>{get$2(Y)&&p(d)})}append(ke,Me)}),bind_this(X,ke=>D=ke,()=>D);var ye=sibling(X,2);GameFooter(ye,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ke,Me)=>{var E=root_6$h(),d=child(E),p=child(d);let A;var L=sibling(p,2);let ee;var pe=sibling(L,2);let Ce;var Oe=sibling(d,2),Te=sibling(child(Oe)),Le=child(Te),Fe=sibling(Oe,2);let He;var Ue=sibling(child(Fe));{var Xe=st=>{var tt=root_7$e(),We=child(tt);template_effect(()=>set_text(We,`(${get$2(T)??""})`)),append(st,tt)};if_block(Ue,st=>{get$2(T)>0&&st(Xe)})}template_effect(()=>{A=set_class(p,1,"size-btn svelte-m54bkq",null,A,{active:get$2(f)==="auto"}),ee=set_class(L,1,"size-btn svelte-m54bkq",null,ee,{active:get$2(f)==="16x9"}),Ce=set_class(pe,1,"size-btn svelte-m54bkq",null,Ce,{active:get$2(f)==="16x16"}),set_text(Le,get$2(ie)),He=set_class(Fe,1,"btn btn-secondary svelte-m54bkq",null,He,{disabled:!get$2(K),"cooldown-active":get$2(T)>0}),Fe.disabled=!get$2(K)}),delegated("click",p,()=>me("auto")),delegated("click",L,()=>me("16x9")),delegated("click",pe,()=>me("16x16")),delegated("click",Fe,j),append(ke,E)},$$slots:{default:!0}});var be=sibling(ye,2);MinigameModal(be,{get modal(){return get$2(x)}}),template_effect(()=>set_style(le,`grid-template-columns: repeat(${get$2(y)??""}, 1fr); grid-template-rows: repeat(${get$2(m)??""}, 1fr);`)),append(ae,F)}}),pop()}delegate(["click","keydown"]);var root_3$t=from_html("<div> </div>"),root_4$p=from_html('<div class="footer-stats svelte-1vj6qxh"><span class="score-counter svelte-1vj6qxh">: <strong class="svelte-1vj6qxh"> </strong></span></div>'),root_1$s=from_html('<!> <div id="game-container" class="svelte-1vj6qxh"><div id="grid" class="svelte-1vj6qxh"></div></div> <!> <!>',1);function Evolution2048(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=4,c=2048,f=1e3,v={2:"",4:"",8:"",16:"",32:"",64:"",128:"",256:"",512:"",1024:"",2048:""},h={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=state(proxy([])),y=state(0),g=state(!1),w=state(!1),k=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>(I(),window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)));function I(){set(m,Array(o).fill(null).map(()=>Array(o).fill(0)),!0),set(y,0),set(g,!1),set(w,!1),V(),O(),O()}function O(){let U=[];for(let j=0;j<o;j++)for(let ne=0;ne<o;ne++)get$2(m)[j][ne]===0&&U.push({r:j,c:ne});if(U.length>0){const{r:j,c:ne}=U[Math.floor(Math.random()*U.length)];get$2(m)[j][ne]=Math.random()<.9?2:4}}function B(U){if(get$2(g))return;let j=!1;switch(U.key){case"ArrowUp":j=M();break;case"ArrowDown":j=T();break;case"ArrowLeft":j=G();break;case"ArrowRight":j=Y();break}j&&(U.preventDefault(),O(),ie())}function P(U){let j=U.filter(te=>te!==0),ne=!1;for(let te=0;te<j.length-1;te++)j[te]===j[te+1]&&(j[te]*=2,set(y,get$2(y)+j[te]),j.splice(te+1,1),ne=!0);for(;j.length<o;)j.push(0);return{newRow:j,moved:ne||U.join(",")!==j.join(",")}}function G(){let U=!1;for(let j=0;j<o;j++){const{newRow:ne,moved:te}=P(get$2(m)[j]);get$2(m)[j]=ne,te&&(U=!0)}return U}function Y(){let U=!1;for(let j=0;j<o;j++){const{newRow:ne,moved:te}=P([...get$2(m)[j]].reverse());get$2(m)[j]=ne.reverse(),te&&(U=!0)}return U}function M(){let U=!1;for(let j=0;j<o;j++){let ne=[];for(let ce=0;ce<o;ce++)ne.push(get$2(m)[ce][j]);const{newRow:te,moved:fe}=P(ne);for(let ce=0;ce<o;ce++)get$2(m)[ce][j]=te[ce];fe&&(U=!0)}return U}function T(){let U=!1;for(let j=0;j<o;j++){let ne=[];for(let ce=0;ce<o;ce++)ne.push(get$2(m)[ce][j]);const{newRow:te,moved:fe}=P(ne.reverse());ne=te.reverse();for(let ce=0;ce<o;ce++)get$2(m)[ce][j]=ne[ce];fe&&(U=!0)}return U}let x=state(0),D=state(0);function N(U){set(x,U.touches[0].clientX,!0),set(D,U.touches[0].clientY,!0)}function q(U){if(get$2(g))return;const j=U.changedTouches[0].clientX,ne=U.changedTouches[0].clientY,te=j-get$2(x),fe=ne-get$2(D);if(Math.abs(te)<30&&Math.abs(fe)<30)return;let ce=!1;Math.abs(te)>Math.abs(fe)?ce=te>0?Y():G():ce=fe>0?T():M(),ce&&(U.preventDefault(),O(),ie())}function ie(){if(!get$2(w)){for(let U=0;U<o;U++)for(let j=0;j<o;j++)if(get$2(m)[U][j]>=c){set(w,!0),t()?(z(" !","   !",[]),setTimeout(()=>{V(),e.onWin?.()},f)):z(" !","   !",[{text:"",action:V},{text:" ",action:I,class:"btn-secondary"}]);return}}K()&&!se()&&(set(g,!0),t()?(z(" ",` . : ${get$2(y)}`,[]),setTimeout(()=>{V(),e.onLose?.()},f)):z(" ",` . : ${get$2(y)}`,[{text:" ",action:I}]))}function K(){for(let U=0;U<o;U++)for(let j=0;j<o;j++)if(get$2(m)[U][j]===0)return!1;return!0}function se(){for(let U=0;U<o;U++)for(let j=0;j<o;j++)if(j<o-1&&get$2(m)[U][j]===get$2(m)[U][j+1]||U<o-1&&get$2(m)[U][j]===get$2(m)[U+1][j])return!0;return!1}function me(){t()?(z(" "," ...",[]),setTimeout(()=>{V(),e.onLose?.()},f)):z("","  !",[{text:" ",action:I}])}function z(U,j,ne){set(k,{show:!0,title:U,text:j,actions:ne},!0)}function V(){get$2(k).show=!1}function oe(){z(" ",` 2048:

 :    2048 ().

         .

     :


      .

 ,   !`,[{text:"",action:V}])}BodyWrapper(r,{children:(U,j)=>{var ne=root_1$s(),te=first_child(ne);{let he=user_derived(()=>t()?me:void 0);GameHeader(te,{onRestart:I,get onGiveUp(){return get$2(he)},get showGiveUp(){return t()},onShowRules:oe})}var fe=sibling(te,2),ce=child(fe);each(ce,21,()=>get$2(m),index$1,(he,ue)=>{var Z=comment(),ge=first_child(Z);each(ge,17,()=>get$2(ue),index$1,(Se,ae)=>{var H=root_3$t();set_class(H,1,"cell svelte-1vj6qxh",null,{},{"cell-{cell}":ae-{}});var F=child(H);template_effect(()=>{set_style(H,`background-color: ${(h[get$2(ae)]||"#2a2a40")??""};`),set_text(F,get$2(ae)>0?v[get$2(ae)]||get$2(ae):"")}),append(Se,H)}),append(he,Z)});var we=sibling(fe,2);GameFooter(we,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(he,ue)=>{var Z=root_4$p(),ge=child(Z),Se=sibling(child(ge)),ae=child(Se);template_effect(()=>set_text(ae,get$2(y))),append(he,Z)},$$slots:{default:!0}});var $e=sibling(we,2);MinigameModal($e,{get modal(){return get$2(k)}}),delegated("touchstart",fe,N),delegated("touchend",fe,q),append(U,ne)}}),pop()}delegate(["touchstart","touchend"]);var root_3$s=from_html('<button type="button" class="option-btn svelte-1eto707"> </button>'),root_2$o=from_html('<div> </div> <div class="score svelte-1eto707">: <strong class="svelte-1eto707"> </strong></div> <div class="question svelte-1eto707"> </div> <div class="options svelte-1eto707"></div>',1),root_4$o=from_html('<div class="start-screen svelte-1eto707"><div class="title svelte-1eto707">  </div> <div class="description svelte-1eto707"></div> <button type="button" class="start-btn svelte-1eto707"> </button></div>'),root_5$m=from_html('<div class="footer-stats svelte-1eto707"><span class="score-display svelte-1eto707">: <strong class="svelte-1eto707"> </strong></span> <span class="time-display svelte-1eto707">: <strong class="svelte-1eto707"> </strong></span></div>'),root_1$r=from_html('<!> <div id="game-container" class="svelte-1eto707"><!></div> <!> <!>',1);function WhisperOfSpiders($$anchor,$$props){push($$props,!0);let integrated=prop($$props,"integrated",3,!1),rewardItem=prop($$props,"rewardItem",3,null),items=prop($$props,"items",19,()=>[]),bucketName=prop($$props,"bucketName",3,"dracula"),question=state(""),correctAnswer=state(0),options=state(proxy([])),score=state(0),timeLeft=state(30),gameActive=state(!1),timerInterval=null;const TIMEOUT=1e3,WIN_SCORE=10;let modal=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>()=>{timerInterval&&clearInterval(timerInterval)});function generateQuestion(){const a=Math.floor(Math.random()*10)+1,b=Math.floor(Math.random()*10)+1,operations=["+","-","*"],op=operations[Math.floor(Math.random()*operations.length)];set(question,`${a} ${op} ${b}`),set(correctAnswer,eval(get$2(question)),!0);let newOptions=[get$2(correctAnswer)];for(;newOptions.length<4;){let r=get$2(correctAnswer)+(Math.floor(Math.random()*7)-3);!newOptions.includes(r)&&r>0&&newOptions.push(r)}set(options,newOptions.sort(()=>Math.random()-.5),!0)}function initGame(){timerInterval&&clearInterval(timerInterval),set(gameActive,!1),set(score,0),set(timeLeft,30),hideModal()}function startGame(){set(gameActive,!0),set(score,0),set(timeLeft,30),generateQuestion(),timerInterval=setInterval(()=>{update(timeLeft,-1),get$2(timeLeft)<=0&&endGame()},1e3)}function endGame(){set(gameActive,!1),timerInterval&&(clearInterval(timerInterval),timerInterval=null),get$2(score)>=WIN_SCORE?integrated()?(showModal(" !",`  ${get$2(score)} !`,[]),setTimeout(()=>{hideModal(),$$props.onWin?.()},TIMEOUT)):showModal(" !",`  ${get$2(score)} !`,[{text:" ",action:initGame}]):integrated()?(showModal("  !",`  ${get$2(score)} .  ${WIN_SCORE}.`,[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("  !",`  ${get$2(score)} .  ${WIN_SCORE}.`,[{text:" ",action:initGame}])}function handleAnswer(r){get$2(gameActive)&&(r===get$2(correctAnswer)?(update(score),get$2(score)>=WIN_SCORE?endGame():generateQuestion()):set(timeLeft,Math.max(0,get$2(timeLeft)-2),!0))}function handleGiveUp(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),set(gameActive,!1),integrated()?(showModal(" "," ...",[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("","  !",[{text:" ",action:initGame}])}function showModal(r,e,t){set(modal,{show:!0,title:r,text:e,actions:t},!0)}function hideModal(){get$2(modal).show=!1}function showRules(){showModal(" ",` :

 :  ${WIN_SCORE}   30 .

   ,     4 .

     -2 .`,[{text:"",action:hideModal}])}BodyWrapper($$anchor,{children:(r,e)=>{var t=root_1$r(),n=first_child(t);{let h=user_derived(()=>integrated()?handleGiveUp:void 0);GameHeader(n,{onRestart:initGame,get onGiveUp(){return get$2(h)},get showGiveUp(){return integrated()},onShowRules:showRules})}var i=sibling(n,2),s=child(i);{var o=h=>{var m=root_2$o(),y=first_child(m);let g;var w=child(y),k=sibling(y,2),I=sibling(child(k)),O=child(I),B=sibling(k,2),P=child(B),G=sibling(B,2);each(G,21,()=>get$2(options),index$1,(Y,M)=>{var T=root_3$s(),x=child(T);template_effect(()=>set_text(x,get$2(M))),delegated("click",T,()=>handleAnswer(get$2(M))),append(Y,T)}),template_effect(()=>{g=set_class(y,1,"timer svelte-1eto707",null,g,{warning:get$2(timeLeft)<=10}),set_text(w,` ${get$2(timeLeft)??""}s`),set_text(O,`${get$2(score)??""}/10`),set_text(P,`${get$2(question)??""} = ?`)}),append(h,m)},c=h=>{var m=root_4$o(),y=sibling(child(m),2);y.textContent=" 10   30 ";var g=sibling(y,2);delegated("click",g,startGame),append(h,m)};if_block(s,h=>{get$2(gameActive)?h(o):h(c,!1)})}var f=sibling(i,2);GameFooter(f,{get rewardItem(){return rewardItem()},get items(){return items()},get bucketName(){return bucketName()},children:(h,m)=>{var y=root_5$m(),g=child(y),w=sibling(child(g)),k=child(w),I=sibling(g,2),O=sibling(child(I)),B=child(O);template_effect(()=>{set_text(k,get$2(score)),set_text(B,`${get$2(timeLeft)??""}s`)}),append(h,y)},$$slots:{default:!0}});var v=sibling(f,2);MinigameModal(v,{get modal(){return get$2(modal)}}),append(r,t)}}),pop()}delegate(["click"]);var root_2$n=from_html('<div class="card back svelte-2q1m10"></div>'),root_3$r=from_html('<div class="card empty svelte-2q1m10"></div>'),root_4$n=from_html('<div><span class="rank svelte-2q1m10"> </span> <span class="suit svelte-2q1m10"> </span></div>'),root_6$g=from_html('<div class="card front svelte-2q1m10"><span class="rank svelte-2q1m10"> </span> <span class="suit svelte-2q1m10"> </span></div>'),root_7$d=from_html('<div class="card empty svelte-2q1m10"></div>'),root_5$l=from_html('<button type="button" class="pile foundation svelte-2q1m10"><!></button>'),root_10$6=from_html('<span class="rank svelte-2q1m10"> </span> <span class="suit svelte-2q1m10"> </span>',1),root_9$5=from_html('<button type="button"><!></button>'),root_8$8=from_html('<div class="tableau svelte-2q1m10" role="button" tabindex="0"></div>'),root_11$3=from_html('<div class="footer-stats svelte-2q1m10"><span class="moves-counter svelte-2q1m10">: <strong class="svelte-2q1m10"> </strong></span></div>'),root_1$q=from_html('<!> <div id="game-container" class="svelte-2q1m10"><div class="top-row svelte-2q1m10"><button type="button" class="pile stock svelte-2q1m10" aria-label=""><!></button> <button type="button" class="pile waste svelte-2q1m10" aria-label=""><!></button> <div class="foundations svelte-2q1m10"></div></div> <div class="tableaus svelte-2q1m10"></div></div> <!> <!>',1);function TowerOfSouls(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=["hearts","diamonds","clubs","spades"],c={hearts:"",diamonds:"",clubs:"",spades:""},f=[1,2,3,4,5,6,7,8,9,10,11,12,13],v={1:"A",11:"J",12:"Q",13:"K"};let h=state(proxy([])),m=state(proxy([])),y=state(proxy([[],[],[],[]])),g=state(proxy([[],[],[],[],[],[],[]])),w=state(null),k=state(!1),I=state(0),O=state(proxy({show:!1,title:"",text:"",actions:[]}));const B=1e3;onMount(()=>G());let P=user_derived(()=>get$2(y).every(V=>V.length===13));function G(){let V=[];for(const U of o)for(const j of f)V.push({suit:U,rank:j,faceUp:!1});V=V.sort(()=>Math.random()-.5),set(h,[],!0),set(m,[],!0),set(y,[[],[],[],[]],!0),set(g,[[],[],[],[],[],[],[]],!0);let oe=0;for(let U=0;U<7;U++)for(let j=U;j<7;j++){const ne=V[oe++];ne.faceUp=U===j,get$2(g)[j].push(ne)}for(;oe<V.length;)get$2(h).push(V[oe++]);set(w,null),set(I,0),set(k,!1),K()}function Y(){if(get$2(h).length>0){const V=get$2(h).pop();V.faceUp=!0,get$2(m).push(V)}else get$2(m).length>0&&(set(h,get$2(m).reverse().map(V=>({...V,faceUp:!1})),!0),set(m,[],!0));update(I)}function M(){get$2(m).length!==0&&set(w,{pile:-2,index:get$2(m).length-1},!0)}function T(V,oe){const U=get$2(g)[V];if(get$2(w)){const{pile:j,index:ne}=get$2(w);let te;j===-2?te=[get$2(m)[ne]]:te=get$2(g)[j].slice(ne);const fe=te[0];if(U.length===0){if(fe.rank===13){D(j,ne,V,-1),set(w,null);return}}else{const ce=U[U.length-1];if((fe.suit==="hearts"||fe.suit==="diamonds")!=(ce.suit==="hearts"||ce.suit==="diamonds")&&fe.rank===ce.rank-1){D(j,ne,V,-1),set(w,null);return}}if(te.length===1)for(let ce=0;ce<4;ce++){const we=get$2(y)[ce];if(we.length===0){if(fe.rank===1){D(j,ne,-1,ce),set(w,null);return}}else{const $e=we[we.length-1];if(fe.suit===$e.suit&&fe.rank===$e.rank+1){D(j,ne,-1,ce),set(w,null);return}}}set(w,null)}else oe>=0&&U[oe]?.faceUp&&set(w,{pile:V,index:oe},!0)}function x(V){if(!get$2(w))return;const{pile:oe,index:U}=get$2(w);let j;oe===-2?j=get$2(m)[U]:j=get$2(g)[oe][U];const ne=get$2(y)[V];if(ne.length===0)j.rank===1&&oe>=-1&&(oe===-2?[get$2(m)[U]]:get$2(g)[oe].slice(U)).length===1&&D(oe,U,-1,V);else{const te=ne[ne.length-1];j.suit===te.suit&&j.rank===te.rank+1&&(oe===-2?[get$2(m)[U]]:get$2(g)[oe].slice(U)).length===1&&D(oe,U,-1,V)}set(w,null)}function D(V,oe,U,j){let ne;V===-2?ne=[get$2(m).pop()]:(ne=get$2(g)[V].splice(oe),get$2(g)[V].length>0&&(get$2(g)[V][get$2(g)[V].length-1].faceUp=!0)),U>=0?get$2(g)[U].push(...ne):j>=0&&get$2(y)[j].push(...ne),update(I),N()}function N(){get$2(P)&&(set(k,!0),t()?(ie(" !",`     ${get$2(I)} !`,[]),setTimeout(()=>{K(),e.onWin?.()},B)):ie(" !",`     ${get$2(I)} !`,[{text:" ",action:G}]))}function q(){t()?(ie(" "," ...",[]),setTimeout(()=>{K(),e.onLose?.()},B)):ie("","  !",[{text:" ",action:G}])}function ie(V,oe,U){set(O,{show:!0,title:V,text:oe,actions:U},!0)}function K(){get$2(O).show=!1}function se(){ie(" ",` ( ):

 :      ()      .

    ()   .

           (  ).

             .

      .

   4     !`,[{text:"",action:K}])}function me(V){return v[V]||V.toString()}function z(V){return V==="hearts"||V==="diamonds"?"#e94560":"#ececec"}BodyWrapper(r,{children:(V,oe)=>{var U=root_1$q(),j=first_child(U);{let F=user_derived(()=>t()?q:void 0);GameHeader(j,{onRestart:G,get onGiveUp(){return get$2(F)},get showGiveUp(){return t()},onShowRules:se})}var ne=sibling(j,2),te=child(ne),fe=child(te),ce=child(fe);{var we=F=>{var W=root_2$n();append(F,W)},$e=F=>{var W=root_3$r();append(F,W)};if_block(ce,F=>{get$2(h).length>0?F(we):F($e,!1)})}var he=sibling(fe,2),ue=child(he);{var Z=F=>{var W=root_4$n();let X;var le=child(W),Ee=child(le),Q=sibling(le,2),ye=child(Q);template_effect((be,ke)=>{X=set_class(W,1,"card front svelte-2q1m10",null,X,{selected:get$2(w)?.pile===-2}),set_text(Ee,be),set_style(Q,`color: ${ke??""}`),set_text(ye,c[get$2(m)[get$2(m).length-1].suit])},[()=>me(get$2(m)[get$2(m).length-1].rank),()=>z(get$2(m)[get$2(m).length-1].suit)]),append(F,W)};if_block(ue,F=>{get$2(m).length>0&&F(Z)})}var ge=sibling(he,2);each(ge,21,()=>get$2(y),index$1,(F,W,X)=>{var le=root_5$l();set_attribute(le,"aria-label",` ${X+1}`);var Ee=child(le);{var Q=be=>{var ke=root_6$g(),Me=child(ke),E=child(Me),d=sibling(Me,2),p=child(d);template_effect((A,L)=>{set_text(E,A),set_style(d,`color: ${L??""}`),set_text(p,c[get$2(W)[get$2(W).length-1].suit])},[()=>me(get$2(W)[get$2(W).length-1].rank),()=>z(get$2(W)[get$2(W).length-1].suit)]),append(be,ke)},ye=be=>{var ke=root_7$d();append(be,ke)};if_block(Ee,be=>{get$2(W).length>0?be(Q):be(ye,!1)})}delegated("click",le,()=>x(X)),append(F,le)});var Se=sibling(te,2);each(Se,21,()=>get$2(g),index$1,(F,W,X)=>{var le=root_8$8();set_attribute(le,"aria-label",` ${X+1}`),each(le,21,()=>get$2(W),index$1,(Ee,Q,ye)=>{var be=root_9$5();let ke;set_style(be,`margin-top: ${ye>0?"-80%":"0"}; z-index: ${ye};`);var Me=child(be);{var E=d=>{var p=root_10$6(),A=first_child(p),L=child(A),ee=sibling(A,2),pe=child(ee);template_effect((Ce,Oe)=>{set_text(L,Ce),set_style(ee,`color: ${Oe??""}`),set_text(pe,c[get$2(Q).suit])},[()=>me(get$2(Q).rank),()=>z(get$2(Q).suit)]),append(d,p)};if_block(Me,d=>{get$2(Q).faceUp&&d(E)})}template_effect(d=>{ke=set_class(be,1,"card svelte-2q1m10",null,ke,{front:get$2(Q).faceUp,back:!get$2(Q).faceUp,selected:get$2(w)?.pile===X&&get$2(w)?.index===ye}),set_attribute(be,"aria-label",d)},[()=>get$2(Q).faceUp?`${me(get$2(Q).rank)} ${c[get$2(Q).suit]}`:"  "]),delegated("click",be,d=>{d.stopPropagation(),T(X,ye)}),append(Ee,be)}),delegated("click",le,()=>T(X,-1)),delegated("keydown",le,Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),T(X,-1))}),append(F,le)});var ae=sibling(ne,2);GameFooter(ae,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(F,W)=>{var X=root_11$3(),le=child(X),Ee=sibling(child(le)),Q=child(Ee);template_effect(()=>set_text(Q,get$2(I))),append(F,X)},$$slots:{default:!0}});var H=sibling(ae,2);MinigameModal(H,{get modal(){return get$2(O)}}),delegated("click",fe,Y),delegated("click",he,M),append(V,U)}}),pop()}delegate(["click","keydown"]);var root_2$m=from_html('<span class="watching svelte-1m2v375"> ...</span>'),root_3$q=from_html('<span class="playing svelte-1m2v375"> !</span>'),root_4$m=from_html("<span> </span>"),root_5$k=from_html('<button type="button" class="symbol svelte-1m2v375"> </button>'),root_6$f=from_html('<div class="footer-stats svelte-1m2v375"><span class="round-display svelte-1m2v375">: <strong class="svelte-1m2v375"> </strong></span></div>'),root_1$p=from_html('<!> <div id="game-container" class="svelte-1m2v375"><div class="status svelte-1m2v375"><!></div> <div class="round-info svelte-1m2v375">: <strong class="svelte-1m2v375"> </strong></div> <div class="symbols svelte-1m2v375"></div></div> <!> <!>',1);function SoulCycle(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=["","","",""],c=["#e94560","#0984e3","#fdcb6e","#6c5ce7"],f=1e3,v=5;let h=state(proxy([])),m=state(proxy([])),y=state(0),g=state(!1),w=state(-1),k=state(!1),I=state(!1),O=state(!1),B=state(proxy({show:!1,title:"",text:"",actions:[]}));function P(){set(g,!0),set(O,!1),set(m,[],!0);const K=o[Math.floor(Math.random()*o.length)];set(h,[...get$2(h),K],!0),G()}async function G(){await new Promise(K=>setTimeout(K,500));for(let K=0;K<get$2(h).length;K++)set(w,o.indexOf(get$2(h)[K]),!0),await new Promise(se=>setTimeout(se,500)),set(w,-1),await new Promise(se=>setTimeout(se,200));set(g,!1),set(O,!0)}function Y(K){if(get$2(g)||!get$2(O)||get$2(k))return;const se=o[K],me=get$2(h)[get$2(m).length];if(se!==me){T();return}set(m,[...get$2(m),se],!0),get$2(m).length===get$2(h).length&&(update(y),get$2(y)>=v?M():(set(O,!1),setTimeout(P,1e3)))}function M(){set(k,!0),set(I,!0),t()?(N(" !",`  ${v} !`,[]),setTimeout(()=>{q(),e.onWin?.()},f)):N(" !",`  ${v} !`,[{text:" ",action:x}])}function T(){set(k,!0),set(I,!1),t()?(N(" !","   !",[]),setTimeout(()=>{q(),e.onLose?.()},f)):N(" !","   !",[{text:" ",action:x}])}function x(){set(h,[],!0),set(m,[],!0),set(y,0),set(k,!1),set(I,!1),set(g,!1),set(O,!1),set(w,-1),q(),P()}function D(){set(k,!0),t()?(N(" "," ...",[]),setTimeout(()=>{q(),e.onLose?.()},f)):N("","  !",[{text:" ",action:x}])}function N(K,se,me){set(B,{show:!0,title:K,text:se,actions:me},!0)}function q(){get$2(B).show=!1}function ie(){N(" ",` :

 :  ${v} .

    .

      .

      !`,[{text:"",action:q}])}onMount(()=>{x()}),BodyWrapper(r,{children:(K,se)=>{var me=root_1$p(),z=first_child(me);{let Z=user_derived(()=>t()?D:void 0);GameHeader(z,{onRestart:x,get onGiveUp(){return get$2(Z)},get showGiveUp(){return t()},onShowRules:ie})}var V=sibling(z,2),oe=child(V),U=child(oe);{var j=Z=>{var ge=root_2$m();append(Z,ge)},ne=Z=>{var ge=root_3$q();append(Z,ge)},te=Z=>{var ge=root_4$m();let Se;var ae=child(ge);template_effect(()=>{Se=set_class(ge,1,"svelte-1m2v375",null,Se,{won:get$2(I),lost:!get$2(I)}),set_text(ae,get$2(I)?" !":" ")}),append(Z,ge)};if_block(U,Z=>{get$2(g)?Z(j):get$2(O)?Z(ne,1):get$2(k)&&Z(te,2)})}var fe=sibling(oe,2),ce=sibling(child(fe)),we=child(ce),$e=sibling(fe,2);each($e,21,()=>o,index$1,(Z,ge,Se)=>{var ae=root_5$k(),H=child(ae);template_effect(()=>{set_style(ae,`background-color: ${c[Se]??""}; filter: ${get$2(w)===Se?"brightness(1.5)":"none"}; transform: ${get$2(w)===Se?"scale(1.1)":"scale(1)"};`),ae.disabled=get$2(g)||!get$2(O)||get$2(k),set_text(H,get$2(ge))}),delegated("click",ae,()=>Y(Se)),append(Z,ae)});var he=sibling(V,2);GameFooter(he,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(Z,ge)=>{var Se=root_6$f(),ae=child(Se),H=sibling(child(ae)),F=child(H);template_effect(()=>set_text(F,get$2(y))),append(Z,Se)},$$slots:{default:!0}});var ue=sibling(he,2);MinigameModal(ue,{get modal(){return get$2(B)}}),template_effect(()=>set_text(we,`${get$2(y)??""}/5`)),append(K,me)}}),pop()}delegate(["click"]);var root_2$l=from_html('<div class="start-screen svelte-fdk3w1"><div class="title svelte-fdk3w1">  </div> <div class="description svelte-fdk3w1">   </div> <button type="button" class="start-btn svelte-fdk3w1"> </button></div>'),root_5$j=from_html("<span><!></span>"),root_4$l=from_html('<div class="row svelte-fdk3w1"></div>'),root_3$p=from_html('<div class="maze-container svelte-fdk3w1"><div class="maze svelte-fdk3w1"></div> <div class="controls svelte-fdk3w1"><button type="button" class="control-btn svelte-fdk3w1"></button> <div class="controls-row svelte-fdk3w1"><button type="button" class="control-btn svelte-fdk3w1"></button> <button type="button" class="control-btn svelte-fdk3w1"></button></div> <button type="button" class="control-btn svelte-fdk3w1"></button></div></div>'),root_8$7=from_html('<div class="footer-stats svelte-fdk3w1"><span class="status-text svelte-fdk3w1"> </span></div>'),root_1$o=from_html('<!> <div id="game-container" class="svelte-fdk3w1"><!></div> <!> <!>',1);function LabyrinthOfMinotaur(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o="",c="",f="",v=1e3,h=7;let m=state(proxy([])),y=state(proxy({x:1,y:1})),g=state(proxy({x:5,y:5})),w=state(!1),k=state(!1),I=state(proxy({show:!1,title:"",text:"",actions:[]}));function O(q=h){const ie=Array(q).fill(null).map(()=>Array(q).fill(o)),K=(se,me)=>{const z=[[0,1],[1,0],[0,-1],[-1,0]].sort(()=>Math.random()-.5);for(let[V,oe]of z){const U=se+V*2,j=me+oe*2;U>0&&U<q-1&&j>0&&j<q-1&&ie[j][U]===o&&(ie[me+oe][se+V]=f,ie[j][U]=f,K(U,j))}};return ie[1][1]=f,K(1,1),ie[get$2(g).y][get$2(g).x]=c,ie}function B(){set(y,{x:1,y:1},!0),set(g,{x:h-2,y:h-2},!0),set(m,O(h),!0),set(w,!1),set(k,!1),x()}function P(){set(k,!0),B()}function G(q,ie){if(get$2(w)||!get$2(k))return;const K=get$2(y).x+q,se=get$2(y).y+ie;(get$2(m)[se]?.[K]===f||get$2(m)[se]?.[K]===c)&&set(y,{x:K,y:se},!0),get$2(y).x===get$2(g).x&&get$2(y).y===get$2(g).y&&Y()}function Y(){set(w,!0),t()?(T(" !","    !",[]),setTimeout(()=>{x(),e.onWin?.()},v)):T(" !","    !",[{text:" ",action:B}])}function M(){get$2(k)&&(set(w,!0),t()?(T(" "," ...",[]),setTimeout(()=>{x(),e.onLose?.()},v)):T("","  !",[{text:" ",action:B}]))}function T(q,ie,K){set(I,{show:!0,title:q,text:ie,actions:K},!0)}function x(){get$2(I).show=!1}function D(){T(" ",` :

 :    .

     .

   ,  .

  !`,[{text:"",action:x}])}function N(q){if(!(!get$2(k)||get$2(w)))switch(q.key){case"ArrowUp":case"w":G(0,-1);break;case"ArrowDown":case"s":G(0,1);break;case"ArrowLeft":case"a":G(-1,0);break;case"ArrowRight":case"d":G(1,0);break}}onMount(()=>(B(),window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N))),BodyWrapper(r,{children:(q,ie)=>{var K=root_1$o(),se=first_child(K);{let ne=user_derived(()=>t()?M:void 0),te=user_derived(()=>t()&&get$2(k));GameHeader(se,{onRestart:B,get onGiveUp(){return get$2(ne)},get showGiveUp(){return get$2(te)},onShowRules:D})}var me=sibling(se,2),z=child(me);{var V=ne=>{var te=root_2$l(),fe=sibling(child(te),4);delegated("click",fe,P),append(ne,te)},oe=ne=>{var te=root_3$p(),fe=child(te);each(fe,21,()=>get$2(m),index$1,(ge,Se,ae)=>{var H=root_4$l();each(H,21,()=>get$2(Se),index$1,(F,W,X)=>{var le=root_5$j();let Ee;var Q=child(le);{var ye=ke=>{var Me=text();Me.nodeValue="",append(ke,Me)},be=ke=>{var Me=text();template_effect(()=>set_text(Me,get$2(W))),append(ke,Me)};if_block(Q,ke=>{get$2(y).x===X&&get$2(y).y===ae?ke(ye):ke(be,!1)})}template_effect(()=>Ee=set_class(le,1,"cell svelte-fdk3w1",null,Ee,{wall:get$2(W)===o,exit:get$2(W)===c})),append(F,le)}),append(ge,H)});var ce=sibling(fe,2),we=child(ce),$e=sibling(we,2),he=child($e),ue=sibling(he,2),Z=sibling($e,2);delegated("click",we,()=>G(0,-1)),delegated("click",he,()=>G(-1,0)),delegated("click",ue,()=>G(1,0)),delegated("click",Z,()=>G(0,1)),append(ne,te)};if_block(z,ne=>{get$2(k)?ne(oe,!1):ne(V)})}var U=sibling(me,2);GameFooter(U,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ne,te)=>{var fe=root_8$7(),ce=child(fe),we=child(ce);template_effect(()=>set_text(we,get$2(w)?" !":get$2(k)?"...":"")),append(ne,fe)},$$slots:{default:!0}});var j=sibling(U,2);MinigameModal(j,{get modal(){return get$2(I)}}),append(q,K)}}),pop()}delegate(["click"]);var root_2$k=from_html('<button type="button"><span class="cell-content svelte-90wygv"> </span></button>'),root_3$o=from_html('<div class="footer-stats svelte-90wygv"><span class="mines-counter svelte-90wygv"></span> <span class="flag-counter svelte-90wygv"> </span></div>'),root_1$n=from_html('<!> <div id="game-container" class="svelte-90wygv"><div id="grid" class="svelte-90wygv"></div></div> <!> <!>',1);function CursedCrypts(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=8,c=8,f=10,v=1e3;let h=state(proxy([])),m=state(!1),y=state(!1),g=state(!0),w=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>B());let k=user_derived(()=>get$2(h).filter(z=>z.revealed).length),I=o*c,O=user_derived(()=>get$2(y)||get$2(k)===I-f);function B(){set(h,Array(I).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),set(m,!1),set(y,!1),set(g,!0),ie()}function P(z){let V=0;for(;V<f;){const oe=Math.floor(Math.random()*I);oe!==z&&!get$2(h)[oe].isMine&&(get$2(h)[oe].isMine=!0,V++)}for(let oe=0;oe<I;oe++)get$2(h)[oe].isMine||(get$2(h)[oe].adjacentMines=G(oe))}function G(z){const V=Math.floor(z/c),oe=z%c;let U=0;for(let j=-1;j<=1;j++)for(let ne=-1;ne<=1;ne++){if(j===0&&ne===0)continue;const te=V+j,fe=oe+ne;if(te>=0&&te<o&&fe>=0&&fe<c){const ce=te*c+fe;get$2(h)[ce].isMine&&U++}}return U}function Y(z){if(!(get$2(m)||get$2(h)[z].revealed||get$2(h)[z].flagged)){if(get$2(g)&&(P(z),set(g,!1)),get$2(h)[z].isMine){x(),set(m,!0),set(y,!1),t()?(q(" !","    !",[]),setTimeout(()=>{ie(),e.onLose?.()},v)):q(" !","    !",[{text:" ",action:B}]);return}T(z),D()}}function M(z,V){V.preventDefault(),!(get$2(m)||get$2(h)[z].revealed)&&(get$2(h)[z].flagged=!get$2(h)[z].flagged)}function T(z){if(!(z<0||z>=I)&&!(get$2(h)[z].revealed||get$2(h)[z].flagged)&&(get$2(h)[z].revealed=!0,get$2(h)[z].adjacentMines===0&&!get$2(h)[z].isMine)){const V=Math.floor(z/c),oe=z%c;for(let U=-1;U<=1;U++)for(let j=-1;j<=1;j++){if(U===0&&j===0)continue;const ne=V+U,te=oe+j;ne>=0&&ne<o&&te>=0&&te<c&&T(ne*c+te)}}}function x(){for(let z=0;z<I;z++)get$2(h)[z].isMine&&(get$2(h)[z].revealed=!0)}function D(){get$2(O)&&(set(y,!0),set(m,!0),t()?(q(" !","    !",[]),setTimeout(()=>{ie(),e.onWin?.()},v)):q(" !","    !",[{text:" ",action:B}]))}function N(){t()?(q(" "," ...",[]),setTimeout(()=>{ie(),e.onLose?.()},v)):q("","  !",[{text:" ",action:B}])}function q(z,V,oe){set(w,{show:!0,title:z,text:V,actions:oe},!0)}function ie(){get$2(w).show=!1}function K(z){return z.revealed?z.isMine?"":z.adjacentMines===0?"":z.adjacentMines.toString():z.flagged?"":""}function se(z){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][z]||"#ececec"}function me(){q(" ",` ( ):

 :   ,   .

  ,      ( 1  8).

     ( ).

          .

      .`,[{text:"",action:ie}])}BodyWrapper(r,{children:(z,V)=>{var oe=root_1$n(),U=first_child(oe);{let ce=user_derived(()=>t()?N:void 0);GameHeader(U,{onRestart:B,get onGiveUp(){return get$2(ce)},get showGiveUp(){return t()},onShowRules:me})}var j=sibling(U,2),ne=child(j);set_style(ne,"grid-template-columns: repeat(8, 1fr);"),each(ne,21,()=>get$2(h),index$1,(ce,we,$e)=>{var he=root_2$k();let ue;var Z=child(he),ge=child(Z);template_effect((Se,ae)=>{ue=set_class(he,1,"cell svelte-90wygv",null,ue,{revealed:get$2(we).revealed,mine:get$2(we).isMine&&get$2(we).revealed,flagged:get$2(we).flagged}),set_attribute(he,"aria-label",get$2(we).revealed?get$2(we).isMine?"":`  ${get$2(we).adjacentMines} `:get$2(we).flagged?"":""),set_style(Z,`color: ${Se??""}`),set_text(ge,ae)},[()=>get$2(we).revealed&&!get$2(we).isMine?se(get$2(we).adjacentMines):"",()=>K(get$2(we))]),delegated("click",he,()=>Y($e)),delegated("contextmenu",he,Se=>M($e,Se)),append(ce,he)});var te=sibling(j,2);GameFooter(te,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ce,we)=>{var $e=root_3$o(),he=child($e);he.textContent=" 10";var ue=sibling(he,2),Z=child(ue);template_effect(ge=>set_text(Z,` ${ge??""}`),[()=>get$2(h).filter(ge=>ge.flagged).length]),append(ce,$e)},$$slots:{default:!0}});var fe=sibling(te,2);MinigameModal(fe,{get modal(){return get$2(w)}}),append(z,oe)}}),pop()}delegate(["click","contextmenu"]);var root_3$n=from_html('<button type="button"> </button>'),root_4$k=from_html('<div class="footer-stats svelte-ojjw52"><span class="moves-counter svelte-ojjw52">: <strong class="svelte-ojjw52"> </strong></span></div>'),root_1$m=from_html('<!> <div id="game-container" class="svelte-ojjw52"><div id="grid" class="svelte-ojjw52"></div></div> <!> <!>',1);function BrokenMirror(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=4,c=1e3;let f=state(proxy([])),v=state(0),h=state(!1),m=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>g());let y=user_derived(()=>()=>{let M=1;for(let T=0;T<o;T++)for(let x=0;x<o;x++)if(T===o-1&&x===o-1){if(get$2(f)[T][x]!==null)return!1}else{if(get$2(f)[T][x]!==M)return!1;M++}return!0});function g(){set(f,[],!0),set(v,0),set(h,!1),G();let M=[];for(let x=1;x<o*o;x++)M.push(x);M.push(null);do M=M.sort(()=>Math.random()-.5);while(!w(M));let T=0;for(let x=0;x<o;x++){let D=[];for(let N=0;N<o;N++)D.push(M[T++]);get$2(f).push(D)}}function w(M){let T=0;for(let D=0;D<M.length;D++)for(let N=D+1;N<M.length;N++)M[D]&&M[N]&&M[D]>M[N]&&T++;let x=0;for(let D=0;D<M.length;D++)if(M[D]===null){x=Math.floor(D/o);break}return T%2===(o-x)%2}function k(){for(let M=0;M<o;M++)for(let T=0;T<o;T++)if(get$2(f)[M][T]===null)return{r:M,c:T};return null}function I(M,T){if(get$2(h))return;const x=k();if(!x)return;const D=Math.abs(M-x.r),N=Math.abs(T-x.c);(D===1&&N===0||D===0&&N===1)&&(get$2(f)[x.r][x.c]=get$2(f)[M][T],get$2(f)[M][T]=null,update(v),O())}function O(){get$2(y)()&&(set(h,!0),t()?(P("  !",`    ${get$2(v)} !`,[]),setTimeout(()=>{G(),e.onWin?.()},c)):P("  !",`    ${get$2(v)} !`,[{text:" ",action:g}]))}function B(){t()?(P(" "," ...",[]),setTimeout(()=>{G(),e.onLose?.()},c)):P("","  !",[{text:" ",action:g}])}function P(M,T,x){set(m,{show:!0,title:M,text:T,actions:x},!0)}function G(){get$2(m).show=!1}function Y(){P(" ",` ( ):

 :      1  15.

         ().

          !

      .`,[{text:"",action:G}])}BodyWrapper(r,{children:(M,T)=>{var x=root_1$m(),D=first_child(x);{let se=user_derived(()=>t()?B:void 0);GameHeader(D,{onRestart:g,get onGiveUp(){return get$2(se)},get showGiveUp(){return t()},onShowRules:Y})}var N=sibling(D,2),q=child(N);set_style(q,"grid-template-columns: repeat(4, 1fr);"),each(q,21,()=>get$2(f),index$1,(se,me,z)=>{var V=comment(),oe=first_child(V);each(oe,17,()=>get$2(me),index$1,(U,j,ne)=>{var te=root_3$n();let fe;var ce=child(te);template_effect(()=>{fe=set_class(te,1,"cell svelte-ojjw52",null,fe,{empty:get$2(j)===null}),te.disabled=get$2(j)===null,set_attribute(te,"aria-label",get$2(j)===null?" ":` ${get$2(j)}`),set_text(ce,get$2(j))}),delegated("click",te,()=>I(z,ne)),append(U,te)}),append(se,V)});var ie=sibling(N,2);GameFooter(ie,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(se,me)=>{var z=root_4$k(),V=child(z),oe=sibling(child(V)),U=child(oe);template_effect(()=>set_text(U,get$2(v))),append(se,z)},$$slots:{default:!0}});var K=sibling(ie,2);MinigameModal(K,{get modal(){return get$2(m)}}),append(M,x)}}),pop()}delegate(["click"]);var root_2$j=from_html('<button type="button" class="cell svelte-1a9vt2h"> </button>'),root_3$m=from_html('<div class="footer-stats svelte-1a9vt2h"><span class="player-info svelte-1a9vt2h">: <strong class="svelte-1a9vt2h"> </strong></span></div>'),root_1$l=from_html('<!> <div id="game-container" class="svelte-1a9vt2h"><div class="status svelte-1a9vt2h">: <span class="current-player svelte-1a9vt2h"> </span></div> <div class="board svelte-1a9vt2h"></div></div> <!> <!>',1);function AlchemistsCross(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=3,c=1e3,f=["",""];let v=state(proxy(Array(o*o).fill(null))),h=state(proxy(f[0])),m=state(!1),y=state(null),g=state(proxy({show:!1,title:"",text:"",actions:[]}));function w(M){if(!(get$2(m)||get$2(v)[M])){if(get$2(v)[M]=get$2(h),k(get$2(h))){I(get$2(h));return}if(get$2(v).every(T=>T)){I(null);return}set(h,get$2(h)===f[0]?f[1]:f[0],!0)}}function k(M){return[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(x=>x.every(D=>get$2(v)[D]===M))}function I(M){set(m,!0),set(y,M,!0),M?t()?(P(" !",` ${M}!`,[]),setTimeout(()=>{G(),e.onWin?.()},c)):P(" !",` ${M}!`,[{text:" ",action:O}]):t()?(P(" !","!",[]),setTimeout(()=>{G(),e.onLose?.()},c)):P(" !","!",[{text:" ",action:O}])}function O(){set(v,Array(o*o).fill(null),!0),set(h,f[0],!0),set(m,!1),set(y,null),G()}function B(){set(m,!0);const M=get$2(h);t()?(P(" ",`${M} !`,[]),setTimeout(()=>{G(),e.onLose?.()},c)):P("","  !",[{text:" ",action:O}])}function P(M,T,x){set(g,{show:!0,title:M,text:T,actions:x},!0)}function G(){get$2(g).show=!1}function Y(){P(" ",` :

 :   3     ( ,   ).

  1: 
  2: 

    .`,[{text:"",action:G}])}onMount(()=>{O()}),BodyWrapper(r,{children:(M,T)=>{var x=root_1$l(),D=first_child(x);{let V=user_derived(()=>t()?B:void 0);GameHeader(D,{onRestart:O,get onGiveUp(){return get$2(V)},get showGiveUp(){return t()},onShowRules:Y})}var N=sibling(D,2),q=child(N),ie=sibling(child(q)),K=child(ie),se=sibling(q,2);each(se,21,()=>get$2(v),index$1,(V,oe,U)=>{var j=root_2$j(),ne=child(j);template_effect(()=>{j.disabled=!!get$2(oe)||get$2(m),set_text(ne,get$2(oe)??"")}),delegated("click",j,()=>w(U)),append(V,j)});var me=sibling(N,2);GameFooter(me,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(V,oe)=>{var U=root_3$m(),j=child(U),ne=sibling(child(j)),te=child(ne);template_effect(()=>set_text(te,get$2(h))),append(V,U)},$$slots:{default:!0}});var z=sibling(me,2);MinigameModal(z,{get modal(){return get$2(g)}}),template_effect(()=>set_text(K,get$2(h))),append(M,x)}}),pop()}delegate(["click"]);const create$5=()=>new Map,copy=r=>{const e=create$5();return r.forEach((t,n)=>{e.set(n,t)}),e},setIfUndefined=(r,e,t)=>{let n=r.get(e);return n===void 0&&r.set(e,n=t()),n},map=(r,e)=>{const t=[];for(const[n,i]of r)t.push(e(i,n));return t},any=(r,e)=>{for(const[t,n]of r)if(e(n,t))return!0;return!1},create$4=()=>new Set,last=r=>r[r.length-1],appendTo=(r,e)=>{for(let t=0;t<e.length;t++)r.push(e[t])},from=Array.from,every$1=(r,e)=>{for(let t=0;t<r.length;t++)if(!e(r[t],t,r))return!1;return!0},some=(r,e)=>{for(let t=0;t<r.length;t++)if(e(r[t],t,r))return!0;return!1},unfold=(r,e)=>{const t=new Array(r);for(let n=0;n<r;n++)t[n]=e(n,t);return t},isArray=Array.isArray;class ObservableV2{constructor(){this._observers=create$5()}on(e,t){return setIfUndefined(this._observers,e,create$4).add(t),t}once(e,t){const n=(...i)=>{this.off(e,n),t(...i)};this.on(e,n)}off(e,t){const n=this._observers.get(e);n!==void 0&&(n.delete(t),n.size===0&&this._observers.delete(e))}emit(e,t){return from((this._observers.get(e)||create$5()).values()).forEach(n=>n(...t))}destroy(){this._observers=create$5()}}const floor=Math.floor,abs=Math.abs,min=(r,e)=>r<e?r:e,max=(r,e)=>r>e?r:e,isNegativeZero=r=>r!==0?r<0:1/r<0,BIT1=1,BIT2=2,BIT3=4,BIT4=8,BIT6=32,BIT7=64,BIT8=128,BITS5=31,BITS6=63,BITS7=127,BITS31=2147483647,MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER,MIN_SAFE_INTEGER=Number.MIN_SAFE_INTEGER,isInteger=Number.isInteger||(r=>typeof r=="number"&&isFinite(r)&&floor(r)===r),fromCharCode=String.fromCharCode,toLowerCase=r=>r.toLowerCase(),trimLeftRegex=/^\s*/g,trimLeft=r=>r.replace(trimLeftRegex,""),fromCamelCaseRegex=/([A-Z])/g,fromCamelCase=(r,e)=>trimLeft(r.replace(fromCamelCaseRegex,t=>`${e}${toLowerCase(t)}`)),_encodeUtf8Polyfill=r=>{const e=unescape(encodeURIComponent(r)),t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.codePointAt(i);return n},utf8TextEncoder=typeof TextEncoder<"u"?new TextEncoder:null,_encodeUtf8Native=r=>utf8TextEncoder.encode(r),encodeUtf8=utf8TextEncoder?_encodeUtf8Native:_encodeUtf8Polyfill;let utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});utf8TextDecoder&&utf8TextDecoder.decode(new Uint8Array).length===1&&(utf8TextDecoder=null);const repeat=(r,e)=>unfold(e,()=>r).join("");class Encoder{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const createEncoder=()=>new Encoder,length=r=>{let e=r.cpos;for(let t=0;t<r.bufs.length;t++)e+=r.bufs[t].length;return e},toUint8Array=r=>{const e=new Uint8Array(length(r));let t=0;for(let n=0;n<r.bufs.length;n++){const i=r.bufs[n];e.set(i,t),t+=i.length}return e.set(new Uint8Array(r.cbuf.buffer,0,r.cpos),t),e},verifyLen=(r,e)=>{const t=r.cbuf.length;t-r.cpos<e&&(r.bufs.push(new Uint8Array(r.cbuf.buffer,0,r.cpos)),r.cbuf=new Uint8Array(max(t,e)*2),r.cpos=0)},write=(r,e)=>{const t=r.cbuf.length;r.cpos===t&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(t*2),r.cpos=0),r.cbuf[r.cpos++]=e},writeUint8=write,writeVarUint=(r,e)=>{for(;e>BITS7;)write(r,BIT8|BITS7&e),e=floor(e/128);write(r,BITS7&e)},writeVarInt=(r,e)=>{const t=isNegativeZero(e);for(t&&(e=-e),write(r,(e>BITS6?BIT8:0)|(t?BIT7:0)|BITS6&e),e=floor(e/64);e>0;)write(r,(e>BITS7?BIT8:0)|BITS7&e),e=floor(e/128)},_strBuffer=new Uint8Array(3e4),_maxStrBSize=_strBuffer.length/3,_writeVarStringNative=(r,e)=>{if(e.length<_maxStrBSize){const t=utf8TextEncoder.encodeInto(e,_strBuffer).written||0;writeVarUint(r,t);for(let n=0;n<t;n++)write(r,_strBuffer[n])}else writeVarUint8Array(r,encodeUtf8(e))},_writeVarStringPolyfill=(r,e)=>{const t=unescape(encodeURIComponent(e)),n=t.length;writeVarUint(r,n);for(let i=0;i<n;i++)write(r,t.codePointAt(i))},writeVarString=utf8TextEncoder&&utf8TextEncoder.encodeInto?_writeVarStringNative:_writeVarStringPolyfill,writeUint8Array=(r,e)=>{const t=r.cbuf.length,n=r.cpos,i=min(t-n,e.length),s=e.length-i;r.cbuf.set(e.subarray(0,i),n),r.cpos+=i,s>0&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(max(t*2,s)),r.cbuf.set(e.subarray(i)),r.cpos=s)},writeVarUint8Array=(r,e)=>{writeVarUint(r,e.byteLength),writeUint8Array(r,e)},writeOnDataView=(r,e)=>{verifyLen(r,e);const t=new DataView(r.cbuf.buffer,r.cpos,e);return r.cpos+=e,t},writeFloat32=(r,e)=>writeOnDataView(r,4).setFloat32(0,e,!1),writeFloat64=(r,e)=>writeOnDataView(r,8).setFloat64(0,e,!1),writeBigInt64=(r,e)=>writeOnDataView(r,8).setBigInt64(0,e,!1),floatTestBed=new DataView(new ArrayBuffer(4)),isFloat32=r=>(floatTestBed.setFloat32(0,r),floatTestBed.getFloat32(0)===r),writeAny=(r,e)=>{switch(typeof e){case"string":write(r,119),writeVarString(r,e);break;case"number":isInteger(e)&&abs(e)<=BITS31?(write(r,125),writeVarInt(r,e)):isFloat32(e)?(write(r,124),writeFloat32(r,e)):(write(r,123),writeFloat64(r,e));break;case"bigint":write(r,122),writeBigInt64(r,e);break;case"object":if(e===null)write(r,126);else if(isArray(e)){write(r,117),writeVarUint(r,e.length);for(let t=0;t<e.length;t++)writeAny(r,e[t])}else if(e instanceof Uint8Array)write(r,116),writeVarUint8Array(r,e);else{write(r,118);const t=Object.keys(e);writeVarUint(r,t.length);for(let n=0;n<t.length;n++){const i=t[n];writeVarString(r,i),writeAny(r,e[i])}}break;case"boolean":write(r,e?120:121);break;default:write(r,127)}};class RleEncoder extends Encoder{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&writeVarUint(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const flushUintOptRleEncoder=r=>{r.count>0&&(writeVarInt(r.encoder,r.count===1?r.s:-r.s),r.count>1&&writeVarUint(r.encoder,r.count-2))};class UintOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0}write(e){this.s===e?this.count++:(flushUintOptRleEncoder(this),this.count=1,this.s=e)}toUint8Array(){return flushUintOptRleEncoder(this),toUint8Array(this.encoder)}}const flushIntDiffOptRleEncoder=r=>{if(r.count>0){const e=r.diff*2+(r.count===1?0:1);writeVarInt(r.encoder,e),r.count>1&&writeVarUint(r.encoder,r.count-2)}};class IntDiffOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(flushIntDiffOptRleEncoder(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return flushIntDiffOptRleEncoder(this),toUint8Array(this.encoder)}}class StringEncoder{constructor(){this.sarr=[],this.s="",this.lensE=new UintOptRleEncoder}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Encoder;return this.sarr.push(this.s),this.s="",writeVarString(e,this.sarr.join("")),writeUint8Array(e,this.lensE.toUint8Array()),toUint8Array(e)}}const create$3=r=>new Error(r),methodUnimplemented=()=>{throw create$3("Method unimplemented")},unexpectedCase=()=>{throw create$3("Unexpected case")},errorUnexpectedEndOfArray=create$3("Unexpected end of array"),errorIntegerOutOfRange=create$3("Integer out of Range");class Decoder{constructor(e){this.arr=e,this.pos=0}}const createDecoder=r=>new Decoder(r),hasContent=r=>r.pos!==r.arr.length,readUint8Array=(r,e)=>{const t=new Uint8Array(r.arr.buffer,r.pos+r.arr.byteOffset,e);return r.pos+=e,t},readVarUint8Array=r=>readUint8Array(r,readVarUint(r)),readUint8=r=>r.arr[r.pos++],readVarUint=r=>{let e=0,t=1;const n=r.arr.length;for(;r.pos<n;){const i=r.arr[r.pos++];if(e=e+(i&BITS7)*t,t*=128,i<BIT8)return e;if(e>MAX_SAFE_INTEGER)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},readVarInt=r=>{let e=r.arr[r.pos++],t=e&BITS6,n=64;const i=(e&BIT7)>0?-1:1;if((e&BIT8)===0)return i*t;const s=r.arr.length;for(;r.pos<s;){if(e=r.arr[r.pos++],t=t+(e&BITS7)*n,n*=128,e<BIT8)return i*t;if(t>MAX_SAFE_INTEGER)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},_readVarStringPolyfill=r=>{let e=readVarUint(r);if(e===0)return"";{let t=String.fromCodePoint(readUint8(r));if(--e<100)for(;e--;)t+=String.fromCodePoint(readUint8(r));else for(;e>0;){const n=e<1e4?e:1e4,i=r.arr.subarray(r.pos,r.pos+n);r.pos+=n,t+=String.fromCodePoint.apply(null,i),e-=n}return decodeURIComponent(escape(t))}},_readVarStringNative=r=>utf8TextDecoder.decode(readVarUint8Array(r)),readVarString=utf8TextDecoder?_readVarStringNative:_readVarStringPolyfill,readFromDataView=(r,e)=>{const t=new DataView(r.arr.buffer,r.arr.byteOffset+r.pos,e);return r.pos+=e,t},readFloat32=r=>readFromDataView(r,4).getFloat32(0,!1),readFloat64=r=>readFromDataView(r,8).getFloat64(0,!1),readBigInt64=r=>readFromDataView(r,8).getBigInt64(0,!1),readAnyLookupTable=[r=>{},r=>null,readVarInt,readFloat32,readFloat64,readBigInt64,r=>!1,r=>!0,readVarString,r=>{const e=readVarUint(r),t={};for(let n=0;n<e;n++){const i=readVarString(r);t[i]=readAny(r)}return t},r=>{const e=readVarUint(r),t=[];for(let n=0;n<e;n++)t.push(readAny(r));return t},readVarUint8Array],readAny=r=>readAnyLookupTable[127-readUint8(r)](r);class RleDecoder extends Decoder{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),hasContent(this)?this.count=readVarUint(this)+1:this.count=-1),this.count--,this.s}}class UintOptRleDecoder extends Decoder{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=readVarInt(this);const e=isNegativeZero(this.s);this.count=1,e&&(this.s=-this.s,this.count=readVarUint(this)+2)}return this.count--,this.s}}class IntDiffOptRleDecoder extends Decoder{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=readVarInt(this),t=e&1;this.diff=floor(e/2),this.count=1,t&&(this.count=readVarUint(this)+2)}return this.s+=this.diff,this.count--,this.s}}class StringDecoder{constructor(e){this.decoder=new UintOptRleDecoder(e),this.str=readVarString(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const getRandomValues$1=crypto.getRandomValues.bind(crypto),uint32=()=>getRandomValues$1(new Uint32Array(1))[0],uuidv4Template="10000000-1000-4000-8000"+-1e11,uuidv4=()=>uuidv4Template.replace(/[018]/g,r=>(r^uint32()&15>>r/4).toString(16)),create$2=r=>new Promise(r);Promise.all.bind(Promise);const undefinedToNull=r=>r===void 0?null:r;class VarStoragePolyfill{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let _localStorage=new VarStoragePolyfill,usePolyfill=!0;try{typeof localStorage<"u"&&localStorage&&(_localStorage=localStorage,usePolyfill=!1)}catch(r){}const varStorage=_localStorage,EqualityTraitSymbol=Symbol("Equality"),equals=(r,e)=>r===e||!!r?.[EqualityTraitSymbol]?.(e)||!1,isObject=r=>typeof r=="object",assign=Object.assign,keys=Object.keys,forEach=(r,e)=>{for(const t in r)e(r[t],t)},size=r=>keys(r).length,isEmpty=r=>{for(const e in r)return!1;return!0},every=(r,e)=>{for(const t in r)if(!e(r[t],t))return!1;return!0},hasProperty=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),equalFlat=(r,e)=>r===e||size(r)===size(e)&&every(r,(t,n)=>(t!==void 0||hasProperty(e,n))&&equals(e[n],t)),freeze=Object.freeze,deepFreeze=r=>{for(const e in r){const t=r[e];(typeof t=="object"||typeof t=="function")&&deepFreeze(r[e])}return freeze(r)},callAll=(r,e,t=0)=>{try{for(;t<r.length;t++)r[t](...e)}finally{t<r.length&&callAll(r,e,t+1)}},equalityDeep=(r,e)=>{if(r===e)return!0;if(r==null||e==null||r.constructor!==e.constructor&&(r.constructor||Object)!==(e.constructor||Object))return!1;if(r[EqualityTraitSymbol]!=null)return r[EqualityTraitSymbol](e);switch(r.constructor){case ArrayBuffer:r=new Uint8Array(r),e=new Uint8Array(e);case Uint8Array:{if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;break}case Set:{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;break}case Map:{if(r.size!==e.size)return!1;for(const t of r.keys())if(!e.has(t)||!equalityDeep(r.get(t),e.get(t)))return!1;break}case void 0:case Object:if(size(r)!==size(e))return!1;for(const t in r)if(!hasProperty(r,t)||!equalityDeep(r[t],e[t]))return!1;break;case Array:if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!equalityDeep(r[t],e[t]))return!1;break;default:return!1}return!0},isOneOf=(r,e)=>e.includes(r);var define_process_env_default={};const isNode=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let params;const computeParams=()=>{if(params===void 0)if(isNode){params=create$5();const r=process.argv;let e=null;for(let t=0;t<r.length;t++){const n=r[t];n[0]==="-"?(e!==null&&params.set(e,""),e=n):e!==null&&(params.set(e,n),e=null)}e!==null&&params.set(e,"")}else typeof location=="object"?(params=create$5(),(location.search||"?").slice(1).split("&").forEach(r=>{if(r.length!==0){const[e,t]=r.split("=");params.set(`--${fromCamelCase(e,"-")}`,t),params.set(`-${fromCamelCase(e,"-")}`,t)}})):params=create$5();return params},hasParam=r=>computeParams().has(r),getVariable=r=>undefinedToNull(isNode?define_process_env_default[r.toUpperCase().replaceAll("-","_")]:varStorage.getItem(r)),hasConf=r=>hasParam("--"+r)||getVariable(r)!==null,production=hasConf("production"),forceColor=isNode&&isOneOf(define_process_env_default.FORCE_COLOR,["true","1","2"]),supportsColor=forceColor||!hasParam("--no-colors")&&!hasConf("no-color")&&(!isNode||process.stdout.isTTY)&&(!isNode||hasParam("--color")||getVariable("COLORTERM")!==null||(getVariable("TERM")||"").includes("color")),createUint8ArrayFromLen=r=>new Uint8Array(r),copyUint8Array=r=>{const e=createUint8ArrayFromLen(r.byteLength);return e.set(r),e};class Pair{constructor(e,t){this.left=e,this.right=t}}const create$1=(r,e)=>new Pair(r,e),bool=r=>r.next()>=.5,int53=(r,e,t)=>floor(r.next()*(t+1-e)+e),int32=(r,e,t)=>floor(r.next()*(t+1-e)+e),int31=(r,e,t)=>int32(r,e,t),letter=r=>fromCharCode(int31(r,97,122)),word=(r,e=0,t=20)=>{const n=int31(r,e,t);let i="";for(let s=0;s<n;s++)i+=letter(r);return i},oneOf=(r,e)=>e[int31(r,0,e.length-1)],schemaSymbol=Symbol("0schema");class ValidationError{constructor(){this._rerrs=[]}extend(e,t,n,i=null){this._rerrs.push({path:e,expected:t,has:n,message:i})}toString(){const e=[];for(let t=this._rerrs.length-1;t>0;t--){const n=this._rerrs[t];e.push(repeat(" ",(this._rerrs.length-t)*2)+`${n.path!=null?`[${n.path}] `:""}${n.has} doesn't match ${n.expected}. ${n.message}`)}return e.join(`
`)}}const shapeExtends=(r,e)=>r===e?!0:r==null||e==null||r.constructor!==e.constructor?!1:r[EqualityTraitSymbol]?equals(r,e):isArray(r)?every$1(r,t=>some(e,n=>shapeExtends(t,n))):isObject(r)?every(r,(t,n)=>shapeExtends(t,e[n])):!1;class Schema{static _dilutes=!1;extends(e){let[t,n]=[this.shape,e.shape];return this.constructor._dilutes&&([n,t]=[t,n]),shapeExtends(t,n)}equals(e){return this.constructor===e.constructor&&equalityDeep(this.shape,e.shape)}[schemaSymbol](){return!0}[EqualityTraitSymbol](e){return this.equals(e)}validate(e){return this.check(e)}check(e,t){methodUnimplemented()}get nullable(){return $union(this,$null)}get optional(){return new $Optional(this)}cast(e){return assert(e,this),e}expect(e){return assert(e,this),e}}class $ConstructedBy extends Schema{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t=void 0){const n=e?.constructor===this.shape&&(this._c==null||this._c(e));return!n&&t?.extend(null,this.shape.name,e?.constructor.name,e?.constructor!==this.shape?"Constructor match failed":"Check failed"),n}}const $constructedBy=(r,e=null)=>new $ConstructedBy(r,e);$constructedBy($ConstructedBy);class $Custom extends Schema{constructor(e){super(),this.shape=e}check(e,t){const n=this.shape(e);return!n&&t?.extend(null,"custom prop",e?.constructor.name,"failed to check custom prop"),n}}const $custom=r=>new $Custom(r);$constructedBy($Custom);class $Literal extends Schema{constructor(e){super(),this.shape=e}check(e,t){const n=this.shape.some(i=>i===e);return!n&&t?.extend(null,this.shape.join(" | "),e.toString()),n}}const $literal=(...r)=>new $Literal(r),$$literal=$constructedBy($Literal),_regexEscape=RegExp.escape||(r=>r.replace(/[().|&,$^[\]]/g,e=>"\\"+e)),_schemaStringTemplateToRegex=r=>{if($string.check(r))return[_regexEscape(r)];if($$literal.check(r))return r.shape.map(e=>e+"");if($$number.check(r))return["[+-]?\\d+.?\\d*"];if($$string.check(r))return[".*"];if($$union.check(r))return r.shape.map(_schemaStringTemplateToRegex).flat(1);unexpectedCase()};class $StringTemplate extends Schema{constructor(e){super(),this.shape=e,this._r=new RegExp("^"+e.map(_schemaStringTemplateToRegex).map(t=>`(${t.join("|")})`).join("")+"$")}check(e,t){const n=this._r.exec(e)!=null;return!n&&t?.extend(null,this._r.toString(),e.toString(),"String doesn't match string template."),n}}$constructedBy($StringTemplate);const isOptionalSymbol=Symbol("optional");class $Optional extends Schema{constructor(e){super(),this.shape=e}check(e,t){const n=e===void 0||this.shape.check(e);return!n&&t?.extend(null,"undefined (optional)","()"),n}get[isOptionalSymbol](){return!0}}const $$optional=$constructedBy($Optional);class $Never extends Schema{check(e,t){return t?.extend(null,"never",typeof e),!1}}$constructedBy($Never);class $Object extends Schema{constructor(e,t=!1){super(),this.shape=e,this._isPartial=t}static _dilutes=!0;get partial(){return new $Object(this.shape,!0)}check(e,t){return e==null?(t?.extend(null,"object","null"),!1):every(this.shape,(n,i)=>{const s=this._isPartial&&!hasProperty(e,i)||n.check(e[i],t);return!s&&t?.extend(i.toString(),n.toString(),typeof e[i],"Object property does not match"),s})}}const $object=r=>new $Object(r),$$object=$constructedBy($Object),$objectAny=$custom(r=>r!=null&&(r.constructor===Object||r.constructor==null));class $Record extends Schema{constructor(e,t){super(),this.shape={keys:e,values:t}}check(e,t){return e!=null&&every(e,(n,i)=>{const s=this.shape.keys.check(i,t);return!s&&t?.extend(i+"","Record",typeof e,s?"Key doesn't match schema":"Value doesn't match value"),s&&this.shape.values.check(n,t)})}}const $record=(r,e)=>new $Record(r,e),$$record=$constructedBy($Record);class $Tuple extends Schema{constructor(e){super(),this.shape=e}check(e,t){return e!=null&&every(this.shape,(n,i)=>{const s=n.check(e[i],t);return!s&&t?.extend(i.toString(),"Tuple",typeof n),s})}}const $tuple=(...r)=>new $Tuple(r);$constructedBy($Tuple);class $Array extends Schema{constructor(e){super(),this.shape=e.length===1?e[0]:new $Union(e)}check(e,t){const n=isArray(e)&&every$1(e,i=>this.shape.check(i));return!n&&t?.extend(null,"Array",""),n}}const $array=(...r)=>new $Array(r),$$array=$constructedBy($Array),$arrayAny=$custom(r=>isArray(r));class $InstanceOf extends Schema{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t){const n=e instanceof this.shape&&(this._c==null||this._c(e));return!n&&t?.extend(null,this.shape.name,e?.constructor.name),n}}const $instanceOf=(r,e=null)=>new $InstanceOf(r,e);$constructedBy($InstanceOf);const $$schema=$instanceOf(Schema);class $Lambda extends Schema{constructor(e){super(),this.len=e.length-1,this.args=$tuple(...e.slice(-1)),this.res=e[this.len]}check(e,t){const n=e.constructor===Function&&e.length<=this.len;return!n&&t?.extend(null,"function",typeof e),n}}const $$lambda=$constructedBy($Lambda),$function=$custom(r=>typeof r=="function");class $Intersection extends Schema{constructor(e){super(),this.shape=e}check(e,t){const n=every$1(this.shape,i=>i.check(e,t));return!n&&t?.extend(null,"Intersectinon",typeof e),n}}$constructedBy($Intersection,r=>r.shape.length>0);class $Union extends Schema{static _dilutes=!0;constructor(e){super(),this.shape=e}check(e,t){const n=some(this.shape,i=>i.check(e,t));return t?.extend(null,"Union",typeof e),n}}const $union=(...r)=>r.findIndex(e=>$$union.check(e))>=0?$union(...r.map(e=>$(e)).map(e=>$$union.check(e)?e.shape:[e]).flat(1)):r.length===1?r[0]:new $Union(r),$$union=$constructedBy($Union),_t=()=>!0,$any=$custom(_t),$$any=$constructedBy($Custom,r=>r.shape===_t),$bigint=$custom(r=>typeof r=="bigint"),$$bigint=$custom(r=>r===$bigint),$symbol=$custom(r=>typeof r=="symbol");$custom(r=>r===$symbol);const $number=$custom(r=>typeof r=="number"),$$number=$custom(r=>r===$number),$string=$custom(r=>typeof r=="string"),$$string=$custom(r=>r===$string),$boolean=$custom(r=>typeof r=="boolean"),$$boolean=$custom(r=>r===$boolean),$undefined=$literal(void 0);$constructedBy($Literal,r=>r.shape.length===1&&r.shape[0]===void 0);$literal(void 0);const $null=$literal(null),$$null=$constructedBy($Literal,r=>r.shape.length===1&&r.shape[0]===null);$constructedBy(Uint8Array);$constructedBy($ConstructedBy,r=>r.shape===Uint8Array);const $primitive=$union($number,$string,$null,$undefined,$bigint,$boolean,$symbol);(()=>{const r=$array($any),e=$record($string,$any),t=$union($number,$string,$null,$boolean,r,e);return r.shape=t,e.shape.values=t,t})();const $=r=>{if($$schema.check(r))return r;if($objectAny.check(r)){const e={};for(const t in r)e[t]=$(r[t]);return $object(e)}else{if($arrayAny.check(r))return $union(...r.map($));if($primitive.check(r))return $literal(r);if($function.check(r))return $constructedBy(r)}unexpectedCase()},assert=production?()=>{}:(r,e)=>{const t=new ValidationError;if(!e.check(r,t))throw create$3(`Expected value to be of type ${e.constructor.name}.
${t.toString()}`)};class PatternMatcher{constructor(e){this.patterns=[],this.$state=e}if(e,t){return this.patterns.push({if:$(e),h:t}),this}else(e){return this.if($any,e)}done(){return(e,t)=>{for(let n=0;n<this.patterns.length;n++){const i=this.patterns[n];if(i.if.check(e))return i.h(e,t)}throw create$3("Unhandled pattern")}}}const match=r=>new PatternMatcher(r),_random=match($any).if($$number,(r,e)=>int53(e,MIN_SAFE_INTEGER,MAX_SAFE_INTEGER)).if($$string,(r,e)=>word(e)).if($$boolean,(r,e)=>bool(e)).if($$bigint,(r,e)=>BigInt(int53(e,MIN_SAFE_INTEGER,MAX_SAFE_INTEGER))).if($$union,(r,e)=>random(e,oneOf(e,r.shape))).if($$object,(r,e)=>{const t={};for(const n in r.shape){let i=r.shape[n];if($$optional.check(i)){if(bool(e))continue;i=i.shape}t[n]=_random(i,e)}return t}).if($$array,(r,e)=>{const t=[],n=int32(e,0,42);for(let i=0;i<n;i++)t.push(random(e,r.shape));return t}).if($$literal,(r,e)=>oneOf(e,r.shape)).if($$null,(r,e)=>null).if($$lambda,(r,e)=>{const t=random(e,r.res);return()=>t}).if($$any,(r,e)=>random(e,oneOf(e,[$number,$string,$null,$undefined,$bigint,$boolean,$array($number),$record($union("a","b","c"),$number)]))).if($$record,(r,e)=>{const t={},n=int53(e,0,3);for(let i=0;i<n;i++){const s=random(e,r.shape.keys),o=random(e,r.shape.values);t[s]=o}return t}).done(),random=(r,e)=>_random($(e),r),doc=typeof document<"u"?document:{};$custom(r=>r.nodeType===DOCUMENT_FRAGMENT_NODE);typeof DOMParser<"u"&&new DOMParser;$custom(r=>r.nodeType===ELEMENT_NODE);$custom(r=>r.nodeType===TEXT_NODE);const mapToStyleString=r=>map(r,(e,t)=>`${t}:${e};`).join(""),ELEMENT_NODE=doc.ELEMENT_NODE,TEXT_NODE=doc.TEXT_NODE,DOCUMENT_NODE=doc.DOCUMENT_NODE,DOCUMENT_FRAGMENT_NODE=doc.DOCUMENT_FRAGMENT_NODE;$custom(r=>r.nodeType===DOCUMENT_NODE);const create=Symbol,BOLD=create(),UNBOLD=create(),BLUE=create(),GREY=create(),GREEN=create(),RED=create(),PURPLE=create(),ORANGE=create(),UNCOLOR=create(),computeNoColorLoggingArgs=r=>{r.length===1&&r[0]?.constructor===Function&&(r=r[0]());const e=[],t=[];let n=0;for(;n<r.length;n++){const i=r[n];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(n>0&&t.push(e.join(""));n<r.length;n++){const i=r[n];i instanceof Symbol||t.push(i)}return t},_browserStyleMap={[BOLD]:create$1("font-weight","bold"),[UNBOLD]:create$1("font-weight","normal"),[BLUE]:create$1("color","blue"),[GREEN]:create$1("color","green"),[GREY]:create$1("color","grey"),[RED]:create$1("color","red"),[PURPLE]:create$1("color","purple"),[ORANGE]:create$1("color","orange"),[UNCOLOR]:create$1("color","black")},computeBrowserLoggingArgs=r=>{r.length===1&&r[0]?.constructor===Function&&(r=r[0]());const e=[],t=[],n=create$5();let i=[],s=0;for(;s<r.length;s++){const o=r[s],c=_browserStyleMap[o];if(c!==void 0)n.set(c.left,c.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const f=mapToStyleString(n);s>0||f.length>0?(e.push("%c"+o),t.push(f)):e.push(o)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<r.length;s++){const o=r[s];o instanceof Symbol||i.push(o)}return i},computeLoggingArgs=supportsColor?computeBrowserLoggingArgs:computeNoColorLoggingArgs,print=(...r)=>{console.log(...computeLoggingArgs(r)),vconsoles.forEach(e=>e.print(r))},warn=(...r)=>{console.warn(...computeLoggingArgs(r)),r.unshift(ORANGE),vconsoles.forEach(e=>e.print(r))},vconsoles=create$4(),createIterator=r=>({[Symbol.iterator](){return this},next:r}),iteratorFilter=(r,e)=>createIterator(()=>{let t;do t=r.next();while(!t.done&&!e(t.value));return t}),iteratorMap=(r,e)=>createIterator(()=>{const{done:t,value:n}=r.next();return{done:t,value:t?void 0:e(n)}});class DeleteItem{constructor(e,t){this.clock=e,this.len=t}}class DeleteSet{constructor(){this.clients=new Map}}const iterateDeletedStructs=(r,e,t)=>e.clients.forEach((n,i)=>{const s=r.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],c=o.id.clock+o.length;for(let f=0,v=n[f];f<n.length&&v.clock<c;v=n[++f])iterateStructs(r,s,v.clock,v.len,t)}}),findIndexDS=(r,e)=>{let t=0,n=r.length-1;for(;t<=n;){const i=floor((t+n)/2),s=r[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else n=i-1}return null},isDeleted=(r,e)=>{const t=r.clients.get(e.client);return t!==void 0&&findIndexDS(t,e.clock)!==null},sortAndMergeDeleteSet=r=>{r.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,n;for(t=1,n=1;t<e.length;t++){const i=e[n-1],s=e[t];i.clock+i.len>=s.clock?i.len=max(i.len,s.clock+s.len-i.clock):(n<t&&(e[n]=s),n++)}e.length=n})},mergeDeleteSets=r=>{const e=new DeleteSet;for(let t=0;t<r.length;t++)r[t].clients.forEach((n,i)=>{if(!e.clients.has(i)){const s=n.slice();for(let o=t+1;o<r.length;o++)appendTo(s,r[o].clients.get(i)||[]);e.clients.set(i,s)}});return sortAndMergeDeleteSet(e),e},addToDeleteSet=(r,e,t,n)=>{setIfUndefined(r.clients,e,()=>[]).push(new DeleteItem(t,n))},writeDeleteSet=(r,e)=>{writeVarUint(r.restEncoder,e.clients.size),from(e.clients.entries()).sort((t,n)=>n[0]-t[0]).forEach(([t,n])=>{r.resetDsCurVal(),writeVarUint(r.restEncoder,t);const i=n.length;writeVarUint(r.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];r.writeDsClock(o.clock),r.writeDsLen(o.len)}})},readDeleteSet=r=>{const e=new DeleteSet,t=readVarUint(r.restDecoder);for(let n=0;n<t;n++){r.resetDsCurVal();const i=readVarUint(r.restDecoder),s=readVarUint(r.restDecoder);if(s>0){const o=setIfUndefined(e.clients,i,()=>[]);for(let c=0;c<s;c++)o.push(new DeleteItem(r.readDsClock(),r.readDsLen()))}}return e},readAndApplyDeleteSet=(r,e,t)=>{const n=new DeleteSet,i=readVarUint(r.restDecoder);for(let s=0;s<i;s++){r.resetDsCurVal();const o=readVarUint(r.restDecoder),c=readVarUint(r.restDecoder),f=t.clients.get(o)||[],v=getState(t,o);for(let h=0;h<c;h++){const m=r.readDsClock(),y=m+r.readDsLen();if(m<v){v<y&&addToDeleteSet(n,o,v,y-v);let g=findIndexSS(f,m),w=f[g];for(!w.deleted&&w.id.clock<m&&(f.splice(g+1,0,splitItem(e,w,m-w.id.clock)),g++);g<f.length&&(w=f[g++],w.id.clock<y);)w.deleted||(y<w.id.clock+w.length&&f.splice(g,0,splitItem(e,w,y-w.id.clock)),w.delete(e))}else addToDeleteSet(n,o,m,y-m)}}if(n.clients.size>0){const s=new UpdateEncoderV2;return writeVarUint(s.restEncoder,0),writeDeleteSet(s,n),s.toUint8Array()}return null},generateNewClientId=uint32;class Doc extends ObservableV2{constructor({guid:e=uuidv4(),collectionid:t=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=generateNewClientId(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new StructStore,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=create$2(v=>{this.on("load",()=>{this.isLoaded=!0,v(this)})});const f=()=>create$2(v=>{const h=m=>{(m===void 0||m===!0)&&(this.off("sync",h),v())};this.on("sync",h)});this.on("sync",v=>{v===!1&&this.isSynced&&(this.whenSynced=f()),this.isSynced=v===void 0||v===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=f()}load(){const e=this._item;e!==null&&!this.shouldLoad&&transact(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(from(this.subdocs).map(e=>e.guid))}transact(e,t=null){return transact(this,e,t)}get(e,t=AbstractType){const n=setIfUndefined(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=n.constructor;if(t!==AbstractType&&i!==t)if(i===AbstractType){const s=new t;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,YArray)}getText(e=""){return this.get(e,YText)}getMap(e=""){return this.get(e,YMap)}getXmlElement(e=""){return this.get(e,YXmlElement)}getXmlFragment(e=""){return this.get(e,YXmlFragment)}toJSON(){const e={};return this.share.forEach((t,n)=>{e[n]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,from(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new Doc({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,transact(e.parent.doc,n=>{const i=t.doc;e.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class DSDecoderV1{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return readVarUint(this.restDecoder)}readDsLen(){return readVarUint(this.restDecoder)}}class UpdateDecoderV1 extends DSDecoderV1{readLeftID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readRightID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readClient(){return readVarUint(this.restDecoder)}readInfo(){return readUint8(this.restDecoder)}readString(){return readVarString(this.restDecoder)}readParentInfo(){return readVarUint(this.restDecoder)===1}readTypeRef(){return readVarUint(this.restDecoder)}readLen(){return readVarUint(this.restDecoder)}readAny(){return readAny(this.restDecoder)}readBuf(){return copyUint8Array(readVarUint8Array(this.restDecoder))}readJSON(){return JSON.parse(readVarString(this.restDecoder))}readKey(){return readVarString(this.restDecoder)}}class DSDecoderV2{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=readVarUint(this.restDecoder),this.dsCurrVal}readDsLen(){const e=readVarUint(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class UpdateDecoderV2 extends DSDecoderV2{constructor(e){super(e),this.keys=[],readVarUint(e),this.keyClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(e)),this.clientDecoder=new UintOptRleDecoder(readVarUint8Array(e)),this.leftClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(e)),this.rightClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(e)),this.infoDecoder=new RleDecoder(readVarUint8Array(e),readUint8),this.stringDecoder=new StringDecoder(readVarUint8Array(e)),this.parentInfoDecoder=new RleDecoder(readVarUint8Array(e),readUint8),this.typeRefDecoder=new UintOptRleDecoder(readVarUint8Array(e)),this.lenDecoder=new UintOptRleDecoder(readVarUint8Array(e))}readLeftID(){return new ID(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ID(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return readAny(this.restDecoder)}readBuf(){return readVarUint8Array(this.restDecoder)}readJSON(){return readAny(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class DSEncoderV1{constructor(){this.restEncoder=createEncoder()}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){writeVarUint(this.restEncoder,e)}writeDsLen(e){writeVarUint(this.restEncoder,e)}}class UpdateEncoderV1 extends DSEncoderV1{writeLeftID(e){writeVarUint(this.restEncoder,e.client),writeVarUint(this.restEncoder,e.clock)}writeRightID(e){writeVarUint(this.restEncoder,e.client),writeVarUint(this.restEncoder,e.clock)}writeClient(e){writeVarUint(this.restEncoder,e)}writeInfo(e){writeUint8(this.restEncoder,e)}writeString(e){writeVarString(this.restEncoder,e)}writeParentInfo(e){writeVarUint(this.restEncoder,e?1:0)}writeTypeRef(e){writeVarUint(this.restEncoder,e)}writeLen(e){writeVarUint(this.restEncoder,e)}writeAny(e){writeAny(this.restEncoder,e)}writeBuf(e){writeVarUint8Array(this.restEncoder,e)}writeJSON(e){writeVarString(this.restEncoder,JSON.stringify(e))}writeKey(e){writeVarString(this.restEncoder,e)}}class DSEncoderV2{constructor(){this.restEncoder=createEncoder(),this.dsCurrVal=0}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,writeVarUint(this.restEncoder,t)}writeDsLen(e){e===0&&unexpectedCase(),writeVarUint(this.restEncoder,e-1),this.dsCurrVal+=e}}class UpdateEncoderV2 extends DSEncoderV2{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new IntDiffOptRleEncoder,this.clientEncoder=new UintOptRleEncoder,this.leftClockEncoder=new IntDiffOptRleEncoder,this.rightClockEncoder=new IntDiffOptRleEncoder,this.infoEncoder=new RleEncoder(writeUint8),this.stringEncoder=new StringEncoder,this.parentInfoEncoder=new RleEncoder(writeUint8),this.typeRefEncoder=new UintOptRleEncoder,this.lenEncoder=new UintOptRleEncoder}toUint8Array(){const e=createEncoder();return writeVarUint(e,0),writeVarUint8Array(e,this.keyClockEncoder.toUint8Array()),writeVarUint8Array(e,this.clientEncoder.toUint8Array()),writeVarUint8Array(e,this.leftClockEncoder.toUint8Array()),writeVarUint8Array(e,this.rightClockEncoder.toUint8Array()),writeVarUint8Array(e,toUint8Array(this.infoEncoder)),writeVarUint8Array(e,this.stringEncoder.toUint8Array()),writeVarUint8Array(e,toUint8Array(this.parentInfoEncoder)),writeVarUint8Array(e,this.typeRefEncoder.toUint8Array()),writeVarUint8Array(e,this.lenEncoder.toUint8Array()),writeUint8Array(e,toUint8Array(this.restEncoder)),toUint8Array(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){writeAny(this.restEncoder,e)}writeBuf(e){writeVarUint8Array(this.restEncoder,e)}writeJSON(e){writeAny(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const writeStructs=(r,e,t,n)=>{n=max(n,e[0].id.clock);const i=findIndexSS(e,n);writeVarUint(r.restEncoder,e.length-i),r.writeClient(t),writeVarUint(r.restEncoder,n);const s=e[i];s.write(r,n-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(r,0)},writeClientsStructs=(r,e,t)=>{const n=new Map;t.forEach((i,s)=>{getState(e,s)>i&&n.set(s,i)}),getStateVector(e).forEach((i,s)=>{t.has(s)||n.set(s,0)}),writeVarUint(r.restEncoder,n.size),from(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{writeStructs(r,e.clients.get(i),i,s)})},readClientsStructRefs=(r,e)=>{const t=create$5(),n=readVarUint(r.restDecoder);for(let i=0;i<n;i++){const s=readVarUint(r.restDecoder),o=new Array(s),c=r.readClient();let f=readVarUint(r.restDecoder);t.set(c,{i:0,refs:o});for(let v=0;v<s;v++){const h=r.readInfo();switch(BITS5&h){case 0:{const m=r.readLen();o[v]=new GC(createID(c,f),m),f+=m;break}case 10:{const m=readVarUint(r.restDecoder);o[v]=new Skip(createID(c,f),m),f+=m;break}default:{const m=(h&(BIT7|BIT8))===0,y=new Item(createID(c,f),null,(h&BIT8)===BIT8?r.readLeftID():null,null,(h&BIT7)===BIT7?r.readRightID():null,m?r.readParentInfo()?e.get(r.readString()):r.readLeftID():null,m&&(h&BIT6)===BIT6?r.readString():null,readItemContent(r,h));o[v]=y,f+=y.length}}}}return t},integrateStructs=(r,e,t)=>{const n=[];let i=from(t.keys()).sort((g,w)=>g-w);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let g=t.get(i[i.length-1]);for(;g.refs.length===g.i;)if(i.pop(),i.length>0)g=t.get(i[i.length-1]);else return null;return g};let o=s();if(o===null)return null;const c=new StructStore,f=new Map,v=(g,w)=>{const k=f.get(g);(k==null||k>w)&&f.set(g,w)};let h=o.refs[o.i++];const m=new Map,y=()=>{for(const g of n){const w=g.id.client,k=t.get(w);k?(k.i--,c.clients.set(w,k.refs.slice(k.i)),t.delete(w),k.i=0,k.refs=[]):c.clients.set(w,[g]),i=i.filter(I=>I!==w)}n.length=0};for(;;){if(h.constructor!==Skip){const w=setIfUndefined(m,h.id.client,()=>getState(e,h.id.client))-h.id.clock;if(w<0)n.push(h),v(h.id.client,h.id.clock-1),y();else{const k=h.getMissing(r,e);if(k!==null){n.push(h);const I=t.get(k)||{refs:[],i:0};if(I.refs.length===I.i)v(k,getState(e,k)),y();else{h=I.refs[I.i++];continue}}else(w===0||w<h.length)&&(h.integrate(r,w),m.set(h.id.client,h.id.clock+h.length))}}if(n.length>0)h=n.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=s(),o===null)break;h=o.refs[o.i++]}}if(c.clients.size>0){const g=new UpdateEncoderV2;return writeClientsStructs(g,c,new Map),writeVarUint(g.restEncoder,0),{missing:f,update:g.toUint8Array()}}return null},writeStructsFromTransaction=(r,e)=>writeClientsStructs(r,e.doc.store,e.beforeState),readUpdateV2=(r,e,t,n=new UpdateDecoderV2(r))=>transact(e,i=>{i.local=!1;let s=!1;const o=i.doc,c=o.store,f=readClientsStructRefs(n,o),v=integrateStructs(i,c,f),h=c.pendingStructs;if(h){for(const[y,g]of h.missing)if(g<getState(c,y)){s=!0;break}if(v){for(const[y,g]of v.missing){const w=h.missing.get(y);(w==null||w>g)&&h.missing.set(y,g)}h.update=mergeUpdatesV2([h.update,v.update])}}else c.pendingStructs=v;const m=readAndApplyDeleteSet(n,i,c);if(c.pendingDs){const y=new UpdateDecoderV2(createDecoder(c.pendingDs));readVarUint(y.restDecoder);const g=readAndApplyDeleteSet(y,i,c);m&&g?c.pendingDs=mergeUpdatesV2([m,g]):c.pendingDs=m||g}else c.pendingDs=m;if(s){const y=c.pendingStructs.update;c.pendingStructs=null,applyUpdateV2(i.doc,y)}},t,!1),applyUpdateV2=(r,e,t,n=UpdateDecoderV2)=>{const i=createDecoder(e);readUpdateV2(i,r,t,new n(i))},applyUpdate=(r,e,t)=>applyUpdateV2(r,e,t,UpdateDecoderV1);class EventHandler{constructor(){this.l=[]}}const createEventHandler=()=>new EventHandler,addEventHandlerListener=(r,e)=>r.l.push(e),removeEventHandlerListener=(r,e)=>{const t=r.l,n=t.length;r.l=t.filter(i=>e!==i),n===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},callEventHandlerListeners=(r,e,t)=>callAll(r.l,[e,t]);class ID{constructor(e,t){this.client=e,this.clock=t}}const compareIDs=(r,e)=>r===e||r!==null&&e!==null&&r.client===e.client&&r.clock===e.clock,createID=(r,e)=>new ID(r,e),findRootTypeKey=r=>{for(const[e,t]of r.doc.share.entries())if(t===r)return e;throw unexpectedCase()},isVisible=(r,e)=>e===void 0?!r.deleted:e.sv.has(r.id.client)&&(e.sv.get(r.id.client)||0)>r.id.clock&&!isDeleted(e.ds,r.id),splitSnapshotAffectedStructs=(r,e)=>{const t=setIfUndefined(r.meta,splitSnapshotAffectedStructs,create$4),n=r.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<getState(n,s)&&getItemCleanStart(r,createID(s,i))}),iterateDeletedStructs(r,e.ds,i=>{}),t.add(e))};class StructStore{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const getStateVector=r=>{const e=new Map;return r.clients.forEach((t,n)=>{const i=t[t.length-1];e.set(n,i.id.clock+i.length)}),e},getState=(r,e)=>{const t=r.clients.get(e);if(t===void 0)return 0;const n=t[t.length-1];return n.id.clock+n.length},addStruct=(r,e)=>{let t=r.clients.get(e.id.client);if(t===void 0)t=[],r.clients.set(e.id.client,t);else{const n=t[t.length-1];if(n.id.clock+n.length!==e.id.clock)throw unexpectedCase()}t.push(e)},findIndexSS=(r,e)=>{let t=0,n=r.length-1,i=r[n],s=i.id.clock;if(s===e)return n;let o=floor(e/(s+i.length-1)*n);for(;t<=n;){if(i=r[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else n=o-1;o=floor((t+n)/2)}throw unexpectedCase()},find=(r,e)=>{const t=r.clients.get(e.client);return t[findIndexSS(t,e.clock)]},getItem=find,findIndexCleanStart=(r,e,t)=>{const n=findIndexSS(e,t),i=e[n];return i.id.clock<t&&i instanceof Item?(e.splice(n+1,0,splitItem(r,i,t-i.id.clock)),n+1):n},getItemCleanStart=(r,e)=>{const t=r.doc.store.clients.get(e.client);return t[findIndexCleanStart(r,t,e.clock)]},getItemCleanEnd=(r,e,t)=>{const n=e.clients.get(t.client),i=findIndexSS(n,t.clock),s=n[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==GC&&n.splice(i+1,0,splitItem(r,s,t.clock-s.id.clock+1)),s},replaceStruct=(r,e,t)=>{const n=r.clients.get(e.id.client);n[findIndexSS(n,e.id.clock)]=t},iterateStructs=(r,e,t,n,i)=>{if(n===0)return;const s=t+n;let o=findIndexCleanStart(r,e,t),c;do c=e[o++],s<c.id.clock+c.length&&findIndexCleanStart(r,e,s),i(c);while(o<e.length&&e[o].id.clock<s)};class Transaction{constructor(e,t,n){this.doc=e,this.deleteSet=new DeleteSet,this.beforeState=getStateVector(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const writeUpdateMessageFromTransaction=(r,e)=>e.deleteSet.clients.size===0&&!any(e.afterState,(t,n)=>e.beforeState.get(n)!==t)?!1:(sortAndMergeDeleteSet(e.deleteSet),writeStructsFromTransaction(r,e),writeDeleteSet(r,e.deleteSet),!0),addChangedTypeToTransaction=(r,e,t)=>{const n=e._item;(n===null||n.id.clock<(r.beforeState.get(n.id.client)||0)&&!n.deleted)&&setIfUndefined(r.changed,e,create$4).add(t)},tryToMergeWithLefts=(r,e)=>{let t=r[e],n=r[e-1],i=e;for(;i>0;t=n,n=r[--i-1]){if(n.deleted===t.deleted&&n.constructor===t.constructor&&n.mergeWith(t)){t instanceof Item&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,n);continue}break}const s=e-i;return s&&r.splice(e+1-s,s),s},tryGcDeleteSet=(r,e,t)=>{for(const[n,i]of r.clients.entries()){const s=e.clients.get(n);for(let o=i.length-1;o>=0;o--){const c=i[o],f=c.clock+c.len;for(let v=findIndexSS(s,c.clock),h=s[v];v<s.length&&h.id.clock<f;h=s[++v]){const m=s[v];if(c.clock+c.len<=m.id.clock)break;m instanceof Item&&m.deleted&&!m.keep&&t(m)&&m.gc(e,!1)}}}},tryMergeDeleteSet=(r,e)=>{r.clients.forEach((t,n)=>{const i=e.clients.get(n);for(let s=t.length-1;s>=0;s--){const o=t[s],c=min(i.length-1,1+findIndexSS(i,o.clock+o.len-1));for(let f=c,v=i[f];f>0&&v.id.clock>=o.clock;v=i[f])f-=1+tryToMergeWithLefts(i,f)}})},cleanupTransactions=(r,e)=>{if(e<r.length){const t=r[e],n=t.doc,i=n.store,s=t.deleteSet,o=t._mergeStructs;try{sortAndMergeDeleteSet(s),t.afterState=getStateVector(t.doc.store),n.emit("beforeObserverCalls",[t,n]);const c=[];t.changed.forEach((f,v)=>c.push(()=>{(v._item===null||!v._item.deleted)&&v._callObserver(t,f)})),c.push(()=>{t.changedParentTypes.forEach((f,v)=>{v._dEH.l.length>0&&(v._item===null||!v._item.deleted)&&(f=f.filter(h=>h.target._item===null||!h.target._item.deleted),f.forEach(h=>{h.currentTarget=v,h._path=null}),f.sort((h,m)=>h.path.length-m.path.length),c.push(()=>{callEventHandlerListeners(v._dEH,f,t)}))}),c.push(()=>n.emit("afterTransaction",[t,n])),c.push(()=>{t._needFormattingCleanup&&cleanupYTextAfterTransaction(t)})}),callAll(c,[])}finally{n.gc&&tryGcDeleteSet(s,i,n.gcFilter),tryMergeDeleteSet(s,i),t.afterState.forEach((h,m)=>{const y=t.beforeState.get(m)||0;if(y!==h){const g=i.clients.get(m),w=max(findIndexSS(g,y),1);for(let k=g.length-1;k>=w;)k-=1+tryToMergeWithLefts(g,k)}});for(let h=o.length-1;h>=0;h--){const{client:m,clock:y}=o[h].id,g=i.clients.get(m),w=findIndexSS(g,y);w+1<g.length&&tryToMergeWithLefts(g,w+1)>1||w>0&&tryToMergeWithLefts(g,w)}if(!t.local&&t.afterState.get(n.clientID)!==t.beforeState.get(n.clientID)&&(print(ORANGE,BOLD,"[yjs] ",UNBOLD,RED,"Changed the client-id because another client seems to be using it."),n.clientID=generateNewClientId()),n.emit("afterTransactionCleanup",[t,n]),n._observers.has("update")){const h=new UpdateEncoderV1;writeUpdateMessageFromTransaction(h,t)&&n.emit("update",[h.toUint8Array(),t.origin,n,t])}if(n._observers.has("updateV2")){const h=new UpdateEncoderV2;writeUpdateMessageFromTransaction(h,t)&&n.emit("updateV2",[h.toUint8Array(),t.origin,n,t])}const{subdocsAdded:c,subdocsLoaded:f,subdocsRemoved:v}=t;(c.size>0||v.size>0||f.size>0)&&(c.forEach(h=>{h.clientID=n.clientID,h.collectionid==null&&(h.collectionid=n.collectionid),n.subdocs.add(h)}),v.forEach(h=>n.subdocs.delete(h)),n.emit("subdocs",[{loaded:f,added:c,removed:v},n,t]),v.forEach(h=>h.destroy())),r.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,r])):cleanupTransactions(r,e+1)}}},transact=(r,e,t=null,n=!0)=>{const i=r._transactionCleanups;let s=!1,o=null;r._transaction===null&&(s=!0,r._transaction=new Transaction(r,t,n),i.push(r._transaction),i.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{o=e(r._transaction)}finally{if(s){const c=r._transaction===i[0];r._transaction=null,c&&cleanupTransactions(i,0)}}return o};function*lazyStructReaderGenerator(r){const e=readVarUint(r.restDecoder);for(let t=0;t<e;t++){const n=readVarUint(r.restDecoder),i=r.readClient();let s=readVarUint(r.restDecoder);for(let o=0;o<n;o++){const c=r.readInfo();if(c===10){const f=readVarUint(r.restDecoder);yield new Skip(createID(i,s),f),s+=f}else if((BITS5&c)!==0){const f=(c&(BIT7|BIT8))===0,v=new Item(createID(i,s),null,(c&BIT8)===BIT8?r.readLeftID():null,null,(c&BIT7)===BIT7?r.readRightID():null,f?r.readParentInfo()?r.readString():r.readLeftID():null,f&&(c&BIT6)===BIT6?r.readString():null,readItemContent(r,c));yield v,s+=v.length}else{const f=r.readLen();yield new GC(createID(i,s),f),s+=f}}}}class LazyStructReader{constructor(e,t){this.gen=lazyStructReaderGenerator(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Skip);return this.curr}}class LazyStructWriter{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const sliceStruct=(r,e)=>{if(r.constructor===GC){const{client:t,clock:n}=r.id;return new GC(createID(t,n+e),r.length-e)}else if(r.constructor===Skip){const{client:t,clock:n}=r.id;return new Skip(createID(t,n+e),r.length-e)}else{const t=r,{client:n,clock:i}=t.id;return new Item(createID(n,i+e),null,createID(n,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},mergeUpdatesV2=(r,e=UpdateDecoderV2,t=UpdateEncoderV2)=>{if(r.length===1)return r[0];const n=r.map(h=>new e(createDecoder(h)));let i=n.map(h=>new LazyStructReader(h,!0)),s=null;const o=new t,c=new LazyStructWriter(o);for(;i=i.filter(y=>y.curr!==null),i.sort((y,g)=>{if(y.curr.id.client===g.curr.id.client){const w=y.curr.id.clock-g.curr.id.clock;return w===0?y.curr.constructor===g.curr.constructor?0:y.curr.constructor===Skip?1:-1:w}else return g.curr.id.client-y.curr.id.client}),i.length!==0;){const h=i[0],m=h.curr.id.client;if(s!==null){let y=h.curr,g=!1;for(;y!==null&&y.id.clock+y.length<=s.struct.id.clock+s.struct.length&&y.id.client>=s.struct.id.client;)y=h.next(),g=!0;if(y===null||y.id.client!==m||g&&y.id.clock>s.struct.id.clock+s.struct.length)continue;if(m!==s.struct.id.client)writeStructToLazyStructWriter(c,s.struct,s.offset),s={struct:y,offset:0},h.next();else if(s.struct.id.clock+s.struct.length<y.id.clock)if(s.struct.constructor===Skip)s.struct.length=y.id.clock+y.length-s.struct.id.clock;else{writeStructToLazyStructWriter(c,s.struct,s.offset);const w=y.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Skip(createID(m,s.struct.id.clock+s.struct.length),w),offset:0}}else{const w=s.struct.id.clock+s.struct.length-y.id.clock;w>0&&(s.struct.constructor===Skip?s.struct.length-=w:y=sliceStruct(y,w)),s.struct.mergeWith(y)||(writeStructToLazyStructWriter(c,s.struct,s.offset),s={struct:y,offset:0},h.next())}}else s={struct:h.curr,offset:0},h.next();for(let y=h.curr;y!==null&&y.id.client===m&&y.id.clock===s.struct.id.clock+s.struct.length&&y.constructor!==Skip;y=h.next())writeStructToLazyStructWriter(c,s.struct,s.offset),s={struct:y,offset:0}}s!==null&&(writeStructToLazyStructWriter(c,s.struct,s.offset),s=null),finishLazyStructWriting(c);const f=n.map(h=>readDeleteSet(h)),v=mergeDeleteSets(f);return writeDeleteSet(o,v),o.toUint8Array()},flushLazyStructWriter=r=>{r.written>0&&(r.clientStructs.push({written:r.written,restEncoder:toUint8Array(r.encoder.restEncoder)}),r.encoder.restEncoder=createEncoder(),r.written=0)},writeStructToLazyStructWriter=(r,e,t)=>{r.written>0&&r.currClient!==e.id.client&&flushLazyStructWriter(r),r.written===0&&(r.currClient=e.id.client,r.encoder.writeClient(e.id.client),writeVarUint(r.encoder.restEncoder,e.id.clock+t)),e.write(r.encoder,t),r.written++},finishLazyStructWriting=r=>{flushLazyStructWriter(r);const e=r.encoder.restEncoder;writeVarUint(e,r.clientStructs.length);for(let t=0;t<r.clientStructs.length;t++){const n=r.clientStructs[t];writeVarUint(e,n.written),writeUint8Array(e,n.restEncoder)}},errorComputeChanges="You must not compute changes after the event-handler fired.";class YEvent{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=getPathTo(this.currentTarget,this.target))}deletes(e){return isDeleted(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw create$3(errorComputeChanges);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,c;if(this.adds(s)){let f=s.left;for(;f!==null&&this.adds(f);)f=f.left;if(this.deletes(s))if(f!==null&&this.deletes(f))o="delete",c=last(f.content.getContent());else return;else f!==null&&this.deletes(f)?(o="update",c=last(f.content.getContent())):(o="add",c=void 0)}else if(this.deletes(s))o="delete",c=last(s.content.getContent());else return;e.set(i,{action:o,oldValue:c})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw create$3(errorComputeChanges);const t=this.target,n=create$4(),i=create$4(),s=[];if(e={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let c=null;const f=()=>{c&&s.push(c)};for(let v=t._start;v!==null;v=v.right)v.deleted?this.deletes(v)&&!this.adds(v)&&((c===null||c.delete===void 0)&&(f(),c={delete:0}),c.delete+=v.length,i.add(v)):this.adds(v)?((c===null||c.insert===void 0)&&(f(),c={insert:[]}),c.insert=c.insert.concat(v.content.getContent()),n.add(v)):((c===null||c.retain===void 0)&&(f(),c={retain:0}),c.retain+=v.length);c!==null&&c.retain===void 0&&f()}this._changes=e}return e}}const getPathTo=(r,e)=>{const t=[];for(;e._item!==null&&e!==r;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let n=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;t.unshift(n)}e=e._item.parent}return t},warnPrematureAccess=()=>{warn("Invalid access: Add Yjs type to a document before reading data.")},maxSearchMarker=80;let globalSearchMarkerTimestamp=0;class ArraySearchMarker{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=globalSearchMarkerTimestamp++}}const refreshMarkerTimestamp=r=>{r.timestamp=globalSearchMarkerTimestamp++},overwriteMarker=(r,e,t)=>{r.p.marker=!1,r.p=e,e.marker=!0,r.index=t,r.timestamp=globalSearchMarkerTimestamp++},markPosition=(r,e,t)=>{if(r.length>=maxSearchMarker){const n=r.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return overwriteMarker(n,e,t),n}else{const n=new ArraySearchMarker(e,t);return r.push(n),n}},findMarker=(r,e)=>{if(r._start===null||e===0||r._searchMarker===null)return null;const t=r._searchMarker.length===0?null:r._searchMarker.reduce((s,o)=>abs(e-s.index)<abs(e-o.index)?s:o);let n=r._start,i=0;for(t!==null&&(n=t.p,i=t.index,refreshMarkerTimestamp(t));n.right!==null&&i<e;){if(!n.deleted&&n.countable){if(e<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>e;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return t!==null&&abs(t.index-i)<n.parent.length/maxSearchMarker?(overwriteMarker(t,n,i),t):markPosition(r._searchMarker,n,i)},updateMarkerChanges=(r,e,t)=>{for(let n=r.length-1;n>=0;n--){const i=r[n];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){r.splice(n,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=max(e,i.index+t))}},callTypeObservers=(r,e,t)=>{const n=r,i=e.changedParentTypes;for(;setIfUndefined(i,r,()=>[]).push(t),r._item!==null;)r=r._item.parent;callEventHandlerListeners(n._eH,t,e)};class AbstractType{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=createEventHandler(),this._dEH=createEventHandler(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw methodUnimplemented()}clone(){throw methodUnimplemented()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){addEventHandlerListener(this._eH,e)}observeDeep(e){addEventHandlerListener(this._dEH,e)}unobserve(e){removeEventHandlerListener(this._eH,e)}unobserveDeep(e){removeEventHandlerListener(this._dEH,e)}toJSON(){}}const typeListSlice=(r,e,t)=>{r.doc??warnPrematureAccess(),e<0&&(e=r._length+e),t<0&&(t=r._length+t);let n=t-e;const i=[];let s=r._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let c=e;c<o.length&&n>0;c++)i.push(o[c]),n--;e=0}}s=s.right}return i},typeListToArray=r=>{r.doc??warnPrematureAccess();const e=[];let t=r._start;for(;t!==null;){if(t.countable&&!t.deleted){const n=t.content.getContent();for(let i=0;i<n.length;i++)e.push(n[i])}t=t.right}return e},typeListForEach=(r,e)=>{let t=0,n=r._start;for(r.doc??warnPrematureAccess();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,r)}n=n.right}},typeListMap=(r,e)=>{const t=[];return typeListForEach(r,(n,i)=>{t.push(e(n,i,r))}),t},typeListCreateIterator=r=>{let e=r._start,t=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),n=0,e=e.right}const i=t[n++];return t.length<=n&&(t=null),{done:!1,value:i}}}},typeListGet=(r,e)=>{r.doc??warnPrematureAccess();const t=findMarker(r,e);let n=r._start;for(t!==null&&(n=t.p,e-=t.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},typeListInsertGenericsAfter=(r,e,t,n)=>{let i=t;const s=r.doc,o=s.clientID,c=s.store,f=t===null?e._start:t.right;let v=[];const h=()=>{v.length>0&&(i=new Item(createID(o,getState(c,o)),i,i&&i.lastId,f,f&&f.id,e,null,new ContentAny(v)),i.integrate(r,0),v=[])};n.forEach(m=>{if(m===null)v.push(m);else switch(m.constructor){case Number:case Object:case Boolean:case Array:case String:v.push(m);break;default:switch(h(),m.constructor){case Uint8Array:case ArrayBuffer:i=new Item(createID(o,getState(c,o)),i,i&&i.lastId,f,f&&f.id,e,null,new ContentBinary(new Uint8Array(m))),i.integrate(r,0);break;case Doc:i=new Item(createID(o,getState(c,o)),i,i&&i.lastId,f,f&&f.id,e,null,new ContentDoc(m)),i.integrate(r,0);break;default:if(m instanceof AbstractType)i=new Item(createID(o,getState(c,o)),i,i&&i.lastId,f,f&&f.id,e,null,new ContentType(m)),i.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},lengthExceeded=()=>create$3("Length exceeded!"),typeListInsertGenerics=(r,e,t,n)=>{if(t>e._length)throw lengthExceeded();if(t===0)return e._searchMarker&&updateMarkerChanges(e._searchMarker,t,n.length),typeListInsertGenericsAfter(r,e,null,n);const i=t,s=findMarker(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&getItemCleanStart(r,createID(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&updateMarkerChanges(e._searchMarker,i,n.length),typeListInsertGenericsAfter(r,e,o,n)},typeListPushGenerics=(r,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return typeListInsertGenericsAfter(r,e,i,t)},typeListDelete=(r,e,t,n)=>{if(n===0)return;const i=t,s=n,o=findMarker(e,t);let c=e._start;for(o!==null&&(c=o.p,t-=o.index);c!==null&&t>0;c=c.right)!c.deleted&&c.countable&&(t<c.length&&getItemCleanStart(r,createID(c.id.client,c.id.clock+t)),t-=c.length);for(;n>0&&c!==null;)c.deleted||(n<c.length&&getItemCleanStart(r,createID(c.id.client,c.id.clock+n)),c.delete(r),n-=c.length),c=c.right;if(n>0)throw lengthExceeded();e._searchMarker&&updateMarkerChanges(e._searchMarker,i,-s+n)},typeMapDelete=(r,e,t)=>{const n=e._map.get(t);n!==void 0&&n.delete(r)},typeMapSet=(r,e,t,n)=>{const i=e._map.get(t)||null,s=r.doc,o=s.clientID;let c;if(n==null)c=new ContentAny([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new ContentAny([n]);break;case Uint8Array:c=new ContentBinary(n);break;case Doc:c=new ContentDoc(n);break;default:if(n instanceof AbstractType)c=new ContentType(n);else throw new Error("Unexpected content type")}new Item(createID(o,getState(s.store,o)),i,i&&i.lastId,null,null,e,t,c).integrate(r,0)},typeMapGet=(r,e)=>{r.doc??warnPrematureAccess();const t=r._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},typeMapGetAll=r=>{const e={};return r.doc??warnPrematureAccess(),r._map.forEach((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])}),e},typeMapHas=(r,e)=>{r.doc??warnPrematureAccess();const t=r._map.get(e);return t!==void 0&&!t.deleted},typeMapGetAllSnapshot=(r,e)=>{const t={};return r._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&isVisible(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},createMapIterator=r=>(r.doc??warnPrematureAccess(),iteratorFilter(r._map.entries(),e=>!e[1].deleted));class YArrayEvent extends YEvent{}class YArray extends AbstractType{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new YArray;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YArray}clone(){const e=new YArray;return e.insert(0,this.toArray().map(t=>t instanceof AbstractType?t.clone():t)),e}get length(){return this.doc??warnPrematureAccess(),this._length}_callObserver(e,t){super._callObserver(e,t),callTypeObservers(this,e,new YArrayEvent(this,e))}insert(e,t){this.doc!==null?transact(this.doc,n=>{typeListInsertGenerics(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?transact(this.doc,t=>{typeListPushGenerics(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?transact(this.doc,n=>{typeListDelete(n,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return typeListGet(this,e)}toArray(){return typeListToArray(this)}slice(e=0,t=this.length){return typeListSlice(this,e,t)}toJSON(){return this.map(e=>e instanceof AbstractType?e.toJSON():e)}map(e){return typeListMap(this,e)}forEach(e){typeListForEach(this,e)}[Symbol.iterator](){return typeListCreateIterator(this)}_write(e){e.writeTypeRef(YArrayRefID)}}const readYArray=r=>new YArray;class YMapEvent extends YEvent{constructor(e,t,n){super(e,t),this.keysChanged=n}}class YMap extends AbstractType{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new YMap}clone(){const e=new YMap;return this.forEach((t,n)=>{e.set(n,t instanceof AbstractType?t.clone():t)}),e}_callObserver(e,t){callTypeObservers(this,e,new YMapEvent(this,e,t))}toJSON(){this.doc??warnPrematureAccess();const e={};return this._map.forEach((t,n)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[n]=i instanceof AbstractType?i.toJSON():i}}),e}get size(){return[...createMapIterator(this)].length}keys(){return iteratorMap(createMapIterator(this),e=>e[0])}values(){return iteratorMap(createMapIterator(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return iteratorMap(createMapIterator(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??warnPrematureAccess(),this._map.forEach((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?transact(this.doc,t=>{typeMapDelete(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?transact(this.doc,n=>{typeMapSet(n,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return typeMapGet(this,e)}has(e){return typeMapHas(this,e)}clear(){this.doc!==null?transact(this.doc,e=>{this.forEach(function(t,n,i){typeMapDelete(e,i,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(YMapRefID)}}const readYMap=r=>new YMap,equalAttrs=(r,e)=>r===e||typeof r=="object"&&typeof e=="object"&&r&&e&&equalFlat(r,e);class ItemTextListPosition{constructor(e,t,n,i){this.left=e,this.right=t,this.index=n,this.currentAttributes=i}forward(){this.right===null&&unexpectedCase(),this.right.content.constructor===ContentFormat?this.right.deleted||updateCurrentAttributes(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const findNextPosition=(r,e,t)=>{for(;e.right!==null&&t>0;)e.right.content.constructor===ContentFormat?e.right.deleted||updateCurrentAttributes(e.currentAttributes,e.right.content):e.right.deleted||(t<e.right.length&&getItemCleanStart(r,createID(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length),e.left=e.right,e.right=e.right.right;return e},findPosition=(r,e,t,n)=>{const i=new Map,s=n?findMarker(e,t):null;if(s){const o=new ItemTextListPosition(s.p.left,s.p,s.index,i);return findNextPosition(r,o,t-s.index)}else{const o=new ItemTextListPosition(null,e._start,0,i);return findNextPosition(r,o,t)}},insertNegatedAttributes=(r,e,t,n)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===ContentFormat&&equalAttrs(n.get(t.right.content.key),t.right.content.value));)t.right.deleted||n.delete(t.right.content.key),t.forward();const i=r.doc,s=i.clientID;n.forEach((o,c)=>{const f=t.left,v=t.right,h=new Item(createID(s,getState(i.store,s)),f,f&&f.lastId,v,v&&v.id,e,null,new ContentFormat(c,o));h.integrate(r,0),t.right=h,t.forward()})},updateCurrentAttributes=(r,e)=>{const{key:t,value:n}=e;n===null?r.delete(t):r.set(t,n)},minimizeAttributeChanges=(r,e)=>{for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===ContentFormat&&equalAttrs(e[r.right.content.key]??null,r.right.content.value)))break;r.forward()}},insertAttributes=(r,e,t,n)=>{const i=r.doc,s=i.clientID,o=new Map;for(const c in n){const f=n[c],v=t.currentAttributes.get(c)??null;if(!equalAttrs(v,f)){o.set(c,v);const{left:h,right:m}=t;t.right=new Item(createID(s,getState(i.store,s)),h,h&&h.lastId,m,m&&m.id,e,null,new ContentFormat(c,f)),t.right.integrate(r,0),t.forward()}}return o},insertText=(r,e,t,n,i)=>{t.currentAttributes.forEach((y,g)=>{i[g]===void 0&&(i[g]=null)});const s=r.doc,o=s.clientID;minimizeAttributeChanges(t,i);const c=insertAttributes(r,e,t,i),f=n.constructor===String?new ContentString(n):n instanceof AbstractType?new ContentType(n):new ContentEmbed(n);let{left:v,right:h,index:m}=t;e._searchMarker&&updateMarkerChanges(e._searchMarker,t.index,f.getLength()),h=new Item(createID(o,getState(s.store,o)),v,v&&v.lastId,h,h&&h.id,e,null,f),h.integrate(r,0),t.right=h,t.index=m,t.forward(),insertNegatedAttributes(r,e,t,c)},formatText=(r,e,t,n,i)=>{const s=r.doc,o=s.clientID;minimizeAttributeChanges(t,i);const c=insertAttributes(r,e,t,i);e:for(;t.right!==null&&(n>0||c.size>0&&(t.right.deleted||t.right.content.constructor===ContentFormat));){if(!t.right.deleted)switch(t.right.content.constructor){case ContentFormat:{const{key:f,value:v}=t.right.content,h=i[f];if(h!==void 0){if(equalAttrs(h,v))c.delete(f);else{if(n===0)break e;c.set(f,v)}t.right.delete(r)}else t.currentAttributes.set(f,v);break}default:n<t.right.length&&getItemCleanStart(r,createID(t.right.id.client,t.right.id.clock+n)),n-=t.right.length;break}t.forward()}if(n>0){let f="";for(;n>0;n--)f+=`
`;t.right=new Item(createID(o,getState(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new ContentString(f)),t.right.integrate(r,0),t.forward()}insertNegatedAttributes(r,e,t,c)},cleanupFormattingGap=(r,e,t,n,i)=>{let s=e;const o=create$5();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ContentFormat){const v=s.content;o.set(v.key,v)}s=s.right}let c=0,f=!1;for(;e!==s;){if(t===e&&(f=!0),!e.deleted){const v=e.content;if(v.constructor===ContentFormat){const{key:h,value:m}=v,y=n.get(h)??null;(o.get(h)!==v||y===m)&&(e.delete(r),c++,!f&&(i.get(h)??null)===m&&y!==m&&(y===null?i.delete(h):i.set(h,y))),!f&&!e.deleted&&updateCurrentAttributes(i,v)}}e=e.right}return c},cleanupContextlessFormattingGap=(r,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ContentFormat){const n=e.content.key;t.has(n)?e.delete(r):t.add(n)}e=e.left}},cleanupYTextFormatting=r=>{let e=0;return transact(r.doc,t=>{let n=r._start,i=r._start,s=create$5();const o=copy(s);for(;i;)i.deleted===!1&&(i.content.constructor===ContentFormat?updateCurrentAttributes(o,i.content):(e+=cleanupFormattingGap(t,n,i,s,o),s=copy(o),n=i)),i=i.right}),e},cleanupYTextAfterTransaction=r=>{const e=new Set,t=r.doc;for(const[n,i]of r.afterState.entries()){const s=r.beforeState.get(n)||0;i!==s&&iterateStructs(r,t.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===ContentFormat&&o.constructor!==GC&&e.add(o.parent)})}transact(t,n=>{iterateDeletedStructs(r,r.deleteSet,i=>{if(i instanceof GC||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===ContentFormat?e.add(s):cleanupContextlessFormattingGap(n,i)});for(const i of e)cleanupYTextFormatting(i)})},deleteText=(r,e,t)=>{const n=t,i=copy(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case ContentType:case ContentEmbed:case ContentString:t<e.right.length&&getItemCleanStart(r,createID(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(r);break}e.forward()}s&&cleanupFormattingGap(r,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&updateMarkerChanges(o._searchMarker,e.index,-n+t),e};class YTextEvent extends YEvent{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];transact(e,n=>{const i=new Map,s=new Map;let o=this.target._start,c=null;const f={};let v="",h=0,m=0;const y=()=>{if(c!==null){let g=null;switch(c){case"delete":m>0&&(g={delete:m}),m=0;break;case"insert":(typeof v=="object"||v.length>0)&&(g={insert:v},i.size>0&&(g.attributes={},i.forEach((w,k)=>{w!==null&&(g.attributes[k]=w)}))),v="";break;case"retain":h>0&&(g={retain:h},isEmpty(f)||(g.attributes=assign({},f))),h=0;break}g&&t.push(g),c=null}};for(;o!==null;){switch(o.content.constructor){case ContentType:case ContentEmbed:this.adds(o)?this.deletes(o)||(y(),c="insert",v=o.content.getContent()[0],y()):this.deletes(o)?(c!=="delete"&&(y(),c="delete"),m+=1):o.deleted||(c!=="retain"&&(y(),c="retain"),h+=1);break;case ContentString:this.adds(o)?this.deletes(o)||(c!=="insert"&&(y(),c="insert"),v+=o.content.str):this.deletes(o)?(c!=="delete"&&(y(),c="delete"),m+=o.length):o.deleted||(c!=="retain"&&(y(),c="retain"),h+=o.length);break;case ContentFormat:{const{key:g,value:w}=o.content;if(this.adds(o)){if(!this.deletes(o)){const k=i.get(g)??null;equalAttrs(k,w)?w!==null&&o.delete(n):(c==="retain"&&y(),equalAttrs(w,s.get(g)??null)?delete f[g]:f[g]=w)}}else if(this.deletes(o)){s.set(g,w);const k=i.get(g)??null;equalAttrs(k,w)||(c==="retain"&&y(),f[g]=k)}else if(!o.deleted){s.set(g,w);const k=f[g];k!==void 0&&(equalAttrs(k,w)?k!==null&&o.delete(n):(c==="retain"&&y(),w===null?delete f[g]:f[g]=w))}o.deleted||(c==="insert"&&y(),updateCurrentAttributes(i,o.content));break}}o=o.right}for(y();t.length>0;){const g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class YText extends AbstractType{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??warnPrematureAccess(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new YText}clone(){const e=new YText;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new YTextEvent(this,e,t);callTypeObservers(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??warnPrematureAccess();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===ContentString&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?transact(this.doc,n=>{const i=new ItemTextListPosition(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const c=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&insertText(n,this,i,c,o.attributes||{})}else o.retain!==void 0?formatText(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&deleteText(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,n){this.doc??warnPrematureAccess();const i=[],s=new Map,o=this.doc;let c="",f=this._start;function v(){if(c.length>0){const m={};let y=!1;s.forEach((w,k)=>{y=!0,m[k]=w});const g={insert:c};y&&(g.attributes=m),i.push(g),c=""}}const h=()=>{for(;f!==null;){if(isVisible(f,e)||t!==void 0&&isVisible(f,t))switch(f.content.constructor){case ContentString:{const m=s.get("ychange");e!==void 0&&!isVisible(f,e)?(m===void 0||m.user!==f.id.client||m.type!=="removed")&&(v(),s.set("ychange",n?n("removed",f.id):{type:"removed"})):t!==void 0&&!isVisible(f,t)?(m===void 0||m.user!==f.id.client||m.type!=="added")&&(v(),s.set("ychange",n?n("added",f.id):{type:"added"})):m!==void 0&&(v(),s.delete("ychange")),c+=f.content.str;break}case ContentType:case ContentEmbed:{v();const m={insert:f.content.getContent()[0]};if(s.size>0){const y={};m.attributes=y,s.forEach((g,w)=>{y[w]=g})}i.push(m);break}case ContentFormat:isVisible(f,e)&&(v(),updateCurrentAttributes(s,f.content));break}f=f.right}v()};return e||t?transact(o,m=>{e&&splitSnapshotAffectedStructs(m,e),t&&splitSnapshotAffectedStructs(m,t),h()},"cleanup"):h(),i}insert(e,t,n){if(t.length<=0)return;const i=this.doc;i!==null?transact(i,s=>{const o=findPosition(s,this,e,!n);n||(n={},o.currentAttributes.forEach((c,f)=>{n[f]=c})),insertText(s,this,o,t,n)}):this._pending.push(()=>this.insert(e,t,n))}insertEmbed(e,t,n){const i=this.doc;i!==null?transact(i,s=>{const o=findPosition(s,this,e,!n);insertText(s,this,o,t,n||{})}):this._pending.push(()=>this.insertEmbed(e,t,n||{}))}delete(e,t){if(t===0)return;const n=this.doc;n!==null?transact(n,i=>{deleteText(i,findPosition(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,n){if(t===0)return;const i=this.doc;i!==null?transact(i,s=>{const o=findPosition(s,this,e,!1);o.right!==null&&formatText(s,this,o,t,n)}):this._pending.push(()=>this.format(e,t,n))}removeAttribute(e){this.doc!==null?transact(this.doc,t=>{typeMapDelete(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?transact(this.doc,n=>{typeMapSet(n,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return typeMapGet(this,e)}getAttributes(){return typeMapGetAll(this)}_write(e){e.writeTypeRef(YTextRefID)}}const readYText=r=>new YText;class YXmlTreeWalker{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??warnPrematureAccess()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===YXmlElement||t.constructor===YXmlFragment)&&t._start!==null)e=t._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class YXmlFragment extends AbstractType{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YXmlFragment}clone(){const e=new YXmlFragment;return e.insert(0,this.toArray().map(t=>t instanceof AbstractType?t.clone():t)),e}get length(){return this.doc??warnPrematureAccess(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new YXmlTreeWalker(this,e)}querySelector(e){e=e.toUpperCase();const n=new YXmlTreeWalker(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),from(new YXmlTreeWalker(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){callTypeObservers(this,e,new YXmlEvent(this,t,e))}toString(){return typeListMap(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const i=e.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),typeListForEach(this,s=>{i.insertBefore(s.toDOM(e,t,n),null)}),i}insert(e,t){this.doc!==null?transact(this.doc,n=>{typeListInsertGenerics(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)transact(this.doc,n=>{const i=e&&e instanceof AbstractType?e._item:e;typeListInsertGenericsAfter(n,this,i,t)});else{const n=this._prelimContent,i=e===null?0:n.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw create$3("Reference item not found");n.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?transact(this.doc,n=>{typeListDelete(n,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return typeListToArray(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return typeListGet(this,e)}slice(e=0,t=this.length){return typeListSlice(this,e,t)}forEach(e){typeListForEach(this,e)}_write(e){e.writeTypeRef(YXmlFragmentRefID)}}const readYXmlFragment=r=>new YXmlFragment;class YXmlElement extends YXmlFragment{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new YXmlElement(this.nodeName)}clone(){const e=new YXmlElement(this.nodeName),t=this.getAttributes();return forEach(t,(n,i)=>{e.setAttribute(i,n)}),e.insert(0,this.toArray().map(n=>n instanceof AbstractType?n.clone():n)),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const c in e)n.push(c);n.sort();const i=n.length;for(let c=0;c<i;c++){const f=n[c];t.push(f+'="'+e[f]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?transact(this.doc,t=>{typeMapDelete(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?transact(this.doc,n=>{typeMapSet(n,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return typeMapGet(this,e)}hasAttribute(e){return typeMapHas(this,e)}getAttributes(e){return e?typeMapGetAllSnapshot(this,e):typeMapGetAll(this)}toDOM(e=document,t={},n){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const c=s[o];typeof c=="string"&&i.setAttribute(o,c)}return typeListForEach(this,o=>{i.appendChild(o.toDOM(e,t,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(YXmlElementRefID),e.writeKey(this.nodeName)}}const readYXmlElement=r=>new YXmlElement(r.readKey());class YXmlEvent extends YEvent{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class YXmlHook extends YMap{constructor(e){super(),this.hookName=e}_copy(){return new YXmlHook(this.hookName)}clone(){const e=new YXmlHook(this.hookName);return this.forEach((t,n)=>{e.set(n,t)}),e}toDOM(e=document,t={},n){const i=t[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(YXmlHookRefID),e.writeKey(this.hookName)}}const readYXmlHook=r=>new YXmlHook(r.readKey());class YXmlText extends YText{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new YXmlText}clone(){const e=new YXmlText;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const i=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const t=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,c)=>o.key<c.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<t.length;i++){const s=t[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const c=s.attrs[o];n+=` ${c.key}="${c.value}"`}n+=">"}n+=e.insert;for(let i=t.length-1;i>=0;i--)n+=`</${t[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(YXmlTextRefID)}}const readYXmlText=r=>new YXmlText;class AbstractStruct{constructor(e,t){this.id=e,this.length=t}get deleted(){throw methodUnimplemented()}mergeWith(e){return!1}write(e,t,n){throw methodUnimplemented()}integrate(e,t){throw methodUnimplemented()}}const structGCRefNumber=0;class GC extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),addStruct(e.doc.store,this)}write(e,t){e.writeInfo(structGCRefNumber),e.writeLen(this.length-t)}getMissing(e,t){return null}}class ContentBinary{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ContentBinary(this.content)}splice(e){throw methodUnimplemented()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const readContentBinary=r=>new ContentBinary(r.readBuf());class ContentDeleted{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ContentDeleted(this.len)}splice(e){const t=new ContentDeleted(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){addToDeleteSet(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const readContentDeleted=r=>new ContentDeleted(r.readLen()),createDocFromOpts=(r,e)=>new Doc({guid:r,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class ContentDoc{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ContentDoc(createDocFromOpts(this.doc.guid,this.opts))}splice(e){throw methodUnimplemented()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const readContentDoc=r=>new ContentDoc(createDocFromOpts(r.readString(),r.readAny()));class ContentEmbed{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ContentEmbed(this.embed)}splice(e){throw methodUnimplemented()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const readContentEmbed=r=>new ContentEmbed(r.readJSON());class ContentFormat{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ContentFormat(this.key,this.value)}splice(e){throw methodUnimplemented()}mergeWith(e){return!1}integrate(e,t){const n=t.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const readContentFormat=r=>new ContentFormat(r.readKey(),r.readJSON());class ContentJSON{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentJSON(this.arr)}splice(e){const t=new ContentJSON(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let i=t;i<n;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const readContentJSON=r=>{const e=r.readLen(),t=[];for(let n=0;n<e;n++){const i=r.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new ContentJSON(t)},isDevMode=getVariable("node_env")==="development";class ContentAny{constructor(e){this.arr=e,isDevMode&&deepFreeze(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentAny(this.arr)}splice(e){const t=new ContentAny(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let i=t;i<n;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const readContentAny=r=>{const e=r.readLen(),t=[];for(let n=0;n<e;n++)t.push(r.readAny());return new ContentAny(t)};class ContentString{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ContentString(this.str)}splice(e){const t=new ContentString(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const readContentString=r=>new ContentString(r.readString()),typeRefs=[readYArray,readYMap,readYText,readYXmlElement,readYXmlFragment,readYXmlHook,readYXmlText],YArrayRefID=0,YMapRefID=1,YTextRefID=2,YXmlElementRefID=3,YXmlFragmentRefID=4,YXmlHookRefID=5,YXmlTextRefID=6;class ContentType{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ContentType(this.type._copy())}splice(e){throw methodUnimplemented()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const readContentType=r=>new ContentType(typeRefs[r.readTypeRef()](r)),splitItem=(r,e,t)=>{const{client:n,clock:i}=e.id,s=new Item(createID(n,i+t),e,createID(n,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=createID(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),r._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class Item extends AbstractStruct{constructor(e,t,n,i,s,o,c,f){super(e,f.getLength()),this.origin=n,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=c,this.redone=null,this.content=f,this.info=this.content.isCountable()?BIT2:0}set marker(e){(this.info&BIT4)>0!==e&&(this.info^=BIT4)}get marker(){return(this.info&BIT4)>0}get keep(){return(this.info&BIT1)>0}set keep(e){this.keep!==e&&(this.info^=BIT1)}get countable(){return(this.info&BIT2)>0}get deleted(){return(this.info&BIT3)>0}set deleted(e){this.deleted!==e&&(this.info^=BIT3)}markDeleted(){this.info|=BIT3}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=getState(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=getState(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ID&&this.id.client!==this.parent.client&&this.parent.clock>=getState(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=getItemCleanEnd(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=getItemCleanStart(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===GC||this.right&&this.right.constructor===GC)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Item?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Item&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ID){const n=getItem(t,this.parent);n.constructor===GC?this.parent=null:this.parent=n.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=getItemCleanEnd(e,e.doc.store,createID(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),compareIDs(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(compareIDs(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(getItem(e.doc.store,i.origin)))s.has(getItem(e.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),addStruct(e.doc.store,this),this.content.integrate(e,this),addChangedTypeToTransaction(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new GC(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:createID(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&compareIDs(e.origin,this.lastId)&&this.right===e&&compareIDs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),addToDeleteSet(e.deleteSet,this.id.client,this.id.clock,this.length),addChangedTypeToTransaction(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw unexpectedCase();this.content.gc(e),t?replaceStruct(e,this,new GC(this.id,this.length)):this.content=new ContentDeleted(this.length)}write(e,t){const n=t>0?createID(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&BITS5|(n===null?0:BIT8)|(i===null?0:BIT7)|(s===null?0:BIT6);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),i!==null&&e.writeRightID(i),n===null&&i===null){const c=this.parent;if(c._item!==void 0){const f=c._item;if(f===null){const v=findRootTypeKey(c);e.writeParentInfo(!0),e.writeString(v)}else e.writeParentInfo(!1),e.writeLeftID(f.id)}else c.constructor===String?(e.writeParentInfo(!0),e.writeString(c)):c.constructor===ID?(e.writeParentInfo(!1),e.writeLeftID(c)):unexpectedCase();s!==null&&e.writeString(s)}this.content.write(e,t)}}const readItemContent=(r,e)=>contentRefs[e&BITS5](r),contentRefs=[()=>{unexpectedCase()},readContentDeleted,readContentJSON,readContentBinary,readContentString,readContentEmbed,readContentFormat,readContentType,readContentAny,readContentDoc,()=>{unexpectedCase()}],structSkipRefNumber=10;class Skip extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){unexpectedCase()}write(e,t){e.writeInfo(structSkipRefNumber),writeVarUint(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const glo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},importIdentifier="__ $YJS$ __";glo[importIdentifier]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");glo[importIdentifier]=!0;class YjsSupabaseProvider{constructor(e,t){this.doc=e,this.roomId=t,this.channel=supabase.channel(`game:${t}`),this.channel.on("broadcast",{event:"yjs-update"},({payload:n})=>{const i=new Uint8Array(n.update);applyUpdate(this.doc,i)}).subscribe(),this.doc.on("update",n=>{this.channel.send({type:"broadcast",event:"yjs-update",payload:{update:Array.from(n)}})})}channel;destroy(){this.doc.destroy(),this.channel.unsubscribe()}}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let r=0;r<256;++r)byteToHex.push((r+256).toString(16).slice(1));function unsafeStringify(r,e=0){return(byteToHex[r[e+0]]+byteToHex[r[e+1]]+byteToHex[r[e+2]]+byteToHex[r[e+3]]+"-"+byteToHex[r[e+4]]+byteToHex[r[e+5]]+"-"+byteToHex[r[e+6]]+byteToHex[r[e+7]]+"-"+byteToHex[r[e+8]]+byteToHex[r[e+9]]+"-"+byteToHex[r[e+10]]+byteToHex[r[e+11]]+byteToHex[r[e+12]]+byteToHex[r[e+13]]+byteToHex[r[e+14]]+byteToHex[r[e+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(r,e,t){if(native.randomUUID&&!r)return native.randomUUID();r=r||{};const n=r.random||(r.rng||rng)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,unsafeStringify(n)}async function updateUserStats(r,e){try{const{data:t,error:n}=await supabase.from("user_keys").select("visit_count").eq("user_key",r).single();if(n){console.error("Error fetching user stats:",n);return}const{error:i}=await supabase.from("user_keys").update({visit_count:(t?.visit_count||0)+1,last_visit:new Date().toISOString(),user_agent:e}).eq("user_key",r);i?console.error("Error updating user stats:",i):console.log("User stats updated for:",r)}catch(t){console.error("Error in updateUserStats:",t)}}let sessionStartTime=null;async function trackAnalyticsEvent(r,e){const t=get$1(userKeyStore);if(!t){console.warn("[Analytics] No user key, skipping event:",r);return}try{const{error:n}=await supabase.from("user_events").insert([{user_key:t,event_type:r,page_url:typeof window<"u"?window.location.href:null,event_data:e||{}}]);n?console.error("[Analytics] Error tracking event:",n):console.log("[Analytics] Event tracked:",r,e)}catch(n){console.error("[Analytics] Exception:",n)}}function createUserKeyStore(){const{subscribe:r,set:e}=writable(null);return{subscribe:r,init:async()=>{try{if(typeof localStorage>"u")return console.error("localStorage is not available"),null;if(typeof navigator>"u")return console.error("navigator is not available"),null;let t=localStorage.getItem("userKey");const n=navigator.userAgent,i=typeof document<"u"&&document.referrer||"direct";if(t)await updateUserStats(t,n);else{t=v4();const{error:s}=await supabase.from("user_keys").insert([{user_key:t,user_agent:n,referrer:i}]);if(s)return console.error("Error saving to Supabase:",s),null;console.log("New user created with key:",t),localStorage.setItem("userKey",t)}return e(t),t}catch(t){return console.error("Error in init:",t),null}},getUserStats:async t=>{try{const{data:n,error:i}=await supabase.from("user_keys").select("*").eq("user_key",t).single();return i?(console.error("Error getting user stats:",i),null):n}catch(n){return console.error("Error in getUserStats:",n),null}},regenerateKey:async()=>{try{if(typeof localStorage>"u"||typeof navigator>"u")return null;const t=v4(),n=navigator.userAgent,i=typeof document<"u"&&document.referrer||"direct",{error:s}=await supabase.from("user_keys").insert([{user_key:t,user_agent:n,referrer:i}]);return s?(console.error("Error saving new key to Supabase:",s),null):(localStorage.setItem("userKey",t),e(t),console.log("Key regenerated:",t),t)}catch(t){return console.error("Error in regenerateKey:",t),null}},clearKey:()=>{typeof localStorage<"u"&&localStorage.removeItem("userKey"),e(null),console.log("User key cleared")},trackEvent:async(t,n)=>{await trackAnalyticsEvent(t,n)},trackStoryStart:async(t,n)=>{await trackAnalyticsEvent("story_start",{story_id:t,story_title:n})},trackStoryComplete:async(t,n,i)=>{await trackAnalyticsEvent("story_complete",{story_id:t,story_title:n,dialogue_count:i})},trackGameStart:async(t,n,i)=>{await trackAnalyticsEvent("game_start",{game_id:t,game_title:n,story_id:i})},trackGameResult:async(t,n,i,s)=>{await trackAnalyticsEvent(i?"game_win":"game_lose",{game_id:t,game_title:n,story_id:s})},startSessionTimer:()=>{sessionStartTime=Date.now(),console.log("[Analytics] Session timer started")},stopSessionTimer:async()=>{if(!sessionStartTime){console.warn("[Analytics] No session start time");return}const t=Math.floor((Date.now()-sessionStartTime)/1e3);await trackAnalyticsEvent("session_time",{duration_seconds:t}),console.log("[Analytics] Session time recorded:",t,"seconds"),sessionStartTime=null},getCurrentKey:()=>get$1(userKeyStore),getGameStats:async()=>{const t=get$1(userKeyStore);if(!t)return[];try{const{data:{user:n}}=await supabase.auth.getUser();let i=supabase.from("user_game_trophies").select("*");n?i=i.eq("user_id",n.id):i=i.eq("user_key",t);const{data:s,error:o}=await i;return o?(console.error("[Trophies] Error fetching trophies:",o),[]):(s||[]).map(c=>({gameId:c.game_id,gameTitle:c.game_title,totalPlays:c.total_plays,wins:c.wins,losses:c.losses,winRate:c.win_rate}))}catch(n){return console.error("[Trophies] Exception:",n),[]}}}}const userKeyStore=createUserKeyStore();var root_2$i=from_html('<!> <div id="game-container" class="svelte-w511os"><h2 class="menu-title svelte-w511os"> </h2> <button type="button" class="menu-btn svelte-w511os"><span class="menu-icon svelte-w511os"></span> <span> </span></button> <button type="button" class="menu-btn svelte-w511os"><span class="menu-icon svelte-w511os"></span> <span>  </span></button> <button type="button" class="menu-btn online-btn svelte-w511os"><span class="menu-icon svelte-w511os"></span> <span> </span></button></div> <!>',1),root_4$j=from_html('<div class="loading svelte-w511os">...</div>'),root_5$i=from_html('<div class="no-rooms svelte-w511os">  </div>'),root_7$c=from_html('<button type="button" class="room-item svelte-w511os"><span class="room-name svelte-w511os"> </span> <span class="room-players svelte-w511os"> </span></button>'),root_6$e=from_html('<div class="rooms-list svelte-w511os"></div>'),root_3$l=from_html('<!> <div id="game-container" class="svelte-w511os"><h2 class="menu-title svelte-w511os"></h2> <div class="create-room-section svelte-w511os"><input type="text" class="room-input svelte-w511os" placeholder="  ()"/> <button type="button" class="menu-btn create-btn svelte-w511os"><span class="menu-icon svelte-w511os"></span> <span> </span></button></div> <div class="divider svelte-w511os"><span class="svelte-w511os"></span></div> <div class="rooms-section svelte-w511os"><h3 class="rooms-title svelte-w511os"> </h3> <!></div> <div class="manual-join svelte-w511os"><input type="text" class="room-input svelte-w511os" placeholder="ID "/> <button type="button" class="menu-btn join-btn svelte-w511os"></button></div></div> <!>',1),root_9$4=from_html('<div class="online-info svelte-w511os"><span class="room-id svelte-w511os"> </span> <span class="player-symbol svelte-w511os"> </span></div>'),root_10$5=from_html(': <span class="winner svelte-w511os"> </span>',1),root_12$1=from_html(': <span class="current-player svelte-w511os"> </span>',1),root_13$2=from_html('<button type="button"> </button>'),root_14$2=from_html('<div class="footer-stats svelte-w511os"><span class="player-info svelte-w511os"><!> : <strong class="svelte-w511os"> </strong></span></div>'),root_8$6=from_html('<!> <div id="game-container" class="svelte-w511os"><!> <div class="status svelte-w511os"><!></div> <div class="board svelte-w511os"></div></div> <!>',1),root_1$k=from_html("<!> <!>",1);function TicTacToe(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=3,c=1e3,f=["",""],v=["X","O"];let h=state("menu"),m=state(proxy([])),y=state(""),g=state(!1),w=state(proxy(Array(o*o).fill(null))),k=state(proxy(f[0])),I=state(!1),O=state(null),B=state(""),P=state(null),G=state(!1),Y=null,M=null,T=null,x=state(proxy({show:!1,title:"",text:"",actions:[]}));async function D(){if(get$2(B)){const H=userKeyStore.getCurrentKey();H&&await supabase.from("game_players").delete().eq("room_id",get$2(B)).eq("user_key",H)}M&&(M.destroy(),M=null),Y&&(Y.destroy(),Y=null),T=null,set(B,""),set(P,null),set(G,!1)}onDestroy(()=>{M&&(M.destroy(),M=null),Y&&(Y.destroy(),Y=null),T=null});function N(){set(h,"online_menu"),q()}async function q(){set(g,!0);try{const{data:H,error:F}=await supabase.rpc("get_active_rooms",{game_type:"tic_tac_toe"});F?(console.error("Error loading rooms:",F),set(m,[],!0)):set(m,H||[],!0)}catch(H){console.error("Error loading rooms:",H),set(m,[],!0)}set(g,!1)}function ie(){return`ttt_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}async function K(){const H=get$2(y).trim()||` ${Date.now()}`,F=ie(),W=userKeyStore.getCurrentKey(),{error:X}=await supabase.from("game_rooms").insert({room_id:F,room_name:H,game_type:"tic_tac_toe",created_by:W||`guest_${Date.now()}`});if(X){console.error("Error creating room:",X),Z(" ","   .",[{text:"OK",action:ge}]);return}set(y,""),set(B,F,!0),await z()}async function se(H){set(B,H,!0),await z()}async function me(){try{const{error:H}=await supabase.from("game_players").select("id",{count:"exact",head:!0}).limit(1);return!(H&&H.message.includes("relation")&&H.message.includes("does not exist"))}catch(H){return console.error("Error checking table:",H),!1}}async function z(){if(!get$2(B).trim())return;if(!await me()){Z(" ","  .  .",[{text:"OK",action:ge}]);return}const{data:F,error:W}=await supabase.from("game_players").select("symbol").eq("room_id",get$2(B));if(W){console.error("Error fetching players:",W),Z(" ","    .",[{text:"OK",action:ge}]);return}if(!F||F.length===0)set(P,f[0],!0);else if(F.length===1)set(P,f[1],!0);else{Z("  ","     ",[{text:"OK",action:ge}]);return}const X=get$2(P)===f[0]?v[0]:v[1],le=userKeyStore.getCurrentKey(),{error:Ee}=await supabase.from("game_players").insert({room_id:get$2(B),user_key:le||`guest_${Date.now()}`,symbol:X});if(Ee){console.error("Error inserting player:",Ee),Z(" ","    .",[{text:"OK",action:ge}]);return}Y=new Doc,T=Y.getArray("board"),T.length===0&&T.insert(0,Array(o*o).fill(null)),T.observe(()=>{if(!T)return;set(w,T.toArray(),!0);const be=get$2(w).filter(Me=>Me===f[0]).length,ke=get$2(w).filter(Me=>Me===f[1]).length;set(k,be===ke?f[0]:f[1],!0),set(O,we(get$2(w)),!0),(get$2(O)||get$2(w).every(Me=>Me))&&oe(get$2(O))}),T&&set(w,T.toArray(),!0);const Q=get$2(w).filter(be=>be===f[0]).length,ye=get$2(w).filter(be=>be===f[1]).length;set(k,Q===ye?f[0]:f[1],!0),set(O,we(get$2(w)),!0),M=new YjsSupabaseProvider(Y,get$2(B)),set(G,!0),set(h,"online")}function V(H){!get$2(G)||!T||get$2(I)||get$2(w)[H]===null&&get$2(k)===get$2(P)&&(T.delete(H,1),T.insert(H,[get$2(P)]))}function oe(H){if(set(I,!0),set(O,H,!0),H){const F=H===get$2(P);if(t())Z(F?" !":" ",F?"  !":"  !",[]),setTimeout(()=>{ge(),F?e.onWin?.():e.onLose?.()},c);else{const W=H===f[0]?"":"",X=H===get$2(P);Z(X?"  !":"  ",` ${W}`,[{text:" ",action:U},{text:" ",action:()=>{D(),set(h,"menu")}}])}}else t()?(Z(" !","!",[]),setTimeout(()=>{ge(),e.onLose?.()},c)):Z(" !","!",[{text:" ",action:U},{text:" ",action:()=>{D(),set(h,"menu")}}])}async function U(){T&&(T.delete(0,T.length),T.insert(0,Array(o*o).fill(null)),set(I,!1),set(O,null),ge())}function j(){set(h,"computer"),he()}function ne(){set(h,"local"),he()}function te(H){if(!(get$2(I)||get$2(w)[H])){if(get$2(w)[H]=get$2(k),we(get$2(k))){$e(get$2(k));return}if(get$2(w).every(F=>F)){$e(null);return}set(k,get$2(k)===f[0]?f[1]:f[0],!0),get$2(h)==="computer"&&get$2(k)===f[1]&&!get$2(I)&&setTimeout(fe,500)}}function fe(){if(get$2(I))return;const H=get$2(w).map((W,X)=>W===null?X:-1).filter(W=>W!==-1);if(H.length===0)return;for(const W of H){if(get$2(w)[W]=f[1],ce(f[1])){$e(f[1]);return}get$2(w)[W]=null}for(const W of H){if(get$2(w)[W]=f[0],ce(f[0])){get$2(w)[W]=f[1],ce(f[1])?$e(f[1]):get$2(w).every(X=>X)?$e(null):set(k,f[0],!0);return}get$2(w)[W]=null}const F=H[Math.floor(Math.random()*H.length)];if(get$2(w)[F]=f[1],ce(f[1])){$e(f[1]);return}if(get$2(w).every(W=>W)){$e(null);return}set(k,f[0],!0)}function ce(H){return we(get$2(w))===H}function we(H){const F=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const W of F){const[X,le,Ee]=W;if(H[X]&&H[X]===H[le]&&H[X]===H[Ee])return H[X]}return null}function $e(H){if(set(I,!0),set(O,H,!0),H){const F=H===f[0]?"":"";if(t()){const W=H===f[0];Z(W?" !":" ",` ${F}!`,[]),setTimeout(()=>{ge(),W?e.onWin?.():e.onLose?.()},c)}else Z(" !",` ${F}!`,[{text:" ",action:he}])}else t()?(Z(" !","!",[]),setTimeout(()=>{ge(),e.onLose?.()},c)):Z(" !","!",[{text:" ",action:he}])}function he(){set(w,Array(o*o).fill(null),!0),set(k,f[0],!0),set(I,!1),set(O,null),ge()}function ue(){set(I,!0);const F=(get$2(k)===f[0]?f[1]:f[0])===f[0]?"":"";t()?(Z(" ",` ${F}!`,[]),setTimeout(()=>{ge(),e.onLose?.()},c)):Z("",` ${F}!   !`,[{text:" ",action:he}])}function Z(H,F,W){set(x,{show:!0,title:H,text:F,actions:W},!0)}function ge(){get$2(x).show=!1}function Se(){Z(" ",`-:

 :   3     ( ,   ).

  1: 
  2: 

:
     AI
        
       `,[{text:"",action:ge}])}function ae(){get$2(h)==="online"&&D(),set(h,"menu"),he()}BodyWrapper(r,{children:(H,F)=>{var W=root_1$k(),X=first_child(W);{var le=be=>{var ke=root_2$i(),Me=first_child(ke);GameHeader(Me,{onRestart:()=>{},onShowRules:Se});var E=sibling(Me,2),d=sibling(child(E),2),p=sibling(d,2),A=sibling(p,2),L=sibling(E,2);GameFooter(L,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()}}),delegated("click",d,j),delegated("click",p,ne),delegated("click",A,N),append(be,ke)},Ee=be=>{var ke=root_3$l(),Me=first_child(ke);GameHeader(Me,{onRestart:()=>{},onShowRules:Se,onBack:ae});var E=sibling(Me,2),d=sibling(child(E),2),p=child(d),A=sibling(p,2),L=sibling(d,4),ee=sibling(child(L),2);{var pe=Ue=>{var Xe=root_4$j();append(Ue,Xe)},Ce=Ue=>{var Xe=root_5$i();append(Ue,Xe)},Oe=Ue=>{var Xe=root_6$e();each(Xe,21,()=>get$2(m),index$1,(st,tt)=>{var We=root_7$c(),Pe=child(We),Be=child(Pe),ze=sibling(Pe,2),ot=child(ze);template_effect(()=>{set_text(Be,get$2(tt).room_name),set_text(ot,`${get$2(tt).player_count??""}/2 `)}),delegated("click",We,()=>se(get$2(tt).room_id)),append(st,We)}),append(Ue,Xe)};if_block(ee,Ue=>{get$2(g)?Ue(pe):get$2(m).length===0?Ue(Ce,1):Ue(Oe,!1)})}var Te=sibling(L,2),Le=child(Te),Fe=sibling(Le,2),He=sibling(E,2);GameFooter(He,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()}}),bind_value(p,()=>get$2(y),Ue=>set(y,Ue)),delegated("click",A,K),bind_value(Le,()=>get$2(B),Ue=>set(B,Ue)),delegated("click",Fe,()=>z()),append(be,ke)},Q=be=>{var ke=root_8$6(),Me=first_child(ke);{let Le=user_derived(()=>get$2(h)==="online"?U:he),Fe=user_derived(()=>t()?ue:void 0);GameHeader(Me,{get onRestart(){return get$2(Le)},get onGiveUp(){return get$2(Fe)},get showGiveUp(){return t()},onShowRules:Se})}var E=sibling(Me,2),d=child(E);{var p=Le=>{var Fe=root_9$4(),He=child(Fe),Ue=child(He),Xe=sibling(He,2),st=child(Xe);template_effect(()=>{set_text(Ue,`: ${get$2(B)??""}`),set_text(st,`  : ${get$2(P)??""}`)}),append(Le,Fe)};if_block(d,Le=>{get$2(h)==="online"&&Le(p)})}var A=sibling(d,2),L=child(A);{var ee=Le=>{var Fe=root_10$5(),He=sibling(first_child(Fe)),Ue=child(He);template_effect(()=>set_text(Ue,get$2(O))),append(Le,Fe)},pe=Le=>{var Fe=text("");append(Le,Fe)},Ce=Le=>{var Fe=root_12$1(),He=sibling(first_child(Fe)),Ue=child(He);template_effect(()=>set_text(Ue,get$2(k))),append(Le,Fe)};if_block(L,Le=>{get$2(I)&&get$2(O)?Le(ee):get$2(I)?Le(pe,1):Le(Ce,!1)})}var Oe=sibling(A,2);each(Oe,21,()=>get$2(w),index$1,(Le,Fe,He)=>{var Ue=root_13$2();let Xe;var st=child(Ue);template_effect(()=>{Xe=set_class(Ue,1,"cell svelte-w511os",null,Xe,{"x-cell":get$2(Fe)===f[0],"o-cell":get$2(Fe)===f[1]}),Ue.disabled=!!get$2(Fe)||get$2(I)||get$2(h)==="online"&&get$2(k)!==get$2(P)||get$2(h)==="computer"&&get$2(k)===f[1],set_text(st,get$2(Fe)??"")}),delegated("click",Ue,()=>get$2(h)==="online"?V(He):te(He)),append(Le,Ue)});var Te=sibling(E,2);GameFooter(Te,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(Le,Fe)=>{var He=root_14$2(),Ue=child(He),Xe=child(Ue);{var st=Pe=>{var Be=text();template_effect(()=>set_text(Be,`: ${get$2(P)??""} |`)),append(Pe,Be)};if_block(Xe,Pe=>{get$2(h)==="online"&&Pe(st)})}var tt=sibling(Xe,2),We=child(tt);template_effect(()=>set_text(We,get$2(k))),append(Le,He)},$$slots:{default:!0}}),append(be,ke)};if_block(X,be=>{get$2(h)==="menu"?be(le):get$2(h)==="online_menu"?be(Ee,1):be(Q,!1)})}var ye=sibling(X,2);MinigameModal(ye,{get modal(){return get$2(x)}}),append(H,W)}}),pop()}delegate(["click"]);var root_4$i=from_html('<div class="flame svelte-9xykz0"></div>'),root_3$k=from_html('<button type="button"><div class="candle svelte-9xykz0"><!></div></button>'),root_5$h=from_html('<div class="footer-stats svelte-9xykz0"><span class="moves-counter svelte-9xykz0">: <strong class="svelte-9xykz0"> </strong></span></div>'),root_1$j=from_html('<!> <div id="game-container" class="svelte-9xykz0"><div id="grid" class="svelte-9xykz0"></div></div> <!> <!>',1);function LightOut(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=5,c=5,f=15,v=1e3;let h=state(proxy([])),m=state(0),y=state(!1),g=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>k());let w=user_derived(()=>get$2(h).flat().every(T=>!T));function k(){set(h,Array(o).fill(null).map(()=>Array(c).fill(!1)),!0),set(m,0),set(y,!1),Y();for(let T=0;T<f;T++){const x=Math.floor(Math.random()*o),D=Math.floor(Math.random()*c);I(x,D,!0)}}function I(T,x,D=!1){get$2(h)[T][x]=!get$2(h)[T][x],T>0&&(get$2(h)[T-1][x]=!get$2(h)[T-1][x]),T<o-1&&(get$2(h)[T+1][x]=!get$2(h)[T+1][x]),x>0&&(get$2(h)[T][x-1]=!get$2(h)[T][x-1]),x<c-1&&(get$2(h)[T][x+1]=!get$2(h)[T][x+1]),D||(update(m),B())}function O(T,x){get$2(y)||I(T,x)}function B(){get$2(w)&&(set(y,!0),t()?(G("  ",`     ${get$2(m)} !`,[]),setTimeout(()=>{Y(),e.onWin?.()},v)):G("  ",`     ${get$2(m)} !`,[{text:" ",action:k}]))}function P(){t()?(G(" "," ...",[]),setTimeout(()=>{Y(),e.onLose?.()},v)):G("","  !",[{text:" ",action:k}])}function G(T,x,D){set(g,{show:!0,title:T,text:x,actions:D},!0)}function Y(){get$2(g).show=!1}function M(){G(" ",` :

 :     .

         (, , , ).

   ,    .

         !

      .`,[{text:"",action:Y}])}BodyWrapper(r,{children:(T,x)=>{var D=root_1$j(),N=first_child(D);{let me=user_derived(()=>t()?P:void 0);GameHeader(N,{onRestart:k,get onGiveUp(){return get$2(me)},get showGiveUp(){return t()},onShowRules:M})}var q=sibling(N,2),ie=child(q);set_style(ie,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),each(ie,21,()=>get$2(h),index$1,(me,z,V)=>{var oe=comment(),U=first_child(oe);each(U,17,()=>get$2(z),index$1,(j,ne,te)=>{var fe=root_3$k();let ce;set_attribute(fe,"aria-label",` ${V}, ${te}`);var we=child(fe),$e=child(we);{var he=ue=>{var Z=root_4$i();append(ue,Z)};if_block($e,ue=>{get$2(ne)&&ue(he)})}template_effect(()=>ce=set_class(fe,1,"cell svelte-9xykz0",null,ce,{lit:get$2(ne)})),delegated("click",fe,()=>O(V,te)),append(j,fe)}),append(me,oe)});var K=sibling(q,2);GameFooter(K,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(me,z)=>{var V=root_5$h(),oe=child(V),U=sibling(child(oe)),j=child(U);template_effect(()=>set_text(j,get$2(m))),append(me,V)},$$slots:{default:!0}});var se=sibling(K,2);MinigameModal(se,{get modal(){return get$2(g)}}),append(T,D)}}),pop()}delegate(["click"]);var root_3$j=from_html('<div class="cell svelte-1gpcadn"> </div>'),root_4$h=from_html('<button class="color-btn svelte-1gpcadn"> </button>'),root_5$g=from_html('<div class="footer-stats svelte-1gpcadn"><span class="moves-counter svelte-1gpcadn">: <strong class="svelte-1gpcadn"> </strong> </span></div>'),root_1$i=from_html('<!> <div id="game-container" class="svelte-1gpcadn"><div id="grid" class="svelte-1gpcadn"></div></div> <div class="color-picker svelte-1gpcadn"></div> <!> <!>',1);function FloodIt(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=12,c=25,f=1e3,v=[{name:"unicorn",value:"#e94560",icon:""},{name:"wizard",value:"#6c5ce7",icon:""},{name:"ghost",value:"#0984e3",icon:""},{name:"skull",value:"#00b894",icon:""},{name:"fire",value:"#fdcb6e",icon:""},{name:"spider",value:"#ffeaa7",icon:""}];let h=state(proxy([])),m=state(0),y=state(!1),g=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>k());let w=user_derived(()=>()=>{const T=get$2(h)[0][0];return get$2(h).every(x=>x.every(D=>D===T))});function k(){set(h,[],!0),set(m,0),set(y,!1),Y();for(let T=0;T<o;T++){let x=[];for(let D=0;D<o;D++)x.push(Math.floor(Math.random()*v.length));get$2(h).push(x)}}function I(T,x,D,N){T<0||T>=o||x<0||x>=o||get$2(h)[T][x]===D&&(get$2(h)[T][x]=N,I(T-1,x,D,N),I(T+1,x,D,N),I(T,x-1,D,N),I(T,x+1,D,N))}function O(T){if(get$2(y)||get$2(m)>=c)return;const x=get$2(h)[0][0];T!==x&&(I(0,0,x,T),update(m),B())}function B(){get$2(w)()?(set(y,!0),t()?(G(" !",`    ${get$2(m)} !`,[]),setTimeout(()=>{Y(),e.onWin?.()},f)):G(" !",`    ${get$2(m)} !`,[{text:" ",action:k}])):get$2(m)>=c&&(set(y,!0),t()?(G(" "," !",[]),setTimeout(()=>{Y(),e.onLose?.()},f)):G(" "," !",[{text:"",action:k}]))}function P(){t()?(G(" "," ...",[]),setTimeout(()=>{Y(),e.onLose?.()},f)):G("","  !",[{text:" ",action:k}])}function G(T,x,D){set(g,{show:!0,title:T,text:x,actions:D},!0)}function Y(){get$2(g).show=!1}function M(){G(" ",` :

 :     .

             .

        .

     25 !

          .`,[{text:"",action:Y}])}BodyWrapper(r,{children:(T,x)=>{var D=root_1$i(),N=first_child(D);{let z=user_derived(()=>t()?P:void 0);GameHeader(N,{onRestart:k,get onGiveUp(){return get$2(z)},get showGiveUp(){return t()},onShowRules:M})}var q=sibling(N,2),ie=child(q);set_style(ie,"grid-template-columns: repeat(12, 1fr);"),each(ie,21,()=>get$2(h),index$1,(z,V)=>{var oe=comment(),U=first_child(oe);each(U,17,()=>get$2(V),index$1,(j,ne)=>{var te=root_3$j(),fe=child(te);template_effect(()=>{set_style(te,`background-color: ${v[get$2(ne)].value??""};`),set_text(fe,v[get$2(ne)].icon)}),append(j,te)}),append(z,oe)});var K=sibling(q,2);each(K,21,()=>v,index$1,(z,V,oe)=>{var U=root_4$h(),j=child(U);template_effect(()=>{set_style(U,`background-color: ${get$2(V).value??""};`),U.disabled=get$2(y)||get$2(m)>=c,set_text(j,get$2(V).icon)}),delegated("click",U,()=>O(oe)),append(z,U)});var se=sibling(K,2);GameFooter(se,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(z,V)=>{var oe=root_5$g(),U=child(oe),j=sibling(child(U)),ne=child(j),te=sibling(j);te.nodeValue=" / 25",template_effect(()=>set_text(ne,get$2(m))),append(z,oe)},$$slots:{default:!0}});var me=sibling(se,2);MinigameModal(me,{get modal(){return get$2(g)}}),append(T,D)}}),pop()}delegate(["click"]);var root_2$h=from_html('<button type="button"><span class="die-face svelte-mtk44w"> </span> <span class="die-number svelte-mtk44w"> </span></button>'),root_3$i=from_html('<div class="footer-stats svelte-mtk44w"><span class="rolls-info svelte-mtk44w">: <strong class="svelte-mtk44w"> </strong></span></div>'),root_1$h=from_html('<!> <div id="game-container" class="svelte-mtk44w"><div class="message svelte-mtk44w"> </div> <div class="dice-area svelte-mtk44w"></div> <button type="button" class="roll-btn svelte-mtk44w"> </button> <div class="target svelte-mtk44w">: <span class="target-combo svelte-mtk44w">4-2-1</span></div></div> <!> <!>',1);function Bones421(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=["","","","","",""],c=1e3,f="124";let v=state(proxy([1,1,1])),h=state(3),m=state(proxy([!1,!1,!1])),y=state(!1),g=state(!1),w=state(" !"),k=state(proxy({show:!1,title:"",text:"",actions:[]}));function I(){if(!(get$2(h)<=0||get$2(y))){for(let N=0;N<get$2(v).length;N++)get$2(m)[N]||(get$2(v)[N]=Math.floor(Math.random()*6)+1);update(h,-1),O()}}function O(){[...get$2(v)].sort().join("")===f?(set(w,"!  !"),set(y,!0),set(g,!0),B()):get$2(h)===0?(set(w," ..."),set(y,!0),set(g,!1),P()):set(w,` : ${get$2(h)}`)}function B(){t()?(T(" !"," 4-2-1!  !",[]),setTimeout(()=>{x(),e.onWin?.()},c)):T(" !"," 4-2-1!  !",[{text:" ",action:Y}])}function P(){t()?(T(" ","   4-2-1...",[]),setTimeout(()=>{x(),e.onLose?.()},c)):T(" ","   4-2-1...",[{text:" ",action:Y}])}function G(N){get$2(y)||get$2(h)===3||(get$2(m)[N]=!get$2(m)[N])}function Y(){set(v,[1,1,1],!0),set(h,3),set(m,[!1,!1,!1],!0),set(y,!1),set(g,!1),set(w," !"),x()}function M(){get$2(y)||(set(y,!0),set(g,!1),t()?(T(" "," ...",[]),setTimeout(()=>{x(),e.onLose?.()},c)):T("","  !",[{text:" ",action:Y}]))}function T(N,q,ie){set(k,{show:!0,title:N,text:q,actions:ie},!0)}function x(){get$2(k).show=!1}function D(){T(" ",` 4-2-1:

 :   4-2-1.

    3 .

      .

  4-2-1 (  )  !`,[{text:"",action:x}])}onMount(()=>{Y()}),BodyWrapper(r,{children:(N,q)=>{var ie=root_1$h(),K=first_child(ie);{let te=user_derived(()=>t()?M:void 0),fe=user_derived(()=>t()&&!get$2(y));GameHeader(K,{onRestart:Y,get onGiveUp(){return get$2(te)},get showGiveUp(){return get$2(fe)},onShowRules:D})}var se=sibling(K,2),me=child(se),z=child(me),V=sibling(me,2);each(V,21,()=>get$2(v),index$1,(te,fe,ce)=>{var we=root_2$h();let $e;var he=child(we),ue=child(he),Z=sibling(he,2),ge=child(Z);template_effect(()=>{$e=set_class(we,1,"die svelte-mtk44w",null,$e,{locked:get$2(m)[ce]}),we.disabled=get$2(y)||get$2(h)===3,set_text(ue,o[get$2(fe)-1]),set_text(ge,get$2(fe))}),delegated("click",we,()=>G(ce)),append(te,we)});var oe=sibling(V,2),U=child(oe),j=sibling(se,2);GameFooter(j,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(te,fe)=>{var ce=root_3$i(),we=child(ce),$e=sibling(child(we)),he=child($e);template_effect(()=>set_text(he,get$2(h))),append(te,ce)},$$slots:{default:!0}});var ne=sibling(j,2);MinigameModal(ne,{get modal(){return get$2(k)}}),template_effect(()=>{set_text(z,get$2(w)),oe.disabled=get$2(h)===0||get$2(y),set_text(U,`  (${get$2(h)??""})`)}),delegated("click",oe,I),append(N,ie)}}),pop()}delegate(["click"]);var root_2$g=from_html('<button type="button" class="crystal-btn svelte-1p3ltlr"><span class="crystal-icon svelte-1p3ltlr"> </span> <span class="crystal-name svelte-1p3ltlr"> </span></button>'),root_3$h=from_html('<div class="game-over-message svelte-1p3ltlr"><span> </span></div>'),root_4$g=from_html('<div class="status-message svelte-1p3ltlr">   ... </div>'),root_5$f=from_html('<div class="status-message svelte-1p3ltlr">  </div>'),root_6$d=from_html('<div class="progress svelte-1p3ltlr"> </div>'),root_7$b=from_html('<div class="footer-stats svelte-1p3ltlr"><span class="target-info svelte-1p3ltlr">: <strong class="svelte-1p3ltlr"> </strong></span></div>'),root_1$g=from_html('<!> <div id="game-container" class="svelte-1p3ltlr"><div class="stats-panel svelte-1p3ltlr"><div class="round svelte-1p3ltlr">: <strong class="svelte-1p3ltlr"> </strong></div> <div class="high-score svelte-1p3ltlr">: <strong class="svelte-1p3ltlr"> </strong></div></div> <div class="crystals-grid svelte-1p3ltlr"></div> <div class="status-area svelte-1p3ltlr"><!></div> <!></div> <!> <!>',1);function CrystalsOfTime(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=[{color:"#e94560",name:"",icon:""},{color:"#0984e3",name:"",icon:""},{color:"#00b894",name:"",icon:""},{color:"#fdcb6e",name:"",icon:""}],c=1e3,f=10;let v=state(proxy([])),h=state(proxy([])),m=state(1),y=state(!1),g=state(null),w=state(!1),k=state(0),I=state(proxy({show:!1,title:"",text:"",actions:[]}));function O(){set(v,[],!0),set(h,[],!0),set(m,1),set(w,!1),B()}function B(){const N=Math.floor(Math.random()*o.length);set(v,[...get$2(v),N],!0),P()}async function P(){set(y,!0),set(h,[],!0);for(let N=0;N<get$2(v).length;N++)await new Promise(q=>setTimeout(q,300)),set(g,get$2(v)[N],!0),Y(get$2(v)[N]),await new Promise(q=>setTimeout(q,500)),set(g,null),await new Promise(q=>setTimeout(q,200));set(y,!1)}function G(N){if(get$2(y)||get$2(w))return;set(g,N,!0),Y(N),setTimeout(()=>{set(g,null)},300);const q=get$2(h).length;if(N!==get$2(v)[q]){set(w,!0),get$2(m)-1>get$2(k)&&set(k,get$2(m)-1),t()?(T(" "," ...",[]),setTimeout(()=>{x(),e.onLose?.()},c)):T("  ",` ${get$2(m)-1}`,[{text:" ",action:O}]);return}if(set(h,[...get$2(h),N],!0),get$2(h).length===get$2(v).length){if(update(m),get$2(m)>get$2(k)&&set(k,get$2(m),!0),get$2(m)>f){set(w,!0),t()?(T(" !","  !",[]),setTimeout(()=>{x(),e.onWin?.()},c)):T(" !","  !",[{text:" ",action:O}]);return}setTimeout(()=>{B()},1e3)}}function Y(N){console.log(`Play sound for crystal ${N}`)}function M(N){const q=o[N],ie=get$2(g)===N,K=ie?`0 0 50px ${q.color}, 0 0 100px ${q.color}`:`0 8px 0 ${q.color}`;return`background-color: ${q.color}; box-shadow: ${K}; transform: ${ie?"translateY(2px)":"none"};`}function T(N,q,ie){set(I,{show:!0,title:N,text:q,actions:ie},!0)}function x(){get$2(I).show=!1}function D(){T(" ",` :

 :   .

    .

      .

   -  .

  10   !`,[{text:"",action:x}])}onMount(()=>{O()}),BodyWrapper(r,{children:(N,q)=>{var ie=root_1$g(),K=first_child(ie);{let ae=user_derived(()=>t()?()=>{set(w,!0),T(" "," ...",[]),setTimeout(()=>{x(),e.onLose?.()},c)}:void 0);GameHeader(K,{onRestart:O,get onGiveUp(){return get$2(ae)},get showGiveUp(){return t()},onShowRules:D})}var se=sibling(K,2),me=child(se),z=child(me),V=sibling(child(z)),oe=child(V),U=sibling(z,2),j=sibling(child(U)),ne=child(j),te=sibling(me,2);each(te,21,()=>o,index$1,(ae,H,F)=>{var W=root_2$g(),X=child(W),le=child(X),Ee=sibling(X,2),Q=child(Ee);template_effect(ye=>{set_style(W,ye),W.disabled=get$2(y)||get$2(w),set_text(le,get$2(H).icon),set_text(Q,get$2(H).name)},[()=>M(F)]),delegated("click",W,()=>G(F)),append(ae,W)});var fe=sibling(te,2),ce=child(fe);{var we=ae=>{var H=root_3$h(),F=child(H),W=child(F);template_effect(()=>set_text(W,`  ...  ${get$2(m)-1}`)),append(ae,H)},$e=ae=>{var H=root_4$g();append(ae,H)},he=ae=>{var H=root_5$f();append(ae,H)};if_block(ce,ae=>{get$2(w)?ae(we):get$2(y)?ae($e,1):ae(he,!1)})}var ue=sibling(fe,2);{var Z=ae=>{var H=root_6$d(),F=child(H);template_effect(()=>set_text(F,`: ${get$2(h).length??""} / ${get$2(v).length??""}`)),append(ae,H)};if_block(ue,ae=>{get$2(v).length>0&&!get$2(w)&&!get$2(y)&&ae(Z)})}var ge=sibling(se,2);GameFooter(ge,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ae,H)=>{var F=root_7$b(),W=child(F),X=sibling(child(W)),le=child(X);template_effect(()=>set_text(le,`${get$2(m)??""}/10`)),append(ae,F)},$$slots:{default:!0}});var Se=sibling(ge,2);MinigameModal(Se,{get modal(){return get$2(I)}}),template_effect(()=>{set_text(oe,get$2(m)),set_text(ne,get$2(k))}),append(N,ie)}}),pop()}delegate(["click"]);var root_2$f=from_html('<button class="rune-btn svelte-mwra7e"> </button>'),root_1$f=from_html('<!> <div id="game-container" class="svelte-mwra7e"><div class="score-board svelte-mwra7e"><div class="score player svelte-mwra7e"><span class="label svelte-mwra7e"></span> <span class="value svelte-mwra7e"> </span></div> <div class="vs svelte-mwra7e">VS</div> <div class="score computer svelte-mwra7e"><span class="label svelte-mwra7e"></span> <span class="value svelte-mwra7e"> </span></div></div> <div class="battle-area svelte-mwra7e"><div class="choice-display player-choice svelte-mwra7e"><div class="rune-icon svelte-mwra7e"> </div> <div class="choice-label svelte-mwra7e"> </div></div> <div class="versus-symbol svelte-mwra7e"></div> <div class="choice-display computer-choice svelte-mwra7e"><div class="rune-icon svelte-mwra7e"> </div> <div class="choice-label svelte-mwra7e"> </div></div></div> <div class="result-message svelte-mwra7e"> </div> <div class="rune-panel svelte-mwra7e"></div> <div class="round-indicator svelte-mwra7e"> </div></div> <!> <!>',1);function RunesOfFate(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=["","",""],c={"":"","":"","":""};let f=state(null),v=state(null),h=state(0),m=state(0),y=state(0),g=5,w=state(!1),k=state(""),I=state(!1),O=state(proxy({show:!1,title:"",text:"",actions:[]}));function B(){const D=Math.floor(Math.random()*o.length);return o[D]}function P(D,N){if(D===N)return"tie";const q=`${D}${N}`;return c[q]===D?"player":"computer"}async function G(D){if(get$2(w)||get$2(I)||get$2(y)>=g)return;set(w,!0),set(f,D,!0),set(v,null),set(k," ..."),await new Promise(q=>setTimeout(q,800)),set(v,B(),!0);const N=P(get$2(f),get$2(v));N==="player"?(update(h),set(k,"!    !")):N==="computer"?(update(m),set(k,"...  ")):set(k,".  "),update(y),get$2(y)>=g&&(set(I,!0),get$2(h)>get$2(m)?t()?setTimeout(()=>e.onWin?.(),1e3):M(" !",`   ${get$2(h)}:${get$2(m)}!`,[{text:" ",action:Y}]):t()?setTimeout(()=>e.onLose?.(),1e3):M(" ",`   ${get$2(m)}:${get$2(h)}`,[{text:" ",action:Y}])),set(w,!1)}function Y(){set(f,null),set(v,null),set(h,0),set(m,0),set(y,0),set(I,!1),set(k,""),T()}function M(D,N,q){set(O,{show:!0,title:D,text:N,actions:q},!0)}function T(){get$2(O).show=!1}function x(){M(" ",` :

    
    
    

,   3   5 ,   !`,[{text:"",action:T}])}BodyWrapper(r,{children:(D,N)=>{var q=root_1$f(),ie=first_child(q);{let W=user_derived(()=>t()?()=>e.onLose?.():void 0);GameHeader(ie,{onRestart:Y,get onGiveUp(){return get$2(W)},get showGiveUp(){return t()},onShowRules:x})}var K=sibling(ie,2),se=child(K),me=child(se),z=sibling(child(me),2),V=child(z),oe=sibling(me,4),U=sibling(child(oe),2),j=child(U),ne=sibling(se,2),te=child(ne),fe=child(te),ce=child(fe),we=sibling(te,4),$e=child(we),he=child($e),ue=sibling(ne,2),Z=child(ue),ge=sibling(ue,2);each(ge,21,()=>o,index$1,(W,X)=>{var le=root_2$f(),Ee=child(le);template_effect(()=>{le.disabled=get$2(w)||get$2(I)||get$2(y)>=g,set_text(Ee,get$2(X))}),delegated("click",le,()=>G(get$2(X))),append(W,le)});var Se=sibling(ge,2),ae=child(Se),H=sibling(K,2);GameFooter(H,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()}});var F=sibling(H,2);MinigameModal(F,{get modal(){return get$2(O)}}),template_effect(()=>{set_text(V,get$2(h)),set_text(j,get$2(m)),set_text(ce,get$2(f)||""),set_text(he,get$2(v)||""),set_text(Z,get$2(k)),set_text(ae,`: ${get$2(y)??""} / 5`)}),append(D,q)}}),pop()}delegate(["click"]);var root_2$e=from_html('<div class="start-screen svelte-11vcbyy"><h2 class="svelte-11vcbyy">   </h2> <p class="svelte-11vcbyy">    !</p> <button type="button" class="start-btn svelte-11vcbyy"> </button></div>'),root_5$e=from_html("<span> </span>"),root_4$f=from_html('<div class="current-recipe svelte-11vcbyy"><div class="recipe-name svelte-11vcbyy"> </div> <div class="recipe-ingredients svelte-11vcbyy"></div> <div class="recipe-progress svelte-11vcbyy"> </div></div>'),root_6$c=from_html('<button type="button" class="floating-item svelte-11vcbyy"> </button>'),root_3$g=from_html('<div class="game-header svelte-11vcbyy"><div class="score svelte-11vcbyy"> </div> <div> </div></div> <!> <div class="game-area svelte-11vcbyy"><div class="cauldron svelte-11vcbyy"> <div class="cauldron-fire svelte-11vcbyy"></div></div> <div class="floating-items svelte-11vcbyy"></div></div> <div class="instructions svelte-11vcbyy"><p class="svelte-11vcbyy">   !</p> <p class="svelte-11vcbyy">   </p></div>',1),root_7$a=from_html('<div class="footer-stats svelte-11vcbyy"><span class="target-info svelte-11vcbyy">: <strong class="svelte-11vcbyy"></strong> </span></div>'),root_1$e=from_html('<!> <div id="game-container" class="svelte-11vcbyy"><!></div> <!> <!>',1);function WitchesCauldrons(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=[{id:"frog",icon:"",name:" "},{id:"spider",icon:"",name:" "},{id:"bat",icon:"",name:"  "},{id:"skull",icon:"",name:" "},{id:"mushroom",icon:"",name:" "},{id:"potion",icon:"",name:" "},{id:"bone",icon:"",name:""},{id:"web",icon:"",name:""}],c=[{name:" ",ingredients:["","",""]},{name:" ",ingredients:["","",""]},{name:"",ingredients:["","",""]},{name:" ",ingredients:["","",""]}],f=1e3,v=20,h=60;let m=state(null),y=state(proxy([])),g=state(0),w=state(h),k=state(!1),I=state(proxy([])),O,B,P=state(!1),G=state(proxy({show:!1,title:"",text:"",actions:[]}));function Y(){set(k,!0),set(P,!0),set(g,0),set(w,h),set(y,[],!0),T(),O=setInterval(()=>{update(w,-1),get$2(w)<=0&&M()},1e3),B=setInterval(()=>{get$2(k)&&x()},800)}function M(){set(k,!1),clearInterval(O),clearInterval(B),get$2(g)>=v?t()?(q("  !",`: ${get$2(g)}`,[]),setTimeout(()=>{ie(),e.onWin?.()},f)):q("  !",`: ${get$2(g)}`,[{text:" ",action:Y}]):t()?(q("  ",`: ${get$2(g)}`,[]),setTimeout(()=>{ie(),e.onLose?.()},f)):q("  ",`: ${get$2(g)}`,[{text:" ",action:Y}])}function T(){const se=Math.floor(Math.random()*c.length);set(m,c[se],!0),set(y,[],!0)}function x(){const se=o[Math.floor(Math.random()*o.length)],me=Math.random()*80+10,V={id:`${se.id}-${Date.now()}-${Math.random()}`,icon:se.icon,x:me,y:-10};set(I,[...get$2(I),V],!0),setTimeout(()=>{set(I,get$2(I).filter(oe=>oe.id!==V.id),!0)},5e3)}function D(se,me){!get$2(k)||!get$2(m)||(set(I,get$2(I).filter(z=>z.id!==me),!0),get$2(m).ingredients.includes(se)&&!get$2(y).includes(se)?(set(y,[...get$2(y),se],!0),set(g,get$2(g)+10),get$2(y).length===get$2(m).ingredients.length&&(set(g,get$2(g)+50),T())):set(g,Math.max(0,get$2(g)-5),!0))}function N(){return get$2(m)?get$2(m).ingredients.map(se=>get$2(y).includes(se)?se:"").join(" + "):""}function q(se,me,z){set(G,{show:!0,title:se,text:me,actions:z},!0)}function ie(){get$2(G).show=!1}function K(){q(" ",` :

 :  {WIN_SCORE}   {GAME_TIME} .

     .

    .

  : +10 .

  : +50 .

  : -5 .`,[{text:"",action:ie}])}onDestroy(()=>{clearInterval(O),clearInterval(B)}),BodyWrapper(r,{children:(se,me)=>{var z=root_1$e(),V=first_child(z);{let ce=user_derived(()=>t()?()=>{set(k,!1),clearInterval(O),clearInterval(B),q(" "," ...",[]),setTimeout(()=>{ie(),e.onLose?.()},f)}:void 0);GameHeader(V,{onRestart:Y,get onGiveUp(){return get$2(ce)},get showGiveUp(){return t()},onShowRules:K})}var oe=sibling(V,2),U=child(oe);{var j=ce=>{var we=root_2$e(),$e=sibling(child(we),4);delegated("click",$e,Y),append(ce,we)},ne=ce=>{var we=root_3$g(),$e=first_child(we),he=child($e),ue=child(he),Z=sibling(he,2);let ge;var Se=child(Z),ae=sibling($e,2);{var H=X=>{var le=root_4$f(),Ee=child(le),Q=child(Ee),ye=sibling(Ee,2);each(ye,21,()=>get$2(m).ingredients,index$1,(Me,E)=>{var d=root_5$e();let p;var A=child(d);template_effect((L,ee)=>{p=set_class(d,1,"ingredient-icon svelte-11vcbyy",null,p,L),set_text(A,ee)},[()=>({collected:get$2(y).includes(get$2(E))}),()=>get$2(y).includes(get$2(E))?get$2(E):""]),append(Me,d)});var be=sibling(ye,2),ke=child(be);template_effect(Me=>{set_text(Q,get$2(m).name),set_text(ke,Me)},[N]),append(X,le)};if_block(ae,X=>{get$2(m)&&X(H)})}var F=sibling(ae,2),W=sibling(child(F),2);each(W,21,()=>get$2(I),index$1,(X,le)=>{var Ee=root_6$c(),Q=child(Ee);template_effect(()=>{set_style(Ee,`left: ${get$2(le).x??""}%; top: ${get$2(le).y??""}%;`),set_text(Q,get$2(le).icon)}),delegated("click",Ee,()=>D(get$2(le).icon,get$2(le).id)),append(X,Ee)}),template_effect(()=>{set_text(ue,` ${get$2(g)??""}`),ge=set_class(Z,1,"timer svelte-11vcbyy",null,ge,{danger:get$2(w)<=10}),set_text(Se,` ${get$2(w)??""}`)}),append(ce,we)};if_block(U,ce=>{get$2(P)?get$2(k)&&ce(ne,1):ce(j)})}var te=sibling(oe,2);GameFooter(te,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(ce,we)=>{var $e=root_7$a(),he=child($e),ue=sibling(child(he));ue.textContent="20",append(ce,$e)},$$slots:{default:!0}});var fe=sibling(te,2);MinigameModal(fe,{get modal(){return get$2(G)}}),append(se,z)}}),pop()}delegate(["click"]);var root_2$d=from_html("<span> </span>"),root_3$f=from_html('<button type="button" class="num-btn svelte-gpwe9t"> </button>'),root_4$e=from_html('<button type="button" class="op-btn svelte-gpwe9t"> </button>'),root_5$d=from_html("<div> </div>"),root_6$b=from_html('<div class="footer-stats svelte-gpwe9t"><span class="target-info svelte-gpwe9t">: <strong class="svelte-gpwe9t"> </strong></span></div>'),root_1$d=from_html('<!> <div id="game-container" class="svelte-gpwe9t"><div class="target-number svelte-gpwe9t"><div class="target-label svelte-gpwe9t">:</div> <div class="target-value svelte-gpwe9t"> </div></div> <div class="expression-area svelte-gpwe9t"><!> <span class="expr-cursor svelte-gpwe9t">_</span></div> <div class="numbers-panel svelte-gpwe9t"><div class="numbers-grid svelte-gpwe9t"></div></div> <div class="operations-grid svelte-gpwe9t"></div> <div class="action-buttons svelte-gpwe9t"><button type="button" class="action-btn svelte-gpwe9t"></button> <button type="button" class="action-btn svelte-gpwe9t"></button> <button type="button" class="action-btn primary svelte-gpwe9t"></button></div> <!></div> <!> <!>',1);function AlchemicalCalculator(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),n=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),s=prop(e,"bucketName",3,"dracula");const o=[{symbol:"+",func:(K,se)=>K+se},{symbol:"",func:(K,se)=>K-se},{symbol:"",func:(K,se)=>K*se},{symbol:"",func:(K,se)=>K/se}],c=1e3;let f=state(proxy([])),v=state(0),h=state(proxy([])),m=state(proxy([])),y=state(proxy([])),g=state(!1),w=state(!1),k=state(""),I=state(proxy({show:!1,title:"",text:"",actions:[]}));function O(){const K=Array(4).fill(0).map(()=>Math.floor(Math.random()*12)+1);set(f,[...K],!0),set(m,[...K],!0),set(v,Math.floor(K.reduce((se,me)=>se+me,0)/2)+2),set(y,[...o],!0),set(h,[],!0),set(k,""),set(g,!1),set(w,!1)}function B(K){get$2(g)||get$2(m).includes(K)&&(set(h,[...get$2(h),{type:"number",value:K,id:`${K}-${Date.now()}-${Math.random()}`}],!0),set(m,get$2(m).filter(se=>se!==K),!0))}function P(K){if(get$2(g))return;const se=get$2(h)[get$2(h).length-1];se&&se.type==="number"&&get$2(h).length<7&&set(h,[...get$2(h),{type:"operation",value:K.symbol,id:`${K.symbol}-${Date.now()}-${Math.random()}`}],!0)}function G(){if(get$2(h).length<3)return null;let K=get$2(h)[0].value;for(let se=1;se<get$2(h).length;se+=2){const me=get$2(h)[se],z=get$2(h)[se+1];if(me.type!=="operation"||!z||z.type!=="number")return null;const V=o.find(oe=>oe.symbol===me.value)?.func;if(!V)return null;K=V(K,z.value)}return K}function Y(){if(get$2(m).length>0){set(k,"  !");return}const K=G();if(K===null){set(k," ");return}Math.abs(K-get$2(v))<.01?(set(k," !  ! "),set(g,!0),set(w,!0),t()?(N(" !"," !",[]),setTimeout(()=>{q(),e.onWin?.()},c)):N(" !"," !",[{text:" ",action:x}])):set(k,`  ${K.toFixed(1)},  ${get$2(v)}`)}function M(){set(m,[...get$2(f)],!0),set(h,[],!0),set(k,"")}function T(){const K=[...get$2(h)],se=K.pop();se&&se.type==="number"&&set(m,[...get$2(m),se.value].sort((me,z)=>me-z),!0),set(h,K,!0)}function x(){O(),q()}function D(){set(g,!0),t()?(N(" "," ...",[]),setTimeout(()=>{q(),e.onLose?.()},c)):N("","  !",[{text:" ",action:x}])}function N(K,se,me){set(I,{show:!0,title:K,text:se,actions:me},!0)}function q(){get$2(I).show=!1}function ie(){N(" ",` :

 :     ,   .

  4   1  12.

    .

  :  .`,[{text:"",action:q}])}onMount(()=>{x()}),BodyWrapper(r,{children:(K,se)=>{var me=root_1$d(),z=first_child(me);{let F=user_derived(()=>t()?D:void 0);GameHeader(z,{onRestart:x,get onGiveUp(){return get$2(F)},get showGiveUp(){return t()},onShowRules:ie})}var V=sibling(z,2),oe=child(V),U=sibling(child(oe),2),j=child(U),ne=sibling(oe,2),te=child(ne);each(te,17,()=>get$2(h),index$1,(F,W)=>{var X=root_2$d(),le=child(X);template_effect(()=>{set_class(X,1,`expr-item expr-${get$2(W).type??""}`,"svelte-gpwe9t"),set_text(le,get$2(W).value)}),append(F,X)});var fe=sibling(ne,2),ce=child(fe);each(ce,21,()=>get$2(m),index$1,(F,W)=>{var X=root_3$f(),le=child(X);template_effect(()=>{X.disabled=get$2(g),set_text(le,get$2(W))}),delegated("click",X,()=>B(get$2(W))),append(F,X)});var we=sibling(fe,2);each(we,21,()=>o,index$1,(F,W)=>{var X=root_4$e(),le=child(X);template_effect(()=>{X.disabled=get$2(g),set_text(le,get$2(W).symbol)}),delegated("click",X,()=>P(get$2(W))),append(F,X)});var $e=sibling(we,2),he=child($e),ue=sibling(he,2),Z=sibling(ue,2),ge=sibling($e,2);{var Se=F=>{var W=root_5$d();let X;var le=child(W);template_effect(Ee=>{X=set_class(W,1,"message svelte-gpwe9t",null,X,Ee),set_text(le,get$2(k))},[()=>({success:get$2(k).includes("")})]),append(F,W)};if_block(ge,F=>{get$2(k)&&F(Se)})}var ae=sibling(V,2);GameFooter(ae,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return s()},children:(F,W)=>{var X=root_6$b(),le=child(X),Ee=sibling(child(le)),Q=child(Ee);template_effect(()=>set_text(Q,get$2(v))),append(F,X)},$$slots:{default:!0}});var H=sibling(ae,2);MinigameModal(H,{get modal(){return get$2(I)}}),template_effect(()=>{set_text(j,get$2(v)),he.disabled=get$2(h).length===0||get$2(g),ue.disabled=get$2(h).length===0||get$2(g),Z.disabled=get$2(g)}),delegated("click",he,T),delegated("click",ue,M),delegated("click",Z,Y),append(K,me)}}),pop()}delegate(["click"]);const gameComponents={memo_monsters:MemoMonsters,onet_monsters:OnetMonsters,onet_monsters_144:OnetMonsters144,evolution_2048:Evolution2048,whisper_of_spiders:WhisperOfSpiders,tower_of_souls:TowerOfSouls,soul_cycle:SoulCycle,labyrinth_of_minotaur:LabyrinthOfMinotaur,cursed_crypts:CursedCrypts,broken_mirror:BrokenMirror,alchemists_cross:AlchemistsCross,tic_tac_toe:TicTacToe,light_out:LightOut,flood_it:FloodIt,bones_421:Bones421,crystals_of_time:CrystalsOfTime,runes_of_fate:RunesOfFate,witches_cauldrons:WitchesCauldrons,alchemical_calculator:AlchemicalCalculator},gamesList=[{id:"memo_monsters",name:" ",description:"    ",icon:"",filename:"MemoMonsters.svelte",category:"memory"},{id:"onet_monsters",name:"  min",description:"   ",icon:"",filename:"OnetMonsters.svelte",category:"puzzle"},{id:"onet_monsters_144",name:"  middle",description:"    (144 )",icon:"",filename:"OnetMonsters144.svelte",category:"puzzle"},{id:"evolution_2048",name:" 2048",description:"    2048",icon:"",filename:"Evolution2048.svelte",category:"puzzle"},{id:"whisper_of_spiders",name:" ",description:"    30 ",icon:"",filename:"WhisperOfSpiders.svelte",category:"arcade"},{id:"tower_of_souls",name:" ",description:"  -    ",icon:"",filename:"TowerOfSouls.svelte",category:"board"},{id:"soul_cycle",name:" ",description:"  ",icon:"",filename:"SoulCycle.svelte",category:"memory"},{id:"labyrinth_of_minotaur",name:" ",description:"   ",icon:"",filename:"LabyrinthOfMinotaur.svelte",category:"puzzle"},{id:"cursed_crypts",name:" ",description:" -    ",icon:"",filename:"CursedCrypts.svelte",category:"puzzle"},{id:"broken_mirror",name:" ",description:"   1  15",icon:"",filename:"BrokenMirror.svelte",category:"puzzle"},{id:"alchemists_cross",name:" ",description:"- -   3  ",icon:"",filename:"AlchemistsCross.svelte",category:"board"},{id:"tic_tac_toe",name:"-",description:" - 3x3",icon:"",filename:"TicTacToe.svelte",category:"board"},{id:"light_out",name:" ",description:"    ",icon:"",filename:"LightOut.svelte",category:"logic"},{id:"flood_it",name:" ",description:"       ",icon:"",filename:"FloodIt.svelte",category:"logic"},{id:"bones_421",name:" 4-2-1",description:"     4-2-1",icon:"",filename:"Bones421.svelte",category:"board"},{id:"crystals_of_time",name:" ",description:"  ",icon:"",filename:"CrystalsOfTime.svelte",category:"memory"},{id:"runes_of_fate",name:" ",description:"    ",icon:"",filename:"RunesOfFate.svelte",category:"board"},{id:"witches_cauldrons",name:" ",description:"   ",icon:"",filename:"WitchesCauldrons.svelte",category:"arcade"},{id:"alchemical_calculator",name:" ",description:"     ",icon:"",filename:"AlchemicalCalculator.svelte",category:"logic"}];function getGameById(r){return gamesList.find(e=>e.id===r)}const categoryNames={puzzle:"",memory:"",logic:"",arcade:"",board:"",other:""};var root_1$c=from_html("<option> </option>"),root_3$e=from_html("<option> </option>"),root_4$d=from_html("<option> </option>"),root_5$c=from_html("<option> </option>"),root_6$a=from_html("<option> </option>"),root_2$c=from_html('<div class="minigame-details svelte-1jt6h90"><div class="form-group svelte-1jt6h90"><label>ID </label> <select class="input select"><option>--   --</option><!></select></div> <div class="form-row svelte-1jt6h90"><div class="form-group svelte-1jt6h90"><label>  </label> <select class="input select"><option>--  --</option><!></select></div> <div class="form-group svelte-1jt6h90"><label>  </label> <select class="input select"><option>--  --</option><!></select></div></div> <div class="form-group svelte-1jt6h90"><label> ()</label> <select class="input select"><option>--   --</option><!></select></div></div>'),root_7$9=from_html("<option> </option>"),root_9$3=from_html("<option> </option>"),root_8$5=from_html('<div class="form-group full-width svelte-1jt6h90"><label></label> <select class="input select"><option>--   --</option><!></select></div>'),root_10$4=from_html('<div class="form-group svelte-1jt6h90"><label></label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-1jt6h90"><label> ></label> <input type="number" class="input"/></div>',1),root_11$2=from_html('<div class="form-group full-width svelte-1jt6h90"><label> </label> <input type="text" class="input" placeholder="metDracula"/></div>'),root$d=from_html('<div class="option-details svelte-1jt6h90"><div class="form-group"><label> </label> <input type="text" class="input"/></div> <div class="form-group"><label></label> <select class="input select"><option>--   --</option><!></select></div> <div class="minigame-section svelte-1jt6h90"><div class="section-header svelte-1jt6h90"><label class="checkbox-row svelte-1jt6h90"><input type="checkbox"/>  -</label></div> <!></div> <div class="options-settings-grid svelte-1jt6h90"><div class="setting-col svelte-1jt6h90"><label class="checkbox-row svelte-1jt6h90"><input type="checkbox"/>  (Enable)</label> <p class="setting-desc svelte-1jt6h90"> ,     .</p></div> <div class="setting-col svelte-1jt6h90"><label class="checkbox-row svelte-1jt6h90"><input type="checkbox"/>  (Visible)</label> <p class="setting-desc svelte-1jt6h90"> ,    .</p></div></div> <div class="trigger-section svelte-1jt6h90"><h5 class="svelte-1jt6h90"> </h5> <div class="form-row svelte-1jt6h90"><div class="form-group svelte-1jt6h90"><label> </label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function OptionEditor(r,e){push(e,!0);const t=prop(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return n(),t().visibilityCondition}function s(F){n();const W=t().visibilityCondition;Object.assign(W,F),t().visibilityCondition={...W}}function o(F){n();const W={type:F};switch(F){case"has_item":W.itemId=i().itemId||"";break;case"stat_greater":W.statName=i().statName||"",W.statValue=i().statValue||0;break;case"flag_true":W.flagName=i().flagName||"";break}t().visibilityCondition=W}const c=user_derived(()=>!!t().miniGame);function f(F){F?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function v(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function h(F,W){const X=v();X&&(X[F]=W)}var m=root$d(),y=child(m),g=child(y),w=sibling(g,2),k=sibling(y,2),I=child(k),O=sibling(I,2),B=child(O);B.value=B.__value="";var P=sibling(B);each(P,17,()=>e.dialogues,F=>F.id,(F,W)=>{var X=root_1$c(),le=child(X),Ee={};template_effect(Q=>{set_text(le,`${get$2(W).id??""}: ${Q??""}...`),Ee!==(Ee=get$2(W).id)&&(X.value=(X.__value=get$2(W).id)??"")},[()=>get$2(W).text.substring(0,30)]),append(F,X)});var G=sibling(k,2),Y=child(G),M=child(Y),T=child(M),x=sibling(Y,2);{var D=F=>{var W=root_2$c(),X=child(W),le=child(X),Ee=sibling(le,2),Q=child(Ee);Q.value=Q.__value="";var ye=sibling(Q);each(ye,17,()=>gamesList,We=>We.id,(We,Pe)=>{var Be=root_3$e(),ze=child(Be),ot={};template_effect(()=>{set_text(ze,`${get$2(Pe).icon??""} ${get$2(Pe).name??""}`),ot!==(ot=get$2(Pe).id)&&(Be.value=(Be.__value=get$2(Pe).id)??"")}),append(We,Be)});var be;init_select(Ee);var ke=sibling(X,2),Me=child(ke),E=child(Me),d=sibling(E,2),p=child(d);p.value=p.__value="";var A=sibling(p);each(A,17,()=>e.dialogues,We=>We.id,(We,Pe)=>{var Be=root_4$d(),ze=child(Be),ot={};template_effect(qe=>{set_text(ze,`${get$2(Pe).id??""}: ${qe??""}...`),ot!==(ot=get$2(Pe).id)&&(Be.value=(Be.__value=get$2(Pe).id)??"")},[()=>get$2(Pe).text.substring(0,30)]),append(We,Be)});var L;init_select(d);var ee=sibling(Me,2),pe=child(ee),Ce=sibling(pe,2),Oe=child(Ce);Oe.value=Oe.__value="";var Te=sibling(Oe);each(Te,17,()=>e.dialogues,We=>We.id,(We,Pe)=>{var Be=root_5$c(),ze=child(Be),ot={};template_effect(qe=>{set_text(ze,`${get$2(Pe).id??""}: ${qe??""}...`),ot!==(ot=get$2(Pe).id)&&(Be.value=(Be.__value=get$2(Pe).id)??"")},[()=>get$2(Pe).text.substring(0,30)]),append(We,Be)});var Le;init_select(Ce);var Fe=sibling(ke,2),He=child(Fe),Ue=sibling(He,2),Xe=child(Ue);Xe.value=Xe.__value="";var st=sibling(Xe);each(st,17,()=>e.availableItems,We=>We.id,(We,Pe)=>{var Be=root_6$a(),ze=child(Be),ot={};template_effect(()=>{set_text(ze,get$2(Pe).name),ot!==(ot=get$2(Pe).id)&&(Be.value=(Be.__value=get$2(Pe).id)??"")}),append(We,Be)});var tt;init_select(Ue),template_effect((We,Pe,Be,ze)=>{set_attribute(le,"for",`option-mg-id-${e.index??""}`),set_attribute(Ee,"id",`option-mg-id-${e.index??""}`),be!==(be=We)&&(Ee.value=(Ee.__value=We)??"",select_option(Ee,We)),set_attribute(E,"for",`option-mg-win-${e.index??""}`),set_attribute(d,"id",`option-mg-win-${e.index??""}`),L!==(L=Pe)&&(d.value=(d.__value=Pe)??"",select_option(d,Pe)),set_attribute(pe,"for",`option-mg-lose-${e.index??""}`),set_attribute(Ce,"id",`option-mg-lose-${e.index??""}`),Le!==(Le=Be)&&(Ce.value=(Ce.__value=Be)??"",select_option(Ce,Be)),set_attribute(He,"for",`option-mg-reward-${e.index??""}`),set_attribute(Ue,"id",`option-mg-reward-${e.index??""}`),tt!==(tt=ze)&&(Ue.value=(Ue.__value=ze)??"",select_option(Ue,ze))},[()=>v().id,()=>v().onWinDialogueId,()=>v().onLoseDialogueId,()=>v().rewardItem||""]),delegated("change",Ee,We=>{const Pe=We.target;h("id",Pe.value)}),delegated("change",d,We=>{const Pe=We.target;h("onWinDialogueId",Pe.value)}),delegated("change",Ce,We=>{const Pe=We.target;h("onLoseDialogueId",Pe.value)}),delegated("change",Ue,We=>{const Pe=We.target;h("rewardItem",Pe.value)}),append(F,W)},N=user_derived(()=>v());if_block(x,F=>{get$2(N)&&F(D)})}var q=sibling(G,2),ie=child(q),K=child(ie),se=child(K),me=sibling(ie,2),z=child(me),V=child(z),oe=sibling(q,2),U=sibling(child(oe),2),j=child(U),ne=child(j),te=sibling(ne,2);each(te,20,()=>e.conditionTypes,F=>F,(F,W)=>{var X=root_7$9(),le=child(X),Ee={};template_effect(()=>{set_text(le,W),Ee!==(Ee=W)&&(X.value=(X.__value=W)??"")}),append(F,X)});var fe;init_select(te);var ce=sibling(j,2);{var we=F=>{var W=root_8$5(),X=child(W),le=sibling(X,2),Ee=child(le);Ee.value=Ee.__value="";var Q=sibling(Ee);each(Q,17,()=>e.availableItems,be=>be.id,(be,ke)=>{var Me=root_9$3(),E=child(Me),d={};template_effect(()=>{set_text(E,get$2(ke).name),d!==(d=get$2(ke).id)&&(Me.value=(Me.__value=get$2(ke).id)??"")}),append(be,Me)});var ye;init_select(le),template_effect(be=>{set_attribute(X,"for",`option-cond-item-${e.index??""}`),set_attribute(le,"id",`option-cond-item-${e.index??""}`),ye!==(ye=be)&&(le.value=(le.__value=be)??"",select_option(le,be))},[()=>i().itemId||""]),delegated("change",le,be=>{const ke=be.target;s({itemId:ke.value})}),append(F,W)},$e=user_derived(()=>i().type==="has_item");if_block(ce,F=>{get$2($e)&&F(we)})}var he=sibling(ce,2);{var ue=F=>{var W=root_10$4(),X=first_child(W),le=child(X),Ee=sibling(le,2),Q=sibling(X,2),ye=child(Q),be=sibling(ye,2);template_effect((ke,Me)=>{set_attribute(le,"for",`option-cond-stat-${e.index??""}`),set_attribute(Ee,"id",`option-cond-stat-${e.index??""}`),set_value(Ee,ke),set_attribute(ye,"for",`option-cond-stat-val-${e.index??""}`),set_attribute(be,"id",`option-cond-stat-val-${e.index??""}`),set_value(be,Me)},[()=>i().statName||"",()=>i().statValue||0]),delegated("input",Ee,ke=>{const Me=ke.target;s({statName:Me.value})}),delegated("input",be,ke=>{const Me=ke.target,E=parseInt(Me.value);s({statValue:isNaN(E)?0:E})}),append(F,W)},Z=user_derived(()=>i().type==="stat_greater");if_block(he,F=>{get$2(Z)&&F(ue)})}var ge=sibling(he,2);{var Se=F=>{var W=root_11$2(),X=child(W),le=sibling(X,2);template_effect(Ee=>{set_attribute(X,"for",`option-cond-flag-${e.index??""}`),set_attribute(le,"id",`option-cond-flag-${e.index??""}`),set_value(le,Ee)},[()=>i().flagName||""]),delegated("input",le,Ee=>{const Q=Ee.target;s({flagName:Q.value})}),append(F,W)},ae=user_derived(()=>i().type==="flag_true");if_block(ge,F=>{get$2(ae)&&F(Se)})}var H=sibling(U,2);if_block(H,F=>{}),template_effect(F=>{set_attribute(g,"for",`option-text-${e.index??""}`),set_attribute(w,"id",`option-text-${e.index??""}`),set_attribute(I,"for",`option-next-${e.index??""}`),set_attribute(O,"id",`option-next-${e.index??""}`),set_checked(T,get$2(c)),set_attribute(ne,"for",`option-cond-type-${e.index??""}`),set_attribute(te,"id",`option-cond-type-${e.index??""}`),fe!==(fe=F)&&(te.value=(te.__value=F)??"",select_option(te,F))},[()=>i().type]),bind_value(w,()=>t().text,F=>t().text=F),bind_select_value(O,()=>t().nextDialogueId,F=>t().nextDialogueId=F),delegated("change",T,F=>{const W=F.target;f(W.checked)}),bind_checked(se,()=>t().enabled,F=>t().enabled=F),bind_checked(V,()=>t().visible,F=>t().visible=F),delegated("change",te,F=>{const W=F.target;o(W.value)}),append(r,m),pop()}delegate(["change","input"]);var $$_import_editor$2=reactive_import(()=>editor),$$_import_editorDerived=reactive_import(()=>editorDerived),root_2$b=from_html("<option> <!></option>"),root_4$c=from_html("<option> </option>"),root_5$b=from_html("<option> </option>"),root_6$9=from_html("<option> </option>"),root_7$8=from_html("<option> </option>"),root_12=from_html('<div class="option-content svelte-132ju9k"><!></div>'),root_8$4=from_html('<div><div class="option-header-row svelte-132ju9k"><div class="option-header svelte-132ju9k" role="button" tabindex="0"><span class="status-icons svelte-132ju9k"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label=" "></button></div> <!></div>'),root_13$1=from_html('<div class="empty-links svelte-132ju9k"> </div>'),root_15$2=from_html('<div class="link-item svelte-132ju9k"><span class="link-type svelte-132ju9k"> </span> <span class="link-id svelte-132ju9k"> </span> <button class="btn-jump svelte-132ju9k" title="  "></button> <span class="link-text svelte-132ju9k"> </span></div>'),root_14$1=from_html('<div class="links-list svelte-132ju9k"></div>'),root_16$1=from_html('<div class="empty-links svelte-132ju9k">  </div>'),root_18$1=from_html('<div class="link-item svelte-132ju9k"><span class="link-id svelte-132ju9k"> </span> <span> </span> <button class="btn-jump svelte-132ju9k" title="  "></button> <span class="link-text svelte-132ju9k"> </span></div>'),root_19=from_html('<div class="more-links svelte-132ju9k"> </div>'),root_17$1=from_html('<div class="links-list svelte-132ju9k"><!> <!></div>'),root_20=from_html("<option> </option>"),root_1$b=from_html('<div class="dialogue-form svelte-132ju9k"><div class="form-group svelte-132ju9k"><label for="dialogue-id" class="svelte-132ju9k">ID </label> <input type="text" id="dialogue-id" class="input svelte-132ju9k"/></div> <div class="form-group svelte-132ju9k"><label for="dialogue-chapter" class="svelte-132ju9k"></label> <select id="dialogue-chapter" class="input select svelte-132ju9k"><option>--   --</option><!></select></div> <div class="form-group svelte-132ju9k"><label for="dialogue-text" class="svelte-132ju9k"></label> <textarea id="dialogue-text" class="textarea svelte-132ju9k" rows="3"></textarea></div> <div class="media-section svelte-132ju9k"><h4 class="svelte-132ju9k"> </h4> <div class="form-group svelte-132ju9k"><label for="dialogue-background" class="svelte-132ju9k"></label> <div class="input-group svelte-132ju9k"><select id="dialogue-background" class="input select svelte-132ju9k"><option>--  --</option><!><!></select> <label class="btn-file svelte-132ju9k"> <input type="file" accept="image/*,.riv" hidden=""/></label></div></div> <div class="form-group svelte-132ju9k"><label for="dialogue-character" class="svelte-132ju9k"></label> <div class="input-group svelte-132ju9k"><select id="dialogue-character" class="input select svelte-132ju9k"><option>--  --</option><!><!></select></div></div></div> <div class="options-section svelte-132ju9k"><div class="section-header svelte-132ju9k"><h4 class="svelte-132ju9k"> </h4> <button class="btn small">+ </button></div> <!></div> <div class="links-section svelte-132ju9k"><div class="links-grid svelte-132ju9k"><div class="link-block svelte-132ju9k"><h5 class="svelte-132ju9k"> </h5> <!></div> <div class="link-block secondary svelte-132ju9k"><h5 class="svelte-132ju9k"> </h5> <!></div></div></div> <div class="links-section svelte-132ju9k"><h4 class="svelte-132ju9k">-</h4> <select class="input select svelte-132ju9k"><option>--  --</option><!></select></div> <div class="form-actions svelte-132ju9k"><button class="btn danger"> </button></div></div>'),root_21=from_html('<div class="empty-state"> </div>');function DialogueForm(r,e){push(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(y){y.options||(y.options=[]);const g=createNewOption();y.options.push(g),$$_import_editor$2($$_import_editor$2().editingOptionIndex=y.options.length-1)}function i(y){if($$_import_editor$2().editingOptionIndex===y)$$_import_editor$2($$_import_editor$2().editingOptionIndex=null);else{$$_import_editor$2($$_import_editor$2().editingOptionIndex=y);const g=$$_import_editorDerived().currentDialogue?.options?.[y];g&&!g.visibilityCondition&&(g.visibilityCondition={type:"always"})}}function s(y,g){confirm("  ?")&&(y.options?.splice(g,1),$$_import_editor$2().editingOptionIndex===g?$$_import_editor$2($$_import_editor$2().editingOptionIndex=null):$$_import_editor$2().editingOptionIndex&&$$_import_editor$2().editingOptionIndex>g&&$$_import_editor$2($$_import_editor$2().editingOptionIndex--))}function o(y){if(!y||!$$_import_editor$2().data)return"";const g=$$_import_editor$2().data.dialogues.find(w=>w.id===y);return g?g.text.substring(0,25)+"...":` ${y}`}function c(){const y=[],g=$$_import_editorDerived().currentDialogue;return g&&(g.nextDialogueId&&y.push({type:"Auto",id:g.nextDialogueId,text:o(g.nextDialogueId)}),g.options?.forEach((w,k)=>{w.nextDialogueId&&y.push({type:` #${k+1}`,id:w.nextDialogueId,text:o(w.nextDialogueId)})})),y}init();var f=comment(),v=first_child(f);{var h=y=>{var g=root_1$b(),w=child(g),k=sibling(child(w),2),I=sibling(w,2),O=sibling(child(I),2),B=child(O);B.value=B.__value="";var P=sibling(B);each(P,1,()=>$$_import_editor$2().data.chapters||[],index$1,(p,A)=>{var L=root_2$b(),ee=child(L),pe=sibling(ee);{var Ce=Te=>{var Le=text();template_effect(Fe=>set_text(Le,`- ${Fe??""}...`),[()=>get$2(A).description.substring(0,30)]),append(Te,Le)};if_block(pe,Te=>{get$2(A).description&&Te(Ce)})}var Oe={};template_effect(()=>{set_text(ee,`${get$2(A).title??""} `),Oe!==(Oe=get$2(A).id)&&(L.value=(L.__value=get$2(A).id)??"")}),append(p,L)});var G=sibling(I,2),Y=sibling(child(G),2),M=sibling(G,2),T=sibling(child(M),2),x=sibling(child(T),2),D=child(x),N=child(D);N.value=N.__value="";var q=sibling(N);each(q,1,()=>$$_import_editorDerived().imageResources,index$1,(p,A)=>{var L=root_4$c(),ee=child(L),pe={};template_effect(()=>{set_text(ee,get$2(A).name),pe!==(pe=get$2(A).name)&&(L.value=(L.__value=get$2(A).name)??"")}),append(p,L)});var ie=sibling(q);each(ie,1,()=>$$_import_editorDerived().riveResources,index$1,(p,A)=>{var L=root_5$b(),ee=child(L),pe={};template_effect(()=>{set_text(ee,`${get$2(A).name??""} (Rive)`),pe!==(pe=get$2(A).name)&&(L.value=(L.__value=get$2(A).name)??"")}),append(p,L)});var K=sibling(D,2),se=sibling(child(K)),me=sibling(T,2),z=sibling(child(me),2),V=child(z),oe=child(V);oe.value=oe.__value="";var U=sibling(oe);each(U,1,()=>$$_import_editorDerived().imageResources,index$1,(p,A)=>{var L=root_6$9(),ee=child(L),pe={};template_effect(()=>{set_text(ee,get$2(A).name),pe!==(pe=get$2(A).name)&&(L.value=(L.__value=get$2(A).name)??"")}),append(p,L)});var j=sibling(U);each(j,1,()=>$$_import_editorDerived().riveResources,index$1,(p,A)=>{var L=root_7$8(),ee=child(L),pe={};template_effect(()=>{set_text(ee,`${get$2(A).name??""} (Rive)`),pe!==(pe=get$2(A).name)&&(L.value=(L.__value=get$2(A).name)??"")}),append(p,L)});var ne=sibling(M,2),te=child(ne),fe=sibling(child(te),2),ce=sibling(te,2);each(ce,1,()=>$$_import_editorDerived().currentDialogue.options||[],index$1,(p,A,L)=>{var ee=root_8$4();let pe;var Ce=child(ee),Oe=child(Ce);set_attribute(Oe,"aria-controls",`option-content-${L}`);var Te=child(Oe),Le=child(Te);{var Fe=Be=>{var ze=text("");append(Be,ze)},He=Be=>{var ze=text("");append(Be,ze)},Ue=Be=>{var ze=text("");append(Be,ze)};if_block(Le,Be=>{get$2(A).visible?get$2(A).enabled?Be(Ue,!1):Be(He,1):Be(Fe)})}var Xe=sibling(Te,2),st=child(Xe),tt=sibling(Oe,2),We=sibling(Ce,2);{var Pe=Be=>{var ze=root_12();set_attribute(ze,"id",`option-content-${L}`);var ot=child(ze);OptionEditor(ot,{get option(){return get$2(A)},index:L,get dialogues(){return $$_import_editor$2().data.dialogues},get availableItems(){return $$_import_editorDerived().availableItems},get conditionTypes(){return t}}),append(Be,ze)};if_block(We,Be=>{$$_import_editor$2().editingOptionIndex===L&&Be(Pe)})}template_effect(()=>{pe=set_class(ee,1,"option-card svelte-132ju9k",null,pe,{editing:$$_import_editor$2().editingOptionIndex===L}),set_attribute(Oe,"aria-expanded",$$_import_editor$2().editingOptionIndex===L),set_text(st,`#${L+1} ${get$2(A).text??""}`)}),delegated("click",Oe,()=>i(L)),delegated("keydown",Oe,Be=>{(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),i(L))}),delegated("click",tt,()=>s($$_import_editorDerived().currentDialogue,L)),append(p,ee)});var we=sibling(ne,2),$e=child(we),he=child($e),ue=child(he),Z=child(ue),ge=sibling(ue,2);{var Se=p=>{var A=root_13$1();append(p,A)},ae=user_derived(()=>c().length===0),H=p=>{var A=root_14$1();each(A,5,c,index$1,(L,ee)=>{var pe=root_15$2(),Ce=child(pe),Oe=child(Ce),Te=sibling(Ce,2),Le=child(Te),Fe=sibling(Te,2),He=sibling(Fe,2),Ue=child(He);template_effect(()=>{set_text(Oe,`${get$2(ee).type??""}:`),set_text(Le,get$2(ee).id),set_text(Ue,get$2(ee).text)}),delegated("click",Fe,()=>storyActions.jumpTo(get$2(ee).id)),append(L,pe)}),append(p,A)};if_block(ge,p=>{get$2(ae)?p(Se):p(H,!1)})}var F=sibling(he,2),W=child(F),X=child(W),le=sibling(W,2);{var Ee=p=>{var A=root_16$1();append(p,A)},Q=p=>{var A=root_17$1(),L=child(A);each(L,1,()=>$$_import_editorDerived().backlinks.slice(0,5),index$1,(Ce,Oe)=>{const Te=derived_safe_equal(()=>storyActions.getLinkType(get$2(Oe),$$_import_editorDerived().currentDialogue.id));var Le=root_18$1(),Fe=child(Le),He=child(Fe),Ue=sibling(Fe,2);let Xe;var st=child(Ue),tt=sibling(Ue,2),We=sibling(tt,2),Pe=child(We);template_effect(Be=>{set_text(He,get$2(Oe).id),Xe=set_class(Ue,1,"link-type-badge svelte-132ju9k",null,Xe,{"link-auto":get$2(Te)==="Auto","link-option":get$2(Te)==="Option"}),set_text(st,get$2(Te)),set_text(Pe,`${Be??""}...`)},[()=>get$2(Oe).text.substring(0,20)]),delegated("click",tt,()=>storyActions.jumpTo(get$2(Oe).id)),append(Ce,Le)});var ee=sibling(L,2);{var pe=Ce=>{var Oe=root_19(),Te=child(Oe);template_effect(()=>set_text(Te,`... ${$$_import_editorDerived().backlinks.length-5}`)),append(Ce,Oe)};if_block(ee,Ce=>{$$_import_editorDerived().backlinks.length>5&&Ce(pe)})}append(p,A)};if_block(le,p=>{$$_import_editorDerived().backlinks.length===0?p(Ee):p(Q,!1)})}var ye=sibling(we,2),be=sibling(child(ye),2),ke=child(be);ke.value=ke.__value="";var Me=sibling(ke);each(Me,1,()=>$$_import_editor$2().data.dialogues,index$1,(p,A)=>{var L=root_20(),ee=child(L),pe={};template_effect(Ce=>{set_text(ee,`${get$2(A).id??""}: ${Ce??""}...`),pe!==(pe=get$2(A).id)&&(L.value=(L.__value=get$2(A).id)??"")},[()=>get$2(A).text.substring(0,30)]),append(p,L)});var E=sibling(ye,2),d=child(E);template_effect(p=>{set_text(Z,`   (${p??""})`),set_text(X,`   (${$$_import_editorDerived().backlinks.length??""})`)},[()=>c().length]),delegated("change",k,p=>{const A=p.target;$$_import_editor$2($$_import_editor$2().selectedDialogueId=A.value)}),bind_value(k,()=>$$_import_editorDerived().currentDialogue.id,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.id=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),delegated("change",O,p=>{const A=p.target;$$_import_editor$2($$_import_editor$2().selectedChapterId=A.value)}),bind_select_value(O,()=>$$_import_editorDerived().currentDialogue.chapterId,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.chapterId=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),bind_value(Y,()=>$$_import_editorDerived().currentDialogue.text,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.text=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),bind_select_value(D,()=>$$_import_editorDerived().currentDialogue.backgroundImage,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.backgroundImage=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),delegated("change",se,function(...p){resourceActions.uploadNewFile?.apply(this,p)}),bind_select_value(V,()=>$$_import_editorDerived().currentDialogue.characterImage,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.characterImage=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),delegated("click",fe,()=>n($$_import_editorDerived().currentDialogue)),bind_select_value(be,()=>$$_import_editorDerived().currentDialogue.nextDialogueId,p=>($$_import_editorDerived($$_import_editorDerived().currentDialogue.nextDialogueId=p),invalidate_inner_signals(()=>{$$_import_editor$2()}))),delegated("click",d,()=>storyActions.deleteDialogue($$_import_editorDerived().currentDialogue.id)),append(y,g)},m=y=>{var g=root_21();append(y,g)};if_block(v,y=>{$$_import_editorDerived().currentDialogue?y(h):y(m,!1)})}append(r,f),pop()}delegate(["change","click","keydown"]);var $$_import_editor$1=reactive_import(()=>editor),root_4$b=from_html('<img class="icon-preview svelte-kh3pfn"/>'),root_5$a=from_html('<div class="icon-placeholder svelte-kh3pfn"></div>'),root_7$7=from_html("<option> </option>"),root_8$3=from_html('<div class="icon-preview-small svelte-kh3pfn"><img alt="Preview" class="preview-image svelte-kh3pfn"/> <span class="preview-name svelte-kh3pfn"> </span></div>'),root_9$2=from_html("<option> </option>"),root_6$8=from_html('<div class="item-edit-form svelte-kh3pfn"><div class="edit-grid svelte-kh3pfn"><div class="form-group full-width-edit svelte-kh3pfn"><label class="svelte-kh3pfn">ID </label> <input type="text" class="input svelte-kh3pfn" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-kh3pfn"><label class="svelte-kh3pfn"></label> <input type="text" class="input svelte-kh3pfn" placeholder=" "/></div> <div class="form-group full-width-edit svelte-kh3pfn"><label class="svelte-kh3pfn"></label> <textarea class="textarea svelte-kh3pfn" rows="2" placeholder=" ..."></textarea></div> <div class="form-group full-width-edit svelte-kh3pfn"><label class="svelte-kh3pfn"></label> <div class="input-group svelte-kh3pfn"><input type="text" class="input svelte-kh3pfn" placeholder="icon.png"/> <select class="input select svelte-kh3pfn"><option>--    --</option><!></select> <label class="btn-file svelte-kh3pfn"> <input type="file" accept="image/*" hidden=""/></label></div> <!></div> <div class="form-group svelte-kh3pfn"><label class="svelte-kh3pfn"></label> <select class="item-type-select svelte-kh3pfn"></select></div></div></div>'),root_3$d=from_html('<div><button type="button" class="item-info svelte-kh3pfn"><div class="item-header svelte-kh3pfn"><div class="item-icon svelte-kh3pfn"><!></div> <div class="item-details svelte-kh3pfn"><div class="item-name svelte-kh3pfn"> </div> <div class="item-meta svelte-kh3pfn"><span class="item-id svelte-kh3pfn"> </span> <span> </span></div></div></div> <div class="item-description svelte-kh3pfn"> <em> </em></div></button> <div class="item-actions svelte-kh3pfn"><button class="btn-icon svelte-kh3pfn" title=""></button> <button class="btn-icon svelte-kh3pfn" title=""></button> <button class="btn-icon danger svelte-kh3pfn" title=""></button></div> <!></div>'),root_2$a=from_html('<div class="items-list svelte-kh3pfn"></div>'),root_10$3=from_html('<div class="empty-items svelte-kh3pfn"><div class="empty-icon svelte-kh3pfn"></div> <div class="empty-text svelte-kh3pfn"> </div> <div class="empty-subtext svelte-kh3pfn">     </div></div>'),root_1$a=from_html('<div id="items-container" class="items-container svelte-kh3pfn"><!> <button class="btn primary full-width svelte-kh3pfn">+  </button></div>'),root$c=from_html('<div class="items-manager svelte-kh3pfn"><button type="button" class="section-header svelte-kh3pfn" aria-controls="items-container"><h4 class="svelte-kh3pfn"><span class="icon svelte-kh3pfn"></span> </h4> <span class="toggle-icon svelte-kh3pfn"> </span></button> <!></div>');function ItemsManager(r,e){push(e,!1);const t=[{value:"tool",label:""},{value:"key",label:""},{value:"consumable",label:""},{value:"quest",label:""},{value:"misc",label:""}];function n(){if(!$$_import_editor$1().data)return;$$_import_editor$1().data.items||$$_import_editor$1($$_import_editor$1().data.items=[]);const I={id:`item_${Date.now()}`,name:" ",description:" ",icon:"icon_default.png",type:"misc"};$$_import_editor$1().data.items.push(I),$$_import_editor$1($$_import_editor$1().editingItemIndex=$$_import_editor$1().data.items.length-1)}function i(I){$$_import_editor$1().editingItemIndex===I?$$_import_editor$1($$_import_editor$1().editingItemIndex=null):$$_import_editor$1($$_import_editor$1().editingItemIndex=I)}function s(I){confirm(" ?")&&$$_import_editor$1().data?.items&&($$_import_editor$1().data.items.splice(I,1),$$_import_editor$1($$_import_editor$1().editingItemIndex=null))}function o(I){if(!$$_import_editor$1().data?.items)return;const O=$$_import_editor$1().data.items[I],B={...O,id:`${O.id}_copy_${Date.now()}`,name:`${O.name} ()`};$$_import_editor$1().data.items.splice(I+1,0,B),$$_import_editor$1($$_import_editor$1().editingItemIndex=I+1)}function c(I){return t.find(O=>O.value===I)?.label||I}init();var f=root$c(),v=child(f),h=child(v),m=sibling(child(h)),y=sibling(h,2),g=child(y),w=sibling(v,2);{var k=I=>{var O=root_1$a(),B=child(O);{var P=M=>{var T=root_2$a();each(T,7,()=>$$_import_editor$1().data.items,x=>x.id,(x,D,N)=>{var q=root_3$d();let ie;var K=child(q),se=child(K),me=child(se),z=child(me);{var V=X=>{var le=root_4$b();template_effect(()=>{set_attribute(le,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(D).icon}`),set_attribute(le,"alt",get$2(D).name)}),append(X,le)},oe=X=>{var le=root_5$a();append(X,le)};if_block(z,X=>{get$2(D).icon?X(V):X(oe,!1)})}var U=sibling(me,2),j=child(U),ne=child(j),te=sibling(j,2),fe=child(te),ce=child(fe),we=sibling(fe,2);let $e;var he=child(we),ue=sibling(se,2),Z=child(ue),ge=sibling(K,2),Se=child(ge),ae=sibling(Se,2),H=sibling(ae,2),F=sibling(ge,2);{var W=X=>{var le=root_6$8(),Ee=child(le),Q=child(Ee),ye=child(Q),be=sibling(ye,2),ke=sibling(Q,2),Me=child(ke),E=sibling(Me,2),d=sibling(ke,2),p=child(d),A=sibling(p,2),L=sibling(d,2),ee=child(L),pe=sibling(ee,2),Ce=child(pe),Oe=sibling(Ce,2),Te=child(Oe);Te.value=Te.__value="";var Le=sibling(Te);each(Le,1,()=>$$_import_editor$1().storedFiles.filter(Pe=>Pe.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),index$1,(Pe,Be)=>{var ze=root_7$7(),ot=child(ze),qe={};template_effect(()=>{set_text(ot,get$2(Be).name),qe!==(qe=get$2(Be).name)&&(ze.value=(ze.__value=get$2(Be).name)??"")}),append(Pe,ze)});var Fe=sibling(Oe,2),He=sibling(child(Fe)),Ue=sibling(pe,2);{var Xe=Pe=>{var Be=root_8$3(),ze=child(Be),ot=sibling(ze,2),qe=child(ot);template_effect(()=>{set_attribute(ze,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(D).icon}`),set_text(qe,get$2(D).icon)}),append(Pe,Be)};if_block(Ue,Pe=>{get$2(D).icon&&Pe(Xe)})}var st=sibling(L,2),tt=child(st),We=sibling(tt,2);each(We,5,()=>t,index$1,(Pe,Be)=>{var ze=root_9$2(),ot=child(ze),qe={};template_effect(()=>{set_text(ot,get$2(Be).label),qe!==(qe=get$2(Be).value)&&(ze.value=(ze.__value=get$2(Be).value)??"")}),append(Pe,ze)}),template_effect(()=>{set_attribute(ye,"for",`item-id-${get$2(N)??""}`),set_attribute(be,"id",`item-id-${get$2(N)??""}`),set_attribute(Me,"for",`item-name-${get$2(N)??""}`),set_attribute(E,"id",`item-name-${get$2(N)??""}`),set_attribute(p,"for",`item-desc-${get$2(N)??""}`),set_attribute(A,"id",`item-desc-${get$2(N)??""}`),set_attribute(ee,"for",`item-icon-${get$2(N)??""}`),set_attribute(Ce,"id",`item-icon-${get$2(N)??""}`),set_attribute(tt,"for",`item-type-${get$2(N)??""}`),set_attribute(We,"id",`item-type-${get$2(N)??""}`)}),bind_value(be,()=>get$2(D).id,Pe=>(get$2(D).id=Pe,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)}))),bind_value(E,()=>get$2(D).name,Pe=>(get$2(D).name=Pe,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)}))),bind_value(A,()=>get$2(D).description,Pe=>(get$2(D).description=Pe,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)}))),bind_value(Ce,()=>get$2(D).icon,Pe=>(get$2(D).icon=Pe,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)}))),delegated("change",Oe,Pe=>{const Be=Pe.target;get$2(D).icon=Be.value,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)})}),delegated("change",He,function(...Pe){resourceActions.uploadNewFile?.apply(this,Pe)}),bind_select_value(We,()=>get$2(D).type,Pe=>(get$2(D).type=Pe,invalidate_inner_signals(()=>$$_import_editor$1()),invalidate_inner_signals(()=>{get$2(N)}))),append(X,le)};if_block(F,X=>{$$_import_editor$1().editingItemIndex===get$2(N)&&X(W)})}template_effect(X=>{ie=set_class(q,1,"item-row svelte-kh3pfn",null,ie,{editing:$$_import_editor$1().editingItemIndex===get$2(N)}),set_attribute(K,"aria-label",`  ${get$2(D).name??""}`),set_text(ne,get$2(D).name),set_text(ce,get$2(D).id),$e=set_class(we,1,"item-type-badge svelte-kh3pfn",null,$e,{tool:get$2(D).type==="tool",key:get$2(D).type==="key",consumable:get$2(D).type==="consumable",quest:get$2(D).type==="quest",misc:get$2(D).type==="misc"}),set_text(he,X),set_text(Z,`${get$2(D).description??""} || `)},[()=>c(get$2(D).type)]),delegated("click",K,()=>i(get$2(N))),delegated("click",Se,()=>o(get$2(N))),delegated("click",ae,()=>i(get$2(N))),delegated("click",H,()=>s(get$2(N))),append(x,q)}),append(M,T)},G=M=>{var T=root_10$3();append(M,T)};if_block(B,M=>{$$_import_editor$1().data?.items?.length?M(P):M(G,!1)})}var Y=sibling(B,2);delegated("click",Y,n),append(I,O)};if_block(w,I=>{$$_import_editor$1().showItems&&I(k)})}template_effect(()=>{set_attribute(v,"title",$$_import_editor$1().showItems?" ":" "),set_attribute(v,"aria-expanded",$$_import_editor$1().showItems),set_text(m,`  (${($$_import_editor$1().data?.items?.length||0)??""})`),set_text(g,$$_import_editor$1().showItems?"":"")}),delegated("click",v,()=>$$_import_editor$1($$_import_editor$1().showItems=!$$_import_editor$1().showItems)),append(r,f),pop()}delegate(["click","change"]);delegate(["click"]);const authStateObj=proxy({user:null,session:null,profile:null,loading:!0,initialized:!1}),user=user_derived(()=>authStateObj.user),session=user_derived(()=>authStateObj.session),profile=user_derived(()=>authStateObj.profile),isAuthenticated=user_derived(()=>get$2(session)!==null&&get$2(user)!==null),isAuthor=user_derived(()=>get$2(profile)?.is_author??!1),isAdmin=user_derived(()=>get$2(profile)?.is_admin??!1);async function initAuth(){try{authStateObj.loading=!0;const{data:{session:r}}=await supabase.auth.getSession();authStateObj.session=r,authStateObj.user=r?.user??null,r?.user&&await loadProfile(r.user.id),supabase.auth.onAuthStateChange(async(e,t)=>{console.log("[Auth] State change:",e,t?.user?.email),authStateObj.session=t,authStateObj.user=t?.user??null,t?.user?await loadProfile(t.user.id):authStateObj.profile=null})}catch(r){console.error("[Auth] Init error:",r)}finally{authStateObj.loading=!1,authStateObj.initialized=!0}}async function loadProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").select("*").eq("user_id",r).single();if(t){t.code==="PGRST116"?(console.log("[Auth] Profile not found, creating..."),await createProfile(r)):console.error("[Auth] Error loading profile:",t);return}authStateObj.profile=e,console.log("[Auth] Profile loaded:",e),await linkUserKeyToProfile(r)}catch(e){console.error("[Auth] Error in loadProfile:",e)}}async function createProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").insert([{user_id:r,is_author:!1,is_admin:!1}]).select().single();if(t){console.error("[Auth] Error creating profile:",t);return}authStateObj.profile=e,await linkUserKeyToProfile(r)}catch(e){console.error("[Auth] Error in createProfile:",e)}}async function linkUserKeyToProfile(r){const e=userKeyStore.getCurrentKey();if(!e){console.log("[Auth] No userKey to link");return}try{const{data:t,error:n}=await supabase.rpc("link_user_key_to_profile",{p_user_key:e,p_profile_id:r});if(n){console.error("[Auth] Error linking userKey:",n);return}t&&t!==e&&(console.log("[Auth] New userKey generated:",t),typeof localStorage<"u"&&localStorage.setItem("userKey",t)),console.log("[Auth] UserKey linked to profile:",t||e)}catch(t){console.error("[Auth] Exception linking userKey:",t)}}async function signIn(r,e){if(!r||!r.trim())return{success:!1,error:"Email    "};if(!e||!e.trim())return{success:!1,error:"    "};authStateObj.loading=!0;try{console.log("[Auth] Attempting sign in for:",r);const{data:t,error:n}=await supabase.auth.signInWithPassword({email:r.trim().toLowerCase(),password:e.trim()});return n?(console.error("[Auth] Sign in error:",n),n.status===400||n.status===422?{success:!1,error:" email  "}:n.message?.includes("Email not confirmed")?{success:!1,error:"Email  .  ."}:{success:!1,error:n.message}):(console.log("[Auth] Sign in successful:",t.user?.email),authStateObj.session=t.session,authStateObj.user=t.user,t.user&&await loadProfile(t.user.id),{success:!0})}catch(t){return console.error("[Auth] Sign in exception:",t),{success:!1,error:"   "}}finally{authStateObj.loading=!1}}async function signOut(){authStateObj.loading=!0;try{const{error:r}=await supabase.auth.signOut();r&&console.error("[Auth] Error signing out:",r),authStateObj.user=null,authStateObj.session=null,authStateObj.profile=null,console.log("[Auth] Signed out successfully")}finally{authStateObj.loading=!1}}async function signUp(r,e,t){authStateObj.loading=!0;try{const{data:n,error:i}=await supabase.auth.signUp({email:r,password:e,options:{data:{username:t||r.split("@")[0]},emailRedirectTo:`${window.location.origin}/auth/callback`}});return i?i.status===429||i.message?.toLowerCase().includes("rate limit")?{success:!1,error:"  . ,  ."}:{success:!1,error:i.message}:{success:!0,needsEmailConfirmation:n.user?.identities?.length===0||n.user?.email_confirmed_at===null}}catch(n){return{success:!1,error:n.message}}finally{authStateObj.loading=!1}}async function resetPassword(r){try{const e=`${window.location.origin}/reset-password`;console.log("[Auth] Sending reset email to:",r);const{data:t,error:n}=await supabase.auth.resetPasswordForEmail(r,{redirectTo:e});return n?(console.error("[Auth] Reset password error:",n),n.status===429||n.message?.toLowerCase().includes("rate limit")?{success:!1,error:"  . ,  ."}:{success:!1,error:n.message}):(console.log("[Auth] Reset email sent:",t),{success:!0})}catch(e){return console.error("[Auth] Reset password exception:",e),{success:!1,error:e.message}}}const authState={get user(){return authStateObj.user},get session(){return authStateObj.session},get profile(){return authStateObj.profile},get loading(){return authStateObj.loading},get initialized(){return authStateObj.initialized}},authDerivedState={get isAuthenticated(){return get$2(isAuthenticated)},get isAuthor(){return get$2(isAuthor)},get isAdmin(){return get$2(isAdmin)}},STORIES_CACHE_KEY="novella_stories_cache",STORIES_VERSIONS_KEY="novella_stories_versions";function getStoriesCache(){try{const r=localStorage.getItem(STORIES_CACHE_KEY);return r?JSON.parse(r):{}}catch{return{}}}function setStoryCache(r,e){try{const t=getStoriesCache(),n=simpleHash(JSON.stringify(e));t[r]={data:e,timestamp:Date.now(),contentHash:n},localStorage.setItem(STORIES_CACHE_KEY,JSON.stringify(t));const i=getStoriesVersions();i[r]=e.meta?.version||n,localStorage.setItem(STORIES_VERSIONS_KEY,JSON.stringify(i))}catch(t){console.warn("[storiesStore]     :",t)}}function getStoryFromCache(r){return getStoriesCache()[r]?.data||null}function getStoriesVersions(){try{const r=localStorage.getItem(STORIES_VERSIONS_KEY);return r?JSON.parse(r):{}}catch{return{}}}function simpleHash(r){let e=0;for(let t=0;t<r.length;t++){const n=r.charCodeAt(t);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(36)}const stories=proxy({stories:[],loading:!1,initialized:!1}),FALLBACK_STORIES=[{id:"dracula",created_at:new Date().toISOString(),title:"",author_id:null,json_url:"dracula_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"dracula",version:"1.0.0"},{id:"zombie",created_at:new Date().toISOString(),title:"",author_id:null,json_url:"zombie_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"zombie",version:"1.0.0"},{id:"fairy_tale",created_at:new Date().toISOString(),title:"",author_id:null,json_url:"fairy_tale_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"fairy_tale",version:"1.0.0"},{id:"minigames",created_at:new Date().toISOString(),title:"-",author_id:null,json_url:"minigames_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"minigames",version:"1.0.0"}];function getPublicStories(){if(console.log("[getPublicStories] initialized:",stories.initialized,"stories.length:",stories.stories.length),!stories.initialized||stories.stories.length===0)return console.log("[getPublicStories]  fallback, count:",FALLBACK_STORIES.length),FALLBACK_STORIES;const r=stories.stories.filter(e=>e.is_public);return console.log("[getPublicStories]  :",r.length),r}function getPlayerStories(){const r=authState.user?.id;if(!r){const t=getPublicStories(),n=t.length>0?t:FALLBACK_STORIES;return console.log("[getPlayerStories] , :",n.length),n}const e=stories.stories.filter(t=>t.is_public||t.allowed_players&&t.allowed_players.includes(r));return console.log("[getPlayerStories] , :",e.length),e}function getStoryById(r){const e=stories.stories.find(t=>t.id===r);return e||FALLBACK_STORIES.find(t=>t.id===r)}function getStoryByBucket(r){const e=stories.stories.find(t=>t.bucket===r);return e||FALLBACK_STORIES.find(t=>t.bucket===r)}function getAuthorStories(){const r=authState.user?.id;return r&&authState.profile?.is_admin?stories.stories:stories.stories.filter(e=>e.author_id===r)}async function loadStories(){console.log("[storiesStore] loadStories "),stories.loading=!0;try{if(console.log("[storiesStore]    ..."),!navigator.onLine){console.log("[storiesStore]   -  fallback"),stories.stories=[],stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories  ()");return}const{data:r,error:e}=await supabase.from("stories").select("*").order("created_at",{ascending:!1});e?(console.error("[storiesStore] Error loading stories:",e),console.log("[storiesStore]  fallback "),stories.stories=[]):(console.log("[storiesStore]    :",r?.length||0),stories.stories=r||[])}catch(r){console.error("[storiesStore] Exception loading stories:",r),console.log("[storiesStore]  fallback "),stories.stories=[]}stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories .   :",stories.stories.length)}async function createStory(r,e="stories"){if(!authState.user)return{success:!1,error:" "};try{const t=`${r.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}.json`,i=JSON.stringify({meta:{version:"3.1",title:r},chapters:[{id:"ch1",title:" 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:" ...",options:[]}],items:[],miniGames:[]},null,2),o=new TextEncoder().encode(i),{error:c}=await supabase.storage.from(e).upload(t,o,{contentType:"application/json"});if(c)return{success:!1,error:c.message};const f=t,{data:v,error:h}=await supabase.from("stories").insert({title:r,author_id:authState.user.id,json_url:f,bucket:e,is_public:!1,allowed_players:[]}).select().single();return h?{success:!1,error:h.message}:(await loadStories(),{success:!0,story:v})}catch(t){return{success:!1,error:t.message}}}async function updateStory(r,e){if(!authState.user)return{success:!1,error:" "};try{const{error:t}=await supabase.from("stories").update(e).eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(t){return{success:!1,error:t.message}}}async function deleteStory(r){if(!authState.user)return{success:!1,error:" "};try{const e=stories.stories.find(n=>n.id===r);if(!e)return{success:!1,error:"  "};if(e.json_url){const[n,...i]=e.json_url.split("/"),s=i.join("/");await supabase.storage.from(n).remove([s])}const{error:t}=await supabase.from("stories").delete().eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(e){return{success:!1,error:e.message}}}async function loadStoryJson(r,e=!1){const t=r.id;if(!e){const n=getStoryFromCache(t);if(n)return console.log(`[storiesStore]  "${r.title}"   `),n}try{const n=r.bucket||"stories",s=r.json_url.split("/").pop()||"story.json";console.log(`[storiesStore]   "${r.title}"  bucket: ${n}, : ${s}`);const{data:o,error:c}=await supabase.storage.from(n).download(s);if(c){console.error("[storiesStore] Error downloading story:",c.message);const h=`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${n}/${s}`;console.log("[storiesStore]  fallback URL:",h);try{const m=await fetch(h);if(!m.ok)throw new Error(`HTTP ${m.status}`);const y=await m.json();return console.log("[storiesStore]   fallback URL"),setStoryCache(t,y),y}catch(m){console.error("[storiesStore] Fallback also failed:",m);const y=`/stories/${s}`;console.log("[storiesStore]   URL:",y);try{const w=await fetch(y);if(w.ok){const k=await w.json();return setStoryCache(t,k),k}}catch{console.error("[storiesStore]  fallback   ")}const g=getStoryFromCache(t);return g?(console.log("[storiesStore]     "),g):null}}const f=await o.text(),v=JSON.parse(f);return console.log("[storiesStore]   "),setStoryCache(t,v),v}catch(n){console.error("[storiesStore] Error loading story JSON:",n);const i=getStoryFromCache(t);return i?(console.log("[storiesStore]    "),i):null}}async function preloadAllStories(){console.log("[storiesStore]   ...");const r=[...stories.stories,...FALLBACK_STORIES],e=getStoriesVersions(),t=r.map(async n=>{if(e[n.id],getStoryFromCache(n.id)&&n.version&&getStoriesVersions()[n.id]===n.version){console.log(`[storiesStore]  ${n.title} -   `);return}try{await loadStoryJson(n,!0),console.log(`[storiesStore] : ${n.title}`)}catch(s){console.warn(`[storiesStore]    ${n.title}:`,s)}});Promise.allSettled(t).then(()=>{console.log("[storiesStore]   ")})}const storiesState=stories;class GameState{#e=state(proxy({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return get$2(this.#e)}set player(e){set(this.#e,e,!0)}#a=state(null);get storyData(){return get$2(this.#a)}set storyData(e){set(this.#a,e,!0)}#t=state("0");get currentDialogueId(){return get$2(this.#t)}set currentDialogueId(e){set(this.#t,e,!0)}#o=state(!0);get isLoading(){return get$2(this.#o)}set isLoading(e){set(this.#o,e,!0)}#r=state("");get error(){return get$2(this.#r)}set error(e){set(this.#r,e,!0)}#s=state(null);get selectedStory(){return get$2(this.#s)}set selectedStory(e){set(this.#s,e,!0)}#n=state(null);get selectedStoryData(){return get$2(this.#n)}set selectedStoryData(e){set(this.#n,e,!0)}#i=state(null);get urlStoryId(){return get$2(this.#i)}set urlStoryId(e){set(this.#i,e,!0)}#l=state(null);get activeMinigame(){return get$2(this.#l)}set activeMinigame(e){set(this.#l,e,!0)}get isMinigameActive(){return this.activeMinigame!==null}get availableStories(){return getPlayerStories()}async initStories(){console.log("[GameState] initStories ");try{const t=new URLSearchParams(window.location.search).get("story");t&&(this.urlStoryId=t,console.log("[GameState] URL  story:",t))}catch{console.log("[GameState]  window.location (SSR?)")}storiesState.initialized?console.log("[GameState]   "):(console.log("[GameState]  ..."),await loadStories(),console.log("[GameState]  , initialized:",storiesState.initialized)),typeof window<"u"&&preloadAllStories(),this.urlStoryId&&(console.log("[GameState]  :",this.urlStoryId),this.selectStoryById(this.urlStoryId)),console.log("[GameState] initStories ")}selectStoryById(e){console.log("[GameState] selectStoryById:",e),console.log("[GameState] storiesState.stories:",storiesState.stories?.length||0),console.log("[GameState] storiesState.initialized:",storiesState.initialized);let t=storiesState.stories?.find(n=>n?.id===e);if(console.log("[GameState]   :",t?.title),!t){const i=[{id:"dracula",title:"",bucket:"dracula",json_url:"dracula_story.json",version:"1.0.0"},{id:"zombie",title:"",bucket:"zombie",json_url:"zombie_story.json",version:"1.0.0"},{id:"fairy_tale",title:"",bucket:"fairy_tale",json_url:"fairy_tale_story.json",version:"1.0.0"},{id:"minigames",title:"-",bucket:"minigames",json_url:"minigames_story.json",version:"1.0.0"}].find(s=>s.id===e);i&&(t={id:i.id,title:i.title,bucket:i.bucket,json_url:i.json_url,version:i.version,created_at:new Date().toISOString(),author_id:null,preview_image_url:null,is_public:!0,allowed_players:[]}),console.log("[GameState]   fallback:",t?.title)}return t&&t.id?(this.selectedStory=t.id,this.selectedStoryData=t,console.log("[GameState]  :",t.title),this.loadSelectedStoryJson(t),!0):(console.warn("[GameState]   :",e),!1)}async loadSelectedStoryJson(e){this.isLoading=!0;try{const t=await loadStoryJson(e);t?(this.storyData=t,this.currentDialogueId=t.dialogues?.[0]?.id||"0"):this.error="   "}catch(t){this.error="  ",console.error("[GameState]   JSON:",t)}finally{this.isLoading=!1}}getStoryById(e){return storiesState.stories.find(t=>t.id===e)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:" ";this.error=` : ${n}`,console.error("  :",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("  :",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const gameState=new GameState;var rive$1={exports:{}},rive=rive$1.exports,hasRequiredRive;function requireRive(){return hasRequiredRive||(hasRequiredRive=1,(function(r,e){(function(n,i){r.exports=i()})(rive,()=>(()=>{var t=[,((o,c,f)=>{f.r(c),f.d(c,{default:()=>h});var v=(()=>{var m=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(y={}){var g=y,w,k;g.ready=new Promise((l,u)=>{w=l,k=u});function I(){function l(J){const ve=S;_=u=0,S=new Map,ve.forEach(_e=>{try{_e(J)}catch(de){console.error(de)}}),this.pb(),C&&C.Tb()}let u=0,_=0,S=new Map,C=null,R=null;this.requestAnimationFrame=function(J){u||(u=requestAnimationFrame(l.bind(this)));const ve=++_;return S.set(ve,J),ve},this.cancelAnimationFrame=function(J){S.delete(J),u&&S.size==0&&(cancelAnimationFrame(u),u=0)},this.Rb=function(J){R&&(document.body.remove(R),R=null),J||(R=document.createElement("div"),R.style.backgroundColor="black",R.style.position="fixed",R.style.right=0,R.style.top=0,R.style.color="white",R.style.padding="4px",R.innerHTML="RIVE FPS",J=function(ve){R.innerHTML="RIVE FPS "+ve.toFixed(1)},document.body.appendChild(R)),C=new function(){let ve=0,_e=0;this.Tb=function(){var de=performance.now();_e?(++ve,de-=_e,1e3<de&&(J(1e3*ve/de),ve=_e=0)):(_e=de,ve=0)}}},this.Ob=function(){R&&(document.body.remove(R),R=null),C=null},this.pb=function(){}}function O(l){console.assert(!0);const u=new Map;let _=-1/0;this.push=function(S){return S=S+((1<<l)-1)>>l,u.has(S)&&clearTimeout(u.get(S)),u.set(S,setTimeout(function(){u.delete(S),u.length==0?_=-1/0:S==_&&(_=Math.max(...u.keys()),console.assert(_<S))},1e3)),_=Math.max(S,_),_<<l}}const B=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){B&&B();let l=g.decodeAudio;g.decodeAudio=function(C,R){C=l(C),R(C)};let u=g.decodeFont;g.decodeFont=function(C,R){C=u(C),R(C)};const _=g.FileAssetLoader;g.ptrToAsset=C=>{let R=g.ptrToFileAsset(C);return R.isImage?g.ptrToImageAsset(C):R.isFont?g.ptrToFontAsset(C):R.isAudio?g.ptrToAudioAsset(C):R},g.CustomFileAssetLoader=_.extend("CustomFileAssetLoader",{__construct:function({loadContents:C}){this.__parent.__construct.call(this),this.Gb=C},loadContents:function(C,R){return C=g.ptrToAsset(C),this.Gb(C,R)}}),g.CDNFileAssetLoader=_.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(C){let R=g.ptrToAsset(C);return C=R.cdnUuid,C===""?!1:((function(J,ve){var _e=new XMLHttpRequest;_e.responseType="arraybuffer",_e.onreadystatechange=function(){_e.readyState==4&&_e.status==200&&ve(_e)},_e.open("GET",J,!0),_e.send(null)})(R.cdnBaseUrl+"/"+C,J=>{R.decode(new Uint8Array(J.response))}),!0)}}),g.FallbackFileAssetLoader=_.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(C){this.lb.push(C)},loadContents:function(C,R){for(let J of this.lb)if(J.loadContents(C,R))return!0;return!1}});let S=g.computeAlignment;g.computeAlignment=function(C,R,J,ve,_e=1){return S.call(this,C,R,J,ve,_e)}};const P="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),G=new function(){function l(){if(!u){let Ke=function(Ze,Ne,ct){if(Ne=Ie.createShader(Ne),Ie.shaderSource(Ne,ct),Ie.compileShader(Ne),ct=Ie.getShaderInfoLog(Ne),0<(ct||"").length)throw ct;Ie.attachShader(Ze,Ne)};var re=document.createElement("canvas"),xe={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let Ie;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(Ie=re.getContext("webgl",xe),_=1,!Ie)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(Ie=re.getContext("webgl2",xe))_=2;else if(Ie=re.getContext("webgl",xe))_=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(Ie=new Proxy(Ie,{get(Ze,Ne){if(Ze.isContextLost()){if(_e||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Ne),_e=!0),typeof Ze[Ne]=="function")return function(){}}else return typeof Ze[Ne]=="function"?function(...ct){return Ze[Ne].apply(Ze,ct)}:Ze[Ne]},set(Ze,Ne,ct){if(Ze.isContextLost())_e||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Ne),_e=!0);else return Ze[Ne]=ct,!0}}),S=Math.min(Ie.getParameter(Ie.MAX_RENDERBUFFER_SIZE),Ie.getParameter(Ie.MAX_TEXTURE_SIZE)),re=Ie.createProgram(),Ke(re,Ie.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ke(re,Ie.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),Ie.bindAttribLocation(re,0,"vertex"),Ie.bindAttribLocation(re,1,"uv"),Ie.linkProgram(re),xe=Ie.getProgramInfoLog(re),0<(xe||"").trim().length)throw xe;C=Ie.getUniformLocation(re,"mat"),R=Ie.getUniformLocation(re,"translate"),Ie.useProgram(re),Ie.bindBuffer(Ie.ARRAY_BUFFER,Ie.createBuffer()),Ie.enableVertexAttribArray(0),Ie.enableVertexAttribArray(1),Ie.bindBuffer(Ie.ELEMENT_ARRAY_BUFFER,Ie.createBuffer()),Ie.uniform1i(Ie.getUniformLocation(re,"image"),0),Ie.pixelStorei(Ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),u=Ie}return!0}let u=null,_=0,S=0,C=null,R=null,J=0,ve=0,_e=!1;l(),this.hc=function(){return l(),S},this.Mb=function(re){u.deleteTexture&&u.deleteTexture(re)},this.Lb=function(re){if(!l())return null;const xe=u.createTexture();return xe?(u.bindTexture(u.TEXTURE_2D,xe),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,re),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),_==2?(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.generateMipmap(u.TEXTURE_2D)):u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),xe):null};const de=new O(8),Re=new O(8),De=new O(10),Ve=new O(10);this.Qb=function(re,xe,Ie,Ke,Ze){if(l()){var Ne=de.push(re),ct=Re.push(xe);if(u.canvas){(u.canvas.width!=Ne||u.canvas.height!=ct)&&(u.canvas.width=Ne,u.canvas.height=ct),u.viewport(0,ct-xe,re,xe),u.disable(u.SCISSOR_TEST),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT),u.enable(u.SCISSOR_TEST),Ie.sort((rt,At)=>At.xb-rt.xb),Ne=De.push(Ke),J!=Ne&&(u.bufferData(u.ARRAY_BUFFER,8*Ne,u.DYNAMIC_DRAW),J=Ne),Ne=0;for(var ht of Ie)u.bufferSubData(u.ARRAY_BUFFER,Ne,ht.Ua),Ne+=4*ht.Ua.length;console.assert(Ne==4*Ke);for(var kt of Ie)u.bufferSubData(u.ARRAY_BUFFER,Ne,kt.Db),Ne+=4*kt.Db.length;console.assert(Ne==8*Ke),Ne=Ve.push(Ze),ve!=Ne&&(u.bufferData(u.ELEMENT_ARRAY_BUFFER,2*Ne,u.DYNAMIC_DRAW),ve=Ne),ht=0;for(var Nt of Ie)u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,ht,Nt.indices),ht+=2*Nt.indices.length;console.assert(ht==2*Ze),Nt=0,kt=!0,Ne=ht=0;for(const rt of Ie){rt.image.Ka!=Nt&&(u.bindTexture(u.TEXTURE_2D,rt.image.Ja||null),Nt=rt.image.Ka),rt.mc?(u.scissor(rt.Za,ct-rt.$a-rt.kb,rt.Ac,rt.kb),kt=!0):kt&&(u.scissor(0,ct-xe,re,xe),kt=!1),Ie=2/re;const At=-2/xe;u.uniform4f(C,rt.ha[0]*Ie*rt.Ba,rt.ha[1]*At*rt.Ca,rt.ha[2]*Ie*rt.Ba,rt.ha[3]*At*rt.Ca),u.uniform2f(R,rt.ha[4]*Ie*rt.Ba+Ie*(rt.Za-rt.ic*rt.Ba)-1,rt.ha[5]*At*rt.Ca+At*(rt.$a-rt.jc*rt.Ca)+1),u.vertexAttribPointer(0,2,u.FLOAT,!1,0,Ne),u.vertexAttribPointer(1,2,u.FLOAT,!1,0,Ne+4*Ke),u.drawElements(u.TRIANGLES,rt.indices.length,u.UNSIGNED_SHORT,ht),Ne+=4*rt.Ua.length,ht+=2*rt.indices.length}console.assert(Ne==4*Ke),console.assert(ht==2*Ze)}}},this.canvas=function(){return l()&&u.canvas}},Y=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function l(Ae){switch(Ae){case de.srcOver:return"source-over";case de.screen:return"screen";case de.overlay:return"overlay";case de.darken:return"darken";case de.lighten:return"lighten";case de.colorDodge:return"color-dodge";case de.colorBurn:return"color-burn";case de.hardLight:return"hard-light";case de.softLight:return"soft-light";case de.difference:return"difference";case de.exclusion:return"exclusion";case de.multiply:return"multiply";case de.hue:return"hue";case de.saturation:return"saturation";case de.color:return"color";case de.luminosity:return"luminosity"}}function u(Ae){return"rgba("+((16711680&Ae)>>>16)+","+((65280&Ae)>>>8)+","+((255&Ae)>>>0)+","+((4278190080&Ae)>>>24)/255+")"}function _(){0<ct.length&&(G.Qb(Ne.drawWidth(),Ne.drawHeight(),ct,ht,kt),ct=[],kt=ht=0,Ne.reset(512,512));for(const Ae of Ze){for(const je of Ae.H)je();Ae.H=[]}Ze.clear()}Y&&Y();var S=g.RenderPaintStyle;const C=g.RenderPath,R=g.RenderPaint,J=g.Renderer,ve=g.StrokeCap,_e=g.StrokeJoin,de=g.BlendMode,Re=S.fill,De=S.stroke,Ve=g.FillRule.evenOdd;let re=1;var xe=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:Ae,xa:je}={}){this.__parent.__construct.call(this),this.Ka=re,re=re+1&2147483647||1,this.la=Ae,this.xa=je},__destruct:function(){this.Ja&&(G.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(Ae){var je=this;je.xa&&je.xa(je);var Qe=new Image;je.Xa=URL.createObjectURL(new Blob([Ae],{type:"image/png"})),Qe.onload=function(){je.Fb=Qe,je.Ja=G.Lb(Qe),je.size(Qe.width,Qe.height),je.la&&je.la(je)},Qe.src=je.Xa}}),Ie=C.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(Ae,je,Qe,nt,Je,et,at){var lt=this.T,$t=lt.addPath;Ae=Ae.T;const dt=new DOMMatrix;dt.a=je,dt.b=Qe,dt.c=nt,dt.d=Je,dt.e=et,dt.f=at,$t.call(lt,Ae,dt)},fillRule:function(Ae){this.Wa=Ae},moveTo:function(Ae,je){this.T.moveTo(Ae,je)},lineTo:function(Ae,je){this.T.lineTo(Ae,je)},cubicTo:function(Ae,je,Qe,nt,Je,et){this.T.bezierCurveTo(Ae,je,Qe,nt,Je,et)},close:function(){this.T.closePath()}}),Ke=R.extend("CanvasRenderPaint",{color:function(Ae){this.Ya=u(Ae)},thickness:function(Ae){this.Ib=Ae},join:function(Ae){switch(Ae){case _e.miter:this.Ia="miter";break;case _e.round:this.Ia="round";break;case _e.bevel:this.Ia="bevel"}},cap:function(Ae){switch(Ae){case ve.butt:this.Ha="butt";break;case ve.round:this.Ha="round";break;case ve.square:this.Ha="square"}},style:function(Ae){this.Hb=Ae},blendMode:function(Ae){this.Eb=l(Ae)},clearGradient:function(){this.ja=null},linearGradient:function(Ae,je,Qe,nt){this.ja={zb:Ae,Ab:je,cb:Qe,eb:nt,Ra:[]}},radialGradient:function(Ae,je,Qe,nt){this.ja={zb:Ae,Ab:je,cb:Qe,eb:nt,Ra:[],ec:!0}},addStop:function(Ae,je){this.ja.Ra.push({color:Ae,stop:je})},completeGradient:function(){},draw:function(Ae,je,Qe){let nt=this.Hb;var Je=this.Ya,et=this.ja;if(Ae.globalCompositeOperation=this.Eb,et!=null){Je=et.zb;var at=et.Ab;const $t=et.cb;var lt=et.eb;const dt=et.Ra;et.ec?(et=$t-Je,lt-=at,Je=Ae.createRadialGradient(Je,at,0,Je,at,Math.sqrt(et*et+lt*lt))):Je=Ae.createLinearGradient(Je,at,$t,lt);for(let mt=0,ft=dt.length;mt<ft;mt++)at=dt[mt],Je.addColorStop(at.stop,u(at.color));this.Ya=Je,this.ja=null}switch(nt){case De:Ae.strokeStyle=Je,Ae.lineWidth=this.Ib,Ae.lineCap=this.Ha,Ae.lineJoin=this.Ia,Ae.stroke(je);break;case Re:Ae.fillStyle=Je,Ae.fill(je,Qe)}}});const Ze=new Set;let Ne=null,ct=[],ht=0,kt=0;var Nt=g.CanvasRenderer=J.extend("Renderer",{__construct:function(Ae){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=Ae.getContext("2d"),this.Va=Ae,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const Ae=this.S.length-6;if(6>Ae)throw"restore() called without matching save().";this.S.splice(Ae),this.H.push(this.C.restore.bind(this.C))},transform:function(Ae,je,Qe,nt,Je,et){const at=this.S,lt=at.length-6;at.splice(lt,6,at[lt]*Ae+at[lt+2]*je,at[lt+1]*Ae+at[lt+3]*je,at[lt]*Qe+at[lt+2]*nt,at[lt+1]*Qe+at[lt+3]*nt,at[lt]*Je+at[lt+2]*et+at[lt+4],at[lt+1]*Je+at[lt+3]*et+at[lt+5]),this.H.push(this.C.transform.bind(this.C,Ae,je,Qe,nt,Je,et))},rotate:function(Ae){const je=Math.sin(Ae);Ae=Math.cos(Ae),this.transform(Ae,je,-je,Ae,0,0)},_drawPath:function(Ae,je){this.H.push(je.draw.bind(je,this.C,Ae.T,Ae.Wa===Ve?"evenodd":"nonzero"))},_drawRiveImage:function(Ae,je,Qe,nt){var Je=Ae.Fb;if(Je){var et=this.C,at=l(Qe);this.H.push(function(){et.globalCompositeOperation=at,et.globalAlpha=nt,et.drawImage(Je,0,0),et.globalAlpha=1})}},_getMatrix:function(Ae){const je=this.S,Qe=je.length-6;for(let nt=0;6>nt;++nt)Ae[nt]=je[Qe+nt]},_drawImageMesh:function(Ae,je,Qe,nt,Je,et,at,lt,$t,dt,mt){je=this.C.canvas.width;var ft=this.C.canvas.height;const An=dt-lt,Tn=mt-$t;lt=Math.max(lt,0),$t=Math.max($t,0),dt=Math.min(dt,je),mt=Math.min(mt,ft);const Qt=dt-lt,er=mt-$t;if(console.assert(Qt<=Math.min(An,je)),console.assert(er<=Math.min(Tn,ft)),!(0>=Qt||0>=er)){dt=Qt<An||er<Tn,je=mt=1;var jt=Math.ceil(Qt*mt),Ut=Math.ceil(er*je);ft=G.hc(),jt>ft&&(mt*=ft/jt,jt=ft),Ut>ft&&(je*=ft/Ut,Ut=ft),Ne||(Ne=new g.DynamicRectanizer(ft),Ne.reset(512,512)),ft=Ne.addRect(jt,Ut),0>ft&&(_(),Ze.add(this),ft=Ne.addRect(jt,Ut),console.assert(0<=ft));var In=ft&65535,Cn=ft>>16;ct.push({ha:this.S.slice(this.S.length-6),image:Ae,Za:In,$a:Cn,ic:lt,jc:$t,Ac:jt,kb:Ut,Ba:mt,Ca:je,Ua:new Float32Array(Je),Db:new Float32Array(et),indices:new Uint16Array(at),mc:dt,xb:Ae.Ka<<1|(dt?1:0)}),ht+=Je.length,kt+=at.length;var Gt=this.C,ri=l(Qe);this.H.push(function(){Gt.save(),Gt.resetTransform(),Gt.globalCompositeOperation=ri,Gt.globalAlpha=nt;const xn=G.canvas();xn&&Gt.drawImage(xn,In,Cn,jt,Ut,lt,$t,Qt,er),Gt.restore()})}},_clipPath:function(Ae){this.H.push(this.C.clip.bind(this.C,Ae.T,Ae.Wa===Ve?"evenodd":"nonzero"))},clear:function(){Ze.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(Ae,je){this.transform(1,0,0,1,Ae,je)}});g.makeRenderer=function(Ae){const je=new Nt(Ae),Qe=je.C;return new Proxy(je,{get(nt,Je){if(typeof nt[Je]=="function")return function(...et){return nt[Je].apply(nt,et)};if(typeof Qe[Je]=="function"){if(-1<P.indexOf(Je))throw Error("RiveException: Method call to '"+Je+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...et){je.H.push(Qe[Je].bind(Qe,...et))}}return nt[Je]},set(nt,Je,et){if(Je in Qe)return je.H.push(()=>{Qe[Je]=et}),!0}})},g.decodeImage=function(Ae,je){new xe({la:je}).decode(Ae)},g.renderFactory={makeRenderPaint:function(){return new Ke},makeRenderPath:function(){return new Ie},makeRenderImage:function(){let Ae=At;return new xe({xa:()=>{Ae.total++},la:()=>{if(Ae.loaded++,Ae.loaded===Ae.total){const je=Ae.ready;je&&(je(),Ae.ready=null)}}})}};let rt=g.load,At=null;g.load=function(Ae,je,Qe=!0){const nt=new g.FallbackFileAssetLoader;return je!==void 0&&nt.addLoader(je),Qe&&(je=new g.CDNFileAssetLoader,nt.addLoader(je)),new Promise(function(Je){let et=null;At={total:0,loaded:0,ready:function(){Je(et)}},et=rt(Ae,nt),At.total==0&&Je(et)})};let ti=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(Ae,je,Qe,nt,Je=1){ti.call(this,Ae,je,Qe,nt,Je)},S=new I,g.requestAnimationFrame=S.requestAnimationFrame.bind(S),g.cancelAnimationFrame=S.cancelAnimationFrame.bind(S),g.enableFPSCounter=S.Rb.bind(S),g.disableFPSCounter=S.Ob,S.pb=_,g.resolveAnimationFrame=_,g.cleanup=function(){Ne&&Ne.delete()}};var M=Object.assign({},g),T="./this.program",x=typeof window=="object",D=typeof importScripts=="function",N="",q,ie;(x||D)&&(D?N=self.location.href:typeof document<"u"&&document.currentScript&&(N=document.currentScript.src),m&&(N=m),N.indexOf("blob:")!==0?N=N.substr(0,N.replace(/[?#].*/,"").lastIndexOf("/")+1):N="",D&&(ie=l=>{var u=new XMLHttpRequest;return u.open("GET",l,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),q=(l,u,_)=>{var S=new XMLHttpRequest;S.open("GET",l,!0),S.responseType="arraybuffer",S.onload=()=>{S.status==200||S.status==0&&S.response?u(S.response):_()},S.onerror=_,S.send(null)});var K=g.print||console.log.bind(console),se=g.printErr||console.error.bind(console);Object.assign(g,M),M=null,g.thisProgram&&(T=g.thisProgram);var me;g.wasmBinary&&(me=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&W("no native wasm support detected");var z,V,oe=!1,U,j,ne,te,fe,ce,we,$e;function he(){var l=z.buffer;g.HEAP8=U=new Int8Array(l),g.HEAP16=ne=new Int16Array(l),g.HEAP32=fe=new Int32Array(l),g.HEAPU8=j=new Uint8Array(l),g.HEAPU16=te=new Uint16Array(l),g.HEAPU32=ce=new Uint32Array(l),g.HEAPF32=we=new Float32Array(l),g.HEAPF64=$e=new Float64Array(l)}var ue,Z=[],ge=[],Se=[];function ae(){var l=g.preRun.shift();Z.unshift(l)}var H=0,F=null;function W(l){throw g.onAbort&&g.onAbort(l),l="Aborted("+l+")",se(l),oe=!0,l=new WebAssembly.RuntimeError(l+". Build with -sASSERTIONS for more info."),k(l),l}function X(l){return l.startsWith("data:application/octet-stream;base64,")}var le;if(le="canvas_advanced.wasm",!X(le)){var Ee=le;le=g.locateFile?g.locateFile(Ee,N):N+Ee}function Q(l){if(l==le&&me)return new Uint8Array(me);if(ie)return ie(l);throw"both async and sync fetching of the wasm failed"}function ye(l){if(!me&&(x||D)){if(typeof fetch=="function"&&!l.startsWith("file://"))return fetch(l,{credentials:"same-origin"}).then(u=>{if(!u.ok)throw"failed to load wasm binary file at '"+l+"'";return u.arrayBuffer()}).catch(()=>Q(l));if(q)return new Promise((u,_)=>{q(l,S=>u(new Uint8Array(S)),_)})}return Promise.resolve().then(()=>Q(l))}function be(l,u,_){return ye(l).then(S=>WebAssembly.instantiate(S,u)).then(S=>S).then(_,S=>{se("failed to asynchronously prepare wasm: "+S),W(S)})}function ke(l,u){var _=le;return me||typeof WebAssembly.instantiateStreaming!="function"||X(_)||_.startsWith("file://")||typeof fetch!="function"?be(_,l,u):fetch(_,{credentials:"same-origin"}).then(S=>WebAssembly.instantiateStreaming(S,l).then(u,function(C){return se("wasm streaming compile failed: "+C),se("falling back to ArrayBuffer instantiation"),be(_,l,u)}))}var Me,E,d={460492:(l,u,_,S,C)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=l,window.h.I.capture=u,window.h.I.La=_,window.h.ga={},window.h.ga.stopped=S,window.h.ga.yb=C;let R=window.h;R.D=[],R.yc=function(J){for(var ve=0;ve<R.D.length;++ve)if(R.D[ve]==null)return R.D[ve]=J,ve;return R.D.push(J),R.D.length-1},R.Cb=function(J){for(R.D[J]=null;0<R.D.length&&R.D[R.D.length-1]==null;)R.D.pop()},R.Sc=function(J){for(var ve=0;ve<R.D.length;++ve)if(R.D[ve]==J)return R.Cb(ve)},R.ra=function(J){return R.D[J]},R.Ta=["touchend","click"],R.unlock=function(){for(var J=0;J<R.D.length;++J){var ve=R.D[J];ve!=null&&ve.J!=null&&ve.state===R.ga.yb&&ve.J.resume().then(()=>{wn(ve.qb)},_e=>{console.error("Failed to resume audiocontext",_e)})}R.Ta.map(function(_e){document.removeEventListener(_e,R.unlock,!0)})},R.Ta.map(function(J){document.addEventListener(J,R.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(l){document.removeEventListener(l,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var l=new(window.AudioContext||window.webkitAudioContext),u=l.sampleRate;return l.close(),u}catch{return 0}},463249:(l,u,_,S,C,R)=>{if(typeof window.h>"u")return-1;var J={},ve={};return l==window.h.I.ya&&_!=0&&(ve.sampleRate=_),J.J=new(window.AudioContext||window.webkitAudioContext)(ve),J.J.suspend(),J.state=window.h.ga.stopped,_=0,l!=window.h.I.ya&&(_=u),J.Z=J.J.createScriptProcessor(S,_,u),J.Z.onaudioprocess=function(_e){if((J.sa==null||J.sa.length==0)&&(J.sa=new Float32Array(we.buffer,C,S*u)),l==window.h.I.capture||l==window.h.I.La){for(var de=0;de<u;de+=1)for(var Re=_e.inputBuffer.getChannelData(de),De=J.sa,Ve=0;Ve<S;Ve+=1)De[Ve*u+de]=Re[Ve];$n(R,S,C)}if(l==window.h.I.ya||l==window.h.I.La)for(Sn(R,S,C),de=0;de<_e.outputBuffer.numberOfChannels;++de)for(Re=_e.outputBuffer.getChannelData(de),De=J.sa,Ve=0;Ve<S;Ve+=1)Re[Ve]=De[Ve*u+de];else for(de=0;de<_e.outputBuffer.numberOfChannels;++de)_e.outputBuffer.getChannelData(de).fill(0)},l!=window.h.I.capture&&l!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(_e){J.Da=J.J.createMediaStreamSource(_e),J.Da.connect(J.Z),J.Z.connect(J.J.destination)}).catch(function(_e){console.log("Failed to get user media: "+_e)}),l==window.h.I.ya&&J.Z.connect(J.J.destination),J.qb=R,window.h.yc(J)},466126:l=>window.h.ra(l).J.sampleRate,466199:l=>{l=window.h.ra(l),l.Z!==void 0&&(l.Z.onaudioprocess=function(){},l.Z.disconnect(),l.Z=void 0),l.Da!==void 0&&(l.Da.disconnect(),l.Da=void 0),l.J.close(),l.J=void 0,l.qb=void 0},466599:l=>{window.h.Cb(l)},466649:l=>{l=window.h.ra(l),l.J.resume(),l.state=window.h.ga.yb},466788:l=>{l=window.h.ra(l),l.J.suspend(),l.state=window.h.ga.stopped}},p=l=>{for(;0<l.length;)l.shift()(g)},A=(l,u)=>{for(var _=0,S=l.length-1;0<=S;S--){var C=l[S];C==="."?l.splice(S,1):C===".."?(l.splice(S,1),_++):_&&(l.splice(S,1),_--)}if(u)for(;_;_--)l.unshift("..");return l},L=l=>{var u=l.charAt(0)==="/",_=l.substr(-1)==="/";return(l=A(l.split("/").filter(S=>!!S),!u).join("/"))||u||(l="."),l&&_&&(l+="/"),(u?"/":"")+l},ee=l=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(l).slice(1);return l=u[0],u=u[1],!l&&!u?".":(u&&(u=u.substr(0,u.length-1)),l+u)},pe=l=>{if(l==="/")return"/";l=L(l),l=l.replace(/\/$/,"");var u=l.lastIndexOf("/");return u===-1?l:l.substr(u+1)},Ce=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return l=>crypto.getRandomValues(l);W("initRandomDevice")},Oe=l=>(Oe=Ce())(l);function Te(){for(var l="",u=!1,_=arguments.length-1;-1<=_&&!u;_--){if(u=0<=_?arguments[_]:"/",typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";l=u+"/"+l,u=u.charAt(0)==="/"}return l=A(l.split("/").filter(S=>!!S),!u).join("/"),(u?"/":"")+l||"."}var Le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Fe=(l,u,_)=>{var S=u+_;for(_=u;l[_]&&!(_>=S);)++_;if(16<_-u&&l.buffer&&Le)return Le.decode(l.subarray(u,_));for(S="";u<_;){var C=l[u++];if(C&128){var R=l[u++]&63;if((C&224)==192)S+=String.fromCharCode((C&31)<<6|R);else{var J=l[u++]&63;C=(C&240)==224?(C&15)<<12|R<<6|J:(C&7)<<18|R<<12|J<<6|l[u++]&63,65536>C?S+=String.fromCharCode(C):(C-=65536,S+=String.fromCharCode(55296|C>>10,56320|C&1023))}}else S+=String.fromCharCode(C)}return S},He=[],Ue=l=>{for(var u=0,_=0;_<l.length;++_){var S=l.charCodeAt(_);127>=S?u++:2047>=S?u+=2:55296<=S&&57343>=S?(u+=4,++_):u+=3}return u},Xe=(l,u,_,S)=>{if(!(0<S))return 0;var C=_;S=_+S-1;for(var R=0;R<l.length;++R){var J=l.charCodeAt(R);if(55296<=J&&57343>=J){var ve=l.charCodeAt(++R);J=65536+((J&1023)<<10)|ve&1023}if(127>=J){if(_>=S)break;u[_++]=J}else{if(2047>=J){if(_+1>=S)break;u[_++]=192|J>>6}else{if(65535>=J){if(_+2>=S)break;u[_++]=224|J>>12}else{if(_+3>=S)break;u[_++]=240|J>>18,u[_++]=128|J>>12&63}u[_++]=128|J>>6&63}u[_++]=128|J&63}}return u[_]=0,_-C};function st(l,u){var _=Array(Ue(l)+1);return l=Xe(l,_,0,_.length),u&&(_.length=l),_}var tt=[];function We(l,u){tt[l]={input:[],F:[],V:u},Er(l,Pe)}var Pe={open:function(l){var u=tt[l.node.za];if(!u)throw new Ge(43);l.s=u,l.seekable=!1},close:function(l){l.s.V.qa(l.s)},qa:function(l){l.s.V.qa(l.s)},read:function(l,u,_,S){if(!l.s||!l.s.V.jb)throw new Ge(60);for(var C=0,R=0;R<S;R++){try{var J=l.s.V.jb(l.s)}catch{throw new Ge(29)}if(J===void 0&&C===0)throw new Ge(6);if(J==null)break;C++,u[_+R]=J}return C&&(l.node.timestamp=Date.now()),C},write:function(l,u,_,S){if(!l.s||!l.s.V.Oa)throw new Ge(60);try{for(var C=0;C<S;C++)l.s.V.Oa(l.s,u[_+C])}catch{throw new Ge(29)}return S&&(l.node.timestamp=Date.now()),C}},Be={jb:function(){e:{if(!He.length){var l=null;if(typeof window<"u"&&typeof window.prompt=="function"?(l=window.prompt("Input: "),l!==null&&(l+=`
`)):typeof readline=="function"&&(l=readline(),l!==null&&(l+=`
`)),!l){l=null;break e}He=st(l,!0)}l=He.shift()}return l},Oa:function(l,u){u===null||u===10?(K(Fe(l.F,0)),l.F=[]):u!=0&&l.F.push(u)},qa:function(l){l.F&&0<l.F.length&&(K(Fe(l.F,0)),l.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},ze={Oa:function(l,u){u===null||u===10?(se(Fe(l.F,0)),l.F=[]):u!=0&&l.F.push(u)},qa:function(l){l.F&&0<l.F.length&&(se(Fe(l.F,0)),l.F=[])}};function ot(l,u){var _=l.j?l.j.length:0;_>=u||(u=Math.max(u,_*(1048576>_?2:1.125)>>>0),_!=0&&(u=Math.max(u,256)),_=l.j,l.j=new Uint8Array(u),0<l.v&&l.j.set(_.subarray(0,l.v),0))}var qe={O:null,U(){return qe.createNode(null,"/",16895,0)},createNode(l,u,_,S){if((_&61440)===24576||(_&61440)===4096)throw new Ge(63);return qe.O||(qe.O={dir:{node:{Y:qe.l.Y,P:qe.l.P,ka:qe.l.ka,va:qe.l.va,vb:qe.l.vb,Bb:qe.l.Bb,wb:qe.l.wb,tb:qe.l.tb,Ea:qe.l.Ea},stream:{ba:qe.m.ba}},file:{node:{Y:qe.l.Y,P:qe.l.P},stream:{ba:qe.m.ba,read:qe.m.read,write:qe.m.write,pa:qe.m.pa,mb:qe.m.mb,ob:qe.m.ob}},link:{node:{Y:qe.l.Y,P:qe.l.P,ma:qe.l.ma},stream:{}},ab:{node:{Y:qe.l.Y,P:qe.l.P},stream:Dn}}),_=Gr(l,u,_,S),(_.mode&61440)===16384?(_.l=qe.O.dir.node,_.m=qe.O.dir.stream,_.j={}):(_.mode&61440)===32768?(_.l=qe.O.file.node,_.m=qe.O.file.stream,_.v=0,_.j=null):(_.mode&61440)===40960?(_.l=qe.O.link.node,_.m=qe.O.link.stream):(_.mode&61440)===8192&&(_.l=qe.O.ab.node,_.m=qe.O.ab.stream),_.timestamp=Date.now(),l&&(l.j[u]=_,l.timestamp=_.timestamp),_},Kc(l){return l.j?l.j.subarray?l.j.subarray(0,l.v):new Uint8Array(l.j):new Uint8Array(0)},l:{Y(l){var u={};return u.Jc=(l.mode&61440)===8192?l.id:1,u.Mc=l.id,u.mode=l.mode,u.Oc=1,u.uid=0,u.Lc=0,u.za=l.za,(l.mode&61440)===16384?u.size=4096:(l.mode&61440)===32768?u.size=l.v:(l.mode&61440)===40960?u.size=l.link.length:u.size=0,u.Bc=new Date(l.timestamp),u.Nc=new Date(l.timestamp),u.Ic=new Date(l.timestamp),u.Jb=4096,u.Cc=Math.ceil(u.size/u.Jb),u},P(l,u){if(u.mode!==void 0&&(l.mode=u.mode),u.timestamp!==void 0&&(l.timestamp=u.timestamp),u.size!==void 0&&(u=u.size,l.v!=u))if(u==0)l.j=null,l.v=0;else{var _=l.j;l.j=new Uint8Array(u),_&&l.j.set(_.subarray(0,Math.min(u,l.v))),l.v=u}},ka(){throw Sr[44]},va(l,u,_,S){return qe.createNode(l,u,_,S)},vb(l,u,_){if((l.mode&61440)===16384){try{var S=rr(u,_)}catch{}if(S)for(var C in S.j)throw new Ge(55)}delete l.parent.j[l.name],l.parent.timestamp=Date.now(),l.name=_,u.j[_]=l,u.timestamp=l.parent.timestamp,l.parent=u},Bb(l,u){delete l.j[u],l.timestamp=Date.now()},wb(l,u){var _=rr(l,u),S;for(S in _.j)throw new Ge(55);delete l.j[u],l.timestamp=Date.now()},tb(l){var u=[".",".."],_;for(_ in l.j)l.j.hasOwnProperty(_)&&u.push(_);return u},Ea(l,u,_){return l=qe.createNode(l,u,41471,0),l.link=_,l},ma(l){if((l.mode&61440)!==40960)throw new Ge(28);return l.link}},m:{read(l,u,_,S,C){var R=l.node.j;if(C>=l.node.v)return 0;if(l=Math.min(l.node.v-C,S),8<l&&R.subarray)u.set(R.subarray(C,C+l),_);else for(S=0;S<l;S++)u[_+S]=R[C+S];return l},write(l,u,_,S,C,R){if(u.buffer===U.buffer&&(R=!1),!S)return 0;if(l=l.node,l.timestamp=Date.now(),u.subarray&&(!l.j||l.j.subarray)){if(R)return l.j=u.subarray(_,_+S),l.v=S;if(l.v===0&&C===0)return l.j=u.slice(_,_+S),l.v=S;if(C+S<=l.v)return l.j.set(u.subarray(_,_+S),C),S}if(ot(l,C+S),l.j.subarray&&u.subarray)l.j.set(u.subarray(_,_+S),C);else for(R=0;R<S;R++)l.j[C+R]=u[_+R];return l.v=Math.max(l.v,C+S),S},ba(l,u,_){if(_===1?u+=l.position:_===2&&(l.node.mode&61440)===32768&&(u+=l.node.v),0>u)throw new Ge(28);return u},pa(l,u,_){ot(l.node,u+_),l.node.v=Math.max(l.node.v,u+_)},mb(l,u,_,S,C){if((l.node.mode&61440)!==32768)throw new Ge(43);if(l=l.node.j,C&2||l.buffer!==U.buffer){if((0<_||_+u<l.length)&&(l.subarray?l=l.subarray(_,_+u):l=Array.prototype.slice.call(l,_,_+u)),_=!0,W(),u=void 0,!u)throw new Ge(48);U.set(l,u)}else _=!1,u=l.byteOffset;return{o:u,M:_}},ob(l,u,_,S){return qe.m.write(l,u,0,S,_,!1),0}}};function it(l,u){var _=0;return l&&(_|=365),u&&(_|=146),_}var St=null,Ur={},tr=[],Rn=1,qt=null,Fr=!0,Ge=null,Sr={},Mt=(l,u={})=>{if(l=Te(l),!l)return{path:"",node:null};if(u=Object.assign({hb:!0,Qa:0},u),8<u.Qa)throw new Ge(32);l=l.split("/").filter(J=>!!J);for(var _=St,S="/",C=0;C<l.length;C++){var R=C===l.length-1;if(R&&u.parent)break;if(_=rr(_,l[C]),S=L(S+"/"+l[C]),_.wa&&(!R||R&&u.hb)&&(_=_.wa.root),!R||u.gb){for(R=0;(_.mode&61440)===40960;)if(_=Mn(S),S=Te(ee(S),_),_=Mt(S,{Qa:u.Qa+1}).node,40<R++)throw new Ge(32)}}return{path:S,node:_}},Br=l=>{for(var u;;){if(l===l.parent)return l=l.U.nb,u?l[l.length-1]!=="/"?`${l}/${u}`:l+u:l;u=u?`${l.name}/${u}`:l.name,l=l.parent}},Vr=(l,u)=>{for(var _=0,S=0;S<u.length;S++)_=(_<<5)-_+u.charCodeAt(S)|0;return(l+_>>>0)%qt.length},rr=(l,u)=>{var _;if(_=(_=nr(l,"x"))?_:l.l.ka?0:2)throw new Ge(_,l);for(_=qt[Vr(l.id,u)];_;_=_.lc){var S=_.name;if(_.parent.id===l.id&&S===u)return _}return l.l.ka(l,u)},Gr=(l,u,_,S)=>(l=new _n(l,u,_,S),u=Vr(l.parent.id,l.name),l.lc=qt[u],qt[u]=l),qr=l=>{var u=["r","w","rw"][l&3];return l&512&&(u+="w"),u},nr=(l,u)=>{if(Fr)return 0;if(!u.includes("r")||l.mode&292){if(u.includes("w")&&!(l.mode&146)||u.includes("x")&&!(l.mode&73))return 2}else return 2;return 0},Wr=(l,u)=>{try{return rr(l,u),20}catch{}return nr(l,"wx")},On=()=>{for(var l=0;4096>=l;l++)if(!tr[l])return l;throw new Ge(33)},Ot=l=>{if(l=tr[l],!l)throw new Ge(8);return l},Hr=(l,u=-1)=>(Ht||(Ht=function(){this.h={}},Ht.prototype={},Object.defineProperties(Ht.prototype,{object:{get(){return this.node},set(_){this.node=_}},flags:{get(){return this.h.flags},set(_){this.h.flags=_}},position:{get(){return this.h.position},set(_){this.h.position=_}}})),l=Object.assign(new Ht,l),u==-1&&(u=On()),l.X=u,tr[u]=l),Dn={open:l=>{l.m=Ur[l.node.za].m,l.m.open&&l.m.open(l)},ba:()=>{throw new Ge(70)}},Er=(l,u)=>{Ur[l]={m:u}},zr=(l,u)=>{var _=u==="/",S=!u;if(_&&St)throw new Ge(10);if(!_&&!S){var C=Mt(u,{hb:!1});if(u=C.path,C=C.node,C.wa)throw new Ge(10);if((C.mode&61440)!==16384)throw new Ge(54)}u={type:l,Qc:{},nb:u,kc:[]},l=l.U(u),l.U=u,u.root=l,_?St=l:C&&(C.wa=u,C.U&&C.U.kc.push(u))},bt=(l,u,_)=>{var S=Mt(l,{parent:!0}).node;if(l=pe(l),!l||l==="."||l==="..")throw new Ge(28);var C=Wr(S,l);if(C)throw new Ge(C);if(!S.l.va)throw new Ge(63);return S.l.va(S,l,u,_)},ir=(l,u,_)=>{typeof _>"u"&&(_=u,u=438),bt(l,u|8192,_)},kr=(l,u)=>{if(!Te(l))throw new Ge(44);var _=Mt(u,{parent:!0}).node;if(!_)throw new Ge(44);u=pe(u);var S=Wr(_,u);if(S)throw new Ge(S);if(!_.l.Ea)throw new Ge(63);_.l.Ea(_,u,l)},Mn=l=>{if(l=Mt(l).node,!l)throw new Ge(44);if(!l.l.ma)throw new Ge(28);return Te(Br(l.parent),l.l.ma(l))},sr=(l,u,_)=>{if(l==="")throw new Ge(44);if(typeof u=="string"){var S={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[u];if(typeof S>"u")throw Error(`Unknown file open mode: ${u}`);u=S}if(_=u&64?(typeof _>"u"?438:_)&4095|32768:0,typeof l=="object")var C=l;else{l=L(l);try{C=Mt(l,{gb:!(u&131072)}).node}catch{}}if(S=!1,u&64)if(C){if(u&128)throw new Ge(20)}else C=bt(l,_,0),S=!0;if(!C)throw new Ge(44);if((C.mode&61440)===8192&&(u&=-513),u&65536&&(C.mode&61440)!==16384)throw new Ge(54);if(!S&&(_=C?(C.mode&61440)===40960?32:(C.mode&61440)===16384&&(qr(u)!=="r"||u&512)?31:nr(C,qr(u)):44))throw new Ge(_);if(u&512&&!S){if(_=C,_=typeof _=="string"?Mt(_,{gb:!0}).node:_,!_.l.P)throw new Ge(63);if((_.mode&61440)===16384)throw new Ge(31);if((_.mode&61440)!==32768)throw new Ge(28);if(S=nr(_,"w"))throw new Ge(S);_.l.P(_,{size:0,timestamp:Date.now()})}return u&=-131713,C=Hr({node:C,path:Br(C),flags:u,seekable:!0,position:0,m:C.m,zc:[],error:!1}),C.m.open&&C.m.open(C),!g.logReadFiles||u&1||(or||(or={}),l in or||(or[l]=1)),C},Yr=(l,u,_)=>{if(l.X===null)throw new Ge(8);if(!l.seekable||!l.m.ba)throw new Ge(70);if(_!=0&&_!=1&&_!=2)throw new Ge(28);l.position=l.m.ba(l,u,_),l.zc=[]},Kr=()=>{Ge||(Ge=function(l,u){this.name="ErrnoError",this.node=u,this.pc=function(_){this.aa=_},this.pc(l),this.message="FS error"},Ge.prototype=Error(),Ge.prototype.constructor=Ge,[44].forEach(l=>{Sr[l]=new Ge(l),Sr[l].stack="<generic error, no stack>"}))},Jr,Wt=(l,u,_)=>{l=L("/dev/"+l);var S=it(!!u,!!_);Ar||(Ar=64);var C=Ar++<<8|0;Er(C,{open:R=>{R.seekable=!1},close:()=>{_&&_.buffer&&_.buffer.length&&_(10)},read:(R,J,ve,_e)=>{for(var de=0,Re=0;Re<_e;Re++){try{var De=u()}catch{throw new Ge(29)}if(De===void 0&&de===0)throw new Ge(6);if(De==null)break;de++,J[ve+Re]=De}return de&&(R.node.timestamp=Date.now()),de},write:(R,J,ve,_e)=>{for(var de=0;de<_e;de++)try{_(J[ve+de])}catch{throw new Ge(29)}return _e&&(R.node.timestamp=Date.now()),de}}),ir(l,S,C)},Ar,Lt={},Ht,or,zt=void 0;function Tt(){return zt+=4,fe[zt-4>>2]}function Xr(l){if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var u=l.charCodeAt(0);return 48<=u&&57>=u?`_${l}`:l}function ar(l,u){return l=Xr(l),{[l]:function(){return u.apply(this,arguments)}}[l]}function Zr(){this.M=[void 0],this.ib=[]}var pt=new Zr,Ft=void 0;function Ye(l){throw new Ft(l)}var yt=l=>(l||Ye("Cannot use deleted val. handle = "+l),pt.get(l).value),wt=l=>{switch(l){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return pt.pa({ub:1,value:l})}};function Qr(l){var u=Error,_=ar(l,function(S){this.name=l,this.message=S,S=Error(S).stack,S!==void 0&&(this.stack=this.toString()+`
`+S.replace(/^Error(:[^\n]*)?\n/,""))});return _.prototype=Object.create(u.prototype),_.prototype.constructor=_,_.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},_}var en=void 0,tn=void 0;function ut(l){for(var u="";j[l];)u+=tn[j[l++]];return u}var Yt=[];function Tr(){for(;Yt.length;){var l=Yt.pop();l.g.fa=!1,l.delete()}}var Kt=void 0,It={};function Ir(l,u){for(u===void 0&&Ye("ptr should not be undefined");l.A;)u=l.na(u),l=l.A;return u}var Pt={};function rn(l){l=En(l);var u=ut(l);return Rt(l),u}function Jt(l,u){var _=Pt[l];return _===void 0&&Ye(u+" has unknown type "+rn(l)),_}function lr(){}var Cr=!1;function nn(l){--l.count.value,l.count.value===0&&(l.G?l.L.W(l.G):l.u.i.W(l.o))}function sn(l,u,_){return u===_?l:_.A===void 0?null:(l=sn(l,u,_.A),l===null?null:_.Pb(l))}var on={};function Ln(l,u){return u=Ir(l,u),It[u]}var an=void 0;function cr(l){throw new an(l)}function ur(l,u){return u.u&&u.o||cr("makeClassHandle requires ptr and ptrType"),!!u.L!=!!u.G&&cr("Both smartPtrType and smartPtr must be specified"),u.count={value:1},Bt(Object.create(l,{g:{value:u}}))}function Bt(l){return typeof FinalizationRegistry>"u"?(Bt=u=>u,l):(Cr=new FinalizationRegistry(u=>{nn(u.g)}),Bt=u=>{var _=u.g;return _.G&&Cr.register(u,{g:_},u),u},lr=u=>{Cr.unregister(u)},Bt(l))}var dr={};function Xt(l){for(;l.length;){var u=l.pop();l.pop()(u)}}function Zt(l){return this.fromWireType(fe[l>>2])}var Vt={},fr={};function gt(l,u,_){function S(ve){ve=_(ve),ve.length!==l.length&&cr("Mismatched type converter count");for(var _e=0;_e<l.length;++_e)Et(l[_e],ve[_e])}l.forEach(function(ve){fr[ve]=u});var C=Array(u.length),R=[],J=0;u.forEach((ve,_e)=>{Pt.hasOwnProperty(ve)?C[_e]=Pt[ve]:(R.push(ve),Vt.hasOwnProperty(ve)||(Vt[ve]=[]),Vt[ve].push(()=>{C[_e]=Pt[ve],++J,J===R.length&&S(C)}))}),R.length===0&&S(C)}function hr(l){switch(l){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${l}`)}}function Pn(l,u,_={}){var S=u.name;if(l||Ye(`type "${S}" must have a positive integer typeid pointer`),Pt.hasOwnProperty(l)){if(_.$b)return;Ye(`Cannot register type '${S}' twice`)}Pt[l]=u,delete fr[l],Vt.hasOwnProperty(l)&&(u=Vt[l],delete Vt[l],u.forEach(C=>C()))}function Et(l,u,_={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");Pn(l,u,_)}function xr(l){Ye(l.g.u.i.name+" instance already deleted")}function Dt(){}function Rr(l,u,_){if(l[u].B===void 0){var S=l[u];l[u]=function(){return l[u].B.hasOwnProperty(arguments.length)||Ye(`Function '${_}' called with an invalid number of arguments (${arguments.length}) - expects one of (${l[u].B})!`),l[u].B[arguments.length].apply(this,arguments)},l[u].B=[],l[u].B[S.ea]=S}}function Or(l,u,_){g.hasOwnProperty(l)?((_===void 0||g[l].B!==void 0&&g[l].B[_]!==void 0)&&Ye(`Cannot register public name '${l}' twice`),Rr(g,l,l),g.hasOwnProperty(_)&&Ye(`Cannot register multiple overloads of a function with the same number of arguments (${_})!`),g[l].B[_]=u):(g[l]=u,_!==void 0&&(g[l].Pc=_))}function Nn(l,u,_,S,C,R,J,ve){this.name=l,this.constructor=u,this.N=_,this.W=S,this.A=C,this.Ub=R,this.na=J,this.Pb=ve,this.rb=[]}function vr(l,u,_){for(;u!==_;)u.na||Ye(`Expected null or instance of ${_.name}, got an instance of ${u.name}`),l=u.na(l),u=u.A;return l}function jn(l,u){return u===null?(this.Na&&Ye(`null is not a valid ${this.name}`),0):(u.g||Ye(`Cannot pass "${Mr(u)}" as a ${this.name}`),u.g.o||Ye(`Cannot pass deleted object as a pointer of type ${this.name}`),vr(u.g.o,u.g.u.i,this.i))}function Un(l,u){if(u===null){if(this.Na&&Ye(`null is not a valid ${this.name}`),this.ua){var _=this.Pa();return l!==null&&l.push(this.W,_),_}return 0}if(u.g||Ye(`Cannot pass "${Mr(u)}" as a ${this.name}`),u.g.o||Ye(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&u.g.u.ta&&Ye(`Cannot convert argument of type ${u.g.L?u.g.L.name:u.g.u.name} to parameter type ${this.name}`),_=vr(u.g.o,u.g.u.i,this.i),this.ua)switch(u.g.G===void 0&&Ye("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:u.g.L===this?_=u.g.G:Ye(`Cannot convert argument of type ${u.g.L?u.g.L.name:u.g.u.name} to parameter type ${this.name}`);break;case 1:_=u.g.G;break;case 2:if(u.g.L===this)_=u.g.G;else{var S=u.clone();_=this.oc(_,wt(function(){S.delete()})),l!==null&&l.push(this.W,_)}break;default:Ye("Unsupporting sharing policy")}return _}function Fn(l,u){return u===null?(this.Na&&Ye(`null is not a valid ${this.name}`),0):(u.g||Ye(`Cannot pass "${Mr(u)}" as a ${this.name}`),u.g.o||Ye(`Cannot pass deleted object as a pointer of type ${this.name}`),u.g.u.ta&&Ye(`Cannot convert argument of type ${u.g.u.name} to parameter type ${this.name}`),vr(u.g.o,u.g.u.i,this.i))}function Ct(l,u,_,S){this.name=l,this.i=u,this.Na=_,this.ta=S,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,u.A!==void 0?this.toWireType=Un:(this.toWireType=S?jn:Fn,this.K=null)}function ln(l,u,_){g.hasOwnProperty(l)||cr("Replacing nonexistant public symbol"),g[l].B!==void 0&&_!==void 0?g[l].B[_]=u:(g[l]=u,g[l].ea=_)}var gr=[],cn=l=>{var u=gr[l];return u||(l>=gr.length&&(gr.length=l+1),gr[l]=u=ue.get(l)),u},Bn=(l,u)=>{var _=[];return function(){if(_.length=0,Object.assign(_,arguments),l.includes("j")){var S=g["dynCall_"+l];S=_&&_.length?S.apply(null,[u].concat(_)):S.call(null,u)}else S=cn(u).apply(null,_);return S}};function vt(l,u){l=ut(l);var _=l.includes("j")?Bn(l,u):cn(u);return typeof _!="function"&&Ye(`unknown function pointer with signature ${l}: ${u}`),_}var un=void 0;function xt(l,u){function _(R){C[R]||Pt[R]||(fr[R]?fr[R].forEach(_):(S.push(R),C[R]=!0))}var S=[],C={};throw u.forEach(_),new un(`${l}: `+S.map(rn).join([", "]))}function pr(l,u,_,S,C){var R=u.length;2>R&&Ye("argTypes array size mismatch! Must at least get return value and 'this' types!");var J=u[1]!==null&&_!==null,ve=!1;for(_=1;_<u.length;++_)if(u[_]!==null&&u[_].K===void 0){ve=!0;break}var _e=u[0].name!=="void",de=R-2,Re=Array(de),De=[],Ve=[];return function(){if(arguments.length!==de&&Ye(`function ${l} called with ${arguments.length} arguments, expected ${de} args!`),Ve.length=0,De.length=J?2:1,De[0]=C,J){var re=u[1].toWireType(Ve,this);De[1]=re}for(var xe=0;xe<de;++xe)Re[xe]=u[xe+2].toWireType(Ve,arguments[xe]),De.push(Re[xe]);if(xe=S.apply(null,De),ve)Xt(Ve);else for(var Ie=J?1:2;Ie<u.length;Ie++){var Ke=Ie===1?re:Re[Ie-2];u[Ie].K!==null&&u[Ie].K(Ke)}return re=_e?u[0].fromWireType(xe):void 0,re}}function _r(l,u){for(var _=[],S=0;S<l;S++)_.push(ce[u+4*S>>2]);return _}function dn(l,u,_){return l instanceof Object||Ye(`${_} with invalid "this": ${l}`),l instanceof u.i.constructor||Ye(`${_} incompatible with "this" of type ${l.constructor.name}`),l.g.o||Ye(`cannot call emscripten binding method ${_} on deleted object`),vr(l.g.o,l.g.u.i,u.i)}function Dr(l){l>=pt.h&&--pt.get(l).ub===0&&pt.Zb(l)}function Vn(l,u,_){switch(u){case 0:return function(S){return this.fromWireType((_?U:j)[S])};case 1:return function(S){return this.fromWireType((_?ne:te)[S>>1])};case 2:return function(S){return this.fromWireType((_?fe:ce)[S>>2])};default:throw new TypeError("Unknown integer type: "+l)}}function Mr(l){if(l===null)return"null";var u=typeof l;return u==="object"||u==="array"||u==="function"?l.toString():""+l}function Gn(l,u){switch(u){case 2:return function(_){return this.fromWireType(we[_>>2])};case 3:return function(_){return this.fromWireType($e[_>>3])};default:throw new TypeError("Unknown float type: "+l)}}function qn(l,u,_){switch(u){case 0:return _?function(S){return U[S]}:function(S){return j[S]};case 1:return _?function(S){return ne[S>>1]}:function(S){return te[S>>1]};case 2:return _?function(S){return fe[S>>2]}:function(S){return ce[S>>2]};default:throw new TypeError("Unknown integer type: "+l)}}var fn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Wn=(l,u)=>{for(var _=l>>1,S=_+u/2;!(_>=S)&&te[_];)++_;if(_<<=1,32<_-l&&fn)return fn.decode(j.subarray(l,_));for(_="",S=0;!(S>=u/2);++S){var C=ne[l+2*S>>1];if(C==0)break;_+=String.fromCharCode(C)}return _},Hn=(l,u,_)=>{if(_===void 0&&(_=2147483647),2>_)return 0;_-=2;var S=u;_=_<2*l.length?_/2:l.length;for(var C=0;C<_;++C)ne[u>>1]=l.charCodeAt(C),u+=2;return ne[u>>1]=0,u-S},zn=l=>2*l.length,Yn=(l,u)=>{for(var _=0,S="";!(_>=u/4);){var C=fe[l+4*_>>2];if(C==0)break;++_,65536<=C?(C-=65536,S+=String.fromCharCode(55296|C>>10,56320|C&1023)):S+=String.fromCharCode(C)}return S},Kn=(l,u,_)=>{if(_===void 0&&(_=2147483647),4>_)return 0;var S=u;_=S+_-4;for(var C=0;C<l.length;++C){var R=l.charCodeAt(C);if(55296<=R&&57343>=R){var J=l.charCodeAt(++C);R=65536+((R&1023)<<10)|J&1023}if(fe[u>>2]=R,u+=4,u+4>_)break}return fe[u>>2]=0,u-S},Jn=l=>{for(var u=0,_=0;_<l.length;++_){var S=l.charCodeAt(_);55296<=S&&57343>=S&&++_,u+=4}return u},Xn={};function mr(l){var u=Xn[l];return u===void 0?ut(l):u}var br=[];function Zn(l){var u=br.length;return br.push(l),u}function Qn(l,u){for(var _=Array(l),S=0;S<l;++S)_[S]=Jt(ce[u+4*S>>2],"parameter "+S);return _}var hn=[],Lr=[],Pr={},vn=()=>{if(!Nr){var l={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:T||"./this.program"},u;for(u in Pr)Pr[u]===void 0?delete l[u]:l[u]=Pr[u];var _=[];for(u in l)_.push(`${u}=${l[u]}`);Nr=_}return Nr},Nr,yr=l=>l%4===0&&(l%100!==0||l%400===0),gn=[31,29,31,30,31,30,31,31,30,31,30,31],pn=[31,28,31,30,31,30,31,31,30,31,30,31],ei=(l,u,_,S)=>{function C(re,xe,Ie){for(re=typeof re=="number"?re.toString():re||"";re.length<xe;)re=Ie[0]+re;return re}function R(re,xe){return C(re,xe,"0")}function J(re,xe){function Ie(Ze){return 0>Ze?-1:0<Ze?1:0}var Ke;return(Ke=Ie(re.getFullYear()-xe.getFullYear()))===0&&(Ke=Ie(re.getMonth()-xe.getMonth()))===0&&(Ke=Ie(re.getDate()-xe.getDate())),Ke}function ve(re){switch(re.getDay()){case 0:return new Date(re.getFullYear()-1,11,29);case 1:return re;case 2:return new Date(re.getFullYear(),0,3);case 3:return new Date(re.getFullYear(),0,2);case 4:return new Date(re.getFullYear(),0,1);case 5:return new Date(re.getFullYear()-1,11,31);case 6:return new Date(re.getFullYear()-1,11,30)}}function _e(re){var xe=re.ca;for(re=new Date(new Date(re.da+1900,0,1).getTime());0<xe;){var Ie=re.getMonth(),Ke=(yr(re.getFullYear())?gn:pn)[Ie];if(xe>Ke-re.getDate())xe-=Ke-re.getDate()+1,re.setDate(1),11>Ie?re.setMonth(Ie+1):(re.setMonth(0),re.setFullYear(re.getFullYear()+1));else{re.setDate(re.getDate()+xe);break}}return Ie=new Date(re.getFullYear()+1,0,4),xe=ve(new Date(re.getFullYear(),0,4)),Ie=ve(Ie),0>=J(xe,re)?0>=J(Ie,re)?re.getFullYear()+1:re.getFullYear():re.getFullYear()-1}var de=fe[S+40>>2];S={wc:fe[S>>2],vc:fe[S+4>>2],Fa:fe[S+8>>2],Sa:fe[S+12>>2],Ga:fe[S+16>>2],da:fe[S+20>>2],R:fe[S+24>>2],ca:fe[S+28>>2],Rc:fe[S+32>>2],uc:fe[S+36>>2],xc:de&&de?Fe(j,de):""},_=_?Fe(j,_):"",de={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Re in de)_=_.replace(new RegExp(Re,"g"),de[Re]);var De="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ve="January February March April May June July August September October November December".split(" ");de={"%a":re=>De[re.R].substring(0,3),"%A":re=>De[re.R],"%b":re=>Ve[re.Ga].substring(0,3),"%B":re=>Ve[re.Ga],"%C":re=>R((re.da+1900)/100|0,2),"%d":re=>R(re.Sa,2),"%e":re=>C(re.Sa,2," "),"%g":re=>_e(re).toString().substring(2),"%G":re=>_e(re),"%H":re=>R(re.Fa,2),"%I":re=>(re=re.Fa,re==0?re=12:12<re&&(re-=12),R(re,2)),"%j":re=>{for(var xe=0,Ie=0;Ie<=re.Ga-1;xe+=(yr(re.da+1900)?gn:pn)[Ie++]);return R(re.Sa+xe,3)},"%m":re=>R(re.Ga+1,2),"%M":re=>R(re.vc,2),"%n":()=>`
`,"%p":re=>0<=re.Fa&&12>re.Fa?"AM":"PM","%S":re=>R(re.wc,2),"%t":()=>"	","%u":re=>re.R||7,"%U":re=>R(Math.floor((re.ca+7-re.R)/7),2),"%V":re=>{var xe=Math.floor((re.ca+7-(re.R+6)%7)/7);if(2>=(re.R+371-re.ca-2)%7&&xe++,xe)xe==53&&(Ie=(re.R+371-re.ca)%7,Ie==4||Ie==3&&yr(re.da)||(xe=1));else{xe=52;var Ie=(re.R+7-re.ca-1)%7;(Ie==4||Ie==5&&yr(re.da%400-1))&&xe++}return R(xe,2)},"%w":re=>re.R,"%W":re=>R(Math.floor((re.ca+7-(re.R+6)%7)/7),2),"%y":re=>(re.da+1900).toString().substring(2),"%Y":re=>re.da+1900,"%z":re=>{re=re.uc;var xe=0<=re;return re=Math.abs(re)/60,(xe?"+":"-")+("0000"+(re/60*100+re%60)).slice(-4)},"%Z":re=>re.xc,"%%":()=>"%"},_=_.replace(/%%/g,"\0\0");for(Re in de)_.includes(Re)&&(_=_.replace(new RegExp(Re,"g"),de[Re](S)));return _=_.replace(/\0\0/g,"%"),Re=st(_,!1),Re.length>u?0:(U.set(Re,l),Re.length-1)};function _n(l,u,_,S){l||(l=this),this.parent=l,this.U=l.U,this.wa=null,this.id=Rn++,this.name=u,this.mode=_,this.l={},this.m={},this.za=S}Object.defineProperties(_n.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(l){l?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(l){l?this.mode|=146:this.mode&=-147}}}),Kr(),qt=Array(4096),zr(qe,"/"),bt("/tmp",16895,0),bt("/home",16895,0),bt("/home/web_user",16895,0),(()=>{bt("/dev",16895,0),Er(259,{read:()=>0,write:(S,C,R,J)=>J}),ir("/dev/null",259),We(1280,Be),We(1536,ze),ir("/dev/tty",1280),ir("/dev/tty1",1536);var l=new Uint8Array(1024),u=0,_=()=>(u===0&&(u=Oe(l).byteLength),l[--u]);Wt("random",_),Wt("urandom",_),bt("/dev/shm",16895,0),bt("/dev/shm/tmp",16895,0)})(),(()=>{bt("/proc",16895,0);var l=bt("/proc/self",16895,0);bt("/proc/self/fd",16895,0),zr({U:()=>{var u=Gr(l,"fd",16895,73);return u.l={ka:(_,S)=>{var C=Ot(+S);return _={parent:null,U:{nb:"fake"},l:{ma:()=>C.path}},_.parent=_}},u}},"/proc/self/fd")})(),Object.assign(Zr.prototype,{get(l){return this.M[l]},has(l){return this.M[l]!==void 0},pa(l){var u=this.ib.pop()||this.M.length;return this.M[u]=l,u},Zb(l){this.M[l]=void 0,this.ib.push(l)}}),Ft=g.BindingError=class extends Error{constructor(l){super(l),this.name="BindingError"}},pt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),pt.h=pt.M.length,g.count_emval_handles=function(){for(var l=0,u=pt.h;u<pt.M.length;++u)pt.M[u]!==void 0&&++l;return l},en=g.PureVirtualError=Qr("PureVirtualError");for(var mn=Array(256),wr=0;256>wr;++wr)mn[wr]=String.fromCharCode(wr);tn=mn,g.getInheritedInstanceCount=function(){return Object.keys(It).length},g.getLiveInheritedInstances=function(){var l=[],u;for(u in It)It.hasOwnProperty(u)&&l.push(It[u]);return l},g.flushPendingDeletes=Tr,g.setDelayFunction=function(l){Kt=l,Yt.length&&Kt&&Kt(Tr)},an=g.InternalError=class extends Error{constructor(l){super(l),this.name="InternalError"}},Dt.prototype.isAliasOf=function(l){if(!(this instanceof Dt&&l instanceof Dt))return!1;var u=this.g.u.i,_=this.g.o,S=l.g.u.i;for(l=l.g.o;u.A;)_=u.na(_),u=u.A;for(;S.A;)l=S.na(l),S=S.A;return u===S&&_===l},Dt.prototype.clone=function(){if(this.g.o||xr(this),this.g.ia)return this.g.count.value+=1,this;var l=Bt,u=Object,_=u.create,S=Object.getPrototypeOf(this),C=this.g;return l=l(_.call(u,S,{g:{value:{count:C.count,fa:C.fa,ia:C.ia,o:C.o,u:C.u,G:C.G,L:C.L}}})),l.g.count.value+=1,l.g.fa=!1,l},Dt.prototype.delete=function(){this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ye("Object already scheduled for deletion"),lr(this),nn(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Dt.prototype.isDeleted=function(){return!this.g.o},Dt.prototype.deleteLater=function(){return this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ye("Object already scheduled for deletion"),Yt.push(this),Yt.length===1&&Kt&&Kt(Tr),this.g.fa=!0,this},Ct.prototype.Vb=function(l){return this.sb&&(l=this.sb(l)),l},Ct.prototype.bb=function(l){this.W&&this.W(l)},Ct.prototype.argPackAdvance=8,Ct.prototype.readValueFromPointer=Zt,Ct.prototype.deleteObject=function(l){l!==null&&l.delete()},Ct.prototype.fromWireType=function(l){function u(){return this.ua?ur(this.i.N,{u:this.nc,o:_,L:this,G:l}):ur(this.i.N,{u:this,o:l})}var _=this.Vb(l);if(!_)return this.bb(l),null;var S=Ln(this.i,_);if(S!==void 0)return S.g.count.value===0?(S.g.o=_,S.g.G=l,S.clone()):(S=S.clone(),this.bb(l),S);if(S=this.i.Ub(_),S=on[S],!S)return u.call(this);S=this.ta?S.Kb:S.pointerType;var C=sn(_,this.i,S.i);return C===null?u.call(this):this.ua?ur(S.i.N,{u:S,o:C,L:this,G:l}):ur(S.i.N,{u:S,o:C})},un=g.UnboundTypeError=Qr("UnboundTypeError");var bn={__syscall_fcntl64:function(l,u,_){zt=_;try{var S=Ot(l);switch(u){case 0:var C=Tt();return 0>C?-28:Hr(S,C).X;case 1:case 2:return 0;case 3:return S.flags;case 4:return C=Tt(),S.flags|=C,0;case 5:return C=Tt(),ne[C+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return fe[yn()>>2]=28,-1;default:return-28}}catch(R){if(typeof Lt>"u"||R.name!=="ErrnoError")throw R;return-R.aa}},__syscall_ioctl:function(l,u,_){zt=_;try{var S=Ot(l);switch(u){case 21509:return S.s?0:-59;case 21505:if(!S.s)return-59;if(S.s.V.bc){u=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var C=Tt();fe[C>>2]=25856,fe[C+4>>2]=5,fe[C+8>>2]=191,fe[C+12>>2]=35387;for(var R=0;32>R;R++)U[C+R+17>>0]=u[R]||0}return 0;case 21510:case 21511:case 21512:return S.s?0:-59;case 21506:case 21507:case 21508:if(!S.s)return-59;if(S.s.V.cc)for(C=Tt(),u=[],R=0;32>R;R++)u.push(U[C+R+17>>0]);return 0;case 21519:return S.s?(C=Tt(),fe[C>>2]=0):-59;case 21520:return S.s?-28:-59;case 21531:if(C=Tt(),!S.m.ac)throw new Ge(59);return S.m.ac(S,u,C);case 21523:return S.s?(S.s.V.dc&&(R=[24,80],C=Tt(),ne[C>>1]=R[0],ne[C+2>>1]=R[1]),0):-59;case 21524:return S.s?0:-59;case 21515:return S.s?0:-59;default:return-28}}catch(J){if(typeof Lt>"u"||J.name!=="ErrnoError")throw J;return-J.aa}},__syscall_openat:function(l,u,_,S){zt=S;try{u=u?Fe(j,u):"";var C=u;if(C.charAt(0)==="/")u=C;else{var R=l===-100?"/":Ot(l).path;if(C.length==0)throw new Ge(44);u=L(R+"/"+C)}var J=S?Tt():0;return sr(u,_,J).X}catch(ve){if(typeof Lt>"u"||ve.name!=="ErrnoError")throw ve;return-ve.aa}},_embind_create_inheriting_constructor:function(l,u,_){l=ut(l),u=Jt(u,"wrapper"),_=yt(_);var S=[].slice,C=u.i,R=C.N,J=C.A.N,ve=C.A.constructor;l=ar(l,function(){C.A.rb.forEach((function(de){if(this[de]===J[de])throw new en(`Pure virtual function ${de} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:R}),this.__construct.apply(this,S.call(arguments))}),R.__construct=function(){this===R&&Ye("Pass correct 'this' to __construct");var de=ve.implement.apply(void 0,[this].concat(S.call(arguments)));lr(de);var Re=de.g;de.notifyOnDestruction(),Re.ia=!0,Object.defineProperties(this,{g:{value:Re}}),Bt(this),de=Re.o,de=Ir(C,de),It.hasOwnProperty(de)?Ye(`Tried to register registered instance: ${de}`):It[de]=this},R.__destruct=function(){this===R&&Ye("Pass correct 'this' to __destruct"),lr(this);var de=this.g.o;de=Ir(C,de),It.hasOwnProperty(de)?delete It[de]:Ye(`Tried to unregister unregistered instance: ${de}`)},l.prototype=Object.create(R);for(var _e in _)l.prototype[_e]=_[_e];return wt(l)},_embind_finalize_value_object:function(l){var u=dr[l];delete dr[l];var _=u.Pa,S=u.W,C=u.fb,R=C.map(J=>J.Yb).concat(C.map(J=>J.rc));gt([l],R,J=>{var ve={};return C.forEach((_e,de)=>{var Re=J[de],De=_e.Wb,Ve=_e.Xb,re=J[de+C.length],xe=_e.qc,Ie=_e.sc;ve[_e.Sb]={read:Ke=>Re.fromWireType(De(Ve,Ke)),write:(Ke,Ze)=>{var Ne=[];xe(Ie,Ke,re.toWireType(Ne,Ze)),Xt(Ne)}}}),[{name:u.name,fromWireType:function(_e){var de={},Re;for(Re in ve)de[Re]=ve[Re].read(_e);return S(_e),de},toWireType:function(_e,de){for(var Re in ve)if(!(Re in de))throw new TypeError(`Missing field: "${Re}"`);var De=_();for(Re in ve)ve[Re].write(De,de[Re]);return _e!==null&&_e.push(S,De),De},argPackAdvance:8,readValueFromPointer:Zt,K:S}]})},_embind_register_bigint:function(){},_embind_register_bool:function(l,u,_,S,C){var R=hr(_);u=ut(u),Et(l,{name:u,fromWireType:function(J){return!!J},toWireType:function(J,ve){return ve?S:C},argPackAdvance:8,readValueFromPointer:function(J){if(_===1)var ve=U;else if(_===2)ve=ne;else if(_===4)ve=fe;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(ve[J>>R])},K:null})},_embind_register_class:function(l,u,_,S,C,R,J,ve,_e,de,Re,De,Ve){Re=ut(Re),R=vt(C,R),ve&&(ve=vt(J,ve)),de&&(de=vt(_e,de)),Ve=vt(De,Ve);var re=Xr(Re);Or(re,function(){xt(`Cannot construct ${Re} due to unbound types`,[S])}),gt([l,u,_],S?[S]:[],function(xe){if(xe=xe[0],S)var Ie=xe.i,Ke=Ie.N;else Ke=Dt.prototype;xe=ar(re,function(){if(Object.getPrototypeOf(this)!==Ze)throw new Ft("Use 'new' to construct "+Re);if(Ne.$===void 0)throw new Ft(Re+" has no accessible constructor");var ht=Ne.$[arguments.length];if(ht===void 0)throw new Ft(`Tried to invoke ctor of ${Re} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Ne.$).toString()}) parameters instead!`);return ht.apply(this,arguments)});var Ze=Object.create(Ke,{constructor:{value:xe}});xe.prototype=Ze;var Ne=new Nn(Re,xe,Ze,Ve,Ie,R,ve,de);Ne.A&&(Ne.A.oa===void 0&&(Ne.A.oa=[]),Ne.A.oa.push(Ne)),Ie=new Ct(Re,Ne,!0,!1),Ke=new Ct(Re+"*",Ne,!1,!1);var ct=new Ct(Re+" const*",Ne,!1,!0);return on[l]={pointerType:Ke,Kb:ct},ln(re,xe),[Ie,Ke,ct]})},_embind_register_class_class_function:function(l,u,_,S,C,R,J){var ve=_r(_,S);u=ut(u),R=vt(C,R),gt([],[l],function(_e){function de(){xt(`Cannot call ${Re} due to unbound types`,ve)}_e=_e[0];var Re=`${_e.name}.${u}`;u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var De=_e.i.constructor;return De[u]===void 0?(de.ea=_-1,De[u]=de):(Rr(De,u,Re),De[u].B[_-1]=de),gt([],ve,function(Ve){if(Ve=pr(Re,[Ve[0],null].concat(Ve.slice(1)),null,R,J),De[u].B===void 0?(Ve.ea=_-1,De[u]=Ve):De[u].B[_-1]=Ve,_e.i.oa)for(const re of _e.i.oa)re.constructor.hasOwnProperty(u)||(re.constructor[u]=Ve);return[]}),[]})},_embind_register_class_class_property:function(l,u,_,S,C,R,J,ve){u=ut(u),R=vt(C,R),gt([],[l],function(_e){_e=_e[0];var de=`${_e.name}.${u}`,Re={get(){xt(`Cannot access ${de} due to unbound types`,[_])},enumerable:!0,configurable:!0};return Re.set=ve?()=>{xt(`Cannot access ${de} due to unbound types`,[_])}:()=>{Ye(`${de} is a read-only property`)},Object.defineProperty(_e.i.constructor,u,Re),gt([],[_],function(De){De=De[0];var Ve={get(){return De.fromWireType(R(S))},enumerable:!0};return ve&&(ve=vt(J,ve),Ve.set=re=>{var xe=[];ve(S,De.toWireType(xe,re)),Xt(xe)}),Object.defineProperty(_e.i.constructor,u,Ve),[]}),[]})},_embind_register_class_constructor:function(l,u,_,S,C,R){var J=_r(u,_);C=vt(S,C),gt([],[l],function(ve){ve=ve[0];var _e=`constructor ${ve.name}`;if(ve.i.$===void 0&&(ve.i.$=[]),ve.i.$[u-1]!==void 0)throw new Ft(`Cannot register multiple constructors with identical number of parameters (${u-1}) for class '${ve.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return ve.i.$[u-1]=()=>{xt(`Cannot construct ${ve.name} due to unbound types`,J)},gt([],J,function(de){return de.splice(1,0,null),ve.i.$[u-1]=pr(_e,de,null,C,R),[]}),[]})},_embind_register_class_function:function(l,u,_,S,C,R,J,ve){var _e=_r(_,S);u=ut(u),R=vt(C,R),gt([],[l],function(de){function Re(){xt(`Cannot call ${De} due to unbound types`,_e)}de=de[0];var De=`${de.name}.${u}`;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),ve&&de.i.rb.push(u);var Ve=de.i.N,re=Ve[u];return re===void 0||re.B===void 0&&re.className!==de.name&&re.ea===_-2?(Re.ea=_-2,Re.className=de.name,Ve[u]=Re):(Rr(Ve,u,De),Ve[u].B[_-2]=Re),gt([],_e,function(xe){return xe=pr(De,xe,de,R,J),Ve[u].B===void 0?(xe.ea=_-2,Ve[u]=xe):Ve[u].B[_-2]=xe,[]}),[]})},_embind_register_class_property:function(l,u,_,S,C,R,J,ve,_e,de){u=ut(u),C=vt(S,C),gt([],[l],function(Re){Re=Re[0];var De=`${Re.name}.${u}`,Ve={get(){xt(`Cannot access ${De} due to unbound types`,[_,J])},enumerable:!0,configurable:!0};return Ve.set=_e?()=>{xt(`Cannot access ${De} due to unbound types`,[_,J])}:()=>{Ye(De+" is a read-only property")},Object.defineProperty(Re.i.N,u,Ve),gt([],_e?[_,J]:[_],function(re){var xe=re[0],Ie={get(){var Ze=dn(this,Re,De+" getter");return xe.fromWireType(C(R,Ze))},enumerable:!0};if(_e){_e=vt(ve,_e);var Ke=re[1];Ie.set=function(Ze){var Ne=dn(this,Re,De+" setter"),ct=[];_e(de,Ne,Ke.toWireType(ct,Ze)),Xt(ct)}}return Object.defineProperty(Re.i.N,u,Ie),[]}),[]})},_embind_register_emval:function(l,u){u=ut(u),Et(l,{name:u,fromWireType:function(_){var S=yt(_);return Dr(_),S},toWireType:function(_,S){return wt(S)},argPackAdvance:8,readValueFromPointer:Zt,K:null})},_embind_register_enum:function(l,u,_,S){function C(){}_=hr(_),u=ut(u),C.values={},Et(l,{name:u,constructor:C,fromWireType:function(R){return this.constructor.values[R]},toWireType:function(R,J){return J.value},argPackAdvance:8,readValueFromPointer:Vn(u,_,S),K:null}),Or(u,C)},_embind_register_enum_value:function(l,u,_){var S=Jt(l,"enum");u=ut(u),l=S.constructor,S=Object.create(S.constructor.prototype,{value:{value:_},constructor:{value:ar(`${S.name}_${u}`,function(){})}}),l.values[_]=S,l[u]=S},_embind_register_float:function(l,u,_){_=hr(_),u=ut(u),Et(l,{name:u,fromWireType:function(S){return S},toWireType:function(S,C){return C},argPackAdvance:8,readValueFromPointer:Gn(u,_),K:null})},_embind_register_function:function(l,u,_,S,C,R){var J=_r(u,_);l=ut(l),C=vt(S,C),Or(l,function(){xt(`Cannot call ${l} due to unbound types`,J)},u-1),gt([],J,function(ve){return ln(l,pr(l,[ve[0],null].concat(ve.slice(1)),null,C,R),u-1),[]})},_embind_register_integer:function(l,u,_,S,C){u=ut(u),C===-1&&(C=4294967295),C=hr(_);var R=ve=>ve;if(S===0){var J=32-8*_;R=ve=>ve<<J>>>J}_=u.includes("unsigned")?function(ve,_e){return _e>>>0}:function(ve,_e){return _e},Et(l,{name:u,fromWireType:R,toWireType:_,argPackAdvance:8,readValueFromPointer:qn(u,C,S!==0),K:null})},_embind_register_memory_view:function(l,u,_){function S(R){R>>=2;var J=ce;return new C(J.buffer,J[R+1],J[R])}var C=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][u];_=ut(_),Et(l,{name:_,fromWireType:S,argPackAdvance:8,readValueFromPointer:S},{$b:!0})},_embind_register_std_string:function(l,u){u=ut(u);var _=u==="std::string";Et(l,{name:u,fromWireType:function(S){var C=ce[S>>2],R=S+4;if(_)for(var J=R,ve=0;ve<=C;++ve){var _e=R+ve;if(ve==C||j[_e]==0){if(J=J?Fe(j,J,_e-J):"",de===void 0)var de=J;else de+="\0",de+=J;J=_e+1}}else{for(de=Array(C),ve=0;ve<C;++ve)de[ve]=String.fromCharCode(j[R+ve]);de=de.join("")}return Rt(S),de},toWireType:function(S,C){C instanceof ArrayBuffer&&(C=new Uint8Array(C));var R=typeof C=="string";R||C instanceof Uint8Array||C instanceof Uint8ClampedArray||C instanceof Int8Array||Ye("Cannot pass non-string to std::string");var J=_&&R?Ue(C):C.length,ve=jr(4+J+1),_e=ve+4;if(ce[ve>>2]=J,_&&R)Xe(C,j,_e,J+1);else if(R)for(R=0;R<J;++R){var de=C.charCodeAt(R);255<de&&(Rt(_e),Ye("String has UTF-16 code units that do not fit in 8 bits")),j[_e+R]=de}else for(R=0;R<J;++R)j[_e+R]=C[R];return S!==null&&S.push(Rt,ve),ve},argPackAdvance:8,readValueFromPointer:Zt,K:function(S){Rt(S)}})},_embind_register_std_wstring:function(l,u,_){if(_=ut(_),u===2)var S=Wn,C=Hn,R=zn,J=()=>te,ve=1;else u===4&&(S=Yn,C=Kn,R=Jn,J=()=>ce,ve=2);Et(l,{name:_,fromWireType:function(_e){for(var de=ce[_e>>2],Re=J(),De,Ve=_e+4,re=0;re<=de;++re){var xe=_e+4+re*u;(re==de||Re[xe>>ve]==0)&&(Ve=S(Ve,xe-Ve),De===void 0?De=Ve:(De+="\0",De+=Ve),Ve=xe+u)}return Rt(_e),De},toWireType:function(_e,de){typeof de!="string"&&Ye(`Cannot pass non-string to C++ string type ${_}`);var Re=R(de),De=jr(4+Re+u);return ce[De>>2]=Re>>ve,C(de,De+4,Re+u),_e!==null&&_e.push(Rt,De),De},argPackAdvance:8,readValueFromPointer:Zt,K:function(_e){Rt(_e)}})},_embind_register_value_object:function(l,u,_,S,C,R){dr[l]={name:ut(u),Pa:vt(_,S),W:vt(C,R),fb:[]}},_embind_register_value_object_field:function(l,u,_,S,C,R,J,ve,_e,de){dr[l].fb.push({Sb:ut(u),Yb:_,Wb:vt(S,C),Xb:R,rc:J,qc:vt(ve,_e),sc:de})},_embind_register_void:function(l,u){u=ut(u),Et(l,{fc:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(l,u,_){l=yt(l),u=Jt(u,"emval::as");var S=[],C=wt(S);return ce[_>>2]=C,u.toWireType(S,l)},_emval_call_method:function(l,u,_,S,C){l=br[l],u=yt(u),_=mr(_);var R=[];return ce[S>>2]=wt(R),l(u,_,R,C)},_emval_call_void_method:function(l,u,_,S){l=br[l],u=yt(u),_=mr(_),l(u,_,null,S)},_emval_decref:Dr,_emval_get_method_caller:function(l,u){var _=Qn(l,u),S=_[0];u=S.name+"_$"+_.slice(1).map(function(J){return J.name}).join("_")+"$";var C=hn[u];if(C!==void 0)return C;var R=Array(l-1);return C=Zn((J,ve,_e,de)=>{for(var Re=0,De=0;De<l-1;++De)R[De]=_[De+1].readValueFromPointer(de+Re),Re+=_[De+1].argPackAdvance;for(J=J[ve].apply(J,R),De=0;De<l-1;++De)_[De+1].Nb&&_[De+1].Nb(R[De]);if(!S.fc)return S.toWireType(_e,J)}),hn[u]=C},_emval_get_module_property:function(l){return l=mr(l),wt(g[l])},_emval_get_property:function(l,u){return l=yt(l),u=yt(u),wt(l[u])},_emval_incref:function(l){4<l&&(pt.get(l).ub+=1)},_emval_new_array:function(){return wt([])},_emval_new_cstring:function(l){return wt(mr(l))},_emval_new_object:function(){return wt({})},_emval_run_destructors:function(l){var u=yt(l);Xt(u),Dr(l)},_emval_set_property:function(l,u,_){l=yt(l),u=yt(u),_=yt(_),l[u]=_},_emval_take_value:function(l,u){return l=Jt(l,"_emval_take_value"),l=l.readValueFromPointer(u),wt(l)},abort:()=>{W("")},emscripten_asm_const_int:(l,u,_)=>{Lr.length=0;var S;for(_>>=2;S=j[u++];)_+=S!=105&_,Lr.push(S==105?fe[_]:$e[_++>>1]),++_;return d[l].apply(null,Lr)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(l,u,_)=>j.copyWithin(l,u,u+_),emscripten_resize_heap:l=>{var u=j.length;if(l>>>=0,2147483648<l)return!1;for(var _=1;4>=_;_*=2){var S=u*(1+.2/_);S=Math.min(S,l+100663296);var C=Math;S=Math.max(l,S);e:{C=C.min.call(C,2147483648,S+(65536-S%65536)%65536)-z.buffer.byteLength+65535>>>16;try{z.grow(C),he();var R=1;break e}catch{}R=void 0}if(R)return!0}return!1},environ_get:(l,u)=>{var _=0;return vn().forEach(function(S,C){var R=u+_;for(C=ce[l+4*C>>2]=R,R=0;R<S.length;++R)U[C++>>0]=S.charCodeAt(R);U[C>>0]=0,_+=S.length+1}),0},environ_sizes_get:(l,u)=>{var _=vn();ce[l>>2]=_.length;var S=0;return _.forEach(function(C){S+=C.length+1}),ce[u>>2]=S,0},fd_close:function(l){try{var u=Ot(l);if(u.X===null)throw new Ge(8);u.Ma&&(u.Ma=null);try{u.m.close&&u.m.close(u)}catch(_){throw _}finally{tr[u.X]=null}return u.X=null,0}catch(_){if(typeof Lt>"u"||_.name!=="ErrnoError")throw _;return _.aa}},fd_read:function(l,u,_,S){try{e:{var C=Ot(l);l=u;for(var R,J=u=0;J<_;J++){var ve=ce[l>>2],_e=ce[l+4>>2];l+=8;var de=C,Re=ve,De=_e,Ve=R,re=U;if(0>De||0>Ve)throw new Ge(28);if(de.X===null)throw new Ge(8);if((de.flags&2097155)===1)throw new Ge(8);if((de.node.mode&61440)===16384)throw new Ge(31);if(!de.m.read)throw new Ge(28);var xe=typeof Ve<"u";if(!xe)Ve=de.position;else if(!de.seekable)throw new Ge(70);var Ie=de.m.read(de,re,Re,De,Ve);xe||(de.position+=Ie);var Ke=Ie;if(0>Ke){var Ze=-1;break e}if(u+=Ke,Ke<_e)break;typeof R<"u"&&(R+=Ke)}Ze=u}return ce[S>>2]=Ze,0}catch(Ne){if(typeof Lt>"u"||Ne.name!=="ErrnoError")throw Ne;return Ne.aa}},fd_seek:function(l,u,_,S,C){u=_+2097152>>>0<4194305-!!u?(u>>>0)+4294967296*_:NaN;try{if(isNaN(u))return 61;var R=Ot(l);return Yr(R,u,S),E=[R.position>>>0,(Me=R.position,1<=+Math.abs(Me)?0<Me?+Math.floor(Me/4294967296)>>>0:~~+Math.ceil((Me-+(~~Me>>>0))/4294967296)>>>0:0)],fe[C>>2]=E[0],fe[C+4>>2]=E[1],R.Ma&&u===0&&S===0&&(R.Ma=null),0}catch(J){if(typeof Lt>"u"||J.name!=="ErrnoError")throw J;return J.aa}},fd_write:function(l,u,_,S){try{e:{var C=Ot(l);l=u;for(var R,J=u=0;J<_;J++){var ve=ce[l>>2],_e=ce[l+4>>2];l+=8;var de=C,Re=ve,De=_e,Ve=R,re=U;if(0>De||0>Ve)throw new Ge(28);if(de.X===null)throw new Ge(8);if((de.flags&2097155)===0)throw new Ge(8);if((de.node.mode&61440)===16384)throw new Ge(31);if(!de.m.write)throw new Ge(28);de.seekable&&de.flags&1024&&Yr(de,0,2);var xe=typeof Ve<"u";if(!xe)Ve=de.position;else if(!de.seekable)throw new Ge(70);var Ie=de.m.write(de,re,Re,De,Ve,void 0);xe||(de.position+=Ie);var Ke=Ie;if(0>Ke){var Ze=-1;break e}u+=Ke,typeof R<"u"&&(R+=Ke)}Ze=u}return ce[S>>2]=Ze,0}catch(Ne){if(typeof Lt>"u"||Ne.name!=="ErrnoError")throw Ne;return Ne.aa}},strftime_l:(l,u,_,S)=>ei(l,u,_,S)};(function(){function l(_){if(V=_=_.exports,z=V.memory,he(),ue=V.__indirect_function_table,ge.unshift(V.__wasm_call_ctors),H--,g.monitorRunDependencies&&g.monitorRunDependencies(H),H==0&&F){var S=F;F=null,S()}return _}var u={env:bn,wasi_snapshot_preview1:bn};if(H++,g.monitorRunDependencies&&g.monitorRunDependencies(H),g.instantiateWasm)try{return g.instantiateWasm(u,l)}catch(_){se("Module.instantiateWasm callback failed with error: "+_),k(_)}return ke(u,function(_){l(_.instance)}).catch(k),{}})();var Rt=l=>(Rt=V.free)(l),jr=l=>(jr=V.malloc)(l),yn=()=>(yn=V.__errno_location)(),wn=g._ma_device__on_notification_unlocked=l=>(wn=g._ma_device__on_notification_unlocked=V.ma_device__on_notification_unlocked)(l);g._ma_malloc_emscripten=(l,u)=>(g._ma_malloc_emscripten=V.ma_malloc_emscripten)(l,u),g._ma_free_emscripten=(l,u)=>(g._ma_free_emscripten=V.ma_free_emscripten)(l,u);var $n=g._ma_device_process_pcm_frames_capture__webaudio=(l,u,_)=>($n=g._ma_device_process_pcm_frames_capture__webaudio=V.ma_device_process_pcm_frames_capture__webaudio)(l,u,_),Sn=g._ma_device_process_pcm_frames_playback__webaudio=(l,u,_)=>(Sn=g._ma_device_process_pcm_frames_playback__webaudio=V.ma_device_process_pcm_frames_playback__webaudio)(l,u,_),En=l=>(En=V.__getTypeName)(l);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=V._embind_initialize_bindings)(),g.dynCall_iiji=(l,u,_,S,C)=>(g.dynCall_iiji=V.dynCall_iiji)(l,u,_,S,C),g.dynCall_jiji=(l,u,_,S,C)=>(g.dynCall_jiji=V.dynCall_jiji)(l,u,_,S,C),g.dynCall_iiiji=(l,u,_,S,C,R)=>(g.dynCall_iiiji=V.dynCall_iiiji)(l,u,_,S,C,R),g.dynCall_iij=(l,u,_,S)=>(g.dynCall_iij=V.dynCall_iij)(l,u,_,S),g.dynCall_jii=(l,u,_)=>(g.dynCall_jii=V.dynCall_jii)(l,u,_),g.dynCall_viijii=(l,u,_,S,C,R,J)=>(g.dynCall_viijii=V.dynCall_viijii)(l,u,_,S,C,R,J),g.dynCall_iiiiij=(l,u,_,S,C,R,J)=>(g.dynCall_iiiiij=V.dynCall_iiiiij)(l,u,_,S,C,R,J),g.dynCall_iiiiijj=(l,u,_,S,C,R,J,ve,_e)=>(g.dynCall_iiiiijj=V.dynCall_iiiiijj)(l,u,_,S,C,R,J,ve,_e),g.dynCall_iiiiiijj=(l,u,_,S,C,R,J,ve,_e,de)=>(g.dynCall_iiiiiijj=V.dynCall_iiiiiijj)(l,u,_,S,C,R,J,ve,_e,de);var $r;F=function l(){$r||kn(),$r||(F=l)};function kn(){function l(){if(!$r&&($r=!0,g.calledRun=!0,!oe)){if(g.noFSInit||Jr||(Jr=!0,Kr(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?Wt("stdin",g.stdin):kr("/dev/tty","/dev/stdin"),g.stdout?Wt("stdout",null,g.stdout):kr("/dev/tty","/dev/stdout"),g.stderr?Wt("stderr",null,g.stderr):kr("/dev/tty1","/dev/stderr"),sr("/dev/stdin",0),sr("/dev/stdout",1),sr("/dev/stderr",1)),Fr=!1,p(ge),w(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var u=g.postRun.shift();Se.unshift(u)}p(Se)}}if(!(0<H)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)ae();p(Z),0<H||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),l()},1)):l())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return kn(),y.ready})})();const h=v}),(o=>{o.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((o,c,f)=>{f.r(c),f.d(c,{Animation:()=>v.Animation});var v=f(4)}),((o,c,f)=>{f.r(c),f.d(c,{Animation:()=>v});var v=(function(){function h(m,y,g,w){this.animation=m,this.artboard=y,this.playing=w,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(m,y)}return Object.defineProperty(h.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"time",{get:function(){return this.instance.time},set:function(m){this.instance.time=m},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),h.prototype.advance=function(m){this.scrubTo===null?this.instance.advance(m):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},h.prototype.apply=function(m){this.instance.apply(m)},h.prototype.cleanup=function(){this.instance.delete()},h})()}),((o,c,f)=>{f.r(c),f.d(c,{AudioAssetWrapper:()=>m.AudioAssetWrapper,AudioWrapper:()=>m.AudioWrapper,BLANK_URL:()=>h.BLANK_URL,CustomFileAssetLoaderWrapper:()=>m.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>m.FileAssetWrapper,Finalizable:()=>m.Finalizable,FontAssetWrapper:()=>m.FontAssetWrapper,FontWrapper:()=>m.FontWrapper,ImageAssetWrapper:()=>m.ImageAssetWrapper,ImageWrapper:()=>m.ImageWrapper,finalizationRegistry:()=>m.finalizationRegistry,registerTouchInteractions:()=>v.registerTouchInteractions,sanitizeUrl:()=>h.sanitizeUrl});var v=f(6),h=f(7),m=f(8)}),((o,c,f)=>{f.r(c),f.d(c,{registerTouchInteractions:()=>m});var v=void 0,h=function(y,g){var w,k;return["touchstart","touchmove"].indexOf(y.type)>-1&&(!((w=y.touches)===null||w===void 0)&&w.length)?(g||y.preventDefault(),{clientX:y.touches[0].clientX,clientY:y.touches[0].clientY}):y.type==="touchend"&&(!((k=y.changedTouches)===null||k===void 0)&&k.length)?{clientX:y.changedTouches[0].clientX,clientY:y.changedTouches[0].clientY}:{clientX:y.clientX,clientY:y.clientY}},m=function(y){var g=y.canvas,w=y.artboard,k=y.stateMachines,I=k===void 0?[]:k,O=y.renderer,B=y.rive,P=y.fit,G=y.alignment,Y=y.isTouchScrollEnabled,M=Y===void 0?!1:Y,T=y.layoutScaleFactor,x=T===void 0?1:T;if(!g||!I.length||!O||!B||!w||typeof window>"u")return null;var D=null,N=!1,q=function(K){if(N&&K instanceof MouseEvent){K.type=="mouseup"&&(N=!1);return}N=M&&K.type==="touchend"&&D==="touchstart",D=K.type;var se=K.currentTarget.getBoundingClientRect(),me=h(K,M),z=me.clientX,V=me.clientY;if(!(!z&&!V)){var oe=z-se.left,U=V-se.top,j=B.computeAlignment(P,G,{minX:0,minY:0,maxX:se.width,maxY:se.height},w.bounds,x),ne=new B.Mat2D;j.invert(ne);var te=new B.Vec2D(oe,U),fe=B.mapXY(ne,te),ce=fe.x(),we=fe.y();switch(fe.delete(),ne.delete(),te.delete(),j.delete(),K.type){case"mouseout":for(var $e=0,he=I;$e<he.length;$e++){var ue=he[$e];ue.pointerMove(ce,we)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Z=0,ge=I;Z<ge.length;Z++){var ue=ge[Z];ue.pointerMove(ce,we)}break}case"touchstart":case"mousedown":{for(var Se=0,ae=I;Se<ae.length;Se++){var ue=ae[Se];ue.pointerDown(ce,we)}break}case"touchend":case"mouseup":{for(var H=0,F=I;H<F.length;H++){var ue=F[H];ue.pointerUp(ce,we)}break}}}},ie=q.bind(v);return g.addEventListener("mouseover",ie),g.addEventListener("mouseout",ie),g.addEventListener("mousemove",ie),g.addEventListener("mousedown",ie),g.addEventListener("mouseup",ie),g.addEventListener("touchmove",ie,{passive:M}),g.addEventListener("touchstart",ie,{passive:M}),g.addEventListener("touchend",ie),function(){g.removeEventListener("mouseover",ie),g.removeEventListener("mouseout",ie),g.removeEventListener("mousemove",ie),g.removeEventListener("mousedown",ie),g.removeEventListener("mouseup",ie),g.removeEventListener("touchmove",ie),g.removeEventListener("touchstart",ie),g.removeEventListener("touchend",ie)}}}),((o,c,f)=>{f.r(c),f.d(c,{BLANK_URL:()=>k,sanitizeUrl:()=>B});var v=/^([^\w]*)(javascript|data|vbscript)/im,h=/&#(\w+)(^\w|;)?/g,m=/&(newline|tab);/gi,y=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,w=[".","/"],k="about:blank";function I(P){return w.indexOf(P[0])>-1}function O(P){var G=P.replace(y,"");return G.replace(h,function(Y,M){return String.fromCharCode(M)})}function B(P){if(!P)return k;var G=O(P).replace(m,"").replace(y,"").trim();if(!G)return k;if(I(G))return G;var Y=G.match(g);if(!Y)return G;var M=Y[0];return v.test(M)?k:G}}),((o,c,f)=>{f.r(c),f.d(c,{AudioAssetWrapper:()=>O,AudioWrapper:()=>y,CustomFileAssetLoaderWrapper:()=>w,FileAssetWrapper:()=>k,Finalizable:()=>h,FontAssetWrapper:()=>B,FontWrapper:()=>g,ImageAssetWrapper:()=>I,ImageWrapper:()=>m,finalizationRegistry:()=>Y});var v=(function(){var M=function(T,x){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,N){D.__proto__=N}||function(D,N){for(var q in N)Object.prototype.hasOwnProperty.call(N,q)&&(D[q]=N[q])},M(T,x)};return function(T,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");M(T,x);function D(){this.constructor=T}T.prototype=x===null?Object.create(x):(D.prototype=x.prototype,new D)}})(),h=(function(){function M(){this.selfUnref=!1}return M})(),m=(function(M){v(T,M);function T(x){var D=M.call(this)||this;return D._nativeImage=x,D}return Object.defineProperty(T.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},T})(h),y=(function(M){v(T,M);function T(x){var D=M.call(this)||this;return D._nativeAudio=x,D}return Object.defineProperty(T.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},T})(h),g=(function(M){v(T,M);function T(x){var D=M.call(this)||this;return D._nativeFont=x,D}return Object.defineProperty(T.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},T})(h),w=(function(){function M(T,x){this._assetLoaderCallback=x,this.assetLoader=new T.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return M.prototype.loadContents=function(T,x){var D;return T.isImage?D=new I(T):T.isAudio?D=new O(T):T.isFont&&(D=new B(T)),this._assetLoaderCallback(D,x)},M})(),k=(function(){function M(T){this._nativeFileAsset=T}return M.prototype.decode=function(T){this._nativeFileAsset.decode(T)},Object.defineProperty(M.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),M})(),I=(function(M){v(T,M);function T(){return M!==null&&M.apply(this,arguments)||this}return T.prototype.setRenderImage=function(x){this._nativeFileAsset.setRenderImage(x.nativeImage)},T})(k),O=(function(M){v(T,M);function T(){return M!==null&&M.apply(this,arguments)||this}return T.prototype.setAudioSource=function(x){this._nativeFileAsset.setAudioSource(x.nativeAudio)},T})(k),B=(function(M){v(T,M);function T(){return M!==null&&M.apply(this,arguments)||this}return T.prototype.setFont=function(x){this._nativeFileAsset.setFont(x.nativeFont)},T})(k),P=(function(){function M(T){}return M.prototype.register=function(T){T.selfUnref=!0},M.prototype.unregister=function(T){},M})(),G=typeof FinalizationRegistry<"u"?FinalizationRegistry:P,Y=new G(function(M){M.unref()})})],n={};function i(o){var c=n[o];if(c!==void 0)return c.exports;var f=n[o]={exports:{}};return t[o](f,f.exports,i),f.exports}i.d=(o,c)=>{for(var f in c)i.o(c,f)&&!i.o(o,f)&&Object.defineProperty(o,f,{enumerable:!0,get:c[f]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{Alignment:()=>B,DataEnum:()=>we,EventType:()=>q,Fit:()=>O,Layout:()=>P,LoopType:()=>ie,Rive:()=>fe,RiveEventType:()=>T,RiveFile:()=>te,RuntimeLoader:()=>G,StateMachineInput:()=>M,StateMachineInputType:()=>Y,Testing:()=>ye,ViewModel:()=>ce,ViewModelInstance:()=>he,ViewModelInstanceArtboard:()=>le,ViewModelInstanceAssetImage:()=>X,ViewModelInstanceBoolean:()=>Se,ViewModelInstanceColor:()=>W,ViewModelInstanceEnum:()=>H,ViewModelInstanceList:()=>F,ViewModelInstanceNumber:()=>ge,ViewModelInstanceString:()=>Z,ViewModelInstanceTrigger:()=>ae,ViewModelInstanceValue:()=>ue,decodeAudio:()=>be,decodeFont:()=>Me,decodeImage:()=>ke});var o=i(1),c=i(2),f=i(3),v=i(5),h=(function(){var E=function(d,p){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,L){A.__proto__=L}||function(A,L){for(var ee in L)Object.prototype.hasOwnProperty.call(L,ee)&&(A[ee]=L[ee])},E(d,p)};return function(d,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");E(d,p);function A(){this.constructor=d}d.prototype=p===null?Object.create(p):(A.prototype=p.prototype,new A)}})(),m=function(){return m=Object.assign||function(E){for(var d,p=1,A=arguments.length;p<A;p++){d=arguments[p];for(var L in d)Object.prototype.hasOwnProperty.call(d,L)&&(E[L]=d[L])}return E},m.apply(this,arguments)},y=function(E,d,p,A){function L(ee){return ee instanceof p?ee:new p(function(pe){pe(ee)})}return new(p||(p=Promise))(function(ee,pe){function Ce(Le){try{Te(A.next(Le))}catch(Fe){pe(Fe)}}function Oe(Le){try{Te(A.throw(Le))}catch(Fe){pe(Fe)}}function Te(Le){Le.done?ee(Le.value):L(Le.value).then(Ce,Oe)}Te((A=A.apply(E,d||[])).next())})},g=function(E,d){var p={label:0,sent:function(){if(ee[0]&1)throw ee[1];return ee[1]},trys:[],ops:[]},A,L,ee,pe=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return pe.next=Ce(0),pe.throw=Ce(1),pe.return=Ce(2),typeof Symbol=="function"&&(pe[Symbol.iterator]=function(){return this}),pe;function Ce(Te){return function(Le){return Oe([Te,Le])}}function Oe(Te){if(A)throw new TypeError("Generator is already executing.");for(;pe&&(pe=0,Te[0]&&(p=0)),p;)try{if(A=1,L&&(ee=Te[0]&2?L.return:Te[0]?L.throw||((ee=L.return)&&ee.call(L),0):L.next)&&!(ee=ee.call(L,Te[1])).done)return ee;switch(L=0,ee&&(Te=[Te[0]&2,ee.value]),Te[0]){case 0:case 1:ee=Te;break;case 4:return p.label++,{value:Te[1],done:!1};case 5:p.label++,L=Te[1],Te=[0];continue;case 7:Te=p.ops.pop(),p.trys.pop();continue;default:if(ee=p.trys,!(ee=ee.length>0&&ee[ee.length-1])&&(Te[0]===6||Te[0]===2)){p=0;continue}if(Te[0]===3&&(!ee||Te[1]>ee[0]&&Te[1]<ee[3])){p.label=Te[1];break}if(Te[0]===6&&p.label<ee[1]){p.label=ee[1],ee=Te;break}if(ee&&p.label<ee[2]){p.label=ee[2],p.ops.push(Te);break}ee[2]&&p.ops.pop(),p.trys.pop();continue}Te=d.call(E,p)}catch(Le){Te=[6,Le],L=0}finally{A=ee=0}if(Te[0]&5)throw Te[1];return{value:Te[0]?Te[1]:void 0,done:!0}}},w=function(E,d,p){if(p||arguments.length===2)for(var A=0,L=d.length,ee;A<L;A++)(ee||!(A in d))&&(ee||(ee=Array.prototype.slice.call(d,0,A)),ee[A]=d[A]);return E.concat(ee||Array.prototype.slice.call(d))},k=(function(E){h(d,E);function d(){var p=E!==null&&E.apply(this,arguments)||this;return p.isHandledError=!0,p}return d})(Error),I=function(E){return E&&E.isHandledError?E.message:"Problem loading file; may be corrupt!"},O;(function(E){E.Cover="cover",E.Contain="contain",E.Fill="fill",E.FitWidth="fitWidth",E.FitHeight="fitHeight",E.None="none",E.ScaleDown="scaleDown",E.Layout="layout"})(O||(O={}));var B;(function(E){E.Center="center",E.TopLeft="topLeft",E.TopCenter="topCenter",E.TopRight="topRight",E.CenterLeft="centerLeft",E.CenterRight="centerRight",E.BottomLeft="bottomLeft",E.BottomCenter="bottomCenter",E.BottomRight="bottomRight"})(B||(B={}));var P=(function(){function E(d){var p,A,L,ee,pe,Ce,Oe;this.fit=(p=d?.fit)!==null&&p!==void 0?p:O.Contain,this.alignment=(A=d?.alignment)!==null&&A!==void 0?A:B.Center,this.layoutScaleFactor=(L=d?.layoutScaleFactor)!==null&&L!==void 0?L:1,this.minX=(ee=d?.minX)!==null&&ee!==void 0?ee:0,this.minY=(pe=d?.minY)!==null&&pe!==void 0?pe:0,this.maxX=(Ce=d?.maxX)!==null&&Ce!==void 0?Ce:0,this.maxY=(Oe=d?.maxY)!==null&&Oe!==void 0?Oe:0}return E.new=function(d){var p=d.fit,A=d.alignment,L=d.minX,ee=d.minY,pe=d.maxX,Ce=d.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new E({fit:p,alignment:A,minX:L,minY:ee,maxX:pe,maxY:Ce})},E.prototype.copyWith=function(d){var p=d.fit,A=d.alignment,L=d.layoutScaleFactor,ee=d.minX,pe=d.minY,Ce=d.maxX,Oe=d.maxY;return new E({fit:p??this.fit,alignment:A??this.alignment,layoutScaleFactor:L??this.layoutScaleFactor,minX:ee??this.minX,minY:pe??this.minY,maxX:Ce??this.maxX,maxY:Oe??this.maxY})},E.prototype.runtimeFit=function(d){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var p;return this.fit===O.Cover?p=d.Fit.cover:this.fit===O.Contain?p=d.Fit.contain:this.fit===O.Fill?p=d.Fit.fill:this.fit===O.FitWidth?p=d.Fit.fitWidth:this.fit===O.FitHeight?p=d.Fit.fitHeight:this.fit===O.ScaleDown?p=d.Fit.scaleDown:this.fit===O.Layout?p=d.Fit.layout:p=d.Fit.none,this.cachedRuntimeFit=p,p},E.prototype.runtimeAlignment=function(d){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var p;return this.alignment===B.TopLeft?p=d.Alignment.topLeft:this.alignment===B.TopCenter?p=d.Alignment.topCenter:this.alignment===B.TopRight?p=d.Alignment.topRight:this.alignment===B.CenterLeft?p=d.Alignment.centerLeft:this.alignment===B.CenterRight?p=d.Alignment.centerRight:this.alignment===B.BottomLeft?p=d.Alignment.bottomLeft:this.alignment===B.BottomCenter?p=d.Alignment.bottomCenter:this.alignment===B.BottomRight?p=d.Alignment.bottomRight:p=d.Alignment.center,this.cachedRuntimeAlignment=p,p},E})(),G=(function(){function E(){}return E.loadRuntime=function(){o.default({locateFile:function(){return E.wasmURL}}).then(function(d){var p;for(E.runtime=d;E.callBackQueue.length>0;)(p=E.callBackQueue.shift())===null||p===void 0||p(E.runtime)}).catch(function(d){var p={message:d?.message||"Unknown error",type:d?.name||"Error",wasmError:d instanceof WebAssembly.CompileError||d instanceof WebAssembly.RuntimeError,originalError:d};console.debug("Rive WASM load error details:",p);var A="https://cdn.jsdelivr.net/npm/".concat(c.name,"@").concat(c.version,"/rive_fallback.wasm");if(E.wasmURL.toLowerCase()!==A)console.warn("Failed to load WASM from ".concat(E.wasmURL," (").concat(p.message,"), trying jsdelivr as a backup")),E.setWasmUrl(A),E.loadRuntime();else{var L=["Could not load Rive WASM file from ".concat(E.wasmURL," or ").concat(A,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(p.type),"- Message: ".concat(p.message),"- WebAssembly-specific error: ".concat(p.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(L)}})},E.getInstance=function(d){E.isLoading||(E.isLoading=!0,E.loadRuntime()),E.runtime?d(E.runtime):E.callBackQueue.push(d)},E.awaitInstance=function(){return new Promise(function(d){return E.getInstance(function(p){return d(p)})})},E.setWasmUrl=function(d){E.wasmURL=d},E.getWasmUrl=function(){return E.wasmURL},E.isLoading=!1,E.callBackQueue=[],E.wasmURL="https://unpkg.com/".concat(c.name,"@").concat(c.version,"/rive.wasm"),E})(),Y;(function(E){E[E.Number=56]="Number",E[E.Trigger=58]="Trigger",E[E.Boolean=59]="Boolean"})(Y||(Y={}));var M=(function(){function E(d,p){this.type=d,this.runtimeInput=p}return Object.defineProperty(E.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(d){this.runtimeInput.value=d},enumerable:!1,configurable:!0}),E.prototype.fire=function(){this.type===Y.Trigger&&this.runtimeInput.fire()},E.prototype.delete=function(){this.runtimeInput=null},E})(),T;(function(E){E[E.General=128]="General",E[E.OpenUrl=131]="OpenUrl"})(T||(T={}));var x=(function(){function E(d){this.nativeArtboard=d}return E})(),D=(function(){function E(d,p,A,L){this.stateMachine=d,this.playing=A,this.artboard=L,this.inputs=[],this.instance=new p.StateMachineInstance(d,L),this.initInputs(p)}return Object.defineProperty(E.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"statesChanged",{get:function(){for(var d=[],p=0;p<this.instance.stateChangedCount();p++)d.push(this.instance.stateChangedNameByIndex(p));return d},enumerable:!1,configurable:!0}),E.prototype.advance=function(d){this.instance.advance(d)},E.prototype.advanceAndApply=function(d){this.instance.advanceAndApply(d)},E.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},E.prototype.reportedEventAt=function(d){return this.instance.reportedEventAt(d)},E.prototype.initInputs=function(d){for(var p=0;p<this.instance.inputCount();p++){var A=this.instance.input(p);this.inputs.push(this.mapRuntimeInput(A,d))}},E.prototype.mapRuntimeInput=function(d,p){if(d.type===p.SMIInput.bool)return new M(Y.Boolean,d.asBool());if(d.type===p.SMIInput.number)return new M(Y.Number,d.asNumber());if(d.type===p.SMIInput.trigger)return new M(Y.Trigger,d.asTrigger())},E.prototype.cleanup=function(){this.inputs.forEach(function(d){d.delete()}),this.inputs.length=0,this.instance.delete()},E.prototype.bindViewModelInstance=function(d){d.runtimeInstance!=null&&this.instance.bindViewModelInstance(d.runtimeInstance)},E})(),N=(function(){function E(d,p,A,L,ee){L===void 0&&(L=[]),ee===void 0&&(ee=[]),this.runtime=d,this.artboard=p,this.eventManager=A,this.animations=L,this.stateMachines=ee}return E.prototype.add=function(d,p,A){if(A===void 0&&(A=!0),d=Q(d),d.length===0)this.animations.forEach(function(Ue){return Ue.playing=p}),this.stateMachines.forEach(function(Ue){return Ue.playing=p});else for(var L=this.animations.map(function(Ue){return Ue.name}),ee=this.stateMachines.map(function(Ue){return Ue.name}),pe=0;pe<d.length;pe++){var Ce=L.indexOf(d[pe]),Oe=ee.indexOf(d[pe]);if(Ce>=0||Oe>=0)Ce>=0?this.animations[Ce].playing=p:this.stateMachines[Oe].playing=p;else{var Te=this.artboard.animationByName(d[pe]);if(Te){var Le=new f.Animation(Te,this.artboard,this.runtime,p);Le.advance(0),Le.apply(1),this.animations.push(Le)}else{var Fe=this.artboard.stateMachineByName(d[pe]);if(Fe){var He=new D(Fe,this.runtime,p,this.artboard);this.stateMachines.push(He)}}}}return A&&(p?this.eventManager.fire({type:q.Play,data:this.playing}):this.eventManager.fire({type:q.Pause,data:this.paused})),p?this.playing:this.paused},E.prototype.initLinearAnimations=function(d,p){for(var A=this.animations.map(function(Oe){return Oe.name}),L=0;L<d.length;L++){var ee=A.indexOf(d[L]);if(ee>=0)this.animations[ee].playing=p;else{var pe=this.artboard.animationByName(d[L]);if(pe){var Ce=new f.Animation(pe,this.artboard,this.runtime,p);Ce.advance(0),Ce.apply(1),this.animations.push(Ce)}else console.error("Animation with name ".concat(d[L]," not found."))}}},E.prototype.initStateMachines=function(d,p){for(var A=this.stateMachines.map(function(Oe){return Oe.name}),L=0;L<d.length;L++){var ee=A.indexOf(d[L]);if(ee>=0)this.stateMachines[ee].playing=p;else{var pe=this.artboard.stateMachineByName(d[L]);if(pe){var Ce=new D(pe,this.runtime,p,this.artboard);this.stateMachines.push(Ce),p||Ce.advanceAndApply(0)}else console.warn("State Machine with name ".concat(d[L]," not found.")),this.initLinearAnimations([d[L]],p)}}},E.prototype.play=function(d){return this.add(d,!0)},E.prototype.pause=function(d){return this.add(d,!1)},E.prototype.scrub=function(d,p){var A=this.animations.filter(function(L){return d.includes(L.name)});return A.forEach(function(L){return L.scrubTo=p}),A.map(function(L){return L.name})},Object.defineProperty(E.prototype,"playing",{get:function(){return this.animations.filter(function(d){return d.playing}).map(function(d){return d.name}).concat(this.stateMachines.filter(function(d){return d.playing}).map(function(d){return d.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"paused",{get:function(){return this.animations.filter(function(d){return!d.playing}).map(function(d){return d.name}).concat(this.stateMachines.filter(function(d){return!d.playing}).map(function(d){return d.name}))},enumerable:!1,configurable:!0}),E.prototype.stop=function(d){var p=this;d=Q(d);var A=[];if(d.length===0)A=this.animations.map(function(pe){return pe.name}).concat(this.stateMachines.map(function(pe){return pe.name})),this.animations.forEach(function(pe){return pe.cleanup()}),this.stateMachines.forEach(function(pe){return pe.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var L=this.animations.filter(function(pe){return d.includes(pe.name)});L.forEach(function(pe){pe.cleanup(),p.animations.splice(p.animations.indexOf(pe),1)});var ee=this.stateMachines.filter(function(pe){return d.includes(pe.name)});ee.forEach(function(pe){pe.cleanup(),p.stateMachines.splice(p.stateMachines.indexOf(pe),1)}),A=L.map(function(pe){return pe.name}).concat(ee.map(function(pe){return pe.name}))}return this.eventManager.fire({type:q.Stop,data:A}),A},Object.defineProperty(E.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(d,p){return d||p.playing},!1)||this.stateMachines.reduce(function(d,p){return d||p.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),E.prototype.atLeastOne=function(d,p){p===void 0&&(p=!0);var A;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([A=this.artboard.animationByIndex(0).name],d,p):this.artboard.stateMachineCount()>0&&this.add([A=this.artboard.stateMachineByIndex(0).name],d,p)),A},E.prototype.handleLooping=function(){for(var d=0,p=this.animations.filter(function(L){return L.playing});d<p.length;d++){var A=p[d];A.loopValue===0&&A.loopCount?(A.loopCount=0,this.stop(A.name)):A.loopValue===1&&A.loopCount?(this.eventManager.fire({type:q.Loop,data:{animation:A.name,type:ie.Loop}}),A.loopCount=0):A.loopValue===2&&A.loopCount>1&&(this.eventManager.fire({type:q.Loop,data:{animation:A.name,type:ie.PingPong}}),A.loopCount=0)}},E.prototype.handleStateChanges=function(){for(var d=[],p=0,A=this.stateMachines.filter(function(ee){return ee.playing});p<A.length;p++){var L=A[p];d.push.apply(d,L.statesChanged)}d.length>0&&this.eventManager.fire({type:q.StateChange,data:d})},E.prototype.handleAdvancing=function(d){this.eventManager.fire({type:q.Advance,data:d})},E})(),q;(function(E){E.Load="load",E.LoadError="loaderror",E.Play="play",E.Pause="pause",E.Stop="stop",E.Loop="loop",E.Draw="draw",E.Advance="advance",E.StateChange="statechange",E.RiveEvent="riveevent",E.AudioStatusChange="audiostatuschange"})(q||(q={}));var ie;(function(E){E.OneShot="oneshot",E.Loop="loop",E.PingPong="pingpong"})(ie||(ie={}));var K=(function(){function E(d){d===void 0&&(d=[]),this.listeners=d}return E.prototype.getListeners=function(d){return this.listeners.filter(function(p){return p.type===d})},E.prototype.add=function(d){this.listeners.includes(d)||this.listeners.push(d)},E.prototype.remove=function(d){for(var p=0;p<this.listeners.length;p++){var A=this.listeners[p];if(A.type===d.type&&A.callback===d.callback){this.listeners.splice(p,1);break}}},E.prototype.removeAll=function(d){var p=this;d?this.listeners.filter(function(A){return A.type===d}).forEach(function(A){return p.remove(A)}):this.listeners.splice(0,this.listeners.length)},E.prototype.fire=function(d){var p=this.getListeners(d.type);p.forEach(function(A){return A.callback(d)})},E})(),se=(function(){function E(d){this.eventManager=d,this.queue=[]}return E.prototype.add=function(d){this.queue.push(d)},E.prototype.process=function(){for(;this.queue.length>0;){var d=this.queue.shift();d?.action&&d.action(),d?.event&&this.eventManager.fire(d.event)}},E})(),me;(function(E){E[E.AVAILABLE=0]="AVAILABLE",E[E.UNAVAILABLE=1]="UNAVAILABLE"})(me||(me={}));var z=(function(E){h(d,E);function d(){var p=E!==null&&E.apply(this,arguments)||this;return p._started=!1,p._enabled=!1,p._status=me.UNAVAILABLE,p}return d.prototype.delay=function(p){return y(this,void 0,void 0,function(){return g(this,function(A){return[2,new Promise(function(L){return setTimeout(L,p)})]})})},d.prototype.timeout=function(){return y(this,void 0,void 0,function(){return g(this,function(p){return[2,new Promise(function(A,L){return setTimeout(L,50)})]})})},d.prototype.reportToListeners=function(){this.fire({type:q.AudioStatusChange}),this.removeAll()},d.prototype.enableAudio=function(){return y(this,void 0,void 0,function(){return g(this,function(p){return this._enabled||(this._enabled=!0,this._status=me.AVAILABLE,this.reportToListeners()),[2]})})},d.prototype.testAudio=function(){return y(this,void 0,void 0,function(){return g(this,function(p){switch(p.label){case 0:if(!(this._status===me.UNAVAILABLE&&this._audioContext!==null))return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return p.sent(),this.enableAudio(),[3,4];case 3:return p.sent(),[3,4];case 4:return[2]}})})},d.prototype._establishAudio=function(){return y(this,void 0,void 0,function(){return g(this,function(p){switch(p.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),p.label=2;case 2:return this._status!==me.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return p.sent(),[4,this.delay(1e3)];case 4:return p.sent(),[3,2];case 5:return[2]}})})},d.prototype.listenForUserAction=function(){var p=this,A=function(){return y(p,void 0,void 0,function(){return g(this,function(L){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",A,{once:!0})},d.prototype.establishAudio=function(){return y(this,void 0,void 0,function(){return g(this,function(p){return this._establishAudio(),[2]})})},Object.defineProperty(d.prototype,"systemVolume",{get:function(){return this._status===me.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),d})(K),V=new z,oe=(function(){function E(){}return E.prototype.observe=function(){},E.prototype.unobserve=function(){},E.prototype.disconnect=function(){},E})(),U=globalThis.ResizeObserver||oe,j=(function(){function E(){var d=this;this._elementsMap=new Map,this._onObservedEntry=function(p){var A=d._elementsMap.get(p.target);A!==null?A.onResize(p.target.clientWidth==0||p.target.clientHeight==0):d._resizeObserver.unobserve(p.target)},this._onObserved=function(p){p.forEach(d._onObservedEntry)},this._resizeObserver=new U(this._onObserved)}return E.prototype.add=function(d,p){var A={onResize:p,element:d};return this._elementsMap.set(d,A),this._resizeObserver.observe(d),A},E.prototype.remove=function(d){this._resizeObserver.unobserve(d.element),this._elementsMap.delete(d.element)},E})(),ne=new j,te=(function(){function E(d){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=d.src,this.buffer=d.buffer,d.assetLoader&&(this.assetLoader=d.assetLoader),this.enableRiveAssetCDN=typeof d.enableRiveAssetCDN=="boolean"?d.enableRiveAssetCDN:!0,this.eventManager=new K,d.onLoad&&this.on(q.Load,d.onLoad),d.onLoadError&&this.on(q.LoadError,d.onLoadError)}return E.prototype.initData=function(){return y(this,void 0,void 0,function(){var d,p,A,L,ee;return g(this,function(pe){switch(pe.label){case 0:return this.src?(d=this,[4,Ee(this.src)]):[3,2];case 1:d.buffer=pe.sent(),pe.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(A=new v.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),p=A.assetLoader),L=this,[4,this.runtime.load(new Uint8Array(this.buffer),p,this.enableRiveAssetCDN)]);case 3:return L.file=pe.sent(),this.destroyed?((ee=this.file)===null||ee===void 0||ee.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:q.Load,data:this}):this.fireLoadError(E.fileLoadErrorMessage),[2])}})})},E.prototype.init=function(){return y(this,void 0,void 0,function(){var d,p;return g(this,function(A){switch(A.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(E.missingErrorMessage),[2];A.label=1;case 1:return A.trys.push([1,4,,5]),d=this,[4,G.awaitInstance()];case 2:return d.runtime=A.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return A.sent(),[3,5];case 4:return p=A.sent(),this.fireLoadError(p instanceof Error?p.message:E.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},E.prototype.fireLoadError=function(d){throw this.eventManager.fire({type:q.LoadError,data:d}),new Error(d)},E.prototype.on=function(d,p){this.eventManager.add({type:d,callback:p})},E.prototype.off=function(d,p){this.eventManager.remove({type:d,callback:p})},E.prototype.cleanup=function(){var d;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(d=this.file)===null||d===void 0||d.delete(),this.file=null,this.destroyed=!0)},E.prototype.removeAllRiveEventListeners=function(d){this.eventManager.removeAll(d)},E.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},E.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},E.prototype.getArtboard=function(d){var p=this.file.artboardByName(d);return p!=null?new x(p):null},E.missingErrorMessage="Rive source file or data buffer required",E.fileLoadErrorMessage="The file failed to load",E})(),fe=(function(){function E(d){var p=this,A;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(L){var ee=p._hasZeroSize!==L;p._hasZeroSize=L,L?(!p._layout.maxX||!p._layout.maxY)&&p.resizeToCanvas():ee&&p.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=d.canvas,d.canvas.constructor===HTMLCanvasElement&&(this._observed=ne.add(this.canvas,this.onCanvasResize)),this.src=d.src,this.buffer=d.buffer,this.riveFile=d.riveFile,this.layout=(A=d.layout)!==null&&A!==void 0?A:new P,this.shouldDisableRiveListeners=!!d.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!d.isTouchScrollEnabled,this.automaticallyHandleEvents=!!d.automaticallyHandleEvents,this.enableRiveAssetCDN=d.enableRiveAssetCDN===void 0?!0:d.enableRiveAssetCDN,this.eventManager=new K,d.onLoad&&this.on(q.Load,d.onLoad),d.onLoadError&&this.on(q.LoadError,d.onLoadError),d.onPlay&&this.on(q.Play,d.onPlay),d.onPause&&this.on(q.Pause,d.onPause),d.onStop&&this.on(q.Stop,d.onStop),d.onLoop&&this.on(q.Loop,d.onLoop),d.onStateChange&&this.on(q.StateChange,d.onStateChange),d.onAdvance&&this.on(q.Advance,d.onAdvance),d.onload&&!d.onLoad&&this.on(q.Load,d.onload),d.onloaderror&&!d.onLoadError&&this.on(q.LoadError,d.onloaderror),d.onplay&&!d.onPlay&&this.on(q.Play,d.onplay),d.onpause&&!d.onPause&&this.on(q.Pause,d.onpause),d.onstop&&!d.onStop&&this.on(q.Stop,d.onstop),d.onloop&&!d.onLoop&&this.on(q.Loop,d.onloop),d.onstatechange&&!d.onStateChange&&this.on(q.StateChange,d.onstatechange),d.assetLoader&&(this.assetLoader=d.assetLoader),this.taskQueue=new se(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:d.autoplay,autoBind:d.autoBind,animations:d.animations,stateMachines:d.stateMachines,artboard:d.artboard,useOffscreenRenderer:d.useOffscreenRenderer})}return Object.defineProperty(E.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),E.new=function(d){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new E(d)},E.prototype.onSystemAudioChanged=function(){this.volume=this._volume},E.prototype.init=function(d){var p=this,A=d.src,L=d.buffer,ee=d.riveFile,pe=d.animations,Ce=d.stateMachines,Oe=d.artboard,Te=d.autoplay,Le=Te===void 0?!1:Te,Fe=d.useOffscreenRenderer,He=Fe===void 0?!1:Fe,Ue=d.autoBind,Xe=Ue===void 0?!1:Ue;if(!this.destroyed){if(this.src=A,this.buffer=L,this.riveFile=ee,!this.src&&!this.buffer&&!this.riveFile)throw new k(E.missingErrorMessage);var st=Q(pe),tt=Q(Ce);this.loaded=!1,this.readyForPlaying=!1,G.awaitInstance().then(function(We){p.destroyed||(p.runtime=We,p.removeRiveListeners(),p.deleteRiveRenderer(),p.renderer=p.runtime.makeRenderer(p.canvas,He),p.canvas.width||p.canvas.height||p.resizeDrawingSurfaceToCanvas(),p.initData(Oe,st,tt,Le,Xe).then(function(Pe){if(Pe)return p.setupRiveListeners()}).catch(function(Pe){console.error(Pe)}))}).catch(function(We){console.error(We)})}},E.prototype.setupRiveListeners=function(d){var p=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var A=(this.animator.stateMachines||[]).filter(function(ee){return ee.playing&&p.runtime.hasListeners(ee.instance)}).map(function(ee){return ee.instance}),L=this.isTouchScrollEnabled;d&&"isTouchScrollEnabled"in d&&(L=d.isTouchScrollEnabled),this.eventCleanup=(0,v.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:A,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:L,layoutScaleFactor:this._layout.layoutScaleFactor})}},E.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},E.prototype.initializeAudio=function(){var d=this,p;V.status==me.UNAVAILABLE&&!((p=this.artboard)===null||p===void 0)&&p.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:q.AudioStatusChange,callback:function(){return d.onSystemAudioChanged()}},V.add(this._audioEventListener),V.establishAudio())},E.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},E.prototype.initData=function(d,p,A,L,ee){return y(this,void 0,void 0,function(){var pe,Ce,Oe,Te;return g(this,function(Le){switch(Le.label){case 0:return Le.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(pe=new te({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=pe,[4,pe.init()]);case 1:if(Le.sent(),this.destroyed)return pe.destroyIfUnused(),[2,!1];Le.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(d,p,A,L,ee),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:q.Load,data:(Te=this.src)!==null&&Te!==void 0?Te:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Ce=Le.sent(),Oe=I(Ce),console.warn(Oe),this.eventManager.fire({type:q.LoadError,data:Oe}),[2,Promise.reject(Oe)];case 4:return[2]}})})},E.prototype.initArtboard=function(d,p,A,L,ee){if(this.file){var pe=d?this.file.artboardByName(d):this.file.defaultArtboard();if(!pe){var Ce="Invalid artboard name or no default artboard";console.warn(Ce),this.eventManager.fire({type:q.LoadError,data:Ce});return}if(this.artboard=pe,pe.volume=this._volume*V.systemVolume,this.artboard.animationCount()<1){var Ce="Artboard has no animations";throw this.eventManager.fire({type:q.LoadError,data:Ce}),Ce}this.animator=new N(this.runtime,this.artboard,this.eventManager);var Oe;if(p.length>0||A.length>0?(Oe=p.concat(A),this.animator.initLinearAnimations(p,L),this.animator.initStateMachines(A,L)):Oe=[this.animator.atLeastOne(L,!1)],this.taskQueue.add({event:{type:L?q.Play:q.Pause,data:Oe}}),ee){var Te=this.file.defaultArtboardViewModel(pe);if(Te!==null){var Le=Te.defaultInstance();if(Le!==null){var Fe=new he(Le,null);this.bindViewModelInstance(Fe)}}}}},E.prototype.drawFrame=function(){var d,p;!((d=document?.timeline)===null||d===void 0)&&d.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(p=this.runtime)===null||p===void 0||p.resolveAnimationFrame()):this.startRendering()},E.prototype.draw=function(d,p){var A;this.frameRequestId=null;var L=performance.now();this.lastRenderTime||(this.lastRenderTime=d),this.renderSecondTimer+=d-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,p?.());var ee=(d-this.lastRenderTime)/1e3;this.lastRenderTime=d;for(var pe=this.animator.animations.filter(function(St){return St.playing||St.needsScrub}).sort(function(St){return St.needsScrub?-1:1}),Ce=0,Oe=pe;Ce<Oe.length;Ce++){var Te=Oe[Ce];Te.advance(ee),Te.instance.didLoop&&(Te.loopCount+=1),Te.apply(1)}for(var Le=this.animator.stateMachines.filter(function(St){return St.playing}),Fe=0,He=Le;Fe<He.length;Fe++){var Ue=He[Fe],Xe=Ue.reportedEventCount();if(Xe)for(var st=0;st<Xe;st++){var tt=Ue.reportedEventAt(st);if(tt)if(tt.type===T.OpenUrl){if(this.eventManager.fire({type:q.RiveEvent,data:tt}),this.automaticallyHandleEvents){var We=document.createElement("a"),Pe=tt,Be=Pe.url,ze=Pe.target,ot=(0,v.sanitizeUrl)(Be);Be&&We.setAttribute("href",ot),ze&&We.setAttribute("target",ze),ot&&ot!==v.BLANK_URL&&We.click()}}else this.eventManager.fire({type:q.RiveEvent,data:tt})}Ue.advanceAndApply(ee)}this.animator.stateMachines.length==0&&this.artboard.advance(ee);var qe=this.renderer;qe.clear(),qe.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(qe),qe.restore(),qe.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(ee),this.frameCount++;var it=performance.now();for(this.frameTimes.push(it),this.durations.push(it-L);this.frameTimes[0]<=it-1e3;)this.frameTimes.shift(),this.durations.shift();(A=this._viewModelInstance)===null||A===void 0||A.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},E.prototype.alignRenderer=function(){var d=this,p=d.renderer,A=d.runtime,L=d._layout,ee=d.artboard;p.align(L.runtimeFit(A),L.runtimeAlignment(A),{minX:L.minX,minY:L.minY,maxX:L.maxX,maxY:L.maxY},ee.bounds,this._devicePixelRatioUsed*L.layoutScaleFactor)},Object.defineProperty(E.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(d,p){return d+p},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),E.prototype.cleanup=function(){var d,p;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ne.remove(this._observed),this.removeRiveListeners(),this.file&&((d=this.riveFile)===null||d===void 0||d.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(V.remove(this._audioEventListener),this._audioEventListener=null),(p=this._viewModelInstance)===null||p===void 0||p.cleanup(),this._viewModelInstance=null,this._dataEnums=null},E.prototype.deleteRiveRenderer=function(){var d;(d=this.renderer)===null||d===void 0||d.delete(),this.renderer=null},E.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},E.prototype.retrieveTextRun=function(d){var p;if(!d){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var A=this.artboard.textRun(d);if(!A){console.warn("Could not access a text run with name '".concat(d,"' in the '").concat((p=this.artboard)===null||p===void 0?void 0:p.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return A},E.prototype.getTextRunValue=function(d){var p=this.retrieveTextRun(d);return p?p.text:void 0},E.prototype.setTextRunValue=function(d,p){var A=this.retrieveTextRun(d);A&&(A.text=p)},E.prototype.play=function(d,p){var A=this;if(d=Q(d),!this.readyForPlaying){this.taskQueue.add({action:function(){return A.play(d,p)}});return}this.animator.play(d),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},E.prototype.pause=function(d){var p=this;if(d=Q(d),!this.readyForPlaying){this.taskQueue.add({action:function(){return p.pause(d)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(d)},E.prototype.scrub=function(d,p){var A=this;if(d=Q(d),!this.readyForPlaying){this.taskQueue.add({action:function(){return A.scrub(d,p)}});return}this.animator.scrub(d,p||0),this.drawFrame()},E.prototype.stop=function(d){var p=this;if(d=Q(d),!this.readyForPlaying){this.taskQueue.add({action:function(){return p.stop(d)}});return}this.animator&&this.animator.stop(d),this.eventCleanup&&this.eventCleanup()},E.prototype.reset=function(d){var p,A,L=d?.artboard,ee=Q(d?.animations),pe=Q(d?.stateMachines),Ce=(p=d?.autoplay)!==null&&p!==void 0?p:!1,Oe=(A=d?.autoBind)!==null&&A!==void 0?A:!1;this.cleanupInstances(),this.initArtboard(L,ee,pe,Ce,Oe),this.taskQueue.process()},E.prototype.load=function(d){this.file=null,this.stop(),this.init(d)},Object.defineProperty(E.prototype,"layout",{get:function(){return this._layout},set:function(d){this._layout=d,(!d.maxX||!d.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),E.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},E.prototype.resizeDrawingSurfaceToCanvas=function(d){if(this.canvas instanceof HTMLCanvasElement&&window){var p=this.canvas.getBoundingClientRect(),A=p.width,L=p.height,ee=d||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=ee,this.canvas.width=ee*A,this.canvas.height=ee*L,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===O.Layout){var pe=this._layout.layoutScaleFactor;this.artboard.width=A/pe,this.artboard.height=L/pe}}},Object.defineProperty(E.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var d=[],p=0;p<this.artboard.animationCount();p++)d.push(this.artboard.animationByIndex(p).name);return d},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var d=[],p=0;p<this.artboard.stateMachineCount();p++)d.push(this.artboard.stateMachineByIndex(p).name);return d},enumerable:!1,configurable:!0}),E.prototype.stateMachineInputs=function(d){if(this.loaded){var p=this.animator.stateMachines.find(function(A){return A.name===d});return p?.inputs}},E.prototype.retrieveInputAtPath=function(d,p){if(!d){console.warn("No input name provided for path '".concat(p,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(d,"', at path: '").concat(p,"', but the Artboard is null"));return}var A=this.artboard.inputByPath(d,p);if(!A){console.warn("Could not access an input with name: '".concat(d,"', at path:'").concat(p,"'"));return}return A},E.prototype.setBooleanStateAtPath=function(d,p,A){var L=this.retrieveInputAtPath(d,A);L&&(L.type===Y.Boolean?L.asBool().value=p:console.warn("Input with name: '".concat(d,"', at path:'").concat(A,"' is not a boolean")))},E.prototype.setNumberStateAtPath=function(d,p,A){var L=this.retrieveInputAtPath(d,A);L&&(L.type===Y.Number?L.asNumber().value=p:console.warn("Input with name: '".concat(d,"', at path:'").concat(A,"' is not a number")))},E.prototype.fireStateAtPath=function(d,p){var A=this.retrieveInputAtPath(d,p);A&&(A.type===Y.Trigger?A.asTrigger().fire():console.warn("Input with name: '".concat(d,"', at path:'").concat(p,"' is not a trigger")))},E.prototype.retrieveTextAtPath=function(d,p){if(!d){console.warn("No text name provided for path '".concat(p,"'"));return}if(!p){console.warn("No path provided for text '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(d,"', at path: '").concat(p,"', but the Artboard is null"));return}var A=this.artboard.textByPath(d,p);if(!A){console.warn("Could not access text with name: '".concat(d,"', at path:'").concat(p,"'"));return}return A},E.prototype.getTextRunValueAtPath=function(d,p){var A=this.retrieveTextAtPath(d,p);if(!A){console.warn("Could not get text with name: '".concat(d,"', at path:'").concat(p,"'"));return}return A.text},E.prototype.setTextRunValueAtPath=function(d,p,A){var L=this.retrieveTextAtPath(d,A);if(!L){console.warn("Could not set text with name: '".concat(d,"', at path:'").concat(A,"'"));return}L.text=p},Object.defineProperty(E.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(d){return d.playing}).map(function(d){return d.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(d){return d.playing}).map(function(d){return d.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(d){return!d.playing}).map(function(d){return d.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(d){return!d.playing}).map(function(d){return d.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),E.prototype.on=function(d,p){this.eventManager.add({type:d,callback:p})},E.prototype.off=function(d,p){this.eventManager.remove({type:d,callback:p})},E.prototype.unsubscribe=function(d,p){console.warn("This function is deprecated: please use `off()` instead."),this.off(d,p)},E.prototype.removeAllRiveEventListeners=function(d){this.eventManager.removeAll(d)},E.prototype.unsubscribeAll=function(d){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(d)},E.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},E.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},E.prototype.enableFPSCounter=function(d){this.runtime.enableFPSCounter(d)},E.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(E.prototype,"contents",{get:function(){if(this.loaded){for(var d={artboards:[]},p=0;p<this.file.artboardCount();p++){for(var A=this.file.artboardByIndex(p),L={name:A.name,animations:[],stateMachines:[]},ee=0;ee<A.animationCount();ee++){var pe=A.animationByIndex(ee);L.animations.push(pe.name)}for(var Ce=0;Ce<A.stateMachineCount();Ce++){for(var Oe=A.stateMachineByIndex(Ce),Te=Oe.name,Le=new this.runtime.StateMachineInstance(Oe,A),Fe=[],He=0;He<Le.inputCount();He++){var Ue=Le.input(He);Fe.push({name:Ue.name,type:Ue.type})}L.stateMachines.push({name:Te,inputs:Fe})}d.artboards.push(L)}return d}},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(d){this._volume=d,this.artboard&&(this.artboard.volume=d*V.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"artboardWidth",{get:function(){var d;return this.artboard?this.artboard.width:(d=this._artboardWidth)!==null&&d!==void 0?d:0},set:function(d){this._artboardWidth=d,this.artboard&&(this.artboard.width=d)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"artboardHeight",{get:function(){var d;return this.artboard?this.artboard.height:(d=this._artboardHeight)!==null&&d!==void 0?d:0},set:function(d){this._artboardHeight=d,this.artboard&&(this.artboard.height=d)},enumerable:!1,configurable:!0}),E.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(E.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(d){this._devicePixelRatioUsed=d},enumerable:!1,configurable:!0}),E.prototype.bindViewModelInstance=function(d){var p;this.artboard&&!this.destroyed&&d&&d.runtimeInstance&&(d.internalIncrementReferenceCount(),(p=this._viewModelInstance)===null||p===void 0||p.cleanup(),this._viewModelInstance=d,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(A){return A.bindViewModelInstance(d)}):this.artboard.bindViewModelInstance(d.runtimeInstance))},Object.defineProperty(E.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),E.prototype.viewModelByIndex=function(d){var p=this.file.viewModelByIndex(d);return p!==null?new ce(p):null},E.prototype.viewModelByName=function(d){var p=this.file.viewModelByName(d);return p!==null?new ce(p):null},E.prototype.enums=function(){if(this._dataEnums===null){var d=this.file.enums();this._dataEnums=d.map(function(p){return new we(p)})}return this._dataEnums},E.prototype.defaultViewModel=function(){if(this.artboard){var d=this.file.defaultArtboardViewModel(this.artboard);if(d)return new ce(d)}return null},E.prototype.getArtboard=function(d){var p,A;return(A=(p=this.riveFile)===null||p===void 0?void 0:p.getArtboard(d))!==null&&A!==void 0?A:null},E.missingErrorMessage="Rive source file or data buffer required",E.cleanupErrorMessage="Attempt to use file after calling cleanup.",E})(),ce=(function(){function E(d){this._viewModel=d}return Object.defineProperty(E.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),E.prototype.instanceByIndex=function(d){var p=this._viewModel.instanceByIndex(d);return p!==null?new he(p,null):null},E.prototype.instanceByName=function(d){var p=this._viewModel.instanceByName(d);return p!==null?new he(p,null):null},E.prototype.defaultInstance=function(){var d=this._viewModel.defaultInstance();return d!==null?new he(d,null):null},E.prototype.instance=function(){var d=this._viewModel.instance();return d!==null?new he(d,null):null},Object.defineProperty(E.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),E})(),we=(function(){function E(d){this._dataEnum=d}return Object.defineProperty(E.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),E})(),$e;(function(E){E.Number="number",E.String="string",E.Boolean="boolean",E.Color="color",E.Trigger="trigger",E.Enum="enum",E.List="list",E.Image="image",E.Artboard="artboard"})($e||($e={}));var he=(function(){function E(d,p){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=d,p!==null&&this._parents.push(p)}return Object.defineProperty(E.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),E.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(d){d.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(d){d.clearChanges()})),this._children.forEach(function(d){return d.handleCallbacks()})},E.prototype.addParent=function(d){this._parents.includes(d)||(this._parents.push(d),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&d.addToViewModelCallbacks(this))},E.prototype.removeParent=function(d){var p=this._parents.indexOf(d);if(p!==-1){var A=this._parents[p];A.removeFromViewModelCallbacks(this),this._parents.splice(p,1)}},E.prototype.addToPropertyCallbacks=function(d){var p=this;this._propertiesWithCallbacks.includes(d)||(this._propertiesWithCallbacks.push(d),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(A){A.addToViewModelCallbacks(p)}))},E.prototype.removeFromPropertyCallbacks=function(d){var p=this;this._propertiesWithCallbacks.includes(d)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(A){return A!==d}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(A){A.removeFromViewModelCallbacks(p)}))},E.prototype.addToViewModelCallbacks=function(d){var p=this;this._children.includes(d)||(this._children.push(d),this._parents.forEach(function(A){A.addToViewModelCallbacks(p)}))},E.prototype.removeFromViewModelCallbacks=function(d){var p=this;this._children.includes(d)&&(this._children=this._children.filter(function(A){return A!==d}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(A){A.removeFromViewModelCallbacks(p)}))},E.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(d){d.clearCallbacks()})},E.prototype.propertyFromPath=function(d,p){var A=d.split("/");return this.propertyFromPathSegments(A,0,p)},E.prototype.viewModelFromPathSegments=function(d,p){var A=this.internalViewModelInstance(d[p]);return A!==null?p==d.length-1?A:A.viewModelFromPathSegments(d,p++):null},E.prototype.propertyFromPathSegments=function(d,p,A){var L,ee,pe,Ce,Oe,Te,Le,Fe,He,Ue,Xe,st,tt,We,Pe,Be,ze,ot;if(p<d.length-1){var qe=this.internalViewModelInstance(d[p]);return qe!==null?qe.propertyFromPathSegments(d,p+1,A):null}var it=null;switch(A){case $e.Number:if(it=(ee=(L=this._runtimeInstance)===null||L===void 0?void 0:L.number(d[p]))!==null&&ee!==void 0?ee:null,it!==null)return new ge(it,this);break;case $e.String:if(it=(Ce=(pe=this._runtimeInstance)===null||pe===void 0?void 0:pe.string(d[p]))!==null&&Ce!==void 0?Ce:null,it!==null)return new Z(it,this);break;case $e.Boolean:if(it=(Te=(Oe=this._runtimeInstance)===null||Oe===void 0?void 0:Oe.boolean(d[p]))!==null&&Te!==void 0?Te:null,it!==null)return new Se(it,this);break;case $e.Color:if(it=(Fe=(Le=this._runtimeInstance)===null||Le===void 0?void 0:Le.color(d[p]))!==null&&Fe!==void 0?Fe:null,it!==null)return new W(it,this);break;case $e.Trigger:if(it=(Ue=(He=this._runtimeInstance)===null||He===void 0?void 0:He.trigger(d[p]))!==null&&Ue!==void 0?Ue:null,it!==null)return new ae(it,this);break;case $e.Enum:if(it=(st=(Xe=this._runtimeInstance)===null||Xe===void 0?void 0:Xe.enum(d[p]))!==null&&st!==void 0?st:null,it!==null)return new H(it,this);break;case $e.List:if(it=(We=(tt=this._runtimeInstance)===null||tt===void 0?void 0:tt.list(d[p]))!==null&&We!==void 0?We:null,it!==null)return new F(it,this);break;case $e.Image:if(it=(Be=(Pe=this._runtimeInstance)===null||Pe===void 0?void 0:Pe.image(d[p]))!==null&&Be!==void 0?Be:null,it!==null)return new X(it,this);break;case $e.Artboard:if(it=(ot=(ze=this._runtimeInstance)===null||ze===void 0?void 0:ze.artboard(d[p]))!==null&&ot!==void 0?ot:null,it!==null)return new le(it,this);break}return null},E.prototype.internalViewModelInstance=function(d){var p;if(this._viewModelInstances.has(d))return this._viewModelInstances.get(d);var A=(p=this._runtimeInstance)===null||p===void 0?void 0:p.viewModel(d);if(A!==null){var L=new E(A,this);return L.internalIncrementReferenceCount(),this._viewModelInstances.set(d,L),L}return null},E.prototype.number=function(d){var p=this.propertyFromPath(d,$e.Number);return p},E.prototype.string=function(d){var p=this.propertyFromPath(d,$e.String);return p},E.prototype.boolean=function(d){var p=this.propertyFromPath(d,$e.Boolean);return p},E.prototype.color=function(d){var p=this.propertyFromPath(d,$e.Color);return p},E.prototype.trigger=function(d){var p=this.propertyFromPath(d,$e.Trigger);return p},E.prototype.enum=function(d){var p=this.propertyFromPath(d,$e.Enum);return p},E.prototype.list=function(d){var p=this.propertyFromPath(d,$e.List);return p},E.prototype.image=function(d){var p=this.propertyFromPath(d,$e.Image);return p},E.prototype.artboard=function(d){var p=this.propertyFromPath(d,$e.Artboard);return p},E.prototype.viewModel=function(d){var p=d.split("/"),A=p.length>1?this.viewModelFromPathSegments(p.slice(0,p.length-1),0):this;return A!=null?A.internalViewModelInstance(p[p.length-1]):null},E.prototype.internalReplaceViewModel=function(d,p){var A;if(p.runtimeInstance!==null){var L=((A=this._runtimeInstance)===null||A===void 0?void 0:A.replaceViewModel(d,p.runtimeInstance))||!1;if(L){p.internalIncrementReferenceCount();var ee=this.internalViewModelInstance(d);ee!==null&&(ee.removeParent(this),this._children.includes(ee)&&(this._children=this._children.filter(function(pe){return pe!==ee})),ee.cleanup()),this._viewModelInstances.set(d,p),p.addParent(this)}return L}return!1},E.prototype.replaceViewModel=function(d,p){var A,L=d.split("/"),ee=L.length>1?this.viewModelFromPathSegments(L.slice(0,L.length-1),0):this;return(A=ee?.internalReplaceViewModel(L[L.length-1],p))!==null&&A!==void 0?A:!1},E.prototype.incrementReferenceCount=function(){var d;this._referenceCount++,(d=this._runtimeInstance)===null||d===void 0||d.incrementReferenceCount()},E.prototype.decrementReferenceCount=function(){var d;this._referenceCount--,(d=this._runtimeInstance)===null||d===void 0||d.decrementReferenceCount()},Object.defineProperty(E.prototype,"properties",{get:function(){var d;return((d=this._runtimeInstance)===null||d===void 0?void 0:d.getProperties().map(function(p){return m({},p)}))||[]},enumerable:!1,configurable:!0}),E.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},E.prototype.cleanup=function(){var d=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(L){L.cleanup()}),this._viewModelInstances.clear();var p=w([],this._children,!0);this._children.length=0;var A=w([],this._parents,!0);this._parents.length=0,p.forEach(function(L){L.removeParent(d)}),A.forEach(function(L){L.removeFromViewModelCallbacks(d)})}},E})(),ue=(function(){function E(d,p){this.callbacks=[],this._viewModelInstanceValue=d,this._parentViewModel=p}return E.prototype.on=function(d){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(d)||(this.callbacks.push(d),this._parentViewModel.addToPropertyCallbacks(this))},E.prototype.off=function(d){d?this.callbacks=this.callbacks.filter(function(p){return p!==d}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},E.prototype.internalHandleCallback=function(d){},E.prototype.handleCallbacks=function(){var d=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(p){d.internalHandleCallback(p)})},E.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},E.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(E.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),E})(),Z=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(p){this._viewModelInstanceValue.value=p},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p(this.value)},d})(ue),ge=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(p){this._viewModelInstanceValue.value=p},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p(this.value)},d})(ue),Se=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(p){this._viewModelInstanceValue.value=p},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p(this.value)},d})(ue),ae=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return d.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},d.prototype.internalHandleCallback=function(p){p()},d})(ue),H=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(p){this._viewModelInstanceValue.value=p},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(p){this._viewModelInstanceValue.valueIndex=p},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p(this.value)},d})(ue),F=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),d.prototype.addInstance=function(p){p.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(p.runtimeInstance),p.addParent(this._parentViewModel))},d.prototype.addInstanceAt=function(p,A){return p.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(p.runtimeInstance,A)?(p.addParent(this._parentViewModel),!0):!1},d.prototype.removeInstance=function(p){p.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(p.runtimeInstance),p.removeParent(this._parentViewModel))},d.prototype.removeInstanceAt=function(p){this._viewModelInstanceValue.removeInstanceAt(p)},d.prototype.instanceAt=function(p){var A=this._viewModelInstanceValue.instanceAt(p);if(A!=null){var L=new he(A,this._parentViewModel);return L}return null},d.prototype.swap=function(p,A){this._viewModelInstanceValue.swap(p,A)},d.prototype.internalHandleCallback=function(p){p()},d})(ue),W=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(p){this._viewModelInstanceValue.value=p},enumerable:!1,configurable:!0}),d.prototype.rgb=function(p,A,L){this._viewModelInstanceValue.rgb(p,A,L)},d.prototype.rgba=function(p,A,L,ee){this._viewModelInstanceValue.argb(ee,p,A,L)},d.prototype.argb=function(p,A,L,ee){this._viewModelInstanceValue.argb(p,A,L,ee)},d.prototype.alpha=function(p){this._viewModelInstanceValue.alpha(p)},d.prototype.opacity=function(p){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,p))*255))},d.prototype.internalHandleCallback=function(p){p(this.value)},d})(ue),X=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{set:function(p){var A;this._viewModelInstanceValue.value((A=p?.nativeImage)!==null&&A!==void 0?A:null)},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p()},d})(ue),le=(function(E){h(d,E);function d(p,A){return E.call(this,p,A)||this}return Object.defineProperty(d.prototype,"value",{set:function(p){var A;this._viewModelInstanceValue.value((A=p?.nativeArtboard)!==null&&A!==void 0?A:null)},enumerable:!1,configurable:!0}),d.prototype.internalHandleCallback=function(p){p()},d})(ue),Ee=function(E){return y(void 0,void 0,void 0,function(){var d,p,A;return g(this,function(L){switch(L.label){case 0:return d=new Request(E),[4,fetch(d)];case 1:return p=L.sent(),[4,p.arrayBuffer()];case 2:return A=L.sent(),[2,A]}})})},Q=function(E){return typeof E=="string"?[E]:E instanceof Array?E:[]},ye={EventManager:K,TaskQueueManager:se},be=function(E){return y(void 0,void 0,void 0,function(){var d,p,A;return g(this,function(L){switch(L.label){case 0:return d=new Promise(function(ee){return G.getInstance(function(pe){pe.decodeAudio(E,ee)})}),[4,d];case 1:return p=L.sent(),A=new v.AudioWrapper(p),v.finalizationRegistry.register(A,p),[2,A]}})})},ke=function(E){return y(void 0,void 0,void 0,function(){var d,p,A;return g(this,function(L){switch(L.label){case 0:return d=new Promise(function(ee){return G.getInstance(function(pe){pe.decodeImage(E,ee)})}),[4,d];case 1:return p=L.sent(),A=new v.ImageWrapper(p),v.finalizationRegistry.register(A,p),[2,A]}})})},Me=function(E){return y(void 0,void 0,void 0,function(){var d,p,A;return g(this,function(L){switch(L.label){case 0:return d=new Promise(function(ee){return G.getInstance(function(pe){pe.decodeFont(E,ee)})}),[4,d];case 1:return p=L.sent(),A=new v.FontWrapper(p),v.finalizationRegistry.register(A,p),[2,A]}})})}})(),s})())})(rive$1)),rive$1.exports}var riveExports=requireRive();const bucketName="dracula",supabaseUrlFile="https://vycjpmuyscfygstjjied.supabase.co";var root$b=from_html('<div class="rive-wrapper svelte-rwtail"><canvas width="250" height="500" class="svelte-rwtail"></canvas></div>');function Rive(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName),n=state(null);onMount(()=>{if(!get$2(n))return;const o=new riveExports.Rive({src:`${supabaseUrlFile}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:get$2(n),autoplay:!0,stateMachines:"SM1"});return()=>{o.cleanup()}});var i=root$b(),s=child(i);bind_this(s,o=>set(n,o),()=>get$2(n)),append(r,i),pop()}var root_3$c=from_html('<p class="game-name"> </p>'),root_2$9=from_html('<div class="loading svelte-qatvbo"><p> </p> <!></div>'),root$a=from_html('<div class="minigame-container svelte-qatvbo"><!></div>');function MinigameLauncher(r,e){push(e,!0);let t=prop(e,"bucketName",3,"dracula");const n=user_derived(()=>gameComponents[e.gameId]||null),i=user_derived(()=>getGameById(e.gameId));function s(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function o(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var c=root$a(),f=child(c);{var v=m=>{var y=comment(),g=first_child(y);component(g,()=>get$2(n),(w,k)=>{k(w,{onWin:s,onLose:o,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})}),append(m,y)},h=m=>{var y=root_2$9(),g=child(y),w=child(g),k=sibling(g,2);{var I=O=>{var B=root_3$c(),P=child(B);template_effect(()=>set_text(P,get$2(i).name)),append(O,B)};if_block(k,O=>{get$2(i)&&O(I)})}template_effect(()=>set_text(w,`  : ${e.gameId??""}`)),append(m,y)};if_block(f,m=>{get$2(n)?m(v):m(h,!1)})}append(r,c),pop()}var root_6$7=from_html('<img alt="BG" class="background-image svelte-c1xfn9"/>'),root_3$b=from_html('<div class="background-media svelte-c1xfn9"><!></div>'),root_10$2=from_html('<img alt="Char" class="character-image svelte-c1xfn9"/>'),root_7$6=from_html('<div class="character-media svelte-c1xfn9"><!></div>'),root_13=from_html("<button> </button>"),root_11$1=from_html('<div class="options-container svelte-c1xfn9"></div>'),root_14=from_html('<div class="swipe-hint svelte-c1xfn9"><span>   </span></div>'),root_1$9=from_html('<div><!> <!> <!> <div class="dialogue-content svelte-c1xfn9"><div class="dialogue-text svelte-c1xfn9"> </div> <!></div></div>'),root_15$1=from_html("<p> </p>");function DialogueCard(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName),n=prop(e,"isPreview",3,!1);const i=user_derived(()=>e.dialogue||gameState.findDialogue(gameState.currentDialogueId));let s=state(0),o=state(0),c=state(!1),f=state(!1);onMount(()=>{set(f,window.innerWidth<768),window.addEventListener("resize",()=>{set(f,window.innerWidth<768)})}),user_effect(()=>{get$2(i)?.onEnter&&gameState.runActions(get$2(i).onEnter)});function v(){get$2(i)?.nextDialogueId&&gameState.goToDialogue(get$2(i).nextDialogueId)}function h(T){if(get$2(f))return;const x=T.target;x.closest("button")||x.closest(".options-container")||v()}function m(T){get$2(f)&&(set(s,T.touches[0].clientX,!0),set(c,!0))}function y(T){!get$2(f)||!get$2(c)||set(o,T.touches[0].clientX,!0)}function g(){if(!get$2(f)||!get$2(c))return;set(c,!1),get$2(s)-get$2(o)>50&&get$2(i)?.nextDialogueId&&v(),set(s,0),set(o,0)}function w(T){if(T.actions&&gameState.runActions(T.actions),T.miniGame){userKeyStore.trackGameStart(T.miniGame.id,T.miniGame.id,gameState.selectedStory||void 0),gameState.activeMinigame={gameId:T.miniGame.id,onWinDialogueId:T.miniGame.onWinDialogueId,onLoseDialogueId:T.miniGame.onLoseDialogueId,rewardItem:T.miniGame.rewardItem};return}T.nextDialogueId&&gameState.goToDialogue(T.nextDialogueId)}function k(){gameState.activeMinigame&&userKeyStore.trackGameResult(gameState.activeMinigame.gameId,gameState.activeMinigame.gameId,!0,gameState.selectedStory||void 0),gameState.activeMinigame?.rewardItem&&gameState.addItem(gameState.activeMinigame.rewardItem),gameState.activeMinigame?.onWinDialogueId&&gameState.goToDialogue(gameState.activeMinigame.onWinDialogueId),gameState.activeMinigame=null}function I(){gameState.activeMinigame&&userKeyStore.trackGameResult(gameState.activeMinigame.gameId,gameState.activeMinigame.gameId,!1,gameState.selectedStory||void 0),gameState.activeMinigame?.onLoseDialogueId&&gameState.goToDialogue(gameState.activeMinigame.onLoseDialogueId),gameState.activeMinigame=null}function O(T){return T.visible===!1?!1:gameState.checkVisibilityCondition(T)}function B(T){return T.enabled!==!1}var P=comment(),G=first_child(P);{var Y=T=>{var x=root_1$9();let D;var N=child(x);{var q=te=>{{let fe=user_derived(()=>gameState.storyData?.items);MinigameLauncher(te,{get gameId(){return gameState.activeMinigame.gameId},onWin:k,onLose:I,get rewardItem(){return gameState.activeMinigame.rewardItem},get items(){return get$2(fe)},get bucketName(){return t()}})}};if_block(N,te=>{gameState.activeMinigame&&te(q)})}var ie=sibling(N,2);{var K=te=>{var fe=root_3$b(),ce=child(fe);{var we=ue=>{var Z=comment(),ge=first_child(Z);key(ge,()=>get$2(i).backgroundImage,Se=>{Rive(Se,{get fileName(){return get$2(i).backgroundImage},get bucketName(){return t()}})}),append(ue,Z)},$e=user_derived(()=>get$2(i).backgroundImage.endsWith(".riv")),he=ue=>{var Z=root_6$7();template_effect(()=>set_attribute(Z,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(i).backgroundImage}`)),append(ue,Z)};if_block(ce,ue=>{get$2($e)?ue(we):ue(he,!1)})}append(te,fe)};if_block(ie,te=>{get$2(i).backgroundImage&&te(K)})}var se=sibling(ie,2);{var me=te=>{var fe=root_7$6(),ce=child(fe);{var we=ue=>{var Z=comment(),ge=first_child(Z);key(ge,()=>get$2(i).characterImage,Se=>{Rive(Se,{get fileName(){return get$2(i).characterImage},get bucketName(){return t()}})}),append(ue,Z)},$e=user_derived(()=>get$2(i).characterImage.endsWith(".riv")),he=ue=>{var Z=root_10$2();template_effect(()=>set_attribute(Z,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(i).characterImage}`)),append(ue,Z)};if_block(ce,ue=>{get$2($e)?ue(we):ue(he,!1)})}append(te,fe)};if_block(se,te=>{get$2(i).characterImage&&te(me)})}var z=sibling(se,2),V=child(z),oe=child(V),U=sibling(V,2);{var j=te=>{var fe=root_11$1();each(fe,21,()=>get$2(i).options,ce=>ce.text,(ce,we)=>{var $e=comment(),he=first_child($e);{var ue=ge=>{var Se=root_13();let ae;var H=child(Se);template_effect((F,W)=>{ae=set_class(Se,1,"option-button svelte-c1xfn9",null,ae,F),Se.disabled=W,set_text(H,get$2(we).text)},[()=>({disabled:!B(get$2(we))}),()=>!B(get$2(we))]),delegated("click",Se,()=>w(get$2(we))),append(ge,Se)},Z=user_derived(()=>O(get$2(we)));if_block(he,ge=>{get$2(Z)&&ge(ue)})}append(ce,$e)}),append(te,fe)},ne=te=>{var fe=root_14();append(te,fe)};if_block(U,te=>{get$2(i).options&&get$2(i).options.length>0?te(j):get$2(i).nextDialogueId&&te(ne,1)})}template_effect(()=>{D=set_class(x,1,"dialogue-container svelte-c1xfn9",null,D,{"preview-mode":n()}),set_text(oe,get$2(i).text)}),delegated("click",x,h),delegated("touchstart",x,m),delegated("touchmove",x,y),delegated("touchend",x,g),append(T,x)},M=T=>{var x=root_15$1(),D=child(x);template_effect(()=>set_text(D,`   (ID: ${gameState.currentDialogueId??""})`)),append(T,x)};if_block(G,T=>{get$2(i)?T(Y):T(M,!1)})}append(r,P),pop()}delegate(["click","touchstart","touchmove","touchend"]);var $$_import_editor=reactive_import(()=>editor),root_2$8=from_html('<div class="info-row svelte-9vbxr2"><span class="info-label svelte-9vbxr2">:</span> <span class="info-value svelte-9vbxr2"> </span></div>'),root_3$a=from_html('<div class="info-row svelte-9vbxr2"><span class="info-label svelte-9vbxr2">:</span> <span class="info-value svelte-9vbxr2"> </span></div>'),root_4$a=from_html('<div class="preview-warning svelte-9vbxr2">   </div>'),root_5$9=from_html('<div class="preview-warning svelte-9vbxr2">     </div>'),root_1$8=from_html('<div class="preview-container svelte-9vbxr2"><!> <div class="preview-info svelte-9vbxr2"><div class="info-row svelte-9vbxr2"><span class="info-label svelte-9vbxr2">ID:</span> <span class="info-value svelte-9vbxr2"> </span></div> <div class="info-row svelte-9vbxr2"><span class="info-label svelte-9vbxr2">:</span> <span class="info-value svelte-9vbxr2"> </span></div> <!> <!></div> <!> <!></div>'),root_6$6=from_html('<div class="empty-preview svelte-9vbxr2"><div class="empty-icon svelte-9vbxr2"></div> <div class="empty-text svelte-9vbxr2">   </div></div>'),root$9=from_html('<aside class="preview-panel svelte-9vbxr2"><div class="preview-header svelte-9vbxr2"><h3 class="svelte-9vbxr2"></h3> <button class="btn-link small svelte-9vbxr2"> . </button></div> <div class="preview-wrapper svelte-9vbxr2"><!></div></aside>');function PreviewPanel(r,e){push(e,!1);function t(){$$_import_editor($$_import_editor().editingOptionIndex=null)}init();var n=root$9(),i=child(n),s=sibling(child(i),2),o=sibling(i,2),c=child(o);{var f=h=>{var m=root_1$8(),y=child(m);DialogueCard(y,{get dialogue(){return editorDerived.currentDialogue},index:0,get bucketName(){return $$_import_editor().selectedBucket},isPreview:!0});var g=sibling(y,2),w=child(g),k=sibling(child(w),2),I=child(k),O=sibling(w,2),B=sibling(child(O),2),P=child(B),G=sibling(O,2);{var Y=K=>{var se=root_2$8(),me=sibling(child(se),2),z=child(me);template_effect(()=>set_text(z,editorDerived.currentDialogue.backgroundImage)),append(K,se)};if_block(G,K=>{editorDerived.currentDialogue.backgroundImage&&K(Y)})}var M=sibling(G,2);{var T=K=>{var se=root_3$a(),me=sibling(child(se),2),z=child(me);template_effect(()=>set_text(z,editorDerived.currentDialogue.characterImage)),append(K,se)};if_block(M,K=>{editorDerived.currentDialogue.characterImage&&K(T)})}var x=sibling(g,2);{var D=K=>{var se=root_4$a();append(K,se)};if_block(x,K=>{(!editorDerived.currentDialogue.options||editorDerived.currentDialogue.options.length===0)&&K(D)})}var N=sibling(x,2);{var q=K=>{var se=root_5$9();append(K,se)},ie=user_derived(()=>editorDerived.currentDialogue.options?.some(K=>!K.nextDialogueId));if_block(N,K=>{get$2(ie)&&K(q)})}template_effect(()=>{set_text(I,editorDerived.currentDialogue.id),set_text(P,editorDerived.currentChapter?.title||" ")}),append(h,m)},v=h=>{var m=root_6$6();append(h,m)};if_block(c,h=>{editorDerived.currentDialogue?h(f):h(v,!1)})}delegated("click",s,t),append(r,n),pop()}delegate(["click"]);const AVAILABLE_STORIES=["dracula","zombie","fairy_tale","minigames"];function getStoriesList(){const r=AVAILABLE_STORIES.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return editorActions.updateBucketsList(r),r}var root_4$9=from_html('<div class="story-card author-card svelte-4uw89o"><div class="story-icon svelte-4uw89o"> </div> <div class="story-content svelte-4uw89o"><h4 class="svelte-4uw89o"> </h4> <span> </span></div> <div class="story-actions svelte-4uw89o"><button class="btn small svelte-4uw89o"></button> <button class="btn small svelte-4uw89o"> </button> <button class="btn small danger svelte-4uw89o"></button></div></div>'),root_3$9=from_html('<div class="stories-section svelte-4uw89o"><div class="stories-grid svelte-4uw89o"></div></div>'),root_5$8=from_html('<p class="empty-text svelte-4uw89o">    .  !</p>'),root_6$5=from_html("<p> ...</p>"),root_8$2=from_html('<span class="selected-badge svelte-4uw89o"></span>'),root_9$1=from_html('<button class="btn small svelte-4uw89o"></button>'),root_7$5=from_html('<div><div class="story-icon svelte-4uw89o"> </div> <div class="story-content svelte-4uw89o"><h4 class="svelte-4uw89o"> </h4> <p class="svelte-4uw89o"> </p></div> <div class="story-actions svelte-4uw89o"><!></div></div>'),root_1$7=from_html('<div class="selector-header svelte-4uw89o"><h2 class="svelte-4uw89o">  </h2> <button class="btn btn-primary svelte-4uw89o">+  </button></div> <!> <div class="stories-section svelte-4uw89o"><h3 class="svelte-4uw89o">  </h3> <div class="stories-grid svelte-4uw89o"></div></div>',1),root_10$1=from_html('<div class="access-denied svelte-4uw89o"><h2 class="svelte-4uw89o">  </h2> <p class="svelte-4uw89o">      .</p> <p class="svelte-4uw89o"> ,     .</p></div>'),root_11=from_html('<div class="modal-overlay svelte-4uw89o" role="dialog"><div class="modal svelte-4uw89o"><h3 class="svelte-4uw89o">  </h3> <div class="form-group svelte-4uw89o"><label for="story-title" class="svelte-4uw89o"> </label> <input type="text" id="story-title" placeholder=":   " class="input svelte-4uw89o"/></div> <div class="form-group svelte-4uw89o"><label for="story-bucket" class="svelte-4uw89o">Bucket  </label> <select id="story-bucket" class="input svelte-4uw89o"><option>stories ( )</option><option>dracula</option><option>zombie</option><option>fairy_tale</option><option>minigames</option></select> <small class="hint svelte-4uw89o"> bucket      </small></div> <div class="modal-actions svelte-4uw89o"><button class="btn svelte-4uw89o"></button> <button class="btn primary svelte-4uw89o"> </button></div></div></div>'),root$8=from_html('<div class="story-selector svelte-4uw89o"><!></div> <!>',1);function StorySelector$1(r,e){push(e,!0);let t=state(!1),n=state(""),i=state("stories"),s=state(!1);const o={dracula:{title:"",description:"    ",icon:""},zombie:{title:"",description:"   ",icon:""},fairy_tale:{title:"",description:"   ",icon:""},minigames:{title:"-",description:" -",icon:""}};onMount(async()=>{await loadStories(),getStoriesList()});async function c(P){editor.selectedBucket=P,editor.data={meta:{version:"3.1",title:" "},dialogues:[],chapters:[],items:[],miniGames:[]},await resourceActions.loadStoriesList(),await resourceActions.loadStoredResources()}async function f(P){editor.manualStorySelected=!0;const G=P.bucket||"stories";editor.selectedBucket=G,editor.currentFileName=P.json_url,await resourceActions.loadStoredResources(),await storyActions.loadStory(editor.currentFileName)}async function v(){if(!get$2(n).trim())return;set(s,!0);const P=await createStory(get$2(n).trim(),get$2(i));P.success&&P.story?(set(t,!1),set(n,""),set(i,"stories"),await f(P.story)):alert(P.error||"  "),set(s,!1)}async function h(P){await updateStory(P.id,{is_public:!P.is_public})}async function m(P){confirm(`  "${P.title}"?`)&&await deleteStory(P.id)}var y=root$8(),g=first_child(y),w=child(g);{var k=P=>{var G=root_1$7(),Y=first_child(G),M=sibling(child(Y),2),T=sibling(Y,2);{var x=ie=>{var K=comment(),se=first_child(K);{var me=oe=>{var U=root_3$9(),j=child(U);each(j,21,getAuthorStories,ne=>ne.id,(ne,te)=>{var fe=root_4$9(),ce=child(fe),we=child(ce),$e=sibling(ce,2),he=child($e),ue=child(he),Z=sibling(he,2);let ge;var Se=child(Z),ae=sibling($e,2),H=child(ae),F=sibling(H,2),W=child(F),X=sibling(F,2);template_effect(()=>{set_text(we,get$2(te).preview_image_url?"":""),set_text(ue,get$2(te).title),ge=set_class(Z,1,"story-status svelte-4uw89o",null,ge,{public:get$2(te).is_public}),set_text(Se,get$2(te).is_public?" ":" "),set_text(W,get$2(te).is_public?"":"")}),delegated("click",H,()=>f(get$2(te))),delegated("click",F,()=>h(get$2(te))),delegated("click",X,()=>m(get$2(te))),append(ne,fe)}),append(oe,U)},z=user_derived(()=>getAuthorStories().length>0),V=oe=>{var U=root_5$8();append(oe,U)};if_block(se,oe=>{get$2(z)?oe(me):oe(V,!1)})}append(ie,K)},D=ie=>{var K=root_6$5();append(ie,K)};if_block(T,ie=>{storiesState.initialized?ie(x):ie(D,!1)})}var N=sibling(T,2),q=sibling(child(N),2);each(q,21,()=>editor.availableBuckets,ie=>ie.name,(ie,K)=>{const se=user_derived(()=>o[get$2(K).id]||{title:get$2(K).name,description:"",icon:""});var me=root_7$5();let z;var V=child(me),oe=child(V),U=sibling(V,2),j=child(U),ne=child(j),te=sibling(j,2),fe=child(te),ce=sibling(U,2),we=child(ce);{var $e=ue=>{var Z=root_8$2();append(ue,Z)},he=ue=>{var Z=root_9$1();delegated("click",Z,()=>c(get$2(K).name)),append(ue,Z)};if_block(we,ue=>{editor.selectedBucket===get$2(K).name?ue($e):ue(he,!1)})}template_effect(()=>{z=set_class(me,1,"story-card svelte-4uw89o",null,z,{selected:editor.selectedBucket===get$2(K).name}),set_text(oe,get$2(se).icon),set_text(ne,get$2(se).title),set_text(fe,get$2(se).description)}),append(ie,me)}),delegated("click",M,()=>set(t,!0)),append(P,G)},I=P=>{var G=root_10$1();append(P,G)};if_block(w,P=>{authDerivedState.isAuthor||authDerivedState.isAdmin?P(k):P(I,!1)})}var O=sibling(g,2);{var B=P=>{var G=root_11(),Y=child(G),M=sibling(child(Y),2),T=sibling(child(M),2),x=sibling(M,2),D=sibling(child(x),2),N=child(D);N.value=N.__value="stories";var q=sibling(N);q.value=q.__value="dracula";var ie=sibling(q);ie.value=ie.__value="zombie";var K=sibling(ie);K.value=K.__value="fairy_tale";var se=sibling(K);se.value=se.__value="minigames";var me=sibling(x,2),z=child(me),V=sibling(z,2),oe=child(V);template_effect(U=>{V.disabled=U,set_text(oe,get$2(s)?"...":"")},[()=>get$2(s)||!get$2(n).trim()]),delegated("click",G,()=>set(t,!1)),delegated("click",Y,U=>U.stopPropagation()),bind_value(T,()=>get$2(n),U=>set(n,U)),bind_select_value(D,()=>get$2(i),U=>set(i,U)),delegated("click",z,()=>set(t,!1)),delegated("click",V,v),append(P,G)};if_block(O,P=>{get$2(t)&&P(B)})}append(r,y),pop()}delegate(["click"]);var root_3$8=from_html("<span> </span>"),root_4$8=from_html('<div class="debug-info svelte-o5tkq6"><small> </small></div>'),root_5$7=from_html('<div class="debug-info warning svelte-o5tkq6"><small>   </small></div>'),root_7$4=from_html('<div class="empty-state svelte-o5tkq6"> </div>'),root_2$7=from_html('<div class="editor-container svelte-o5tkq6"><header class="toolbar svelte-o5tkq6"><div class="logo svelte-o5tkq6"><h2 class="svelte-o5tkq6"> </h2></div> <div class="stories-control svelte-o5tkq6"><span class="story-file-name svelte-o5tkq6"> </span> <!> <button class="btn success small svelte-o5tkq6"> </button> <button class="btn small svelte-o5tkq6"> </button></div></header> <div class="main-workspace svelte-o5tkq6"><!> <main class="editor-area svelte-o5tkq6"><!> <!> <!></main> <!></div> <button class="btn-back-to-game svelte-o5tkq6" title="  ">  </button></div>');function Editor(r,e){push(e,!0);async function t(f){console.log(`[Editor]   bucket: ${f}`);try{const v=resourceActions.loadStoredResources(),h=new Promise((w,k)=>setTimeout(()=>k(new Error("Timeout loading resources")),15e3));await Promise.race([v,h]);const m=`${f}_story.json`;editor.currentFileName=m;const y=storyActions.loadStory(m),g=new Promise((w,k)=>setTimeout(()=>k(new Error("Timeout loading story")),15e3));await Promise.race([y,g]),console.log(`[Editor]  : ${m}`)}catch(v){console.error("[Editor]   :",v)}}onMount(async()=>{getStoriesList(),editor.availableBuckets.length>0&&!editor.selectedBucket&&(editor.selectedBucket=editor.availableBuckets[0].name,await t(editor.selectedBucket))}),user_effect(()=>{editor.selectedBucket&&!editor.manualStorySelected&&t(editor.selectedBucket)});function n(){editor.manualStorySelected=!1,editor.selectedBucket=null,editor.currentFileName="",editor.data=null}var i=comment(),s=first_child(i);{var o=f=>{StorySelector$1(f,{})},c=f=>{var v=root_2$7(),h=child(v),m=child(h),y=child(m),g=child(y),w=sibling(m,2),k=child(w),I=child(k),O=sibling(k,2);{var B=V=>{var oe=root_3$8(),U=child(oe);template_effect(()=>{set_class(oe,1,`status-message ${editor.statusMessage.type??""}`,"svelte-o5tkq6"),set_text(U,editor.statusMessage.text)}),append(V,oe)};if_block(O,V=>{editor.statusMessage.text&&V(B)})}var P=sibling(O,2),G=sibling(P,2),Y=sibling(h,2),M=child(Y);EditorSidebar(M,{});var T=sibling(M,2),x=child(T);{var D=V=>{var oe=root_4$8(),U=child(oe),j=child(U);template_effect(()=>set_text(j,`: ${editor.data.meta?.title??""} |
              : ${(editor.data.chapters?.length||0)??""} |
              : ${(editor.data.dialogues?.length||0)??""} |
              : ${(editor.data.items?.length||0)??""}`)),append(V,oe)},N=V=>{var oe=root_5$7();append(V,oe)};if_block(x,V=>{editor.data?V(D):V(N,!1)})}var q=sibling(x,2);ItemsManager(q,{});var ie=sibling(q,2);{var K=V=>{DialogueForm(V,{get editor(){return editor},get storyActions(){return storyActions},get resourceActions(){return resourceActions}})},se=V=>{var oe=root_7$4();append(V,oe)};if_block(ie,V=>{editorDerived.currentDialogue?V(K):V(se,!1)})}var me=sibling(T,2);PreviewPanel(me,{});var z=sibling(Y,2);template_effect(()=>{set_text(g,`Story Editor v3.1 - ${editor.selectedBucket??""}`),set_text(I,editor.currentFileName||" ")}),delegated("click",P,function(...V){storyActions.saveCurrentStory?.apply(this,V)}),delegated("click",G,function(...V){storyActions.saveStoryCopy?.apply(this,V)}),delegated("click",z,n),append(f,v)};if_block(s,f=>{editor.selectedBucket?f(c,!1):f(o)})}append(r,i),pop()}delegate(["click"]);function cubic_out(r){const e=r-1;return e*e*e+1}function split_css_unit(r){const e=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[r,"px"]}function fly(r,{delay:e=0,duration:t=400,easing:n=cubic_out,x:i=0,y:s=0,opacity:o=0}={}){const c=getComputedStyle(r),f=+c.opacity,v=c.transform==="none"?"":c.transform,h=f*(1-o),[m,y]=split_css_unit(i),[g,w]=split_css_unit(s);return{delay:e,duration:t,easing:n,css:(k,I)=>`
			transform: ${v} translate(${(1-k)*m}${y}, ${(1-k)*g}${w});
			opacity: ${f-h*I}`}}function cubicOut(r){const e=r-1;return e*e*e+1}var root_1$6=from_html('<div class="loading svelte-1fomxau"> ...</div>'),root_3$7=from_html('<div class="empty-state svelte-1fomxau"><p class="svelte-1fomxau">  </p> <p class="hint svelte-1fomxau">    !</p></div>'),root_6$4=from_html('<div class="story-loading svelte-1fomxau"><div class="spinner svelte-1fomxau"></div></div>'),root_7$3=from_html('<div class="story-icon svelte-1fomxau"> </div>'),root_5$6=from_html('<div role="button" tabindex="0"><!> <div class="story-content svelte-1fomxau"><h3 class="story-title svelte-1fomxau"> </h3> <p class="story-description svelte-1fomxau"> </p></div> <div class="story-arrow svelte-1fomxau"></div></div>'),root_4$7=from_html('<div class="stories-grid svelte-1fomxau"></div>'),root_2$6=from_html('<div class="selector-header svelte-1fomxau"><h1 class="svelte-1fomxau">  </h1> <p class="svelte-1fomxau">   </p></div> <button type="button" class="btn-all-games svelte-1fomxau"><span class="games-icon svelte-1fomxau"></span> <span class="games-text svelte-1fomxau"> -</span> <span class="games-arrow svelte-1fomxau"></span></button> <!> <div class="selector-footer svelte-1fomxau"><p class="hint svelte-1fomxau"> :       </p></div>',1),root$7=from_html('<div class="story-selector svelte-1fomxau"><!></div>');function StorySelector(r,e){push(e,!0);function t(){window.dispatchEvent(new CustomEvent("open-all-games"))}let n=state(!0),i=state(!1),s=state(null);onMount(async()=>{console.log("[StorySelector] ..."),await gameState.initStories(),console.log("[StorySelector]  :",{initialized:storiesState.initialized,count:storiesState.stories.length,available:getPlayerStories().length,urlStoryId:gameState.urlStoryId}),typeof window<"u"&&preloadAllStories(),gameState.urlStoryId&&gameState.selectedStoryData&&!get$2(i)&&(set(i,!0),await o(gameState.selectedStoryData)),set(n,!1)});async function o(g){set(s,g.id,!0);try{const w=await loadStoryJson(g);w?(gameState.storyData=w,gameState.currentDialogueId=w.dialogues?.[0]?.id||"0",gameState.isLoading=!1):console.error("[StorySelector]    ")}catch(w){console.error("[StorySelector]   :",w)}finally{set(s,null)}}const c={dracula:"",zombie:"",fairy_tale:"",minigames:""};function f(g){gameState.selectedStory=g.id,gameState.selectedStoryData=g,o(g)}var v=root$7(),h=child(v);{var m=g=>{var w=root_1$6();append(g,w)},y=g=>{var w=root_2$6(),k=sibling(first_child(w),2),I=sibling(k,2);{var O=P=>{var G=root_3$7();append(P,G)},B=P=>{var G=root_4$7();each(G,21,()=>gameState.availableStories,Y=>Y.id,(Y,M)=>{const T=user_derived(()=>c[get$2(M).title.toLowerCase()]||""),x=user_derived(()=>get$2(s)===get$2(M).id);var D=root_5$6();let N;var q=child(D);{var ie=U=>{var j=root_6$4();append(U,j)},K=U=>{var j=root_7$3(),ne=child(j);template_effect(()=>set_text(ne,get$2(T))),append(U,j)};if_block(q,U=>{get$2(x)?U(ie):U(K,!1)})}var se=sibling(q,2),me=child(se),z=child(me),V=sibling(me,2),oe=child(V);template_effect(()=>{N=set_class(D,1,"story-card svelte-1fomxau",null,N,{loading:get$2(x)}),set_text(z,get$2(M).title),set_text(oe,get$2(M).preview_image_url?"  ":" ")}),delegated("click",D,()=>f(get$2(M))),delegated("keydown",D,U=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),f(get$2(M)))}),append(Y,D)}),append(P,G)};if_block(I,P=>{gameState.availableStories.length===0?P(O):P(B,!1)})}delegated("click",k,t),append(g,w)};if_block(h,g=>{get$2(n)?g(m):g(y,!1)})}append(r,v),pop()}delegate(["click","keydown"]);var root_1$5=from_html('<span class="inventory-badge svelte-1n0ksgu"> </span>'),root_4$6=from_html('<button type="button" class="item-card svelte-1n0ksgu"><div class="item-icon svelte-1n0ksgu"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-1n0ksgu"><span class="item-name svelte-1n0ksgu"> </span> <span class="item-type svelte-1n0ksgu"> </span></div></button>'),root_3$6=from_html('<div class="items-grid svelte-1n0ksgu"></div>'),root_5$5=from_html('<div class="empty-inventory svelte-1n0ksgu"><span class="empty-icon svelte-1n0ksgu"></span> <p class="svelte-1n0ksgu"> </p> <p class="empty-hint svelte-1n0ksgu">    </p></div>'),root_2$5=from_html('<div class="inventory-overlay svelte-1n0ksgu" role="dialog" tabindex="-1"><div class="inventory-modal svelte-1n0ksgu" role="dialog" aria-label=" " tabindex="-1"><div class="inventory-header svelte-1n0ksgu"><h2 class="svelte-1n0ksgu"></h2> <button class="close-button svelte-1n0ksgu"></button></div> <div class="stats-section svelte-1n0ksgu"><h3 class="svelte-1n0ksgu"></h3> <div class="stats-grid svelte-1n0ksgu"><div class="stat-item svelte-1n0ksgu"><span class="stat-icon svelte-1n0ksgu"></span> <div class="stat-info svelte-1n0ksgu"><span class="stat-name svelte-1n0ksgu"></span> <span class="stat-value svelte-1n0ksgu"> </span></div></div> <div class="stat-item svelte-1n0ksgu"><span class="stat-icon svelte-1n0ksgu"></span> <div class="stat-info svelte-1n0ksgu"><span class="stat-name svelte-1n0ksgu"></span> <span class="stat-value svelte-1n0ksgu"> </span></div></div> <div class="stat-item svelte-1n0ksgu"><span class="stat-icon svelte-1n0ksgu"></span> <div class="stat-info svelte-1n0ksgu"><span class="stat-name svelte-1n0ksgu"></span> <span class="stat-value svelte-1n0ksgu"> </span></div></div></div></div> <div class="items-section svelte-1n0ksgu"><h3 class="svelte-1n0ksgu"> </h3> <!></div></div></div>'),root$6=from_html('<div class="inventory-wrapper svelte-1n0ksgu"><button class="inventory-button svelte-1n0ksgu"> <!></button> <!></div>');function Inventory(r,e){push(e,!0);let t=state(!1);const n=user_derived(()=>gameState.getInventoryItems()),i=user_derived(()=>gameState.player.stats);function s(){set(t,!get$2(t))}function o(g){console.log(" :",g.name)}var c=root$6(),f=child(c),v=sibling(child(f));{var h=g=>{var w=root_1$5(),k=child(w);template_effect(()=>set_text(k,get$2(n).length)),append(g,w)};if_block(v,g=>{get$2(n).length>0&&g(h)})}var m=sibling(f,2);{var y=g=>{var w=root_2$5(),k=child(w),I=child(k),O=sibling(child(I),2),B=sibling(I,2),P=sibling(child(B),2),G=child(P),Y=sibling(child(G),2),M=sibling(child(Y),2),T=child(M),x=sibling(G,2),D=sibling(child(x),2),N=sibling(child(D),2),q=child(N),ie=sibling(x,2),K=sibling(child(ie),2),se=sibling(child(K),2),me=child(se),z=sibling(B,2),V=child(z),oe=child(V),U=sibling(V,2);{var j=te=>{var fe=root_3$6();each(fe,21,()=>get$2(n),ce=>ce.id,(ce,we)=>{var $e=root_4$6(),he=child($e),ue=child(he),Z=sibling(he,2),ge=child(Z),Se=child(ge),ae=sibling(ge,2),H=child(ae);template_effect(()=>{set_attribute($e,"aria-label",`: ${get$2(we).name}`),set_attribute(ue,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${gameState.selectedStoryData?.bucket||"stories"}/${get$2(we).icon}`),set_attribute(ue,"alt",get$2(we).icon),set_text(Se,get$2(we).name),set_text(H,get$2(we).type)}),delegated("click",$e,()=>o(get$2(we))),append(ce,$e)}),append(te,fe)},ne=te=>{var fe=root_5$5();append(te,fe)};if_block(U,te=>{get$2(n).length>0?te(j):te(ne,!1)})}template_effect(()=>{set_text(T,get$2(i).knowledge),set_text(q,get$2(i).courage),set_text(me,get$2(i).charisma),set_text(oe,` (${get$2(n).length??""})`)}),delegated("click",w,s),delegated("keydown",w,te=>te.key==="Escape"&&s()),delegated("click",k,te=>te.stopPropagation()),delegated("keydown",k,te=>te.stopPropagation()),delegated("click",O,s),append(g,w)};if_block(m,g=>{get$2(t)&&g(y)})}template_effect(()=>set_attribute(f,"title",` (${get$2(n).length??""})`)),delegated("click",f,s),append(r,c),pop()}delegate(["click","keydown"]);var root_2$4=from_html('<div class="loading svelte-kmjb24"><p>  ...</p></div>'),root_3$5=from_html('<div class="error svelte-kmjb24"> <button class="btn-back svelte-kmjb24">   </button></div>'),root_6$3=from_html('<button class="btn-change-story svelte-kmjb24" title=" "></button>'),root_8$1=from_html('<div class="dialogue-wrapper svelte-kmjb24"><!></div>'),root_4$5=from_html('<div class="game-container svelte-kmjb24"><!> <!> <div class="dialogues-container svelte-kmjb24"><!></div></div>'),root$5=from_html('<div class="app svelte-kmjb24"><!></div>');function Main(r,e){push(e,!0);let t=state(!1);onMount(async()=>{await gameState.initStories(),set(t,!0)}),user_effect(async()=>{if(get$2(t)&&gameState.selectedStory&&gameState.selectedStoryData){const h=gameState.selectedStoryData;if(!h||!h.id){console.warn("[Main]     ");return}console.log("[Main]  :",h?.title||h.id),await userKeyStore.trackStoryStart(h.id,h.title||h.id);const m=await loadStoryJson(h);m?(gameState.storyData=m,gameState.currentDialogueId=m.dialogues?.[0]?.id||"0",gameState.isLoading=!1,console.log("[Main]  , :",m.dialogues?.length)):(gameState.error="   ",gameState.isLoading=!1)}});let n=null;user_effect(()=>{if(n&&!gameState.selectedStory&&gameState.storyData){const h=gameState.storyData.dialogues?.length||0;userKeyStore.trackStoryComplete(n,gameState.selectedStoryData?.title||n,h),n=null}else gameState.selectedStory&&(n=gameState.selectedStory)});var i=root$5(),s=child(i);{var o=h=>{StorySelector(h,{})},c=h=>{var m=root_2$4();append(h,m)},f=h=>{var m=root_3$5(),y=child(m),g=sibling(y);template_effect(()=>set_text(y,` ${gameState.error??""} `)),delegated("click",g,()=>gameState.selectedStory=null),append(h,m)},v=h=>{var m=root_4$5(),y=child(m);{var g=P=>{Inventory(P,{})};if_block(y,P=>{gameState.isMinigameActive||P(g)})}var w=sibling(y,2);{var k=P=>{var G=root_6$3();delegated("click",G,()=>{gameState.selectedStory=null,gameState.selectedStoryData=null,gameState.storyData=null}),append(P,G)};if_block(w,P=>{gameState.isMinigameActive||P(k)})}var I=sibling(w,2),O=child(I);{var B=P=>{var G=comment(),Y=first_child(G);key(Y,()=>gameState.currentDialogueId,M=>{var T=root_8$1(),x=child(T);{let D=user_derived(()=>gameState.selectedStoryData?.bucket||"stories");DialogueCard(x,{get bucketName(){return get$2(D)}})}transition(1,T,()=>fly,()=>({y:20,duration:500,easing:cubicOut})),append(M,T)}),append(P,G)};if_block(O,P=>{gameState.storyData&&P(B)})}append(h,m)};if_block(s,h=>{gameState.selectedStory?gameState.isLoading?h(c,1):gameState.error?h(f,2):h(v,!1):h(o)})}append(r,i),pop()}delegate(["click"]);var root_4$4=from_html('<div class="alert error svelte-o861tn"><strong></strong> </div>'),root_5$4=from_html('<div class="alert success svelte-o861tn"><strong></strong> </div>'),root_6$2=from_html('<div class="form-group svelte-o861tn"><label for="username" class="svelte-o861tn"> </label> <input type="text" id="username" placeholder=" " required="" class="svelte-o861tn"/></div>'),root_7$2=from_html('<span class="field-error svelte-o861tn"> </span>'),root_9=from_html('<span class="field-error svelte-o861tn"> </span>'),root_10=from_html('<small class="hint svelte-o861tn"> 6 </small>'),root_8=from_html('<div class="form-group svelte-o861tn"><label for="password" class="svelte-o861tn"></label> <input type="password" id="password" placeholder=" " required="" minlength="6"/> <!> <!></div>'),root_15=from_html('<button type="button" class="link-btn svelte-o861tn"> ?</button> <button type="button" class="link-btn svelte-o861tn"> ? </button>',1),root_16=from_html('<button type="button" class="link-btn svelte-o861tn">  ? </button>'),root_17=from_html('<button type="button" class="link-btn svelte-o861tn"> ? </button>'),root_18=from_html('<div class="debug-info svelte-o861tn"><details><summary class="svelte-o861tn"> </summary> <p> </p> <p> </p> <p>: :</p> <ul class="svelte-o861tn"><li>   email  Supabase Dashboard</li> <li>   " ?"</li> <li>   (F12)</li></ul></details></div>'),root$4=from_html('<div class="auth-modal-overlay svelte-o861tn" role="dialog" aria-modal="true" tabindex="-1"><div class="auth-modal svelte-o861tn" role="document"><button class="close-btn svelte-o861tn" aria-label=""></button> <h2 class="svelte-o861tn"><!></h2> <!> <!> <form><!> <div class="form-group svelte-o861tn"><label for="email" class="svelte-o861tn">Email</label> <input type="email" id="email" placeholder="your@email.com" required=""/> <!></div> <!> <button type="submit" class="btn-primary svelte-o861tn"><!></button></form> <div class="auth-links svelte-o861tn"><!></div> <!></div></div>');function AuthModal(r,e){push(e,!0);let t=prop(e,"initialMode",3,"login"),n=state(proxy(t())),i=state(""),s=state(""),o=state(""),c=state(""),f=state(""),v=state(!1),h=state(""),m=state("");function y(Q){set(n,Q,!0),set(c,""),set(f,""),set(h,""),set(m,"")}function g(Q){const be=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Q);return set(h,be?"":"  email",!0),be}function w(Q){const ye=Q.length>=6;return set(m,ye?"":"     6 ",!0),ye}async function k(){if(!(!g(get$2(i))||!w(get$2(s)))){set(c,""),set(f,""),set(v,!0);try{const Q=await signIn(get$2(i),get$2(s));Q.success?e.onClose?.():(set(c,Q.error||" ",!0),get$2(c).includes("")&&setTimeout(()=>{confirm("    ?")&&I()},100))}finally{set(v,!1)}}}async function I(){set(v,!0);try{const{error:Q}=await supabase.auth.resend({type:"signup",email:get$2(i)});Q?set(c,"  : "+Q.message):set(f,"    !")}catch(Q){set(c,Q.message,!0)}finally{set(v,!1)}}async function O(){if(!(!g(get$2(i))||!w(get$2(s)))){if(!get$2(o).trim()){set(c,"  ");return}set(c,""),set(f,""),set(v,!0);try{const Q=await signUp(get$2(i),get$2(s),get$2(o));Q.success?Q.needsEmailConfirmation?set(f,"   !     email."):(set(f," !"),setTimeout(()=>e.onClose?.(),2e3)):set(c,Q.error||" ",!0)}finally{set(v,!1)}}}async function B(){if(g(get$2(i))){set(c,""),set(f,""),set(v,!0);try{const Q=await resetPassword(get$2(i));Q.success?set(f,"       !"):set(c,Q.error||"  ",!0)}finally{set(v,!1)}}}async function P(){get$2(n)==="login"?await k():get$2(n)==="register"?await O():get$2(n)==="reset"&&await B()}var G=root$4(),Y=child(G),M=child(Y),T=sibling(M,2),x=child(T);{var D=Q=>{var ye=text("");append(Q,ye)},N=Q=>{var ye=text("");append(Q,ye)},q=Q=>{var ye=text(" ");append(Q,ye)};if_block(x,Q=>{get$2(n)==="login"?Q(D):get$2(n)==="register"?Q(N,1):Q(q,!1)})}var ie=sibling(T,2);{var K=Q=>{var ye=root_4$4(),be=sibling(child(ye));template_effect(()=>set_text(be,` ${get$2(c)??""}`)),append(Q,ye)};if_block(ie,Q=>{get$2(c)&&Q(K)})}var se=sibling(ie,2);{var me=Q=>{var ye=root_5$4(),be=sibling(child(ye));template_effect(()=>set_text(be,` ${get$2(f)??""}`)),append(Q,ye)};if_block(se,Q=>{get$2(f)&&Q(me)})}var z=sibling(se,2),V=child(z);{var oe=Q=>{var ye=root_6$2(),be=sibling(child(ye),2);template_effect(()=>be.disabled=get$2(v)),bind_value(be,()=>get$2(o),ke=>set(o,ke)),append(Q,ye)};if_block(V,Q=>{get$2(n)==="register"&&Q(oe)})}var U=sibling(V,2),j=sibling(child(U),2);let ne;var te=sibling(j,2);{var fe=Q=>{var ye=root_7$2(),be=child(ye);template_effect(()=>set_text(be,get$2(h))),append(Q,ye)};if_block(te,Q=>{get$2(h)&&Q(fe)})}var ce=sibling(U,2);{var we=Q=>{var ye=root_8(),be=sibling(child(ye),2);let ke;var Me=sibling(be,2);{var E=A=>{var L=root_9(),ee=child(L);template_effect(()=>set_text(ee,get$2(m))),append(A,L)};if_block(Me,A=>{get$2(m)&&A(E)})}var d=sibling(Me,2);{var p=A=>{var L=root_10();append(A,L)};if_block(d,A=>{get$2(n)==="register"&&A(p)})}template_effect(()=>{be.disabled=get$2(v),ke=set_class(be,1,"svelte-o861tn",null,ke,{error:get$2(m)})}),delegated("input",be,()=>w(get$2(s))),bind_value(be,()=>get$2(s),A=>set(s,A)),append(Q,ye)};if_block(ce,Q=>{get$2(n)!=="reset"&&Q(we)})}var $e=sibling(ce,2),he=child($e);{var ue=Q=>{var ye=text("...");append(Q,ye)},Z=Q=>{var ye=text("");append(Q,ye)},ge=Q=>{var ye=text("");append(Q,ye)},Se=Q=>{var ye=text("");append(Q,ye)};if_block(he,Q=>{get$2(v)?Q(ue):get$2(n)==="login"?Q(Z,1):get$2(n)==="register"?Q(ge,2):Q(Se,!1)})}var ae=sibling(z,2),H=child(ae);{var F=Q=>{var ye=root_15(),be=first_child(ye),ke=sibling(be,2);template_effect(()=>{be.disabled=get$2(v),ke.disabled=get$2(v)}),delegated("click",be,()=>y("reset")),delegated("click",ke,()=>y("register")),append(Q,ye)},W=Q=>{var ye=root_16();template_effect(()=>ye.disabled=get$2(v)),delegated("click",ye,()=>y("login")),append(Q,ye)},X=Q=>{var ye=root_17();template_effect(()=>ye.disabled=get$2(v)),delegated("click",ye,()=>y("login")),append(Q,ye)};if_block(H,Q=>{get$2(n)==="login"?Q(F):get$2(n)==="register"?Q(W,1):Q(X,!1)})}var le=sibling(ae,2);{var Ee=Q=>{var ye=root_18(),be=child(ye),ke=sibling(child(be),2),Me=child(ke),E=sibling(ke,2),d=child(E);template_effect(()=>{set_text(Me,`Email: ${get$2(i)??""}`),set_text(d,` : ${get$2(s).length??""}`)}),append(Q,ye)};if_block(le,Q=>{get$2(n)==="login"&&get$2(c)&&Q(Ee)})}template_effect(()=>{j.disabled=get$2(v),ne=set_class(j,1,"svelte-o861tn",null,ne,{error:get$2(h)}),$e.disabled=get$2(v)||get$2(n)==="login"&&(!get$2(i)||!get$2(s))||get$2(n)==="register"&&(!get$2(i)||!get$2(s)||!get$2(o))||get$2(n)==="reset"&&!get$2(i)}),delegated("click",G,function(...Q){e.onClose?.apply(this,Q)}),delegated("keydown",G,Q=>Q.key==="Escape"&&e.onClose?.()),delegated("click",Y,Q=>Q.stopPropagation()),delegated("keydown",Y,Q=>Q.stopPropagation()),delegated("click",M,function(...Q){e.onClose?.apply(this,Q)}),event("submit",z,Q=>{Q.preventDefault(),P()}),delegated("input",j,()=>g(get$2(i))),bind_value(j,()=>get$2(i),Q=>set(i,Q)),append(r,G),pop()}delegate(["click","keydown","input"]);var root_1$4=from_html('<div class="loading svelte-v05hqo">...</div>'),root_2$3=from_html('<div class="empty-state svelte-v05hqo"><span class="empty-icon svelte-v05hqo"></span> <p class="svelte-v05hqo">    </p> <p class="hint svelte-v05hqo">  -,    !</p></div>'),root_4$3=from_html('<button class="trophy-card svelte-v05hqo"><div class="trophy-icon svelte-v05hqo"> </div> <div class="trophy-info svelte-v05hqo"><h3 class="svelte-v05hqo"> </h3> <div class="trophy-stats svelte-v05hqo"><span class="stat wins svelte-v05hqo"> </span></div></div> <div class="trophy-rate svelte-v05hqo"><span class="rate-value svelte-v05hqo"> </span> <span class="rate-label svelte-v05hqo"></span></div></button>'),root_3$4=from_html('<div class="trophies-list svelte-v05hqo"></div> <div class="trophies-summary svelte-v05hqo"><div class="summary-item svelte-v05hqo"><span class="summary-value svelte-v05hqo"> </span> <span class="summary-label svelte-v05hqo"> </span></div> <div class="summary-item svelte-v05hqo"><span class="summary-value svelte-v05hqo"> </span> <span class="summary-label svelte-v05hqo"> </span></div></div>',1),root$3=from_html('<div class="modal-overlay svelte-v05hqo"><div class="trophies-modal svelte-v05hqo"><div class="trophies-header svelte-v05hqo"><button class="btn-close svelte-v05hqo" aria-label=""></button> <h1 class="svelte-v05hqo"> </h1> <p class="subtitle svelte-v05hqo">   -</p></div> <!></div></div>');function Trophies(r,e){push(e,!0);let t=state(!0),n=state(proxy([]));onMount(async()=>{set(n,await userKeyStore.getGameStats(),!0),set(t,!1)});function i(I){return getGameById(I)?.icon||""}function s(I,O){return getGameById(I)?.name||O}function o(I){window.dispatchEvent(new CustomEvent("open-minigame",{detail:{gameId:I}}))}function c(I){I.target===I.currentTarget&&e.onClose()}var f=root$3(),v=child(f),h=child(v),m=child(h),y=sibling(h,2);{var g=I=>{var O=root_1$4();append(I,O)},w=I=>{var O=root_2$3();append(I,O)},k=I=>{var O=root_3$4(),B=first_child(O);each(B,21,()=>get$2(n),N=>N.gameId,(N,q)=>{var ie=root_4$3(),K=child(ie),se=child(K),me=sibling(K,2),z=child(me),V=child(z),oe=sibling(z,2),U=child(oe),j=child(U),ne=sibling(me,2),te=child(ne),fe=child(te);template_effect((ce,we)=>{set_text(se,ce),set_text(V,we),set_text(j,` ${get$2(q).wins??""} `),set_text(fe,`${get$2(q).winRate??""}%`)},[()=>i(get$2(q).gameId),()=>s(get$2(q).gameId,get$2(q).gameTitle)]),delegated("click",ie,()=>o(get$2(q).gameId)),append(N,ie)});var P=sibling(B,2),G=child(P),Y=child(G),M=child(Y),T=sibling(G,2),x=child(T),D=child(x);template_effect(N=>{set_text(M,N),set_text(D,get$2(n).length)},[()=>get$2(n).reduce((N,q)=>N+q.wins,0)]),append(I,O)};if_block(y,I=>{get$2(t)?I(g):get$2(n).length===0?I(w,1):I(k,!1)})}delegated("click",f,c),delegated("click",m,function(...I){e.onClose?.apply(this,I)}),append(r,f),pop()}delegate(["click"]);var root_1$3=from_html('<button class="editor-btn desktop-only svelte-1xgz5ag" title=" "></button>'),root_4$2=from_html('<span class="author-badge svelte-1xgz5ag"></span>'),root_5$3=from_html('<button class="editor-btn-dropdown svelte-1xgz5ag"> </button>'),root_3$3=from_html('<div class="user-dropdown svelte-1xgz5ag"><div class="user-email svelte-1xgz5ag"> </div> <!> <button class="trophies-btn svelte-1xgz5ag"> </button> <!> <button class="signout-btn svelte-1xgz5ag"></button></div>'),root_2$2=from_html('<button class="user-btn svelte-1xgz5ag"></button> <!>',1),root_7$1=from_html('<div class="user-dropdown svelte-1xgz5ag"><div class="guest-label svelte-1xgz5ag"></div> <button class="trophies-btn svelte-1xgz5ag">  </button> <button class="login-btn-dropdown svelte-1xgz5ag"> </button></div>'),root_6$1=from_html('<button class="user-btn login-btn svelte-1xgz5ag" title=""></button> <!>',1),root$2=from_html('<!> <div class="user-menu svelte-1xgz5ag"><!> <!> <!></div>',1);function UserMenu(r,e){push(e,!0);let t=state(!1),n=state(!1),i=state(!1),s=state(!0),o=state(!1);function c(){set(n,!1),set(i,!0)}function f(){set(n,!1),set(t,!0)}function v(){if(!get$2(s)){alert("   ");return}set(n,!1),editorActions.toggleEditor()}user_effect(()=>{set(s,navigator.onLine,!0),set(o,window.innerWidth>=769);const Y=()=>{set(s,!0)},M=()=>{set(s,!1)},T=()=>{set(o,window.innerWidth>=769)};return window.addEventListener("online",Y),window.addEventListener("offline",M),window.addEventListener("resize",T),()=>{window.removeEventListener("online",Y),window.removeEventListener("offline",M),window.removeEventListener("resize",T)}});var h=root$2(),m=first_child(h);{var y=Y=>{var M=root_1$3();delegated("click",M,v),append(Y,M)};if_block(m,Y=>{authDerivedState.isAuthenticated&&(authDerivedState.isAuthor||authDerivedState.isAdmin)&&get$2(s)&&get$2(o)&&Y(y)})}var g=sibling(m,2),w=child(g);{var k=Y=>{var M=root_2$2(),T=first_child(M),x=sibling(T,2);{var D=N=>{var q=root_3$3(),ie=child(q),K=child(ie),se=sibling(ie,2);{var me=j=>{var ne=root_4$2();append(j,ne)};if_block(se,j=>{authDerivedState.isAuthor&&j(me)})}var z=sibling(se,2),V=sibling(z,2);{var oe=j=>{var ne=root_5$3();delegated("click",ne,v),append(j,ne)};if_block(V,j=>{(authDerivedState.isAuthor||authDerivedState.isAdmin)&&get$2(s)&&get$2(o)&&j(oe)})}var U=sibling(V,2);template_effect(()=>set_text(K,authState.user?.email)),delegated("click",z,c),delegated("click",U,function(...j){signOut?.apply(this,j)}),append(N,q)};if_block(x,N=>{get$2(n)&&N(D)})}template_effect(()=>set_attribute(T,"title",authState.user?.email||"")),delegated("click",T,()=>set(n,!get$2(n))),append(Y,M)},I=Y=>{var M=root_6$1(),T=first_child(M),x=sibling(T,2);{var D=N=>{var q=root_7$1(),ie=sibling(child(q),2),K=sibling(ie,2);delegated("click",ie,c),delegated("click",K,f),append(N,q)};if_block(x,N=>{get$2(n)&&N(D)})}delegated("click",T,()=>set(n,!get$2(n))),append(Y,M)};if_block(w,Y=>{authDerivedState.isAuthenticated?Y(k):Y(I,!1)})}var O=sibling(w,2);{var B=Y=>{AuthModal(Y,{onClose:()=>set(t,!1)})};if_block(O,Y=>{get$2(t)&&Y(B)})}var P=sibling(O,2);{var G=Y=>{Trophies(Y,{onClose:()=>set(i,!1)})};if_block(P,Y=>{get$2(i)&&Y(G)})}append(r,h),pop()}delegate(["click"]);var root_1$2=from_html('<div class="success-message svelte-b6vc4l"><span class="icon svelte-b6vc4l"></span> <p class="svelte-b6vc4l"> </p> <p class="redirect svelte-b6vc4l">...</p></div>'),root_2$1=from_html('<div class="error-message svelte-b6vc4l"><span class="icon svelte-b6vc4l"></span> <p> </p> <p class="hint svelte-b6vc4l">   .      .</p> <button class="btn secondary svelte-b6vc4l"></button></div>'),root_4$1=from_html('<div class="error-message svelte-b6vc4l"> </div>'),root_5$2=from_html('<div class="success-message-small svelte-b6vc4l"> </div>'),root_3$2=from_html('<p class="description svelte-b6vc4l">     email.        .</p> <!> <!> <form><div class="form-group svelte-b6vc4l"><label for="reset-email" class="svelte-b6vc4l"> email</label> <input type="email" id="reset-email" placeholder="your@email.com" required="" class="svelte-b6vc4l"/></div> <button type="submit" class="btn-submit svelte-b6vc4l"> </button></form> <div class="links"><button class="btn-link svelte-b6vc4l">  </button></div>',1),root_7=from_html('<div class="error-message svelte-b6vc4l"> </div>'),root_6=from_html('<p class="description svelte-b6vc4l">     .</p> <!> <form><div class="form-group svelte-b6vc4l"><label for="new-password" class="svelte-b6vc4l"> </label> <input type="password" id="new-password" placeholder=" 6 " minlength="6" required="" class="svelte-b6vc4l"/></div> <div class="form-group svelte-b6vc4l"><label for="confirm-password" class="svelte-b6vc4l"> </label> <input type="password" id="confirm-password" placeholder=" " minlength="6" required="" class="svelte-b6vc4l"/></div> <button type="submit" class="btn-submit svelte-b6vc4l"> </button></form>',1),root$1=from_html('<div class="reset-password-overlay svelte-b6vc4l"><div class="reset-card svelte-b6vc4l"><button class="close-btn svelte-b6vc4l" aria-label=""></button> <h1 class="svelte-b6vc4l">  </h1> <!></div></div>');function ResetPasswordPage(r,e){push(e,!0);let t=prop(e,"initialError",3,""),n=prop(e,"initialToken",3,""),i=state(""),s=state(""),o=state(""),c=state(!1),f=state(""),v=state(proxy(t())),h=state(!1),m=state(!1),y=state(!1);async function g(){if(get$2(y))return!0;try{console.log("[ResetPassword] Setting session from token");const{data:{session:x},error:D}=await supabase.auth.getSession();if(D)return console.error("[ResetPassword] Session error:",D),!1;if(x)return console.log("[ResetPassword] Session already exists"),set(y,!0),!0;if(n()){console.log("[ResetPassword] Token provided, waiting for session..."),await new Promise(q=>setTimeout(q,1e3));const{data:{session:N}}=await supabase.auth.getSession();if(N)return set(y,!0),!0}return!1}catch(x){return console.error("[ResetPassword] Error setting session:",x),!1}}onMount(async()=>{if(console.log("[ResetPassword] Mounted with:",{hasToken:!!n(),hasError:!!t(),path:window.location.pathname,hash:window.location.hash,search:window.location.search}),n()||window.location.pathname==="/reset-password"){const x=await g();set(m,x,!0),!x&&!t()&&set(v,"      .  .")}else t()&&(set(m,!1),set(v,t()))});async function w(){if(get$2(o)){set(c,!0),set(v,""),set(f,""),console.log("[ResetPassword] Sending reset to:",get$2(o));try{const{data:x,error:D}=await supabase.auth.resetPasswordForEmail(get$2(o),{redirectTo:`${window.location.origin}/reset-password`});console.log("[ResetPassword] Response:",{data:x,error:D}),D?D.message?.toLowerCase().includes("rate limit")||D.message?.toLowerCase().includes("too many")?set(v,"   . ,  ."):D.message?.includes("User not found")?set(v,"   email  "):set(v,D.message,!0):set(f,"    !   (  ).")}catch(x){console.error("[ResetPassword] Exception:",x),set(v,x.message||" ",!0)}set(c,!1)}}async function k(){if(set(v,""),set(f,""),get$2(i).length<6){set(v,"     6 ");return}if(get$2(i)!==get$2(s)){set(v,"  ");return}set(c,!0);try{if(!await g()){set(v,"  . ,      .");return}const{error:D}=await supabase.auth.updateUser({password:get$2(i)});D?(console.error("[ResetPassword] Update error:",D),set(v,D.message,!0)):(set(h,!0),set(f,"  !"),setTimeout(()=>{window.location.hash="",e.onClose?.()},3e3))}catch(x){console.error("[ResetPassword] Exception:",x),set(v,x.message||"   ",!0)}finally{set(c,!1)}}var I=root$1(),O=child(I),B=child(O),P=sibling(B,4);{var G=x=>{var D=root_1$2(),N=sibling(child(D),2),q=child(N);template_effect(()=>set_text(q,get$2(f))),append(x,D)},Y=x=>{var D=root_2$1(),N=sibling(child(D),2),q=child(N),ie=sibling(N,4);template_effect(()=>set_text(q,get$2(v))),delegated("click",ie,function(...K){e.onClose?.apply(this,K)}),append(x,D)},M=x=>{var D=root_3$2(),N=sibling(first_child(D),2);{var q=ne=>{var te=root_4$1(),fe=child(te);template_effect(()=>set_text(fe,get$2(v))),append(ne,te)};if_block(N,ne=>{get$2(v)&&ne(q)})}var ie=sibling(N,2);{var K=ne=>{var te=root_5$2(),fe=child(te);template_effect(()=>set_text(fe,get$2(f))),append(ne,te)};if_block(ie,ne=>{get$2(f)&&ne(K)})}var se=sibling(ie,2),me=child(se),z=sibling(child(me),2),V=sibling(me,2),oe=child(V),U=sibling(se,2),j=child(U);template_effect(()=>{V.disabled=get$2(c)||!get$2(o),set_text(oe,get$2(c)?"...":" ")}),event("submit",se,ne=>{ne.preventDefault(),w()}),bind_value(z,()=>get$2(o),ne=>set(o,ne)),delegated("click",j,function(...ne){e.onClose?.apply(this,ne)}),append(x,D)},T=x=>{var D=root_6(),N=sibling(first_child(D),2);{var q=U=>{var j=root_7(),ne=child(j);template_effect(()=>set_text(ne,get$2(v))),append(U,j)};if_block(N,U=>{get$2(v)&&U(q)})}var ie=sibling(N,2),K=child(ie),se=sibling(child(K),2),me=sibling(K,2),z=sibling(child(me),2),V=sibling(me,2),oe=child(V);template_effect(()=>{V.disabled=get$2(c)||!get$2(m),set_text(oe,get$2(c)?"...":"  ")}),event("submit",ie,U=>{U.preventDefault(),k()}),bind_value(se,()=>get$2(i),U=>set(i,U)),bind_value(z,()=>get$2(s),U=>set(s,U)),append(x,D)};if_block(P,x=>{get$2(h)?x(G):!get$2(m)&&get$2(v)?x(Y,1):get$2(m)?x(T,!1):x(M,2)})}delegated("click",B,function(...x){e.onClose?.apply(this,x)}),append(r,I),pop()}delegate(["click"]);var root_1$1=from_html('<div class="game-container svelte-wa8fyy"><button type="button" class="back-btn svelte-wa8fyy">   </button> <!></div>'),root_3$1=from_html('<button type="button"> </button>'),root_4=from_html('<button type="button" class="game-card svelte-wa8fyy"><div class="game-icon svelte-wa8fyy"> </div> <div class="game-info svelte-wa8fyy"><h3 class="game-name svelte-wa8fyy"> </h3> <p class="game-description svelte-wa8fyy"> </p></div> <div class="game-arrow svelte-wa8fyy"></div></button>'),root_5$1=from_html('<div class="empty svelte-wa8fyy"><p>     </p></div>'),root_2=from_html('<div class="all-games svelte-wa8fyy"><div class="header svelte-wa8fyy"><button type="button" class="back-btn svelte-wa8fyy"> </button> <h1 class="svelte-wa8fyy"> -</h1> <p class="svelte-wa8fyy">   </p></div> <div class="categories svelte-wa8fyy"></div> <div class="games-scroll svelte-wa8fyy"><div class="games-grid svelte-wa8fyy"></div></div> <!></div>');function AllGames(r,e){push(e,!0);let t=state("all"),n=state(null);const i=user_derived(()=>get$2(t)==="all"?gamesList:gamesList.filter(w=>w.category===get$2(t))),s=["all","puzzle","memory","logic","arcade","board"];function o(w){userKeyStore.trackGameStart(w.id,w.name),set(n,w,!0)}function c(){set(n,null)}async function f(){get$2(n)&&await userKeyStore.trackEvent("session_time",{game_id:get$2(n).id,game_title:get$2(n).name}),set(n,null)}const v=user_derived(()=>get$2(n)?gameComponents[get$2(n).id]:null);var h=comment(),m=first_child(h);{var y=w=>{var k=root_1$1(),I=child(k),O=sibling(I,2);component(O,()=>get$2(v),(B,P)=>{P(B,{integrated:!1,onWin:()=>{get$2(n)&&userKeyStore.trackGameResult(get$2(n).id,get$2(n).name,!0),f()},onLose:()=>{get$2(n)&&userKeyStore.trackGameResult(get$2(n).id,get$2(n).name,!1),f()},rewardItem:null,items:[],bucketName:"dracula"})}),delegated("click",I,c),append(w,k)},g=w=>{var k=root_2(),I=child(k),O=child(I),B=sibling(I,2);each(B,21,()=>s,index$1,(T,x)=>{var D=root_3$1();let N;var q=child(D);template_effect(()=>{N=set_class(D,1,"category-btn svelte-wa8fyy",null,N,{active:get$2(t)===get$2(x)}),set_text(q,get$2(x)==="all"?"":categoryNames[get$2(x)])}),delegated("click",D,()=>set(t,get$2(x),!0)),append(T,D)});var P=sibling(B,2),G=child(P);each(G,21,()=>get$2(i),T=>T.id,(T,x)=>{var D=root_4(),N=child(D),q=child(N),ie=sibling(N,2),K=child(ie),se=child(K),me=sibling(K,2),z=child(me);template_effect(()=>{set_text(q,get$2(x).icon),set_text(se,get$2(x).name),set_text(z,get$2(x).description)}),delegated("click",D,()=>o(get$2(x))),append(T,D)});var Y=sibling(P,2);{var M=T=>{var x=root_5$1();append(T,x)};if_block(Y,T=>{get$2(i).length===0&&T(M)})}delegated("click",O,function(...T){e.onBack?.apply(this,T)}),append(w,k)};if_block(m,w=>{get$2(n)&&get$2(v)?w(y):w(g,!1)})}append(r,h),pop()}delegate(["click"]);var root_1=from_html('<div class="loading-screen svelte-1n46o8q"><div class="loader svelte-1n46o8q"></div> <p>...</p></div>'),root_3=from_html('<button class="btn-back-to-game svelte-1n46o8q" title="  ">   </button> <!>',1),root_5=from_html("<!> <!>",1),root=from_html("<!> <!>",1);function App(r,e){push(e,!0);let t=null,n=null,i=null,s=state(!1),o=state(!1),c=state(!1),f=state(""),v=state(""),h=state(!0);async function m(){const D=new URLSearchParams(window.location.search),N=D.get("story"),q=D.get("bucket");if(!N&&!q)return null;console.log("[App]    :",{storyId:N,bucket:q}),await loadStories();let ie=null;return N?ie=getStoryById(N):q&&(ie=getStoryByBucket(q)),ie?(console.log("[App]  :",ie.title),gameState.selectedStory=ie.id,gameState.selectedStoryData=ie,window.history.replaceState({},"","/"),ie):(console.log("[App]   "),null)}user_effect(()=>{authState.initialized&&console.log("[App] Auth state changed:",{user:authState.user?.email,isAuthenticated:authDerivedState.isAuthenticated,session:!!authState.session,loading:authState.loading})});async function y(){const D=window.location.hash,N=window.location.search;if(console.log("[App] Checking auth callback:",{hash:D,search:N}),D.includes("type=recovery")||N.includes("type=recovery")){console.log("[App] Recovery flow detected");let q="";D.includes("access_token=")?q=new URLSearchParams(D.substring(1)).get("access_token")||"":N.includes("token=")&&(q=new URLSearchParams(N).get("token")||""),q&&(set(v,q,!0),set(o,!0),window.history.replaceState({},"","/reset-password"))}else if(N.includes("error=")){const q=new URLSearchParams(N);set(f,q.get("error_description")||q.get("error")||"Unknown error",!0),set(o,!0),window.history.replaceState({},"","/reset-password")}else window.location.pathname==="/reset-password"&&set(o,!0)}const g=async()=>{await userKeyStore.stopSessionTimer()};onMount(async()=>{console.log("[App] Mounted"),userKeyStore.startSessionTimer(),typeof window<"u"&&(window.addEventListener("beforeunload",g),window.addEventListener("keydown",w));try{const N=await userKeyStore.init();N?(t=N,n=await userKeyStore.getUserStats(N)):i="    "}catch(N){i=N instanceof Error?N.message:" "}const D=()=>{set(c,!0)};window.addEventListener("open-all-games",D);try{await y();const N=initAuth(),q=new Promise((ie,K)=>setTimeout(()=>K(new Error("Timeout auth")),1e4));await Promise.race([N,q]),console.log("[App] Auth initialized successfully"),await m()}catch(N){console.error("[App] Auth init error:",N)}finally{set(s,!0),console.log("[App] App ready")}return()=>{window.removeEventListener("open-all-games",D),window.removeEventListener("beforeunload",g),window.removeEventListener("keydown",w)}});function w(D){D.ctrlKey&&D.shiftKey&&D.key==="D"&&(D.preventDefault(),set(h,!get$2(h)))}function k(){set(o,!1),set(f,""),set(v,""),window.history.replaceState({},"","/")}function I(){set(c,!1)}var O=root(),B=first_child(O);{var P=D=>{var N=root_1();append(D,N)},G=D=>{ResetPasswordPage(D,{onClose:k,get initialError(){return get$2(f)},get initialToken(){return get$2(v)}})},Y=D=>{var N=root_3(),q=first_child(N),ie=sibling(q,2);Editor(ie,{}),delegated("click",q,function(...K){editorActions.toggleEditor?.apply(this,K)}),append(D,N)},M=D=>{AllGames(D,{onBack:I})},T=D=>{var N=root_5(),q=first_child(N);{var ie=se=>{UserMenu(se,{})};if_block(q,se=>{gameState.isMinigameActive||se(ie)})}var K=sibling(q,2);Main(K,{}),append(D,N)};if_block(B,D=>{get$2(s)?get$2(o)?D(G,1):editor.showEditor?D(Y,2):get$2(c)?D(M,3):D(T,!1):D(P)})}var x=sibling(B,2);if_block(x,D=>{}),append(r,O),pop()}delegate(["click"]);mount(App,{target:document.getElementById("app")});
