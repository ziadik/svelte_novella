(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const Il=!1;var ki=Array.isArray,sc=Array.prototype.indexOf,Aa=Array.from,oa=Object.defineProperty,Br=Object.getOwnPropertyDescriptor,Al=Object.getOwnPropertyDescriptors,ac=Object.prototype,oc=Array.prototype,Ca=Object.getPrototypeOf,$o=Object.isExtensible;function lc(n){return n()}function os(n){for(var e=0;e<n.length;e++)n[e]()}function uc(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const nn=2,Ta=4,ms=8,Xr=16,Un=32,gr=64,Cl=128,on=256,ls=512,Wt=1024,ln=2048,Yn=4096,pn=8192,mr=16384,Pa=32768,_s=65536,Fo=1<<17,cc=1<<18,Si=1<<19,Tl=1<<20,la=1<<21,Ra=1<<22,hr=1<<23,Dn=Symbol("$state"),dc=Symbol("legacy props"),hc=Symbol(""),ja=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function fc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Pl(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function vc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function pc(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function gc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mc(n){throw new Error("https://svelte.dev/e/effect_orphan")}function _c(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function yc(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function wc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function bc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function kc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const ys=1,ws=2,Rl=4,Sc=8,Ec=16,Ic=1,Ac=2,Cc=4,Tc=8,Pc=16,Rc=1,jc=2,Mt=Symbol(),xc="http://www.w3.org/1999/xhtml";function Oc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Mc=!1;function jl(n){return n===this.v}function xl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Lc(n,e){return n!==e}function Ol(n){return!xl(n,this.v)}let Qr=!1,Dc=!1;function $c(){Qr=!0}let Et=null;function us(n){Et=n}function Ht(n,e=!1,t){Et={p:Et,c:null,e:null,s:n,x:null,l:Qr&&!e?{s:null,u:null,$:[]}:null}}function Gt(n){var e=Et,t=e.e;if(t!==null){e.e=null;for(var r of t)Gl(r)}return Et=e.p,{}}function Zr(){return!Qr||Et!==null&&Et.l===null}const Fc=new WeakMap;function Uc(n){var e=Qe;if(e===null)return tt.f|=hr,n;if((e.f&Pa)===0){if((e.f&Cl)===0)throw!e.parent&&n instanceof Error&&Ml(n),n;e.b.error(n)}else xa(n,e)}function xa(n,e){for(;e!==null;){if((e.f&Cl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Ml(n),n}function Ml(n){const e=Fc.get(n);e&&(oa(n,"message",{value:e.message}),oa(n,"stack",{value:e.stack}))}let _i=[],ua=[];function Ll(){var n=_i;_i=[],os(n)}function Nc(){var n=ua;ua=[],os(n)}function Dl(n){_i.length===0&&queueMicrotask(Ll),_i.push(n)}function Bc(){_i.length>0&&Ll(),ua.length>0&&Nc()}function Wc(){for(var n=Qe.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&fc(),n}function Ei(n){var e=nn|ln,t=tt!==null&&(tt.f&nn)!==0?tt:null;return Qe===null||t!==null&&(t.f&on)!==0?e|=on:Qe.f|=Si,{ctx:Et,deps:null,effects:null,equals:jl,f:e,fn:n,reactions:null,rv:0,v:Mt,wv:0,parent:t??Qe,ac:null}}function Vc(n,e){let t=Qe;t===null&&vc();var r=t.b,s=void 0,l=Hr(Mt),u=null,h=!tt;return sd(()=>{try{var f=n();u&&Promise.resolve(f).catch(()=>{})}catch(g){f=Promise.reject(g)}var m=()=>f;s=u?.then(m,m)??Promise.resolve(f),u=s;var _=dt,b=r.pending;h&&(r.update_pending_count(1),b||_.increment());const S=(g,A=void 0)=>{u=null,b||_.activate(),A?A!==ja&&(l.f|=hr,Gr(l,A)):((l.f&hr)!==0&&(l.f^=hr),Gr(l,g)),h&&(r.update_pending_count(-1),b||_.decrement()),Ul()};if(s.then(S,g=>S(null,g||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(f=>{function m(_){function b(){_===s?f(l):m(s)}_.then(b,b)}m(s)})}function Oa(n){const e=Ei(n);return eu(e),e}function ei(n){const e=Ei(n);return e.equals=Ol,e}function $l(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Fn(e[t])}}function qc(n){for(var e=n.parent;e!==null;){if((e.f&nn)===0)return e;e=e.parent}return null}function Ma(n){var e,t=Qe;Gn(qc(n));try{$l(n),e=iu(n)}finally{Gn(t)}return e}function Fl(n){var e=Ma(n);if(n.equals(e)||(n.v=e,n.wv=nu()),!_r){var t=(zn||(n.f&on)!==0)&&n.deps!==null?Yn:Wt;Jt(n,t)}}function zc(n,e,t){const r=Zr()?Ei:ei;if(e.length===0){t(n.map(r));return}var s=dt,l=Qe,u=Hc(),h=Wc();Promise.all(e.map(f=>Vc(f))).then(f=>{s?.activate(),u();try{t([...n.map(r),...f])}catch(m){(l.f&mr)===0&&xa(m,l)}s?.deactivate(),Ul()}).catch(f=>{h.error(f)})}function Hc(){var n=Qe,e=tt,t=Et,r=dt;return function(){Gn(n),An(e),us(t),r?.activate()}}function Ul(){Gn(null),An(null),us(null)}const qs=new Set;let dt=null,is=null,Uo=new Set,cs=[];function Nl(){const n=cs.shift();cs.length>0&&queueMicrotask(Nl),n()}let vr=[],bs=null,ca=!1,ss=!1;class qr{current=new Map;#i=new Map;#n=new Set;#e=0;#s=null;#a=!1;#t=[];#r=[];#l=[];#o=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){vr=[],is=null;for(const s of e)this.#v(s);if(this.#t.length===0&&this.#e===0){this.#f();var t=this.#l,r=this.#o;this.#l=[],this.#o=[],this.#u=[],is=dt,dt=null,No(t),No(r),dt===null?dt=this:qs.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const s of this.#t)Vr(s);for(const s of this.#r)Vr(s);this.#t=[],this.#r=[]}#v(e){e.f^=Wt;for(var t=e.first;t!==null;){var r=t.f,s=(r&(Un|gr))!==0,l=s&&(r&Wt)!==0,u=l||(r&pn)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(s)t.f^=Wt;else if((r&Ta)!==0)this.#o.push(t);else if((r&Wt)===0)if((r&Ra)!==0){var h=t.b?.pending?this.#r:this.#t;h.push(t)}else Is(t)&&((t.f&Xr)!==0&&this.#u.push(t),Vr(t));var f=t.first;if(f!==null){t=f;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&ln)!==0?this.#d:this.#h).push(t),Jt(t,Wt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){dt=this}deactivate(){dt=null,is=null;for(const e of Uo)if(Uo.delete(e),e(),dt!==null)break}neuter(){this.#a=!0}flush(){vr.length>0?Bl():this.#f(),dt===this&&(this.#e===0&&qs.delete(this),this.deactivate())}#f(){if(!this.#a)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)Jt(e,ln),zr(e);for(const e of this.#h)Jt(e,Yn),zr(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#s??=uc()).promise}static ensure(){if(dt===null){const e=dt=new qr;qs.add(dt),ss||qr.enqueue(()=>{dt===e&&e.flush()})}return dt}static enqueue(e){cs.length===0&&queueMicrotask(Nl),cs.unshift(e)}}function Gc(n){var e=ss;ss=!0;try{for(var t;;){if(Bc(),vr.length===0&&(dt?.flush(),vr.length===0))return bs=null,t;Bl()}}finally{ss=e}}function Bl(){var n=Wr;ca=!0;try{var e=0;for(qo(!0);vr.length>0;){var t=qr.ensure();if(e++>1e3){var r,s;Kc()}t.process(vr),Hn.clear()}}finally{ca=!1,qo(n),bs=null}}function Kc(){try{_c()}catch(n){xa(n,bs)}}let lr=null;function No(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(mr|pn))===0&&Is(r)&&(lr=[],Vr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Xl(r):r.fn=null),lr?.length>0)){Hn.clear();for(const s of lr)Vr(s);lr=[]}}lr=null}}function zr(n){for(var e=bs=n;e.parent!==null;){e=e.parent;var t=e.f;if(ca&&e===Qe&&(t&Xr)!==0)return;if((t&(gr|Un))!==0){if((t&Wt)===0)return;e.f^=Wt}}vr.push(e)}const Hn=new Map;function Hr(n,e){var t={f:0,v:n,reactions:null,equals:jl,rv:0,wv:0};return t}function lt(n,e){const t=Hr(n);return eu(t),t}function Yc(n,e=!1,t=!0){const r=Hr(n);return e||(r.equals=Ol),Qr&&t&&Et!==null&&Et.l!==null&&(Et.l.s??=[]).push(r),r}function xe(n,e,t=!1){tt!==null&&(!In||(tt.f&Fo)!==0)&&Zr()&&(tt.f&(nn|Xr|Ra|Fo))!==0&&!$n?.includes(n)&&kc();let r=t?zt(e):e;return Gr(n,r)}function Gr(n,e){if(!n.equals(e)){var t=n.v;_r?Hn.set(n,e):Hn.set(n,t),n.v=e;var r=qr.ensure();r.capture(n,t),(n.f&nn)!==0&&((n.f&ln)!==0&&Ma(n),Jt(n,(n.f&on)===0?Wt:Yn)),n.wv=nu(),Wl(n,ln),Zr()&&Qe!==null&&(Qe.f&Wt)!==0&&(Qe.f&(Un|gr))===0&&(an===null?ud([n]):an.push(n))}return e}function Jc(n,e=1){var t=E(n),r=e===1?t++:t--;return xe(n,t),r}function zs(n){xe(n,n.v+1)}function Wl(n,e){var t=n.reactions;if(t!==null)for(var r=Zr(),s=t.length,l=0;l<s;l++){var u=t[l],h=u.f;if(!(!r&&u===Qe)){var f=(h&ln)===0;f&&Jt(u,e),(h&nn)!==0?Wl(u,Yn):f&&((h&Xr)!==0&&lr!==null&&lr.push(u),zr(u))}}}function zt(n){if(typeof n!="object"||n===null||Dn in n)return n;const e=Ca(n);if(e!==ac&&e!==oc)return n;var t=new Map,r=ki(n),s=lt(0),l=fr,u=h=>{if(fr===l)return h();var f=tt,m=fr;An(null),Ho(l);var _=h();return An(f),Ho(m),_};return r&&t.set("length",lt(n.length)),new Proxy(n,{defineProperty(h,f,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&wc();var _=t.get(f);return _===void 0?_=u(()=>{var b=lt(m.value);return t.set(f,b),b}):xe(_,m.value,!0),!0},deleteProperty(h,f){var m=t.get(f);if(m===void 0){if(f in h){const _=u(()=>lt(Mt));t.set(f,_),zs(s)}}else xe(m,Mt),zs(s);return!0},get(h,f,m){if(f===Dn)return n;var _=t.get(f),b=f in h;if(_===void 0&&(!b||Br(h,f)?.writable)&&(_=u(()=>{var g=zt(b?h[f]:Mt),A=lt(g);return A}),t.set(f,_)),_!==void 0){var S=E(_);return S===Mt?void 0:S}return Reflect.get(h,f,m)},getOwnPropertyDescriptor(h,f){var m=Reflect.getOwnPropertyDescriptor(h,f);if(m&&"value"in m){var _=t.get(f);_&&(m.value=E(_))}else if(m===void 0){var b=t.get(f),S=b?.v;if(b!==void 0&&S!==Mt)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return m},has(h,f){if(f===Dn)return!0;var m=t.get(f),_=m!==void 0&&m.v!==Mt||Reflect.has(h,f);if(m!==void 0||Qe!==null&&(!_||Br(h,f)?.writable)){m===void 0&&(m=u(()=>{var S=_?zt(h[f]):Mt,g=lt(S);return g}),t.set(f,m));var b=E(m);if(b===Mt)return!1}return _},set(h,f,m,_){var b=t.get(f),S=f in h;if(r&&f==="length")for(var g=m;g<b.v;g+=1){var A=t.get(g+"");A!==void 0?xe(A,Mt):g in h&&(A=u(()=>lt(Mt)),t.set(g+"",A))}if(b===void 0)(!S||Br(h,f)?.writable)&&(b=u(()=>lt(void 0)),xe(b,zt(m)),t.set(f,b));else{S=b.v!==Mt;var D=u(()=>zt(m));xe(b,D)}var P=Reflect.getOwnPropertyDescriptor(h,f);if(P?.set&&P.set.call(_,m),!S){if(r&&typeof f=="string"){var U=t.get("length"),W=Number(f);Number.isInteger(W)&&W>=U.v&&xe(U,W+1)}zs(s)}return!0},ownKeys(h){E(s);var f=Reflect.ownKeys(h).filter(b=>{var S=t.get(b);return S===void 0||S.v!==Mt});for(var[m,_]of t)_.v!==Mt&&!(m in h)&&f.push(m);return f},setPrototypeOf(){bc()}})}function Bo(n){try{if(n!==null&&typeof n=="object"&&Dn in n)return n[Dn]}catch{}return n}function Xc(n,e){return Object.is(Bo(n),Bo(e))}var Wo,Vl,ql,zl;function Qc(){if(Wo===void 0){Wo=window,Vl=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;ql=Br(e,"firstChild").get,zl=Br(e,"nextSibling").get,$o(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),$o(t)&&(t.__t=void 0)}}function Jn(n=""){return document.createTextNode(n)}function Kr(n){return ql.call(n)}function ks(n){return zl.call(n)}function R(n,e){return Kr(n)}function Lt(n,e){{var t=Kr(n);return t instanceof Comment&&t.data===""?ks(t):t}}function $(n,e=1,t=!1){let r=n;for(;e--;)r=ks(r);return r}function Zc(n){n.textContent=""}function Ss(){return!1}let Vo=!1;function ed(){Vo||(Vo=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function La(n){var e=tt,t=Qe;An(null),Gn(null);try{return n()}finally{An(e),Gn(t)}}function Da(n,e,t,r=t){n.addEventListener(e,()=>La(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),ed()}function Hl(n){Qe===null&&tt===null&&mc(),tt!==null&&(tt.f&on)!==0&&Qe===null&&gc(),_r&&pc()}function td(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Cn(n,e,t,r=!0){var s=Qe;s!==null&&(s.f&pn)!==0&&(n|=pn);var l={ctx:Et,deps:null,nodes_start:null,nodes_end:null,f:n|ln,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Vr(l),l.f|=Pa}catch(f){throw Fn(l),f}else e!==null&&zr(l);if(r){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Si)===0&&(u=u.first),u!==null&&(u.parent=s,s!==null&&td(u,s),tt!==null&&(tt.f&nn)!==0&&(n&gr)===0)){var h=tt;(h.effects??=[]).push(u)}}return l}function nd(n){const e=Cn(ms,null,!1);return Jt(e,Wt),e.teardown=n,e}function Yr(n){Hl();var e=Qe.f,t=!tt&&(e&Un)!==0&&(e&Pa)===0;if(t){var r=Et;(r.e??=[]).push(n)}else return Gl(n)}function Gl(n){return Cn(Ta|Tl,n,!1)}function rd(n){return Hl(),Cn(ms|Tl,n,!0)}function id(n){qr.ensure();const e=Cn(gr|Si,n,!0);return(t={})=>new Promise(r=>{t.outro?Ii(e,()=>{Fn(e),r(void 0)}):(Fn(e),r(void 0))})}function Kl(n){return Cn(Ta,n,!1)}function sd(n){return Cn(Ra|Si,n,!0)}function $a(n,e=0){return Cn(ms|e,n,!0)}function Te(n,e=[],t=[]){zc(e,t,r=>{Cn(ms,()=>n(...r.map(E)),!0)})}function Es(n,e=0){var t=Cn(Xr|e,n,!0);return t}function pr(n,e=!0){return Cn(Un|Si,n,!0,e)}function Yl(n){var e=n.teardown;if(e!==null){const t=_r,r=tt;zo(!0),An(null);try{e.call(null)}finally{zo(t),An(r)}}}function Jl(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&La(()=>{s.abort(ja)});var r=t.next;(t.f&gr)!==0?t.parent=null:Fn(t,e),t=r}}function ad(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Un)===0&&Fn(e),e=t}}function Fn(n,e=!0){var t=!1;(e||(n.f&cc)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(od(n.nodes_start,n.nodes_end),t=!0),Jl(n,e&&!t),ds(n,0),Jt(n,mr);var r=n.transitions;if(r!==null)for(const l of r)l.stop();Yl(n);var s=n.parent;s!==null&&s.first!==null&&Xl(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function od(n,e){for(;n!==null;){var t=n===e?null:ks(n);n.remove(),n=t}}function Xl(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ii(n,e){var t=[];Fa(n,t,!0),Ql(t,()=>{Fn(n),e&&e()})}function Ql(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function Fa(n,e,t){if((n.f&pn)===0){if(n.f^=pn,n.transitions!==null)for(const u of n.transitions)(u.is_global||t)&&e.push(u);for(var r=n.first;r!==null;){var s=r.next,l=(r.f&_s)!==0||(r.f&Un)!==0;Fa(r,e,l?t:!1),r=s}}}function Ua(n){Zl(n,!0)}function Zl(n,e){if((n.f&pn)!==0){n.f^=pn,(n.f&Wt)===0&&(Jt(n,ln),zr(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&_s)!==0||(t.f&Un)!==0;Zl(t,s?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let Fr=null;function ld(n){var e=Fr;try{if(Fr=new Set,yr(n),e!==null)for(var t of Fr)e.add(t);return Fr}finally{Fr=e}}function Sn(n){for(var e of ld(n))Gr(e,e.v)}let Wr=!1;function qo(n){Wr=n}let _r=!1;function zo(n){_r=n}let tt=null,In=!1;function An(n){tt=n}let Qe=null;function Gn(n){Qe=n}let $n=null;function eu(n){tt!==null&&($n===null?$n=[n]:$n.push(n))}let qt=null,tn=0,an=null;function ud(n){an=n}let tu=1,yi=0,fr=yi;function Ho(n){fr=n}let zn=!1;function nu(){return++tu}function Is(n){var e=n.f;if((e&ln)!==0)return!0;if((e&Yn)!==0){var t=n.deps,r=(e&on)!==0;if(t!==null){var s,l,u=(e&ls)!==0,h=r&&Qe!==null&&!zn,f=t.length;if((u||h)&&(Qe===null||(Qe.f&mr)===0)){var m=n,_=m.parent;for(s=0;s<f;s++)l=t[s],(u||!l?.reactions?.includes(m))&&(l.reactions??=[]).push(m);u&&(m.f^=ls),h&&_!==null&&(_.f&on)===0&&(m.f^=on)}for(s=0;s<f;s++)if(l=t[s],Is(l)&&Fl(l),l.wv>n.wv)return!0}(!r||Qe!==null&&!zn)&&Jt(n,Wt)}return!1}function ru(n,e,t=!0){var r=n.reactions;if(r!==null&&!$n?.includes(n))for(var s=0;s<r.length;s++){var l=r[s];(l.f&nn)!==0?ru(l,e,!1):e===l&&(t?Jt(l,ln):(l.f&Wt)!==0&&Jt(l,Yn),zr(l))}}function iu(n){var e=qt,t=tn,r=an,s=tt,l=zn,u=$n,h=Et,f=In,m=fr,_=n.f;qt=null,tn=0,an=null,zn=(_&on)!==0&&(In||!Wr||tt===null),tt=(_&(Un|gr))===0?n:null,$n=null,us(n.ctx),In=!1,fr=++yi,n.ac!==null&&(La(()=>{n.ac.abort(ja)}),n.ac=null);try{n.f|=la;var b=n.fn,S=b(),g=n.deps;if(qt!==null){var A;if(ds(n,tn),g!==null&&tn>0)for(g.length=tn+qt.length,A=0;A<qt.length;A++)g[tn+A]=qt[A];else n.deps=g=qt;if(!zn||(_&nn)!==0&&n.reactions!==null)for(A=tn;A<g.length;A++)(g[A].reactions??=[]).push(n)}else g!==null&&tn<g.length&&(ds(n,tn),g.length=tn);if(Zr()&&an!==null&&!In&&g!==null&&(n.f&(nn|Yn|ln))===0)for(A=0;A<an.length;A++)ru(an[A],n);return s!==null&&s!==n&&(yi++,an!==null&&(r===null?r=an:r.push(...an))),(n.f&hr)!==0&&(n.f^=hr),S}catch(D){return Uc(D)}finally{n.f^=la,qt=e,tn=t,an=r,tt=s,zn=l,$n=u,us(h),In=f,fr=m}}function cd(n,e){let t=e.reactions;if(t!==null){var r=sc.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&nn)!==0&&(qt===null||!qt.includes(e))&&(Jt(e,Yn),(e.f&(on|ls))===0&&(e.f^=ls),$l(e),ds(e,0))}function ds(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)cd(n,t[r])}function Vr(n){var e=n.f;if((e&mr)===0){Jt(n,Wt);var t=Qe,r=Wr;Qe=n,Wr=!0;try{(e&Xr)!==0?ad(n):Jl(n),Yl(n);var s=iu(n);n.teardown=typeof s=="function"?s:null,n.wv=tu;var l;Il&&Dc&&(n.f&ln)!==0&&n.deps}finally{Wr=r,Qe=t}}}async function su(){await Promise.resolve(),Gc()}function E(n){var e=n.f,t=(e&nn)!==0;if(Fr?.add(n),tt!==null&&!In){var r=Qe!==null&&(Qe.f&mr)!==0;if(!r&&!$n?.includes(n)){var s=tt.deps;if((tt.f&la)!==0)n.rv<yi&&(n.rv=yi,qt===null&&s!==null&&s[tn]===n?tn++:qt===null?qt=[n]:(!zn||!qt.includes(n))&&qt.push(n));else{(tt.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[tt]:l.includes(tt)||l.push(tt)}}}else if(t&&n.deps===null&&n.effects===null){var u=n,h=u.parent;h!==null&&(h.f&on)===0&&(u.f^=on)}if(_r){if(Hn.has(n))return Hn.get(n);if(t){u=n;var f=u.v;return((u.f&Wt)===0&&u.reactions!==null||au(u))&&(f=Ma(u)),Hn.set(u,f),f}}else t&&(u=n,Is(u)&&Fl(u));if((n.f&hr)!==0)throw n.v;return n.v}function au(n){if(n.v===Mt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Hn.has(e)||(e.f&nn)!==0&&au(e))return!0;return!1}function yr(n){var e=In;try{return In=!0,n()}finally{In=e}}const dd=-7169;function Jt(n,e){n.f=n.f&dd|e}function hd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Dn in n)da(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Dn in t&&da(t)}}}function da(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{da(n[r],e)}catch{}const t=Ca(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Al(t);for(let s in r){const l=r[s].get;if(l)try{l.call(n)}catch{}}}}}const fd=["touchstart","touchmove"];function vd(n){return fd.includes(n)}const ou=new Set,ha=new Set;function Xt(n){for(var e=0;e<n.length;e++)ou.add(n[e]);for(var t of ha)t(n)}let Go=null;function Xi(n){var e=this,t=e.ownerDocument,r=n.type,s=n.composedPath?.()||[],l=s[0]||n.target;Go=n;var u=0,h=Go===n&&n.__root;if(h){var f=s.indexOf(h);if(f!==-1&&(e===document||e===window)){n.__root=e;return}var m=s.indexOf(e);if(m===-1)return;f<=m&&(u=f)}if(l=s[u]||n.target,l!==e){oa(n,"currentTarget",{configurable:!0,get(){return l||t}});var _=tt,b=Qe;An(null),Gn(null);try{for(var S,g=[];l!==null;){var A=l.assignedSlot||l.parentNode||l.host||null;try{var D=l["__"+r];if(D!=null&&(!l.disabled||n.target===l))if(ki(D)){var[P,...U]=D;P.apply(l,[n,...U])}else D.call(l,n)}catch(W){S?g.push(W):S=W}if(n.cancelBubble||A===e||A===null)break;l=A}if(S){for(let W of g)queueMicrotask(()=>{throw W});throw S}}finally{n.__root=e,delete n.currentTarget,An(_),Gn(b)}}}function lu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function wi(n,e){var t=Qe;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function oe(n,e){var t=(e&Rc)!==0,r=(e&jc)!==0,s,l=!n.startsWith("<!>");return()=>{s===void 0&&(s=lu(l?n:"<!>"+n),t||(s=Kr(s)));var u=r||Vl?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=Kr(u),f=u.lastChild;wi(h,f)}else wi(u,u);return u}}function pd(n,e,t="svg"){var r=!n.startsWith("<!>"),s=`<${t}>${r?n:"<!>"+n}</${t}>`,l;return()=>{if(!l){var u=lu(s),h=Kr(u);l=Kr(h)}var f=l.cloneNode(!0);return wi(f,f),f}}function gd(n,e){return pd(n,e,"svg")}function Hs(n=""){{var e=Jn(n+"");return wi(e,e),e}}function Yt(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Jn();return n.append(e,t),wi(e,t),n}function Y(n,e){n!==null&&n.before(e)}function Pe(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function md(n,e){return _d(n,e)}const Cr=new Map;function _d(n,{target:e,anchor:t,props:r={},events:s,context:l,intro:u=!0}){Qc();var h=new Set,f=b=>{for(var S=0;S<b.length;S++){var g=b[S];if(!h.has(g)){h.add(g);var A=vd(g);e.addEventListener(g,Xi,{passive:A});var D=Cr.get(g);D===void 0?(document.addEventListener(g,Xi,{passive:A}),Cr.set(g,1)):Cr.set(g,D+1)}}};f(Aa(ou)),ha.add(f);var m=void 0,_=id(()=>{var b=t??e.appendChild(Jn());return pr(()=>{if(l){Ht({});var S=Et;S.c=l}s&&(r.$$events=s),m=n(b,r)||{},l&&Gt()}),()=>{for(var S of h){e.removeEventListener(S,Xi);var g=Cr.get(S);--g===0?(document.removeEventListener(S,Xi),Cr.delete(S)):Cr.set(S,g)}ha.delete(f),b!==t&&b.parentNode?.removeChild(b)}});return yd.set(m,_),m}let yd=new WeakMap;function De(n,e,t=!1){var r=n,s=null,l=null,u=Mt,h=t?_s:0,f=!1;const m=(g,A=!0)=>{f=!0,S(A,g)};var _=null;function b(){_!==null&&(_.lastChild.remove(),r.before(_),_=null);var g=u?s:l,A=u?l:s;g&&Ua(g),A&&Ii(A,()=>{u?l=null:s=null})}const S=(g,A)=>{if(u!==(u=g)){var D=Ss(),P=r;if(D&&(_=document.createDocumentFragment(),_.append(P=Jn())),u?s??=A&&pr(()=>A(P)):l??=A&&pr(()=>A(P)),D){var U=dt,W=u?s:l,B=u?l:s;W&&U.skipped_effects.delete(W),B&&U.skipped_effects.add(B),U.add_callback(b)}else b()}};Es(()=>{f=!1,e(m),f||S(null,null)},h)}function fa(n,e,t){var r=n,s=Mt,l,u,h=null,f=Zr()?Lc:xl;function m(){l&&Ii(l),h!==null&&(h.lastChild.remove(),r.before(h),h=null),l=u}Es(()=>{if(f(s,s=e())){var _=r,b=Ss();b&&(h=document.createDocumentFragment(),h.append(_=Jn())),u=pr(()=>t(_)),b?dt.add_callback(m):m()}})}function Bt(n,e){return e}function wd(n,e,t){for(var r=n.items,s=[],l=e.length,u=0;u<l;u++)Fa(e[u].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var f=t.parentNode;Zc(f),f.append(t),r.clear(),bn(n,e[0].prev,e[l-1].next)}Ql(s,()=>{for(var m=0;m<l;m++){var _=e[m];h||(r.delete(_.k),bn(n,_.prev,_.next)),Fn(_.e,!h)}})}function yt(n,e,t,r,s,l=null){var u=n,h={flags:e,items:new Map,first:null},f=(e&Rl)!==0;if(f){var m=n;u=m.appendChild(Jn())}var _=null,b=!1,S=new Map,g=ei(()=>{var U=t();return ki(U)?U:U==null?[]:Aa(U)}),A,D;function P(){bd(D,A,h,S,u,s,e,r,t),l!==null&&(A.length===0?_?Ua(_):_=pr(()=>l(u)):_!==null&&Ii(_,()=>{_=null}))}Es(()=>{D??=Qe,A=E(g);var U=A.length;if(!(b&&U===0)){b=U===0;var W,B,z,X;if(Ss()){var L=new Set,N=dt;for(B=0;B<U;B+=1){z=A[B],X=r(z,B);var fe=h.items.get(X)??S.get(X);fe?(e&(ys|ws))!==0&&uu(fe,z,B,e):(W=cu(null,h,null,null,z,X,B,s,e,t,!0),S.set(X,W)),L.add(X)}for(const[te,Ee]of h.items)L.has(te)||N.skipped_effects.add(Ee.e);N.add_callback(P)}else P();E(g)}})}function bd(n,e,t,r,s,l,u,h,f){var m=(u&Sc)!==0,_=(u&(ys|ws))!==0,b=e.length,S=t.items,g=t.first,A=g,D,P=null,U,W=[],B=[],z,X,L,N;if(m)for(N=0;N<b;N+=1)z=e[N],X=h(z,N),L=S.get(X),L!==void 0&&(L.a?.measure(),(U??=new Set).add(L));for(N=0;N<b;N+=1){if(z=e[N],X=h(z,N),L=S.get(X),L===void 0){var fe=r.get(X);if(fe!==void 0){r.delete(X),S.set(X,fe);var te=P?P.next:A;bn(t,P,fe),bn(t,fe,te),Gs(fe,te,s),P=fe}else{var Ee=A?A.e.nodes_start:s;P=cu(Ee,t,P,P===null?t.first:P.next,z,X,N,l,u,f)}S.set(X,P),W=[],B=[],A=P.next;continue}if(_&&uu(L,z,N,u),(L.e.f&pn)!==0&&(Ua(L.e),m&&(L.a?.unfix(),(U??=new Set).delete(L))),L!==A){if(D!==void 0&&D.has(L)){if(W.length<B.length){var J=B[0],ne;P=J.prev;var ye=W[0],Re=W[W.length-1];for(ne=0;ne<W.length;ne+=1)Gs(W[ne],J,s);for(ne=0;ne<B.length;ne+=1)D.delete(B[ne]);bn(t,ye.prev,Re.next),bn(t,P,ye),bn(t,Re,J),A=J,P=Re,N-=1,W=[],B=[]}else D.delete(L),Gs(L,A,s),bn(t,L.prev,L.next),bn(t,L,P===null?t.first:P.next),bn(t,P,L),P=L;continue}for(W=[],B=[];A!==null&&A.k!==X;)(A.e.f&pn)===0&&(D??=new Set).add(A),B.push(A),A=A.next;if(A===null)continue;L=A}W.push(L),P=L,A=L.next}if(A!==null||D!==void 0){for(var he=D===void 0?[]:Aa(D);A!==null;)(A.e.f&pn)===0&&he.push(A),A=A.next;var be=he.length;if(be>0){var me=(u&Rl)!==0&&b===0?s:null;if(m){for(N=0;N<be;N+=1)he[N].a?.measure();for(N=0;N<be;N+=1)he[N].a?.fix()}wd(t,he,me)}}m&&Dl(()=>{if(U!==void 0)for(L of U)L.a?.apply()}),n.first=t.first&&t.first.e,n.last=P&&P.e;for(var at of r.values())Fn(at.e);r.clear()}function uu(n,e,t,r){(r&ys)!==0&&Gr(n.v,e),(r&ws)!==0?Gr(n.i,t):n.i=t}function cu(n,e,t,r,s,l,u,h,f,m,_){var b=(f&ys)!==0,S=(f&Ec)===0,g=b?S?Yc(s,!1,!1):Hr(s):s,A=(f&ws)===0?u:Hr(u),D={i:A,v:g,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var P=document.createDocumentFragment();P.append(n=Jn())}return D.e=pr(()=>h(n,g,A,m),Mc),D.e.prev=t&&t.e,D.e.next=r&&r.e,t===null?_||(e.first=D):(t.next=D,t.e.next=D.e),r!==null&&(r.prev=D,r.e.prev=D.e),D}finally{}}function Gs(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var u=ks(l);s.before(l),l=u}}function bn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function kd(n,e,t){var r=n,s,l,u=null,h=null;function f(){l&&(Ii(l),l=null),u&&(u.lastChild.remove(),r.before(u),u=null),l=h,h=null}Es(()=>{if(s!==(s=e())){var m=Ss();if(s){var _=r;m&&(u=document.createDocumentFragment(),u.append(_=Jn()),l&&dt.skipped_effects.add(l)),h=pr(()=>t(_,s))}m?dt.add_callback(f):f()}},_s)}const Ko=[...` 	
\r\f \v\uFEFF`];function Sd(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var l=s.length,u=0;(u=r.indexOf(s,u))>=0;){var h=u+l;(u===0||Ko.includes(r[u-1]))&&(h===r.length||Ko.includes(r[h]))?r=(u===0?"":r.substring(0,u))+r.substring(h+1):u=h}}return r===""?null:r}function Ed(n,e){return String(n)}function gn(n,e,t,r,s,l){var u=n.__className;if(u!==t||u===void 0){var h=Sd(t,r,l);h==null?n.removeAttribute("class"):n.className=h,n.__className=t}else if(l&&s!==l)for(var f in l){var m=!!l[f];(s==null||m!==!!s[f])&&n.classList.toggle(f,m)}return l}function Id(n,e,t,r){var s=n.__style;if(s!==e){var l=Ed(e);l==null?n.removeAttribute("style"):n.style.cssText=l,n.__style=e}return r}function hs(n,e,t=!1){if(n.multiple){if(e==null)return;if(!ki(e))return Oc();for(var r of n.options)r.selected=e.includes(vi(r));return}for(r of n.options){var s=vi(r);if(Xc(s,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function va(n){var e=new MutationObserver(()=>{hs(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),nd(()=>{e.disconnect()})}function Ln(n,e,t=e){var r=!0;Da(n,"change",s=>{var l=s?"[selected]":":checked",u;if(n.multiple)u=[].map.call(n.querySelectorAll(l),vi);else{var h=n.querySelector(l)??n.querySelector("option:not([disabled])");u=h&&vi(h)}t(u)}),Kl(()=>{var s=e();if(hs(n,s,r),r&&s===void 0){var l=n.querySelector(":checked");l!==null&&(s=vi(l),t(s))}n.__value=s,r=!1}),va(n)}function vi(n){return"__value"in n?n.__value:n.value}const Ad=Symbol("is custom element"),Cd=Symbol("is html");function Ks(n,e){var t=du(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function je(n,e,t,r){var s=du(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[hc]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Td(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function du(n){return n.__attributes??={[Ad]:n.nodeName.includes("-"),[Cd]:n.namespaceURI===xc}}var Yo=new Map;function Td(n){var e=n.getAttribute("is")||n.nodeName,t=Yo.get(e);if(t)return t;Yo.set(e,t=[]);for(var r,s=n,l=Element.prototype;l!==s;){r=Al(s);for(var u in r)r[u].set&&t.push(u);s=Ca(s)}return t}function cr(n,e,t=e){var r=new WeakSet;Da(n,"input",async s=>{var l=s?n.defaultValue:n.value;if(l=Js(n)?Xs(l):l,t(l),dt!==null&&r.add(dt),await su(),l!==(l=e())){var u=n.selectionStart,h=n.selectionEnd;n.value=l??"",h!==null&&(n.selectionStart=u,n.selectionEnd=Math.min(h,n.value.length))}}),yr(e)==null&&n.value&&(t(Js(n)?Xs(n.value):n.value),dt!==null&&r.add(dt)),$a(()=>{var s=e();if(n===document.activeElement){var l=is??dt;if(r.has(l))return}Js(n)&&s===Xs(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Ys(n,e,t=e){Da(n,"change",r=>{var s=r?n.defaultChecked:n.checked;t(s)}),yr(e)==null&&t(n.checked),$a(()=>{var r=e();n.checked=!!r})}function Js(n){var e=n.type;return e==="number"||e==="range"}function Xs(n){return n===""?null:+n}function Jo(n,e){return n===e||n?.[Dn]===e}function fs(n={},e,t,r){return Kl(()=>{var s,l;return $a(()=>{s=l,l=[],yr(()=>{n!==t(...l)&&(e(n,...l),s&&Jo(t(...s),n)&&e(null,...s))})}),()=>{Dl(()=>{l&&Jo(t(...l),n)&&e(null,...l)})}}),n}function wr(n=!1){const e=Et,t=e.l.u;if(!t)return;let r=()=>hd(e.s);if(n){let s=0,l={};const u=Ei(()=>{let h=!1;const f=e.s;for(const m in f)f[m]!==l[m]&&(l[m]=f[m],h=!0);return h&&s++,s});r=()=>E(u)}t.b.length&&rd(()=>{Xo(e,r),os(t.b)}),Yr(()=>{const s=yr(()=>t.m.map(lc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&Yr(()=>{Xo(e,r),os(t.a)})}function Xo(n,e){if(n.l.s)for(const t of n.l.s)E(t);e()}function br(n){var e=Hr(0);return function(){return arguments.length===1?(xe(e,E(e)+1),arguments[0]):(E(e),n())}}let Qi=!1;function Pd(n){var e=Qi;try{return Qi=!1,[n(),Qi]}finally{Qi=e}}function As(n,e,t,r){var s=!Qr||(t&Ac)!==0,l=(t&Tc)!==0,u=(t&Pc)!==0,h=r,f=!0,m=()=>(f&&(f=!1,h=u?yr(r):r),h),_;if(l){var b=Dn in n||dc in n;_=Br(n,e)?.set??(b&&e in n?B=>n[e]=B:void 0)}var S,g=!1;l?[S,g]=Pd(()=>n[e]):S=n[e],S===void 0&&r!==void 0&&(S=m(),_&&(s&&yc(),_(S)));var A;if(s?A=()=>{var B=n[e];return B===void 0?m():(f=!0,B)}:A=()=>{var B=n[e];return B!==void 0&&(h=void 0),B===void 0?h:B},s&&(t&Cc)===0)return A;if(_){var D=n.$$legacy;return(function(B,z){return arguments.length>0?((!s||!z||D||g)&&_(z?A():B),B):A()})}var P=!1,U=((t&Ic)!==0?Ei:ei)(()=>(P=!1,A()));l&&E(U);var W=Qe;return(function(B,z){if(arguments.length>0){const X=z?E(U):s&&l?zt(B):B;return xe(U,X),P=!0,h!==void 0&&(h=X),B}return _r&&P||(W.f&mr)!==0?U.v:E(U)})}function Ai(n){Et===null&&Pl(),Qr&&Et.l!==null?xd(Et).m.push(n):Yr(()=>{const e=yr(n);if(typeof e=="function")return e})}function Rd(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function jd(){const n=Et;return n===null&&Pl(),(e,t,r)=>{const s=n.s.$$events?.[e];if(s){const l=ki(s)?s.slice():[s],u=Rd(e,t,r);for(const h of l)h.call(n.x,u);return!u.defaultPrevented}return!0}}function xd(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Od="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Od);$c();const x=zt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Ft={get currentDialogue(){return x.data?.dialogues.find(n=>n.id===x.selectedDialogueId)},get currentChapter(){return x.data?.chapters?.find(n=>n.id===x.selectedChapterId)},get currentEditingOption(){return Ft.currentDialogue&&x.editingOptionIndex!==null?Ft.currentDialogue.options?.[x.editingOptionIndex]:void 0},get chapterDialogues(){return!x.data?.dialogues||!x.selectedChapterId?[]:x.data.dialogues.filter(n=>n.chapterId===x.selectedChapterId)},get imageResources(){return x.storedFiles.filter(n=>n.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return x.storedFiles.filter(n=>n.name.endsWith(".riv"))},get availableItems(){return x.data?.items||[]},get backlinks(){return!x.data||!x.selectedDialogueId?[]:x.data.dialogues.filter(n=>n.nextDialogueId===x.selectedDialogueId?!0:n.options?n.options.some(e=>e.nextDialogueId===x.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},pt={toggleEditor(){x.showEditor=!x.showEditor},toggleItemsPanel(){x.showItems=!x.showItems},setStatus(n,e){x.statusMessage={type:n,text:e}},clearStatus(){x.statusMessage={type:"",text:""}},selectBucket(n){x.selectedBucket=n,x.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},x.storedFiles=[],x.storiesList=[],x.selectedChapterId=null,x.selectedDialogueId=null},updateBucketsList(n){x.availableBuckets=n},selectChapter(n){x.selectedChapterId=n,x.selectedDialogueId=null},selectDialogue(n){x.selectedDialogueId=n},selectOption(n){x.editingOptionIndex=n},selectItem(n){x.editingItemIndex=n},updateStoryData(n){x.data=n},updateStoredFiles(n){x.storedFiles=n},updateStoriesList(n){x.storiesList=n},setCurrentFileName(n){x.currentFileName=n},addDialogue(n){x.data.dialogues=[...x.data.dialogues,n]},updateDialogue(n,e){x.data.dialogues=x.data.dialogues.map(t=>t.id===n?{...t,...e}:t)},deleteDialogue(n){x.data.dialogues=x.data.dialogues.filter(e=>e.id!==n),x.selectedDialogueId===n&&(x.selectedDialogueId=null)},addChapter(n){x.data.chapters=[...x.data.chapters,n]},updateChapter(n,e){x.data.chapters=x.data.chapters.map(t=>t.id===n?{...t,...e}:t)},deleteChapter(n){x.data.chapters=x.data.chapters.filter(e=>e.id!==n),x.selectedChapterId===n&&(x.selectedChapterId=null,x.selectedDialogueId=null)},addItem(n){x.data.items=[...x.data.items||[],n]},updateItem(n,e){x.data.items&&(x.data.items=x.data.items.map(t=>t.id===n?{...t,...e}:t))},deleteItem(n){x.data.items&&(x.data.items=x.data.items.filter(e=>e.id!==n))},reset(){x.showEditor=!1,x.showItems=!1,x.editingOptionIndex=null,x.editingItemIndex=null,x.selectedChapterId=null,x.selectedDialogueId=null,x.statusMessage={type:"",text:""}}},Md="modulepreload",Ld=function(n,e){return new URL(n,e).href},Qo={},Ci=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let m=function(_){return Promise.all(_.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");s=m(t.map(_=>{if(_=Ld(_,r),_ in Qo)return;Qo[_]=!0;const b=_.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(!!r)for(let D=u.length-1;D>=0;D--){const P=u[D];if(P.href===_&&(!b||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${S}`))return;const A=document.createElement("link");if(A.rel=b?"stylesheet":Md,b||(A.as="script"),A.crossOrigin="",A.href=_,f&&A.setAttribute("nonce",f),document.head.appendChild(A),b)return new Promise((D,P)=>{A.addEventListener("load",D),A.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Dd=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ci(async()=>{const{default:r}=await Promise.resolve().then(()=>ti);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Na extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class $d extends Na{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Zo extends Na{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class el extends Na{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var pa;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(pa||(pa={}));var Fd=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Ud{constructor(e,{headers:t={},customFetch:r,region:s=pa.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Dd(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Fd(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:u}=t;let h={},{region:f}=t;f||(f=this.region);const m=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let _;u&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(h["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(h["Content-Type"]="application/json",_=JSON.stringify(u)));const b=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:_}).catch(D=>{throw new $d(D)}),S=b.headers.get("x-relay-error");if(S&&S==="true")throw new Zo(b);if(!b.ok)throw new el(b);let g=((r=b.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),A;return g==="application/json"?A=yield b.json():g==="application/octet-stream"?A=yield b.blob():g==="text/event-stream"?A=b:g==="multipart/form-data"?A=yield b.formData():A=yield b.text(),{data:A,error:null,response:b}}catch(s){return{data:null,error:s,response:s instanceof el||s instanceof Zo?s.context:void 0}}})}}function Nd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Bd(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Ot={},Tr={},Pr={},Rr={},jr={},xr={},Wd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Jr=Wd();const Vd=Jr.fetch,hu=Jr.fetch.bind(Jr),fu=Jr.Headers,qd=Jr.Request,zd=Jr.Response,ti=Object.freeze(Object.defineProperty({__proto__:null,Headers:fu,Request:qd,Response:zd,default:hu,fetch:Vd},Symbol.toStringTag,{value:"Module"})),Hd=Bd(ti);var Zi={},tl;function vu(){if(tl)return Zi;tl=1,Object.defineProperty(Zi,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Zi.default=n,Zi}var nl;function pu(){if(nl)return xr;nl=1;var n=xr&&xr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(xr,"__esModule",{value:!0});const e=n(Hd),t=n(vu());class r{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let f=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var _,b,S,g;let A=null,D=null,P=null,U=m.status,W=m.statusText;if(m.ok){if(this.method!=="HEAD"){const L=await m.text();L===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?D=L:D=JSON.parse(L))}const z=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),X=(S=m.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");z&&X&&X.length>1&&(P=parseInt(X[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(D)&&(D.length>1?(A={code:"PGRST116",details:`Results contain ${D.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},D=null,P=null,U=406,W="Not Acceptable"):D.length===1?D=D[0]:D=null)}else{const z=await m.text();try{A=JSON.parse(z),Array.isArray(A)&&m.status===404&&(D=[],A=null,U=200,W="OK")}catch{m.status===404&&z===""?(U=204,W="No Content"):A={message:z}}if(A&&this.isMaybeSingle&&(!((g=A?.details)===null||g===void 0)&&g.includes("0 rows"))&&(A=null,U=200,W="OK"),A&&this.shouldThrowOnError)throw new t.default(A)}return{error:A,data:D,count:P,status:U,statusText:W}});return this.shouldThrowOnError||(f=f.catch(m=>{var _,b,S;return{error:{message:`${(_=m?.name)!==null&&_!==void 0?_:"FetchError"}: ${m?.message}`,details:`${(b=m?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(S=m?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),f.then(l,u)}returns(){return this}overrideTypes(){return this}}return xr.default=r,xr}var rl;function gu(){if(rl)return jr;rl=1;var n=jr&&jr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(jr,"__esModule",{value:!0});const e=n(pu());class t extends e.default{select(s){let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:f=h}={}){const m=f?`${f}.order`:"order",_=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${_?`${_},`:""}${s}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:u,referencedTable:h=u}={}){const f=typeof h>"u"?"offset":`${h}.offset`,m=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(f,`${s}`),this.url.searchParams.set(m,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:f=!1,format:m="text"}={}){var _;const b=[s?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,f?"wal":null].filter(Boolean).join("|"),S=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${S}"; options=${b};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return jr.default=t,jr}var il;function Ba(){if(il)return Rr;il=1;var n=Rr&&Rr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=n(gu());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const m=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${m}.${l}`),this}match(s){return Object.entries(s).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(s,l,u){return this.url.searchParams.append(s,`not.${l}.${u}`),this}or(s,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,u){return this.url.searchParams.append(s,`${l}.${u}`),this}}return Rr.default=t,Rr}var sl;function mu(){if(sl)return Pr;sl=1;var n=Pr&&Pr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Pr,"__esModule",{value:!0});const e=n(Ba());class t{constructor(s,{headers:l={},schema:u,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(s,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let f=!1;const m=(s??"*").split("").map(_=>/\s/.test(_)&&!f?"":(_==='"'&&(f=!f),_)).join("");return this.url.searchParams.set("select",m),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:u=!0}={}){var h;const f="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((_,b)=>_.concat(Object.keys(b)),[]);if(m.length>0){const _=[...new Set(m)].map(b=>`"${b}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:f=!0}={}){var m;const _="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const b=s.reduce((S,g)=>S.concat(Object.keys(g)),[]);if(b.length>0){const S=[...new Set(b)].map(g=>`"${g}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(s,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:s}={}){var l;const u="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Pr.default=t,Pr}var al;function Gd(){if(al)return Tr;al=1;var n=Tr&&Tr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Tr,"__esModule",{value:!0});const e=n(mu()),t=n(Ba());class r{constructor(l,{headers:u={},schema:h,fetch:f}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=f}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:f=!1,count:m}={}){var _;let b;const S=new URL(`${this.url}/rpc/${l}`);let g;h||f?(b=h?"HEAD":"GET",Object.entries(u).filter(([D,P])=>P!==void 0).map(([D,P])=>[D,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([D,P])=>{S.searchParams.append(D,P)})):(b="POST",g=u);const A=new Headers(this.headers);return m&&A.set("Prefer",`count=${m}`),new t.default({method:b,url:S,headers:A,schema:this.schemaName,body:g,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return Tr.default=r,Tr}var ol;function Kd(){if(ol)return Ot;ol=1;var n=Ot&&Ot.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.PostgrestError=Ot.PostgrestBuilder=Ot.PostgrestTransformBuilder=Ot.PostgrestFilterBuilder=Ot.PostgrestQueryBuilder=Ot.PostgrestClient=void 0;const e=n(Gd());Ot.PostgrestClient=e.default;const t=n(mu());Ot.PostgrestQueryBuilder=t.default;const r=n(Ba());Ot.PostgrestFilterBuilder=r.default;const s=n(gu());Ot.PostgrestTransformBuilder=s.default;const l=n(pu());Ot.PostgrestBuilder=l.default;const u=n(vu());return Ot.PostgrestError=u.default,Ot.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:u.default},Ot}var Yd=Kd();const Jd=Nd(Yd),{PostgrestClient:Xd,PostgrestQueryBuilder:Vp,PostgrestFilterBuilder:qp,PostgrestTransformBuilder:zp,PostgrestBuilder:Hp,PostgrestError:Gp}=Jd;class Qd{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Zd="2.15.1",eh=`realtime-js/${Zd}`,th="1.0.0",ga=1e4,nh=1e3,rh=100;var pi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(pi||(pi={}));var Tt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Tt||(Tt={}));var vn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(vn||(vn={}));var ma;(function(n){n.websocket="websocket"})(ma||(ma={}));var ur;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ur||(ur={}));class ih{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=r.decode(e.slice(u,u+s));u=u+s;const f=r.decode(e.slice(u,u+l));u=u+l;const m=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:f,payload:m}}}class _u{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ft;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ft||(ft={}));const ll=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,u)=>(l[u]=sh(u,n,e,s),l),{})},sh=(n,e,t,r)=>{const s=e.find(h=>h.name===n),l=s?.type,u=t[n];return l&&!r.includes(l)?yu(l,u):_a(u)},yu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return uh(e,t)}switch(n){case ft.bool:return ah(e);case ft.float4:case ft.float8:case ft.int2:case ft.int4:case ft.int8:case ft.numeric:case ft.oid:return oh(e);case ft.json:case ft.jsonb:return lh(e);case ft.timestamp:return ch(e);case ft.abstime:case ft.date:case ft.daterange:case ft.int4range:case ft.int8range:case ft.money:case ft.reltime:case ft.text:case ft.time:case ft.timestamptz:case ft.timetz:case ft.tsrange:case ft.tstzrange:return _a(e);default:return _a(e)}},_a=n=>n,ah=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},oh=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},lh=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},uh=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const u=n.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>yu(e,h))}return n},ch=n=>typeof n=="string"?n.replace(" ","T"):n,wu=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Qs{constructor(e,t,r={},s=ga){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ul;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ul||(ul={}));class gi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=gi.syncState(this.state,s,l,u),this.pendingDiffs.forEach(f=>{this.state=gi.syncDiff(this.state,f,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(r.diff,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=gi.syncDiff(this.state,s,l,u),h())}),this.onJoin((s,l,u)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:u})}),this.onLeave((s,l,u)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const l=this.cloneDeep(e),u=this.transformState(t),h={},f={};return this.map(l,(m,_)=>{u[m]||(f[m]=_)}),this.map(u,(m,_)=>{const b=l[m];if(b){const S=_.map(P=>P.presence_ref),g=b.map(P=>P.presence_ref),A=_.filter(P=>g.indexOf(P.presence_ref)<0),D=b.filter(P=>S.indexOf(P.presence_ref)<0);A.length>0&&(h[m]=A),D.length>0&&(f[m]=D)}else h[m]=_}),this.syncDiff(l,{joins:h,leaves:f},r,s)}static syncDiff(e,t,r,s){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(l,(h,f)=>{var m;const _=(m=e[h])!==null&&m!==void 0?m:[];if(e[h]=this.cloneDeep(f),_.length>0){const b=e[h].map(g=>g.presence_ref),S=_.filter(g=>b.indexOf(g.presence_ref)<0);e[h].unshift(...S)}r(h,_,f)}),this.map(u,(h,f)=>{let m=e[h];if(!m)return;const _=f.map(b=>b.presence_ref);m=m.filter(b=>_.indexOf(b.presence_ref)<0),e[h]=m,s(h,m,f),m.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var cl;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(cl||(cl={}));var mi;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(mi||(mi={}));var Mn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Mn||(Mn={}));class Wa{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Tt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Qs(this,vn.join,this.params,this.timeout),this.rejoinTimer=new _u(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Tt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Tt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(vn.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new gi(this),this.broadcastEndpointURL=wu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Tt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,f=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(S=>S.filter))!==null&&s!==void 0?s:[],m=!!this.bindings[mi.PRESENCE]&&this.bindings[mi.PRESENCE].length>0,_={},b={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(S=>e?.(Mn.CHANNEL_ERROR,S)),this._onClose(()=>e?.(Mn.CLOSED)),this.updateJoinPayload(Object.assign({config:b},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var g;if(this.socket.setAuth(),S===void 0){e?.(Mn.SUBSCRIBED);return}else{const A=this.bindings.postgres_changes,D=(g=A?.length)!==null&&g!==void 0?g:0,P=[];for(let U=0;U<D;U++){const W=A[U],{filter:{event:B,schema:z,table:X,filter:L}}=W,N=S&&S[U];if(N&&N.event===B&&N.schema===z&&N.table===X&&N.filter===L)P.push(Object.assign(Object.assign({},W),{id:N.id}));else{this.unsubscribe(),this.state=Tt.errored,e?.(Mn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e(Mn.SUBSCRIBED);return}}).receive("error",S=>{this.state=Tt.errored,e?.(Mn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.(Mn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===Tt.joined&&e===mi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=m.body)===null||s===void 0?void 0:s.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,f;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),m.receive("ok",()=>l("ok")),m.receive("error",()=>l("error")),m.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Tt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(vn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Qs(this,vn.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Tt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,l=setTimeout(()=>s.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Qs(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>rh){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,l;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:m,join:_}=vn;if(r&&[h,f,m,_].indexOf(u)>=0&&r!==this._joinRef())return;let S=this._onMessage(u,t,r);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var A,D,P;return((A=g.filter)===null||A===void 0?void 0:A.event)==="*"||((P=(D=g.filter)===null||D===void 0?void 0:D.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===u}).map(g=>g.callback(S,r)):(l=this.bindings[u])===null||l===void 0||l.filter(g=>{var A,D,P,U,W,B;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in g){const z=g.id,X=(A=g.filter)===null||A===void 0?void 0:A.event;return z&&((D=t.ids)===null||D===void 0?void 0:D.includes(z))&&(X==="*"||X?.toLocaleLowerCase()===((P=t.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const z=(W=(U=g?.filter)===null||U===void 0?void 0:U.event)===null||W===void 0?void 0:W.toLocaleLowerCase();return z==="*"||z===((B=t?.event)===null||B===void 0?void 0:B.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===u}).map(g=>{if(typeof S=="object"&&"ids"in S){const A=S.data,{schema:D,table:P,commit_timestamp:U,type:W,errors:B}=A;S=Object.assign(Object.assign({},{schema:D,table:P,commit_timestamp:U,eventType:W,new:{},old:{},errors:B}),this._getPayloadRecords(A))}g.callback(S,r)})}_isClosed(){return this.state===Tt.closed}_isJoined(){return this.state===Tt.joined}_isJoining(){return this.state===Tt.joining}_isLeaving(){return this.state===Tt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Wa.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(vn.close,{},e)}_onError(e){this._on(vn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Tt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ll(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ll(e.columns,e.old_record)),t}}const dl=()=>{},es={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},dh=[1e3,2e3,5e3,1e4],hh=1e4,fh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class vh{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ga,this.transport=null,this.heartbeatIntervalMs=es.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=dl,this.ref=0,this.reconnectTimer=null,this.logger=dl,this.conn=null,this.sendBuffer=[],this.serializer=new ih,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...u)=>Ci(async()=>{const{default:h}=await Promise.resolve().then(()=>ti);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ma.websocket}`,this.httpEndpoint=wu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Qd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:th}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case pi.connecting:return ur.Connecting;case pi.open:return ur.Open;case pi.closing:return ur.Closing;default:return ur.Closed}}isConnected(){return this.connectionState()===ur.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===r);if(s)return s;{const l=new Wa(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:s,ref:l}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${t} ${r} (${l})`,s),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(nh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},es.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:l,ref:u}=t,h=u?`(${u})`:"",f=l.status||"";this.log("receive",`${f} ${r} ${s} ${h}`.trim(),l),this.channels.filter(m=>m._isMember(r)).forEach(m=>m._trigger(s,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(vn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([fh],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:eh};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(vn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new _u(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},es.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,l,u,h,f,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:ga,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:es.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>dh[_-1]||hh),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((_,b)=>b(JSON.stringify(_))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Va extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Pt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class ph extends Va{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ya extends Va{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var gh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const bu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ci(async()=>{const{default:r}=await Promise.resolve().then(()=>ti);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},mh=()=>gh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ci(()=>Promise.resolve().then(()=>ti),void 0,import.meta.url)).Response:Response}),wa=n=>{if(Array.isArray(n))return n.map(t=>wa(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=wa(r)}),e},_h=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var kr=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const Zs=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),yh=(n,e,t)=>kr(void 0,void 0,void 0,function*(){const r=yield mh();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{const l=n.status||500,u=s?.statusCode||l+"";e(new ph(Zs(s),l,u))}).catch(s=>{e(new ya(Zs(s),s))}):e(new ya(Zs(n),n))}),wh=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"||!r?s:(_h(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r)):s.body=r,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Ti(n,e,t,r,s,l){return kr(this,void 0,void 0,function*(){return new Promise((u,h)=>{n(t,wh(e,r,s,l)).then(f=>{if(!f.ok)throw f;return r?.noResolveJson?f:f.json()}).then(f=>u(f)).catch(f=>yh(f,h,r))})})}function vs(n,e,t,r){return kr(this,void 0,void 0,function*(){return Ti(n,"GET",e,t,r)})}function kn(n,e,t,r,s){return kr(this,void 0,void 0,function*(){return Ti(n,"POST",e,r,s,t)})}function ba(n,e,t,r,s){return kr(this,void 0,void 0,function*(){return Ti(n,"PUT",e,r,s,t)})}function bh(n,e,t,r){return kr(this,void 0,void 0,function*(){return Ti(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function ku(n,e,t,r,s){return kr(this,void 0,void 0,function*(){return Ti(n,"DELETE",e,r,s,t)})}var Vt=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const kh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},hl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Sh{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=bu(s)}uploadOrUpdate(e,t,r,s){return Vt(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},hl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f))):(l=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const m=this._removeEmptyFolders(t),_=this._getFinalPath(m),b=yield(e=="PUT"?ba:kn)(this.fetch,`${this.url}/object/${_}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:m,id:b.Id,fullPath:b.Key},error:null}}catch(l){if(Pt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return Vt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Vt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let f;const m=Object.assign({upsert:hl.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&r instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",r)):typeof FormData<"u"&&r instanceof FormData?(f=r,f.append("cacheControl",m.cacheControl)):(f=r,_["cache-control"]=`max-age=${m.cacheControl}`,_["content-type"]=m.contentType);const b=yield ba(this.fetch,h.toString(),f,{headers:_});return{data:{path:l,fullPath:b.Key},error:null}}catch(f){if(Pt(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return Vt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield kn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new Va("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}update(e,t,r){return Vt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Vt(this,void 0,void 0,function*(){try{return{data:yield kn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}copy(e,t,r){return Vt(this,void 0,void 0,function*(){try{return{data:{path:(yield kn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return Vt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield kn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Vt(this,void 0,void 0,function*(){try{const s=yield kn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}download(e,t){return Vt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield vs(this.fetch,`${this.url}/${s}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Pt(h))return{data:null,error:h};throw h}})}info(e){return Vt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield vs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:wa(r),error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}exists(e){return Vt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield bh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Pt(r)&&r instanceof ya){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&s.push(f);let m=s.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${r}${m}`)}}}remove(e){return Vt(this,void 0,void 0,function*(){try{return{data:yield ku(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}list(e,t,r){return Vt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},kh),t),{prefix:e||""});return{data:yield kn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}listV2(e,t){return Vt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield kn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Eh="2.11.0",Ih={"X-Client-Info":`storage-js/${Eh}`};var Or=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Ah{constructor(e,t={},r,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Ih),t),this.fetch=bu(r)}listBuckets(){return Or(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Pt(e))return{data:null,error:e};throw e}})}getBucket(e){return Or(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Or(this,void 0,void 0,function*(){try{return{data:yield kn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Or(this,void 0,void 0,function*(){try{return{data:yield ba(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Or(this,void 0,void 0,function*(){try{return{data:yield kn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Or(this,void 0,void 0,function*(){try{return{data:yield ku(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}}class Ch extends Ah{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Sh(this.url,this.headers,e,this.fetch)}}const Th="2.56.0";let fi="";typeof Deno<"u"?fi="deno":typeof document<"u"?fi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?fi="react-native":fi="node";const Ph={"X-Client-Info":`supabase-js-${fi}/${Th}`},Rh={headers:Ph},jh={schema:"public"},xh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Oh={};var Mh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const Lh=n=>{let e;return n?e=n:typeof fetch>"u"?e=hu:e=fetch,(...t)=>e(...t)},Dh=()=>typeof Headers>"u"?fu:Headers,$h=(n,e,t)=>{const r=Lh(t),s=Dh();return(l,u)=>Mh(void 0,void 0,void 0,function*(){var h;const f=(h=yield e())!==null&&h!==void 0?h:n;let m=new s(u?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),r(l,Object.assign(Object.assign({},u),{headers:m}))})};var Fh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};function Uh(n){return n.endsWith("/")?n:n+"/"}function Nh(n,e){var t,r;const{db:s,auth:l,realtime:u,global:h}=n,{db:f,auth:m,realtime:_,global:b}=e,S={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},m),l),realtime:Object.assign(Object.assign({},_),u),storage:{},global:Object.assign(Object.assign(Object.assign({},b),h),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(r=h?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Fh(this,void 0,void 0,function*(){return""})};return n.accessToken?S.accessToken=n.accessToken:delete S.accessToken,S}const Su="2.71.1",Ur=30*1e3,ka=3,ea=ka*Ur,Bh="http://localhost:9999",Wh="supabase.auth.token",Vh={"X-Client-Info":`gotrue-js/${Su}`},Sa="X-Supabase-Api-Version",Eu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},qh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,zh=600*1e3;class qa extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Le(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Hh extends qa{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Gh(n){return Le(n)&&n.name==="AuthApiError"}class Iu extends qa{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Xn extends qa{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Vn extends Xn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Kh(n){return Le(n)&&n.name==="AuthSessionMissingError"}class ts extends Xn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ns extends Xn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class rs extends Xn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Yh(n){return Le(n)&&n.name==="AuthImplicitGrantRedirectError"}class fl extends Xn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ea extends Xn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ta(n){return Le(n)&&n.name==="AuthRetryableFetchError"}class vl extends Xn{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Ia extends Xn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ps="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),pl=` 	
\r=`.split(""),Jh=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<pl.length;e+=1)n[pl[e].charCodeAt(0)]=-2;for(let e=0;e<ps.length;e+=1)n[ps[e].charCodeAt(0)]=e;return n})();function gl(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ps[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ps[r]),e.queuedBits-=6}}function Au(n,e,t){const r=Jh[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function ml(n){const e=[],t=u=>{e.push(String.fromCodePoint(u))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=u=>{Zh(u,r,t)};for(let u=0;u<n.length;u+=1)Au(n.charCodeAt(u),s,l);return e.join("")}function Xh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Qh(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Xh(r,e)}}function Zh(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ef(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)Au(n.charCodeAt(s),t,r);return new Uint8Array(e)}function tf(n){const e=[];return Qh(n,t=>e.push(t)),new Uint8Array(e)}function nf(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>gl(s,t,r)),gl(null,t,r),e.join("")}function rf(n){return Math.round(Date.now()/1e3)+n}function sf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const fn=()=>typeof window<"u"&&typeof document<"u",ir={tested:!1,writable:!1},Cu=()=>{if(!fn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ir.tested)return ir.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ir.tested=!0,ir.writable=!0}catch{ir.tested=!0,ir.writable=!1}return ir.writable};function af(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Tu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ci(async()=>{const{default:r}=await Promise.resolve().then(()=>ti);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},of=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Nr=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},sr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Wn=async(n,e)=>{await n.removeItem(e)};class Cs{constructor(){this.promise=new Cs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Cs.promiseConstructor=Promise;function na(n){const e=n.split(".");if(e.length!==3)throw new Ia("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!qh.test(e[r]))throw new Ia("JWT not in base64url format");return{header:JSON.parse(ml(e[0])),payload:JSON.parse(ml(e[1])),signature:ef(e[2]),raw:{header:e[0],payload:e[1]}}}async function lf(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function uf(n,e){return new Promise((r,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await n(l);if(!e(l,null,u)){r(u);return}}catch(u){if(!e(l,u)){s(u);return}}})()})}function cf(n){return("0"+n.toString(16)).substr(-2)}function df(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,cf).join("")}async function hf(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function ff(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await hf(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Mr(n,e,t=!1){const r=df();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Nr(n,`${e}-code-verifier`,s);const l=await ff(r);return[l,r===l?"plain":"s256"]}const vf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function pf(n){const e=n.headers.get(Sa);if(!e||!e.match(vf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function gf(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function mf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const _f=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Lr(n){if(!_f.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ra(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function _l(n){return JSON.parse(JSON.stringify(n))}var yf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const or=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),wf=[502,503,504];async function yl(n){var e;if(!of(n))throw new Ea(or(n),0);if(wf.includes(n.status))throw new Ea(or(n),n.status);let t;try{t=await n.json()}catch(l){throw new Iu(or(l),l)}let r;const s=pf(n);if(s&&s.getTime()>=Eu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new vl(or(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Vn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new vl(or(t),n.status,t.weak_password.reasons);throw new Hh(or(t),n.status||500,r)}const bf=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function qe(n,e,t,r){var s;const l=Object.assign({},r?.headers);l[Sa]||(l[Sa]=Eu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const u=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await kf(n,e,t+h,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(f):{data:Object.assign({},f),error:null}}async function kf(n,e,t,r,s,l){const u=bf(e,r,s,l);let h;try{h=await n(t,Object.assign({},u))}catch(f){throw console.error(f),new Ea(or(f),0)}if(h.ok||await yl(h),r?.noResolveJson)return h;try{return await h.json()}catch(f){await yl(f)}}function On(n){var e;let t=null;Af(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=rf(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function wl(n){const e=On(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function qn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Sf(n){return{data:n,error:null}}function Ef(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l}=n,u=yf(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function If(n){return n}function Af(n){return n.access_token&&n.refresh_token&&n.expires_in}const ia=["global","local","others"];var Cf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Tf{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Tu(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ia[0]){if(ia.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ia.join(", ")}`);try{return await qe(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await qe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:qn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Cf(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await qe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ef,redirectTo:t?.redirectTo})}catch(t){if(Le(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await qe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:qn})}catch(t){if(Le(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,l,u,h,f;try{const m={nextPage:null,lastPage:0,total:0},_=await qe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:If});if(_.error)throw _.error;const b=await _.json(),S=(u=_.headers.get("x-total-count"))!==null&&u!==void 0?u:0,g=(f=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return g.length>0&&(g.forEach(A=>{const D=parseInt(A.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(A.split(";")[1].split("=")[1]);m[`${P}Page`]=D}),m.total=parseInt(S)),{data:Object.assign(Object.assign({},b),m),error:null}}catch(m){if(Le(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){Lr(e);try{return await qe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:qn})}catch(t){if(Le(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Lr(e);try{return await qe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:qn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Lr(e);try{return await qe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:qn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Lr(e.userId);try{const{data:t,error:r}=await qe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(Le(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Lr(e.userId),Lr(e.id);try{return{data:await qe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}}}function bl(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Pf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Dr={debug:!!(globalThis&&Cu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Pu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Rf extends Pu{}async function jf(n,e,t){Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Rf(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Dr.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Pf();const xf={url:Bh,storageKey:Wh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function kl(n,e,t){return await t()}const $r={};class bi{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=bi.nextInstanceID,bi.nextInstanceID+=1,this.instanceID>0&&fn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},xf),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Tf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Tu(s.fetch),this.lock=s.lock||kl,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:fn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=jf:this.lock=kl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Cu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=bl(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=bl(this.memoryStorage)),fn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=$r[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){$r[this.storageKey]=Object.assign(Object.assign({},$r[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=$r[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){$r[this.storageKey]=Object.assign(Object.assign({},$r[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Su}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=af(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),fn()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Yh(l)){const f=(e=l.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Le(t)?{error:t}:{error:new Iu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const l=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:On}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(Le(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,s;try{let l;if("email"in e){const{email:_,password:b,options:S}=e;let g=null,A=null;this.flowType==="pkce"&&([g,A]=await Mr(this.storage,this.storageKey)),l=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:_,password:b,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:g,code_challenge_method:A},xform:On})}else if("phone"in e){const{phone:_,password:b,options:S}=e;l=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:b,data:(r=S?.data)!==null&&r!==void 0?r:{},channel:(s=S?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:On})}else throw new ns("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(Le(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await qe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wl})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await qe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wl})}else throw new ns("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ts}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(Le(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,l,u,h,f,m,_,b,S,g;let A,D;if("message"in e)A=e.message,D=e.signature;else{const{chain:P,wallet:U,statement:W,options:B}=e;let z;if(fn())if(typeof U=="object")z=U;else{const L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))z=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!B?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=U}const X=new URL((t=B?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const L=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},B?.signInWithSolana),{version:"1",domain:X.host,uri:X.href}),W?{statement:W}:null));let N;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")N=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)N=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)A=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),D=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");A=[`${X.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...W?["",W,""]:[""],"Version: 1",`URI: ${X.href}`,`Issued At: ${(s=(r=B?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=B?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${B.signInWithSolana.notBefore}`]:[],...!((u=B?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${B.signInWithSolana.expirationTime}`]:[],...!((h=B?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${B.signInWithSolana.chainId}`]:[],...!((f=B?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${B.signInWithSolana.nonce}`]:[],...!((m=B?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${B.signInWithSolana.requestId}`]:[],...!((b=(_=B?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||b===void 0)&&b.length?["Resources",...B.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);const L=await z.signMessage(new TextEncoder().encode(A),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");D=L}}try{const{data:P,error:U}=await qe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:A,signature:nf(D)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:On});if(U)throw U;return!P||!P.session||!P.user?{data:{user:null,session:null},error:new ts}:(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),{data:Object.assign({},P),error:U})}catch(P){if(Le(P))return{data:{user:null,session:null},error:P};throw P}}async _exchangeCodeForSession(e){const t=await sr(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:l,error:u}=await qe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:On});if(await Wn(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new ts}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:u})}catch(l){if(Le(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:l,nonce:u}=e,h=await qe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:On}),{data:f,error:m}=h;return m?{data:{user:null,session:null},error:m}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new ts}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:m})}catch(t){if(Le(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,l,u;try{if("email"in e){const{email:h,options:f}=e;let m=null,_=null;this.flowType==="pkce"&&([m,_]=await Mr(this.storage,this.storageKey));const{error:b}=await qe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(r=f?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:_},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:h,options:f}=e,{data:m,error:_}=await qe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:_}}throw new ns("You must provide either an email or phone number.")}catch(h){if(Le(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,r;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:h}=await qe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:On});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,m=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(s){if(Le(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Mr(this.storage,this.storageKey)),await qe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Sf})}catch(l){if(Le(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Vn;const{error:s}=await qe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Le(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:l}=e,{error:u}=await qe(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:s,options:l}=e,{data:u,error:h}=await qe(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new ns("You must provide either an email or phone number and a type")}catch(t){if(Le(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await sr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ea:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const u=await sr(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ra()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,m,_)=>(!u&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,m,_))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await qe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:qn}):await this._useSession(async t=>{var r,s,l;const{data:u,error:h}=t;if(h)throw h;return!(!((r=u.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vn}:await qe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:qn})})}catch(t){if(Le(t))return Kh(t)&&(await this._removeSession(),await Wn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:l}=r;if(l)throw l;if(!s.session)throw new Vn;const u=s.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await Mr(this.storage,this.storageKey));const{data:m,error:_}=await qe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:qn});if(_)throw _;return u.user=m.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vn;const t=Date.now()/1e3;let r=t,s=!0,l=null;const{payload:u}=na(e.access_token);if(u.exp&&(r=u.exp,s=r<=t),s){const{session:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)throw f;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Le(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Vn;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Le(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!fn())throw new rs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new rs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new fl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new rs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new fl("No code detected.");const{data:W,error:B}=await this._exchangeCodeForSession(e.code);if(B)throw B;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:W.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:l,refresh_token:u,expires_in:h,expires_at:f,token_type:m}=e;if(!l||!h||!u||!m)throw new rs("No session defined in URL");const _=Math.round(Date.now()/1e3),b=parseInt(h);let S=_+b;f&&(S=parseInt(f));const g=S-_;g*1e3<=Ur&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${b}s`);const A=S-b;_-A>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",A,S,_):_-A<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",A,S,_);const{data:D,error:P}=await this._getUser(l);if(P)throw P;const U={provider_token:r,provider_refresh_token:s,access_token:l,expires_in:b,expires_at:S,refresh_token:u,token_type:m,user:D.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:e.type},error:null}}catch(r){if(Le(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await sr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{error:l};const u=(r=s.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Gh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Wn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=sf(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:l},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Mr(this.storage,this.storageKey,!0));try{return await qe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Le(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async l=>{var u,h,f,m,_;const{data:b,error:S}=l;if(S)throw S;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await qe(this.fetch,"GET",g,{headers:this.headers,jwt:(_=(m=b.session)===null||m===void 0?void 0:m.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return fn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Le(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)throw u;return await qe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Le(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await uf(async s=>(s>0&&await lf(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await qe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:On})),(s,l)=>{const u=200*Math.pow(2,s);return l&&ta(l)&&Date.now()+u-r<Ur})}catch(r){if(this._debug(t,"error",r),Le(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),fn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await sr(this.storage,this.storageKey);if(s&&this.userStorage){let u=await sr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:s.user},await Nr(this.userStorage,this.storageKey+"-user",u)),s.user=(e=u?.user)!==null&&e!==void 0?e:ra()}else if(s&&!s.user&&!s.user){const u=await sr(this.storage,this.storageKey+"-user");u&&u?.user?(s.user=u.user,await Wn(this.storage,this.storageKey+"-user"),await Nr(this.storage,this.storageKey,s)):s.user=ra()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ea;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${ea}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:u}=await this._callRefreshToken(s.refresh_token);u&&(console.error(u),ta(u)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(s.access_token);!h&&u?.user?(s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(r,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Vn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Cs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new Vn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),Le(l)){const u={session:null,error:l};return ta(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(f){l.push(f)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Nr(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=_l(s);await Nr(this.storage,this.storageKey,l)}else{const s=_l(t);await Nr(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Wn(this.storage,this.storageKey),await Wn(this.storage,this.storageKey+"-code-verifier"),await Wn(this.storage,this.storageKey+"-user"),this.userStorage&&await Wn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ur);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ur);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ur}ms, refresh threshold is ${ka} ticks`),s<=ka&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Pu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,u]=await Mr(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});s.push(h.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);s.push(l.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await qe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Le(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:m}=await qe(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((s=f?.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(Le(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await qe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(Le(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await qe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Le(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=r.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:r,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=na(s.access_token);let h=null;u.aal&&(h=u.aal);let f=h;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");const _=u.amr||[];return{data:{currentLevel:h,nextLevel:f,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(h=>h.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(h=>h.kid===e),r&&this.jwks_cached_at+zh>s)return r;const{data:l,error:u}=await qe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,r=l.keys.find(h=>h.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:A}=await this.getSession();if(A||!g.session)return{data:null,error:A};r=g.session.access_token}const{header:s,payload:l,signature:u,raw:{header:h,payload:f}}=na(r);t?.allowExpired||gf(l.exp);const m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:l,header:s,signature:u},error:null}}const _=mf(s.alg),b=await crypto.subtle.importKey("jwk",m,_,!0,["verify"]);if(!await crypto.subtle.verify(_,b,u,tf(`${h}.${f}`)))throw new Ia("Invalid JWT signature");return{data:{claims:l,header:s,signature:u},error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}}bi.nextInstanceID=0;const Of=bi;class Mf extends Of{constructor(e){super(e)}}var Lf=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(b){u(b)}}function f(_){try{m(r.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Df{constructor(e,t,r){var s,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Uh(e),f=new URL(h);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const m=`sb-${f.hostname.split(".")[0]}-auth-token`,_={db:jh,realtime:Oh,auth:Object.assign(Object.assign({},xh),{storageKey:m}),global:Rh},b=Nh(r??{},_);this.storageKey=(s=b.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=b.global.headers)!==null&&l!==void 0?l:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(S,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=b.auth)!==null&&u!==void 0?u:{},this.headers,b.global.fetch),this.fetch=$h(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new Xd(new URL("rest/v1",f).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new Ch(this.storageUrl.href,this.headers,this.fetch,r?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Ud(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Lf(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:l,flowType:u,lock:h,debug:f},m,_){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Mf({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:u,lock:h,debug:f,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new vh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const $f=(n,e,t)=>new Df(n,e,t);function Ff(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Ff()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Uf="https://vycjpmuyscfygstjjied.supabase.co",Nf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",En=$f(Uf,Nf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Kn={async loadStoriesList(){if(!x.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${x.selectedBucket}`);const n=`${x.selectedBucket}_story.json`,{data:e,error:t}=await En.storage.from(x.selectedBucket).list("",{search:n});console.log(`[ResourceStore] Проверка файла ${n}:`,{files:e,error:t}),!t&&e&&e.some(r=>r.name===n)?(x.storiesList=[n],console.log(`[ResourceStore] Найден файл: ${n}`)):(x.storiesList=[],console.warn(`[ResourceStore] Файл ${n} не найден`))},async loadStoredResources(){if(!x.selectedBucket){console.warn("No bucket selected");return}const{data:n}=await En.storage.from(x.selectedBucket).list();n&&(x.storedFiles=n.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(n){const e=n.target;if(!e.files||e.files.length===0)return;if(!x.selectedBucket){pt.setStatus("error","Не выбрана история");return}const t=e.files[0];pt.setStatus("loading","Загрузка файла...");const r=await t.arrayBuffer(),s=new Uint8Array(r),{error:l}=await En.storage.from(x.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?pt.setStatus("error","Ошибка загрузки"):(pt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(n){if(!x.selectedBucket){pt.setStatus("error","Не выбрана история");return}const{error:e}=await En.storage.from(x.selectedBucket).remove([n]);e?pt.setStatus("error","Ошибка удаления файла"):(pt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Bf(n){return n.dialogues&&n.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),n.chapters||(n.chapters=[{id:"main",title:"Основная история"}],n.dialogues&&n.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),n.items||(n.items=[]),n.meta||(n.meta={version:"3.1",title:n.title||"Untitled"}),n.miniGames&&Array.isArray(n.miniGames)&&(n.miniGames=n.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),n}function Wf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const dr={async createNewStory(){if(!x.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}const n=prompt("Введите имя файла истории:","new_story.json");if(!n)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1"}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await En.storage.from(x.selectedBucket).upload(n,s,{contentType:"application/json"});l?pt.setStatus("error","Ошибка создания: "+l.message):(await Kn.loadStoriesList(),await this.loadStory(n))},async loadStory(n){if(!x.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${n} из bucket: ${x.selectedBucket}`),pt.setStatus("loading","Загрузка..."),x.currentFileName=n;try{const{data:e,error:t}=await En.storage.from(x.selectedBucket).download(n);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let r;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=En.storage.from(x.selectedBucket).getPublicUrl(n).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);r=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${r.length}`)}else r=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${r.length}`);let s=JSON.parse(r);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Bf(s),console.log("[StoryStore] Присваиваем данные в editor.data"),x.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:x.data.chapters?.length,dialogues:x.data.dialogues?.length}),x.data.chapters&&x.data.chapters.length>0&&(x.selectedChapterId=x.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${x.selectedChapterId}`)),x.data.dialogues&&x.data.dialogues.length>0&&(x.selectedDialogueId=x.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${x.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),pt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),pt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!x.data)return;if(!x.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}pt.setStatus("loading","Сохранение...");const n=JSON.stringify(x.data,null,2);console.log(`[StoryStore] Сохранение файла: ${x.currentFileName}, размер: ${n.length} байт`);const t=new TextEncoder().encode(n),{error:r}=await En.storage.from(x.selectedBucket).update(x.currentFileName,t,{contentType:"application/json"});if(r){console.error("[StoryStore] Ошибка сохранения (update):",r),console.log("[StoryStore] Пробуем upload вместо update");const s=await En.storage.from(x.selectedBucket).upload(x.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),pt.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),pt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),pt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!x.data)return;if(!x.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}const n=x.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${n}_copy_${e}.json`.trim();const r=prompt("Введите имя для копии:",t);if(!r)return;t=r.trim(),t.endsWith(".json")||(t+=".json"),pt.setStatus("loading","Создание копии...");const s=JSON.stringify(x.data,null,2),u=new TextEncoder().encode(s),{error:h}=await En.storage.from(x.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?pt.setStatus("error",`Ошибка копии: ${h.message}`):(await Kn.loadStoriesList(),pt.setStatus("success","Копия сохранена!"))},addChapter(){if(!x.data||!x.data.chapters)return;const n="ch_"+Date.now();x.data.chapters.push({id:n,title:"Новая глава"}),x.selectedChapterId=n},addDialogue(){if(!x.data||!x.selectedChapterId)return;const n="d_"+Date.now();x.data.dialogues.push({id:n,chapterId:x.selectedChapterId,text:"Новый текст...",options:[]}),x.selectedDialogueId=n},deleteDialogue(n){confirm("Удалить диалог "+n+"?")&&x.data&&(x.data.dialogues=x.data.dialogues.filter(e=>e.id!==n),x.data.dialogues.forEach(e=>{e.nextDialogueId===n&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===n&&(t.nextDialogueId="")})}),x.selectedDialogueId===n&&(x.selectedDialogueId=null))},jumpTo(n){const e=x.data?.dialogues.find(t=>t.id===n);e&&(x.selectedChapterId=e.chapterId,x.selectedDialogueId=n)},getLinkType(n,e){return n.nextDialogueId===e?"Auto":"Option"}};var en=br(()=>x),Vf=oe('<button type="button"> </button>'),qf=oe('<button type="button"><span class="id-badge svelte-1s51h91"> </span> <span class="preview-text svelte-1s51h91"> </span></button>'),zf=oe("<div> </div>"),Hf=oe('<aside class="sidebar svelte-1s51h91"><div class="sidebar-section svelte-1s51h91"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-1s51h91"></div></div> <div class="sidebar-section flex-1 svelte-1s51h91"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-1s51h91"></div></div> <div class="status-box svelte-1s51h91"><!></div></aside>');function Gf(n,e){Ht(e,!1),wr();var t=Hf(),r=R(t),s=R(r),l=$(R(s),2);l.__click=function(...P){dr.addChapter?.apply(this,P)};var u=$(s,2);yt(u,5,()=>en().data?.chapters||[],P=>P.id,(P,U)=>{var W=Vf();let B;W.__click=()=>en(en().selectedChapterId=E(U).id);var z=R(W);Te(X=>{B=gn(W,1,"chapter-item svelte-1s51h91",null,B,X),je(W,"aria-pressed",en().selectedChapterId===E(U).id),Pe(z,E(U).title)},[()=>({active:en().selectedChapterId===E(U).id})]),Y(P,W)});var h=$(r,2),f=R(h),m=R(f),_=R(m),b=$(m,2);b.__click=function(...P){dr.addDialogue?.apply(this,P)};var S=$(f,2);yt(S,5,()=>Ft.chapterDialogues,P=>P.id,(P,U)=>{var W=qf();let B;W.__click=()=>en(en().selectedDialogueId=E(U).id);var z=R(W),X=R(z),L=$(z,2),N=R(L);Te((fe,te)=>{B=gn(W,1,"dialogue-item svelte-1s51h91",null,B,fe),je(W,"aria-pressed",en().selectedDialogueId===E(U).id),Pe(X,E(U).id),Pe(N,`${te??""}...`)},[()=>({active:en().selectedDialogueId===E(U).id}),()=>E(U).text.substring(0,25)]),Y(P,W)});var g=$(h,2),A=R(g);{var D=P=>{var U=zf(),W=R(U);Te(()=>{gn(U,1,`alert ${en().statusMessage.type??""}`,"svelte-1s51h91"),Pe(W,en().statusMessage.text)}),Y(P,U)};De(A,P=>{en().statusMessage.text&&P(D)})}Te(()=>{Pe(_,`Сцены (${Ft.chapterDialogues.length??""})`),b.disabled=!en().selectedChapterId}),Y(n,t),Gt()}Xt(["click"]);var Kf=oe("<option> </option>"),Yf=(n,e)=>{n.target.checked&&!e().miniGame&&(e().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""})},Jf=oe("<option> </option>"),Xf=oe("<option> </option>"),Qf=oe("<option> </option>"),Zf=oe('<div class="minigame-details svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option></select></div> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-92kmf5"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-92kmf5"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),ev=(n,e)=>{const t=n.target.value;e({type:t})},tv=oe("<option> </option>"),nv=(n,e)=>e({itemId:n.target.value}),rv=oe("<option> </option>"),iv=oe('<div class="form-group full-width svelte-92kmf5"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),sv=(n,e)=>e({statName:n.target.value}),av=(n,e)=>e({statValue:parseInt(n.target.value)||0}),ov=oe('<div class="form-group svelte-92kmf5"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-92kmf5"><label>Значение ></label> <input type="number" class="input"/></div>',1),lv=(n,e)=>e({flagName:n.target.value}),uv=oe('<div class="form-group full-width svelte-92kmf5"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),cv=oe('<div class="option-details svelte-92kmf5"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-92kmf5"><div class="section-header svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-92kmf5"><div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-92kmf5">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-92kmf5">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-92kmf5"><h5 class="svelte-92kmf5">Условие видимости</h5> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function dv(n,e){Ht(e,!0);const t=As(e,"option",7);function r(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return r(),t().visibilityCondition}function l(le){r(),t().visibilityCondition={...t().visibilityCondition,...le}}var u=cv(),h=R(u),f=R(h),m=$(f,2),_=$(h,2),b=R(_),S=$(b,2),g=R(S);g.value=g.__value="";var A=$(g);yt(A,17,()=>e.dialogues,Bt,(le,we)=>{var re=Kf(),ae=R(re),ke={};Te($e=>{Pe(ae,`${E(we).id??""}: ${$e??""}...`),ke!==(ke=E(we).id)&&(re.value=(re.__value=E(we).id)??"")},[()=>E(we).text.substring(0,30)]),Y(le,re)});var D=$(_,2),P=R(D),U=R(P),W=R(U);W.__change=[Yf,t];var B=$(P,2);{var z=le=>{var we=Zf(),re=R(we),ae=R(re),ke=$(ae,2),$e=R(ke);$e.value=$e.__value="";var ut=$($e);ut.value=ut.__value="onet_monsters";var Ke=$(re,2),ct=R(Ke),rt=R(ct),_t=$(rt,2),kt=R(_t);kt.value=kt.__value="";var gt=$(kt);yt(gt,17,()=>e.dialogues,Bt,(w,I)=>{var M=Jf(),V=R(M),ce={};Te(Se=>{Pe(V,`${E(I).id??""}: ${Se??""}...`),ce!==(ce=E(I).id)&&(M.value=(M.__value=E(I).id)??"")},[()=>E(I).text.substring(0,30)]),Y(w,M)});var G=$(ct,2),ee=R(G),q=$(ee,2),se=R(q);se.value=se.__value="";var ve=$(se);yt(ve,17,()=>e.dialogues,Bt,(w,I)=>{var M=Xf(),V=R(M),ce={};Te(Se=>{Pe(V,`${E(I).id??""}: ${Se??""}...`),ce!==(ce=E(I).id)&&(M.value=(M.__value=E(I).id)??"")},[()=>E(I).text.substring(0,30)]),Y(w,M)});var Ce=$(Ke,2),Ae=R(Ce),p=$(Ae,2),o=R(p);o.value=o.__value="";var d=$(o);yt(d,17,()=>e.availableItems,Bt,(w,I)=>{var M=Qf(),V=R(M),ce={};Te(()=>{Pe(V,E(I).name),ce!==(ce=E(I).id)&&(M.value=(M.__value=E(I).id)??"")}),Y(w,M)}),Te(()=>{je(ae,"for",`option-mg-id-${e.index??""}`),je(ke,"id",`option-mg-id-${e.index??""}`),je(rt,"for",`option-mg-win-${e.index??""}`),je(_t,"id",`option-mg-win-${e.index??""}`),je(ee,"for",`option-mg-lose-${e.index??""}`),je(q,"id",`option-mg-lose-${e.index??""}`),je(Ae,"for",`option-mg-reward-${e.index??""}`),je(p,"id",`option-mg-reward-${e.index??""}`)}),Ln(ke,()=>t().miniGame.id,w=>t().miniGame.id=w),Ln(_t,()=>t().miniGame.onWinDialogueId,w=>t().miniGame.onWinDialogueId=w),Ln(q,()=>t().miniGame.onLoseDialogueId,w=>t().miniGame.onLoseDialogueId=w),Ln(p,()=>t().miniGame.rewardItem,w=>t().miniGame.rewardItem=w),Y(le,we)};De(B,le=>{t().miniGame&&le(z)})}var X=$(D,2),L=R(X),N=R(L),fe=R(N),te=$(L,2),Ee=R(te),J=R(Ee),ne=$(X,2),ye=$(R(ne),2),Re=R(ye),he=R(Re),be=$(he,2);be.__change=[ev,l],yt(be,21,()=>e.conditionTypes,Bt,(le,we)=>{var re=tv(),ae=R(re),ke={};Te(()=>{Pe(ae,E(we)),ke!==(ke=E(we))&&(re.value=(re.__value=E(we))??"")}),Y(le,re)});var me;va(be);var at=$(Re,2);{var ze=le=>{var we=iv(),re=R(we),ae=$(re,2);ae.__change=[nv,l];var ke=R(ae);ke.value=ke.__value="";var $e=$(ke);yt($e,17,()=>e.availableItems,Bt,(Ke,ct)=>{var rt=rv(),_t=R(rt),kt={};Te(()=>{Pe(_t,E(ct).name),kt!==(kt=E(ct).id)&&(rt.value=(rt.__value=E(ct).id)??"")}),Y(Ke,rt)});var ut;va(ae),Te(Ke=>{je(re,"for",`option-cond-item-${e.index??""}`),je(ae,"id",`option-cond-item-${e.index??""}`),ut!==(ut=Ke)&&(ae.value=(ae.__value=Ke)??"",hs(ae,Ke))},[()=>s().itemId||""]),Y(le,we)};De(at,le=>{s().type==="has_item"&&le(ze)})}var Ve=$(at,2);{var ot=le=>{var we=ov(),re=Lt(we),ae=R(re),ke=$(ae,2);ke.__input=[sv,l];var $e=$(re,2),ut=R($e),Ke=$(ut,2);Ke.__input=[av,l],Te((ct,rt)=>{je(ae,"for",`option-cond-stat-${e.index??""}`),je(ke,"id",`option-cond-stat-${e.index??""}`),Ks(ke,ct),je(ut,"for",`option-cond-stat-val-${e.index??""}`),je(Ke,"id",`option-cond-stat-val-${e.index??""}`),Ks(Ke,rt)},[()=>s().statName||"",()=>s().statValue||""]),Y(le,we)};De(Ve,le=>{s().type==="stat_greater"&&le(ot)})}var At=$(Ve,2);{var Oe=le=>{var we=uv(),re=R(we),ae=$(re,2);ae.__input=[lv,l],Te(ke=>{je(re,"for",`option-cond-flag-${e.index??""}`),je(ae,"id",`option-cond-flag-${e.index??""}`),Ks(ae,ke)},[()=>s().flagName||""]),Y(le,we)};De(At,le=>{s().type==="flag_true"&&le(Oe)})}Te(le=>{je(f,"for",`option-text-${e.index??""}`),je(m,"id",`option-text-${e.index??""}`),je(b,"for",`option-next-${e.index??""}`),je(S,"id",`option-next-${e.index??""}`),je(he,"for",`option-cond-type-${e.index??""}`),je(be,"id",`option-cond-type-${e.index??""}`),me!==(me=le)&&(be.value=(be.__value=le)??"",hs(be,le))},[()=>s().type]),cr(m,()=>t().text,le=>t().text=le),Ln(S,()=>t().nextDialogueId,le=>t().nextDialogueId=le),Ys(W,()=>t().miniGame,le=>t().miniGame=le),Ys(fe,()=>t().enabled,le=>t().enabled=le),Ys(J,()=>t().visible,le=>t().visible=le),Y(n,u),Gt()}Xt(["change","input"]);var bt=br(()=>x),st=br(()=>Ft),hv=oe("<option> </option>"),fv=oe("<option> </option>"),vv=oe("<option> </option>"),pv=oe("<option> </option>"),gv=oe('<div class="option-content svelte-1de8com"><!></div>'),mv=oe('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),_v=oe("<option> </option>"),yv=oe('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),wv=oe('<div class="empty-state">Выберите сцену</div>');function bv(n,e){Ht(e,!1);const t=["always","has_item","stat_greater","flag_true"];function r(_){_.options||(_.options=[]);const b=Wf();_.options.push(b),bt(bt().editingOptionIndex=_.options.length-1)}function s(_){if(bt().editingOptionIndex===_)bt(bt().editingOptionIndex=null);else{bt(bt().editingOptionIndex=_);const b=st().currentDialogue?.options?.[_];b&&!b.visibilityCondition&&(b.visibilityCondition={type:"always"})}}function l(_,b){confirm("Удалить вариант ответа?")&&(_.options?.splice(b,1),bt().editingOptionIndex===b?bt(bt().editingOptionIndex=null):bt().editingOptionIndex&&bt().editingOptionIndex>b&&bt(bt().editingOptionIndex--))}wr();var u=Yt(),h=Lt(u);{var f=_=>{var b=yv(),S=R(b),g=$(R(S),2);g.__change=we=>bt(bt().selectedDialogueId=we.target?.value);var A=$(S,2),D=$(R(A),2),P=$(A,2),U=$(R(P),2),W=$(R(U),2),B=R(W);Te(()=>{st(),Sn(()=>{})});var z=R(B);z.value=z.__value="";var X=$(z);yt(X,1,()=>st().imageResources,Bt,(we,re)=>{var ae=hv(),ke=R(ae),$e={};Te(()=>{Pe(ke,E(re).name),$e!==($e=E(re).name)&&(ae.value=(ae.__value=E(re).name)??"")}),Y(we,ae)});var L=$(X);yt(L,1,()=>st().riveResources,Bt,(we,re)=>{var ae=fv(),ke=R(ae),$e={};Te(()=>{Pe(ke,`${E(re).name??""} (Rive)`),$e!==($e=E(re).name)&&(ae.value=(ae.__value=E(re).name)??"")}),Y(we,ae)});var N=$(B,2),fe=$(R(N));fe.__change=function(...we){Kn.uploadNewFile?.apply(this,we)};var te=$(U,2),Ee=$(R(te),2),J=R(Ee);Te(()=>{st(),Sn(()=>{})});var ne=R(J);ne.value=ne.__value="";var ye=$(ne);yt(ye,1,()=>st().imageResources,Bt,(we,re)=>{var ae=vv(),ke=R(ae),$e={};Te(()=>{Pe(ke,E(re).name),$e!==($e=E(re).name)&&(ae.value=(ae.__value=E(re).name)??"")}),Y(we,ae)});var Re=$(ye);yt(Re,1,()=>st().riveResources,Bt,(we,re)=>{var ae=pv(),ke=R(ae),$e={};Te(()=>{Pe(ke,`${E(re).name??""} (Rive)`),$e!==($e=E(re).name)&&(ae.value=(ae.__value=E(re).name)??"")}),Y(we,ae)});var he=$(P,2),be=R(he),me=$(R(be),2);me.__click=()=>r(st().currentDialogue);var at=$(be,2);yt(at,1,()=>st().currentDialogue.options||[],Bt,(we,re,ae)=>{var ke=mv();let $e;var ut=R(ke),Ke=R(ut);Ke.__click=()=>s(ae),Ke.__keydown=ve=>{(ve.key==="Enter"||ve.key===" ")&&(ve.preventDefault(),s(ae))},je(Ke,"aria-controls",`option-content-${ae}`);var ct=R(Ke),rt=R(ct);{var _t=ve=>{var Ce=Hs("👁️‍🗨️");Y(ve,Ce)},kt=ve=>{var Ce=Yt(),Ae=Lt(Ce);{var p=d=>{var w=Hs("🔒");Y(d,w)},o=d=>{var w=Hs("✅");Y(d,w)};De(Ae,d=>{E(re).enabled?d(o,!1):d(p)},!0)}Y(ve,Ce)};De(rt,ve=>{E(re).visible?ve(kt,!1):ve(_t)})}var gt=$(ct,2),G=R(gt),ee=$(Ke,2);ee.__click=()=>l(st().currentDialogue,ae);var q=$(ut,2);{var se=ve=>{var Ce=gv();je(Ce,"id",`option-content-${ae}`);var Ae=R(Ce);dv(Ae,{get option(){return E(re)},index:ae,get dialogues(){return bt().data.dialogues},get availableItems(){return st().availableItems},get conditionTypes(){return t}}),Y(ve,Ce)};De(q,ve=>{bt().editingOptionIndex===ae&&ve(se)})}Te(ve=>{$e=gn(ke,1,"option-card svelte-1de8com",null,$e,ve),je(Ke,"aria-expanded",bt().editingOptionIndex===ae),Pe(G,`#${ae+1} ${E(re).text??""}`)},[()=>({editing:bt().editingOptionIndex===ae})]),Y(we,ke)});var ze=$(he,2),Ve=$(R(ze),2);Te(()=>{st(),Sn(()=>{bt()})});var ot=R(Ve);ot.value=ot.__value="";var At=$(ot);yt(At,1,()=>bt().data.dialogues,Bt,(we,re)=>{var ae=_v(),ke=R(ae),$e={};Te(ut=>{Pe(ke,`${E(re).id??""}: ${ut??""}...`),$e!==($e=E(re).id)&&(ae.value=(ae.__value=E(re).id)??"")},[()=>E(re).text.substring(0,30)]),Y(we,ae)});var Oe=$(ze,2),le=R(Oe);le.__click=()=>dr.deleteDialogue(st().currentDialogue.id),cr(g,()=>st().currentDialogue.id,we=>st(st().currentDialogue.id=we)),cr(D,()=>st().currentDialogue.text,we=>st(st().currentDialogue.text=we)),Ln(B,()=>st().currentDialogue.backgroundImage,we=>st(st().currentDialogue.backgroundImage=we)),Ln(J,()=>st().currentDialogue.characterImage,we=>st(st().currentDialogue.characterImage=we)),Ln(Ve,()=>st().currentDialogue.nextDialogueId,we=>st(st().currentDialogue.nextDialogueId=we)),Y(_,b)},m=_=>{var b=wv();Y(_,b)};De(h,_=>{st().currentDialogue?_(f):_(m,!1)})}Y(n,u),Gt()}Xt(["change","click","keydown"]);var Me=br(()=>x),kv=oe('<img class="icon-preview svelte-asgatj"/>'),Sv=oe('<div class="icon-placeholder svelte-asgatj">📦</div>'),Ev=oe("<option> </option>"),Iv=oe('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Av=oe("<option> </option>"),Cv=oe('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Tv=oe('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),Pv=oe('<div class="items-list svelte-asgatj"></div>'),Rv=oe('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),jv=oe('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),xv=oe('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function Ov(n,e){Ht(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function r(){if(!Me().data)return;Me().data.items||Me(Me().data.items=[]);const P={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Me().data.items.push(P),Me(Me().editingItemIndex=Me().data.items.length-1)}function s(P){Me().editingItemIndex===P?Me(Me().editingItemIndex=null):Me(Me().editingItemIndex=P)}function l(P){confirm("Удалить предмет?")&&Me().data?.items&&(Me().data.items.splice(P,1),Me(Me().editingItemIndex=null))}function u(P){if(!Me().data?.items)return;const U=Me().data.items[P],W={...U,id:`${U.id}_copy_${Date.now()}`,name:`${U.name} (копия)`};Me().data.items.splice(P+1,0,W),Me(Me().editingItemIndex=P+1)}function h(P){return t.find(U=>U.value===P)?.label||P}wr();var f=xv(),m=R(f);m.__click=()=>Me(Me().showItems=!Me().showItems);var _=R(m),b=$(R(_)),S=$(_,2),g=R(S),A=$(m,2);{var D=P=>{var U=jv(),W=R(U);{var B=L=>{var N=Pv();yt(N,7,()=>Me().data.items,fe=>fe.id,(fe,te,Ee)=>{var J=Tv();let ne;var ye=R(J);ye.__click=()=>s(E(Ee));var Re=R(ye),he=R(Re),be=R(he);{var me=gt=>{var G=kv();Te(()=>{je(G,"src",`https://vycjpmuyscfygstjjied.supabase.co/${Me().selectedBucket}/${E(te).icon}`),je(G,"alt",E(te).name)}),Y(gt,G)},at=gt=>{var G=Sv();Y(gt,G)};De(be,gt=>{E(te).icon?gt(me):gt(at,!1)})}var ze=$(he,2),Ve=R(ze),ot=R(Ve),At=$(Ve,2),Oe=R(At),le=R(Oe),we=$(Oe,2);let re;var ae=R(we),ke=$(Re,2),$e=R(ke),ut=$(ye,2),Ke=R(ut);Ke.__click=()=>u(E(Ee));var ct=$(Ke,2);ct.__click=()=>s(E(Ee));var rt=$(ct,2);rt.__click=()=>l(E(Ee));var _t=$(ut,2);{var kt=gt=>{var G=Cv(),ee=R(G),q=R(ee),se=R(q),ve=$(se,2),Ce=$(q,2),Ae=R(Ce),p=$(Ae,2),o=$(Ce,2),d=R(o),w=$(d,2),I=$(o,2),M=R(I),V=$(M,2),ce=R(V),Se=$(ce,2);Se.__change=He=>(E(te).icon=He.target.value,Sn(()=>Me()));var _e=R(Se);_e.value=_e.__value="";var Be=$(_e);yt(Be,1,()=>Me().storedFiles.filter(He=>He.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Bt,(He,Ct)=>{var St=Ev(),Ut=R(St),Ie={};Te(()=>{Pe(Ut,E(Ct).name),Ie!==(Ie=E(Ct).name)&&(St.value=(St.__value=E(Ct).name)??"")}),Y(He,St)});var Ze=$(Se,2),It=$(R(Ze));It.__change=function(...He){Kn.uploadNewFile?.apply(this,He)};var ht=$(V,2);{var Qt=He=>{var Ct=Iv(),St=R(Ct),Ut=$(St,2),Ie=R(Ut);Te(()=>{je(St,"src",`https://vycjpmuyscfygstjjied.supabase.co/${Me().selectedBucket}/${E(te).icon}`),Pe(Ie,E(te).icon)}),Y(He,Ct)};De(ht,He=>{E(te).icon&&He(Qt)})}var Kt=$(I,2),Dt=R(Kt),Rt=$(Dt,2);Te(()=>{E(te),Sn(()=>{E(Ee)})}),yt(Rt,5,()=>t,Bt,(He,Ct)=>{var St=Av(),Ut=R(St),Ie={};Te(()=>{Pe(Ut,E(Ct).label),Ie!==(Ie=E(Ct).value)&&(St.value=(St.__value=E(Ct).value)??"")}),Y(He,St)}),Te(()=>{je(se,"for",`item-id-${E(Ee)??""}`),je(ve,"id",`item-id-${E(Ee)??""}`),je(Ae,"for",`item-name-${E(Ee)??""}`),je(p,"id",`item-name-${E(Ee)??""}`),je(d,"for",`item-desc-${E(Ee)??""}`),je(w,"id",`item-desc-${E(Ee)??""}`),je(M,"for",`item-icon-${E(Ee)??""}`),je(ce,"id",`item-icon-${E(Ee)??""}`),je(Dt,"for",`item-type-${E(Ee)??""}`),je(Rt,"id",`item-type-${E(Ee)??""}`)}),cr(ve,()=>E(te).id,He=>(E(te).id=He,Sn(()=>Me()))),cr(p,()=>E(te).name,He=>(E(te).name=He,Sn(()=>Me()))),cr(w,()=>E(te).description,He=>(E(te).description=He,Sn(()=>Me()))),cr(ce,()=>E(te).icon,He=>(E(te).icon=He,Sn(()=>Me()))),Ln(Rt,()=>E(te).type,He=>(E(te).type=He,Sn(()=>Me()))),Y(gt,G)};De(_t,gt=>{Me().editingItemIndex===E(Ee)&&gt(kt)})}Te((gt,G,ee)=>{ne=gn(J,1,"item-row svelte-asgatj",null,ne,gt),je(ye,"aria-label",`Редактировать предмет ${E(te).name??""}`),Pe(ot,E(te).name),Pe(le,E(te).id),re=gn(we,1,"item-type-badge svelte-asgatj",null,re,G),Pe(ae,ee),Pe($e,`${E(te).description??""} || `)},[()=>({editing:Me().editingItemIndex===E(Ee)}),()=>({tool:E(te).type==="tool",key:E(te).type==="key",consumable:E(te).type==="consumable",quest:E(te).type==="quest",misc:E(te).type==="misc"}),()=>h(E(te).type)]),Y(fe,J)}),Y(L,N)},z=L=>{var N=Rv();Y(L,N)};De(W,L=>{Me().data?.items?.length?L(B):L(z,!1)})}var X=$(W,2);X.__click=r,Y(P,U)};De(A,P=>{Me().showItems&&P(D)})}Te(()=>{je(m,"title",Me().showItems?"Скрыть предметы":"Показать предметы"),je(m,"aria-expanded",Me().showItems),Pe(b,` Предметы (${(Me().data?.items?.length||0)??""})`),Pe(g,Me().showItems?"▼":"▶")}),Y(n,f),Gt()}Xt(["click","change"]);Xt(["click"]);class Mv{#i=lt(zt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return E(this.#i)}set player(e){xe(this.#i,e,!0)}#n=lt(null);get storyData(){return E(this.#n)}set storyData(e){xe(this.#n,e,!0)}#e=lt("0");get currentDialogueId(){return E(this.#e)}set currentDialogueId(e){xe(this.#e,e,!0)}#s=lt(!0);get isLoading(){return E(this.#s)}set isLoading(e){xe(this.#s,e,!0)}#a=lt("");get error(){return E(this.#a)}set error(e){xe(this.#a,e,!0)}#t=lt(null);get selectedStory(){return E(this.#t)}set selectedStory(e){xe(this.#t,e,!0)}#r=lt(zt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return E(this.#r)}set availableStories(e){xe(this.#r,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();this.storyData=r,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const r=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${r}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){return e.visibleIf&&e.visibleIf.hasItem?this.hasItem(e.visibleIf.hasItem):!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const mt=new Mv;var as={exports:{}},Lv=as.exports,Sl;function Dv(){return Sl||(Sl=1,(function(n,e){(function(r,s){n.exports=s()})(Lv,()=>(()=>{var t=[,((u,h,f)=>{f.r(h),f.d(h,{default:()=>_});var m=(()=>{var b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var g=S,A,D;g.ready=new Promise((i,a)=>{A=i,D=a});function P(){function i(C){const O=v;c=a=0,v=new Map,O.forEach(F=>{try{F(C)}catch(j){console.error(j)}}),this.pb(),y&&y.Tb()}let a=0,c=0,v=new Map,y=null,k=null;this.requestAnimationFrame=function(C){a||(a=requestAnimationFrame(i.bind(this)));const O=++c;return v.set(O,C),O},this.cancelAnimationFrame=function(C){v.delete(C),a&&v.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(C){k&&(document.body.remove(k),k=null),C||(k=document.createElement("div"),k.style.backgroundColor="black",k.style.position="fixed",k.style.right=0,k.style.top=0,k.style.color="white",k.style.padding="4px",k.innerHTML="RIVE FPS",C=function(O){k.innerHTML="RIVE FPS "+O.toFixed(1)},document.body.appendChild(k)),y=new function(){let O=0,F=0;this.Tb=function(){var j=performance.now();F?(++O,j-=F,1e3<j&&(C(1e3*O/j),O=F=0)):(F=j,O=0)}}},this.Ob=function(){k&&(document.body.remove(k),k=null),y=null},this.pb=function(){}}function U(i){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(v){return v=v+((1<<i)-1)>>i,a.has(v)&&clearTimeout(a.get(v)),a.set(v,setTimeout(function(){a.delete(v),a.length==0?c=-1/0:v==c&&(c=Math.max(...a.keys()),console.assert(c<v))},1e3)),c=Math.max(v,c),c<<i}}const W=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){W&&W();let i=g.decodeAudio;g.decodeAudio=function(y,k){y=i(y),k(y)};let a=g.decodeFont;g.decodeFont=function(y,k){y=a(y),k(y)};const c=g.FileAssetLoader;g.ptrToAsset=y=>{let k=g.ptrToFileAsset(y);return k.isImage?g.ptrToImageAsset(y):k.isFont?g.ptrToFontAsset(y):k.isAudio?g.ptrToAudioAsset(y):k},g.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:y}){this.__parent.__construct.call(this),this.Gb=y},loadContents:function(y,k){return y=g.ptrToAsset(y),this.Gb(y,k)}}),g.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(y){let k=g.ptrToAsset(y);return y=k.cdnUuid,y===""?!1:((function(C,O){var F=new XMLHttpRequest;F.responseType="arraybuffer",F.onreadystatechange=function(){F.readyState==4&&F.status==200&&O(F)},F.open("GET",C,!0),F.send(null)})(k.cdnBaseUrl+"/"+y,C=>{k.decode(new Uint8Array(C.response))}),!0)}}),g.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(y){this.lb.push(y)},loadContents:function(y,k){for(let C of this.lb)if(C.loadContents(y,k))return!0;return!1}});let v=g.computeAlignment;g.computeAlignment=function(y,k,C,O,F=1){return v.call(this,y,k,C,O,F)}};const B="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function i(){if(!a){let Ue=function(We,ue,vt){if(ue=K.createShader(ue),K.shaderSource(ue,vt),K.compileShader(ue),vt=K.getShaderInfoLog(ue),0<(vt||"").length)throw vt;K.attachShader(We,ue)};var T=document.createElement("canvas"),Q={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let K;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(K=T.getContext("webgl",Q),c=1,!K)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(K=T.getContext("webgl2",Q))c=2;else if(K=T.getContext("webgl",Q))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(K=new Proxy(K,{get(We,ue){if(We.isContextLost()){if(F||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",ue),F=!0),typeof We[ue]=="function")return function(){}}else return typeof We[ue]=="function"?function(...vt){return We[ue].apply(We,vt)}:We[ue]},set(We,ue,vt){if(We.isContextLost())F||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+ue),F=!0);else return We[ue]=vt,!0}}),v=Math.min(K.getParameter(K.MAX_RENDERBUFFER_SIZE),K.getParameter(K.MAX_TEXTURE_SIZE)),T=K.createProgram(),Ue(T,K.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ue(T,K.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),K.bindAttribLocation(T,0,"vertex"),K.bindAttribLocation(T,1,"uv"),K.linkProgram(T),Q=K.getProgramInfoLog(T),0<(Q||"").trim().length)throw Q;y=K.getUniformLocation(T,"mat"),k=K.getUniformLocation(T,"translate"),K.useProgram(T),K.bindBuffer(K.ARRAY_BUFFER,K.createBuffer()),K.enableVertexAttribArray(0),K.enableVertexAttribArray(1),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,K.createBuffer()),K.uniform1i(K.getUniformLocation(T,"image"),0),K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=K}return!0}let a=null,c=0,v=0,y=null,k=null,C=0,O=0,F=!1;i(),this.hc=function(){return i(),v},this.Mb=function(T){a.deleteTexture&&a.deleteTexture(T)},this.Lb=function(T){if(!i())return null;const Q=a.createTexture();return Q?(a.bindTexture(a.TEXTURE_2D,Q),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,T),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),Q):null};const j=new U(8),Z=new U(8),ie=new U(10),pe=new U(10);this.Qb=function(T,Q,K,Ue,We){if(i()){var ue=j.push(T),vt=Z.push(Q);if(a.canvas){(a.canvas.width!=ue||a.canvas.height!=vt)&&(a.canvas.width=ue,a.canvas.height=vt),a.viewport(0,vt-Q,T,Q),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),K.sort((Je,wn)=>wn.xb-Je.xb),ue=ie.push(Ue),C!=ue&&(a.bufferData(a.ARRAY_BUFFER,8*ue,a.DYNAMIC_DRAW),C=ue),ue=0;for(var $t of K)a.bufferSubData(a.ARRAY_BUFFER,ue,$t.Ua),ue+=4*$t.Ua.length;console.assert(ue==4*Ue);for(var yn of K)a.bufferSubData(a.ARRAY_BUFFER,ue,yn.Db),ue+=4*yn.Db.length;console.assert(ue==8*Ue),ue=pe.push(We),O!=ue&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*ue,a.DYNAMIC_DRAW),O=ue),$t=0;for(var tr of K)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,$t,tr.indices),$t+=2*tr.indices.length;console.assert($t==2*We),tr=0,yn=!0,ue=$t=0;for(const Je of K){Je.image.Ka!=tr&&(a.bindTexture(a.TEXTURE_2D,Je.image.Ja||null),tr=Je.image.Ka),Je.mc?(a.scissor(Je.Za,vt-Je.$a-Je.kb,Je.Ac,Je.kb),yn=!0):yn&&(a.scissor(0,vt-Q,T,Q),yn=!1),K=2/T;const wn=-2/Q;a.uniform4f(y,Je.ha[0]*K*Je.Ba,Je.ha[1]*wn*Je.Ca,Je.ha[2]*K*Je.Ba,Je.ha[3]*wn*Je.Ca),a.uniform2f(k,Je.ha[4]*K*Je.Ba+K*(Je.Za-Je.ic*Je.Ba)-1,Je.ha[5]*wn*Je.Ca+wn*(Je.$a-Je.jc*Je.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,ue),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,ue+4*Ue),a.drawElements(a.TRIANGLES,Je.indices.length,a.UNSIGNED_SHORT,$t),ue+=4*Je.Ua.length,$t+=2*Je.indices.length}console.assert(ue==4*Ue),console.assert($t==2*We)}}},this.canvas=function(){return i()&&a.canvas}},X=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(H){switch(H){case j.srcOver:return"source-over";case j.screen:return"screen";case j.overlay:return"overlay";case j.darken:return"darken";case j.lighten:return"lighten";case j.colorDodge:return"color-dodge";case j.colorBurn:return"color-burn";case j.hardLight:return"hard-light";case j.softLight:return"soft-light";case j.difference:return"difference";case j.exclusion:return"exclusion";case j.multiply:return"multiply";case j.hue:return"hue";case j.saturation:return"saturation";case j.color:return"color";case j.luminosity:return"luminosity"}}function a(H){return"rgba("+((16711680&H)>>>16)+","+((65280&H)>>>8)+","+((255&H)>>>0)+","+((4278190080&H)>>>24)/255+")"}function c(){0<vt.length&&(z.Qb(ue.drawWidth(),ue.drawHeight(),vt,$t,yn),vt=[],yn=$t=0,ue.reset(512,512));for(const H of We){for(const de of H.H)de();H.H=[]}We.clear()}X&&X();var v=g.RenderPaintStyle;const y=g.RenderPath,k=g.RenderPaint,C=g.Renderer,O=g.StrokeCap,F=g.StrokeJoin,j=g.BlendMode,Z=v.fill,ie=v.stroke,pe=g.FillRule.evenOdd;let T=1;var Q=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:H,xa:de}={}){this.__parent.__construct.call(this),this.Ka=T,T=T+1&2147483647||1,this.la=H,this.xa=de},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(H){var de=this;de.xa&&de.xa(de);var Ge=new Image;de.Xa=URL.createObjectURL(new Blob([H],{type:"image/png"})),Ge.onload=function(){de.Fb=Ge,de.Ja=z.Lb(Ge),de.size(Ge.width,Ge.height),de.la&&de.la(de)},Ge.src=de.Xa}}),K=y.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(H,de,Ge,Xe,Ne,Ye,nt){var it=this.T,hn=it.addPath;H=H.T;const jt=new DOMMatrix;jt.a=de,jt.b=Ge,jt.c=Xe,jt.d=Ne,jt.e=Ye,jt.f=nt,hn.call(it,H,jt)},fillRule:function(H){this.Wa=H},moveTo:function(H,de){this.T.moveTo(H,de)},lineTo:function(H,de){this.T.lineTo(H,de)},cubicTo:function(H,de,Ge,Xe,Ne,Ye){this.T.bezierCurveTo(H,de,Ge,Xe,Ne,Ye)},close:function(){this.T.closePath()}}),Ue=k.extend("CanvasRenderPaint",{color:function(H){this.Ya=a(H)},thickness:function(H){this.Ib=H},join:function(H){switch(H){case F.miter:this.Ia="miter";break;case F.round:this.Ia="round";break;case F.bevel:this.Ia="bevel"}},cap:function(H){switch(H){case O.butt:this.Ha="butt";break;case O.round:this.Ha="round";break;case O.square:this.Ha="square"}},style:function(H){this.Hb=H},blendMode:function(H){this.Eb=i(H)},clearGradient:function(){this.ja=null},linearGradient:function(H,de,Ge,Xe){this.ja={zb:H,Ab:de,cb:Ge,eb:Xe,Ra:[]}},radialGradient:function(H,de,Ge,Xe){this.ja={zb:H,Ab:de,cb:Ge,eb:Xe,Ra:[],ec:!0}},addStop:function(H,de){this.ja.Ra.push({color:H,stop:de})},completeGradient:function(){},draw:function(H,de,Ge){let Xe=this.Hb;var Ne=this.Ya,Ye=this.ja;if(H.globalCompositeOperation=this.Eb,Ye!=null){Ne=Ye.zb;var nt=Ye.Ab;const hn=Ye.cb;var it=Ye.eb;const jt=Ye.Ra;Ye.ec?(Ye=hn-Ne,it-=nt,Ne=H.createRadialGradient(Ne,nt,0,Ne,nt,Math.sqrt(Ye*Ye+it*it))):Ne=H.createLinearGradient(Ne,nt,hn,it);for(let sn=0,xt=jt.length;sn<xt;sn++)nt=jt[sn],Ne.addColorStop(nt.stop,a(nt.color));this.Ya=Ne,this.ja=null}switch(Xe){case ie:H.strokeStyle=Ne,H.lineWidth=this.Ib,H.lineCap=this.Ha,H.lineJoin=this.Ia,H.stroke(de);break;case Z:H.fillStyle=Ne,H.fill(de,Ge)}}});const We=new Set;let ue=null,vt=[],$t=0,yn=0;var tr=g.CanvasRenderer=C.extend("Renderer",{__construct:function(H){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=H.getContext("2d"),this.Va=H,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const H=this.S.length-6;if(6>H)throw"restore() called without matching save().";this.S.splice(H),this.H.push(this.C.restore.bind(this.C))},transform:function(H,de,Ge,Xe,Ne,Ye){const nt=this.S,it=nt.length-6;nt.splice(it,6,nt[it]*H+nt[it+2]*de,nt[it+1]*H+nt[it+3]*de,nt[it]*Ge+nt[it+2]*Xe,nt[it+1]*Ge+nt[it+3]*Xe,nt[it]*Ne+nt[it+2]*Ye+nt[it+4],nt[it+1]*Ne+nt[it+3]*Ye+nt[it+5]),this.H.push(this.C.transform.bind(this.C,H,de,Ge,Xe,Ne,Ye))},rotate:function(H){const de=Math.sin(H);H=Math.cos(H),this.transform(H,de,-de,H,0,0)},_drawPath:function(H,de){this.H.push(de.draw.bind(de,this.C,H.T,H.Wa===pe?"evenodd":"nonzero"))},_drawRiveImage:function(H,de,Ge,Xe){var Ne=H.Fb;if(Ne){var Ye=this.C,nt=i(Ge);this.H.push(function(){Ye.globalCompositeOperation=nt,Ye.globalAlpha=Xe,Ye.drawImage(Ne,0,0),Ye.globalAlpha=1})}},_getMatrix:function(H){const de=this.S,Ge=de.length-6;for(let Xe=0;6>Xe;++Xe)H[Xe]=de[Ge+Xe]},_drawImageMesh:function(H,de,Ge,Xe,Ne,Ye,nt,it,hn,jt,sn){de=this.C.canvas.width;var xt=this.C.canvas.height;const xo=jt-it,Oo=sn-hn;it=Math.max(it,0),hn=Math.max(hn,0),jt=Math.min(jt,de),sn=Math.min(sn,xt);const di=jt-it,hi=sn-hn;if(console.assert(di<=Math.min(xo,de)),console.assert(hi<=Math.min(Oo,xt)),!(0>=di||0>=hi)){jt=di<xo||hi<Oo,de=sn=1;var nr=Math.ceil(di*sn),rr=Math.ceil(hi*de);xt=z.hc(),nr>xt&&(sn*=xt/nr,nr=xt),rr>xt&&(de*=xt/rr,rr=xt),ue||(ue=new g.DynamicRectanizer(xt),ue.reset(512,512)),xt=ue.addRect(nr,rr),0>xt&&(c(),We.add(this),xt=ue.addRect(nr,rr),console.assert(0<=xt));var Mo=xt&65535,Lo=xt>>16;vt.push({ha:this.S.slice(this.S.length-6),image:H,Za:Mo,$a:Lo,ic:it,jc:hn,Ac:nr,kb:rr,Ba:sn,Ca:de,Ua:new Float32Array(Ne),Db:new Float32Array(Ye),indices:new Uint16Array(nt),mc:jt,xb:H.Ka<<1|(jt?1:0)}),$t+=Ne.length,yn+=nt.length;var Ar=this.C,ic=i(Ge);this.H.push(function(){Ar.save(),Ar.resetTransform(),Ar.globalCompositeOperation=ic,Ar.globalAlpha=Xe;const Do=z.canvas();Do&&Ar.drawImage(Do,Mo,Lo,nr,rr,it,hn,di,hi),Ar.restore()})}},_clipPath:function(H){this.H.push(this.C.clip.bind(this.C,H.T,H.Wa===pe?"evenodd":"nonzero"))},clear:function(){We.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(H,de){this.transform(1,0,0,1,H,de)}});g.makeRenderer=function(H){const de=new tr(H),Ge=de.C;return new Proxy(de,{get(Xe,Ne){if(typeof Xe[Ne]=="function")return function(...Ye){return Xe[Ne].apply(Xe,Ye)};if(typeof Ge[Ne]=="function"){if(-1<B.indexOf(Ne))throw Error("RiveException: Method call to '"+Ne+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ye){de.H.push(Ge[Ne].bind(Ge,...Ye))}}return Xe[Ne]},set(Xe,Ne,Ye){if(Ne in Ge)return de.H.push(()=>{Ge[Ne]=Ye}),!0}})},g.decodeImage=function(H,de){new Q({la:de}).decode(H)},g.renderFactory={makeRenderPaint:function(){return new Ue},makeRenderPath:function(){return new K},makeRenderImage:function(){let H=wn;return new Q({xa:()=>{H.total++},la:()=>{if(H.loaded++,H.loaded===H.total){const de=H.ready;de&&(de(),H.ready=null)}}})}};let Je=g.load,wn=null;g.load=function(H,de,Ge=!0){const Xe=new g.FallbackFileAssetLoader;return de!==void 0&&Xe.addLoader(de),Ge&&(de=new g.CDNFileAssetLoader,Xe.addLoader(de)),new Promise(function(Ne){let Ye=null;wn={total:0,loaded:0,ready:function(){Ne(Ye)}},Ye=Je(H,Xe),wn.total==0&&Ne(Ye)})};let rc=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(H,de,Ge,Xe,Ne=1){rc.call(this,H,de,Ge,Xe,Ne)},v=new P,g.requestAnimationFrame=v.requestAnimationFrame.bind(v),g.cancelAnimationFrame=v.cancelAnimationFrame.bind(v),g.enableFPSCounter=v.Rb.bind(v),g.disableFPSCounter=v.Ob,v.pb=c,g.resolveAnimationFrame=c,g.cleanup=function(){ue&&ue.delete()}};var L=Object.assign({},g),N="./this.program",fe=typeof window=="object",te=typeof importScripts=="function",Ee="",J,ne;(fe||te)&&(te?Ee=self.location.href:typeof document<"u"&&document.currentScript&&(Ee=document.currentScript.src),b&&(Ee=b),Ee.indexOf("blob:")!==0?Ee=Ee.substr(0,Ee.replace(/[?#].*/,"").lastIndexOf("/")+1):Ee="",te&&(ne=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),J=(i,a,c)=>{var v=new XMLHttpRequest;v.open("GET",i,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var ye=g.print||console.log.bind(console),Re=g.printErr||console.error.bind(console);Object.assign(g,L),L=null,g.thisProgram&&(N=g.thisProgram);var he;g.wasmBinary&&(he=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&kt("no native wasm support detected");var be,me,at=!1,ze,Ve,ot,At,Oe,le,we,re;function ae(){var i=be.buffer;g.HEAP8=ze=new Int8Array(i),g.HEAP16=ot=new Int16Array(i),g.HEAP32=Oe=new Int32Array(i),g.HEAPU8=Ve=new Uint8Array(i),g.HEAPU16=At=new Uint16Array(i),g.HEAPU32=le=new Uint32Array(i),g.HEAPF32=we=new Float32Array(i),g.HEAPF64=re=new Float64Array(i)}var ke,$e=[],ut=[],Ke=[];function ct(){var i=g.preRun.shift();$e.unshift(i)}var rt=0,_t=null;function kt(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",Re(i),at=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),D(i),i}function gt(i){return i.startsWith("data:application/octet-stream;base64,")}var G;if(G="canvas_advanced.wasm",!gt(G)){var ee=G;G=g.locateFile?g.locateFile(ee,Ee):Ee+ee}function q(i){if(i==G&&he)return new Uint8Array(he);if(ne)return ne(i);throw"both async and sync fetching of the wasm failed"}function se(i){if(!he&&(fe||te)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>q(i));if(J)return new Promise((a,c)=>{J(i,v=>a(new Uint8Array(v)),c)})}return Promise.resolve().then(()=>q(i))}function ve(i,a,c){return se(i).then(v=>WebAssembly.instantiate(v,a)).then(v=>v).then(c,v=>{Re("failed to asynchronously prepare wasm: "+v),kt(v)})}function Ce(i,a){var c=G;return he||typeof WebAssembly.instantiateStreaming!="function"||gt(c)||c.startsWith("file://")||typeof fetch!="function"?ve(c,i,a):fetch(c,{credentials:"same-origin"}).then(v=>WebAssembly.instantiateStreaming(v,i).then(a,function(y){return Re("wasm streaming compile failed: "+y),Re("falling back to ArrayBuffer instantiation"),ve(c,i,a)}))}var Ae,p,o={460492:(i,a,c,v,y)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=v,window.h.ga.yb=y;let k=window.h;k.D=[],k.yc=function(C){for(var O=0;O<k.D.length;++O)if(k.D[O]==null)return k.D[O]=C,O;return k.D.push(C),k.D.length-1},k.Cb=function(C){for(k.D[C]=null;0<k.D.length&&k.D[k.D.length-1]==null;)k.D.pop()},k.Sc=function(C){for(var O=0;O<k.D.length;++O)if(k.D[O]==C)return k.Cb(O)},k.ra=function(C){return k.D[C]},k.Ta=["touchend","click"],k.unlock=function(){for(var C=0;C<k.D.length;++C){var O=k.D[C];O!=null&&O.J!=null&&O.state===k.ga.yb&&O.J.resume().then(()=>{Co(O.qb)},F=>{console.error("Failed to resume audiocontext",F)})}k.Ta.map(function(F){document.removeEventListener(F,k.unlock,!0)})},k.Ta.map(function(C){document.addEventListener(C,k.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,c,v,y,k)=>{if(typeof window.h>"u")return-1;var C={},O={};return i==window.h.I.ya&&c!=0&&(O.sampleRate=c),C.J=new(window.AudioContext||window.webkitAudioContext)(O),C.J.suspend(),C.state=window.h.ga.stopped,c=0,i!=window.h.I.ya&&(c=a),C.Z=C.J.createScriptProcessor(v,c,a),C.Z.onaudioprocess=function(F){if((C.sa==null||C.sa.length==0)&&(C.sa=new Float32Array(we.buffer,y,v*a)),i==window.h.I.capture||i==window.h.I.La){for(var j=0;j<a;j+=1)for(var Z=F.inputBuffer.getChannelData(j),ie=C.sa,pe=0;pe<v;pe+=1)ie[pe*a+j]=Z[pe];To(k,v,y)}if(i==window.h.I.ya||i==window.h.I.La)for(Po(k,v,y),j=0;j<F.outputBuffer.numberOfChannels;++j)for(Z=F.outputBuffer.getChannelData(j),ie=C.sa,pe=0;pe<v;pe+=1)Z[pe]=ie[pe*a+j];else for(j=0;j<F.outputBuffer.numberOfChannels;++j)F.outputBuffer.getChannelData(j).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(F){C.Da=C.J.createMediaStreamSource(F),C.Da.connect(C.Z),C.Z.connect(C.J.destination)}).catch(function(F){console.log("Failed to get user media: "+F)}),i==window.h.I.ya&&C.Z.connect(C.J.destination),C.qb=k,window.h.yc(C)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(g)},w=(i,a)=>{for(var c=0,v=i.length-1;0<=v;v--){var y=i[v];y==="."?i.splice(v,1):y===".."?(i.splice(v,1),c++):c&&(i.splice(v,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},I=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=w(i.split("/").filter(v=>!!v),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},M=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},V=i=>{if(i==="/")return"/";i=I(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},ce=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);kt("initRandomDevice")},Se=i=>(Se=ce())(i);function _e(){for(var i="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=w(i.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+i||"."}var Be=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ze=(i,a,c)=>{var v=a+c;for(c=a;i[c]&&!(c>=v);)++c;if(16<c-a&&i.buffer&&Be)return Be.decode(i.subarray(a,c));for(v="";a<c;){var y=i[a++];if(y&128){var k=i[a++]&63;if((y&224)==192)v+=String.fromCharCode((y&31)<<6|k);else{var C=i[a++]&63;y=(y&240)==224?(y&15)<<12|k<<6|C:(y&7)<<18|k<<12|C<<6|i[a++]&63,65536>y?v+=String.fromCharCode(y):(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else v+=String.fromCharCode(y)}return v},It=[],ht=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);127>=v?a++:2047>=v?a+=2:55296<=v&&57343>=v?(a+=4,++c):a+=3}return a},Qt=(i,a,c,v)=>{if(!(0<v))return 0;var y=c;v=c+v-1;for(var k=0;k<i.length;++k){var C=i.charCodeAt(k);if(55296<=C&&57343>=C){var O=i.charCodeAt(++k);C=65536+((C&1023)<<10)|O&1023}if(127>=C){if(c>=v)break;a[c++]=C}else{if(2047>=C){if(c+1>=v)break;a[c++]=192|C>>6}else{if(65535>=C){if(c+2>=v)break;a[c++]=224|C>>12}else{if(c+3>=v)break;a[c++]=240|C>>18,a[c++]=128|C>>12&63}a[c++]=128|C>>6&63}a[c++]=128|C&63}}return a[c]=0,c-y};function Kt(i,a){var c=Array(ht(i)+1);return i=Qt(i,c,0,c.length),a&&(c.length=i),c}var Dt=[];function Rt(i,a){Dt[i]={input:[],F:[],V:a},Ps(i,He)}var He={open:function(i){var a=Dt[i.node.za];if(!a)throw new ge(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,c,v){if(!i.s||!i.s.V.jb)throw new ge(60);for(var y=0,k=0;k<v;k++){try{var C=i.s.V.jb(i.s)}catch{throw new ge(29)}if(C===void 0&&y===0)throw new ge(6);if(C==null)break;y++,a[c+k]=C}return y&&(i.node.timestamp=Date.now()),y},write:function(i,a,c,v){if(!i.s||!i.s.V.Oa)throw new ge(60);try{for(var y=0;y<v;y++)i.s.V.Oa(i.s,a[c+y])}catch{throw new ge(29)}return v&&(i.node.timestamp=Date.now()),y}},Ct={jb:function(){e:{if(!It.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}It=Kt(i,!0)}i=It.shift()}return i},Oa:function(i,a){a===null||a===10?(ye(Ze(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(ye(Ze(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},St={Oa:function(i,a){a===null||a===10?(Re(Ze(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Re(Ze(i.F,0)),i.F=[])}};function Ut(i,a){var c=i.j?i.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(c.subarray(0,i.v),0))}var Ie={O:null,U(){return Ie.createNode(null,"/",16895,0)},createNode(i,a,c,v){if((c&61440)===24576||(c&61440)===4096)throw new ge(63);return Ie.O||(Ie.O={dir:{node:{Y:Ie.l.Y,P:Ie.l.P,ka:Ie.l.ka,va:Ie.l.va,vb:Ie.l.vb,Bb:Ie.l.Bb,wb:Ie.l.wb,tb:Ie.l.tb,Ea:Ie.l.Ea},stream:{ba:Ie.m.ba}},file:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:{ba:Ie.m.ba,read:Ie.m.read,write:Ie.m.write,pa:Ie.m.pa,mb:Ie.m.mb,ob:Ie.m.ob}},link:{node:{Y:Ie.l.Y,P:Ie.l.P,ma:Ie.l.ma},stream:{}},ab:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:Lu}}),c=Ya(i,a,c,v),(c.mode&61440)===16384?(c.l=Ie.O.dir.node,c.m=Ie.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Ie.O.file.node,c.m=Ie.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Ie.O.link.node,c.m=Ie.O.link.stream):(c.mode&61440)===8192&&(c.l=Ie.O.ab.node,c.m=Ie.O.ab.stream),c.timestamp=Date.now(),i&&(i.j[a]=c,i.timestamp=c.timestamp),c},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var c=i.j;i.j=new Uint8Array(a),c&&i.j.set(c.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw Ts[44]},va(i,a,c,v){return Ie.createNode(i,a,c,v)},vb(i,a,c){if((i.mode&61440)===16384){try{var v=Ri(a,c)}catch{}if(v)for(var y in v.j)throw new ge(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=c,a.j[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var c=Ri(i,a),v;for(v in c.j)throw new ge(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],c;for(c in i.j)i.j.hasOwnProperty(c)&&a.push(c);return a},Ea(i,a,c){return i=Ie.createNode(i,a,41471,0),i.link=c,i},ma(i){if((i.mode&61440)!==40960)throw new ge(28);return i.link}},m:{read(i,a,c,v,y){var k=i.node.j;if(y>=i.node.v)return 0;if(i=Math.min(i.node.v-y,v),8<i&&k.subarray)a.set(k.subarray(y,y+i),c);else for(v=0;v<i;v++)a[c+v]=k[y+v];return i},write(i,a,c,v,y,k){if(a.buffer===ze.buffer&&(k=!1),!v)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(k)return i.j=a.subarray(c,c+v),i.v=v;if(i.v===0&&y===0)return i.j=a.slice(c,c+v),i.v=v;if(y+v<=i.v)return i.j.set(a.subarray(c,c+v),y),v}if(Ut(i,y+v),i.j.subarray&&a.subarray)i.j.set(a.subarray(c,c+v),y);else for(k=0;k<v;k++)i.j[y+k]=a[c+k];return i.v=Math.max(i.v,y+v),v},ba(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new ge(28);return a},pa(i,a,c){Ut(i.node,a+c),i.node.v=Math.max(i.node.v,a+c)},mb(i,a,c,v,y){if((i.node.mode&61440)!==32768)throw new ge(43);if(i=i.node.j,y&2||i.buffer!==ze.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,kt(),a=void 0,!a)throw new ge(48);ze.set(i,a)}else c=!1,a=i.byteOffset;return{o:a,M:c}},ob(i,a,c,v){return Ie.m.write(i,a,0,v,c,!1),0}}};function et(i,a){var c=0;return i&&(c|=365),a&&(c|=146),c}var mn=null,za={},Pi=[],Ou=1,ni=null,Ha=!0,ge=null,Ts={},Qn=(i,a={})=>{if(i=_e(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new ge(32);i=i.split("/").filter(C=>!!C);for(var c=mn,v="/",y=0;y<i.length;y++){var k=y===i.length-1;if(k&&a.parent)break;if(c=Ri(c,i[y]),v=I(v+"/"+i[y]),c.wa&&(!k||k&&a.hb)&&(c=c.wa.root),!k||a.gb){for(k=0;(c.mode&61440)===40960;)if(c=Du(v),v=_e(M(v),c),c=Qn(v,{Qa:a.Qa+1}).node,40<k++)throw new ge(32)}}return{path:v,node:c}},Ga=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},Ka=(i,a)=>{for(var c=0,v=0;v<a.length;v++)c=(c<<5)-c+a.charCodeAt(v)|0;return(i+c>>>0)%ni.length},Ri=(i,a)=>{var c;if(c=(c=ji(i,"x"))?c:i.l.ka?0:2)throw new ge(c,i);for(c=ni[Ka(i.id,a)];c;c=c.lc){var v=c.name;if(c.parent.id===i.id&&v===a)return c}return i.l.ka(i,a)},Ya=(i,a,c,v)=>(i=new So(i,a,c,v),a=Ka(i.parent.id,i.name),i.lc=ni[a],ni[a]=i),Ja=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},ji=(i,a)=>{if(Ha)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Xa=(i,a)=>{try{return Ri(i,a),20}catch{}return ji(i,"wx")},Mu=()=>{for(var i=0;4096>=i;i++)if(!Pi[i])return i;throw new ge(33)},Nn=i=>{if(i=Pi[i],!i)throw new ge(8);return i},Qa=(i,a=-1)=>(ii||(ii=function(){this.h={}},ii.prototype={},Object.defineProperties(ii.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),i=Object.assign(new ii,i),a==-1&&(a=Mu()),i.X=a,Pi[a]=i),Lu={open:i=>{i.m=za[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new ge(70)}},Ps=(i,a)=>{za[i]={m:a}},Za=(i,a)=>{var c=a==="/",v=!a;if(c&&mn)throw new ge(10);if(!c&&!v){var y=Qn(a,{hb:!1});if(a=y.path,y=y.node,y.wa)throw new ge(10);if((y.mode&61440)!==16384)throw new ge(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,c?mn=i:y&&(y.wa=a,y.U&&y.U.kc.push(a))},un=(i,a,c)=>{var v=Qn(i,{parent:!0}).node;if(i=V(i),!i||i==="."||i==="..")throw new ge(28);var y=Xa(v,i);if(y)throw new ge(y);if(!v.l.va)throw new ge(63);return v.l.va(v,i,a,c)},xi=(i,a,c)=>{typeof c>"u"&&(c=a,a=438),un(i,a|8192,c)},Rs=(i,a)=>{if(!_e(i))throw new ge(44);var c=Qn(a,{parent:!0}).node;if(!c)throw new ge(44);a=V(a);var v=Xa(c,a);if(v)throw new ge(v);if(!c.l.Ea)throw new ge(63);c.l.Ea(c,a,i)},Du=i=>{if(i=Qn(i).node,!i)throw new ge(44);if(!i.l.ma)throw new ge(28);return _e(Ga(i.parent),i.l.ma(i))},Oi=(i,a,c)=>{if(i==="")throw new ge(44);if(typeof a=="string"){var v={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof v>"u")throw Error(`Unknown file open mode: ${a}`);a=v}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var y=i;else{i=I(i);try{y=Qn(i,{gb:!(a&131072)}).node}catch{}}if(v=!1,a&64)if(y){if(a&128)throw new ge(20)}else y=un(i,c,0),v=!0;if(!y)throw new ge(44);if((y.mode&61440)===8192&&(a&=-513),a&65536&&(y.mode&61440)!==16384)throw new ge(54);if(!v&&(c=y?(y.mode&61440)===40960?32:(y.mode&61440)===16384&&(Ja(a)!=="r"||a&512)?31:ji(y,Ja(a)):44))throw new ge(c);if(a&512&&!v){if(c=y,c=typeof c=="string"?Qn(c,{gb:!0}).node:c,!c.l.P)throw new ge(63);if((c.mode&61440)===16384)throw new ge(31);if((c.mode&61440)!==32768)throw new ge(28);if(v=ji(c,"w"))throw new ge(v);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,y=Qa({node:y,path:Ga(y),flags:a,seekable:!0,position:0,m:y.m,zc:[],error:!1}),y.m.open&&y.m.open(y),!g.logReadFiles||a&1||(Mi||(Mi={}),i in Mi||(Mi[i]=1)),y},eo=(i,a,c)=>{if(i.X===null)throw new ge(8);if(!i.seekable||!i.m.ba)throw new ge(70);if(c!=0&&c!=1&&c!=2)throw new ge(28);i.position=i.m.ba(i,a,c),i.zc=[]},to=()=>{ge||(ge=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(i),this.message="FS error"},ge.prototype=Error(),ge.prototype.constructor=ge,[44].forEach(i=>{Ts[i]=new ge(i),Ts[i].stack="<generic error, no stack>"}))},no,ri=(i,a,c)=>{i=I("/dev/"+i);var v=et(!!a,!!c);js||(js=64);var y=js++<<8|0;Ps(y,{open:k=>{k.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(k,C,O,F)=>{for(var j=0,Z=0;Z<F;Z++){try{var ie=a()}catch{throw new ge(29)}if(ie===void 0&&j===0)throw new ge(6);if(ie==null)break;j++,C[O+Z]=ie}return j&&(k.node.timestamp=Date.now()),j},write:(k,C,O,F)=>{for(var j=0;j<F;j++)try{c(C[O+j])}catch{throw new ge(29)}return F&&(k.node.timestamp=Date.now()),j}}),xi(i,v,y)},js,Zn={},ii,Mi,si=void 0;function Tn(){return si+=4,Oe[si-4>>2]}function ro(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Li(i,a){return i=ro(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function io(){this.M=[void 0],this.ib=[]}var rn=new io,Sr=void 0;function Fe(i){throw new Sr(i)}var cn=i=>(i||Fe("Cannot use deleted val. handle = "+i),rn.get(i).value),dn=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return rn.pa({ub:1,value:i})}};function so(i){var a=Error,c=Li(i,function(v){this.name=i,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var ao=void 0,oo=void 0;function wt(i){for(var a="";Ve[i];)a+=oo[Ve[i++]];return a}var ai=[];function xs(){for(;ai.length;){var i=ai.pop();i.g.fa=!1,i.delete()}}var oi=void 0,Pn={};function Os(i,a){for(a===void 0&&Fe("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var er={};function lo(i){i=Ro(i);var a=wt(i);return xn(i),a}function li(i,a){var c=er[i];return c===void 0&&Fe(a+" has unknown type "+lo(i)),c}function Di(){}var Ms=!1;function uo(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function co(i,a,c){return a===c?i:c.A===void 0?null:(i=co(i,a,c.A),i===null?null:c.Pb(i))}var ho={};function $u(i,a){return a=Os(i,a),Pn[a]}var fo=void 0;function $i(i){throw new fo(i)}function Fi(i,a){return a.u&&a.o||$i("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&$i("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Er(Object.create(i,{g:{value:a}}))}function Er(i){return typeof FinalizationRegistry>"u"?(Er=a=>a,i):(Ms=new FinalizationRegistry(a=>{uo(a.g)}),Er=a=>{var c=a.g;return c.G&&Ms.register(a,{g:c},a),a},Di=a=>{Ms.unregister(a)},Er(i))}var Ui={};function ui(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function ci(i){return this.fromWireType(Oe[i>>2])}var Ir={},Ni={};function Zt(i,a,c){function v(O){O=c(O),O.length!==i.length&&$i("Mismatched type converter count");for(var F=0;F<i.length;++F)_n(i[F],O[F])}i.forEach(function(O){Ni[O]=a});var y=Array(a.length),k=[],C=0;a.forEach((O,F)=>{er.hasOwnProperty(O)?y[F]=er[O]:(k.push(O),Ir.hasOwnProperty(O)||(Ir[O]=[]),Ir[O].push(()=>{y[F]=er[O],++C,C===k.length&&v(y)}))}),k.length===0&&v(y)}function Bi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Fu(i,a,c={}){var v=a.name;if(i||Fe(`type "${v}" must have a positive integer typeid pointer`),er.hasOwnProperty(i)){if(c.$b)return;Fe(`Cannot register type '${v}' twice`)}er[i]=a,delete Ni[i],Ir.hasOwnProperty(i)&&(a=Ir[i],delete Ir[i],a.forEach(y=>y()))}function _n(i,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Fu(i,a,c)}function Ls(i){Fe(i.g.u.i.name+" instance already deleted")}function Bn(){}function Ds(i,a,c){if(i[a].B===void 0){var v=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||Fe(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[v.ea]=v}}function $s(i,a,c){g.hasOwnProperty(i)?((c===void 0||g[i].B!==void 0&&g[i].B[c]!==void 0)&&Fe(`Cannot register public name '${i}' twice`),Ds(g,i,i),g.hasOwnProperty(c)&&Fe(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),g[i].B[c]=a):(g[i]=a,c!==void 0&&(g[i].Pc=c))}function Uu(i,a,c,v,y,k,C,O){this.name=i,this.constructor=a,this.N=c,this.W=v,this.A=y,this.Ub=k,this.na=C,this.Pb=O,this.rb=[]}function Wi(i,a,c){for(;a!==c;)a.na||Fe(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function Nu(i,a){return a===null?(this.Na&&Fe(`null is not a valid ${this.name}`),0):(a.g||Fe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Fe(`Cannot pass deleted object as a pointer of type ${this.name}`),Wi(a.g.o,a.g.u.i,this.i))}function Bu(i,a){if(a===null){if(this.Na&&Fe(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return i!==null&&i.push(this.W,c),c}return 0}if(a.g||Fe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Fe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&Fe(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Wi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&Fe("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:Fe(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var v=a.clone();c=this.oc(c,dn(function(){v.delete()})),i!==null&&i.push(this.W,c)}break;default:Fe("Unsupporting sharing policy")}return c}function Wu(i,a){return a===null?(this.Na&&Fe(`null is not a valid ${this.name}`),0):(a.g||Fe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Fe(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&Fe(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Wi(a.g.o,a.g.u.i,this.i))}function Rn(i,a,c,v){this.name=i,this.i=a,this.Na=c,this.ta=v,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Bu:(this.toWireType=v?Nu:Wu,this.K=null)}function vo(i,a,c){g.hasOwnProperty(i)||$i("Replacing nonexistant public symbol"),g[i].B!==void 0&&c!==void 0?g[i].B[c]=a:(g[i]=a,g[i].ea=c)}var Vi=[],po=i=>{var a=Vi[i];return a||(i>=Vi.length&&(Vi.length=i+1),Vi[i]=a=ke.get(i)),a},Vu=(i,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),i.includes("j")){var v=g["dynCall_"+i];v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)}else v=po(a).apply(null,c);return v}};function Nt(i,a){i=wt(i);var c=i.includes("j")?Vu(i,a):po(a);return typeof c!="function"&&Fe(`unknown function pointer with signature ${i}: ${a}`),c}var go=void 0;function jn(i,a){function c(k){y[k]||er[k]||(Ni[k]?Ni[k].forEach(c):(v.push(k),y[k]=!0))}var v=[],y={};throw a.forEach(c),new go(`${i}: `+v.map(lo).join([", "]))}function qi(i,a,c,v,y){var k=a.length;2>k&&Fe("argTypes array size mismatch! Must at least get return value and 'this' types!");var C=a[1]!==null&&c!==null,O=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){O=!0;break}var F=a[0].name!=="void",j=k-2,Z=Array(j),ie=[],pe=[];return function(){if(arguments.length!==j&&Fe(`function ${i} called with ${arguments.length} arguments, expected ${j} args!`),pe.length=0,ie.length=C?2:1,ie[0]=y,C){var T=a[1].toWireType(pe,this);ie[1]=T}for(var Q=0;Q<j;++Q)Z[Q]=a[Q+2].toWireType(pe,arguments[Q]),ie.push(Z[Q]);if(Q=v.apply(null,ie),O)ui(pe);else for(var K=C?1:2;K<a.length;K++){var Ue=K===1?T:Z[K-2];a[K].K!==null&&a[K].K(Ue)}return T=F?a[0].fromWireType(Q):void 0,T}}function zi(i,a){for(var c=[],v=0;v<i;v++)c.push(le[a+4*v>>2]);return c}function mo(i,a,c){return i instanceof Object||Fe(`${c} with invalid "this": ${i}`),i instanceof a.i.constructor||Fe(`${c} incompatible with "this" of type ${i.constructor.name}`),i.g.o||Fe(`cannot call emscripten binding method ${c} on deleted object`),Wi(i.g.o,i.g.u.i,a.i)}function Fs(i){i>=rn.h&&--rn.get(i).ub===0&&rn.Zb(i)}function qu(i,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?ze:Ve)[v])};case 1:return function(v){return this.fromWireType((c?ot:At)[v>>1])};case 2:return function(v){return this.fromWireType((c?Oe:le)[v>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Us(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function zu(i,a){switch(a){case 2:return function(c){return this.fromWireType(we[c>>2])};case 3:return function(c){return this.fromWireType(re[c>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Hu(i,a,c){switch(a){case 0:return c?function(v){return ze[v]}:function(v){return Ve[v]};case 1:return c?function(v){return ot[v>>1]}:function(v){return At[v>>1]};case 2:return c?function(v){return Oe[v>>2]}:function(v){return le[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var _o=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Gu=(i,a)=>{for(var c=i>>1,v=c+a/2;!(c>=v)&&At[c];)++c;if(c<<=1,32<c-i&&_o)return _o.decode(Ve.subarray(i,c));for(c="",v=0;!(v>=a/2);++v){var y=ot[i+2*v>>1];if(y==0)break;c+=String.fromCharCode(y)}return c},Ku=(i,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*i.length?c/2:i.length;for(var y=0;y<c;++y)ot[a>>1]=i.charCodeAt(y),a+=2;return ot[a>>1]=0,a-v},Yu=i=>2*i.length,Ju=(i,a)=>{for(var c=0,v="";!(c>=a/4);){var y=Oe[i+4*c>>2];if(y==0)break;++c,65536<=y?(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023)):v+=String.fromCharCode(y)}return v},Xu=(i,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var y=0;y<i.length;++y){var k=i.charCodeAt(y);if(55296<=k&&57343>=k){var C=i.charCodeAt(++y);k=65536+((k&1023)<<10)|C&1023}if(Oe[a>>2]=k,a+=4,a+4>c)break}return Oe[a>>2]=0,a-v},Qu=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a},Zu={};function Hi(i){var a=Zu[i];return a===void 0?wt(i):a}var Gi=[];function ec(i){var a=Gi.length;return Gi.push(i),a}function tc(i,a){for(var c=Array(i),v=0;v<i;++v)c[v]=li(le[a+4*v>>2],"parameter "+v);return c}var yo=[],Ns=[],Bs={},wo=()=>{if(!Ws){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:N||"./this.program"},a;for(a in Bs)Bs[a]===void 0?delete i[a]:i[a]=Bs[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);Ws=c}return Ws},Ws,Ki=i=>i%4===0&&(i%100!==0||i%400===0),bo=[31,29,31,30,31,30,31,31,30,31,30,31],ko=[31,28,31,30,31,30,31,31,30,31,30,31],nc=(i,a,c,v)=>{function y(T,Q,K){for(T=typeof T=="number"?T.toString():T||"";T.length<Q;)T=K[0]+T;return T}function k(T,Q){return y(T,Q,"0")}function C(T,Q){function K(We){return 0>We?-1:0<We?1:0}var Ue;return(Ue=K(T.getFullYear()-Q.getFullYear()))===0&&(Ue=K(T.getMonth()-Q.getMonth()))===0&&(Ue=K(T.getDate()-Q.getDate())),Ue}function O(T){switch(T.getDay()){case 0:return new Date(T.getFullYear()-1,11,29);case 1:return T;case 2:return new Date(T.getFullYear(),0,3);case 3:return new Date(T.getFullYear(),0,2);case 4:return new Date(T.getFullYear(),0,1);case 5:return new Date(T.getFullYear()-1,11,31);case 6:return new Date(T.getFullYear()-1,11,30)}}function F(T){var Q=T.ca;for(T=new Date(new Date(T.da+1900,0,1).getTime());0<Q;){var K=T.getMonth(),Ue=(Ki(T.getFullYear())?bo:ko)[K];if(Q>Ue-T.getDate())Q-=Ue-T.getDate()+1,T.setDate(1),11>K?T.setMonth(K+1):(T.setMonth(0),T.setFullYear(T.getFullYear()+1));else{T.setDate(T.getDate()+Q);break}}return K=new Date(T.getFullYear()+1,0,4),Q=O(new Date(T.getFullYear(),0,4)),K=O(K),0>=C(Q,T)?0>=C(K,T)?T.getFullYear()+1:T.getFullYear():T.getFullYear()-1}var j=Oe[v+40>>2];v={wc:Oe[v>>2],vc:Oe[v+4>>2],Fa:Oe[v+8>>2],Sa:Oe[v+12>>2],Ga:Oe[v+16>>2],da:Oe[v+20>>2],R:Oe[v+24>>2],ca:Oe[v+28>>2],Rc:Oe[v+32>>2],uc:Oe[v+36>>2],xc:j&&j?Ze(Ve,j):""},c=c?Ze(Ve,c):"",j={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Z in j)c=c.replace(new RegExp(Z,"g"),j[Z]);var ie="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),pe="January February March April May June July August September October November December".split(" ");j={"%a":T=>ie[T.R].substring(0,3),"%A":T=>ie[T.R],"%b":T=>pe[T.Ga].substring(0,3),"%B":T=>pe[T.Ga],"%C":T=>k((T.da+1900)/100|0,2),"%d":T=>k(T.Sa,2),"%e":T=>y(T.Sa,2," "),"%g":T=>F(T).toString().substring(2),"%G":T=>F(T),"%H":T=>k(T.Fa,2),"%I":T=>(T=T.Fa,T==0?T=12:12<T&&(T-=12),k(T,2)),"%j":T=>{for(var Q=0,K=0;K<=T.Ga-1;Q+=(Ki(T.da+1900)?bo:ko)[K++]);return k(T.Sa+Q,3)},"%m":T=>k(T.Ga+1,2),"%M":T=>k(T.vc,2),"%n":()=>`
`,"%p":T=>0<=T.Fa&&12>T.Fa?"AM":"PM","%S":T=>k(T.wc,2),"%t":()=>"	","%u":T=>T.R||7,"%U":T=>k(Math.floor((T.ca+7-T.R)/7),2),"%V":T=>{var Q=Math.floor((T.ca+7-(T.R+6)%7)/7);if(2>=(T.R+371-T.ca-2)%7&&Q++,Q)Q==53&&(K=(T.R+371-T.ca)%7,K==4||K==3&&Ki(T.da)||(Q=1));else{Q=52;var K=(T.R+7-T.ca-1)%7;(K==4||K==5&&Ki(T.da%400-1))&&Q++}return k(Q,2)},"%w":T=>T.R,"%W":T=>k(Math.floor((T.ca+7-(T.R+6)%7)/7),2),"%y":T=>(T.da+1900).toString().substring(2),"%Y":T=>T.da+1900,"%z":T=>{T=T.uc;var Q=0<=T;return T=Math.abs(T)/60,(Q?"+":"-")+("0000"+(T/60*100+T%60)).slice(-4)},"%Z":T=>T.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(Z in j)c.includes(Z)&&(c=c.replace(new RegExp(Z,"g"),j[Z](v)));return c=c.replace(/\0\0/g,"%"),Z=Kt(c,!1),Z.length>a?0:(ze.set(Z,i),Z.length-1)};function So(i,a,c,v){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Ou++,this.name=a,this.mode=c,this.l={},this.m={},this.za=v}Object.defineProperties(So.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),to(),ni=Array(4096),Za(Ie,"/"),un("/tmp",16895,0),un("/home",16895,0),un("/home/web_user",16895,0),(()=>{un("/dev",16895,0),Ps(259,{read:()=>0,write:(v,y,k,C)=>C}),xi("/dev/null",259),Rt(1280,Ct),Rt(1536,St),xi("/dev/tty",1280),xi("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=Se(i).byteLength),i[--a]);ri("random",c),ri("urandom",c),un("/dev/shm",16895,0),un("/dev/shm/tmp",16895,0)})(),(()=>{un("/proc",16895,0);var i=un("/proc/self",16895,0);un("/proc/self/fd",16895,0),Za({U:()=>{var a=Ya(i,"fd",16895,73);return a.l={ka:(c,v)=>{var y=Nn(+v);return c={parent:null,U:{nb:"fake"},l:{ma:()=>y.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(io.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Sr=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},rn.M.push({value:void 0},{value:null},{value:!0},{value:!1}),rn.h=rn.M.length,g.count_emval_handles=function(){for(var i=0,a=rn.h;a<rn.M.length;++a)rn.M[a]!==void 0&&++i;return i},ao=g.PureVirtualError=so("PureVirtualError");for(var Eo=Array(256),Yi=0;256>Yi;++Yi)Eo[Yi]=String.fromCharCode(Yi);oo=Eo,g.getInheritedInstanceCount=function(){return Object.keys(Pn).length},g.getLiveInheritedInstances=function(){var i=[],a;for(a in Pn)Pn.hasOwnProperty(a)&&i.push(Pn[a]);return i},g.flushPendingDeletes=xs,g.setDelayFunction=function(i){oi=i,ai.length&&oi&&oi(xs)},fo=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},Bn.prototype.isAliasOf=function(i){if(!(this instanceof Bn&&i instanceof Bn))return!1;var a=this.g.u.i,c=this.g.o,v=i.g.u.i;for(i=i.g.o;a.A;)c=a.na(c),a=a.A;for(;v.A;)i=v.na(i),v=v.A;return a===v&&c===i},Bn.prototype.clone=function(){if(this.g.o||Ls(this),this.g.ia)return this.g.count.value+=1,this;var i=Er,a=Object,c=a.create,v=Object.getPrototypeOf(this),y=this.g;return i=i(c.call(a,v,{g:{value:{count:y.count,fa:y.fa,ia:y.ia,o:y.o,u:y.u,G:y.G,L:y.L}}})),i.g.count.value+=1,i.g.fa=!1,i},Bn.prototype.delete=function(){this.g.o||Ls(this),this.g.fa&&!this.g.ia&&Fe("Object already scheduled for deletion"),Di(this),uo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Bn.prototype.isDeleted=function(){return!this.g.o},Bn.prototype.deleteLater=function(){return this.g.o||Ls(this),this.g.fa&&!this.g.ia&&Fe("Object already scheduled for deletion"),ai.push(this),ai.length===1&&oi&&oi(xs),this.g.fa=!0,this},Rn.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},Rn.prototype.bb=function(i){this.W&&this.W(i)},Rn.prototype.argPackAdvance=8,Rn.prototype.readValueFromPointer=ci,Rn.prototype.deleteObject=function(i){i!==null&&i.delete()},Rn.prototype.fromWireType=function(i){function a(){return this.ua?Fi(this.i.N,{u:this.nc,o:c,L:this,G:i}):Fi(this.i.N,{u:this,o:i})}var c=this.Vb(i);if(!c)return this.bb(i),null;var v=$u(this.i,c);if(v!==void 0)return v.g.count.value===0?(v.g.o=c,v.g.G=i,v.clone()):(v=v.clone(),this.bb(i),v);if(v=this.i.Ub(c),v=ho[v],!v)return a.call(this);v=this.ta?v.Kb:v.pointerType;var y=co(c,this.i,v.i);return y===null?a.call(this):this.ua?Fi(v.i.N,{u:v,o:y,L:this,G:i}):Fi(v.i.N,{u:v,o:y})},go=g.UnboundTypeError=so("UnboundTypeError");var Io={__syscall_fcntl64:function(i,a,c){si=c;try{var v=Nn(i);switch(a){case 0:var y=Tn();return 0>y?-28:Qa(v,y).X;case 1:case 2:return 0;case 3:return v.flags;case 4:return y=Tn(),v.flags|=y,0;case 5:return y=Tn(),ot[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Oe[Ao()>>2]=28,-1;default:return-28}}catch(k){if(typeof Zn>"u"||k.name!=="ErrnoError")throw k;return-k.aa}},__syscall_ioctl:function(i,a,c){si=c;try{var v=Nn(i);switch(a){case 21509:return v.s?0:-59;case 21505:if(!v.s)return-59;if(v.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var y=Tn();Oe[y>>2]=25856,Oe[y+4>>2]=5,Oe[y+8>>2]=191,Oe[y+12>>2]=35387;for(var k=0;32>k;k++)ze[y+k+17>>0]=a[k]||0}return 0;case 21510:case 21511:case 21512:return v.s?0:-59;case 21506:case 21507:case 21508:if(!v.s)return-59;if(v.s.V.cc)for(y=Tn(),a=[],k=0;32>k;k++)a.push(ze[y+k+17>>0]);return 0;case 21519:return v.s?(y=Tn(),Oe[y>>2]=0):-59;case 21520:return v.s?-28:-59;case 21531:if(y=Tn(),!v.m.ac)throw new ge(59);return v.m.ac(v,a,y);case 21523:return v.s?(v.s.V.dc&&(k=[24,80],y=Tn(),ot[y>>1]=k[0],ot[y+2>>1]=k[1]),0):-59;case 21524:return v.s?0:-59;case 21515:return v.s?0:-59;default:return-28}}catch(C){if(typeof Zn>"u"||C.name!=="ErrnoError")throw C;return-C.aa}},__syscall_openat:function(i,a,c,v){si=v;try{a=a?Ze(Ve,a):"";var y=a;if(y.charAt(0)==="/")a=y;else{var k=i===-100?"/":Nn(i).path;if(y.length==0)throw new ge(44);a=I(k+"/"+y)}var C=v?Tn():0;return Oi(a,c,C).X}catch(O){if(typeof Zn>"u"||O.name!=="ErrnoError")throw O;return-O.aa}},_embind_create_inheriting_constructor:function(i,a,c){i=wt(i),a=li(a,"wrapper"),c=cn(c);var v=[].slice,y=a.i,k=y.N,C=y.A.N,O=y.A.constructor;i=Li(i,function(){y.A.rb.forEach((function(j){if(this[j]===C[j])throw new ao(`Pure virtual function ${j} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:k}),this.__construct.apply(this,v.call(arguments))}),k.__construct=function(){this===k&&Fe("Pass correct 'this' to __construct");var j=O.implement.apply(void 0,[this].concat(v.call(arguments)));Di(j);var Z=j.g;j.notifyOnDestruction(),Z.ia=!0,Object.defineProperties(this,{g:{value:Z}}),Er(this),j=Z.o,j=Os(y,j),Pn.hasOwnProperty(j)?Fe(`Tried to register registered instance: ${j}`):Pn[j]=this},k.__destruct=function(){this===k&&Fe("Pass correct 'this' to __destruct"),Di(this);var j=this.g.o;j=Os(y,j),Pn.hasOwnProperty(j)?delete Pn[j]:Fe(`Tried to unregister unregistered instance: ${j}`)},i.prototype=Object.create(k);for(var F in c)i.prototype[F]=c[F];return dn(i)},_embind_finalize_value_object:function(i){var a=Ui[i];delete Ui[i];var c=a.Pa,v=a.W,y=a.fb,k=y.map(C=>C.Yb).concat(y.map(C=>C.rc));Zt([i],k,C=>{var O={};return y.forEach((F,j)=>{var Z=C[j],ie=F.Wb,pe=F.Xb,T=C[j+y.length],Q=F.qc,K=F.sc;O[F.Sb]={read:Ue=>Z.fromWireType(ie(pe,Ue)),write:(Ue,We)=>{var ue=[];Q(K,Ue,T.toWireType(ue,We)),ui(ue)}}}),[{name:a.name,fromWireType:function(F){var j={},Z;for(Z in O)j[Z]=O[Z].read(F);return v(F),j},toWireType:function(F,j){for(var Z in O)if(!(Z in j))throw new TypeError(`Missing field: "${Z}"`);var ie=c();for(Z in O)O[Z].write(ie,j[Z]);return F!==null&&F.push(v,ie),ie},argPackAdvance:8,readValueFromPointer:ci,K:v}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,c,v,y){var k=Bi(c);a=wt(a),_n(i,{name:a,fromWireType:function(C){return!!C},toWireType:function(C,O){return O?v:y},argPackAdvance:8,readValueFromPointer:function(C){if(c===1)var O=ze;else if(c===2)O=ot;else if(c===4)O=Oe;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(O[C>>k])},K:null})},_embind_register_class:function(i,a,c,v,y,k,C,O,F,j,Z,ie,pe){Z=wt(Z),k=Nt(y,k),O&&(O=Nt(C,O)),j&&(j=Nt(F,j)),pe=Nt(ie,pe);var T=ro(Z);$s(T,function(){jn(`Cannot construct ${Z} due to unbound types`,[v])}),Zt([i,a,c],v?[v]:[],function(Q){if(Q=Q[0],v)var K=Q.i,Ue=K.N;else Ue=Bn.prototype;Q=Li(T,function(){if(Object.getPrototypeOf(this)!==We)throw new Sr("Use 'new' to construct "+Z);if(ue.$===void 0)throw new Sr(Z+" has no accessible constructor");var $t=ue.$[arguments.length];if($t===void 0)throw new Sr(`Tried to invoke ctor of ${Z} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(ue.$).toString()}) parameters instead!`);return $t.apply(this,arguments)});var We=Object.create(Ue,{constructor:{value:Q}});Q.prototype=We;var ue=new Uu(Z,Q,We,pe,K,k,O,j);ue.A&&(ue.A.oa===void 0&&(ue.A.oa=[]),ue.A.oa.push(ue)),K=new Rn(Z,ue,!0,!1),Ue=new Rn(Z+"*",ue,!1,!1);var vt=new Rn(Z+" const*",ue,!1,!0);return ho[i]={pointerType:Ue,Kb:vt},vo(T,Q),[K,Ue,vt]})},_embind_register_class_class_function:function(i,a,c,v,y,k,C){var O=zi(c,v);a=wt(a),k=Nt(y,k),Zt([],[i],function(F){function j(){jn(`Cannot call ${Z} due to unbound types`,O)}F=F[0];var Z=`${F.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var ie=F.i.constructor;return ie[a]===void 0?(j.ea=c-1,ie[a]=j):(Ds(ie,a,Z),ie[a].B[c-1]=j),Zt([],O,function(pe){if(pe=qi(Z,[pe[0],null].concat(pe.slice(1)),null,k,C),ie[a].B===void 0?(pe.ea=c-1,ie[a]=pe):ie[a].B[c-1]=pe,F.i.oa)for(const T of F.i.oa)T.constructor.hasOwnProperty(a)||(T.constructor[a]=pe);return[]}),[]})},_embind_register_class_class_property:function(i,a,c,v,y,k,C,O){a=wt(a),k=Nt(y,k),Zt([],[i],function(F){F=F[0];var j=`${F.name}.${a}`,Z={get(){jn(`Cannot access ${j} due to unbound types`,[c])},enumerable:!0,configurable:!0};return Z.set=O?()=>{jn(`Cannot access ${j} due to unbound types`,[c])}:()=>{Fe(`${j} is a read-only property`)},Object.defineProperty(F.i.constructor,a,Z),Zt([],[c],function(ie){ie=ie[0];var pe={get(){return ie.fromWireType(k(v))},enumerable:!0};return O&&(O=Nt(C,O),pe.set=T=>{var Q=[];O(v,ie.toWireType(Q,T)),ui(Q)}),Object.defineProperty(F.i.constructor,a,pe),[]}),[]})},_embind_register_class_constructor:function(i,a,c,v,y,k){var C=zi(a,c);y=Nt(v,y),Zt([],[i],function(O){O=O[0];var F=`constructor ${O.name}`;if(O.i.$===void 0&&(O.i.$=[]),O.i.$[a-1]!==void 0)throw new Sr(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${O.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return O.i.$[a-1]=()=>{jn(`Cannot construct ${O.name} due to unbound types`,C)},Zt([],C,function(j){return j.splice(1,0,null),O.i.$[a-1]=qi(F,j,null,y,k),[]}),[]})},_embind_register_class_function:function(i,a,c,v,y,k,C,O){var F=zi(c,v);a=wt(a),k=Nt(y,k),Zt([],[i],function(j){function Z(){jn(`Cannot call ${ie} due to unbound types`,F)}j=j[0];var ie=`${j.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),O&&j.i.rb.push(a);var pe=j.i.N,T=pe[a];return T===void 0||T.B===void 0&&T.className!==j.name&&T.ea===c-2?(Z.ea=c-2,Z.className=j.name,pe[a]=Z):(Ds(pe,a,ie),pe[a].B[c-2]=Z),Zt([],F,function(Q){return Q=qi(ie,Q,j,k,C),pe[a].B===void 0?(Q.ea=c-2,pe[a]=Q):pe[a].B[c-2]=Q,[]}),[]})},_embind_register_class_property:function(i,a,c,v,y,k,C,O,F,j){a=wt(a),y=Nt(v,y),Zt([],[i],function(Z){Z=Z[0];var ie=`${Z.name}.${a}`,pe={get(){jn(`Cannot access ${ie} due to unbound types`,[c,C])},enumerable:!0,configurable:!0};return pe.set=F?()=>{jn(`Cannot access ${ie} due to unbound types`,[c,C])}:()=>{Fe(ie+" is a read-only property")},Object.defineProperty(Z.i.N,a,pe),Zt([],F?[c,C]:[c],function(T){var Q=T[0],K={get(){var We=mo(this,Z,ie+" getter");return Q.fromWireType(y(k,We))},enumerable:!0};if(F){F=Nt(O,F);var Ue=T[1];K.set=function(We){var ue=mo(this,Z,ie+" setter"),vt=[];F(j,ue,Ue.toWireType(vt,We)),ui(vt)}}return Object.defineProperty(Z.i.N,a,K),[]}),[]})},_embind_register_emval:function(i,a){a=wt(a),_n(i,{name:a,fromWireType:function(c){var v=cn(c);return Fs(c),v},toWireType:function(c,v){return dn(v)},argPackAdvance:8,readValueFromPointer:ci,K:null})},_embind_register_enum:function(i,a,c,v){function y(){}c=Bi(c),a=wt(a),y.values={},_n(i,{name:a,constructor:y,fromWireType:function(k){return this.constructor.values[k]},toWireType:function(k,C){return C.value},argPackAdvance:8,readValueFromPointer:qu(a,c,v),K:null}),$s(a,y)},_embind_register_enum_value:function(i,a,c){var v=li(i,"enum");a=wt(a),i=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:Li(`${v.name}_${a}`,function(){})}}),i.values[c]=v,i[a]=v},_embind_register_float:function(i,a,c){c=Bi(c),a=wt(a),_n(i,{name:a,fromWireType:function(v){return v},toWireType:function(v,y){return y},argPackAdvance:8,readValueFromPointer:zu(a,c),K:null})},_embind_register_function:function(i,a,c,v,y,k){var C=zi(a,c);i=wt(i),y=Nt(v,y),$s(i,function(){jn(`Cannot call ${i} due to unbound types`,C)},a-1),Zt([],C,function(O){return vo(i,qi(i,[O[0],null].concat(O.slice(1)),null,y,k),a-1),[]})},_embind_register_integer:function(i,a,c,v,y){a=wt(a),y===-1&&(y=4294967295),y=Bi(c);var k=O=>O;if(v===0){var C=32-8*c;k=O=>O<<C>>>C}c=a.includes("unsigned")?function(O,F){return F>>>0}:function(O,F){return F},_n(i,{name:a,fromWireType:k,toWireType:c,argPackAdvance:8,readValueFromPointer:Hu(a,y,v!==0),K:null})},_embind_register_memory_view:function(i,a,c){function v(k){k>>=2;var C=le;return new y(C.buffer,C[k+1],C[k])}var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=wt(c),_n(i,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{$b:!0})},_embind_register_std_string:function(i,a){a=wt(a);var c=a==="std::string";_n(i,{name:a,fromWireType:function(v){var y=le[v>>2],k=v+4;if(c)for(var C=k,O=0;O<=y;++O){var F=k+O;if(O==y||Ve[F]==0){if(C=C?Ze(Ve,C,F-C):"",j===void 0)var j=C;else j+="\0",j+=C;C=F+1}}else{for(j=Array(y),O=0;O<y;++O)j[O]=String.fromCharCode(Ve[k+O]);j=j.join("")}return xn(v),j},toWireType:function(v,y){y instanceof ArrayBuffer&&(y=new Uint8Array(y));var k=typeof y=="string";k||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Int8Array||Fe("Cannot pass non-string to std::string");var C=c&&k?ht(y):y.length,O=Vs(4+C+1),F=O+4;if(le[O>>2]=C,c&&k)Qt(y,Ve,F,C+1);else if(k)for(k=0;k<C;++k){var j=y.charCodeAt(k);255<j&&(xn(F),Fe("String has UTF-16 code units that do not fit in 8 bits")),Ve[F+k]=j}else for(k=0;k<C;++k)Ve[F+k]=y[k];return v!==null&&v.push(xn,O),O},argPackAdvance:8,readValueFromPointer:ci,K:function(v){xn(v)}})},_embind_register_std_wstring:function(i,a,c){if(c=wt(c),a===2)var v=Gu,y=Ku,k=Yu,C=()=>At,O=1;else a===4&&(v=Ju,y=Xu,k=Qu,C=()=>le,O=2);_n(i,{name:c,fromWireType:function(F){for(var j=le[F>>2],Z=C(),ie,pe=F+4,T=0;T<=j;++T){var Q=F+4+T*a;(T==j||Z[Q>>O]==0)&&(pe=v(pe,Q-pe),ie===void 0?ie=pe:(ie+="\0",ie+=pe),pe=Q+a)}return xn(F),ie},toWireType:function(F,j){typeof j!="string"&&Fe(`Cannot pass non-string to C++ string type ${c}`);var Z=k(j),ie=Vs(4+Z+a);return le[ie>>2]=Z>>O,y(j,ie+4,Z+a),F!==null&&F.push(xn,ie),ie},argPackAdvance:8,readValueFromPointer:ci,K:function(F){xn(F)}})},_embind_register_value_object:function(i,a,c,v,y,k){Ui[i]={name:wt(a),Pa:Nt(c,v),W:Nt(y,k),fb:[]}},_embind_register_value_object_field:function(i,a,c,v,y,k,C,O,F,j){Ui[i].fb.push({Sb:wt(a),Yb:c,Wb:Nt(v,y),Xb:k,rc:C,qc:Nt(O,F),sc:j})},_embind_register_void:function(i,a){a=wt(a),_n(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,c){i=cn(i),a=li(a,"emval::as");var v=[],y=dn(v);return le[c>>2]=y,a.toWireType(v,i)},_emval_call_method:function(i,a,c,v,y){i=Gi[i],a=cn(a),c=Hi(c);var k=[];return le[v>>2]=dn(k),i(a,c,k,y)},_emval_call_void_method:function(i,a,c,v){i=Gi[i],a=cn(a),c=Hi(c),i(a,c,null,v)},_emval_decref:Fs,_emval_get_method_caller:function(i,a){var c=tc(i,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(C){return C.name}).join("_")+"$";var y=yo[a];if(y!==void 0)return y;var k=Array(i-1);return y=ec((C,O,F,j)=>{for(var Z=0,ie=0;ie<i-1;++ie)k[ie]=c[ie+1].readValueFromPointer(j+Z),Z+=c[ie+1].argPackAdvance;for(C=C[O].apply(C,k),ie=0;ie<i-1;++ie)c[ie+1].Nb&&c[ie+1].Nb(k[ie]);if(!v.fc)return v.toWireType(F,C)}),yo[a]=y},_emval_get_module_property:function(i){return i=Hi(i),dn(g[i])},_emval_get_property:function(i,a){return i=cn(i),a=cn(a),dn(i[a])},_emval_incref:function(i){4<i&&(rn.get(i).ub+=1)},_emval_new_array:function(){return dn([])},_emval_new_cstring:function(i){return dn(Hi(i))},_emval_new_object:function(){return dn({})},_emval_run_destructors:function(i){var a=cn(i);ui(a),Fs(i)},_emval_set_property:function(i,a,c){i=cn(i),a=cn(a),c=cn(c),i[a]=c},_emval_take_value:function(i,a){return i=li(i,"_emval_take_value"),i=i.readValueFromPointer(a),dn(i)},abort:()=>{kt("")},emscripten_asm_const_int:(i,a,c)=>{Ns.length=0;var v;for(c>>=2;v=Ve[a++];)c+=v!=105&c,Ns.push(v==105?Oe[c]:re[c++>>1]),++c;return o[i].apply(null,Ns)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,c)=>Ve.copyWithin(i,a,a+c),emscripten_resize_heap:i=>{var a=Ve.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,i+100663296);var y=Math;v=Math.max(i,v);e:{y=y.min.call(y,2147483648,v+(65536-v%65536)%65536)-be.buffer.byteLength+65535>>>16;try{be.grow(y),ae();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},environ_get:(i,a)=>{var c=0;return wo().forEach(function(v,y){var k=a+c;for(y=le[i+4*y>>2]=k,k=0;k<v.length;++k)ze[y++>>0]=v.charCodeAt(k);ze[y>>0]=0,c+=v.length+1}),0},environ_sizes_get:(i,a)=>{var c=wo();le[i>>2]=c.length;var v=0;return c.forEach(function(y){v+=y.length+1}),le[a>>2]=v,0},fd_close:function(i){try{var a=Nn(i);if(a.X===null)throw new ge(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Pi[a.X]=null}return a.X=null,0}catch(c){if(typeof Zn>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(i,a,c,v){try{e:{var y=Nn(i);i=a;for(var k,C=a=0;C<c;C++){var O=le[i>>2],F=le[i+4>>2];i+=8;var j=y,Z=O,ie=F,pe=k,T=ze;if(0>ie||0>pe)throw new ge(28);if(j.X===null)throw new ge(8);if((j.flags&2097155)===1)throw new ge(8);if((j.node.mode&61440)===16384)throw new ge(31);if(!j.m.read)throw new ge(28);var Q=typeof pe<"u";if(!Q)pe=j.position;else if(!j.seekable)throw new ge(70);var K=j.m.read(j,T,Z,ie,pe);Q||(j.position+=K);var Ue=K;if(0>Ue){var We=-1;break e}if(a+=Ue,Ue<F)break;typeof k<"u"&&(k+=Ue)}We=a}return le[v>>2]=We,0}catch(ue){if(typeof Zn>"u"||ue.name!=="ErrnoError")throw ue;return ue.aa}},fd_seek:function(i,a,c,v,y){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var k=Nn(i);return eo(k,a,v),p=[k.position>>>0,(Ae=k.position,1<=+Math.abs(Ae)?0<Ae?+Math.floor(Ae/4294967296)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],Oe[y>>2]=p[0],Oe[y+4>>2]=p[1],k.Ma&&a===0&&v===0&&(k.Ma=null),0}catch(C){if(typeof Zn>"u"||C.name!=="ErrnoError")throw C;return C.aa}},fd_write:function(i,a,c,v){try{e:{var y=Nn(i);i=a;for(var k,C=a=0;C<c;C++){var O=le[i>>2],F=le[i+4>>2];i+=8;var j=y,Z=O,ie=F,pe=k,T=ze;if(0>ie||0>pe)throw new ge(28);if(j.X===null)throw new ge(8);if((j.flags&2097155)===0)throw new ge(8);if((j.node.mode&61440)===16384)throw new ge(31);if(!j.m.write)throw new ge(28);j.seekable&&j.flags&1024&&eo(j,0,2);var Q=typeof pe<"u";if(!Q)pe=j.position;else if(!j.seekable)throw new ge(70);var K=j.m.write(j,T,Z,ie,pe,void 0);Q||(j.position+=K);var Ue=K;if(0>Ue){var We=-1;break e}a+=Ue,typeof k<"u"&&(k+=Ue)}We=a}return le[v>>2]=We,0}catch(ue){if(typeof Zn>"u"||ue.name!=="ErrnoError")throw ue;return ue.aa}},strftime_l:(i,a,c,v)=>nc(i,a,c,v)};(function(){function i(c){if(me=c=c.exports,be=me.memory,ae(),ke=me.__indirect_function_table,ut.unshift(me.__wasm_call_ctors),rt--,g.monitorRunDependencies&&g.monitorRunDependencies(rt),rt==0&&_t){var v=_t;_t=null,v()}return c}var a={env:Io,wasi_snapshot_preview1:Io};if(rt++,g.monitorRunDependencies&&g.monitorRunDependencies(rt),g.instantiateWasm)try{return g.instantiateWasm(a,i)}catch(c){Re("Module.instantiateWasm callback failed with error: "+c),D(c)}return Ce(a,function(c){i(c.instance)}).catch(D),{}})();var xn=i=>(xn=me.free)(i),Vs=i=>(Vs=me.malloc)(i),Ao=()=>(Ao=me.__errno_location)(),Co=g._ma_device__on_notification_unlocked=i=>(Co=g._ma_device__on_notification_unlocked=me.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,a)=>(g._ma_malloc_emscripten=me.ma_malloc_emscripten)(i,a),g._ma_free_emscripten=(i,a)=>(g._ma_free_emscripten=me.ma_free_emscripten)(i,a);var To=g._ma_device_process_pcm_frames_capture__webaudio=(i,a,c)=>(To=g._ma_device_process_pcm_frames_capture__webaudio=me.ma_device_process_pcm_frames_capture__webaudio)(i,a,c),Po=g._ma_device_process_pcm_frames_playback__webaudio=(i,a,c)=>(Po=g._ma_device_process_pcm_frames_playback__webaudio=me.ma_device_process_pcm_frames_playback__webaudio)(i,a,c),Ro=i=>(Ro=me.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=me._embind_initialize_bindings)(),g.dynCall_iiji=(i,a,c,v,y)=>(g.dynCall_iiji=me.dynCall_iiji)(i,a,c,v,y),g.dynCall_jiji=(i,a,c,v,y)=>(g.dynCall_jiji=me.dynCall_jiji)(i,a,c,v,y),g.dynCall_iiiji=(i,a,c,v,y,k)=>(g.dynCall_iiiji=me.dynCall_iiiji)(i,a,c,v,y,k),g.dynCall_iij=(i,a,c,v)=>(g.dynCall_iij=me.dynCall_iij)(i,a,c,v),g.dynCall_jii=(i,a,c)=>(g.dynCall_jii=me.dynCall_jii)(i,a,c),g.dynCall_viijii=(i,a,c,v,y,k,C)=>(g.dynCall_viijii=me.dynCall_viijii)(i,a,c,v,y,k,C),g.dynCall_iiiiij=(i,a,c,v,y,k,C)=>(g.dynCall_iiiiij=me.dynCall_iiiiij)(i,a,c,v,y,k,C),g.dynCall_iiiiijj=(i,a,c,v,y,k,C,O,F)=>(g.dynCall_iiiiijj=me.dynCall_iiiiijj)(i,a,c,v,y,k,C,O,F),g.dynCall_iiiiiijj=(i,a,c,v,y,k,C,O,F,j)=>(g.dynCall_iiiiiijj=me.dynCall_iiiiiijj)(i,a,c,v,y,k,C,O,F,j);var Ji;_t=function i(){Ji||jo(),Ji||(_t=i)};function jo(){function i(){if(!Ji&&(Ji=!0,g.calledRun=!0,!at)){if(g.noFSInit||no||(no=!0,to(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?ri("stdin",g.stdin):Rs("/dev/tty","/dev/stdin"),g.stdout?ri("stdout",null,g.stdout):Rs("/dev/tty","/dev/stdout"),g.stderr?ri("stderr",null,g.stderr):Rs("/dev/tty1","/dev/stderr"),Oi("/dev/stdin",0),Oi("/dev/stdout",1),Oi("/dev/stderr",1)),Ha=!1,d(ut),A(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var a=g.postRun.shift();Ke.unshift(a)}d(Ke)}}if(!(0<rt)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)ct();d($e),0<rt||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return jo(),S.ready})})();const _=m}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m.Animation});var m=f(4)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m});var m=(function(){function _(b,S,g,A){this.animation=b,this.artboard=S,this.playing=A,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(b,S)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(b){this.instance.time=b},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(b){this.scrubTo===null?this.instance.advance(b):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(b){this.instance.apply(b)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>b.AudioAssetWrapper,AudioWrapper:()=>b.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>b.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>b.FileAssetWrapper,Finalizable:()=>b.Finalizable,FontAssetWrapper:()=>b.FontAssetWrapper,FontWrapper:()=>b.FontWrapper,ImageAssetWrapper:()=>b.ImageAssetWrapper,ImageWrapper:()=>b.ImageWrapper,finalizationRegistry:()=>b.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var m=f(6),_=f(7),b=f(8)}),((u,h,f)=>{f.r(h),f.d(h,{registerTouchInteractions:()=>b});var m=void 0,_=function(S,g){var A,D;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((A=S.touches)===null||A===void 0)&&A.length)?(g||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((D=S.changedTouches)===null||D===void 0)&&D.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},b=function(S){var g=S.canvas,A=S.artboard,D=S.stateMachines,P=D===void 0?[]:D,U=S.renderer,W=S.rive,B=S.fit,z=S.alignment,X=S.isTouchScrollEnabled,L=X===void 0?!1:X,N=S.layoutScaleFactor,fe=N===void 0?1:N;if(!g||!P.length||!U||!W||!A||typeof window>"u")return null;var te=null,Ee=!1,J=function(ye){if(Ee&&ye instanceof MouseEvent){ye.type=="mouseup"&&(Ee=!1);return}Ee=L&&ye.type==="touchend"&&te==="touchstart",te=ye.type;var Re=ye.currentTarget.getBoundingClientRect(),he=_(ye,L),be=he.clientX,me=he.clientY;if(!(!be&&!me)){var at=be-Re.left,ze=me-Re.top,Ve=W.computeAlignment(B,z,{minX:0,minY:0,maxX:Re.width,maxY:Re.height},A.bounds,fe),ot=new W.Mat2D;Ve.invert(ot);var At=new W.Vec2D(at,ze),Oe=W.mapXY(ot,At),le=Oe.x(),we=Oe.y();switch(Oe.delete(),ot.delete(),At.delete(),Ve.delete(),ye.type){case"mouseout":for(var re=0,ae=P;re<ae.length;re++){var ke=ae[re];ke.pointerMove(le,we)}break;case"touchmove":case"mouseover":case"mousemove":{for(var $e=0,ut=P;$e<ut.length;$e++){var ke=ut[$e];ke.pointerMove(le,we)}break}case"touchstart":case"mousedown":{for(var Ke=0,ct=P;Ke<ct.length;Ke++){var ke=ct[Ke];ke.pointerDown(le,we)}break}case"touchend":case"mouseup":{for(var rt=0,_t=P;rt<_t.length;rt++){var ke=_t[rt];ke.pointerUp(le,we)}break}}}},ne=J.bind(m);return g.addEventListener("mouseover",ne),g.addEventListener("mouseout",ne),g.addEventListener("mousemove",ne),g.addEventListener("mousedown",ne),g.addEventListener("mouseup",ne),g.addEventListener("touchmove",ne,{passive:L}),g.addEventListener("touchstart",ne,{passive:L}),g.addEventListener("touchend",ne),function(){g.removeEventListener("mouseover",ne),g.removeEventListener("mouseout",ne),g.removeEventListener("mousemove",ne),g.removeEventListener("mousedown",ne),g.removeEventListener("mouseup",ne),g.removeEventListener("touchmove",ne),g.removeEventListener("touchstart",ne),g.removeEventListener("touchend",ne)}}}),((u,h,f)=>{f.r(h),f.d(h,{BLANK_URL:()=>D,sanitizeUrl:()=>W});var m=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,b=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,A=[".","/"],D="about:blank";function P(B){return A.indexOf(B[0])>-1}function U(B){var z=B.replace(S,"");return z.replace(_,function(X,L){return String.fromCharCode(L)})}function W(B){if(!B)return D;var z=U(B).replace(b,"").replace(S,"").trim();if(!z)return D;if(P(z))return z;var X=z.match(g);if(!X)return z;var L=X[0];return m.test(L)?D:z}}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>U,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>A,FileAssetWrapper:()=>D,Finalizable:()=>_,FontAssetWrapper:()=>W,FontWrapper:()=>g,ImageAssetWrapper:()=>P,ImageWrapper:()=>b,finalizationRegistry:()=>X});var m=(function(){var L=function(N,fe){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(te,Ee){te.__proto__=Ee}||function(te,Ee){for(var J in Ee)Object.prototype.hasOwnProperty.call(Ee,J)&&(te[J]=Ee[J])},L(N,fe)};return function(N,fe){if(typeof fe!="function"&&fe!==null)throw new TypeError("Class extends value "+String(fe)+" is not a constructor or null");L(N,fe);function te(){this.constructor=N}N.prototype=fe===null?Object.create(fe):(te.prototype=fe.prototype,new te)}})(),_=(function(){function L(){this.selfUnref=!1}return L})(),b=(function(L){m(N,L);function N(fe){var te=L.call(this)||this;return te._nativeImage=fe,te}return Object.defineProperty(N.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),N.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},N})(_),S=(function(L){m(N,L);function N(fe){var te=L.call(this)||this;return te._nativeAudio=fe,te}return Object.defineProperty(N.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),N.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},N})(_),g=(function(L){m(N,L);function N(fe){var te=L.call(this)||this;return te._nativeFont=fe,te}return Object.defineProperty(N.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),N.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},N})(_),A=(function(){function L(N,fe){this._assetLoaderCallback=fe,this.assetLoader=new N.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return L.prototype.loadContents=function(N,fe){var te;return N.isImage?te=new P(N):N.isAudio?te=new U(N):N.isFont&&(te=new W(N)),this._assetLoaderCallback(te,fe)},L})(),D=(function(){function L(N){this._nativeFileAsset=N}return L.prototype.decode=function(N){this._nativeFileAsset.decode(N)},Object.defineProperty(L.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),L})(),P=(function(L){m(N,L);function N(){return L!==null&&L.apply(this,arguments)||this}return N.prototype.setRenderImage=function(fe){this._nativeFileAsset.setRenderImage(fe.nativeImage)},N})(D),U=(function(L){m(N,L);function N(){return L!==null&&L.apply(this,arguments)||this}return N.prototype.setAudioSource=function(fe){this._nativeFileAsset.setAudioSource(fe.nativeAudio)},N})(D),W=(function(L){m(N,L);function N(){return L!==null&&L.apply(this,arguments)||this}return N.prototype.setFont=function(fe){this._nativeFileAsset.setFont(fe.nativeFont)},N})(D),B=(function(){function L(N){}return L.prototype.register=function(N){N.selfUnref=!0},L.prototype.unregister=function(N){},L})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:B,X=new z(function(L){L.unref()})})],r={};function s(u){var h=r[u];if(h!==void 0)return h.exports;var f=r[u]={exports:{}};return t[u](f,f.exports,s),f.exports}s.d=(u,h)=>{for(var f in h)s.o(h,f)&&!s.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},s.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>W,DataEnum:()=>we,EventType:()=>J,Fit:()=>U,Layout:()=>B,LoopType:()=>ne,Rive:()=>Oe,RiveEventType:()=>N,RiveFile:()=>At,RuntimeLoader:()=>z,StateMachineInput:()=>L,StateMachineInputType:()=>X,Testing:()=>se,ViewModel:()=>le,ViewModelInstance:()=>ae,ViewModelInstanceArtboard:()=>G,ViewModelInstanceAssetImage:()=>gt,ViewModelInstanceBoolean:()=>Ke,ViewModelInstanceColor:()=>kt,ViewModelInstanceEnum:()=>rt,ViewModelInstanceList:()=>_t,ViewModelInstanceNumber:()=>ut,ViewModelInstanceString:()=>$e,ViewModelInstanceTrigger:()=>ct,ViewModelInstanceValue:()=>ke,decodeAudio:()=>ve,decodeFont:()=>Ae,decodeImage:()=>Ce});var u=s(1),h=s(2),f=s(3),m=s(5),_=(function(){var p=function(o,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,I){w.__proto__=I}||function(w,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(w[M]=I[M])},p(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(o,d);function w(){this.constructor=o}o.prototype=d===null?Object.create(d):(w.prototype=d.prototype,new w)}})(),b=function(){return b=Object.assign||function(p){for(var o,d=1,w=arguments.length;d<w;d++){o=arguments[d];for(var I in o)Object.prototype.hasOwnProperty.call(o,I)&&(p[I]=o[I])}return p},b.apply(this,arguments)},S=function(p,o,d,w){function I(M){return M instanceof d?M:new d(function(V){V(M)})}return new(d||(d=Promise))(function(M,V){function ce(Be){try{_e(w.next(Be))}catch(Ze){V(Ze)}}function Se(Be){try{_e(w.throw(Be))}catch(Ze){V(Ze)}}function _e(Be){Be.done?M(Be.value):I(Be.value).then(ce,Se)}_e((w=w.apply(p,o||[])).next())})},g=function(p,o){var d={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},w,I,M,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=ce(0),V.throw=ce(1),V.return=ce(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function ce(_e){return function(Be){return Se([_e,Be])}}function Se(_e){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,_e[0]&&(d=0)),d;)try{if(w=1,I&&(M=_e[0]&2?I.return:_e[0]?I.throw||((M=I.return)&&M.call(I),0):I.next)&&!(M=M.call(I,_e[1])).done)return M;switch(I=0,M&&(_e=[_e[0]&2,M.value]),_e[0]){case 0:case 1:M=_e;break;case 4:return d.label++,{value:_e[1],done:!1};case 5:d.label++,I=_e[1],_e=[0];continue;case 7:_e=d.ops.pop(),d.trys.pop();continue;default:if(M=d.trys,!(M=M.length>0&&M[M.length-1])&&(_e[0]===6||_e[0]===2)){d=0;continue}if(_e[0]===3&&(!M||_e[1]>M[0]&&_e[1]<M[3])){d.label=_e[1];break}if(_e[0]===6&&d.label<M[1]){d.label=M[1],M=_e;break}if(M&&d.label<M[2]){d.label=M[2],d.ops.push(_e);break}M[2]&&d.ops.pop(),d.trys.pop();continue}_e=o.call(p,d)}catch(Be){_e=[6,Be],I=0}finally{w=M=0}if(_e[0]&5)throw _e[1];return{value:_e[0]?_e[1]:void 0,done:!0}}},A=function(p,o,d){if(d||arguments.length===2)for(var w=0,I=o.length,M;w<I;w++)(M||!(w in o))&&(M||(M=Array.prototype.slice.call(o,0,w)),M[w]=o[w]);return p.concat(M||Array.prototype.slice.call(o))},D=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),P=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},U;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(U||(U={}));var W;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(W||(W={}));var B=(function(){function p(o){var d,w,I,M,V,ce,Se;this.fit=(d=o?.fit)!==null&&d!==void 0?d:U.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:W.Center,this.layoutScaleFactor=(I=o?.layoutScaleFactor)!==null&&I!==void 0?I:1,this.minX=(M=o?.minX)!==null&&M!==void 0?M:0,this.minY=(V=o?.minY)!==null&&V!==void 0?V:0,this.maxX=(ce=o?.maxX)!==null&&ce!==void 0?ce:0,this.maxY=(Se=o?.maxY)!==null&&Se!==void 0?Se:0}return p.new=function(o){var d=o.fit,w=o.alignment,I=o.minX,M=o.minY,V=o.maxX,ce=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:d,alignment:w,minX:I,minY:M,maxX:V,maxY:ce})},p.prototype.copyWith=function(o){var d=o.fit,w=o.alignment,I=o.layoutScaleFactor,M=o.minX,V=o.minY,ce=o.maxX,Se=o.maxY;return new p({fit:d??this.fit,alignment:w??this.alignment,layoutScaleFactor:I??this.layoutScaleFactor,minX:M??this.minX,minY:V??this.minY,maxX:ce??this.maxX,maxY:Se??this.maxY})},p.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===U.Cover?d=o.Fit.cover:this.fit===U.Contain?d=o.Fit.contain:this.fit===U.Fill?d=o.Fit.fill:this.fit===U.FitWidth?d=o.Fit.fitWidth:this.fit===U.FitHeight?d=o.Fit.fitHeight:this.fit===U.ScaleDown?d=o.Fit.scaleDown:this.fit===U.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},p.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===W.TopLeft?d=o.Alignment.topLeft:this.alignment===W.TopCenter?d=o.Alignment.topCenter:this.alignment===W.TopRight?d=o.Alignment.topRight:this.alignment===W.CenterLeft?d=o.Alignment.centerLeft:this.alignment===W.CenterRight?d=o.Alignment.centerRight:this.alignment===W.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===W.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===W.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},p})(),z=(function(){function p(){}return p.loadRuntime=function(){u.default({locateFile:function(){return p.wasmURL}}).then(function(o){var d;for(p.runtime=o;p.callBackQueue.length>0;)(d=p.callBackQueue.shift())===null||d===void 0||d(p.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var w="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),p.setWasmUrl(w),p.loadRuntime();else{var I=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(I)}})},p.getInstance=function(o){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?o(p.runtime):p.callBackQueue.push(o)},p.awaitInstance=function(){return new Promise(function(o){return p.getInstance(function(d){return o(d)})})},p.setWasmUrl=function(o){p.wasmURL=o},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),p})(),X;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(X||(X={}));var L=(function(){function p(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===X.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),N;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(N||(N={}));var fe=(function(){function p(o){this.nativeArtboard=o}return p})(),te=(function(){function p(o,d,w,I){this.stateMachine=o,this.playing=w,this.artboard=I,this.inputs=[],this.instance=new d.StateMachineInstance(o,I),this.initInputs(d)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),p.prototype.advance=function(o){this.instance.advance(o)},p.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},p.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var w=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(w,o))}},p.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new L(X.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new L(X.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new L(X.Trigger,o.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},p})(),Ee=(function(){function p(o,d,w,I,M){I===void 0&&(I=[]),M===void 0&&(M=[]),this.runtime=o,this.artboard=d,this.eventManager=w,this.animations=I,this.stateMachines=M}return p.prototype.add=function(o,d,w){if(w===void 0&&(w=!0),o=q(o),o.length===0)this.animations.forEach(function(ht){return ht.playing=d}),this.stateMachines.forEach(function(ht){return ht.playing=d});else for(var I=this.animations.map(function(ht){return ht.name}),M=this.stateMachines.map(function(ht){return ht.name}),V=0;V<o.length;V++){var ce=I.indexOf(o[V]),Se=M.indexOf(o[V]);if(ce>=0||Se>=0)ce>=0?this.animations[ce].playing=d:this.stateMachines[Se].playing=d;else{var _e=this.artboard.animationByName(o[V]);if(_e){var Be=new f.Animation(_e,this.artboard,this.runtime,d);Be.advance(0),Be.apply(1),this.animations.push(Be)}else{var Ze=this.artboard.stateMachineByName(o[V]);if(Ze){var It=new te(Ze,this.runtime,d,this.artboard);this.stateMachines.push(It)}}}}return w&&(d?this.eventManager.fire({type:J.Play,data:this.playing}):this.eventManager.fire({type:J.Pause,data:this.paused})),d?this.playing:this.paused},p.prototype.initLinearAnimations=function(o,d){for(var w=this.animations.map(function(Se){return Se.name}),I=0;I<o.length;I++){var M=w.indexOf(o[I]);if(M>=0)this.animations[M].playing=d;else{var V=this.artboard.animationByName(o[I]);if(V){var ce=new f.Animation(V,this.artboard,this.runtime,d);ce.advance(0),ce.apply(1),this.animations.push(ce)}else console.error("Animation with name ".concat(o[I]," not found."))}}},p.prototype.initStateMachines=function(o,d){for(var w=this.stateMachines.map(function(Se){return Se.name}),I=0;I<o.length;I++){var M=w.indexOf(o[I]);if(M>=0)this.stateMachines[M].playing=d;else{var V=this.artboard.stateMachineByName(o[I]);if(V){var ce=new te(V,this.runtime,d,this.artboard);this.stateMachines.push(ce),d||ce.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[I]," not found.")),this.initLinearAnimations([o[I]],d)}}},p.prototype.play=function(o){return this.add(o,!0)},p.prototype.pause=function(o){return this.add(o,!1)},p.prototype.scrub=function(o,d){var w=this.animations.filter(function(I){return o.includes(I.name)});return w.forEach(function(I){return I.scrubTo=d}),w.map(function(I){return I.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(o){var d=this;o=q(o);var w=[];if(o.length===0)w=this.animations.map(function(V){return V.name}).concat(this.stateMachines.map(function(V){return V.name})),this.animations.forEach(function(V){return V.cleanup()}),this.stateMachines.forEach(function(V){return V.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var I=this.animations.filter(function(V){return o.includes(V.name)});I.forEach(function(V){V.cleanup(),d.animations.splice(d.animations.indexOf(V),1)});var M=this.stateMachines.filter(function(V){return o.includes(V.name)});M.forEach(function(V){V.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(V),1)}),w=I.map(function(V){return V.name}).concat(M.map(function(V){return V.name}))}return this.eventManager.fire({type:J.Stop,data:w}),w},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,d)),w},p.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(I){return I.playing});o<d.length;o++){var w=d[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:J.Loop,data:{animation:w.name,type:ne.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:J.Loop,data:{animation:w.name,type:ne.PingPong}}),w.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var o=[],d=0,w=this.stateMachines.filter(function(M){return M.playing});d<w.length;d++){var I=w[d];o.push.apply(o,I.statesChanged)}o.length>0&&this.eventManager.fire({type:J.StateChange,data:o})},p.prototype.handleAdvancing=function(o){this.eventManager.fire({type:J.Advance,data:o})},p})(),J;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(J||(J={}));var ne;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(ne||(ne={}));var ye=(function(){function p(o){o===void 0&&(o=[]),this.listeners=o}return p.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},p.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},p.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var w=this.listeners[d];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(d,1);break}}},p.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return d.remove(w)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(w){return w.callback(o)})},p})(),Re=(function(){function p(o){this.eventManager=o,this.queue=[]}return p.prototype.add=function(o){this.queue.push(o)},p.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},p})(),he;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(he||(he={}));var be=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=he.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return g(this,function(w){return[2,new Promise(function(I){return setTimeout(I,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return[2,new Promise(function(w,I){return setTimeout(I,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:J.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return this._enabled||(this._enabled=!0,this._status=he.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!(this._status===he.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==he.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,w=function(){return S(d,void 0,void 0,function(){return g(this,function(I){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===he.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(ye),me=new be,at=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),ze=globalThis.ResizeObserver||at,Ve=(function(){function p(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var w=o._elementsMap.get(d.target);w!==null?w.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new ze(this._onObserved)}return p.prototype.add=function(o,d){var w={onResize:d,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},p.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},p})(),ot=new Ve,At=(function(){function p(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new ye,o.onLoad&&this.on(J.Load,o.onLoad),o.onLoadError&&this.on(J.LoadError,o.onLoadError)}return p.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,w,I,M;return g(this,function(V){switch(V.label){case 0:return this.src?(o=this,[4,ee(this.src)]):[3,2];case 1:o.buffer=V.sent(),V.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=w.assetLoader),I=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return I.file=V.sent(),this.destroyed?((M=this.file)===null||M===void 0||M.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:J.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return g(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,z.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return d=w.sent(),this.fireLoadError(d instanceof Error?d.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:J.LoadError,data:o}),new Error(o)},p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new fe(d):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),Oe=(function(){function p(o){var d=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(I){var M=d._hasZeroSize!==I;d._hasZeroSize=I,I?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():M&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=ot.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new B,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new ye,o.onLoad&&this.on(J.Load,o.onLoad),o.onLoadError&&this.on(J.LoadError,o.onLoadError),o.onPlay&&this.on(J.Play,o.onPlay),o.onPause&&this.on(J.Pause,o.onPause),o.onStop&&this.on(J.Stop,o.onStop),o.onLoop&&this.on(J.Loop,o.onLoop),o.onStateChange&&this.on(J.StateChange,o.onStateChange),o.onAdvance&&this.on(J.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(J.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(J.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(J.Play,o.onplay),o.onpause&&!o.onPause&&this.on(J.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(J.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(J.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(J.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Re(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(o)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(o){var d=this,w=o.src,I=o.buffer,M=o.riveFile,V=o.animations,ce=o.stateMachines,Se=o.artboard,_e=o.autoplay,Be=_e===void 0?!1:_e,Ze=o.useOffscreenRenderer,It=Ze===void 0?!1:Ze,ht=o.autoBind,Qt=ht===void 0?!1:ht;if(!this.destroyed){if(this.src=w,this.buffer=I,this.riveFile=M,!this.src&&!this.buffer&&!this.riveFile)throw new D(p.missingErrorMessage);var Kt=q(V),Dt=q(ce);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(Rt){d.destroyed||(d.runtime=Rt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,It),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(Se,Kt,Dt,Be,Qt).then(function(He){if(He)return d.setupRiveListeners()}).catch(function(He){console.error(He)}))}).catch(function(Rt){console.error(Rt)})}},p.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(M){return M.playing&&d.runtime.hasListeners(M.instance)}).map(function(M){return M.instance}),I=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(I=o.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:I,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var o=this,d;me.status==he.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:J.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},me.add(this._audioEventListener),me.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(o,d,w,I,M){return S(this,void 0,void 0,function(){var V,ce,Se,_e;return g(this,function(Be){switch(Be.label){case 0:return Be.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(V=new At({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=V,[4,V.init()]);case 1:if(Be.sent(),this.destroyed)return V.destroyIfUnused(),[2,!1];Be.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,w,I,M),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:J.Load,data:(_e=this.src)!==null&&_e!==void 0?_e:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return ce=Be.sent(),Se=P(ce),console.warn(Se),this.eventManager.fire({type:J.LoadError,data:Se}),[2,Promise.reject(Se)];case 4:return[2]}})})},p.prototype.initArtboard=function(o,d,w,I,M){if(this.file){var V=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!V){var ce="Invalid artboard name or no default artboard";console.warn(ce),this.eventManager.fire({type:J.LoadError,data:ce});return}if(this.artboard=V,V.volume=this._volume*me.systemVolume,this.artboard.animationCount()<1){var ce="Artboard has no animations";throw this.eventManager.fire({type:J.LoadError,data:ce}),ce}this.animator=new Ee(this.runtime,this.artboard,this.eventManager);var Se;if(d.length>0||w.length>0?(Se=d.concat(w),this.animator.initLinearAnimations(d,I),this.animator.initStateMachines(w,I)):Se=[this.animator.atLeastOne(I,!1)],this.taskQueue.add({event:{type:I?J.Play:J.Pause,data:Se}}),M){var _e=this.file.defaultArtboardViewModel(V);if(_e!==null){var Be=_e.defaultInstance();if(Be!==null){var Ze=new ae(Be,null);this.bindViewModelInstance(Ze)}}}}},p.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(o,d){var w;this.frameRequestId=null;var I=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var M=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var V=this.animator.animations.filter(function(mn){return mn.playing||mn.needsScrub}).sort(function(mn){return mn.needsScrub?-1:1}),ce=0,Se=V;ce<Se.length;ce++){var _e=Se[ce];_e.advance(M),_e.instance.didLoop&&(_e.loopCount+=1),_e.apply(1)}for(var Be=this.animator.stateMachines.filter(function(mn){return mn.playing}),Ze=0,It=Be;Ze<It.length;Ze++){var ht=It[Ze],Qt=ht.reportedEventCount();if(Qt)for(var Kt=0;Kt<Qt;Kt++){var Dt=ht.reportedEventAt(Kt);if(Dt)if(Dt.type===N.OpenUrl){if(this.eventManager.fire({type:J.RiveEvent,data:Dt}),this.automaticallyHandleEvents){var Rt=document.createElement("a"),He=Dt,Ct=He.url,St=He.target,Ut=(0,m.sanitizeUrl)(Ct);Ct&&Rt.setAttribute("href",Ut),St&&Rt.setAttribute("target",St),Ut&&Ut!==m.BLANK_URL&&Rt.click()}}else this.eventManager.fire({type:J.RiveEvent,data:Dt})}ht.advanceAndApply(M)}this.animator.stateMachines.length==0&&this.artboard.advance(M);var Ie=this.renderer;Ie.clear(),Ie.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Ie),Ie.restore(),Ie.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(M),this.frameCount++;var et=performance.now();for(this.frameTimes.push(et),this.durations.push(et-I);this.frameTimes[0]<=et-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var o=this,d=o.renderer,w=o.runtime,I=o._layout,M=o.artboard;d.align(I.runtimeFit(w),I.runtimeAlignment(w),{minX:I.minX,minY:I.minY,maxX:I.maxX,maxY:I.maxY},M.bounds,this._devicePixelRatioUsed*I.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ot.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(me.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},p.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},p.prototype.setTextRunValue=function(o,d){var w=this.retrieveTextRun(o);w&&(w.text=d)},p.prototype.play=function(o,d){var w=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(o){var d=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},p.prototype.scrub=function(o,d){var w=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},p.prototype.stop=function(o){var d=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(o){var d,w,I=o?.artboard,M=q(o?.animations),V=q(o?.stateMachines),ce=(d=o?.autoplay)!==null&&d!==void 0?d:!1,Se=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(I,M,V,ce,Se),this.taskQueue.process()},p.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),w=d.width,I=d.height,M=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=M,this.canvas.width=M*w,this.canvas.height=M*I,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===U.Layout){var V=this._layout.layoutScaleFactor;this.artboard.width=w/V,this.artboard.height=I/V}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(w){return w.name===o});return d?.inputs}},p.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,d);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},p.prototype.setBooleanStateAtPath=function(o,d,w){var I=this.retrieveInputAtPath(o,w);I&&(I.type===X.Boolean?I.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(o,d,w){var I=this.retrieveInputAtPath(o,w);I&&(I.type===X.Number?I.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},p.prototype.fireStateAtPath=function(o,d){var w=this.retrieveInputAtPath(o,d);w&&(w.type===X.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,d);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},p.prototype.getTextRunValueAtPath=function(o,d){var w=this.retrieveTextAtPath(o,d);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w.text},p.prototype.setTextRunValueAtPath=function(o,d,w){var I=this.retrieveTextAtPath(o,w);if(!I){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}I.text=d},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var w=this.file.artboardByIndex(d),I={name:w.name,animations:[],stateMachines:[]},M=0;M<w.animationCount();M++){var V=w.animationByIndex(M);I.animations.push(V.name)}for(var ce=0;ce<w.stateMachineCount();ce++){for(var Se=w.stateMachineByIndex(ce),_e=Se.name,Be=new this.runtime.StateMachineInstance(Se,w),Ze=[],It=0;It<Be.inputCount();It++){var ht=Be.input(It);Ze.push({name:ht.name,type:ht.type})}I.stateMachines.push({name:_e,inputs:Ze})}o.artboards.push(I)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*me.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new le(d):null},p.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new le(d):null},p.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new we(d)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new le(o)}return null},p.prototype.getArtboard=function(o){var d,w;return(w=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&w!==void 0?w:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),le=(function(){function p(o){this._viewModel=o}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new ae(d,null):null},p.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new ae(d,null):null},p.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new ae(o,null):null},p.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new ae(o,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),we=(function(){function p(o){this._dataEnum=o}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),re;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(re||(re={}));var ae=(function(){function p(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},p.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},p.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var w=this._parents[d];w.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},p.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},p.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},p.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},p.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},p.prototype.propertyFromPath=function(o,d){var w=o.split("/");return this.propertyFromPathSegments(w,0,d)},p.prototype.viewModelFromPathSegments=function(o,d){var w=this.internalViewModelInstance(o[d]);return w!==null?d==o.length-1?w:w.viewModelFromPathSegments(o,d++):null},p.prototype.propertyFromPathSegments=function(o,d,w){var I,M,V,ce,Se,_e,Be,Ze,It,ht,Qt,Kt,Dt,Rt,He,Ct,St,Ut;if(d<o.length-1){var Ie=this.internalViewModelInstance(o[d]);return Ie!==null?Ie.propertyFromPathSegments(o,d+1,w):null}var et=null;switch(w){case re.Number:if(et=(M=(I=this._runtimeInstance)===null||I===void 0?void 0:I.number(o[d]))!==null&&M!==void 0?M:null,et!==null)return new ut(et,this);break;case re.String:if(et=(ce=(V=this._runtimeInstance)===null||V===void 0?void 0:V.string(o[d]))!==null&&ce!==void 0?ce:null,et!==null)return new $e(et,this);break;case re.Boolean:if(et=(_e=(Se=this._runtimeInstance)===null||Se===void 0?void 0:Se.boolean(o[d]))!==null&&_e!==void 0?_e:null,et!==null)return new Ke(et,this);break;case re.Color:if(et=(Ze=(Be=this._runtimeInstance)===null||Be===void 0?void 0:Be.color(o[d]))!==null&&Ze!==void 0?Ze:null,et!==null)return new kt(et,this);break;case re.Trigger:if(et=(ht=(It=this._runtimeInstance)===null||It===void 0?void 0:It.trigger(o[d]))!==null&&ht!==void 0?ht:null,et!==null)return new ct(et,this);break;case re.Enum:if(et=(Kt=(Qt=this._runtimeInstance)===null||Qt===void 0?void 0:Qt.enum(o[d]))!==null&&Kt!==void 0?Kt:null,et!==null)return new rt(et,this);break;case re.List:if(et=(Rt=(Dt=this._runtimeInstance)===null||Dt===void 0?void 0:Dt.list(o[d]))!==null&&Rt!==void 0?Rt:null,et!==null)return new _t(et,this);break;case re.Image:if(et=(Ct=(He=this._runtimeInstance)===null||He===void 0?void 0:He.image(o[d]))!==null&&Ct!==void 0?Ct:null,et!==null)return new gt(et,this);break;case re.Artboard:if(et=(Ut=(St=this._runtimeInstance)===null||St===void 0?void 0:St.artboard(o[d]))!==null&&Ut!==void 0?Ut:null,et!==null)return new G(et,this);break}return null},p.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(w!==null){var I=new p(w,this);return I.internalIncrementReferenceCount(),this._viewModelInstances.set(o,I),I}return null},p.prototype.number=function(o){var d=this.propertyFromPath(o,re.Number);return d},p.prototype.string=function(o){var d=this.propertyFromPath(o,re.String);return d},p.prototype.boolean=function(o){var d=this.propertyFromPath(o,re.Boolean);return d},p.prototype.color=function(o){var d=this.propertyFromPath(o,re.Color);return d},p.prototype.trigger=function(o){var d=this.propertyFromPath(o,re.Trigger);return d},p.prototype.enum=function(o){var d=this.propertyFromPath(o,re.Enum);return d},p.prototype.list=function(o){var d=this.propertyFromPath(o,re.List);return d},p.prototype.image=function(o){var d=this.propertyFromPath(o,re.Image);return d},p.prototype.artboard=function(o){var d=this.propertyFromPath(o,re.Artboard);return d},p.prototype.viewModel=function(o){var d=o.split("/"),w=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return w!=null?w.internalViewModelInstance(d[d.length-1]):null},p.prototype.internalReplaceViewModel=function(o,d){var w;if(d.runtimeInstance!==null){var I=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,d.runtimeInstance))||!1;if(I){d.internalIncrementReferenceCount();var M=this.internalViewModelInstance(o);M!==null&&(M.removeParent(this),this._children.includes(M)&&(this._children=this._children.filter(function(V){return V!==M})),M.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return I}return!1},p.prototype.replaceViewModel=function(o,d){var w,I=o.split("/"),M=I.length>1?this.viewModelFromPathSegments(I.slice(0,I.length-1),0):this;return(w=M?.internalReplaceViewModel(I[I.length-1],d))!==null&&w!==void 0?w:!1},p.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return b({},d)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(I){I.cleanup()}),this._viewModelInstances.clear();var d=A([],this._children,!0);this._children.length=0;var w=A([],this._parents,!0);this._parents.length=0,d.forEach(function(I){I.removeParent(o)}),w.forEach(function(I){I.removeFromViewModelCallbacks(o)})}},p})(),ke=(function(){function p(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return p.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(o){},p.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),$e=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(ke),ut=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(ke),Ke=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(ke),ct=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(ke),rt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(ke),_t=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,w){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,w)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var w=this._viewModelInstanceValue.instanceAt(d);if(w!=null){var I=new ae(w,this._parentViewModel);return I}return null},o.prototype.swap=function(d,w){this._viewModelInstanceValue.swap(d,w)},o.prototype.internalHandleCallback=function(d){d()},o})(ke),kt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,w,I){this._viewModelInstanceValue.rgb(d,w,I)},o.prototype.rgba=function(d,w,I,M){this._viewModelInstanceValue.argb(M,d,w,I)},o.prototype.argb=function(d,w,I,M){this._viewModelInstanceValue.argb(d,w,I,M)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(ke),gt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(ke),G=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(ke),ee=function(p){return S(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(I){switch(I.label){case 0:return o=new Request(p),[4,fetch(o)];case 1:return d=I.sent(),[4,d.arrayBuffer()];case 2:return w=I.sent(),[2,w]}})})},q=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},se={EventManager:ye,TaskQueueManager:Re},ve=function(p){return S(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeAudio(p,M)})}),[4,o];case 1:return d=I.sent(),w=new m.AudioWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},Ce=function(p){return S(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeImage(p,M)})}),[4,o];case 1:return d=I.sent(),w=new m.ImageWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},Ae=function(p){return S(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeFont(p,M)})}),[4,o];case 1:return d=I.sent(),w=new m.FontWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})}})(),l})())})(as)),as.exports}var $v=Dv();const Ru="dracula",gs="https://vycjpmuyscfygstjjied.supabase.co";var Fv=oe('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function El(n,e){Ht(e,!0);let t=As(e,"bucketName",3,Ru),r=lt(void 0);Ai(()=>{if(!E(r))return;const u=new $v.Rive({src:`${gs}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:E(r),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var s=Fv(),l=R(s);fs(l,u=>xe(r,u),()=>E(r)),Y(n,s),Gt()}function Uv(n,e,t,r,s,l){e()?t.onLose?t.onLose():r("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var Nv=oe('<div class="info-item svelte-zdkig8"><button class="btn btn-danger svelte-zdkig8">🏳️ Сдаться</button></div>'),Bv=oe('<div role="button" tabindex="0"> </div>'),Wv=gd('<polyline class="connection-line svelte-zdkig8" vector-effect="non-scaling-stroke"></polyline>'),Vv=oe("<button> </button>"),qv=oe('<div id="modal-overlay"><div class="modal-content svelte-zdkig8"><div class="modal-title svelte-zdkig8"> </div> <div class="modal-text svelte-zdkig8"> </div> <div class="modal-buttons svelte-zdkig8"></div></div></div>'),zv=oe('<div class="body-wrapper svelte-zdkig8"><div id="game-info" class="svelte-zdkig8"><div class="info-item svelte-zdkig8"><span class="svelte-zdkig8">Осталось: <strong id="tiles-count" class="svelte-zdkig8"> </strong></span></div> <div class="info-item svelte-zdkig8"><button class="btn btn-secondary svelte-zdkig8">💡 Подсказка</button></div> <div class="info-item svelte-zdkig8"><button class="btn btn-secondary svelte-zdkig8">Новая игра</button></div> <!></div> <div id="game-container" class="svelte-zdkig8"><div id="grid" class="svelte-zdkig8"></div> <svg id="line-layer" class="svelte-zdkig8"><!></svg></div></div> <!>',1);function Hv(n,e){Ht(e,!0);let t=As(e,"integrated",3,!1);const r=jd(),s=8,l=6,u=["🧛","🦇","👻","💀","🔥","🕷️","🕸️","🧟","🧙‍♀️","⚰️","🪦","🦴","🔮","🧪","👹","🌜","👽","🤡","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","👁️"];let h=lt(zt([])),f=lt(zt([])),m=lt(zt({})),_=lt(zt([])),b=lt(null),S=lt(!1),g=lt(!1),A=lt(zt([])),D=lt(0),P=lt(zt({show:!1,title:"",text:"",actions:[]})),U,W;Ai(()=>{X()});function B(){if(!E(f)||E(f).length===0)return 0;let G=0;for(let ee=0;ee<s;ee++)for(let q=0;q<l;q++)E(f)[ee]&&!E(f)[ee][q]&&G++;return G}let z=Oa(B);function X(){xe(h,[],!0),xe(f,[],!0),xe(b,null),xe(S,!1),xe(g,!1),xe(m,{},!0),xe(_,[],!0),xe(A,[],!0),me();let G=[...new Set(u)];for(;G.length<s*l/2;)G=[...G,...G];let ee=G.sort(()=>.5-Math.random()).slice(0,s*l/2),q=[];ee.forEach(ve=>q.push(ve,ve)),q.sort(()=>Math.random()-.5);let se=0;for(let ve=0;ve<s;ve++){let Ce=[],Ae=[];for(let p=0;p<l;p++)Ce.push(q[se++]),Ae.push(!1);E(h).push(Ce),E(f).push(Ae)}setTimeout(te,500)}async function L(G,ee){if(E(S)||E(f)[G][ee]||E(g))return;if(E(_).length>0&&xe(_,[],!0),!E(b)){xe(b,{r:G,c:ee},!0);return}if(E(b).r===G&&E(b).c===ee){xe(b,null);return}const q=E(h)[E(b).r][E(b).c],se=E(h)[G][ee];if(q===se){const ve=Re(E(b).r,E(b).c,G,ee);if(ve){xe(S,!0),await he(ve),E(f)[E(b).r][E(b).c]=!0,E(f)[G][ee]=!0,xe(b,null),xe(S,!1),te();return}}xe(b,{r:G,c:ee},!0)}async function N(G,ee,q){(q.key==="Enter"||q.key===" ")&&(q.preventDefault(),await L(G,ee))}function fe(){if(E(S)||E(g))return;let G=[];for(let q=0;q<s;q++)for(let se=0;se<l;se++)E(f)[q][se]||G.push({r:q,c:se,icon:E(h)[q][se]});let ee={};G.forEach(q=>{ee[q.icon]||(ee[q.icon]=[]),ee[q.icon].push(q)});for(let q in ee){let se=ee[q];if(!(se.length<2))for(let ve=0;ve<se.length;ve++)for(let Ce=ve+1;Ce<se.length;Ce++){let Ae=se[ve],p=se[Ce];if(Re(Ae.r,Ae.c,p.r,p.c)){xe(_,[Ae,p],!0),setTimeout(()=>xe(_,[],!0),1500);return}}}be("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:me}])}function te(){if(E(z)===0){xe(g,!0),t()?e.onWin?e.onWin():r("win"):be("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:X}]);return}Ee()||(t()?setTimeout(()=>J(),1e3):be("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{me(),J()}},{text:"Сдаться",action:()=>{be("Конец","Попытайте удачу снова!",[{text:"ОК",action:X}])}}]))}function Ee(){let G=[];for(let q=0;q<s;q++)for(let se=0;se<l;se++)E(f)[q][se]||G.push({r:q,c:se,icon:E(h)[q][se]});let ee={};G.forEach(q=>{ee[q.icon]||(ee[q.icon]=[]),ee[q.icon].push(q)});for(let q in ee){let se=ee[q];if(!(se.length<2)){for(let ve=0;ve<se.length;ve++)for(let Ce=ve+1;Ce<se.length;Ce++)if(Re(se[ve].r,se[ve].c,se[Ce].r,se[Ce].c))return!0}}return!1}function J(){let G=[],ee=[];for(let q=0;q<s;q++)for(let se=0;se<l;se++)E(f)[q][se]||(G.push(E(h)[q][se]),ee.push({r:q,c:se}));G.length!==0&&(G.sort(()=>Math.random()-.5),ee.forEach((q,se)=>{E(h)[q.r][q.c]=G[se],E(m)[`${q.r},${q.c}`]=!0}),setTimeout(()=>{xe(m,{},!0),Ee()?xe(g,!1):J()},500))}function ne(G,ee){return G<0||G>=s||ee<0||ee>=l?!0:E(f)[G][ee]}function ye(G,ee,q,se){if(G!==q&&ee!==se)return!1;if(G===q){const ve=Math.min(ee,se),Ce=Math.max(ee,se);for(let Ae=ve+1;Ae<Ce;Ae++)if(!ne(G,Ae))return!1}else{const ve=Math.min(G,q),Ce=Math.max(G,q);for(let Ae=ve+1;Ae<Ce;Ae++)if(!ne(Ae,ee))return!1}return!0}function Re(G,ee,q,se){if(ye(G,ee,q,se))return[{r:G,c:ee},{r:q,c:se}];let ve={r:G,c:se};if(ne(ve.r,ve.c)&&ye(G,ee,ve.r,ve.c)&&ye(ve.r,ve.c,q,se))return[{r:G,c:ee},ve,{r:q,c:se}];let Ce={r:q,c:ee};if(ne(Ce.r,Ce.c)&&ye(G,ee,Ce.r,Ce.c)&&ye(Ce.r,Ce.c,q,se))return[{r:G,c:ee},Ce,{r:q,c:se}];for(let Ae=-1;Ae<=s;Ae++){if(Ae===G||Ae===q)continue;let p={r:Ae,c:ee},o={r:Ae,c:se};if(ne(p.r,p.c)&&ne(o.r,o.c)&&ye(G,ee,p.r,p.c)&&ye(p.r,p.c,o.r,o.c)&&ye(o.r,o.c,q,se))return[{r:G,c:ee},p,o,{r:q,c:se}]}for(let Ae=-1;Ae<=l;Ae++){if(Ae===ee||Ae===se)continue;let p={r:G,c:Ae},o={r:q,c:Ae};if(ne(p.r,p.c)&&ne(o.r,o.c)&&ye(G,ee,p.r,p.c)&&ye(p.r,p.c,o.r,o.c)&&ye(o.r,o.c,q,se))return[{r:G,c:ee},p,o,{r:q,c:se}]}return null}async function he(G){if(await su(),!U||!W)return;const ee=U.getBoundingClientRect(),q=W.getBoundingClientRect(),se=W.querySelector(".cell");if(!se)return;const ve=se.offsetWidth,Ce=se.offsetHeight,Ae=window.getComputedStyle(W),p=parseFloat(Ae.gap)||4,o=q.left-ee.left,d=q.top-ee.top,w=G.map(I=>{let M,V;if(I.r>=0&&I.r<s&&I.c>=0&&I.c<l){const Se=W.children[I.r*l+I.c].getBoundingClientRect();M=Se.left-ee.left+Se.width/2,V=Se.top-ee.top+Se.height/2}else{const ce=I.c*(ve+p)+ve/2,Se=I.r*(Ce+p)+Ce/2;M=o+ce,V=d+Se}return`${M.toFixed(1)},${V.toFixed(1)}`}).join(" ");return xe(A,w,!0),Jc(D),new Promise(I=>{setTimeout(()=>{xe(A,[],!0),I()},350)})}function be(G,ee,q){t()||xe(P,{show:!0,title:G,text:ee,actions:q},!0)}function me(){E(P).show=!1}var at=zv(),ze=Lt(at),Ve=R(ze),ot=R(Ve),At=R(ot),Oe=$(R(At)),le=R(Oe),we=$(ot,2),re=R(we);re.__click=fe;var ae=$(we,2),ke=R(ae);ke.__click=X;var $e=$(ae,2);{var ut=G=>{var ee=Nv(),q=R(ee);q.__click=[Uv,t,e,r,be,X],Y(G,ee)};De($e,G=>{t()&&G(ut)})}var Ke=$(Ve,2),ct=R(Ke);Id(ct,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),yt(ct,21,()=>E(h),Bt,(G,ee,q)=>{var se=Yt(),ve=Lt(se);yt(ve,17,()=>E(ee),Bt,(Ce,Ae,p)=>{var o=Bv();let d;o.__click=()=>L(q,p),o.__keydown=I=>N(q,p,I);var w=R(o);Te(I=>{d=gn(o,1,"cell svelte-zdkig8",null,d,I),Pe(w,E(Ae))},[()=>({selected:E(b)?.r===q&&E(b)?.c===p,matched:E(f)[q][p],shuffling:E(m)[`${q},${p}`],"hint-glow":E(_).some(I=>I.r===q&&I.c===p)})]),Y(Ce,o)}),Y(G,se)}),fs(ct,G=>W=G,()=>W);var rt=$(ct,2),_t=R(rt);fa(_t,()=>E(D),G=>{var ee=Yt(),q=Lt(ee);{var se=ve=>{var Ce=Wv();Te(()=>je(Ce,"points",E(A))),Y(ve,Ce)};De(q,ve=>{E(A)&&ve(se)})}Y(G,ee)}),fs(Ke,G=>U=G,()=>U);var kt=$(ze,2);{var gt=G=>{var ee=qv();let q;var se=R(ee),ve=R(se),Ce=R(ve),Ae=$(ve,2),p=R(Ae),o=$(Ae,2);yt(o,21,()=>E(P).actions,d=>d.text,(d,w)=>{var I=Vv();let M;I.__click=function(...ce){E(w).action?.apply(this,ce)};var V=R(I);Te(ce=>{M=gn(I,1,"btn svelte-zdkig8",null,M,ce),Pe(V,E(w).text)},[()=>({"btn-secondary":E(w).class==="btn-secondary"})]),Y(d,I)}),Te(d=>{q=gn(ee,1,"svelte-zdkig8",null,q,d),Pe(Ce,E(P).title),Pe(p,E(P).text)},[()=>({active:E(P).show})]),Y(G,ee)};De(kt,G=>{E(P).show&&G(gt)})}Te(()=>Pe(le,E(z))),Y(n,at),Gt()}Xt(["click","keydown"]);function Gv(n,e){e.onLose()}var Kv=oe('<div class="loading svelte-1rtkeyj">Загрузка игры...</div>'),Yv=oe('<div class="minigame-container svelte-1rtkeyj"><button class="exit-btn svelte-1rtkeyj">✕ Выйти из игры</button> <!></div>');function Jv(n,e){Ht(e,!0);let t=lt(null),r;Ai(()=>{s()});function s(){switch(console.log(e.gameId),e.gameId){case"onet_monsters":xe(t,Hv,!0);break;default:console.error(`Unknown game ID: ${e.gameId}`),e.onLose()}}function l(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function u(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var h=Yv(),f=R(h);f.__click=[Gv,e];var m=$(f,2);{var _=S=>{var g=Yt(),A=Lt(g);kd(A,()=>E(t),(D,P)=>{P(D,{onwin:l,onlose:u})}),Y(S,g)},b=S=>{var g=Kv();Y(S,g)};De(m,S=>{E(t)?S(_):S(b,!1)})}fs(h,S=>r=S,()=>r),Y(n,h),Gt()}Xt(["click"]);function Xv(n,e){E(e)?.nextDialogueId&&mt.goToDialogue(E(e).nextDialogueId)}var Qv=oe('<img alt="BG" class="background-image svelte-dd9wj5"/>'),Zv=oe('<div class="background-media svelte-dd9wj5"><!></div>'),ep=oe('<img alt="Char" class="character-image svelte-dd9wj5"/>'),tp=oe('<div class="character-media svelte-dd9wj5"><!></div>'),np=(n,e,t)=>e(E(t)),rp=oe('<button class="option-button svelte-dd9wj5"> </button>'),ip=oe('<div class="options-container svelte-dd9wj5"></div>'),sp=oe('<div class="next-container svelte-dd9wj5"><button class="next-button svelte-dd9wj5">Далее...</button></div>'),ap=oe('<div class="dialogue-container svelte-dd9wj5"><!> <!> <!> <div class="dialogue-content svelte-dd9wj5"><div class="dialogue-text svelte-dd9wj5"> </div> <!></div></div>'),op=oe("<p> </p>");function ju(n,e){Ht(e,!0);let t=As(e,"bucketName",3,Ru);console.log(t());const r=Oa(()=>e.dialogue||mt.findDialogue(mt.currentDialogueId));let s=lt(null);Yr(()=>{E(r)?.onEnter&&mt.runActions(E(r).onEnter)});function l(g){if(g.actions&&mt.runActions(g.actions),g.miniGame){console.log("Запуск мини-игры:",g.miniGame.id),xe(s,{gameId:g.miniGame.id,onWinDialogueId:g.miniGame.onWinDialogueId,onLoseDialogueId:g.miniGame.onLoseDialogueId,rewardItem:g.miniGame.rewardItem},!0);return}g.nextDialogueId&&mt.goToDialogue(g.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),E(s)?.rewardItem&&mt.addItem(E(s).rewardItem),E(s)?.onWinDialogueId&&mt.goToDialogue(E(s).onWinDialogueId),xe(s,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),E(s)?.onLoseDialogueId&&mt.goToDialogue(E(s).onLoseDialogueId),xe(s,null)}function f(g){return g.visibleIf&&g.visibleIf.hasItem?mt.hasItem(g.visibleIf.hasItem):!0}var m=Yt(),_=Lt(m);{var b=g=>{var A=ap(),D=R(A);{var P=J=>{Jv(J,{get gameId(){return E(s).gameId},onWin:u,onLose:h})};De(D,J=>{E(s)&&J(P)})}var U=$(D,2);{var W=J=>{var ne=Zv(),ye=R(ne);{var Re=be=>{var me=Yt(),at=Lt(me);fa(at,()=>E(r).backgroundImage,ze=>{El(ze,{get fileName(){return E(r).backgroundImage},get bucketName(){return t()}})}),Y(be,me)},he=be=>{var me=Qv();Te(()=>je(me,"src",`${gs}/storage/v1/object/public/${t()}/${E(r).backgroundImage}`)),Y(be,me)};De(ye,be=>{E(r).backgroundImage.endsWith(".riv")?be(Re):be(he,!1)})}Y(J,ne)};De(U,J=>{E(r).backgroundImage&&J(W)})}var B=$(U,2);{var z=J=>{var ne=tp(),ye=R(ne);{var Re=be=>{var me=Yt(),at=Lt(me);fa(at,()=>E(r).characterImage,ze=>{El(ze,{get fileName(){return E(r).characterImage},get bucketName(){return t()}})}),Y(be,me)},he=be=>{var me=ep();Te(()=>je(me,"src",`${gs}/storage/v1/object/public/${t()}/${E(r).characterImage}`)),Y(be,me)};De(ye,be=>{E(r).characterImage.endsWith(".riv")?be(Re):be(he,!1)})}Y(J,ne)};De(B,J=>{E(r).characterImage&&J(z)})}var X=$(B,2),L=R(X),N=R(L),fe=$(L,2);{var te=J=>{var ne=ip();yt(ne,21,()=>E(r).options,ye=>ye.text,(ye,Re)=>{var he=Yt(),be=Lt(he);{var me=at=>{var ze=rp();ze.__click=[np,l,Re];var Ve=R(ze);Te(()=>Pe(Ve,E(Re).text)),Y(at,ze)};De(be,at=>{f(E(Re))&&at(me)})}Y(ye,he)}),Y(J,ne)},Ee=J=>{var ne=Yt(),ye=Lt(ne);{var Re=he=>{var be=sp(),me=R(be);me.__click=[Xv,r],Y(he,be)};De(ye,he=>{E(r).nextDialogueId&&he(Re)},!0)}Y(J,ne)};De(fe,J=>{E(r).options&&E(r).options.length>0?J(te):J(Ee,!1)})}Te(()=>Pe(N,E(r).text)),Y(g,A)},S=g=>{var A=op(),D=R(A);Te(()=>Pe(D,`Диалог не найден (ID: ${mt.currentDialogueId??""})`)),Y(g,A)};De(_,g=>{E(r)?g(b):g(S,!1)})}Y(n,m),Gt()}Xt(["click"]);var sa=br(()=>x),lp=oe('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),up=oe('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),cp=oe('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),dp=oe('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),hp=oe('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),fp=oe('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),vp=oe('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function pp(n,e){Ht(e,!1);function t(){sa(sa().editingOptionIndex=null)}wr();var r=vp(),s=R(r),l=$(R(s),2);l.__click=t;var u=$(s,2),h=R(u);{var f=_=>{var b=hp(),S=R(b);{let ne=ei(()=>sa().selectedBucket||void 0);ju(S,{get dialogue(){return Ft.currentDialogue},index:0,get bucketName(){return E(ne)}})}var g=$(S,2),A=R(g),D=$(R(A),2),P=R(D),U=$(A,2),W=$(R(U),2),B=R(W),z=$(U,2);{var X=ne=>{var ye=lp(),Re=$(R(ye),2),he=R(Re);Te(()=>Pe(he,Ft.currentDialogue.backgroundImage)),Y(ne,ye)};De(z,ne=>{Ft.currentDialogue.backgroundImage&&ne(X)})}var L=$(z,2);{var N=ne=>{var ye=up(),Re=$(R(ye),2),he=R(Re);Te(()=>Pe(he,Ft.currentDialogue.characterImage)),Y(ne,ye)};De(L,ne=>{Ft.currentDialogue.characterImage&&ne(N)})}var fe=$(g,2);{var te=ne=>{var ye=cp();Y(ne,ye)};De(fe,ne=>{(!Ft.currentDialogue.options||Ft.currentDialogue.options.length===0)&&ne(te)})}var Ee=$(fe,2);{var J=ne=>{var ye=dp();Y(ne,ye)};De(Ee,ne=>{Ft.currentDialogue.options?.some(ye=>!ye.nextDialogueId)&&ne(J)})}Te(()=>{Pe(P,Ft.currentDialogue.id),Pe(B,Ft.currentChapter?.title||"Без главы")}),Y(_,b)},m=_=>{var b=fp();Y(_,b)};De(h,_=>{Ft.currentDialogue?_(f):_(m,!1)})}Y(n,r),Gt()}Xt(["click"]);const gp=["dracula","zombie","fairy_tale","minigames"];function xu(){const n=gp.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return pt.updateBucketsList(n),n}var ar=br(()=>x),mp=oe('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),_p=(n,e,t)=>e(E(t).name),yp=oe('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),wp=oe('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),bp=oe('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function kp(n,e){Ht(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};Ai(()=>{r()});function r(){xu()}async function s(h){ar(ar().selectedBucket=h),ar(ar().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Kn.loadStoriesList(),await Kn.loadStoredResources()}wr();var l=bp(),u=$(R(l),2);yt(u,5,()=>ar().availableBuckets,h=>h,(h,f)=>{const m=ei(()=>t[E(f).id]||{title:E(f),description:"Интерактивная история",icon:"📖"});var _=wp();let b;var S=R(_),g=R(S),A=R(g),D=$(g,2),P=R(D),U=R(P),W=$(P,2),B=R(W),z=$(S,2),X=R(z);{var L=fe=>{var te=mp();Y(fe,te)},N=fe=>{var te=yp();te.__click=[_p,s,f],Y(fe,te)};De(X,fe=>{ar().selectedBucket===E(f).name?fe(L):fe(N,!1)})}Te(fe=>{b=gn(_,1,"bucket-card svelte-1cmn6ru",null,b,fe),Pe(A,E(m).icon),Pe(U,E(m).title),Pe(B,E(m).description)},[()=>({selected:ar().selectedBucket===E(f).name})]),Y(h,_)}),Y(n,l),Gt()}Xt(["click"]);var Sp=oe("<span> </span>"),Ep=oe('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Ip=oe('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Ap=oe('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Cp=oe('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Tp(n,e){Ht(e,!0),Ai(async()=>{xu(),x.availableBuckets.length>0&&!x.selectedBucket&&(x.selectedBucket=x.availableBuckets[0].name)}),Yr(async()=>{if(x.selectedBucket){console.log(`[Editor] Bucket выбран: ${x.selectedBucket}`),await Kn.loadStoredResources();const u=`${x.selectedBucket}_story.json`;x.currentFileName=u,await dr.loadStory(u)}});var t=Yt(),r=Lt(t);{var s=u=>{kp(u,{})},l=u=>{var h=Cp(),f=R(h),m=R(f),_=R(m);_.__click=()=>x.selectedBucket=null;var b=$(_,2),S=R(b),g=$(m,2),A=R(g),D=R(A),P=$(A,2);{var U=he=>{var be=Sp(),me=R(be);Te(()=>{gn(be,1,`status-message ${x.statusMessage.type??""}`,"svelte-1k4krym"),Pe(me,x.statusMessage.text)}),Y(he,be)};De(P,he=>{x.statusMessage.text&&he(U)})}var W=$(P,2);W.__click=function(...he){dr.saveCurrentStory?.apply(this,he)};var B=$(W,2);B.__click=function(...he){dr.saveStoryCopy?.apply(this,he)};var z=$(f,2),X=R(z);Gf(X,{});var L=$(X,2),N=R(L);{var fe=he=>{var be=Ep(),me=R(be),at=R(me);Te(()=>Pe(at,`Загружено: ${x.data.meta?.title??""} |
              Глав: ${(x.data.chapters?.length||0)??""} |
              Диалогов: ${(x.data.dialogues?.length||0)??""} |
              Предметов: ${(x.data.items?.length||0)??""}`)),Y(he,be)},te=he=>{var be=Ip();Y(he,be)};De(N,he=>{x.data?he(fe):he(te,!1)})}var Ee=$(N,2);Ov(Ee,{});var J=$(Ee,2);{var ne=he=>{bv(he,{get editor(){return x},get storyActions(){return dr},get resourceActions(){return Kn}})},ye=he=>{var be=Ap();Y(he,be)};De(J,he=>{Ft.currentDialogue?he(ne):he(ye,!1)})}var Re=$(L,2);pp(Re,{}),Te(()=>{Pe(S,`Story Editor v3.1 - ${x.selectedBucket??""}`),Pe(D,x.currentFileName||"Нет файла")}),Y(u,h)};De(r,u=>{x.selectedBucket?u(l,!1):u(s)})}Y(n,t),Gt()}Xt(["click"]);var aa=br(()=>mt),Pp=(n,e,t)=>e(E(t)),Rp=(n,e,t)=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e(E(t)))},jp=oe('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),xp=oe('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function Op(n,e){Ht(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function r(u){aa(aa().selectedStory=u)}wr();var s=xp(),l=$(R(s),2);yt(l,5,()=>aa().availableStories,u=>u,(u,h)=>{const f=ei(()=>t[E(h)]||{title:E(h),description:"Интерактивная история",icon:"📖"});var m=jp();m.__click=[Pp,r,h],m.__keydown=[Rp,r,h];var _=R(m),b=R(_),S=$(_,2),g=R(S),A=R(g),D=$(g,2),P=R(D);Te(()=>{Pe(b,E(f).icon),Pe(A,E(f).title),Pe(P,E(f).description)}),Y(u,m)}),Y(n,s),Gt()}Xt(["click","keydown"]);var Mp=oe('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),Lp=oe('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),Dp=oe('<div class="game-container svelte-14svm27"><button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),$p=oe('<div class="app svelte-14svm27"><!></div>');function Fp(n,e){Ht(e,!0),Yr(async()=>{if(mt.selectedStory){const u=`${mt.selectedStory}_story.json`,h=`${gs}/storage/v1/object/public/${mt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await mt.loadStory(h)}});var t=$p(),r=R(t);{var s=u=>{Op(u,{})},l=u=>{var h=Yt(),f=Lt(h);{var m=b=>{var S=Mp();Y(b,S)},_=b=>{var S=Yt(),g=Lt(S);{var A=P=>{var U=Lp(),W=R(U),B=$(W);B.__click=()=>mt.selectedStory=null,Te(()=>Pe(W,`⚠️ ${mt.error??""} `)),Y(P,U)},D=P=>{var U=Dp(),W=R(U);W.__click=()=>mt.selectedStory=null;var B=$(W,2),z=R(B);{var X=L=>{{let N=Oa(()=>mt.selectedStory||void 0);ju(L,{get bucketName(){return E(N)}})}};De(z,L=>{mt.storyData&&L(X)})}Y(P,U)};De(g,P=>{mt.error?P(A):P(D,!1)},!0)}Y(b,S)};De(f,b=>{mt.isLoading?b(m):b(_,!1)},!0)}Y(u,h)};De(r,u=>{mt.selectedStory?u(l,!1):u(s)})}Y(n,t),Gt()}Xt(["click"]);var Up=oe('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),Np=oe('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function Bp(n,e){Ht(e,!1),wr();var t=Yt(),r=Lt(t);{var s=u=>{var h=Up(),f=Lt(h);f.__click=function(..._){pt.toggleEditor?.apply(this,_)};var m=$(f,2);Tp(m,{}),Y(u,h)},l=u=>{var h=Np(),f=Lt(h);f.__click=function(..._){pt.toggleEditor?.apply(this,_)};var m=$(f,2);Fp(m,{}),Y(u,h)};De(r,u=>{x.showEditor?u(s):u(l,!1)})}Y(n,t),Gt()}Xt(["click"]);md(Bp,{target:document.getElementById("app")});
