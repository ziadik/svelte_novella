(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const El=!1;var hs=Array.isArray,Zu=Array.prototype.indexOf,ma=Array.from,ea=Object.defineProperty,Fn=Object.getOwnPropertyDescriptor,Sl=Object.getOwnPropertyDescriptors,ec=Object.prototype,tc=Array.prototype,ya=Object.getPrototypeOf,xo=Object.isExtensible;function rc(r){return r()}function ts(r){for(var e=0;e<r.length;e++)r[e]()}function nc(){var r,e,t=new Promise((n,s)=>{r=n,e=s});return{promise:t,resolve:r,reject:e}}const Gt=2,wa=4,fs=8,Gn=16,Mr=32,fn=64,Al=128,Zt=256,rs=512,Rt=1024,er=2048,Gr=4096,ur=8192,vn=16384,ba=32768,ka=65536,Mo=1<<17,ic=1<<18,yi=1<<19,Il=1<<20,ta=1<<21,Ea=1<<22,cn=1<<23,jr=Symbol("$state"),sc=Symbol("legacy props"),ac=Symbol(""),Sa=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function oc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function lc(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function uc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function cc(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function dc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function hc(r){throw new Error("https://svelte.dev/e/effect_orphan")}function fc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function vc(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function pc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function gc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function _c(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const vs=1,ps=2,Cl=4,mc=8,yc=16,wc=1,bc=2,kc=4,Ec=8,Sc=16,Ac=1,Ic=2,kt=Symbol(),Cc="http://www.w3.org/1999/xhtml";function Tc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Pc=!1;function Tl(r){return r===this.v}function Pl(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Rc(r,e){return r!==e}function Rl(r){return!Pl(r,this.v)}let Kn=!1,jc=!1;function Oc(){Kn=!0}let dt=null;function ns(r){dt=r}function tr(r,e=!1,t){dt={p:dt,c:null,e:null,s:r,x:null,l:Kn&&!e?{s:null,u:null,$:[]}:null}}function rr(r){var e=dt,t=e.e;if(t!==null){e.e=null;for(var n of t)ql(n)}return dt=e.p,{}}function Yn(){return!Kn||dt!==null&&dt.l===null}const xc=new WeakMap;function Mc(r){var e=Ve;if(e===null)return ze.f|=cn,r;if((e.f&ba)===0){if((e.f&Al)===0)throw!e.parent&&r instanceof Error&&jl(r),r;e.b.error(r)}else Aa(r,e)}function Aa(r,e){for(;e!==null;){if((e.f&Al)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&jl(r),r}function jl(r){const e=xc.get(r);e&&(ea(r,"message",{value:e.message}),ea(r,"stack",{value:e.stack}))}let pi=[],ra=[];function Ol(){var r=pi;pi=[],ts(r)}function Lc(){var r=ra;ra=[],ts(r)}function xl(r){pi.length===0&&queueMicrotask(Ol),pi.push(r)}function Dc(){pi.length>0&&Ol(),ra.length>0&&Lc()}function $c(){for(var r=Ve.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&oc(),r}function wi(r){var e=Gt|er,t=ze!==null&&(ze.f&Gt)!==0?ze:null;return Ve===null||t!==null&&(t.f&Zt)!==0?e|=Zt:Ve.f|=yi,{ctx:dt,deps:null,effects:null,equals:Tl,f:e,fn:r,reactions:null,rv:0,v:kt,wv:0,parent:t??Ve,ac:null}}function Fc(r,e){let t=Ve;t===null&&uc();var n=t.b,s=void 0,l=Vn(kt),c=null,h=!ze;return ed(()=>{try{var v=r();c&&Promise.resolve(v).catch(()=>{})}catch(g){v=Promise.reject(g)}var m=()=>v;s=c?.then(m,m)??Promise.resolve(v),c=s;var _=nt,k=n.pending;h&&(n.update_pending_count(1),k||_.increment());const E=(g,S=void 0)=>{c=null,k||_.activate(),S?S!==Sa&&(l.f|=cn,qn(l,S)):((l.f&cn)!==0&&(l.f^=cn),qn(l,g)),h&&(n.update_pending_count(-1),k||_.decrement()),Dl()};if(s.then(E,g=>E(null,g||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(v=>{function m(_){function k(){_===s?v(l):m(s)}_.then(k,k)}m(s)})}function Uc(r){const e=wi(r);return Xl(e),e}function gs(r){const e=wi(r);return e.equals=Rl,e}function Ml(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)xr(e[t])}}function Nc(r){for(var e=r.parent;e!==null;){if((e.f&Gt)===0)return e;e=e.parent}return null}function Ia(r){var e,t=Ve;Hr(Nc(r));try{Ml(r),e=tu(r)}finally{Hr(t)}return e}function Ll(r){var e=Ia(r);if(r.equals(e)||(r.v=e,r.wv=Zl()),!gn){var t=(Wr||(r.f&Zt)!==0)&&r.deps!==null?Gr:Rt;Nt(r,t)}}function Bc(r,e,t){const n=Yn()?wi:gs;if(e.length===0){t(r.map(n));return}var s=nt,l=Ve,c=Wc(),h=$c();Promise.all(e.map(v=>Fc(v))).then(v=>{s?.activate(),c();try{t([...r.map(n),...v])}catch(m){(l.f&vn)===0&&Aa(m,l)}s?.deactivate(),Dl()}).catch(v=>{h.error(v)})}function Wc(){var r=Ve,e=ze,t=dt,n=nt;return function(){Hr(r),br(e),ns(t),n?.activate()}}function Dl(){Hr(null),br(null),ns(null)}const Us=new Set;let nt=null,Qi=null,Lo=new Set,is=[];function $l(){const r=is.shift();is.length>0&&queueMicrotask($l),r()}let hn=[],_s=null,na=!1,Zi=!1;class Bn{current=new Map;#r=new Map;#t=new Set;#e=0;#n=null;#i=!1;#a=[];#l=[];#o=[];#s=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){hn=[],Qi=null;for(const s of e)this.#v(s);if(this.#a.length===0&&this.#e===0){this.#f();var t=this.#o,n=this.#s;this.#o=[],this.#s=[],this.#u=[],Qi=nt,nt=null,Do(t),Do(n),nt===null?nt=this:Us.delete(this),this.#n?.resolve()}else this.#c(this.#o),this.#c(this.#s),this.#c(this.#u);for(const s of this.#a)Nn(s);for(const s of this.#l)Nn(s);this.#a=[],this.#l=[]}#v(e){e.f^=Rt;for(var t=e.first;t!==null;){var n=t.f,s=(n&(Mr|fn))!==0,l=s&&(n&Rt)!==0,c=l||(n&ur)!==0||this.skipped_effects.has(t);if(!c&&t.fn!==null){if(s)t.f^=Rt;else if((n&wa)!==0)this.#s.push(t);else if((n&Rt)===0)if((n&Ea)!==0){var h=t.b?.pending?this.#l:this.#a;h.push(t)}else ws(t)&&((t.f&Gn)!==0&&this.#u.push(t),Nn(t));var v=t.first;if(v!==null){t=v;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&er)!==0?this.#d:this.#h).push(t),Nt(t,Rt);e.length=0}capture(e,t){this.#r.has(e)||this.#r.set(e,t),this.current.set(e,e.v)}activate(){nt=this}deactivate(){nt=null,Qi=null;for(const e of Lo)if(Lo.delete(e),e(),nt!==null)break}neuter(){this.#i=!0}flush(){hn.length>0?Fl():this.#f(),nt===this&&(this.#e===0&&Us.delete(this),this.deactivate())}#f(){if(!this.#i)for(const e of this.#t)e();this.#t.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)Nt(e,er),Wn(e);for(const e of this.#h)Nt(e,Gr),Wn(e);this.#o=[],this.#s=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#n??=nc()).promise}static ensure(){if(nt===null){const e=nt=new Bn;Us.add(nt),Zi||Bn.enqueue(()=>{nt===e&&e.flush()})}return nt}static enqueue(e){is.length===0&&queueMicrotask($l),is.unshift(e)}}function Vc(r){var e=Zi;Zi=!0;try{for(var t;;){if(Dc(),hn.length===0&&(nt?.flush(),hn.length===0))return _s=null,t;Fl()}}finally{Zi=e}}function Fl(){var r=Un;na=!0;try{var e=0;for(No(!0);hn.length>0;){var t=Bn.ensure();if(e++>1e3){var n,s;qc()}t.process(hn),Vr.clear()}}finally{na=!1,No(r),_s=null}}function qc(){try{fc()}catch(r){Aa(r,_s)}}let an=null;function Do(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(vn|ur))===0&&ws(n)&&(an=[],Nn(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?Kl(n):n.fn=null),an?.length>0)){Vr.clear();for(const s of an)Nn(s);an=[]}}an=null}}function Wn(r){for(var e=_s=r;e.parent!==null;){e=e.parent;var t=e.f;if(na&&e===Ve&&(t&Gn)!==0)return;if((t&(fn|Mr))!==0){if((t&Rt)===0)return;e.f^=Rt}}hn.push(e)}const Vr=new Map;function Vn(r,e){var t={f:0,v:r,reactions:null,equals:Tl,rv:0,wv:0};return t}function Ft(r,e){const t=Vn(r);return Xl(t),t}function Hc(r,e=!1,t=!0){const n=Vn(r);return e||(n.equals=Rl),Kn&&t&&dt!==null&&dt.l!==null&&(dt.l.s??=[]).push(n),n}function Dt(r,e,t=!1){ze!==null&&(!yr||(ze.f&Mo)!==0)&&Yn()&&(ze.f&(Gt|Gn|Ea|Mo))!==0&&!Or?.includes(r)&&_c();let n=t?Br(e):e;return qn(r,n)}function qn(r,e){if(!r.equals(e)){var t=r.v;gn?Vr.set(r,e):Vr.set(r,t),r.v=e;var n=Bn.ensure();n.capture(r,t),(r.f&Gt)!==0&&((r.f&er)!==0&&Ia(r),Nt(r,(r.f&Zt)===0?Rt:Gr)),r.wv=Zl(),Ul(r,er),Yn()&&Ve!==null&&(Ve.f&Rt)!==0&&(Ve.f&(Mr|fn))===0&&(Xt===null?id([r]):Xt.push(r))}return e}function Ns(r){Dt(r,r.v+1)}function Ul(r,e){var t=r.reactions;if(t!==null)for(var n=Yn(),s=t.length,l=0;l<s;l++){var c=t[l],h=c.f;if(!(!n&&c===Ve)){var v=(h&er)===0;v&&Nt(c,e),(h&Gt)!==0?Ul(c,Gr):v&&((h&Gn)!==0&&an!==null&&an.push(c),Wn(c))}}}function Br(r){if(typeof r!="object"||r===null||jr in r)return r;const e=ya(r);if(e!==ec&&e!==tc)return r;var t=new Map,n=hs(r),s=Ft(0),l=dn,c=h=>{if(dn===l)return h();var v=ze,m=dn;br(null),Wo(l);var _=h();return br(v),Wo(m),_};return n&&t.set("length",Ft(r.length)),new Proxy(r,{defineProperty(h,v,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&pc();var _=t.get(v);return _===void 0?_=c(()=>{var k=Ft(m.value);return t.set(v,k),k}):Dt(_,m.value,!0),!0},deleteProperty(h,v){var m=t.get(v);if(m===void 0){if(v in h){const _=c(()=>Ft(kt));t.set(v,_),Ns(s)}}else Dt(m,kt),Ns(s);return!0},get(h,v,m){if(v===jr)return r;var _=t.get(v),k=v in h;if(_===void 0&&(!k||Fn(h,v)?.writable)&&(_=c(()=>{var g=Br(k?h[v]:kt),S=Ft(g);return S}),t.set(v,_)),_!==void 0){var E=x(_);return E===kt?void 0:E}return Reflect.get(h,v,m)},getOwnPropertyDescriptor(h,v){var m=Reflect.getOwnPropertyDescriptor(h,v);if(m&&"value"in m){var _=t.get(v);_&&(m.value=x(_))}else if(m===void 0){var k=t.get(v),E=k?.v;if(k!==void 0&&E!==kt)return{enumerable:!0,configurable:!0,value:E,writable:!0}}return m},has(h,v){if(v===jr)return!0;var m=t.get(v),_=m!==void 0&&m.v!==kt||Reflect.has(h,v);if(m!==void 0||Ve!==null&&(!_||Fn(h,v)?.writable)){m===void 0&&(m=c(()=>{var E=_?Br(h[v]):kt,g=Ft(E);return g}),t.set(v,m));var k=x(m);if(k===kt)return!1}return _},set(h,v,m,_){var k=t.get(v),E=v in h;if(n&&v==="length")for(var g=m;g<k.v;g+=1){var S=t.get(g+"");S!==void 0?Dt(S,kt):g in h&&(S=c(()=>Ft(kt)),t.set(g+"",S))}if(k===void 0)(!E||Fn(h,v)?.writable)&&(k=c(()=>Ft(void 0)),Dt(k,Br(m)),t.set(v,k));else{E=k.v!==kt;var $=c(()=>Br(m));Dt(k,$)}var R=Reflect.getOwnPropertyDescriptor(h,v);if(R?.set&&R.set.call(_,m),!E){if(n&&typeof v=="string"){var U=t.get("length"),B=Number(v);Number.isInteger(B)&&B>=U.v&&Dt(U,B+1)}Ns(s)}return!0},ownKeys(h){x(s);var v=Reflect.ownKeys(h).filter(k=>{var E=t.get(k);return E===void 0||E.v!==kt});for(var[m,_]of t)_.v!==kt&&!(m in h)&&v.push(m);return v},setPrototypeOf(){gc()}})}function $o(r){try{if(r!==null&&typeof r=="object"&&jr in r)return r[jr]}catch{}return r}function zc(r,e){return Object.is($o(r),$o(e))}var Fo,Nl,Bl,Wl;function Gc(){if(Fo===void 0){Fo=window,Nl=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Bl=Fn(e,"firstChild").get,Wl=Fn(e,"nextSibling").get,xo(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),xo(t)&&(t.__t=void 0)}}function pn(r=""){return document.createTextNode(r)}function ss(r){return Bl.call(r)}function ms(r){return Wl.call(r)}function F(r,e){return ss(r)}function zt(r,e){{var t=ss(r);return t instanceof Comment&&t.data===""?ms(t):t}}function W(r,e=1,t=!1){let n=r;for(;e--;)n=ms(n);return n}function Kc(r){r.textContent=""}function Ca(){return!1}let Uo=!1;function Yc(){Uo||(Uo=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function Ta(r){var e=ze,t=Ve;br(null),Hr(null);try{return r()}finally{br(e),Hr(t)}}function Pa(r,e,t,n=t){r.addEventListener(e,()=>Ta(t));const s=r.__on_r;s?r.__on_r=()=>{s(),n(!0)}:r.__on_r=()=>n(!0),Yc()}function Vl(r){Ve===null&&ze===null&&hc(),ze!==null&&(ze.f&Zt)!==0&&Ve===null&&dc(),gn&&cc()}function Jc(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function kr(r,e,t,n=!0){var s=Ve;s!==null&&(s.f&ur)!==0&&(r|=ur);var l={ctx:dt,deps:null,nodes_start:null,nodes_end:null,f:r|er,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Nn(l),l.f|=ba}catch(v){throw xr(l),v}else e!==null&&Wn(l);if(n){var c=l;if(t&&c.deps===null&&c.teardown===null&&c.nodes_start===null&&c.first===c.last&&(c.f&yi)===0&&(c=c.first),c!==null&&(c.parent=s,s!==null&&Jc(c,s),ze!==null&&(ze.f&Gt)!==0&&(r&fn)===0)){var h=ze;(h.effects??=[]).push(c)}}return l}function Xc(r){const e=kr(fs,null,!1);return Nt(e,Rt),e.teardown=r,e}function gi(r){Vl();var e=Ve.f,t=!ze&&(e&Mr)!==0&&(e&ba)===0;if(t){var n=dt;(n.e??=[]).push(r)}else return ql(r)}function ql(r){return kr(wa|Il,r,!1)}function Qc(r){return Vl(),kr(fs|Il,r,!0)}function Zc(r){Bn.ensure();const e=kr(fn|yi,r,!0);return(t={})=>new Promise(n=>{t.outro?ys(e,()=>{xr(e),n(void 0)}):(xr(e),n(void 0))})}function Hl(r){return kr(wa,r,!1)}function ed(r){return kr(Ea|yi,r,!0)}function Ra(r,e=0){return kr(fs|e,r,!0)}function Re(r,e=[],t=[]){Bc(e,t,n=>{kr(fs,()=>r(...n.map(x)),!0)})}function ja(r,e=0){var t=kr(Gn|e,r,!0);return t}function Hn(r,e=!0){return kr(Mr|yi,r,!0,e)}function zl(r){var e=r.teardown;if(e!==null){const t=gn,n=ze;Bo(!0),br(null);try{e.call(null)}finally{Bo(t),br(n)}}}function Gl(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const s=t.ac;s!==null&&Ta(()=>{s.abort(Sa)});var n=t.next;(t.f&fn)!==0?t.parent=null:xr(t,e),t=n}}function td(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Mr)===0&&xr(e),e=t}}function xr(r,e=!0){var t=!1;(e||(r.f&ic)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(rd(r.nodes_start,r.nodes_end),t=!0),Gl(r,e&&!t),as(r,0),Nt(r,vn);var n=r.transitions;if(n!==null)for(const l of n)l.stop();zl(r);var s=r.parent;s!==null&&s.first!==null&&Kl(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function rd(r,e){for(;r!==null;){var t=r===e?null:ms(r);r.remove(),r=t}}function Kl(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function ys(r,e){var t=[];Oa(r,t,!0),Yl(t,()=>{xr(r),e&&e()})}function Yl(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var s of r)s.out(n)}else e()}function Oa(r,e,t){if((r.f&ur)===0){if(r.f^=ur,r.transitions!==null)for(const c of r.transitions)(c.is_global||t)&&e.push(c);for(var n=r.first;n!==null;){var s=n.next,l=(n.f&ka)!==0||(n.f&Mr)!==0;Oa(n,e,l?t:!1),n=s}}}function xa(r){Jl(r,!0)}function Jl(r,e){if((r.f&ur)!==0){r.f^=ur,(r.f&Rt)===0&&(Nt(r,er),Wn(r));for(var t=r.first;t!==null;){var n=t.next,s=(t.f&ka)!==0||(t.f&Mr)!==0;Jl(t,s?e:!1),t=n}if(r.transitions!==null)for(const l of r.transitions)(l.is_global||e)&&l.in()}}let Ln=null;function nd(r){var e=Ln;try{if(Ln=new Set,_n(r),e!==null)for(var t of Ln)e.add(t);return Ln}finally{Ln=e}}function _r(r){for(var e of nd(r))qn(e,e.v)}let Un=!1;function No(r){Un=r}let gn=!1;function Bo(r){gn=r}let ze=null,yr=!1;function br(r){ze=r}let Ve=null;function Hr(r){Ve=r}let Or=null;function Xl(r){ze!==null&&(Or===null?Or=[r]:Or.push(r))}let Lt=null,Ht=0,Xt=null;function id(r){Xt=r}let Ql=1,_i=0,dn=_i;function Wo(r){dn=r}let Wr=!1;function Zl(){return++Ql}function ws(r){var e=r.f;if((e&er)!==0)return!0;if((e&Gr)!==0){var t=r.deps,n=(e&Zt)!==0;if(t!==null){var s,l,c=(e&rs)!==0,h=n&&Ve!==null&&!Wr,v=t.length;if((c||h)&&(Ve===null||(Ve.f&vn)===0)){var m=r,_=m.parent;for(s=0;s<v;s++)l=t[s],(c||!l?.reactions?.includes(m))&&(l.reactions??=[]).push(m);c&&(m.f^=rs),h&&_!==null&&(_.f&Zt)===0&&(m.f^=Zt)}for(s=0;s<v;s++)if(l=t[s],ws(l)&&Ll(l),l.wv>r.wv)return!0}(!n||Ve!==null&&!Wr)&&Nt(r,Rt)}return!1}function eu(r,e,t=!0){var n=r.reactions;if(n!==null&&!Or?.includes(r))for(var s=0;s<n.length;s++){var l=n[s];(l.f&Gt)!==0?eu(l,e,!1):e===l&&(t?Nt(l,er):(l.f&Rt)!==0&&Nt(l,Gr),Wn(l))}}function tu(r){var e=Lt,t=Ht,n=Xt,s=ze,l=Wr,c=Or,h=dt,v=yr,m=dn,_=r.f;Lt=null,Ht=0,Xt=null,Wr=(_&Zt)!==0&&(yr||!Un||ze===null),ze=(_&(Mr|fn))===0?r:null,Or=null,ns(r.ctx),yr=!1,dn=++_i,r.ac!==null&&(Ta(()=>{r.ac.abort(Sa)}),r.ac=null);try{r.f|=ta;var k=r.fn,E=k(),g=r.deps;if(Lt!==null){var S;if(as(r,Ht),g!==null&&Ht>0)for(g.length=Ht+Lt.length,S=0;S<Lt.length;S++)g[Ht+S]=Lt[S];else r.deps=g=Lt;if(!Wr||(_&Gt)!==0&&r.reactions!==null)for(S=Ht;S<g.length;S++)(g[S].reactions??=[]).push(r)}else g!==null&&Ht<g.length&&(as(r,Ht),g.length=Ht);if(Yn()&&Xt!==null&&!yr&&g!==null&&(r.f&(Gt|Gr|er))===0)for(S=0;S<Xt.length;S++)eu(Xt[S],r);return s!==null&&s!==r&&(_i++,Xt!==null&&(n===null?n=Xt:n.push(...Xt))),(r.f&cn)!==0&&(r.f^=cn),E}catch($){return Mc($)}finally{r.f^=ta,Lt=e,Ht=t,Xt=n,ze=s,Wr=l,Or=c,ns(h),yr=v,dn=m}}function sd(r,e){let t=e.reactions;if(t!==null){var n=Zu.call(t,r);if(n!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[n]=t[s],t.pop())}}t===null&&(e.f&Gt)!==0&&(Lt===null||!Lt.includes(e))&&(Nt(e,Gr),(e.f&(Zt|rs))===0&&(e.f^=rs),Ml(e),as(e,0))}function as(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)sd(r,t[n])}function Nn(r){var e=r.f;if((e&vn)===0){Nt(r,Rt);var t=Ve,n=Un;Ve=r,Un=!0;try{(e&Gn)!==0?td(r):Gl(r),zl(r);var s=tu(r);r.teardown=typeof s=="function"?s:null,r.wv=Ql;var l;El&&jc&&(r.f&er)!==0&&r.deps}finally{Un=n,Ve=t}}}async function ad(){await Promise.resolve(),Vc()}function x(r){var e=r.f,t=(e&Gt)!==0;if(Ln?.add(r),ze!==null&&!yr){var n=Ve!==null&&(Ve.f&vn)!==0;if(!n&&!Or?.includes(r)){var s=ze.deps;if((ze.f&ta)!==0)r.rv<_i&&(r.rv=_i,Lt===null&&s!==null&&s[Ht]===r?Ht++:Lt===null?Lt=[r]:(!Wr||!Lt.includes(r))&&Lt.push(r));else{(ze.deps??=[]).push(r);var l=r.reactions;l===null?r.reactions=[ze]:l.includes(ze)||l.push(ze)}}}else if(t&&r.deps===null&&r.effects===null){var c=r,h=c.parent;h!==null&&(h.f&Zt)===0&&(c.f^=Zt)}if(gn){if(Vr.has(r))return Vr.get(r);if(t){c=r;var v=c.v;return((c.f&Rt)===0&&c.reactions!==null||ru(c))&&(v=Ia(c)),Vr.set(c,v),v}}else t&&(c=r,ws(c)&&Ll(c));if((r.f&cn)!==0)throw r.v;return r.v}function ru(r){if(r.v===kt)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(Vr.has(e)||(e.f&Gt)!==0&&ru(e))return!0;return!1}function _n(r){var e=yr;try{return yr=!0,r()}finally{yr=e}}const od=-7169;function Nt(r,e){r.f=r.f&od|e}function ld(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(jr in r)ia(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&jr in t&&ia(t)}}}function ia(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{ia(r[n],e)}catch{}const t=ya(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Sl(t);for(let s in n){const l=n[s].get;if(l)try{l.call(r)}catch{}}}}}const ud=["touchstart","touchmove"];function cd(r){return ud.includes(r)}const nu=new Set,sa=new Set;function Er(r){for(var e=0;e<r.length;e++)nu.add(r[e]);for(var t of sa)t(r)}let Vo=null;function Hi(r){var e=this,t=e.ownerDocument,n=r.type,s=r.composedPath?.()||[],l=s[0]||r.target;Vo=r;var c=0,h=Vo===r&&r.__root;if(h){var v=s.indexOf(h);if(v!==-1&&(e===document||e===window)){r.__root=e;return}var m=s.indexOf(e);if(m===-1)return;v<=m&&(c=v)}if(l=s[c]||r.target,l!==e){ea(r,"currentTarget",{configurable:!0,get(){return l||t}});var _=ze,k=Ve;br(null),Hr(null);try{for(var E,g=[];l!==null;){var S=l.assignedSlot||l.parentNode||l.host||null;try{var $=l["__"+n];if($!=null&&(!l.disabled||r.target===l))if(hs($)){var[R,...U]=$;R.apply(l,[r,...U])}else $.call(l,r)}catch(B){E?g.push(B):E=B}if(r.cancelBubble||S===e||S===null)break;l=S}if(E){for(let B of g)queueMicrotask(()=>{throw B});throw E}}finally{r.__root=e,delete r.currentTarget,br(_),Hr(k)}}}function dd(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function os(r,e){var t=Ve;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function ue(r,e){var t=(e&Ac)!==0,n=(e&Ic)!==0,s,l=!r.startsWith("<!>");return()=>{s===void 0&&(s=dd(l?r:"<!>"+r),t||(s=ss(s)));var c=n||Nl?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=ss(c),v=c.lastChild;os(h,v)}else os(c,c);return c}}function Bs(r=""){{var e=pn(r+"");return os(e,e),e}}function wr(){var r=document.createDocumentFragment(),e=document.createComment(""),t=pn();return r.append(e,t),os(e,t),r}function ee(r,e){r!==null&&r.before(e)}function Fe(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function hd(r,e){return fd(r,e)}const Sn=new Map;function fd(r,{target:e,anchor:t,props:n={},events:s,context:l,intro:c=!0}){Gc();var h=new Set,v=k=>{for(var E=0;E<k.length;E++){var g=k[E];if(!h.has(g)){h.add(g);var S=cd(g);e.addEventListener(g,Hi,{passive:S});var $=Sn.get(g);$===void 0?(document.addEventListener(g,Hi,{passive:S}),Sn.set(g,1)):Sn.set(g,$+1)}}};v(ma(nu)),sa.add(v);var m=void 0,_=Zc(()=>{var k=t??e.appendChild(pn());return Hn(()=>{if(l){tr({});var E=dt;E.c=l}s&&(n.$$events=s),m=r(k,n)||{},l&&rr()}),()=>{for(var E of h){e.removeEventListener(E,Hi);var g=Sn.get(E);--g===0?(document.removeEventListener(E,Hi),Sn.delete(E)):Sn.set(E,g)}sa.delete(v),k!==t&&k.parentNode?.removeChild(k)}});return vd.set(m,_),m}let vd=new WeakMap;function Ne(r,e,t=!1){var n=r,s=null,l=null,c=kt,h=t?ka:0,v=!1;const m=(g,S=!0)=>{v=!0,E(S,g)};var _=null;function k(){_!==null&&(_.lastChild.remove(),n.before(_),_=null);var g=c?s:l,S=c?l:s;g&&xa(g),S&&ys(S,()=>{c?l=null:s=null})}const E=(g,S)=>{if(c!==(c=g)){var $=Ca(),R=n;if($&&(_=document.createDocumentFragment(),_.append(R=pn())),c?s??=S&&Hn(()=>S(R)):l??=S&&Hn(()=>S(R)),$){var U=nt,B=c?s:l,N=c?l:s;B&&U.skipped_effects.delete(B),N&&U.skipped_effects.add(N),U.add_callback(k)}else k()}};ja(()=>{v=!1,e(m),v||E(null,null)},h)}function qo(r,e,t){var n=r,s=kt,l,c,h=null,v=Yn()?Rc:Pl;function m(){l&&ys(l),h!==null&&(h.lastChild.remove(),n.before(h),h=null),l=c}ja(()=>{if(v(s,s=e())){var _=n,k=Ca();k&&(h=document.createDocumentFragment(),h.append(_=pn())),c=Hn(()=>t(_)),k?nt.add_callback(m):m()}})}function Qt(r,e){return e}function pd(r,e,t){for(var n=r.items,s=[],l=e.length,c=0;c<l;c++)Oa(e[c].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var v=t.parentNode;Kc(v),v.append(t),n.clear(),pr(r,e[0].prev,e[l-1].next)}Yl(s,()=>{for(var m=0;m<l;m++){var _=e[m];h||(n.delete(_.k),pr(r,_.prev,_.next)),xr(_.e,!h)}})}function Pt(r,e,t,n,s,l=null){var c=r,h={flags:e,items:new Map,first:null},v=(e&Cl)!==0;if(v){var m=r;c=m.appendChild(pn())}var _=null,k=!1,E=new Map,g=gs(()=>{var U=t();return hs(U)?U:U==null?[]:ma(U)}),S,$;function R(){gd($,S,h,E,c,s,e,n,t),l!==null&&(S.length===0?_?xa(_):_=Hn(()=>l(c)):_!==null&&ys(_,()=>{_=null}))}ja(()=>{$??=Ve,S=x(g);var U=S.length;if(!(k&&U===0)){k=U===0;var B,N,z,Z;if(Ca()){var O=new Set,L=nt;for(N=0;N<U;N+=1){z=S[N],Z=n(z,N);var ie=h.items.get(Z)??E.get(Z);ie?(e&(vs|ps))!==0&&iu(ie,z,N,e):(B=su(null,h,null,null,z,Z,N,s,e,t,!0),E.set(Z,B)),O.add(Z)}for(const[J,ne]of h.items)O.has(J)||L.skipped_effects.add(ne.e);L.add_callback(R)}else R();x(g)}})}function gd(r,e,t,n,s,l,c,h,v){var m=(c&mc)!==0,_=(c&(vs|ps))!==0,k=e.length,E=t.items,g=t.first,S=g,$,R=null,U,B=[],N=[],z,Z,O,L;if(m)for(L=0;L<k;L+=1)z=e[L],Z=h(z,L),O=E.get(Z),O!==void 0&&(O.a?.measure(),(U??=new Set).add(O));for(L=0;L<k;L+=1){if(z=e[L],Z=h(z,L),O=E.get(Z),O===void 0){var ie=n.get(Z);if(ie!==void 0){n.delete(Z),E.set(Z,ie);var J=R?R.next:S;pr(t,R,ie),pr(t,ie,J),Ws(ie,J,s),R=ie}else{var ne=S?S.e.nodes_start:s;R=su(ne,t,R,R===null?t.first:R.next,z,Z,L,l,c,v)}E.set(Z,R),B=[],N=[],S=R.next;continue}if(_&&iu(O,z,L,c),(O.e.f&ur)!==0&&(xa(O.e),m&&(O.a?.unfix(),(U??=new Set).delete(O))),O!==S){if($!==void 0&&$.has(O)){if(B.length<N.length){var Y=N[0],X;R=Y.prev;var ve=B[0],Ae=B[B.length-1];for(X=0;X<B.length;X+=1)Ws(B[X],Y,s);for(X=0;X<N.length;X+=1)$.delete(N[X]);pr(t,ve.prev,Ae.next),pr(t,R,ve),pr(t,Ae,Y),S=Y,R=Ae,L-=1,B=[],N=[]}else $.delete(O),Ws(O,S,s),pr(t,O.prev,O.next),pr(t,O,R===null?t.first:R.next),pr(t,R,O),R=O;continue}for(B=[],N=[];S!==null&&S.k!==Z;)(S.e.f&ur)===0&&($??=new Set).add(S),N.push(S),S=S.next;if(S===null)continue;O=S}B.push(O),R=O,S=O.next}if(S!==null||$!==void 0){for(var ce=$===void 0?[]:ma($);S!==null;)(S.e.f&ur)===0&&ce.push(S),S=S.next;var Ke=ce.length;if(Ke>0){var ye=(c&Cl)!==0&&k===0?s:null;if(m){for(L=0;L<Ke;L+=1)ce[L].a?.measure();for(L=0;L<Ke;L+=1)ce[L].a?.fix()}pd(t,ce,ye)}}m&&xl(()=>{if(U!==void 0)for(O of U)O.a?.apply()}),r.first=t.first&&t.first.e,r.last=R&&R.e;for(var we of n.values())xr(we.e);n.clear()}function iu(r,e,t,n){(n&vs)!==0&&qn(r.v,e),(n&ps)!==0?qn(r.i,t):r.i=t}function su(r,e,t,n,s,l,c,h,v,m,_){var k=(v&vs)!==0,E=(v&yc)===0,g=k?E?Hc(s,!1,!1):Vn(s):s,S=(v&ps)===0?c:Vn(c),$={i:S,v:g,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var R=document.createDocumentFragment();R.append(r=pn())}return $.e=Hn(()=>h(r,g,S,m),Pc),$.e.prev=t&&t.e,$.e.next=n&&n.e,t===null?_||(e.first=$):(t.next=$,t.e.next=$.e),n!==null&&(n.prev=$,n.e.prev=$.e),$}finally{}}function Ws(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var c=ms(l);s.before(l),l=c}}function pr(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const Ho=[...` 	
\r\f \v\uFEFF`];function _d(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var l=s.length,c=0;(c=n.indexOf(s,c))>=0;){var h=c+l;(c===0||Ho.includes(n[c-1]))&&(h===n.length||Ho.includes(n[h]))?n=(c===0?"":n.substring(0,c))+n.substring(h+1):c=h}}return n===""?null:n}function qr(r,e,t,n,s,l){var c=r.__className;if(c!==t||c===void 0){var h=_d(t,n,l);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(l&&s!==l)for(var v in l){var m=!!l[v];(s==null||m!==!!s[v])&&r.classList.toggle(v,m)}return l}function ls(r,e,t=!1){if(r.multiple){if(e==null)return;if(!hs(e))return Tc();for(var n of r.options)n.selected=e.includes(di(n));return}for(n of r.options){var s=di(n);if(zc(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function aa(r){var e=new MutationObserver(()=>{ls(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Xc(()=>{e.disconnect()})}function ci(r,e,t=e){var n=!0;Pa(r,"change",s=>{var l=s?"[selected]":":checked",c;if(r.multiple)c=[].map.call(r.querySelectorAll(l),di);else{var h=r.querySelector(l)??r.querySelector("option:not([disabled])");c=h&&di(h)}t(c)}),Hl(()=>{var s=e();if(ls(r,s,n),n&&s===void 0){var l=r.querySelector(":checked");l!==null&&(s=di(l),t(s))}r.__value=s,n=!1}),aa(r)}function di(r){return"__value"in r?r.__value:r.value}const md=Symbol("is custom element"),yd=Symbol("is html");function Vs(r,e){var t=au(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Le(r,e,t,n){var s=au(r);s[e]!==(s[e]=t)&&(e==="loading"&&(r[ac]=t),t==null?r.removeAttribute(e):typeof t!="string"&&wd(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function au(r){return r.__attributes??={[md]:r.nodeName.includes("-"),[yd]:r.namespaceURI===Cc}}var zo=new Map;function wd(r){var e=r.getAttribute("is")||r.nodeName,t=zo.get(e);if(t)return t;zo.set(e,t=[]);for(var n,s=r,l=Element.prototype;l!==s;){n=Sl(s);for(var c in n)n[c].set&&t.push(c);s=ya(s)}return t}function ln(r,e,t=e){var n=new WeakSet;Pa(r,"input",async s=>{var l=s?r.defaultValue:r.value;if(l=qs(r)?Hs(l):l,t(l),nt!==null&&n.add(nt),await ad(),l!==(l=e())){var c=r.selectionStart,h=r.selectionEnd;r.value=l??"",h!==null&&(r.selectionStart=c,r.selectionEnd=Math.min(h,r.value.length))}}),_n(e)==null&&r.value&&(t(qs(r)?Hs(r.value):r.value),nt!==null&&n.add(nt)),Ra(()=>{var s=e();if(r===document.activeElement){var l=Qi??nt;if(n.has(l))return}qs(r)&&s===Hs(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Go(r,e,t=e){Pa(r,"change",n=>{var s=n?r.defaultChecked:r.checked;t(s)}),_n(e)==null&&t(r.checked),Ra(()=>{var n=e();r.checked=!!n})}function qs(r){var e=r.type;return e==="number"||e==="range"}function Hs(r){return r===""?null:+r}function Ko(r,e){return r===e||r?.[jr]===e}function bd(r={},e,t,n){return Hl(()=>{var s,l;return Ra(()=>{s=l,l=[],_n(()=>{r!==t(...l)&&(e(r,...l),s&&Ko(t(...s),r)&&e(null,...s))})}),()=>{xl(()=>{l&&Ko(t(...l),r)&&e(null,...l)})}}),r}function mn(r=!1){const e=dt,t=e.l.u;if(!t)return;let n=()=>ld(e.s);if(r){let s=0,l={};const c=wi(()=>{let h=!1;const v=e.s;for(const m in v)v[m]!==l[m]&&(l[m]=v[m],h=!0);return h&&s++,s});n=()=>x(c)}t.b.length&&Qc(()=>{Yo(e,n),ts(t.b)}),gi(()=>{const s=_n(()=>t.m.map(rc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&gi(()=>{Yo(e,n),ts(t.a)})}function Yo(r,e){if(r.l.s)for(const t of r.l.s)x(t);e()}function Jn(r){var e=Vn(0);return function(){return arguments.length===1?(Dt(e,x(e)+1),arguments[0]):(x(e),r())}}let zi=!1;function kd(r){var e=zi;try{return zi=!1,[r(),zi]}finally{zi=e}}function Ma(r,e,t,n){var s=!Kn||(t&bc)!==0,l=(t&Ec)!==0,c=(t&Sc)!==0,h=n,v=!0,m=()=>(v&&(v=!1,h=c?_n(n):n),h),_;if(l){var k=jr in r||sc in r;_=Fn(r,e)?.set??(k&&e in r?N=>r[e]=N:void 0)}var E,g=!1;l?[E,g]=kd(()=>r[e]):E=r[e],E===void 0&&n!==void 0&&(E=m(),_&&(s&&vc(),_(E)));var S;if(s?S=()=>{var N=r[e];return N===void 0?m():(v=!0,N)}:S=()=>{var N=r[e];return N!==void 0&&(h=void 0),N===void 0?h:N},s&&(t&kc)===0)return S;if(_){var $=r.$$legacy;return(function(N,z){return arguments.length>0?((!s||!z||$||g)&&_(z?S():N),N):S()})}var R=!1,U=((t&wc)!==0?wi:gs)(()=>(R=!1,S()));l&&x(U);var B=Ve;return(function(N,z){if(arguments.length>0){const Z=z?x(U):s&&l?Br(N):N;return Dt(U,Z),R=!0,h!==void 0&&(h=Z),N}return gn&&R||(B.f&vn)!==0?U.v:x(U)})}function bs(r){dt===null&&lc(),Kn&&dt.l!==null?Ed(dt).m.push(r):gi(()=>{const e=_n(r);if(typeof e=="function")return e})}function Ed(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Sd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Sd);Oc();const P=Br({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),At={get currentDialogue(){return P.data?.dialogues.find(r=>r.id===P.selectedDialogueId)},get currentChapter(){return P.data?.chapters?.find(r=>r.id===P.selectedChapterId)},get currentEditingOption(){return At.currentDialogue&&P.editingOptionIndex!==null?At.currentDialogue.options?.[P.editingOptionIndex]:void 0},get chapterDialogues(){return!P.data?.dialogues||!P.selectedChapterId?[]:P.data.dialogues.filter(r=>r.chapterId===P.selectedChapterId)},get imageResources(){return P.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return P.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return P.data?.items||[]},get backlinks(){return!P.data||!P.selectedDialogueId?[]:P.data.dialogues.filter(r=>r.nextDialogueId===P.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===P.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},rt={toggleEditor(){P.showEditor=!P.showEditor},toggleItemsPanel(){P.showItems=!P.showItems},setStatus(r,e){P.statusMessage={type:r,text:e}},clearStatus(){P.statusMessage={type:"",text:""}},selectBucket(r){P.selectedBucket=r,P.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},P.storedFiles=[],P.storiesList=[],P.selectedChapterId=null,P.selectedDialogueId=null},updateBucketsList(r){P.availableBuckets=r},selectChapter(r){P.selectedChapterId=r,P.selectedDialogueId=null},selectDialogue(r){P.selectedDialogueId=r},selectOption(r){P.editingOptionIndex=r},selectItem(r){P.editingItemIndex=r},updateStoryData(r){P.data=r},updateStoredFiles(r){P.storedFiles=r},updateStoriesList(r){P.storiesList=r},setCurrentFileName(r){P.currentFileName=r},addDialogue(r){P.data.dialogues=[...P.data.dialogues,r]},updateDialogue(r,e){P.data.dialogues=P.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){P.data.dialogues=P.data.dialogues.filter(e=>e.id!==r),P.selectedDialogueId===r&&(P.selectedDialogueId=null)},addChapter(r){P.data.chapters=[...P.data.chapters,r]},updateChapter(r,e){P.data.chapters=P.data.chapters.map(t=>t.id===r?{...t,...e}:t)},deleteChapter(r){P.data.chapters=P.data.chapters.filter(e=>e.id!==r),P.selectedChapterId===r&&(P.selectedChapterId=null,P.selectedDialogueId=null)},addItem(r){P.data.items=[...P.data.items||[],r]},updateItem(r,e){P.data.items&&(P.data.items=P.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){P.data.items&&(P.data.items=P.data.items.filter(e=>e.id!==r))},reset(){P.showEditor=!1,P.showItems=!1,P.editingOptionIndex=null,P.editingItemIndex=null,P.selectedChapterId=null,P.selectedDialogueId=null,P.statusMessage={type:"",text:""}}},Ad="modulepreload",Id=function(r,e){return new URL(r,e).href},Jo={},bi=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let m=function(_){return Promise.all(_.map(k=>Promise.resolve(k).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};const c=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),v=h?.nonce||h?.getAttribute("nonce");s=m(t.map(_=>{if(_=Id(_,n),_ in Jo)return;Jo[_]=!0;const k=_.endsWith(".css"),E=k?'[rel="stylesheet"]':"";if(!!n)for(let $=c.length-1;$>=0;$--){const R=c[$];if(R.href===_&&(!k||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${E}`))return;const S=document.createElement("link");if(S.rel=k?"stylesheet":Ad,k||(S.as="script"),S.crossOrigin="",S.href=_,v&&S.setAttribute("nonce",v),document.head.appendChild(S),k)return new Promise(($,R)=>{S.addEventListener("load",$),S.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return s.then(c=>{for(const h of c||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Cd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>bi(async()=>{const{default:n}=await Promise.resolve().then(()=>Xn);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class La extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class Td extends La{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Xo extends La{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Qo extends La{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var oa;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(oa||(oa={}));var Pd=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};class Rd{constructor(e,{headers:t={},customFetch:n,region:s=oa.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Cd(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Pd(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:c}=t;let h={},{region:v}=t;v||(v=this.region);const m=new URL(`${this.url}/${e}`);v&&v!=="any"&&(h["x-region"]=v,m.searchParams.set("forceFunctionRegion",v));let _;c&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=c):typeof c=="string"?(h["Content-Type"]="text/plain",_=c):typeof FormData<"u"&&c instanceof FormData?_=c:(h["Content-Type"]="application/json",_=JSON.stringify(c)));const k=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:_}).catch($=>{throw new Td($)}),E=k.headers.get("x-relay-error");if(E&&E==="true")throw new Xo(k);if(!k.ok)throw new Qo(k);let g=((n=k.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),S;return g==="application/json"?S=yield k.json():g==="application/octet-stream"?S=yield k.blob():g==="text/event-stream"?S=k:g==="multipart/form-data"?S=yield k.formData():S=yield k.text(),{data:S,error:null,response:k}}catch(s){return{data:null,error:s,response:s instanceof Qo||s instanceof Xo?s.context:void 0}}})}}function jd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Od(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var bt={},An={},In={},Cn={},Tn={},Pn={},xd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},zn=xd();const Md=zn.fetch,ou=zn.fetch.bind(zn),lu=zn.Headers,Ld=zn.Request,Dd=zn.Response,Xn=Object.freeze(Object.defineProperty({__proto__:null,Headers:lu,Request:Ld,Response:Dd,default:ou,fetch:Md},Symbol.toStringTag,{value:"Module"})),$d=Od(Xn);var Gi={},Zo;function uu(){if(Zo)return Gi;Zo=1,Object.defineProperty(Gi,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Gi.default=r,Gi}var el;function cu(){if(el)return Pn;el=1;var r=Pn&&Pn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pn,"__esModule",{value:!0});const e=r($d),t=r(uu());class n{constructor(l){var c,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(c=l.shouldThrowOnError)!==null&&c!==void 0?c:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,c){return this.headers=new Headers(this.headers),this.headers.set(l,c),this}then(l,c){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let v=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var _,k,E,g;let S=null,$=null,R=null,U=m.status,B=m.statusText;if(m.ok){if(this.method!=="HEAD"){const O=await m.text();O===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?$=O:$=JSON.parse(O))}const z=(k=this.headers.get("Prefer"))===null||k===void 0?void 0:k.match(/count=(exact|planned|estimated)/),Z=(E=m.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");z&&Z&&Z.length>1&&(R=parseInt(Z[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray($)&&($.length>1?(S={code:"PGRST116",details:`Results contain ${$.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},$=null,R=null,U=406,B="Not Acceptable"):$.length===1?$=$[0]:$=null)}else{const z=await m.text();try{S=JSON.parse(z),Array.isArray(S)&&m.status===404&&($=[],S=null,U=200,B="OK")}catch{m.status===404&&z===""?(U=204,B="No Content"):S={message:z}}if(S&&this.isMaybeSingle&&(!((g=S?.details)===null||g===void 0)&&g.includes("0 rows"))&&(S=null,U=200,B="OK"),S&&this.shouldThrowOnError)throw new t.default(S)}return{error:S,data:$,count:R,status:U,statusText:B}});return this.shouldThrowOnError||(v=v.catch(m=>{var _,k,E;return{error:{message:`${(_=m?.name)!==null&&_!==void 0?_:"FetchError"}: ${m?.message}`,details:`${(k=m?.stack)!==null&&k!==void 0?k:""}`,hint:"",code:`${(E=m?.code)!==null&&E!==void 0?E:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,c)}returns(){return this}overrideTypes(){return this}}return Pn.default=n,Pn}var tl;function du(){if(tl)return Tn;tl=1;var r=Tn&&Tn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Tn,"__esModule",{value:!0});const e=r(cu());class t extends e.default{select(s){let l=!1;const c=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:c,foreignTable:h,referencedTable:v=h}={}){const m=v?`${v}.order`:"order",_=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${_?`${_},`:""}${s}.${l?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:c=l}={}){const h=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:c,referencedTable:h=c}={}){const v=typeof h>"u"?"offset":`${h}.offset`,m=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(v,`${s}`),this.url.searchParams.set(m,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:c=!1,buffers:h=!1,wal:v=!1,format:m="text"}={}){var _;const k=[s?"analyze":null,l?"verbose":null,c?"settings":null,h?"buffers":null,v?"wal":null].filter(Boolean).join("|"),E=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${E}"; options=${k};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Tn.default=t,Tn}var rl;function Da(){if(rl)return Cn;rl=1;var r=Cn&&Cn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Cn,"__esModule",{value:!0});const e=r(du());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const c=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${c})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:c,type:h}={}){let v="";h==="plain"?v="pl":h==="phrase"?v="ph":h==="websearch"&&(v="w");const m=c===void 0?"":`(${c})`;return this.url.searchParams.append(s,`${v}fts${m}.${l}`),this}match(s){return Object.entries(s).forEach(([l,c])=>{this.url.searchParams.append(l,`eq.${c}`)}),this}not(s,l,c){return this.url.searchParams.append(s,`not.${l}.${c}`),this}or(s,{foreignTable:l,referencedTable:c=l}={}){const h=c?`${c}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,c){return this.url.searchParams.append(s,`${l}.${c}`),this}}return Cn.default=t,Cn}var nl;function hu(){if(nl)return In;nl=1;var r=In&&In.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(In,"__esModule",{value:!0});const e=r(Da());class t{constructor(s,{headers:l={},schema:c,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=c,this.fetch=h}select(s,{head:l=!1,count:c}={}){const h=l?"HEAD":"GET";let v=!1;const m=(s??"*").split("").map(_=>/\s/.test(_)&&!v?"":(_==='"'&&(v=!v),_)).join("");return this.url.searchParams.set("select",m),c&&this.headers.append("Prefer",`count=${c}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:c=!0}={}){var h;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((_,k)=>_.concat(Object.keys(k)),[]);if(m.length>0){const _=[...new Set(m)].map(k=>`"${k}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:c=!1,count:h,defaultToNull:v=!0}={}){var m;const _="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const k=s.reduce((E,g)=>E.concat(Object.keys(g)),[]);if(k.length>0){const E=[...new Set(k)].map(g=>`"${g}"`);this.url.searchParams.set("columns",E.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(s,{count:l}={}){var c;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:s}={}){var l;const c="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return In.default=t,In}var il;function Fd(){if(il)return An;il=1;var r=An&&An.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(An,"__esModule",{value:!0});const e=r(hu()),t=r(Da());class n{constructor(l,{headers:c={},schema:h,fetch:v}={}){this.url=l,this.headers=new Headers(c),this.schemaName=h,this.fetch=v}from(l){const c=new URL(`${this.url}/${l}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:h=!1,get:v=!1,count:m}={}){var _;let k;const E=new URL(`${this.url}/rpc/${l}`);let g;h||v?(k=h?"HEAD":"GET",Object.entries(c).filter(([$,R])=>R!==void 0).map(([$,R])=>[$,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([$,R])=>{E.searchParams.append($,R)})):(k="POST",g=c);const S=new Headers(this.headers);return m&&S.set("Prefer",`count=${m}`),new t.default({method:k,url:E,headers:S,schema:this.schemaName,body:g,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return An.default=n,An}var sl;function Ud(){if(sl)return bt;sl=1;var r=bt&&bt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(bt,"__esModule",{value:!0}),bt.PostgrestError=bt.PostgrestBuilder=bt.PostgrestTransformBuilder=bt.PostgrestFilterBuilder=bt.PostgrestQueryBuilder=bt.PostgrestClient=void 0;const e=r(Fd());bt.PostgrestClient=e.default;const t=r(hu());bt.PostgrestQueryBuilder=t.default;const n=r(Da());bt.PostgrestFilterBuilder=n.default;const s=r(du());bt.PostgrestTransformBuilder=s.default;const l=r(cu());bt.PostgrestBuilder=l.default;const c=r(uu());return bt.PostgrestError=c.default,bt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:c.default},bt}var Nd=Ud();const Bd=jd(Nd),{PostgrestClient:Wd,PostgrestQueryBuilder:fp,PostgrestFilterBuilder:vp,PostgrestTransformBuilder:pp,PostgrestBuilder:gp,PostgrestError:_p}=Bd;class Vd{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const qd="2.15.1",Hd=`realtime-js/${qd}`,zd="1.0.0",la=1e4,Gd=1e3,Kd=100;var hi;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(hi||(hi={}));var vt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(vt||(vt={}));var lr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(lr||(lr={}));var ua;(function(r){r.websocket="websocket"})(ua||(ua={}));var on;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(on||(on={}));class Yd{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),l=t.getUint8(2);let c=this.HEADER_LENGTH+2;const h=n.decode(e.slice(c,c+s));c=c+s;const v=n.decode(e.slice(c,c+l));c=c+l;const m=JSON.parse(n.decode(e.slice(c,e.byteLength)));return{ref:null,topic:h,event:v,payload:m}}}class fu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var et;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(et||(et={}));const al=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((l,c)=>(l[c]=Jd(c,r,e,s),l),{})},Jd=(r,e,t,n)=>{const s=e.find(h=>h.name===r),l=s?.type,c=t[r];return l&&!n.includes(l)?vu(l,c):ca(c)},vu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return eh(e,t)}switch(r){case et.bool:return Xd(e);case et.float4:case et.float8:case et.int2:case et.int4:case et.int8:case et.numeric:case et.oid:return Qd(e);case et.json:case et.jsonb:return Zd(e);case et.timestamp:return th(e);case et.abstime:case et.date:case et.daterange:case et.int4range:case et.int8range:case et.money:case et.reltime:case et.text:case et.time:case et.timestamptz:case et.timetz:case et.tsrange:case et.tstzrange:return ca(e);default:return ca(e)}},ca=r=>r,Xd=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Qd=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Zd=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},eh=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let l;const c=r.slice(1,t);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(h=>vu(e,h))}return r},th=r=>typeof r=="string"?r.replace(" ","T"):r,pu=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class zs{constructor(e,t,n={},s=la){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ol;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(ol||(ol={}));class fi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:l,onLeave:c,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fi.syncState(this.state,s,l,c),this.pendingDiffs.forEach(v=>{this.state=fi.syncDiff(this.state,v,l,c)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},s=>{const{onJoin:l,onLeave:c,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=fi.syncDiff(this.state,s,l,c),h())}),this.onJoin((s,l,c)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:c})}),this.onLeave((s,l,c)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const l=this.cloneDeep(e),c=this.transformState(t),h={},v={};return this.map(l,(m,_)=>{c[m]||(v[m]=_)}),this.map(c,(m,_)=>{const k=l[m];if(k){const E=_.map(R=>R.presence_ref),g=k.map(R=>R.presence_ref),S=_.filter(R=>g.indexOf(R.presence_ref)<0),$=k.filter(R=>E.indexOf(R.presence_ref)<0);S.length>0&&(h[m]=S),$.length>0&&(v[m]=$)}else h[m]=_}),this.syncDiff(l,{joins:h,leaves:v},n,s)}static syncDiff(e,t,n,s){const{joins:l,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(l,(h,v)=>{var m;const _=(m=e[h])!==null&&m!==void 0?m:[];if(e[h]=this.cloneDeep(v),_.length>0){const k=e[h].map(g=>g.presence_ref),E=_.filter(g=>k.indexOf(g.presence_ref)<0);e[h].unshift(...E)}n(h,_,v)}),this.map(c,(h,v)=>{let m=e[h];if(!m)return;const _=v.map(k=>k.presence_ref);m=m.filter(k=>_.indexOf(k.presence_ref)<0),e[h]=m,s(h,m,v),m.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ll;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ll||(ll={}));var vi;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(vi||(vi={}));var Rr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Rr||(Rr={}));class $a{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new zs(this,lr.join,this.params,this.timeout),this.rejoinTimer=new fu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=vt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(lr.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new fi(this),this.broadcastEndpointURL=pu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==vt.closed){const{config:{broadcast:l,presence:c,private:h}}=this.params,v=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(E=>E.filter))!==null&&s!==void 0?s:[],m=!!this.bindings[vi.PRESENCE]&&this.bindings[vi.PRESENCE].length>0,_={},k={broadcast:l,presence:Object.assign(Object.assign({},c),{enabled:m}),postgres_changes:v,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(E=>e?.(Rr.CHANNEL_ERROR,E)),this._onClose(()=>e?.(Rr.CLOSED)),this.updateJoinPayload(Object.assign({config:k},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:E})=>{var g;if(this.socket.setAuth(),E===void 0){e?.(Rr.SUBSCRIBED);return}else{const S=this.bindings.postgres_changes,$=(g=S?.length)!==null&&g!==void 0?g:0,R=[];for(let U=0;U<$;U++){const B=S[U],{filter:{event:N,schema:z,table:Z,filter:O}}=B,L=E&&E[U];if(L&&L.event===N&&L.schema===z&&L.table===Z&&L.filter===O)R.push(Object.assign(Object.assign({},B),{id:L.id}));else{this.unsubscribe(),this.state=vt.errored,e?.(Rr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,e&&e(Rr.SUBSCRIBED);return}}).receive("error",E=>{this.state=vt.errored,e?.(Rr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(E).join(", ")||"error")))}).receive("timeout",()=>{e?.(Rr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===vt.joined&&e===vi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:c}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=m.body)===null||s===void 0?void 0:s.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,h,v;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(h=(c=this.params)===null||c===void 0?void 0:c.config)===null||h===void 0?void 0:h.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),m.receive("ok",()=>l("ok")),m.receive("error",()=>l("error")),m.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=vt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(lr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new zs(this,lr.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=vt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,l=setTimeout(()=>s.abort(),n),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),c}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new zs(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Kd){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,l;const c=e.toLocaleLowerCase(),{close:h,error:v,leave:m,join:_}=lr;if(n&&[h,v,m,_].indexOf(c)>=0&&n!==this._joinRef())return;let E=this._onMessage(c,t,n);if(t&&!E)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var S,$,R;return((S=g.filter)===null||S===void 0?void 0:S.event)==="*"||((R=($=g.filter)===null||$===void 0?void 0:$.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===c}).map(g=>g.callback(E,n)):(l=this.bindings[c])===null||l===void 0||l.filter(g=>{var S,$,R,U,B,N;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in g){const z=g.id,Z=(S=g.filter)===null||S===void 0?void 0:S.event;return z&&(($=t.ids)===null||$===void 0?void 0:$.includes(z))&&(Z==="*"||Z?.toLocaleLowerCase()===((R=t.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const z=(B=(U=g?.filter)===null||U===void 0?void 0:U.event)===null||B===void 0?void 0:B.toLocaleLowerCase();return z==="*"||z===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===c}).map(g=>{if(typeof E=="object"&&"ids"in E){const S=E.data,{schema:$,table:R,commit_timestamp:U,type:B,errors:N}=S;E=Object.assign(Object.assign({},{schema:$,table:R,commit_timestamp:U,eventType:B,new:{},old:{},errors:N}),this._getPayloadRecords(S))}g.callback(E,n)})}_isClosed(){return this.state===vt.closed}_isJoined(){return this.state===vt.joined}_isJoining(){return this.state===vt.joining}_isLeaving(){return this.state===vt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&$a.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(lr.close,{},e)}_onError(e){this._on(lr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=vt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=al(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=al(e.columns,e.old_record)),t}}const ul=()=>{},Ki={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},rh=[1e3,2e3,5e3,1e4],nh=1e4,ih=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class sh{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=la,this.transport=null,this.heartbeatIntervalMs=Ki.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ul,this.ref=0,this.reconnectTimer=null,this.logger=ul,this.conn=null,this.sendBuffer=[],this.serializer=new Yd,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...c)=>bi(async()=>{const{default:h}=await Promise.resolve().then(()=>Xn);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...c)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...c)=>l(...c)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ua.websocket}`,this.httpEndpoint=pu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Vd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:zd}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case hi.connecting:return on.Connecting;case hi.open:return on.Open;case hi.closing:return on.Closing;default:return on.Closed}}isConnected(){return this.connectionState()===on.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===n);if(s)return s;{const l=new $a(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:n,payload:s,ref:l}=e,c=()=>{this.encode(e,h=>{var v;(v=this.conn)===null||v===void 0||v.send(h)})};this.log("push",`${t} ${n} (${l})`,s),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Gd,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ki.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:l,ref:c}=t,h=c?`(${c})`:"",v=l.status||"";this.log("receive",`${v} ${n} ${s} ${h}`.trim(),l),this.channels.filter(m=>m._isMember(n)).forEach(m=>m._trigger(s,l,c)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(lr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([ih],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:Hd};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(lr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new fu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ki.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,l,c,h,v,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:la,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:Ki.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>rh[_-1]||nh),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((_,k)=>k(JSON.stringify(_))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Fa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function pt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class ah extends Fa{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class da extends Fa{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var oh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};const gu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>bi(async()=>{const{default:n}=await Promise.resolve().then(()=>Xn);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},lh=()=>oh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield bi(()=>Promise.resolve().then(()=>Xn),void 0,import.meta.url)).Response:Response}),ha=r=>{if(Array.isArray(r))return r.map(t=>ha(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=ha(n)}),e},uh=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var yn=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};const Gs=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ch=(r,e,t)=>yn(void 0,void 0,void 0,function*(){const n=yield lh();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{const l=r.status||500,c=s?.statusCode||l+"";e(new ah(Gs(s),l,c))}).catch(s=>{e(new da(Gs(s),s))}):e(new da(Gs(r),r))}),dh=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"||!n?s:(uh(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function ki(r,e,t,n,s,l){return yn(this,void 0,void 0,function*(){return new Promise((c,h)=>{r(t,dh(e,n,s,l)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>c(v)).catch(v=>ch(v,h,n))})})}function us(r,e,t,n){return yn(this,void 0,void 0,function*(){return ki(r,"GET",e,t,n)})}function gr(r,e,t,n,s){return yn(this,void 0,void 0,function*(){return ki(r,"POST",e,n,s,t)})}function fa(r,e,t,n,s){return yn(this,void 0,void 0,function*(){return ki(r,"PUT",e,n,s,t)})}function hh(r,e,t,n){return yn(this,void 0,void 0,function*(){return ki(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function _u(r,e,t,n,s){return yn(this,void 0,void 0,function*(){return ki(r,"DELETE",e,n,s,t)})}var Mt=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};const fh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},cl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class vh{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=gu(s)}uploadOrUpdate(e,t,n,s){return Mt(this,void 0,void 0,function*(){try{let l;const c=Object.assign(Object.assign({},cl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const v=c.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=n,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType,v&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const m=this._removeEmptyFolders(t),_=this._getFinalPath(m),k=yield(e=="PUT"?fa:gr)(this.fetch,`${this.url}/object/${_}`,l,Object.assign({headers:h},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:m,id:k.Id,fullPath:k.Key},error:null}}catch(l){if(pt(l))return{data:null,error:l};throw l}})}upload(e,t,n){return Mt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return Mt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${c}`);h.searchParams.set("token",t);try{let v;const m=Object.assign({upsert:cl.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",m.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",m.cacheControl)):(v=n,_["cache-control"]=`max-age=${m.cacheControl}`,_["content-type"]=m.contentType);const k=yield fa(this.fetch,h.toString(),v,{headers:_});return{data:{path:l,fullPath:k.Key},error:null}}catch(v){if(pt(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return Mt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield gr(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),c=new URL(this.url+l.url),h=c.searchParams.get("token");if(!h)throw new Fa("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:h},error:null}}catch(n){if(pt(n))return{data:null,error:n};throw n}})}update(e,t,n){return Mt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return Mt(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(pt(s))return{data:null,error:s};throw s}})}copy(e,t,n){return Mt(this,void 0,void 0,function*(){try{return{data:{path:(yield gr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(pt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return Mt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield gr(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const c=n?.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${c}`)},{data:l,error:null}}catch(s){if(pt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return Mt(this,void 0,void 0,function*(){try{const s=yield gr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${l}`):null})),error:null}}catch(s){if(pt(s))return{data:null,error:s};throw s}})}download(e,t){return Mt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),c=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield us(this.fetch,`${this.url}/${s}/${h}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(pt(h))return{data:null,error:h};throw h}})}info(e){return Mt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield us(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ha(n),error:null}}catch(n){if(pt(n))return{data:null,error:n};throw n}})}exists(e){return Mt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield hh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(pt(n)&&n instanceof da){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&s.push(v);let m=s.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${m}`)}}}remove(e){return Mt(this,void 0,void 0,function*(){try{return{data:yield _u(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(pt(t))return{data:null,error:t};throw t}})}list(e,t,n){return Mt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},fh),t),{prefix:e||""});return{data:yield gr(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(pt(s))return{data:null,error:s};throw s}})}listV2(e,t){return Mt(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield gr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(pt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ph="2.11.0",gh={"X-Client-Info":`storage-js/${ph}`};var Rn=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};class _h{constructor(e,t={},n,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},gh),t),this.fetch=gu(n)}listBuckets(){return Rn(this,void 0,void 0,function*(){try{return{data:yield us(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(pt(e))return{data:null,error:e};throw e}})}getBucket(e){return Rn(this,void 0,void 0,function*(){try{return{data:yield us(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(pt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Rn(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(pt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Rn(this,void 0,void 0,function*(){try{return{data:yield fa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(pt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Rn(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(pt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Rn(this,void 0,void 0,function*(){try{return{data:yield _u(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(pt(t))return{data:null,error:t};throw t}})}}class mh extends _h{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new vh(this.url,this.headers,e,this.fetch)}}const yh="2.56.0";let ui="";typeof Deno<"u"?ui="deno":typeof document<"u"?ui="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ui="react-native":ui="node";const wh={"X-Client-Info":`supabase-js-${ui}/${yh}`},bh={headers:wh},kh={schema:"public"},Eh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Sh={};var Ah=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};const Ih=r=>{let e;return r?e=r:typeof fetch>"u"?e=ou:e=fetch,(...t)=>e(...t)},Ch=()=>typeof Headers>"u"?lu:Headers,Th=(r,e,t)=>{const n=Ih(t),s=Ch();return(l,c)=>Ah(void 0,void 0,void 0,function*(){var h;const v=(h=yield e())!==null&&h!==void 0?h:r;let m=new s(c?.headers);return m.has("apikey")||m.set("apikey",r),m.has("Authorization")||m.set("Authorization",`Bearer ${v}`),n(l,Object.assign(Object.assign({},c),{headers:m}))})};var Ph=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};function Rh(r){return r.endsWith("/")?r:r+"/"}function jh(r,e){var t,n;const{db:s,auth:l,realtime:c,global:h}=r,{db:v,auth:m,realtime:_,global:k}=e,E={db:Object.assign(Object.assign({},v),s),auth:Object.assign(Object.assign({},m),l),realtime:Object.assign(Object.assign({},_),c),storage:{},global:Object.assign(Object.assign(Object.assign({},k),h),{headers:Object.assign(Object.assign({},(t=k?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Ph(this,void 0,void 0,function*(){return""})};return r.accessToken?E.accessToken=r.accessToken:delete E.accessToken,E}const mu="2.71.1",Dn=30*1e3,va=3,Ks=va*Dn,Oh="http://localhost:9999",xh="supabase.auth.token",Mh={"X-Client-Info":`gotrue-js/${mu}`},pa="X-Supabase-Api-Version",yu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Lh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Dh=600*1e3;class Ua extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Se(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class $h extends Ua{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Fh(r){return Se(r)&&r.name==="AuthApiError"}class wu extends Ua{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Kr extends Ua{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Ur extends Kr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Uh(r){return Se(r)&&r.name==="AuthSessionMissingError"}class Yi extends Kr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ji extends Kr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Xi extends Kr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Nh(r){return Se(r)&&r.name==="AuthImplicitGrantRedirectError"}class dl extends Kr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ga extends Kr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ys(r){return Se(r)&&r.name==="AuthRetryableFetchError"}class hl extends Kr{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class _a extends Kr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),fl=` 	
\r=`.split(""),Bh=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<fl.length;e+=1)r[fl[e].charCodeAt(0)]=-2;for(let e=0;e<cs.length;e+=1)r[cs[e].charCodeAt(0)]=e;return r})();function vl(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cs[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cs[n]),e.queuedBits-=6}}function bu(r,e,t){const n=Bh[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function pl(r){const e=[],t=c=>{e.push(String.fromCodePoint(c))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=c=>{qh(c,n,t)};for(let c=0;c<r.length;c+=1)bu(r.charCodeAt(c),s,l);return e.join("")}function Wh(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Vh(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Wh(n,e)}}function qh(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Hh(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)bu(r.charCodeAt(s),t,n);return new Uint8Array(e)}function zh(r){const e=[];return Vh(r,t=>e.push(t)),new Uint8Array(e)}function Gh(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>vl(s,t,n)),vl(null,t,n),e.join("")}function Kh(r){return Math.round(Date.now()/1e3)+r}function Yh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const or=()=>typeof window<"u"&&typeof document<"u",tn={tested:!1,writable:!1},ku=()=>{if(!or())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tn.tested)return tn.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),tn.tested=!0,tn.writable=!0}catch{tn.tested=!0,tn.writable=!1}return tn.writable};function Jh(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const Eu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>bi(async()=>{const{default:n}=await Promise.resolve().then(()=>Xn);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Xh=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",$n=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},rn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Fr=async(r,e)=>{await r.removeItem(e)};class ks{constructor(){this.promise=new ks.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ks.promiseConstructor=Promise;function Js(r){const e=r.split(".");if(e.length!==3)throw new _a("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Lh.test(e[n]))throw new _a("JWT not in base64url format");return{header:JSON.parse(pl(e[0])),payload:JSON.parse(pl(e[1])),signature:Hh(e[2]),raw:{header:e[0],payload:e[1]}}}async function Qh(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Zh(r,e){return new Promise((n,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await r(l);if(!e(l,null,c)){n(c);return}}catch(c){if(!e(l,c)){s(c);return}}})()})}function ef(r){return("0"+r.toString(16)).substr(-2)}function tf(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,ef).join("")}async function rf(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function nf(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await rf(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function jn(r,e,t=!1){const n=tf();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await $n(r,`${e}-code-verifier`,s);const l=await nf(n);return[l,n===l?"plain":"s256"]}const sf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function af(r){const e=r.headers.get(pa);if(!e||!e.match(sf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function of(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function lf(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const uf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function On(r){if(!uf.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Xs(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function gl(r){return JSON.parse(JSON.stringify(r))}var cf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const sn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),df=[502,503,504];async function _l(r){var e;if(!Xh(r))throw new ga(sn(r),0);if(df.includes(r.status))throw new ga(sn(r),r.status);let t;try{t=await r.json()}catch(l){throw new wu(sn(l),l)}let n;const s=af(r);if(s&&s.getTime()>=yu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new hl(sn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ur}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new hl(sn(t),r.status,t.weak_password.reasons);throw new $h(sn(t),r.status||500,n)}const hf=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function Me(r,e,t,n){var s;const l=Object.assign({},n?.headers);l[pa]||(l[pa]=yu["2024-01-01"].name),n?.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const c=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(c.redirect_to=n.redirectTo);const h=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",v=await ff(r,e,t+h,{headers:l,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function ff(r,e,t,n,s,l){const c=hf(e,n,s,l);let h;try{h=await r(t,Object.assign({},c))}catch(v){throw console.error(v),new ga(sn(v),0)}if(h.ok||await _l(h),n?.noResolveJson)return h;try{return await h.json()}catch(v){await _l(v)}}function Pr(r){var e;let t=null;_f(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Kh(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function ml(r){const e=Pr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Nr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function vf(r){return{data:r,error:null}}function pf(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l}=r,c=cf(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l},v=Object.assign({},c);return{data:{properties:h,user:v},error:null}}function gf(r){return r}function _f(r){return r.access_token&&r.refresh_token&&r.expires_in}const Qs=["global","local","others"];var mf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class yf{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Eu(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Qs[0]){if(Qs.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Qs.join(", ")}`);try{return await Me(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Me(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Nr})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=mf(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await Me(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:pf,redirectTo:t?.redirectTo})}catch(t){if(Se(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Me(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Nr})}catch(t){if(Se(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,l,c,h,v;try{const m={nextPage:null,lastPage:0,total:0},_=await Me(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:gf});if(_.error)throw _.error;const k=await _.json(),E=(c=_.headers.get("x-total-count"))!==null&&c!==void 0?c:0,g=(v=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&v!==void 0?v:[];return g.length>0&&(g.forEach(S=>{const $=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(S.split(";")[1].split("=")[1]);m[`${R}Page`]=$}),m.total=parseInt(E)),{data:Object.assign(Object.assign({},k),m),error:null}}catch(m){if(Se(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){On(e);try{return await Me(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Nr})}catch(t){if(Se(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){On(e);try{return await Me(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Nr})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){On(e);try{return await Me(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Nr})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){On(e.userId);try{const{data:t,error:n}=await Me(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _deleteFactor(e){On(e.userId),On(e.id);try{return{data:await Me(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Se(t))return{data:null,error:t};throw t}}}function yl(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function wf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const xn={debug:!!(globalThis&&ku()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Su extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bf extends Su{}async function kf(r,e,t){xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),xn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new bf(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(xn.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}wf();const Ef={url:Oh,storageKey:xh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Mh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function wl(r,e,t){return await t()}const Mn={};class mi{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=mi.nextInstanceID,mi.nextInstanceID+=1,this.instanceID>0&&or()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Ef),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new yf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Eu(s.fetch),this.lock=s.lock||wl,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:or()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=kf:this.lock=wl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:ku()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=yl(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=yl(this.memoryStorage)),or()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Mn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Mn[this.storageKey]=Object.assign(Object.assign({},Mn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Mn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Mn[this.storageKey]=Object.assign(Object.assign({},Mn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${mu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Jh(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),or()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Nh(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:c,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",c,"redirect type",h),await this._saveSession(c),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Se(t)?{error:t}:{error:new wu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const l=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Pr}),{data:c,error:h}=l;if(h||!c)return{data:{user:null,session:null},error:h};const v=c.session,m=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(l){if(Se(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,n,s;try{let l;if("email"in e){const{email:_,password:k,options:E}=e;let g=null,S=null;this.flowType==="pkce"&&([g,S]=await jn(this.storage,this.storageKey)),l=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:E?.emailRedirectTo,body:{email:_,password:k,data:(t=E?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:E?.captchaToken},code_challenge:g,code_challenge_method:S},xform:Pr})}else if("phone"in e){const{phone:_,password:k,options:E}=e;l=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:k,data:(n=E?.data)!==null&&n!==void 0?n:{},channel:(s=E?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:E?.captchaToken}},xform:Pr})}else throw new Ji("You must provide either an email or phone number and a password");const{data:c,error:h}=l;if(h||!c)return{data:{user:null,session:null},error:h};const v=c.session,m=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(l){if(Se(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:c,options:h}=e;t=await Me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:ml})}else if("phone"in e){const{phone:l,password:c,options:h}=e;t=await Me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:ml})}else throw new Ji("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Yi}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(Se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,l,c,h,v,m,_,k,E,g;let S,$;if("message"in e)S=e.message,$=e.signature;else{const{chain:R,wallet:U,statement:B,options:N}=e;let z;if(or())if(typeof U=="object")z=U;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))z=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=U}const Z=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const O=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:Z.host,uri:Z.href}),B?{statement:B}:null));let L;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")L=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)L=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in L&&"signature"in L&&(typeof L.signedMessage=="string"||L.signedMessage instanceof Uint8Array)&&L.signature instanceof Uint8Array)S=typeof L.signedMessage=="string"?L.signedMessage:new TextDecoder().decode(L.signedMessage),$=L.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${Z.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...B?["",B,""]:[""],"Version: 1",`URI: ${Z.href}`,`Issued At: ${(s=(n=N?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=N?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((c=N?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((v=N?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((m=N?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((k=(_=N?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||k===void 0)&&k.length?["Resources",...N.signInWithSolana.resources.map(L=>`- ${L}`)]:[]].join(`
`);const O=await z.signMessage(new TextEncoder().encode(S),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");$=O}}try{const{data:R,error:U}=await Me(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:Gh($)},!((E=e.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Pr});if(U)throw U;return!R||!R.session||!R.user?{data:{user:null,session:null},error:new Yi}:(R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),{data:Object.assign({},R),error:U})}catch(R){if(Se(R))return{data:{user:null,session:null},error:R};throw R}}async _exchangeCodeForSession(e){const t=await rn(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:l,error:c}=await Me(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Pr});if(await Fr(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new Yi}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:c})}catch(l){if(Se(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:l,nonce:c}=e,h=await Me(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Pr}),{data:v,error:m}=h;return m?{data:{user:null,session:null},error:m}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new Yi}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:m})}catch(t){if(Se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,l,c;try{if("email"in e){const{email:h,options:v}=e;let m=null,_=null;this.flowType==="pkce"&&([m,_]=await jn(this.storage,this.storageKey));const{error:k}=await Me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:m,code_challenge_method:_},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:k}}if("phone"in e){const{phone:h,options:v}=e,{data:m,error:_}=await Me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=v?.data)!==null&&s!==void 0?s:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(c=v?.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:_}}throw new Ji("You must provide either an email or phone number.")}catch(h){if(Se(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:c,error:h}=await Me(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Pr});if(h)throw h;if(!c)throw new Error("An error occurred on token verification.");const v=c.session,m=c.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:m,session:v},error:null}}catch(s){if(Se(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let l=null,c=null;return this.flowType==="pkce"&&([l,c]=await jn(this.storage,this.storageKey)),await Me(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:vf})}catch(l){if(Se(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ur;const{error:s}=await Me(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Se(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:l}=e,{error:c}=await Me(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:n,type:s,options:l}=e,{data:c,error:h}=await Me(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:c?.message_id},error:h}}throw new Ji("You must provide either an email or phone number and a type")}catch(t){if(Se(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await rn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Ks:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const c=await rn(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=Xs()}if(this.storage.isServer&&e.user){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,m,_)=>(!c&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,m,_))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Nr}):await this._useSession(async t=>{var n,s,l;const{data:c,error:h}=t;if(h)throw h;return!(!((n=c.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ur}:await Me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=c.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:Nr})})}catch(t){if(Se(t))return Uh(t)&&(await this._removeSession(),await Fr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:l}=n;if(l)throw l;if(!s.session)throw new Ur;const c=s.session;let h=null,v=null;this.flowType==="pkce"&&e.email!=null&&([h,v]=await jn(this.storage,this.storageKey));const{data:m,error:_}=await Me(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:v}),jwt:c.access_token,xform:Nr});if(_)throw _;return c.user=m.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ur;const t=Date.now()/1e3;let n=t,s=!0,l=null;const{payload:c}=Js(e.access_token);if(c.exp&&(n=c.exp,s=n<=t),s){const{session:h,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Se(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:c,error:h}=t;if(h)throw h;e=(n=c.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Ur;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Se(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!or())throw new Xi("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Xi(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new dl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Xi("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new dl("No code detected.");const{data:B,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:B.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:l,refresh_token:c,expires_in:h,expires_at:v,token_type:m}=e;if(!l||!h||!c||!m)throw new Xi("No session defined in URL");const _=Math.round(Date.now()/1e3),k=parseInt(h);let E=_+k;v&&(E=parseInt(v));const g=E-_;g*1e3<=Dn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${k}s`);const S=E-k;_-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,E,_):_-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,E,_);const{data:$,error:R}=await this._getUser(l);if(R)throw R;const U={provider_token:n,provider_refresh_token:s,access_token:l,expires_in:k,expires_at:E,refresh_token:c,token_type:m,user:$.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:e.type},error:null}}catch(n){if(Se(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await rn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{error:l};const c=(n=s.session)===null||n===void 0?void 0:n.access_token;if(c){const{error:h}=await this.admin.signOut(c,e);if(h&&!(Fh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Fr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Yh(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:l},error:c}=t;if(c)throw c;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await jn(this.storage,this.storageKey,!0));try{return await Me(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Se(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Se(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async l=>{var c,h,v,m,_;const{data:k,error:E}=l;if(E)throw E;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await Me(this.fetch,"GET",g,{headers:this.headers,jwt:(_=(m=k.session)===null||m===void 0?void 0:m.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return or()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(Se(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:c}=t;if(c)throw c;return await Me(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Zh(async s=>(s>0&&await Qh(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Me(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Pr})),(s,l)=>{const c=200*Math.pow(2,s);return l&&Ys(l)&&Date.now()+c-n<Dn})}catch(n){if(this._debug(t,"error",n),Se(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),or()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await rn(this.storage,this.storageKey);if(s&&this.userStorage){let c=await rn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:s.user},await $n(this.userStorage,this.storageKey+"-user",c)),s.user=(e=c?.user)!==null&&e!==void 0?e:Xs()}else if(s&&!s.user&&!s.user){const c=await rn(this.storage,this.storageKey+"-user");c&&c?.user?(s.user=c.user,await Fr(this.storage,this.storageKey+"-user"),await $n(this.storage,this.storageKey,s)):s.user=Xs()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Ks;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${Ks}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:c}=await this._callRefreshToken(s.refresh_token);c&&(console.error(c),Ys(c)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:h}=await this._getUser(s.access_token);!h&&c?.user?(s.user=c.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(n,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ur;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ks;const{data:l,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!l.session)throw new Ur;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),Se(l)){const c={session:null,error:l};return Ys(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(c),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await $n(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=gl(s);await $n(this.storage,this.storageKey,l)}else{const s=gl(t);await $n(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Fr(this.storage,this.storageKey),await Fr(this.storage,this.storageKey+"-code-verifier"),await Fr(this.storage,this.storageKey+"-user"),this.userStorage&&await Fr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&or()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Dn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Dn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Dn}ms, refresh threshold is ${va} ticks`),s<=va&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Su)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!or()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,c]=await jn(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});s.push(h.toString())}if(n?.queryParams){const l=new URLSearchParams(n.queryParams);s.push(l.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await Me(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:c}=t;if(c)return{data:null,error:c};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:m}=await Me(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((s=v?.totp)===null||s===void 0)&&s.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:c,error:h}=await Me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:h})})}catch(t){if(Se(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await Me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Se(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],s=n.filter(c=>c.factor_type==="totp"&&c.status==="verified"),l=n.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:n,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=Js(s.access_token);let h=null;c.aal&&(h=c.aal);let v=h;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(k=>k.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const _=c.amr||[];return{data:{currentLevel:h,nextLevel:v,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+Dh>s)return n;const{data:l,error:c}=await Me(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,n=l.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:g,error:S}=await this.getSession();if(S||!g.session)return{data:null,error:S};n=g.session.access_token}const{header:s,payload:l,signature:c,raw:{header:h,payload:v}}=Js(n);t?.allowExpired||of(l.exp);const m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:l,header:s,signature:c},error:null}}const _=lf(s.alg),k=await crypto.subtle.importKey("jwk",m,_,!0,["verify"]);if(!await crypto.subtle.verify(_,k,c,zh(`${h}.${v}`)))throw new _a("Invalid JWT signature");return{data:{claims:l,header:s,signature:c},error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}}}mi.nextInstanceID=0;const Sf=mi;class Af extends Sf{constructor(e){super(e)}}var If=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function h(_){try{m(n.next(_))}catch(k){c(k)}}function v(_){try{m(n.throw(_))}catch(k){c(k)}}function m(_){_.done?l(_.value):s(_.value).then(h,v)}m((n=n.apply(r,e||[])).next())})};class Cf{constructor(e,t,n){var s,l,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Rh(e),v=new URL(h);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const m=`sb-${v.hostname.split(".")[0]}-auth-token`,_={db:kh,realtime:Sh,auth:Object.assign(Object.assign({},Eh),{storageKey:m}),global:bh},k=jh(n??{},_);this.storageKey=(s=k.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=k.global.headers)!==null&&l!==void 0?l:{},k.accessToken?(this.accessToken=k.accessToken,this.auth=new Proxy({},{get:(E,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=k.auth)!==null&&c!==void 0?c:{},this.headers,k.global.fetch),this.fetch=Th(t,this._getAccessToken.bind(this),k.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},k.realtime)),this.rest=new Wd(new URL("rest/v1",v).href,{headers:this.headers,schema:k.db.schema,fetch:this.fetch}),this.storage=new mh(this.storageUrl.href,this.headers,this.fetch,n?.storage),k.accessToken||this._listenForAuthEvents()}get functions(){return new Rd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return If(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:l,flowType:c,lock:h,debug:v},m,_){const k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Af({url:this.authUrl.href,headers:Object.assign(Object.assign({},k),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:c,lock:h,debug:v,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new sh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Tf=(r,e,t)=>new Cf(r,e,t);function Pf(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Pf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Rf="https://vycjpmuyscfygstjjied.supabase.co",jf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",mr=Tf(Rf,jf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),zr={async loadStoriesList(){if(!P.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${P.selectedBucket}`);const r=`${P.selectedBucket}_story.json`,{data:e,error:t}=await mr.storage.from(P.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(P.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(P.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!P.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await mr.storage.from(P.selectedBucket).list();r&&(P.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!P.selectedBucket){rt.setStatus("error","Не выбрана история");return}const t=e.files[0];rt.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),s=new Uint8Array(n),{error:l}=await mr.storage.from(P.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?rt.setStatus("error","Ошибка загрузки"):(rt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!P.selectedBucket){rt.setStatus("error","Не выбрана история");return}const{error:e}=await mr.storage.from(P.selectedBucket).remove([r]);e?rt.setStatus("error","Ошибка удаления файла"):(rt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Of(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история"}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function xf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const un={async createNewStory(){if(!P.selectedBucket){rt.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1"}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await mr.storage.from(P.selectedBucket).upload(r,s,{contentType:"application/json"});l?rt.setStatus("error","Ошибка создания: "+l.message):(await zr.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!P.selectedBucket){rt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${P.selectedBucket}`),rt.setStatus("loading","Загрузка..."),P.currentFileName=r;try{const{data:e,error:t}=await mr.storage.from(P.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=mr.storage.from(P.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const c=await fetch(l);if(!c.ok)throw new Error(`Не удалось загрузить файл: ${c.statusText}`);n=await c.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let s=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Of(s),console.log("[StoryStore] Присваиваем данные в editor.data"),P.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:P.data.chapters?.length,dialogues:P.data.dialogues?.length}),P.data.chapters&&P.data.chapters.length>0&&(P.selectedChapterId=P.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${P.selectedChapterId}`)),P.data.dialogues&&P.data.dialogues.length>0&&(P.selectedDialogueId=P.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${P.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),rt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),rt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!P.data)return;if(!P.selectedBucket){rt.setStatus("error","Не выбрана история (bucket)");return}rt.setStatus("loading","Сохранение...");const r=JSON.stringify(P.data,null,2);console.log(`[StoryStore] Сохранение файла: ${P.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await mr.storage.from(P.selectedBucket).update(P.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const s=await mr.storage.from(P.selectedBucket).upload(P.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),rt.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),rt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),rt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!P.data)return;if(!P.selectedBucket){rt.setStatus("error","Не выбрана история (bucket)");return}const r=P.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),rt.setStatus("loading","Создание копии...");const s=JSON.stringify(P.data,null,2),c=new TextEncoder().encode(s),{error:h}=await mr.storage.from(P.selectedBucket).upload(t,c,{upsert:!0,contentType:"application/json"});h?rt.setStatus("error",`Ошибка копии: ${h.message}`):(await zr.loadStoriesList(),rt.setStatus("success","Копия сохранена!"))},addChapter(){if(!P.data||!P.data.chapters)return;const r="ch_"+Date.now();P.data.chapters.push({id:r,title:"Новая глава"}),P.selectedChapterId=r},addDialogue(){if(!P.data||!P.selectedChapterId)return;const r="d_"+Date.now();P.data.dialogues.push({id:r,chapterId:P.selectedChapterId,text:"Новый текст...",options:[]}),P.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&P.data&&(P.data.dialogues=P.data.dialogues.filter(e=>e.id!==r),P.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),P.selectedDialogueId===r&&(P.selectedDialogueId=null))},jumpTo(r){const e=P.data?.dialogues.find(t=>t.id===r);e&&(P.selectedChapterId=e.chapterId,P.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var qt=Jn(()=>P),Mf=ue('<button type="button"> </button>'),Lf=ue('<button type="button"><span class="id-badge svelte-1s51h91"> </span> <span class="preview-text svelte-1s51h91"> </span></button>'),Df=ue("<div> </div>"),$f=ue('<aside class="sidebar svelte-1s51h91"><div class="sidebar-section svelte-1s51h91"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-1s51h91"></div></div> <div class="sidebar-section flex-1 svelte-1s51h91"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-1s51h91"></div></div> <div class="status-box svelte-1s51h91"><!></div></aside>');function Ff(r,e){tr(e,!1),mn();var t=$f(),n=F(t),s=F(n),l=W(F(s),2);l.__click=function(...R){un.addChapter?.apply(this,R)};var c=W(s,2);Pt(c,5,()=>qt().data?.chapters||[],R=>R.id,(R,U)=>{var B=Mf();let N;B.__click=()=>qt(qt().selectedChapterId=x(U).id);var z=F(B);Re(Z=>{N=qr(B,1,"chapter-item svelte-1s51h91",null,N,Z),Le(B,"aria-pressed",qt().selectedChapterId===x(U).id),Fe(z,x(U).title)},[()=>({active:qt().selectedChapterId===x(U).id})]),ee(R,B)});var h=W(n,2),v=F(h),m=F(v),_=F(m),k=W(m,2);k.__click=function(...R){un.addDialogue?.apply(this,R)};var E=W(v,2);Pt(E,5,()=>At.chapterDialogues,R=>R.id,(R,U)=>{var B=Lf();let N;B.__click=()=>qt(qt().selectedDialogueId=x(U).id);var z=F(B),Z=F(z),O=W(z,2),L=F(O);Re((ie,J)=>{N=qr(B,1,"dialogue-item svelte-1s51h91",null,N,ie),Le(B,"aria-pressed",qt().selectedDialogueId===x(U).id),Fe(Z,x(U).id),Fe(L,`${J??""}...`)},[()=>({active:qt().selectedDialogueId===x(U).id}),()=>x(U).text.substring(0,25)]),ee(R,B)});var g=W(h,2),S=F(g);{var $=R=>{var U=Df(),B=F(U);Re(()=>{qr(U,1,`alert ${qt().statusMessage.type??""}`,"svelte-1s51h91"),Fe(B,qt().statusMessage.text)}),ee(R,U)};Ne(S,R=>{qt().statusMessage.text&&R($)})}Re(()=>{Fe(_,`Сцены (${At.chapterDialogues.length??""})`),k.disabled=!qt().selectedChapterId}),ee(r,t),rr()}Er(["click"]);var Uf=ue("<option> </option>"),Nf=(r,e)=>{const t=r.target.value;e({type:t})},Bf=ue("<option> </option>"),Wf=(r,e)=>e({itemId:r.target.value}),Vf=ue("<option> </option>"),qf=ue('<div class="form-group full-width svelte-1br6fha"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),Hf=(r,e)=>e({statName:r.target.value}),zf=(r,e)=>e({statValue:parseInt(r.target.value)||0}),Gf=ue('<div class="form-group svelte-1br6fha"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-1br6fha"><label>Значение ></label> <input type="number" class="input"/></div>',1),Kf=(r,e)=>e({flagName:r.target.value}),Yf=ue('<div class="form-group full-width svelte-1br6fha"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),Jf=ue('<div class="option-details svelte-1br6fha"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="options-settings-grid svelte-1br6fha"><div class="setting-col svelte-1br6fha"><label class="checkbox-row svelte-1br6fha"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-1br6fha">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-1br6fha"><label class="checkbox-row svelte-1br6fha"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-1br6fha">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-1br6fha"><h5 class="svelte-1br6fha">Условие видимости</h5> <div class="form-row svelte-1br6fha"><div class="form-group svelte-1br6fha"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function Xf(r,e){tr(e,!0);const t=Ma(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return n(),t().visibilityCondition}function l(we){n(),t().visibilityCondition={...t().visibilityCondition,...we}}var c=Jf(),h=F(c),v=F(h),m=W(v,2),_=W(h,2),k=F(_),E=W(k,2),g=F(E);g.value=g.__value="";var S=W(g);Pt(S,17,()=>e.dialogues,Qt,(we,Ie)=>{var pe=Uf(),ke=F(pe),Ye={};Re(me=>{Fe(ke,`${x(Ie).id??""}: ${me??""}...`),Ye!==(Ye=x(Ie).id)&&(pe.value=(pe.__value=x(Ie).id)??"")},[()=>x(Ie).text.substring(0,30)]),ee(we,pe)});var $=W(_,2),R=F($),U=F(R),B=F(U),N=W(R,2),z=F(N),Z=F(z),O=W($,2),L=W(F(O),2),ie=F(L),J=F(ie),ne=W(J,2);ne.__change=[Nf,l],Pt(ne,21,()=>e.conditionTypes,Qt,(we,Ie)=>{var pe=Bf(),ke=F(pe),Ye={};Re(()=>{Fe(ke,x(Ie)),Ye!==(Ye=x(Ie))&&(pe.value=(pe.__value=x(Ie))??"")}),ee(we,pe)});var Y;aa(ne);var X=W(ie,2);{var ve=we=>{var Ie=qf(),pe=F(Ie),ke=W(pe,2);ke.__change=[Wf,l];var Ye=F(ke);Ye.value=Ye.__value="";var me=W(Ye);Pt(me,17,()=>e.availableItems,Qt,(ge,le)=>{var de=Vf(),Oe=F(de),Ge={};Re(()=>{Fe(Oe,x(le).name),Ge!==(Ge=x(le).id)&&(de.value=(de.__value=x(le).id)??"")}),ee(ge,de)});var Ee;aa(ke),Re(ge=>{Le(pe,"for",`option-cond-item-${e.index??""}`),Le(ke,"id",`option-cond-item-${e.index??""}`),Ee!==(Ee=ge)&&(ke.value=(ke.__value=ge)??"",ls(ke,ge))},[()=>s().itemId||""]),ee(we,Ie)};Ne(X,we=>{s().type==="has_item"&&we(ve)})}var Ae=W(X,2);{var ce=we=>{var Ie=Gf(),pe=zt(Ie),ke=F(pe),Ye=W(ke,2);Ye.__input=[Hf,l];var me=W(pe,2),Ee=F(me),ge=W(Ee,2);ge.__input=[zf,l],Re((le,de)=>{Le(ke,"for",`option-cond-stat-${e.index??""}`),Le(Ye,"id",`option-cond-stat-${e.index??""}`),Vs(Ye,le),Le(Ee,"for",`option-cond-stat-val-${e.index??""}`),Le(ge,"id",`option-cond-stat-val-${e.index??""}`),Vs(ge,de)},[()=>s().statName||"",()=>s().statValue||""]),ee(we,Ie)};Ne(Ae,we=>{s().type==="stat_greater"&&we(ce)})}var Ke=W(Ae,2);{var ye=we=>{var Ie=Yf(),pe=F(Ie),ke=W(pe,2);ke.__input=[Kf,l],Re(Ye=>{Le(pe,"for",`option-cond-flag-${e.index??""}`),Le(ke,"id",`option-cond-flag-${e.index??""}`),Vs(ke,Ye)},[()=>s().flagName||""]),ee(we,Ie)};Ne(Ke,we=>{s().type==="flag_true"&&we(ye)})}Re(we=>{Le(v,"for",`option-text-${e.index??""}`),Le(m,"id",`option-text-${e.index??""}`),Le(k,"for",`option-next-${e.index??""}`),Le(E,"id",`option-next-${e.index??""}`),Le(J,"for",`option-cond-type-${e.index??""}`),Le(ne,"id",`option-cond-type-${e.index??""}`),Y!==(Y=we)&&(ne.value=(ne.__value=we)??"",ls(ne,we))},[()=>s().type]),ln(m,()=>t().text,we=>t().text=we),ci(E,()=>t().nextDialogueId,we=>t().nextDialogueId=we),Go(B,()=>t().enabled,we=>t().enabled=we),Go(Z,()=>t().visible,we=>t().visible=we),ee(r,c),rr()}Er(["change","input"]);var ct=Jn(()=>P),Qe=Jn(()=>At),Qf=ue("<option> </option>"),Zf=ue("<option> </option>"),ev=ue("<option> </option>"),tv=ue("<option> </option>"),rv=ue('<div class="option-content svelte-1de8com"><!></div>'),nv=ue('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),iv=ue("<option> </option>"),sv=ue('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),av=ue('<div class="empty-state">Выберите сцену</div>');function ov(r,e){tr(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(_){_.options||(_.options=[]);const k=xf();_.options.push(k),ct(ct().editingOptionIndex=_.options.length-1)}function s(_){if(ct().editingOptionIndex===_)ct(ct().editingOptionIndex=null);else{ct(ct().editingOptionIndex=_);const k=Qe().currentDialogue?.options?.[_];k&&!k.visibilityCondition&&(k.visibilityCondition={type:"always"})}}function l(_,k){confirm("Удалить вариант ответа?")&&(_.options?.splice(k,1),ct().editingOptionIndex===k?ct(ct().editingOptionIndex=null):ct().editingOptionIndex&&ct().editingOptionIndex>k&&ct(ct().editingOptionIndex--))}mn();var c=wr(),h=zt(c);{var v=_=>{var k=sv(),E=F(k),g=W(F(E),2),S=W(E,2),$=W(F(S),2),R=W(S,2),U=W(F(R),2),B=W(F(U),2),N=F(B);Re(()=>{Qe(),_r(()=>{})});var z=F(N);z.value=z.__value="";var Z=W(z);Pt(Z,1,()=>Qe().imageResources,Qt,(ge,le)=>{var de=Qf(),Oe=F(de),Ge={};Re(()=>{Fe(Oe,x(le).name),Ge!==(Ge=x(le).name)&&(de.value=(de.__value=x(le).name)??"")}),ee(ge,de)});var O=W(Z);Pt(O,1,()=>Qe().riveResources,Qt,(ge,le)=>{var de=Zf(),Oe=F(de),Ge={};Re(()=>{Fe(Oe,`${x(le).name??""} (Rive)`),Ge!==(Ge=x(le).name)&&(de.value=(de.__value=x(le).name)??"")}),ee(ge,de)});var L=W(N,2),ie=W(F(L));ie.__change=function(...ge){zr.uploadNewFile?.apply(this,ge)};var J=W(U,2),ne=W(F(J),2),Y=F(ne);Re(()=>{Qe(),_r(()=>{})});var X=F(Y);X.value=X.__value="";var ve=W(X);Pt(ve,1,()=>Qe().imageResources,Qt,(ge,le)=>{var de=ev(),Oe=F(de),Ge={};Re(()=>{Fe(Oe,x(le).name),Ge!==(Ge=x(le).name)&&(de.value=(de.__value=x(le).name)??"")}),ee(ge,de)});var Ae=W(ve);Pt(Ae,1,()=>Qe().riveResources,Qt,(ge,le)=>{var de=tv(),Oe=F(de),Ge={};Re(()=>{Fe(Oe,`${x(le).name??""} (Rive)`),Ge!==(Ge=x(le).name)&&(de.value=(de.__value=x(le).name)??"")}),ee(ge,de)});var ce=W(R,2),Ke=F(ce),ye=W(F(Ke),2);ye.__click=()=>n(Qe().currentDialogue);var we=W(Ke,2);Pt(we,1,()=>Qe().currentDialogue.options||[],Qt,(ge,le,de)=>{var Oe=nv();let Ge;var It=F(Oe),ht=F(It);ht.__click=()=>s(de),ht.__keydown=it=>{(it.key==="Enter"||it.key===" ")&&(it.preventDefault(),s(de))},Le(ht,"aria-controls",`option-content-${de}`);var Bt=F(ht),gt=F(Bt);{var jt=it=>{var Ot=Bs("👁️‍🗨️");ee(it,Ot)},Kt=it=>{var Ot=wr(),xt=zt(Ot);{var p=d=>{var w=Bs("🔒");ee(d,w)},o=d=>{var w=Bs("✅");ee(d,w)};Ne(xt,d=>{x(le).enabled?d(o,!1):d(p)},!0)}ee(it,Ot)};Ne(gt,it=>{x(le).visible?it(Kt,!1):it(jt)})}var lt=W(Bt,2),st=F(lt),cr=W(ht,2);cr.__click=()=>l(Qe().currentDialogue,de);var _t=W(It,2);{var Lr=it=>{var Ot=rv();Le(Ot,"id",`option-content-${de}`);var xt=F(Ot);Xf(xt,{get option(){return x(le)},index:de,get dialogues(){return ct().data.dialogues},get availableItems(){return Qe().availableItems},get conditionTypes(){return t}}),ee(it,Ot)};Ne(_t,it=>{ct().editingOptionIndex===de&&it(Lr)})}Re(it=>{Ge=qr(Oe,1,"option-card svelte-1de8com",null,Ge,it),Le(ht,"aria-expanded",ct().editingOptionIndex===de),Fe(st,`#${de+1} ${x(le).text??""}`)},[()=>({editing:ct().editingOptionIndex===de})]),ee(ge,Oe)});var Ie=W(ce,2),pe=W(F(Ie),2);Re(()=>{Qe(),_r(()=>{ct()})});var ke=F(pe);ke.value=ke.__value="";var Ye=W(ke);Pt(Ye,1,()=>ct().data.dialogues,Qt,(ge,le)=>{var de=iv(),Oe=F(de),Ge={};Re(It=>{Fe(Oe,`${x(le).id??""}: ${It??""}...`),Ge!==(Ge=x(le).id)&&(de.value=(de.__value=x(le).id)??"")},[()=>x(le).text.substring(0,30)]),ee(ge,de)});var me=W(Ie,2),Ee=F(me);Ee.__click=()=>un.deleteDialogue(Qe().currentDialogue.id),ln(g,()=>Qe().currentDialogue.id,ge=>Qe(Qe().currentDialogue.id=ge)),ln($,()=>Qe().currentDialogue.text,ge=>Qe(Qe().currentDialogue.text=ge)),ci(N,()=>Qe().currentDialogue.backgroundImage,ge=>Qe(Qe().currentDialogue.backgroundImage=ge)),ci(Y,()=>Qe().currentDialogue.characterImage,ge=>Qe(Qe().currentDialogue.characterImage=ge)),ci(pe,()=>Qe().currentDialogue.nextDialogueId,ge=>Qe(Qe().currentDialogue.nextDialogueId=ge)),ee(_,k)},m=_=>{var k=av();ee(_,k)};Ne(h,_=>{Qe().currentDialogue?_(v):_(m,!1)})}ee(r,c),rr()}Er(["change","click","keydown"]);var be=Jn(()=>P),lv=ue('<img class="icon-preview svelte-asgatj"/>'),uv=ue('<div class="icon-placeholder svelte-asgatj">📦</div>'),cv=ue("<option> </option>"),dv=ue('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),hv=ue("<option> </option>"),fv=ue('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),vv=ue('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),pv=ue('<div class="items-list svelte-asgatj"></div>'),gv=ue('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),_v=ue('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),mv=ue('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function yv(r,e){tr(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!be().data)return;be().data.items||be(be().data.items=[]);const R={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};be().data.items.push(R),be(be().editingItemIndex=be().data.items.length-1)}function s(R){be().editingItemIndex===R?be(be().editingItemIndex=null):be(be().editingItemIndex=R)}function l(R){confirm("Удалить предмет?")&&be().data?.items&&(be().data.items.splice(R,1),be(be().editingItemIndex=null))}function c(R){if(!be().data?.items)return;const U=be().data.items[R],B={...U,id:`${U.id}_copy_${Date.now()}`,name:`${U.name} (копия)`};be().data.items.splice(R+1,0,B),be(be().editingItemIndex=R+1)}function h(R){return t.find(U=>U.value===R)?.label||R}mn();var v=mv(),m=F(v);m.__click=()=>be(be().showItems=!be().showItems);var _=F(m),k=W(F(_)),E=W(_,2),g=F(E),S=W(m,2);{var $=R=>{var U=_v(),B=F(U);{var N=O=>{var L=pv();Pt(L,7,()=>be().data.items,ie=>ie.id,(ie,J,ne)=>{var Y=vv();let X;var ve=F(Y);ve.__click=()=>s(x(ne));var Ae=F(ve),ce=F(Ae),Ke=F(ce);{var ye=lt=>{var st=lv();Re(()=>{Le(st,"src",`https://vycjpmuyscfygstjjied.supabase.co/${be().selectedBucket}/${x(J).icon}`),Le(st,"alt",x(J).name)}),ee(lt,st)},we=lt=>{var st=uv();ee(lt,st)};Ne(Ke,lt=>{x(J).icon?lt(ye):lt(we,!1)})}var Ie=W(ce,2),pe=F(Ie),ke=F(pe),Ye=W(pe,2),me=F(Ye),Ee=F(me),ge=W(me,2);let le;var de=F(ge),Oe=W(Ae,2),Ge=F(Oe),It=W(ve,2),ht=F(It);ht.__click=()=>c(x(ne));var Bt=W(ht,2);Bt.__click=()=>s(x(ne));var gt=W(Bt,2);gt.__click=()=>l(x(ne));var jt=W(It,2);{var Kt=lt=>{var st=fv(),cr=F(st),_t=F(cr),Lr=F(_t),it=W(Lr,2),Ot=W(_t,2),xt=F(Ot),p=W(xt,2),o=W(Ot,2),d=F(o),w=W(d,2),C=W(o,2),D=F(C),V=W(D,2),he=F(V),_e=W(he,2);_e.__change=De=>(x(J).icon=De.target.value,_r(()=>be()));var oe=F(_e);oe.value=oe.__value="";var je=W(oe);Pt(je,1,()=>be().storedFiles.filter(De=>De.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Qt,(De,ft)=>{var ot=cv(),Ct=F(ot),fe={};Re(()=>{Fe(Ct,x(ft).name),fe!==(fe=x(ft).name)&&(ot.value=(ot.__value=x(ft).name)??"")}),ee(De,ot)});var qe=W(_e,2),ut=W(F(qe));ut.__change=function(...De){zr.uploadNewFile?.apply(this,De)};var Ze=W(V,2);{var Wt=De=>{var ft=dv(),ot=F(ft),Ct=W(ot,2),fe=F(Ct);Re(()=>{Le(ot,"src",`https://vycjpmuyscfygstjjied.supabase.co/${be().selectedBucket}/${x(J).icon}`),Fe(fe,x(J).icon)}),ee(De,ft)};Ne(Ze,De=>{x(J).icon&&De(Wt)})}var $t=W(C,2),Et=F($t),mt=W(Et,2);Re(()=>{x(J),_r(()=>{x(ne)})}),Pt(mt,5,()=>t,Qt,(De,ft)=>{var ot=hv(),Ct=F(ot),fe={};Re(()=>{Fe(Ct,x(ft).label),fe!==(fe=x(ft).value)&&(ot.value=(ot.__value=x(ft).value)??"")}),ee(De,ot)}),Re(()=>{Le(Lr,"for",`item-id-${x(ne)??""}`),Le(it,"id",`item-id-${x(ne)??""}`),Le(xt,"for",`item-name-${x(ne)??""}`),Le(p,"id",`item-name-${x(ne)??""}`),Le(d,"for",`item-desc-${x(ne)??""}`),Le(w,"id",`item-desc-${x(ne)??""}`),Le(D,"for",`item-icon-${x(ne)??""}`),Le(he,"id",`item-icon-${x(ne)??""}`),Le(Et,"for",`item-type-${x(ne)??""}`),Le(mt,"id",`item-type-${x(ne)??""}`)}),ln(it,()=>x(J).id,De=>(x(J).id=De,_r(()=>be()))),ln(p,()=>x(J).name,De=>(x(J).name=De,_r(()=>be()))),ln(w,()=>x(J).description,De=>(x(J).description=De,_r(()=>be()))),ln(he,()=>x(J).icon,De=>(x(J).icon=De,_r(()=>be()))),ci(mt,()=>x(J).type,De=>(x(J).type=De,_r(()=>be()))),ee(lt,st)};Ne(jt,lt=>{be().editingItemIndex===x(ne)&&lt(Kt)})}Re((lt,st,cr)=>{X=qr(Y,1,"item-row svelte-asgatj",null,X,lt),Le(ve,"aria-label",`Редактировать предмет ${x(J).name??""}`),Fe(ke,x(J).name),Fe(Ee,x(J).id),le=qr(ge,1,"item-type-badge svelte-asgatj",null,le,st),Fe(de,cr),Fe(Ge,`${x(J).description??""} || `)},[()=>({editing:be().editingItemIndex===x(ne)}),()=>({tool:x(J).type==="tool",key:x(J).type==="key",consumable:x(J).type==="consumable",quest:x(J).type==="quest",misc:x(J).type==="misc"}),()=>h(x(J).type)]),ee(ie,Y)}),ee(O,L)},z=O=>{var L=gv();ee(O,L)};Ne(B,O=>{be().data?.items?.length?O(N):O(z,!1)})}var Z=W(B,2);Z.__click=n,ee(R,U)};Ne(S,R=>{be().showItems&&R($)})}Re(()=>{Le(m,"title",be().showItems?"Скрыть предметы":"Показать предметы"),Le(m,"aria-expanded",be().showItems),Fe(k,` Предметы (${(be().data?.items?.length||0)??""})`),Fe(g,be().showItems?"▼":"▶")}),ee(r,v),rr()}Er(["click","change"]);Er(["click"]);class wv{#r=Ft(Br({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return x(this.#r)}set player(e){Dt(this.#r,e,!0)}#t=Ft(null);get storyData(){return x(this.#t)}set storyData(e){Dt(this.#t,e,!0)}#e=Ft("0");get currentDialogueId(){return x(this.#e)}set currentDialogueId(e){Dt(this.#e,e,!0)}#n=Ft(!0);get isLoading(){return x(this.#n)}set isLoading(e){Dt(this.#n,e,!0)}#i=Ft("");get error(){return x(this.#i)}set error(e){Dt(this.#i,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){return e.visibleIf&&e.visibleIf.hasItem?this.hasItem(e.visibleIf.hasItem):!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Ut=new wv;var es={exports:{}},bv=es.exports,bl;function kv(){return bl||(bl=1,(function(r,e){(function(n,s){r.exports=s()})(bv,()=>(()=>{var t=[,((c,h,v)=>{v.r(h),v.d(h,{default:()=>_});var m=(()=>{var k=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(E={}){var g=E,S,$;g.ready=new Promise((i,a)=>{S=i,$=a});function R(){function i(A){const j=f;u=a=0,f=new Map,j.forEach(M=>{try{M(A)}catch(T){console.error(T)}}),this.pb(),y&&y.Tb()}let a=0,u=0,f=new Map,y=null,b=null;this.requestAnimationFrame=function(A){a||(a=requestAnimationFrame(i.bind(this)));const j=++u;return f.set(j,A),j},this.cancelAnimationFrame=function(A){f.delete(A),a&&f.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(A){b&&(document.body.remove(b),b=null),A||(b=document.createElement("div"),b.style.backgroundColor="black",b.style.position="fixed",b.style.right=0,b.style.top=0,b.style.color="white",b.style.padding="4px",b.innerHTML="RIVE FPS",A=function(j){b.innerHTML="RIVE FPS "+j.toFixed(1)},document.body.appendChild(b)),y=new function(){let j=0,M=0;this.Tb=function(){var T=performance.now();M?(++j,T-=M,1e3<T&&(A(1e3*j/T),j=M=0)):(M=T,j=0)}}},this.Ob=function(){b&&(document.body.remove(b),b=null),y=null},this.pb=function(){}}function U(i){console.assert(!0);const a=new Map;let u=-1/0;this.push=function(f){return f=f+((1<<i)-1)>>i,a.has(f)&&clearTimeout(a.get(f)),a.set(f,setTimeout(function(){a.delete(f),a.length==0?u=-1/0:f==u&&(u=Math.max(...a.keys()),console.assert(u<f))},1e3)),u=Math.max(f,u),u<<i}}const B=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){B&&B();let i=g.decodeAudio;g.decodeAudio=function(y,b){y=i(y),b(y)};let a=g.decodeFont;g.decodeFont=function(y,b){y=a(y),b(y)};const u=g.FileAssetLoader;g.ptrToAsset=y=>{let b=g.ptrToFileAsset(y);return b.isImage?g.ptrToImageAsset(y):b.isFont?g.ptrToFontAsset(y):b.isAudio?g.ptrToAudioAsset(y):b},g.CustomFileAssetLoader=u.extend("CustomFileAssetLoader",{__construct:function({loadContents:y}){this.__parent.__construct.call(this),this.Gb=y},loadContents:function(y,b){return y=g.ptrToAsset(y),this.Gb(y,b)}}),g.CDNFileAssetLoader=u.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(y){let b=g.ptrToAsset(y);return y=b.cdnUuid,y===""?!1:((function(A,j){var M=new XMLHttpRequest;M.responseType="arraybuffer",M.onreadystatechange=function(){M.readyState==4&&M.status==200&&j(M)},M.open("GET",A,!0),M.send(null)})(b.cdnBaseUrl+"/"+y,A=>{b.decode(new Uint8Array(A.response))}),!0)}}),g.FallbackFileAssetLoader=u.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(y){this.lb.push(y)},loadContents:function(y,b){for(let A of this.lb)if(A.loadContents(y,b))return!0;return!1}});let f=g.computeAlignment;g.computeAlignment=function(y,b,A,j,M=1){return f.call(this,y,b,A,j,M)}};const N="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function i(){if(!a){let Te=function(xe,te,tt){if(te=H.createShader(te),H.shaderSource(te,tt),H.compileShader(te),tt=H.getShaderInfoLog(te),0<(tt||"").length)throw tt;H.attachShader(xe,te)};var I=document.createElement("canvas"),G={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let H;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(H=I.getContext("webgl",G),u=1,!H)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(H=I.getContext("webgl2",G))u=2;else if(H=I.getContext("webgl",G))u=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(H=new Proxy(H,{get(xe,te){if(xe.isContextLost()){if(M||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",te),M=!0),typeof xe[te]=="function")return function(){}}else return typeof xe[te]=="function"?function(...tt){return xe[te].apply(xe,tt)}:xe[te]},set(xe,te,tt){if(xe.isContextLost())M||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+te),M=!0);else return xe[te]=tt,!0}}),f=Math.min(H.getParameter(H.MAX_RENDERBUFFER_SIZE),H.getParameter(H.MAX_TEXTURE_SIZE)),I=H.createProgram(),Te(I,H.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Te(I,H.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),H.bindAttribLocation(I,0,"vertex"),H.bindAttribLocation(I,1,"uv"),H.linkProgram(I),G=H.getProgramInfoLog(I),0<(G||"").trim().length)throw G;y=H.getUniformLocation(I,"mat"),b=H.getUniformLocation(I,"translate"),H.useProgram(I),H.bindBuffer(H.ARRAY_BUFFER,H.createBuffer()),H.enableVertexAttribArray(0),H.enableVertexAttribArray(1),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,H.createBuffer()),H.uniform1i(H.getUniformLocation(I,"image"),0),H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=H}return!0}let a=null,u=0,f=0,y=null,b=null,A=0,j=0,M=!1;i(),this.hc=function(){return i(),f},this.Mb=function(I){a.deleteTexture&&a.deleteTexture(I)},this.Lb=function(I){if(!i())return null;const G=a.createTexture();return G?(a.bindTexture(a.TEXTURE_2D,G),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,I),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),u==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),G):null};const T=new U(8),K=new U(8),Q=new U(10),se=new U(10);this.Qb=function(I,G,H,Te,xe){if(i()){var te=T.push(I),tt=K.push(G);if(a.canvas){(a.canvas.width!=te||a.canvas.height!=tt)&&(a.canvas.width=te,a.canvas.height=tt),a.viewport(0,tt-G,I,G),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),H.sort((Be,vr)=>vr.xb-Be.xb),te=Q.push(Te),A!=te&&(a.bufferData(a.ARRAY_BUFFER,8*te,a.DYNAMIC_DRAW),A=te),te=0;for(var St of H)a.bufferSubData(a.ARRAY_BUFFER,te,St.Ua),te+=4*St.Ua.length;console.assert(te==4*Te);for(var fr of H)a.bufferSubData(a.ARRAY_BUFFER,te,fr.Db),te+=4*fr.Db.length;console.assert(te==8*Te),te=se.push(xe),j!=te&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*te,a.DYNAMIC_DRAW),j=te),St=0;for(var Qr of H)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,St,Qr.indices),St+=2*Qr.indices.length;console.assert(St==2*xe),Qr=0,fr=!0,te=St=0;for(const Be of H){Be.image.Ka!=Qr&&(a.bindTexture(a.TEXTURE_2D,Be.image.Ja||null),Qr=Be.image.Ka),Be.mc?(a.scissor(Be.Za,tt-Be.$a-Be.kb,Be.Ac,Be.kb),fr=!0):fr&&(a.scissor(0,tt-G,I,G),fr=!1),H=2/I;const vr=-2/G;a.uniform4f(y,Be.ha[0]*H*Be.Ba,Be.ha[1]*vr*Be.Ca,Be.ha[2]*H*Be.Ba,Be.ha[3]*vr*Be.Ca),a.uniform2f(b,Be.ha[4]*H*Be.Ba+H*(Be.Za-Be.ic*Be.Ba)-1,Be.ha[5]*vr*Be.Ca+vr*(Be.$a-Be.jc*Be.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,te),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,te+4*Te),a.drawElements(a.TRIANGLES,Be.indices.length,a.UNSIGNED_SHORT,St),te+=4*Be.Ua.length,St+=2*Be.indices.length}console.assert(te==4*Te),console.assert(St==2*xe)}}},this.canvas=function(){return i()&&a.canvas}},Z=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(q){switch(q){case T.srcOver:return"source-over";case T.screen:return"screen";case T.overlay:return"overlay";case T.darken:return"darken";case T.lighten:return"lighten";case T.colorDodge:return"color-dodge";case T.colorBurn:return"color-burn";case T.hardLight:return"hard-light";case T.softLight:return"soft-light";case T.difference:return"difference";case T.exclusion:return"exclusion";case T.multiply:return"multiply";case T.hue:return"hue";case T.saturation:return"saturation";case T.color:return"color";case T.luminosity:return"luminosity"}}function a(q){return"rgba("+((16711680&q)>>>16)+","+((65280&q)>>>8)+","+((255&q)>>>0)+","+((4278190080&q)>>>24)/255+")"}function u(){0<tt.length&&(z.Qb(te.drawWidth(),te.drawHeight(),tt,St,fr),tt=[],fr=St=0,te.reset(512,512));for(const q of xe){for(const re of q.H)re();q.H=[]}xe.clear()}Z&&Z();var f=g.RenderPaintStyle;const y=g.RenderPath,b=g.RenderPaint,A=g.Renderer,j=g.StrokeCap,M=g.StrokeJoin,T=g.BlendMode,K=f.fill,Q=f.stroke,se=g.FillRule.evenOdd;let I=1;var G=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:q,xa:re}={}){this.__parent.__construct.call(this),this.Ka=I,I=I+1&2147483647||1,this.la=q,this.xa=re},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(q){var re=this;re.xa&&re.xa(re);var $e=new Image;re.Xa=URL.createObjectURL(new Blob([q],{type:"image/png"})),$e.onload=function(){re.Fb=$e,re.Ja=z.Lb($e),re.size($e.width,$e.height),re.la&&re.la(re)},$e.src=re.Xa}}),H=y.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(q,re,$e,We,Pe,Ue,Je){var Xe=this.T,ar=Xe.addPath;q=q.T;const yt=new DOMMatrix;yt.a=re,yt.b=$e,yt.c=We,yt.d=Pe,yt.e=Ue,yt.f=Je,ar.call(Xe,q,yt)},fillRule:function(q){this.Wa=q},moveTo:function(q,re){this.T.moveTo(q,re)},lineTo:function(q,re){this.T.lineTo(q,re)},cubicTo:function(q,re,$e,We,Pe,Ue){this.T.bezierCurveTo(q,re,$e,We,Pe,Ue)},close:function(){this.T.closePath()}}),Te=b.extend("CanvasRenderPaint",{color:function(q){this.Ya=a(q)},thickness:function(q){this.Ib=q},join:function(q){switch(q){case M.miter:this.Ia="miter";break;case M.round:this.Ia="round";break;case M.bevel:this.Ia="bevel"}},cap:function(q){switch(q){case j.butt:this.Ha="butt";break;case j.round:this.Ha="round";break;case j.square:this.Ha="square"}},style:function(q){this.Hb=q},blendMode:function(q){this.Eb=i(q)},clearGradient:function(){this.ja=null},linearGradient:function(q,re,$e,We){this.ja={zb:q,Ab:re,cb:$e,eb:We,Ra:[]}},radialGradient:function(q,re,$e,We){this.ja={zb:q,Ab:re,cb:$e,eb:We,Ra:[],ec:!0}},addStop:function(q,re){this.ja.Ra.push({color:q,stop:re})},completeGradient:function(){},draw:function(q,re,$e){let We=this.Hb;var Pe=this.Ya,Ue=this.ja;if(q.globalCompositeOperation=this.Eb,Ue!=null){Pe=Ue.zb;var Je=Ue.Ab;const ar=Ue.cb;var Xe=Ue.eb;const yt=Ue.Ra;Ue.ec?(Ue=ar-Pe,Xe-=Je,Pe=q.createRadialGradient(Pe,Je,0,Pe,Je,Math.sqrt(Ue*Ue+Xe*Xe))):Pe=q.createLinearGradient(Pe,Je,ar,Xe);for(let Jt=0,wt=yt.length;Jt<wt;Jt++)Je=yt[Jt],Pe.addColorStop(Je.stop,a(Je.color));this.Ya=Pe,this.ja=null}switch(We){case Q:q.strokeStyle=Pe,q.lineWidth=this.Ib,q.lineCap=this.Ha,q.lineJoin=this.Ia,q.stroke(re);break;case K:q.fillStyle=Pe,q.fill(re,$e)}}});const xe=new Set;let te=null,tt=[],St=0,fr=0;var Qr=g.CanvasRenderer=A.extend("Renderer",{__construct:function(q){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=q.getContext("2d"),this.Va=q,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const q=this.S.length-6;if(6>q)throw"restore() called without matching save().";this.S.splice(q),this.H.push(this.C.restore.bind(this.C))},transform:function(q,re,$e,We,Pe,Ue){const Je=this.S,Xe=Je.length-6;Je.splice(Xe,6,Je[Xe]*q+Je[Xe+2]*re,Je[Xe+1]*q+Je[Xe+3]*re,Je[Xe]*$e+Je[Xe+2]*We,Je[Xe+1]*$e+Je[Xe+3]*We,Je[Xe]*Pe+Je[Xe+2]*Ue+Je[Xe+4],Je[Xe+1]*Pe+Je[Xe+3]*Ue+Je[Xe+5]),this.H.push(this.C.transform.bind(this.C,q,re,$e,We,Pe,Ue))},rotate:function(q){const re=Math.sin(q);q=Math.cos(q),this.transform(q,re,-re,q,0,0)},_drawPath:function(q,re){this.H.push(re.draw.bind(re,this.C,q.T,q.Wa===se?"evenodd":"nonzero"))},_drawRiveImage:function(q,re,$e,We){var Pe=q.Fb;if(Pe){var Ue=this.C,Je=i($e);this.H.push(function(){Ue.globalCompositeOperation=Je,Ue.globalAlpha=We,Ue.drawImage(Pe,0,0),Ue.globalAlpha=1})}},_getMatrix:function(q){const re=this.S,$e=re.length-6;for(let We=0;6>We;++We)q[We]=re[$e+We]},_drawImageMesh:function(q,re,$e,We,Pe,Ue,Je,Xe,ar,yt,Jt){re=this.C.canvas.width;var wt=this.C.canvas.height;const To=yt-Xe,Po=Jt-ar;Xe=Math.max(Xe,0),ar=Math.max(ar,0),yt=Math.min(yt,re),Jt=Math.min(Jt,wt);const oi=yt-Xe,li=Jt-ar;if(console.assert(oi<=Math.min(To,re)),console.assert(li<=Math.min(Po,wt)),!(0>=oi||0>=li)){yt=oi<To||li<Po,re=Jt=1;var Zr=Math.ceil(oi*Jt),en=Math.ceil(li*re);wt=z.hc(),Zr>wt&&(Jt*=wt/Zr,Zr=wt),en>wt&&(re*=wt/en,en=wt),te||(te=new g.DynamicRectanizer(wt),te.reset(512,512)),wt=te.addRect(Zr,en),0>wt&&(u(),xe.add(this),wt=te.addRect(Zr,en),console.assert(0<=wt));var Ro=wt&65535,jo=wt>>16;tt.push({ha:this.S.slice(this.S.length-6),image:q,Za:Ro,$a:jo,ic:Xe,jc:ar,Ac:Zr,kb:en,Ba:Jt,Ca:re,Ua:new Float32Array(Pe),Db:new Float32Array(Ue),indices:new Uint16Array(Je),mc:yt,xb:q.Ka<<1|(yt?1:0)}),St+=Pe.length,fr+=Je.length;var En=this.C,Qu=i($e);this.H.push(function(){En.save(),En.resetTransform(),En.globalCompositeOperation=Qu,En.globalAlpha=We;const Oo=z.canvas();Oo&&En.drawImage(Oo,Ro,jo,Zr,en,Xe,ar,oi,li),En.restore()})}},_clipPath:function(q){this.H.push(this.C.clip.bind(this.C,q.T,q.Wa===se?"evenodd":"nonzero"))},clear:function(){xe.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(q,re){this.transform(1,0,0,1,q,re)}});g.makeRenderer=function(q){const re=new Qr(q),$e=re.C;return new Proxy(re,{get(We,Pe){if(typeof We[Pe]=="function")return function(...Ue){return We[Pe].apply(We,Ue)};if(typeof $e[Pe]=="function"){if(-1<N.indexOf(Pe))throw Error("RiveException: Method call to '"+Pe+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ue){re.H.push($e[Pe].bind($e,...Ue))}}return We[Pe]},set(We,Pe,Ue){if(Pe in $e)return re.H.push(()=>{$e[Pe]=Ue}),!0}})},g.decodeImage=function(q,re){new G({la:re}).decode(q)},g.renderFactory={makeRenderPaint:function(){return new Te},makeRenderPath:function(){return new H},makeRenderImage:function(){let q=vr;return new G({xa:()=>{q.total++},la:()=>{if(q.loaded++,q.loaded===q.total){const re=q.ready;re&&(re(),q.ready=null)}}})}};let Be=g.load,vr=null;g.load=function(q,re,$e=!0){const We=new g.FallbackFileAssetLoader;return re!==void 0&&We.addLoader(re),$e&&(re=new g.CDNFileAssetLoader,We.addLoader(re)),new Promise(function(Pe){let Ue=null;vr={total:0,loaded:0,ready:function(){Pe(Ue)}},Ue=Be(q,We),vr.total==0&&Pe(Ue)})};let Xu=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(q,re,$e,We,Pe=1){Xu.call(this,q,re,$e,We,Pe)},f=new R,g.requestAnimationFrame=f.requestAnimationFrame.bind(f),g.cancelAnimationFrame=f.cancelAnimationFrame.bind(f),g.enableFPSCounter=f.Rb.bind(f),g.disableFPSCounter=f.Ob,f.pb=u,g.resolveAnimationFrame=u,g.cleanup=function(){te&&te.delete()}};var O=Object.assign({},g),L="./this.program",ie=typeof window=="object",J=typeof importScripts=="function",ne="",Y,X;(ie||J)&&(J?ne=self.location.href:typeof document<"u"&&document.currentScript&&(ne=document.currentScript.src),k&&(ne=k),ne.indexOf("blob:")!==0?ne=ne.substr(0,ne.replace(/[?#].*/,"").lastIndexOf("/")+1):ne="",J&&(X=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),Y=(i,a,u)=>{var f=new XMLHttpRequest;f.open("GET",i,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?a(f.response):u()},f.onerror=u,f.send(null)});var ve=g.print||console.log.bind(console),Ae=g.printErr||console.error.bind(console);Object.assign(g,O),O=null,g.thisProgram&&(L=g.thisProgram);var ce;g.wasmBinary&&(ce=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&Kt("no native wasm support detected");var Ke,ye,we=!1,Ie,pe,ke,Ye,me,Ee,ge,le;function de(){var i=Ke.buffer;g.HEAP8=Ie=new Int8Array(i),g.HEAP16=ke=new Int16Array(i),g.HEAP32=me=new Int32Array(i),g.HEAPU8=pe=new Uint8Array(i),g.HEAPU16=Ye=new Uint16Array(i),g.HEAPU32=Ee=new Uint32Array(i),g.HEAPF32=ge=new Float32Array(i),g.HEAPF64=le=new Float64Array(i)}var Oe,Ge=[],It=[],ht=[];function Bt(){var i=g.preRun.shift();Ge.unshift(i)}var gt=0,jt=null;function Kt(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",Ae(i),we=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),$(i),i}function lt(i){return i.startsWith("data:application/octet-stream;base64,")}var st;if(st="canvas_advanced.wasm",!lt(st)){var cr=st;st=g.locateFile?g.locateFile(cr,ne):ne+cr}function _t(i){if(i==st&&ce)return new Uint8Array(ce);if(X)return X(i);throw"both async and sync fetching of the wasm failed"}function Lr(i){if(!ce&&(ie||J)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>_t(i));if(Y)return new Promise((a,u)=>{Y(i,f=>a(new Uint8Array(f)),u)})}return Promise.resolve().then(()=>_t(i))}function it(i,a,u){return Lr(i).then(f=>WebAssembly.instantiate(f,a)).then(f=>f).then(u,f=>{Ae("failed to asynchronously prepare wasm: "+f),Kt(f)})}function Ot(i,a){var u=st;return ce||typeof WebAssembly.instantiateStreaming!="function"||lt(u)||u.startsWith("file://")||typeof fetch!="function"?it(u,i,a):fetch(u,{credentials:"same-origin"}).then(f=>WebAssembly.instantiateStreaming(f,i).then(a,function(y){return Ae("wasm streaming compile failed: "+y),Ae("falling back to ArrayBuffer instantiation"),it(u,i,a)}))}var xt,p,o={460492:(i,a,u,f,y)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=u,window.h.ga={},window.h.ga.stopped=f,window.h.ga.yb=y;let b=window.h;b.D=[],b.yc=function(A){for(var j=0;j<b.D.length;++j)if(b.D[j]==null)return b.D[j]=A,j;return b.D.push(A),b.D.length-1},b.Cb=function(A){for(b.D[A]=null;0<b.D.length&&b.D[b.D.length-1]==null;)b.D.pop()},b.Sc=function(A){for(var j=0;j<b.D.length;++j)if(b.D[j]==A)return b.Cb(j)},b.ra=function(A){return b.D[A]},b.Ta=["touchend","click"],b.unlock=function(){for(var A=0;A<b.D.length;++A){var j=b.D[A];j!=null&&j.J!=null&&j.state===b.ga.yb&&j.J.resume().then(()=>{Eo(j.qb)},M=>{console.error("Failed to resume audiocontext",M)})}b.Ta.map(function(M){document.removeEventListener(M,b.unlock,!0)})},b.Ta.map(function(A){document.addEventListener(A,b.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,u,f,y,b)=>{if(typeof window.h>"u")return-1;var A={},j={};return i==window.h.I.ya&&u!=0&&(j.sampleRate=u),A.J=new(window.AudioContext||window.webkitAudioContext)(j),A.J.suspend(),A.state=window.h.ga.stopped,u=0,i!=window.h.I.ya&&(u=a),A.Z=A.J.createScriptProcessor(f,u,a),A.Z.onaudioprocess=function(M){if((A.sa==null||A.sa.length==0)&&(A.sa=new Float32Array(ge.buffer,y,f*a)),i==window.h.I.capture||i==window.h.I.La){for(var T=0;T<a;T+=1)for(var K=M.inputBuffer.getChannelData(T),Q=A.sa,se=0;se<f;se+=1)Q[se*a+T]=K[se];So(b,f,y)}if(i==window.h.I.ya||i==window.h.I.La)for(Ao(b,f,y),T=0;T<M.outputBuffer.numberOfChannels;++T)for(K=M.outputBuffer.getChannelData(T),Q=A.sa,se=0;se<f;se+=1)K[se]=Q[se*a+T];else for(T=0;T<M.outputBuffer.numberOfChannels;++T)M.outputBuffer.getChannelData(T).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(M){A.Da=A.J.createMediaStreamSource(M),A.Da.connect(A.Z),A.Z.connect(A.J.destination)}).catch(function(M){console.log("Failed to get user media: "+M)}),i==window.h.I.ya&&A.Z.connect(A.J.destination),A.qb=b,window.h.yc(A)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(g)},w=(i,a)=>{for(var u=0,f=i.length-1;0<=f;f--){var y=i[f];y==="."?i.splice(f,1):y===".."?(i.splice(f,1),u++):u&&(i.splice(f,1),u--)}if(a)for(;u;u--)i.unshift("..");return i},C=i=>{var a=i.charAt(0)==="/",u=i.substr(-1)==="/";return(i=w(i.split("/").filter(f=>!!f),!a).join("/"))||a||(i="."),i&&u&&(i+="/"),(a?"/":"")+i},D=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},V=i=>{if(i==="/")return"/";i=C(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},he=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Kt("initRandomDevice")},_e=i=>(_e=he())(i);function oe(){for(var i="",a=!1,u=arguments.length-1;-1<=u&&!a;u--){if(a=0<=u?arguments[u]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=w(i.split("/").filter(f=>!!f),!a).join("/"),(a?"/":"")+i||"."}var je=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,qe=(i,a,u)=>{var f=a+u;for(u=a;i[u]&&!(u>=f);)++u;if(16<u-a&&i.buffer&&je)return je.decode(i.subarray(a,u));for(f="";a<u;){var y=i[a++];if(y&128){var b=i[a++]&63;if((y&224)==192)f+=String.fromCharCode((y&31)<<6|b);else{var A=i[a++]&63;y=(y&240)==224?(y&15)<<12|b<<6|A:(y&7)<<18|b<<12|A<<6|i[a++]&63,65536>y?f+=String.fromCharCode(y):(y-=65536,f+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else f+=String.fromCharCode(y)}return f},ut=[],Ze=i=>{for(var a=0,u=0;u<i.length;++u){var f=i.charCodeAt(u);127>=f?a++:2047>=f?a+=2:55296<=f&&57343>=f?(a+=4,++u):a+=3}return a},Wt=(i,a,u,f)=>{if(!(0<f))return 0;var y=u;f=u+f-1;for(var b=0;b<i.length;++b){var A=i.charCodeAt(b);if(55296<=A&&57343>=A){var j=i.charCodeAt(++b);A=65536+((A&1023)<<10)|j&1023}if(127>=A){if(u>=f)break;a[u++]=A}else{if(2047>=A){if(u+1>=f)break;a[u++]=192|A>>6}else{if(65535>=A){if(u+2>=f)break;a[u++]=224|A>>12}else{if(u+3>=f)break;a[u++]=240|A>>18,a[u++]=128|A>>12&63}a[u++]=128|A>>6&63}a[u++]=128|A&63}}return a[u]=0,u-y};function $t(i,a){var u=Array(Ze(i)+1);return i=Wt(i,u,0,u.length),a&&(u.length=i),u}var Et=[];function mt(i,a){Et[i]={input:[],F:[],V:a},Ss(i,De)}var De={open:function(i){var a=Et[i.node.za];if(!a)throw new ae(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,u,f){if(!i.s||!i.s.V.jb)throw new ae(60);for(var y=0,b=0;b<f;b++){try{var A=i.s.V.jb(i.s)}catch{throw new ae(29)}if(A===void 0&&y===0)throw new ae(6);if(A==null)break;y++,a[u+b]=A}return y&&(i.node.timestamp=Date.now()),y},write:function(i,a,u,f){if(!i.s||!i.s.V.Oa)throw new ae(60);try{for(var y=0;y<f;y++)i.s.V.Oa(i.s,a[u+y])}catch{throw new ae(29)}return f&&(i.node.timestamp=Date.now()),y}},ft={jb:function(){e:{if(!ut.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}ut=$t(i,!0)}i=ut.shift()}return i},Oa:function(i,a){a===null||a===10?(ve(qe(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(ve(qe(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},ot={Oa:function(i,a){a===null||a===10?(Ae(qe(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Ae(qe(i.F,0)),i.F=[])}};function Ct(i,a){var u=i.j?i.j.length:0;u>=a||(a=Math.max(a,u*(1048576>u?2:1.125)>>>0),u!=0&&(a=Math.max(a,256)),u=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(u.subarray(0,i.v),0))}var fe={O:null,U(){return fe.createNode(null,"/",16895,0)},createNode(i,a,u,f){if((u&61440)===24576||(u&61440)===4096)throw new ae(63);return fe.O||(fe.O={dir:{node:{Y:fe.l.Y,P:fe.l.P,ka:fe.l.ka,va:fe.l.va,vb:fe.l.vb,Bb:fe.l.Bb,wb:fe.l.wb,tb:fe.l.tb,Ea:fe.l.Ea},stream:{ba:fe.m.ba}},file:{node:{Y:fe.l.Y,P:fe.l.P},stream:{ba:fe.m.ba,read:fe.m.read,write:fe.m.write,pa:fe.m.pa,mb:fe.m.mb,ob:fe.m.ob}},link:{node:{Y:fe.l.Y,P:fe.l.P,ma:fe.l.ma},stream:{}},ab:{node:{Y:fe.l.Y,P:fe.l.P},stream:Pu}}),u=Ha(i,a,u,f),(u.mode&61440)===16384?(u.l=fe.O.dir.node,u.m=fe.O.dir.stream,u.j={}):(u.mode&61440)===32768?(u.l=fe.O.file.node,u.m=fe.O.file.stream,u.v=0,u.j=null):(u.mode&61440)===40960?(u.l=fe.O.link.node,u.m=fe.O.link.stream):(u.mode&61440)===8192&&(u.l=fe.O.ab.node,u.m=fe.O.ab.stream),u.timestamp=Date.now(),i&&(i.j[a]=u,i.timestamp=u.timestamp),u},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var u=i.j;i.j=new Uint8Array(a),u&&i.j.set(u.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw Es[44]},va(i,a,u,f){return fe.createNode(i,a,u,f)},vb(i,a,u){if((i.mode&61440)===16384){try{var f=Si(a,u)}catch{}if(f)for(var y in f.j)throw new ae(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=u,a.j[u]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var u=Si(i,a),f;for(f in u.j)throw new ae(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],u;for(u in i.j)i.j.hasOwnProperty(u)&&a.push(u);return a},Ea(i,a,u){return i=fe.createNode(i,a,41471,0),i.link=u,i},ma(i){if((i.mode&61440)!==40960)throw new ae(28);return i.link}},m:{read(i,a,u,f,y){var b=i.node.j;if(y>=i.node.v)return 0;if(i=Math.min(i.node.v-y,f),8<i&&b.subarray)a.set(b.subarray(y,y+i),u);else for(f=0;f<i;f++)a[u+f]=b[y+f];return i},write(i,a,u,f,y,b){if(a.buffer===Ie.buffer&&(b=!1),!f)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(b)return i.j=a.subarray(u,u+f),i.v=f;if(i.v===0&&y===0)return i.j=a.slice(u,u+f),i.v=f;if(y+f<=i.v)return i.j.set(a.subarray(u,u+f),y),f}if(Ct(i,y+f),i.j.subarray&&a.subarray)i.j.set(a.subarray(u,u+f),y);else for(b=0;b<f;b++)i.j[y+b]=a[u+b];return i.v=Math.max(i.v,y+f),f},ba(i,a,u){if(u===1?a+=i.position:u===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new ae(28);return a},pa(i,a,u){Ct(i.node,a+u),i.node.v=Math.max(i.node.v,a+u)},mb(i,a,u,f,y){if((i.node.mode&61440)!==32768)throw new ae(43);if(i=i.node.j,y&2||i.buffer!==Ie.buffer){if((0<u||u+a<i.length)&&(i.subarray?i=i.subarray(u,u+a):i=Array.prototype.slice.call(i,u,u+a)),u=!0,Kt(),a=void 0,!a)throw new ae(48);Ie.set(i,a)}else u=!1,a=i.byteOffset;return{o:a,M:u}},ob(i,a,u,f){return fe.m.write(i,a,0,f,u,!1),0}}};function He(i,a){var u=0;return i&&(u|=365),a&&(u|=146),u}var dr=null,Ba={},Ei=[],Cu=1,Qn=null,Wa=!0,ae=null,Es={},Yr=(i,a={})=>{if(i=oe(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new ae(32);i=i.split("/").filter(A=>!!A);for(var u=dr,f="/",y=0;y<i.length;y++){var b=y===i.length-1;if(b&&a.parent)break;if(u=Si(u,i[y]),f=C(f+"/"+i[y]),u.wa&&(!b||b&&a.hb)&&(u=u.wa.root),!b||a.gb){for(b=0;(u.mode&61440)===40960;)if(u=Ru(f),f=oe(D(f),u),u=Yr(f,{Qa:a.Qa+1}).node,40<b++)throw new ae(32)}}return{path:f,node:u}},Va=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},qa=(i,a)=>{for(var u=0,f=0;f<a.length;f++)u=(u<<5)-u+a.charCodeAt(f)|0;return(i+u>>>0)%Qn.length},Si=(i,a)=>{var u;if(u=(u=Ai(i,"x"))?u:i.l.ka?0:2)throw new ae(u,i);for(u=Qn[qa(i.id,a)];u;u=u.lc){var f=u.name;if(u.parent.id===i.id&&f===a)return u}return i.l.ka(i,a)},Ha=(i,a,u,f)=>(i=new yo(i,a,u,f),a=qa(i.parent.id,i.name),i.lc=Qn[a],Qn[a]=i),za=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},Ai=(i,a)=>{if(Wa)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Ga=(i,a)=>{try{return Si(i,a),20}catch{}return Ai(i,"wx")},Tu=()=>{for(var i=0;4096>=i;i++)if(!Ei[i])return i;throw new ae(33)},Dr=i=>{if(i=Ei[i],!i)throw new ae(8);return i},Ka=(i,a=-1)=>(ei||(ei=function(){this.h={}},ei.prototype={},Object.defineProperties(ei.prototype,{object:{get(){return this.node},set(u){this.node=u}},flags:{get(){return this.h.flags},set(u){this.h.flags=u}},position:{get(){return this.h.position},set(u){this.h.position=u}}})),i=Object.assign(new ei,i),a==-1&&(a=Tu()),i.X=a,Ei[a]=i),Pu={open:i=>{i.m=Ba[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new ae(70)}},Ss=(i,a)=>{Ba[i]={m:a}},Ya=(i,a)=>{var u=a==="/",f=!a;if(u&&dr)throw new ae(10);if(!u&&!f){var y=Yr(a,{hb:!1});if(a=y.path,y=y.node,y.wa)throw new ae(10);if((y.mode&61440)!==16384)throw new ae(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,u?dr=i:y&&(y.wa=a,y.U&&y.U.kc.push(a))},nr=(i,a,u)=>{var f=Yr(i,{parent:!0}).node;if(i=V(i),!i||i==="."||i==="..")throw new ae(28);var y=Ga(f,i);if(y)throw new ae(y);if(!f.l.va)throw new ae(63);return f.l.va(f,i,a,u)},Ii=(i,a,u)=>{typeof u>"u"&&(u=a,a=438),nr(i,a|8192,u)},As=(i,a)=>{if(!oe(i))throw new ae(44);var u=Yr(a,{parent:!0}).node;if(!u)throw new ae(44);a=V(a);var f=Ga(u,a);if(f)throw new ae(f);if(!u.l.Ea)throw new ae(63);u.l.Ea(u,a,i)},Ru=i=>{if(i=Yr(i).node,!i)throw new ae(44);if(!i.l.ma)throw new ae(28);return oe(Va(i.parent),i.l.ma(i))},Ci=(i,a,u)=>{if(i==="")throw new ae(44);if(typeof a=="string"){var f={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof f>"u")throw Error(`Unknown file open mode: ${a}`);a=f}if(u=a&64?(typeof u>"u"?438:u)&4095|32768:0,typeof i=="object")var y=i;else{i=C(i);try{y=Yr(i,{gb:!(a&131072)}).node}catch{}}if(f=!1,a&64)if(y){if(a&128)throw new ae(20)}else y=nr(i,u,0),f=!0;if(!y)throw new ae(44);if((y.mode&61440)===8192&&(a&=-513),a&65536&&(y.mode&61440)!==16384)throw new ae(54);if(!f&&(u=y?(y.mode&61440)===40960?32:(y.mode&61440)===16384&&(za(a)!=="r"||a&512)?31:Ai(y,za(a)):44))throw new ae(u);if(a&512&&!f){if(u=y,u=typeof u=="string"?Yr(u,{gb:!0}).node:u,!u.l.P)throw new ae(63);if((u.mode&61440)===16384)throw new ae(31);if((u.mode&61440)!==32768)throw new ae(28);if(f=Ai(u,"w"))throw new ae(f);u.l.P(u,{size:0,timestamp:Date.now()})}return a&=-131713,y=Ka({node:y,path:Va(y),flags:a,seekable:!0,position:0,m:y.m,zc:[],error:!1}),y.m.open&&y.m.open(y),!g.logReadFiles||a&1||(Ti||(Ti={}),i in Ti||(Ti[i]=1)),y},Ja=(i,a,u)=>{if(i.X===null)throw new ae(8);if(!i.seekable||!i.m.ba)throw new ae(70);if(u!=0&&u!=1&&u!=2)throw new ae(28);i.position=i.m.ba(i,a,u),i.zc=[]},Xa=()=>{ae||(ae=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(u){this.aa=u},this.pc(i),this.message="FS error"},ae.prototype=Error(),ae.prototype.constructor=ae,[44].forEach(i=>{Es[i]=new ae(i),Es[i].stack="<generic error, no stack>"}))},Qa,Zn=(i,a,u)=>{i=C("/dev/"+i);var f=He(!!a,!!u);Is||(Is=64);var y=Is++<<8|0;Ss(y,{open:b=>{b.seekable=!1},close:()=>{u&&u.buffer&&u.buffer.length&&u(10)},read:(b,A,j,M)=>{for(var T=0,K=0;K<M;K++){try{var Q=a()}catch{throw new ae(29)}if(Q===void 0&&T===0)throw new ae(6);if(Q==null)break;T++,A[j+K]=Q}return T&&(b.node.timestamp=Date.now()),T},write:(b,A,j,M)=>{for(var T=0;T<M;T++)try{u(A[j+T])}catch{throw new ae(29)}return M&&(b.node.timestamp=Date.now()),T}}),Ii(i,f,y)},Is,Jr={},ei,Ti,ti=void 0;function Sr(){return ti+=4,me[ti-4>>2]}function Za(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Pi(i,a){return i=Za(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function eo(){this.M=[void 0],this.ib=[]}var Yt=new eo,wn=void 0;function Ce(i){throw new wn(i)}var ir=i=>(i||Ce("Cannot use deleted val. handle = "+i),Yt.get(i).value),sr=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Yt.pa({ub:1,value:i})}};function to(i){var a=Error,u=Pi(i,function(f){this.name=i,this.message=f,f=Error(f).stack,f!==void 0&&(this.stack=this.toString()+`
`+f.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(a.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},u}var ro=void 0,no=void 0;function at(i){for(var a="";pe[i];)a+=no[pe[i++]];return a}var ri=[];function Cs(){for(;ri.length;){var i=ri.pop();i.g.fa=!1,i.delete()}}var ni=void 0,Ar={};function Ts(i,a){for(a===void 0&&Ce("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var Xr={};function io(i){i=Io(i);var a=at(i);return Tr(i),a}function ii(i,a){var u=Xr[i];return u===void 0&&Ce(a+" has unknown type "+io(i)),u}function Ri(){}var Ps=!1;function so(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function ao(i,a,u){return a===u?i:u.A===void 0?null:(i=ao(i,a,u.A),i===null?null:u.Pb(i))}var oo={};function ju(i,a){return a=Ts(i,a),Ar[a]}var lo=void 0;function ji(i){throw new lo(i)}function Oi(i,a){return a.u&&a.o||ji("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&ji("Both smartPtrType and smartPtr must be specified"),a.count={value:1},bn(Object.create(i,{g:{value:a}}))}function bn(i){return typeof FinalizationRegistry>"u"?(bn=a=>a,i):(Ps=new FinalizationRegistry(a=>{so(a.g)}),bn=a=>{var u=a.g;return u.G&&Ps.register(a,{g:u},a),a},Ri=a=>{Ps.unregister(a)},bn(i))}var xi={};function si(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function ai(i){return this.fromWireType(me[i>>2])}var kn={},Mi={};function Vt(i,a,u){function f(j){j=u(j),j.length!==i.length&&ji("Mismatched type converter count");for(var M=0;M<i.length;++M)hr(i[M],j[M])}i.forEach(function(j){Mi[j]=a});var y=Array(a.length),b=[],A=0;a.forEach((j,M)=>{Xr.hasOwnProperty(j)?y[M]=Xr[j]:(b.push(j),kn.hasOwnProperty(j)||(kn[j]=[]),kn[j].push(()=>{y[M]=Xr[j],++A,A===b.length&&f(y)}))}),b.length===0&&f(y)}function Li(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Ou(i,a,u={}){var f=a.name;if(i||Ce(`type "${f}" must have a positive integer typeid pointer`),Xr.hasOwnProperty(i)){if(u.$b)return;Ce(`Cannot register type '${f}' twice`)}Xr[i]=a,delete Mi[i],kn.hasOwnProperty(i)&&(a=kn[i],delete kn[i],a.forEach(y=>y()))}function hr(i,a,u={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Ou(i,a,u)}function Rs(i){Ce(i.g.u.i.name+" instance already deleted")}function $r(){}function js(i,a,u){if(i[a].B===void 0){var f=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||Ce(`Function '${u}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[f.ea]=f}}function Os(i,a,u){g.hasOwnProperty(i)?((u===void 0||g[i].B!==void 0&&g[i].B[u]!==void 0)&&Ce(`Cannot register public name '${i}' twice`),js(g,i,i),g.hasOwnProperty(u)&&Ce(`Cannot register multiple overloads of a function with the same number of arguments (${u})!`),g[i].B[u]=a):(g[i]=a,u!==void 0&&(g[i].Pc=u))}function xu(i,a,u,f,y,b,A,j){this.name=i,this.constructor=a,this.N=u,this.W=f,this.A=y,this.Ub=b,this.na=A,this.Pb=j,this.rb=[]}function Di(i,a,u){for(;a!==u;)a.na||Ce(`Expected null or instance of ${u.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function Mu(i,a){return a===null?(this.Na&&Ce(`null is not a valid ${this.name}`),0):(a.g||Ce(`Cannot pass "${Ms(a)}" as a ${this.name}`),a.g.o||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`),Di(a.g.o,a.g.u.i,this.i))}function Lu(i,a){if(a===null){if(this.Na&&Ce(`null is not a valid ${this.name}`),this.ua){var u=this.Pa();return i!==null&&i.push(this.W,u),u}return 0}if(a.g||Ce(`Cannot pass "${Ms(a)}" as a ${this.name}`),a.g.o||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&Ce(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),u=Di(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&Ce("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?u=a.g.G:Ce(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:u=a.g.G;break;case 2:if(a.g.L===this)u=a.g.G;else{var f=a.clone();u=this.oc(u,sr(function(){f.delete()})),i!==null&&i.push(this.W,u)}break;default:Ce("Unsupporting sharing policy")}return u}function Du(i,a){return a===null?(this.Na&&Ce(`null is not a valid ${this.name}`),0):(a.g||Ce(`Cannot pass "${Ms(a)}" as a ${this.name}`),a.g.o||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&Ce(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Di(a.g.o,a.g.u.i,this.i))}function Ir(i,a,u,f){this.name=i,this.i=a,this.Na=u,this.ta=f,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Lu:(this.toWireType=f?Mu:Du,this.K=null)}function uo(i,a,u){g.hasOwnProperty(i)||ji("Replacing nonexistant public symbol"),g[i].B!==void 0&&u!==void 0?g[i].B[u]=a:(g[i]=a,g[i].ea=u)}var $i=[],co=i=>{var a=$i[i];return a||(i>=$i.length&&($i.length=i+1),$i[i]=a=Oe.get(i)),a},$u=(i,a)=>{var u=[];return function(){if(u.length=0,Object.assign(u,arguments),i.includes("j")){var f=g["dynCall_"+i];f=u&&u.length?f.apply(null,[a].concat(u)):f.call(null,a)}else f=co(a).apply(null,u);return f}};function Tt(i,a){i=at(i);var u=i.includes("j")?$u(i,a):co(a);return typeof u!="function"&&Ce(`unknown function pointer with signature ${i}: ${a}`),u}var ho=void 0;function Cr(i,a){function u(b){y[b]||Xr[b]||(Mi[b]?Mi[b].forEach(u):(f.push(b),y[b]=!0))}var f=[],y={};throw a.forEach(u),new ho(`${i}: `+f.map(io).join([", "]))}function Fi(i,a,u,f,y){var b=a.length;2>b&&Ce("argTypes array size mismatch! Must at least get return value and 'this' types!");var A=a[1]!==null&&u!==null,j=!1;for(u=1;u<a.length;++u)if(a[u]!==null&&a[u].K===void 0){j=!0;break}var M=a[0].name!=="void",T=b-2,K=Array(T),Q=[],se=[];return function(){if(arguments.length!==T&&Ce(`function ${i} called with ${arguments.length} arguments, expected ${T} args!`),se.length=0,Q.length=A?2:1,Q[0]=y,A){var I=a[1].toWireType(se,this);Q[1]=I}for(var G=0;G<T;++G)K[G]=a[G+2].toWireType(se,arguments[G]),Q.push(K[G]);if(G=f.apply(null,Q),j)si(se);else for(var H=A?1:2;H<a.length;H++){var Te=H===1?I:K[H-2];a[H].K!==null&&a[H].K(Te)}return I=M?a[0].fromWireType(G):void 0,I}}function Ui(i,a){for(var u=[],f=0;f<i;f++)u.push(Ee[a+4*f>>2]);return u}function fo(i,a,u){return i instanceof Object||Ce(`${u} with invalid "this": ${i}`),i instanceof a.i.constructor||Ce(`${u} incompatible with "this" of type ${i.constructor.name}`),i.g.o||Ce(`cannot call emscripten binding method ${u} on deleted object`),Di(i.g.o,i.g.u.i,a.i)}function xs(i){i>=Yt.h&&--Yt.get(i).ub===0&&Yt.Zb(i)}function Fu(i,a,u){switch(a){case 0:return function(f){return this.fromWireType((u?Ie:pe)[f])};case 1:return function(f){return this.fromWireType((u?ke:Ye)[f>>1])};case 2:return function(f){return this.fromWireType((u?me:Ee)[f>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Ms(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Uu(i,a){switch(a){case 2:return function(u){return this.fromWireType(ge[u>>2])};case 3:return function(u){return this.fromWireType(le[u>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Nu(i,a,u){switch(a){case 0:return u?function(f){return Ie[f]}:function(f){return pe[f]};case 1:return u?function(f){return ke[f>>1]}:function(f){return Ye[f>>1]};case 2:return u?function(f){return me[f>>2]}:function(f){return Ee[f>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var vo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Bu=(i,a)=>{for(var u=i>>1,f=u+a/2;!(u>=f)&&Ye[u];)++u;if(u<<=1,32<u-i&&vo)return vo.decode(pe.subarray(i,u));for(u="",f=0;!(f>=a/2);++f){var y=ke[i+2*f>>1];if(y==0)break;u+=String.fromCharCode(y)}return u},Wu=(i,a,u)=>{if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var f=a;u=u<2*i.length?u/2:i.length;for(var y=0;y<u;++y)ke[a>>1]=i.charCodeAt(y),a+=2;return ke[a>>1]=0,a-f},Vu=i=>2*i.length,qu=(i,a)=>{for(var u=0,f="";!(u>=a/4);){var y=me[i+4*u>>2];if(y==0)break;++u,65536<=y?(y-=65536,f+=String.fromCharCode(55296|y>>10,56320|y&1023)):f+=String.fromCharCode(y)}return f},Hu=(i,a,u)=>{if(u===void 0&&(u=2147483647),4>u)return 0;var f=a;u=f+u-4;for(var y=0;y<i.length;++y){var b=i.charCodeAt(y);if(55296<=b&&57343>=b){var A=i.charCodeAt(++y);b=65536+((b&1023)<<10)|A&1023}if(me[a>>2]=b,a+=4,a+4>u)break}return me[a>>2]=0,a-f},zu=i=>{for(var a=0,u=0;u<i.length;++u){var f=i.charCodeAt(u);55296<=f&&57343>=f&&++u,a+=4}return a},Gu={};function Ni(i){var a=Gu[i];return a===void 0?at(i):a}var Bi=[];function Ku(i){var a=Bi.length;return Bi.push(i),a}function Yu(i,a){for(var u=Array(i),f=0;f<i;++f)u[f]=ii(Ee[a+4*f>>2],"parameter "+f);return u}var po=[],Ls=[],Ds={},go=()=>{if(!$s){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:L||"./this.program"},a;for(a in Ds)Ds[a]===void 0?delete i[a]:i[a]=Ds[a];var u=[];for(a in i)u.push(`${a}=${i[a]}`);$s=u}return $s},$s,Wi=i=>i%4===0&&(i%100!==0||i%400===0),_o=[31,29,31,30,31,30,31,31,30,31,30,31],mo=[31,28,31,30,31,30,31,31,30,31,30,31],Ju=(i,a,u,f)=>{function y(I,G,H){for(I=typeof I=="number"?I.toString():I||"";I.length<G;)I=H[0]+I;return I}function b(I,G){return y(I,G,"0")}function A(I,G){function H(xe){return 0>xe?-1:0<xe?1:0}var Te;return(Te=H(I.getFullYear()-G.getFullYear()))===0&&(Te=H(I.getMonth()-G.getMonth()))===0&&(Te=H(I.getDate()-G.getDate())),Te}function j(I){switch(I.getDay()){case 0:return new Date(I.getFullYear()-1,11,29);case 1:return I;case 2:return new Date(I.getFullYear(),0,3);case 3:return new Date(I.getFullYear(),0,2);case 4:return new Date(I.getFullYear(),0,1);case 5:return new Date(I.getFullYear()-1,11,31);case 6:return new Date(I.getFullYear()-1,11,30)}}function M(I){var G=I.ca;for(I=new Date(new Date(I.da+1900,0,1).getTime());0<G;){var H=I.getMonth(),Te=(Wi(I.getFullYear())?_o:mo)[H];if(G>Te-I.getDate())G-=Te-I.getDate()+1,I.setDate(1),11>H?I.setMonth(H+1):(I.setMonth(0),I.setFullYear(I.getFullYear()+1));else{I.setDate(I.getDate()+G);break}}return H=new Date(I.getFullYear()+1,0,4),G=j(new Date(I.getFullYear(),0,4)),H=j(H),0>=A(G,I)?0>=A(H,I)?I.getFullYear()+1:I.getFullYear():I.getFullYear()-1}var T=me[f+40>>2];f={wc:me[f>>2],vc:me[f+4>>2],Fa:me[f+8>>2],Sa:me[f+12>>2],Ga:me[f+16>>2],da:me[f+20>>2],R:me[f+24>>2],ca:me[f+28>>2],Rc:me[f+32>>2],uc:me[f+36>>2],xc:T&&T?qe(pe,T):""},u=u?qe(pe,u):"",T={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var K in T)u=u.replace(new RegExp(K,"g"),T[K]);var Q="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),se="January February March April May June July August September October November December".split(" ");T={"%a":I=>Q[I.R].substring(0,3),"%A":I=>Q[I.R],"%b":I=>se[I.Ga].substring(0,3),"%B":I=>se[I.Ga],"%C":I=>b((I.da+1900)/100|0,2),"%d":I=>b(I.Sa,2),"%e":I=>y(I.Sa,2," "),"%g":I=>M(I).toString().substring(2),"%G":I=>M(I),"%H":I=>b(I.Fa,2),"%I":I=>(I=I.Fa,I==0?I=12:12<I&&(I-=12),b(I,2)),"%j":I=>{for(var G=0,H=0;H<=I.Ga-1;G+=(Wi(I.da+1900)?_o:mo)[H++]);return b(I.Sa+G,3)},"%m":I=>b(I.Ga+1,2),"%M":I=>b(I.vc,2),"%n":()=>`
`,"%p":I=>0<=I.Fa&&12>I.Fa?"AM":"PM","%S":I=>b(I.wc,2),"%t":()=>"	","%u":I=>I.R||7,"%U":I=>b(Math.floor((I.ca+7-I.R)/7),2),"%V":I=>{var G=Math.floor((I.ca+7-(I.R+6)%7)/7);if(2>=(I.R+371-I.ca-2)%7&&G++,G)G==53&&(H=(I.R+371-I.ca)%7,H==4||H==3&&Wi(I.da)||(G=1));else{G=52;var H=(I.R+7-I.ca-1)%7;(H==4||H==5&&Wi(I.da%400-1))&&G++}return b(G,2)},"%w":I=>I.R,"%W":I=>b(Math.floor((I.ca+7-(I.R+6)%7)/7),2),"%y":I=>(I.da+1900).toString().substring(2),"%Y":I=>I.da+1900,"%z":I=>{I=I.uc;var G=0<=I;return I=Math.abs(I)/60,(G?"+":"-")+("0000"+(I/60*100+I%60)).slice(-4)},"%Z":I=>I.xc,"%%":()=>"%"},u=u.replace(/%%/g,"\0\0");for(K in T)u.includes(K)&&(u=u.replace(new RegExp(K,"g"),T[K](f)));return u=u.replace(/\0\0/g,"%"),K=$t(u,!1),K.length>a?0:(Ie.set(K,i),K.length-1)};function yo(i,a,u,f){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Cu++,this.name=a,this.mode=u,this.l={},this.m={},this.za=f}Object.defineProperties(yo.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),Xa(),Qn=Array(4096),Ya(fe,"/"),nr("/tmp",16895,0),nr("/home",16895,0),nr("/home/web_user",16895,0),(()=>{nr("/dev",16895,0),Ss(259,{read:()=>0,write:(f,y,b,A)=>A}),Ii("/dev/null",259),mt(1280,ft),mt(1536,ot),Ii("/dev/tty",1280),Ii("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,u=()=>(a===0&&(a=_e(i).byteLength),i[--a]);Zn("random",u),Zn("urandom",u),nr("/dev/shm",16895,0),nr("/dev/shm/tmp",16895,0)})(),(()=>{nr("/proc",16895,0);var i=nr("/proc/self",16895,0);nr("/proc/self/fd",16895,0),Ya({U:()=>{var a=Ha(i,"fd",16895,73);return a.l={ka:(u,f)=>{var y=Dr(+f);return u={parent:null,U:{nb:"fake"},l:{ma:()=>y.path}},u.parent=u}},a}},"/proc/self/fd")})(),Object.assign(eo.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),wn=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},Yt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),Yt.h=Yt.M.length,g.count_emval_handles=function(){for(var i=0,a=Yt.h;a<Yt.M.length;++a)Yt.M[a]!==void 0&&++i;return i},ro=g.PureVirtualError=to("PureVirtualError");for(var wo=Array(256),Vi=0;256>Vi;++Vi)wo[Vi]=String.fromCharCode(Vi);no=wo,g.getInheritedInstanceCount=function(){return Object.keys(Ar).length},g.getLiveInheritedInstances=function(){var i=[],a;for(a in Ar)Ar.hasOwnProperty(a)&&i.push(Ar[a]);return i},g.flushPendingDeletes=Cs,g.setDelayFunction=function(i){ni=i,ri.length&&ni&&ni(Cs)},lo=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},$r.prototype.isAliasOf=function(i){if(!(this instanceof $r&&i instanceof $r))return!1;var a=this.g.u.i,u=this.g.o,f=i.g.u.i;for(i=i.g.o;a.A;)u=a.na(u),a=a.A;for(;f.A;)i=f.na(i),f=f.A;return a===f&&u===i},$r.prototype.clone=function(){if(this.g.o||Rs(this),this.g.ia)return this.g.count.value+=1,this;var i=bn,a=Object,u=a.create,f=Object.getPrototypeOf(this),y=this.g;return i=i(u.call(a,f,{g:{value:{count:y.count,fa:y.fa,ia:y.ia,o:y.o,u:y.u,G:y.G,L:y.L}}})),i.g.count.value+=1,i.g.fa=!1,i},$r.prototype.delete=function(){this.g.o||Rs(this),this.g.fa&&!this.g.ia&&Ce("Object already scheduled for deletion"),Ri(this),so(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},$r.prototype.isDeleted=function(){return!this.g.o},$r.prototype.deleteLater=function(){return this.g.o||Rs(this),this.g.fa&&!this.g.ia&&Ce("Object already scheduled for deletion"),ri.push(this),ri.length===1&&ni&&ni(Cs),this.g.fa=!0,this},Ir.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},Ir.prototype.bb=function(i){this.W&&this.W(i)},Ir.prototype.argPackAdvance=8,Ir.prototype.readValueFromPointer=ai,Ir.prototype.deleteObject=function(i){i!==null&&i.delete()},Ir.prototype.fromWireType=function(i){function a(){return this.ua?Oi(this.i.N,{u:this.nc,o:u,L:this,G:i}):Oi(this.i.N,{u:this,o:i})}var u=this.Vb(i);if(!u)return this.bb(i),null;var f=ju(this.i,u);if(f!==void 0)return f.g.count.value===0?(f.g.o=u,f.g.G=i,f.clone()):(f=f.clone(),this.bb(i),f);if(f=this.i.Ub(u),f=oo[f],!f)return a.call(this);f=this.ta?f.Kb:f.pointerType;var y=ao(u,this.i,f.i);return y===null?a.call(this):this.ua?Oi(f.i.N,{u:f,o:y,L:this,G:i}):Oi(f.i.N,{u:f,o:y})},ho=g.UnboundTypeError=to("UnboundTypeError");var bo={__syscall_fcntl64:function(i,a,u){ti=u;try{var f=Dr(i);switch(a){case 0:var y=Sr();return 0>y?-28:Ka(f,y).X;case 1:case 2:return 0;case 3:return f.flags;case 4:return y=Sr(),f.flags|=y,0;case 5:return y=Sr(),ke[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return me[ko()>>2]=28,-1;default:return-28}}catch(b){if(typeof Jr>"u"||b.name!=="ErrnoError")throw b;return-b.aa}},__syscall_ioctl:function(i,a,u){ti=u;try{var f=Dr(i);switch(a){case 21509:return f.s?0:-59;case 21505:if(!f.s)return-59;if(f.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var y=Sr();me[y>>2]=25856,me[y+4>>2]=5,me[y+8>>2]=191,me[y+12>>2]=35387;for(var b=0;32>b;b++)Ie[y+b+17>>0]=a[b]||0}return 0;case 21510:case 21511:case 21512:return f.s?0:-59;case 21506:case 21507:case 21508:if(!f.s)return-59;if(f.s.V.cc)for(y=Sr(),a=[],b=0;32>b;b++)a.push(Ie[y+b+17>>0]);return 0;case 21519:return f.s?(y=Sr(),me[y>>2]=0):-59;case 21520:return f.s?-28:-59;case 21531:if(y=Sr(),!f.m.ac)throw new ae(59);return f.m.ac(f,a,y);case 21523:return f.s?(f.s.V.dc&&(b=[24,80],y=Sr(),ke[y>>1]=b[0],ke[y+2>>1]=b[1]),0):-59;case 21524:return f.s?0:-59;case 21515:return f.s?0:-59;default:return-28}}catch(A){if(typeof Jr>"u"||A.name!=="ErrnoError")throw A;return-A.aa}},__syscall_openat:function(i,a,u,f){ti=f;try{a=a?qe(pe,a):"";var y=a;if(y.charAt(0)==="/")a=y;else{var b=i===-100?"/":Dr(i).path;if(y.length==0)throw new ae(44);a=C(b+"/"+y)}var A=f?Sr():0;return Ci(a,u,A).X}catch(j){if(typeof Jr>"u"||j.name!=="ErrnoError")throw j;return-j.aa}},_embind_create_inheriting_constructor:function(i,a,u){i=at(i),a=ii(a,"wrapper"),u=ir(u);var f=[].slice,y=a.i,b=y.N,A=y.A.N,j=y.A.constructor;i=Pi(i,function(){y.A.rb.forEach((function(T){if(this[T]===A[T])throw new ro(`Pure virtual function ${T} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:b}),this.__construct.apply(this,f.call(arguments))}),b.__construct=function(){this===b&&Ce("Pass correct 'this' to __construct");var T=j.implement.apply(void 0,[this].concat(f.call(arguments)));Ri(T);var K=T.g;T.notifyOnDestruction(),K.ia=!0,Object.defineProperties(this,{g:{value:K}}),bn(this),T=K.o,T=Ts(y,T),Ar.hasOwnProperty(T)?Ce(`Tried to register registered instance: ${T}`):Ar[T]=this},b.__destruct=function(){this===b&&Ce("Pass correct 'this' to __destruct"),Ri(this);var T=this.g.o;T=Ts(y,T),Ar.hasOwnProperty(T)?delete Ar[T]:Ce(`Tried to unregister unregistered instance: ${T}`)},i.prototype=Object.create(b);for(var M in u)i.prototype[M]=u[M];return sr(i)},_embind_finalize_value_object:function(i){var a=xi[i];delete xi[i];var u=a.Pa,f=a.W,y=a.fb,b=y.map(A=>A.Yb).concat(y.map(A=>A.rc));Vt([i],b,A=>{var j={};return y.forEach((M,T)=>{var K=A[T],Q=M.Wb,se=M.Xb,I=A[T+y.length],G=M.qc,H=M.sc;j[M.Sb]={read:Te=>K.fromWireType(Q(se,Te)),write:(Te,xe)=>{var te=[];G(H,Te,I.toWireType(te,xe)),si(te)}}}),[{name:a.name,fromWireType:function(M){var T={},K;for(K in j)T[K]=j[K].read(M);return f(M),T},toWireType:function(M,T){for(var K in j)if(!(K in T))throw new TypeError(`Missing field: "${K}"`);var Q=u();for(K in j)j[K].write(Q,T[K]);return M!==null&&M.push(f,Q),Q},argPackAdvance:8,readValueFromPointer:ai,K:f}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,u,f,y){var b=Li(u);a=at(a),hr(i,{name:a,fromWireType:function(A){return!!A},toWireType:function(A,j){return j?f:y},argPackAdvance:8,readValueFromPointer:function(A){if(u===1)var j=Ie;else if(u===2)j=ke;else if(u===4)j=me;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(j[A>>b])},K:null})},_embind_register_class:function(i,a,u,f,y,b,A,j,M,T,K,Q,se){K=at(K),b=Tt(y,b),j&&(j=Tt(A,j)),T&&(T=Tt(M,T)),se=Tt(Q,se);var I=Za(K);Os(I,function(){Cr(`Cannot construct ${K} due to unbound types`,[f])}),Vt([i,a,u],f?[f]:[],function(G){if(G=G[0],f)var H=G.i,Te=H.N;else Te=$r.prototype;G=Pi(I,function(){if(Object.getPrototypeOf(this)!==xe)throw new wn("Use 'new' to construct "+K);if(te.$===void 0)throw new wn(K+" has no accessible constructor");var St=te.$[arguments.length];if(St===void 0)throw new wn(`Tried to invoke ctor of ${K} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(te.$).toString()}) parameters instead!`);return St.apply(this,arguments)});var xe=Object.create(Te,{constructor:{value:G}});G.prototype=xe;var te=new xu(K,G,xe,se,H,b,j,T);te.A&&(te.A.oa===void 0&&(te.A.oa=[]),te.A.oa.push(te)),H=new Ir(K,te,!0,!1),Te=new Ir(K+"*",te,!1,!1);var tt=new Ir(K+" const*",te,!1,!0);return oo[i]={pointerType:Te,Kb:tt},uo(I,G),[H,Te,tt]})},_embind_register_class_class_function:function(i,a,u,f,y,b,A){var j=Ui(u,f);a=at(a),b=Tt(y,b),Vt([],[i],function(M){function T(){Cr(`Cannot call ${K} due to unbound types`,j)}M=M[0];var K=`${M.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var Q=M.i.constructor;return Q[a]===void 0?(T.ea=u-1,Q[a]=T):(js(Q,a,K),Q[a].B[u-1]=T),Vt([],j,function(se){if(se=Fi(K,[se[0],null].concat(se.slice(1)),null,b,A),Q[a].B===void 0?(se.ea=u-1,Q[a]=se):Q[a].B[u-1]=se,M.i.oa)for(const I of M.i.oa)I.constructor.hasOwnProperty(a)||(I.constructor[a]=se);return[]}),[]})},_embind_register_class_class_property:function(i,a,u,f,y,b,A,j){a=at(a),b=Tt(y,b),Vt([],[i],function(M){M=M[0];var T=`${M.name}.${a}`,K={get(){Cr(`Cannot access ${T} due to unbound types`,[u])},enumerable:!0,configurable:!0};return K.set=j?()=>{Cr(`Cannot access ${T} due to unbound types`,[u])}:()=>{Ce(`${T} is a read-only property`)},Object.defineProperty(M.i.constructor,a,K),Vt([],[u],function(Q){Q=Q[0];var se={get(){return Q.fromWireType(b(f))},enumerable:!0};return j&&(j=Tt(A,j),se.set=I=>{var G=[];j(f,Q.toWireType(G,I)),si(G)}),Object.defineProperty(M.i.constructor,a,se),[]}),[]})},_embind_register_class_constructor:function(i,a,u,f,y,b){var A=Ui(a,u);y=Tt(f,y),Vt([],[i],function(j){j=j[0];var M=`constructor ${j.name}`;if(j.i.$===void 0&&(j.i.$=[]),j.i.$[a-1]!==void 0)throw new wn(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${j.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return j.i.$[a-1]=()=>{Cr(`Cannot construct ${j.name} due to unbound types`,A)},Vt([],A,function(T){return T.splice(1,0,null),j.i.$[a-1]=Fi(M,T,null,y,b),[]}),[]})},_embind_register_class_function:function(i,a,u,f,y,b,A,j){var M=Ui(u,f);a=at(a),b=Tt(y,b),Vt([],[i],function(T){function K(){Cr(`Cannot call ${Q} due to unbound types`,M)}T=T[0];var Q=`${T.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),j&&T.i.rb.push(a);var se=T.i.N,I=se[a];return I===void 0||I.B===void 0&&I.className!==T.name&&I.ea===u-2?(K.ea=u-2,K.className=T.name,se[a]=K):(js(se,a,Q),se[a].B[u-2]=K),Vt([],M,function(G){return G=Fi(Q,G,T,b,A),se[a].B===void 0?(G.ea=u-2,se[a]=G):se[a].B[u-2]=G,[]}),[]})},_embind_register_class_property:function(i,a,u,f,y,b,A,j,M,T){a=at(a),y=Tt(f,y),Vt([],[i],function(K){K=K[0];var Q=`${K.name}.${a}`,se={get(){Cr(`Cannot access ${Q} due to unbound types`,[u,A])},enumerable:!0,configurable:!0};return se.set=M?()=>{Cr(`Cannot access ${Q} due to unbound types`,[u,A])}:()=>{Ce(Q+" is a read-only property")},Object.defineProperty(K.i.N,a,se),Vt([],M?[u,A]:[u],function(I){var G=I[0],H={get(){var xe=fo(this,K,Q+" getter");return G.fromWireType(y(b,xe))},enumerable:!0};if(M){M=Tt(j,M);var Te=I[1];H.set=function(xe){var te=fo(this,K,Q+" setter"),tt=[];M(T,te,Te.toWireType(tt,xe)),si(tt)}}return Object.defineProperty(K.i.N,a,H),[]}),[]})},_embind_register_emval:function(i,a){a=at(a),hr(i,{name:a,fromWireType:function(u){var f=ir(u);return xs(u),f},toWireType:function(u,f){return sr(f)},argPackAdvance:8,readValueFromPointer:ai,K:null})},_embind_register_enum:function(i,a,u,f){function y(){}u=Li(u),a=at(a),y.values={},hr(i,{name:a,constructor:y,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,A){return A.value},argPackAdvance:8,readValueFromPointer:Fu(a,u,f),K:null}),Os(a,y)},_embind_register_enum_value:function(i,a,u){var f=ii(i,"enum");a=at(a),i=f.constructor,f=Object.create(f.constructor.prototype,{value:{value:u},constructor:{value:Pi(`${f.name}_${a}`,function(){})}}),i.values[u]=f,i[a]=f},_embind_register_float:function(i,a,u){u=Li(u),a=at(a),hr(i,{name:a,fromWireType:function(f){return f},toWireType:function(f,y){return y},argPackAdvance:8,readValueFromPointer:Uu(a,u),K:null})},_embind_register_function:function(i,a,u,f,y,b){var A=Ui(a,u);i=at(i),y=Tt(f,y),Os(i,function(){Cr(`Cannot call ${i} due to unbound types`,A)},a-1),Vt([],A,function(j){return uo(i,Fi(i,[j[0],null].concat(j.slice(1)),null,y,b),a-1),[]})},_embind_register_integer:function(i,a,u,f,y){a=at(a),y===-1&&(y=4294967295),y=Li(u);var b=j=>j;if(f===0){var A=32-8*u;b=j=>j<<A>>>A}u=a.includes("unsigned")?function(j,M){return M>>>0}:function(j,M){return M},hr(i,{name:a,fromWireType:b,toWireType:u,argPackAdvance:8,readValueFromPointer:Nu(a,y,f!==0),K:null})},_embind_register_memory_view:function(i,a,u){function f(b){b>>=2;var A=Ee;return new y(A.buffer,A[b+1],A[b])}var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];u=at(u),hr(i,{name:u,fromWireType:f,argPackAdvance:8,readValueFromPointer:f},{$b:!0})},_embind_register_std_string:function(i,a){a=at(a);var u=a==="std::string";hr(i,{name:a,fromWireType:function(f){var y=Ee[f>>2],b=f+4;if(u)for(var A=b,j=0;j<=y;++j){var M=b+j;if(j==y||pe[M]==0){if(A=A?qe(pe,A,M-A):"",T===void 0)var T=A;else T+="\0",T+=A;A=M+1}}else{for(T=Array(y),j=0;j<y;++j)T[j]=String.fromCharCode(pe[b+j]);T=T.join("")}return Tr(f),T},toWireType:function(f,y){y instanceof ArrayBuffer&&(y=new Uint8Array(y));var b=typeof y=="string";b||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Int8Array||Ce("Cannot pass non-string to std::string");var A=u&&b?Ze(y):y.length,j=Fs(4+A+1),M=j+4;if(Ee[j>>2]=A,u&&b)Wt(y,pe,M,A+1);else if(b)for(b=0;b<A;++b){var T=y.charCodeAt(b);255<T&&(Tr(M),Ce("String has UTF-16 code units that do not fit in 8 bits")),pe[M+b]=T}else for(b=0;b<A;++b)pe[M+b]=y[b];return f!==null&&f.push(Tr,j),j},argPackAdvance:8,readValueFromPointer:ai,K:function(f){Tr(f)}})},_embind_register_std_wstring:function(i,a,u){if(u=at(u),a===2)var f=Bu,y=Wu,b=Vu,A=()=>Ye,j=1;else a===4&&(f=qu,y=Hu,b=zu,A=()=>Ee,j=2);hr(i,{name:u,fromWireType:function(M){for(var T=Ee[M>>2],K=A(),Q,se=M+4,I=0;I<=T;++I){var G=M+4+I*a;(I==T||K[G>>j]==0)&&(se=f(se,G-se),Q===void 0?Q=se:(Q+="\0",Q+=se),se=G+a)}return Tr(M),Q},toWireType:function(M,T){typeof T!="string"&&Ce(`Cannot pass non-string to C++ string type ${u}`);var K=b(T),Q=Fs(4+K+a);return Ee[Q>>2]=K>>j,y(T,Q+4,K+a),M!==null&&M.push(Tr,Q),Q},argPackAdvance:8,readValueFromPointer:ai,K:function(M){Tr(M)}})},_embind_register_value_object:function(i,a,u,f,y,b){xi[i]={name:at(a),Pa:Tt(u,f),W:Tt(y,b),fb:[]}},_embind_register_value_object_field:function(i,a,u,f,y,b,A,j,M,T){xi[i].fb.push({Sb:at(a),Yb:u,Wb:Tt(f,y),Xb:b,rc:A,qc:Tt(j,M),sc:T})},_embind_register_void:function(i,a){a=at(a),hr(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,u){i=ir(i),a=ii(a,"emval::as");var f=[],y=sr(f);return Ee[u>>2]=y,a.toWireType(f,i)},_emval_call_method:function(i,a,u,f,y){i=Bi[i],a=ir(a),u=Ni(u);var b=[];return Ee[f>>2]=sr(b),i(a,u,b,y)},_emval_call_void_method:function(i,a,u,f){i=Bi[i],a=ir(a),u=Ni(u),i(a,u,null,f)},_emval_decref:xs,_emval_get_method_caller:function(i,a){var u=Yu(i,a),f=u[0];a=f.name+"_$"+u.slice(1).map(function(A){return A.name}).join("_")+"$";var y=po[a];if(y!==void 0)return y;var b=Array(i-1);return y=Ku((A,j,M,T)=>{for(var K=0,Q=0;Q<i-1;++Q)b[Q]=u[Q+1].readValueFromPointer(T+K),K+=u[Q+1].argPackAdvance;for(A=A[j].apply(A,b),Q=0;Q<i-1;++Q)u[Q+1].Nb&&u[Q+1].Nb(b[Q]);if(!f.fc)return f.toWireType(M,A)}),po[a]=y},_emval_get_module_property:function(i){return i=Ni(i),sr(g[i])},_emval_get_property:function(i,a){return i=ir(i),a=ir(a),sr(i[a])},_emval_incref:function(i){4<i&&(Yt.get(i).ub+=1)},_emval_new_array:function(){return sr([])},_emval_new_cstring:function(i){return sr(Ni(i))},_emval_new_object:function(){return sr({})},_emval_run_destructors:function(i){var a=ir(i);si(a),xs(i)},_emval_set_property:function(i,a,u){i=ir(i),a=ir(a),u=ir(u),i[a]=u},_emval_take_value:function(i,a){return i=ii(i,"_emval_take_value"),i=i.readValueFromPointer(a),sr(i)},abort:()=>{Kt("")},emscripten_asm_const_int:(i,a,u)=>{Ls.length=0;var f;for(u>>=2;f=pe[a++];)u+=f!=105&u,Ls.push(f==105?me[u]:le[u++>>1]),++u;return o[i].apply(null,Ls)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,u)=>pe.copyWithin(i,a,a+u),emscripten_resize_heap:i=>{var a=pe.length;if(i>>>=0,2147483648<i)return!1;for(var u=1;4>=u;u*=2){var f=a*(1+.2/u);f=Math.min(f,i+100663296);var y=Math;f=Math.max(i,f);e:{y=y.min.call(y,2147483648,f+(65536-f%65536)%65536)-Ke.buffer.byteLength+65535>>>16;try{Ke.grow(y),de();var b=1;break e}catch{}b=void 0}if(b)return!0}return!1},environ_get:(i,a)=>{var u=0;return go().forEach(function(f,y){var b=a+u;for(y=Ee[i+4*y>>2]=b,b=0;b<f.length;++b)Ie[y++>>0]=f.charCodeAt(b);Ie[y>>0]=0,u+=f.length+1}),0},environ_sizes_get:(i,a)=>{var u=go();Ee[i>>2]=u.length;var f=0;return u.forEach(function(y){f+=y.length+1}),Ee[a>>2]=f,0},fd_close:function(i){try{var a=Dr(i);if(a.X===null)throw new ae(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(u){throw u}finally{Ei[a.X]=null}return a.X=null,0}catch(u){if(typeof Jr>"u"||u.name!=="ErrnoError")throw u;return u.aa}},fd_read:function(i,a,u,f){try{e:{var y=Dr(i);i=a;for(var b,A=a=0;A<u;A++){var j=Ee[i>>2],M=Ee[i+4>>2];i+=8;var T=y,K=j,Q=M,se=b,I=Ie;if(0>Q||0>se)throw new ae(28);if(T.X===null)throw new ae(8);if((T.flags&2097155)===1)throw new ae(8);if((T.node.mode&61440)===16384)throw new ae(31);if(!T.m.read)throw new ae(28);var G=typeof se<"u";if(!G)se=T.position;else if(!T.seekable)throw new ae(70);var H=T.m.read(T,I,K,Q,se);G||(T.position+=H);var Te=H;if(0>Te){var xe=-1;break e}if(a+=Te,Te<M)break;typeof b<"u"&&(b+=Te)}xe=a}return Ee[f>>2]=xe,0}catch(te){if(typeof Jr>"u"||te.name!=="ErrnoError")throw te;return te.aa}},fd_seek:function(i,a,u,f,y){a=u+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*u:NaN;try{if(isNaN(a))return 61;var b=Dr(i);return Ja(b,a,f),p=[b.position>>>0,(xt=b.position,1<=+Math.abs(xt)?0<xt?+Math.floor(xt/4294967296)>>>0:~~+Math.ceil((xt-+(~~xt>>>0))/4294967296)>>>0:0)],me[y>>2]=p[0],me[y+4>>2]=p[1],b.Ma&&a===0&&f===0&&(b.Ma=null),0}catch(A){if(typeof Jr>"u"||A.name!=="ErrnoError")throw A;return A.aa}},fd_write:function(i,a,u,f){try{e:{var y=Dr(i);i=a;for(var b,A=a=0;A<u;A++){var j=Ee[i>>2],M=Ee[i+4>>2];i+=8;var T=y,K=j,Q=M,se=b,I=Ie;if(0>Q||0>se)throw new ae(28);if(T.X===null)throw new ae(8);if((T.flags&2097155)===0)throw new ae(8);if((T.node.mode&61440)===16384)throw new ae(31);if(!T.m.write)throw new ae(28);T.seekable&&T.flags&1024&&Ja(T,0,2);var G=typeof se<"u";if(!G)se=T.position;else if(!T.seekable)throw new ae(70);var H=T.m.write(T,I,K,Q,se,void 0);G||(T.position+=H);var Te=H;if(0>Te){var xe=-1;break e}a+=Te,typeof b<"u"&&(b+=Te)}xe=a}return Ee[f>>2]=xe,0}catch(te){if(typeof Jr>"u"||te.name!=="ErrnoError")throw te;return te.aa}},strftime_l:(i,a,u,f)=>Ju(i,a,u,f)};(function(){function i(u){if(ye=u=u.exports,Ke=ye.memory,de(),Oe=ye.__indirect_function_table,It.unshift(ye.__wasm_call_ctors),gt--,g.monitorRunDependencies&&g.monitorRunDependencies(gt),gt==0&&jt){var f=jt;jt=null,f()}return u}var a={env:bo,wasi_snapshot_preview1:bo};if(gt++,g.monitorRunDependencies&&g.monitorRunDependencies(gt),g.instantiateWasm)try{return g.instantiateWasm(a,i)}catch(u){Ae("Module.instantiateWasm callback failed with error: "+u),$(u)}return Ot(a,function(u){i(u.instance)}).catch($),{}})();var Tr=i=>(Tr=ye.free)(i),Fs=i=>(Fs=ye.malloc)(i),ko=()=>(ko=ye.__errno_location)(),Eo=g._ma_device__on_notification_unlocked=i=>(Eo=g._ma_device__on_notification_unlocked=ye.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,a)=>(g._ma_malloc_emscripten=ye.ma_malloc_emscripten)(i,a),g._ma_free_emscripten=(i,a)=>(g._ma_free_emscripten=ye.ma_free_emscripten)(i,a);var So=g._ma_device_process_pcm_frames_capture__webaudio=(i,a,u)=>(So=g._ma_device_process_pcm_frames_capture__webaudio=ye.ma_device_process_pcm_frames_capture__webaudio)(i,a,u),Ao=g._ma_device_process_pcm_frames_playback__webaudio=(i,a,u)=>(Ao=g._ma_device_process_pcm_frames_playback__webaudio=ye.ma_device_process_pcm_frames_playback__webaudio)(i,a,u),Io=i=>(Io=ye.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=ye._embind_initialize_bindings)(),g.dynCall_iiji=(i,a,u,f,y)=>(g.dynCall_iiji=ye.dynCall_iiji)(i,a,u,f,y),g.dynCall_jiji=(i,a,u,f,y)=>(g.dynCall_jiji=ye.dynCall_jiji)(i,a,u,f,y),g.dynCall_iiiji=(i,a,u,f,y,b)=>(g.dynCall_iiiji=ye.dynCall_iiiji)(i,a,u,f,y,b),g.dynCall_iij=(i,a,u,f)=>(g.dynCall_iij=ye.dynCall_iij)(i,a,u,f),g.dynCall_jii=(i,a,u)=>(g.dynCall_jii=ye.dynCall_jii)(i,a,u),g.dynCall_viijii=(i,a,u,f,y,b,A)=>(g.dynCall_viijii=ye.dynCall_viijii)(i,a,u,f,y,b,A),g.dynCall_iiiiij=(i,a,u,f,y,b,A)=>(g.dynCall_iiiiij=ye.dynCall_iiiiij)(i,a,u,f,y,b,A),g.dynCall_iiiiijj=(i,a,u,f,y,b,A,j,M)=>(g.dynCall_iiiiijj=ye.dynCall_iiiiijj)(i,a,u,f,y,b,A,j,M),g.dynCall_iiiiiijj=(i,a,u,f,y,b,A,j,M,T)=>(g.dynCall_iiiiiijj=ye.dynCall_iiiiiijj)(i,a,u,f,y,b,A,j,M,T);var qi;jt=function i(){qi||Co(),qi||(jt=i)};function Co(){function i(){if(!qi&&(qi=!0,g.calledRun=!0,!we)){if(g.noFSInit||Qa||(Qa=!0,Xa(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?Zn("stdin",g.stdin):As("/dev/tty","/dev/stdin"),g.stdout?Zn("stdout",null,g.stdout):As("/dev/tty","/dev/stdout"),g.stderr?Zn("stderr",null,g.stderr):As("/dev/tty1","/dev/stderr"),Ci("/dev/stdin",0),Ci("/dev/stdout",1),Ci("/dev/stderr",1)),Wa=!1,d(It),S(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var a=g.postRun.shift();ht.unshift(a)}d(ht)}}if(!(0<gt)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Bt();d(Ge),0<gt||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Co(),E.ready})})();const _=m}),(c=>{c.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((c,h,v)=>{v.r(h),v.d(h,{Animation:()=>m.Animation});var m=v(4)}),((c,h,v)=>{v.r(h),v.d(h,{Animation:()=>m});var m=(function(){function _(k,E,g,S){this.animation=k,this.artboard=E,this.playing=S,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(k,E)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(k){this.instance.time=k},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(k){this.scrubTo===null?this.instance.advance(k):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(k){this.instance.apply(k)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((c,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>k.AudioAssetWrapper,AudioWrapper:()=>k.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>k.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>k.FileAssetWrapper,Finalizable:()=>k.Finalizable,FontAssetWrapper:()=>k.FontAssetWrapper,FontWrapper:()=>k.FontWrapper,ImageAssetWrapper:()=>k.ImageAssetWrapper,ImageWrapper:()=>k.ImageWrapper,finalizationRegistry:()=>k.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var m=v(6),_=v(7),k=v(8)}),((c,h,v)=>{v.r(h),v.d(h,{registerTouchInteractions:()=>k});var m=void 0,_=function(E,g){var S,$;return["touchstart","touchmove"].indexOf(E.type)>-1&&(!((S=E.touches)===null||S===void 0)&&S.length)?(g||E.preventDefault(),{clientX:E.touches[0].clientX,clientY:E.touches[0].clientY}):E.type==="touchend"&&(!(($=E.changedTouches)===null||$===void 0)&&$.length)?{clientX:E.changedTouches[0].clientX,clientY:E.changedTouches[0].clientY}:{clientX:E.clientX,clientY:E.clientY}},k=function(E){var g=E.canvas,S=E.artboard,$=E.stateMachines,R=$===void 0?[]:$,U=E.renderer,B=E.rive,N=E.fit,z=E.alignment,Z=E.isTouchScrollEnabled,O=Z===void 0?!1:Z,L=E.layoutScaleFactor,ie=L===void 0?1:L;if(!g||!R.length||!U||!B||!S||typeof window>"u")return null;var J=null,ne=!1,Y=function(ve){if(ne&&ve instanceof MouseEvent){ve.type=="mouseup"&&(ne=!1);return}ne=O&&ve.type==="touchend"&&J==="touchstart",J=ve.type;var Ae=ve.currentTarget.getBoundingClientRect(),ce=_(ve,O),Ke=ce.clientX,ye=ce.clientY;if(!(!Ke&&!ye)){var we=Ke-Ae.left,Ie=ye-Ae.top,pe=B.computeAlignment(N,z,{minX:0,minY:0,maxX:Ae.width,maxY:Ae.height},S.bounds,ie),ke=new B.Mat2D;pe.invert(ke);var Ye=new B.Vec2D(we,Ie),me=B.mapXY(ke,Ye),Ee=me.x(),ge=me.y();switch(me.delete(),ke.delete(),Ye.delete(),pe.delete(),ve.type){case"mouseout":for(var le=0,de=R;le<de.length;le++){var Oe=de[le];Oe.pointerMove(Ee,ge)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Ge=0,It=R;Ge<It.length;Ge++){var Oe=It[Ge];Oe.pointerMove(Ee,ge)}break}case"touchstart":case"mousedown":{for(var ht=0,Bt=R;ht<Bt.length;ht++){var Oe=Bt[ht];Oe.pointerDown(Ee,ge)}break}case"touchend":case"mouseup":{for(var gt=0,jt=R;gt<jt.length;gt++){var Oe=jt[gt];Oe.pointerUp(Ee,ge)}break}}}},X=Y.bind(m);return g.addEventListener("mouseover",X),g.addEventListener("mouseout",X),g.addEventListener("mousemove",X),g.addEventListener("mousedown",X),g.addEventListener("mouseup",X),g.addEventListener("touchmove",X,{passive:O}),g.addEventListener("touchstart",X,{passive:O}),g.addEventListener("touchend",X),function(){g.removeEventListener("mouseover",X),g.removeEventListener("mouseout",X),g.removeEventListener("mousemove",X),g.removeEventListener("mousedown",X),g.removeEventListener("mouseup",X),g.removeEventListener("touchmove",X),g.removeEventListener("touchstart",X),g.removeEventListener("touchend",X)}}}),((c,h,v)=>{v.r(h),v.d(h,{BLANK_URL:()=>$,sanitizeUrl:()=>B});var m=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,k=/&(newline|tab);/gi,E=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,S=[".","/"],$="about:blank";function R(N){return S.indexOf(N[0])>-1}function U(N){var z=N.replace(E,"");return z.replace(_,function(Z,O){return String.fromCharCode(O)})}function B(N){if(!N)return $;var z=U(N).replace(k,"").replace(E,"").trim();if(!z)return $;if(R(z))return z;var Z=z.match(g);if(!Z)return z;var O=Z[0];return m.test(O)?$:z}}),((c,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>U,AudioWrapper:()=>E,CustomFileAssetLoaderWrapper:()=>S,FileAssetWrapper:()=>$,Finalizable:()=>_,FontAssetWrapper:()=>B,FontWrapper:()=>g,ImageAssetWrapper:()=>R,ImageWrapper:()=>k,finalizationRegistry:()=>Z});var m=(function(){var O=function(L,ie){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,ne){J.__proto__=ne}||function(J,ne){for(var Y in ne)Object.prototype.hasOwnProperty.call(ne,Y)&&(J[Y]=ne[Y])},O(L,ie)};return function(L,ie){if(typeof ie!="function"&&ie!==null)throw new TypeError("Class extends value "+String(ie)+" is not a constructor or null");O(L,ie);function J(){this.constructor=L}L.prototype=ie===null?Object.create(ie):(J.prototype=ie.prototype,new J)}})(),_=(function(){function O(){this.selfUnref=!1}return O})(),k=(function(O){m(L,O);function L(ie){var J=O.call(this)||this;return J._nativeImage=ie,J}return Object.defineProperty(L.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),L.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},L})(_),E=(function(O){m(L,O);function L(ie){var J=O.call(this)||this;return J._nativeAudio=ie,J}return Object.defineProperty(L.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),L.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},L})(_),g=(function(O){m(L,O);function L(ie){var J=O.call(this)||this;return J._nativeFont=ie,J}return Object.defineProperty(L.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),L.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},L})(_),S=(function(){function O(L,ie){this._assetLoaderCallback=ie,this.assetLoader=new L.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return O.prototype.loadContents=function(L,ie){var J;return L.isImage?J=new R(L):L.isAudio?J=new U(L):L.isFont&&(J=new B(L)),this._assetLoaderCallback(J,ie)},O})(),$=(function(){function O(L){this._nativeFileAsset=L}return O.prototype.decode=function(L){this._nativeFileAsset.decode(L)},Object.defineProperty(O.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),O})(),R=(function(O){m(L,O);function L(){return O!==null&&O.apply(this,arguments)||this}return L.prototype.setRenderImage=function(ie){this._nativeFileAsset.setRenderImage(ie.nativeImage)},L})($),U=(function(O){m(L,O);function L(){return O!==null&&O.apply(this,arguments)||this}return L.prototype.setAudioSource=function(ie){this._nativeFileAsset.setAudioSource(ie.nativeAudio)},L})($),B=(function(O){m(L,O);function L(){return O!==null&&O.apply(this,arguments)||this}return L.prototype.setFont=function(ie){this._nativeFileAsset.setFont(ie.nativeFont)},L})($),N=(function(){function O(L){}return O.prototype.register=function(L){L.selfUnref=!0},O.prototype.unregister=function(L){},O})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:N,Z=new z(function(O){O.unref()})})],n={};function s(c){var h=n[c];if(h!==void 0)return h.exports;var v=n[c]={exports:{}};return t[c](v,v.exports,s),v.exports}s.d=(c,h)=>{for(var v in h)s.o(h,v)&&!s.o(c,v)&&Object.defineProperty(c,v,{enumerable:!0,get:h[v]})},s.o=(c,h)=>Object.prototype.hasOwnProperty.call(c,h),s.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>B,DataEnum:()=>ge,EventType:()=>Y,Fit:()=>U,Layout:()=>N,LoopType:()=>X,Rive:()=>me,RiveEventType:()=>L,RiveFile:()=>Ye,RuntimeLoader:()=>z,StateMachineInput:()=>O,StateMachineInputType:()=>Z,Testing:()=>Lr,ViewModel:()=>Ee,ViewModelInstance:()=>de,ViewModelInstanceArtboard:()=>st,ViewModelInstanceAssetImage:()=>lt,ViewModelInstanceBoolean:()=>ht,ViewModelInstanceColor:()=>Kt,ViewModelInstanceEnum:()=>gt,ViewModelInstanceList:()=>jt,ViewModelInstanceNumber:()=>It,ViewModelInstanceString:()=>Ge,ViewModelInstanceTrigger:()=>Bt,ViewModelInstanceValue:()=>Oe,decodeAudio:()=>it,decodeFont:()=>xt,decodeImage:()=>Ot});var c=s(1),h=s(2),v=s(3),m=s(5),_=(function(){var p=function(o,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,C){w.__proto__=C}||function(w,C){for(var D in C)Object.prototype.hasOwnProperty.call(C,D)&&(w[D]=C[D])},p(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(o,d);function w(){this.constructor=o}o.prototype=d===null?Object.create(d):(w.prototype=d.prototype,new w)}})(),k=function(){return k=Object.assign||function(p){for(var o,d=1,w=arguments.length;d<w;d++){o=arguments[d];for(var C in o)Object.prototype.hasOwnProperty.call(o,C)&&(p[C]=o[C])}return p},k.apply(this,arguments)},E=function(p,o,d,w){function C(D){return D instanceof d?D:new d(function(V){V(D)})}return new(d||(d=Promise))(function(D,V){function he(je){try{oe(w.next(je))}catch(qe){V(qe)}}function _e(je){try{oe(w.throw(je))}catch(qe){V(qe)}}function oe(je){je.done?D(je.value):C(je.value).then(he,_e)}oe((w=w.apply(p,o||[])).next())})},g=function(p,o){var d={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},w,C,D,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=he(0),V.throw=he(1),V.return=he(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function he(oe){return function(je){return _e([oe,je])}}function _e(oe){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,oe[0]&&(d=0)),d;)try{if(w=1,C&&(D=oe[0]&2?C.return:oe[0]?C.throw||((D=C.return)&&D.call(C),0):C.next)&&!(D=D.call(C,oe[1])).done)return D;switch(C=0,D&&(oe=[oe[0]&2,D.value]),oe[0]){case 0:case 1:D=oe;break;case 4:return d.label++,{value:oe[1],done:!1};case 5:d.label++,C=oe[1],oe=[0];continue;case 7:oe=d.ops.pop(),d.trys.pop();continue;default:if(D=d.trys,!(D=D.length>0&&D[D.length-1])&&(oe[0]===6||oe[0]===2)){d=0;continue}if(oe[0]===3&&(!D||oe[1]>D[0]&&oe[1]<D[3])){d.label=oe[1];break}if(oe[0]===6&&d.label<D[1]){d.label=D[1],D=oe;break}if(D&&d.label<D[2]){d.label=D[2],d.ops.push(oe);break}D[2]&&d.ops.pop(),d.trys.pop();continue}oe=o.call(p,d)}catch(je){oe=[6,je],C=0}finally{w=D=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}},S=function(p,o,d){if(d||arguments.length===2)for(var w=0,C=o.length,D;w<C;w++)(D||!(w in o))&&(D||(D=Array.prototype.slice.call(o,0,w)),D[w]=o[w]);return p.concat(D||Array.prototype.slice.call(o))},$=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),R=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},U;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(U||(U={}));var B;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(B||(B={}));var N=(function(){function p(o){var d,w,C,D,V,he,_e;this.fit=(d=o?.fit)!==null&&d!==void 0?d:U.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:B.Center,this.layoutScaleFactor=(C=o?.layoutScaleFactor)!==null&&C!==void 0?C:1,this.minX=(D=o?.minX)!==null&&D!==void 0?D:0,this.minY=(V=o?.minY)!==null&&V!==void 0?V:0,this.maxX=(he=o?.maxX)!==null&&he!==void 0?he:0,this.maxY=(_e=o?.maxY)!==null&&_e!==void 0?_e:0}return p.new=function(o){var d=o.fit,w=o.alignment,C=o.minX,D=o.minY,V=o.maxX,he=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:d,alignment:w,minX:C,minY:D,maxX:V,maxY:he})},p.prototype.copyWith=function(o){var d=o.fit,w=o.alignment,C=o.layoutScaleFactor,D=o.minX,V=o.minY,he=o.maxX,_e=o.maxY;return new p({fit:d??this.fit,alignment:w??this.alignment,layoutScaleFactor:C??this.layoutScaleFactor,minX:D??this.minX,minY:V??this.minY,maxX:he??this.maxX,maxY:_e??this.maxY})},p.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===U.Cover?d=o.Fit.cover:this.fit===U.Contain?d=o.Fit.contain:this.fit===U.Fill?d=o.Fit.fill:this.fit===U.FitWidth?d=o.Fit.fitWidth:this.fit===U.FitHeight?d=o.Fit.fitHeight:this.fit===U.ScaleDown?d=o.Fit.scaleDown:this.fit===U.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},p.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===B.TopLeft?d=o.Alignment.topLeft:this.alignment===B.TopCenter?d=o.Alignment.topCenter:this.alignment===B.TopRight?d=o.Alignment.topRight:this.alignment===B.CenterLeft?d=o.Alignment.centerLeft:this.alignment===B.CenterRight?d=o.Alignment.centerRight:this.alignment===B.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===B.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===B.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},p})(),z=(function(){function p(){}return p.loadRuntime=function(){c.default({locateFile:function(){return p.wasmURL}}).then(function(o){var d;for(p.runtime=o;p.callBackQueue.length>0;)(d=p.callBackQueue.shift())===null||d===void 0||d(p.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var w="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),p.setWasmUrl(w),p.loadRuntime();else{var C=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(C)}})},p.getInstance=function(o){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?o(p.runtime):p.callBackQueue.push(o)},p.awaitInstance=function(){return new Promise(function(o){return p.getInstance(function(d){return o(d)})})},p.setWasmUrl=function(o){p.wasmURL=o},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),p})(),Z;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(Z||(Z={}));var O=(function(){function p(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===Z.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),L;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(L||(L={}));var ie=(function(){function p(o){this.nativeArtboard=o}return p})(),J=(function(){function p(o,d,w,C){this.stateMachine=o,this.playing=w,this.artboard=C,this.inputs=[],this.instance=new d.StateMachineInstance(o,C),this.initInputs(d)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),p.prototype.advance=function(o){this.instance.advance(o)},p.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},p.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var w=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(w,o))}},p.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new O(Z.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new O(Z.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new O(Z.Trigger,o.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},p})(),ne=(function(){function p(o,d,w,C,D){C===void 0&&(C=[]),D===void 0&&(D=[]),this.runtime=o,this.artboard=d,this.eventManager=w,this.animations=C,this.stateMachines=D}return p.prototype.add=function(o,d,w){if(w===void 0&&(w=!0),o=_t(o),o.length===0)this.animations.forEach(function(Ze){return Ze.playing=d}),this.stateMachines.forEach(function(Ze){return Ze.playing=d});else for(var C=this.animations.map(function(Ze){return Ze.name}),D=this.stateMachines.map(function(Ze){return Ze.name}),V=0;V<o.length;V++){var he=C.indexOf(o[V]),_e=D.indexOf(o[V]);if(he>=0||_e>=0)he>=0?this.animations[he].playing=d:this.stateMachines[_e].playing=d;else{var oe=this.artboard.animationByName(o[V]);if(oe){var je=new v.Animation(oe,this.artboard,this.runtime,d);je.advance(0),je.apply(1),this.animations.push(je)}else{var qe=this.artboard.stateMachineByName(o[V]);if(qe){var ut=new J(qe,this.runtime,d,this.artboard);this.stateMachines.push(ut)}}}}return w&&(d?this.eventManager.fire({type:Y.Play,data:this.playing}):this.eventManager.fire({type:Y.Pause,data:this.paused})),d?this.playing:this.paused},p.prototype.initLinearAnimations=function(o,d){for(var w=this.animations.map(function(_e){return _e.name}),C=0;C<o.length;C++){var D=w.indexOf(o[C]);if(D>=0)this.animations[D].playing=d;else{var V=this.artboard.animationByName(o[C]);if(V){var he=new v.Animation(V,this.artboard,this.runtime,d);he.advance(0),he.apply(1),this.animations.push(he)}else console.error("Animation with name ".concat(o[C]," not found."))}}},p.prototype.initStateMachines=function(o,d){for(var w=this.stateMachines.map(function(_e){return _e.name}),C=0;C<o.length;C++){var D=w.indexOf(o[C]);if(D>=0)this.stateMachines[D].playing=d;else{var V=this.artboard.stateMachineByName(o[C]);if(V){var he=new J(V,this.runtime,d,this.artboard);this.stateMachines.push(he),d||he.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[C]," not found.")),this.initLinearAnimations([o[C]],d)}}},p.prototype.play=function(o){return this.add(o,!0)},p.prototype.pause=function(o){return this.add(o,!1)},p.prototype.scrub=function(o,d){var w=this.animations.filter(function(C){return o.includes(C.name)});return w.forEach(function(C){return C.scrubTo=d}),w.map(function(C){return C.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(o){var d=this;o=_t(o);var w=[];if(o.length===0)w=this.animations.map(function(V){return V.name}).concat(this.stateMachines.map(function(V){return V.name})),this.animations.forEach(function(V){return V.cleanup()}),this.stateMachines.forEach(function(V){return V.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var C=this.animations.filter(function(V){return o.includes(V.name)});C.forEach(function(V){V.cleanup(),d.animations.splice(d.animations.indexOf(V),1)});var D=this.stateMachines.filter(function(V){return o.includes(V.name)});D.forEach(function(V){V.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(V),1)}),w=C.map(function(V){return V.name}).concat(D.map(function(V){return V.name}))}return this.eventManager.fire({type:Y.Stop,data:w}),w},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,d)),w},p.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(C){return C.playing});o<d.length;o++){var w=d[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:Y.Loop,data:{animation:w.name,type:X.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:Y.Loop,data:{animation:w.name,type:X.PingPong}}),w.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var o=[],d=0,w=this.stateMachines.filter(function(D){return D.playing});d<w.length;d++){var C=w[d];o.push.apply(o,C.statesChanged)}o.length>0&&this.eventManager.fire({type:Y.StateChange,data:o})},p.prototype.handleAdvancing=function(o){this.eventManager.fire({type:Y.Advance,data:o})},p})(),Y;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(Y||(Y={}));var X;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(X||(X={}));var ve=(function(){function p(o){o===void 0&&(o=[]),this.listeners=o}return p.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},p.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},p.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var w=this.listeners[d];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(d,1);break}}},p.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return d.remove(w)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(w){return w.callback(o)})},p})(),Ae=(function(){function p(o){this.eventManager=o,this.queue=[]}return p.prototype.add=function(o){this.queue.push(o)},p.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},p})(),ce;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(ce||(ce={}));var Ke=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=ce.UNAVAILABLE,d}return o.prototype.delay=function(d){return E(this,void 0,void 0,function(){return g(this,function(w){return[2,new Promise(function(C){return setTimeout(C,d)})]})})},o.prototype.timeout=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return[2,new Promise(function(w,C){return setTimeout(C,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:Y.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return this._enabled||(this._enabled=!0,this._status=ce.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!(this._status===ce.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==ce.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,w=function(){return E(d,void 0,void 0,function(){return g(this,function(C){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===ce.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(ve),ye=new Ke,we=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),Ie=globalThis.ResizeObserver||we,pe=(function(){function p(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var w=o._elementsMap.get(d.target);w!==null?w.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new Ie(this._onObserved)}return p.prototype.add=function(o,d){var w={onResize:d,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},p.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},p})(),ke=new pe,Ye=(function(){function p(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new ve,o.onLoad&&this.on(Y.Load,o.onLoad),o.onLoadError&&this.on(Y.LoadError,o.onLoadError)}return p.prototype.initData=function(){return E(this,void 0,void 0,function(){var o,d,w,C,D;return g(this,function(V){switch(V.label){case 0:return this.src?(o=this,[4,cr(this.src)]):[3,2];case 1:o.buffer=V.sent(),V.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=w.assetLoader),C=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return C.file=V.sent(),this.destroyed?((D=this.file)===null||D===void 0||D.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Y.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return E(this,void 0,void 0,function(){var o,d;return g(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,z.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return d=w.sent(),this.fireLoadError(d instanceof Error?d.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:Y.LoadError,data:o}),new Error(o)},p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new ie(d):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),me=(function(){function p(o){var d=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(C){var D=d._hasZeroSize!==C;d._hasZeroSize=C,C?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():D&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=ke.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new N,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new ve,o.onLoad&&this.on(Y.Load,o.onLoad),o.onLoadError&&this.on(Y.LoadError,o.onLoadError),o.onPlay&&this.on(Y.Play,o.onPlay),o.onPause&&this.on(Y.Pause,o.onPause),o.onStop&&this.on(Y.Stop,o.onStop),o.onLoop&&this.on(Y.Loop,o.onLoop),o.onStateChange&&this.on(Y.StateChange,o.onStateChange),o.onAdvance&&this.on(Y.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(Y.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(Y.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(Y.Play,o.onplay),o.onpause&&!o.onPause&&this.on(Y.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(Y.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(Y.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(Y.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Ae(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(o)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(o){var d=this,w=o.src,C=o.buffer,D=o.riveFile,V=o.animations,he=o.stateMachines,_e=o.artboard,oe=o.autoplay,je=oe===void 0?!1:oe,qe=o.useOffscreenRenderer,ut=qe===void 0?!1:qe,Ze=o.autoBind,Wt=Ze===void 0?!1:Ze;if(!this.destroyed){if(this.src=w,this.buffer=C,this.riveFile=D,!this.src&&!this.buffer&&!this.riveFile)throw new $(p.missingErrorMessage);var $t=_t(V),Et=_t(he);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(mt){d.destroyed||(d.runtime=mt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,ut),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(_e,$t,Et,je,Wt).then(function(De){if(De)return d.setupRiveListeners()}).catch(function(De){console.error(De)}))}).catch(function(mt){console.error(mt)})}},p.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(D){return D.playing&&d.runtime.hasListeners(D.instance)}).map(function(D){return D.instance}),C=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(C=o.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:C,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var o=this,d;ye.status==ce.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Y.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},ye.add(this._audioEventListener),ye.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(o,d,w,C,D){return E(this,void 0,void 0,function(){var V,he,_e,oe;return g(this,function(je){switch(je.label){case 0:return je.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(V=new Ye({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=V,[4,V.init()]);case 1:if(je.sent(),this.destroyed)return V.destroyIfUnused(),[2,!1];je.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,w,C,D),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Y.Load,data:(oe=this.src)!==null&&oe!==void 0?oe:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return he=je.sent(),_e=R(he),console.warn(_e),this.eventManager.fire({type:Y.LoadError,data:_e}),[2,Promise.reject(_e)];case 4:return[2]}})})},p.prototype.initArtboard=function(o,d,w,C,D){if(this.file){var V=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!V){var he="Invalid artboard name or no default artboard";console.warn(he),this.eventManager.fire({type:Y.LoadError,data:he});return}if(this.artboard=V,V.volume=this._volume*ye.systemVolume,this.artboard.animationCount()<1){var he="Artboard has no animations";throw this.eventManager.fire({type:Y.LoadError,data:he}),he}this.animator=new ne(this.runtime,this.artboard,this.eventManager);var _e;if(d.length>0||w.length>0?(_e=d.concat(w),this.animator.initLinearAnimations(d,C),this.animator.initStateMachines(w,C)):_e=[this.animator.atLeastOne(C,!1)],this.taskQueue.add({event:{type:C?Y.Play:Y.Pause,data:_e}}),D){var oe=this.file.defaultArtboardViewModel(V);if(oe!==null){var je=oe.defaultInstance();if(je!==null){var qe=new de(je,null);this.bindViewModelInstance(qe)}}}}},p.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(o,d){var w;this.frameRequestId=null;var C=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var D=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var V=this.animator.animations.filter(function(dr){return dr.playing||dr.needsScrub}).sort(function(dr){return dr.needsScrub?-1:1}),he=0,_e=V;he<_e.length;he++){var oe=_e[he];oe.advance(D),oe.instance.didLoop&&(oe.loopCount+=1),oe.apply(1)}for(var je=this.animator.stateMachines.filter(function(dr){return dr.playing}),qe=0,ut=je;qe<ut.length;qe++){var Ze=ut[qe],Wt=Ze.reportedEventCount();if(Wt)for(var $t=0;$t<Wt;$t++){var Et=Ze.reportedEventAt($t);if(Et)if(Et.type===L.OpenUrl){if(this.eventManager.fire({type:Y.RiveEvent,data:Et}),this.automaticallyHandleEvents){var mt=document.createElement("a"),De=Et,ft=De.url,ot=De.target,Ct=(0,m.sanitizeUrl)(ft);ft&&mt.setAttribute("href",Ct),ot&&mt.setAttribute("target",ot),Ct&&Ct!==m.BLANK_URL&&mt.click()}}else this.eventManager.fire({type:Y.RiveEvent,data:Et})}Ze.advanceAndApply(D)}this.animator.stateMachines.length==0&&this.artboard.advance(D);var fe=this.renderer;fe.clear(),fe.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(fe),fe.restore(),fe.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(D),this.frameCount++;var He=performance.now();for(this.frameTimes.push(He),this.durations.push(He-C);this.frameTimes[0]<=He-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var o=this,d=o.renderer,w=o.runtime,C=o._layout,D=o.artboard;d.align(C.runtimeFit(w),C.runtimeAlignment(w),{minX:C.minX,minY:C.minY,maxX:C.maxX,maxY:C.maxY},D.bounds,this._devicePixelRatioUsed*C.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ke.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ye.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},p.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},p.prototype.setTextRunValue=function(o,d){var w=this.retrieveTextRun(o);w&&(w.text=d)},p.prototype.play=function(o,d){var w=this;if(o=_t(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(o){var d=this;if(o=_t(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},p.prototype.scrub=function(o,d){var w=this;if(o=_t(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},p.prototype.stop=function(o){var d=this;if(o=_t(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(o){var d,w,C=o?.artboard,D=_t(o?.animations),V=_t(o?.stateMachines),he=(d=o?.autoplay)!==null&&d!==void 0?d:!1,_e=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(C,D,V,he,_e),this.taskQueue.process()},p.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),w=d.width,C=d.height,D=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=D,this.canvas.width=D*w,this.canvas.height=D*C,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===U.Layout){var V=this._layout.layoutScaleFactor;this.artboard.width=w/V,this.artboard.height=C/V}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(w){return w.name===o});return d?.inputs}},p.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,d);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},p.prototype.setBooleanStateAtPath=function(o,d,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===Z.Boolean?C.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(o,d,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===Z.Number?C.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},p.prototype.fireStateAtPath=function(o,d){var w=this.retrieveInputAtPath(o,d);w&&(w.type===Z.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,d);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},p.prototype.getTextRunValueAtPath=function(o,d){var w=this.retrieveTextAtPath(o,d);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w.text},p.prototype.setTextRunValueAtPath=function(o,d,w){var C=this.retrieveTextAtPath(o,w);if(!C){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}C.text=d},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var w=this.file.artboardByIndex(d),C={name:w.name,animations:[],stateMachines:[]},D=0;D<w.animationCount();D++){var V=w.animationByIndex(D);C.animations.push(V.name)}for(var he=0;he<w.stateMachineCount();he++){for(var _e=w.stateMachineByIndex(he),oe=_e.name,je=new this.runtime.StateMachineInstance(_e,w),qe=[],ut=0;ut<je.inputCount();ut++){var Ze=je.input(ut);qe.push({name:Ze.name,type:Ze.type})}C.stateMachines.push({name:oe,inputs:qe})}o.artboards.push(C)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*ye.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Ee(d):null},p.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Ee(d):null},p.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new ge(d)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Ee(o)}return null},p.prototype.getArtboard=function(o){var d,w;return(w=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&w!==void 0?w:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),Ee=(function(){function p(o){this._viewModel=o}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new de(d,null):null},p.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new de(d,null):null},p.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new de(o,null):null},p.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new de(o,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),ge=(function(){function p(o){this._dataEnum=o}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),le;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(le||(le={}));var de=(function(){function p(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},p.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},p.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var w=this._parents[d];w.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},p.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},p.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},p.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},p.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},p.prototype.propertyFromPath=function(o,d){var w=o.split("/");return this.propertyFromPathSegments(w,0,d)},p.prototype.viewModelFromPathSegments=function(o,d){var w=this.internalViewModelInstance(o[d]);return w!==null?d==o.length-1?w:w.viewModelFromPathSegments(o,d++):null},p.prototype.propertyFromPathSegments=function(o,d,w){var C,D,V,he,_e,oe,je,qe,ut,Ze,Wt,$t,Et,mt,De,ft,ot,Ct;if(d<o.length-1){var fe=this.internalViewModelInstance(o[d]);return fe!==null?fe.propertyFromPathSegments(o,d+1,w):null}var He=null;switch(w){case le.Number:if(He=(D=(C=this._runtimeInstance)===null||C===void 0?void 0:C.number(o[d]))!==null&&D!==void 0?D:null,He!==null)return new It(He,this);break;case le.String:if(He=(he=(V=this._runtimeInstance)===null||V===void 0?void 0:V.string(o[d]))!==null&&he!==void 0?he:null,He!==null)return new Ge(He,this);break;case le.Boolean:if(He=(oe=(_e=this._runtimeInstance)===null||_e===void 0?void 0:_e.boolean(o[d]))!==null&&oe!==void 0?oe:null,He!==null)return new ht(He,this);break;case le.Color:if(He=(qe=(je=this._runtimeInstance)===null||je===void 0?void 0:je.color(o[d]))!==null&&qe!==void 0?qe:null,He!==null)return new Kt(He,this);break;case le.Trigger:if(He=(Ze=(ut=this._runtimeInstance)===null||ut===void 0?void 0:ut.trigger(o[d]))!==null&&Ze!==void 0?Ze:null,He!==null)return new Bt(He,this);break;case le.Enum:if(He=($t=(Wt=this._runtimeInstance)===null||Wt===void 0?void 0:Wt.enum(o[d]))!==null&&$t!==void 0?$t:null,He!==null)return new gt(He,this);break;case le.List:if(He=(mt=(Et=this._runtimeInstance)===null||Et===void 0?void 0:Et.list(o[d]))!==null&&mt!==void 0?mt:null,He!==null)return new jt(He,this);break;case le.Image:if(He=(ft=(De=this._runtimeInstance)===null||De===void 0?void 0:De.image(o[d]))!==null&&ft!==void 0?ft:null,He!==null)return new lt(He,this);break;case le.Artboard:if(He=(Ct=(ot=this._runtimeInstance)===null||ot===void 0?void 0:ot.artboard(o[d]))!==null&&Ct!==void 0?Ct:null,He!==null)return new st(He,this);break}return null},p.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(w!==null){var C=new p(w,this);return C.internalIncrementReferenceCount(),this._viewModelInstances.set(o,C),C}return null},p.prototype.number=function(o){var d=this.propertyFromPath(o,le.Number);return d},p.prototype.string=function(o){var d=this.propertyFromPath(o,le.String);return d},p.prototype.boolean=function(o){var d=this.propertyFromPath(o,le.Boolean);return d},p.prototype.color=function(o){var d=this.propertyFromPath(o,le.Color);return d},p.prototype.trigger=function(o){var d=this.propertyFromPath(o,le.Trigger);return d},p.prototype.enum=function(o){var d=this.propertyFromPath(o,le.Enum);return d},p.prototype.list=function(o){var d=this.propertyFromPath(o,le.List);return d},p.prototype.image=function(o){var d=this.propertyFromPath(o,le.Image);return d},p.prototype.artboard=function(o){var d=this.propertyFromPath(o,le.Artboard);return d},p.prototype.viewModel=function(o){var d=o.split("/"),w=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return w!=null?w.internalViewModelInstance(d[d.length-1]):null},p.prototype.internalReplaceViewModel=function(o,d){var w;if(d.runtimeInstance!==null){var C=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,d.runtimeInstance))||!1;if(C){d.internalIncrementReferenceCount();var D=this.internalViewModelInstance(o);D!==null&&(D.removeParent(this),this._children.includes(D)&&(this._children=this._children.filter(function(V){return V!==D})),D.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return C}return!1},p.prototype.replaceViewModel=function(o,d){var w,C=o.split("/"),D=C.length>1?this.viewModelFromPathSegments(C.slice(0,C.length-1),0):this;return(w=D?.internalReplaceViewModel(C[C.length-1],d))!==null&&w!==void 0?w:!1},p.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return k({},d)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(C){C.cleanup()}),this._viewModelInstances.clear();var d=S([],this._children,!0);this._children.length=0;var w=S([],this._parents,!0);this._parents.length=0,d.forEach(function(C){C.removeParent(o)}),w.forEach(function(C){C.removeFromViewModelCallbacks(o)})}},p})(),Oe=(function(){function p(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return p.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(o){},p.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),Ge=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Oe),It=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Oe),ht=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Oe),Bt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(Oe),gt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Oe),jt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,w){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,w)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var w=this._viewModelInstanceValue.instanceAt(d);if(w!=null){var C=new de(w,this._parentViewModel);return C}return null},o.prototype.swap=function(d,w){this._viewModelInstanceValue.swap(d,w)},o.prototype.internalHandleCallback=function(d){d()},o})(Oe),Kt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,w,C){this._viewModelInstanceValue.rgb(d,w,C)},o.prototype.rgba=function(d,w,C,D){this._viewModelInstanceValue.argb(D,d,w,C)},o.prototype.argb=function(d,w,C,D){this._viewModelInstanceValue.argb(d,w,C,D)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Oe),lt=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Oe),st=(function(p){_(o,p);function o(d,w){return p.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Oe),cr=function(p){return E(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(C){switch(C.label){case 0:return o=new Request(p),[4,fetch(o)];case 1:return d=C.sent(),[4,d.arrayBuffer()];case 2:return w=C.sent(),[2,w]}})})},_t=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},Lr={EventManager:ve,TaskQueueManager:Ae},it=function(p){return E(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(D){return z.getInstance(function(V){V.decodeAudio(p,D)})}),[4,o];case 1:return d=C.sent(),w=new m.AudioWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},Ot=function(p){return E(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(D){return z.getInstance(function(V){V.decodeImage(p,D)})}),[4,o];case 1:return d=C.sent(),w=new m.ImageWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},xt=function(p){return E(void 0,void 0,void 0,function(){var o,d,w;return g(this,function(C){switch(C.label){case 0:return o=new Promise(function(D){return z.getInstance(function(V){V.decodeFont(p,D)})}),[4,o];case 1:return d=C.sent(),w=new m.FontWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})}})(),l})())})(es)),es.exports}var Ev=kv();const Na="dracula",Sv="dracula_story.json",ds="https://vycjpmuyscfygstjjied.supabase.co";var Av=ue('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function kl(r,e){tr(e,!0);let t=Ma(e,"bucketName",3,Na),n=Ft(void 0);bs(()=>{if(!x(n))return;const c=new Ev.Rive({src:`${ds}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:x(n),autoplay:!0,stateMachines:"SM1"});return()=>{c.cleanup()}});var s=Av(),l=F(s);bd(l,c=>Dt(n,c),()=>x(n)),ee(r,s),rr()}function Iv(r,e){x(e)?.nextDialogueId&&Ut.goToDialogue(x(e).nextDialogueId)}var Cv=ue('<img alt="BG" class="background-image svelte-ik8jti"/>'),Tv=ue('<div class="background-media svelte-ik8jti"><!></div>'),Pv=ue('<img alt="Char" class="character-image svelte-ik8jti"/>'),Rv=ue('<div class="character-media svelte-ik8jti"><!></div>'),jv=(r,e,t)=>e(x(t)),Ov=ue('<button class="option-button svelte-ik8jti"> </button>'),xv=ue('<div class="options-container svelte-ik8jti"></div>'),Mv=ue('<div class="next-container svelte-ik8jti"><button class="next-button svelte-ik8jti">Далее...</button></div>'),Lv=ue('<div class="dialogue-container svelte-ik8jti"><!> <!> <div class="dialogue-content svelte-ik8jti"><div class="dialogue-text svelte-ik8jti"> </div> <!></div></div>'),Dv=ue("<p> </p>");function Au(r,e){tr(e,!0);let t=Ma(e,"bucketName",3,Na);const n=Uc(()=>e.dialogue||Ut.findDialogue(Ut.currentDialogueId));gi(()=>{x(n)?.onEnter&&Ut.runActions(x(n).onEnter)});function s(_){if(_.actions&&Ut.runActions(_.actions),_.miniGame){console.log("Запуск мини-игры:",_.miniGame.id),Ut.goToDialogue(_.miniGame.onWinDialogueId);return}_.nextDialogueId&&Ut.goToDialogue(_.nextDialogueId)}function l(_){return _.visibleIf&&_.visibleIf.hasItem?Ut.hasItem(_.visibleIf.hasItem):!0}var c=wr(),h=zt(c);{var v=_=>{var k=Lv(),E=F(k);{var g=O=>{var L=Tv(),ie=F(L);{var J=Y=>{var X=wr(),ve=zt(X);qo(ve,()=>x(n).backgroundImage,Ae=>{kl(Ae,{get fileName(){return x(n).backgroundImage},get bucketName(){return t()}})}),ee(Y,X)},ne=Y=>{var X=Cv();Re(()=>Le(X,"src",`${ds}/storage/v1/object/public/${t()}/${x(n).backgroundImage}`)),ee(Y,X)};Ne(ie,Y=>{x(n).backgroundImage.endsWith(".riv")?Y(J):Y(ne,!1)})}ee(O,L)};Ne(E,O=>{x(n).backgroundImage&&O(g)})}var S=W(E,2);{var $=O=>{var L=Rv(),ie=F(L);{var J=Y=>{var X=wr(),ve=zt(X);qo(ve,()=>x(n).characterImage,Ae=>{kl(Ae,{get fileName(){return x(n).characterImage},get bucketName(){return t()}})}),ee(Y,X)},ne=Y=>{var X=Pv();Re(()=>Le(X,"src",`${ds}/storage/v1/object/public/${t()}/${x(n).characterImage}`)),ee(Y,X)};Ne(ie,Y=>{x(n).characterImage.endsWith(".riv")?Y(J):Y(ne,!1)})}ee(O,L)};Ne(S,O=>{x(n).characterImage&&O($)})}var R=W(S,2),U=F(R),B=F(U),N=W(U,2);{var z=O=>{var L=xv();Pt(L,21,()=>x(n).options,ie=>ie.text,(ie,J)=>{var ne=wr(),Y=zt(ne);{var X=ve=>{var Ae=Ov();Ae.__click=[jv,s,J];var ce=F(Ae);Re(()=>Fe(ce,x(J).text)),ee(ve,Ae)};Ne(Y,ve=>{l(x(J))&&ve(X)})}ee(ie,ne)}),ee(O,L)},Z=O=>{var L=wr(),ie=zt(L);{var J=ne=>{var Y=Mv(),X=F(Y);X.__click=[Iv,n],ee(ne,Y)};Ne(ie,ne=>{x(n).nextDialogueId&&ne(J)},!0)}ee(O,L)};Ne(N,O=>{x(n).options&&x(n).options.length>0?O(z):O(Z,!1)})}Re(()=>Fe(B,x(n).text)),ee(_,k)},m=_=>{var k=Dv(),E=F(k);Re(()=>Fe(E,`Диалог не найден (ID: ${Ut.currentDialogueId??""})`)),ee(_,k)};Ne(h,_=>{x(n)?_(v):_(m,!1)})}ee(r,c),rr()}Er(["click"]);var Zs=Jn(()=>P),$v=ue('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Fv=ue('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Uv=ue('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Nv=ue('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),Bv=ue('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),Wv=ue('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Vv=ue('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function qv(r,e){tr(e,!1);function t(){Zs(Zs().editingOptionIndex=null)}mn();var n=Vv(),s=F(n),l=W(F(s),2);l.__click=t;var c=W(s,2),h=F(c);{var v=_=>{var k=Bv(),E=F(k);{let X=gs(()=>Zs().selectedBucket||void 0);Au(E,{get dialogue(){return At.currentDialogue},index:0,get bucketName(){return x(X)}})}var g=W(E,2),S=F(g),$=W(F(S),2),R=F($),U=W(S,2),B=W(F(U),2),N=F(B),z=W(U,2);{var Z=X=>{var ve=$v(),Ae=W(F(ve),2),ce=F(Ae);Re(()=>Fe(ce,At.currentDialogue.backgroundImage)),ee(X,ve)};Ne(z,X=>{At.currentDialogue.backgroundImage&&X(Z)})}var O=W(z,2);{var L=X=>{var ve=Fv(),Ae=W(F(ve),2),ce=F(Ae);Re(()=>Fe(ce,At.currentDialogue.characterImage)),ee(X,ve)};Ne(O,X=>{At.currentDialogue.characterImage&&X(L)})}var ie=W(g,2);{var J=X=>{var ve=Uv();ee(X,ve)};Ne(ie,X=>{(!At.currentDialogue.options||At.currentDialogue.options.length===0)&&X(J)})}var ne=W(ie,2);{var Y=X=>{var ve=Nv();ee(X,ve)};Ne(ne,X=>{At.currentDialogue.options?.some(ve=>!ve.nextDialogueId)&&X(Y)})}Re(()=>{Fe(R,At.currentDialogue.id),Fe(N,At.currentChapter?.title||"Без главы")}),ee(_,k)},m=_=>{var k=Wv();ee(_,k)};Ne(h,_=>{At.currentDialogue?_(v):_(m,!1)})}ee(r,n),rr()}Er(["click"]);const Hv=["dracula","zombie","fairy_tale"];function Iu(){const r=Hv.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return rt.updateBucketsList(r),r}var nn=Jn(()=>P),zv=ue('<span class="selected-badge svelte-1enye7i">Выбрано</span>'),Gv=(r,e,t)=>e(x(t).name),Kv=ue('<button class="btn small svelte-1enye7i">Выбрать</button>'),Yv=ue('<div><div class="bucket-info svelte-1enye7i"><div class="bucket-name svelte-1enye7i"> </div> <div class="bucket-meta svelte-1enye7i">📖 Интерактивная история</div></div> <div class="bucket-actions svelte-1enye7i"><!></div></div>'),Jv=ue('<div class="story-selector svelte-1enye7i"><div class="selector-header svelte-1enye7i"><h2 class="svelte-1enye7i">Выберите историю</h2></div> <div class="buckets-list svelte-1enye7i"></div></div>');function Xv(r,e){tr(e,!1),bs(()=>{t()});function t(){Iu()}async function n(c){nn(nn().selectedBucket=c),nn(nn().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await zr.loadStoriesList(),await zr.loadStoredResources()}mn();var s=Jv(),l=W(F(s),2);Pt(l,5,()=>nn().availableBuckets,Qt,(c,h)=>{var v=Yv();let m;var _=F(v),k=F(_),E=F(k),g=W(_,2),S=F(g);{var $=U=>{var B=zv();ee(U,B)},R=U=>{var B=Kv();B.__click=[Gv,n,h],ee(U,B)};Ne(S,U=>{nn().selectedBucket===x(h).name?U($):U(R,!1)})}Re(U=>{m=qr(v,1,"bucket-card svelte-1enye7i",null,m,U),Fe(E,x(h).name)},[()=>({selected:nn().selectedBucket===x(h).name})]),ee(c,v)}),ee(r,s),rr()}Er(["click"]);var Qv=ue("<span> </span>"),Zv=ue('<div class="debug-info svelte-1k4krym"><small> </small></div>'),ep=ue('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),tp=ue('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),rp=ue('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function np(r,e){tr(e,!0),bs(async()=>{Iu(),P.availableBuckets.length>0&&!P.selectedBucket&&(P.selectedBucket=P.availableBuckets[0].name)}),gi(async()=>{if(P.selectedBucket){console.log(`[Editor] Bucket выбран: ${P.selectedBucket}`),await zr.loadStoredResources();const c=`${P.selectedBucket}_story.json`;P.currentFileName=c,await un.loadStory(c)}});var t=wr(),n=zt(t);{var s=c=>{Xv(c,{})},l=c=>{var h=rp(),v=F(h),m=F(v),_=F(m);_.__click=()=>P.selectedBucket=null;var k=W(_,2),E=F(k),g=W(m,2),S=F(g),$=F(S),R=W(S,2);{var U=ce=>{var Ke=Qv(),ye=F(Ke);Re(()=>{qr(Ke,1,`status-message ${P.statusMessage.type??""}`,"svelte-1k4krym"),Fe(ye,P.statusMessage.text)}),ee(ce,Ke)};Ne(R,ce=>{P.statusMessage.text&&ce(U)})}var B=W(R,2);B.__click=function(...ce){un.saveCurrentStory?.apply(this,ce)};var N=W(B,2);N.__click=function(...ce){un.saveStoryCopy?.apply(this,ce)};var z=W(v,2),Z=F(z);Ff(Z,{});var O=W(Z,2),L=F(O);{var ie=ce=>{var Ke=Zv(),ye=F(Ke),we=F(ye);Re(()=>Fe(we,`Загружено: ${P.data.meta?.title??""} |
              Глав: ${(P.data.chapters?.length||0)??""} |
              Диалогов: ${(P.data.dialogues?.length||0)??""} |
              Предметов: ${(P.data.items?.length||0)??""}`)),ee(ce,Ke)},J=ce=>{var Ke=ep();ee(ce,Ke)};Ne(L,ce=>{P.data?ce(ie):ce(J,!1)})}var ne=W(L,2);yv(ne,{});var Y=W(ne,2);{var X=ce=>{ov(ce,{get editor(){return P},get storyActions(){return un},get resourceActions(){return zr}})},ve=ce=>{var Ke=tp();ee(ce,Ke)};Ne(Y,ce=>{At.currentDialogue?ce(X):ce(ve,!1)})}var Ae=W(O,2);qv(Ae,{}),Re(()=>{Fe(E,`Story Editor v3.1 - ${P.selectedBucket??""}`),Fe($,P.currentFileName||"Нет файла")}),ee(c,h)};Ne(n,c=>{P.selectedBucket?c(l,!1):c(s)})}ee(r,t),rr()}Er(["click"]);var ip=ue('<div class="loading svelte-fgmugb"><p>🔄 Загрузка истории...</p></div>'),sp=ue('<div class="error svelte-fgmugb"> </div>'),ap=ue('<div class="dialogues-container svelte-fgmugb"><!></div>'),op=ue('<div class="app svelte-fgmugb"><!></div>');function lp(r,e){tr(e,!1);let t=`${ds}/storage/v1/object/public/${Na}/${Sv}`;bs(async()=>{console.log("Загружаем историю из:",t),await Ut.loadStory(t)}),mn();var n=op(),s=F(n);{var l=h=>{var v=ip();ee(h,v)},c=h=>{var v=wr(),m=zt(v);{var _=E=>{var g=sp(),S=F(g);Re(()=>Fe(S,`⚠️ ${Ut.error??""}`)),ee(E,g)},k=E=>{var g=ap(),S=F(g);{var $=R=>{Au(R,{})};Ne(S,R=>{Ut.storyData&&R($)})}ee(E,g)};Ne(m,E=>{Ut.error?E(_):E(k,!1)},!0)}ee(h,v)};Ne(s,h=>{Ut.isLoading?h(l):h(c,!1)})}ee(r,n),rr()}var up=ue('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),cp=ue('<button style="position:fixed; bottom:10px; right:10px; z-index:9999;">Редактор</button> <!>',1);function dp(r,e){tr(e,!1),mn();var t=wr(),n=zt(t);{var s=c=>{var h=up(),v=zt(h);v.__click=function(..._){rt.toggleEditor?.apply(this,_)};var m=W(v,2);np(m,{}),ee(c,h)},l=c=>{var h=cp(),v=zt(h);v.__click=function(..._){rt.toggleEditor?.apply(this,_)};var m=W(v,2);lp(m,{}),ee(c,h)};Ne(n,c=>{P.showEditor?c(s):c(l,!1)})}ee(r,t),rr()}Er(["click"]);hd(dp,{target:document.getElementById("app")});
