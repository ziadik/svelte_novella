(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const DEV=!1;var is_array=Array.isArray,index_of=Array.prototype.indexOf,array_from=Array.from,define_property=Object.defineProperty,get_descriptor=Object.getOwnPropertyDescriptor,get_descriptors=Object.getOwnPropertyDescriptors,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf,is_extensible=Object.isExtensible;const noop$2=()=>{};function run(r){return r()}function run_all(r){for(var e=0;e<r.length;e++)r[e]()}function deferred(){var r,e,t=new Promise((i,n)=>{r=i,e=n});return{promise:t,resolve:r,reject:e}}const DERIVED=2,EFFECT=4,RENDER_EFFECT=8,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,UNOWNED=256,DISCONNECTED=512,CLEAN=1024,DIRTY=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EFFECT_TRANSPARENT=65536,INSPECT_EFFECT=1<<17,HEAD_EFFECT=1<<18,EFFECT_PRESERVED=1<<19,USER_EFFECT=1<<20,REACTION_IS_UPDATING=1<<21,ASYNC=1<<22,ERROR_VALUE=1<<23,STATE_SYMBOL=Symbol("$state"),LEGACY_PROPS=Symbol("legacy props"),LOADING_ATTR_SYMBOL=Symbol(""),STALE_REACTION=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function await_outside_boundary(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function lifecycle_outside_component(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function async_derived_orphan(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function effect_in_teardown(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function effect_in_unowned_derived(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function effect_orphan(r){throw new Error("https://svelte.dev/e/effect_orphan")}function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function props_invalid_value(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const EACH_ITEM_REACTIVE=1,EACH_INDEX_REACTIVE=2,EACH_IS_CONTROLLED=4,EACH_IS_ANIMATED=8,EACH_ITEM_IMMUTABLE=16,PROPS_IS_IMMUTABLE=1,PROPS_IS_RUNES=2,PROPS_IS_UPDATED=4,PROPS_IS_BINDABLE=8,PROPS_IS_LAZY_INITIAL=16,TEMPLATE_FRAGMENT=1,TEMPLATE_USE_IMPORT_NODE=2,UNINITIALIZED=Symbol(),NAMESPACE_HTML="http://www.w3.org/1999/xhtml";function select_multiple_invalid_value(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let hydrating=!1;function equals(r){return r===this.v}function safe_not_equal(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function not_equal(r,e){return r!==e}function safe_equals(r){return!safe_not_equal(r,this.v)}let legacy_mode_flag=!1,tracing_mode_flag=!1;function enable_legacy_mode_flag(){legacy_mode_flag=!0}let component_context=null;function set_component_context(r){component_context=r}function push(r,e=!1,t){component_context={p:component_context,c:null,e:null,s:r,x:null,l:legacy_mode_flag&&!e?{s:null,u:null,$:[]}:null}}function pop(r){var e=component_context,t=e.e;if(t!==null){e.e=null;for(var i of t)create_user_effect(i)}return component_context=e.p,{}}function is_runes(){return!legacy_mode_flag||component_context!==null&&component_context.l===null}const adjustments=new WeakMap;function handle_error(r){var e=active_effect;if(e===null)return active_reaction.f|=ERROR_VALUE,r;if((e.f&EFFECT_RAN)===0){if((e.f&BOUNDARY_EFFECT)===0)throw!e.parent&&r instanceof Error&&apply_adjustments(r),r;e.b.error(r)}else invoke_error_boundary(r,e)}function invoke_error_boundary(r,e){for(;e!==null;){if((e.f&BOUNDARY_EFFECT)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&apply_adjustments(r),r}function apply_adjustments(r){const e=adjustments.get(r);e&&(define_property(r,"message",{value:e.message}),define_property(r,"stack",{value:e.stack}))}let micro_tasks=[],idle_tasks=[];function run_micro_tasks(){var r=micro_tasks;micro_tasks=[],run_all(r)}function run_idle_tasks(){var r=idle_tasks;idle_tasks=[],run_all(r)}function queue_micro_task(r){micro_tasks.length===0&&queueMicrotask(run_micro_tasks),micro_tasks.push(r)}function flush_tasks(){micro_tasks.length>0&&run_micro_tasks(),idle_tasks.length>0&&run_idle_tasks()}function get_pending_boundary(){for(var r=active_effect.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&await_outside_boundary(),r}function derived(r){var e=DERIVED|DIRTY,t=active_reaction!==null&&(active_reaction.f&DERIVED)!==0?active_reaction:null;return active_effect===null||t!==null&&(t.f&UNOWNED)!==0?e|=UNOWNED:active_effect.f|=EFFECT_PRESERVED,{ctx:component_context,deps:null,effects:null,equals,f:e,fn:r,reactions:null,rv:0,v:UNINITIALIZED,wv:0,parent:t??active_effect,ac:null}}function async_derived(r,e){let t=active_effect;t===null&&async_derived_orphan();var i=t.b,n=void 0,o=source(UNINITIALIZED),u=null,h=!active_reaction;return async_effect(()=>{try{var _=r();u&&Promise.resolve(_).catch(()=>{})}catch(p){_=Promise.reject(p)}var v=()=>_;n=u?.then(v,v)??Promise.resolve(_),u=n;var g=current_batch,m=i.pending;h&&(i.update_pending_count(1),m||g.increment());const $=(p,E=void 0)=>{u=null,m||g.activate(),E?E!==STALE_REACTION&&(o.f|=ERROR_VALUE,internal_set(o,E)):((o.f&ERROR_VALUE)!==0&&(o.f^=ERROR_VALUE),internal_set(o,p)),h&&(i.update_pending_count(-1),m||g.decrement()),unset_context()};if(n.then($,p=>$(null,p||"unknown")),g)return()=>{queueMicrotask(()=>g.neuter())}}),new Promise(_=>{function v(g){function m(){g===n?_(o):v(n)}g.then(m,m)}v(n)})}function user_derived(r){const e=derived(r);return push_reaction_value(e),e}function derived_safe_equal(r){const e=derived(r);return e.equals=safe_equals,e}function destroy_derived_effects(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)destroy_effect(e[t])}}function get_derived_parent_effect(r){for(var e=r.parent;e!==null;){if((e.f&DERIVED)===0)return e;e=e.parent}return null}function execute_derived(r){var e,t=active_effect;set_active_effect(get_derived_parent_effect(r));try{destroy_derived_effects(r),e=update_reaction(r)}finally{set_active_effect(t)}return e}function update_derived(r){var e=execute_derived(r);if(r.equals(e)||(r.v=e,r.wv=increment_write_version()),!is_destroying_effect){var t=(skip_reaction||(r.f&UNOWNED)!==0)&&r.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(r,t)}}function flatten(r,e,t){const i=is_runes()?derived:derived_safe_equal;if(e.length===0){t(r.map(i));return}var n=current_batch,o=active_effect,u=capture(),h=get_pending_boundary();Promise.all(e.map(_=>async_derived(_))).then(_=>{n?.activate(),u();try{t([...r.map(i),..._])}catch(v){(o.f&DESTROYED)===0&&invoke_error_boundary(v,o)}n?.deactivate(),unset_context()}).catch(_=>{h.error(_)})}function capture(){var r=active_effect,e=active_reaction,t=component_context,i=current_batch;return function(){set_active_effect(r),set_active_reaction(e),set_component_context(t),i?.activate()}}function unset_context(){set_active_effect(null),set_active_reaction(null),set_component_context(null)}const batches=new Set;let current_batch=null,previous_batch=null,effect_pending_updates=new Set,tasks=[];function dequeue(){const r=tasks.shift();tasks.length>0&&queueMicrotask(dequeue),r()}let queued_root_effects=[],last_scheduled_effect=null,is_flushing=!1,is_flushing_sync=!1;class Batch{current=new Map;#s=new Map;#i=new Set;#e=0;#a=null;#o=!1;#t=[];#n=[];#r=[];#l=[];#c=[];#d=[];#f=[];skipped_effects=new Set;process(e){queued_root_effects=[],previous_batch=null;for(const n of e)this.#v(n);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#r,i=this.#l;this.#r=[],this.#l=[],this.#c=[],previous_batch=current_batch,current_batch=null,flush_queued_effects(t),flush_queued_effects(i),current_batch===null?current_batch=this:batches.delete(this),this.#a?.resolve()}else this.#u(this.#r),this.#u(this.#l),this.#u(this.#c);for(const n of this.#t)update_effect(n);for(const n of this.#n)update_effect(n);this.#t=[],this.#n=[]}#v(e){e.f^=CLEAN;for(var t=e.first;t!==null;){var i=t.f,n=(i&(BRANCH_EFFECT|ROOT_EFFECT))!==0,o=n&&(i&CLEAN)!==0,u=o||(i&INERT)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(n)t.f^=CLEAN;else if((i&EFFECT)!==0)this.#l.push(t);else if((i&CLEAN)===0)if((i&ASYNC)!==0){var h=t.b?.pending?this.#n:this.#t;h.push(t)}else is_dirty(t)&&((t.f&BLOCK_EFFECT)!==0&&this.#c.push(t),update_effect(t));var _=t.first;if(_!==null){t=_;continue}}var v=t.parent;for(t=t.next;t===null&&v!==null;)t=v.next,v=v.parent}}#u(e){for(const t of e)((t.f&DIRTY)!==0?this.#d:this.#f).push(t),set_signal_status(t,CLEAN);e.length=0}capture(e,t){this.#s.has(e)||this.#s.set(e,t),this.current.set(e,e.v)}activate(){current_batch=this}deactivate(){current_batch=null,previous_batch=null;for(const e of effect_pending_updates)if(effect_pending_updates.delete(e),e(),current_batch!==null)break}neuter(){this.#o=!0}flush(){queued_root_effects.length>0?flush_effects():this.#h(),current_batch===this&&(this.#e===0&&batches.delete(this),this.deactivate())}#h(){if(!this.#o)for(const e of this.#i)e();this.#i.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)set_signal_status(e,DIRTY),schedule_effect(e);for(const e of this.#f)set_signal_status(e,MAYBE_DIRTY),schedule_effect(e);this.#r=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#i.add(e)}settled(){return(this.#a??=deferred()).promise}static ensure(){if(current_batch===null){const e=current_batch=new Batch;batches.add(current_batch),is_flushing_sync||Batch.enqueue(()=>{current_batch===e&&e.flush()})}return current_batch}static enqueue(e){tasks.length===0&&queueMicrotask(dequeue),tasks.unshift(e)}}function flushSync(r){var e=is_flushing_sync;is_flushing_sync=!0;try{for(var t;;){if(flush_tasks(),queued_root_effects.length===0&&(current_batch?.flush(),queued_root_effects.length===0))return last_scheduled_effect=null,t;flush_effects()}}finally{is_flushing_sync=e}}function flush_effects(){var r=is_updating_effect;is_flushing=!0;try{var e=0;for(set_is_updating_effect(!0);queued_root_effects.length>0;){var t=Batch.ensure();if(e++>1e3){var i,n;infinite_loop_guard()}t.process(queued_root_effects),old_values.clear()}}finally{is_flushing=!1,set_is_updating_effect(r),last_scheduled_effect=null}}function infinite_loop_guard(){try{effect_update_depth_exceeded()}catch(r){invoke_error_boundary(r,last_scheduled_effect)}}let eager_block_effects=null;function flush_queued_effects(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var i=r[t++];if((i.f&(DESTROYED|INERT))===0&&is_dirty(i)&&(eager_block_effects=[],update_effect(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?unlink_effect(i):i.fn=null),eager_block_effects?.length>0)){old_values.clear();for(const n of eager_block_effects)update_effect(n);eager_block_effects=[]}}eager_block_effects=null}}function schedule_effect(r){for(var e=last_scheduled_effect=r;e.parent!==null;){e=e.parent;var t=e.f;if(is_flushing&&e===active_effect&&(t&BLOCK_EFFECT)!==0)return;if((t&(ROOT_EFFECT|BRANCH_EFFECT))!==0){if((t&CLEAN)===0)return;e.f^=CLEAN}}queued_root_effects.push(e)}const old_values=new Map;function source(r,e){var t={f:0,v:r,reactions:null,equals,rv:0,wv:0};return t}function state(r,e){const t=source(r);return push_reaction_value(t),t}function mutable_source(r,e=!1,t=!0){const i=source(r);return e||(i.equals=safe_equals),legacy_mode_flag&&t&&component_context!==null&&component_context.l!==null&&(component_context.l.s??=[]).push(i),i}function set(r,e,t=!1){active_reaction!==null&&(!untracking||(active_reaction.f&INSPECT_EFFECT)!==0)&&is_runes()&&(active_reaction.f&(DERIVED|BLOCK_EFFECT|ASYNC|INSPECT_EFFECT))!==0&&!current_sources?.includes(r)&&state_unsafe_mutation();let i=t?proxy(e):e;return internal_set(r,i)}function internal_set(r,e){if(!r.equals(e)){var t=r.v;is_destroying_effect?old_values.set(r,e):old_values.set(r,t),r.v=e;var i=Batch.ensure();i.capture(r,t),(r.f&DERIVED)!==0&&((r.f&DIRTY)!==0&&execute_derived(r),set_signal_status(r,(r.f&UNOWNED)===0?CLEAN:MAYBE_DIRTY)),r.wv=increment_write_version(),mark_reactions(r,DIRTY),is_runes()&&active_effect!==null&&(active_effect.f&CLEAN)!==0&&(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))===0&&(untracked_writes===null?set_untracked_writes([r]):untracked_writes.push(r))}return e}function update(r,e=1){var t=get$2(r),i=e===1?t++:t--;return set(r,t),i}function increment(r){set(r,r.v+1)}function mark_reactions(r,e){var t=r.reactions;if(t!==null)for(var i=is_runes(),n=t.length,o=0;o<n;o++){var u=t[o],h=u.f;if(!(!i&&u===active_effect)){var _=(h&DIRTY)===0;_&&set_signal_status(u,e),(h&DERIVED)!==0?mark_reactions(u,MAYBE_DIRTY):_&&((h&BLOCK_EFFECT)!==0&&eager_block_effects!==null&&eager_block_effects.push(u),schedule_effect(u))}}}function proxy(r){if(typeof r!="object"||r===null||STATE_SYMBOL in r)return r;const e=get_prototype_of(r);if(e!==object_prototype&&e!==array_prototype)return r;var t=new Map,i=is_array(r),n=state(0),o=update_version,u=h=>{if(update_version===o)return h();var _=active_reaction,v=update_version;set_active_reaction(null),set_update_version(o);var g=h();return set_active_reaction(_),set_update_version(v),g};return i&&t.set("length",state(r.length)),new Proxy(r,{defineProperty(h,_,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&state_descriptors_fixed();var g=t.get(_);return g===void 0?g=u(()=>{var m=state(v.value);return t.set(_,m),m}):set(g,v.value,!0),!0},deleteProperty(h,_){var v=t.get(_);if(v===void 0){if(_ in h){const g=u(()=>state(UNINITIALIZED));t.set(_,g),increment(n)}}else set(v,UNINITIALIZED),increment(n);return!0},get(h,_,v){if(_===STATE_SYMBOL)return r;var g=t.get(_),m=_ in h;if(g===void 0&&(!m||get_descriptor(h,_)?.writable)&&(g=u(()=>{var p=proxy(m?h[_]:UNINITIALIZED),E=state(p);return E}),t.set(_,g)),g!==void 0){var $=get$2(g);return $===UNINITIALIZED?void 0:$}return Reflect.get(h,_,v)},getOwnPropertyDescriptor(h,_){var v=Reflect.getOwnPropertyDescriptor(h,_);if(v&&"value"in v){var g=t.get(_);g&&(v.value=get$2(g))}else if(v===void 0){var m=t.get(_),$=m?.v;if(m!==void 0&&$!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:$,writable:!0}}return v},has(h,_){if(_===STATE_SYMBOL)return!0;var v=t.get(_),g=v!==void 0&&v.v!==UNINITIALIZED||Reflect.has(h,_);if(v!==void 0||active_effect!==null&&(!g||get_descriptor(h,_)?.writable)){v===void 0&&(v=u(()=>{var $=g?proxy(h[_]):UNINITIALIZED,p=state($);return p}),t.set(_,v));var m=get$2(v);if(m===UNINITIALIZED)return!1}return g},set(h,_,v,g){var m=t.get(_),$=_ in h;if(i&&_==="length")for(var p=v;p<m.v;p+=1){var E=t.get(p+"");E!==void 0?set(E,UNINITIALIZED):p in h&&(E=u(()=>state(UNINITIALIZED)),t.set(p+"",E))}if(m===void 0)(!$||get_descriptor(h,_)?.writable)&&(m=u(()=>state(void 0)),set(m,proxy(v)),t.set(_,m));else{$=m.v!==UNINITIALIZED;var T=u(()=>proxy(v));set(m,T)}var x=Reflect.getOwnPropertyDescriptor(h,_);if(x?.set&&x.set.call(g,v),!$){if(i&&typeof _=="string"){var D=t.get("length"),R=Number(_);Number.isInteger(R)&&R>=D.v&&set(D,R+1)}increment(n)}return!0},ownKeys(h){get$2(n);var _=Reflect.ownKeys(h).filter(m=>{var $=t.get(m);return $===void 0||$.v!==UNINITIALIZED});for(var[v,g]of t)g.v!==UNINITIALIZED&&!(v in h)&&_.push(v);return _},setPrototypeOf(){state_prototype_fixed()}})}function get_proxied_value(r){try{if(r!==null&&typeof r=="object"&&STATE_SYMBOL in r)return r[STATE_SYMBOL]}catch{}return r}function is(r,e){return Object.is(get_proxied_value(r),get_proxied_value(e))}var $window,is_firefox,first_child_getter,next_sibling_getter;function init_operations(){if($window===void 0){$window=window,is_firefox=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;first_child_getter=get_descriptor(e,"firstChild").get,next_sibling_getter=get_descriptor(e,"nextSibling").get,is_extensible(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),is_extensible(t)&&(t.__t=void 0)}}function create_text(r=""){return document.createTextNode(r)}function get_first_child(r){return first_child_getter.call(r)}function get_next_sibling(r){return next_sibling_getter.call(r)}function child(r,e){return get_first_child(r)}function first_child(r,e){{var t=get_first_child(r);return t instanceof Comment&&t.data===""?get_next_sibling(t):t}}function sibling(r,e=1,t=!1){let i=r;for(;e--;)i=get_next_sibling(i);return i}function clear_text_content(r){r.textContent=""}function should_defer_append(){return!1}let listening_to_form_reset=!1;function add_form_reset_listener(){listening_to_form_reset||(listening_to_form_reset=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function without_reactive_context(r){var e=active_reaction,t=active_effect;set_active_reaction(null),set_active_effect(null);try{return r()}finally{set_active_reaction(e),set_active_effect(t)}}function listen_to_event_and_reset_event(r,e,t,i=t){r.addEventListener(e,()=>without_reactive_context(t));const n=r.__on_r;n?r.__on_r=()=>{n(),i(!0)}:r.__on_r=()=>i(!0),add_form_reset_listener()}function validate_effect(r){active_effect===null&&active_reaction===null&&effect_orphan(),active_reaction!==null&&(active_reaction.f&UNOWNED)!==0&&active_effect===null&&effect_in_unowned_derived(),is_destroying_effect&&effect_in_teardown()}function push_effect(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function create_effect(r,e,t,i=!0){var n=active_effect;n!==null&&(n.f&INERT)!==0&&(r|=INERT);var o={ctx:component_context,deps:null,nodes_start:null,nodes_end:null,f:r|DIRTY,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{update_effect(o),o.f|=EFFECT_RAN}catch(_){throw destroy_effect(o),_}else e!==null&&schedule_effect(o);if(i){var u=o;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&EFFECT_PRESERVED)===0&&(u=u.first),u!==null&&(u.parent=n,n!==null&&push_effect(u,n),active_reaction!==null&&(active_reaction.f&DERIVED)!==0&&(r&ROOT_EFFECT)===0)){var h=active_reaction;(h.effects??=[]).push(u)}}return o}function teardown(r){const e=create_effect(RENDER_EFFECT,null,!1);return set_signal_status(e,CLEAN),e.teardown=r,e}function user_effect(r){validate_effect();var e=active_effect.f,t=!active_reaction&&(e&BRANCH_EFFECT)!==0&&(e&EFFECT_RAN)===0;if(t){var i=component_context;(i.e??=[]).push(r)}else return create_user_effect(r)}function create_user_effect(r){return create_effect(EFFECT|USER_EFFECT,r,!1)}function user_pre_effect(r){return validate_effect(),create_effect(RENDER_EFFECT|USER_EFFECT,r,!0)}function component_root(r){Batch.ensure();const e=create_effect(ROOT_EFFECT|EFFECT_PRESERVED,r,!0);return(t={})=>new Promise(i=>{t.outro?pause_effect(e,()=>{destroy_effect(e),i(void 0)}):(destroy_effect(e),i(void 0))})}function effect(r){return create_effect(EFFECT,r,!1)}function async_effect(r){return create_effect(ASYNC|EFFECT_PRESERVED,r,!0)}function render_effect(r,e=0){return create_effect(RENDER_EFFECT|e,r,!0)}function template_effect(r,e=[],t=[]){flatten(e,t,i=>{create_effect(RENDER_EFFECT,()=>r(...i.map(get$2)),!0)})}function block(r,e=0){var t=create_effect(BLOCK_EFFECT|e,r,!0);return t}function branch(r,e=!0){return create_effect(BRANCH_EFFECT|EFFECT_PRESERVED,r,!0,e)}function execute_effect_teardown(r){var e=r.teardown;if(e!==null){const t=is_destroying_effect,i=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{e.call(null)}finally{set_is_destroying_effect(t),set_active_reaction(i)}}}function destroy_effect_children(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const n=t.ac;n!==null&&without_reactive_context(()=>{n.abort(STALE_REACTION)});var i=t.next;(t.f&ROOT_EFFECT)!==0?t.parent=null:destroy_effect(t,e),t=i}}function destroy_block_effect_children(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&BRANCH_EFFECT)===0&&destroy_effect(e),e=t}}function destroy_effect(r,e=!0){var t=!1;(e||(r.f&HEAD_EFFECT)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(remove_effect_dom(r.nodes_start,r.nodes_end),t=!0),destroy_effect_children(r,e&&!t),remove_reactions(r,0),set_signal_status(r,DESTROYED);var i=r.transitions;if(i!==null)for(const o of i)o.stop();execute_effect_teardown(r);var n=r.parent;n!==null&&n.first!==null&&unlink_effect(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function remove_effect_dom(r,e){for(;r!==null;){var t=r===e?null:get_next_sibling(r);r.remove(),r=t}}function unlink_effect(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function pause_effect(r,e){var t=[];pause_children(r,t,!0),run_out_transitions(t,()=>{destroy_effect(r),e&&e()})}function run_out_transitions(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var n of r)n.out(i)}else e()}function pause_children(r,e,t){if((r.f&INERT)===0){if(r.f^=INERT,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var i=r.first;i!==null;){var n=i.next,o=(i.f&EFFECT_TRANSPARENT)!==0||(i.f&BRANCH_EFFECT)!==0;pause_children(i,e,o?t:!1),i=n}}}function resume_effect(r){resume_children(r,!0)}function resume_children(r,e){if((r.f&INERT)!==0){r.f^=INERT,(r.f&CLEAN)===0&&(set_signal_status(r,DIRTY),schedule_effect(r));for(var t=r.first;t!==null;){var i=t.next,n=(t.f&EFFECT_TRANSPARENT)!==0||(t.f&BRANCH_EFFECT)!==0;resume_children(t,n?e:!1),t=i}if(r.transitions!==null)for(const o of r.transitions)(o.is_global||e)&&o.in()}}let captured_signals=null;function capture_signals(r){var e=captured_signals;try{if(captured_signals=new Set,untrack(r),e!==null)for(var t of captured_signals)e.add(t);return captured_signals}finally{captured_signals=e}}function invalidate_inner_signals(r){for(var e of capture_signals(r))internal_set(e,e.v)}let is_updating_effect=!1;function set_is_updating_effect(r){is_updating_effect=r}let is_destroying_effect=!1;function set_is_destroying_effect(r){is_destroying_effect=r}let active_reaction=null,untracking=!1;function set_active_reaction(r){active_reaction=r}let active_effect=null;function set_active_effect(r){active_effect=r}let current_sources=null;function push_reaction_value(r){active_reaction!==null&&(current_sources===null?current_sources=[r]:current_sources.push(r))}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(r){untracked_writes=r}let write_version=1,read_version=0,update_version=read_version;function set_update_version(r){update_version=r}let skip_reaction=!1;function increment_write_version(){return++write_version}function is_dirty(r){var e=r.f;if((e&DIRTY)!==0)return!0;if((e&MAYBE_DIRTY)!==0){var t=r.deps,i=(e&UNOWNED)!==0;if(t!==null){var n,o,u=(e&DISCONNECTED)!==0,h=i&&active_effect!==null&&!skip_reaction,_=t.length;if((u||h)&&(active_effect===null||(active_effect.f&DESTROYED)===0)){var v=r,g=v.parent;for(n=0;n<_;n++)o=t[n],(u||!o?.reactions?.includes(v))&&(o.reactions??=[]).push(v);u&&(v.f^=DISCONNECTED),h&&g!==null&&(g.f&UNOWNED)===0&&(v.f^=UNOWNED)}for(n=0;n<_;n++)if(o=t[n],is_dirty(o)&&update_derived(o),o.wv>r.wv)return!0}(!i||active_effect!==null&&!skip_reaction)&&set_signal_status(r,CLEAN)}return!1}function schedule_possible_effect_self_invalidation(r,e,t=!0){var i=r.reactions;if(i!==null&&!current_sources?.includes(r))for(var n=0;n<i.length;n++){var o=i[n];(o.f&DERIVED)!==0?schedule_possible_effect_self_invalidation(o,e,!1):e===o&&(t?set_signal_status(o,DIRTY):(o.f&CLEAN)!==0&&set_signal_status(o,MAYBE_DIRTY),schedule_effect(o))}}function update_reaction(r){var e=new_deps,t=skipped_deps,i=untracked_writes,n=active_reaction,o=skip_reaction,u=current_sources,h=component_context,_=untracking,v=update_version,g=r.f;new_deps=null,skipped_deps=0,untracked_writes=null,skip_reaction=(g&UNOWNED)!==0&&(untracking||!is_updating_effect||active_reaction===null),active_reaction=(g&(BRANCH_EFFECT|ROOT_EFFECT))===0?r:null,current_sources=null,set_component_context(r.ctx),untracking=!1,update_version=++read_version,r.ac!==null&&(without_reactive_context(()=>{r.ac.abort(STALE_REACTION)}),r.ac=null);try{r.f|=REACTION_IS_UPDATING;var m=r.fn,$=m(),p=r.deps;if(new_deps!==null){var E;if(remove_reactions(r,skipped_deps),p!==null&&skipped_deps>0)for(p.length=skipped_deps+new_deps.length,E=0;E<new_deps.length;E++)p[skipped_deps+E]=new_deps[E];else r.deps=p=new_deps;if(!skip_reaction||(g&DERIVED)!==0&&r.reactions!==null)for(E=skipped_deps;E<p.length;E++)(p[E].reactions??=[]).push(r)}else p!==null&&skipped_deps<p.length&&(remove_reactions(r,skipped_deps),p.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!untracking&&p!==null&&(r.f&(DERIVED|MAYBE_DIRTY|DIRTY))===0)for(E=0;E<untracked_writes.length;E++)schedule_possible_effect_self_invalidation(untracked_writes[E],r);return n!==null&&n!==r&&(read_version++,untracked_writes!==null&&(i===null?i=untracked_writes:i.push(...untracked_writes))),(r.f&ERROR_VALUE)!==0&&(r.f^=ERROR_VALUE),$}catch(T){return handle_error(T)}finally{r.f^=REACTION_IS_UPDATING,new_deps=e,skipped_deps=t,untracked_writes=i,active_reaction=n,skip_reaction=o,current_sources=u,set_component_context(h),untracking=_,update_version=v}}function remove_reaction(r,e){let t=e.reactions;if(t!==null){var i=index_of.call(t,r);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&(e.f&DERIVED)!==0&&(new_deps===null||!new_deps.includes(e))&&(set_signal_status(e,MAYBE_DIRTY),(e.f&(UNOWNED|DISCONNECTED))===0&&(e.f^=DISCONNECTED),destroy_derived_effects(e),remove_reactions(e,0))}function remove_reactions(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)remove_reaction(r,t[i])}function update_effect(r){var e=r.f;if((e&DESTROYED)===0){set_signal_status(r,CLEAN);var t=active_effect,i=is_updating_effect;active_effect=r,is_updating_effect=!0;try{(e&BLOCK_EFFECT)!==0?destroy_block_effect_children(r):destroy_effect_children(r),execute_effect_teardown(r);var n=update_reaction(r);r.teardown=typeof n=="function"?n:null,r.wv=write_version;var o;DEV&&tracing_mode_flag&&(r.f&DIRTY)!==0&&r.deps}finally{is_updating_effect=i,active_effect=t}}}async function tick(){await Promise.resolve(),flushSync()}function get$2(r){var e=r.f,t=(e&DERIVED)!==0;if(captured_signals?.add(r),active_reaction!==null&&!untracking){var i=active_effect!==null&&(active_effect.f&DESTROYED)!==0;if(!i&&!current_sources?.includes(r)){var n=active_reaction.deps;if((active_reaction.f&REACTION_IS_UPDATING)!==0)r.rv<read_version&&(r.rv=read_version,new_deps===null&&n!==null&&n[skipped_deps]===r?skipped_deps++:new_deps===null?new_deps=[r]:(!skip_reaction||!new_deps.includes(r))&&new_deps.push(r));else{(active_reaction.deps??=[]).push(r);var o=r.reactions;o===null?r.reactions=[active_reaction]:o.includes(active_reaction)||o.push(active_reaction)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&UNOWNED)===0&&(u.f^=UNOWNED)}if(is_destroying_effect){if(old_values.has(r))return old_values.get(r);if(t){u=r;var _=u.v;return((u.f&CLEAN)===0&&u.reactions!==null||depends_on_old_values(u))&&(_=execute_derived(u)),old_values.set(u,_),_}}else t&&(u=r,is_dirty(u)&&update_derived(u));if((r.f&ERROR_VALUE)!==0)throw r.v;return r.v}function depends_on_old_values(r){if(r.v===UNINITIALIZED)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(old_values.has(e)||(e.f&DERIVED)!==0&&depends_on_old_values(e))return!0;return!1}function untrack(r){var e=untracking;try{return untracking=!0,r()}finally{untracking=e}}const STATUS_MASK=-7169;function set_signal_status(r,e){r.f=r.f&STATUS_MASK|e}function deep_read_state(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(STATE_SYMBOL in r)deep_read(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&STATE_SYMBOL in t&&deep_read(t)}}}function deep_read(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{deep_read(r[i],e)}catch{}const t=get_prototype_of(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=get_descriptors(t);for(let n in i){const o=i[n].get;if(o)try{o.call(r)}catch{}}}}}const PASSIVE_EVENTS=["touchstart","touchmove"];function is_passive_event(r){return PASSIVE_EVENTS.includes(r)}const all_registered_events=new Set,root_event_handles=new Set;function create_event(r,e,t,i={}){function n(o){if(i.capture||handle_event_propagation.call(e,o),!o.cancelBubble)return without_reactive_context(()=>t?.call(this,o))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?queue_micro_task(()=>{e.addEventListener(r,n,i)}):e.addEventListener(r,n,i),n}function event(r,e,t,i,n){var o={capture:i,passive:n},u=create_event(r,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&teardown(()=>{e.removeEventListener(r,u,o)})}function delegate(r){for(var e=0;e<r.length;e++)all_registered_events.add(r[e]);for(var t of root_event_handles)t(r)}let last_propagated_event=null;function handle_event_propagation(r){var e=this,t=e.ownerDocument,i=r.type,n=r.composedPath?.()||[],o=n[0]||r.target;last_propagated_event=r;var u=0,h=last_propagated_event===r&&r.__root;if(h){var _=n.indexOf(h);if(_!==-1&&(e===document||e===window)){r.__root=e;return}var v=n.indexOf(e);if(v===-1)return;_<=v&&(u=_)}if(o=n[u]||r.target,o!==e){define_property(r,"currentTarget",{configurable:!0,get(){return o||t}});var g=active_reaction,m=active_effect;set_active_reaction(null),set_active_effect(null);try{for(var $,p=[];o!==null;){var E=o.assignedSlot||o.parentNode||o.host||null;try{var T=o["__"+i];if(T!=null&&(!o.disabled||r.target===o))if(is_array(T)){var[x,...D]=T;x.apply(o,[r,...D])}else T.call(o,r)}catch(R){$?p.push(R):$=R}if(r.cancelBubble||E===e||E===null)break;o=E}if($){for(let R of p)queueMicrotask(()=>{throw R});throw $}}finally{r.__root=e,delete r.currentTarget,set_active_reaction(g),set_active_effect(m)}}}function create_fragment_from_html(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function assign_nodes(r,e){var t=active_effect;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function from_html(r,e){var t=(e&TEMPLATE_FRAGMENT)!==0,i=(e&TEMPLATE_USE_IMPORT_NODE)!==0,n,o=!r.startsWith("<!>");return()=>{n===void 0&&(n=create_fragment_from_html(o?r:"<!>"+r),t||(n=get_first_child(n)));var u=i||is_firefox?document.importNode(n,!0):n.cloneNode(!0);if(t){var h=get_first_child(u),_=u.lastChild;assign_nodes(h,_)}else assign_nodes(u,u);return u}}function from_namespace(r,e,t="svg"){var i=!r.startsWith("<!>"),n=`<${t}>${i?r:"<!>"+r}</${t}>`,o;return()=>{if(!o){var u=create_fragment_from_html(n),h=get_first_child(u);o=get_first_child(h)}var _=o.cloneNode(!0);return assign_nodes(_,_),_}}function from_svg(r,e){return from_namespace(r,e,"svg")}function text(r=""){{var e=create_text(r+"");return assign_nodes(e,e),e}}function comment(){var r=document.createDocumentFragment(),e=document.createComment(""),t=create_text();return r.append(e,t),assign_nodes(e,t),r}function append(r,e){r!==null&&r.before(e)}function set_text(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function mount(r,e){return _mount(r,e)}const document_listeners=new Map;function _mount(r,{target:e,anchor:t,props:i={},events:n,context:o,intro:u=!0}){init_operations();var h=new Set,_=m=>{for(var $=0;$<m.length;$++){var p=m[$];if(!h.has(p)){h.add(p);var E=is_passive_event(p);e.addEventListener(p,handle_event_propagation,{passive:E});var T=document_listeners.get(p);T===void 0?(document.addEventListener(p,handle_event_propagation,{passive:E}),document_listeners.set(p,1)):document_listeners.set(p,T+1)}}};_(array_from(all_registered_events)),root_event_handles.add(_);var v=void 0,g=component_root(()=>{var m=t??e.appendChild(create_text());return branch(()=>{if(o){push({});var $=component_context;$.c=o}n&&(i.$$events=n),v=r(m,i)||{},o&&pop()}),()=>{for(var $ of h){e.removeEventListener($,handle_event_propagation);var p=document_listeners.get($);--p===0?(document.removeEventListener($,handle_event_propagation),document_listeners.delete($)):document_listeners.set($,p)}root_event_handles.delete(_),m!==t&&m.parentNode?.removeChild(m)}});return mounted_components.set(v,g),v}let mounted_components=new WeakMap;function if_block(r,e,t=!1){var i=r,n=null,o=null,u=UNINITIALIZED,h=t?EFFECT_TRANSPARENT:0,_=!1;const v=(p,E=!0)=>{_=!0,$(E,p)};var g=null;function m(){g!==null&&(g.lastChild.remove(),i.before(g),g=null);var p=u?n:o,E=u?o:n;p&&resume_effect(p),E&&pause_effect(E,()=>{u?o=null:n=null})}const $=(p,E)=>{if(u!==(u=p)){var T=should_defer_append(),x=i;if(T&&(g=document.createDocumentFragment(),g.append(x=create_text())),u?n??=E&&branch(()=>E(x)):o??=E&&branch(()=>E(x)),T){var D=current_batch,R=u?n:o,P=u?o:n;R&&D.skipped_effects.delete(R),P&&D.skipped_effects.add(P),D.add_callback(m)}else m()}};block(()=>{_=!1,e(v),_||$(null,null)},h)}function key(r,e,t){var i=r,n=UNINITIALIZED,o,u,h=null,_=is_runes()?not_equal:safe_not_equal;function v(){o&&pause_effect(o),h!==null&&(h.lastChild.remove(),i.before(h),h=null),o=u}block(()=>{if(_(n,n=e())){var g=i,m=should_defer_append();m&&(h=document.createDocumentFragment(),h.append(g=create_text())),u=branch(()=>t(g)),m?current_batch.add_callback(v):v()}})}function index$1(r,e){return e}function pause_effects(r,e,t){for(var i=r.items,n=[],o=e.length,u=0;u<o;u++)pause_children(e[u].e,n,!0);var h=o>0&&n.length===0&&t!==null;if(h){var _=t.parentNode;clear_text_content(_),_.append(t),i.clear(),link(r,e[0].prev,e[o-1].next)}run_out_transitions(n,()=>{for(var v=0;v<o;v++){var g=e[v];h||(i.delete(g.k),link(r,g.prev,g.next)),destroy_effect(g.e,!h)}})}function each(r,e,t,i,n,o=null){var u=r,h={flags:e,items:new Map,first:null},_=(e&EACH_IS_CONTROLLED)!==0;if(_){var v=r;u=v.appendChild(create_text())}var g=null,m=!1,$=new Map,p=derived_safe_equal(()=>{var D=t();return is_array(D)?D:D==null?[]:array_from(D)}),E,T;function x(){reconcile(T,E,h,$,u,n,e,i,t),o!==null&&(E.length===0?g?resume_effect(g):g=branch(()=>o(u)):g!==null&&pause_effect(g,()=>{g=null}))}block(()=>{T??=active_effect,E=get$2(p);var D=E.length;if(!(m&&D===0)){m=D===0;var R,P,N,J;if(should_defer_append()){var I=new Set,k=current_batch;for(P=0;P<D;P+=1){N=E[P],J=i(N,P);var j=h.items.get(J)??$.get(J);j?(e&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0&&update_item(j,N,P,e):(R=create_item(null,h,null,null,N,J,P,n,e,t,!0),$.set(J,R)),I.add(J)}for(const[F,U]of h.items)I.has(F)||k.skipped_effects.add(U.e);k.add_callback(x)}else x();get$2(p)}})}function reconcile(r,e,t,i,n,o,u,h,_){var v=(u&EACH_IS_ANIMATED)!==0,g=(u&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0,m=e.length,$=t.items,p=t.first,E=p,T,x=null,D,R=[],P=[],N,J,I,k;if(v)for(k=0;k<m;k+=1)N=e[k],J=h(N,k),I=$.get(J),I!==void 0&&(I.a?.measure(),(D??=new Set).add(I));for(k=0;k<m;k+=1){if(N=e[k],J=h(N,k),I=$.get(J),I===void 0){var j=i.get(J);if(j!==void 0){i.delete(J),$.set(J,j);var F=x?x.next:E;link(t,x,j),link(t,j,F),move(j,F,n),x=j}else{var U=E?E.e.nodes_start:n;x=create_item(U,t,x,x===null?t.first:x.next,N,J,k,o,u,_)}$.set(J,x),R=[],P=[],E=x.next;continue}if(g&&update_item(I,N,k,u),(I.e.f&INERT)!==0&&(resume_effect(I.e),v&&(I.a?.unfix(),(D??=new Set).delete(I))),I!==E){if(T!==void 0&&T.has(I)){if(R.length<P.length){var L=P[0],X;x=L.prev;var fe=R[0],ge=R[R.length-1];for(X=0;X<R.length;X+=1)move(R[X],L,n);for(X=0;X<P.length;X+=1)T.delete(P[X]);link(t,fe.prev,ge.next),link(t,x,fe),link(t,ge,L),E=L,x=ge,k-=1,R=[],P=[]}else T.delete(I),move(I,E,n),link(t,I.prev,I.next),link(t,I,x===null?t.first:x.next),link(t,x,I),x=I;continue}for(R=[],P=[];E!==null&&E.k!==J;)(E.e.f&INERT)===0&&(T??=new Set).add(E),P.push(E),E=E.next;if(E===null)continue;I=E}R.push(I),x=I,E=I.next}if(E!==null||T!==void 0){for(var re=T===void 0?[]:array_from(T);E!==null;)(E.e.f&INERT)===0&&re.push(E),E=E.next;var V=re.length;if(V>0){var G=(u&EACH_IS_CONTROLLED)!==0&&m===0?n:null;if(v){for(k=0;k<V;k+=1)re[k].a?.measure();for(k=0;k<V;k+=1)re[k].a?.fix()}pause_effects(t,re,G)}}v&&queue_micro_task(()=>{if(D!==void 0)for(I of D)I.a?.apply()}),r.first=t.first&&t.first.e,r.last=x&&x.e;for(var q of i.values())destroy_effect(q.e);i.clear()}function update_item(r,e,t,i){(i&EACH_ITEM_REACTIVE)!==0&&internal_set(r.v,e),(i&EACH_INDEX_REACTIVE)!==0?internal_set(r.i,t):r.i=t}function create_item(r,e,t,i,n,o,u,h,_,v,g){var m=(_&EACH_ITEM_REACTIVE)!==0,$=(_&EACH_ITEM_IMMUTABLE)===0,p=m?$?mutable_source(n,!1,!1):source(n):n,E=(_&EACH_INDEX_REACTIVE)===0?u:source(u),T={i:E,v:p,k:o,a:null,e:null,prev:t,next:i};try{if(r===null){var x=document.createDocumentFragment();x.append(r=create_text())}return T.e=branch(()=>h(r,p,E,v),hydrating),T.e.prev=t&&t.e,T.e.next=i&&i.e,t===null?g||(e.first=T):(t.next=T,t.e.next=T.e),i!==null&&(i.prev=T,i.e.prev=T.e),T}finally{}}function move(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,o=r.e.nodes_start;o!==null&&o!==i;){var u=get_next_sibling(o);n.before(o),o=u}}function link(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function snippet(r,e,...t){var i=r,n=noop$2,o;block(()=>{n!==(n=e())&&(o&&(destroy_effect(o),o=null),o=branch(()=>n(i,...t)))},EFFECT_TRANSPARENT)}function component(r,e,t){var i=r,n,o,u=null,h=null;function _(){o&&(pause_effect(o),o=null),u&&(u.lastChild.remove(),i.before(u),u=null),o=h,h=null}block(()=>{if(n!==(n=e())){var v=should_defer_append();if(n){var g=i;v&&(u=document.createDocumentFragment(),u.append(g=create_text()),o&&current_batch.skipped_effects.add(o)),h=branch(()=>t(g,n))}v?current_batch.add_callback(_):_()}},EFFECT_TRANSPARENT)}const whitespace=[...` 	
\r\f \v\uFEFF`];function to_class(r,e,t){var i=r==null?"":""+r;if(e&&(i=i?i+" "+e:e),t){for(var n in t)if(t[n])i=i?i+" "+n:n;else if(i.length)for(var o=n.length,u=0;(u=i.indexOf(n,u))>=0;){var h=u+o;(u===0||whitespace.includes(i[u-1]))&&(h===i.length||whitespace.includes(i[h]))?i=(u===0?"":i.substring(0,u))+i.substring(h+1):u=h}}return i===""?null:i}function to_style(r,e){return r==null?null:String(r)}function set_class(r,e,t,i,n,o){var u=r.__className;if(u!==t||u===void 0){var h=to_class(t,i,o);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(o&&n!==o)for(var _ in o){var v=!!o[_];(n==null||v!==!!n[_])&&r.classList.toggle(_,v)}return o}function set_style(r,e,t,i){var n=r.__style;if(n!==e){var o=to_style(e);o==null?r.removeAttribute("style"):r.style.cssText=o,r.__style=e}return i}function select_option(r,e,t=!1){if(r.multiple){if(e==null)return;if(!is_array(e))return select_multiple_invalid_value();for(var i of r.options)i.selected=e.includes(get_option_value(i));return}for(i of r.options){var n=get_option_value(i);if(is(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function init_select(r){var e=new MutationObserver(()=>{select_option(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),teardown(()=>{e.disconnect()})}function bind_select_value(r,e,t=e){var i=!0;listen_to_event_and_reset_event(r,"change",n=>{var o=n?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(o),get_option_value);else{var h=r.querySelector(o)??r.querySelector("option:not([disabled])");u=h&&get_option_value(h)}t(u)}),effect(()=>{var n=e();if(select_option(r,n,i),i&&n===void 0){var o=r.querySelector(":checked");o!==null&&(n=get_option_value(o),t(n))}r.__value=n,i=!1}),init_select(r)}function get_option_value(r){return"__value"in r?r.__value:r.value}const IS_CUSTOM_ELEMENT=Symbol("is custom element"),IS_HTML=Symbol("is html");function set_value(r,e){var t=get_attributes(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function set_checked(r,e){var t=get_attributes(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function set_attribute(r,e,t,i){var n=get_attributes(r);n[e]!==(n[e]=t)&&(e==="loading"&&(r[LOADING_ATTR_SYMBOL]=t),t==null?r.removeAttribute(e):typeof t!="string"&&get_setters(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function get_attributes(r){return r.__attributes??={[IS_CUSTOM_ELEMENT]:r.nodeName.includes("-"),[IS_HTML]:r.namespaceURI===NAMESPACE_HTML}}var setters_cache=new Map;function get_setters(r){var e=r.getAttribute("is")||r.nodeName,t=setters_cache.get(e);if(t)return t;setters_cache.set(e,t=[]);for(var i,n=r,o=Element.prototype;o!==n;){i=get_descriptors(n);for(var u in i)i[u].set&&t.push(u);n=get_prototype_of(n)}return t}function bind_value(r,e,t=e){var i=new WeakSet;listen_to_event_and_reset_event(r,"input",async n=>{var o=n?r.defaultValue:r.value;if(o=is_numberlike_input(r)?to_number(o):o,t(o),current_batch!==null&&i.add(current_batch),await tick(),o!==(o=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=o??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),untrack(e)==null&&r.value&&(t(is_numberlike_input(r)?to_number(r.value):r.value),current_batch!==null&&i.add(current_batch)),render_effect(()=>{var n=e();if(r===document.activeElement){var o=previous_batch??current_batch;if(i.has(o))return}is_numberlike_input(r)&&n===to_number(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function bind_checked(r,e,t=e){listen_to_event_and_reset_event(r,"change",i=>{var n=i?r.defaultChecked:r.checked;t(n)}),untrack(e)==null&&t(r.checked),render_effect(()=>{var i=e();r.checked=!!i})}function is_numberlike_input(r){var e=r.type;return e==="number"||e==="range"}function to_number(r){return r===""?null:+r}function is_bound_this(r,e){return r===e||r?.[STATE_SYMBOL]===e}function bind_this(r={},e,t,i){return effect(()=>{var n,o;return render_effect(()=>{n=o,o=[],untrack(()=>{r!==t(...o)&&(e(r,...o),n&&is_bound_this(t(...n),r)&&e(null,...n))})}),()=>{queue_micro_task(()=>{o&&is_bound_this(t(...o),r)&&e(null,...o)})}}),r}function init(r=!1){const e=component_context,t=e.l.u;if(!t)return;let i=()=>deep_read_state(e.s);if(r){let n=0,o={};const u=derived(()=>{let h=!1;const _=e.s;for(const v in _)_[v]!==o[v]&&(o[v]=_[v],h=!0);return h&&n++,n});i=()=>get$2(u)}t.b.length&&user_pre_effect(()=>{observe_all(e,i),run_all(t.b)}),user_effect(()=>{const n=untrack(()=>t.m.map(run));return()=>{for(const o of n)typeof o=="function"&&o()}}),t.a.length&&user_effect(()=>{observe_all(e,i),run_all(t.a)})}function observe_all(r,e){if(r.l.s)for(const t of r.l.s)get$2(t);e()}function reactive_import(r){var e=source(0);return function(){return arguments.length===1?(set(e,get$2(e)+1),arguments[0]):(get$2(e),r())}}function subscribe_to_store(r,e,t){if(r==null)return e(void 0),noop$2;const i=untrack(()=>r.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const subscriber_queue=[];function writable(r,e=noop$2){let t=null;const i=new Set;function n(h){if(safe_not_equal(r,h)&&(r=h,t)){const _=!subscriber_queue.length;for(const v of i)v[1](),subscriber_queue.push(v,r);if(_){for(let v=0;v<subscriber_queue.length;v+=2)subscriber_queue[v][0](subscriber_queue[v+1]);subscriber_queue.length=0}}}function o(h){n(h(r))}function u(h,_=noop$2){const v=[h,_];return i.add(v),i.size===1&&(t=e(n,o)||noop$2),h(r),()=>{i.delete(v),i.size===0&&t&&(t(),t=null)}}return{set:n,update:o,subscribe:u}}function get$1(r){let e;return subscribe_to_store(r,t=>e=t)(),e}let is_store_binding=!1;function capture_store_binding(r){var e=is_store_binding;try{return is_store_binding=!1,[r(),is_store_binding]}finally{is_store_binding=e}}function prop(r,e,t,i){var n=!legacy_mode_flag||(t&PROPS_IS_RUNES)!==0,o=(t&PROPS_IS_BINDABLE)!==0,u=(t&PROPS_IS_LAZY_INITIAL)!==0,h=i,_=!0,v=()=>(_&&(_=!1,h=u?untrack(i):i),h),g;if(o){var m=STATE_SYMBOL in r||LEGACY_PROPS in r;g=get_descriptor(r,e)?.set??(m&&e in r?P=>r[e]=P:void 0)}var $,p=!1;o?[$,p]=capture_store_binding(()=>r[e]):$=r[e],$===void 0&&i!==void 0&&($=v(),g&&(n&&props_invalid_value(),g($)));var E;if(n?E=()=>{var P=r[e];return P===void 0?v():(_=!0,P)}:E=()=>{var P=r[e];return P!==void 0&&(h=void 0),P===void 0?h:P},n&&(t&PROPS_IS_UPDATED)===0)return E;if(g){var T=r.$$legacy;return(function(P,N){return arguments.length>0?((!n||!N||T||p)&&g(N?E():P),P):E()})}var x=!1,D=((t&PROPS_IS_IMMUTABLE)!==0?derived:derived_safe_equal)(()=>(x=!1,E()));o&&get$2(D);var R=active_effect;return(function(P,N){if(arguments.length>0){const J=N?get$2(D):n&&o?proxy(P):P;return set(D,J),x=!0,h!==void 0&&(h=J),P}return is_destroying_effect&&x||(R.f&DESTROYED)!==0?D.v:get$2(D)})}function onMount(r){component_context===null&&lifecycle_outside_component(),legacy_mode_flag&&component_context.l!==null?init_update_callbacks(component_context).m.push(r):user_effect(()=>{const e=untrack(r);if(typeof e=="function")return e})}function onDestroy(r){component_context===null&&lifecycle_outside_component(),onMount(()=>()=>untrack(r))}function init_update_callbacks(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const PUBLIC_VERSION="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(PUBLIC_VERSION);enable_legacy_mode_flag();const editor=proxy({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,manualStorySelected:!1,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),editorDerived={get currentDialogue(){return editor.data?.dialogues.find(r=>r.id===editor.selectedDialogueId)},get currentChapter(){return editor.data?.chapters?.find(r=>r.id===editor.selectedChapterId)},get currentEditingChapter(){return editor.data?.chapters?.find(r=>r.id===editor.editingChapterId)},get currentEditingOption(){return editorDerived.currentDialogue&&editor.editingOptionIndex!==null?editorDerived.currentDialogue.options?.[editor.editingOptionIndex]:void 0},get chapterDialogues(){return!editor.data?.dialogues||!editor.selectedChapterId?[]:editor.data.dialogues.filter(r=>r.chapterId===editor.selectedChapterId)},get imageResources(){return editor.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return editor.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return editor.data?.items||[]},get backlinks(){return!editor.data||!editor.selectedDialogueId?[]:editor.data.dialogues.filter(r=>r.nextDialogueId===editor.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===editor.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},editorActions={toggleEditor(){editor.showEditor=!editor.showEditor},toggleItemsPanel(){editor.showItems=!editor.showItems},setStatus(r,e){editor.statusMessage={type:r,text:e}},clearStatus(){editor.statusMessage={type:"",text:""}},selectBucket(r){editor.selectedBucket=r,editor.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},editor.storedFiles=[],editor.storiesList=[],editor.selectedChapterId=null,editor.selectedDialogueId=null},updateBucketsList(r){editor.availableBuckets=r},selectChapter(r){editor.selectedChapterId=r,editor.selectedDialogueId=null},selectDialogue(r){editor.selectedDialogueId=r},selectOption(r){editor.editingOptionIndex=r},selectItem(r){editor.editingItemIndex=r},updateStoryData(r){editor.data=r},updateStoredFiles(r){editor.storedFiles=r},updateStoriesList(r){editor.storiesList=r},setCurrentFileName(r){editor.currentFileName=r},addDialogue(r){editor.data.dialogues=[...editor.data.dialogues,r]},updateDialogue(r,e){editor.data.dialogues=editor.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null)},addChapter(r){editor.data.chapters=[...editor.data.chapters||[],r]},updateChapter(r,e){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.map(t=>t.id===r?{...t,...e}:t))},selectEditingChapter(r){editor.editingChapterId=r},deleteChapter(r){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.filter(e=>e.id!==r),editor.selectedChapterId===r&&(editor.selectedChapterId=null,editor.selectedDialogueId=null))},addItem(r){editor.data.items=[...editor.data.items||[],r]},updateItem(r,e){editor.data.items&&(editor.data.items=editor.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){editor.data.items&&(editor.data.items=editor.data.items.filter(e=>e.id!==r))},reset(){editor.showEditor=!1,editor.showItems=!1,editor.editingOptionIndex=null,editor.editingItemIndex=null,editor.selectedChapterId=null,editor.selectedDialogueId=null,editor.statusMessage={type:"",text:""}}},scriptRel="modulepreload",assetsURL=function(r,e){return new URL(r,e).href},seen={},__vitePreload=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let v=function(g){return Promise.all(g.map(m=>Promise.resolve(m).then($=>({status:"fulfilled",value:$}),$=>({status:"rejected",reason:$}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),_=h?.nonce||h?.getAttribute("nonce");n=v(t.map(g=>{if(g=assetsURL(g,i),g in seen)return;seen[g]=!0;const m=g.endsWith(".css"),$=m?'[rel="stylesheet"]':"";if(!!i)for(let T=u.length-1;T>=0;T--){const x=u[T];if(x.href===g&&(!m||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${g}"]${$}`))return;const E=document.createElement("link");if(E.rel=m?"stylesheet":scriptRel,m||(E.as="script"),E.crossOrigin="",E.href=g,_&&E.setAttribute("nonce",_),document.head.appendChild(E),m)return new Promise((T,x)=>{E.addEventListener("load",T),E.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${g}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return n.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},resolveFetch$3=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)};class FunctionsError extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class FunctionsFetchError extends FunctionsError{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class FunctionsRelayError extends FunctionsError{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FunctionsHttpError extends FunctionsError{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var FunctionRegion;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));var __awaiter$7=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};class FunctionsClient{constructor(e,{headers:t={},customFetch:i,region:n=FunctionRegion.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=resolveFetch$3(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var i;return __awaiter$7(this,void 0,void 0,function*(){try{const{headers:n,method:o,body:u}=t;let h={},{region:_}=t;_||(_=this.region);const v=new URL(`${this.url}/${e}`);_&&_!=="any"&&(h["x-region"]=_,v.searchParams.set("forceFunctionRegion",_));let g;u&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",g=u):typeof u=="string"?(h["Content-Type"]="text/plain",g=u):typeof FormData<"u"&&u instanceof FormData?g=u:(h["Content-Type"]="application/json",g=JSON.stringify(u)));const m=yield this.fetch(v.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),n),body:g}).catch(T=>{throw new FunctionsFetchError(T)}),$=m.headers.get("x-relay-error");if($&&$==="true")throw new FunctionsRelayError(m);if(!m.ok)throw new FunctionsHttpError(m);let p=((i=m.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),E;return p==="application/json"?E=yield m.json():p==="application/octet-stream"?E=yield m.blob():p==="text/event-stream"?E=m:p==="multipart/form-data"?E=yield m.formData():E=yield m.text(),{data:E,error:null,response:m}}catch(n){return{data:null,error:n,response:n instanceof FunctionsHttpError||n instanceof FunctionsRelayError?n.context:void 0}}})}}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){var n=!1;try{n=this instanceof i}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var cjs={},PostgrestClient$1={},PostgrestQueryBuilder$1={},PostgrestFilterBuilder$1={},PostgrestTransformBuilder$1={},PostgrestBuilder$1={},getGlobal=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},globalObject=getGlobal();const fetch$1=globalObject.fetch,nodeFetch=globalObject.fetch.bind(globalObject),Headers$1=globalObject.Headers,Request$1=globalObject.Request,Response$1=globalObject.Response,browser=Object.freeze(Object.defineProperty({__proto__:null,Headers:Headers$1,Request:Request$1,Response:Response$1,default:nodeFetch,fetch:fetch$1},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(browser);var PostgrestError$1={},hasRequiredPostgrestError;function requirePostgrestError(){if(hasRequiredPostgrestError)return PostgrestError$1;hasRequiredPostgrestError=1,Object.defineProperty(PostgrestError$1,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return PostgrestError$1.default=r,PostgrestError$1}var hasRequiredPostgrestBuilder;function requirePostgrestBuilder(){if(hasRequiredPostgrestBuilder)return PostgrestBuilder$1;hasRequiredPostgrestBuilder=1;var r=PostgrestBuilder$1&&PostgrestBuilder$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestBuilder$1,"__esModule",{value:!0});const e=r(require$$0),t=r(requirePostgrestError());class i{constructor(o){var u,h;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(u=o.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=o.signal,this.isMaybeSingle=(h=o.isMaybeSingle)!==null&&h!==void 0?h:!1,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,u){return this.headers=new Headers(this.headers),this.headers.set(o,u),this}then(o,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let _=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var g,m,$,p;let E=null,T=null,x=null,D=v.status,R=v.statusText;if(v.ok){if(this.method!=="HEAD"){const I=await v.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((g=this.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?T=I:T=JSON.parse(I))}const N=(m=this.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),J=($=v.headers.get("content-range"))===null||$===void 0?void 0:$.split("/");N&&J&&J.length>1&&(x=parseInt(J[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(E={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,x=null,D=406,R="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const N=await v.text();try{E=JSON.parse(N),Array.isArray(E)&&v.status===404&&(T=[],E=null,D=200,R="OK")}catch{v.status===404&&N===""?(D=204,R="No Content"):E={message:N}}if(E&&this.isMaybeSingle&&(!((p=E?.details)===null||p===void 0)&&p.includes("0 rows"))&&(E=null,D=200,R="OK"),E&&this.shouldThrowOnError)throw new t.default(E)}return{error:E,data:T,count:x,status:D,statusText:R}});return this.shouldThrowOnError||(_=_.catch(v=>{var g,m,$;return{error:{message:`${(g=v?.name)!==null&&g!==void 0?g:"FetchError"}: ${v?.message}`,details:`${(m=v?.stack)!==null&&m!==void 0?m:""}`,hint:"",code:`${($=v?.code)!==null&&$!==void 0?$:""}`},data:null,count:null,status:0,statusText:""}})),_.then(o,u)}returns(){return this}overrideTypes(){return this}}return PostgrestBuilder$1.default=i,PostgrestBuilder$1}var hasRequiredPostgrestTransformBuilder;function requirePostgrestTransformBuilder(){if(hasRequiredPostgrestTransformBuilder)return PostgrestTransformBuilder$1;hasRequiredPostgrestTransformBuilder=1;var r=PostgrestTransformBuilder$1&&PostgrestTransformBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestTransformBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestBuilder());class t extends e.default{select(n){let o=!1;const u=(n??"*").split("").map(h=>/\s/.test(h)&&!o?"":(h==='"'&&(o=!o),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:o=!0,nullsFirst:u,foreignTable:h,referencedTable:_=h}={}){const v=_?`${_}.order`:"order",g=this.url.searchParams.get(v);return this.url.searchParams.set(v,`${g?`${g},`:""}${n}.${o?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:u=o}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${n}`),this}range(n,o,{foreignTable:u,referencedTable:h=u}={}){const _=typeof h>"u"?"offset":`${h}.offset`,v=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(_,`${n}`),this.url.searchParams.set(v,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:o=!1,settings:u=!1,buffers:h=!1,wal:_=!1,format:v="text"}={}){var g;const m=[n?"analyze":null,o?"verbose":null,u?"settings":null,h?"buffers":null,_?"wal":null].filter(Boolean).join("|"),$=(g=this.headers.get("Accept"))!==null&&g!==void 0?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${v}; for="${$}"; options=${m};`),v==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return PostgrestTransformBuilder$1.default=t,PostgrestTransformBuilder$1}var hasRequiredPostgrestFilterBuilder;function requirePostgrestFilterBuilder(){if(hasRequiredPostgrestFilterBuilder)return PostgrestFilterBuilder$1;hasRequiredPostgrestFilterBuilder=1;var r=PostgrestFilterBuilder$1&&PostgrestFilterBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestFilterBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestTransformBuilder());class t extends e.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const u=Array.from(new Set(o)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(n,`in.(${u})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:u,type:h}={}){let _="";h==="plain"?_="pl":h==="phrase"?_="ph":h==="websearch"&&(_="w");const v=u===void 0?"":`(${u})`;return this.url.searchParams.append(n,`${_}fts${v}.${o}`),this}match(n){return Object.entries(n).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(n,o,u){return this.url.searchParams.append(n,`not.${o}.${u}`),this}or(n,{foreignTable:o,referencedTable:u=o}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${n})`),this}filter(n,o,u){return this.url.searchParams.append(n,`${o}.${u}`),this}}return PostgrestFilterBuilder$1.default=t,PostgrestFilterBuilder$1}var hasRequiredPostgrestQueryBuilder;function requirePostgrestQueryBuilder(){if(hasRequiredPostgrestQueryBuilder)return PostgrestQueryBuilder$1;hasRequiredPostgrestQueryBuilder=1;var r=PostgrestQueryBuilder$1&&PostgrestQueryBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestQueryBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestFilterBuilder());class t{constructor(n,{headers:o={},schema:u,fetch:h}){this.url=n,this.headers=new Headers(o),this.schema=u,this.fetch=h}select(n,{head:o=!1,count:u}={}){const h=o?"HEAD":"GET";let _=!1;const v=(n??"*").split("").map(g=>/\s/.test(g)&&!_?"":(g==='"'&&(_=!_),g)).join("");return this.url.searchParams.set("select",v),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:o,defaultToNull:u=!0}={}){var h;const _="POST";if(o&&this.headers.append("Prefer",`count=${o}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const v=n.reduce((g,m)=>g.concat(Object.keys(m)),[]);if(v.length>0){const g=[...new Set(v)].map(m=>`"${m}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(n,{onConflict:o,ignoreDuplicates:u=!1,count:h,defaultToNull:_=!0}={}){var v;const g="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),h&&this.headers.append("Prefer",`count=${h}`),_||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const m=n.reduce(($,p)=>$.concat(Object.keys(p)),[]);if(m.length>0){const $=[...new Set(m)].map(p=>`"${p}"`);this.url.searchParams.set("columns",$.join(","))}}return new e.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}update(n,{count:o}={}){var u;const h="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:n}={}){var o;const u="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return PostgrestQueryBuilder$1.default=t,PostgrestQueryBuilder$1}var hasRequiredPostgrestClient;function requirePostgrestClient(){if(hasRequiredPostgrestClient)return PostgrestClient$1;hasRequiredPostgrestClient=1;var r=PostgrestClient$1&&PostgrestClient$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestClient$1,"__esModule",{value:!0});const e=r(requirePostgrestQueryBuilder()),t=r(requirePostgrestFilterBuilder());class i{constructor(o,{headers:u={},schema:h,fetch:_}={}){this.url=o,this.headers=new Headers(u),this.schemaName=h,this.fetch=_}from(o){const u=new URL(`${this.url}/${o}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new i(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,u={},{head:h=!1,get:_=!1,count:v}={}){var g;let m;const $=new URL(`${this.url}/rpc/${o}`);let p;h||_?(m=h?"HEAD":"GET",Object.entries(u).filter(([T,x])=>x!==void 0).map(([T,x])=>[T,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([T,x])=>{$.searchParams.append(T,x)})):(m="POST",p=u);const E=new Headers(this.headers);return v&&E.set("Prefer",`count=${v}`),new t.default({method:m,url:$,headers:E,schema:this.schemaName,body:p,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}}return PostgrestClient$1.default=i,PostgrestClient$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var r=cjs&&cjs.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(cjs,"__esModule",{value:!0}),cjs.PostgrestError=cjs.PostgrestBuilder=cjs.PostgrestTransformBuilder=cjs.PostgrestFilterBuilder=cjs.PostgrestQueryBuilder=cjs.PostgrestClient=void 0;const e=r(requirePostgrestClient());cjs.PostgrestClient=e.default;const t=r(requirePostgrestQueryBuilder());cjs.PostgrestQueryBuilder=t.default;const i=r(requirePostgrestFilterBuilder());cjs.PostgrestFilterBuilder=i.default;const n=r(requirePostgrestTransformBuilder());cjs.PostgrestTransformBuilder=n.default;const o=r(requirePostgrestBuilder());cjs.PostgrestBuilder=o.default;const u=r(requirePostgrestError());return cjs.PostgrestError=u.default,cjs.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:o.default,PostgrestError:u.default},cjs}var cjsExports=requireCjs();const index=getDefaultExportFromCjs(cjsExports),{PostgrestClient,PostgrestQueryBuilder,PostgrestFilterBuilder,PostgrestTransformBuilder,PostgrestBuilder,PostgrestError}=index;class WebSocketFactory{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const i=this.getWebSocketConstructor();return new i(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const version$3="2.15.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(r){r.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),i=new TextDecoder;return this._decodeBroadcast(e,t,i)}_decodeBroadcast(e,t,i){const n=t.getUint8(1),o=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=i.decode(e.slice(u,u+n));u=u+n;const _=i.decode(e.slice(u,u+o));u=u+o;const v=JSON.parse(i.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:_,payload:v}}}class Timer{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(r,e,t={})=>{var i;const n=(i=t.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(e).reduce((o,u)=>(o[u]=convertColumn(u,r,e,n),o),{})},convertColumn=(r,e,t,i)=>{const n=e.find(h=>h.name===r),o=n?.type,u=t[r];return o&&!i.includes(o)?convertCell(o,u):noop$1(u)},convertCell=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return toArray(e,t)}switch(r){case PostgresTypes.bool:return toBoolean(e);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(e);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(e);case PostgresTypes.timestamp:return toTimestampString(e);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(e);default:return noop$1(e)}},noop$1=r=>r,toBoolean=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},toNumber=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},toJson=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},toArray=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,i=r[t];if(r[0]==="{"&&i==="}"){let o;const u=r.slice(1,t);try{o=JSON.parse("["+u+"]")}catch{o=u?u.split(","):[]}return o.map(h=>convertCell(e,h))}return r},toTimestampString=r=>typeof r=="string"?r.replace(" ","T"):r,httpEndpointURL=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Push{constructor(e,t,i={},n=DEFAULT_TIMEOUT){this.channel=e,this.event=t,this.payload=i,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},n=>{const{onJoin:o,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,n,o,u),this.pendingDiffs.forEach(_=>{this.state=RealtimePresence.syncDiff(this.state,_,o,u)}),this.pendingDiffs=[],h()}),this.channel._on(i.diff,{},n=>{const{onJoin:o,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=RealtimePresence.syncDiff(this.state,n,o,u),h())}),this.onJoin((n,o,u)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:o,newPresences:u})}),this.onLeave((n,o,u)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:o,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,n){const o=this.cloneDeep(e),u=this.transformState(t),h={},_={};return this.map(o,(v,g)=>{u[v]||(_[v]=g)}),this.map(u,(v,g)=>{const m=o[v];if(m){const $=g.map(x=>x.presence_ref),p=m.map(x=>x.presence_ref),E=g.filter(x=>p.indexOf(x.presence_ref)<0),T=m.filter(x=>$.indexOf(x.presence_ref)<0);E.length>0&&(h[v]=E),T.length>0&&(_[v]=T)}else h[v]=g}),this.syncDiff(o,{joins:h,leaves:_},i,n)}static syncDiff(e,t,i,n){const{joins:o,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),n||(n=()=>{}),this.map(o,(h,_)=>{var v;const g=(v=e[h])!==null&&v!==void 0?v:[];if(e[h]=this.cloneDeep(_),g.length>0){const m=e[h].map(p=>p.presence_ref),$=g.filter(p=>m.indexOf(p.presence_ref)<0);e[h].unshift(...$)}i(h,g,_)}),this.map(u,(h,_)=>{let v=e[h];if(!v)return;const g=_.map(m=>m.presence_ref);v=v.filter(m=>g.indexOf(m.presence_ref)<0),e[h]=v,n(h,v,_),v.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const n=e[i];return"metas"in n?t[i]=n.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[i]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(e,t={config:{}},i){this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(n,o)=>{this._trigger(this._replyEventName(o),n)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:o,presence:u,private:h}}=this.params,_=(n=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map($=>$.filter))!==null&&n!==void 0?n:[],v=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0,g={},m={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:v}),postgres_changes:_,private:h};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError($=>e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,$)),this._onClose(()=>e?.(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:m},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:$})=>{var p;if(this.socket.setAuth(),$===void 0){e?.(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,T=(p=E?.length)!==null&&p!==void 0?p:0,x=[];for(let D=0;D<T;D++){const R=E[D],{filter:{event:P,schema:N,table:J,filter:I}}=R,k=$&&$[D];if(k&&k.event===P&&k.schema===N&&k.table===J&&k.filter===I)x.push(Object.assign(Object.assign({},R),{id:k.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",$=>{this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values($).join(", ")||"error")))}).receive("timeout",()=>{e?.(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this.state===CHANNEL_STATES.joined&&e===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,i)}async send(e,t={}){var i,n;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:u}=e,_={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:u,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,_,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((n=v.body)===null||n===void 0?void 0:n.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var u,h,_;const v=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((_=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||_===void 0)&&_.ack)&&o("ok"),v.receive("ok",()=>o("ok")),v.receive("error",()=>o("error")),v.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=CHANNEL_STATES.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(n=>{i=new Push(this,CHANNEL_EVENTS.leave,{},e),i.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(e,t,i){const n=new AbortController,o=setTimeout(()=>n.abort(),i),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),u}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Push(this,e,t,i);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var n,o;const u=e.toLocaleLowerCase(),{close:h,error:_,leave:v,join:g}=CHANNEL_EVENTS;if(i&&[h,_,v,g].indexOf(u)>=0&&i!==this._joinRef())return;let $=this._onMessage(u,t,i);if(t&&!$)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var E,T,x;return((E=p.filter)===null||E===void 0?void 0:E.event)==="*"||((x=(T=p.filter)===null||T===void 0?void 0:T.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===u}).map(p=>p.callback($,i)):(o=this.bindings[u])===null||o===void 0||o.filter(p=>{var E,T,x,D,R,P;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const N=p.id,J=(E=p.filter)===null||E===void 0?void 0:E.event;return N&&((T=t.ids)===null||T===void 0?void 0:T.includes(N))&&(J==="*"||J?.toLocaleLowerCase()===((x=t.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const N=(R=(D=p?.filter)===null||D===void 0?void 0:D.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return N==="*"||N===((P=t?.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof $=="object"&&"ids"in $){const E=$.data,{schema:T,table:x,commit_timestamp:D,type:R,errors:P}=E;$=Object.assign(Object.assign({},{schema:T,table:x,commit_timestamp:D,eventType:R,new:{},old:{},errors:P}),this._getPayloadRecords(E))}p.callback($,i)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const n=e.toLocaleLowerCase(),o={type:n,filter:t,callback:i};return this.bindings[n]?this.bindings[n].push(o):this.bindings[n]=[o],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(n=>{var o;return!(((o=n.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&RealtimeChannel.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(CHANNEL_EVENTS.close,{},e)}_onError(e){this._on(CHANNEL_EVENTS.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=convertChangeData(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=convertChangeData(e.columns,e.old_record)),t}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(e,t){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...u)=>__vitePreload(async()=>{const{default:h}=await Promise.resolve().then(()=>browser);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...u)=>o(...u)},!(!((i=t?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const i=`realtime:${e}`,n=this.getChannels().find(o=>o.topic===i);if(n)return n;{const o=new RealtimeChannel(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:i,payload:n,ref:o}=e,u=()=>{this.encode(e,h=>{var _;(_=this.conn)===null||_===void 0||_.send(h)})};this.log("push",`${t} ${i} (${o})`,n),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:n,payload:o,ref:u}=t,h=u?`(${u})`:"",_=o.status||"";this.log("receive",`${_} ${i} ${n} ${h}`.trim(),o),this.channels.filter(v=>v._isMember(i)).forEach(v=>v._trigger(n,o,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(CHANNEL_EVENTS.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${i}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([WORKER_SCRIPT],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const n={access_token:t,version:DEFAULT_VERSION};t&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(CHANNEL_EVENTS.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,i,n,o,u,h,_,v;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(g=>RECONNECT_INTERVALS[g-1]||DEFAULT_RECONNECT_FALLBACK),this.encode=(_=e?.encode)!==null&&_!==void 0?_:((g,m)=>m(JSON.stringify(g))),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class StorageError extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class StorageApiError extends StorageError{constructor(e,t,i){super(e),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class StorageUnknownError extends StorageError{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var __awaiter$6=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};const resolveFetch$2=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},resolveResponse=()=>__awaiter$6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield __vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url)).Response:Response}),recursiveToCamel=r=>{if(Array.isArray(r))return r.map(t=>recursiveToCamel(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,i])=>{const n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[n]=recursiveToCamel(i)}),e},isPlainObject=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var __awaiter$5=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};const _getErrorMessage$1=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),handleError$1=(r,e,t)=>__awaiter$5(void 0,void 0,void 0,function*(){const i=yield resolveResponse();r instanceof i&&!t?.noResolveJson?r.json().then(n=>{const o=r.status||500,u=n?.statusCode||o+"";e(new StorageApiError(_getErrorMessage$1(n),o,u))}).catch(n=>{e(new StorageUnknownError(_getErrorMessage$1(n),n))}):e(new StorageUnknownError(_getErrorMessage$1(r),r))}),_getRequestParams$1=(r,e,t,i)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"||!i?n:(isPlainObject(i)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(i)):n.body=i,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function _handleRequest$1(r,e,t,i,n,o){return __awaiter$5(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,_getRequestParams$1(e,i,n,o)).then(_=>{if(!_.ok)throw _;return i?.noResolveJson?_:_.json()}).then(_=>u(_)).catch(_=>handleError$1(_,h,i))})})}function get(r,e,t,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"GET",e,t,i)})}function post(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"POST",e,i,n,t)})}function put(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"PUT",e,i,n,t)})}function head(r,e,t,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),i)})}function remove(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"DELETE",e,i,n,t)})}var __awaiter$4=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(e,t={},i,n){this.url=e,this.headers=t,this.bucketId=i,this.fetch=resolveFetch$2(n)}uploadOrUpdate(e,t,i,n){return __awaiter$4(this,void 0,void 0,function*(){try{let o;const u=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),n);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const _=u.metadata;typeof Blob<"u"&&i instanceof Blob?(o=new FormData,o.append("cacheControl",u.cacheControl),_&&o.append("metadata",this.encodeMetadata(_)),o.append("",i)):typeof FormData<"u"&&i instanceof FormData?(o=i,o.append("cacheControl",u.cacheControl),_&&o.append("metadata",this.encodeMetadata(_))):(o=i,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,_&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(_)))),n?.headers&&(h=Object.assign(Object.assign({},h),n.headers));const v=this._removeEmptyFolders(t),g=this._getFinalPath(v),m=yield(e=="PUT"?put:post)(this.fetch,`${this.url}/object/${g}`,o,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:v,id:m.Id,fullPath:m.Key},error:null}}catch(o){if(isStorageError(o))return{data:null,error:o};throw o}})}upload(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,i)})}uploadToSignedUrl(e,t,i,n){return __awaiter$4(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),u=this._getFinalPath(o),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let _;const v=Object.assign({upsert:DEFAULT_FILE_OPTIONS.upsert},n),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(v.upsert)});typeof Blob<"u"&&i instanceof Blob?(_=new FormData,_.append("cacheControl",v.cacheControl),_.append("",i)):typeof FormData<"u"&&i instanceof FormData?(_=i,_.append("cacheControl",v.cacheControl)):(_=i,g["cache-control"]=`max-age=${v.cacheControl}`,g["content-type"]=v.contentType);const m=yield put(this.fetch,h.toString(),_,{headers:g});return{data:{path:o,fullPath:m.Key},error:null}}catch(_){if(isStorageError(_))return{data:null,error:_};throw _}})}createSignedUploadUrl(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const o=yield post(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:n}),u=new URL(this.url+o.url),h=u.searchParams.get("token");if(!h)throw new StorageError("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}update(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,i)})}move(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}copy(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=yield post(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:this.headers});const u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${u}`)},{data:o,error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{const n=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:n.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${o}`):null})),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}download(e,t){return __awaiter$4(this,void 0,void 0,function*(){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield get(this.fetch,`${this.url}/${n}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(isStorageError(h))return{data:null,error:h};throw h}})}info(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const i=yield get(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:recursiveToCamel(i),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}exists(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield head(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(isStorageError(i)&&i instanceof StorageUnknownError){const n=i.originalError;if([400,404].includes(n?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,t){const i=this._getFinalPath(e),n=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);const h=typeof t?.transform<"u"?"render/image":"object",_=this.transformOptsToQueryString(t?.transform||{});_!==""&&n.push(_);let v=n.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${i}${v}`)}}}remove(e){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}list(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),t),{prefix:e||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},i),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}listV2(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{const i=Object.assign({},e);return{data:yield post(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},t),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const version$2="2.11.0",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var __awaiter$3=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};class StorageBucketApi{constructor(e,t={},i,n){const o=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),t),this.fetch=resolveFetch$2(i)}listBuckets(){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(isStorageError(e))return{data:null,error:e};throw e}})}getBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}emptyBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}deleteBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}}class StorageClient extends StorageBucketApi{constructor(e,t={},i,n){super(e,t,i,n)}from(e){return new StorageFileApi(this.url,this.headers,e,this.fetch)}}const version$1="2.56.0";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";const DEFAULT_HEADERS$1={"X-Client-Info":`supabase-js-${JS_ENV}/${version$1}`},DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS$1},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};var __awaiter$2=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};const resolveFetch$1=r=>{let e;return r?e=r:typeof fetch>"u"?e=nodeFetch:e=fetch,(...t)=>e(...t)},resolveHeadersConstructor=()=>typeof Headers>"u"?Headers$1:Headers,fetchWithAuth=(r,e,t)=>{const i=resolveFetch$1(t),n=resolveHeadersConstructor();return(o,u)=>__awaiter$2(void 0,void 0,void 0,function*(){var h;const _=(h=yield e())!==null&&h!==void 0?h:r;let v=new n(u?.headers);return v.has("apikey")||v.set("apikey",r),v.has("Authorization")||v.set("Authorization",`Bearer ${_}`),i(o,Object.assign(Object.assign({},u),{headers:v}))})};var __awaiter$1=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};function ensureTrailingSlash(r){return r.endsWith("/")?r:r+"/"}function applySettingDefaults(r,e){var t,i;const{db:n,auth:o,realtime:u,global:h}=r,{db:_,auth:v,realtime:g,global:m}=e,$={db:Object.assign(Object.assign({},_),n),auth:Object.assign(Object.assign({},v),o),realtime:Object.assign(Object.assign({},g),u),storage:{},global:Object.assign(Object.assign(Object.assign({},m),h),{headers:Object.assign(Object.assign({},(t=m?.headers)!==null&&t!==void 0?t:{}),(i=h?.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>__awaiter$1(this,void 0,void 0,function*(){return""})};return r.accessToken?$.accessToken=r.accessToken:delete $.accessToken,$}const version="2.71.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=600*1e3;class AuthError extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function isAuthError(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class AuthApiError extends AuthError{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function isAuthApiError(r){return isAuthError(r)&&r.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class CustomAuthError extends AuthError{constructor(e,t,i,n){super(e,i,n),this.name=t,this.status=i}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(r){return isAuthError(r)&&r.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(r){return isAuthError(r)&&r.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function isAuthRetryableFetchError(r){return isAuthError(r)&&r.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class AuthInvalidJwtError extends CustomAuthError{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<IGNORE_BASE64URL.length;e+=1)r[IGNORE_BASE64URL[e].charCodeAt(0)]=-2;for(let e=0;e<TO_BASE64URL.length;e+=1)r[TO_BASE64URL[e].charCodeAt(0)]=e;return r})();function byteToBase64URL(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[i]),e.queuedBits-=6}}function byteFromBase64URL(r,e,t){const i=FROM_BASE64URL[r];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function stringFromBase64URL(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=u=>{stringFromUTF8(u,i,t)};for(let u=0;u<r.length;u+=1)byteFromBase64URL(r.charCodeAt(u),n,o);return e.join("")}function codepointToUTF8(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function stringToUTF8(r,e){for(let t=0;t<r.length;t+=1){let i=r.charCodeAt(t);if(i>55295&&i<=56319){const n=(i-55296)*1024&65535;i=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}codepointToUTF8(i,e)}}function stringFromUTF8(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let i=1;i<6;i+=1)if((r>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function base64UrlToUint8Array(r){const e=[],t={queue:0,queuedBits:0},i=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)byteFromBase64URL(r.charCodeAt(n),t,i);return new Uint8Array(e)}function stringToUint8Array(r){const e=[];return stringToUTF8(r,t=>e.push(t)),new Uint8Array(e)}function bytesToBase64URL(r){const e=[],t={queue:0,queuedBits:0},i=n=>{e.push(n)};return r.forEach(n=>byteToBase64URL(n,t,i)),byteToBase64URL(null,t,i),e.join("")}function expiresAt(r){return Math.round(Date.now()/1e3)+r}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,o)=>{e[o]=n})}catch{}return t.searchParams.forEach((i,n)=>{e[n]=i}),e}const resolveFetch=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},looksLikeFetchResponse=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",setItemAsync=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},getItemAsync=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},removeItemAsync=async(r,e)=>{await r.removeItem(e)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Deferred.promiseConstructor=Promise;function decodeJWT(r){const e=r.split(".");if(e.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!BASE64URL_REGEX.test(e[i]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(e[0])),payload:JSON.parse(stringFromBase64URL(e[1])),signature:base64UrlToUint8Array(e[2]),raw:{header:e[0],payload:e[1]}}}async function sleep(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function retryable(r,e){return new Promise((i,n)=>{(async()=>{for(let o=0;o<1/0;o++)try{const u=await r(o);if(!e(o,null,u)){i(u);return}}catch(u){if(!e(o,u)){n(u);return}}})()})}function dec2hex(r){return("0"+r.toString(16)).substr(-2)}function generatePKCEVerifier(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let n="";for(let o=0;o<56;o++)n+=t.charAt(Math.floor(Math.random()*i));return n}return crypto.getRandomValues(e),Array.from(e,dec2hex).join("")}async function sha256(r){const t=new TextEncoder().encode(r),i=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(i);return Array.from(n).map(o=>String.fromCharCode(o)).join("")}async function generatePKCEChallenge(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await sha256(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(r,e,t=!1){const i=generatePKCEVerifier();let n=i;t&&(n+="/PASSWORD_RECOVERY"),await setItemAsync(r,`${e}-code-verifier`,n);const o=await generatePKCEChallenge(i);return[o,i===o?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(r){const e=r.headers.get(API_VERSION_HEADER_NAME);if(!e||!e.match(API_VERSION_REGEX))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function validateExp(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function getAlgorithm(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(r){if(!UUID_REGEX.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const i=t.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function deepClone(r){return JSON.parse(JSON.stringify(r))}var __rest$1=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t};const _getErrorMessage=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),NETWORK_ERROR_CODES=[502,503,504];async function handleError(r){var e;if(!looksLikeFetchResponse(r))throw new AuthRetryableFetchError(_getErrorMessage(r),0);if(NETWORK_ERROR_CODES.includes(r.status))throw new AuthRetryableFetchError(_getErrorMessage(r),r.status);let t;try{t=await r.json()}catch(o){throw new AuthUnknownError(_getErrorMessage(o),o)}let i;const n=parseResponseAPIVersion(r);if(n&&n.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new AuthSessionMissingError}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,t.weak_password.reasons);throw new AuthApiError(_getErrorMessage(t),r.status||500,i)}const _getRequestParams=(r,e,t,i)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),t))};async function _request(r,e,t,i){var n;const o=Object.assign({},i?.headers);o[API_VERSION_HEADER_NAME]||(o[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);const u=(n=i?.query)!==null&&n!==void 0?n:{};i?.redirectTo&&(u.redirect_to=i.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",_=await _handleRequest(r,e,t+h,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(_):{data:Object.assign({},_),error:null}}async function _handleRequest(r,e,t,i,n,o){const u=_getRequestParams(e,i,n,o);let h;try{h=await r(t,Object.assign({},u))}catch(_){throw console.error(_),new AuthRetryableFetchError(_getErrorMessage(_),0)}if(h.ok||await handleError(h),i?.noResolveJson)return h;try{return await h.json()}catch(_){await handleError(_)}}function _sessionResponse(r){var e;let t=null;hasSession(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=expiresAt(r.expires_in)));const i=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:i},error:null}}function _sessionResponsePassword(r){const e=_sessionResponse(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=r.weak_password),e}function _userResponse(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function _ssoResponse(r){return{data:r,error:null}}function _generateLinkResponse(r){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:n,verification_type:o}=r,u=__rest$1(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:i,redirect_to:n,verification_type:o},_=Object.assign({},u);return{data:{properties:h,user:_},error:null}}function _noResolveJsonResponse(r){return r}function hasSession(r){return r.access_token&&r.refresh_token&&r.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];var __rest=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t};class GoTrueAdminApi{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=resolveFetch(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=__rest(e,["options"]),n=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(n.new_email=i?.newEmail,delete n.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:_generateLinkResponse,redirectTo:t?.redirectTo})}catch(t){if(isAuthError(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,n,o,u,h,_;try{const v={nextPage:null,lastPage:0,total:0},g=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(o=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""},xform:_noResolveJsonResponse});if(g.error)throw g.error;const m=await g.json(),$=(u=g.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(_=(h=g.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&_!==void 0?_:[];return p.length>0&&(p.forEach(E=>{const T=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(E.split(";")[1].split("=")[1]);v[`${x}Page`]=T}),v.total=parseInt($)),{data:Object.assign(Object.assign({},m),v),error:null}}catch(v){if(isAuthError(v))return{data:{users:[]},error:v};throw v}}async getUserById(e){validateUUID(e);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){validateUUID(e);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){validateUUID(e);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){validateUUID(e.userId);try{const{data:t,error:i}=await _request(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:i}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _deleteFactor(e){validateUUID(e.userId),validateUUID(e.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}}function memoryLocalStorageAdapter(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(r,e,t){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async n=>{if(n){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(internals.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lockNoOp(r,e,t){return await t()}const GLOBAL_JWKS={};class GoTrueClient{constructor(e){var t,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&isBrowser()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},DEFAULT_OPTIONS),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new GoTrueAdminApi({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=resolveFetch(n.fetch),this.lock=n.lock||lockNoOp,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:isBrowser()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${version}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=parseParametersFromURL(window.location.href);let i="none";if(this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce"),isBrowser()&&this.detectSessionInUrl&&i!=="none"){const{data:n,error:o}=await this._getSessionFromURL(t,i);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),isAuthImplicitGrantRedirectError(o)){const _=(e=o.details)===null||e===void 0?void 0:e.code;if(_==="identity_already_exists"||_==="identity_not_found"||_==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:u,redirectType:h}=n;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return isAuthError(t)?{error:t}:{error:new AuthUnknownError("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,n;try{const o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:_sessionResponse}),{data:u,error:h}=o;if(h||!u)return{data:{user:null,session:null},error:h};const _=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",_)),{data:{user:v,session:_},error:null}}catch(o){if(isAuthError(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,i,n;try{let o;if("email"in e){const{email:g,password:m,options:$}=e;let p=null,E=null;this.flowType==="pkce"&&([p,E]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:$?.emailRedirectTo,body:{email:g,password:m,data:(t=$?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:$?.captchaToken},code_challenge:p,code_challenge_method:E},xform:_sessionResponse})}else if("phone"in e){const{phone:g,password:m,options:$}=e;o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:m,data:(i=$?.data)!==null&&i!==void 0?i:{},channel:(n=$?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:$?.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:u,error:h}=o;if(h||!u)return{data:{user:null,session:null},error:h};const _=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",_)),{data:{user:v,session:_},error:null}}catch(o){if(isAuthError(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:u,options:h}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in e){const{phone:o,password:u,options:h}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:i,error:n}=t;return n?{data:{user:null,session:null},error:n}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:n})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,i,n,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,i,n,o,u,h,_,v,g,m,$,p;let E,T;if("message"in e)E=e.message,T=e.signature;else{const{chain:x,wallet:D,statement:R,options:P}=e;let N;if(isBrowser())if(typeof D=="object")N=D;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))N=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof D!="object"||!P?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");N=D}const J=new URL((t=P?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in N&&N.signIn){const I=await N.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},P?.signInWithSolana),{version:"1",domain:J.host,uri:J.href}),R?{statement:R}:null));let k;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")k=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)k=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)E=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),T=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in N)||typeof N.signMessage!="function"||!("publicKey"in N)||typeof N!="object"||!N.publicKey||!("toBase58"in N.publicKey)||typeof N.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${J.host} wants you to sign in with your Solana account:`,N.publicKey.toBase58(),...R?["",R,""]:[""],"Version: 1",`URI: ${J.href}`,`Issued At: ${(n=(i=P?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((o=P?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${P.signInWithSolana.notBefore}`]:[],...!((u=P?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${P.signInWithSolana.expirationTime}`]:[],...!((h=P?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${P.signInWithSolana.chainId}`]:[],...!((_=P?.signInWithSolana)===null||_===void 0)&&_.nonce?[`Nonce: ${P.signInWithSolana.nonce}`]:[],...!((v=P?.signInWithSolana)===null||v===void 0)&&v.requestId?[`Request ID: ${P.signInWithSolana.requestId}`]:[],...!((m=(g=P?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||m===void 0)&&m.length?["Resources",...P.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const I=await N.signMessage(new TextEncoder().encode(E),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=I}}try{const{data:x,error:D}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:bytesToBase64URL(T)},!(($=e.options)===null||$===void 0)&&$.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:_sessionResponse});if(D)throw D;return!x||!x.session||!x.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign({},x),error:D})}catch(x){if(isAuthError(x))return{data:{user:null,session:null},error:x};throw x}}async _exchangeCodeForSession(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[i,n]=(t??"").split("/");try{const{data:o,error:u}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new AuthInvalidTokenResponseError}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:u})}catch(o){if(isAuthError(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:i,token:n,access_token:o,nonce:u}=e,h=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:n,access_token:o,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:_sessionResponse}),{data:_,error:v}=h;return v?{data:{user:null,session:null},error:v}:!_||!_.session||!_.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:_,error:v})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,i,n,o,u;try{if("email"in e){const{email:h,options:_}=e;let v=null,g=null;this.flowType==="pkce"&&([v,g]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:m}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=_?.data)!==null&&t!==void 0?t:{},create_user:(i=_?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:_?.captchaToken},code_challenge:v,code_challenge_method:g},redirectTo:_?.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){const{phone:h,options:_}=e,{data:v,error:g}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(n=_?.data)!==null&&n!==void 0?n:{},create_user:(o=_?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:_?.captchaToken},channel:(u=_?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:v?.message_id},error:g}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(h){if(isAuthError(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,i;try{let n,o;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:u,error:h}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:_sessionResponse});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const _=u.session,v=u.user;return _?.access_token&&(await this._saveSession(_),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",_)),{data:{user:v,session:_},error:null}}catch(n){if(isAuthError(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,i,n;try{let o=null,u=null;return this.flowType==="pkce"&&([o,u]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:u}),headers:this.headers,xform:_ssoResponse})}catch(o){if(isAuthError(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new AuthSessionMissingError;const{error:n}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(isAuthError(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:n,options:o}=e,{error:u}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:i,type:n,options:o}=e,{data:u,error:h}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const u=await getItemAsync(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=userNotAvailableProxy()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(_,v,g)=>(!u&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(_,v,g))})}return{data:{session:e},error:null}}const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_userResponse}):await this._useSession(async t=>{var i,n,o;const{data:u,error:h}=t;if(h)throw h;return!(!((i=u.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=u.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:_userResponse})})}catch(t){if(isAuthError(t))return isAuthSessionMissingError(t)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:n,error:o}=i;if(o)throw o;if(!n.session)throw new AuthSessionMissingError;const u=n.session;let h=null,_=null;this.flowType==="pkce"&&e.email!=null&&([h,_]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:v,error:g}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:_}),jwt:u.access_token,xform:_userResponse});if(g)throw g;return u.user=v.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new AuthSessionMissingError;const t=Date.now()/1e3;let i=t,n=!0,o=null;const{payload:u}=decodeJWT(e.access_token);if(u.exp&&(i=u.exp,n=i<=t),n){const{session:h,error:_}=await this._callRefreshToken(e.refresh_token);if(_)return{data:{user:null,session:null},error:_};if(!h)return{data:{user:null,session:null},error:null};o=h}else{const{data:h,error:_}=await this._getUser(e.access_token);if(_)throw _;o={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(isAuthError(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(i=u.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new AuthSessionMissingError;const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(e.error||e.error_description||e.error_code)throw new AuthImplicitGrantRedirectError(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:R,error:P}=await this._exchangeCodeForSession(e.code);if(P)throw P;const N=new URL(window.location.href);return N.searchParams.delete("code"),window.history.replaceState(window.history.state,"",N.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:n,access_token:o,refresh_token:u,expires_in:h,expires_at:_,token_type:v}=e;if(!o||!h||!u||!v)throw new AuthImplicitGrantRedirectError("No session defined in URL");const g=Math.round(Date.now()/1e3),m=parseInt(h);let $=g+m;_&&($=parseInt(_));const p=$-g;p*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${m}s`);const E=$-m;g-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,$,g):g-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,$,g);const{data:T,error:x}=await this._getUser(o);if(x)throw x;const D={provider_token:i,provider_refresh_token:n,access_token:o,expires_in:m,expires_at:$,refresh_token:u,token_type:v,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:D,redirectType:e.type},error:null}}catch(i){if(isAuthError(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:n,error:o}=t;if(o)return{error:o};const u=(i=n.session)===null||i===void 0?void 0:i.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(isAuthApiError(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=uuid(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,n;try{const{data:{session:o},error:u}=t;if(u)throw u;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let i=null,n=null;this.flowType==="pkce"&&([i,n]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(isAuthError(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:i,error:n}=await this._useSession(async o=>{var u,h,_,v,g;const{data:m,error:$}=o;if($)throw $;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(_=e.options)===null||_===void 0?void 0:_.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",p,{headers:this.headers,jwt:(g=(v=m.session)===null||v===void 0?void 0:v.access_token)!==null&&g!==void 0?g:void 0})});if(n)throw n;return isBrowser()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i?.url),{data:{provider:e.provider,url:i?.url},error:null}}catch(i){if(isAuthError(i))return{data:{provider:e.provider,url:null},error:i};throw i}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,n;const{data:o,error:u}=t;if(u)throw u;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await retryable(async n=>(n>0&&await sleep(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_sessionResponse})),(n,o)=>{const u=200*Math.pow(2,n);return o&&isAuthRetryableFetchError(o)&&Date.now()+u-i<AUTO_REFRESH_TICK_DURATION_MS})}catch(i){if(this._debug(t,"error",i),isAuthError(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),isBrowser()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await getItemAsync(this.storage,this.storageKey);if(n&&this.userStorage){let u=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:n.user},await setItemAsync(this.userStorage,this.storageKey+"-user",u)),n.user=(e=u?.user)!==null&&e!==void 0?e:userNotAvailableProxy()}else if(n&&!n.user&&!n.user){const u=await getItemAsync(this.storage,this.storageKey+"-user");u&&u?.user?(n.user=u.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,n)):n.user=userNotAvailableProxy()}if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const o=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(i,`session has${o?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),o){if(this.autoRefreshToken&&n.refresh_token){const{error:u}=await this._callRefreshToken(n.refresh_token);u&&(console.error(u),isAuthRetryableFetchError(u)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(n.access_token);!h&&u?.user?(n.user=u.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(i,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Deferred;const{data:o,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!o.session)throw new AuthSessionMissingError;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const h={session:o.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(o){if(this._debug(n,"error",o),isAuthError(o)){const u={session:null,error:o};return isAuthRetryableFetchError(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,i=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(_){o.push(_)}});if(await Promise.all(u),o.length>0){for(let h=0;h<o.length;h+=1)console.error(o[h]);throw o[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const o=deepClone(n);await setItemAsync(this.storage,this.storageKey,o)}else{const n=deepClone(t);await setItemAsync(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&isBrowser()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((i.expires_at*1e3-e)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),n<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const n=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&n.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[o,u]=await getCodeChallengeAndMethod(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(u)}`});n.push(h.toString())}if(i?.queryParams){const o=new URLSearchParams(i.queryParams);n.push(o.toString())}return i?.skipBrowserRedirect&&n.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;return o?{data:null,error:o}:await _request(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,n;const{data:o,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:_,error:v}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(i=o?.session)===null||i===void 0?void 0:i.access_token});return v?{data:null,error:v}:(e.factorType==="totp"&&(!((n=_?.totp)===null||n===void 0)&&n.qr_code)&&(_.totp.qr_code=`data:image/svg+xml;utf-8,${_.totp.qr_code}`),{data:_,error:null})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:u,error:h}=await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;return o?{data:null,error:o}:await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?{data:null,error:i}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const i=e?.factors||[],n=i.filter(u=>u.factor_type==="totp"&&u.status==="verified"),o=i.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:i,totp:n,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,i;const{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=decodeJWT(n.access_token);let h=null;u.aal&&(h=u.aal);let _=h;((i=(t=n.user.factors)===null||t===void 0?void 0:t.filter(m=>m.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(_="aal2");const g=u.amr||[];return{data:{currentLevel:h,nextLevel:_,currentAuthenticationMethods:g},error:null}}))}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(h=>h.kid===e);if(i)return i;const n=Date.now();if(i=this.jwks.keys.find(h=>h.kid===e),i&&this.jwks_cached_at+JWKS_TTL>n)return i;const{data:o,error:u}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=n,i=o.keys.find(h=>h.kid===e),!i)?null:i}async getClaims(e,t={}){try{let i=e;if(!i){const{data:p,error:E}=await this.getSession();if(E||!p.session)return{data:null,error:E};i=p.session.access_token}const{header:n,payload:o,signature:u,raw:{header:h,payload:_}}=decodeJWT(i);t?.allowExpired||validateExp(o.exp);const v=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!v){const{error:p}=await this.getUser(i);if(p)throw p;return{data:{claims:o,header:n,signature:u},error:null}}const g=getAlgorithm(n.alg),m=await crypto.subtle.importKey("jwk",v,g,!0,["verify"]);if(!await crypto.subtle.verify(g,m,u,stringToUint8Array(`${h}.${_}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:o,header:n,signature:u},error:null}}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}}GoTrueClient.nextInstanceID=0;const AuthClient=GoTrueClient;class SupabaseAuthClient extends AuthClient{constructor(e){super(e)}}var __awaiter=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(g){try{v(i.next(g))}catch(m){u(m)}}function _(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(h,_)}v((i=i.apply(r,e||[])).next())})};class SupabaseClient{constructor(e,t,i){var n,o,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=ensureTrailingSlash(e),_=new URL(h);this.realtimeUrl=new URL("realtime/v1",_),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",_),this.storageUrl=new URL("storage/v1",_),this.functionsUrl=new URL("functions/v1",_);const v=`sb-${_.hostname.split(".")[0]}-auth-token`,g={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},DEFAULT_AUTH_OPTIONS),{storageKey:v}),global:DEFAULT_GLOBAL_OPTIONS},m=applySettingDefaults(i??{},g);this.storageKey=(n=m.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=m.global.headers)!==null&&o!==void 0?o:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:($,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=m.auth)!==null&&u!==void 0?u:{},this.headers,m.global.fetch),this.fetch=fetchWithAuth(t,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new PostgrestClient(new URL("rest/v1",_).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,i?.storage),m.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return __awaiter(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:n,storageKey:o,flowType:u,lock:h,debug:_},v,g){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),v),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:n,flowType:u,lock:h,debug:_,fetch:g,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i?.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?this.changedAccessToken=i:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const createClient=(r,e,t)=>new SupabaseClient(r,e,t);function shouldShowDeprecationWarning(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl="https://vycjpmuyscfygstjjied.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",customFetch=async(r,e)=>{const t=typeof r=="string"?r:r instanceof URL?r.href:r.url,i=e?.method||"GET";console.log(`[Supabase] ${i} ${t}`);const n=performance.now();try{const o=await fetch(r,e),u=(performance.now()-n).toFixed(2);return console.log(`[Supabase] ${i} ${t} - ${o.status} (${u}ms)`),o}catch(o){const u=(performance.now()-n).toFixed(2);throw console.error(`[Supabase] ${i} ${t} - ERROR (${u}ms)`,o),o}},supabase=createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:customFetch,headers:{"Content-Type":"application/json"}}}),resourceActions={async loadStoriesList(){if(!editor.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${editor.selectedBucket}`);const r=`${editor.selectedBucket}_story.json`,{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(i=>i.name===r)?(editor.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(editor.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!editor.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await supabase.storage.from(editor.selectedBucket).list();r&&(editor.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история");return}const t=e.files[0];editorActions.setStatus("loading","Загрузка файла...");const i=await t.arrayBuffer(),n=new Uint8Array(i),{error:o}=await supabase.storage.from(editor.selectedBucket).upload(t.name,n,{upsert:!0,contentType:t.type});o?editorActions.setStatus("error","Ошибка загрузки"):(editorActions.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история");return}const{error:e}=await supabase.storage.from(editor.selectedBucket).remove([r]);e?editorActions.setStatus("error","Ошибка удаления файла"):(editorActions.setStatus("success","Файл удален"),await this.loadStoredResources())}};function migrateStoryData(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function createNewOption(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const storyActions={async createNewStory(){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),n=new TextEncoder().encode(t),{error:o}=await supabase.storage.from(editor.selectedBucket).upload(r,n,{contentType:"application/json"});o?editorActions.setStatus("error","Ошибка создания: "+o.message):(await resourceActions.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${editor.selectedBucket}`),editorActions.setStatus("loading","Загрузка..."),editor.currentFileName=r;try{const{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let i;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const o=supabase.storage.from(editor.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${o}`);const u=await fetch(o);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);i=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${i.length}`)}else i=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${i.length}`);let n=JSON.parse(i);console.log("[StoryStore] Данные распарсены:",{meta:n.meta,chaptersCount:n.chapters?.length,dialoguesCount:n.dialogues?.length,itemsCount:n.items?.length}),n=migrateStoryData(n),console.log("[StoryStore] Присваиваем данные в editor.data"),editor.data=n,console.log("[StoryStore] editor.data обновлен:",{chapters:editor.data.chapters?.length,dialogues:editor.data.dialogues?.length}),editor.data.chapters&&editor.data.chapters.length>0&&(editor.selectedChapterId=editor.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${editor.selectedChapterId}`)),editor.data.dialogues&&editor.data.dialogues.length>0&&(editor.selectedDialogueId=editor.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${editor.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),editorActions.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),editorActions.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}editorActions.setStatus("loading","Сохранение...");const r=JSON.stringify(editor.data,null,2);console.log(`[StoryStore] Сохранение файла: ${editor.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:i}=await supabase.storage.from(editor.selectedBucket).update(editor.currentFileName,t,{contentType:"application/json"});if(i){console.error("[StoryStore] Ошибка сохранения (update):",i),console.log("[StoryStore] Пробуем upload вместо update");const n=await supabase.storage.from(editor.selectedBucket).upload(editor.currentFileName,t,{contentType:"application/json"});n.error?(console.error("[StoryStore] Ошибка сохранения (upload):",n.error),editorActions.setStatus("error","Ошибка сохранения: "+n.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),editorActions.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),editorActions.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}const r=editor.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const i=prompt("Введите имя для копии:",t);if(!i)return;t=i.trim(),t.endsWith(".json")||(t+=".json"),editorActions.setStatus("loading","Создание копии...");const n=JSON.stringify(editor.data,null,2),u=new TextEncoder().encode(n),{error:h}=await supabase.storage.from(editor.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?editorActions.setStatus("error",`Ошибка копии: ${h.message}`):(await resourceActions.loadStoriesList(),editorActions.setStatus("success","Копия сохранена!"))},addChapter(){if(!editor.data||!editor.data.chapters)return;const r="ch_"+Date.now();editor.data.chapters.push({id:r,title:"Новая глава",description:""}),editor.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!editor.data||!editor.selectedChapterId)return;const r="d_"+Date.now();editor.data.dialogues.push({id:r,chapterId:editor.selectedChapterId,text:"Новый текст...",options:[]}),editor.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&editor.data&&(editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null))},jumpTo(r){const e=editor.data?.dialogues.find(t=>t.id===r);e&&(editor.selectedChapterId=e.chapterId,editor.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var $$_import_editorDerived$1=reactive_import(()=>editorDerived);function handleCancel(){editorActions.selectEditingChapter(null)}var root_1$y=from_html('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function ChapterForm(r,e){push(e,!1);function t(){$$_import_editorDerived$1().currentEditingChapter&&(editorActions.updateChapter($$_import_editorDerived$1().currentEditingChapter.id,{title:$$_import_editorDerived$1().currentEditingChapter.title,description:$$_import_editorDerived$1().currentEditingChapter.description}),editorActions.selectEditingChapter(null))}function i(){$$_import_editorDerived$1().currentEditingChapter&&confirm(`Удалить главу "${$$_import_editorDerived$1().currentEditingChapter.title}"?`)&&(editorActions.deleteChapter($$_import_editorDerived$1().currentEditingChapter.id),editorActions.selectEditingChapter(null))}init();var n=comment(),o=first_child(n);{var u=h=>{var _=root_1$y(),v=child(_),g=sibling(child(v),2),m=child(g);m.__click=i;var $=sibling(v,2),p=sibling(child($),2),E=sibling($,2),T=sibling(child(E),2),x=sibling(E,2),D=child(x);D.__click=[handleCancel];var R=sibling(D,2);R.__click=t,bind_value(p,()=>$$_import_editorDerived$1().currentEditingChapter.title,P=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.title=P)),bind_value(T,()=>$$_import_editorDerived$1().currentEditingChapter.description,P=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.description=P)),append(h,_)};if_block(o,h=>{$$_import_editorDerived$1().currentEditingChapter&&h(u)})}append(r,n),pop()}delegate(["click"]);var $$_import_editor$3=reactive_import(()=>editor),on_click$e=(r,e,t)=>e(get$2(t).id),root_2$n=from_html('<div class="chapter-form-container svelte-xp6igx"><!></div>'),root_1$x=from_html('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),root_3$r=from_html('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),root_4$l=from_html("<div> </div>"),root$g=from_html('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function EditorSidebar(r,e){push(e,!1);function t(D){editorActions.selectEditingChapter(D)}init();var i=root$g(),n=child(i),o=child(n),u=sibling(child(o),2);u.__click=function(...D){storyActions.addChapter?.apply(this,D)};var h=sibling(o,2);each(h,5,()=>$$_import_editor$3().data?.chapters||[],D=>D.id,(D,R)=>{var P=root_1$x(),N=first_child(P),J=child(N);let I;J.__click=()=>$$_import_editor$3($$_import_editor$3().selectedChapterId=get$2(R).id);var k=child(J),j=child(k),F=sibling(J,2);F.__click=[on_click$e,t,R];var U=sibling(N,2);{var L=X=>{var fe=root_2$n(),ge=child(fe);ChapterForm(ge,{}),append(X,fe)};if_block(U,X=>{$$_import_editor$3().editingChapterId===get$2(R).id&&X(L)})}template_effect(X=>{I=set_class(J,1,"chapter-item svelte-xp6igx",null,I,X),set_attribute(J,"aria-pressed",$$_import_editor$3().selectedChapterId===get$2(R).id),set_attribute(J,"title",get$2(R).description||"Без описания"),set_text(j,get$2(R).title)},[()=>({active:$$_import_editor$3().selectedChapterId===get$2(R).id})]),append(D,P)});var _=sibling(n,2),v=child(_),g=child(v),m=child(g),$=sibling(g,2);$.__click=function(...D){storyActions.addDialogue?.apply(this,D)};var p=sibling(v,2);each(p,5,()=>editorDerived.chapterDialogues,D=>D.id,(D,R)=>{var P=root_3$r();let N;P.__click=()=>$$_import_editor$3($$_import_editor$3().selectedDialogueId=get$2(R).id);var J=child(P),I=child(J),k=sibling(J,2),j=child(k);template_effect((F,U)=>{N=set_class(P,1,"dialogue-item svelte-xp6igx",null,N,F),set_attribute(P,"aria-pressed",$$_import_editor$3().selectedDialogueId===get$2(R).id),set_text(I,get$2(R).id),set_text(j,`${U??""}...`)},[()=>({active:$$_import_editor$3().selectedDialogueId===get$2(R).id}),()=>get$2(R).text.substring(0,25)]),append(D,P)});var E=sibling(_,2),T=child(E);{var x=D=>{var R=root_4$l(),P=child(R);template_effect(()=>{set_class(R,1,`alert ${$$_import_editor$3().statusMessage.type??""}`,"svelte-xp6igx"),set_text(P,$$_import_editor$3().statusMessage.text)}),append(D,R)};if_block(T,D=>{$$_import_editor$3().statusMessage.text&&D(x)})}template_effect(()=>{set_text(m,`Сцены (${editorDerived.chapterDialogues.length??""})`),$.disabled=!$$_import_editor$3().selectedChapterId}),append(r,i),pop()}delegate(["click"]);var root_1$w=from_html("<option> </option>"),on_change=(r,e)=>{const t=r.target;e(t.checked)},on_change_1=(r,e)=>{const t=r.target;e("id",t.value)},on_change_2=(r,e)=>{const t=r.target;e("onWinDialogueId",t.value)},root_3$q=from_html("<option> </option>"),on_change_3=(r,e)=>{const t=r.target;e("onLoseDialogueId",t.value)},root_4$k=from_html("<option> </option>"),on_change_4=(r,e)=>{const t=r.target;e("rewardItem",t.value)},root_5$n=from_html("<option> </option>"),root_2$m=from_html('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option><option>Алхимический Крест</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),on_change_5=(r,e)=>{const t=r.target;e(t.value)},root_6$f=from_html("<option> </option>"),on_change_6=(r,e)=>{const t=r.target;e({itemId:t.value})},root_8$b=from_html("<option> </option>"),root_7$e=from_html('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),on_input$1=(r,e)=>{const t=r.target;e({statName:t.value})},on_input_1$1=(r,e)=>{const t=r.target,i=parseInt(t.value);e({statValue:isNaN(i)?0:i})},root_9$5=from_html('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),on_input_2=(r,e)=>{const t=r.target;e({flagName:t.value})},root_10$5=from_html('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),root$f=from_html('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function OptionEditor(r,e){push(e,!0);const t=prop(e,"option",7);function i(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function n(){return i(),t().visibilityCondition}function o(Q){i();const ae=t().visibilityCondition;Object.assign(ae,Q),t().visibilityCondition={...ae}}function u(Q){i();const ae={type:Q};switch(Q){case"has_item":ae.itemId=n().itemId||"";break;case"stat_greater":ae.statName=n().statName||"",ae.statValue=n().statValue||0;break;case"flag_true":ae.flagName=n().flagName||"";break}t().visibilityCondition=ae}const h=user_derived(()=>!!t().miniGame);function _(Q){Q?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function v(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function g(Q,ae){const H=v();H&&(H[Q]=ae)}var m=root$f(),$=child(m),p=child($),E=sibling(p,2),T=sibling($,2),x=child(T),D=sibling(x,2),R=child(D);R.value=R.__value="";var P=sibling(R);each(P,17,()=>e.dialogues,Q=>Q.id,(Q,ae)=>{var H=root_1$w(),W=child(H),Z={};template_effect(B=>{set_text(W,`${get$2(ae).id??""}: ${B??""}...`),Z!==(Z=get$2(ae).id)&&(H.value=(H.__value=get$2(ae).id)??"")},[()=>get$2(ae).text.substring(0,30)]),append(Q,H)});var N=sibling(T,2),J=child(N),I=child(J),k=child(I);k.__change=[on_change,_];var j=sibling(J,2);{var F=Q=>{var ae=root_2$m(),H=child(ae),W=child(H),Z=sibling(W,2);Z.__change=[on_change_1,g];var B=child(Z);B.value=B.__value="";var te=sibling(B);te.value=te.__value="onet_monsters";var ne=sibling(te);ne.value=ne.__value="memo_monsters";var ye=sibling(ne);ye.value=ye.__value="light_out";var we=sibling(ye);we.value=we.__value="flood_it";var Ee=sibling(we);Ee.value=Ee.__value="broken_mirror";var $e=sibling(Ee);$e.value=$e.__value="evolution2048";var Ce=sibling($e);Ce.value=Ce.__value="cursed_crypts";var Le=sibling(Ce);Le.value=Le.__value="tower_of_souls";var w=sibling(Le);w.value=w.__value="alchemists_cross";var c;init_select(Z);var d=sibling(H,2),S=child(d),M=child(S),Y=sibling(M,2);Y.__change=[on_change_2,g];var _e=child(Y);_e.value=_e.__value="";var Ie=sibling(_e);each(Ie,17,()=>e.dialogues,Qe=>Qe.id,(Qe,Pe)=>{var Ue=root_3$q(),ut=child(Ue),mt={};template_effect(Rt=>{set_text(ut,`${get$2(Pe).id??""}: ${Rt??""}...`),mt!==(mt=get$2(Pe).id)&&(Ue.value=(Ue.__value=get$2(Pe).id)??"")},[()=>get$2(Pe).text.substring(0,30)]),append(Qe,Ue)});var Oe;init_select(Y);var Ae=sibling(S,2),Fe=child(Ae),We=sibling(Fe,2);We.__change=[on_change_3,g];var Ye=child(We);Ye.value=Ye.__value="";var Je=sibling(Ye);each(Je,17,()=>e.dialogues,Qe=>Qe.id,(Qe,Pe)=>{var Ue=root_4$k(),ut=child(Ue),mt={};template_effect(Rt=>{set_text(ut,`${get$2(Pe).id??""}: ${Rt??""}...`),mt!==(mt=get$2(Pe).id)&&(Ue.value=(Ue.__value=get$2(Pe).id)??"")},[()=>get$2(Pe).text.substring(0,30)]),append(Qe,Ue)});var lt;init_select(We);var st=sibling(d,2),it=child(st),qe=sibling(it,2);qe.__change=[on_change_4,g];var Be=child(qe);Be.value=Be.__value="";var nt=sibling(Be);each(nt,17,()=>e.availableItems,Qe=>Qe.id,(Qe,Pe)=>{var Ue=root_5$n(),ut=child(Ue),mt={};template_effect(()=>{set_text(ut,get$2(Pe).name),mt!==(mt=get$2(Pe).id)&&(Ue.value=(Ue.__value=get$2(Pe).id)??"")}),append(Qe,Ue)});var at;init_select(qe),template_effect((Qe,Pe,Ue,ut)=>{set_attribute(W,"for",`option-mg-id-${e.index??""}`),set_attribute(Z,"id",`option-mg-id-${e.index??""}`),c!==(c=Qe)&&(Z.value=(Z.__value=Qe)??"",select_option(Z,Qe)),set_attribute(M,"for",`option-mg-win-${e.index??""}`),set_attribute(Y,"id",`option-mg-win-${e.index??""}`),Oe!==(Oe=Pe)&&(Y.value=(Y.__value=Pe)??"",select_option(Y,Pe)),set_attribute(Fe,"for",`option-mg-lose-${e.index??""}`),set_attribute(We,"id",`option-mg-lose-${e.index??""}`),lt!==(lt=Ue)&&(We.value=(We.__value=Ue)??"",select_option(We,Ue)),set_attribute(it,"for",`option-mg-reward-${e.index??""}`),set_attribute(qe,"id",`option-mg-reward-${e.index??""}`),at!==(at=ut)&&(qe.value=(qe.__value=ut)??"",select_option(qe,ut))},[()=>v().id,()=>v().onWinDialogueId,()=>v().onLoseDialogueId,()=>v().rewardItem||""]),append(Q,ae)};if_block(j,Q=>{v()&&Q(F)})}var U=sibling(N,2),L=child(U),X=child(L),fe=child(X),ge=sibling(L,2),re=child(ge),V=child(re),G=sibling(U,2),q=sibling(child(G),2),O=child(q),z=child(O),ce=sibling(z,2);ce.__change=[on_change_5,u],each(ce,20,()=>e.conditionTypes,Q=>Q,(Q,ae)=>{var H=root_6$f(),W=child(H),Z={};template_effect(()=>{set_text(W,ae),Z!==(Z=ae)&&(H.value=(H.__value=ae)??"")}),append(Q,H)});var he;init_select(ce);var se=sibling(O,2);{var ve=Q=>{var ae=root_7$e(),H=child(ae),W=sibling(H,2);W.__change=[on_change_6,o];var Z=child(W);Z.value=Z.__value="";var B=sibling(Z);each(B,17,()=>e.availableItems,ne=>ne.id,(ne,ye)=>{var we=root_8$b(),Ee=child(we),$e={};template_effect(()=>{set_text(Ee,get$2(ye).name),$e!==($e=get$2(ye).id)&&(we.value=(we.__value=get$2(ye).id)??"")}),append(ne,we)});var te;init_select(W),template_effect(ne=>{set_attribute(H,"for",`option-cond-item-${e.index??""}`),set_attribute(W,"id",`option-cond-item-${e.index??""}`),te!==(te=ne)&&(W.value=(W.__value=ne)??"",select_option(W,ne))},[()=>n().itemId||""]),append(Q,ae)};if_block(se,Q=>{n().type==="has_item"&&Q(ve)})}var me=sibling(se,2);{var be=Q=>{var ae=root_9$5(),H=first_child(ae),W=child(H),Z=sibling(W,2);Z.__input=[on_input$1,o];var B=sibling(H,2),te=child(B),ne=sibling(te,2);ne.__input=[on_input_1$1,o],template_effect((ye,we)=>{set_attribute(W,"for",`option-cond-stat-${e.index??""}`),set_attribute(Z,"id",`option-cond-stat-${e.index??""}`),set_value(Z,ye),set_attribute(te,"for",`option-cond-stat-val-${e.index??""}`),set_attribute(ne,"id",`option-cond-stat-val-${e.index??""}`),set_value(ne,we)},[()=>n().statName||"",()=>n().statValue||0]),append(Q,ae)};if_block(me,Q=>{n().type==="stat_greater"&&Q(be)})}var ue=sibling(me,2);{var ie=Q=>{var ae=root_10$5(),H=child(ae),W=sibling(H,2);W.__input=[on_input_2,o],template_effect(Z=>{set_attribute(H,"for",`option-cond-flag-${e.index??""}`),set_attribute(W,"id",`option-cond-flag-${e.index??""}`),set_value(W,Z)},[()=>n().flagName||""]),append(Q,ae)};if_block(ue,Q=>{n().type==="flag_true"&&Q(ie)})}var oe=sibling(q,2);if_block(oe,Q=>{}),template_effect(Q=>{set_attribute(p,"for",`option-text-${e.index??""}`),set_attribute(E,"id",`option-text-${e.index??""}`),set_attribute(x,"for",`option-next-${e.index??""}`),set_attribute(D,"id",`option-next-${e.index??""}`),set_checked(k,get$2(h)),set_attribute(z,"for",`option-cond-type-${e.index??""}`),set_attribute(ce,"id",`option-cond-type-${e.index??""}`),he!==(he=Q)&&(ce.value=(ce.__value=Q)??"",select_option(ce,Q))},[()=>n().type]),bind_value(E,()=>t().text,Q=>t().text=Q),bind_select_value(D,()=>t().nextDialogueId,Q=>t().nextDialogueId=Q),bind_checked(fe,()=>t().enabled,Q=>t().enabled=Q),bind_checked(V,()=>t().visible,Q=>t().visible=Q),append(r,m),pop()}delegate(["change","input"]);var $$_import_editor$2=reactive_import(()=>editor),$$_import_editorDerived=reactive_import(()=>editorDerived),root_2$l=from_html("<option> <!></option>"),root_4$j=from_html("<option> </option>"),root_5$m=from_html("<option> </option>"),root_6$e=from_html("<option> </option>"),root_7$d=from_html("<option> </option>"),root_13$1=from_html('<div class="option-content svelte-1e6637j"><!></div>'),root_8$a=from_html('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),root_14=from_html('<div class="empty-links svelte-1e6637j">Нет связей</div>'),on_click$d=(r,e)=>storyActions.jumpTo(get$2(e).id),root_16$1=from_html('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),root_15$1=from_html('<div class="links-list svelte-1e6637j"></div>'),root_17=from_html('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),on_click_1$7=(r,e)=>storyActions.jumpTo(get$2(e).id),root_19=from_html('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),root_20$1=from_html('<div class="more-links svelte-1e6637j"> </div>'),root_18$1=from_html('<div class="links-list svelte-1e6637j"><!> <!></div>'),root_21$1=from_html("<option> </option>"),root_1$v=from_html('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),root_22$1=from_html('<div class="empty-state">Выберите сцену</div>');function DialogueForm(r,e){push(e,!1);const t=["always","has_item","stat_greater","flag_true"];function i($){$.options||($.options=[]);const p=createNewOption();$.options.push(p),$$_import_editor$2($$_import_editor$2().editingOptionIndex=$.options.length-1)}function n($){if($$_import_editor$2().editingOptionIndex===$)$$_import_editor$2($$_import_editor$2().editingOptionIndex=null);else{$$_import_editor$2($$_import_editor$2().editingOptionIndex=$);const p=$$_import_editorDerived().currentDialogue?.options?.[$];p&&!p.visibilityCondition&&(p.visibilityCondition={type:"always"})}}function o($,p){confirm("Удалить вариант ответа?")&&($.options?.splice(p,1),$$_import_editor$2().editingOptionIndex===p?$$_import_editor$2($$_import_editor$2().editingOptionIndex=null):$$_import_editor$2().editingOptionIndex&&$$_import_editor$2().editingOptionIndex>p&&$$_import_editor$2($$_import_editor$2().editingOptionIndex--))}function u($){if(!$||!$$_import_editor$2().data)return"Нет";const p=$$_import_editor$2().data.dialogues.find(E=>E.id===$);return p?p.text.substring(0,25)+"...":`❌ ${$}`}function h(){const $=[],p=$$_import_editorDerived().currentDialogue;return p&&(p.nextDialogueId&&$.push({type:"Auto",id:p.nextDialogueId,text:u(p.nextDialogueId)}),p.options?.forEach((E,T)=>{E.nextDialogueId&&$.push({type:`Опция #${T+1}`,id:E.nextDialogueId,text:u(E.nextDialogueId)})})),$}init();var _=comment(),v=first_child(_);{var g=$=>{var p=root_1$v(),E=child(p),T=sibling(child(E),2);T.__change=c=>{const d=c.target;$$_import_editor$2($$_import_editor$2().selectedDialogueId=d.value)};var x=sibling(E,2),D=sibling(child(x),2);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{$$_import_editor$2()})}),D.__change=c=>{const d=c.target;$$_import_editor$2($$_import_editor$2().selectedChapterId=d.value)};var R=child(D);R.value=R.__value="";var P=sibling(R);each(P,1,()=>$$_import_editor$2().data.chapters||[],index$1,(c,d)=>{var S=root_2$l(),M=child(S),Y=sibling(M);{var _e=Oe=>{var Ae=text();template_effect(Fe=>set_text(Ae,`- ${Fe??""}...`),[()=>get$2(d).description.substring(0,30)]),append(Oe,Ae)};if_block(Y,Oe=>{get$2(d).description&&Oe(_e)})}var Ie={};template_effect(()=>{set_text(M,`${get$2(d).title??""} `),Ie!==(Ie=get$2(d).id)&&(S.value=(S.__value=get$2(d).id)??"")}),append(c,S)});var N=sibling(x,2),J=sibling(child(N),2),I=sibling(N,2),k=sibling(child(I),2),j=sibling(child(k),2),F=child(j);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{})});var U=child(F);U.value=U.__value="";var L=sibling(U);each(L,1,()=>$$_import_editorDerived().imageResources,index$1,(c,d)=>{var S=root_4$j(),M=child(S),Y={};template_effect(()=>{set_text(M,get$2(d).name),Y!==(Y=get$2(d).name)&&(S.value=(S.__value=get$2(d).name)??"")}),append(c,S)});var X=sibling(L);each(X,1,()=>$$_import_editorDerived().riveResources,index$1,(c,d)=>{var S=root_5$m(),M=child(S),Y={};template_effect(()=>{set_text(M,`${get$2(d).name??""} (Rive)`),Y!==(Y=get$2(d).name)&&(S.value=(S.__value=get$2(d).name)??"")}),append(c,S)});var fe=sibling(F,2),ge=sibling(child(fe));ge.__change=function(...c){resourceActions.uploadNewFile?.apply(this,c)};var re=sibling(k,2),V=sibling(child(re),2),G=child(V);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{})});var q=child(G);q.value=q.__value="";var O=sibling(q);each(O,1,()=>$$_import_editorDerived().imageResources,index$1,(c,d)=>{var S=root_6$e(),M=child(S),Y={};template_effect(()=>{set_text(M,get$2(d).name),Y!==(Y=get$2(d).name)&&(S.value=(S.__value=get$2(d).name)??"")}),append(c,S)});var z=sibling(O);each(z,1,()=>$$_import_editorDerived().riveResources,index$1,(c,d)=>{var S=root_7$d(),M=child(S),Y={};template_effect(()=>{set_text(M,`${get$2(d).name??""} (Rive)`),Y!==(Y=get$2(d).name)&&(S.value=(S.__value=get$2(d).name)??"")}),append(c,S)});var ce=sibling(I,2),he=child(ce),se=sibling(child(he),2);se.__click=()=>i($$_import_editorDerived().currentDialogue);var ve=sibling(he,2);each(ve,1,()=>$$_import_editorDerived().currentDialogue.options||[],index$1,(c,d,S)=>{var M=root_8$a();let Y;var _e=child(M),Ie=child(_e);Ie.__click=()=>n(S),Ie.__keydown=qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),n(S))},set_attribute(Ie,"aria-controls",`option-content-${S}`);var Oe=child(Ie),Ae=child(Oe);{var Fe=qe=>{var Be=text("👁️‍🗨️");append(qe,Be)},We=qe=>{var Be=comment(),nt=first_child(Be);{var at=Pe=>{var Ue=text("🔒");append(Pe,Ue)},Qe=Pe=>{var Ue=text("✅");append(Pe,Ue)};if_block(nt,Pe=>{get$2(d).enabled?Pe(Qe,!1):Pe(at)},!0)}append(qe,Be)};if_block(Ae,qe=>{get$2(d).visible?qe(We,!1):qe(Fe)})}var Ye=sibling(Oe,2),Je=child(Ye),lt=sibling(Ie,2);lt.__click=()=>o($$_import_editorDerived().currentDialogue,S);var st=sibling(_e,2);{var it=qe=>{var Be=root_13$1();set_attribute(Be,"id",`option-content-${S}`);var nt=child(Be);OptionEditor(nt,{get option(){return get$2(d)},index:S,get dialogues(){return $$_import_editor$2().data.dialogues},get availableItems(){return $$_import_editorDerived().availableItems},get conditionTypes(){return t}}),append(qe,Be)};if_block(st,qe=>{$$_import_editor$2().editingOptionIndex===S&&qe(it)})}template_effect(qe=>{Y=set_class(M,1,"option-card svelte-1e6637j",null,Y,qe),set_attribute(Ie,"aria-expanded",$$_import_editor$2().editingOptionIndex===S),set_text(Je,`#${S+1} ${get$2(d).text??""}`)},[()=>({editing:$$_import_editor$2().editingOptionIndex===S})]),append(c,M)});var me=sibling(ce,2),be=child(me),ue=child(be),ie=child(ue),oe=child(ie),Q=sibling(ie,2);{var ae=c=>{var d=root_14();append(c,d)},H=c=>{var d=root_15$1();each(d,5,h,index$1,(S,M)=>{var Y=root_16$1(),_e=child(Y),Ie=child(_e),Oe=sibling(_e,2),Ae=child(Oe),Fe=sibling(Oe,2);Fe.__click=[on_click$d,M];var We=sibling(Fe,2),Ye=child(We);template_effect(()=>{set_text(Ie,`${get$2(M).type??""}:`),set_text(Ae,get$2(M).id),set_text(Ye,get$2(M).text)}),append(S,Y)}),append(c,d)};if_block(Q,c=>{h().length===0?c(ae):c(H,!1)})}var W=sibling(ue,2),Z=child(W),B=child(Z),te=sibling(Z,2);{var ne=c=>{var d=root_17();append(c,d)},ye=c=>{var d=root_18$1(),S=child(d);each(S,1,()=>$$_import_editorDerived().backlinks.slice(0,5),index$1,(_e,Ie)=>{const Oe=derived_safe_equal(()=>storyActions.getLinkType(get$2(Ie),$$_import_editorDerived().currentDialogue.id));var Ae=root_19(),Fe=child(Ae),We=child(Fe),Ye=sibling(Fe,2);let Je;var lt=child(Ye),st=sibling(Ye,2);st.__click=[on_click_1$7,Ie];var it=sibling(st,2),qe=child(it);template_effect((Be,nt)=>{set_text(We,get$2(Ie).id),Je=set_class(Ye,1,"link-type-badge svelte-1e6637j",null,Je,Be),set_text(lt,get$2(Oe)),set_text(qe,`${nt??""}...`)},[()=>({"link-auto":get$2(Oe)==="Auto","link-option":get$2(Oe)==="Option"}),()=>get$2(Ie).text.substring(0,20)]),append(_e,Ae)});var M=sibling(S,2);{var Y=_e=>{var Ie=root_20$1(),Oe=child(Ie);template_effect(()=>set_text(Oe,`...ещё ${$$_import_editorDerived().backlinks.length-5}`)),append(_e,Ie)};if_block(M,_e=>{$$_import_editorDerived().backlinks.length>5&&_e(Y)})}append(c,d)};if_block(te,c=>{$$_import_editorDerived().backlinks.length===0?c(ne):c(ye,!1)})}var we=sibling(me,2),Ee=sibling(child(we),2);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{$$_import_editor$2()})});var $e=child(Ee);$e.value=$e.__value="";var Ce=sibling($e);each(Ce,1,()=>$$_import_editor$2().data.dialogues,index$1,(c,d)=>{var S=root_21$1(),M=child(S),Y={};template_effect(_e=>{set_text(M,`${get$2(d).id??""}: ${_e??""}...`),Y!==(Y=get$2(d).id)&&(S.value=(S.__value=get$2(d).id)??"")},[()=>get$2(d).text.substring(0,30)]),append(c,S)});var Le=sibling(we,2),w=child(Le);w.__click=()=>storyActions.deleteDialogue($$_import_editorDerived().currentDialogue.id),template_effect(c=>{set_text(oe,`👉 Куда ведет (${c??""})`),set_text(B,`👈 Откуда ведут (${$$_import_editorDerived().backlinks.length??""})`)},[()=>h().length]),bind_value(T,()=>$$_import_editorDerived().currentDialogue.id,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.id=c)),bind_select_value(D,()=>$$_import_editorDerived().currentDialogue.chapterId,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.chapterId=c)),bind_value(J,()=>$$_import_editorDerived().currentDialogue.text,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.text=c)),bind_select_value(F,()=>$$_import_editorDerived().currentDialogue.backgroundImage,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.backgroundImage=c)),bind_select_value(G,()=>$$_import_editorDerived().currentDialogue.characterImage,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.characterImage=c)),bind_select_value(Ee,()=>$$_import_editorDerived().currentDialogue.nextDialogueId,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.nextDialogueId=c)),append($,p)},m=$=>{var p=root_22$1();append($,p)};if_block(v,$=>{$$_import_editorDerived().currentDialogue?$(g):$(m,!1)})}append(r,_),pop()}delegate(["change","click","keydown"]);var $$_import_editor$1=reactive_import(()=>editor),root_4$i=from_html('<img class="icon-preview svelte-asgatj"/>'),root_5$l=from_html('<div class="icon-placeholder svelte-asgatj">📦</div>'),root_7$c=from_html("<option> </option>"),root_8$9=from_html('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),root_9$4=from_html("<option> </option>"),root_6$d=from_html('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),root_3$p=from_html('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),root_2$k=from_html('<div class="items-list svelte-asgatj"></div>'),root_10$4=from_html('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),root_1$u=from_html('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),root$e=from_html('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function ItemsManager(r,e){push(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function i(){if(!$$_import_editor$1().data)return;$$_import_editor$1().data.items||$$_import_editor$1($$_import_editor$1().data.items=[]);const x={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};$$_import_editor$1().data.items.push(x),$$_import_editor$1($$_import_editor$1().editingItemIndex=$$_import_editor$1().data.items.length-1)}function n(x){$$_import_editor$1().editingItemIndex===x?$$_import_editor$1($$_import_editor$1().editingItemIndex=null):$$_import_editor$1($$_import_editor$1().editingItemIndex=x)}function o(x){confirm("Удалить предмет?")&&$$_import_editor$1().data?.items&&($$_import_editor$1().data.items.splice(x,1),$$_import_editor$1($$_import_editor$1().editingItemIndex=null))}function u(x){if(!$$_import_editor$1().data?.items)return;const D=$$_import_editor$1().data.items[x],R={...D,id:`${D.id}_copy_${Date.now()}`,name:`${D.name} (копия)`};$$_import_editor$1().data.items.splice(x+1,0,R),$$_import_editor$1($$_import_editor$1().editingItemIndex=x+1)}function h(x){return t.find(D=>D.value===x)?.label||x}init();var _=root$e(),v=child(_);v.__click=()=>$$_import_editor$1($$_import_editor$1().showItems=!$$_import_editor$1().showItems);var g=child(v),m=sibling(child(g)),$=sibling(g,2),p=child($),E=sibling(v,2);{var T=x=>{var D=root_1$u(),R=child(D);{var P=I=>{var k=root_2$k();each(k,7,()=>$$_import_editor$1().data.items,j=>j.id,(j,F,U)=>{var L=root_3$p();let X;var fe=child(L);fe.__click=()=>n(get$2(U));var ge=child(fe),re=child(ge),V=child(re);{var G=te=>{var ne=root_4$i();template_effect(()=>{set_attribute(ne,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(F).icon}`),set_attribute(ne,"alt",get$2(F).name)}),append(te,ne)},q=te=>{var ne=root_5$l();append(te,ne)};if_block(V,te=>{get$2(F).icon?te(G):te(q,!1)})}var O=sibling(re,2),z=child(O),ce=child(z),he=sibling(z,2),se=child(he),ve=child(se),me=sibling(se,2);let be;var ue=child(me),ie=sibling(ge,2),oe=child(ie),Q=sibling(fe,2),ae=child(Q);ae.__click=()=>u(get$2(U));var H=sibling(ae,2);H.__click=()=>n(get$2(U));var W=sibling(H,2);W.__click=()=>o(get$2(U));var Z=sibling(Q,2);{var B=te=>{var ne=root_6$d(),ye=child(ne),we=child(ye),Ee=child(we),$e=sibling(Ee,2),Ce=sibling(we,2),Le=child(Ce),w=sibling(Le,2),c=sibling(Ce,2),d=child(c),S=sibling(d,2),M=sibling(c,2),Y=child(M),_e=sibling(Y,2),Ie=child(_e),Oe=sibling(Ie,2);Oe.__change=Be=>{const nt=Be.target;get$2(F).icon=nt.value,invalidate_inner_signals(()=>$$_import_editor$1())};var Ae=child(Oe);Ae.value=Ae.__value="";var Fe=sibling(Ae);each(Fe,1,()=>$$_import_editor$1().storedFiles.filter(Be=>Be.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),index$1,(Be,nt)=>{var at=root_7$c(),Qe=child(at),Pe={};template_effect(()=>{set_text(Qe,get$2(nt).name),Pe!==(Pe=get$2(nt).name)&&(at.value=(at.__value=get$2(nt).name)??"")}),append(Be,at)});var We=sibling(Oe,2),Ye=sibling(child(We));Ye.__change=function(...Be){resourceActions.uploadNewFile?.apply(this,Be)};var Je=sibling(_e,2);{var lt=Be=>{var nt=root_8$9(),at=child(nt),Qe=sibling(at,2),Pe=child(Qe);template_effect(()=>{set_attribute(at,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(F).icon}`),set_text(Pe,get$2(F).icon)}),append(Be,nt)};if_block(Je,Be=>{get$2(F).icon&&Be(lt)})}var st=sibling(M,2),it=child(st),qe=sibling(it,2);template_effect(()=>{get$2(F),invalidate_inner_signals(()=>{get$2(U)})}),each(qe,5,()=>t,index$1,(Be,nt)=>{var at=root_9$4(),Qe=child(at),Pe={};template_effect(()=>{set_text(Qe,get$2(nt).label),Pe!==(Pe=get$2(nt).value)&&(at.value=(at.__value=get$2(nt).value)??"")}),append(Be,at)}),template_effect(()=>{set_attribute(Ee,"for",`item-id-${get$2(U)??""}`),set_attribute($e,"id",`item-id-${get$2(U)??""}`),set_attribute(Le,"for",`item-name-${get$2(U)??""}`),set_attribute(w,"id",`item-name-${get$2(U)??""}`),set_attribute(d,"for",`item-desc-${get$2(U)??""}`),set_attribute(S,"id",`item-desc-${get$2(U)??""}`),set_attribute(Y,"for",`item-icon-${get$2(U)??""}`),set_attribute(Ie,"id",`item-icon-${get$2(U)??""}`),set_attribute(it,"for",`item-type-${get$2(U)??""}`),set_attribute(qe,"id",`item-type-${get$2(U)??""}`)}),bind_value($e,()=>get$2(F).id,Be=>(get$2(F).id=Be,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(w,()=>get$2(F).name,Be=>(get$2(F).name=Be,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(S,()=>get$2(F).description,Be=>(get$2(F).description=Be,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(Ie,()=>get$2(F).icon,Be=>(get$2(F).icon=Be,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_select_value(qe,()=>get$2(F).type,Be=>(get$2(F).type=Be,invalidate_inner_signals(()=>$$_import_editor$1()))),append(te,ne)};if_block(Z,te=>{$$_import_editor$1().editingItemIndex===get$2(U)&&te(B)})}template_effect((te,ne,ye)=>{X=set_class(L,1,"item-row svelte-asgatj",null,X,te),set_attribute(fe,"aria-label",`Редактировать предмет ${get$2(F).name??""}`),set_text(ce,get$2(F).name),set_text(ve,get$2(F).id),be=set_class(me,1,"item-type-badge svelte-asgatj",null,be,ne),set_text(ue,ye),set_text(oe,`${get$2(F).description??""} || `)},[()=>({editing:$$_import_editor$1().editingItemIndex===get$2(U)}),()=>({tool:get$2(F).type==="tool",key:get$2(F).type==="key",consumable:get$2(F).type==="consumable",quest:get$2(F).type==="quest",misc:get$2(F).type==="misc"}),()=>h(get$2(F).type)]),append(j,L)}),append(I,k)},N=I=>{var k=root_10$4();append(I,k)};if_block(R,I=>{$$_import_editor$1().data?.items?.length?I(P):I(N,!1)})}var J=sibling(R,2);J.__click=i,append(x,D)};if_block(E,x=>{$$_import_editor$1().showItems&&x(T)})}template_effect(()=>{set_attribute(v,"title",$$_import_editor$1().showItems?"Скрыть предметы":"Показать предметы"),set_attribute(v,"aria-expanded",$$_import_editor$1().showItems),set_text(m,` Предметы (${($$_import_editor$1().data?.items?.length||0)??""})`),set_text(p,$$_import_editor$1().showItems?"▼":"▶")}),append(r,_),pop()}delegate(["click","change"]);delegate(["click"]);const authStateObj=proxy({user:null,session:null,profile:null,loading:!0,initialized:!1}),user=user_derived(()=>authStateObj.user),session=user_derived(()=>authStateObj.session),profile=user_derived(()=>authStateObj.profile),isAuthenticated=user_derived(()=>get$2(session)!==null&&get$2(user)!==null),isAuthor=user_derived(()=>get$2(profile)?.is_author??!1),isAdmin=user_derived(()=>get$2(profile)?.is_admin??!1);async function initAuth(){try{authStateObj.loading=!0;const{data:{session:r}}=await supabase.auth.getSession();authStateObj.session=r,authStateObj.user=r?.user??null,r?.user&&await loadProfile(r.user.id),supabase.auth.onAuthStateChange(async(e,t)=>{console.log("[Auth] State change:",e,t?.user?.email),authStateObj.session=t,authStateObj.user=t?.user??null,t?.user?await loadProfile(t.user.id):authStateObj.profile=null})}catch(r){console.error("[Auth] Init error:",r)}finally{authStateObj.loading=!1,authStateObj.initialized=!0}}async function loadProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").select("*").eq("user_id",r).single();if(t){t.code==="PGRST116"?(console.log("[Auth] Profile not found, creating..."),await createProfile(r)):console.error("[Auth] Error loading profile:",t);return}authStateObj.profile=e,console.log("[Auth] Profile loaded:",e)}catch(e){console.error("[Auth] Error in loadProfile:",e)}}async function createProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").insert([{user_id:r,is_author:!1,is_admin:!1}]).select().single();if(t){console.error("[Auth] Error creating profile:",t);return}authStateObj.profile=e}catch(e){console.error("[Auth] Error in createProfile:",e)}}async function signIn(r,e){if(!r||!r.trim())return{success:!1,error:"Email не может быть пустым"};if(!e||!e.trim())return{success:!1,error:"Пароль не может быть пустым"};authStateObj.loading=!0;try{console.log("[Auth] Attempting sign in for:",r);const{data:t,error:i}=await supabase.auth.signInWithPassword({email:r.trim().toLowerCase(),password:e.trim()});return i?(console.error("[Auth] Sign in error:",i),i.status===400||i.status===422?{success:!1,error:"Неверный email или пароль"}:i.message?.includes("Email not confirmed")?{success:!1,error:"Email не подтвержден. Проверьте почту."}:{success:!1,error:i.message}):(console.log("[Auth] Sign in successful:",t.user?.email),authStateObj.session=t.session,authStateObj.user=t.user,t.user&&await loadProfile(t.user.id),{success:!0})}catch(t){return console.error("[Auth] Sign in exception:",t),{success:!1,error:"Произошла ошибка при входе"}}finally{authStateObj.loading=!1}}async function signOut(){authStateObj.loading=!0;try{const{error:r}=await supabase.auth.signOut();r&&console.error("[Auth] Error signing out:",r),authStateObj.user=null,authStateObj.session=null,authStateObj.profile=null,console.log("[Auth] Signed out successfully")}finally{authStateObj.loading=!1}}async function signUp(r,e,t){authStateObj.loading=!0;try{const{data:i,error:n}=await supabase.auth.signUp({email:r,password:e,options:{data:{username:t||r.split("@")[0]},emailRedirectTo:`${window.location.origin}/auth/callback`}});return n?n.status===429||n.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:n.message}:{success:!0,needsEmailConfirmation:i.user?.identities?.length===0||i.user?.email_confirmed_at===null}}catch(i){return{success:!1,error:i.message}}finally{authStateObj.loading=!1}}async function resetPassword(r){try{const e=`${window.location.origin}/reset-password`;console.log("[Auth] Sending reset email to:",r);const{data:t,error:i}=await supabase.auth.resetPasswordForEmail(r,{redirectTo:e});return i?(console.error("[Auth] Reset password error:",i),i.status===429||i.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:i.message}):(console.log("[Auth] Reset email sent:",t),{success:!0})}catch(e){return console.error("[Auth] Reset password exception:",e),{success:!1,error:e.message}}}const authState={get user(){return authStateObj.user},get session(){return authStateObj.session},get profile(){return authStateObj.profile},get loading(){return authStateObj.loading},get initialized(){return authStateObj.initialized}},authDerivedState={get isAuthenticated(){return get$2(isAuthenticated)},get isAuthor(){return get$2(isAuthor)},get isAdmin(){return get$2(isAdmin)}},stories=proxy({stories:[],loading:!1,initialized:!1}),FALLBACK_STORIES=[{id:"dracula",created_at:new Date().toISOString(),title:"Дракула",author_id:null,json_url:"dracula_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"dracula"},{id:"zombie",created_at:new Date().toISOString(),title:"Выживание",author_id:null,json_url:"zombie_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"zombie"},{id:"fairy_tale",created_at:new Date().toISOString(),title:"Сказка",author_id:null,json_url:"fairy_tale_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"fairy_tale"},{id:"minigames",created_at:new Date().toISOString(),title:"Мини-игры",author_id:null,json_url:"minigames_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"minigames"}];function getPublicStories(){if(console.log("[getPublicStories] initialized:",stories.initialized,"stories.length:",stories.stories.length),!stories.initialized||stories.stories.length===0)return console.log("[getPublicStories] Возвращаем fallback, count:",FALLBACK_STORIES.length),FALLBACK_STORIES;const r=stories.stories.filter(e=>e.is_public);return console.log("[getPublicStories] Публичных историй:",r.length),r}function getPlayerStories(){const r=authState.user?.id;if(!r){const t=getPublicStories(),i=t.length>0?t:FALLBACK_STORIES;return console.log("[getPlayerStories] Гость, результат:",i.length),i}const e=stories.stories.filter(t=>t.is_public||t.allowed_players&&t.allowed_players.includes(r));return console.log("[getPlayerStories] Авторизован, результат:",e.length),e}function getStoryById(r){const e=stories.stories.find(t=>t.id===r);return e||FALLBACK_STORIES.find(t=>t.id===r)}function getStoryByBucket(r){const e=stories.stories.find(t=>t.bucket===r);return e||FALLBACK_STORIES.find(t=>t.bucket===r)}function getAuthorStories(){const r=authState.user?.id;return r&&authState.profile?.is_admin?stories.stories:stories.stories.filter(e=>e.author_id===r)}async function loadStories(){console.log("[storiesStore] loadStories начало"),stories.loading=!0;try{if(console.log("[storiesStore] Загрузка историй из таблицы..."),!navigator.onLine){console.log("[storiesStore] Нет сети - используем fallback"),stories.stories=[],stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories завершено (офлайн)");return}const{data:r,error:e}=await supabase.from("stories").select("*").order("created_at",{ascending:!1});e?(console.error("[storiesStore] Error loading stories:",e),console.log("[storiesStore] Используем fallback истории"),stories.stories=[]):(console.log("[storiesStore] Загружено историй из БД:",r?.length||0),stories.stories=r||[])}catch(r){console.error("[storiesStore] Exception loading stories:",r),console.log("[storiesStore] Используем fallback истории"),stories.stories=[]}stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories завершено. Историй в сторе:",stories.stories.length)}async function createStory(r,e="stories"){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const t=`${r.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}.json`,n=JSON.stringify({meta:{version:"3.1",title:r},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало истории...",options:[]}],items:[],miniGames:[]},null,2),u=new TextEncoder().encode(n),{error:h}=await supabase.storage.from(e).upload(t,u,{contentType:"application/json"});if(h)return{success:!1,error:h.message};const _=t,{data:v,error:g}=await supabase.from("stories").insert({title:r,author_id:authState.user.id,json_url:_,bucket:e,is_public:!1,allowed_players:[]}).select().single();return g?{success:!1,error:g.message}:(await loadStories(),{success:!0,story:v})}catch(t){return{success:!1,error:t.message}}}async function updateStory(r,e){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const{error:t}=await supabase.from("stories").update(e).eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(t){return{success:!1,error:t.message}}}async function deleteStory(r){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const e=stories.stories.find(i=>i.id===r);if(!e)return{success:!1,error:"История не найдена"};if(e.json_url){const[i,...n]=e.json_url.split("/"),o=n.join("/");await supabase.storage.from(i).remove([o])}const{error:t}=await supabase.from("stories").delete().eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(e){return{success:!1,error:e.message}}}async function loadStoryJson(r){try{const e=r.bucket||"stories",i=r.json_url.split("/").pop()||"story.json";console.log(`[storiesStore] Загрузка истории "${r.title}" из bucket: ${e}, файл: ${i}`);const{data:n,error:o}=await supabase.storage.from(e).download(i);if(o){console.error("[storiesStore] Error downloading story:",o.message);const _=`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${e}/${i}`;console.log("[storiesStore] Пробуем fallback URL:",_);try{const v=await fetch(_);if(!v.ok)throw new Error(`HTTP ${v.status}`);const g=await v.json();return console.log("[storiesStore] Загружено через fallback URL"),g}catch(v){console.error("[storiesStore] Fallback also failed:",v);const g=`/stories/${i}`;console.log("[storiesStore] Пробуем локальный URL:",g);try{const m=await fetch(g);if(m.ok)return await m.json()}catch{console.error("[storiesStore] Локальный fallback тоже не работает")}return null}}const u=await n.text(),h=JSON.parse(u);return console.log("[storiesStore] История загружена успешно"),h}catch(e){return console.error("[storiesStore] Error loading story JSON:",e),null}}const storiesState=stories;class GameState{#s=state(proxy({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return get$2(this.#s)}set player(e){set(this.#s,e,!0)}#i=state(null);get storyData(){return get$2(this.#i)}set storyData(e){set(this.#i,e,!0)}#e=state("0");get currentDialogueId(){return get$2(this.#e)}set currentDialogueId(e){set(this.#e,e,!0)}#a=state(!0);get isLoading(){return get$2(this.#a)}set isLoading(e){set(this.#a,e,!0)}#o=state("");get error(){return get$2(this.#o)}set error(e){set(this.#o,e,!0)}#t=state(null);get selectedStory(){return get$2(this.#t)}set selectedStory(e){set(this.#t,e,!0)}#n=state(null);get selectedStoryData(){return get$2(this.#n)}set selectedStoryData(e){set(this.#n,e,!0)}#r=state(null);get urlStoryId(){return get$2(this.#r)}set urlStoryId(e){set(this.#r,e,!0)}get availableStories(){return getPlayerStories()}async initStories(){console.log("[GameState] initStories начало");try{const t=new URLSearchParams(window.location.search).get("story");t&&(this.urlStoryId=t,console.log("[GameState] URL параметр story:",t))}catch{console.log("[GameState] Нет window.location (SSR?)")}storiesState.initialized?console.log("[GameState] Истории уже загружены"):(console.log("[GameState] Загружаем истории..."),await loadStories(),console.log("[GameState] Истории загружены, initialized:",storiesState.initialized)),this.urlStoryId&&(console.log("[GameState] Выбираем историю:",this.urlStoryId),this.selectStoryById(this.urlStoryId)),console.log("[GameState] initStories завершено")}selectStoryById(e){console.log("[GameState] selectStoryById:",e),console.log("[GameState] storiesState.stories:",storiesState.stories?.length||0),console.log("[GameState] storiesState.initialized:",storiesState.initialized);let t=storiesState.stories?.find(i=>i?.id===e);if(console.log("[GameState] Найдена в БД:",t?.title),!t){const n=[{id:"dracula",title:"Дракула",bucket:"dracula",json_url:"dracula_story.json"},{id:"zombie",title:"Выживание",bucket:"zombie",json_url:"zombie_story.json"},{id:"fairy_tale",title:"Сказка",bucket:"fairy_tale",json_url:"fairy_tale_story.json"},{id:"minigames",title:"Мини-игры",bucket:"minigames",json_url:"minigames_story.json"}].find(o=>o.id===e);n&&(t={id:n.id,title:n.title,bucket:n.bucket,json_url:n.json_url,created_at:new Date().toISOString(),author_id:null,preview_image_url:null,is_public:!0,allowed_players:[]}),console.log("[GameState] Найдена в fallback:",t?.title)}return t&&t.id?(this.selectedStory=t.id,this.selectedStoryData=t,console.log("[GameState] Выбрана история:",t.title),!0):(console.warn("[GameState] История не найдена:",e),!1)}getStoryById(e){return storiesState.stories.find(t=>t.id===e)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();this.storyData=i,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const i=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${i}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const gameState=new GameState;var rive$1={exports:{}},rive=rive$1.exports,hasRequiredRive;function requireRive(){return hasRequiredRive||(hasRequiredRive=1,(function(r,e){(function(i,n){r.exports=n()})(rive,()=>(()=>{var t=[,((u,h,_)=>{_.r(h),_.d(h,{default:()=>g});var v=(()=>{var m=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function($={}){var p=$,E,T;p.ready=new Promise((s,l)=>{E=s,T=l});function x(){function s(K){const de=y;f=l=0,y=new Map,de.forEach(pe=>{try{pe(K)}catch(le){console.error(le)}}),this.pb(),A&&A.Tb()}let l=0,f=0,y=new Map,A=null,C=null;this.requestAnimationFrame=function(K){l||(l=requestAnimationFrame(s.bind(this)));const de=++f;return y.set(de,K),de},this.cancelAnimationFrame=function(K){y.delete(K),l&&y.size==0&&(cancelAnimationFrame(l),l=0)},this.Rb=function(K){C&&(document.body.remove(C),C=null),K||(C=document.createElement("div"),C.style.backgroundColor="black",C.style.position="fixed",C.style.right=0,C.style.top=0,C.style.color="white",C.style.padding="4px",C.innerHTML="RIVE FPS",K=function(de){C.innerHTML="RIVE FPS "+de.toFixed(1)},document.body.appendChild(C)),A=new function(){let de=0,pe=0;this.Tb=function(){var le=performance.now();pe?(++de,le-=pe,1e3<le&&(K(1e3*de/le),de=pe=0)):(pe=le,de=0)}}},this.Ob=function(){C&&(document.body.remove(C),C=null),A=null},this.pb=function(){}}function D(s){console.assert(!0);const l=new Map;let f=-1/0;this.push=function(y){return y=y+((1<<s)-1)>>s,l.has(y)&&clearTimeout(l.get(y)),l.set(y,setTimeout(function(){l.delete(y),l.length==0?f=-1/0:y==f&&(f=Math.max(...l.keys()),console.assert(f<y))},1e3)),f=Math.max(y,f),f<<s}}const R=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){R&&R();let s=p.decodeAudio;p.decodeAudio=function(A,C){A=s(A),C(A)};let l=p.decodeFont;p.decodeFont=function(A,C){A=l(A),C(A)};const f=p.FileAssetLoader;p.ptrToAsset=A=>{let C=p.ptrToFileAsset(A);return C.isImage?p.ptrToImageAsset(A):C.isFont?p.ptrToFontAsset(A):C.isAudio?p.ptrToAudioAsset(A):C},p.CustomFileAssetLoader=f.extend("CustomFileAssetLoader",{__construct:function({loadContents:A}){this.__parent.__construct.call(this),this.Gb=A},loadContents:function(A,C){return A=p.ptrToAsset(A),this.Gb(A,C)}}),p.CDNFileAssetLoader=f.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(A){let C=p.ptrToAsset(A);return A=C.cdnUuid,A===""?!1:((function(K,de){var pe=new XMLHttpRequest;pe.responseType="arraybuffer",pe.onreadystatechange=function(){pe.readyState==4&&pe.status==200&&de(pe)},pe.open("GET",K,!0),pe.send(null)})(C.cdnBaseUrl+"/"+A,K=>{C.decode(new Uint8Array(K.response))}),!0)}}),p.FallbackFileAssetLoader=f.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(A){this.lb.push(A)},loadContents:function(A,C){for(let K of this.lb)if(K.loadContents(A,C))return!0;return!1}});let y=p.computeAlignment;p.computeAlignment=function(A,C,K,de,pe=1){return y.call(this,A,C,K,de,pe)}};const P="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),N=new function(){function s(){if(!l){let Ve=function(ze,je,ot){if(je=ke.createShader(je),ke.shaderSource(je,ot),ke.compileShader(je),ot=ke.getShaderInfoLog(je),0<(ot||"").length)throw ot;ke.attachShader(ze,je)};var ee=document.createElement("canvas"),Te={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let ke;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(ke=ee.getContext("webgl",Te),f=1,!ke)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(ke=ee.getContext("webgl2",Te))f=2;else if(ke=ee.getContext("webgl",Te))f=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(ke=new Proxy(ke,{get(ze,je){if(ze.isContextLost()){if(pe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",je),pe=!0),typeof ze[je]=="function")return function(){}}else return typeof ze[je]=="function"?function(...ot){return ze[je].apply(ze,ot)}:ze[je]},set(ze,je,ot){if(ze.isContextLost())pe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+je),pe=!0);else return ze[je]=ot,!0}}),y=Math.min(ke.getParameter(ke.MAX_RENDERBUFFER_SIZE),ke.getParameter(ke.MAX_TEXTURE_SIZE)),ee=ke.createProgram(),Ve(ee,ke.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ve(ee,ke.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),ke.bindAttribLocation(ee,0,"vertex"),ke.bindAttribLocation(ee,1,"uv"),ke.linkProgram(ee),Te=ke.getProgramInfoLog(ee),0<(Te||"").trim().length)throw Te;A=ke.getUniformLocation(ee,"mat"),C=ke.getUniformLocation(ee,"translate"),ke.useProgram(ee),ke.bindBuffer(ke.ARRAY_BUFFER,ke.createBuffer()),ke.enableVertexAttribArray(0),ke.enableVertexAttribArray(1),ke.bindBuffer(ke.ELEMENT_ARRAY_BUFFER,ke.createBuffer()),ke.uniform1i(ke.getUniformLocation(ee,"image"),0),ke.pixelStorei(ke.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),l=ke}return!0}let l=null,f=0,y=0,A=null,C=null,K=0,de=0,pe=!1;s(),this.hc=function(){return s(),y},this.Mb=function(ee){l.deleteTexture&&l.deleteTexture(ee)},this.Lb=function(ee){if(!s())return null;const Te=l.createTexture();return Te?(l.bindTexture(l.TEXTURE_2D,Te),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,ee),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),f==2?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.generateMipmap(l.TEXTURE_2D)):l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),Te):null};const le=new D(8),xe=new D(8),Re=new D(10),De=new D(10);this.Qb=function(ee,Te,ke,Ve,ze){if(s()){var je=le.push(ee),ot=xe.push(Te);if(l.canvas){(l.canvas.width!=je||l.canvas.height!=ot)&&(l.canvas.width=je,l.canvas.height=ot),l.viewport(0,ot-Te,ee,Te),l.disable(l.SCISSOR_TEST),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.enable(l.SCISSOR_TEST),ke.sort((Ze,kt)=>kt.xb-Ze.xb),je=Re.push(Ve),K!=je&&(l.bufferData(l.ARRAY_BUFFER,8*je,l.DYNAMIC_DRAW),K=je),je=0;for(var ht of ke)l.bufferSubData(l.ARRAY_BUFFER,je,ht.Ua),je+=4*ht.Ua.length;console.assert(je==4*Ve);for(var St of ke)l.bufferSubData(l.ARRAY_BUFFER,je,St.Db),je+=4*St.Db.length;console.assert(je==8*Ve),je=De.push(ze),de!=je&&(l.bufferData(l.ELEMENT_ARRAY_BUFFER,2*je,l.DYNAMIC_DRAW),de=je),ht=0;for(var Dt of ke)l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,ht,Dt.indices),ht+=2*Dt.indices.length;console.assert(ht==2*ze),Dt=0,St=!0,je=ht=0;for(const Ze of ke){Ze.image.Ka!=Dt&&(l.bindTexture(l.TEXTURE_2D,Ze.image.Ja||null),Dt=Ze.image.Ka),Ze.mc?(l.scissor(Ze.Za,ot-Ze.$a-Ze.kb,Ze.Ac,Ze.kb),St=!0):St&&(l.scissor(0,ot-Te,ee,Te),St=!1),ke=2/ee;const kt=-2/Te;l.uniform4f(A,Ze.ha[0]*ke*Ze.Ba,Ze.ha[1]*kt*Ze.Ca,Ze.ha[2]*ke*Ze.Ba,Ze.ha[3]*kt*Ze.Ca),l.uniform2f(C,Ze.ha[4]*ke*Ze.Ba+ke*(Ze.Za-Ze.ic*Ze.Ba)-1,Ze.ha[5]*kt*Ze.Ca+kt*(Ze.$a-Ze.jc*Ze.Ca)+1),l.vertexAttribPointer(0,2,l.FLOAT,!1,0,je),l.vertexAttribPointer(1,2,l.FLOAT,!1,0,je+4*Ve),l.drawElements(l.TRIANGLES,Ze.indices.length,l.UNSIGNED_SHORT,ht),je+=4*Ze.Ua.length,ht+=2*Ze.indices.length}console.assert(je==4*Ve),console.assert(ht==2*ze)}}},this.canvas=function(){return s()&&l.canvas}},J=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function s(Se){switch(Se){case le.srcOver:return"source-over";case le.screen:return"screen";case le.overlay:return"overlay";case le.darken:return"darken";case le.lighten:return"lighten";case le.colorDodge:return"color-dodge";case le.colorBurn:return"color-burn";case le.hardLight:return"hard-light";case le.softLight:return"soft-light";case le.difference:return"difference";case le.exclusion:return"exclusion";case le.multiply:return"multiply";case le.hue:return"hue";case le.saturation:return"saturation";case le.color:return"color";case le.luminosity:return"luminosity"}}function l(Se){return"rgba("+((16711680&Se)>>>16)+","+((65280&Se)>>>8)+","+((255&Se)>>>0)+","+((4278190080&Se)>>>24)/255+")"}function f(){0<ot.length&&(N.Qb(je.drawWidth(),je.drawHeight(),ot,ht,St),ot=[],St=ht=0,je.reset(512,512));for(const Se of ze){for(const Me of Se.H)Me();Se.H=[]}ze.clear()}J&&J();var y=p.RenderPaintStyle;const A=p.RenderPath,C=p.RenderPaint,K=p.Renderer,de=p.StrokeCap,pe=p.StrokeJoin,le=p.BlendMode,xe=y.fill,Re=y.stroke,De=p.FillRule.evenOdd;let ee=1;var Te=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:Se,xa:Me}={}){this.__parent.__construct.call(this),this.Ka=ee,ee=ee+1&2147483647||1,this.la=Se,this.xa=Me},__destruct:function(){this.Ja&&(N.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(Se){var Me=this;Me.xa&&Me.xa(Me);var Ke=new Image;Me.Xa=URL.createObjectURL(new Blob([Se],{type:"image/png"})),Ke.onload=function(){Me.Fb=Ke,Me.Ja=N.Lb(Ke),Me.size(Ke.width,Ke.height),Me.la&&Me.la(Me)},Ke.src=Me.Xa}}),ke=A.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(Se,Me,Ke,et,He,Xe,tt){var rt=this.T,$t=rt.addPath;Se=Se.T;const dt=new DOMMatrix;dt.a=Me,dt.b=Ke,dt.c=et,dt.d=He,dt.e=Xe,dt.f=tt,$t.call(rt,Se,dt)},fillRule:function(Se){this.Wa=Se},moveTo:function(Se,Me){this.T.moveTo(Se,Me)},lineTo:function(Se,Me){this.T.lineTo(Se,Me)},cubicTo:function(Se,Me,Ke,et,He,Xe){this.T.bezierCurveTo(Se,Me,Ke,et,He,Xe)},close:function(){this.T.closePath()}}),Ve=C.extend("CanvasRenderPaint",{color:function(Se){this.Ya=l(Se)},thickness:function(Se){this.Ib=Se},join:function(Se){switch(Se){case pe.miter:this.Ia="miter";break;case pe.round:this.Ia="round";break;case pe.bevel:this.Ia="bevel"}},cap:function(Se){switch(Se){case de.butt:this.Ha="butt";break;case de.round:this.Ha="round";break;case de.square:this.Ha="square"}},style:function(Se){this.Hb=Se},blendMode:function(Se){this.Eb=s(Se)},clearGradient:function(){this.ja=null},linearGradient:function(Se,Me,Ke,et){this.ja={zb:Se,Ab:Me,cb:Ke,eb:et,Ra:[]}},radialGradient:function(Se,Me,Ke,et){this.ja={zb:Se,Ab:Me,cb:Ke,eb:et,Ra:[],ec:!0}},addStop:function(Se,Me){this.ja.Ra.push({color:Se,stop:Me})},completeGradient:function(){},draw:function(Se,Me,Ke){let et=this.Hb;var He=this.Ya,Xe=this.ja;if(Se.globalCompositeOperation=this.Eb,Xe!=null){He=Xe.zb;var tt=Xe.Ab;const $t=Xe.cb;var rt=Xe.eb;const dt=Xe.Ra;Xe.ec?(Xe=$t-He,rt-=tt,He=Se.createRadialGradient(He,tt,0,He,tt,Math.sqrt(Xe*Xe+rt*rt))):He=Se.createLinearGradient(He,tt,$t,rt);for(let pt=0,ft=dt.length;pt<ft;pt++)tt=dt[pt],He.addColorStop(tt.stop,l(tt.color));this.Ya=He,this.ja=null}switch(et){case Re:Se.strokeStyle=He,Se.lineWidth=this.Ib,Se.lineCap=this.Ha,Se.lineJoin=this.Ia,Se.stroke(Me);break;case xe:Se.fillStyle=He,Se.fill(Me,Ke)}}});const ze=new Set;let je=null,ot=[],ht=0,St=0;var Dt=p.CanvasRenderer=K.extend("Renderer",{__construct:function(Se){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=Se.getContext("2d"),this.Va=Se,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const Se=this.S.length-6;if(6>Se)throw"restore() called without matching save().";this.S.splice(Se),this.H.push(this.C.restore.bind(this.C))},transform:function(Se,Me,Ke,et,He,Xe){const tt=this.S,rt=tt.length-6;tt.splice(rt,6,tt[rt]*Se+tt[rt+2]*Me,tt[rt+1]*Se+tt[rt+3]*Me,tt[rt]*Ke+tt[rt+2]*et,tt[rt+1]*Ke+tt[rt+3]*et,tt[rt]*He+tt[rt+2]*Xe+tt[rt+4],tt[rt+1]*He+tt[rt+3]*Xe+tt[rt+5]),this.H.push(this.C.transform.bind(this.C,Se,Me,Ke,et,He,Xe))},rotate:function(Se){const Me=Math.sin(Se);Se=Math.cos(Se),this.transform(Se,Me,-Me,Se,0,0)},_drawPath:function(Se,Me){this.H.push(Me.draw.bind(Me,this.C,Se.T,Se.Wa===De?"evenodd":"nonzero"))},_drawRiveImage:function(Se,Me,Ke,et){var He=Se.Fb;if(He){var Xe=this.C,tt=s(Ke);this.H.push(function(){Xe.globalCompositeOperation=tt,Xe.globalAlpha=et,Xe.drawImage(He,0,0),Xe.globalAlpha=1})}},_getMatrix:function(Se){const Me=this.S,Ke=Me.length-6;for(let et=0;6>et;++et)Se[et]=Me[Ke+et]},_drawImageMesh:function(Se,Me,Ke,et,He,Xe,tt,rt,$t,dt,pt){Me=this.C.canvas.width;var ft=this.C.canvas.height;const Ei=dt-rt,Si=pt-$t;rt=Math.max(rt,0),$t=Math.max($t,0),dt=Math.min(dt,Me),pt=Math.min(pt,ft);const Zt=dt-rt,er=pt-$t;if(console.assert(Zt<=Math.min(Ei,Me)),console.assert(er<=Math.min(Si,ft)),!(0>=Zt||0>=er)){dt=Zt<Ei||er<Si,Me=pt=1;var Nt=Math.ceil(Zt*pt),Ft=Math.ceil(er*Me);ft=N.hc(),Nt>ft&&(pt*=ft/Nt,Nt=ft),Ft>ft&&(Me*=ft/Ft,Ft=ft),je||(je=new p.DynamicRectanizer(ft),je.reset(512,512)),ft=je.addRect(Nt,Ft),0>ft&&(f(),ze.add(this),ft=je.addRect(Nt,Ft),console.assert(0<=ft));var ki=ft&65535,Ai=ft>>16;ot.push({ha:this.S.slice(this.S.length-6),image:Se,Za:ki,$a:Ai,ic:rt,jc:$t,Ac:Nt,kb:Ft,Ba:pt,Ca:Me,Ua:new Float32Array(He),Db:new Float32Array(Xe),indices:new Uint16Array(tt),mc:dt,xb:Se.Ka<<1|(dt?1:0)}),ht+=He.length,St+=tt.length;var qt=this.C,Zi=s(Ke);this.H.push(function(){qt.save(),qt.resetTransform(),qt.globalCompositeOperation=Zi,qt.globalAlpha=et;const Ii=N.canvas();Ii&&qt.drawImage(Ii,ki,Ai,Nt,Ft,rt,$t,Zt,er),qt.restore()})}},_clipPath:function(Se){this.H.push(this.C.clip.bind(this.C,Se.T,Se.Wa===De?"evenodd":"nonzero"))},clear:function(){ze.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(Se,Me){this.transform(1,0,0,1,Se,Me)}});p.makeRenderer=function(Se){const Me=new Dt(Se),Ke=Me.C;return new Proxy(Me,{get(et,He){if(typeof et[He]=="function")return function(...Xe){return et[He].apply(et,Xe)};if(typeof Ke[He]=="function"){if(-1<P.indexOf(He))throw Error("RiveException: Method call to '"+He+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Xe){Me.H.push(Ke[He].bind(Ke,...Xe))}}return et[He]},set(et,He,Xe){if(He in Ke)return Me.H.push(()=>{Ke[He]=Xe}),!0}})},p.decodeImage=function(Se,Me){new Te({la:Me}).decode(Se)},p.renderFactory={makeRenderPaint:function(){return new Ve},makeRenderPath:function(){return new ke},makeRenderImage:function(){let Se=kt;return new Te({xa:()=>{Se.total++},la:()=>{if(Se.loaded++,Se.loaded===Se.total){const Me=Se.ready;Me&&(Me(),Se.ready=null)}}})}};let Ze=p.load,kt=null;p.load=function(Se,Me,Ke=!0){const et=new p.FallbackFileAssetLoader;return Me!==void 0&&et.addLoader(Me),Ke&&(Me=new p.CDNFileAssetLoader,et.addLoader(Me)),new Promise(function(He){let Xe=null;kt={total:0,loaded:0,ready:function(){He(Xe)}},Xe=Ze(Se,et),kt.total==0&&He(Xe)})};let Qi=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(Se,Me,Ke,et,He=1){Qi.call(this,Se,Me,Ke,et,He)},y=new x,p.requestAnimationFrame=y.requestAnimationFrame.bind(y),p.cancelAnimationFrame=y.cancelAnimationFrame.bind(y),p.enableFPSCounter=y.Rb.bind(y),p.disableFPSCounter=y.Ob,y.pb=f,p.resolveAnimationFrame=f,p.cleanup=function(){je&&je.delete()}};var I=Object.assign({},p),k="./this.program",j=typeof window=="object",F=typeof importScripts=="function",U="",L,X;(j||F)&&(F?U=self.location.href:typeof document<"u"&&document.currentScript&&(U=document.currentScript.src),m&&(U=m),U.indexOf("blob:")!==0?U=U.substr(0,U.replace(/[?#].*/,"").lastIndexOf("/")+1):U="",F&&(X=s=>{var l=new XMLHttpRequest;return l.open("GET",s,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),L=(s,l,f)=>{var y=new XMLHttpRequest;y.open("GET",s,!0),y.responseType="arraybuffer",y.onload=()=>{y.status==200||y.status==0&&y.response?l(y.response):f()},y.onerror=f,y.send(null)});var fe=p.print||console.log.bind(console),ge=p.printErr||console.error.bind(console);Object.assign(p,I),I=null,p.thisProgram&&(k=p.thisProgram);var re;p.wasmBinary&&(re=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&B("no native wasm support detected");var V,G,q=!1,O,z,ce,he,se,ve,me,be;function ue(){var s=V.buffer;p.HEAP8=O=new Int8Array(s),p.HEAP16=ce=new Int16Array(s),p.HEAP32=se=new Int32Array(s),p.HEAPU8=z=new Uint8Array(s),p.HEAPU16=he=new Uint16Array(s),p.HEAPU32=ve=new Uint32Array(s),p.HEAPF32=me=new Float32Array(s),p.HEAPF64=be=new Float64Array(s)}var ie,oe=[],Q=[],ae=[];function H(){var s=p.preRun.shift();oe.unshift(s)}var W=0,Z=null;function B(s){throw p.onAbort&&p.onAbort(s),s="Aborted("+s+")",ge(s),q=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),T(s),s}function te(s){return s.startsWith("data:application/octet-stream;base64,")}var ne;if(ne="canvas_advanced.wasm",!te(ne)){var ye=ne;ne=p.locateFile?p.locateFile(ye,U):U+ye}function we(s){if(s==ne&&re)return new Uint8Array(re);if(X)return X(s);throw"both async and sync fetching of the wasm failed"}function Ee(s){if(!re&&(j||F)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(l=>{if(!l.ok)throw"failed to load wasm binary file at '"+s+"'";return l.arrayBuffer()}).catch(()=>we(s));if(L)return new Promise((l,f)=>{L(s,y=>l(new Uint8Array(y)),f)})}return Promise.resolve().then(()=>we(s))}function $e(s,l,f){return Ee(s).then(y=>WebAssembly.instantiate(y,l)).then(y=>y).then(f,y=>{ge("failed to asynchronously prepare wasm: "+y),B(y)})}function Ce(s,l){var f=ne;return re||typeof WebAssembly.instantiateStreaming!="function"||te(f)||f.startsWith("file://")||typeof fetch!="function"?$e(f,s,l):fetch(f,{credentials:"same-origin"}).then(y=>WebAssembly.instantiateStreaming(y,s).then(l,function(A){return ge("wasm streaming compile failed: "+A),ge("falling back to ArrayBuffer instantiation"),$e(f,s,l)}))}var Le,w,c={460492:(s,l,f,y,A)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=l,window.h.I.La=f,window.h.ga={},window.h.ga.stopped=y,window.h.ga.yb=A;let C=window.h;C.D=[],C.yc=function(K){for(var de=0;de<C.D.length;++de)if(C.D[de]==null)return C.D[de]=K,de;return C.D.push(K),C.D.length-1},C.Cb=function(K){for(C.D[K]=null;0<C.D.length&&C.D[C.D.length-1]==null;)C.D.pop()},C.Sc=function(K){for(var de=0;de<C.D.length;++de)if(C.D[de]==K)return C.Cb(de)},C.ra=function(K){return C.D[K]},C.Ta=["touchend","click"],C.unlock=function(){for(var K=0;K<C.D.length;++K){var de=C.D[K];de!=null&&de.J!=null&&de.state===C.ga.yb&&de.J.resume().then(()=>{mi(de.qb)},pe=>{console.error("Failed to resume audiocontext",pe)})}C.Ta.map(function(pe){document.removeEventListener(pe,C.unlock,!0)})},C.Ta.map(function(K){document.addEventListener(K,C.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),l=s.sampleRate;return s.close(),l}catch{return 0}},463249:(s,l,f,y,A,C)=>{if(typeof window.h>"u")return-1;var K={},de={};return s==window.h.I.ya&&f!=0&&(de.sampleRate=f),K.J=new(window.AudioContext||window.webkitAudioContext)(de),K.J.suspend(),K.state=window.h.ga.stopped,f=0,s!=window.h.I.ya&&(f=l),K.Z=K.J.createScriptProcessor(y,f,l),K.Z.onaudioprocess=function(pe){if((K.sa==null||K.sa.length==0)&&(K.sa=new Float32Array(me.buffer,A,y*l)),s==window.h.I.capture||s==window.h.I.La){for(var le=0;le<l;le+=1)for(var xe=pe.inputBuffer.getChannelData(le),Re=K.sa,De=0;De<y;De+=1)Re[De*l+le]=xe[De];bi(C,y,A)}if(s==window.h.I.ya||s==window.h.I.La)for(yi(C,y,A),le=0;le<pe.outputBuffer.numberOfChannels;++le)for(xe=pe.outputBuffer.getChannelData(le),Re=K.sa,De=0;De<y;De+=1)xe[De]=Re[De*l+le];else for(le=0;le<pe.outputBuffer.numberOfChannels;++le)pe.outputBuffer.getChannelData(le).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(pe){K.Da=K.J.createMediaStreamSource(pe),K.Da.connect(K.Z),K.Z.connect(K.J.destination)}).catch(function(pe){console.log("Failed to get user media: "+pe)}),s==window.h.I.ya&&K.Z.connect(K.J.destination),K.qb=C,window.h.yc(K)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},d=s=>{for(;0<s.length;)s.shift()(p)},S=(s,l)=>{for(var f=0,y=s.length-1;0<=y;y--){var A=s[y];A==="."?s.splice(y,1):A===".."?(s.splice(y,1),f++):f&&(s.splice(y,1),f--)}if(l)for(;f;f--)s.unshift("..");return s},M=s=>{var l=s.charAt(0)==="/",f=s.substr(-1)==="/";return(s=S(s.split("/").filter(y=>!!y),!l).join("/"))||l||(s="."),s&&f&&(s+="/"),(l?"/":"")+s},Y=s=>{var l=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=l[0],l=l[1],!s&&!l?".":(l&&(l=l.substr(0,l.length-1)),s+l)},_e=s=>{if(s==="/")return"/";s=M(s),s=s.replace(/\/$/,"");var l=s.lastIndexOf("/");return l===-1?s:s.substr(l+1)},Ie=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);B("initRandomDevice")},Oe=s=>(Oe=Ie())(s);function Ae(){for(var s="",l=!1,f=arguments.length-1;-1<=f&&!l;f--){if(l=0<=f?arguments[f]:"/",typeof l!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!l)return"";s=l+"/"+s,l=l.charAt(0)==="/"}return s=S(s.split("/").filter(y=>!!y),!l).join("/"),(l?"/":"")+s||"."}var Fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,We=(s,l,f)=>{var y=l+f;for(f=l;s[f]&&!(f>=y);)++f;if(16<f-l&&s.buffer&&Fe)return Fe.decode(s.subarray(l,f));for(y="";l<f;){var A=s[l++];if(A&128){var C=s[l++]&63;if((A&224)==192)y+=String.fromCharCode((A&31)<<6|C);else{var K=s[l++]&63;A=(A&240)==224?(A&15)<<12|C<<6|K:(A&7)<<18|C<<12|K<<6|s[l++]&63,65536>A?y+=String.fromCharCode(A):(A-=65536,y+=String.fromCharCode(55296|A>>10,56320|A&1023))}}else y+=String.fromCharCode(A)}return y},Ye=[],Je=s=>{for(var l=0,f=0;f<s.length;++f){var y=s.charCodeAt(f);127>=y?l++:2047>=y?l+=2:55296<=y&&57343>=y?(l+=4,++f):l+=3}return l},lt=(s,l,f,y)=>{if(!(0<y))return 0;var A=f;y=f+y-1;for(var C=0;C<s.length;++C){var K=s.charCodeAt(C);if(55296<=K&&57343>=K){var de=s.charCodeAt(++C);K=65536+((K&1023)<<10)|de&1023}if(127>=K){if(f>=y)break;l[f++]=K}else{if(2047>=K){if(f+1>=y)break;l[f++]=192|K>>6}else{if(65535>=K){if(f+2>=y)break;l[f++]=224|K>>12}else{if(f+3>=y)break;l[f++]=240|K>>18,l[f++]=128|K>>12&63}l[f++]=128|K>>6&63}l[f++]=128|K&63}}return l[f]=0,f-A};function st(s,l){var f=Array(Je(s)+1);return s=lt(s,f,0,f.length),l&&(f.length=s),f}var it=[];function qe(s,l){it[s]={input:[],F:[],V:l},Er(s,Be)}var Be={open:function(s){var l=it[s.node.za];if(!l)throw new Ne(43);s.s=l,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,l,f,y){if(!s.s||!s.s.V.jb)throw new Ne(60);for(var A=0,C=0;C<y;C++){try{var K=s.s.V.jb(s.s)}catch{throw new Ne(29)}if(K===void 0&&A===0)throw new Ne(6);if(K==null)break;A++,l[f+C]=K}return A&&(s.node.timestamp=Date.now()),A},write:function(s,l,f,y){if(!s.s||!s.s.V.Oa)throw new Ne(60);try{for(var A=0;A<y;A++)s.s.V.Oa(s.s,l[f+A])}catch{throw new Ne(29)}return y&&(s.node.timestamp=Date.now()),A}},nt={jb:function(){e:{if(!Ye.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}Ye=st(s,!0)}s=Ye.shift()}return s},Oa:function(s,l){l===null||l===10?(fe(We(s.F,0)),s.F=[]):l!=0&&s.F.push(l)},qa:function(s){s.F&&0<s.F.length&&(fe(We(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},at={Oa:function(s,l){l===null||l===10?(ge(We(s.F,0)),s.F=[]):l!=0&&s.F.push(l)},qa:function(s){s.F&&0<s.F.length&&(ge(We(s.F,0)),s.F=[])}};function Qe(s,l){var f=s.j?s.j.length:0;f>=l||(l=Math.max(l,f*(1048576>f?2:1.125)>>>0),f!=0&&(l=Math.max(l,256)),f=s.j,s.j=new Uint8Array(l),0<s.v&&s.j.set(f.subarray(0,s.v),0))}var Pe={O:null,U(){return Pe.createNode(null,"/",16895,0)},createNode(s,l,f,y){if((f&61440)===24576||(f&61440)===4096)throw new Ne(63);return Pe.O||(Pe.O={dir:{node:{Y:Pe.l.Y,P:Pe.l.P,ka:Pe.l.ka,va:Pe.l.va,vb:Pe.l.vb,Bb:Pe.l.Bb,wb:Pe.l.wb,tb:Pe.l.tb,Ea:Pe.l.Ea},stream:{ba:Pe.m.ba}},file:{node:{Y:Pe.l.Y,P:Pe.l.P},stream:{ba:Pe.m.ba,read:Pe.m.read,write:Pe.m.write,pa:Pe.m.pa,mb:Pe.m.mb,ob:Pe.m.ob}},link:{node:{Y:Pe.l.Y,P:Pe.l.P,ma:Pe.l.ma},stream:{}},ab:{node:{Y:Pe.l.Y,P:Pe.l.P},stream:Ci}}),f=Br(s,l,f,y),(f.mode&61440)===16384?(f.l=Pe.O.dir.node,f.m=Pe.O.dir.stream,f.j={}):(f.mode&61440)===32768?(f.l=Pe.O.file.node,f.m=Pe.O.file.stream,f.v=0,f.j=null):(f.mode&61440)===40960?(f.l=Pe.O.link.node,f.m=Pe.O.link.stream):(f.mode&61440)===8192&&(f.l=Pe.O.ab.node,f.m=Pe.O.ab.stream),f.timestamp=Date.now(),s&&(s.j[l]=f,s.timestamp=f.timestamp),f},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var l={};return l.Jc=(s.mode&61440)===8192?s.id:1,l.Mc=s.id,l.mode=s.mode,l.Oc=1,l.uid=0,l.Lc=0,l.za=s.za,(s.mode&61440)===16384?l.size=4096:(s.mode&61440)===32768?l.size=s.v:(s.mode&61440)===40960?l.size=s.link.length:l.size=0,l.Bc=new Date(s.timestamp),l.Nc=new Date(s.timestamp),l.Ic=new Date(s.timestamp),l.Jb=4096,l.Cc=Math.ceil(l.size/l.Jb),l},P(s,l){if(l.mode!==void 0&&(s.mode=l.mode),l.timestamp!==void 0&&(s.timestamp=l.timestamp),l.size!==void 0&&(l=l.size,s.v!=l))if(l==0)s.j=null,s.v=0;else{var f=s.j;s.j=new Uint8Array(l),f&&s.j.set(f.subarray(0,Math.min(l,s.v))),s.v=l}},ka(){throw $r[44]},va(s,l,f,y){return Pe.createNode(s,l,f,y)},vb(s,l,f){if((s.mode&61440)===16384){try{var y=tr(l,f)}catch{}if(y)for(var A in y.j)throw new Ne(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=f,l.j[f]=s,l.timestamp=s.parent.timestamp,s.parent=l},Bb(s,l){delete s.j[l],s.timestamp=Date.now()},wb(s,l){var f=tr(s,l),y;for(y in f.j)throw new Ne(55);delete s.j[l],s.timestamp=Date.now()},tb(s){var l=[".",".."],f;for(f in s.j)s.j.hasOwnProperty(f)&&l.push(f);return l},Ea(s,l,f){return s=Pe.createNode(s,l,41471,0),s.link=f,s},ma(s){if((s.mode&61440)!==40960)throw new Ne(28);return s.link}},m:{read(s,l,f,y,A){var C=s.node.j;if(A>=s.node.v)return 0;if(s=Math.min(s.node.v-A,y),8<s&&C.subarray)l.set(C.subarray(A,A+s),f);else for(y=0;y<s;y++)l[f+y]=C[A+y];return s},write(s,l,f,y,A,C){if(l.buffer===O.buffer&&(C=!1),!y)return 0;if(s=s.node,s.timestamp=Date.now(),l.subarray&&(!s.j||s.j.subarray)){if(C)return s.j=l.subarray(f,f+y),s.v=y;if(s.v===0&&A===0)return s.j=l.slice(f,f+y),s.v=y;if(A+y<=s.v)return s.j.set(l.subarray(f,f+y),A),y}if(Qe(s,A+y),s.j.subarray&&l.subarray)s.j.set(l.subarray(f,f+y),A);else for(C=0;C<y;C++)s.j[A+C]=l[f+C];return s.v=Math.max(s.v,A+y),y},ba(s,l,f){if(f===1?l+=s.position:f===2&&(s.node.mode&61440)===32768&&(l+=s.node.v),0>l)throw new Ne(28);return l},pa(s,l,f){Qe(s.node,l+f),s.node.v=Math.max(s.node.v,l+f)},mb(s,l,f,y,A){if((s.node.mode&61440)!==32768)throw new Ne(43);if(s=s.node.j,A&2||s.buffer!==O.buffer){if((0<f||f+l<s.length)&&(s.subarray?s=s.subarray(f,f+l):s=Array.prototype.slice.call(s,f,f+l)),f=!0,B(),l=void 0,!l)throw new Ne(48);O.set(s,l)}else f=!1,l=s.byteOffset;return{o:l,M:f}},ob(s,l,f,y){return Pe.m.write(s,l,0,y,f,!1),0}}};function Ue(s,l){var f=0;return s&&(f|=365),l&&(f|=146),f}var ut=null,mt={},Rt=[],Ti=1,Gt=null,Nr=!0,Ne=null,$r={},jt=(s,l={})=>{if(s=Ae(s),!s)return{path:"",node:null};if(l=Object.assign({hb:!0,Qa:0},l),8<l.Qa)throw new Ne(32);s=s.split("/").filter(K=>!!K);for(var f=ut,y="/",A=0;A<s.length;A++){var C=A===s.length-1;if(C&&l.parent)break;if(f=tr(f,s[A]),y=M(y+"/"+s[A]),f.wa&&(!C||C&&l.hb)&&(f=f.wa.root),!C||l.gb){for(C=0;(f.mode&61440)===40960;)if(f=Ri(y),y=Ae(Y(y),f),f=jt(y,{Qa:l.Qa+1}).node,40<C++)throw new Ne(32)}}return{path:y,node:f}},Fr=s=>{for(var l;;){if(s===s.parent)return s=s.U.nb,l?s[s.length-1]!=="/"?`${s}/${l}`:s+l:s;l=l?`${s.name}/${l}`:s.name,s=s.parent}},Ur=(s,l)=>{for(var f=0,y=0;y<l.length;y++)f=(f<<5)-f+l.charCodeAt(y)|0;return(s+f>>>0)%Gt.length},tr=(s,l)=>{var f;if(f=(f=rr(s,"x"))?f:s.l.ka?0:2)throw new Ne(f,s);for(f=Gt[Ur(s.id,l)];f;f=f.lc){var y=f.name;if(f.parent.id===s.id&&y===l)return f}return s.l.ka(s,l)},Br=(s,l,f,y)=>(s=new vi(s,l,f,y),l=Ur(s.parent.id,s.name),s.lc=Gt[l],Gt[l]=s),Wr=s=>{var l=["r","w","rw"][s&3];return s&512&&(l+="w"),l},rr=(s,l)=>{if(Nr)return 0;if(!l.includes("r")||s.mode&292){if(l.includes("w")&&!(s.mode&146)||l.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},qr=(s,l)=>{try{return tr(s,l),20}catch{}return rr(s,"wx")},xi=()=>{for(var s=0;4096>=s;s++)if(!Rt[s])return s;throw new Ne(33)},Pt=s=>{if(s=Rt[s],!s)throw new Ne(8);return s},Gr=(s,l=-1)=>(Ht||(Ht=function(){this.h={}},Ht.prototype={},Object.defineProperties(Ht.prototype,{object:{get(){return this.node},set(f){this.node=f}},flags:{get(){return this.h.flags},set(f){this.h.flags=f}},position:{get(){return this.h.position},set(f){this.h.position=f}}})),s=Object.assign(new Ht,s),l==-1&&(l=xi()),s.X=l,Rt[l]=s),Ci={open:s=>{s.m=mt[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new Ne(70)}},Er=(s,l)=>{mt[s]={m:l}},Vr=(s,l)=>{var f=l==="/",y=!l;if(f&&ut)throw new Ne(10);if(!f&&!y){var A=jt(l,{hb:!1});if(l=A.path,A=A.node,A.wa)throw new Ne(10);if((A.mode&61440)!==16384)throw new Ne(54)}l={type:s,Qc:{},nb:l,kc:[]},s=s.U(l),s.U=l,l.root=s,f?ut=s:A&&(A.wa=l,A.U&&A.U.kc.push(l))},bt=(s,l,f)=>{var y=jt(s,{parent:!0}).node;if(s=_e(s),!s||s==="."||s==="..")throw new Ne(28);var A=qr(y,s);if(A)throw new Ne(A);if(!y.l.va)throw new Ne(63);return y.l.va(y,s,l,f)},ir=(s,l,f)=>{typeof f>"u"&&(f=l,l=438),bt(s,l|8192,f)},Sr=(s,l)=>{if(!Ae(s))throw new Ne(44);var f=jt(l,{parent:!0}).node;if(!f)throw new Ne(44);l=_e(l);var y=qr(f,l);if(y)throw new Ne(y);if(!f.l.Ea)throw new Ne(63);f.l.Ea(f,l,s)},Ri=s=>{if(s=jt(s).node,!s)throw new Ne(44);if(!s.l.ma)throw new Ne(28);return Ae(Fr(s.parent),s.l.ma(s))},nr=(s,l,f)=>{if(s==="")throw new Ne(44);if(typeof l=="string"){var y={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[l];if(typeof y>"u")throw Error(`Unknown file open mode: ${l}`);l=y}if(f=l&64?(typeof f>"u"?438:f)&4095|32768:0,typeof s=="object")var A=s;else{s=M(s);try{A=jt(s,{gb:!(l&131072)}).node}catch{}}if(y=!1,l&64)if(A){if(l&128)throw new Ne(20)}else A=bt(s,f,0),y=!0;if(!A)throw new Ne(44);if((A.mode&61440)===8192&&(l&=-513),l&65536&&(A.mode&61440)!==16384)throw new Ne(54);if(!y&&(f=A?(A.mode&61440)===40960?32:(A.mode&61440)===16384&&(Wr(l)!=="r"||l&512)?31:rr(A,Wr(l)):44))throw new Ne(f);if(l&512&&!y){if(f=A,f=typeof f=="string"?jt(f,{gb:!0}).node:f,!f.l.P)throw new Ne(63);if((f.mode&61440)===16384)throw new Ne(31);if((f.mode&61440)!==32768)throw new Ne(28);if(y=rr(f,"w"))throw new Ne(y);f.l.P(f,{size:0,timestamp:Date.now()})}return l&=-131713,A=Gr({node:A,path:Fr(A),flags:l,seekable:!0,position:0,m:A.m,zc:[],error:!1}),A.m.open&&A.m.open(A),!p.logReadFiles||l&1||(sr||(sr={}),s in sr||(sr[s]=1)),A},Hr=(s,l,f)=>{if(s.X===null)throw new Ne(8);if(!s.seekable||!s.m.ba)throw new Ne(70);if(f!=0&&f!=1&&f!=2)throw new Ne(28);s.position=s.m.ba(s,l,f),s.zc=[]},zr=()=>{Ne||(Ne=function(s,l){this.name="ErrnoError",this.node=l,this.pc=function(f){this.aa=f},this.pc(s),this.message="FS error"},Ne.prototype=Error(),Ne.prototype.constructor=Ne,[44].forEach(s=>{$r[s]=new Ne(s),$r[s].stack="<generic error, no stack>"}))},Kr,Vt=(s,l,f)=>{s=M("/dev/"+s);var y=Ue(!!l,!!f);kr||(kr=64);var A=kr++<<8|0;Er(A,{open:C=>{C.seekable=!1},close:()=>{f&&f.buffer&&f.buffer.length&&f(10)},read:(C,K,de,pe)=>{for(var le=0,xe=0;xe<pe;xe++){try{var Re=l()}catch{throw new Ne(29)}if(Re===void 0&&le===0)throw new Ne(6);if(Re==null)break;le++,K[de+xe]=Re}return le&&(C.node.timestamp=Date.now()),le},write:(C,K,de,pe)=>{for(var le=0;le<pe;le++)try{f(K[de+le])}catch{throw new Ne(29)}return pe&&(C.node.timestamp=Date.now()),le}}),ir(s,y,A)},kr,Mt={},Ht,sr,zt=void 0;function At(){return zt+=4,se[zt-4>>2]}function Yr(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var l=s.charCodeAt(0);return 48<=l&&57>=l?`_${s}`:s}function ar(s,l){return s=Yr(s),{[s]:function(){return l.apply(this,arguments)}}[s]}function Jr(){this.M=[void 0],this.ib=[]}var gt=new Jr,Ut=void 0;function Ge(s){throw new Ut(s)}var yt=s=>(s||Ge("Cannot use deleted val. handle = "+s),gt.get(s).value),wt=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return gt.pa({ub:1,value:s})}};function Xr(s){var l=Error,f=ar(s,function(y){this.name=s,this.message=y,y=Error(y).stack,y!==void 0&&(this.stack=this.toString()+`
`+y.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(l.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},f}var Qr=void 0,Zr=void 0;function ct(s){for(var l="";z[s];)l+=Zr[z[s++]];return l}var Kt=[];function Ar(){for(;Kt.length;){var s=Kt.pop();s.g.fa=!1,s.delete()}}var Yt=void 0,It={};function Ir(s,l){for(l===void 0&&Ge("ptr should not be undefined");s.A;)l=s.na(l),s=s.A;return l}var Lt={};function ei(s){s=wi(s);var l=ct(s);return Ct(s),l}function Jt(s,l){var f=Lt[s];return f===void 0&&Ge(l+" has unknown type "+ei(s)),f}function or(){}var Tr=!1;function ti(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function ri(s,l,f){return l===f?s:f.A===void 0?null:(s=ri(s,l,f.A),s===null?null:f.Pb(s))}var ii={};function Pi(s,l){return l=Ir(s,l),It[l]}var ni=void 0;function lr(s){throw new ni(s)}function cr(s,l){return l.u&&l.o||lr("makeClassHandle requires ptr and ptrType"),!!l.L!=!!l.G&&lr("Both smartPtrType and smartPtr must be specified"),l.count={value:1},Bt(Object.create(s,{g:{value:l}}))}function Bt(s){return typeof FinalizationRegistry>"u"?(Bt=l=>l,s):(Tr=new FinalizationRegistry(l=>{ti(l.g)}),Bt=l=>{var f=l.g;return f.G&&Tr.register(l,{g:f},l),l},or=l=>{Tr.unregister(l)},Bt(s))}var ur={};function Xt(s){for(;s.length;){var l=s.pop();s.pop()(l)}}function Qt(s){return this.fromWireType(se[s>>2])}var Wt={},dr={};function _t(s,l,f){function y(de){de=f(de),de.length!==s.length&&lr("Mismatched type converter count");for(var pe=0;pe<s.length;++pe)Et(s[pe],de[pe])}s.forEach(function(de){dr[de]=l});var A=Array(l.length),C=[],K=0;l.forEach((de,pe)=>{Lt.hasOwnProperty(de)?A[pe]=Lt[de]:(C.push(de),Wt.hasOwnProperty(de)||(Wt[de]=[]),Wt[de].push(()=>{A[pe]=Lt[de],++K,K===C.length&&y(A)}))}),C.length===0&&y(A)}function fr(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Oi(s,l,f={}){var y=l.name;if(s||Ge(`type "${y}" must have a positive integer typeid pointer`),Lt.hasOwnProperty(s)){if(f.$b)return;Ge(`Cannot register type '${y}' twice`)}Lt[s]=l,delete dr[s],Wt.hasOwnProperty(s)&&(l=Wt[s],delete Wt[s],l.forEach(A=>A()))}function Et(s,l,f={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");Oi(s,l,f)}function xr(s){Ge(s.g.u.i.name+" instance already deleted")}function Ot(){}function Cr(s,l,f){if(s[l].B===void 0){var y=s[l];s[l]=function(){return s[l].B.hasOwnProperty(arguments.length)||Ge(`Function '${f}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[l].B})!`),s[l].B[arguments.length].apply(this,arguments)},s[l].B=[],s[l].B[y.ea]=y}}function Rr(s,l,f){p.hasOwnProperty(s)?((f===void 0||p[s].B!==void 0&&p[s].B[f]!==void 0)&&Ge(`Cannot register public name '${s}' twice`),Cr(p,s,s),p.hasOwnProperty(f)&&Ge(`Cannot register multiple overloads of a function with the same number of arguments (${f})!`),p[s].B[f]=l):(p[s]=l,f!==void 0&&(p[s].Pc=f))}function ji(s,l,f,y,A,C,K,de){this.name=s,this.constructor=l,this.N=f,this.W=y,this.A=A,this.Ub=C,this.na=K,this.Pb=de,this.rb=[]}function hr(s,l,f){for(;l!==f;)l.na||Ge(`Expected null or instance of ${f.name}, got an instance of ${l.name}`),s=l.na(s),l=l.A;return s}function Mi(s,l){return l===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),hr(l.g.o,l.g.u.i,this.i))}function Li(s,l){if(l===null){if(this.Na&&Ge(`null is not a valid ${this.name}`),this.ua){var f=this.Pa();return s!==null&&s.push(this.W,f),f}return 0}if(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&l.g.u.ta&&Ge(`Cannot convert argument of type ${l.g.L?l.g.L.name:l.g.u.name} to parameter type ${this.name}`),f=hr(l.g.o,l.g.u.i,this.i),this.ua)switch(l.g.G===void 0&&Ge("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:l.g.L===this?f=l.g.G:Ge(`Cannot convert argument of type ${l.g.L?l.g.L.name:l.g.u.name} to parameter type ${this.name}`);break;case 1:f=l.g.G;break;case 2:if(l.g.L===this)f=l.g.G;else{var y=l.clone();f=this.oc(f,wt(function(){y.delete()})),s!==null&&s.push(this.W,f)}break;default:Ge("Unsupporting sharing policy")}return f}function Di(s,l){return l===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),l.g.u.ta&&Ge(`Cannot convert argument of type ${l.g.u.name} to parameter type ${this.name}`),hr(l.g.o,l.g.u.i,this.i))}function Tt(s,l,f,y){this.name=s,this.i=l,this.Na=f,this.ta=y,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,l.A!==void 0?this.toWireType=Li:(this.toWireType=y?Mi:Di,this.K=null)}function si(s,l,f){p.hasOwnProperty(s)||lr("Replacing nonexistant public symbol"),p[s].B!==void 0&&f!==void 0?p[s].B[f]=l:(p[s]=l,p[s].ea=f)}var vr=[],ai=s=>{var l=vr[s];return l||(s>=vr.length&&(vr.length=s+1),vr[s]=l=ie.get(s)),l},Ni=(s,l)=>{var f=[];return function(){if(f.length=0,Object.assign(f,arguments),s.includes("j")){var y=p["dynCall_"+s];y=f&&f.length?y.apply(null,[l].concat(f)):y.call(null,l)}else y=ai(l).apply(null,f);return y}};function vt(s,l){s=ct(s);var f=s.includes("j")?Ni(s,l):ai(l);return typeof f!="function"&&Ge(`unknown function pointer with signature ${s}: ${l}`),f}var oi=void 0;function xt(s,l){function f(C){A[C]||Lt[C]||(dr[C]?dr[C].forEach(f):(y.push(C),A[C]=!0))}var y=[],A={};throw l.forEach(f),new oi(`${s}: `+y.map(ei).join([", "]))}function _r(s,l,f,y,A){var C=l.length;2>C&&Ge("argTypes array size mismatch! Must at least get return value and 'this' types!");var K=l[1]!==null&&f!==null,de=!1;for(f=1;f<l.length;++f)if(l[f]!==null&&l[f].K===void 0){de=!0;break}var pe=l[0].name!=="void",le=C-2,xe=Array(le),Re=[],De=[];return function(){if(arguments.length!==le&&Ge(`function ${s} called with ${arguments.length} arguments, expected ${le} args!`),De.length=0,Re.length=K?2:1,Re[0]=A,K){var ee=l[1].toWireType(De,this);Re[1]=ee}for(var Te=0;Te<le;++Te)xe[Te]=l[Te+2].toWireType(De,arguments[Te]),Re.push(xe[Te]);if(Te=y.apply(null,Re),de)Xt(De);else for(var ke=K?1:2;ke<l.length;ke++){var Ve=ke===1?ee:xe[ke-2];l[ke].K!==null&&l[ke].K(Ve)}return ee=pe?l[0].fromWireType(Te):void 0,ee}}function gr(s,l){for(var f=[],y=0;y<s;y++)f.push(ve[l+4*y>>2]);return f}function li(s,l,f){return s instanceof Object||Ge(`${f} with invalid "this": ${s}`),s instanceof l.i.constructor||Ge(`${f} incompatible with "this" of type ${s.constructor.name}`),s.g.o||Ge(`cannot call emscripten binding method ${f} on deleted object`),hr(s.g.o,s.g.u.i,l.i)}function Pr(s){s>=gt.h&&--gt.get(s).ub===0&&gt.Zb(s)}function Fi(s,l,f){switch(l){case 0:return function(y){return this.fromWireType((f?O:z)[y])};case 1:return function(y){return this.fromWireType((f?ce:he)[y>>1])};case 2:return function(y){return this.fromWireType((f?se:ve)[y>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Or(s){if(s===null)return"null";var l=typeof s;return l==="object"||l==="array"||l==="function"?s.toString():""+s}function Ui(s,l){switch(l){case 2:return function(f){return this.fromWireType(me[f>>2])};case 3:return function(f){return this.fromWireType(be[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Bi(s,l,f){switch(l){case 0:return f?function(y){return O[y]}:function(y){return z[y]};case 1:return f?function(y){return ce[y>>1]}:function(y){return he[y>>1]};case 2:return f?function(y){return se[y>>2]}:function(y){return ve[y>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var ci=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Wi=(s,l)=>{for(var f=s>>1,y=f+l/2;!(f>=y)&&he[f];)++f;if(f<<=1,32<f-s&&ci)return ci.decode(z.subarray(s,f));for(f="",y=0;!(y>=l/2);++y){var A=ce[s+2*y>>1];if(A==0)break;f+=String.fromCharCode(A)}return f},qi=(s,l,f)=>{if(f===void 0&&(f=2147483647),2>f)return 0;f-=2;var y=l;f=f<2*s.length?f/2:s.length;for(var A=0;A<f;++A)ce[l>>1]=s.charCodeAt(A),l+=2;return ce[l>>1]=0,l-y},Gi=s=>2*s.length,Vi=(s,l)=>{for(var f=0,y="";!(f>=l/4);){var A=se[s+4*f>>2];if(A==0)break;++f,65536<=A?(A-=65536,y+=String.fromCharCode(55296|A>>10,56320|A&1023)):y+=String.fromCharCode(A)}return y},Hi=(s,l,f)=>{if(f===void 0&&(f=2147483647),4>f)return 0;var y=l;f=y+f-4;for(var A=0;A<s.length;++A){var C=s.charCodeAt(A);if(55296<=C&&57343>=C){var K=s.charCodeAt(++A);C=65536+((C&1023)<<10)|K&1023}if(se[l>>2]=C,l+=4,l+4>f)break}return se[l>>2]=0,l-y},zi=s=>{for(var l=0,f=0;f<s.length;++f){var y=s.charCodeAt(f);55296<=y&&57343>=y&&++f,l+=4}return l},Ki={};function pr(s){var l=Ki[s];return l===void 0?ct(s):l}var mr=[];function Yi(s){var l=mr.length;return mr.push(s),l}function Ji(s,l){for(var f=Array(s),y=0;y<s;++y)f[y]=Jt(ve[l+4*y>>2],"parameter "+y);return f}var ui=[],jr=[],Mr={},di=()=>{if(!Lr){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:k||"./this.program"},l;for(l in Mr)Mr[l]===void 0?delete s[l]:s[l]=Mr[l];var f=[];for(l in s)f.push(`${l}=${s[l]}`);Lr=f}return Lr},Lr,br=s=>s%4===0&&(s%100!==0||s%400===0),fi=[31,29,31,30,31,30,31,31,30,31,30,31],hi=[31,28,31,30,31,30,31,31,30,31,30,31],Xi=(s,l,f,y)=>{function A(ee,Te,ke){for(ee=typeof ee=="number"?ee.toString():ee||"";ee.length<Te;)ee=ke[0]+ee;return ee}function C(ee,Te){return A(ee,Te,"0")}function K(ee,Te){function ke(ze){return 0>ze?-1:0<ze?1:0}var Ve;return(Ve=ke(ee.getFullYear()-Te.getFullYear()))===0&&(Ve=ke(ee.getMonth()-Te.getMonth()))===0&&(Ve=ke(ee.getDate()-Te.getDate())),Ve}function de(ee){switch(ee.getDay()){case 0:return new Date(ee.getFullYear()-1,11,29);case 1:return ee;case 2:return new Date(ee.getFullYear(),0,3);case 3:return new Date(ee.getFullYear(),0,2);case 4:return new Date(ee.getFullYear(),0,1);case 5:return new Date(ee.getFullYear()-1,11,31);case 6:return new Date(ee.getFullYear()-1,11,30)}}function pe(ee){var Te=ee.ca;for(ee=new Date(new Date(ee.da+1900,0,1).getTime());0<Te;){var ke=ee.getMonth(),Ve=(br(ee.getFullYear())?fi:hi)[ke];if(Te>Ve-ee.getDate())Te-=Ve-ee.getDate()+1,ee.setDate(1),11>ke?ee.setMonth(ke+1):(ee.setMonth(0),ee.setFullYear(ee.getFullYear()+1));else{ee.setDate(ee.getDate()+Te);break}}return ke=new Date(ee.getFullYear()+1,0,4),Te=de(new Date(ee.getFullYear(),0,4)),ke=de(ke),0>=K(Te,ee)?0>=K(ke,ee)?ee.getFullYear()+1:ee.getFullYear():ee.getFullYear()-1}var le=se[y+40>>2];y={wc:se[y>>2],vc:se[y+4>>2],Fa:se[y+8>>2],Sa:se[y+12>>2],Ga:se[y+16>>2],da:se[y+20>>2],R:se[y+24>>2],ca:se[y+28>>2],Rc:se[y+32>>2],uc:se[y+36>>2],xc:le&&le?We(z,le):""},f=f?We(z,f):"",le={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var xe in le)f=f.replace(new RegExp(xe,"g"),le[xe]);var Re="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),De="January February March April May June July August September October November December".split(" ");le={"%a":ee=>Re[ee.R].substring(0,3),"%A":ee=>Re[ee.R],"%b":ee=>De[ee.Ga].substring(0,3),"%B":ee=>De[ee.Ga],"%C":ee=>C((ee.da+1900)/100|0,2),"%d":ee=>C(ee.Sa,2),"%e":ee=>A(ee.Sa,2," "),"%g":ee=>pe(ee).toString().substring(2),"%G":ee=>pe(ee),"%H":ee=>C(ee.Fa,2),"%I":ee=>(ee=ee.Fa,ee==0?ee=12:12<ee&&(ee-=12),C(ee,2)),"%j":ee=>{for(var Te=0,ke=0;ke<=ee.Ga-1;Te+=(br(ee.da+1900)?fi:hi)[ke++]);return C(ee.Sa+Te,3)},"%m":ee=>C(ee.Ga+1,2),"%M":ee=>C(ee.vc,2),"%n":()=>`
`,"%p":ee=>0<=ee.Fa&&12>ee.Fa?"AM":"PM","%S":ee=>C(ee.wc,2),"%t":()=>"	","%u":ee=>ee.R||7,"%U":ee=>C(Math.floor((ee.ca+7-ee.R)/7),2),"%V":ee=>{var Te=Math.floor((ee.ca+7-(ee.R+6)%7)/7);if(2>=(ee.R+371-ee.ca-2)%7&&Te++,Te)Te==53&&(ke=(ee.R+371-ee.ca)%7,ke==4||ke==3&&br(ee.da)||(Te=1));else{Te=52;var ke=(ee.R+7-ee.ca-1)%7;(ke==4||ke==5&&br(ee.da%400-1))&&Te++}return C(Te,2)},"%w":ee=>ee.R,"%W":ee=>C(Math.floor((ee.ca+7-(ee.R+6)%7)/7),2),"%y":ee=>(ee.da+1900).toString().substring(2),"%Y":ee=>ee.da+1900,"%z":ee=>{ee=ee.uc;var Te=0<=ee;return ee=Math.abs(ee)/60,(Te?"+":"-")+("0000"+(ee/60*100+ee%60)).slice(-4)},"%Z":ee=>ee.xc,"%%":()=>"%"},f=f.replace(/%%/g,"\0\0");for(xe in le)f.includes(xe)&&(f=f.replace(new RegExp(xe,"g"),le[xe](y)));return f=f.replace(/\0\0/g,"%"),xe=st(f,!1),xe.length>l?0:(O.set(xe,s),xe.length-1)};function vi(s,l,f,y){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Ti++,this.name=l,this.mode=f,this.l={},this.m={},this.za=y}Object.defineProperties(vi.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),zr(),Gt=Array(4096),Vr(Pe,"/"),bt("/tmp",16895,0),bt("/home",16895,0),bt("/home/web_user",16895,0),(()=>{bt("/dev",16895,0),Er(259,{read:()=>0,write:(y,A,C,K)=>K}),ir("/dev/null",259),qe(1280,nt),qe(1536,at),ir("/dev/tty",1280),ir("/dev/tty1",1536);var s=new Uint8Array(1024),l=0,f=()=>(l===0&&(l=Oe(s).byteLength),s[--l]);Vt("random",f),Vt("urandom",f),bt("/dev/shm",16895,0),bt("/dev/shm/tmp",16895,0)})(),(()=>{bt("/proc",16895,0);var s=bt("/proc/self",16895,0);bt("/proc/self/fd",16895,0),Vr({U:()=>{var l=Br(s,"fd",16895,73);return l.l={ka:(f,y)=>{var A=Pt(+y);return f={parent:null,U:{nb:"fake"},l:{ma:()=>A.path}},f.parent=f}},l}},"/proc/self/fd")})(),Object.assign(Jr.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var l=this.ib.pop()||this.M.length;return this.M[l]=s,l},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Ut=p.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},gt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),gt.h=gt.M.length,p.count_emval_handles=function(){for(var s=0,l=gt.h;l<gt.M.length;++l)gt.M[l]!==void 0&&++s;return s},Qr=p.PureVirtualError=Xr("PureVirtualError");for(var _i=Array(256),yr=0;256>yr;++yr)_i[yr]=String.fromCharCode(yr);Zr=_i,p.getInheritedInstanceCount=function(){return Object.keys(It).length},p.getLiveInheritedInstances=function(){var s=[],l;for(l in It)It.hasOwnProperty(l)&&s.push(It[l]);return s},p.flushPendingDeletes=Ar,p.setDelayFunction=function(s){Yt=s,Kt.length&&Yt&&Yt(Ar)},ni=p.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Ot.prototype.isAliasOf=function(s){if(!(this instanceof Ot&&s instanceof Ot))return!1;var l=this.g.u.i,f=this.g.o,y=s.g.u.i;for(s=s.g.o;l.A;)f=l.na(f),l=l.A;for(;y.A;)s=y.na(s),y=y.A;return l===y&&f===s},Ot.prototype.clone=function(){if(this.g.o||xr(this),this.g.ia)return this.g.count.value+=1,this;var s=Bt,l=Object,f=l.create,y=Object.getPrototypeOf(this),A=this.g;return s=s(f.call(l,y,{g:{value:{count:A.count,fa:A.fa,ia:A.ia,o:A.o,u:A.u,G:A.G,L:A.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Ot.prototype.delete=function(){this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),or(this),ti(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Ot.prototype.isDeleted=function(){return!this.g.o},Ot.prototype.deleteLater=function(){return this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),Kt.push(this),Kt.length===1&&Yt&&Yt(Ar),this.g.fa=!0,this},Tt.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Tt.prototype.bb=function(s){this.W&&this.W(s)},Tt.prototype.argPackAdvance=8,Tt.prototype.readValueFromPointer=Qt,Tt.prototype.deleteObject=function(s){s!==null&&s.delete()},Tt.prototype.fromWireType=function(s){function l(){return this.ua?cr(this.i.N,{u:this.nc,o:f,L:this,G:s}):cr(this.i.N,{u:this,o:s})}var f=this.Vb(s);if(!f)return this.bb(s),null;var y=Pi(this.i,f);if(y!==void 0)return y.g.count.value===0?(y.g.o=f,y.g.G=s,y.clone()):(y=y.clone(),this.bb(s),y);if(y=this.i.Ub(f),y=ii[y],!y)return l.call(this);y=this.ta?y.Kb:y.pointerType;var A=ri(f,this.i,y.i);return A===null?l.call(this):this.ua?cr(y.i.N,{u:y,o:A,L:this,G:s}):cr(y.i.N,{u:y,o:A})},oi=p.UnboundTypeError=Xr("UnboundTypeError");var gi={__syscall_fcntl64:function(s,l,f){zt=f;try{var y=Pt(s);switch(l){case 0:var A=At();return 0>A?-28:Gr(y,A).X;case 1:case 2:return 0;case 3:return y.flags;case 4:return A=At(),y.flags|=A,0;case 5:return A=At(),ce[A+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return se[pi()>>2]=28,-1;default:return-28}}catch(C){if(typeof Mt>"u"||C.name!=="ErrnoError")throw C;return-C.aa}},__syscall_ioctl:function(s,l,f){zt=f;try{var y=Pt(s);switch(l){case 21509:return y.s?0:-59;case 21505:if(!y.s)return-59;if(y.s.V.bc){l=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var A=At();se[A>>2]=25856,se[A+4>>2]=5,se[A+8>>2]=191,se[A+12>>2]=35387;for(var C=0;32>C;C++)O[A+C+17>>0]=l[C]||0}return 0;case 21510:case 21511:case 21512:return y.s?0:-59;case 21506:case 21507:case 21508:if(!y.s)return-59;if(y.s.V.cc)for(A=At(),l=[],C=0;32>C;C++)l.push(O[A+C+17>>0]);return 0;case 21519:return y.s?(A=At(),se[A>>2]=0):-59;case 21520:return y.s?-28:-59;case 21531:if(A=At(),!y.m.ac)throw new Ne(59);return y.m.ac(y,l,A);case 21523:return y.s?(y.s.V.dc&&(C=[24,80],A=At(),ce[A>>1]=C[0],ce[A+2>>1]=C[1]),0):-59;case 21524:return y.s?0:-59;case 21515:return y.s?0:-59;default:return-28}}catch(K){if(typeof Mt>"u"||K.name!=="ErrnoError")throw K;return-K.aa}},__syscall_openat:function(s,l,f,y){zt=y;try{l=l?We(z,l):"";var A=l;if(A.charAt(0)==="/")l=A;else{var C=s===-100?"/":Pt(s).path;if(A.length==0)throw new Ne(44);l=M(C+"/"+A)}var K=y?At():0;return nr(l,f,K).X}catch(de){if(typeof Mt>"u"||de.name!=="ErrnoError")throw de;return-de.aa}},_embind_create_inheriting_constructor:function(s,l,f){s=ct(s),l=Jt(l,"wrapper"),f=yt(f);var y=[].slice,A=l.i,C=A.N,K=A.A.N,de=A.A.constructor;s=ar(s,function(){A.A.rb.forEach((function(le){if(this[le]===K[le])throw new Qr(`Pure virtual function ${le} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:C}),this.__construct.apply(this,y.call(arguments))}),C.__construct=function(){this===C&&Ge("Pass correct 'this' to __construct");var le=de.implement.apply(void 0,[this].concat(y.call(arguments)));or(le);var xe=le.g;le.notifyOnDestruction(),xe.ia=!0,Object.defineProperties(this,{g:{value:xe}}),Bt(this),le=xe.o,le=Ir(A,le),It.hasOwnProperty(le)?Ge(`Tried to register registered instance: ${le}`):It[le]=this},C.__destruct=function(){this===C&&Ge("Pass correct 'this' to __destruct"),or(this);var le=this.g.o;le=Ir(A,le),It.hasOwnProperty(le)?delete It[le]:Ge(`Tried to unregister unregistered instance: ${le}`)},s.prototype=Object.create(C);for(var pe in f)s.prototype[pe]=f[pe];return wt(s)},_embind_finalize_value_object:function(s){var l=ur[s];delete ur[s];var f=l.Pa,y=l.W,A=l.fb,C=A.map(K=>K.Yb).concat(A.map(K=>K.rc));_t([s],C,K=>{var de={};return A.forEach((pe,le)=>{var xe=K[le],Re=pe.Wb,De=pe.Xb,ee=K[le+A.length],Te=pe.qc,ke=pe.sc;de[pe.Sb]={read:Ve=>xe.fromWireType(Re(De,Ve)),write:(Ve,ze)=>{var je=[];Te(ke,Ve,ee.toWireType(je,ze)),Xt(je)}}}),[{name:l.name,fromWireType:function(pe){var le={},xe;for(xe in de)le[xe]=de[xe].read(pe);return y(pe),le},toWireType:function(pe,le){for(var xe in de)if(!(xe in le))throw new TypeError(`Missing field: "${xe}"`);var Re=f();for(xe in de)de[xe].write(Re,le[xe]);return pe!==null&&pe.push(y,Re),Re},argPackAdvance:8,readValueFromPointer:Qt,K:y}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,l,f,y,A){var C=fr(f);l=ct(l),Et(s,{name:l,fromWireType:function(K){return!!K},toWireType:function(K,de){return de?y:A},argPackAdvance:8,readValueFromPointer:function(K){if(f===1)var de=O;else if(f===2)de=ce;else if(f===4)de=se;else throw new TypeError("Unknown boolean type size: "+l);return this.fromWireType(de[K>>C])},K:null})},_embind_register_class:function(s,l,f,y,A,C,K,de,pe,le,xe,Re,De){xe=ct(xe),C=vt(A,C),de&&(de=vt(K,de)),le&&(le=vt(pe,le)),De=vt(Re,De);var ee=Yr(xe);Rr(ee,function(){xt(`Cannot construct ${xe} due to unbound types`,[y])}),_t([s,l,f],y?[y]:[],function(Te){if(Te=Te[0],y)var ke=Te.i,Ve=ke.N;else Ve=Ot.prototype;Te=ar(ee,function(){if(Object.getPrototypeOf(this)!==ze)throw new Ut("Use 'new' to construct "+xe);if(je.$===void 0)throw new Ut(xe+" has no accessible constructor");var ht=je.$[arguments.length];if(ht===void 0)throw new Ut(`Tried to invoke ctor of ${xe} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(je.$).toString()}) parameters instead!`);return ht.apply(this,arguments)});var ze=Object.create(Ve,{constructor:{value:Te}});Te.prototype=ze;var je=new ji(xe,Te,ze,De,ke,C,de,le);je.A&&(je.A.oa===void 0&&(je.A.oa=[]),je.A.oa.push(je)),ke=new Tt(xe,je,!0,!1),Ve=new Tt(xe+"*",je,!1,!1);var ot=new Tt(xe+" const*",je,!1,!0);return ii[s]={pointerType:Ve,Kb:ot},si(ee,Te),[ke,Ve,ot]})},_embind_register_class_class_function:function(s,l,f,y,A,C,K){var de=gr(f,y);l=ct(l),C=vt(A,C),_t([],[s],function(pe){function le(){xt(`Cannot call ${xe} due to unbound types`,de)}pe=pe[0];var xe=`${pe.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]);var Re=pe.i.constructor;return Re[l]===void 0?(le.ea=f-1,Re[l]=le):(Cr(Re,l,xe),Re[l].B[f-1]=le),_t([],de,function(De){if(De=_r(xe,[De[0],null].concat(De.slice(1)),null,C,K),Re[l].B===void 0?(De.ea=f-1,Re[l]=De):Re[l].B[f-1]=De,pe.i.oa)for(const ee of pe.i.oa)ee.constructor.hasOwnProperty(l)||(ee.constructor[l]=De);return[]}),[]})},_embind_register_class_class_property:function(s,l,f,y,A,C,K,de){l=ct(l),C=vt(A,C),_t([],[s],function(pe){pe=pe[0];var le=`${pe.name}.${l}`,xe={get(){xt(`Cannot access ${le} due to unbound types`,[f])},enumerable:!0,configurable:!0};return xe.set=de?()=>{xt(`Cannot access ${le} due to unbound types`,[f])}:()=>{Ge(`${le} is a read-only property`)},Object.defineProperty(pe.i.constructor,l,xe),_t([],[f],function(Re){Re=Re[0];var De={get(){return Re.fromWireType(C(y))},enumerable:!0};return de&&(de=vt(K,de),De.set=ee=>{var Te=[];de(y,Re.toWireType(Te,ee)),Xt(Te)}),Object.defineProperty(pe.i.constructor,l,De),[]}),[]})},_embind_register_class_constructor:function(s,l,f,y,A,C){var K=gr(l,f);A=vt(y,A),_t([],[s],function(de){de=de[0];var pe=`constructor ${de.name}`;if(de.i.$===void 0&&(de.i.$=[]),de.i.$[l-1]!==void 0)throw new Ut(`Cannot register multiple constructors with identical number of parameters (${l-1}) for class '${de.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return de.i.$[l-1]=()=>{xt(`Cannot construct ${de.name} due to unbound types`,K)},_t([],K,function(le){return le.splice(1,0,null),de.i.$[l-1]=_r(pe,le,null,A,C),[]}),[]})},_embind_register_class_function:function(s,l,f,y,A,C,K,de){var pe=gr(f,y);l=ct(l),C=vt(A,C),_t([],[s],function(le){function xe(){xt(`Cannot call ${Re} due to unbound types`,pe)}le=le[0];var Re=`${le.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),de&&le.i.rb.push(l);var De=le.i.N,ee=De[l];return ee===void 0||ee.B===void 0&&ee.className!==le.name&&ee.ea===f-2?(xe.ea=f-2,xe.className=le.name,De[l]=xe):(Cr(De,l,Re),De[l].B[f-2]=xe),_t([],pe,function(Te){return Te=_r(Re,Te,le,C,K),De[l].B===void 0?(Te.ea=f-2,De[l]=Te):De[l].B[f-2]=Te,[]}),[]})},_embind_register_class_property:function(s,l,f,y,A,C,K,de,pe,le){l=ct(l),A=vt(y,A),_t([],[s],function(xe){xe=xe[0];var Re=`${xe.name}.${l}`,De={get(){xt(`Cannot access ${Re} due to unbound types`,[f,K])},enumerable:!0,configurable:!0};return De.set=pe?()=>{xt(`Cannot access ${Re} due to unbound types`,[f,K])}:()=>{Ge(Re+" is a read-only property")},Object.defineProperty(xe.i.N,l,De),_t([],pe?[f,K]:[f],function(ee){var Te=ee[0],ke={get(){var ze=li(this,xe,Re+" getter");return Te.fromWireType(A(C,ze))},enumerable:!0};if(pe){pe=vt(de,pe);var Ve=ee[1];ke.set=function(ze){var je=li(this,xe,Re+" setter"),ot=[];pe(le,je,Ve.toWireType(ot,ze)),Xt(ot)}}return Object.defineProperty(xe.i.N,l,ke),[]}),[]})},_embind_register_emval:function(s,l){l=ct(l),Et(s,{name:l,fromWireType:function(f){var y=yt(f);return Pr(f),y},toWireType:function(f,y){return wt(y)},argPackAdvance:8,readValueFromPointer:Qt,K:null})},_embind_register_enum:function(s,l,f,y){function A(){}f=fr(f),l=ct(l),A.values={},Et(s,{name:l,constructor:A,fromWireType:function(C){return this.constructor.values[C]},toWireType:function(C,K){return K.value},argPackAdvance:8,readValueFromPointer:Fi(l,f,y),K:null}),Rr(l,A)},_embind_register_enum_value:function(s,l,f){var y=Jt(s,"enum");l=ct(l),s=y.constructor,y=Object.create(y.constructor.prototype,{value:{value:f},constructor:{value:ar(`${y.name}_${l}`,function(){})}}),s.values[f]=y,s[l]=y},_embind_register_float:function(s,l,f){f=fr(f),l=ct(l),Et(s,{name:l,fromWireType:function(y){return y},toWireType:function(y,A){return A},argPackAdvance:8,readValueFromPointer:Ui(l,f),K:null})},_embind_register_function:function(s,l,f,y,A,C){var K=gr(l,f);s=ct(s),A=vt(y,A),Rr(s,function(){xt(`Cannot call ${s} due to unbound types`,K)},l-1),_t([],K,function(de){return si(s,_r(s,[de[0],null].concat(de.slice(1)),null,A,C),l-1),[]})},_embind_register_integer:function(s,l,f,y,A){l=ct(l),A===-1&&(A=4294967295),A=fr(f);var C=de=>de;if(y===0){var K=32-8*f;C=de=>de<<K>>>K}f=l.includes("unsigned")?function(de,pe){return pe>>>0}:function(de,pe){return pe},Et(s,{name:l,fromWireType:C,toWireType:f,argPackAdvance:8,readValueFromPointer:Bi(l,A,y!==0),K:null})},_embind_register_memory_view:function(s,l,f){function y(C){C>>=2;var K=ve;return new A(K.buffer,K[C+1],K[C])}var A=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][l];f=ct(f),Et(s,{name:f,fromWireType:y,argPackAdvance:8,readValueFromPointer:y},{$b:!0})},_embind_register_std_string:function(s,l){l=ct(l);var f=l==="std::string";Et(s,{name:l,fromWireType:function(y){var A=ve[y>>2],C=y+4;if(f)for(var K=C,de=0;de<=A;++de){var pe=C+de;if(de==A||z[pe]==0){if(K=K?We(z,K,pe-K):"",le===void 0)var le=K;else le+="\0",le+=K;K=pe+1}}else{for(le=Array(A),de=0;de<A;++de)le[de]=String.fromCharCode(z[C+de]);le=le.join("")}return Ct(y),le},toWireType:function(y,A){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var C=typeof A=="string";C||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int8Array||Ge("Cannot pass non-string to std::string");var K=f&&C?Je(A):A.length,de=Dr(4+K+1),pe=de+4;if(ve[de>>2]=K,f&&C)lt(A,z,pe,K+1);else if(C)for(C=0;C<K;++C){var le=A.charCodeAt(C);255<le&&(Ct(pe),Ge("String has UTF-16 code units that do not fit in 8 bits")),z[pe+C]=le}else for(C=0;C<K;++C)z[pe+C]=A[C];return y!==null&&y.push(Ct,de),de},argPackAdvance:8,readValueFromPointer:Qt,K:function(y){Ct(y)}})},_embind_register_std_wstring:function(s,l,f){if(f=ct(f),l===2)var y=Wi,A=qi,C=Gi,K=()=>he,de=1;else l===4&&(y=Vi,A=Hi,C=zi,K=()=>ve,de=2);Et(s,{name:f,fromWireType:function(pe){for(var le=ve[pe>>2],xe=K(),Re,De=pe+4,ee=0;ee<=le;++ee){var Te=pe+4+ee*l;(ee==le||xe[Te>>de]==0)&&(De=y(De,Te-De),Re===void 0?Re=De:(Re+="\0",Re+=De),De=Te+l)}return Ct(pe),Re},toWireType:function(pe,le){typeof le!="string"&&Ge(`Cannot pass non-string to C++ string type ${f}`);var xe=C(le),Re=Dr(4+xe+l);return ve[Re>>2]=xe>>de,A(le,Re+4,xe+l),pe!==null&&pe.push(Ct,Re),Re},argPackAdvance:8,readValueFromPointer:Qt,K:function(pe){Ct(pe)}})},_embind_register_value_object:function(s,l,f,y,A,C){ur[s]={name:ct(l),Pa:vt(f,y),W:vt(A,C),fb:[]}},_embind_register_value_object_field:function(s,l,f,y,A,C,K,de,pe,le){ur[s].fb.push({Sb:ct(l),Yb:f,Wb:vt(y,A),Xb:C,rc:K,qc:vt(de,pe),sc:le})},_embind_register_void:function(s,l){l=ct(l),Et(s,{fc:!0,name:l,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,l,f){s=yt(s),l=Jt(l,"emval::as");var y=[],A=wt(y);return ve[f>>2]=A,l.toWireType(y,s)},_emval_call_method:function(s,l,f,y,A){s=mr[s],l=yt(l),f=pr(f);var C=[];return ve[y>>2]=wt(C),s(l,f,C,A)},_emval_call_void_method:function(s,l,f,y){s=mr[s],l=yt(l),f=pr(f),s(l,f,null,y)},_emval_decref:Pr,_emval_get_method_caller:function(s,l){var f=Ji(s,l),y=f[0];l=y.name+"_$"+f.slice(1).map(function(K){return K.name}).join("_")+"$";var A=ui[l];if(A!==void 0)return A;var C=Array(s-1);return A=Yi((K,de,pe,le)=>{for(var xe=0,Re=0;Re<s-1;++Re)C[Re]=f[Re+1].readValueFromPointer(le+xe),xe+=f[Re+1].argPackAdvance;for(K=K[de].apply(K,C),Re=0;Re<s-1;++Re)f[Re+1].Nb&&f[Re+1].Nb(C[Re]);if(!y.fc)return y.toWireType(pe,K)}),ui[l]=A},_emval_get_module_property:function(s){return s=pr(s),wt(p[s])},_emval_get_property:function(s,l){return s=yt(s),l=yt(l),wt(s[l])},_emval_incref:function(s){4<s&&(gt.get(s).ub+=1)},_emval_new_array:function(){return wt([])},_emval_new_cstring:function(s){return wt(pr(s))},_emval_new_object:function(){return wt({})},_emval_run_destructors:function(s){var l=yt(s);Xt(l),Pr(s)},_emval_set_property:function(s,l,f){s=yt(s),l=yt(l),f=yt(f),s[l]=f},_emval_take_value:function(s,l){return s=Jt(s,"_emval_take_value"),s=s.readValueFromPointer(l),wt(s)},abort:()=>{B("")},emscripten_asm_const_int:(s,l,f)=>{jr.length=0;var y;for(f>>=2;y=z[l++];)f+=y!=105&f,jr.push(y==105?se[f]:be[f++>>1]),++f;return c[s].apply(null,jr)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,l,f)=>z.copyWithin(s,l,l+f),emscripten_resize_heap:s=>{var l=z.length;if(s>>>=0,2147483648<s)return!1;for(var f=1;4>=f;f*=2){var y=l*(1+.2/f);y=Math.min(y,s+100663296);var A=Math;y=Math.max(s,y);e:{A=A.min.call(A,2147483648,y+(65536-y%65536)%65536)-V.buffer.byteLength+65535>>>16;try{V.grow(A),ue();var C=1;break e}catch{}C=void 0}if(C)return!0}return!1},environ_get:(s,l)=>{var f=0;return di().forEach(function(y,A){var C=l+f;for(A=ve[s+4*A>>2]=C,C=0;C<y.length;++C)O[A++>>0]=y.charCodeAt(C);O[A>>0]=0,f+=y.length+1}),0},environ_sizes_get:(s,l)=>{var f=di();ve[s>>2]=f.length;var y=0;return f.forEach(function(A){y+=A.length+1}),ve[l>>2]=y,0},fd_close:function(s){try{var l=Pt(s);if(l.X===null)throw new Ne(8);l.Ma&&(l.Ma=null);try{l.m.close&&l.m.close(l)}catch(f){throw f}finally{Rt[l.X]=null}return l.X=null,0}catch(f){if(typeof Mt>"u"||f.name!=="ErrnoError")throw f;return f.aa}},fd_read:function(s,l,f,y){try{e:{var A=Pt(s);s=l;for(var C,K=l=0;K<f;K++){var de=ve[s>>2],pe=ve[s+4>>2];s+=8;var le=A,xe=de,Re=pe,De=C,ee=O;if(0>Re||0>De)throw new Ne(28);if(le.X===null)throw new Ne(8);if((le.flags&2097155)===1)throw new Ne(8);if((le.node.mode&61440)===16384)throw new Ne(31);if(!le.m.read)throw new Ne(28);var Te=typeof De<"u";if(!Te)De=le.position;else if(!le.seekable)throw new Ne(70);var ke=le.m.read(le,ee,xe,Re,De);Te||(le.position+=ke);var Ve=ke;if(0>Ve){var ze=-1;break e}if(l+=Ve,Ve<pe)break;typeof C<"u"&&(C+=Ve)}ze=l}return ve[y>>2]=ze,0}catch(je){if(typeof Mt>"u"||je.name!=="ErrnoError")throw je;return je.aa}},fd_seek:function(s,l,f,y,A){l=f+2097152>>>0<4194305-!!l?(l>>>0)+4294967296*f:NaN;try{if(isNaN(l))return 61;var C=Pt(s);return Hr(C,l,y),w=[C.position>>>0,(Le=C.position,1<=+Math.abs(Le)?0<Le?+Math.floor(Le/4294967296)>>>0:~~+Math.ceil((Le-+(~~Le>>>0))/4294967296)>>>0:0)],se[A>>2]=w[0],se[A+4>>2]=w[1],C.Ma&&l===0&&y===0&&(C.Ma=null),0}catch(K){if(typeof Mt>"u"||K.name!=="ErrnoError")throw K;return K.aa}},fd_write:function(s,l,f,y){try{e:{var A=Pt(s);s=l;for(var C,K=l=0;K<f;K++){var de=ve[s>>2],pe=ve[s+4>>2];s+=8;var le=A,xe=de,Re=pe,De=C,ee=O;if(0>Re||0>De)throw new Ne(28);if(le.X===null)throw new Ne(8);if((le.flags&2097155)===0)throw new Ne(8);if((le.node.mode&61440)===16384)throw new Ne(31);if(!le.m.write)throw new Ne(28);le.seekable&&le.flags&1024&&Hr(le,0,2);var Te=typeof De<"u";if(!Te)De=le.position;else if(!le.seekable)throw new Ne(70);var ke=le.m.write(le,ee,xe,Re,De,void 0);Te||(le.position+=ke);var Ve=ke;if(0>Ve){var ze=-1;break e}l+=Ve,typeof C<"u"&&(C+=Ve)}ze=l}return ve[y>>2]=ze,0}catch(je){if(typeof Mt>"u"||je.name!=="ErrnoError")throw je;return je.aa}},strftime_l:(s,l,f,y)=>Xi(s,l,f,y)};(function(){function s(f){if(G=f=f.exports,V=G.memory,ue(),ie=G.__indirect_function_table,Q.unshift(G.__wasm_call_ctors),W--,p.monitorRunDependencies&&p.monitorRunDependencies(W),W==0&&Z){var y=Z;Z=null,y()}return f}var l={env:gi,wasi_snapshot_preview1:gi};if(W++,p.monitorRunDependencies&&p.monitorRunDependencies(W),p.instantiateWasm)try{return p.instantiateWasm(l,s)}catch(f){ge("Module.instantiateWasm callback failed with error: "+f),T(f)}return Ce(l,function(f){s(f.instance)}).catch(T),{}})();var Ct=s=>(Ct=G.free)(s),Dr=s=>(Dr=G.malloc)(s),pi=()=>(pi=G.__errno_location)(),mi=p._ma_device__on_notification_unlocked=s=>(mi=p._ma_device__on_notification_unlocked=G.ma_device__on_notification_unlocked)(s);p._ma_malloc_emscripten=(s,l)=>(p._ma_malloc_emscripten=G.ma_malloc_emscripten)(s,l),p._ma_free_emscripten=(s,l)=>(p._ma_free_emscripten=G.ma_free_emscripten)(s,l);var bi=p._ma_device_process_pcm_frames_capture__webaudio=(s,l,f)=>(bi=p._ma_device_process_pcm_frames_capture__webaudio=G.ma_device_process_pcm_frames_capture__webaudio)(s,l,f),yi=p._ma_device_process_pcm_frames_playback__webaudio=(s,l,f)=>(yi=p._ma_device_process_pcm_frames_playback__webaudio=G.ma_device_process_pcm_frames_playback__webaudio)(s,l,f),wi=s=>(wi=G.__getTypeName)(s);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=G._embind_initialize_bindings)(),p.dynCall_iiji=(s,l,f,y,A)=>(p.dynCall_iiji=G.dynCall_iiji)(s,l,f,y,A),p.dynCall_jiji=(s,l,f,y,A)=>(p.dynCall_jiji=G.dynCall_jiji)(s,l,f,y,A),p.dynCall_iiiji=(s,l,f,y,A,C)=>(p.dynCall_iiiji=G.dynCall_iiiji)(s,l,f,y,A,C),p.dynCall_iij=(s,l,f,y)=>(p.dynCall_iij=G.dynCall_iij)(s,l,f,y),p.dynCall_jii=(s,l,f)=>(p.dynCall_jii=G.dynCall_jii)(s,l,f),p.dynCall_viijii=(s,l,f,y,A,C,K)=>(p.dynCall_viijii=G.dynCall_viijii)(s,l,f,y,A,C,K),p.dynCall_iiiiij=(s,l,f,y,A,C,K)=>(p.dynCall_iiiiij=G.dynCall_iiiiij)(s,l,f,y,A,C,K),p.dynCall_iiiiijj=(s,l,f,y,A,C,K,de,pe)=>(p.dynCall_iiiiijj=G.dynCall_iiiiijj)(s,l,f,y,A,C,K,de,pe),p.dynCall_iiiiiijj=(s,l,f,y,A,C,K,de,pe,le)=>(p.dynCall_iiiiiijj=G.dynCall_iiiiiijj)(s,l,f,y,A,C,K,de,pe,le);var wr;Z=function s(){wr||$i(),wr||(Z=s)};function $i(){function s(){if(!wr&&(wr=!0,p.calledRun=!0,!q)){if(p.noFSInit||Kr||(Kr=!0,zr(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?Vt("stdin",p.stdin):Sr("/dev/tty","/dev/stdin"),p.stdout?Vt("stdout",null,p.stdout):Sr("/dev/tty","/dev/stdout"),p.stderr?Vt("stderr",null,p.stderr):Sr("/dev/tty1","/dev/stderr"),nr("/dev/stdin",0),nr("/dev/stdout",1),nr("/dev/stderr",1)),Nr=!1,d(Q),E(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var l=p.postRun.shift();ae.unshift(l)}d(ae)}}if(!(0<W)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)H();d(oe),0<W||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),s()},1)):s())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return $i(),$.ready})})();const g=v}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,_)=>{_.r(h),_.d(h,{Animation:()=>v.Animation});var v=_(4)}),((u,h,_)=>{_.r(h),_.d(h,{Animation:()=>v});var v=(function(){function g(m,$,p,E){this.animation=m,this.artboard=$,this.playing=E,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(m,$)}return Object.defineProperty(g.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"time",{get:function(){return this.instance.time},set:function(m){this.instance.time=m},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),g.prototype.advance=function(m){this.scrubTo===null?this.instance.advance(m):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},g.prototype.apply=function(m){this.instance.apply(m)},g.prototype.cleanup=function(){this.instance.delete()},g})()}),((u,h,_)=>{_.r(h),_.d(h,{AudioAssetWrapper:()=>m.AudioAssetWrapper,AudioWrapper:()=>m.AudioWrapper,BLANK_URL:()=>g.BLANK_URL,CustomFileAssetLoaderWrapper:()=>m.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>m.FileAssetWrapper,Finalizable:()=>m.Finalizable,FontAssetWrapper:()=>m.FontAssetWrapper,FontWrapper:()=>m.FontWrapper,ImageAssetWrapper:()=>m.ImageAssetWrapper,ImageWrapper:()=>m.ImageWrapper,finalizationRegistry:()=>m.finalizationRegistry,registerTouchInteractions:()=>v.registerTouchInteractions,sanitizeUrl:()=>g.sanitizeUrl});var v=_(6),g=_(7),m=_(8)}),((u,h,_)=>{_.r(h),_.d(h,{registerTouchInteractions:()=>m});var v=void 0,g=function($,p){var E,T;return["touchstart","touchmove"].indexOf($.type)>-1&&(!((E=$.touches)===null||E===void 0)&&E.length)?(p||$.preventDefault(),{clientX:$.touches[0].clientX,clientY:$.touches[0].clientY}):$.type==="touchend"&&(!((T=$.changedTouches)===null||T===void 0)&&T.length)?{clientX:$.changedTouches[0].clientX,clientY:$.changedTouches[0].clientY}:{clientX:$.clientX,clientY:$.clientY}},m=function($){var p=$.canvas,E=$.artboard,T=$.stateMachines,x=T===void 0?[]:T,D=$.renderer,R=$.rive,P=$.fit,N=$.alignment,J=$.isTouchScrollEnabled,I=J===void 0?!1:J,k=$.layoutScaleFactor,j=k===void 0?1:k;if(!p||!x.length||!D||!R||!E||typeof window>"u")return null;var F=null,U=!1,L=function(fe){if(U&&fe instanceof MouseEvent){fe.type=="mouseup"&&(U=!1);return}U=I&&fe.type==="touchend"&&F==="touchstart",F=fe.type;var ge=fe.currentTarget.getBoundingClientRect(),re=g(fe,I),V=re.clientX,G=re.clientY;if(!(!V&&!G)){var q=V-ge.left,O=G-ge.top,z=R.computeAlignment(P,N,{minX:0,minY:0,maxX:ge.width,maxY:ge.height},E.bounds,j),ce=new R.Mat2D;z.invert(ce);var he=new R.Vec2D(q,O),se=R.mapXY(ce,he),ve=se.x(),me=se.y();switch(se.delete(),ce.delete(),he.delete(),z.delete(),fe.type){case"mouseout":for(var be=0,ue=x;be<ue.length;be++){var ie=ue[be];ie.pointerMove(ve,me)}break;case"touchmove":case"mouseover":case"mousemove":{for(var oe=0,Q=x;oe<Q.length;oe++){var ie=Q[oe];ie.pointerMove(ve,me)}break}case"touchstart":case"mousedown":{for(var ae=0,H=x;ae<H.length;ae++){var ie=H[ae];ie.pointerDown(ve,me)}break}case"touchend":case"mouseup":{for(var W=0,Z=x;W<Z.length;W++){var ie=Z[W];ie.pointerUp(ve,me)}break}}}},X=L.bind(v);return p.addEventListener("mouseover",X),p.addEventListener("mouseout",X),p.addEventListener("mousemove",X),p.addEventListener("mousedown",X),p.addEventListener("mouseup",X),p.addEventListener("touchmove",X,{passive:I}),p.addEventListener("touchstart",X,{passive:I}),p.addEventListener("touchend",X),function(){p.removeEventListener("mouseover",X),p.removeEventListener("mouseout",X),p.removeEventListener("mousemove",X),p.removeEventListener("mousedown",X),p.removeEventListener("mouseup",X),p.removeEventListener("touchmove",X),p.removeEventListener("touchstart",X),p.removeEventListener("touchend",X)}}}),((u,h,_)=>{_.r(h),_.d(h,{BLANK_URL:()=>T,sanitizeUrl:()=>R});var v=/^([^\w]*)(javascript|data|vbscript)/im,g=/&#(\w+)(^\w|;)?/g,m=/&(newline|tab);/gi,$=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,E=[".","/"],T="about:blank";function x(P){return E.indexOf(P[0])>-1}function D(P){var N=P.replace($,"");return N.replace(g,function(J,I){return String.fromCharCode(I)})}function R(P){if(!P)return T;var N=D(P).replace(m,"").replace($,"").trim();if(!N)return T;if(x(N))return N;var J=N.match(p);if(!J)return N;var I=J[0];return v.test(I)?T:N}}),((u,h,_)=>{_.r(h),_.d(h,{AudioAssetWrapper:()=>D,AudioWrapper:()=>$,CustomFileAssetLoaderWrapper:()=>E,FileAssetWrapper:()=>T,Finalizable:()=>g,FontAssetWrapper:()=>R,FontWrapper:()=>p,ImageAssetWrapper:()=>x,ImageWrapper:()=>m,finalizationRegistry:()=>J});var v=(function(){var I=function(k,j){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,U){F.__proto__=U}||function(F,U){for(var L in U)Object.prototype.hasOwnProperty.call(U,L)&&(F[L]=U[L])},I(k,j)};return function(k,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");I(k,j);function F(){this.constructor=k}k.prototype=j===null?Object.create(j):(F.prototype=j.prototype,new F)}})(),g=(function(){function I(){this.selfUnref=!1}return I})(),m=(function(I){v(k,I);function k(j){var F=I.call(this)||this;return F._nativeImage=j,F}return Object.defineProperty(k.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},k})(g),$=(function(I){v(k,I);function k(j){var F=I.call(this)||this;return F._nativeAudio=j,F}return Object.defineProperty(k.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},k})(g),p=(function(I){v(k,I);function k(j){var F=I.call(this)||this;return F._nativeFont=j,F}return Object.defineProperty(k.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},k})(g),E=(function(){function I(k,j){this._assetLoaderCallback=j,this.assetLoader=new k.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return I.prototype.loadContents=function(k,j){var F;return k.isImage?F=new x(k):k.isAudio?F=new D(k):k.isFont&&(F=new R(k)),this._assetLoaderCallback(F,j)},I})(),T=(function(){function I(k){this._nativeFileAsset=k}return I.prototype.decode=function(k){this._nativeFileAsset.decode(k)},Object.defineProperty(I.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),I})(),x=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setRenderImage=function(j){this._nativeFileAsset.setRenderImage(j.nativeImage)},k})(T),D=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setAudioSource=function(j){this._nativeFileAsset.setAudioSource(j.nativeAudio)},k})(T),R=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setFont=function(j){this._nativeFileAsset.setFont(j.nativeFont)},k})(T),P=(function(){function I(k){}return I.prototype.register=function(k){k.selfUnref=!0},I.prototype.unregister=function(k){},I})(),N=typeof FinalizationRegistry<"u"?FinalizationRegistry:P,J=new N(function(I){I.unref()})})],i={};function n(u){var h=i[u];if(h!==void 0)return h.exports;var _=i[u]={exports:{}};return t[u](_,_.exports,n),_.exports}n.d=(u,h)=>{for(var _ in h)n.o(h,_)&&!n.o(u,_)&&Object.defineProperty(u,_,{enumerable:!0,get:h[_]})},n.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),n.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{Alignment:()=>R,DataEnum:()=>me,EventType:()=>L,Fit:()=>D,Layout:()=>P,LoopType:()=>X,Rive:()=>se,RiveEventType:()=>k,RiveFile:()=>he,RuntimeLoader:()=>N,StateMachineInput:()=>I,StateMachineInputType:()=>J,Testing:()=>Ee,ViewModel:()=>ve,ViewModelInstance:()=>ue,ViewModelInstanceArtboard:()=>ne,ViewModelInstanceAssetImage:()=>te,ViewModelInstanceBoolean:()=>ae,ViewModelInstanceColor:()=>B,ViewModelInstanceEnum:()=>W,ViewModelInstanceList:()=>Z,ViewModelInstanceNumber:()=>Q,ViewModelInstanceString:()=>oe,ViewModelInstanceTrigger:()=>H,ViewModelInstanceValue:()=>ie,decodeAudio:()=>$e,decodeFont:()=>Le,decodeImage:()=>Ce});var u=n(1),h=n(2),_=n(3),v=n(5),g=(function(){var w=function(c,d){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,M){S.__proto__=M}||function(S,M){for(var Y in M)Object.prototype.hasOwnProperty.call(M,Y)&&(S[Y]=M[Y])},w(c,d)};return function(c,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");w(c,d);function S(){this.constructor=c}c.prototype=d===null?Object.create(d):(S.prototype=d.prototype,new S)}})(),m=function(){return m=Object.assign||function(w){for(var c,d=1,S=arguments.length;d<S;d++){c=arguments[d];for(var M in c)Object.prototype.hasOwnProperty.call(c,M)&&(w[M]=c[M])}return w},m.apply(this,arguments)},$=function(w,c,d,S){function M(Y){return Y instanceof d?Y:new d(function(_e){_e(Y)})}return new(d||(d=Promise))(function(Y,_e){function Ie(Fe){try{Ae(S.next(Fe))}catch(We){_e(We)}}function Oe(Fe){try{Ae(S.throw(Fe))}catch(We){_e(We)}}function Ae(Fe){Fe.done?Y(Fe.value):M(Fe.value).then(Ie,Oe)}Ae((S=S.apply(w,c||[])).next())})},p=function(w,c){var d={label:0,sent:function(){if(Y[0]&1)throw Y[1];return Y[1]},trys:[],ops:[]},S,M,Y,_e=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return _e.next=Ie(0),_e.throw=Ie(1),_e.return=Ie(2),typeof Symbol=="function"&&(_e[Symbol.iterator]=function(){return this}),_e;function Ie(Ae){return function(Fe){return Oe([Ae,Fe])}}function Oe(Ae){if(S)throw new TypeError("Generator is already executing.");for(;_e&&(_e=0,Ae[0]&&(d=0)),d;)try{if(S=1,M&&(Y=Ae[0]&2?M.return:Ae[0]?M.throw||((Y=M.return)&&Y.call(M),0):M.next)&&!(Y=Y.call(M,Ae[1])).done)return Y;switch(M=0,Y&&(Ae=[Ae[0]&2,Y.value]),Ae[0]){case 0:case 1:Y=Ae;break;case 4:return d.label++,{value:Ae[1],done:!1};case 5:d.label++,M=Ae[1],Ae=[0];continue;case 7:Ae=d.ops.pop(),d.trys.pop();continue;default:if(Y=d.trys,!(Y=Y.length>0&&Y[Y.length-1])&&(Ae[0]===6||Ae[0]===2)){d=0;continue}if(Ae[0]===3&&(!Y||Ae[1]>Y[0]&&Ae[1]<Y[3])){d.label=Ae[1];break}if(Ae[0]===6&&d.label<Y[1]){d.label=Y[1],Y=Ae;break}if(Y&&d.label<Y[2]){d.label=Y[2],d.ops.push(Ae);break}Y[2]&&d.ops.pop(),d.trys.pop();continue}Ae=c.call(w,d)}catch(Fe){Ae=[6,Fe],M=0}finally{S=Y=0}if(Ae[0]&5)throw Ae[1];return{value:Ae[0]?Ae[1]:void 0,done:!0}}},E=function(w,c,d){if(d||arguments.length===2)for(var S=0,M=c.length,Y;S<M;S++)(Y||!(S in c))&&(Y||(Y=Array.prototype.slice.call(c,0,S)),Y[S]=c[S]);return w.concat(Y||Array.prototype.slice.call(c))},T=(function(w){g(c,w);function c(){var d=w!==null&&w.apply(this,arguments)||this;return d.isHandledError=!0,d}return c})(Error),x=function(w){return w&&w.isHandledError?w.message:"Problem loading file; may be corrupt!"},D;(function(w){w.Cover="cover",w.Contain="contain",w.Fill="fill",w.FitWidth="fitWidth",w.FitHeight="fitHeight",w.None="none",w.ScaleDown="scaleDown",w.Layout="layout"})(D||(D={}));var R;(function(w){w.Center="center",w.TopLeft="topLeft",w.TopCenter="topCenter",w.TopRight="topRight",w.CenterLeft="centerLeft",w.CenterRight="centerRight",w.BottomLeft="bottomLeft",w.BottomCenter="bottomCenter",w.BottomRight="bottomRight"})(R||(R={}));var P=(function(){function w(c){var d,S,M,Y,_e,Ie,Oe;this.fit=(d=c?.fit)!==null&&d!==void 0?d:D.Contain,this.alignment=(S=c?.alignment)!==null&&S!==void 0?S:R.Center,this.layoutScaleFactor=(M=c?.layoutScaleFactor)!==null&&M!==void 0?M:1,this.minX=(Y=c?.minX)!==null&&Y!==void 0?Y:0,this.minY=(_e=c?.minY)!==null&&_e!==void 0?_e:0,this.maxX=(Ie=c?.maxX)!==null&&Ie!==void 0?Ie:0,this.maxY=(Oe=c?.maxY)!==null&&Oe!==void 0?Oe:0}return w.new=function(c){var d=c.fit,S=c.alignment,M=c.minX,Y=c.minY,_e=c.maxX,Ie=c.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new w({fit:d,alignment:S,minX:M,minY:Y,maxX:_e,maxY:Ie})},w.prototype.copyWith=function(c){var d=c.fit,S=c.alignment,M=c.layoutScaleFactor,Y=c.minX,_e=c.minY,Ie=c.maxX,Oe=c.maxY;return new w({fit:d??this.fit,alignment:S??this.alignment,layoutScaleFactor:M??this.layoutScaleFactor,minX:Y??this.minX,minY:_e??this.minY,maxX:Ie??this.maxX,maxY:Oe??this.maxY})},w.prototype.runtimeFit=function(c){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===D.Cover?d=c.Fit.cover:this.fit===D.Contain?d=c.Fit.contain:this.fit===D.Fill?d=c.Fit.fill:this.fit===D.FitWidth?d=c.Fit.fitWidth:this.fit===D.FitHeight?d=c.Fit.fitHeight:this.fit===D.ScaleDown?d=c.Fit.scaleDown:this.fit===D.Layout?d=c.Fit.layout:d=c.Fit.none,this.cachedRuntimeFit=d,d},w.prototype.runtimeAlignment=function(c){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===R.TopLeft?d=c.Alignment.topLeft:this.alignment===R.TopCenter?d=c.Alignment.topCenter:this.alignment===R.TopRight?d=c.Alignment.topRight:this.alignment===R.CenterLeft?d=c.Alignment.centerLeft:this.alignment===R.CenterRight?d=c.Alignment.centerRight:this.alignment===R.BottomLeft?d=c.Alignment.bottomLeft:this.alignment===R.BottomCenter?d=c.Alignment.bottomCenter:this.alignment===R.BottomRight?d=c.Alignment.bottomRight:d=c.Alignment.center,this.cachedRuntimeAlignment=d,d},w})(),N=(function(){function w(){}return w.loadRuntime=function(){u.default({locateFile:function(){return w.wasmURL}}).then(function(c){var d;for(w.runtime=c;w.callBackQueue.length>0;)(d=w.callBackQueue.shift())===null||d===void 0||d(w.runtime)}).catch(function(c){var d={message:c?.message||"Unknown error",type:c?.name||"Error",wasmError:c instanceof WebAssembly.CompileError||c instanceof WebAssembly.RuntimeError,originalError:c};console.debug("Rive WASM load error details:",d);var S="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(w.wasmURL.toLowerCase()!==S)console.warn("Failed to load WASM from ".concat(w.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),w.setWasmUrl(S),w.loadRuntime();else{var M=["Could not load Rive WASM file from ".concat(w.wasmURL," or ").concat(S,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(M)}})},w.getInstance=function(c){w.isLoading||(w.isLoading=!0,w.loadRuntime()),w.runtime?c(w.runtime):w.callBackQueue.push(c)},w.awaitInstance=function(){return new Promise(function(c){return w.getInstance(function(d){return c(d)})})},w.setWasmUrl=function(c){w.wasmURL=c},w.getWasmUrl=function(){return w.wasmURL},w.isLoading=!1,w.callBackQueue=[],w.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),w})(),J;(function(w){w[w.Number=56]="Number",w[w.Trigger=58]="Trigger",w[w.Boolean=59]="Boolean"})(J||(J={}));var I=(function(){function w(c,d){this.type=c,this.runtimeInput=d}return Object.defineProperty(w.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(c){this.runtimeInput.value=c},enumerable:!1,configurable:!0}),w.prototype.fire=function(){this.type===J.Trigger&&this.runtimeInput.fire()},w.prototype.delete=function(){this.runtimeInput=null},w})(),k;(function(w){w[w.General=128]="General",w[w.OpenUrl=131]="OpenUrl"})(k||(k={}));var j=(function(){function w(c){this.nativeArtboard=c}return w})(),F=(function(){function w(c,d,S,M){this.stateMachine=c,this.playing=S,this.artboard=M,this.inputs=[],this.instance=new d.StateMachineInstance(c,M),this.initInputs(d)}return Object.defineProperty(w.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"statesChanged",{get:function(){for(var c=[],d=0;d<this.instance.stateChangedCount();d++)c.push(this.instance.stateChangedNameByIndex(d));return c},enumerable:!1,configurable:!0}),w.prototype.advance=function(c){this.instance.advance(c)},w.prototype.advanceAndApply=function(c){this.instance.advanceAndApply(c)},w.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},w.prototype.reportedEventAt=function(c){return this.instance.reportedEventAt(c)},w.prototype.initInputs=function(c){for(var d=0;d<this.instance.inputCount();d++){var S=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(S,c))}},w.prototype.mapRuntimeInput=function(c,d){if(c.type===d.SMIInput.bool)return new I(J.Boolean,c.asBool());if(c.type===d.SMIInput.number)return new I(J.Number,c.asNumber());if(c.type===d.SMIInput.trigger)return new I(J.Trigger,c.asTrigger())},w.prototype.cleanup=function(){this.inputs.forEach(function(c){c.delete()}),this.inputs.length=0,this.instance.delete()},w.prototype.bindViewModelInstance=function(c){c.runtimeInstance!=null&&this.instance.bindViewModelInstance(c.runtimeInstance)},w})(),U=(function(){function w(c,d,S,M,Y){M===void 0&&(M=[]),Y===void 0&&(Y=[]),this.runtime=c,this.artboard=d,this.eventManager=S,this.animations=M,this.stateMachines=Y}return w.prototype.add=function(c,d,S){if(S===void 0&&(S=!0),c=we(c),c.length===0)this.animations.forEach(function(Je){return Je.playing=d}),this.stateMachines.forEach(function(Je){return Je.playing=d});else for(var M=this.animations.map(function(Je){return Je.name}),Y=this.stateMachines.map(function(Je){return Je.name}),_e=0;_e<c.length;_e++){var Ie=M.indexOf(c[_e]),Oe=Y.indexOf(c[_e]);if(Ie>=0||Oe>=0)Ie>=0?this.animations[Ie].playing=d:this.stateMachines[Oe].playing=d;else{var Ae=this.artboard.animationByName(c[_e]);if(Ae){var Fe=new _.Animation(Ae,this.artboard,this.runtime,d);Fe.advance(0),Fe.apply(1),this.animations.push(Fe)}else{var We=this.artboard.stateMachineByName(c[_e]);if(We){var Ye=new F(We,this.runtime,d,this.artboard);this.stateMachines.push(Ye)}}}}return S&&(d?this.eventManager.fire({type:L.Play,data:this.playing}):this.eventManager.fire({type:L.Pause,data:this.paused})),d?this.playing:this.paused},w.prototype.initLinearAnimations=function(c,d){for(var S=this.animations.map(function(Oe){return Oe.name}),M=0;M<c.length;M++){var Y=S.indexOf(c[M]);if(Y>=0)this.animations[Y].playing=d;else{var _e=this.artboard.animationByName(c[M]);if(_e){var Ie=new _.Animation(_e,this.artboard,this.runtime,d);Ie.advance(0),Ie.apply(1),this.animations.push(Ie)}else console.error("Animation with name ".concat(c[M]," not found."))}}},w.prototype.initStateMachines=function(c,d){for(var S=this.stateMachines.map(function(Oe){return Oe.name}),M=0;M<c.length;M++){var Y=S.indexOf(c[M]);if(Y>=0)this.stateMachines[Y].playing=d;else{var _e=this.artboard.stateMachineByName(c[M]);if(_e){var Ie=new F(_e,this.runtime,d,this.artboard);this.stateMachines.push(Ie),d||Ie.advanceAndApply(0)}else console.warn("State Machine with name ".concat(c[M]," not found.")),this.initLinearAnimations([c[M]],d)}}},w.prototype.play=function(c){return this.add(c,!0)},w.prototype.pause=function(c){return this.add(c,!1)},w.prototype.scrub=function(c,d){var S=this.animations.filter(function(M){return c.includes(M.name)});return S.forEach(function(M){return M.scrubTo=d}),S.map(function(M){return M.name})},Object.defineProperty(w.prototype,"playing",{get:function(){return this.animations.filter(function(c){return c.playing}).map(function(c){return c.name}).concat(this.stateMachines.filter(function(c){return c.playing}).map(function(c){return c.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"paused",{get:function(){return this.animations.filter(function(c){return!c.playing}).map(function(c){return c.name}).concat(this.stateMachines.filter(function(c){return!c.playing}).map(function(c){return c.name}))},enumerable:!1,configurable:!0}),w.prototype.stop=function(c){var d=this;c=we(c);var S=[];if(c.length===0)S=this.animations.map(function(_e){return _e.name}).concat(this.stateMachines.map(function(_e){return _e.name})),this.animations.forEach(function(_e){return _e.cleanup()}),this.stateMachines.forEach(function(_e){return _e.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var M=this.animations.filter(function(_e){return c.includes(_e.name)});M.forEach(function(_e){_e.cleanup(),d.animations.splice(d.animations.indexOf(_e),1)});var Y=this.stateMachines.filter(function(_e){return c.includes(_e.name)});Y.forEach(function(_e){_e.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(_e),1)}),S=M.map(function(_e){return _e.name}).concat(Y.map(function(_e){return _e.name}))}return this.eventManager.fire({type:L.Stop,data:S}),S},Object.defineProperty(w.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(c,d){return c||d.playing},!1)||this.stateMachines.reduce(function(c,d){return c||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),w.prototype.atLeastOne=function(c,d){d===void 0&&(d=!0);var S;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([S=this.artboard.animationByIndex(0).name],c,d):this.artboard.stateMachineCount()>0&&this.add([S=this.artboard.stateMachineByIndex(0).name],c,d)),S},w.prototype.handleLooping=function(){for(var c=0,d=this.animations.filter(function(M){return M.playing});c<d.length;c++){var S=d[c];S.loopValue===0&&S.loopCount?(S.loopCount=0,this.stop(S.name)):S.loopValue===1&&S.loopCount?(this.eventManager.fire({type:L.Loop,data:{animation:S.name,type:X.Loop}}),S.loopCount=0):S.loopValue===2&&S.loopCount>1&&(this.eventManager.fire({type:L.Loop,data:{animation:S.name,type:X.PingPong}}),S.loopCount=0)}},w.prototype.handleStateChanges=function(){for(var c=[],d=0,S=this.stateMachines.filter(function(Y){return Y.playing});d<S.length;d++){var M=S[d];c.push.apply(c,M.statesChanged)}c.length>0&&this.eventManager.fire({type:L.StateChange,data:c})},w.prototype.handleAdvancing=function(c){this.eventManager.fire({type:L.Advance,data:c})},w})(),L;(function(w){w.Load="load",w.LoadError="loaderror",w.Play="play",w.Pause="pause",w.Stop="stop",w.Loop="loop",w.Draw="draw",w.Advance="advance",w.StateChange="statechange",w.RiveEvent="riveevent",w.AudioStatusChange="audiostatuschange"})(L||(L={}));var X;(function(w){w.OneShot="oneshot",w.Loop="loop",w.PingPong="pingpong"})(X||(X={}));var fe=(function(){function w(c){c===void 0&&(c=[]),this.listeners=c}return w.prototype.getListeners=function(c){return this.listeners.filter(function(d){return d.type===c})},w.prototype.add=function(c){this.listeners.includes(c)||this.listeners.push(c)},w.prototype.remove=function(c){for(var d=0;d<this.listeners.length;d++){var S=this.listeners[d];if(S.type===c.type&&S.callback===c.callback){this.listeners.splice(d,1);break}}},w.prototype.removeAll=function(c){var d=this;c?this.listeners.filter(function(S){return S.type===c}).forEach(function(S){return d.remove(S)}):this.listeners.splice(0,this.listeners.length)},w.prototype.fire=function(c){var d=this.getListeners(c.type);d.forEach(function(S){return S.callback(c)})},w})(),ge=(function(){function w(c){this.eventManager=c,this.queue=[]}return w.prototype.add=function(c){this.queue.push(c)},w.prototype.process=function(){for(;this.queue.length>0;){var c=this.queue.shift();c?.action&&c.action(),c?.event&&this.eventManager.fire(c.event)}},w})(),re;(function(w){w[w.AVAILABLE=0]="AVAILABLE",w[w.UNAVAILABLE=1]="UNAVAILABLE"})(re||(re={}));var V=(function(w){g(c,w);function c(){var d=w!==null&&w.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=re.UNAVAILABLE,d}return c.prototype.delay=function(d){return $(this,void 0,void 0,function(){return p(this,function(S){return[2,new Promise(function(M){return setTimeout(M,d)})]})})},c.prototype.timeout=function(){return $(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(S,M){return setTimeout(M,50)})]})})},c.prototype.reportToListeners=function(){this.fire({type:L.AudioStatusChange}),this.removeAll()},c.prototype.enableAudio=function(){return $(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=re.AVAILABLE,this.reportToListeners()),[2]})})},c.prototype.testAudio=function(){return $(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===re.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},c.prototype._establishAudio=function(){return $(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==re.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},c.prototype.listenForUserAction=function(){var d=this,S=function(){return $(d,void 0,void 0,function(){return p(this,function(M){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",S,{once:!0})},c.prototype.establishAudio=function(){return $(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(c.prototype,"systemVolume",{get:function(){return this._status===re.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),c})(fe),G=new V,q=(function(){function w(){}return w.prototype.observe=function(){},w.prototype.unobserve=function(){},w.prototype.disconnect=function(){},w})(),O=globalThis.ResizeObserver||q,z=(function(){function w(){var c=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var S=c._elementsMap.get(d.target);S!==null?S.onResize(d.target.clientWidth==0||d.target.clientHeight==0):c._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(c._onObservedEntry)},this._resizeObserver=new O(this._onObserved)}return w.prototype.add=function(c,d){var S={onResize:d,element:c};return this._elementsMap.set(c,S),this._resizeObserver.observe(c),S},w.prototype.remove=function(c){this._resizeObserver.unobserve(c.element),this._elementsMap.delete(c.element)},w})(),ce=new z,he=(function(){function w(c){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=c.src,this.buffer=c.buffer,c.assetLoader&&(this.assetLoader=c.assetLoader),this.enableRiveAssetCDN=typeof c.enableRiveAssetCDN=="boolean"?c.enableRiveAssetCDN:!0,this.eventManager=new fe,c.onLoad&&this.on(L.Load,c.onLoad),c.onLoadError&&this.on(L.LoadError,c.onLoadError)}return w.prototype.initData=function(){return $(this,void 0,void 0,function(){var c,d,S,M,Y;return p(this,function(_e){switch(_e.label){case 0:return this.src?(c=this,[4,ye(this.src)]):[3,2];case 1:c.buffer=_e.sent(),_e.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(S=new v.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=S.assetLoader),M=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return M.file=_e.sent(),this.destroyed?((Y=this.file)===null||Y===void 0||Y.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:L.Load,data:this}):this.fireLoadError(w.fileLoadErrorMessage),[2])}})})},w.prototype.init=function(){return $(this,void 0,void 0,function(){var c,d;return p(this,function(S){switch(S.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(w.missingErrorMessage),[2];S.label=1;case 1:return S.trys.push([1,4,,5]),c=this,[4,N.awaitInstance()];case 2:return c.runtime=S.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return S.sent(),[3,5];case 4:return d=S.sent(),this.fireLoadError(d instanceof Error?d.message:w.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},w.prototype.fireLoadError=function(c){throw this.eventManager.fire({type:L.LoadError,data:c}),new Error(c)},w.prototype.on=function(c,d){this.eventManager.add({type:c,callback:d})},w.prototype.off=function(c,d){this.eventManager.remove({type:c,callback:d})},w.prototype.cleanup=function(){var c;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(c=this.file)===null||c===void 0||c.delete(),this.file=null,this.destroyed=!0)},w.prototype.removeAllRiveEventListeners=function(c){this.eventManager.removeAll(c)},w.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},w.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},w.prototype.getArtboard=function(c){var d=this.file.artboardByName(c);return d!=null?new j(d):null},w.missingErrorMessage="Rive source file or data buffer required",w.fileLoadErrorMessage="The file failed to load",w})(),se=(function(){function w(c){var d=this,S;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(M){var Y=d._hasZeroSize!==M;d._hasZeroSize=M,M?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():Y&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=c.canvas,c.canvas.constructor===HTMLCanvasElement&&(this._observed=ce.add(this.canvas,this.onCanvasResize)),this.src=c.src,this.buffer=c.buffer,this.riveFile=c.riveFile,this.layout=(S=c.layout)!==null&&S!==void 0?S:new P,this.shouldDisableRiveListeners=!!c.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!c.isTouchScrollEnabled,this.automaticallyHandleEvents=!!c.automaticallyHandleEvents,this.enableRiveAssetCDN=c.enableRiveAssetCDN===void 0?!0:c.enableRiveAssetCDN,this.eventManager=new fe,c.onLoad&&this.on(L.Load,c.onLoad),c.onLoadError&&this.on(L.LoadError,c.onLoadError),c.onPlay&&this.on(L.Play,c.onPlay),c.onPause&&this.on(L.Pause,c.onPause),c.onStop&&this.on(L.Stop,c.onStop),c.onLoop&&this.on(L.Loop,c.onLoop),c.onStateChange&&this.on(L.StateChange,c.onStateChange),c.onAdvance&&this.on(L.Advance,c.onAdvance),c.onload&&!c.onLoad&&this.on(L.Load,c.onload),c.onloaderror&&!c.onLoadError&&this.on(L.LoadError,c.onloaderror),c.onplay&&!c.onPlay&&this.on(L.Play,c.onplay),c.onpause&&!c.onPause&&this.on(L.Pause,c.onpause),c.onstop&&!c.onStop&&this.on(L.Stop,c.onstop),c.onloop&&!c.onLoop&&this.on(L.Loop,c.onloop),c.onstatechange&&!c.onStateChange&&this.on(L.StateChange,c.onstatechange),c.assetLoader&&(this.assetLoader=c.assetLoader),this.taskQueue=new ge(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:c.autoplay,autoBind:c.autoBind,animations:c.animations,stateMachines:c.stateMachines,artboard:c.artboard,useOffscreenRenderer:c.useOffscreenRenderer})}return Object.defineProperty(w.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),w.new=function(c){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new w(c)},w.prototype.onSystemAudioChanged=function(){this.volume=this._volume},w.prototype.init=function(c){var d=this,S=c.src,M=c.buffer,Y=c.riveFile,_e=c.animations,Ie=c.stateMachines,Oe=c.artboard,Ae=c.autoplay,Fe=Ae===void 0?!1:Ae,We=c.useOffscreenRenderer,Ye=We===void 0?!1:We,Je=c.autoBind,lt=Je===void 0?!1:Je;if(!this.destroyed){if(this.src=S,this.buffer=M,this.riveFile=Y,!this.src&&!this.buffer&&!this.riveFile)throw new T(w.missingErrorMessage);var st=we(_e),it=we(Ie);this.loaded=!1,this.readyForPlaying=!1,N.awaitInstance().then(function(qe){d.destroyed||(d.runtime=qe,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,Ye),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(Oe,st,it,Fe,lt).then(function(Be){if(Be)return d.setupRiveListeners()}).catch(function(Be){console.error(Be)}))}).catch(function(qe){console.error(qe)})}},w.prototype.setupRiveListeners=function(c){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var S=(this.animator.stateMachines||[]).filter(function(Y){return Y.playing&&d.runtime.hasListeners(Y.instance)}).map(function(Y){return Y.instance}),M=this.isTouchScrollEnabled;c&&"isTouchScrollEnabled"in c&&(M=c.isTouchScrollEnabled),this.eventCleanup=(0,v.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:S,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:M,layoutScaleFactor:this._layout.layoutScaleFactor})}},w.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},w.prototype.initializeAudio=function(){var c=this,d;G.status==re.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:L.AudioStatusChange,callback:function(){return c.onSystemAudioChanged()}},G.add(this._audioEventListener),G.establishAudio())},w.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},w.prototype.initData=function(c,d,S,M,Y){return $(this,void 0,void 0,function(){var _e,Ie,Oe,Ae;return p(this,function(Fe){switch(Fe.label){case 0:return Fe.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(_e=new he({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=_e,[4,_e.init()]);case 1:if(Fe.sent(),this.destroyed)return _e.destroyIfUnused(),[2,!1];Fe.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(c,d,S,M,Y),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:L.Load,data:(Ae=this.src)!==null&&Ae!==void 0?Ae:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Ie=Fe.sent(),Oe=x(Ie),console.warn(Oe),this.eventManager.fire({type:L.LoadError,data:Oe}),[2,Promise.reject(Oe)];case 4:return[2]}})})},w.prototype.initArtboard=function(c,d,S,M,Y){if(this.file){var _e=c?this.file.artboardByName(c):this.file.defaultArtboard();if(!_e){var Ie="Invalid artboard name or no default artboard";console.warn(Ie),this.eventManager.fire({type:L.LoadError,data:Ie});return}if(this.artboard=_e,_e.volume=this._volume*G.systemVolume,this.artboard.animationCount()<1){var Ie="Artboard has no animations";throw this.eventManager.fire({type:L.LoadError,data:Ie}),Ie}this.animator=new U(this.runtime,this.artboard,this.eventManager);var Oe;if(d.length>0||S.length>0?(Oe=d.concat(S),this.animator.initLinearAnimations(d,M),this.animator.initStateMachines(S,M)):Oe=[this.animator.atLeastOne(M,!1)],this.taskQueue.add({event:{type:M?L.Play:L.Pause,data:Oe}}),Y){var Ae=this.file.defaultArtboardViewModel(_e);if(Ae!==null){var Fe=Ae.defaultInstance();if(Fe!==null){var We=new ue(Fe,null);this.bindViewModelInstance(We)}}}}},w.prototype.drawFrame=function(){var c,d;!((c=document?.timeline)===null||c===void 0)&&c.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},w.prototype.draw=function(c,d){var S;this.frameRequestId=null;var M=performance.now();this.lastRenderTime||(this.lastRenderTime=c),this.renderSecondTimer+=c-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var Y=(c-this.lastRenderTime)/1e3;this.lastRenderTime=c;for(var _e=this.animator.animations.filter(function(ut){return ut.playing||ut.needsScrub}).sort(function(ut){return ut.needsScrub?-1:1}),Ie=0,Oe=_e;Ie<Oe.length;Ie++){var Ae=Oe[Ie];Ae.advance(Y),Ae.instance.didLoop&&(Ae.loopCount+=1),Ae.apply(1)}for(var Fe=this.animator.stateMachines.filter(function(ut){return ut.playing}),We=0,Ye=Fe;We<Ye.length;We++){var Je=Ye[We],lt=Je.reportedEventCount();if(lt)for(var st=0;st<lt;st++){var it=Je.reportedEventAt(st);if(it)if(it.type===k.OpenUrl){if(this.eventManager.fire({type:L.RiveEvent,data:it}),this.automaticallyHandleEvents){var qe=document.createElement("a"),Be=it,nt=Be.url,at=Be.target,Qe=(0,v.sanitizeUrl)(nt);nt&&qe.setAttribute("href",Qe),at&&qe.setAttribute("target",at),Qe&&Qe!==v.BLANK_URL&&qe.click()}}else this.eventManager.fire({type:L.RiveEvent,data:it})}Je.advanceAndApply(Y)}this.animator.stateMachines.length==0&&this.artboard.advance(Y);var Pe=this.renderer;Pe.clear(),Pe.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Pe),Pe.restore(),Pe.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(Y),this.frameCount++;var Ue=performance.now();for(this.frameTimes.push(Ue),this.durations.push(Ue-M);this.frameTimes[0]<=Ue-1e3;)this.frameTimes.shift(),this.durations.shift();(S=this._viewModelInstance)===null||S===void 0||S.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},w.prototype.alignRenderer=function(){var c=this,d=c.renderer,S=c.runtime,M=c._layout,Y=c.artboard;d.align(M.runtimeFit(S),M.runtimeAlignment(S),{minX:M.minX,minY:M.minY,maxX:M.maxX,maxY:M.maxY},Y.bounds,this._devicePixelRatioUsed*M.layoutScaleFactor)},Object.defineProperty(w.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(c,d){return c+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),w.prototype.cleanup=function(){var c,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ce.remove(this._observed),this.removeRiveListeners(),this.file&&((c=this.riveFile)===null||c===void 0||c.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(G.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},w.prototype.deleteRiveRenderer=function(){var c;(c=this.renderer)===null||c===void 0||c.delete(),this.renderer=null},w.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},w.prototype.retrieveTextRun=function(c){var d;if(!c){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var S=this.artboard.textRun(c);if(!S){console.warn("Could not access a text run with name '".concat(c,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return S},w.prototype.getTextRunValue=function(c){var d=this.retrieveTextRun(c);return d?d.text:void 0},w.prototype.setTextRunValue=function(c,d){var S=this.retrieveTextRun(c);S&&(S.text=d)},w.prototype.play=function(c,d){var S=this;if(c=we(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return S.play(c,d)}});return}this.animator.play(c),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},w.prototype.pause=function(c){var d=this;if(c=we(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(c)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(c)},w.prototype.scrub=function(c,d){var S=this;if(c=we(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return S.scrub(c,d)}});return}this.animator.scrub(c,d||0),this.drawFrame()},w.prototype.stop=function(c){var d=this;if(c=we(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(c)}});return}this.animator&&this.animator.stop(c),this.eventCleanup&&this.eventCleanup()},w.prototype.reset=function(c){var d,S,M=c?.artboard,Y=we(c?.animations),_e=we(c?.stateMachines),Ie=(d=c?.autoplay)!==null&&d!==void 0?d:!1,Oe=(S=c?.autoBind)!==null&&S!==void 0?S:!1;this.cleanupInstances(),this.initArtboard(M,Y,_e,Ie,Oe),this.taskQueue.process()},w.prototype.load=function(c){this.file=null,this.stop(),this.init(c)},Object.defineProperty(w.prototype,"layout",{get:function(){return this._layout},set:function(c){this._layout=c,(!c.maxX||!c.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),w.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},w.prototype.resizeDrawingSurfaceToCanvas=function(c){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),S=d.width,M=d.height,Y=c||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=Y,this.canvas.width=Y*S,this.canvas.height=Y*M,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===D.Layout){var _e=this._layout.layoutScaleFactor;this.artboard.width=S/_e,this.artboard.height=M/_e}}},Object.defineProperty(w.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var c=[],d=0;d<this.artboard.animationCount();d++)c.push(this.artboard.animationByIndex(d).name);return c},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var c=[],d=0;d<this.artboard.stateMachineCount();d++)c.push(this.artboard.stateMachineByIndex(d).name);return c},enumerable:!1,configurable:!0}),w.prototype.stateMachineInputs=function(c){if(this.loaded){var d=this.animator.stateMachines.find(function(S){return S.name===c});return d?.inputs}},w.prototype.retrieveInputAtPath=function(c,d){if(!c){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(c,"', at path: '").concat(d,"', but the Artboard is null"));return}var S=this.artboard.inputByPath(c,d);if(!S){console.warn("Could not access an input with name: '".concat(c,"', at path:'").concat(d,"'"));return}return S},w.prototype.setBooleanStateAtPath=function(c,d,S){var M=this.retrieveInputAtPath(c,S);M&&(M.type===J.Boolean?M.asBool().value=d:console.warn("Input with name: '".concat(c,"', at path:'").concat(S,"' is not a boolean")))},w.prototype.setNumberStateAtPath=function(c,d,S){var M=this.retrieveInputAtPath(c,S);M&&(M.type===J.Number?M.asNumber().value=d:console.warn("Input with name: '".concat(c,"', at path:'").concat(S,"' is not a number")))},w.prototype.fireStateAtPath=function(c,d){var S=this.retrieveInputAtPath(c,d);S&&(S.type===J.Trigger?S.asTrigger().fire():console.warn("Input with name: '".concat(c,"', at path:'").concat(d,"' is not a trigger")))},w.prototype.retrieveTextAtPath=function(c,d){if(!c){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(c,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(c,"', at path: '").concat(d,"', but the Artboard is null"));return}var S=this.artboard.textByPath(c,d);if(!S){console.warn("Could not access text with name: '".concat(c,"', at path:'").concat(d,"'"));return}return S},w.prototype.getTextRunValueAtPath=function(c,d){var S=this.retrieveTextAtPath(c,d);if(!S){console.warn("Could not get text with name: '".concat(c,"', at path:'").concat(d,"'"));return}return S.text},w.prototype.setTextRunValueAtPath=function(c,d,S){var M=this.retrieveTextAtPath(c,S);if(!M){console.warn("Could not set text with name: '".concat(c,"', at path:'").concat(S,"'"));return}M.text=d},Object.defineProperty(w.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(c){return c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(c){return c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(c){return!c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(c){return!c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),w.prototype.on=function(c,d){this.eventManager.add({type:c,callback:d})},w.prototype.off=function(c,d){this.eventManager.remove({type:c,callback:d})},w.prototype.unsubscribe=function(c,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(c,d)},w.prototype.removeAllRiveEventListeners=function(c){this.eventManager.removeAll(c)},w.prototype.unsubscribeAll=function(c){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(c)},w.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},w.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},w.prototype.enableFPSCounter=function(c){this.runtime.enableFPSCounter(c)},w.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(w.prototype,"contents",{get:function(){if(this.loaded){for(var c={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var S=this.file.artboardByIndex(d),M={name:S.name,animations:[],stateMachines:[]},Y=0;Y<S.animationCount();Y++){var _e=S.animationByIndex(Y);M.animations.push(_e.name)}for(var Ie=0;Ie<S.stateMachineCount();Ie++){for(var Oe=S.stateMachineByIndex(Ie),Ae=Oe.name,Fe=new this.runtime.StateMachineInstance(Oe,S),We=[],Ye=0;Ye<Fe.inputCount();Ye++){var Je=Fe.input(Ye);We.push({name:Je.name,type:Je.type})}M.stateMachines.push({name:Ae,inputs:We})}c.artboards.push(M)}return c}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(c){this._volume=c,this.artboard&&(this.artboard.volume=c*G.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"artboardWidth",{get:function(){var c;return this.artboard?this.artboard.width:(c=this._artboardWidth)!==null&&c!==void 0?c:0},set:function(c){this._artboardWidth=c,this.artboard&&(this.artboard.width=c)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"artboardHeight",{get:function(){var c;return this.artboard?this.artboard.height:(c=this._artboardHeight)!==null&&c!==void 0?c:0},set:function(c){this._artboardHeight=c,this.artboard&&(this.artboard.height=c)},enumerable:!1,configurable:!0}),w.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(w.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(c){this._devicePixelRatioUsed=c},enumerable:!1,configurable:!0}),w.prototype.bindViewModelInstance=function(c){var d;this.artboard&&!this.destroyed&&c&&c.runtimeInstance&&(c.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=c,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(S){return S.bindViewModelInstance(c)}):this.artboard.bindViewModelInstance(c.runtimeInstance))},Object.defineProperty(w.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),w.prototype.viewModelByIndex=function(c){var d=this.file.viewModelByIndex(c);return d!==null?new ve(d):null},w.prototype.viewModelByName=function(c){var d=this.file.viewModelByName(c);return d!==null?new ve(d):null},w.prototype.enums=function(){if(this._dataEnums===null){var c=this.file.enums();this._dataEnums=c.map(function(d){return new me(d)})}return this._dataEnums},w.prototype.defaultViewModel=function(){if(this.artboard){var c=this.file.defaultArtboardViewModel(this.artboard);if(c)return new ve(c)}return null},w.prototype.getArtboard=function(c){var d,S;return(S=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(c))!==null&&S!==void 0?S:null},w.missingErrorMessage="Rive source file or data buffer required",w.cleanupErrorMessage="Attempt to use file after calling cleanup.",w})(),ve=(function(){function w(c){this._viewModel=c}return Object.defineProperty(w.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),w.prototype.instanceByIndex=function(c){var d=this._viewModel.instanceByIndex(c);return d!==null?new ue(d,null):null},w.prototype.instanceByName=function(c){var d=this._viewModel.instanceByName(c);return d!==null?new ue(d,null):null},w.prototype.defaultInstance=function(){var c=this._viewModel.defaultInstance();return c!==null?new ue(c,null):null},w.prototype.instance=function(){var c=this._viewModel.instance();return c!==null?new ue(c,null):null},Object.defineProperty(w.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),w})(),me=(function(){function w(c){this._dataEnum=c}return Object.defineProperty(w.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),w})(),be;(function(w){w.Number="number",w.String="string",w.Boolean="boolean",w.Color="color",w.Trigger="trigger",w.Enum="enum",w.List="list",w.Image="image",w.Artboard="artboard"})(be||(be={}));var ue=(function(){function w(c,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=c,d!==null&&this._parents.push(d)}return Object.defineProperty(w.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),w.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(c){c.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(c){c.clearChanges()})),this._children.forEach(function(c){return c.handleCallbacks()})},w.prototype.addParent=function(c){this._parents.includes(c)||(this._parents.push(c),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&c.addToViewModelCallbacks(this))},w.prototype.removeParent=function(c){var d=this._parents.indexOf(c);if(d!==-1){var S=this._parents[d];S.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},w.prototype.addToPropertyCallbacks=function(c){var d=this;this._propertiesWithCallbacks.includes(c)||(this._propertiesWithCallbacks.push(c),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(S){S.addToViewModelCallbacks(d)}))},w.prototype.removeFromPropertyCallbacks=function(c){var d=this;this._propertiesWithCallbacks.includes(c)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(S){return S!==c}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(S){S.removeFromViewModelCallbacks(d)}))},w.prototype.addToViewModelCallbacks=function(c){var d=this;this._children.includes(c)||(this._children.push(c),this._parents.forEach(function(S){S.addToViewModelCallbacks(d)}))},w.prototype.removeFromViewModelCallbacks=function(c){var d=this;this._children.includes(c)&&(this._children=this._children.filter(function(S){return S!==c}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(S){S.removeFromViewModelCallbacks(d)}))},w.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(c){c.clearCallbacks()})},w.prototype.propertyFromPath=function(c,d){var S=c.split("/");return this.propertyFromPathSegments(S,0,d)},w.prototype.viewModelFromPathSegments=function(c,d){var S=this.internalViewModelInstance(c[d]);return S!==null?d==c.length-1?S:S.viewModelFromPathSegments(c,d++):null},w.prototype.propertyFromPathSegments=function(c,d,S){var M,Y,_e,Ie,Oe,Ae,Fe,We,Ye,Je,lt,st,it,qe,Be,nt,at,Qe;if(d<c.length-1){var Pe=this.internalViewModelInstance(c[d]);return Pe!==null?Pe.propertyFromPathSegments(c,d+1,S):null}var Ue=null;switch(S){case be.Number:if(Ue=(Y=(M=this._runtimeInstance)===null||M===void 0?void 0:M.number(c[d]))!==null&&Y!==void 0?Y:null,Ue!==null)return new Q(Ue,this);break;case be.String:if(Ue=(Ie=(_e=this._runtimeInstance)===null||_e===void 0?void 0:_e.string(c[d]))!==null&&Ie!==void 0?Ie:null,Ue!==null)return new oe(Ue,this);break;case be.Boolean:if(Ue=(Ae=(Oe=this._runtimeInstance)===null||Oe===void 0?void 0:Oe.boolean(c[d]))!==null&&Ae!==void 0?Ae:null,Ue!==null)return new ae(Ue,this);break;case be.Color:if(Ue=(We=(Fe=this._runtimeInstance)===null||Fe===void 0?void 0:Fe.color(c[d]))!==null&&We!==void 0?We:null,Ue!==null)return new B(Ue,this);break;case be.Trigger:if(Ue=(Je=(Ye=this._runtimeInstance)===null||Ye===void 0?void 0:Ye.trigger(c[d]))!==null&&Je!==void 0?Je:null,Ue!==null)return new H(Ue,this);break;case be.Enum:if(Ue=(st=(lt=this._runtimeInstance)===null||lt===void 0?void 0:lt.enum(c[d]))!==null&&st!==void 0?st:null,Ue!==null)return new W(Ue,this);break;case be.List:if(Ue=(qe=(it=this._runtimeInstance)===null||it===void 0?void 0:it.list(c[d]))!==null&&qe!==void 0?qe:null,Ue!==null)return new Z(Ue,this);break;case be.Image:if(Ue=(nt=(Be=this._runtimeInstance)===null||Be===void 0?void 0:Be.image(c[d]))!==null&&nt!==void 0?nt:null,Ue!==null)return new te(Ue,this);break;case be.Artboard:if(Ue=(Qe=(at=this._runtimeInstance)===null||at===void 0?void 0:at.artboard(c[d]))!==null&&Qe!==void 0?Qe:null,Ue!==null)return new ne(Ue,this);break}return null},w.prototype.internalViewModelInstance=function(c){var d;if(this._viewModelInstances.has(c))return this._viewModelInstances.get(c);var S=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(c);if(S!==null){var M=new w(S,this);return M.internalIncrementReferenceCount(),this._viewModelInstances.set(c,M),M}return null},w.prototype.number=function(c){var d=this.propertyFromPath(c,be.Number);return d},w.prototype.string=function(c){var d=this.propertyFromPath(c,be.String);return d},w.prototype.boolean=function(c){var d=this.propertyFromPath(c,be.Boolean);return d},w.prototype.color=function(c){var d=this.propertyFromPath(c,be.Color);return d},w.prototype.trigger=function(c){var d=this.propertyFromPath(c,be.Trigger);return d},w.prototype.enum=function(c){var d=this.propertyFromPath(c,be.Enum);return d},w.prototype.list=function(c){var d=this.propertyFromPath(c,be.List);return d},w.prototype.image=function(c){var d=this.propertyFromPath(c,be.Image);return d},w.prototype.artboard=function(c){var d=this.propertyFromPath(c,be.Artboard);return d},w.prototype.viewModel=function(c){var d=c.split("/"),S=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return S!=null?S.internalViewModelInstance(d[d.length-1]):null},w.prototype.internalReplaceViewModel=function(c,d){var S;if(d.runtimeInstance!==null){var M=((S=this._runtimeInstance)===null||S===void 0?void 0:S.replaceViewModel(c,d.runtimeInstance))||!1;if(M){d.internalIncrementReferenceCount();var Y=this.internalViewModelInstance(c);Y!==null&&(Y.removeParent(this),this._children.includes(Y)&&(this._children=this._children.filter(function(_e){return _e!==Y})),Y.cleanup()),this._viewModelInstances.set(c,d),d.addParent(this)}return M}return!1},w.prototype.replaceViewModel=function(c,d){var S,M=c.split("/"),Y=M.length>1?this.viewModelFromPathSegments(M.slice(0,M.length-1),0):this;return(S=Y?.internalReplaceViewModel(M[M.length-1],d))!==null&&S!==void 0?S:!1},w.prototype.incrementReferenceCount=function(){var c;this._referenceCount++,(c=this._runtimeInstance)===null||c===void 0||c.incrementReferenceCount()},w.prototype.decrementReferenceCount=function(){var c;this._referenceCount--,(c=this._runtimeInstance)===null||c===void 0||c.decrementReferenceCount()},Object.defineProperty(w.prototype,"properties",{get:function(){var c;return((c=this._runtimeInstance)===null||c===void 0?void 0:c.getProperties().map(function(d){return m({},d)}))||[]},enumerable:!1,configurable:!0}),w.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},w.prototype.cleanup=function(){var c=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(M){M.cleanup()}),this._viewModelInstances.clear();var d=E([],this._children,!0);this._children.length=0;var S=E([],this._parents,!0);this._parents.length=0,d.forEach(function(M){M.removeParent(c)}),S.forEach(function(M){M.removeFromViewModelCallbacks(c)})}},w})(),ie=(function(){function w(c,d){this.callbacks=[],this._viewModelInstanceValue=c,this._parentViewModel=d}return w.prototype.on=function(c){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(c)||(this.callbacks.push(c),this._parentViewModel.addToPropertyCallbacks(this))},w.prototype.off=function(c){c?this.callbacks=this.callbacks.filter(function(d){return d!==c}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},w.prototype.internalHandleCallback=function(c){},w.prototype.handleCallbacks=function(){var c=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){c.internalHandleCallback(d)})},w.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},w.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(w.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),w})(),oe=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d(this.value)},c})(ie),Q=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d(this.value)},c})(ie),ae=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d(this.value)},c})(ie),H=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return c.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},c.prototype.internalHandleCallback=function(d){d()},c})(ie),W=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d(this.value)},c})(ie),Z=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),c.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},c.prototype.addInstanceAt=function(d,S){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,S)?(d.addParent(this._parentViewModel),!0):!1},c.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},c.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},c.prototype.instanceAt=function(d){var S=this._viewModelInstanceValue.instanceAt(d);if(S!=null){var M=new ue(S,this._parentViewModel);return M}return null},c.prototype.swap=function(d,S){this._viewModelInstanceValue.swap(d,S)},c.prototype.internalHandleCallback=function(d){d()},c})(ie),B=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),c.prototype.rgb=function(d,S,M){this._viewModelInstanceValue.rgb(d,S,M)},c.prototype.rgba=function(d,S,M,Y){this._viewModelInstanceValue.argb(Y,d,S,M)},c.prototype.argb=function(d,S,M,Y){this._viewModelInstanceValue.argb(d,S,M,Y)},c.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},c.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},c.prototype.internalHandleCallback=function(d){d(this.value)},c})(ie),te=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{set:function(d){var S;this._viewModelInstanceValue.value((S=d?.nativeImage)!==null&&S!==void 0?S:null)},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d()},c})(ie),ne=(function(w){g(c,w);function c(d,S){return w.call(this,d,S)||this}return Object.defineProperty(c.prototype,"value",{set:function(d){var S;this._viewModelInstanceValue.value((S=d?.nativeArtboard)!==null&&S!==void 0?S:null)},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(d){d()},c})(ie),ye=function(w){return $(void 0,void 0,void 0,function(){var c,d,S;return p(this,function(M){switch(M.label){case 0:return c=new Request(w),[4,fetch(c)];case 1:return d=M.sent(),[4,d.arrayBuffer()];case 2:return S=M.sent(),[2,S]}})})},we=function(w){return typeof w=="string"?[w]:w instanceof Array?w:[]},Ee={EventManager:fe,TaskQueueManager:ge},$e=function(w){return $(void 0,void 0,void 0,function(){var c,d,S;return p(this,function(M){switch(M.label){case 0:return c=new Promise(function(Y){return N.getInstance(function(_e){_e.decodeAudio(w,Y)})}),[4,c];case 1:return d=M.sent(),S=new v.AudioWrapper(d),v.finalizationRegistry.register(S,d),[2,S]}})})},Ce=function(w){return $(void 0,void 0,void 0,function(){var c,d,S;return p(this,function(M){switch(M.label){case 0:return c=new Promise(function(Y){return N.getInstance(function(_e){_e.decodeImage(w,Y)})}),[4,c];case 1:return d=M.sent(),S=new v.ImageWrapper(d),v.finalizationRegistry.register(S,d),[2,S]}})})},Le=function(w){return $(void 0,void 0,void 0,function(){var c,d,S;return p(this,function(M){switch(M.label){case 0:return c=new Promise(function(Y){return N.getInstance(function(_e){_e.decodeFont(w,Y)})}),[4,c];case 1:return d=M.sent(),S=new v.FontWrapper(d),v.finalizationRegistry.register(S,d),[2,S]}})})}})(),o})())})(rive$1)),rive$1.exports}var riveExports=requireRive();const bucketName="dracula",supabaseUrlFile="https://vycjpmuyscfygstjjied.supabase.co";var root$d=from_html('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Rive(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName),i=state(null);onMount(()=>{if(!get$2(i))return;const u=new riveExports.Rive({src:`${supabaseUrlFile}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:get$2(i),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var n=root$d(),o=child(n);bind_this(o,u=>set(i,u),()=>get$2(i)),append(r,n),pop()}var root$c=from_html('<div class="body-wrapper svelte-njwbfg"><!></div>');function BodyWrapper(r,e){var t=root$c(),i=child(t);snippet(i,()=>e.children),append(r,t)}var root_1$t=from_html('<button class="btn btn-info svelte-aplqg7">❓ Правила</button>'),root_2$j=from_html('<button class="btn btn-secondary svelte-aplqg7">🔄 Заново</button>'),root_4$h=from_html('<button class="btn btn-danger svelte-aplqg7">🏳️ Сдаться</button>'),root$b=from_html('<div id="game-header" class="svelte-aplqg7"><!> <!> <!> <!></div>');function GameHeader(r,e){let t=prop(e,"showGiveUp",3,!1),i=prop(e,"extraContent",3,null),n=prop(e,"onShowRules",3,null);var o=root$b(),u=child(o);{var h=E=>{var T=root_1$t();T.__click=function(...x){n()?.apply(this,x)},append(E,T)};if_block(u,E=>{n()&&E(h)})}var _=sibling(u,2);{var v=E=>{var T=root_2$j();T.__click=function(...x){e.onRestart?.apply(this,x)},append(E,T)};if_block(_,E=>{e.onRestart&&E(v)})}var g=sibling(_,2);{var m=E=>{var T=comment(),x=first_child(T);snippet(x,i),append(E,T)};if_block(g,E=>{i()&&E(m)})}var $=sibling(g,2);{var p=E=>{var T=root_4$h();T.__click=function(...x){e.onGiveUp?.apply(this,x)},append(E,T)};if_block($,E=>{t()&&e.onGiveUp&&E(p)})}append(r,o)}delegate(["click"]);var root_2$i=from_html('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),root_1$s=from_html('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function RewardPanel(r,e){push(e,!0);let t=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),n=prop(e,"bucketName",3,"dracula"),o=prop(e,"label",3,"Награда");function u(){if(!t()||!i()||i().length===0)return null;const p=typeof t()=="string"?t():t()?.id;return p&&i().find(E=>E.id===p)||null}let h=user_derived(u),_=user_derived(()=>typeof t()=="object"&&t()?.name?t().name:null);function v(p){const E=p.target;E.style.display="none"}var g=comment(),m=first_child(g);{var $=p=>{var E=root_1$s(),T=child(E);{var x=I=>{var k=root_2$i(),j=child(k);template_effect(()=>{set_attribute(j,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${n()}/${get$2(h)?.icon||(typeof t()=="object"?t().icon:"")}`),set_attribute(j,"alt",get$2(h)?.name||get$2(_)||"Награда")}),event("error",j,v),append(I,k)};if_block(T,I=>{(get$2(h)?.icon||typeof t()=="object"&&t().icon)&&I(x)})}var D=sibling(T,2),R=child(D),P=child(R),N=sibling(R,2),J=child(N);template_effect(()=>{set_text(P,`${o()??""}:`),set_text(J,get$2(h)?.name||get$2(_)||"Неизвестный предмет")}),append(p,E)};if_block(m,p=>{(get$2(h)||get$2(_))&&p($)})}append(r,g),pop()}var root$a=from_html('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function GameFooter(r,e){let t=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),n=prop(e,"bucketName",3,"dracula");var o=root$a(),u=child(o);RewardPanel(u,{get rewardItem(){return t()},get items(){return i()},get bucketName(){return n()}});var h=sibling(u,2);{var _=v=>{var g=comment(),m=first_child(g);snippet(m,()=>e.children),append(v,g)};if_block(h,v=>{e.children&&v(_)})}append(r,o)}var root_2$h=from_html("<button> </button>"),root_1$r=from_html('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function MinigameModal(r,e){push(e,!0);let t=prop(e,"modal",7);var i=comment(),n=first_child(i);{var o=u=>{var h=root_1$r();let _;var v=child(h),g=child(v),m=child(g),$=sibling(g,2),p=child($),E=sibling($,2);each(E,21,()=>t().actions,T=>T.text,(T,x)=>{var D=root_2$h();let R;D.__click=function(...N){get$2(x).action?.apply(this,N)};var P=child(D);template_effect(N=>{R=set_class(D,1,"btn",null,R,N),set_text(P,get$2(x).text)},[()=>({"btn-secondary":get$2(x).class==="btn-secondary"})]),append(T,D)}),template_effect(T=>{_=set_class(h,1,"svelte-s62q14",null,_,T),set_text(m,t().title),set_text(p,t().text)},[()=>({active:t().show})]),append(u,h)};if_block(n,u=>{t().show&&u(o)})}append(r,i),pop()}delegate(["click"]);var root_3$o=from_html('<div role="button" tabindex="0"> </div>'),root_5$k=from_svg('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),root_7$b=from_html('<span class="cooldown-timer svelte-d67gs4"> </span>'),root_6$c=from_html('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),root_1$q=from_html('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function OnetMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=8,h=6,_=5,v=1e3,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let m=state(proxy([])),$=state(proxy([])),p=state(proxy({})),E=state(proxy([])),T=state(null),x=state(!1),D=state(!1),R=state(""),P=state(0),N=state(0),J=state(proxy({show:!1,title:"",text:"",actions:[]})),I,k;onMount(()=>{L()});function j(){if(!get$2($)||get$2($).length===0)return 0;let ue=0;for(let ie=0;ie<u;ie++)for(let oe=0;oe<h;oe++)get$2($)[ie]&&!get$2($)[ie][oe]&&ue++;return ue}let F=user_derived(j),U=user_derived(()=>get$2(N)<1);function L(){set(m,[],!0),set($,[],!0),set(T,null),set(x,!1),set(D,!1),set(p,{},!0),set(E,[],!0),set(R,""),set(N,0),ve();let ue=[...new Set(g)];for(;ue.length<u*h/2;)ue=[...ue,...ue];let ie=ue.sort(()=>.5-Math.random()).slice(0,u*h/2),oe=[];ie.forEach(ae=>oe.push(ae,ae)),oe.sort(()=>Math.random()-.5);let Q=0;for(let ae=0;ae<u;ae++){let H=[],W=[];for(let Z=0;Z<h;Z++)H.push(oe[Q++]),W.push(!1);get$2(m).push(H),get$2($).push(W)}setTimeout(V,500)}async function X(ue,ie){if(get$2(x)||get$2($)[ue][ie]||get$2(D))return;if(get$2(E).length>0&&set(E,[],!0),!get$2(T)){set(T,{r:ue,c:ie},!0);return}if(get$2(T).r===ue&&get$2(T).c===ie){set(T,null);return}const oe=get$2(m)[get$2(T).r][get$2(T).c],Q=get$2(m)[ue][ie];if(oe===Q){const ae=ce(get$2(T).r,get$2(T).c,ue,ie);if(ae){set(x,!0),await he(ae),get$2($)[get$2(T).r][get$2(T).c]=!0,get$2($)[ue][ie]=!0,set(T,null),set(x,!1),ge(),V();return}}set(T,{r:ue,c:ie},!0)}async function fe(ue,ie,oe){(oe.key==="Enter"||oe.key===" ")&&(oe.preventDefault(),await X(ue,ie))}function ge(){set(N,_);const ue=setInterval(()=>{update(N,-1),get$2(N)<=0&&clearInterval(ue)},1e3)}function re(){if(get$2(x)||get$2(D)||!get$2(U))return;let ue=[];for(let oe=0;oe<u;oe++)for(let Q=0;Q<h;Q++)get$2($)[oe][Q]||ue.push({r:oe,c:Q,icon:get$2(m)[oe][Q]});let ie={};ue.forEach(oe=>{ie[oe.icon]||(ie[oe.icon]=[]),ie[oe.icon].push(oe)});for(const oe in ie){const Q=ie[oe];if(!(Q.length<2))for(let ae=0;ae<Q.length;ae++)for(let H=ae+1;H<Q.length;H++){const W=Q[ae],Z=Q[H];if(ce(W.r,W.c,Z.r,Z.c)){set(E,[W,Z],!0),setTimeout(()=>set(E,[],!0),1500);return}}}}function V(){if(get$2(F)===0){set(D,!0),t()?(se("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{ve(),e.onWin?.()},v)):se("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:L}]);return}G()||(t()?setTimeout(()=>q(),1e3):se("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ve(),q()}},{text:"Сдаться",action:()=>{se("Конец","Попытайте удачу снова!",[{text:"ОК",action:L}])}}]))}function G(){let ue=[];for(let oe=0;oe<u;oe++)for(let Q=0;Q<h;Q++)get$2($)[oe][Q]||ue.push({r:oe,c:Q,icon:get$2(m)[oe][Q]});let ie={};ue.forEach(oe=>{ie[oe.icon]||(ie[oe.icon]=[]),ie[oe.icon].push(oe)});for(const oe in ie){const Q=ie[oe];if(!(Q.length<2)){for(let ae=0;ae<Q.length;ae++)for(let H=ae+1;H<Q.length;H++)if(ce(Q[ae].r,Q[ae].c,Q[H].r,Q[H].c))return!0}}return!1}function q(){let ue=[],ie=[];for(let oe=0;oe<u;oe++)for(let Q=0;Q<h;Q++)get$2($)[oe][Q]||(ue.push(get$2(m)[oe][Q]),ie.push({r:oe,c:Q}));ue.length!==0&&(ue.sort(()=>Math.random()-.5),ie.forEach((oe,Q)=>{get$2(m)[oe.r][oe.c]=ue[Q],get$2(p)[`${oe.r},${oe.c}`]=!0}),setTimeout(()=>{set(p,{},!0),G()?set(D,!1):q()},500))}function O(ue,ie){return ue<0||ue>=u||ie<0||ie>=h?!0:get$2($)[ue][ie]}function z(ue,ie,oe,Q){if(ue!==oe&&ie!==Q)return!1;if(ue===oe){const ae=Math.min(ie,Q),H=Math.max(ie,Q);for(let W=ae+1;W<H;W++)if(!O(ue,W))return!1}else{const ae=Math.min(ue,oe),H=Math.max(ue,oe);for(let W=ae+1;W<H;W++)if(!O(W,ie))return!1}return!0}function ce(ue,ie,oe,Q){if(z(ue,ie,oe,Q))return[{r:ue,c:ie},{r:oe,c:Q}];const ae={r:ue,c:Q};if(O(ae.r,ae.c)&&z(ue,ie,ae.r,ae.c)&&z(ae.r,ae.c,oe,Q))return[{r:ue,c:ie},ae,{r:oe,c:Q}];const H={r:oe,c:ie};if(O(H.r,H.c)&&z(ue,ie,H.r,H.c)&&z(H.r,H.c,oe,Q))return[{r:ue,c:ie},H,{r:oe,c:Q}];for(let W=-1;W<=u;W++){if(W===ue||W===oe)continue;const Z={r:W,c:ie},B={r:W,c:Q};if(O(Z.r,Z.c)&&O(B.r,B.c)&&z(ue,ie,Z.r,Z.c)&&z(Z.r,Z.c,B.r,B.c)&&z(B.r,B.c,oe,Q))return[{r:ue,c:ie},Z,B,{r:oe,c:Q}]}for(let W=-1;W<=h;W++){if(W===ie||W===Q)continue;const Z={r:ue,c:W},B={r:oe,c:W};if(O(Z.r,Z.c)&&O(B.r,B.c)&&z(ue,ie,Z.r,Z.c)&&z(Z.r,Z.c,B.r,B.c)&&z(B.r,B.c,oe,Q))return[{r:ue,c:ie},Z,B,{r:oe,c:Q}]}return null}async function he(ue){if(await tick(),!I||!k)return;const ie=I.getBoundingClientRect(),oe=k.getBoundingClientRect(),Q=k.querySelector(".cell:not(.matched)");if(!Q)return;const ae=Q.offsetWidth,H=Q.offsetHeight,W=window.getComputedStyle(k),Z=parseFloat(W.gap)||4,B=oe.left-ie.left,te=oe.top-ie.top,ne=ue.map(ye=>{let we,Ee;if(ye.r>=0&&ye.r<u&&ye.c>=0&&ye.c<h){const Ce=k.children[ye.r*h+ye.c].getBoundingClientRect();we=Ce.left-ie.left+Ce.width/2,Ee=Ce.top-ie.top+Ce.height/2}else{const $e=ye.c*(ae+Z)+ae/2,Ce=ye.r*(H+Z)+H/2;we=B+$e,Ee=te+Ce}return`${we.toFixed(1)},${Ee.toFixed(1)}`}).join(" ");return set(R,ne,!0),update(P),new Promise(ye=>{setTimeout(()=>{set(R,""),ye()},350)})}function se(ue,ie,oe){set(J,{show:!0,title:ue,text:ie,actions:oe},!0)}function ve(){get$2(J).show=!1}function me(){se("📖 Правила",`Соеди монстров:

🎯 Цель: Удалить все пары одинаковых монстров.

🔗 Соедини две одинаковые фигуры линией.

📐 Линия может иметь не более 2 поворотов (изгибов).

🚫 Линия не должна проходить через другие фигуры.

💡 Если ходов нет — игра сама перемешает доску.

💡 Кнопка 💡 покажет доступную пару (с перезарядкой).`,[{text:"Понятно",action:ve}])}function be(){t()?(se("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ve(),e.onLose?.()},v)):se("Конец","Попытайте удачу снова!",[{text:"ОК",action:L}])}BodyWrapper(r,{children:(ue,ie)=>{var oe=root_1$q(),Q=first_child(oe);{let ne=user_derived(()=>t()?be:void 0);GameHeader(Q,{onRestart:L,get onGiveUp(){return get$2(ne)},get showGiveUp(){return t()},onShowRules:me})}var ae=sibling(Q,2),H=child(ae);set_style(H,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),each(H,21,()=>get$2(m),index$1,(ne,ye,we)=>{var Ee=comment(),$e=first_child(Ee);each($e,17,()=>get$2(ye),index$1,(Ce,Le,w)=>{var c=root_3$o();let d;c.__click=()=>X(we,w),c.__keydown=M=>fe(we,w,M);var S=child(c);template_effect(M=>{d=set_class(c,1,"cell svelte-d67gs4",null,d,M),set_text(S,get$2(Le))},[()=>({selected:get$2(T)?.r===we&&get$2(T)?.c===w,matched:get$2($)[we][w],shuffling:get$2(p)[`${we},${w}`],"hint-glow":get$2(E).some(M=>M.r===we&&M.c===w)})]),append(Ce,c)}),append(ne,Ee)}),bind_this(H,ne=>k=ne,()=>k);var W=sibling(H,2),Z=child(W);key(Z,()=>get$2(P),ne=>{var ye=comment(),we=first_child(ye);{var Ee=$e=>{var Ce=root_5$k();template_effect(()=>set_attribute(Ce,"points",get$2(R))),append($e,Ce)};if_block(we,$e=>{get$2(R)&&$e(Ee)})}append(ne,ye)}),bind_this(ae,ne=>I=ne,()=>I);var B=sibling(ae,2);GameFooter(B,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ne,ye)=>{var we=root_6$c(),Ee=child(we),$e=sibling(child(Ee)),Ce=child($e),Le=sibling(Ee,2);let w;Le.__click=re;var c=sibling(child(Le));{var d=S=>{var M=root_7$b(),Y=child(M);template_effect(()=>set_text(Y,`(${get$2(N)??""})`)),append(S,M)};if_block(c,S=>{get$2(N)>0&&S(d)})}template_effect(S=>{set_text(Ce,get$2(F)),w=set_class(Le,1,"btn btn-secondary svelte-d67gs4",null,w,S),Le.disabled=!get$2(U)},[()=>({disabled:!get$2(U),"cooldown-active":get$2(N)>0})]),append(ne,we)},$$slots:{default:!0}});var te=sibling(B,2);MinigameModal(te,{get modal(){return get$2(J)}}),append(ue,oe)}}),pop()}delegate(["click","keydown"]);function showHint(r,e,t,i,n,o,u,h,_,v){if(!(get$2(e)||get$2(t)||!get$2(i)))for(let g=0;g<n;g++)for(let m=0;m<o;m++){if(get$2(u)[g]?.[m]||get$2(h)[g]?.[m])continue;let $=get$2(_)[g][m];for(let p=0;p<n;p++)for(let E=0;E<o;E++)if(!(g===p&&m===E)&&!(get$2(u)[p]?.[E]||get$2(h)[p]?.[E])&&get$2(_)[p][E]===$){set(v,[{r:g,c:m},{r:p,c:E}],!0),setTimeout(()=>set(v,[],!0),1500);return}}}var root_3$n=from_html('<button type="button"><div class="card-inner svelte-k8c0r2"><div class="card-front svelte-k8c0r2"> </div> <div class="card-back svelte-k8c0r2">?</div></div></button>'),root_5$j=from_html('<span class="cooldown-timer svelte-k8c0r2"> </span>'),root_4$g=from_html('<div class="footer-stats svelte-k8c0r2"><span class="tiles-counter svelte-k8c0r2">Осталось: <strong class="svelte-k8c0r2"> </strong></span> <button>💡 <!></button></div>'),root_1$p=from_html('<!> <div id="game-container" class="svelte-k8c0r2"><div id="grid" class="svelte-k8c0r2"></div></div> <!> <!>',1);function MemoMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,h=4,_=5,v=1e3,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let m=state(proxy([])),$=state(proxy([])),p=state(proxy([])),E=state(proxy([])),T=state(null),x=state(!1),D=state(!1),R=state(0),P=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>{k()});function N(){let re=0;for(let V=0;V<u;V++)for(let G=0;G<h;G++)get$2($)[V]?.[G]||re++;return re}let J=user_derived(N),I=user_derived(()=>get$2(R)<1);function k(){set(m,[],!0),set($,[],!0),set(p,[],!0),set(T,null),set(x,!1),set(D,!1),set(E,[],!0),set(R,0),fe();let re=[...new Set(g)];for(;re.length<u*h/2;)re=[...re,...re];let V=re.sort(()=>.5-Math.random()).slice(0,u*h/2),G=[];V.forEach(O=>G.push(O,O)),G.sort(()=>Math.random()-.5);let q=0;for(let O=0;O<u;O++){let z=[],ce=[],he=[];for(let se=0;se<h;se++)z.push(G[q++]),ce.push(!1),he.push(!1);get$2(m).push(z),get$2($).push(ce),get$2(p).push(he)}}async function j(re,V){if(!(get$2(x)||get$2($)[re]?.[V]||get$2(D))){if(get$2(T)&&get$2(T).r===re&&get$2(T).c===V){get$2(p)[re][V]=!1,set(T,null);return}if(!get$2(p)[re]?.[V])if(get$2(E).length>0&&set(E,[],!0),get$2(p)[re][V]=!0,!get$2(T))set(T,{r:re,c:V},!0);else{set(x,!0);const G={r:re,c:V},q=get$2(m)[get$2(T).r][get$2(T).c],O=get$2(m)[G.r][G.c];q===O?setTimeout(()=>{get$2($)[get$2(T).r][get$2(T).c]=!0,get$2($)[G.r][G.c]=!0,get$2(p)[get$2(T).r][get$2(T).c]=!1,get$2(p)[G.r][G.c]=!1,set(T,null),set(x,!1),F(),U()},600):setTimeout(()=>{get$2(p)[get$2(T).r][get$2(T).c]=!1,get$2(p)[G.r][G.c]=!1,set(T,null),set(x,!1)},1e3)}}}function F(){set(R,_);const re=setInterval(()=>{update(R,-1),get$2(R)<=0&&clearInterval(re)},1e3)}function U(){get$2(J)===0&&(set(D,!0),t()?(X("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{fe(),e.onWin?.()},v)):X("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:k}]))}function L(){t()?(X("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{fe(),e.onLose?.()},v)):X("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function X(re,V,G){set(P,{show:!0,title:re,text:V,actions:G},!0)}function fe(){get$2(P).show=!1}function ge(){X("📖 Правила",`Память с монстрами:

🎯 Цель: Найти все пары одинаковых карт.

🔍 Кликни на карту, чтобы открыть её.

🔗 Найди вторую карту с таким же изображением.

💡 Если карты совпали — они исчезают.

❌ Если не совпали — обе закроются.

💡 Подсказка (кнопка 💡) покажет одну пару, но имеет перезарядку.`,[{text:"Понятно",action:fe}])}BodyWrapper(r,{children:(re,V)=>{var G=root_1$p(),q=first_child(G);{let se=user_derived(()=>t()?L:void 0);GameHeader(q,{onRestart:k,get onGiveUp(){return get$2(se)},get showGiveUp(){return t()},onShowRules:ge})}var O=sibling(q,2),z=child(O);set_style(z,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),each(z,21,()=>get$2(m),index$1,(se,ve,me)=>{var be=comment(),ue=first_child(be);each(ue,17,()=>get$2(ve),index$1,(ie,oe,Q)=>{var ae=root_3$n();let H;ae.__click=()=>j(me,Q),set_attribute(ae,"aria-label",`Ячейка ${me}, ${Q}`);var W=child(ae),Z=child(W),B=child(Z);template_effect(te=>{H=set_class(ae,1,"cell svelte-k8c0r2",null,H,te),set_text(B,get$2(oe))},[()=>({flipped:get$2(p)[me]?.[Q],matched:get$2($)[me]?.[Q],selected:get$2(T)?.r===me&&get$2(T)?.c===Q,"hint-glow":get$2(E).some(te=>te.r===me&&te.c===Q)})]),append(ie,ae)}),append(se,be)});var ce=sibling(O,2);GameFooter(ce,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(se,ve)=>{var me=root_4$g(),be=child(me),ue=sibling(child(be)),ie=child(ue),oe=sibling(be,2);let Q;oe.__click=[showHint,x,D,I,u,h,$,p,m,E];var ae=sibling(child(oe));{var H=W=>{var Z=root_5$j(),B=child(Z);template_effect(()=>set_text(B,`(${get$2(R)??""})`)),append(W,Z)};if_block(ae,W=>{get$2(R)>0&&W(H)})}template_effect(W=>{set_text(ie,get$2(J)),Q=set_class(oe,1,"btn btn-secondary svelte-k8c0r2",null,Q,W),oe.disabled=!get$2(I)},[()=>({disabled:!get$2(I),"cooldown-active":get$2(R)>0})]),append(se,me)},$$slots:{default:!0}});var he=sibling(ce,2);MinigameModal(he,{get modal(){return get$2(P)}}),append(re,G)}}),pop()}delegate(["click"]);var root_4$f=from_html('<div class="flame svelte-1v5x2m5"></div>'),root_3$m=from_html('<button type="button"><div class="candle svelte-1v5x2m5"><!></div></button>'),root_5$i=from_html('<div class="footer-stats svelte-1v5x2m5"><span class="moves-counter svelte-1v5x2m5">Ходов: <strong class="svelte-1v5x2m5"> </strong></span></div>'),root_1$o=from_html('<!> <div id="game-container" class="svelte-1v5x2m5"><div id="grid" class="svelte-1v5x2m5"></div></div> <!> <!>',1);function LightOut(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=5,h=5,_=15,v=1e3;let g=state(proxy([])),m=state(0),$=state(!1),p=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>T());let E=user_derived(()=>get$2(g).flat().every(k=>!k));function T(){set(g,Array(u).fill(null).map(()=>Array(h).fill(!1)),!0),set(m,0),set($,!1),J();for(let k=0;k<_;k++){const j=Math.floor(Math.random()*u),F=Math.floor(Math.random()*h);x(j,F,!0)}}function x(k,j,F=!1){get$2(g)[k][j]=!get$2(g)[k][j],k>0&&(get$2(g)[k-1][j]=!get$2(g)[k-1][j]),k<u-1&&(get$2(g)[k+1][j]=!get$2(g)[k+1][j]),j>0&&(get$2(g)[k][j-1]=!get$2(g)[k][j-1]),j<h-1&&(get$2(g)[k][j+1]=!get$2(g)[k][j+1]),F||(update(m),R())}function D(k,j){get$2($)||x(k,j)}function R(){get$2(E)&&(set($,!0),t()?(N("🕯️ Тьма наступила",`Вы погасили все свечи за ${get$2(m)} ходов!`,[]),setTimeout(()=>{J(),e.onWin?.()},v)):N("🕯️ Тьма наступила",`Вы погасили все свечи за ${get$2(m)} ходов!`,[{text:"Играть снова",action:T}]))}function P(){t()?(N("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{J(),e.onLose?.()},v)):N("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:T}])}function N(k,j,F){set(p,{show:!0,title:k,text:j,actions:F},!0)}function J(){get$2(p).show=!1}function I(){N("📖 Правила",`Погаси свечи:

🎯 Цель: Погасить все свечи на поле.

💡 Клик на свечу переключает её и соседние свечи (вверх, вниз, влево, вправо).

🔢 Зажжённая свеча гаснет, а потухшая — зажигается.

🧠 Подумай хорошенько — каждый ход влияет на соседние свечи!

🏆 Чем меньше ходов — тем лучше.`,[{text:"Понятно",action:J}])}BodyWrapper(r,{children:(k,j)=>{var F=root_1$o(),U=first_child(F);{let re=user_derived(()=>t()?P:void 0);GameHeader(U,{onRestart:T,get onGiveUp(){return get$2(re)},get showGiveUp(){return t()},onShowRules:I})}var L=sibling(U,2),X=child(L);set_style(X,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),each(X,21,()=>get$2(g),index$1,(re,V,G)=>{var q=comment(),O=first_child(q);each(O,17,()=>get$2(V),index$1,(z,ce,he)=>{var se=root_3$m();let ve;se.__click=()=>D(G,he),set_attribute(se,"aria-label",`Свеча ${G}, ${he}`);var me=child(se),be=child(me);{var ue=ie=>{var oe=root_4$f();append(ie,oe)};if_block(be,ie=>{get$2(ce)&&ie(ue)})}template_effect(ie=>ve=set_class(se,1,"cell svelte-1v5x2m5",null,ve,ie),[()=>({lit:get$2(ce)})]),append(z,se)}),append(re,q)});var fe=sibling(L,2);GameFooter(fe,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(re,V)=>{var G=root_5$i(),q=child(G),O=sibling(child(q)),z=child(O);template_effect(()=>set_text(z,get$2(m))),append(re,G)},$$slots:{default:!0}});var ge=sibling(fe,2);MinigameModal(ge,{get modal(){return get$2(p)}}),append(k,F)}}),pop()}delegate(["click"]);var root_3$l=from_html('<div class="cell svelte-53kujm"> </div>'),root_4$e=from_html('<button class="color-btn svelte-53kujm"> </button>'),root_5$h=from_html('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),root_1$n=from_html('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function FloodIt(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=12,h=25,_=1e3,v=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let g=state(proxy([])),m=state(0),$=state(!1),p=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>T());let E=user_derived(()=>()=>{const k=get$2(g)[0][0];return get$2(g).every(j=>j.every(F=>F===k))});function T(){set(g,[],!0),set(m,0),set($,!1),J();for(let k=0;k<u;k++){let j=[];for(let F=0;F<u;F++)j.push(Math.floor(Math.random()*v.length));get$2(g).push(j)}}function x(k,j,F,U){k<0||k>=u||j<0||j>=u||get$2(g)[k][j]===F&&(get$2(g)[k][j]=U,x(k-1,j,F,U),x(k+1,j,F,U),x(k,j-1,F,U),x(k,j+1,F,U))}function D(k){if(get$2($)||get$2(m)>=h)return;const j=get$2(g)[0][0];k!==j&&(x(0,0,j,k),update(m),R())}function R(){get$2(E)()?(set($,!0),t()?(N("🎉 Победа!",`Вы захватили мир за ${get$2(m)} ходов!`,[]),setTimeout(()=>{J(),e.onWin?.()},_)):N("🎉 Победа!",`Вы захватили мир за ${get$2(m)} ходов!`,[{text:"Играть снова",action:T}])):get$2(m)>=h&&(set($,!0),t()?(N("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{J(),e.onLose?.()},_)):N("💀 Поражение","Ходы закончились!",[{text:"Заново",action:T}]))}function P(){t()?(N("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{J(),e.onLose?.()},_)):N("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:T}])}function N(k,j,F){set(p,{show:!0,title:k,text:j,actions:F},!0)}function J(){get$2(p).show=!1}function I(){N("📖 Правила",`Заливка мира:

🎯 Цель: Залить всё поле одним цветом.

🔴 Нажми на цвет внизу — он начнёт заливать поле с левого верхнего угла.

🔗 Цвет распространяется по соседним клеткам того же цвета.

⏰ У тебя есть всего 25 ходов!

💡 Планируй заранее — выбирай цтобы захватить как можно больше клеток.`,[{text:"Понятно",action:J}])}BodyWrapper(r,{children:(k,j)=>{var F=root_1$n(),U=first_child(F);{let V=user_derived(()=>t()?P:void 0);GameHeader(U,{onRestart:T,get onGiveUp(){return get$2(V)},get showGiveUp(){return t()},onShowRules:I})}var L=sibling(U,2),X=child(L);set_style(X,"grid-template-columns: repeat(12, 1fr);"),each(X,21,()=>get$2(g),index$1,(V,G)=>{var q=comment(),O=first_child(q);each(O,17,()=>get$2(G),index$1,(z,ce)=>{var he=root_3$l(),se=child(he);template_effect(()=>{set_style(he,`background-color: ${v[get$2(ce)].value??""};`),set_text(se,v[get$2(ce)].icon)}),append(z,he)}),append(V,q)});var fe=sibling(L,2);each(fe,21,()=>v,index$1,(V,G,q)=>{var O=root_4$e();O.__click=()=>D(q);var z=child(O);template_effect(()=>{set_style(O,`background-color: ${get$2(G).value??""};`),O.disabled=get$2($)||get$2(m)>=h,set_text(z,get$2(G).icon)}),append(V,O)});var ge=sibling(fe,2);GameFooter(ge,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(V,G)=>{var q=root_5$h(),O=child(q),z=sibling(child(O)),ce=child(z),he=sibling(z);he.nodeValue=" / 25",template_effect(()=>set_text(ce,get$2(m))),append(V,q)},$$slots:{default:!0}});var re=sibling(ge,2);MinigameModal(re,{get modal(){return get$2(p)}}),append(k,F)}}),pop()}delegate(["click"]);var root_3$k=from_html('<button type="button"> </button>'),root_4$d=from_html('<div class="footer-stats svelte-fn2aic"><span class="moves-counter svelte-fn2aic">Ходов: <strong class="svelte-fn2aic"> </strong></span></div>'),root_1$m=from_html('<!> <div id="game-container" class="svelte-fn2aic"><div id="grid" class="svelte-fn2aic"></div></div> <!> <!>',1);function BrokenMirror(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,h=1e3;let _=state(proxy([])),v=state(0),g=state(!1),m=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>p());let $=user_derived(()=>()=>{let I=1;for(let k=0;k<u;k++)for(let j=0;j<u;j++)if(k===u-1&&j===u-1){if(get$2(_)[k][j]!==null)return!1}else{if(get$2(_)[k][j]!==I)return!1;I++}return!0});function p(){set(_,[],!0),set(v,0),set(g,!1),N();let I=[];for(let j=1;j<u*u;j++)I.push(j);I.push(null);do I=I.sort(()=>Math.random()-.5);while(!E(I));let k=0;for(let j=0;j<u;j++){let F=[];for(let U=0;U<u;U++)F.push(I[k++]);get$2(_).push(F)}}function E(I){let k=0;for(let F=0;F<I.length;F++)for(let U=F+1;U<I.length;U++)I[F]&&I[U]&&I[F]>I[U]&&k++;let j=0;for(let F=0;F<I.length;F++)if(I[F]===null){j=Math.floor(F/u);break}return k%2===(u-j)%2}function T(){for(let I=0;I<u;I++)for(let k=0;k<u;k++)if(get$2(_)[I][k]===null)return{r:I,c:k};return null}function x(I,k){if(get$2(g))return;const j=T();if(!j)return;const F=Math.abs(I-j.r),U=Math.abs(k-j.c);(F===1&&U===0||F===0&&U===1)&&(get$2(_)[j.r][j.c]=get$2(_)[I][k],get$2(_)[I][k]=null,update(v),D())}function D(){get$2($)()&&(set(g,!0),t()?(P("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${get$2(v)} ходов!`,[]),setTimeout(()=>{N(),e.onWin?.()},h)):P("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${get$2(v)} ходов!`,[{text:"Играть снова",action:p}]))}function R(){t()?(P("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{N(),e.onLose?.()},h)):P("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:p}])}function P(I,k,j){set(m,{show:!0,title:I,text:k,actions:j},!0)}function N(){get$2(m).show=!1}function J(){P("📖 Правила",`Пятнашки (Осколки зеркала):

🎯 Цель: Собрать числа по порядку от 1 до 15.

🔄 Клик на плитку перемещает её на пустое место (рядом).

🧠 Подумай над ходами — плитки можно двигать только по одной!

🏆 Собери головоломку за меньшее количество ходов.`,[{text:"Понятно",action:N}])}BodyWrapper(r,{children:(I,k)=>{var j=root_1$m(),F=first_child(j);{let ge=user_derived(()=>t()?R:void 0);GameHeader(F,{onRestart:p,get onGiveUp(){return get$2(ge)},get showGiveUp(){return t()},onShowRules:J})}var U=sibling(F,2),L=child(U);set_style(L,"grid-template-columns: repeat(4, 1fr);"),each(L,21,()=>get$2(_),index$1,(ge,re,V)=>{var G=comment(),q=first_child(G);each(q,17,()=>get$2(re),index$1,(O,z,ce)=>{var he=root_3$k();let se;he.__click=()=>x(V,ce);var ve=child(he);template_effect(me=>{se=set_class(he,1,"cell svelte-fn2aic",null,se,me),he.disabled=get$2(z)===null,set_attribute(he,"aria-label",get$2(z)===null?"Пустая ячейка":`Ячейка ${get$2(z)}`),set_text(ve,get$2(z))},[()=>({empty:get$2(z)===null})]),append(O,he)}),append(ge,G)});var X=sibling(U,2);GameFooter(X,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ge,re)=>{var V=root_4$d(),G=child(V),q=sibling(child(G)),O=child(q);template_effect(()=>set_text(O,get$2(v))),append(ge,V)},$$slots:{default:!0}});var fe=sibling(X,2);MinigameModal(fe,{get modal(){return get$2(m)}}),append(I,j)}}),pop()}delegate(["click"]);function handleTouchStart$1(r,e,t){set(e,r.touches[0].clientX,!0),set(t,r.touches[0].clientY,!0)}var root_3$j=from_html("<div> </div>"),root_4$c=from_html('<div class="footer-stats svelte-1o3nb6j"><span class="score-counter svelte-1o3nb6j">Очки: <strong class="svelte-1o3nb6j"> </strong></span></div>'),root_1$l=from_html('<!> <div id="game-container" class="svelte-1o3nb6j"><div id="grid" class="svelte-1o3nb6j"></div></div> <!> <!>',1);function Evolution2048(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,h=2048,_=1e3,v={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},g={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=state(proxy([])),$=state(0),p=state(!1),E=state(!1),T=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>(x(),window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)));function x(){set(m,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),set($,0),set(p,!1),set(E,!1),V(),D(),D()}function D(){let q=[];for(let O=0;O<u;O++)for(let z=0;z<u;z++)get$2(m)[O][z]===0&&q.push({r:O,c:z});if(q.length>0){const{r:O,c:z}=q[Math.floor(Math.random()*q.length)];get$2(m)[O][z]=Math.random()<.9?2:4}}function R(q){if(get$2(p))return;let O=!1;switch(q.key){case"ArrowUp":O=I();break;case"ArrowDown":O=k();break;case"ArrowLeft":O=N();break;case"ArrowRight":O=J();break}O&&(q.preventDefault(),D(),L())}function P(q){let O=q.filter(ce=>ce!==0),z=!1;for(let ce=0;ce<O.length-1;ce++)O[ce]===O[ce+1]&&(O[ce]*=2,set($,get$2($)+O[ce]),O.splice(ce+1,1),z=!0);for(;O.length<u;)O.push(0);return{newRow:O,moved:z||q.join(",")!==O.join(",")}}function N(){let q=!1;for(let O=0;O<u;O++){const{newRow:z,moved:ce}=P(get$2(m)[O]);get$2(m)[O]=z,ce&&(q=!0)}return q}function J(){let q=!1;for(let O=0;O<u;O++){const{newRow:z,moved:ce}=P([...get$2(m)[O]].reverse());get$2(m)[O]=z.reverse(),ce&&(q=!0)}return q}function I(){let q=!1;for(let O=0;O<u;O++){let z=[];for(let se=0;se<u;se++)z.push(get$2(m)[se][O]);const{newRow:ce,moved:he}=P(z);for(let se=0;se<u;se++)get$2(m)[se][O]=ce[se];he&&(q=!0)}return q}function k(){let q=!1;for(let O=0;O<u;O++){let z=[];for(let se=0;se<u;se++)z.push(get$2(m)[se][O]);const{newRow:ce,moved:he}=P(z.reverse());z=ce.reverse();for(let se=0;se<u;se++)get$2(m)[se][O]=z[se];he&&(q=!0)}return q}let j=state(0),F=state(0);function U(q){if(get$2(p))return;const O=q.changedTouches[0].clientX,z=q.changedTouches[0].clientY,ce=O-get$2(j),he=z-get$2(F);if(Math.abs(ce)<30&&Math.abs(he)<30)return;let se=!1;Math.abs(ce)>Math.abs(he)?se=ce>0?J():N():se=he>0?k():I(),se&&(q.preventDefault(),D(),L())}function L(){if(!get$2(E)){for(let q=0;q<u;q++)for(let O=0;O<u;O++)if(get$2(m)[q][O]>=h){set(E,!0),t()?(re("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{V(),e.onWin?.()},_)):re("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:V},{text:"Новая игра",action:x,class:"btn-secondary"}]);return}}X()&&!fe()&&(set(p,!0),t()?(re("💀 Конец",`Игра окончена. Очки: ${get$2($)}`,[]),setTimeout(()=>{V(),e.onLose?.()},_)):re("💀 Конец",`Игра окончена. Очки: ${get$2($)}`,[{text:"Новая игра",action:x}]))}function X(){for(let q=0;q<u;q++)for(let O=0;O<u;O++)if(get$2(m)[q][O]===0)return!1;return!0}function fe(){for(let q=0;q<u;q++)for(let O=0;O<u;O++)if(O<u-1&&get$2(m)[q][O]===get$2(m)[q][O+1]||q<u-1&&get$2(m)[q][O]===get$2(m)[q+1][O])return!0;return!1}function ge(){t()?(re("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{V(),e.onLose?.()},_)):re("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:x}])}function re(q,O,z){set(T,{show:!0,title:q,text:O,actions:z},!0)}function V(){get$2(T).show=!1}function G(){re("📖 Правила",`Эволюция 2048:

🎯 Цель: Создать существо уровня 2048 (Король).

⬅️➡️⬆️⬇️ Свайп или стрелки перемещают всех существ в одну сторону.

🔗 Одинаковые существа эволюционируют при столкновении:
🦇→👻→💀→🧟→🧛→🧙→👹→🐉→🔥→⚡→👑

💥 Новое существо появляется после каждого хода.

🏆 Победишь, когда получишь короля!`,[{text:"Понятно",action:V}])}BodyWrapper(r,{children:(q,O)=>{var z=root_1$l(),ce=first_child(z);{let be=user_derived(()=>t()?ge:void 0);GameHeader(ce,{onRestart:x,get onGiveUp(){return get$2(be)},get showGiveUp(){return t()},onShowRules:G})}var he=sibling(ce,2);he.__touchstart=[handleTouchStart$1,j,F],he.__touchend=U;var se=child(he);each(se,21,()=>get$2(m),index$1,(be,ue)=>{var ie=comment(),oe=first_child(ie);each(oe,17,()=>get$2(ue),index$1,(Q,ae)=>{var H=root_3$j();set_class(H,1,"cell svelte-1o3nb6j",null,{},{"cell-{cell}":ae-{}});var W=child(H);template_effect(()=>{set_style(H,`background-color: ${g[get$2(ae)]||"#2a2a40"};`),set_text(W,get$2(ae)>0?v[get$2(ae)]||get$2(ae):"")}),append(Q,H)}),append(be,ie)});var ve=sibling(he,2);GameFooter(ve,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(be,ue)=>{var ie=root_4$c(),oe=child(ie),Q=sibling(child(oe)),ae=child(Q);template_effect(()=>set_text(ae,get$2($))),append(be,ie)},$$slots:{default:!0}});var me=sibling(ve,2);MinigameModal(me,{get modal(){return get$2(T)}}),append(q,z)}}),pop()}delegate(["touchstart","touchend"]);var root_2$g=from_html('<button type="button"><span class="cell-content svelte-1p9db1h"> </span></button>'),root_3$i=from_html('<div class="footer-stats svelte-1p9db1h"><span class="mines-counter svelte-1p9db1h"></span> <span class="flag-counter svelte-1p9db1h"> </span></div>'),root_1$k=from_html('<!> <div id="game-container" class="svelte-1p9db1h"><div id="grid" class="svelte-1p9db1h"></div></div> <!> <!>',1);function CursedCrypts(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=8,h=8,_=10,v=1e3;let g=state(proxy([])),m=state(!1),$=state(!1),p=state(!0),E=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>R());let T=user_derived(()=>get$2(g).filter(V=>V.revealed).length),x=u*h,D=user_derived(()=>get$2($)||get$2(T)===x-_);function R(){set(g,Array(x).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),set(m,!1),set($,!1),set(p,!0),X()}function P(V){let G=0;for(;G<_;){const q=Math.floor(Math.random()*x);q!==V&&!get$2(g)[q].isMine&&(get$2(g)[q].isMine=!0,G++)}for(let q=0;q<x;q++)get$2(g)[q].isMine||(get$2(g)[q].adjacentMines=N(q))}function N(V){const G=Math.floor(V/h),q=V%h;let O=0;for(let z=-1;z<=1;z++)for(let ce=-1;ce<=1;ce++){if(z===0&&ce===0)continue;const he=G+z,se=q+ce;if(he>=0&&he<u&&se>=0&&se<h){const ve=he*h+se;get$2(g)[ve].isMine&&O++}}return O}function J(V){if(!(get$2(m)||get$2(g)[V].revealed||get$2(g)[V].flagged)){if(get$2(p)&&(P(V),set(p,!1)),get$2(g)[V].isMine){j(),set(m,!0),set($,!1),t()?(L("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{X(),e.onLose?.()},v)):L("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:R}]);return}k(V),F()}}function I(V,G){G.preventDefault(),!(get$2(m)||get$2(g)[V].revealed)&&(get$2(g)[V].flagged=!get$2(g)[V].flagged)}function k(V){if(!(V<0||V>=x)&&!(get$2(g)[V].revealed||get$2(g)[V].flagged)&&(get$2(g)[V].revealed=!0,get$2(g)[V].adjacentMines===0&&!get$2(g)[V].isMine)){const G=Math.floor(V/h),q=V%h;for(let O=-1;O<=1;O++)for(let z=-1;z<=1;z++){if(O===0&&z===0)continue;const ce=G+O,he=q+z;ce>=0&&ce<u&&he>=0&&he<h&&k(ce*h+he)}}}function j(){for(let V=0;V<x;V++)get$2(g)[V].isMine&&(get$2(g)[V].revealed=!0)}function F(){get$2(D)&&(set($,!0),set(m,!0),t()?(L("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{X(),e.onWin?.()},v)):L("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:R}]))}function U(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{X(),e.onLose?.()},v)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:R}])}function L(V,G,q){set(E,{show:!0,title:V,text:G,actions:q},!0)}function X(){get$2(E).show=!1}function fe(V){return V.revealed?V.isMine?"💀":V.adjacentMines===0?"":V.adjacentMines.toString():V.flagged?"🕯":""}function ge(V){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][V]||"#ececec"}function re(){L("📖 Правила",`Сапёр (Проклятые склепы):

🎯 Цель: Открыть все ячейки, где нет мин.

🔢 Цифры показывают, сколько мин рядом с ячейкой (от 1 до 8).

🕯 Правый клик ставит флаг (пометить мину).

💡 Первое нажатие всегда безопасно — мины расставляются после первого клика.

💀 Если наткнёшься на мину — проигрыш.`,[{text:"Понятно",action:X}])}BodyWrapper(r,{children:(V,G)=>{var q=root_1$k(),O=first_child(q);{let ve=user_derived(()=>t()?U:void 0);GameHeader(O,{onRestart:R,get onGiveUp(){return get$2(ve)},get showGiveUp(){return t()},onShowRules:re})}var z=sibling(O,2),ce=child(z);set_style(ce,"grid-template-columns: repeat(8, 1fr);"),each(ce,21,()=>get$2(g),index$1,(ve,me,be)=>{var ue=root_2$g();let ie;ue.__click=()=>J(be),ue.__contextmenu=ae=>I(be,ae);var oe=child(ue),Q=child(oe);template_effect((ae,H,W)=>{ie=set_class(ue,1,"cell svelte-1p9db1h",null,ie,ae),set_attribute(ue,"aria-label",get$2(me).revealed?get$2(me).isMine?"Мина":`Ячейка с ${get$2(me).adjacentMines} минами`:get$2(me).flagged?"Флаг":"Неизвестно"),set_style(oe,`color: ${H??""}`),set_text(Q,W)},[()=>({revealed:get$2(me).revealed,mine:get$2(me).isMine&&get$2(me).revealed,flagged:get$2(me).flagged}),()=>get$2(me).revealed&&!get$2(me).isMine?ge(get$2(me).adjacentMines):"",()=>fe(get$2(me))]),append(ve,ue)});var he=sibling(z,2);GameFooter(he,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ve,me)=>{var be=root_3$i(),ue=child(be);ue.textContent="💀 10";var ie=sibling(ue,2),oe=child(ie);template_effect(Q=>set_text(oe,`🕯 ${Q??""}`),[()=>get$2(g).filter(Q=>Q.flagged).length]),append(ve,be)},$$slots:{default:!0}});var se=sibling(he,2);MinigameModal(se,{get modal(){return get$2(E)}}),append(V,q)}}),pop()}delegate(["click","contextmenu"]);function handleStockClick(r,e,t,i){if(get$2(e).length>0){const n=get$2(e).pop();n.faceUp=!0,get$2(t).push(n)}else get$2(t).length>0&&(set(e,get$2(t).reverse().map(n=>({...n,faceUp:!1})),!0),set(t,[],!0));update(i)}function handleWasteClick(r,e,t){get$2(e).length!==0&&set(t,{pile:-2,index:get$2(e).length-1},!0)}var root_2$f=from_html('<div class="card back svelte-fcha4g"></div>'),root_3$h=from_html('<div class="card empty svelte-fcha4g">🔄</div>'),root_4$b=from_html('<div><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),root_6$b=from_html('<div class="card front svelte-fcha4g"><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),root_7$a=from_html('<div class="card empty svelte-fcha4g">👻</div>'),root_5$g=from_html('<button type="button" class="pile foundation svelte-fcha4g"><!></button>'),root_10$3=from_html('<span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span>',1),root_9$3=from_html('<button type="button"><!></button>'),root_8$8=from_html('<div class="tableau svelte-fcha4g" role="button" tabindex="0"></div>'),root_11$3=from_html('<div class="footer-stats svelte-fcha4g"><span class="moves-counter svelte-fcha4g">Ходов: <strong class="svelte-fcha4g"> </strong></span></div>'),root_1$j=from_html('<!> <div id="game-container" class="svelte-fcha4g"><div class="top-row svelte-fcha4g"><button type="button" class="pile stock svelte-fcha4g" aria-label="Колода"><!></button> <button type="button" class="pile waste svelte-fcha4g" aria-label="Сброс"><!></button> <div class="foundations svelte-fcha4g"></div></div> <div class="tableaus svelte-fcha4g"></div></div> <!> <!>',1);function TowerOfSouls(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],h={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},_=[1,2,3,4,5,6,7,8,9,10,11,12,13],v={1:"A",11:"J",12:"Q",13:"K"};let g=state(proxy([])),m=state(proxy([])),$=state(proxy([[],[],[],[]])),p=state(proxy([[],[],[],[],[],[],[]])),E=state(null),T=state(!1),x=state(0),D=state(proxy({show:!1,title:"",text:"",actions:[]}));const R=1e3;onMount(()=>N());let P=user_derived(()=>get$2($).every(re=>re.length===13));function N(){let re=[];for(const G of u)for(const q of _)re.push({suit:G,rank:q,faceUp:!1});re=re.sort(()=>Math.random()-.5),set(g,[],!0),set(m,[],!0),set($,[[],[],[],[]],!0),set(p,[[],[],[],[],[],[],[]],!0);let V=0;for(let G=0;G<7;G++)for(let q=G;q<7;q++){const O=re[V++];O.faceUp=G===q,get$2(p)[q].push(O)}for(;V<re.length;)get$2(g).push(re[V++]);set(E,null),set(x,0),set(T,!1),L()}function J(re,V){const G=get$2(p)[re];if(get$2(E)){const{pile:q,index:O}=get$2(E);let z;q===-2?z=[get$2(m)[O]]:z=get$2(p)[q].slice(O);const ce=z[0];if(G.length===0){if(ce.rank===13){k(q,O,re,-1),set(E,null);return}}else{const he=G[G.length-1];if((ce.suit==="hearts"||ce.suit==="diamonds")!=(he.suit==="hearts"||he.suit==="diamonds")&&ce.rank===he.rank-1){k(q,O,re,-1),set(E,null);return}}if(z.length===1)for(let he=0;he<4;he++){const se=get$2($)[he];if(se.length===0){if(ce.rank===1){k(q,O,-1,he),set(E,null);return}}else{const ve=se[se.length-1];if(ce.suit===ve.suit&&ce.rank===ve.rank+1){k(q,O,-1,he),set(E,null);return}}}set(E,null)}else V>=0&&G[V]?.faceUp&&set(E,{pile:re,index:V},!0)}function I(re){if(!get$2(E))return;const{pile:V,index:G}=get$2(E);let q;V===-2?q=get$2(m)[G]:q=get$2(p)[V][G];const O=get$2($)[re];if(O.length===0)q.rank===1&&V>=-1&&(V===-2?[get$2(m)[G]]:get$2(p)[V].slice(G)).length===1&&k(V,G,-1,re);else{const z=O[O.length-1];q.suit===z.suit&&q.rank===z.rank+1&&(V===-2?[get$2(m)[G]]:get$2(p)[V].slice(G)).length===1&&k(V,G,-1,re)}set(E,null)}function k(re,V,G,q){let O;re===-2?O=[get$2(m).pop()]:(O=get$2(p)[re].splice(V),get$2(p)[re].length>0&&(get$2(p)[re][get$2(p)[re].length-1].faceUp=!0)),G>=0?get$2(p)[G].push(...O):q>=0&&get$2($)[q].push(...O),update(x),j()}function j(){get$2(P)&&(set(T,!0),t()?(U("🎉 Победа!",`Вы собрали все души за ${get$2(x)} ходов!`,[]),setTimeout(()=>{L(),e.onWin?.()},R)):U("🎉 Победа!",`Вы собрали все души за ${get$2(x)} ходов!`,[{text:"Играть снова",action:N}]))}function F(){t()?(U("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},R)):U("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:N}])}function U(re,V,G){set(D,{show:!0,title:re,text:V,actions:G},!0)}function L(){get$2(D).show=!1}function X(){U("📖 Правила",`Пасьянс (Башня душ):

🎯 Цель: Собрать все карты в фундаменты (справа) по мастям от туза до короля.

🃏 Кликни на колоду (слева) чтобы взять карту.

📋 Возьми карту из сброса и положи в столбец по убыванию (красная на чёрную).

🔄 Карты в столбце можно перемещать друг на друга по убыванию и чередованию цветов.

💡 Короля можно положить на пустой столбец.

🏆 Собери все 4 масти от туза до короля!`,[{text:"Понятно",action:L}])}function fe(re){return v[re]||re.toString()}function ge(re){return re==="hearts"||re==="diamonds"?"#e94560":"#ececec"}BodyWrapper(r,{children:(re,V)=>{var G=root_1$j(),q=first_child(G);{let H=user_derived(()=>t()?F:void 0);GameHeader(q,{onRestart:N,get onGiveUp(){return get$2(H)},get showGiveUp(){return t()},onShowRules:X})}var O=sibling(q,2),z=child(O),ce=child(z);ce.__click=[handleStockClick,g,m,x];var he=child(ce);{var se=H=>{var W=root_2$f();append(H,W)},ve=H=>{var W=root_3$h();append(H,W)};if_block(he,H=>{get$2(g).length>0?H(se):H(ve,!1)})}var me=sibling(ce,2);me.__click=[handleWasteClick,m,E];var be=child(me);{var ue=H=>{var W=root_4$b();let Z;var B=child(W),te=child(B),ne=sibling(B,2),ye=child(ne);template_effect((we,Ee,$e)=>{Z=set_class(W,1,"card front svelte-fcha4g",null,Z,we),set_text(te,Ee),set_style(ne,`color: ${$e??""}`),set_text(ye,h[get$2(m)[get$2(m).length-1].suit])},[()=>({selected:get$2(E)?.pile===-2}),()=>fe(get$2(m)[get$2(m).length-1].rank),()=>ge(get$2(m)[get$2(m).length-1].suit)]),append(H,W)};if_block(be,H=>{get$2(m).length>0&&H(ue)})}var ie=sibling(me,2);each(ie,21,()=>get$2($),index$1,(H,W,Z)=>{var B=root_5$g();B.__click=()=>I(Z),set_attribute(B,"aria-label",`Фундамент ${Z+1}`);var te=child(B);{var ne=we=>{var Ee=root_6$b(),$e=child(Ee),Ce=child($e),Le=sibling($e,2),w=child(Le);template_effect((c,d)=>{set_text(Ce,c),set_style(Le,`color: ${d??""}`),set_text(w,h[get$2(W)[get$2(W).length-1].suit])},[()=>fe(get$2(W)[get$2(W).length-1].rank),()=>ge(get$2(W)[get$2(W).length-1].suit)]),append(we,Ee)},ye=we=>{var Ee=root_7$a();append(we,Ee)};if_block(te,we=>{get$2(W).length>0?we(ne):we(ye,!1)})}append(H,B)});var oe=sibling(z,2);each(oe,21,()=>get$2(p),index$1,(H,W,Z)=>{var B=root_8$8();B.__click=()=>J(Z,-1),B.__keydown=te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),J(Z,-1))},set_attribute(B,"aria-label",`Столбец ${Z+1}`),each(B,21,()=>get$2(W),index$1,(te,ne,ye)=>{var we=root_9$3();let Ee;we.__click=Le=>{Le.stopPropagation(),J(Z,ye)},set_style(we,`margin-top: ${ye>0?"-80%":"0"}; z-index: ${ye};`);var $e=child(we);{var Ce=Le=>{var w=root_10$3(),c=first_child(w),d=child(c),S=sibling(c,2),M=child(S);template_effect((Y,_e)=>{set_text(d,Y),set_style(S,`color: ${_e??""}`),set_text(M,h[get$2(ne).suit])},[()=>fe(get$2(ne).rank),()=>ge(get$2(ne).suit)]),append(Le,w)};if_block($e,Le=>{get$2(ne).faceUp&&Le(Ce)})}template_effect((Le,w)=>{Ee=set_class(we,1,"card svelte-fcha4g",null,Ee,Le),set_attribute(we,"aria-label",w)},[()=>({front:get$2(ne).faceUp,back:!get$2(ne).faceUp,selected:get$2(E)?.pile===Z&&get$2(E)?.index===ye}),()=>get$2(ne).faceUp?`${fe(get$2(ne).rank)} ${h[get$2(ne).suit]}`:"Лицевая сторона карты"]),append(te,we)}),append(H,B)});var Q=sibling(O,2);GameFooter(Q,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(H,W)=>{var Z=root_11$3(),B=child(Z),te=sibling(child(B)),ne=child(te);template_effect(()=>set_text(ne,get$2(x))),append(H,Z)},$$slots:{default:!0}});var ae=sibling(Q,2);MinigameModal(ae,{get modal(){return get$2(D)}}),append(re,G)}}),pop()}delegate(["click","keydown"]);var root_2$e=from_html('<button type="button" class="cell svelte-v9v15s"> </button>'),root_3$g=from_html('<div class="footer-stats svelte-v9v15s"><span class="player-info svelte-v9v15s">Ход: <strong class="svelte-v9v15s"> </strong></span></div>'),root_1$i=from_html('<!> <div id="game-container" class="svelte-v9v15s"><div class="status svelte-v9v15s">Ход: <span class="current-player svelte-v9v15s"> </span></div> <div class="board svelte-v9v15s"></div></div> <!> <!>',1);function AlchemistsCross(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=3,h=1e3,_=["🧪","🗡️"];let v=state(proxy(Array(u*u).fill(null))),g=state(proxy(_[0])),m=state(!1),$=state(null),p=state(proxy({show:!1,title:"",text:"",actions:[]}));function E(I){if(!(get$2(m)||get$2(v)[I])){if(get$2(v)[I]=get$2(g),T(get$2(g))){x(get$2(g));return}if(get$2(v).every(k=>k)){x(null);return}set(g,get$2(g)===_[0]?_[1]:_[0],!0)}}function T(I){return[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(j=>j.every(F=>get$2(v)[F]===I))}function x(I){set(m,!0),set($,I,!0),I?t()?(P("🎉 Победа!",`Победил ${I}!`,[]),setTimeout(()=>{N(),e.onWin?.()},h)):P("🎉 Победа!",`Победил ${I}!`,[{text:"Играть снова",action:D}]):t()?(P("🤝 Ничья!","Ничья!",[]),setTimeout(()=>{N(),e.onLose?.()},h)):P("🤝 Ничья!","Ничья!",[{text:"Играть снова",action:D}])}function D(){set(v,Array(u*u).fill(null),!0),set(g,_[0],!0),set(m,!1),set($,null),N()}function R(){set(m,!0);const I=get$2(g);t()?(P("💀 Сдаюсь",`${I} сдался!`,[]),setTimeout(()=>{N(),e.onLose?.()},h)):P("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:D}])}function P(I,k,j){set(p,{show:!0,title:I,text:k,actions:j},!0)}function N(){get$2(p).show=!1}function J(){P("📖 Правила",`Алхимический крестик:

🎯 Цель: Первым выстроить 3 своих символа в ряд (по горизонтали, вертикали или диагонали).

🧪 Игрок 1: 🧪
🗡️ Игрок 2: 🗡️

⚠️ Игроки ходят по очереди.`,[{text:"Понятно",action:N}])}onMount(()=>{D()}),BodyWrapper(r,{children:(I,k)=>{var j=root_1$i(),F=first_child(j);{let G=user_derived(()=>t()?R:void 0);GameHeader(F,{onRestart:D,get onGiveUp(){return get$2(G)},get showGiveUp(){return t()},onShowRules:J})}var U=sibling(F,2),L=child(U),X=sibling(child(L)),fe=child(X),ge=sibling(L,2);each(ge,21,()=>get$2(v),index$1,(G,q,O)=>{var z=root_2$e();z.__click=()=>E(O);var ce=child(z);template_effect(()=>{z.disabled=!!get$2(q)||get$2(m),set_text(ce,get$2(q)??"")}),append(G,z)});var re=sibling(U,2);GameFooter(re,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(G,q)=>{var O=root_3$g(),z=child(O),ce=sibling(child(z)),he=child(ce);template_effect(()=>set_text(he,get$2(g))),append(G,O)},$$slots:{default:!0}});var V=sibling(re,2);MinigameModal(V,{get modal(){return get$2(p)}}),template_effect(()=>set_text(fe,get$2(g))),append(I,j)}}),pop()}delegate(["click"]);var on_click$c=(r,e,t)=>e(get$2(t)),root_3$f=from_html('<button type="button" class="option-btn svelte-18w6na5"> </button>'),root_2$d=from_html('<div> </div> <div class="score svelte-18w6na5">Очки: <strong class="svelte-18w6na5"> </strong></div> <div class="question svelte-18w6na5"> </div> <div class="options svelte-18w6na5"></div>',1),root_4$a=from_html('<div class="start-screen svelte-18w6na5"><div class="title svelte-18w6na5">🕷️ Шёпот пауков</div> <div class="description svelte-18w6na5"></div> <button type="button" class="start-btn svelte-18w6na5">Начать испытание</button></div>'),root_5$f=from_html('<div class="footer-stats svelte-18w6na5"><span class="score-display svelte-18w6na5">Очки: <strong class="svelte-18w6na5"> </strong></span> <span class="time-display svelte-18w6na5">Время: <strong class="svelte-18w6na5"> </strong></span></div>'),root_1$h=from_html('<!> <div id="game-container" class="svelte-18w6na5"><!></div> <!> <!>',1);function WhisperOfSpiders($$anchor,$$props){push($$props,!0);let integrated=prop($$props,"integrated",3,!1),rewardItem=prop($$props,"rewardItem",3,null),items=prop($$props,"items",19,()=>[]),bucketName=prop($$props,"bucketName",3,"dracula"),question=state(""),correctAnswer=state(0),options=state(proxy([])),score=state(0),timeLeft=state(30),gameActive=state(!1),timerInterval=null;const TIMEOUT=1e3,WIN_SCORE=10;let modal=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>()=>{timerInterval&&clearInterval(timerInterval)});function generateQuestion(){const a=Math.floor(Math.random()*10)+1,b=Math.floor(Math.random()*10)+1,operations=["+","-","*"],op=operations[Math.floor(Math.random()*operations.length)];set(question,`${a} ${op} ${b}`),set(correctAnswer,eval(get$2(question)),!0);let newOptions=[get$2(correctAnswer)];for(;newOptions.length<4;){let r=get$2(correctAnswer)+(Math.floor(Math.random()*7)-3);!newOptions.includes(r)&&r>0&&newOptions.push(r)}set(options,newOptions.sort(()=>Math.random()-.5),!0)}function initGame(){timerInterval&&clearInterval(timerInterval),set(gameActive,!1),set(score,0),set(timeLeft,30),hideModal()}function startGame(){set(gameActive,!0),set(score,0),set(timeLeft,30),generateQuestion(),timerInterval=setInterval(()=>{update(timeLeft,-1),get$2(timeLeft)<=0&&endGame()},1e3)}function endGame(){set(gameActive,!1),timerInterval&&(clearInterval(timerInterval),timerInterval=null),get$2(score)>=WIN_SCORE?integrated()?(showModal("🎉 Победа!",`Вы набрали ${get$2(score)} очков!`,[]),setTimeout(()=>{hideModal(),$$props.onWin?.()},TIMEOUT)):showModal("🎉 Победа!",`Вы набрали ${get$2(score)} очков!`,[{text:"Играть снова",action:initGame}]):integrated()?(showModal("💥 Время вышло!",`Вы набрали ${get$2(score)} очков. Нужно ${WIN_SCORE}.`,[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("💥 Время вышло!",`Вы набрали ${get$2(score)} очков. Нужно ${WIN_SCORE}.`,[{text:"Попробовать снова",action:initGame}])}function handleAnswer(r){get$2(gameActive)&&(r===get$2(correctAnswer)?(update(score),get$2(score)>=WIN_SCORE?endGame():generateQuestion()):set(timeLeft,Math.max(0,get$2(timeLeft)-2),!0))}function handleGiveUp(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),set(gameActive,!1),integrated()?(showModal("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:initGame}])}function showModal(r,e,t){set(modal,{show:!0,title:r,text:e,actions:t},!0)}function hideModal(){get$2(modal).show=!1}function showRules(){showModal("📖 Правила",`Шёпот пауков:

🎯 Цель: Набери ${WIN_SCORE} очков за 30 секунд.

🔢 Реши математический пример, выбрав правильный ответ из 4 вариантов.

⏱️ За неправильный ответ штраф -2 секунды.`,[{text:"Понятно",action:hideModal}])}BodyWrapper($$anchor,{children:(r,e)=>{var t=root_1$h(),i=first_child(t);{let g=user_derived(()=>integrated()?handleGiveUp:void 0);GameHeader(i,{onRestart:initGame,get onGiveUp(){return get$2(g)},get showGiveUp(){return integrated()},onShowRules:showRules})}var n=sibling(i,2),o=child(n);{var u=g=>{var m=root_2$d(),$=first_child(m);let p;var E=child($),T=sibling($,2),x=sibling(child(T)),D=child(x),R=sibling(T,2),P=child(R),N=sibling(R,2);each(N,21,()=>get$2(options),index$1,(J,I)=>{var k=root_3$f();k.__click=[on_click$c,handleAnswer,I];var j=child(k);template_effect(()=>set_text(j,get$2(I))),append(J,k)}),template_effect(J=>{p=set_class($,1,"timer svelte-18w6na5",null,p,J),set_text(E,`⏱️ ${get$2(timeLeft)??""}s`),set_text(D,`${get$2(score)??""}/10`),set_text(P,`${get$2(question)??""} = ?`)},[()=>({warning:get$2(timeLeft)<=10})]),append(g,m)},h=g=>{var m=root_4$a(),$=sibling(child(m),2);$.textContent="Реши 10 примеров за 30 секунд";var p=sibling($,2);p.__click=startGame,append(g,m)};if_block(o,g=>{get$2(gameActive)?g(u):g(h,!1)})}var _=sibling(n,2);GameFooter(_,{get rewardItem(){return rewardItem()},get items(){return items()},get bucketName(){return bucketName()},children:(g,m)=>{var $=root_5$f(),p=child($),E=sibling(child(p)),T=child(E),x=sibling(p,2),D=sibling(child(x)),R=child(D);template_effect(()=>{set_text(T,get$2(score)),set_text(R,`${get$2(timeLeft)??""}s`)}),append(g,$)},$$slots:{default:!0}});var v=sibling(_,2);MinigameModal(v,{get modal(){return get$2(modal)}}),append(r,t)}}),pop()}delegate(["click"]);var root_2$c=from_html('<span class="watching svelte-14s4ld8">👀 Смотри...</span>'),root_4$9=from_html('<span class="playing svelte-14s4ld8">🎮 Повторяй!</span>'),root_6$a=from_html("<span> </span>"),root_7$9=from_html('<button type="button" class="symbol svelte-14s4ld8"> </button>'),root_8$7=from_html('<div class="footer-stats svelte-14s4ld8"><span class="round-display svelte-14s4ld8">Раунд: <strong class="svelte-14s4ld8"> </strong></span></div>'),root_1$g=from_html('<!> <div id="game-container" class="svelte-14s4ld8"><div class="status svelte-14s4ld8"><!></div> <div class="round-info svelte-14s4ld8">Раунд: <strong class="svelte-14s4ld8"> </strong></div> <div class="symbols svelte-14s4ld8"></div></div> <!> <!>',1);function SoulCycle(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["🔥","💧","🌪️","🌑"],h=["#e94560","#0984e3","#fdcb6e","#6c5ce7"],_=1e3,v=5;let g=state(proxy([])),m=state(proxy([])),$=state(0),p=state(!1),E=state(-1),T=state(!1),x=state(!1),D=state(!1),R=state(proxy({show:!1,title:"",text:"",actions:[]}));function P(){set(p,!0),set(D,!1),set(m,[],!0);const fe=u[Math.floor(Math.random()*u.length)];set(g,[...get$2(g),fe],!0),N()}async function N(){await new Promise(fe=>setTimeout(fe,500));for(let fe=0;fe<get$2(g).length;fe++)set(E,u.indexOf(get$2(g)[fe]),!0),await new Promise(ge=>setTimeout(ge,500)),set(E,-1),await new Promise(ge=>setTimeout(ge,200));set(p,!1),set(D,!0)}function J(fe){if(get$2(p)||!get$2(D)||get$2(T))return;const ge=u[fe],re=get$2(g)[get$2(m).length];if(ge!==re){k();return}set(m,[...get$2(m),ge],!0),get$2(m).length===get$2(g).length&&(update($),get$2($)>=v?I():(set(D,!1),setTimeout(P,1e3)))}function I(){set(T,!0),set(x,!0),t()?(U("🎉 Победа!",`Вы прошли ${v} раундов!`,[]),setTimeout(()=>{L(),e.onWin?.()},_)):U("🎉 Победа!",`Вы прошли ${v} раундов!`,[{text:"Играть снова",action:j}])}function k(){set(T,!0),set(x,!1),t()?(U("💥 Ошибка!","Вы нажали неправильный символ!",[]),setTimeout(()=>{L(),e.onLose?.()},_)):U("💥 Ошибка!","Вы нажали неправильный символ!",[{text:"Попробовать снова",action:j}])}function j(){set(g,[],!0),set(m,[],!0),set($,0),set(T,!1),set(x,!1),set(p,!1),set(D,!1),set(E,-1),L(),P()}function F(){set(T,!0),t()?(U("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},_)):U("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:j}])}function U(fe,ge,re){set(R,{show:!0,title:fe,text:ge,actions:re},!0)}function L(){get$2(R).show=!1}function X(){U("📖 Правила",`Цикл душ:

🎯 Цель: Пройди ${v} раундов.

🔴 Компьютер показывает последовательность символов.

🟢 Повтори последовательность в том же порядке.

⚠️ Одна ошибка — и игра окончена!`,[{text:"Понятно",action:L}])}onMount(()=>{j()}),BodyWrapper(r,{children:(fe,ge)=>{var re=root_1$g(),V=first_child(re);{let ie=user_derived(()=>t()?F:void 0);GameHeader(V,{onRestart:j,get onGiveUp(){return get$2(ie)},get showGiveUp(){return t()},onShowRules:X})}var G=sibling(V,2),q=child(G),O=child(q);{var z=ie=>{var oe=root_2$c();append(ie,oe)},ce=ie=>{var oe=comment(),Q=first_child(oe);{var ae=W=>{var Z=root_4$9();append(W,Z)},H=W=>{var Z=comment(),B=first_child(Z);{var te=ne=>{var ye=root_6$a();let we;var Ee=child(ye);template_effect($e=>{we=set_class(ye,1,"svelte-14s4ld8",null,we,$e),set_text(Ee,get$2(x)?"🎉 Победа!":"💥 Проигрыш")},[()=>({won:get$2(x),lost:!get$2(x)})]),append(ne,ye)};if_block(B,ne=>{get$2(T)&&ne(te)},!0)}append(W,Z)};if_block(Q,W=>{get$2(D)?W(ae):W(H,!1)},!0)}append(ie,oe)};if_block(O,ie=>{get$2(p)?ie(z):ie(ce,!1)})}var he=sibling(q,2),se=sibling(child(he)),ve=child(se),me=sibling(he,2);each(me,21,()=>u,index$1,(ie,oe,Q)=>{var ae=root_7$9();ae.__click=()=>J(Q);var H=child(ae);template_effect(()=>{set_style(ae,`background-color: ${h[Q]??""}; filter: ${get$2(E)===Q?"brightness(1.5)":"none"}; transform: ${get$2(E)===Q?"scale(1.1)":"scale(1)"};`),ae.disabled=get$2(p)||!get$2(D)||get$2(T),set_text(H,get$2(oe))}),append(ie,ae)});var be=sibling(G,2);GameFooter(be,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ie,oe)=>{var Q=root_8$7(),ae=child(Q),H=sibling(child(ae)),W=child(H);template_effect(()=>set_text(W,get$2($))),append(ie,Q)},$$slots:{default:!0}});var ue=sibling(be,2);MinigameModal(ue,{get modal(){return get$2(R)}}),template_effect(()=>set_text(ve,`${get$2($)??""}/5`)),append(fe,re)}}),pop()}delegate(["click"]);function startGame(r,e,t){set(e,!0),t()}var root_2$b=from_html('<div class="start-screen svelte-1g2wfw4"><div class="title svelte-1g2wfw4">🌀 Лабиринт Минотавра</div> <div class="description svelte-1g2wfw4">Найди выход из лабиринта</div> <button type="button" class="start-btn svelte-1g2wfw4">Начать испытание</button></div>'),root_5$e=from_html("<span><!></span>"),root_4$8=from_html('<div class="row svelte-1g2wfw4"></div>'),on_click$b=(r,e)=>e(0,-1),on_click_1$6=(r,e)=>e(-1,0),on_click_2$3=(r,e)=>e(1,0),on_click_3$2=(r,e)=>e(0,1),root_3$e=from_html('<div class="maze-container svelte-1g2wfw4"><div class="maze svelte-1g2wfw4"></div> <div class="controls svelte-1g2wfw4"><button type="button" class="control-btn svelte-1g2wfw4">⬆️</button> <div class="controls-row svelte-1g2wfw4"><button type="button" class="control-btn svelte-1g2wfw4">⬅️</button> <button type="button" class="control-btn svelte-1g2wfw4">➡️</button></div> <button type="button" class="control-btn svelte-1g2wfw4">⬇️</button></div></div>'),root_8$6=from_html('<div class="footer-stats svelte-1g2wfw4"><span class="status-text svelte-1g2wfw4"> </span></div>'),root_1$f=from_html('<!> <div id="game-container" class="svelte-1g2wfw4"><!></div> <!> <!>',1);function LabyrinthOfMinotaur(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u="🧱",h="🚪",_="·",v=1e3,g=7;let m=state(proxy([])),$=state(proxy({x:1,y:1})),p=state(proxy({x:5,y:5})),E=state(!1),T=state(!1),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(U=g){const L=Array(U).fill(null).map(()=>Array(U).fill(u)),X=(fe,ge)=>{const re=[[0,1],[1,0],[0,-1],[-1,0]].sort(()=>Math.random()-.5);for(let[V,G]of re){const q=fe+V*2,O=ge+G*2;q>0&&q<U-1&&O>0&&O<U-1&&L[O][q]===u&&(L[ge+G][fe+V]=_,L[O][q]=_,X(q,O))}};return L[1][1]=_,X(1,1),L[get$2(p).y][get$2(p).x]=h,L}function R(){set($,{x:1,y:1},!0),set(p,{x:g-2,y:g-2},!0),set(m,D(g),!0),set(E,!1),set(T,!1),k()}function P(U,L){if(get$2(E)||!get$2(T))return;const X=get$2($).x+U,fe=get$2($).y+L;(get$2(m)[fe]?.[X]===_||get$2(m)[fe]?.[X]===h)&&set($,{x:X,y:fe},!0),get$2($).x===get$2(p).x&&get$2($).y===get$2(p).y&&N()}function N(){set(E,!0),t()?(I("🎉 Победа!","Вы нашли выход из лабиринта!",[]),setTimeout(()=>{k(),e.onWin?.()},v)):I("🎉 Победа!","Вы нашли выход из лабиринта!",[{text:"Играть снова",action:R}])}function J(){get$2(T)&&(set(E,!0),t()?(I("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{k(),e.onLose?.()},v)):I("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:R}]))}function I(U,L,X){set(x,{show:!0,title:U,text:L,actions:X},!0)}function k(){get$2(x).show=!1}function j(){I("📖 Правила",`Лабиринт Минотавра:

🎯 Цель: Найди выход из лабиринта.

🧙‍♂️ Управляй магом с помощью кнопок.

🚪 Дойди до двери, чтобы выиграть.

⚠️ Избегай стен!`,[{text:"Понятно",action:k}])}function F(U){if(!(!get$2(T)||get$2(E)))switch(U.key){case"ArrowUp":case"w":P(0,-1);break;case"ArrowDown":case"s":P(0,1);break;case"ArrowLeft":case"a":P(-1,0);break;case"ArrowRight":case"d":P(1,0);break}}onMount(()=>(R(),window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F))),BodyWrapper(r,{children:(U,L)=>{var X=root_1$f(),fe=first_child(X);{let z=user_derived(()=>t()?J:void 0),ce=user_derived(()=>t()&&get$2(T));GameHeader(fe,{onRestart:R,get onGiveUp(){return get$2(z)},get showGiveUp(){return get$2(ce)},onShowRules:j})}var ge=sibling(fe,2),re=child(ge);{var V=z=>{var ce=root_2$b(),he=sibling(child(ce),4);he.__click=[startGame,T,R],append(z,ce)},G=z=>{var ce=root_3$e(),he=child(ce);each(he,21,()=>get$2(m),index$1,(oe,Q,ae)=>{var H=root_4$8();each(H,21,()=>get$2(Q),index$1,(W,Z,B)=>{var te=root_5$e();let ne;var ye=child(te);{var we=$e=>{var Ce=text();Ce.nodeValue="🧙",append($e,Ce)},Ee=$e=>{var Ce=text();template_effect(()=>set_text(Ce,get$2(Z))),append($e,Ce)};if_block(ye,$e=>{get$2($).x===B&&get$2($).y===ae?$e(we):$e(Ee,!1)})}template_effect($e=>ne=set_class(te,1,"cell svelte-1g2wfw4",null,ne,$e),[()=>({wall:get$2(Z)===u,exit:get$2(Z)===h})]),append(W,te)}),append(oe,H)});var se=sibling(he,2),ve=child(se);ve.__click=[on_click$b,P];var me=sibling(ve,2),be=child(me);be.__click=[on_click_1$6,P];var ue=sibling(be,2);ue.__click=[on_click_2$3,P];var ie=sibling(me,2);ie.__click=[on_click_3$2,P],append(z,ce)};if_block(re,z=>{get$2(T)?z(G,!1):z(V)})}var q=sibling(ge,2);GameFooter(q,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(z,ce)=>{var he=root_8$6(),se=child(he),ve=child(se);template_effect(()=>set_text(ve,get$2(E)?"🎉 Победа!":get$2(T)?"Играет...":"Готов")),append(z,he)},$$slots:{default:!0}});var O=sibling(q,2);MinigameModal(O,{get modal(){return get$2(x)}}),append(U,X)}}),pop()}delegate(["click"]);function rollDice(r,e,t,i,n,o){if(!(get$2(e)<=0||get$2(t))){for(let u=0;u<get$2(i).length;u++)get$2(n)[u]||(get$2(i)[u]=Math.floor(Math.random()*6)+1);update(e,-1),o()}}var root_2$a=from_html('<button type="button"><span class="die-face svelte-1y509l9"> </span> <span class="die-number svelte-1y509l9"> </span></button>'),root_3$d=from_html('<div class="footer-stats svelte-1y509l9"><span class="rolls-info svelte-1y509l9">Бросков: <strong class="svelte-1y509l9"> </strong></span></div>'),root_1$e=from_html('<!> <div id="game-container" class="svelte-1y509l9"><div class="message svelte-1y509l9"> </div> <div class="dice-area svelte-1y509l9"></div> <button type="button" class="roll-btn svelte-1y509l9"> </button> <div class="target svelte-1y509l9">Цель: <span class="target-combo svelte-1y509l9">4-2-1</span></div></div> <!> <!>',1);function Bones421(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["⚀","⚁","⚂","⚃","⚄","⚅"],h=1e3,_="124";let v=state(proxy([1,1,1])),g=state(3),m=state(proxy([!1,!1,!1])),$=state(!1),p=state(!1),E=state("Брось кости!"),T=state(proxy({show:!1,title:"",text:"",actions:[]}));function x(){[...get$2(v)].sort().join("")===_?(set(E,"Победа! Снято проклятие!"),set($,!0),set(p,!0),D()):get$2(g)===0?(set(E,"Попытки кончились..."),set($,!0),set(p,!1),R()):set(E,`Осталось бросков: ${get$2(g)}`)}function D(){t()?(I("🎉 Победа!","Выпало 4-2-1! Проклятие снято!",[]),setTimeout(()=>{k(),e.onWin?.()},h)):I("🎉 Победа!","Выпало 4-2-1! Проклятие снято!",[{text:"Играть снова",action:N}])}function R(){t()?(I("💥 Поражение","Не удалось выбросить 4-2-1...",[]),setTimeout(()=>{k(),e.onLose?.()},h)):I("💥 Поражение","Не удалось выбросить 4-2-1...",[{text:"Попробовать снова",action:N}])}function P(F){get$2($)||get$2(g)===3||(get$2(m)[F]=!get$2(m)[F])}function N(){set(v,[1,1,1],!0),set(g,3),set(m,[!1,!1,!1],!0),set($,!1),set(p,!1),set(E,"Брось кости!"),k()}function J(){get$2($)||(set($,!0),set(p,!1),t()?(I("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{k(),e.onLose?.()},h)):I("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:N}]))}function I(F,U,L){set(T,{show:!0,title:F,text:U,actions:L},!0)}function k(){get$2(T).show=!1}function j(){I("📖 Правила",`Кости 4-2-1:

🎯 Цель: Выбрось комбинацию 4-2-1.

🎲 У тебя есть 3 броска.

🔒 После первого броска можно зафиксировать кубики.

💡 Комбинация 4-2-1 (в любом порядке) — победа!`,[{text:"Понятно",action:k}])}onMount(()=>{N()}),BodyWrapper(r,{children:(F,U)=>{var L=root_1$e(),X=first_child(L);{let ce=user_derived(()=>t()?J:void 0),he=user_derived(()=>t()&&!get$2($));GameHeader(X,{onRestart:N,get onGiveUp(){return get$2(ce)},get showGiveUp(){return get$2(he)},onShowRules:j})}var fe=sibling(X,2),ge=child(fe),re=child(ge),V=sibling(ge,2);each(V,21,()=>get$2(v),index$1,(ce,he,se)=>{var ve=root_2$a();let me;ve.__click=()=>P(se);var be=child(ve),ue=child(be),ie=sibling(be,2),oe=child(ie);template_effect(Q=>{me=set_class(ve,1,"die svelte-1y509l9",null,me,Q),ve.disabled=get$2($)||get$2(g)===3,set_text(ue,u[get$2(he)-1]),set_text(oe,get$2(he))},[()=>({locked:get$2(m)[se]})]),append(ce,ve)});var G=sibling(V,2);G.__click=[rollDice,g,$,v,m,x];var q=child(G),O=sibling(fe,2);GameFooter(O,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ce,he)=>{var se=root_3$d(),ve=child(se),me=sibling(child(ve)),be=child(me);template_effect(()=>set_text(be,get$2(g))),append(ce,se)},$$slots:{default:!0}});var z=sibling(O,2);MinigameModal(z,{get modal(){return get$2(T)}}),template_effect(()=>{set_text(re,get$2(E)),G.disabled=get$2(g)===0||get$2($),set_text(q,`🎲 Бросить (${get$2(g)??""})`)}),append(F,L)}}),pop()}delegate(["click"]);var root_26=from_html('<div class="loading svelte-15dde84">Загрузка игры...</div>'),root$9=from_html('<div class="minigame-container svelte-15dde84"><!></div>');function MinigameLauncher(r,e){push(e,!0);let t=prop(e,"bucketName",3,"dracula");function i(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function n(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var o=root$9(),u=child(o);{var h=v=>{OnetMonsters(v,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},_=v=>{var g=comment(),m=first_child(g);{var $=E=>{MemoMonsters(E,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=E=>{var T=comment(),x=first_child(T);{var D=P=>{LightOut(P,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},R=P=>{var N=comment(),J=first_child(N);{var I=j=>{FloodIt(j,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},k=j=>{var F=comment(),U=first_child(F);{var L=fe=>{BrokenMirror(fe,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},X=fe=>{var ge=comment(),re=first_child(ge);{var V=q=>{Evolution2048(q,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},G=q=>{var O=comment(),z=first_child(O);{var ce=se=>{CursedCrypts(se,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},he=se=>{var ve=comment(),me=first_child(ve);{var be=ie=>{TowerOfSouls(ie,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ue=ie=>{var oe=comment(),Q=first_child(oe);{var ae=W=>{AlchemistsCross(W,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},H=W=>{var Z=comment(),B=first_child(Z);{var te=ye=>{WhisperOfSpiders(ye,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ne=ye=>{var we=comment(),Ee=first_child(we);{var $e=Le=>{SoulCycle(Le,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},Ce=Le=>{var w=comment(),c=first_child(w);{var d=M=>{LabyrinthOfMinotaur(M,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},S=M=>{var Y=comment(),_e=first_child(Y);{var Ie=Ae=>{Bones421(Ae,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},Oe=Ae=>{var Fe=root_26();append(Ae,Fe)};if_block(_e,Ae=>{e.gameId==="bones421"?Ae(Ie):Ae(Oe,!1)},!0)}append(M,Y)};if_block(c,M=>{e.gameId==="labyrinth_of_minotaur"?M(d):M(S,!1)},!0)}append(Le,w)};if_block(Ee,Le=>{e.gameId==="soul_cycle"?Le($e):Le(Ce,!1)},!0)}append(ye,we)};if_block(B,ye=>{e.gameId==="whisper_of_spiders"?ye(te):ye(ne,!1)},!0)}append(W,Z)};if_block(Q,W=>{e.gameId==="alchemists_cross"?W(ae):W(H,!1)},!0)}append(ie,oe)};if_block(me,ie=>{e.gameId==="tower_of_souls"?ie(be):ie(ue,!1)},!0)}append(se,ve)};if_block(z,se=>{e.gameId==="cursed_crypts"?se(ce):se(he,!1)},!0)}append(q,O)};if_block(re,q=>{e.gameId==="evolution2048"?q(V):q(G,!1)},!0)}append(fe,ge)};if_block(U,fe=>{e.gameId==="broken_mirror"?fe(L):fe(X,!1)},!0)}append(j,F)};if_block(J,j=>{e.gameId==="flood_it"?j(I):j(k,!1)},!0)}append(P,N)};if_block(x,P=>{e.gameId==="light_out"?P(D):P(R,!1)},!0)}append(E,T)};if_block(m,E=>{e.gameId==="memo_monsters"?E($):E(p,!1)},!0)}append(v,g)};if_block(u,v=>{e.gameId==="onet_monsters"?v(h):v(_,!1)})}append(r,o),pop()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let r=0;r<256;++r)byteToHex.push((r+256).toString(16).slice(1));function unsafeStringify(r,e=0){return(byteToHex[r[e+0]]+byteToHex[r[e+1]]+byteToHex[r[e+2]]+byteToHex[r[e+3]]+"-"+byteToHex[r[e+4]]+byteToHex[r[e+5]]+"-"+byteToHex[r[e+6]]+byteToHex[r[e+7]]+"-"+byteToHex[r[e+8]]+byteToHex[r[e+9]]+"-"+byteToHex[r[e+10]]+byteToHex[r[e+11]]+byteToHex[r[e+12]]+byteToHex[r[e+13]]+byteToHex[r[e+14]]+byteToHex[r[e+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(r,e,t){if(native.randomUUID&&!r)return native.randomUUID();r=r||{};const i=r.random||(r.rng||rng)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,unsafeStringify(i)}async function updateUserStats(r,e){try{const{data:t,error:i}=await supabase.from("user_keys").select("visit_count").eq("user_key",r).single();if(i){console.error("Error fetching user stats:",i);return}const{error:n}=await supabase.from("user_keys").update({visit_count:(t?.visit_count||0)+1,last_visit:new Date().toISOString(),user_agent:e}).eq("user_key",r);n?console.error("Error updating user stats:",n):console.log("User stats updated for:",r)}catch(t){console.error("Error in updateUserStats:",t)}}let sessionStartTime=null;async function trackAnalyticsEvent(r,e){const t=get$1(userKeyStore);if(!t){console.warn("[Analytics] No user key, skipping event:",r);return}try{const{error:i}=await supabase.from("user_events").insert([{user_key:t,event_type:r,page_url:typeof window<"u"?window.location.href:null,event_data:e||{}}]);i?console.error("[Analytics] Error tracking event:",i):console.log("[Analytics] Event tracked:",r,e)}catch(i){console.error("[Analytics] Exception:",i)}}function createUserKeyStore(){const{subscribe:r,set:e}=writable(null);return{subscribe:r,init:async()=>{try{if(typeof localStorage>"u")return console.error("localStorage is not available"),null;if(typeof navigator>"u")return console.error("navigator is not available"),null;let t=localStorage.getItem("userKey");const i=navigator.userAgent,n=typeof document<"u"&&document.referrer||"direct";if(t)await updateUserStats(t,i);else{t=v4();const{error:o}=await supabase.from("user_keys").insert([{user_key:t,user_agent:i,referrer:n}]);if(o)return console.error("Error saving to Supabase:",o),null;console.log("New user created with key:",t),localStorage.setItem("userKey",t)}return e(t),t}catch(t){return console.error("Error in init:",t),null}},getUserStats:async t=>{try{const{data:i,error:n}=await supabase.from("user_keys").select("*").eq("user_key",t).single();return n?(console.error("Error getting user stats:",n),null):i}catch(i){return console.error("Error in getUserStats:",i),null}},regenerateKey:async()=>{try{if(typeof localStorage>"u"||typeof navigator>"u")return null;const t=v4(),i=navigator.userAgent,n=typeof document<"u"&&document.referrer||"direct",{error:o}=await supabase.from("user_keys").insert([{user_key:t,user_agent:i,referrer:n}]);return o?(console.error("Error saving new key to Supabase:",o),null):(localStorage.setItem("userKey",t),e(t),console.log("Key regenerated:",t),t)}catch(t){return console.error("Error in regenerateKey:",t),null}},clearKey:()=>{typeof localStorage<"u"&&localStorage.removeItem("userKey"),e(null),console.log("User key cleared")},trackEvent:async(t,i)=>{await trackAnalyticsEvent(t,i)},trackStoryStart:async(t,i)=>{await trackAnalyticsEvent("story_start",{story_id:t,story_title:i})},trackStoryComplete:async(t,i,n)=>{await trackAnalyticsEvent("story_complete",{story_id:t,story_title:i,dialogue_count:n})},trackGameStart:async(t,i,n)=>{await trackAnalyticsEvent("game_start",{game_id:t,game_title:i,story_id:n})},trackGameResult:async(t,i,n,o)=>{await trackAnalyticsEvent(n?"game_win":"game_lose",{game_id:t,game_title:i,story_id:o})},startSessionTimer:()=>{sessionStartTime=Date.now(),console.log("[Analytics] Session timer started")},stopSessionTimer:async()=>{if(!sessionStartTime){console.warn("[Analytics] No session start time");return}const t=Math.floor((Date.now()-sessionStartTime)/1e3);await trackAnalyticsEvent("session_time",{duration_seconds:t}),console.log("[Analytics] Session time recorded:",t,"seconds"),sessionStartTime=null},getCurrentKey:()=>get$1(userKeyStore)}}const userKeyStore=createUserKeyStore();function handleContainerClick(r,e,t){if(get$2(e))return;const i=r.target;i.closest("button")||i.closest(".options-container")||t()}function handleTouchStart(r,e,t,i){get$2(e)&&(set(t,r.touches[0].clientX,!0),set(i,!0))}function handleTouchMove(r,e,t,i){!get$2(e)||!get$2(t)||set(i,r.touches[0].clientX,!0)}function handleTouchEnd(r,e,t,i,n,o,u){if(!get$2(e)||!get$2(t))return;set(t,!1),get$2(i)-get$2(n)>50&&get$2(o)?.nextDialogueId&&u(),set(i,0),set(n,0)}var root_6$9=from_html('<img alt="BG" class="background-image svelte-1efw406"/>'),root_3$c=from_html('<div class="background-media svelte-1efw406"><!></div>'),root_10$2=from_html('<img alt="Char" class="character-image svelte-1efw406"/>'),root_7$8=from_html('<div class="character-media svelte-1efw406"><!></div>'),on_click$a=(r,e,t)=>e(get$2(t)),root_13=from_html("<button> </button>"),root_11$2=from_html('<div class="options-container svelte-1efw406"></div>'),root_15=from_html('<div class="swipe-hint svelte-1efw406"><span>← свайп влево →</span></div>'),root_1$d=from_html('<div><!> <!> <!> <div class="dialogue-content svelte-1efw406"><div class="dialogue-text svelte-1efw406"> </div> <!></div></div>'),root_16=from_html("<p> </p>");function DialogueCard(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName),i=prop(e,"isPreview",3,!1);const n=user_derived(()=>e.dialogue||gameState.findDialogue(gameState.currentDialogueId));let o=state(null),u=state(0),h=state(0),_=state(!1),v=state(!1);onMount(()=>{set(v,window.innerWidth<768),window.addEventListener("resize",()=>{set(v,window.innerWidth<768)})}),user_effect(()=>{get$2(n)?.onEnter&&gameState.runActions(get$2(n).onEnter)});function g(){get$2(n)?.nextDialogueId&&gameState.goToDialogue(get$2(n).nextDialogueId)}function m(N){if(N.actions&&gameState.runActions(N.actions),N.miniGame){userKeyStore.trackGameStart(N.miniGame.id,N.miniGame.id,gameState.selectedStory||void 0),set(o,{gameId:N.miniGame.id,onWinDialogueId:N.miniGame.onWinDialogueId,onLoseDialogueId:N.miniGame.onLoseDialogueId,rewardItem:N.miniGame.rewardItem},!0);return}N.nextDialogueId&&gameState.goToDialogue(N.nextDialogueId)}function $(){get$2(o)&&userKeyStore.trackGameResult(get$2(o).gameId,get$2(o).gameId,!0,gameState.selectedStory||void 0),get$2(o)?.rewardItem&&gameState.addItem(get$2(o).rewardItem),get$2(o)?.onWinDialogueId&&gameState.goToDialogue(get$2(o).onWinDialogueId),set(o,null)}function p(){get$2(o)&&userKeyStore.trackGameResult(get$2(o).gameId,get$2(o).gameId,!1,gameState.selectedStory||void 0),get$2(o)?.onLoseDialogueId&&gameState.goToDialogue(get$2(o).onLoseDialogueId),set(o,null)}function E(N){return N.visible===!1?!1:gameState.checkVisibilityCondition(N)}function T(N){return N.enabled!==!1}var x=comment(),D=first_child(x);{var R=N=>{var J=root_1$d();let I;J.__click=[handleContainerClick,v,g],J.__touchstart=[handleTouchStart,v,u,_],J.__touchmove=[handleTouchMove,v,_,h],J.__touchend=[handleTouchEnd,v,_,u,h,n,g];var k=child(J);{var j=O=>{{let z=user_derived(()=>gameState.storyData?.items);MinigameLauncher(O,{get gameId(){return get$2(o).gameId},onWin:$,onLose:p,get rewardItem(){return get$2(o).rewardItem},get items(){return get$2(z)},get bucketName(){return t()}})}};if_block(k,O=>{get$2(o)&&O(j)})}var F=sibling(k,2);{var U=O=>{var z=root_3$c(),ce=child(z);{var he=ve=>{var me=comment(),be=first_child(me);key(be,()=>get$2(n).backgroundImage,ue=>{Rive(ue,{get fileName(){return get$2(n).backgroundImage},get bucketName(){return t()}})}),append(ve,me)},se=ve=>{var me=root_6$9();template_effect(()=>set_attribute(me,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(n).backgroundImage}`)),append(ve,me)};if_block(ce,ve=>{get$2(n).backgroundImage.endsWith(".riv")?ve(he):ve(se,!1)})}append(O,z)};if_block(F,O=>{get$2(n).backgroundImage&&O(U)})}var L=sibling(F,2);{var X=O=>{var z=root_7$8(),ce=child(z);{var he=ve=>{var me=comment(),be=first_child(me);key(be,()=>get$2(n).characterImage,ue=>{Rive(ue,{get fileName(){return get$2(n).characterImage},get bucketName(){return t()}})}),append(ve,me)},se=ve=>{var me=root_10$2();template_effect(()=>set_attribute(me,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(n).characterImage}`)),append(ve,me)};if_block(ce,ve=>{get$2(n).characterImage.endsWith(".riv")?ve(he):ve(se,!1)})}append(O,z)};if_block(L,O=>{get$2(n).characterImage&&O(X)})}var fe=sibling(L,2),ge=child(fe),re=child(ge),V=sibling(ge,2);{var G=O=>{var z=root_11$2();each(z,21,()=>get$2(n).options,ce=>ce.text,(ce,he)=>{var se=comment(),ve=first_child(se);{var me=be=>{var ue=root_13();let ie;ue.__click=[on_click$a,m,he];var oe=child(ue);template_effect((Q,ae)=>{ie=set_class(ue,1,"option-button svelte-1efw406",null,ie,Q),ue.disabled=ae,set_text(oe,get$2(he).text)},[()=>({disabled:!T(get$2(he))}),()=>!T(get$2(he))]),append(be,ue)};if_block(ve,be=>{E(get$2(he))&&be(me)})}append(ce,se)}),append(O,z)},q=O=>{var z=comment(),ce=first_child(z);{var he=se=>{var ve=root_15();append(se,ve)};if_block(ce,se=>{get$2(n).nextDialogueId&&se(he)},!0)}append(O,z)};if_block(V,O=>{get$2(n).options&&get$2(n).options.length>0?O(G):O(q,!1)})}template_effect(O=>{I=set_class(J,1,"dialogue-container svelte-1efw406",null,I,O),set_text(re,get$2(n).text)},[()=>({"preview-mode":i()})]),append(N,J)},P=N=>{var J=root_16(),I=child(J);template_effect(()=>set_text(I,`Диалог не найден (ID: ${gameState.currentDialogueId??""})`)),append(N,J)};if_block(D,N=>{get$2(n)?N(R):N(P,!1)})}append(r,x),pop()}delegate(["click","touchstart","touchmove","touchend"]);var $$_import_editor=reactive_import(()=>editor),root_2$9=from_html('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),root_3$b=from_html('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),root_4$7=from_html('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),root_5$d=from_html('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),root_1$c=from_html('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),root_6$8=from_html('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),root$8=from_html('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function PreviewPanel(r,e){push(e,!1);function t(){$$_import_editor($$_import_editor().editingOptionIndex=null)}init();var i=root$8(),n=child(i),o=sibling(child(n),2);o.__click=t;var u=sibling(n,2),h=child(u);{var _=g=>{var m=root_1$c(),$=child(m);DialogueCard($,{get dialogue(){return editorDerived.currentDialogue},index:0,get bucketName(){return $$_import_editor().selectedBucket},isPreview:!0});var p=sibling($,2),E=child(p),T=sibling(child(E),2),x=child(T),D=sibling(E,2),R=sibling(child(D),2),P=child(R),N=sibling(D,2);{var J=X=>{var fe=root_2$9(),ge=sibling(child(fe),2),re=child(ge);template_effect(()=>set_text(re,editorDerived.currentDialogue.backgroundImage)),append(X,fe)};if_block(N,X=>{editorDerived.currentDialogue.backgroundImage&&X(J)})}var I=sibling(N,2);{var k=X=>{var fe=root_3$b(),ge=sibling(child(fe),2),re=child(ge);template_effect(()=>set_text(re,editorDerived.currentDialogue.characterImage)),append(X,fe)};if_block(I,X=>{editorDerived.currentDialogue.characterImage&&X(k)})}var j=sibling(p,2);{var F=X=>{var fe=root_4$7();append(X,fe)};if_block(j,X=>{(!editorDerived.currentDialogue.options||editorDerived.currentDialogue.options.length===0)&&X(F)})}var U=sibling(j,2);{var L=X=>{var fe=root_5$d();append(X,fe)};if_block(U,X=>{editorDerived.currentDialogue.options?.some(fe=>!fe.nextDialogueId)&&X(L)})}template_effect(()=>{set_text(x,editorDerived.currentDialogue.id),set_text(P,editorDerived.currentChapter?.title||"Без главы")}),append(g,m)},v=g=>{var m=root_6$8();append(g,m)};if_block(h,g=>{editorDerived.currentDialogue?g(_):g(v,!1)})}append(r,i),pop()}delegate(["click"]);const AVAILABLE_STORIES=["dracula","zombie","fairy_tale","minigames"];function getStoriesList(){const r=AVAILABLE_STORIES.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return editorActions.updateBucketsList(r),r}async function handleCreateStory(r,e,t,i,n,o){if(!get$2(e).trim())return;set(t,!0);const u=await createStory(get$2(e).trim(),get$2(i));u.success&&u.story?(set(n,!1),set(e,""),set(i,"stories"),await o(u.story)):alert(u.error||"Ошибка создания истории"),set(t,!1)}var on_click$9=(r,e)=>set(e,!0),on_click_1$5=(r,e,t)=>e(get$2(t)),on_click_2$2=(r,e,t)=>e(get$2(t)),on_click_3$1=(r,e,t)=>e(get$2(t)),root_4$6=from_html('<div class="story-card author-card svelte-1tegylr"><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <span> </span></div> <div class="story-actions svelte-1tegylr"><button class="btn small svelte-1tegylr">Открыть</button> <button class="btn small svelte-1tegylr"> </button> <button class="btn small danger svelte-1tegylr">✕</button></div></div>'),root_3$a=from_html('<div class="stories-section svelte-1tegylr"><div class="stories-grid svelte-1tegylr"></div></div>'),root_5$c=from_html('<p class="empty-text svelte-1tegylr">У вас пока нет историй. Создайте первую!</p>'),root_6$7=from_html("<p>Загрузка историй...</p>"),root_8$5=from_html('<span class="selected-badge svelte-1tegylr">Выбрано</span>'),on_click_4$1=(r,e,t)=>e(get$2(t).name),root_9$2=from_html('<button class="btn small svelte-1tegylr">Выбрать</button>'),root_7$7=from_html('<div><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <p class="svelte-1tegylr"> </p></div> <div class="story-actions svelte-1tegylr"><!></div></div>'),root_1$b=from_html('<div class="selector-header svelte-1tegylr"><h2 class="svelte-1tegylr">📝 Мои истории</h2> <button class="btn btn-primary svelte-1tegylr">+ Создать историю</button></div> <!> <div class="stories-section svelte-1tegylr"><h3 class="svelte-1tegylr">📚 Архивные истории</h3> <div class="stories-grid svelte-1tegylr"></div></div>',1),root_10$1=from_html('<div class="access-denied svelte-1tegylr"><h2 class="svelte-1tegylr">🔒 Доступ запрещён</h2> <p class="svelte-1tegylr">Редактирование историй доступно только авторам и администраторам.</p> <p class="svelte-1tegylr">Станьте автором, чтобы создавать и редактировать истории.</p></div>'),on_click_5=(r,e)=>set(e,!1),on_click_6=r=>r.stopPropagation(),on_click_7=(r,e)=>set(e,!1),root_11$1=from_html('<div class="modal-overlay svelte-1tegylr" role="dialog"><div class="modal svelte-1tegylr"><h3 class="svelte-1tegylr">Создать новую историю</h3> <div class="form-group svelte-1tegylr"><label for="story-title" class="svelte-1tegylr">Название истории</label> <input type="text" id="story-title" placeholder="Например: Приключения в замке" class="input svelte-1tegylr"/></div> <div class="form-group svelte-1tegylr"><label for="story-bucket" class="svelte-1tegylr">Bucket для ресурсов</label> <select id="story-bucket" class="input svelte-1tegylr"><option>stories (по умолчанию)</option><option>dracula</option><option>zombie</option><option>fairy_tale</option><option>minigames</option></select> <small class="hint svelte-1tegylr">Выберите bucket в котором будут храниться ресурсы истории</small></div> <div class="modal-actions svelte-1tegylr"><button class="btn svelte-1tegylr">Отмена</button> <button class="btn primary svelte-1tegylr"> </button></div></div></div>'),root$7=from_html('<div class="story-selector svelte-1tegylr"><!></div> <!>',1);function StorySelector$1(r,e){push(e,!0);let t=state(!1),i=state(""),n=state("stories"),o=state(!1);const u={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр",icon:"🎮"}};onMount(async()=>{await loadStories(),getStoriesList()});async function h(R){editor.selectedBucket=R,editor.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},await resourceActions.loadStoriesList(),await resourceActions.loadStoredResources()}async function _(R){editor.manualStorySelected=!0;const P=R.bucket||"stories";editor.selectedBucket=P,editor.currentFileName=R.json_url,await resourceActions.loadStoredResources(),await storyActions.loadStory(editor.currentFileName)}async function v(R){await updateStory(R.id,{is_public:!R.is_public})}async function g(R){confirm(`Удалить историю "${R.title}"?`)&&await deleteStory(R.id)}var m=root$7(),$=first_child(m),p=child($);{var E=R=>{var P=root_1$b(),N=first_child(P),J=sibling(child(N),2);J.__click=[on_click$9,t];var I=sibling(N,2);{var k=L=>{var X=comment(),fe=first_child(X);{var ge=V=>{var G=root_3$a(),q=child(G);each(q,21,getAuthorStories,O=>O.id,(O,z)=>{var ce=root_4$6(),he=child(ce),se=child(he),ve=sibling(he,2),me=child(ve),be=child(me),ue=sibling(me,2);let ie;var oe=child(ue),Q=sibling(ve,2),ae=child(Q);ae.__click=[on_click_1$5,_,z];var H=sibling(ae,2);H.__click=[on_click_2$2,v,z];var W=child(H),Z=sibling(H,2);Z.__click=[on_click_3$1,g,z],template_effect(B=>{set_text(se,get$2(z).preview_image_url?"🖼️":"📖"),set_text(be,get$2(z).title),ie=set_class(ue,1,"story-status svelte-1tegylr",null,ie,B),set_text(oe,get$2(z).is_public?"🌍 Публичная":"🔒 Приватная"),set_text(W,get$2(z).is_public?"Скрыть":"Опубликовать")},[()=>({public:get$2(z).is_public})]),append(O,ce)}),append(V,G)},re=V=>{var G=root_5$c();append(V,G)};if_block(fe,V=>{getAuthorStories().length>0?V(ge):V(re,!1)})}append(L,X)},j=L=>{var X=root_6$7();append(L,X)};if_block(I,L=>{storiesState.initialized?L(k):L(j,!1)})}var F=sibling(I,2),U=sibling(child(F),2);each(U,21,()=>editor.availableBuckets,L=>L.name,(L,X)=>{const fe=user_derived(()=>u[get$2(X).id]||{title:get$2(X).name,description:"История",icon:"📖"});var ge=root_7$7();let re;var V=child(ge),G=child(V),q=sibling(V,2),O=child(q),z=child(O),ce=sibling(O,2),he=child(ce),se=sibling(q,2),ve=child(se);{var me=ue=>{var ie=root_8$5();append(ue,ie)},be=ue=>{var ie=root_9$2();ie.__click=[on_click_4$1,h,X],append(ue,ie)};if_block(ve,ue=>{editor.selectedBucket===get$2(X).name?ue(me):ue(be,!1)})}template_effect(ue=>{re=set_class(ge,1,"story-card svelte-1tegylr",null,re,ue),set_text(G,get$2(fe).icon),set_text(z,get$2(fe).title),set_text(he,get$2(fe).description)},[()=>({selected:editor.selectedBucket===get$2(X).name})]),append(L,ge)}),append(R,P)},T=R=>{var P=root_10$1();append(R,P)};if_block(p,R=>{authDerivedState.isAuthor||authDerivedState.isAdmin?R(E):R(T,!1)})}var x=sibling($,2);{var D=R=>{var P=root_11$1();P.__click=[on_click_5,t];var N=child(P);N.__click=[on_click_6];var J=sibling(child(N),2),I=sibling(child(J),2),k=sibling(J,2),j=sibling(child(k),2),F=child(j);F.value=F.__value="stories";var U=sibling(F);U.value=U.__value="dracula";var L=sibling(U);L.value=L.__value="zombie";var X=sibling(L);X.value=X.__value="fairy_tale";var fe=sibling(X);fe.value=fe.__value="minigames";var ge=sibling(k,2),re=child(ge);re.__click=[on_click_7,t];var V=sibling(re,2);V.__click=[handleCreateStory,i,o,n,t,_];var G=child(V);template_effect(q=>{V.disabled=q,set_text(G,get$2(o)?"Создание...":"Создать")},[()=>get$2(o)||!get$2(i).trim()]),bind_value(I,()=>get$2(i),q=>set(i,q)),bind_select_value(j,()=>get$2(n),q=>set(n,q)),append(R,P)};if_block(x,R=>{get$2(t)&&R(D)})}append(r,m),pop()}delegate(["click"]);var root_3$9=from_html("<span> </span>"),root_4$5=from_html('<div class="debug-info svelte-1o87bfp"><small> </small></div>'),root_5$b=from_html('<div class="debug-info warning svelte-1o87bfp"><small>⚠️ Данные не загружены</small></div>'),root_7$6=from_html('<div class="empty-state svelte-1o87bfp">Выберите сцену</div>'),root_2$8=from_html('<div class="editor-container svelte-1o87bfp"><header class="toolbar svelte-1o87bfp"><div class="logo svelte-1o87bfp"><h2 class="svelte-1o87bfp"> </h2></div> <div class="stories-control svelte-1o87bfp"><span class="story-file-name svelte-1o87bfp"> </span> <!> <button class="btn success small svelte-1o87bfp">💾 Сохранить</button> <button class="btn small svelte-1o87bfp">📋 Копия</button></div></header> <div class="main-workspace svelte-1o87bfp"><!> <main class="editor-area svelte-1o87bfp"><!> <!> <!></main> <!></div> <button class="btn-back-to-game svelte-1o87bfp" title="Выбрать другую историю">📚 Выбрать историю</button></div>');function Editor(r,e){push(e,!0);async function t(_){console.log(`[Editor] Загрузка для bucket: ${_}`);try{const v=resourceActions.loadStoredResources(),g=new Promise((E,T)=>setTimeout(()=>T(new Error("Timeout loading resources")),15e3));await Promise.race([v,g]);const m=`${_}_story.json`;editor.currentFileName=m;const $=storyActions.loadStory(m),p=new Promise((E,T)=>setTimeout(()=>T(new Error("Timeout loading story")),15e3));await Promise.race([$,p]),console.log(`[Editor] История загружена: ${m}`)}catch(v){console.error("[Editor] Ошибка загрузки истории:",v)}}onMount(async()=>{getStoriesList(),editor.availableBuckets.length>0&&!editor.selectedBucket&&(editor.selectedBucket=editor.availableBuckets[0].name,await t(editor.selectedBucket))}),user_effect(()=>{editor.selectedBucket&&!editor.manualStorySelected&&t(editor.selectedBucket)});function i(){editor.manualStorySelected=!1,editor.selectedBucket=null,editor.currentFileName="",editor.data=null}var n=comment(),o=first_child(n);{var u=_=>{StorySelector$1(_,{})},h=_=>{var v=root_2$8(),g=child(v),m=child(g),$=child(m),p=child($),E=sibling(m,2),T=child(E),x=child(T),D=sibling(T,2);{var R=G=>{var q=root_3$9(),O=child(q);template_effect(()=>{set_class(q,1,`status-message ${editor.statusMessage.type??""}`,"svelte-1o87bfp"),set_text(O,editor.statusMessage.text)}),append(G,q)};if_block(D,G=>{editor.statusMessage.text&&G(R)})}var P=sibling(D,2);P.__click=function(...G){storyActions.saveCurrentStory?.apply(this,G)};var N=sibling(P,2);N.__click=function(...G){storyActions.saveStoryCopy?.apply(this,G)};var J=sibling(g,2),I=child(J);EditorSidebar(I,{});var k=sibling(I,2),j=child(k);{var F=G=>{var q=root_4$5(),O=child(q),z=child(O);template_effect(()=>set_text(z,`Загружено: ${editor.data.meta?.title??""} |
              Глав: ${(editor.data.chapters?.length||0)??""} |
              Диалогов: ${(editor.data.dialogues?.length||0)??""} |
              Предметов: ${(editor.data.items?.length||0)??""}`)),append(G,q)},U=G=>{var q=root_5$b();append(G,q)};if_block(j,G=>{editor.data?G(F):G(U,!1)})}var L=sibling(j,2);ItemsManager(L,{});var X=sibling(L,2);{var fe=G=>{DialogueForm(G,{get editor(){return editor},get storyActions(){return storyActions},get resourceActions(){return resourceActions}})},ge=G=>{var q=root_7$6();append(G,q)};if_block(X,G=>{editorDerived.currentDialogue?G(fe):G(ge,!1)})}var re=sibling(k,2);PreviewPanel(re,{});var V=sibling(J,2);V.__click=i,template_effect(()=>{set_text(p,`Story Editor v3.1 - ${editor.selectedBucket??""}`),set_text(x,editor.currentFileName||"Нет файла")}),append(_,v)};if_block(o,_=>{editor.selectedBucket?_(h,!1):_(u)})}append(r,n),pop()}delegate(["click"]);function openAllGames(){window.dispatchEvent(new CustomEvent("open-all-games"))}var root_1$a=from_html('<div class="loading svelte-2tmiof">Загрузка историй...</div>'),root_3$8=from_html('<div class="empty-state svelte-2tmiof"><p class="svelte-2tmiof">Историй пока нет</p> <p class="hint svelte-2tmiof">Создайте свою историю в редакторе!</p></div>'),on_click$8=(r,e,t)=>e(get$2(t)),on_keydown$2=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(get$2(t)))},root_5$a=from_html('<div class="story-card svelte-2tmiof" role="button" tabindex="0"><div class="story-icon svelte-2tmiof"> </div> <div class="story-content svelte-2tmiof"><h3 class="story-title svelte-2tmiof"> </h3> <p class="story-description svelte-2tmiof"> </p></div> <div class="story-arrow svelte-2tmiof">→</div></div>'),root_4$4=from_html('<div class="stories-grid svelte-2tmiof"></div>'),root_2$7=from_html('<div class="selector-header svelte-2tmiof"><h1 class="svelte-2tmiof">🎭 Визуальные новеллы</h1> <p class="svelte-2tmiof">Выберите историю для прохождения</p></div> <button type="button" class="btn-all-games svelte-2tmiof"><span class="games-icon svelte-2tmiof">🎮</span> <span class="games-text svelte-2tmiof">Все мини-игры</span> <span class="games-arrow svelte-2tmiof">→</span></button> <!> <div class="selector-footer svelte-2tmiof"><p class="hint svelte-2tmiof">💡 Совет: Вы можете создать свою историю в редакторе</p></div>',1),root$6=from_html('<div class="story-selector svelte-2tmiof"><!></div>');function StorySelector(r,e){push(e,!0);let t=state(!0),i=state(!1);onMount(async()=>{if(console.log("[StorySelector] Инициализация..."),await gameState.initStories(),console.log("[StorySelector] Истории загружены:",{initialized:storiesState.initialized,count:storiesState.stories.length,available:getPlayerStories().length,urlStoryId:gameState.urlStoryId}),gameState.urlStoryId&&gameState.selectedStoryData&&!get$2(i)){set(i,!0);const g=await loadStoryJson(gameState.selectedStoryData);g&&(gameState.storyData=g,gameState.currentDialogueId=g.dialogues?.[0]?.id||"0",gameState.isLoading=!1)}set(t,!1)});const n={dracula:"🧛",zombie:"🧟",fairy_tale:"🧚",minigames:"🎮"};function o(g){gameState.selectedStory=g.id,gameState.selectedStoryData=g}var u=root$6(),h=child(u);{var _=g=>{var m=root_1$a();append(g,m)},v=g=>{var m=root_2$7(),$=sibling(first_child(m),2);$.__click=[openAllGames];var p=sibling($,2);{var E=x=>{var D=root_3$8();append(x,D)},T=x=>{var D=root_4$4();each(D,21,()=>gameState.availableStories,R=>R.id,(R,P)=>{const N=user_derived(()=>n[get$2(P).title.toLowerCase()]||"📖");var J=root_5$a();J.__click=[on_click$8,o,P],J.__keydown=[on_keydown$2,o,P];var I=child(J),k=child(I),j=sibling(I,2),F=child(j),U=child(F),L=sibling(F,2),X=child(L);template_effect(()=>{set_text(k,get$2(N)),set_text(U,get$2(P).title),set_text(X,get$2(P).preview_image_url?"Нажмите для начала":"Интерактивная история")}),append(R,J)}),append(x,D)};if_block(p,x=>{gameState.availableStories.length===0?x(E):x(T,!1)})}append(g,m)};if_block(h,g=>{get$2(t)?g(_):g(v,!1)})}append(r,u),pop()}delegate(["click","keydown"]);var root_1$9=from_html('<span class="inventory-badge svelte-166jaas"> </span>'),on_keydown$1=(r,e)=>r.key==="Escape"&&e(),on_click$7=r=>r.stopPropagation(),on_keydown_1$1=r=>r.stopPropagation(),on_click_1$4=(r,e,t)=>e(get$2(t)),root_4$3=from_html('<button type="button" class="item-card svelte-166jaas"><div class="item-icon svelte-166jaas"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-166jaas"><span class="item-name svelte-166jaas"> </span> <span class="item-type svelte-166jaas"> </span></div></button>'),root_3$7=from_html('<div class="items-grid svelte-166jaas"></div>'),root_5$9=from_html('<div class="empty-inventory svelte-166jaas"><span class="empty-icon svelte-166jaas">🎒</span> <p class="svelte-166jaas">Инвентарь пуст</p> <p class="empty-hint svelte-166jaas">Получайте предметы в ходе игры</p></div>'),root_2$6=from_html('<div class="inventory-overlay svelte-166jaas" role="dialog" tabindex="-1"><div class="inventory-modal svelte-166jaas" role="dialog" aria-label="Окно инвентаря" tabindex="-1"><div class="inventory-header svelte-166jaas"><h2 class="svelte-166jaas">Инвентарь</h2> <button class="close-button svelte-166jaas">✕</button></div> <div class="stats-section svelte-166jaas"><h3 class="svelte-166jaas">Характеристики</h3> <div class="stats-grid svelte-166jaas"><div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">📚</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Знания</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">💪</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Смелость</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">✨</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Харизма</span> <span class="stat-value svelte-166jaas"> </span></div></div></div></div> <div class="items-section svelte-166jaas"><h3 class="svelte-166jaas"> </h3> <!></div></div></div>'),root$5=from_html('<div class="inventory-wrapper svelte-166jaas"><button class="inventory-button svelte-166jaas">🎒 <!></button> <!></div>');function Inventory(r,e){push(e,!0);let t=state(!1);const i=user_derived(()=>gameState.getInventoryItems()),n=user_derived(()=>gameState.player.stats);function o(){set(t,!get$2(t))}function u(p){console.log("Выбран предмет:",p.name)}var h=root$5(),_=child(h);_.__click=o;var v=sibling(child(_));{var g=p=>{var E=root_1$9(),T=child(E);template_effect(()=>set_text(T,get$2(i).length)),append(p,E)};if_block(v,p=>{get$2(i).length>0&&p(g)})}var m=sibling(_,2);{var $=p=>{var E=root_2$6();E.__click=o,E.__keydown=[on_keydown$1,o];var T=child(E);T.__click=[on_click$7],T.__keydown=[on_keydown_1$1];var x=child(T),D=sibling(child(x),2);D.__click=o;var R=sibling(x,2),P=sibling(child(R),2),N=child(P),J=sibling(child(N),2),I=sibling(child(J),2),k=child(I),j=sibling(N,2),F=sibling(child(j),2),U=sibling(child(F),2),L=child(U),X=sibling(j,2),fe=sibling(child(X),2),ge=sibling(child(fe),2),re=child(ge),V=sibling(R,2),G=child(V),q=child(G),O=sibling(G,2);{var z=he=>{var se=root_3$7();each(se,21,()=>get$2(i),ve=>ve.id,(ve,me)=>{var be=root_4$3();be.__click=[on_click_1$4,u,me];var ue=child(be),ie=child(ue),oe=sibling(ue,2),Q=child(oe),ae=child(Q),H=sibling(Q,2),W=child(H);template_effect(()=>{set_attribute(be,"aria-label",`Предмет: ${get$2(me).name}`),set_attribute(ie,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${gameState.selectedStory}/${get$2(me).icon}`),set_attribute(ie,"alt",get$2(me).icon),set_text(ae,get$2(me).name),set_text(W,get$2(me).type)}),append(ve,be)}),append(he,se)},ce=he=>{var se=root_5$9();append(he,se)};if_block(O,he=>{get$2(i).length>0?he(z):he(ce,!1)})}template_effect(()=>{set_text(k,get$2(n).knowledge),set_text(L,get$2(n).courage),set_text(re,get$2(n).charisma),set_text(q,`Предметы (${get$2(i).length??""})`)}),append(p,E)};if_block(m,p=>{get$2(t)&&p($)})}template_effect(()=>set_attribute(_,"title",`Инвентарь (${get$2(i).length??""})`)),append(r,h),pop()}delegate(["click","keydown"]);function openEditor(r,e){if(!get$2(e)){alert("Редактирование недоступно без интернета");return}editorActions.toggleEditor()}var root_3$6=from_html('<div class="loading svelte-1r563ib"><p>🔄 Загрузка истории...</p></div>'),root_5$8=from_html('<div class="error svelte-1r563ib"> <button class="btn-back svelte-1r563ib">← Вернуться к выбору</button></div>'),root_7$5=from_html('<button class="btn-edit desktop-only svelte-1r563ib" title="Редактор историй">✏️ Редактор</button>'),root_6$6=from_html('<div class="game-container svelte-1r563ib"><!> <button class="btn-change-story svelte-1r563ib" title="Сменить историю">📚</button> <!> <div class="dialogues-container svelte-1r563ib"><!></div></div>'),root$4=from_html('<div class="app svelte-1r563ib"><!></div>');function Main(r,e){push(e,!0);let t=state(!0),i=state(!1);onMount(async()=>{set(t,navigator.onLine,!0);const v=()=>{set(t,!0)},g=()=>{set(t,!1)};return window.addEventListener("online",v),window.addEventListener("offline",g),await gameState.initStories(),set(i,!0),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",g)}}),user_effect(async()=>{if(get$2(i)&&gameState.selectedStory&&gameState.selectedStoryData){const v=gameState.selectedStoryData;if(!v||!v.id){console.warn("[Main] История не выбрана или некорректна");return}console.log("[Main] Загрузка истории:",v?.title||v.id),await userKeyStore.trackStoryStart(v.id,v.title||v.id);const g=await loadStoryJson(v);g?(gameState.storyData=g,gameState.currentDialogueId=g.dialogues?.[0]?.id||"0",gameState.isLoading=!1,console.log("[Main] История загружена, диалогов:",g.dialogues?.length)):(gameState.error="Не удалось загрузить историю",gameState.isLoading=!1)}});let n=null;user_effect(()=>{if(n&&!gameState.selectedStory&&gameState.storyData){const v=gameState.storyData.dialogues?.length||0;userKeyStore.trackStoryComplete(n,gameState.selectedStoryData?.title||n,v),n=null}else gameState.selectedStory&&(n=gameState.selectedStory)});var o=root$4(),u=child(o);{var h=v=>{StorySelector(v,{})},_=v=>{var g=comment(),m=first_child(g);{var $=E=>{var T=root_3$6();append(E,T)},p=E=>{var T=comment(),x=first_child(T);{var D=P=>{var N=root_5$8(),J=child(N),I=sibling(J);I.__click=()=>gameState.selectedStory=null,template_effect(()=>set_text(J,`⚠️ ${gameState.error??""} `)),append(P,N)},R=P=>{var N=root_6$6(),J=child(N);Inventory(J,{});var I=sibling(J,2);I.__click=()=>{gameState.selectedStory=null,gameState.selectedStoryData=null,gameState.storyData=null};var k=sibling(I,2);{var j=X=>{var fe=root_7$5();fe.__click=[openEditor,t],append(X,fe)};if_block(k,X=>{authState.user&&get$2(t)&&X(j)})}var F=sibling(k,2),U=child(F);{var L=X=>{{let fe=user_derived(()=>gameState.selectedStoryData?.bucket||"stories");DialogueCard(X,{get bucketName(){return get$2(fe)}})}};if_block(U,X=>{gameState.storyData&&X(L)})}append(P,N)};if_block(x,P=>{gameState.error?P(D):P(R,!1)},!0)}append(E,T)};if_block(m,E=>{gameState.isLoading?E($):E(p,!1)},!0)}append(v,g)};if_block(u,v=>{gameState.selectedStory?v(_,!1):v(h)})}append(r,o),pop()}delegate(["click"]);var on_keydown=(r,e)=>r.key==="Escape"&&e.onClose?.(),on_click$6=r=>r.stopPropagation(),on_keydown_1=r=>r.stopPropagation(),root_5$7=from_html('<div class="alert error svelte-961h07"><strong>⚠️</strong> </div>'),root_6$5=from_html('<div class="alert success svelte-961h07"><strong>✅</strong> </div>'),root_7$4=from_html('<div class="form-group svelte-961h07"><label for="username" class="svelte-961h07">Имя пользователя</label> <input type="text" id="username" placeholder="Придумайте имя" required class="svelte-961h07"/></div>'),on_input=(r,e,t)=>e(get$2(t)),root_8$4=from_html('<span class="field-error svelte-961h07"> </span>'),on_input_1=(r,e,t)=>e(get$2(t)),root_10=from_html('<span class="field-error svelte-961h07"> </span>'),root_11=from_html('<small class="hint svelte-961h07">Минимум 6 символов</small>'),root_9$1=from_html('<div class="form-group svelte-961h07"><label for="password" class="svelte-961h07">Пароль</label> <input type="password" id="password" placeholder="Введите пароль" required minlength="6"/> <!> <!></div>'),on_click_1$3=(r,e)=>e("reset"),on_click_2$1=(r,e)=>e("register"),root_18=from_html('<button type="button" class="link-btn svelte-961h07">Забыли пароль?</button> <button type="button" class="link-btn svelte-961h07">Нет аккаунта? Регистрация</button>',1),on_click_3=(r,e)=>e("login"),root_20=from_html('<button type="button" class="link-btn svelte-961h07">Уже есть аккаунт? Войти</button>'),on_click_4=(r,e)=>e("login"),root_21=from_html('<button type="button" class="link-btn svelte-961h07">Вспомнили пароль? Войти</button>'),root_22=from_html('<div class="debug-info svelte-961h07"><details><summary class="svelte-961h07">🔧 Отладка</summary> <p> </p> <p> </p> <p>Статус: Попробуйте:</p> <ul class="svelte-961h07"><li>Проверить подтвержден ли email в Supabase Dashboard</li> <li>Сбросить пароль через "Забыли пароль?"</li> <li>Проверить консоль браузера (F12)</li></ul></details></div>'),root$3=from_html('<div class="auth-modal-overlay svelte-961h07" role="dialog" aria-modal="true" tabindex="-1"><div class="auth-modal svelte-961h07" role="document"><button class="close-btn svelte-961h07" aria-label="Закрыть">×</button> <h2 class="svelte-961h07"><!></h2> <!> <!> <form><!> <div class="form-group svelte-961h07"><label for="email" class="svelte-961h07">Email</label> <input type="email" id="email" placeholder="your@email.com" required/> <!></div> <!> <button type="submit" class="btn-primary svelte-961h07"><!></button></form> <div class="auth-links svelte-961h07"><!></div> <!></div></div>');function AuthModal(r,e){push(e,!0);let t=prop(e,"initialMode",3,"login"),i=state(proxy(t())),n=state(""),o=state(""),u=state(""),h=state(""),_=state(""),v=state(!1),g=state(""),m=state("");function $(B){set(i,B,!0),set(h,""),set(_,""),set(g,""),set(m,"")}function p(B){const ne=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(B);return set(g,ne?"":"Введите корректный email",!0),ne}function E(B){const te=B.length>=6;return set(m,te?"":"Пароль должен быть не менее 6 символов",!0),te}async function T(){if(!(!p(get$2(n))||!E(get$2(o)))){set(h,""),set(_,""),set(v,!0);try{const B=await signIn(get$2(n),get$2(o));B.success?e.onClose?.():(set(h,B.error||"Ошибка входа",!0),get$2(h).includes("подтвержден")&&setTimeout(()=>{confirm("Отправить письмо с подтверждением повторно?")&&x()},100))}finally{set(v,!1)}}}async function x(){set(v,!0);try{const{error:B}=await supabase.auth.resend({type:"signup",email:get$2(n)});B?set(h,"Ошибка при отправке: "+B.message):set(_,"Письмо с подтверждением отправлено повторно!")}catch(B){set(h,B.message,!0)}finally{set(v,!1)}}async function D(){if(!(!p(get$2(n))||!E(get$2(o)))){if(!get$2(u).trim()){set(h,"Введите имя пользователя");return}set(h,""),set(_,""),set(v,!0);try{const B=await signUp(get$2(n),get$2(o),get$2(u));B.success?B.needsEmailConfirmation?set(_,"✅ Регистрация почти завершена! Проверьте почту и подтвердите email."):(set(_,"Регистрация успешна!"),setTimeout(()=>e.onClose?.(),2e3)):set(h,B.error||"Ошибка регистрации",!0)}finally{set(v,!1)}}}async function R(){if(p(get$2(n))){set(h,""),set(_,""),set(v,!0);try{const B=await resetPassword(get$2(n));B.success?set(_,"📧 Инструкции по сбросу пароля отправлены на почту!"):set(h,B.error||"Ошибка сброса пароля",!0)}finally{set(v,!1)}}}async function P(){get$2(i)==="login"?await T():get$2(i)==="register"?await D():get$2(i)==="reset"&&await R()}var N=root$3();N.__click=function(...B){e.onClose?.apply(this,B)},N.__keydown=[on_keydown,e];var J=child(N);J.__click=[on_click$6],J.__keydown=[on_keydown_1];var I=child(J);I.__click=function(...B){e.onClose?.apply(this,B)};var k=sibling(I,2),j=child(k);{var F=B=>{var te=text("Вход");append(B,te)},U=B=>{var te=comment(),ne=first_child(te);{var ye=Ee=>{var $e=text("Регистрация");append(Ee,$e)},we=Ee=>{var $e=text("Сброс пароля");append(Ee,$e)};if_block(ne,Ee=>{get$2(i)==="register"?Ee(ye):Ee(we,!1)},!0)}append(B,te)};if_block(j,B=>{get$2(i)==="login"?B(F):B(U,!1)})}var L=sibling(k,2);{var X=B=>{var te=root_5$7(),ne=sibling(child(te));template_effect(()=>set_text(ne,` ${get$2(h)??""}`)),append(B,te)};if_block(L,B=>{get$2(h)&&B(X)})}var fe=sibling(L,2);{var ge=B=>{var te=root_6$5(),ne=sibling(child(te));template_effect(()=>set_text(ne,` ${get$2(_)??""}`)),append(B,te)};if_block(fe,B=>{get$2(_)&&B(ge)})}var re=sibling(fe,2),V=child(re);{var G=B=>{var te=root_7$4(),ne=sibling(child(te),2);template_effect(()=>ne.disabled=get$2(v)),bind_value(ne,()=>get$2(u),ye=>set(u,ye)),append(B,te)};if_block(V,B=>{get$2(i)==="register"&&B(G)})}var q=sibling(V,2),O=sibling(child(q),2);O.__input=[on_input,p,n];let z;var ce=sibling(O,2);{var he=B=>{var te=root_8$4(),ne=child(te);template_effect(()=>set_text(ne,get$2(g))),append(B,te)};if_block(ce,B=>{get$2(g)&&B(he)})}var se=sibling(q,2);{var ve=B=>{var te=root_9$1(),ne=sibling(child(te),2);ne.__input=[on_input_1,E,o];let ye;var we=sibling(ne,2);{var Ee=Le=>{var w=root_10(),c=child(w);template_effect(()=>set_text(c,get$2(m))),append(Le,w)};if_block(we,Le=>{get$2(m)&&Le(Ee)})}var $e=sibling(we,2);{var Ce=Le=>{var w=root_11();append(Le,w)};if_block($e,Le=>{get$2(i)==="register"&&Le(Ce)})}template_effect(Le=>{ne.disabled=get$2(v),ye=set_class(ne,1,"svelte-961h07",null,ye,Le)},[()=>({error:get$2(m)})]),bind_value(ne,()=>get$2(o),Le=>set(o,Le)),append(B,te)};if_block(se,B=>{get$2(i)!=="reset"&&B(ve)})}var me=sibling(se,2),be=child(me);{var ue=B=>{var te=text("Загрузка...");append(B,te)},ie=B=>{var te=comment(),ne=first_child(te);{var ye=Ee=>{var $e=text("Войти");append(Ee,$e)},we=Ee=>{var $e=comment(),Ce=first_child($e);{var Le=c=>{var d=text("Зарегистрироваться");append(c,d)},w=c=>{var d=text("Отправить");append(c,d)};if_block(Ce,c=>{get$2(i)==="register"?c(Le):c(w,!1)},!0)}append(Ee,$e)};if_block(ne,Ee=>{get$2(i)==="login"?Ee(ye):Ee(we,!1)},!0)}append(B,te)};if_block(be,B=>{get$2(v)?B(ue):B(ie,!1)})}var oe=sibling(re,2),Q=child(oe);{var ae=B=>{var te=root_18(),ne=first_child(te);ne.__click=[on_click_1$3,$];var ye=sibling(ne,2);ye.__click=[on_click_2$1,$],template_effect(()=>{ne.disabled=get$2(v),ye.disabled=get$2(v)}),append(B,te)},H=B=>{var te=comment(),ne=first_child(te);{var ye=Ee=>{var $e=root_20();$e.__click=[on_click_3,$],template_effect(()=>$e.disabled=get$2(v)),append(Ee,$e)},we=Ee=>{var $e=root_21();$e.__click=[on_click_4,$],template_effect(()=>$e.disabled=get$2(v)),append(Ee,$e)};if_block(ne,Ee=>{get$2(i)==="register"?Ee(ye):Ee(we,!1)},!0)}append(B,te)};if_block(Q,B=>{get$2(i)==="login"?B(ae):B(H,!1)})}var W=sibling(oe,2);{var Z=B=>{var te=root_22(),ne=child(te),ye=sibling(child(ne),2),we=child(ye),Ee=sibling(ye,2),$e=child(Ee);template_effect(()=>{set_text(we,`Email: ${get$2(n)??""}`),set_text($e,`Длина пароля: ${get$2(o).length??""}`)}),append(B,te)};if_block(W,B=>{get$2(i)==="login"&&get$2(h)&&B(Z)})}template_effect(B=>{O.disabled=get$2(v),z=set_class(O,1,"svelte-961h07",null,z,B),me.disabled=get$2(v)||get$2(i)==="login"&&(!get$2(n)||!get$2(o))||get$2(i)==="register"&&(!get$2(n)||!get$2(o)||!get$2(u))||get$2(i)==="reset"&&!get$2(n)},[()=>({error:get$2(g)})]),event("submit",re,B=>{B.preventDefault(),P()}),bind_value(O,()=>get$2(n),B=>set(n,B)),append(r,N),pop()}delegate(["click","keydown","input"]);var root_2$5=from_html('<span class="author-badge svelte-18xh1i2">Автор</span>'),root_1$8=from_html('<div class="user-info svelte-18xh1i2"><span class="user-email svelte-18xh1i2"> </span> <!> <button>Выйти</button></div>'),on_click$5=(r,e)=>set(e,!0),root_3$5=from_html("<button>Войти</button>"),root$2=from_html('<div class="user-menu svelte-18xh1i2"><!> <!></div>');function UserMenu(r,e){push(e,!0);let t=state(!1);var i=root$2(),n=child(i);{var o=v=>{var g=root_1$8(),m=child(g),$=child(m),p=sibling(m,2);{var E=x=>{var D=root_2$5();append(x,D)};if_block(p,x=>{authDerivedState.isAuthor&&x(E)})}var T=sibling(p,2);T.__click=function(...x){signOut?.apply(this,x)},template_effect(()=>set_text($,authState.user?.email)),append(v,g)},u=v=>{var g=root_3$5();g.__click=[on_click$5,t],append(v,g)};if_block(n,v=>{authDerivedState.isAuthenticated?v(o):v(u,!1)})}var h=sibling(n,2);{var _=v=>{AuthModal(v,{onClose:()=>set(t,!1)})};if_block(h,v=>{get$2(t)&&v(_)})}append(r,i),pop()}delegate(["click"]);var root_1$7=from_html('<div class="success-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">✅</span> <p class="svelte-1kxwu1f"> </p> <p class="redirect svelte-1kxwu1f">Перенаправление...</p></div>'),root_3$4=from_html('<div class="error-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">⚠️</span> <p> </p> <p class="hint svelte-1kxwu1f">Срок действия ссылки истёк. Запросите новую ссылку для сброса пароля.</p> <button class="btn secondary svelte-1kxwu1f">Вернуться</button></div>'),root_6$4=from_html('<div class="error-message svelte-1kxwu1f"> </div>'),root_7$3=from_html('<div class="success-message-small svelte-1kxwu1f"> </div>'),root_5$6=from_html('<p class="description svelte-1kxwu1f">Для сброса пароля введите ваш email. Мы отправим вам ссылку для создания нового пароля.</p> <!> <!> <form><div class="form-group svelte-1kxwu1f"><label for="reset-email" class="svelte-1kxwu1f">Ваш email</label> <input type="email" id="reset-email" placeholder="your@email.com" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form> <div class="links"><button class="btn-link svelte-1kxwu1f">← На главную</button></div>',1),root_9=from_html('<div class="error-message svelte-1kxwu1f"> </div>'),root_8$3=from_html('<p class="description svelte-1kxwu1f">Введите новый пароль для вашего аккаунта.</p> <!> <form><div class="form-group svelte-1kxwu1f"><label for="new-password" class="svelte-1kxwu1f">Новый пароль</label> <input type="password" id="new-password" placeholder="Минимум 6 символов" minlength="6" required class="svelte-1kxwu1f"/></div> <div class="form-group svelte-1kxwu1f"><label for="confirm-password" class="svelte-1kxwu1f">Подтвердите пароль</label> <input type="password" id="confirm-password" placeholder="Повторите пароль" minlength="6" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form>',1),root$1=from_html('<div class="reset-password-overlay svelte-1kxwu1f"><div class="reset-card svelte-1kxwu1f"><button class="close-btn svelte-1kxwu1f" aria-label="Закрыть">×</button> <h1 class="svelte-1kxwu1f">🔐 Сброс пароля</h1> <!></div></div>');function ResetPasswordPage(r,e){push(e,!0);let t=prop(e,"initialError",3,""),i=prop(e,"initialToken",3,""),n=state(""),o=state(""),u=state(""),h=state(!1),_=state(""),v=state(proxy(t())),g=state(!1),m=state(!1),$=state(!1);async function p(){if(get$2($))return!0;try{console.log("[ResetPassword] Setting session from token");const{data:{session:I},error:k}=await supabase.auth.getSession();if(k)return console.error("[ResetPassword] Session error:",k),!1;if(I)return console.log("[ResetPassword] Session already exists"),set($,!0),!0;if(i()){console.log("[ResetPassword] Token provided, waiting for session..."),await new Promise(F=>setTimeout(F,1e3));const{data:{session:j}}=await supabase.auth.getSession();if(j)return set($,!0),!0}return!1}catch(I){return console.error("[ResetPassword] Error setting session:",I),!1}}onMount(async()=>{if(console.log("[ResetPassword] Mounted with:",{hasToken:!!i(),hasError:!!t(),path:window.location.pathname,hash:window.location.hash,search:window.location.search}),i()||window.location.pathname==="/reset-password"){const I=await p();set(m,I,!0),!I&&!t()&&set(v,"Ссылка для сброса пароля недействительна или истекла. Запросите новую.")}else t()&&(set(m,!1),set(v,t()))});async function E(){if(get$2(u)){set(h,!0),set(v,""),set(_,""),console.log("[ResetPassword] Sending reset to:",get$2(u));try{const{data:I,error:k}=await supabase.auth.resetPasswordForEmail(get$2(u),{redirectTo:`${window.location.origin}/reset-password`});console.log("[ResetPassword] Response:",{data:I,error:k}),k?k.message?.toLowerCase().includes("rate limit")||k.message?.toLowerCase().includes("too many")?set(v,"Лимит отправки писем исчерпан. Пожалуйста, подождите час."):k.message?.includes("User not found")?set(v,"Пользователь с таким email не найден"):set(v,k.message,!0):set(_,"Ссылка для сброса пароля отправлена! Проверьте почту (и папку спам).")}catch(I){console.error("[ResetPassword] Exception:",I),set(v,I.message||"Ошибка отправки",!0)}set(h,!1)}}async function T(){if(set(v,""),set(_,""),get$2(n).length<6){set(v,"Пароль должен быть не менее 6 символов");return}if(get$2(n)!==get$2(o)){set(v,"Пароли не совпадают");return}set(h,!0);try{if(!await p()){set(v,"Сессия не найдена. Пожалуйста, запросите новую ссылку для сброса пароля.");return}const{error:k}=await supabase.auth.updateUser({password:get$2(n)});k?(console.error("[ResetPassword] Update error:",k),set(v,k.message,!0)):(set(g,!0),set(_,"Пароль успешно изменён!"),setTimeout(()=>{window.location.hash="",e.onClose?.()},3e3))}catch(I){console.error("[ResetPassword] Exception:",I),set(v,I.message||"Ошибка при сбросе пароля",!0)}finally{set(h,!1)}}var x=root$1(),D=child(x),R=child(D);R.__click=function(...I){e.onClose?.apply(this,I)};var P=sibling(R,4);{var N=I=>{var k=root_1$7(),j=sibling(child(k),2),F=child(j);template_effect(()=>set_text(F,get$2(_))),append(I,k)},J=I=>{var k=comment(),j=first_child(k);{var F=L=>{var X=root_3$4(),fe=sibling(child(X),2),ge=child(fe),re=sibling(fe,4);re.__click=function(...V){e.onClose?.apply(this,V)},template_effect(()=>set_text(ge,get$2(v))),append(L,X)},U=L=>{var X=comment(),fe=first_child(X);{var ge=V=>{var G=root_5$6(),q=sibling(first_child(G),2);{var O=oe=>{var Q=root_6$4(),ae=child(Q);template_effect(()=>set_text(ae,get$2(v))),append(oe,Q)};if_block(q,oe=>{get$2(v)&&oe(O)})}var z=sibling(q,2);{var ce=oe=>{var Q=root_7$3(),ae=child(Q);template_effect(()=>set_text(ae,get$2(_))),append(oe,Q)};if_block(z,oe=>{get$2(_)&&oe(ce)})}var he=sibling(z,2),se=child(he),ve=sibling(child(se),2),me=sibling(se,2),be=child(me),ue=sibling(he,2),ie=child(ue);ie.__click=function(...oe){e.onClose?.apply(this,oe)},template_effect(()=>{me.disabled=get$2(h)||!get$2(u),set_text(be,get$2(h)?"Отправка...":"Отправить ссылку")}),event("submit",he,oe=>{oe.preventDefault(),E()}),bind_value(ve,()=>get$2(u),oe=>set(u,oe)),append(V,G)},re=V=>{var G=root_8$3(),q=sibling(first_child(G),2);{var O=ue=>{var ie=root_9(),oe=child(ie);template_effect(()=>set_text(oe,get$2(v))),append(ue,ie)};if_block(q,ue=>{get$2(v)&&ue(O)})}var z=sibling(q,2),ce=child(z),he=sibling(child(ce),2),se=sibling(ce,2),ve=sibling(child(se),2),me=sibling(se,2),be=child(me);template_effect(()=>{me.disabled=get$2(h)||!get$2(m),set_text(be,get$2(h)?"Сохранение...":"Сохранить новый пароль")}),event("submit",z,ue=>{ue.preventDefault(),T()}),bind_value(he,()=>get$2(n),ue=>set(n,ue)),bind_value(ve,()=>get$2(o),ue=>set(o,ue)),append(V,G)};if_block(fe,V=>{get$2(m)?V(re,!1):V(ge)},!0)}append(L,X)};if_block(j,L=>{!get$2(m)&&get$2(v)?L(F):L(U,!1)},!0)}append(I,k)};if_block(P,I=>{get$2(g)?I(N):I(J,!1)})}append(r,x),pop()}delegate(["click"]);const gamesList=[{id:"memo-monsters",name:"Память монстров",description:"Найди все пары одинаковых монстров",icon:"👾",filename:"MemoMonsters.svelte",category:"memory"},{id:"onet-monsters",name:"Связь монстров min",description:"Соедини одинаковых монстров линией",icon:"🔗",filename:"OnetMonsters.svelte",category:"puzzle"},{id:"onet-monsters-144",name:"Связь монстров middle",description:"Соедини одинаковых монстров линией (144 плитки)",icon:"🔗",filename:"OnetMonsters144.svelte",category:"puzzle"},{id:"evolution-2048",name:"Эволюция 2048",description:"Объединяй плитки и достигни 2048",icon:"🎲",filename:"Evolution2048.svelte",category:"puzzle"},{id:"whisper-of-spiders",name:"Шёпот пауков",description:"Реши математические примеры за 30 секунд",icon:"🕷️",filename:"WhisperOfSpiders.svelte",category:"arcade"},{id:"tower-of-souls",name:"Башня душ",description:"Классический пасьянс - собери карты по мастям",icon:"🃏",filename:"TowerOfSouls.svelte",category:"board"},{id:"soul-cycle",name:"Цикл душ",description:"Повторяй последовательность символов",icon:"🔥",filename:"SoulCycle.svelte",category:"memory"},{id:"labyrinth-of-minotaur",name:"Лабиринт Минотавра",description:"Найди выход из лабиринта",icon:"🌀",filename:"LabyrinthOfMinotaur.svelte",category:"puzzle"},{id:"cursed-crypts",name:"Проклятые склепы",description:"Сапёр - найди все безопасные ячейки",icon:"💀",filename:"CursedCrypts.svelte",category:"puzzle"},{id:"broken-mirror",name:"Разбитое зеркало",description:"Собери числа от 1 до 15",icon:"🪞",filename:"BrokenMirror.svelte",category:"puzzle"},{id:"alchemists-cross",name:"Алхимический крестик",description:"Крестики-нолики - первым выстрой 3 в ряд",icon:"🧪",filename:"AlchemistsCross.svelte",category:"board"},{id:"light-out",name:"Погаси свет",description:"Погаси все клетки на поле",icon:"💡",filename:"LightOut.svelte",category:"logic"},{id:"flood-it",name:"Затопи поле",description:"Заливай поле одним цветом за минимальное количество ходов",icon:"🌊",filename:"FloodIt.svelte",category:"logic"},{id:"bones-421",name:"Кости 4-2-1",description:"Брось кости и набери комбинацию 4-2-1",icon:"🎴",filename:"Bones421.svelte",category:"board"},{id:"crystals-of-time",name:"Кристаллы времени",description:"Повтори последовательность кристаллов",icon:"💎",filename:"CrystalsOfTime.svelte",category:"memory"},{id:"runes-of-fate",name:"Руны судьбы",description:"Победи духа в поединке рун",icon:"🔮",filename:"RunesOfFate.svelte",category:"board"},{id:"witches-cauldrons",name:"Котёл ведьмы",description:"Собери ингредиенты для зелья",icon:"🧙",filename:"WitchesCauldrons.svelte",category:"arcade"},{id:"alchemical-calculator",name:"Алхимический калькулятор",description:"Получи целевое число используя все числа",icon:"⚗️",filename:"AlchemicalCalculator.svelte",category:"logic"}],categoryNames={puzzle:"Головоломки",memory:"Память",logic:"Логика",arcade:"Аркады",board:"Настольные",other:"Другие"};var root_3$3=from_html('<div role="button" tabindex="0"> </div>'),root_5$5=from_svg('<polyline class="connection-line svelte-1nbr0u5" vector-effect="non-scaling-stroke"></polyline>'),on_click$4=(r,e)=>e("auto"),on_click_1$2=(r,e)=>e("16x9"),on_click_2=(r,e)=>e("16x16"),root_7$2=from_html('<span class="cooldown-timer svelte-1nbr0u5"> </span>'),root_6$3=from_html('<div class="footer-stats svelte-1nbr0u5"><div class="size-selector svelte-1nbr0u5"><button title="Авто (по ориентации экрана)">Авто</button> <button title="16x9">16×9</button> <button title="16x16">16×16</button></div> <span class="tiles-counter svelte-1nbr0u5">Осталось: <strong class="svelte-1nbr0u5"> </strong></span> <button>💡 <!></button></div>'),root_1$6=from_html('<!> <div id="game-container" class="svelte-1nbr0u5"><div id="grid" class="svelte-1nbr0u5"></div> <svg id="line-layer" class="svelte-1nbr0u5"><!></svg></div> <!> <!>',1);function OnetMonsters144(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=5,h=1e3;let _=state("auto"),v=state(!0);function g(){typeof window<"u"&&set(v,window.innerWidth>window.innerHeight)}const m=user_derived(()=>get$2(_)==="16x9"?9:get$2(_)==="16x16"?16:get$2(v)?9:16),$=user_derived(()=>get$2(_)==="16x9"||get$2(_)==="16x16"||get$2(v)?16:9),p=["🧛","🧛‍♀️","🧛‍♂️","🧟","🧟‍♀️","🧟‍♂️","👻","💀","☠️","👹","👺","👻","👽","👾","🤖","🦇","🐉","🦄","🦕","🦖","🐺","🐗","🦊","🦝","🦁","🐯","🐆","🐆","🦓","🦍","🐘","🦏","🦛","🐙","🦑","🐡","🐠","🐟","🐬","🐳","🕷️","🕸️","🦂","🐝","🧠","🐞","🦗","🦟","💔","🐜","🔮","🧪","⚗️","🧿","🕯️","🗝️","🗡️","⚔️","🛡️","🏺","📜","⚰️","⚱️","🪦","🧬","🔥","🌊","🌪️","🌩️","❄️","🌙","🌛","🌜","☀️","🍑","⭐","🌟","💫","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","☿","♀","♁","♂","♃","♄","♅","⛢","♆","♇","⚳","⚴","⚵","⚶","⚷","⚸","☀","🌞","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","☄","☊","☋","☌","☍","☉","☽","☾","☼","🚀","🛰","🌌","🪐","📡","🔭","👾","👽"];let E=state(proxy([])),T=state(proxy([])),x=state(proxy({})),D=state(proxy([])),R=state(null),P=state(!1),N=state(!1),J=state(""),I=state(0),k=state(0),j=state(proxy({show:!1,title:"",text:"",actions:[]})),F,U;onMount(()=>(g(),window.addEventListener("resize",g),window.addEventListener("orientationchange",g),V(),()=>{window.removeEventListener("resize",g),window.removeEventListener("orientationchange",g)}));function L(){if(!get$2(T)||get$2(T).length===0)return 0;let H=0;const W=get$2(m),Z=get$2($);for(let B=0;B<W;B++)for(let te=0;te<Z;te++)get$2(T)[B]&&!get$2(T)[B][te]&&H++;return H}let X=user_derived(L),fe=user_derived(()=>get$2(k)<1),ge=state(!0);user_effect(()=>{get$2(_)==="auto"&&get$2(ge)!==get$2(v)&&get$2(E).length>0&&V(),set(ge,get$2(v),!0)});function re(H){set(_,H,!0),V()}function V(){set(E,[],!0),set(T,[],!0),set(R,null),set(P,!1),set(N,!1),set(x,{},!0),set(D,[],!0),set(J,""),set(k,0),oe();const H=get$2(m),W=get$2($),Z=H*W;let B=[...new Set(p)];for(;B.length<Z/2;)B=[...B,...B];let te=B.sort(()=>.5-Math.random()).slice(0,Z/2),ne=[];te.forEach(we=>ne.push(we,we)),ne.sort(()=>Math.random()-.5);let ye=0;for(let we=0;we<H;we++){let Ee=[],$e=[];for(let Ce=0;Ce<W;Ce++)Ee.push(ne[ye++]),$e.push(!1);get$2(E).push(Ee),get$2(T).push($e)}setTimeout(ce,500)}async function G(H,W){if(get$2(P)||get$2(T)[H][W]||get$2(N))return;if(get$2(D).length>0&&set(D,[],!0),!get$2(R)){set(R,{r:H,c:W},!0);return}if(get$2(R).r===H&&get$2(R).c===W){set(R,null);return}const Z=get$2(E)[get$2(R).r][get$2(R).c],B=get$2(E)[H][W];if(Z===B){const te=be(get$2(R).r,get$2(R).c,H,W);if(te){set(P,!0),await ue(te),get$2(T)[get$2(R).r][get$2(R).c]=!0,get$2(T)[H][W]=!0,set(R,null),set(P,!1),O(),ce();return}}set(R,{r:H,c:W},!0)}async function q(H,W,Z){(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),await G(H,W))}function O(){set(k,u);const H=setInterval(()=>{update(k,-1),get$2(k)<=0&&clearInterval(H)},1e3)}function z(){if(get$2(P)||get$2(N)||!get$2(fe))return;const H=get$2(m),W=get$2($);let Z=[];for(let te=0;te<H;te++)for(let ne=0;ne<W;ne++)get$2(T)[te][ne]||Z.push({r:te,c:ne,icon:get$2(E)[te][ne]});let B={};Z.forEach(te=>{B[te.icon]||(B[te.icon]=[]),B[te.icon].push(te)});for(const te in B){const ne=B[te];if(!(ne.length<2))for(let ye=0;ye<ne.length;ye++)for(let we=ye+1;we<ne.length;we++){const Ee=ne[ye],$e=ne[we];if(be(Ee.r,Ee.c,$e.r,$e.c)){set(D,[Ee,$e],!0),setTimeout(()=>set(D,[],!0),1500);return}}}}function ce(){if(get$2(X)===0){set(N,!0),t()?(ie("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{oe(),e.onWin?.()},h)):ie("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:V}]);return}he()||(t()?setTimeout(()=>se(),1e3):ie("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{oe(),se()}},{text:"Сдаться",action:()=>{ie("Конец","Попытайте удачу снова!",[{text:"ОК",action:V}])}}]))}function he(){const H=get$2(m),W=get$2($);let Z=[];for(let te=0;te<H;te++)for(let ne=0;ne<W;ne++)get$2(T)[te][ne]||Z.push({r:te,c:ne,icon:get$2(E)[te][ne]});let B={};Z.forEach(te=>{B[te.icon]||(B[te.icon]=[]),B[te.icon].push(te)});for(const te in B){const ne=B[te];if(!(ne.length<2)){for(let ye=0;ye<ne.length;ye++)for(let we=ye+1;we<ne.length;we++)if(be(ne[ye].r,ne[ye].c,ne[we].r,ne[we].c))return!0}}return!1}function se(){const H=get$2(m),W=get$2($);let Z=[],B=[];for(let te=0;te<H;te++)for(let ne=0;ne<W;ne++)get$2(T)[te][ne]||(Z.push(get$2(E)[te][ne]),B.push({r:te,c:ne}));Z.length!==0&&(Z.sort(()=>Math.random()-.5),B.forEach((te,ne)=>{get$2(E)[te.r][te.c]=Z[ne],get$2(x)[`${te.r},${te.c}`]=!0}),setTimeout(()=>{set(x,{},!0),he()?set(N,!1):se()},500))}function ve(H,W){const Z=get$2(m),B=get$2($);return H<0||H>=Z||W<0||W>=B?!0:get$2(T)[H][W]}function me(H,W,Z,B){if(H!==Z&&W!==B)return!1;if(H===Z){const te=Math.min(W,B),ne=Math.max(W,B);for(let ye=te+1;ye<ne;ye++)if(!ve(H,ye))return!1}else{const te=Math.min(H,Z),ne=Math.max(H,Z);for(let ye=te+1;ye<ne;ye++)if(!ve(ye,W))return!1}return!0}function be(H,W,Z,B){if(me(H,W,Z,B))return[{r:H,c:W},{r:Z,c:B}];const te={r:H,c:B};if(ve(te.r,te.c)&&me(H,W,te.r,te.c)&&me(te.r,te.c,Z,B))return[{r:H,c:W},te,{r:Z,c:B}];const ne={r:Z,c:W};if(ve(ne.r,ne.c)&&me(H,W,ne.r,ne.c)&&me(ne.r,ne.c,Z,B))return[{r:H,c:W},ne,{r:Z,c:B}];const ye=get$2(m),we=get$2($);for(let Ee=-1;Ee<=ye;Ee++){if(Ee===H||Ee===Z)continue;const $e={r:Ee,c:W},Ce={r:Ee,c:B};if(ve($e.r,$e.c)&&ve(Ce.r,Ce.c)&&me(H,W,$e.r,$e.c)&&me($e.r,$e.c,Ce.r,Ce.c)&&me(Ce.r,Ce.c,Z,B))return[{r:H,c:W},$e,Ce,{r:Z,c:B}]}for(let Ee=-1;Ee<=we;Ee++){if(Ee===W||Ee===B)continue;const $e={r:H,c:Ee},Ce={r:Z,c:Ee};if(ve($e.r,$e.c)&&ve(Ce.r,Ce.c)&&me(H,W,$e.r,$e.c)&&me($e.r,$e.c,Ce.r,Ce.c)&&me(Ce.r,Ce.c,Z,B))return[{r:H,c:W},$e,Ce,{r:Z,c:B}]}return null}async function ue(H){if(await tick(),!F||!U)return;const W=F.getBoundingClientRect(),Z=U.getBoundingClientRect(),B=U.querySelector(".cell:not(.matched)");if(!B)return;const te=B.offsetWidth,ne=B.offsetHeight,ye=window.getComputedStyle(U),we=parseFloat(ye.gap)||4,Ee=Z.left-W.left,$e=Z.top-W.top,Ce=get$2(m),Le=get$2($),w=H.map(c=>{let d,S;if(c.r>=0&&c.r<Ce&&c.c>=0&&c.c<Le){const Y=U.children[c.r*Le+c.c].getBoundingClientRect();d=Y.left-W.left+Y.width/2,S=Y.top-W.top+Y.height/2}else{const M=c.c*(te+we)+te/2,Y=c.r*(ne+we)+ne/2;d=Ee+M,S=$e+Y}return`${d.toFixed(1)},${S.toFixed(1)}`}).join(" ");return set(J,w,!0),update(I),new Promise(c=>{setTimeout(()=>{set(J,""),c()},350)})}function ie(H,W,Z){set(j,{show:!0,title:H,text:W,actions:Z},!0)}function oe(){get$2(j).show=!1}function Q(){ie("📖 Правила",`Соеди монстров:

🎯 Цель: Удалить все пары одинаковых монстров.

🔗 Соедини две одинаковые фигуры линией.

📐 Линия может иметь не более 2 поворотов (изгибов).

🚫 Линия не должна проходить через другие фигуры.

💡 Если ходов нет — игра сама перемешает доску.

💡 Кнопка 💡 покажет доступную пару (с перезарядкой).`,[{text:"Понятно",action:oe}])}function ae(){t()?(ie("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{oe(),e.onLose?.()},h)):ie("Конец","Попытайте удачу снова!",[{text:"ОК",action:V}])}BodyWrapper(r,{children:(H,W)=>{var Z=root_1$6(),B=first_child(Z);{let Ce=user_derived(()=>t()?ae:void 0);GameHeader(B,{onRestart:V,get onGiveUp(){return get$2(Ce)},get showGiveUp(){return t()},onShowRules:Q})}var te=sibling(B,2),ne=child(te);each(ne,21,()=>get$2(E),index$1,(Ce,Le,w)=>{var c=comment(),d=first_child(c);each(d,17,()=>get$2(Le),index$1,(S,M,Y)=>{var _e=root_3$3();let Ie;_e.__click=()=>G(w,Y),_e.__keydown=Ae=>q(w,Y,Ae);var Oe=child(_e);template_effect(Ae=>{Ie=set_class(_e,1,"cell svelte-1nbr0u5",null,Ie,Ae),set_text(Oe,get$2(M))},[()=>({selected:get$2(R)?.r===w&&get$2(R)?.c===Y,matched:get$2(T)[w][Y],shuffling:get$2(x)[`${w},${Y}`],"hint-glow":get$2(D).some(Ae=>Ae.r===w&&Ae.c===Y)})]),append(S,_e)}),append(Ce,c)}),bind_this(ne,Ce=>U=Ce,()=>U);var ye=sibling(ne,2),we=child(ye);key(we,()=>get$2(I),Ce=>{var Le=comment(),w=first_child(Le);{var c=d=>{var S=root_5$5();template_effect(()=>set_attribute(S,"points",get$2(J))),append(d,S)};if_block(w,d=>{get$2(J)&&d(c)})}append(Ce,Le)}),bind_this(te,Ce=>F=Ce,()=>F);var Ee=sibling(te,2);GameFooter(Ee,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(Ce,Le)=>{var w=root_6$3(),c=child(w),d=child(c);let S;d.__click=[on_click$4,re];var M=sibling(d,2);let Y;M.__click=[on_click_1$2,re];var _e=sibling(M,2);let Ie;_e.__click=[on_click_2,re];var Oe=sibling(c,2),Ae=sibling(child(Oe)),Fe=child(Ae),We=sibling(Oe,2);let Ye;We.__click=z;var Je=sibling(child(We));{var lt=st=>{var it=root_7$2(),qe=child(it);template_effect(()=>set_text(qe,`(${get$2(k)??""})`)),append(st,it)};if_block(Je,st=>{get$2(k)>0&&st(lt)})}template_effect((st,it,qe,Be)=>{S=set_class(d,1,"size-btn svelte-1nbr0u5",null,S,st),Y=set_class(M,1,"size-btn svelte-1nbr0u5",null,Y,it),Ie=set_class(_e,1,"size-btn svelte-1nbr0u5",null,Ie,qe),set_text(Fe,get$2(X)),Ye=set_class(We,1,"btn btn-secondary svelte-1nbr0u5",null,Ye,Be),We.disabled=!get$2(fe)},[()=>({active:get$2(_)==="auto"}),()=>({active:get$2(_)==="16x9"}),()=>({active:get$2(_)==="16x16"}),()=>({disabled:!get$2(fe),"cooldown-active":get$2(k)>0})]),append(Ce,w)},$$slots:{default:!0}});var $e=sibling(Ee,2);MinigameModal($e,{get modal(){return get$2(j)}}),template_effect(()=>set_style(ne,`grid-template-columns: repeat(${get$2($)??""}, 1fr); grid-template-rows: repeat(${get$2(m)??""}, 1fr);`)),append(H,Z)}}),pop()}delegate(["click","keydown"]);var root_2$4=from_html('<button type="button" class="crystal-btn svelte-1gbuyw4"><span class="crystal-icon svelte-1gbuyw4"> </span> <span class="crystal-name svelte-1gbuyw4"> </span></button>'),root_3$2=from_html('<div class="game-over-message svelte-1gbuyw4"><span> </span></div>'),root_5$4=from_html('<div class="status-message svelte-1gbuyw4">✨ Кристаллы показывают путь... ✨</div>'),root_6$2=from_html('<div class="status-message svelte-1gbuyw4">👆 Повтори последовательность</div>'),root_7$1=from_html('<div class="progress svelte-1gbuyw4"> </div>'),root_8$2=from_html('<div class="footer-stats svelte-1gbuyw4"><span class="target-info svelte-1gbuyw4">Раунд: <strong class="svelte-1gbuyw4"> </strong></span></div>'),root_1$5=from_html('<!> <div id="game-container" class="svelte-1gbuyw4"><div class="stats-panel svelte-1gbuyw4"><div class="round svelte-1gbuyw4">Раунд: <strong class="svelte-1gbuyw4"> </strong></div> <div class="high-score svelte-1gbuyw4">Рекорд: <strong class="svelte-1gbuyw4"> </strong></div></div> <div class="crystals-grid svelte-1gbuyw4"></div> <div class="status-area svelte-1gbuyw4"><!></div> <!></div> <!> <!>',1);function CrystalsOfTime(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{color:"#e94560",name:"Рубин",icon:"🔴"},{color:"#0984e3",name:"Сапфир",icon:"🔵"},{color:"#00b894",name:"Изумруд",icon:"🟢"},{color:"#fdcb6e",name:"Топаз",icon:"🟡"}],h=1e3,_=10;let v=state(proxy([])),g=state(proxy([])),m=state(1),$=state(!1),p=state(null),E=state(!1),T=state(0),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(){set(v,[],!0),set(g,[],!0),set(m,1),set(E,!1),R()}function R(){const U=Math.floor(Math.random()*u.length);set(v,[...get$2(v),U],!0),P()}async function P(){set($,!0),set(g,[],!0);for(let U=0;U<get$2(v).length;U++)await new Promise(L=>setTimeout(L,300)),set(p,get$2(v)[U],!0),J(get$2(v)[U]),await new Promise(L=>setTimeout(L,500)),set(p,null),await new Promise(L=>setTimeout(L,200));set($,!1)}function N(U){if(get$2($)||get$2(E))return;set(p,U,!0),J(U),setTimeout(()=>{set(p,null)},300);const L=get$2(g).length;if(U!==get$2(v)[L]){set(E,!0),get$2(m)-1>get$2(T)&&set(T,get$2(m)-1),t()?(k("💀 Поражение","Время распалось...",[]),setTimeout(()=>{j(),e.onLose?.()},h)):k("💀 Время распалось",`Раунд ${get$2(m)-1}`,[{text:"Начать заново",action:D}]);return}if(set(g,[...get$2(g),U],!0),get$2(g).length===get$2(v).length){if(update(m),get$2(m)>get$2(T)&&set(T,get$2(m),!0),get$2(m)>_){set(E,!0),t()?(k("🎉 Победа!","Время под контролем!",[]),setTimeout(()=>{j(),e.onWin?.()},h)):k("🎉 Победа!","Ты покорил время!",[{text:"Играть снова",action:D}]);return}setTimeout(()=>{R()},1e3)}}function J(U){console.log(`Play sound for crystal ${U}`)}function I(U){const L=u[U],X=get$2(p)===U,fe=X?`0 0 50px ${L.color}, 0 0 100px ${L.color}`:`0 8px 0 ${L.color}`;return`background-color: ${L.color}; box-shadow: ${fe}; transform: ${X?"translateY(2px)":"none"};`}function k(U,L,X){set(x,{show:!0,title:U,text:L,actions:X},!0)}function j(){get$2(x).show=!1}function F(){k("📖 Правила",`Кристаллы времени:

🎯 Цель: Повтори последовательность кристаллов.

🔮 Смотри внимательно на последовательность.

👆 Кликай кристаллы в том же порядке.

💀 Если ошибся - игра окончена.

✨ Пройди 10 раундов для победы!`,[{text:"Понятно",action:j}])}onMount(()=>{D()}),BodyWrapper(r,{children:(U,L)=>{var X=root_1$5(),fe=first_child(X);{let ae=user_derived(()=>t()?()=>{set(E,!0),k("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{j(),e.onLose?.()},h)}:void 0);GameHeader(fe,{onRestart:D,get onGiveUp(){return get$2(ae)},get showGiveUp(){return t()},onShowRules:F})}var ge=sibling(fe,2),re=child(ge),V=child(re),G=sibling(child(V)),q=child(G),O=sibling(V,2),z=sibling(child(O)),ce=child(z),he=sibling(re,2);each(he,21,()=>u,index$1,(ae,H,W)=>{var Z=root_2$4();Z.__click=()=>N(W);var B=child(Z),te=child(B),ne=sibling(B,2),ye=child(ne);template_effect(we=>{set_style(Z,we),Z.disabled=get$2($)||get$2(E),set_text(te,get$2(H).icon),set_text(ye,get$2(H).name)},[()=>I(W)]),append(ae,Z)});var se=sibling(he,2),ve=child(se);{var me=ae=>{var H=root_3$2(),W=child(H),Z=child(W);template_effect(()=>set_text(Z,`💀 Время распалось... Раунд ${get$2(m)-1}`)),append(ae,H)},be=ae=>{var H=comment(),W=first_child(H);{var Z=te=>{var ne=root_5$4();append(te,ne)},B=te=>{var ne=root_6$2();append(te,ne)};if_block(W,te=>{get$2($)?te(Z):te(B,!1)},!0)}append(ae,H)};if_block(ve,ae=>{get$2(E)?ae(me):ae(be,!1)})}var ue=sibling(se,2);{var ie=ae=>{var H=root_7$1(),W=child(H);template_effect(()=>set_text(W,`Прогресс: ${get$2(g).length??""} / ${get$2(v).length??""}`)),append(ae,H)};if_block(ue,ae=>{get$2(v).length>0&&!get$2(E)&&!get$2($)&&ae(ie)})}var oe=sibling(ge,2);GameFooter(oe,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ae,H)=>{var W=root_8$2(),Z=child(W),B=sibling(child(Z)),te=child(B);template_effect(()=>set_text(te,`${get$2(m)??""}/10`)),append(ae,W)},$$slots:{default:!0}});var Q=sibling(oe,2);MinigameModal(Q,{get modal(){return get$2(x)}}),template_effect(()=>{set_text(q,get$2(m)),set_text(ce,get$2(T))}),append(U,X)}}),pop()}delegate(["click"]);var on_click$3=(r,e,t)=>e(get$2(t)),root_2$3=from_html('<button class="rune-btn svelte-1bt21l4"> </button>'),root_1$4=from_html('<!> <div id="game-container" class="svelte-1bt21l4"><div class="score-board svelte-1bt21l4"><div class="score player svelte-1bt21l4"><span class="label svelte-1bt21l4">Ты</span> <span class="value svelte-1bt21l4"> </span></div> <div class="vs svelte-1bt21l4">VS</div> <div class="score computer svelte-1bt21l4"><span class="label svelte-1bt21l4">Дух</span> <span class="value svelte-1bt21l4"> </span></div></div> <div class="battle-area svelte-1bt21l4"><div class="choice-display player-choice svelte-1bt21l4"><div class="rune-icon svelte-1bt21l4"> </div> <div class="choice-label svelte-1bt21l4">Твой выбор</div></div> <div class="versus-symbol svelte-1bt21l4">⚡</div> <div class="choice-display computer-choice svelte-1bt21l4"><div class="rune-icon svelte-1bt21l4"> </div> <div class="choice-label svelte-1bt21l4">Выбор духа</div></div></div> <div class="result-message svelte-1bt21l4"> </div> <div class="rune-panel svelte-1bt21l4"></div> <div class="round-indicator svelte-1bt21l4"> </div></div> <!> <!>',1);function RunesOfFate(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["🛡️","⚔️","🔮"],h={"🛡️⚔️":"🛡️","⚔️🔮":"⚔️","🔮🛡️":"🔮"};let _=state(null),v=state(null),g=state(0),m=state(0),$=state(0),p=5,E=state(!1),T=state(""),x=state(!1),D=state(proxy({show:!1,title:"",text:"",actions:[]}));function R(){const F=Math.floor(Math.random()*u.length);return u[F]}function P(F,U){if(F===U)return"tie";const L=`${F}${U}`;return h[L]===F?"player":"computer"}async function N(F){if(get$2(E)||get$2(x)||get$2($)>=p)return;set(E,!0),set(_,F,!0),set(v,null),set(T,"Дух выбирает..."),await new Promise(L=>setTimeout(L,800)),set(v,R(),!0);const U=P(get$2(_),get$2(v));U==="player"?(update(g),set(T,"Победа! Силы света с тобой!")):U==="computer"?(update(m),set(T,"Поражение... Тьма наступает")):set(T,"Ничья. Силы уравновешены"),update($),get$2($)>=p&&(set(x,!0),get$2(g)>get$2(m)?t()?setTimeout(()=>e.onWin?.(),1e3):I("🎉 Победа!",`Ты победил духа ${get$2(g)}:${get$2(m)}!`,[{text:"Играть снова",action:J}]):t()?setTimeout(()=>e.onLose?.(),1e3):I("💀 Поражение",`Дух оказался сильнее ${get$2(m)}:${get$2(g)}`,[{text:"Новая битва",action:J}])),set(E,!1)}function J(){set(_,null),set(v,null),set(g,0),set(m,0),set($,0),set(x,!1),set(T,""),k()}function I(F,U,L){set(D,{show:!0,title:F,text:U,actions:L},!0)}function k(){get$2(D).show=!1}function j(){I("📖 Правила",`Руны Судьбы:

🛡️ Щит побеждает ⚔️ Меч
⚔️ Меч побеждает 🔮 Магию
🔮 Магия побеждает 🛡️ Щит

Первый, кто наберет 3 победы из 5 раундов, станет властелином судьбы!`,[{text:"Понятно",action:k}])}BodyWrapper(r,{children:(F,U)=>{var L=root_1$4(),X=first_child(L);{let B=user_derived(()=>t()?()=>e.onLose?.():void 0);GameHeader(X,{onRestart:J,get onGiveUp(){return get$2(B)},get showGiveUp(){return t()},onShowRules:j})}var fe=sibling(X,2),ge=child(fe),re=child(ge),V=sibling(child(re),2),G=child(V),q=sibling(re,4),O=sibling(child(q),2),z=child(O),ce=sibling(ge,2),he=child(ce),se=child(he),ve=child(se),me=sibling(he,4),be=child(me),ue=child(be),ie=sibling(ce,2),oe=child(ie),Q=sibling(ie,2);each(Q,21,()=>u,index$1,(B,te)=>{var ne=root_2$3();ne.__click=[on_click$3,N,te];var ye=child(ne);template_effect(()=>{ne.disabled=get$2(E)||get$2(x)||get$2($)>=p,set_text(ye,get$2(te))}),append(B,ne)});var ae=sibling(Q,2),H=child(ae),W=sibling(fe,2);GameFooter(W,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()}});var Z=sibling(W,2);MinigameModal(Z,{get modal(){return get$2(D)}}),template_effect(()=>{set_text(G,get$2(g)),set_text(z,get$2(m)),set_text(ve,get$2(_)||"❓"),set_text(ue,get$2(v)||"❓"),set_text(oe,get$2(T)),set_text(H,`Раунд: ${get$2($)??""} / 5`)}),append(F,L)}}),pop()}delegate(["click"]);var root_2$2=from_html('<div class="start-screen svelte-y67o6y"><h2 class="svelte-y67o6y">🧙 Котлы Ведьмы 🧙</h2> <p class="svelte-y67o6y">Помоги ведьме собрать нужные ингредиенты!</p> <button type="button" class="start-btn svelte-y67o6y">Начать варить</button></div>'),root_6$1=from_html("<span> </span>"),root_5$3=from_html('<div class="current-recipe svelte-y67o6y"><div class="recipe-name svelte-y67o6y"> </div> <div class="recipe-ingredients svelte-y67o6y"></div> <div class="recipe-progress svelte-y67o6y"> </div></div>'),on_click$2=(r,e,t)=>e(get$2(t).icon,get$2(t).id),root_7=from_html('<button type="button" class="floating-item svelte-y67o6y"> </button>'),root_4$2=from_html('<div class="game-header svelte-y67o6y"><div class="score svelte-y67o6y"> </div> <div> </div></div> <!> <div class="game-area svelte-y67o6y"><div class="cauldron svelte-y67o6y">🧙‍♀️ <div class="cauldron-fire svelte-y67o6y">🔥</div></div> <div class="floating-items svelte-y67o6y"></div></div> <div class="instructions svelte-y67o6y"><p class="svelte-y67o6y">Кликай на нужные ингредиенты!</p> <p class="svelte-y67o6y">Лишние уменьшают счёт 👎</p></div>',1),root_8$1=from_html('<div class="footer-stats svelte-y67o6y"><span class="target-info svelte-y67o6y">Цель: <strong class="svelte-y67o6y"></strong> очков</span></div>'),root_1$3=from_html('<!> <div id="game-container" class="svelte-y67o6y"><!></div> <!> <!>',1);function WitchesCauldrons(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{id:"frog",icon:"🐸",name:"Лягушачья лапка"},{id:"spider",icon:"🕷️",name:"Паучий глаз"},{id:"bat",icon:"🦇",name:"Крыло летучей мыши"},{id:"skull",icon:"💀",name:"Прах скелета"},{id:"mushroom",icon:"🍄",name:"Ядовитый гриб"},{id:"potion",icon:"🧪",name:"База зелья"},{id:"bone",icon:"🦴",name:"Кость"},{id:"web",icon:"🕸️",name:"Паутина"}],h=[{name:"Любовное зелье",ingredients:["🐸","🕷️","🧪"]},{name:"Зелье невидимости",ingredients:["🦇","🍄","🧪"]},{name:"Яд",ingredients:["💀","🕷️","🍄"]},{name:"Эликсир жизни",ingredients:["🦇","🦴","🧪"]}],_=1e3,v=20,g=60;let m=state(null),$=state(proxy([])),p=state(0),E=state(g),T=state(!1),x=state(proxy([])),D,R,P=state(!1),N=state(proxy({show:!1,title:"",text:"",actions:[]}));function J(){set(T,!0),set(P,!0),set(p,0),set(E,g),set($,[],!0),k(),D=setInterval(()=>{update(E,-1),get$2(E)<=0&&I()},1e3),R=setInterval(()=>{get$2(T)&&j()},800)}function I(){set(T,!1),clearInterval(D),clearInterval(R),get$2(p)>=v?t()?(L("🧪 Зелье сварено!",`Счёт: ${get$2(p)}`,[]),setTimeout(()=>{X(),e.onWin?.()},_)):L("🧪 Зелье сварено!",`Счёт: ${get$2(p)}`,[{text:"Играть снова",action:J}]):t()?(L("💀 Котёл взорвался",`Счёт: ${get$2(p)}`,[]),setTimeout(()=>{X(),e.onLose?.()},_)):L("💀 Котёл взорвался",`Счёт: ${get$2(p)}`,[{text:"Испытать снова",action:J}])}function k(){const ge=Math.floor(Math.random()*h.length);set(m,h[ge],!0),set($,[],!0)}function j(){const ge=u[Math.floor(Math.random()*u.length)],re=Math.random()*80+10,G={id:`${ge.id}-${Date.now()}-${Math.random()}`,icon:ge.icon,x:re,y:-10};set(x,[...get$2(x),G],!0),setTimeout(()=>{set(x,get$2(x).filter(q=>q.id!==G.id),!0)},5e3)}function F(ge,re){!get$2(T)||!get$2(m)||(set(x,get$2(x).filter(V=>V.id!==re),!0),get$2(m).ingredients.includes(ge)&&!get$2($).includes(ge)?(set($,[...get$2($),ge],!0),set(p,get$2(p)+10),get$2($).length===get$2(m).ingredients.length&&(set(p,get$2(p)+50),k())):set(p,Math.max(0,get$2(p)-5),!0))}function U(){return get$2(m)?get$2(m).ingredients.map(ge=>get$2($).includes(ge)?ge:"❓").join(" + "):""}function L(ge,re,V){set(N,{show:!0,title:ge,text:re,actions:V},!0)}function X(){get$2(N).show=!1}function fe(){L("📖 Правила",`Котёл ведьмы:

🎯 Цель: Набери {WIN_SCORE} очков за {GAME_TIME} секунд.

🧪 Собирай нужные ингредиенты для рецепта.

👆 Кликай на падающие ингредиенты.

✅ Правильный ингредиент: +10 очков.

✨ Полный рецепт: +50 очков.

❌ Неправильный ингредиент: -5 очков.`,[{text:"Понятно",action:X}])}onDestroy(()=>{clearInterval(D),clearInterval(R)}),BodyWrapper(r,{children:(ge,re)=>{var V=root_1$3(),G=first_child(V);{let ve=user_derived(()=>t()?()=>{set(T,!1),clearInterval(D),clearInterval(R),L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{X(),e.onLose?.()},_)}:void 0);GameHeader(G,{onRestart:J,get onGiveUp(){return get$2(ve)},get showGiveUp(){return t()},onShowRules:fe})}var q=sibling(G,2),O=child(q);{var z=ve=>{var me=root_2$2(),be=sibling(child(me),4);be.__click=J,append(ve,me)},ce=ve=>{var me=comment(),be=first_child(me);{var ue=ie=>{var oe=root_4$2(),Q=first_child(oe),ae=child(Q),H=child(ae),W=sibling(ae,2);let Z;var B=child(W),te=sibling(Q,2);{var ne=Ee=>{var $e=root_5$3(),Ce=child($e),Le=child(Ce),w=sibling(Ce,2);each(w,21,()=>get$2(m).ingredients,index$1,(S,M)=>{var Y=root_6$1();let _e;var Ie=child(Y);template_effect((Oe,Ae)=>{_e=set_class(Y,1,"ingredient-icon svelte-y67o6y",null,_e,Oe),set_text(Ie,Ae)},[()=>({collected:get$2($).includes(get$2(M))}),()=>get$2($).includes(get$2(M))?get$2(M):"❓"]),append(S,Y)});var c=sibling(w,2),d=child(c);template_effect(S=>{set_text(Le,get$2(m).name),set_text(d,S)},[U]),append(Ee,$e)};if_block(te,Ee=>{get$2(m)&&Ee(ne)})}var ye=sibling(te,2),we=sibling(child(ye),2);each(we,21,()=>get$2(x),index$1,(Ee,$e)=>{var Ce=root_7();Ce.__click=[on_click$2,F,$e];var Le=child(Ce);template_effect(()=>{set_style(Ce,`left: ${get$2($e).x??""}%; top: ${get$2($e).y??""}%;`),set_text(Le,get$2($e).icon)}),append(Ee,Ce)}),template_effect(Ee=>{set_text(H,`✨ ${get$2(p)??""}`),Z=set_class(W,1,"timer svelte-y67o6y",null,Z,Ee),set_text(B,`⏳ ${get$2(E)??""}с`)},[()=>({danger:get$2(E)<=10})]),append(ie,oe)};if_block(be,ie=>{get$2(T)&&ie(ue)},!0)}append(ve,me)};if_block(O,ve=>{get$2(P)?ve(ce,!1):ve(z)})}var he=sibling(q,2);GameFooter(he,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ve,me)=>{var be=root_8$1(),ue=child(be),ie=sibling(child(ue));ie.textContent="20",append(ve,be)},$$slots:{default:!0}});var se=sibling(he,2);MinigameModal(se,{get modal(){return get$2(N)}}),append(ge,V)}}),pop()}delegate(["click"]);function checkSolution(r,e,t,i,n,o,u,h,_,v,g,m,$){if(get$2(e).length>0){set(t,"Используй все числа!");return}const p=i();if(p===null){set(t,"Неполное выражение");return}Math.abs(p-get$2(n))<.01?(set(t,"✨ Великолепно! Алхимия удалась! ✨"),set(o,!0),set(u,!0),h()?(_("🎉 Победа!","Алхимия удалась!",[]),setTimeout(()=>{v(),g.onWin?.()},m)):_("🎉 Победа!","Алхимия удалась!",[{text:"Играть снова",action:$}])):set(t,`❌ Получилось ${p.toFixed(1)}, нужно ${get$2(n)}`)}function clearExpression(r,e,t,i,n){set(e,[...get$2(t)],!0),set(i,[],!0),set(n,"")}function removeLast(r,e,t){const i=[...get$2(e)],n=i.pop();n&&n.type==="number"&&set(t,[...get$2(t),n.value].sort((o,u)=>o-u),!0),set(e,i,!0)}var root_2$1=from_html("<span> </span>"),on_click$1=(r,e,t)=>e(get$2(t)),root_3$1=from_html('<button type="button" class="num-btn svelte-x83gym"> </button>'),on_click_1$1=(r,e,t)=>e(get$2(t)),root_4$1=from_html('<button type="button" class="op-btn svelte-x83gym"> </button>'),root_5$2=from_html("<div> </div>"),root_6=from_html('<div class="footer-stats svelte-x83gym"><span class="target-info svelte-x83gym">Цель: <strong class="svelte-x83gym"> </strong></span></div>'),root_1$2=from_html('<!> <div id="game-container" class="svelte-x83gym"><div class="target-number svelte-x83gym"><div class="target-label svelte-x83gym">Цель:</div> <div class="target-value svelte-x83gym"> </div></div> <div class="expression-area svelte-x83gym"><!> <span class="expr-cursor svelte-x83gym">_</span></div> <div class="numbers-panel svelte-x83gym"><div class="numbers-grid svelte-x83gym"></div></div> <div class="operations-grid svelte-x83gym"></div> <div class="action-buttons svelte-x83gym"><button type="button" class="action-btn svelte-x83gym">↩</button> <button type="button" class="action-btn svelte-x83gym">🧹</button> <button type="button" class="action-btn primary svelte-x83gym">⚗️</button></div> <!></div> <!> <!>',1);function AlchemicalCalculator(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{symbol:"+",func:(U,L)=>U+L},{symbol:"−",func:(U,L)=>U-L},{symbol:"×",func:(U,L)=>U*L},{symbol:"÷",func:(U,L)=>U/L}],h=1e3;let _=state(proxy([])),v=state(0),g=state(proxy([])),m=state(proxy([])),$=state(proxy([])),p=state(!1),E=state(!1),T=state(""),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(){const U=Array(4).fill(0).map(()=>Math.floor(Math.random()*12)+1);set(_,[...U],!0),set(m,[...U],!0),set(v,Math.floor(U.reduce((L,X)=>L+X,0)/2)+2),set($,[...u],!0),set(g,[],!0),set(T,""),set(p,!1),set(E,!1)}function R(U){get$2(p)||get$2(m).includes(U)&&(set(g,[...get$2(g),{type:"number",value:U,id:`${U}-${Date.now()}-${Math.random()}`}],!0),set(m,get$2(m).filter(L=>L!==U),!0))}function P(U){if(get$2(p))return;const L=get$2(g)[get$2(g).length-1];L&&L.type==="number"&&get$2(g).length<7&&set(g,[...get$2(g),{type:"operation",value:U.symbol,id:`${U.symbol}-${Date.now()}-${Math.random()}`}],!0)}function N(){if(get$2(g).length<3)return null;let U=get$2(g)[0].value;for(let L=1;L<get$2(g).length;L+=2){const X=get$2(g)[L],fe=get$2(g)[L+1];if(X.type!=="operation"||!fe||fe.type!=="number")return null;const ge=u.find(re=>re.symbol===X.value)?.func;if(!ge)return null;U=ge(U,fe.value)}return U}function J(){D(),j()}function I(){set(p,!0),t()?(k("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{j(),e.onLose?.()},h)):k("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:J}])}function k(U,L,X){set(x,{show:!0,title:U,text:L,actions:X},!0)}function j(){get$2(x).show=!1}function F(){k("📖 Правила",`Алхимический калькулятор:

🎯 Цель: Используя все числа и операции, получи целевое число.

🔢 Доступны 4 числа от 1 до 12.

➕➖✖️➗ Можно использовать любые операции.

⚠️ Порядок выполнения: слева направо.`,[{text:"Понятно",action:j}])}onMount(()=>{J()}),BodyWrapper(r,{children:(U,L)=>{var X=root_1$2(),fe=first_child(X);{let ae=user_derived(()=>t()?I:void 0);GameHeader(fe,{onRestart:J,get onGiveUp(){return get$2(ae)},get showGiveUp(){return t()},onShowRules:F})}var ge=sibling(fe,2),re=child(ge),V=sibling(child(re),2),G=child(V),q=sibling(re,2),O=child(q);each(O,17,()=>get$2(g),index$1,(ae,H)=>{var W=root_2$1(),Z=child(W);template_effect(()=>{set_class(W,1,`expr-item expr-${get$2(H).type??""}`,"svelte-x83gym"),set_text(Z,get$2(H).value)}),append(ae,W)});var z=sibling(q,2),ce=child(z);each(ce,21,()=>get$2(m),index$1,(ae,H)=>{var W=root_3$1();W.__click=[on_click$1,R,H];var Z=child(W);template_effect(()=>{W.disabled=get$2(p),set_text(Z,get$2(H))}),append(ae,W)});var he=sibling(z,2);each(he,21,()=>u,index$1,(ae,H)=>{var W=root_4$1();W.__click=[on_click_1$1,P,H];var Z=child(W);template_effect(()=>{W.disabled=get$2(p),set_text(Z,get$2(H).symbol)}),append(ae,W)});var se=sibling(he,2),ve=child(se);ve.__click=[removeLast,g,m];var me=sibling(ve,2);me.__click=[clearExpression,m,_,g,T];var be=sibling(me,2);be.__click=[checkSolution,m,T,N,v,p,E,t,k,j,e,h,J];var ue=sibling(se,2);{var ie=ae=>{var H=root_5$2();let W;var Z=child(H);template_effect(B=>{W=set_class(H,1,"message svelte-x83gym",null,W,B),set_text(Z,get$2(T))},[()=>({success:get$2(T).includes("✨")})]),append(ae,H)};if_block(ue,ae=>{get$2(T)&&ae(ie)})}var oe=sibling(ge,2);GameFooter(oe,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ae,H)=>{var W=root_6(),Z=child(W),B=sibling(child(Z)),te=child(B);template_effect(()=>set_text(te,get$2(v))),append(ae,W)},$$slots:{default:!0}});var Q=sibling(oe,2);MinigameModal(Q,{get modal(){return get$2(x)}}),template_effect(()=>{set_text(G,get$2(v)),ve.disabled=get$2(g).length===0||get$2(p),me.disabled=get$2(g).length===0||get$2(p),be.disabled=get$2(p)}),append(U,X)}}),pop()}delegate(["click"]);function handleGameBack(r,e){set(e,null)}var root_1$1=from_html('<div class="game-container svelte-1t3borq"><button type="button" class="back-btn svelte-1t3borq">← К списку игр</button> <!></div>'),on_click=(r,e,t)=>set(e,get$2(t),!0),root_3=from_html('<button type="button"> </button>'),on_click_1=(r,e,t)=>e(get$2(t)),root_4=from_html('<button type="button" class="game-card svelte-1t3borq"><div class="game-icon svelte-1t3borq"> </div> <div class="game-info svelte-1t3borq"><h3 class="game-name svelte-1t3borq"> </h3> <p class="game-description svelte-1t3borq"> </p></div> <div class="game-arrow svelte-1t3borq">→</div></button>'),root_5$1=from_html('<div class="empty svelte-1t3borq"><p>Игр в этой категории пока нет</p></div>'),root_2=from_html('<div class="all-games svelte-1t3borq"><div class="header svelte-1t3borq"><button type="button" class="back-btn svelte-1t3borq">← Назад</button> <h1 class="svelte-1t3borq">🎮 Мини-игры</h1> <p class="svelte-1t3borq">Выберите игру для прохождения</p></div> <div class="categories svelte-1t3borq"></div> <div class="games-scroll svelte-1t3borq"><div class="games-grid svelte-1t3borq"></div></div> <!></div>');function AllGames(r,e){push(e,!0);const t={"memo-monsters":MemoMonsters,"onet-monsters":OnetMonsters,"onet-monsters-144":OnetMonsters144,"evolution-2048":Evolution2048,"whisper-of-spiders":WhisperOfSpiders,"tower-of-souls":TowerOfSouls,"soul-cycle":SoulCycle,"labyrinth-of-minotaur":LabyrinthOfMinotaur,"cursed-crypts":CursedCrypts,"broken-mirror":BrokenMirror,"alchemists-cross":AlchemistsCross,"light-out":LightOut,"flood-it":FloodIt,"bones-421":Bones421,"crystals-of-time":CrystalsOfTime,"runes-of-fate":RunesOfFate,"witches-cauldrons":WitchesCauldrons,"alchemical-calculator":AlchemicalCalculator};let i=state("all"),n=state(null);const o=user_derived(()=>get$2(i)==="all"?gamesList:gamesList.filter(E=>E.category===get$2(i))),u=["all","puzzle","memory","logic","arcade","board"];function h(E){userKeyStore.trackGameStart(E.id,E.name),set(n,E,!0)}async function _(){get$2(n)&&await userKeyStore.trackEvent("session_time",{game_id:get$2(n).id,game_title:get$2(n).name}),set(n,null)}const v=user_derived(()=>get$2(n)?t[get$2(n).id]:null);var g=comment(),m=first_child(g);{var $=E=>{var T=root_1$1(),x=child(T);x.__click=[handleGameBack,n];var D=sibling(x,2);component(D,()=>get$2(v),(R,P)=>{P(R,{integrated:!1,onWin:()=>{get$2(n)&&userKeyStore.trackGameResult(get$2(n).id,get$2(n).name,!0),_()},onLose:()=>{get$2(n)&&userKeyStore.trackGameResult(get$2(n).id,get$2(n).name,!1),_()},rewardItem:null,items:[],bucketName:"dracula"})}),append(E,T)},p=E=>{var T=root_2(),x=child(T),D=child(x);D.__click=function(...k){e.onBack?.apply(this,k)};var R=sibling(x,2);each(R,21,()=>u,index$1,(k,j)=>{var F=root_3();let U;F.__click=[on_click,i,j];var L=child(F);template_effect(X=>{U=set_class(F,1,"category-btn svelte-1t3borq",null,U,X),set_text(L,get$2(j)==="all"?"Все":categoryNames[get$2(j)])},[()=>({active:get$2(i)===get$2(j)})]),append(k,F)});var P=sibling(R,2),N=child(P);each(N,21,()=>get$2(o),k=>k.id,(k,j)=>{var F=root_4();F.__click=[on_click_1,h,j];var U=child(F),L=child(U),X=sibling(U,2),fe=child(X),ge=child(fe),re=sibling(fe,2),V=child(re);template_effect(()=>{set_text(L,get$2(j).icon),set_text(ge,get$2(j).name),set_text(V,get$2(j).description)}),append(k,F)});var J=sibling(P,2);{var I=k=>{var j=root_5$1();append(k,j)};if_block(J,k=>{get$2(o).length===0&&k(I)})}append(E,T)};if_block(m,E=>{get$2(n)&&get$2(v)?E($):E(p,!1)})}append(r,g),pop()}delegate(["click"]);var root_1=from_html('<div class="loading-screen svelte-8uu4k4"><div class="loader svelte-8uu4k4"></div> <p>Загрузка...</p></div>'),root_5=from_html('<button class="btn-back-to-game svelte-8uu4k4" title="Назад к игре">← Назад к игре</button> <!>',1),root_8=from_html("<!> <!>",1),root=from_html("<!> <!>",1);function App(r,e){push(e,!0);let t=null,i=null,n=null,o=state(!1),u=state(!1),h=state(!1),_=state(""),v=state(""),g=state(!0);async function m(){const I=new URLSearchParams(window.location.search),k=I.get("story"),j=I.get("bucket");if(!k&&!j)return null;console.log("[App] Внешняя ссылка на историю:",{storyId:k,bucket:j}),await loadStories();let F=null;return k?F=getStoryById(k):j&&(F=getStoryByBucket(j)),F?(console.log("[App] Найдена история:",F.title),gameState.selectedStory=F.id,gameState.selectedStoryData=F,window.history.replaceState({},"","/"),F):(console.log("[App] История не найдена"),null)}user_effect(()=>{authState.initialized&&console.log("[App] Auth state changed:",{user:authState.user?.email,isAuthenticated:authDerivedState.isAuthenticated,session:!!authState.session,loading:authState.loading})});async function $(){const I=window.location.hash,k=window.location.search;if(console.log("[App] Checking auth callback:",{hash:I,search:k}),I.includes("type=recovery")||k.includes("type=recovery")){console.log("[App] Recovery flow detected");let j="";I.includes("access_token=")?j=new URLSearchParams(I.substring(1)).get("access_token")||"":k.includes("token=")&&(j=new URLSearchParams(k).get("token")||""),j&&(set(v,j,!0),set(u,!0),window.history.replaceState({},"","/reset-password"))}else if(k.includes("error=")){const j=new URLSearchParams(k);set(_,j.get("error_description")||j.get("error")||"Unknown error",!0),set(u,!0),window.history.replaceState({},"","/reset-password")}else window.location.pathname==="/reset-password"&&set(u,!0)}const p=async()=>{await userKeyStore.stopSessionTimer()};onMount(async()=>{console.log("[App] Mounted"),userKeyStore.startSessionTimer(),typeof window<"u"&&(window.addEventListener("beforeunload",p),window.addEventListener("keydown",E));try{const k=await userKeyStore.init();k?(t=k,i=await userKeyStore.getUserStats(k)):n="Не удалось создать ключ пользователя"}catch(k){n=k instanceof Error?k.message:"Произошла ошибка"}finally{}const I=()=>{set(h,!0)};window.addEventListener("open-all-games",I);try{await $();const k=initAuth(),j=new Promise((F,U)=>setTimeout(()=>U(new Error("Timeout auth")),1e4));await Promise.race([k,j]),console.log("[App] Auth initialized successfully"),await m()}catch(k){console.error("[App] Auth init error:",k)}finally{set(o,!0),console.log("[App] App ready")}return()=>{window.removeEventListener("open-all-games",I),window.removeEventListener("beforeunload",p),window.removeEventListener("keydown",E)}});function E(I){I.ctrlKey&&I.shiftKey&&I.key==="D"&&(I.preventDefault(),set(g,!get$2(g)))}function T(){set(u,!1),set(_,""),set(v,""),window.history.replaceState({},"","/")}function x(){set(h,!1)}var D=root(),R=first_child(D);{var P=I=>{var k=root_1();append(I,k)},N=I=>{var k=comment(),j=first_child(k);{var F=L=>{ResetPasswordPage(L,{onClose:T,get initialError(){return get$2(_)},get initialToken(){return get$2(v)}})},U=L=>{var X=comment(),fe=first_child(X);{var ge=V=>{var G=root_5(),q=first_child(G);q.__click=function(...z){editorActions.toggleEditor?.apply(this,z)};var O=sibling(q,2);Editor(O,{}),append(V,G)},re=V=>{var G=comment(),q=first_child(G);{var O=ce=>{AllGames(ce,{onBack:x})},z=ce=>{var he=root_8(),se=first_child(he);UserMenu(se,{});var ve=sibling(se,2);Main(ve,{}),append(ce,he)};if_block(q,ce=>{get$2(h)?ce(O):ce(z,!1)},!0)}append(V,G)};if_block(fe,V=>{editor.showEditor?V(ge):V(re,!1)},!0)}append(L,X)};if_block(j,L=>{get$2(u)?L(F):L(U,!1)},!0)}append(I,k)};if_block(R,I=>{get$2(o)?I(N,!1):I(P)})}var J=sibling(R,2);if_block(J,I=>{}),append(r,D),pop()}delegate(["click"]);mount(App,{target:document.getElementById("app")});
