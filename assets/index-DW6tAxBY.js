(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const Ll=!1;var As=Array.isArray,hc=Array.prototype.indexOf,Ma=Array.from,pa=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,Dl=Object.getOwnPropertyDescriptors,vc=Object.prototype,pc=Array.prototype,La=Object.getPrototypeOf,Ho=Object.isExtensible;const gc=()=>{};function _c(r){return r()}function ms(r){for(var e=0;e<r.length;e++)r[e]()}function mc(){var r,e,t=new Promise((n,i)=>{r=n,e=i});return{promise:t,resolve:r,reject:e}}const lr=2,Da=4,Cs=8,ci=16,qr=32,jn=64,Fl=128,fr=256,ys=512,Zt=1024,hr=2048,rn=4096,wr=8192,Tn=16384,Fa=32768,js=65536,zo=1<<17,yc=1<<18,Di=1<<19,$l=1<<20,ga=1<<21,$a=1<<22,Sn=1<<23,Wr=Symbol("$state"),bc=Symbol("legacy props"),wc=Symbol(""),Ua=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function kc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ic(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Sc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ec(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ac(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Cc(r){throw new Error("https://svelte.dev/e/effect_orphan")}function jc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Tc(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function xc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Pc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Rc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Ts=1,xs=2,Ul=4,Oc=8,Mc=16,Lc=1,Dc=2,Fc=4,$c=8,Uc=16,Nc=1,Bc=2,Yt=Symbol(),Wc="http://www.w3.org/1999/xhtml";function Vc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let qc=!1;function Nl(r){return r===this.v}function Bl(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Gc(r,e){return r!==e}function Wl(r){return!Bl(r,this.v)}let di=!1,Hc=!1;function zc(){di=!0}let Bt=null;function bs(r){Bt=r}function Rt(r,e=!1,t){Bt={p:Bt,c:null,e:null,s:r,x:null,l:di&&!e?{s:null,u:null,$:[]}:null}}function Ot(r){var e=Bt,t=e.e;if(t!==null){e.e=null;for(var n of t)ru(n)}return Bt=e.p,{}}function fi(){return!di||Bt!==null&&Bt.l===null}const Kc=new WeakMap;function Yc(r){var e=gt;if(e===null)return mt.f|=Sn,r;if((e.f&Fa)===0){if((e.f&Fl)===0)throw!e.parent&&r instanceof Error&&Vl(r),r;e.b.error(r)}else Na(r,e)}function Na(r,e){for(;e!==null;){if((e.f&Fl)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&Vl(r),r}function Vl(r){const e=Kc.get(r);e&&(pa(r,"message",{value:e.message}),pa(r,"stack",{value:e.stack}))}let Ri=[],_a=[];function ql(){var r=Ri;Ri=[],ms(r)}function Jc(){var r=_a;_a=[],ms(r)}function Ba(r){Ri.length===0&&queueMicrotask(ql),Ri.push(r)}function Xc(){Ri.length>0&&ql(),_a.length>0&&Jc()}function Qc(){for(var r=gt.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&kc(),r}function Fi(r){var e=lr|hr,t=mt!==null&&(mt.f&lr)!==0?mt:null;return gt===null||t!==null&&(t.f&fr)!==0?e|=fr:gt.f|=Di,{ctx:Bt,deps:null,effects:null,equals:Nl,f:e,fn:r,reactions:null,rv:0,v:Yt,wv:0,parent:t??gt,ac:null}}function Zc(r,e){let t=gt;t===null&&Sc();var n=t.b,i=void 0,l=si(Yt),u=null,h=!mt;return hd(()=>{try{var v=r();u&&Promise.resolve(v).catch(()=>{})}catch(p){v=Promise.reject(p)}var g=()=>v;i=u?.then(g,g)??Promise.resolve(v),u=i;var m=Lt,b=n.pending;h&&(n.update_pending_count(1),b||m.increment());const S=(p,k=void 0)=>{u=null,b||m.activate(),k?k!==Ua&&(l.f|=Sn,ai(l,k)):((l.f&Sn)!==0&&(l.f^=Sn),ai(l,p)),h&&(n.update_pending_count(-1),b||m.decrement()),zl()};if(i.then(S,p=>S(null,p||"unknown")),m)return()=>{queueMicrotask(()=>m.neuter())}}),new Promise(v=>{function g(m){function b(){m===i?v(l):g(i)}m.then(b,b)}g(i)})}function Dt(r){const e=Fi(r);return uu(e),e}function hi(r){const e=Fi(r);return e.equals=Wl,e}function Gl(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Pr(e[t])}}function ed(r){for(var e=r.parent;e!==null;){if((e.f&lr)===0)return e;e=e.parent}return null}function Wa(r){var e,t=gt;en(ed(r));try{Gl(r),e=hu(r)}finally{en(t)}return e}function Hl(r){var e=Wa(r);if(r.equals(e)||(r.v=e,r.wv=du()),!Pn){var t=(Xr||(r.f&fr)!==0)&&r.deps!==null?rn:Zt;sr(r,t)}}function td(r,e,t){const n=fi()?Fi:hi;if(e.length===0){t(r.map(n));return}var i=Lt,l=gt,u=rd(),h=Qc();Promise.all(e.map(v=>Zc(v))).then(v=>{i?.activate(),u();try{t([...r.map(n),...v])}catch(g){(l.f&Tn)===0&&Na(g,l)}i?.deactivate(),zl()}).catch(v=>{h.error(v)})}function rd(){var r=gt,e=mt,t=Bt,n=Lt;return function(){en(r),Rr(e),bs(t),n?.activate()}}function zl(){en(null),Rr(null),bs(null)}const ea=new Set;let Lt=null,ps=null,Ko=new Set,ws=[];function Kl(){const r=ws.shift();ws.length>0&&queueMicrotask(Kl),r()}let An=[],Ps=null,ma=!1,gs=!1;class ni{current=new Map;#i=new Map;#r=new Set;#e=0;#s=null;#a=!1;#t=[];#n=[];#l=[];#o=[];#u=[];#d=[];#f=[];skipped_effects=new Set;process(e){An=[],ps=null;for(const i of e)this.#v(i);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#l,n=this.#o;this.#l=[],this.#o=[],this.#u=[],ps=Lt,Lt=null,Yo(t),Yo(n),Lt===null?Lt=this:ea.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const i of this.#t)ri(i);for(const i of this.#n)ri(i);this.#t=[],this.#n=[]}#v(e){e.f^=Zt;for(var t=e.first;t!==null;){var n=t.f,i=(n&(qr|jn))!==0,l=i&&(n&Zt)!==0,u=l||(n&wr)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(i)t.f^=Zt;else if((n&Da)!==0)this.#o.push(t);else if((n&Zt)===0)if((n&$a)!==0){var h=t.b?.pending?this.#n:this.#t;h.push(t)}else Ds(t)&&((t.f&ci)!==0&&this.#u.push(t),ri(t));var v=t.first;if(v!==null){t=v;continue}}var g=t.parent;for(t=t.next;t===null&&g!==null;)t=g.next,g=g.parent}}#c(e){for(const t of e)((t.f&hr)!==0?this.#d:this.#f).push(t),sr(t,Zt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){Lt=this}deactivate(){Lt=null,ps=null;for(const e of Ko)if(Ko.delete(e),e(),Lt!==null)break}neuter(){this.#a=!0}flush(){An.length>0?Yl():this.#h(),Lt===this&&(this.#e===0&&ea.delete(this),this.deactivate())}#h(){if(!this.#a)for(const e of this.#r)e();this.#r.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)sr(e,hr),ii(e);for(const e of this.#f)sr(e,rn),ii(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#r.add(e)}settled(){return(this.#s??=mc()).promise}static ensure(){if(Lt===null){const e=Lt=new ni;ea.add(Lt),gs||ni.enqueue(()=>{Lt===e&&e.flush()})}return Lt}static enqueue(e){ws.length===0&&queueMicrotask(Kl),ws.unshift(e)}}function nd(r){var e=gs;gs=!0;try{for(var t;;){if(Xc(),An.length===0&&(Lt?.flush(),An.length===0))return Ps=null,t;Yl()}}finally{gs=e}}function Yl(){var r=ti;ma=!0;try{var e=0;for(Zo(!0);An.length>0;){var t=ni.ensure();if(e++>1e3){var n,i;id()}t.process(An),Qr.clear()}}finally{ma=!1,Zo(r),Ps=null}}function id(){try{jc()}catch(r){Na(r,Ps)}}let kn=null;function Yo(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(Tn|wr))===0&&Ds(n)&&(kn=[],ri(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?au(n):n.fn=null),kn?.length>0)){Qr.clear();for(const i of kn)ri(i);kn=[]}}kn=null}}function ii(r){for(var e=Ps=r;e.parent!==null;){e=e.parent;var t=e.f;if(ma&&e===gt&&(t&ci)!==0)return;if((t&(jn|qr))!==0){if((t&Zt)===0)return;e.f^=Zt}}An.push(e)}const Qr=new Map;function si(r,e){var t={f:0,v:r,reactions:null,equals:Nl,rv:0,wv:0};return t}function Me(r,e){const t=si(r);return uu(t),t}function sd(r,e=!1,t=!0){const n=si(r);return e||(n.equals=Wl),di&&t&&Bt!==null&&Bt.l!==null&&(Bt.l.s??=[]).push(n),n}function ne(r,e,t=!1){mt!==null&&(!Tr||(mt.f&zo)!==0)&&fi()&&(mt.f&(lr|ci|$a|zo))!==0&&!Vr?.includes(r)&&Rc();let n=t?pt(e):e;return ai(r,n)}function ai(r,e){if(!r.equals(e)){var t=r.v;Pn?Qr.set(r,e):Qr.set(r,t),r.v=e;var n=ni.ensure();n.capture(r,t),(r.f&lr)!==0&&((r.f&hr)!==0&&Wa(r),sr(r,(r.f&fr)===0?Zt:rn)),r.wv=du(),Jl(r,hr),fi()&&gt!==null&&(gt.f&Zt)!==0&&(gt.f&(qr|jn))===0&&(dr===null?_d([r]):dr.push(r))}return e}function Zr(r,e=1){var t=f(r),n=e===1?t++:t--;return ne(r,t),n}function ta(r){ne(r,r.v+1)}function Jl(r,e){var t=r.reactions;if(t!==null)for(var n=fi(),i=t.length,l=0;l<i;l++){var u=t[l],h=u.f;if(!(!n&&u===gt)){var v=(h&hr)===0;v&&sr(u,e),(h&lr)!==0?Jl(u,rn):v&&((h&ci)!==0&&kn!==null&&kn.push(u),ii(u))}}}function pt(r){if(typeof r!="object"||r===null||Wr in r)return r;const e=La(r);if(e!==vc&&e!==pc)return r;var t=new Map,n=As(r),i=Me(0),l=En,u=h=>{if(En===l)return h();var v=mt,g=En;Rr(null),tl(l);var m=h();return Rr(v),tl(g),m};return n&&t.set("length",Me(r.length)),new Proxy(r,{defineProperty(h,v,g){(!("value"in g)||g.configurable===!1||g.enumerable===!1||g.writable===!1)&&xc();var m=t.get(v);return m===void 0?m=u(()=>{var b=Me(g.value);return t.set(v,b),b}):ne(m,g.value,!0),!0},deleteProperty(h,v){var g=t.get(v);if(g===void 0){if(v in h){const m=u(()=>Me(Yt));t.set(v,m),ta(i)}}else ne(g,Yt),ta(i);return!0},get(h,v,g){if(v===Wr)return r;var m=t.get(v),b=v in h;if(m===void 0&&(!b||ei(h,v)?.writable)&&(m=u(()=>{var p=pt(b?h[v]:Yt),k=Me(p);return k}),t.set(v,m)),m!==void 0){var S=f(m);return S===Yt?void 0:S}return Reflect.get(h,v,g)},getOwnPropertyDescriptor(h,v){var g=Reflect.getOwnPropertyDescriptor(h,v);if(g&&"value"in g){var m=t.get(v);m&&(g.value=f(m))}else if(g===void 0){var b=t.get(v),S=b?.v;if(b!==void 0&&S!==Yt)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return g},has(h,v){if(v===Wr)return!0;var g=t.get(v),m=g!==void 0&&g.v!==Yt||Reflect.has(h,v);if(g!==void 0||gt!==null&&(!m||ei(h,v)?.writable)){g===void 0&&(g=u(()=>{var S=m?pt(h[v]):Yt,p=Me(S);return p}),t.set(v,g));var b=f(g);if(b===Yt)return!1}return m},set(h,v,g,m){var b=t.get(v),S=v in h;if(n&&v==="length")for(var p=g;p<b.v;p+=1){var k=t.get(p+"");k!==void 0?ne(k,Yt):p in h&&(k=u(()=>Me(Yt)),t.set(p+"",k))}if(b===void 0)(!S||ei(h,v)?.writable)&&(b=u(()=>Me(void 0)),ne(b,pt(g)),t.set(v,b));else{S=b.v!==Yt;var x=u(()=>pt(g));ne(b,x)}var P=Reflect.getOwnPropertyDescriptor(h,v);if(P?.set&&P.set.call(m,g),!S){if(n&&typeof v=="string"){var F=t.get("length"),H=Number(v);Number.isInteger(H)&&H>=F.v&&ne(F,H+1)}ta(i)}return!0},ownKeys(h){f(i);var v=Reflect.ownKeys(h).filter(b=>{var S=t.get(b);return S===void 0||S.v!==Yt});for(var[g,m]of t)m.v!==Yt&&!(g in h)&&v.push(g);return v},setPrototypeOf(){Pc()}})}function Jo(r){try{if(r!==null&&typeof r=="object"&&Wr in r)return r[Wr]}catch{}return r}function ad(r,e){return Object.is(Jo(r),Jo(e))}var Xo,Xl,Ql,Zl;function od(){if(Xo===void 0){Xo=window,Xl=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Ql=ei(e,"firstChild").get,Zl=ei(e,"nextSibling").get,Ho(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Ho(t)&&(t.__t=void 0)}}function xn(r=""){return document.createTextNode(r)}function oi(r){return Ql.call(r)}function Rs(r){return Zl.call(r)}function E(r,e){return oi(r)}function Je(r,e){{var t=oi(r);return t instanceof Comment&&t.data===""?Rs(t):t}}function j(r,e=1,t=!1){let n=r;for(;e--;)n=Rs(n);return n}function ld(r){r.textContent=""}function Va(){return!1}let Qo=!1;function ud(){Qo||(Qo=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function Os(r){var e=mt,t=gt;Rr(null),en(null);try{return r()}finally{Rr(e),en(t)}}function qa(r,e,t,n=t){r.addEventListener(e,()=>Os(t));const i=r.__on_r;i?r.__on_r=()=>{i(),n(!0)}:r.__on_r=()=>n(!0),ud()}function eu(r){gt===null&&mt===null&&Cc(),mt!==null&&(mt.f&fr)!==0&&gt===null&&Ac(),Pn&&Ec()}function cd(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Or(r,e,t,n=!0){var i=gt;i!==null&&(i.f&wr)!==0&&(r|=wr);var l={ctx:Bt,deps:null,nodes_start:null,nodes_end:null,f:r|hr,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{ri(l),l.f|=Fa}catch(v){throw Pr(l),v}else e!==null&&ii(l);if(n){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Di)===0&&(u=u.first),u!==null&&(u.parent=i,i!==null&&cd(u,i),mt!==null&&(mt.f&lr)!==0&&(r&jn)===0)){var h=mt;(h.effects??=[]).push(u)}}return l}function tu(r){const e=Or(Cs,null,!1);return sr(e,Zt),e.teardown=r,e}function li(r){eu();var e=gt.f,t=!mt&&(e&qr)!==0&&(e&Fa)===0;if(t){var n=Bt;(n.e??=[]).push(r)}else return ru(r)}function ru(r){return Or(Da|$l,r,!1)}function dd(r){return eu(),Or(Cs|$l,r,!0)}function fd(r){ni.ensure();const e=Or(jn|Di,r,!0);return(t={})=>new Promise(n=>{t.outro?Ls(e,()=>{Pr(e),n(void 0)}):(Pr(e),n(void 0))})}function nu(r){return Or(Da,r,!1)}function hd(r){return Or($a|Di,r,!0)}function Ga(r,e=0){return Or(Cs|e,r,!0)}function ke(r,e=[],t=[]){td(e,t,n=>{Or(Cs,()=>r(...n.map(f)),!0)})}function Ms(r,e=0){var t=Or(ci|e,r,!0);return t}function Cn(r,e=!0){return Or(qr|Di,r,!0,e)}function iu(r){var e=r.teardown;if(e!==null){const t=Pn,n=mt;el(!0),Rr(null);try{e.call(null)}finally{el(t),Rr(n)}}}function su(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const i=t.ac;i!==null&&Os(()=>{i.abort(Ua)});var n=t.next;(t.f&jn)!==0?t.parent=null:Pr(t,e),t=n}}function vd(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&qr)===0&&Pr(e),e=t}}function Pr(r,e=!0){var t=!1;(e||(r.f&yc)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(pd(r.nodes_start,r.nodes_end),t=!0),su(r,e&&!t),ks(r,0),sr(r,Tn);var n=r.transitions;if(n!==null)for(const l of n)l.stop();iu(r);var i=r.parent;i!==null&&i.first!==null&&au(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function pd(r,e){for(;r!==null;){var t=r===e?null:Rs(r);r.remove(),r=t}}function au(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Ls(r,e){var t=[];Ha(r,t,!0),ou(t,()=>{Pr(r),e&&e()})}function ou(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var i of r)i.out(n)}else e()}function Ha(r,e,t){if((r.f&wr)===0){if(r.f^=wr,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var n=r.first;n!==null;){var i=n.next,l=(n.f&js)!==0||(n.f&qr)!==0;Ha(n,e,l?t:!1),n=i}}}function za(r){lu(r,!0)}function lu(r,e){if((r.f&wr)!==0){r.f^=wr,(r.f&Zt)===0&&(sr(r,hr),ii(r));for(var t=r.first;t!==null;){var n=t.next,i=(t.f&js)!==0||(t.f&qr)!==0;lu(t,i?e:!1),t=n}if(r.transitions!==null)for(const l of r.transitions)(l.is_global||e)&&l.in()}}let Jn=null;function gd(r){var e=Jn;try{if(Jn=new Set,Rn(r),e!==null)for(var t of Jn)e.add(t);return Jn}finally{Jn=e}}function yr(r){for(var e of gd(r))ai(e,e.v)}let ti=!1;function Zo(r){ti=r}let Pn=!1;function el(r){Pn=r}let mt=null,Tr=!1;function Rr(r){mt=r}let gt=null;function en(r){gt=r}let Vr=null;function uu(r){mt!==null&&(Vr===null?Vr=[r]:Vr.push(r))}let tr=null,or=0,dr=null;function _d(r){dr=r}let cu=1,Oi=0,En=Oi;function tl(r){En=r}let Xr=!1;function du(){return++cu}function Ds(r){var e=r.f;if((e&hr)!==0)return!0;if((e&rn)!==0){var t=r.deps,n=(e&fr)!==0;if(t!==null){var i,l,u=(e&ys)!==0,h=n&&gt!==null&&!Xr,v=t.length;if((u||h)&&(gt===null||(gt.f&Tn)===0)){var g=r,m=g.parent;for(i=0;i<v;i++)l=t[i],(u||!l?.reactions?.includes(g))&&(l.reactions??=[]).push(g);u&&(g.f^=ys),h&&m!==null&&(m.f&fr)===0&&(g.f^=fr)}for(i=0;i<v;i++)if(l=t[i],Ds(l)&&Hl(l),l.wv>r.wv)return!0}(!n||gt!==null&&!Xr)&&sr(r,Zt)}return!1}function fu(r,e,t=!0){var n=r.reactions;if(n!==null&&!Vr?.includes(r))for(var i=0;i<n.length;i++){var l=n[i];(l.f&lr)!==0?fu(l,e,!1):e===l&&(t?sr(l,hr):(l.f&Zt)!==0&&sr(l,rn),ii(l))}}function hu(r){var e=tr,t=or,n=dr,i=mt,l=Xr,u=Vr,h=Bt,v=Tr,g=En,m=r.f;tr=null,or=0,dr=null,Xr=(m&fr)!==0&&(Tr||!ti||mt===null),mt=(m&(qr|jn))===0?r:null,Vr=null,bs(r.ctx),Tr=!1,En=++Oi,r.ac!==null&&(Os(()=>{r.ac.abort(Ua)}),r.ac=null);try{r.f|=ga;var b=r.fn,S=b(),p=r.deps;if(tr!==null){var k;if(ks(r,or),p!==null&&or>0)for(p.length=or+tr.length,k=0;k<tr.length;k++)p[or+k]=tr[k];else r.deps=p=tr;if(!Xr||(m&lr)!==0&&r.reactions!==null)for(k=or;k<p.length;k++)(p[k].reactions??=[]).push(r)}else p!==null&&or<p.length&&(ks(r,or),p.length=or);if(fi()&&dr!==null&&!Tr&&p!==null&&(r.f&(lr|rn|hr))===0)for(k=0;k<dr.length;k++)fu(dr[k],r);return i!==null&&i!==r&&(Oi++,dr!==null&&(n===null?n=dr:n.push(...dr))),(r.f&Sn)!==0&&(r.f^=Sn),S}catch(x){return Yc(x)}finally{r.f^=ga,tr=e,or=t,dr=n,mt=i,Xr=l,Vr=u,bs(h),Tr=v,En=g}}function md(r,e){let t=e.reactions;if(t!==null){var n=hc.call(t,r);if(n!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[n]=t[i],t.pop())}}t===null&&(e.f&lr)!==0&&(tr===null||!tr.includes(e))&&(sr(e,rn),(e.f&(fr|ys))===0&&(e.f^=ys),Gl(e),ks(e,0))}function ks(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)md(r,t[n])}function ri(r){var e=r.f;if((e&Tn)===0){sr(r,Zt);var t=gt,n=ti;gt=r,ti=!0;try{(e&ci)!==0?vd(r):su(r),iu(r);var i=hu(r);r.teardown=typeof i=="function"?i:null,r.wv=cu;var l;Ll&&Hc&&(r.f&hr)!==0&&r.deps}finally{ti=n,gt=t}}}async function vu(){await Promise.resolve(),nd()}function f(r){var e=r.f,t=(e&lr)!==0;if(Jn?.add(r),mt!==null&&!Tr){var n=gt!==null&&(gt.f&Tn)!==0;if(!n&&!Vr?.includes(r)){var i=mt.deps;if((mt.f&ga)!==0)r.rv<Oi&&(r.rv=Oi,tr===null&&i!==null&&i[or]===r?or++:tr===null?tr=[r]:(!Xr||!tr.includes(r))&&tr.push(r));else{(mt.deps??=[]).push(r);var l=r.reactions;l===null?r.reactions=[mt]:l.includes(mt)||l.push(mt)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&fr)===0&&(u.f^=fr)}if(Pn){if(Qr.has(r))return Qr.get(r);if(t){u=r;var v=u.v;return((u.f&Zt)===0&&u.reactions!==null||pu(u))&&(v=Wa(u)),Qr.set(u,v),v}}else t&&(u=r,Ds(u)&&Hl(u));if((r.f&Sn)!==0)throw r.v;return r.v}function pu(r){if(r.v===Yt)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(Qr.has(e)||(e.f&lr)!==0&&pu(e))return!0;return!1}function Rn(r){var e=Tr;try{return Tr=!0,r()}finally{Tr=e}}const yd=-7169;function sr(r,e){r.f=r.f&yd|e}function bd(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Wr in r)ya(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Wr in t&&ya(t)}}}function ya(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{ya(r[n],e)}catch{}const t=La(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Dl(t);for(let i in n){const l=n[i].get;if(l)try{l.call(r)}catch{}}}}}const wd=["touchstart","touchmove"];function kd(r){return wd.includes(r)}const gu=new Set,ba=new Set;function Id(r,e,t,n={}){function i(l){if(n.capture||Ai.call(e,l),!l.cancelBubble)return Os(()=>t?.call(this,l))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Ba(()=>{e.addEventListener(r,i,n)}):e.addEventListener(r,i,n),i}function Sd(r,e,t,n,i){var l={capture:n,passive:i},u=Id(r,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&tu(()=>{e.removeEventListener(r,u,l)})}function Ft(r){for(var e=0;e<r.length;e++)gu.add(r[e]);for(var t of ba)t(r)}let rl=null;function Ai(r){var e=this,t=e.ownerDocument,n=r.type,i=r.composedPath?.()||[],l=i[0]||r.target;rl=r;var u=0,h=rl===r&&r.__root;if(h){var v=i.indexOf(h);if(v!==-1&&(e===document||e===window)){r.__root=e;return}var g=i.indexOf(e);if(g===-1)return;v<=g&&(u=v)}if(l=i[u]||r.target,l!==e){pa(r,"currentTarget",{configurable:!0,get(){return l||t}});var m=mt,b=gt;Rr(null),en(null);try{for(var S,p=[];l!==null;){var k=l.assignedSlot||l.parentNode||l.host||null;try{var x=l["__"+n];if(x!=null&&(!l.disabled||r.target===l))if(As(x)){var[P,...F]=x;P.apply(l,[r,...F])}else x.call(l,r)}catch(H){S?p.push(H):S=H}if(r.cancelBubble||k===e||k===null)break;l=k}if(S){for(let H of p)queueMicrotask(()=>{throw H});throw S}}finally{r.__root=e,delete r.currentTarget,Rr(m),en(b)}}}function _u(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function Mi(r,e){var t=gt;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function X(r,e){var t=(e&Nc)!==0,n=(e&Bc)!==0,i,l=!r.startsWith("<!>");return()=>{i===void 0&&(i=_u(l?r:"<!>"+r),t||(i=oi(i)));var u=n||Xl?document.importNode(i,!0):i.cloneNode(!0);if(t){var h=oi(u),v=u.lastChild;Mi(h,v)}else Mi(u,u);return u}}function Ed(r,e,t="svg"){var n=!r.startsWith("<!>"),i=`<${t}>${n?r:"<!>"+r}</${t}>`,l;return()=>{if(!l){var u=_u(i),h=oi(u);l=oi(h)}var v=l.cloneNode(!0);return Mi(v,v),v}}function Ad(r,e){return Ed(r,e,"svg")}function ls(r=""){{var e=xn(r+"");return Mi(e,e),e}}function St(){var r=document.createDocumentFragment(),e=document.createComment(""),t=xn();return r.append(e,t),Mi(e,t),r}function W(r,e){r!==null&&r.before(e)}function me(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function Cd(r,e){return jd(r,e)}const Un=new Map;function jd(r,{target:e,anchor:t,props:n={},events:i,context:l,intro:u=!0}){od();var h=new Set,v=b=>{for(var S=0;S<b.length;S++){var p=b[S];if(!h.has(p)){h.add(p);var k=kd(p);e.addEventListener(p,Ai,{passive:k});var x=Un.get(p);x===void 0?(document.addEventListener(p,Ai,{passive:k}),Un.set(p,1)):Un.set(p,x+1)}}};v(Ma(gu)),ba.add(v);var g=void 0,m=fd(()=>{var b=t??e.appendChild(xn());return Cn(()=>{if(l){Rt({});var S=Bt;S.c=l}i&&(n.$$events=i),g=r(b,n)||{},l&&Ot()}),()=>{for(var S of h){e.removeEventListener(S,Ai);var p=Un.get(S);--p===0?(document.removeEventListener(S,Ai),Un.delete(S)):Un.set(S,p)}ba.delete(v),b!==t&&b.parentNode?.removeChild(b)}});return Td.set(g,m),g}let Td=new WeakMap;function Re(r,e,t=!1){var n=r,i=null,l=null,u=Yt,h=t?js:0,v=!1;const g=(p,k=!0)=>{v=!0,S(k,p)};var m=null;function b(){m!==null&&(m.lastChild.remove(),n.before(m),m=null);var p=u?i:l,k=u?l:i;p&&za(p),k&&Ls(k,()=>{u?l=null:i=null})}const S=(p,k)=>{if(u!==(u=p)){var x=Va(),P=n;if(x&&(m=document.createDocumentFragment(),m.append(P=xn())),u?i??=k&&Cn(()=>k(P)):l??=k&&Cn(()=>k(P)),x){var F=Lt,H=u?i:l,L=u?l:i;H&&F.skipped_effects.delete(H),L&&F.skipped_effects.add(L),F.add_callback(b)}else b()}};Ms(()=>{v=!1,e(g),v||S(null,null)},h)}function wa(r,e,t){var n=r,i=Yt,l,u,h=null,v=fi()?Gc:Bl;function g(){l&&Ls(l),h!==null&&(h.lastChild.remove(),n.before(h),h=null),l=u}Ms(()=>{if(v(i,i=e())){var m=n,b=Va();b&&(h=document.createDocumentFragment(),h.append(m=xn())),u=Cn(()=>t(m)),b?Lt.add_callback(g):g()}})}function xt(r,e){return e}function xd(r,e,t){for(var n=r.items,i=[],l=e.length,u=0;u<l;u++)Ha(e[u].e,i,!0);var h=l>0&&i.length===0&&t!==null;if(h){var v=t.parentNode;ld(v),v.append(t),n.clear(),Ar(r,e[0].prev,e[l-1].next)}ou(i,()=>{for(var g=0;g<l;g++){var m=e[g];h||(n.delete(m.k),Ar(r,m.prev,m.next)),Pr(m.e,!h)}})}function Ze(r,e,t,n,i,l=null){var u=r,h={flags:e,items:new Map,first:null},v=(e&Ul)!==0;if(v){var g=r;u=g.appendChild(xn())}var m=null,b=!1,S=new Map,p=hi(()=>{var F=t();return As(F)?F:F==null?[]:Ma(F)}),k,x;function P(){Pd(x,k,h,S,u,i,e,n,t),l!==null&&(k.length===0?m?za(m):m=Cn(()=>l(u)):m!==null&&Ls(m,()=>{m=null}))}Ms(()=>{x??=gt,k=f(p);var F=k.length;if(!(b&&F===0)){b=F===0;var H,L,U,$;if(Va()){var C=new Set,O=Lt;for(L=0;L<F;L+=1){U=k[L],$=n(U,L);var ie=h.items.get($)??S.get($);ie?(e&(Ts|xs))!==0&&mu(ie,U,L,e):(H=yu(null,h,null,null,U,$,L,i,e,t,!0),S.set($,H)),C.add($)}for(const[oe,ve]of h.items)C.has(oe)||O.skipped_effects.add(ve.e);O.add_callback(P)}else P();f(p)}})}function Pd(r,e,t,n,i,l,u,h,v){var g=(u&Oc)!==0,m=(u&(Ts|xs))!==0,b=e.length,S=t.items,p=t.first,k=p,x,P=null,F,H=[],L=[],U,$,C,O;if(g)for(O=0;O<b;O+=1)U=e[O],$=h(U,O),C=S.get($),C!==void 0&&(C.a?.measure(),(F??=new Set).add(C));for(O=0;O<b;O+=1){if(U=e[O],$=h(U,O),C=S.get($),C===void 0){var ie=n.get($);if(ie!==void 0){n.delete($),S.set($,ie);var oe=P?P.next:k;Ar(t,P,ie),Ar(t,ie,oe),ra(ie,oe,i),P=ie}else{var ve=k?k.e.nodes_start:i;P=yu(ve,t,P,P===null?t.first:P.next,U,$,O,l,u,v)}S.set($,P),H=[],L=[],k=P.next;continue}if(m&&mu(C,U,O,u),(C.e.f&wr)!==0&&(za(C.e),g&&(C.a?.unfix(),(F??=new Set).delete(C))),C!==k){if(x!==void 0&&x.has(C)){if(H.length<L.length){var fe=L[0],le;P=fe.prev;var Y=H[0],K=H[H.length-1];for(le=0;le<H.length;le+=1)ra(H[le],fe,i);for(le=0;le<L.length;le+=1)x.delete(L[le]);Ar(t,Y.prev,K.next),Ar(t,P,Y),Ar(t,K,fe),k=fe,P=K,O-=1,H=[],L=[]}else x.delete(C),ra(C,k,i),Ar(t,C.prev,C.next),Ar(t,C,P===null?t.first:P.next),Ar(t,P,C),P=C;continue}for(H=[],L=[];k!==null&&k.k!==$;)(k.e.f&wr)===0&&(x??=new Set).add(k),L.push(k),k=k.next;if(k===null)continue;C=k}H.push(C),P=C,k=C.next}if(k!==null||x!==void 0){for(var G=x===void 0?[]:Ma(x);k!==null;)(k.e.f&wr)===0&&G.push(k),k=k.next;var V=G.length;if(V>0){var R=(u&Ul)!==0&&b===0?i:null;if(g){for(O=0;O<V;O+=1)G[O].a?.measure();for(O=0;O<V;O+=1)G[O].a?.fix()}xd(t,G,R)}}g&&Ba(()=>{if(F!==void 0)for(C of F)C.a?.apply()}),r.first=t.first&&t.first.e,r.last=P&&P.e;for(var Q of n.values())Pr(Q.e);n.clear()}function mu(r,e,t,n){(n&Ts)!==0&&ai(r.v,e),(n&xs)!==0?ai(r.i,t):r.i=t}function yu(r,e,t,n,i,l,u,h,v,g,m){var b=(v&Ts)!==0,S=(v&Mc)===0,p=b?S?sd(i,!1,!1):si(i):i,k=(v&xs)===0?u:si(u),x={i:k,v:p,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var P=document.createDocumentFragment();P.append(r=xn())}return x.e=Cn(()=>h(r,p,k,g),qc),x.e.prev=t&&t.e,x.e.next=n&&n.e,t===null?m||(e.first=x):(t.next=x,t.e.next=x.e),n!==null&&(n.prev=x,n.e.prev=x.e),x}finally{}}function ra(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var u=Rs(l);i.before(l),l=u}}function Ar(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ka(r,e,...t){var n=r,i=gc,l;Ms(()=>{i!==(i=e())&&(l&&(Pr(l),l=null),l=Cn(()=>i(n,...t)))},js)}const nl=[...` 	
\r\f \v\uFEFF`];function Rd(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var i in t)if(t[i])n=n?n+" "+i:i;else if(n.length)for(var l=i.length,u=0;(u=n.indexOf(i,u))>=0;){var h=u+l;(u===0||nl.includes(n[u-1]))&&(h===n.length||nl.includes(n[h]))?n=(u===0?"":n.substring(0,u))+n.substring(h+1):u=h}}return n===""?null:n}function Od(r,e){return r==null?null:String(r)}function Nt(r,e,t,n,i,l){var u=r.__className;if(u!==t||u===void 0){var h=Rd(t,n,l);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(l&&i!==l)for(var v in l){var g=!!l[v];(i==null||g!==!!i[v])&&r.classList.toggle(v,g)}return l}function ir(r,e,t,n){var i=r.__style;if(i!==e){var l=Od(e);l==null?r.removeAttribute("style"):r.style.cssText=l,r.__style=e}return n}function Yr(r,e,t=!1){if(r.multiple){if(e==null)return;if(!As(e))return Vc();for(var n of r.options)n.selected=e.includes(ji(n));return}for(n of r.options){var i=ji(n);if(ad(i,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function bn(r){var e=new MutationObserver(()=>{Yr(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),tu(()=>{e.disconnect()})}function Zn(r,e,t=e){var n=!0;qa(r,"change",i=>{var l=i?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(l),ji);else{var h=r.querySelector(l)??r.querySelector("option:not([disabled])");u=h&&ji(h)}t(u)}),nu(()=>{var i=e();if(Yr(r,i,n),n&&i===void 0){var l=r.querySelector(":checked");l!==null&&(i=ji(l),t(i))}r.__value=i,n=!1}),bn(r)}function ji(r){return"__value"in r?r.__value:r.value}const Md=Symbol("is custom element"),Ld=Symbol("is html");function na(r,e){var t=Ya(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Dd(r,e){var t=Ya(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Ne(r,e,t,n){var i=Ya(r);i[e]!==(i[e]=t)&&(e==="loading"&&(r[wc]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Fd(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Ya(r){return r.__attributes??={[Md]:r.nodeName.includes("-"),[Ld]:r.namespaceURI===Wc}}var il=new Map;function Fd(r){var e=r.getAttribute("is")||r.nodeName,t=il.get(e);if(t)return t;il.set(e,t=[]);for(var n,i=r,l=Element.prototype;l!==i;){n=Dl(i);for(var u in n)n[u].set&&t.push(u);i=La(i)}return t}function Br(r,e,t=e){var n=new WeakSet;qa(r,"input",async i=>{var l=i?r.defaultValue:r.value;if(l=ia(r)?sa(l):l,t(l),Lt!==null&&n.add(Lt),await vu(),l!==(l=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=l??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),Rn(e)==null&&r.value&&(t(ia(r)?sa(r.value):r.value),Lt!==null&&n.add(Lt)),Ga(()=>{var i=e();if(r===document.activeElement){var l=ps??Lt;if(n.has(l))return}ia(r)&&i===sa(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function sl(r,e,t=e){qa(r,"change",n=>{var i=n?r.defaultChecked:r.checked;t(i)}),Rn(e)==null&&t(r.checked),Ga(()=>{var n=e();r.checked=!!n})}function ia(r){var e=r.type;return e==="number"||e==="range"}function sa(r){return r===""?null:+r}function al(r,e){return r===e||r?.[Wr]===e}function ka(r={},e,t,n){return nu(()=>{var i,l;return Ga(()=>{i=l,l=[],Rn(()=>{r!==t(...l)&&(e(r,...l),i&&al(t(...i),r)&&e(null,...i))})}),()=>{Ba(()=>{l&&al(t(...l),r)&&e(null,...l)})}}),r}function nn(r=!1){const e=Bt,t=e.l.u;if(!t)return;let n=()=>bd(e.s);if(r){let i=0,l={};const u=Fi(()=>{let h=!1;const v=e.s;for(const g in v)v[g]!==l[g]&&(l[g]=v[g],h=!0);return h&&i++,i});n=()=>f(u)}t.b.length&&dd(()=>{ol(e,n),ms(t.b)}),li(()=>{const i=Rn(()=>t.m.map(_c));return()=>{for(const l of i)typeof l=="function"&&l()}}),t.a.length&&li(()=>{ol(e,n),ms(t.a)})}function ol(r,e){if(r.l.s)for(const t of r.l.s)f(t);e()}function sn(r){var e=si(0);return function(){return arguments.length===1?(ne(e,f(e)+1),arguments[0]):(f(e),r())}}let us=!1;function $d(r){var e=us;try{return us=!1,[r(),us]}finally{us=e}}function ze(r,e,t,n){var i=!di||(t&Dc)!==0,l=(t&$c)!==0,u=(t&Uc)!==0,h=n,v=!0,g=()=>(v&&(v=!1,h=u?Rn(n):n),h),m;if(l){var b=Wr in r||bc in r;m=ei(r,e)?.set??(b&&e in r?L=>r[e]=L:void 0)}var S,p=!1;l?[S,p]=$d(()=>r[e]):S=r[e],S===void 0&&n!==void 0&&(S=g(),m&&(i&&Tc(),m(S)));var k;if(i?k=()=>{var L=r[e];return L===void 0?g():(v=!0,L)}:k=()=>{var L=r[e];return L!==void 0&&(h=void 0),L===void 0?h:L},i&&(t&Fc)===0)return k;if(m){var x=r.$$legacy;return(function(L,U){return arguments.length>0?((!i||!U||x||p)&&m(U?k():L),L):k()})}var P=!1,F=((t&Lc)!==0?Fi:hi)(()=>(P=!1,k()));l&&f(F);var H=gt;return(function(L,U){if(arguments.length>0){const $=U?f(F):i&&l?pt(L):L;return ne(F,$),P=!0,h!==void 0&&(h=$),L}return Pn&&P||(H.f&Tn)!==0?F.v:f(F)})}function kr(r){Bt===null&&Ic(),di&&Bt.l!==null?Ud(Bt).m.push(r):li(()=>{const e=Rn(r);if(typeof e=="function")return e})}function Ud(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Nd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Nd);zc();const B=pt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Jt={get currentDialogue(){return B.data?.dialogues.find(r=>r.id===B.selectedDialogueId)},get currentChapter(){return B.data?.chapters?.find(r=>r.id===B.selectedChapterId)},get currentEditingChapter(){return B.data?.chapters?.find(r=>r.id===B.editingChapterId)},get currentEditingOption(){return Jt.currentDialogue&&B.editingOptionIndex!==null?Jt.currentDialogue.options?.[B.editingOptionIndex]:void 0},get chapterDialogues(){return!B.data?.dialogues||!B.selectedChapterId?[]:B.data.dialogues.filter(r=>r.chapterId===B.selectedChapterId)},get imageResources(){return B.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return B.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return B.data?.items||[]},get backlinks(){return!B.data||!B.selectedDialogueId?[]:B.data.dialogues.filter(r=>r.nextDialogueId===B.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===B.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},bt={toggleEditor(){B.showEditor=!B.showEditor},toggleItemsPanel(){B.showItems=!B.showItems},setStatus(r,e){B.statusMessage={type:r,text:e}},clearStatus(){B.statusMessage={type:"",text:""}},selectBucket(r){B.selectedBucket=r,B.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},B.storedFiles=[],B.storiesList=[],B.selectedChapterId=null,B.selectedDialogueId=null},updateBucketsList(r){B.availableBuckets=r},selectChapter(r){B.selectedChapterId=r,B.selectedDialogueId=null},selectDialogue(r){B.selectedDialogueId=r},selectOption(r){B.editingOptionIndex=r},selectItem(r){B.editingItemIndex=r},updateStoryData(r){B.data=r},updateStoredFiles(r){B.storedFiles=r},updateStoriesList(r){B.storiesList=r},setCurrentFileName(r){B.currentFileName=r},addDialogue(r){B.data.dialogues=[...B.data.dialogues,r]},updateDialogue(r,e){B.data.dialogues=B.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){B.data.dialogues=B.data.dialogues.filter(e=>e.id!==r),B.selectedDialogueId===r&&(B.selectedDialogueId=null)},addChapter(r){B.data.chapters=[...B.data.chapters||[],r]},updateChapter(r,e){B.data.chapters&&(B.data.chapters=B.data.chapters.map(t=>t.id===r?{...t,...e}:t))},selectEditingChapter(r){B.editingChapterId=r},deleteChapter(r){B.data.chapters&&(B.data.chapters=B.data.chapters.filter(e=>e.id!==r),B.selectedChapterId===r&&(B.selectedChapterId=null,B.selectedDialogueId=null))},addItem(r){B.data.items=[...B.data.items||[],r]},updateItem(r,e){B.data.items&&(B.data.items=B.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){B.data.items&&(B.data.items=B.data.items.filter(e=>e.id!==r))},reset(){B.showEditor=!1,B.showItems=!1,B.editingOptionIndex=null,B.editingItemIndex=null,B.selectedChapterId=null,B.selectedDialogueId=null,B.statusMessage={type:"",text:""}}},Bd="modulepreload",Wd=function(r,e){return new URL(r,e).href},ll={},$i=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let g=function(m){return Promise.all(m.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),v=h?.nonce||h?.getAttribute("nonce");i=g(t.map(m=>{if(m=Wd(m,n),m in ll)return;ll[m]=!0;const b=m.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(!!n)for(let x=u.length-1;x>=0;x--){const P=u[x];if(P.href===m&&(!b||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${S}`))return;const k=document.createElement("link");if(k.rel=b?"stylesheet":Bd,b||(k.as="script"),k.crossOrigin="",k.href=m,v&&k.setAttribute("nonce",v),document.head.appendChild(k),b)return new Promise((x,P)=>{k.addEventListener("load",x),k.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Vd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:n}=await Promise.resolve().then(()=>vi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Ja extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class qd extends Ja{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ul extends Ja{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class cl extends Ja{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ia;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Ia||(Ia={}));var Gd=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};class Hd{constructor(e,{headers:t={},customFetch:n,region:i=Ia.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Vd(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Gd(this,void 0,void 0,function*(){try{const{headers:i,method:l,body:u}=t;let h={},{region:v}=t;v||(v=this.region);const g=new URL(`${this.url}/${e}`);v&&v!=="any"&&(h["x-region"]=v,g.searchParams.set("forceFunctionRegion",v));let m;u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",m=u):typeof u=="string"?(h["Content-Type"]="text/plain",m=u):typeof FormData<"u"&&u instanceof FormData?m=u:(h["Content-Type"]="application/json",m=JSON.stringify(u)));const b=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),i),body:m}).catch(x=>{throw new qd(x)}),S=b.headers.get("x-relay-error");if(S&&S==="true")throw new ul(b);if(!b.ok)throw new cl(b);let p=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),k;return p==="application/json"?k=yield b.json():p==="application/octet-stream"?k=yield b.blob():p==="text/event-stream"?k=b:p==="multipart/form-data"?k=yield b.formData():k=yield b.text(),{data:k,error:null,response:b}}catch(i){return{data:null,error:i,response:i instanceof cl||i instanceof ul?i.context:void 0}}})}}function zd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Kd(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Kt={},Nn={},Bn={},Wn={},Vn={},qn={},Yd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ui=Yd();const Jd=ui.fetch,bu=ui.fetch.bind(ui),wu=ui.Headers,Xd=ui.Request,Qd=ui.Response,vi=Object.freeze(Object.defineProperty({__proto__:null,Headers:wu,Request:Xd,Response:Qd,default:bu,fetch:Jd},Symbol.toStringTag,{value:"Module"})),Zd=Kd(vi);var cs={},dl;function ku(){if(dl)return cs;dl=1,Object.defineProperty(cs,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return cs.default=r,cs}var fl;function Iu(){if(fl)return qn;fl=1;var r=qn&&qn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qn,"__esModule",{value:!0});const e=r(Zd),t=r(ku());class n{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let v=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var m,b,S,p;let k=null,x=null,P=null,F=g.status,H=g.statusText;if(g.ok){if(this.method!=="HEAD"){const C=await g.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?x=C:x=JSON.parse(C))}const U=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),$=(S=g.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");U&&$&&$.length>1&&(P=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(x)&&(x.length>1?(k={code:"PGRST116",details:`Results contain ${x.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},x=null,P=null,F=406,H="Not Acceptable"):x.length===1?x=x[0]:x=null)}else{const U=await g.text();try{k=JSON.parse(U),Array.isArray(k)&&g.status===404&&(x=[],k=null,F=200,H="OK")}catch{g.status===404&&U===""?(F=204,H="No Content"):k={message:U}}if(k&&this.isMaybeSingle&&(!((p=k?.details)===null||p===void 0)&&p.includes("0 rows"))&&(k=null,F=200,H="OK"),k&&this.shouldThrowOnError)throw new t.default(k)}return{error:k,data:x,count:P,status:F,statusText:H}});return this.shouldThrowOnError||(v=v.catch(g=>{var m,b,S;return{error:{message:`${(m=g?.name)!==null&&m!==void 0?m:"FetchError"}: ${g?.message}`,details:`${(b=g?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(S=g?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,u)}returns(){return this}overrideTypes(){return this}}return qn.default=n,qn}var hl;function Su(){if(hl)return Vn;hl=1;var r=Vn&&Vn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vn,"__esModule",{value:!0});const e=r(Iu());class t extends e.default{select(i){let l=!1;const u=(i??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:v=h}={}){const g=v?`${v}.order`:"order",m=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${m?`${m},`:""}${i}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${i}`),this}range(i,l,{foreignTable:u,referencedTable:h=u}={}){const v=typeof h>"u"?"offset":`${h}.offset`,g=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(v,`${i}`),this.url.searchParams.set(g,`${l-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:v=!1,format:g="text"}={}){var m;const b=[i?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,v?"wal":null].filter(Boolean).join("|"),S=(m=this.headers.get("Accept"))!==null&&m!==void 0?m:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${g}; for="${S}"; options=${b};`),g==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Vn.default=t,Vn}var vl;function Xa(){if(vl)return Wn;vl=1;var r=Wn&&Wn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wn,"__esModule",{value:!0});const e=r(Su());class t extends e.default{eq(i,l){return this.url.searchParams.append(i,`eq.${l}`),this}neq(i,l){return this.url.searchParams.append(i,`neq.${l}`),this}gt(i,l){return this.url.searchParams.append(i,`gt.${l}`),this}gte(i,l){return this.url.searchParams.append(i,`gte.${l}`),this}lt(i,l){return this.url.searchParams.append(i,`lt.${l}`),this}lte(i,l){return this.url.searchParams.append(i,`lte.${l}`),this}like(i,l){return this.url.searchParams.append(i,`like.${l}`),this}likeAllOf(i,l){return this.url.searchParams.append(i,`like(all).{${l.join(",")}}`),this}likeAnyOf(i,l){return this.url.searchParams.append(i,`like(any).{${l.join(",")}}`),this}ilike(i,l){return this.url.searchParams.append(i,`ilike.${l}`),this}ilikeAllOf(i,l){return this.url.searchParams.append(i,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(i,l){return this.url.searchParams.append(i,`ilike(any).{${l.join(",")}}`),this}is(i,l){return this.url.searchParams.append(i,`is.${l}`),this}in(i,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cs.{${l.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(l)}`),this}containedBy(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cd.{${l.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(l)}`),this}rangeGt(i,l){return this.url.searchParams.append(i,`sr.${l}`),this}rangeGte(i,l){return this.url.searchParams.append(i,`nxl.${l}`),this}rangeLt(i,l){return this.url.searchParams.append(i,`sl.${l}`),this}rangeLte(i,l){return this.url.searchParams.append(i,`nxr.${l}`),this}rangeAdjacent(i,l){return this.url.searchParams.append(i,`adj.${l}`),this}overlaps(i,l){return typeof l=="string"?this.url.searchParams.append(i,`ov.${l}`):this.url.searchParams.append(i,`ov.{${l.join(",")}}`),this}textSearch(i,l,{config:u,type:h}={}){let v="";h==="plain"?v="pl":h==="phrase"?v="ph":h==="websearch"&&(v="w");const g=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${v}fts${g}.${l}`),this}match(i){return Object.entries(i).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(i,l,u){return this.url.searchParams.append(i,`not.${l}.${u}`),this}or(i,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${i})`),this}filter(i,l,u){return this.url.searchParams.append(i,`${l}.${u}`),this}}return Wn.default=t,Wn}var pl;function Eu(){if(pl)return Bn;pl=1;var r=Bn&&Bn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=r(Xa());class t{constructor(i,{headers:l={},schema:u,fetch:h}){this.url=i,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(i,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let v=!1;const g=(i??"*").split("").map(m=>/\s/.test(m)&&!v?"":(m==='"'&&(v=!v),m)).join("");return this.url.searchParams.set("select",g),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:l,defaultToNull:u=!0}={}){var h;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const g=i.reduce((m,b)=>m.concat(Object.keys(b)),[]);if(g.length>0){const m=[...new Set(g)].map(b=>`"${b}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(i,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:v=!0}={}){var g;const m="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const b=i.reduce((S,p)=>S.concat(Object.keys(p)),[]);if(b.length>0){const S=[...new Set(b)].map(p=>`"${p}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}update(i,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:i}={}){var l;const u="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Bn.default=t,Bn}var gl;function ef(){if(gl)return Nn;gl=1;var r=Nn&&Nn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Nn,"__esModule",{value:!0});const e=r(Eu()),t=r(Xa());class n{constructor(l,{headers:u={},schema:h,fetch:v}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=v}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:v=!1,count:g}={}){var m;let b;const S=new URL(`${this.url}/rpc/${l}`);let p;h||v?(b=h?"HEAD":"GET",Object.entries(u).filter(([x,P])=>P!==void 0).map(([x,P])=>[x,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([x,P])=>{S.searchParams.append(x,P)})):(b="POST",p=u);const k=new Headers(this.headers);return g&&k.set("Prefer",`count=${g}`),new t.default({method:b,url:S,headers:k,schema:this.schemaName,body:p,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}}return Nn.default=n,Nn}var _l;function tf(){if(_l)return Kt;_l=1;var r=Kt&&Kt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PostgrestError=Kt.PostgrestBuilder=Kt.PostgrestTransformBuilder=Kt.PostgrestFilterBuilder=Kt.PostgrestQueryBuilder=Kt.PostgrestClient=void 0;const e=r(ef());Kt.PostgrestClient=e.default;const t=r(Eu());Kt.PostgrestQueryBuilder=t.default;const n=r(Xa());Kt.PostgrestFilterBuilder=n.default;const i=r(Su());Kt.PostgrestTransformBuilder=i.default;const l=r(Iu());Kt.PostgrestBuilder=l.default;const u=r(ku());return Kt.PostgrestError=u.default,Kt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:u.default},Kt}var rf=tf();const nf=zd(rf),{PostgrestClient:sf,PostgrestQueryBuilder:k_,PostgrestFilterBuilder:I_,PostgrestTransformBuilder:S_,PostgrestBuilder:E_,PostgrestError:A_}=nf;class af{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const of="2.15.1",lf=`realtime-js/${of}`,uf="1.0.0",Sa=1e4,cf=1e3,df=100;var Ti;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Ti||(Ti={}));var qt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(qt||(qt={}));var br;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(br||(br={}));var Ea;(function(r){r.websocket="websocket"})(Ea||(Ea={}));var In;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(In||(In={}));class ff{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const i=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=n.decode(e.slice(u,u+i));u=u+i;const v=n.decode(e.slice(u,u+l));u=u+l;const g=JSON.parse(n.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:v,payload:g}}}class Au{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Pt;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Pt||(Pt={}));const ml=(r,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((l,u)=>(l[u]=hf(u,r,e,i),l),{})},hf=(r,e,t,n)=>{const i=e.find(h=>h.name===r),l=i?.type,u=t[r];return l&&!n.includes(l)?Cu(l,u):Aa(u)},Cu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return _f(e,t)}switch(r){case Pt.bool:return vf(e);case Pt.float4:case Pt.float8:case Pt.int2:case Pt.int4:case Pt.int8:case Pt.numeric:case Pt.oid:return pf(e);case Pt.json:case Pt.jsonb:return gf(e);case Pt.timestamp:return mf(e);case Pt.abstime:case Pt.date:case Pt.daterange:case Pt.int4range:case Pt.int8range:case Pt.money:case Pt.reltime:case Pt.text:case Pt.time:case Pt.timestamptz:case Pt.timetz:case Pt.tsrange:case Pt.tstzrange:return Aa(e);default:return Aa(e)}},Aa=r=>r,vf=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},pf=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},gf=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},_f=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let l;const u=r.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>Cu(e,h))}return r},mf=r=>typeof r=="string"?r.replace(" ","T"):r,ju=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class aa{constructor(e,t,n={},i=Sa){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var yl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(yl||(yl={}));class xi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xi.syncState(this.state,i,l,u),this.pendingDiffs.forEach(v=>{this.state=xi.syncDiff(this.state,v,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=xi.syncDiff(this.state,i,l,u),h())}),this.onJoin((i,l,u)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:l,newPresences:u})}),this.onLeave((i,l,u)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const l=this.cloneDeep(e),u=this.transformState(t),h={},v={};return this.map(l,(g,m)=>{u[g]||(v[g]=m)}),this.map(u,(g,m)=>{const b=l[g];if(b){const S=m.map(P=>P.presence_ref),p=b.map(P=>P.presence_ref),k=m.filter(P=>p.indexOf(P.presence_ref)<0),x=b.filter(P=>S.indexOf(P.presence_ref)<0);k.length>0&&(h[g]=k),x.length>0&&(v[g]=x)}else h[g]=m}),this.syncDiff(l,{joins:h,leaves:v},n,i)}static syncDiff(e,t,n,i){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(l,(h,v)=>{var g;const m=(g=e[h])!==null&&g!==void 0?g:[];if(e[h]=this.cloneDeep(v),m.length>0){const b=e[h].map(p=>p.presence_ref),S=m.filter(p=>b.indexOf(p.presence_ref)<0);e[h].unshift(...S)}n(h,m,v)}),this.map(u,(h,v)=>{let g=e[h];if(!g)return;const m=v.map(b=>b.presence_ref);g=g.filter(b=>m.indexOf(b.presence_ref)<0),e[h]=g,i(h,g,v),g.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bl;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(bl||(bl={}));var Pi;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Pi||(Pi={}));var Nr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Nr||(Nr={}));class Qa{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new aa(this,br.join,this.params,this.timeout),this.rejoinTimer=new Au(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(br.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new xi(this),this.broadcastEndpointURL=ju(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==qt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,v=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(S=>S.filter))!==null&&i!==void 0?i:[],g=!!this.bindings[Pi.PRESENCE]&&this.bindings[Pi.PRESENCE].length>0,m={},b={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:g}),postgres_changes:v,private:h};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(S=>e?.(Nr.CHANNEL_ERROR,S)),this._onClose(()=>e?.(Nr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var p;if(this.socket.setAuth(),S===void 0){e?.(Nr.SUBSCRIBED);return}else{const k=this.bindings.postgres_changes,x=(p=k?.length)!==null&&p!==void 0?p:0,P=[];for(let F=0;F<x;F++){const H=k[F],{filter:{event:L,schema:U,table:$,filter:C}}=H,O=S&&S[F];if(O&&O.event===L&&O.schema===U&&O.table===$&&O.filter===C)P.push(Object.assign(Object.assign({},H),{id:O.id}));else{this.unsubscribe(),this.state=qt.errored,e?.(Nr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e(Nr.SUBSCRIBED);return}}).receive("error",S=>{this.state=qt.errored,e?.(Nr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.(Nr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===qt.joined&&e===Pi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const g=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=g.body)===null||i===void 0?void 0:i.cancel()),g.ok?"ok":"error"}catch(g){return g.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,v;const g=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),g.receive("ok",()=>l("ok")),g.receive("error",()=>l("error")),g.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(br.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new aa(this,br.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,l=setTimeout(()=>i.abort(),n),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(l),u}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new aa(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>df){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,l;const u=e.toLocaleLowerCase(),{close:h,error:v,leave:g,join:m}=br;if(n&&[h,v,g,m].indexOf(u)>=0&&n!==this._joinRef())return;let S=this._onMessage(u,t,n);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var k,x,P;return((k=p.filter)===null||k===void 0?void 0:k.event)==="*"||((P=(x=p.filter)===null||x===void 0?void 0:x.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===u}).map(p=>p.callback(S,n)):(l=this.bindings[u])===null||l===void 0||l.filter(p=>{var k,x,P,F,H,L;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const U=p.id,$=(k=p.filter)===null||k===void 0?void 0:k.event;return U&&((x=t.ids)===null||x===void 0?void 0:x.includes(U))&&($==="*"||$?.toLocaleLowerCase()===((P=t.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const U=(H=(F=p?.filter)===null||F===void 0?void 0:F.event)===null||H===void 0?void 0:H.toLocaleLowerCase();return U==="*"||U===((L=t?.event)===null||L===void 0?void 0:L.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof S=="object"&&"ids"in S){const k=S.data,{schema:x,table:P,commit_timestamp:F,type:H,errors:L}=k;S=Object.assign(Object.assign({},{schema:x,table:P,commit_timestamp:F,eventType:H,new:{},old:{},errors:L}),this._getPayloadRecords(k))}p.callback(S,n)})}_isClosed(){return this.state===qt.closed}_isJoined(){return this.state===qt.joined}_isJoining(){return this.state===qt.joining}_isLeaving(){return this.state===qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),l={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(l):this.bindings[i]=[l],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var l;return!(((l=i.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&Qa.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(br.close,{},e)}_onError(e){this._on(br.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ml(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ml(e.columns,e.old_record)),t}}const wl=()=>{},ds={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},yf=[1e3,2e3,5e3,1e4],bf=1e4,wf=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class kf{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Sa,this.transport=null,this.heartbeatIntervalMs=ds.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=wl,this.ref=0,this.reconnectTimer=null,this.logger=wl,this.conn=null,this.sendBuffer=[],this.serializer=new ff,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...u)=>$i(async()=>{const{default:h}=await Promise.resolve().then(()=>vi);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ea.websocket}`,this.httpEndpoint=ju(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=af.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:uf}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ti.connecting:return In.Connecting;case Ti.open:return In.Open;case Ti.closing:return In.Closing;default:return In.Closed}}isConnected(){return this.connectionState()===In.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(l=>l.topic===n);if(i)return i;{const l=new Qa(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:n,payload:i,ref:l}=e,u=()=>{this.encode(e,h=>{var v;(v=this.conn)===null||v===void 0||v.send(h)})};this.log("push",`${t} ${n} (${l})`,i),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(cf,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ds.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:l,ref:u}=t,h=u?`(${u})`:"",v=l.status||"";this.log("receive",`${v} ${n} ${i} ${h}`.trim(),l),this.channels.filter(g=>g._isMember(n)).forEach(g=>g._trigger(i,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(br.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([wf],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:lf};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(br.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Au(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ds.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,l,u,h,v,g;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:Sa,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:ds.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(m=>yf[m-1]||bf),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((m,b)=>b(JSON.stringify(m))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Za extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Gt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class If extends Za{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ca extends Za{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Sf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};const Tu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:n}=await Promise.resolve().then(()=>vi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Ef=()=>Sf(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $i(()=>Promise.resolve().then(()=>vi),void 0,import.meta.url)).Response:Response}),ja=r=>{if(Array.isArray(r))return r.map(t=>ja(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[i]=ja(n)}),e},Af=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var On=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};const oa=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Cf=(r,e,t)=>On(void 0,void 0,void 0,function*(){const n=yield Ef();r instanceof n&&!t?.noResolveJson?r.json().then(i=>{const l=r.status||500,u=i?.statusCode||l+"";e(new If(oa(i),l,u))}).catch(i=>{e(new Ca(oa(i),i))}):e(new Ca(oa(r),r))}),jf=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"||!n?i:(Af(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function Ui(r,e,t,n,i,l){return On(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,jf(e,n,i,l)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>u(v)).catch(v=>Cf(v,h,n))})})}function Is(r,e,t,n){return On(this,void 0,void 0,function*(){return Ui(r,"GET",e,t,n)})}function Cr(r,e,t,n,i){return On(this,void 0,void 0,function*(){return Ui(r,"POST",e,n,i,t)})}function Ta(r,e,t,n,i){return On(this,void 0,void 0,function*(){return Ui(r,"PUT",e,n,i,t)})}function Tf(r,e,t,n){return On(this,void 0,void 0,function*(){return Ui(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function xu(r,e,t,n,i){return On(this,void 0,void 0,function*(){return Ui(r,"DELETE",e,n,i,t)})}var er=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};const xf={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Pf{constructor(e,t={},n,i){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Tu(i)}uploadOrUpdate(e,t,n,i){return er(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},kl),i);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const v=u.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,v&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),i?.headers&&(h=Object.assign(Object.assign({},h),i.headers));const g=this._removeEmptyFolders(t),m=this._getFinalPath(g),b=yield(e=="PUT"?Ta:Cr)(this.fetch,`${this.url}/object/${m}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:g,id:b.Id,fullPath:b.Key},error:null}}catch(l){if(Gt(l))return{data:null,error:l};throw l}})}upload(e,t,n){return er(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return er(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let v;const g=Object.assign({upsert:kl.upsert},i),m=Object.assign(Object.assign({},this.headers),{"x-upsert":String(g.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",g.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",g.cacheControl)):(v=n,m["cache-control"]=`max-age=${g.cacheControl}`,m["content-type"]=g.contentType);const b=yield Ta(this.fetch,h.toString(),v,{headers:m});return{data:{path:l,fullPath:b.Key},error:null}}catch(v){if(Gt(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return er(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const l=yield Cr(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new Za("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(n){if(Gt(n))return{data:null,error:n};throw n}})}update(e,t,n){return er(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return er(this,void 0,void 0,function*(){try{return{data:yield Cr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}copy(e,t,n){return er(this,void 0,void 0,function*(){try{return{data:{path:(yield Cr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return er(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),l=yield Cr(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const u=n?.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return er(this,void 0,void 0,function*(){try{const i=yield Cr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}download(e,t){return er(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield Is(this.fetch,`${this.url}/${i}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Gt(h))return{data:null,error:h};throw h}})}info(e){return er(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield Is(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ja(n),error:null}}catch(n){if(Gt(n))return{data:null,error:n};throw n}})}exists(e){return er(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Tf(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Gt(n)&&n instanceof Ca){const i=n.originalError;if([400,404].includes(i?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),i=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&i.push(l);const h=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&i.push(v);let g=i.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${g}`)}}}remove(e){return er(this,void 0,void 0,function*(){try{return{data:yield xu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}list(e,t,n){return er(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},xf),t),{prefix:e||""});return{data:yield Cr(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}listV2(e,t){return er(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Cr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(Gt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Rf="2.11.0",Of={"X-Client-Info":`storage-js/${Rf}`};var Gn=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};class Mf{constructor(e,t={},n,i){const l=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Of),t),this.fetch=Tu(n)}listBuckets(){return Gn(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Gt(e))return{data:null,error:e};throw e}})}getBucket(e){return Gn(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Gn(this,void 0,void 0,function*(){try{return{data:yield Cr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Gt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Gn(this,void 0,void 0,function*(){try{return{data:yield Ta(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Gt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Gn(this,void 0,void 0,function*(){try{return{data:yield Cr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Gn(this,void 0,void 0,function*(){try{return{data:yield xu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}}class Lf extends Mf{constructor(e,t={},n,i){super(e,t,n,i)}from(e){return new Pf(this.url,this.headers,e,this.fetch)}}const Df="2.56.0";let Ci="";typeof Deno<"u"?Ci="deno":typeof document<"u"?Ci="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ci="react-native":Ci="node";const Ff={"X-Client-Info":`supabase-js-${Ci}/${Df}`},$f={headers:Ff},Uf={schema:"public"},Nf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Bf={};var Wf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};const Vf=r=>{let e;return r?e=r:typeof fetch>"u"?e=bu:e=fetch,(...t)=>e(...t)},qf=()=>typeof Headers>"u"?wu:Headers,Gf=(r,e,t)=>{const n=Vf(t),i=qf();return(l,u)=>Wf(void 0,void 0,void 0,function*(){var h;const v=(h=yield e())!==null&&h!==void 0?h:r;let g=new i(u?.headers);return g.has("apikey")||g.set("apikey",r),g.has("Authorization")||g.set("Authorization",`Bearer ${v}`),n(l,Object.assign(Object.assign({},u),{headers:g}))})};var Hf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};function zf(r){return r.endsWith("/")?r:r+"/"}function Kf(r,e){var t,n;const{db:i,auth:l,realtime:u,global:h}=r,{db:v,auth:g,realtime:m,global:b}=e,S={db:Object.assign(Object.assign({},v),i),auth:Object.assign(Object.assign({},g),l),realtime:Object.assign(Object.assign({},m),u),storage:{},global:Object.assign(Object.assign(Object.assign({},b),h),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Hf(this,void 0,void 0,function*(){return""})};return r.accessToken?S.accessToken=r.accessToken:delete S.accessToken,S}const Pu="2.71.1",Xn=30*1e3,xa=3,la=xa*Xn,Yf="http://localhost:9999",Jf="supabase.auth.token",Xf={"X-Client-Info":`gotrue-js/${Pu}`},Pa="X-Supabase-Api-Version",Ru={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Qf=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Zf=600*1e3;class eo extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Qe(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class eh extends eo{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function th(r){return Qe(r)&&r.name==="AuthApiError"}class Ou extends eo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class an extends eo{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class Kr extends an{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rh(r){return Qe(r)&&r.name==="AuthSessionMissingError"}class fs extends an{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class hs extends an{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vs extends an{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function nh(r){return Qe(r)&&r.name==="AuthImplicitGrantRedirectError"}class Il extends an{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ra extends an{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ua(r){return Qe(r)&&r.name==="AuthRetryableFetchError"}class Sl extends an{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Oa extends an{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),El=` 	
\r=`.split(""),ih=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<El.length;e+=1)r[El[e].charCodeAt(0)]=-2;for(let e=0;e<Ss.length;e+=1)r[Ss[e].charCodeAt(0)]=e;return r})();function Al(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Ss[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Ss[n]),e.queuedBits-=6}}function Mu(r,e,t){const n=ih[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Cl(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},l=u=>{oh(u,n,t)};for(let u=0;u<r.length;u+=1)Mu(r.charCodeAt(u),i,l);return e.join("")}function sh(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function ah(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}sh(n,e)}}function oh(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function lh(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Mu(r.charCodeAt(i),t,n);return new Uint8Array(e)}function uh(r){const e=[];return ah(r,t=>e.push(t)),new Uint8Array(e)}function ch(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return r.forEach(i=>Al(i,t,n)),Al(null,t,n),e.join("")}function dh(r){return Math.round(Date.now()/1e3)+r}function fh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const mr=()=>typeof window<"u"&&typeof document<"u",_n={tested:!1,writable:!1},Lu=()=>{if(!mr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_n.tested)return _n.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),_n.tested=!0,_n.writable=!0}catch{_n.tested=!0,_n.writable=!1}return _n.writable};function hh(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,l)=>{e[l]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const Du=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:n}=await Promise.resolve().then(()=>vi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},vh=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Qn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},mn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},zr=async(r,e)=>{await r.removeItem(e)};class Fs{constructor(){this.promise=new Fs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Fs.promiseConstructor=Promise;function ca(r){const e=r.split(".");if(e.length!==3)throw new Oa("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Qf.test(e[n]))throw new Oa("JWT not in base64url format");return{header:JSON.parse(Cl(e[0])),payload:JSON.parse(Cl(e[1])),signature:lh(e[2]),raw:{header:e[0],payload:e[1]}}}async function ph(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function gh(r,e){return new Promise((n,i)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await r(l);if(!e(l,null,u)){n(u);return}}catch(u){if(!e(l,u)){i(u);return}}})()})}function _h(r){return("0"+r.toString(16)).substr(-2)}function mh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let l=0;l<56;l++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,_h).join("")}async function yh(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(l=>String.fromCharCode(l)).join("")}async function bh(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await yh(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hn(r,e,t=!1){const n=mh();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await Qn(r,`${e}-code-verifier`,i);const l=await bh(n);return[l,n===l?"plain":"s256"]}const wh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kh(r){const e=r.headers.get(Pa);if(!e||!e.match(wh))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ih(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Sh(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Eh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function zn(r){if(!Eh.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function da(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function jl(r){return JSON.parse(JSON.stringify(r))}var Ah=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const wn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Ch=[502,503,504];async function Tl(r){var e;if(!vh(r))throw new Ra(wn(r),0);if(Ch.includes(r.status))throw new Ra(wn(r),r.status);let t;try{t=await r.json()}catch(l){throw new Ou(wn(l),l)}let n;const i=kh(r);if(i&&i.getTime()>=Ru["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Sl(wn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Kr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new Sl(wn(t),r.status,t.weak_password.reasons);throw new eh(wn(t),r.status||500,n)}const jh=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function ot(r,e,t,n){var i;const l=Object.assign({},n?.headers);l[Pa]||(l[Pa]=Ru["2024-01-01"].name),n?.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const u=(i=n?.query)!==null&&i!==void 0?i:{};n?.redirectTo&&(u.redirect_to=n.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",v=await Th(r,e,t+h,{headers:l,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function Th(r,e,t,n,i,l){const u=jh(e,n,i,l);let h;try{h=await r(t,Object.assign({},u))}catch(v){throw console.error(v),new Ra(wn(v),0)}if(h.ok||await Tl(h),n?.noResolveJson)return h;try{return await h.json()}catch(v){await Tl(v)}}function Ur(r){var e;let t=null;Oh(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=dh(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function xl(r){const e=Ur(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Jr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function xh(r){return{data:r,error:null}}function Ph(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:l}=r,u=Ah(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:l},v=Object.assign({},u);return{data:{properties:h,user:v},error:null}}function Rh(r){return r}function Oh(r){return r.access_token&&r.refresh_token&&r.expires_in}const fa=["global","local","others"];var Mh=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Lh{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Du(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=fa[0]){if(fa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fa.join(", ")}`);try{return await ot(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Qe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await ot(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Jr})}catch(n){if(Qe(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Mh(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n?.newEmail,delete i.newEmail),await ot(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Ph,redirectTo:t?.redirectTo})}catch(t){if(Qe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ot(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Jr})}catch(t){if(Qe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,l,u,h,v;try{const g={nextPage:null,lastPage:0,total:0},m=await ot(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(l=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:Rh});if(m.error)throw m.error;const b=await m.json(),S=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(v=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&v!==void 0?v:[];return p.length>0&&(p.forEach(k=>{const x=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(k.split(";")[1].split("=")[1]);g[`${P}Page`]=x}),g.total=parseInt(S)),{data:Object.assign(Object.assign({},b),g),error:null}}catch(g){if(Qe(g))return{data:{users:[]},error:g};throw g}}async getUserById(e){zn(e);try{return await ot(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Jr})}catch(t){if(Qe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){zn(e);try{return await ot(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Jr})}catch(n){if(Qe(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){zn(e);try{return await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Jr})}catch(n){if(Qe(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){zn(e.userId);try{const{data:t,error:n}=await ot(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){zn(e.userId),zn(e.id);try{return{data:await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}}function Pl(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Dh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Kn={debug:!!(globalThis&&Lu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Fu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Fh extends Fu{}async function $h(r,e,t){Kn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Kn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){Kn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Kn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Kn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Fh(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Kn.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Dh();const Uh={url:Yf,storageKey:Jf,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Rl(r,e,t){return await t()}const Yn={};class Li{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Li.nextInstanceID,Li.nextInstanceID+=1,this.instanceID>0&&mr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Uh),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Lh({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Du(i.fetch),this.lock=i.lock||Rl,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:mr()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=$h:this.lock=Rl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Lu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Pl(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Pl(this.memoryStorage)),mr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Yn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Yn[this.storageKey]=Object.assign(Object.assign({},Yn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Yn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yn[this.storageKey]=Object.assign(Object.assign({},Yn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Pu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=hh(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),mr()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:l}=await this._getSessionFromURL(t,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),nh(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Qe(t)?{error:t}:{error:new Ou("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Ur}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Qe(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,n,i;try{let l;if("email"in e){const{email:m,password:b,options:S}=e;let p=null,k=null;this.flowType==="pkce"&&([p,k]=await Hn(this.storage,this.storageKey)),l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:m,password:b,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:p,code_challenge_method:k},xform:Ur})}else if("phone"in e){const{phone:m,password:b,options:S}=e;l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:b,data:(n=S?.data)!==null&&n!==void 0?n:{},channel:(i=S?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Ur})}else throw new hs("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Qe(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:xl})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:xl})}else throw new hs("You must provide either an email or phone number and a password");const{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new fs}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,i,l,u,h,v,g,m,b,S,p;let k,x;if("message"in e)k=e.message,x=e.signature;else{const{chain:P,wallet:F,statement:H,options:L}=e;let U;if(mr())if(typeof F=="object")U=F;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))U=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof F!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");U=F}const $=new URL((t=L?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in U&&U.signIn){const C=await U.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},L?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),H?{statement:H}:null));let O;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")O=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)O=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in O&&"signature"in O&&(typeof O.signedMessage=="string"||O.signedMessage instanceof Uint8Array)&&O.signature instanceof Uint8Array)k=typeof O.signedMessage=="string"?O.signedMessage:new TextDecoder().decode(O.signedMessage),x=O.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in U)||typeof U.signMessage!="function"||!("publicKey"in U)||typeof U!="object"||!U.publicKey||!("toBase58"in U.publicKey)||typeof U.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");k=[`${$.host} wants you to sign in with your Solana account:`,U.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(i=(n=L?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((l=L?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${L.signInWithSolana.notBefore}`]:[],...!((u=L?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${L.signInWithSolana.expirationTime}`]:[],...!((h=L?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${L.signInWithSolana.chainId}`]:[],...!((v=L?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${L.signInWithSolana.nonce}`]:[],...!((g=L?.signInWithSolana)===null||g===void 0)&&g.requestId?[`Request ID: ${L.signInWithSolana.requestId}`]:[],...!((b=(m=L?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||b===void 0)&&b.length?["Resources",...L.signInWithSolana.resources.map(O=>`- ${O}`)]:[]].join(`
`);const C=await U.signMessage(new TextEncoder().encode(k),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=C}}try{const{data:P,error:F}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:k,signature:ch(x)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Ur});if(F)throw F;return!P||!P.session||!P.user?{data:{user:null,session:null},error:new fs}:(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),{data:Object.assign({},P),error:F})}catch(P){if(Qe(P))return{data:{user:null,session:null},error:P};throw P}}async _exchangeCodeForSession(e){const t=await mn(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{const{data:l,error:u}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ur});if(await zr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new fs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:i??null}),error:u})}catch(l){if(Qe(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:l,nonce:u}=e,h=await ot(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ur}),{data:v,error:g}=h;return g?{data:{user:null,session:null},error:g}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new fs}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:g})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,l,u;try{if("email"in e){const{email:h,options:v}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await Hn(this.storage,this.storageKey));const{error:b}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:g,code_challenge_method:m},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:h,options:v}=e,{data:g,error:m}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(i=v?.data)!==null&&i!==void 0?i:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(u=v?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:g?.message_id},error:m}}throw new hs("You must provide either an email or phone number.")}catch(h){if(Qe(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let i,l;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:u,error:h}=await ot(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:i,xform:Ur});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const v=u.session,g=u.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(i){if(Qe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Hn(this.storage,this.storageKey)),await ot(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:xh})}catch(l){if(Qe(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Kr;const{error:i}=await ot(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Qe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:l}=e,{error:u}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:n,type:i,options:l}=e,{data:u,error:h}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new hs("You must provide either an email or phone number and a type")}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await mn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<la:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const u=await mn(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=da()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,g,m)=>(!u&&g==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,g,m))})}return{data:{session:e},error:null}}const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Jr}):await this._useSession(async t=>{var n,i,l;const{data:u,error:h}=t;if(h)throw h;return!(!((n=u.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Kr}:await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&l!==void 0?l:void 0,xform:Jr})})}catch(t){if(Qe(t))return rh(t)&&(await this._removeSession(),await zr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:l}=n;if(l)throw l;if(!i.session)throw new Kr;const u=i.session;let h=null,v=null;this.flowType==="pkce"&&e.email!=null&&([h,v]=await Hn(this.storage,this.storageKey));const{data:g,error:m}=await ot(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:v}),jwt:u.access_token,xform:Jr});if(m)throw m;return u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(n){if(Qe(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Kr;const t=Date.now()/1e3;let n=t,i=!0,l=null;const{payload:u}=ca(e.access_token);if(u.exp&&(n=u.exp,i=n<=t),i){const{session:h,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Qe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(n=u.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Kr;const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!mr())throw new vs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Il("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Il("No code detected.");const{data:H,error:L}=await this._exchangeCodeForSession(e.code);if(L)throw L;const U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:l,refresh_token:u,expires_in:h,expires_at:v,token_type:g}=e;if(!l||!h||!u||!g)throw new vs("No session defined in URL");const m=Math.round(Date.now()/1e3),b=parseInt(h);let S=m+b;v&&(S=parseInt(v));const p=S-m;p*1e3<=Xn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${b}s`);const k=S-b;m-k>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",k,S,m):m-k<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",k,S,m);const{data:x,error:P}=await this._getUser(l);if(P)throw P;const F={provider_token:n,provider_refresh_token:i,access_token:l,expires_in:b,expires_at:S,refresh_token:u,token_type:g,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:F,redirectType:e.type},error:null}}catch(n){if(Qe(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:l}=t;if(l)return{error:l};const u=(n=i.session)===null||n===void 0?void 0:n.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(th(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await zr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=fh(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:l},error:u}=t;if(u)throw u;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Hn(this.storage,this.storageKey,!0));try{return await ot(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Qe(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:i}=await this._useSession(async l=>{var u,h,v,g,m;const{data:b,error:S}=l;if(S)throw S;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await ot(this.fetch,"GET",p,{headers:this.headers,jwt:(m=(g=b.session)===null||g===void 0?void 0:g.access_token)!==null&&m!==void 0?m:void 0})});if(i)throw i;return mr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(Qe(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:l,error:u}=t;if(u)throw u;return await ot(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await gh(async i=>(i>0&&await ph(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await ot(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ur})),(i,l)=>{const u=200*Math.pow(2,i);return l&&ua(l)&&Date.now()+u-n<Xn})}catch(n){if(this._debug(t,"error",n),Qe(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),mr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await mn(this.storage,this.storageKey);if(i&&this.userStorage){let u=await mn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},await Qn(this.userStorage,this.storageKey+"-user",u)),i.user=(e=u?.user)!==null&&e!==void 0?e:da()}else if(i&&!i.user&&!i.user){const u=await mn(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,await zr(this.storage,this.storageKey+"-user"),await Qn(this.storage,this.storageKey,i)):i.user=da()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const l=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<la;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${la}s`),l){if(this.autoRefreshToken&&i.refresh_token){const{error:u}=await this._callRefreshToken(i.refresh_token);u&&(console.error(u),ua(u)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(i.access_token);!h&&u?.user?(i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(n,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Kr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Fs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new Kr;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(i,"error",l),Qe(l)){const u={session:null,error:l};return ua(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Qn(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const l=jl(i);await Qn(this.storage,this.storageKey,l)}else{const i=jl(t);await Qn(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await zr(this.storage,this.storageKey),await zr(this.storage,this.storageKey+"-code-verifier"),await zr(this.storage,this.storageKey+"-user"),this.userStorage&&await zr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&mr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Xn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/Xn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Xn}ms, refresh threshold is ${xa} ticks`),i<=xa&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Fu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!mr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,u]=await Hn(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(h.toString())}if(n?.queryParams){const l=new URLSearchParams(n.queryParams);i.push(l.toString())}return n?.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:g}=await ot(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return g?{data:null,error:g}:(e.factorType==="totp"&&(!((i=v?.totp)===null||i===void 0)&&i.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],i=n.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=n.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:n,totp:i,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:i},error:l}=e;if(l)return{data:null,error:l};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ca(i.access_token);let h=null;u.aal&&(h=u.aal);let v=h;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const m=u.amr||[];return{data:{currentLevel:h,nextLevel:v,currentAuthenticationMethods:m},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+Zf>i)return n;const{data:l,error:u}=await ot(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=i,n=l.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:k}=await this.getSession();if(k||!p.session)return{data:null,error:k};n=p.session.access_token}const{header:i,payload:l,signature:u,raw:{header:h,payload:v}}=ca(n);t?.allowExpired||Ih(l.exp);const g=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!g){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:l,header:i,signature:u},error:null}}const m=Sh(i.alg),b=await crypto.subtle.importKey("jwk",g,m,!0,["verify"]);if(!await crypto.subtle.verify(m,b,u,uh(`${h}.${v}`)))throw new Oa("Invalid JWT signature");return{data:{claims:l,header:i,signature:u},error:null}}catch(n){if(Qe(n))return{data:null,error:n};throw n}}}Li.nextInstanceID=0;const Nh=Li;class Bh extends Nh{constructor(e){super(e)}}var Wh=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(n.next(m))}catch(b){u(b)}}function v(m){try{g(n.throw(m))}catch(b){u(b)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((n=n.apply(r,e||[])).next())})};class Vh{constructor(e,t,n){var i,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=zf(e),v=new URL(h);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const g=`sb-${v.hostname.split(".")[0]}-auth-token`,m={db:Uf,realtime:Bf,auth:Object.assign(Object.assign({},Nf),{storageKey:g}),global:$f},b=Kf(n??{},m);this.storageKey=(i=b.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(l=b.global.headers)!==null&&l!==void 0?l:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(S,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=b.auth)!==null&&u!==void 0?u:{},this.headers,b.global.fetch),this.fetch=Gf(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new sf(new URL("rest/v1",v).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new Lf(this.storageUrl.href,this.headers,this.fetch,n?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Hd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Wh(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,storageKey:l,flowType:u,lock:h,debug:v},g,m){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Bh({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),g),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,flowType:u,lock:h,debug:v,fetch:m,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new kf(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const qh=(r,e,t)=>new Vh(r,e,t);function Gh(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Gh()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Hh="https://vycjpmuyscfygstjjied.supabase.co",zh="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",jr=qh(Hh,zh,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),tn={async loadStoriesList(){if(!B.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${B.selectedBucket}`);const r=`${B.selectedBucket}_story.json`,{data:e,error:t}=await jr.storage.from(B.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(B.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(B.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!B.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await jr.storage.from(B.selectedBucket).list();r&&(B.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!B.selectedBucket){bt.setStatus("error","Не выбрана история");return}const t=e.files[0];bt.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),i=new Uint8Array(n),{error:l}=await jr.storage.from(B.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});l?bt.setStatus("error","Ошибка загрузки"):(bt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!B.selectedBucket){bt.setStatus("error","Не выбрана история");return}const{error:e}=await jr.storage.from(B.selectedBucket).remove([r]);e?bt.setStatus("error","Ошибка удаления файла"):(bt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Kh(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function Yh(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const xr={async createNewStory(){if(!B.selectedBucket){bt.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:l}=await jr.storage.from(B.selectedBucket).upload(r,i,{contentType:"application/json"});l?bt.setStatus("error","Ошибка создания: "+l.message):(await tn.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!B.selectedBucket){bt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${B.selectedBucket}`),bt.setStatus("loading","Загрузка..."),B.currentFileName=r;try{const{data:e,error:t}=await jr.storage.from(B.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=jr.storage.from(B.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);n=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let i=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=Kh(i),console.log("[StoryStore] Присваиваем данные в editor.data"),B.data=i,console.log("[StoryStore] editor.data обновлен:",{chapters:B.data.chapters?.length,dialogues:B.data.dialogues?.length}),B.data.chapters&&B.data.chapters.length>0&&(B.selectedChapterId=B.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${B.selectedChapterId}`)),B.data.dialogues&&B.data.dialogues.length>0&&(B.selectedDialogueId=B.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${B.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),bt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),bt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!B.data)return;if(!B.selectedBucket){bt.setStatus("error","Не выбрана история (bucket)");return}bt.setStatus("loading","Сохранение...");const r=JSON.stringify(B.data,null,2);console.log(`[StoryStore] Сохранение файла: ${B.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await jr.storage.from(B.selectedBucket).update(B.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const i=await jr.storage.from(B.selectedBucket).upload(B.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore] Ошибка сохранения (upload):",i.error),bt.setStatus("error","Ошибка сохранения: "+i.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),bt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),bt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!B.data)return;if(!B.selectedBucket){bt.setStatus("error","Не выбрана история (bucket)");return}const r=B.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),bt.setStatus("loading","Создание копии...");const i=JSON.stringify(B.data,null,2),u=new TextEncoder().encode(i),{error:h}=await jr.storage.from(B.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?bt.setStatus("error",`Ошибка копии: ${h.message}`):(await tn.loadStoriesList(),bt.setStatus("success","Копия сохранена!"))},addChapter(){if(!B.data||!B.data.chapters)return;const r="ch_"+Date.now();B.data.chapters.push({id:r,title:"Новая глава",description:""}),B.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!B.data||!B.selectedChapterId)return;const r="d_"+Date.now();B.data.dialogues.push({id:r,chapterId:B.selectedChapterId,text:"Новый текст...",options:[]}),B.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&B.data&&(B.data.dialogues=B.data.dialogues.filter(e=>e.id!==r),B.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),B.selectedDialogueId===r&&(B.selectedDialogueId=null))},jumpTo(r){const e=B.data?.dialogues.find(t=>t.id===r);e&&(B.selectedChapterId=e.chapterId,B.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var rr=sn(()=>Jt);function Jh(){bt.selectEditingChapter(null)}var Xh=X('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function Qh(r,e){Rt(e,!1);function t(){rr().currentEditingChapter&&(bt.updateChapter(rr().currentEditingChapter.id,{title:rr().currentEditingChapter.title,description:rr().currentEditingChapter.description}),bt.selectEditingChapter(null))}function n(){rr().currentEditingChapter&&confirm(`Удалить главу "${rr().currentEditingChapter.title}"?`)&&(bt.deleteChapter(rr().currentEditingChapter.id),bt.selectEditingChapter(null))}nn();var i=St(),l=Je(i);{var u=h=>{var v=Xh(),g=E(v),m=j(E(g),2),b=E(m);b.__click=n;var S=j(g,2),p=j(E(S),2),k=j(S,2),x=j(E(k),2),P=j(k,2),F=E(P);F.__click=[Jh];var H=j(F,2);H.__click=t,Br(p,()=>rr().currentEditingChapter.title,L=>rr(rr().currentEditingChapter.title=L)),Br(x,()=>rr().currentEditingChapter.description,L=>rr(rr().currentEditingChapter.description=L)),W(h,v)};Re(l,h=>{rr().currentEditingChapter&&h(u)})}W(r,i),Ot()}Ft(["click"]);var nr=sn(()=>B),Zh=(r,e,t)=>e(f(t).id),ev=X('<div class="chapter-form-container svelte-xp6igx"><!></div>'),tv=X('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),rv=X('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),nv=X("<div> </div>"),iv=X('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function sv(r,e){Rt(e,!1);function t(F){bt.selectEditingChapter(F)}nn();var n=iv(),i=E(n),l=E(i),u=j(E(l),2);u.__click=function(...F){xr.addChapter?.apply(this,F)};var h=j(l,2);Ze(h,5,()=>nr().data?.chapters||[],F=>F.id,(F,H)=>{var L=tv(),U=Je(L),$=E(U);let C;$.__click=()=>nr(nr().selectedChapterId=f(H).id);var O=E($),ie=E(O),oe=j($,2);oe.__click=[Zh,t,H];var ve=j(U,2);{var fe=le=>{var Y=ev(),K=E(Y);Qh(K,{}),W(le,Y)};Re(ve,le=>{nr().editingChapterId===f(H).id&&le(fe)})}ke(le=>{C=Nt($,1,"chapter-item svelte-xp6igx",null,C,le),Ne($,"aria-pressed",nr().selectedChapterId===f(H).id),Ne($,"title",f(H).description||"Без описания"),me(ie,f(H).title)},[()=>({active:nr().selectedChapterId===f(H).id})]),W(F,L)});var v=j(i,2),g=E(v),m=E(g),b=E(m),S=j(m,2);S.__click=function(...F){xr.addDialogue?.apply(this,F)};var p=j(g,2);Ze(p,5,()=>Jt.chapterDialogues,F=>F.id,(F,H)=>{var L=rv();let U;L.__click=()=>nr(nr().selectedDialogueId=f(H).id);var $=E(L),C=E($),O=j($,2),ie=E(O);ke((oe,ve)=>{U=Nt(L,1,"dialogue-item svelte-xp6igx",null,U,oe),Ne(L,"aria-pressed",nr().selectedDialogueId===f(H).id),me(C,f(H).id),me(ie,`${ve??""}...`)},[()=>({active:nr().selectedDialogueId===f(H).id}),()=>f(H).text.substring(0,25)]),W(F,L)});var k=j(v,2),x=E(k);{var P=F=>{var H=nv(),L=E(H);ke(()=>{Nt(H,1,`alert ${nr().statusMessage.type??""}`,"svelte-xp6igx"),me(L,nr().statusMessage.text)}),W(F,H)};Re(x,F=>{nr().statusMessage.text&&F(P)})}ke(()=>{me(b,`Сцены (${Jt.chapterDialogues.length??""})`),S.disabled=!nr().selectedChapterId}),W(r,n),Ot()}Ft(["click"]);var av=X("<option> </option>"),ov=(r,e)=>{const t=r.target;e(t.checked)},lv=(r,e)=>{const t=r.target;e("id",t.value)},uv=(r,e)=>{const t=r.target;e("onWinDialogueId",t.value)},cv=X("<option> </option>"),dv=(r,e)=>{const t=r.target;e("onLoseDialogueId",t.value)},fv=X("<option> </option>"),hv=(r,e)=>{const t=r.target;e("rewardItem",t.value)},vv=X("<option> </option>"),pv=X('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),gv=(r,e)=>{const t=r.target;e(t.value)},_v=X("<option> </option>"),mv=(r,e)=>{const t=r.target;e({itemId:t.value})},yv=X("<option> </option>"),bv=X('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),wv=(r,e)=>{const t=r.target;e({statName:t.value})},kv=(r,e)=>{const t=r.target,n=parseInt(t.value);e({statValue:isNaN(n)?0:n})},Iv=X('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),Sv=(r,e)=>{const t=r.target;e({flagName:t.value})},Ev=X('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),Av=X('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function Cv(r,e){Rt(e,!0);const t=ze(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return n(),t().visibilityCondition}function l(ee){n();const ce=t().visibilityCondition;Object.assign(ce,ee),t().visibilityCondition={...ce}}function u(ee){n();const ce={type:ee};switch(ee){case"has_item":ce.itemId=i().itemId||"";break;case"stat_greater":ce.statName=i().statName||"",ce.statValue=i().statValue||0;break;case"flag_true":ce.flagName=i().flagName||"";break}t().visibilityCondition=ce}const h=Dt(()=>!!t().miniGame);function v(ee){ee?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function g(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function m(ee,ce){const we=g();we&&(we[ee]=ce)}var b=Av(),S=E(b),p=E(S),k=j(p,2),x=j(S,2),P=E(x),F=j(P,2),H=E(F);H.value=H.__value="";var L=j(H);Ze(L,17,()=>e.dialogues,ee=>ee.id,(ee,ce)=>{var we=av(),Ie=E(we),Ue={};ke(Ve=>{me(Ie,`${f(ce).id??""}: ${Ve??""}...`),Ue!==(Ue=f(ce).id)&&(we.value=(we.__value=f(ce).id)??"")},[()=>f(ce).text.substring(0,30)]),W(ee,we)});var U=j(x,2),$=E(U),C=E($),O=E(C);O.__change=[ov,v];var ie=j($,2);{var oe=ee=>{var ce=pv(),we=E(ce),Ie=E(we),Ue=j(Ie,2);Ue.__change=[lv,m];var Ve=E(Ue);Ve.value=Ve.__value="";var We=j(Ve);We.value=We.__value="onet_monsters";var Oe=j(We);Oe.value=Oe.__value="memo_monsters";var Xe=j(Oe);Xe.value=Xe.__value="light_out";var Ge=j(Xe);Ge.value=Ge.__value="flood_it";var _t=j(Ge);_t.value=_t.__value="broken_mirror";var lt=j(_t);lt.value=lt.__value="evolution2048";var Et=j(lt);Et.value=Et.__value="cursed_crypts";var At=j(Et);At.value=At.__value="tower_of_souls";var y;bn(Ue);var o=j(we,2),d=E(o),w=E(d),T=j(w,2);T.__change=[uv,m];var q=E(T);q.value=q.__value="";var se=j(q);Ze(se,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Se=cv(),He=E(Se),Vt={};ke(Mn=>{me(He,`${f(ut).id??""}: ${Mn??""}...`),Vt!==(Vt=f(ut).id)&&(Se.value=(Se.__value=f(ut).id)??"")},[()=>f(ut).text.substring(0,30)]),W(st,Se)});var Ce;bn(T);var Fe=j(d,2),je=E(Fe),Be=j(je,2);Be.__change=[dv,m];var Ke=E(Be);Ke.value=Ke.__value="";var wt=j(Ke);Ze(wt,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Se=fv(),He=E(Se),Vt={};ke(Mn=>{me(He,`${f(ut).id??""}: ${Mn??""}...`),Vt!==(Vt=f(ut).id)&&(Se.value=(Se.__value=f(ut).id)??"")},[()=>f(ut).text.substring(0,30)]),W(st,Se)});var ft;bn(Be);var Wt=j(o,2),$t=E(Wt),Ct=j($t,2);Ct.__change=[hv,m];var et=E(Ct);et.value=et.__value="";var qe=j(et);Ze(qe,17,()=>e.availableItems,st=>st.id,(st,ut)=>{var Se=vv(),He=E(Se),Vt={};ke(()=>{me(He,f(ut).name),Vt!==(Vt=f(ut).id)&&(Se.value=(Se.__value=f(ut).id)??"")}),W(st,Se)});var kt;bn(Ct),ke((st,ut,Se,He)=>{Ne(Ie,"for",`option-mg-id-${e.index??""}`),Ne(Ue,"id",`option-mg-id-${e.index??""}`),y!==(y=st)&&(Ue.value=(Ue.__value=st)??"",Yr(Ue,st)),Ne(w,"for",`option-mg-win-${e.index??""}`),Ne(T,"id",`option-mg-win-${e.index??""}`),Ce!==(Ce=ut)&&(T.value=(T.__value=ut)??"",Yr(T,ut)),Ne(je,"for",`option-mg-lose-${e.index??""}`),Ne(Be,"id",`option-mg-lose-${e.index??""}`),ft!==(ft=Se)&&(Be.value=(Be.__value=Se)??"",Yr(Be,Se)),Ne($t,"for",`option-mg-reward-${e.index??""}`),Ne(Ct,"id",`option-mg-reward-${e.index??""}`),kt!==(kt=He)&&(Ct.value=(Ct.__value=He)??"",Yr(Ct,He))},[()=>g().id,()=>g().onWinDialogueId,()=>g().onLoseDialogueId,()=>g().rewardItem||""]),W(ee,ce)};Re(ie,ee=>{g()&&ee(oe)})}var ve=j(U,2),fe=E(ve),le=E(fe),Y=E(le),K=j(fe,2),G=E(K),V=E(G),R=j(ve,2),Q=j(E(R),2),ae=E(Q),de=E(ae),ge=j(de,2);ge.__change=[gv,u],Ze(ge,20,()=>e.conditionTypes,ee=>ee,(ee,ce)=>{var we=_v(),Ie=E(we),Ue={};ke(()=>{me(Ie,ce),Ue!==(Ue=ce)&&(we.value=(we.__value=ce)??"")}),W(ee,we)});var $e;bn(ge);var _e=j(ae,2);{var Pe=ee=>{var ce=bv(),we=E(ce),Ie=j(we,2);Ie.__change=[mv,l];var Ue=E(Ie);Ue.value=Ue.__value="";var Ve=j(Ue);Ze(Ve,17,()=>e.availableItems,Oe=>Oe.id,(Oe,Xe)=>{var Ge=yv(),_t=E(Ge),lt={};ke(()=>{me(_t,f(Xe).name),lt!==(lt=f(Xe).id)&&(Ge.value=(Ge.__value=f(Xe).id)??"")}),W(Oe,Ge)});var We;bn(Ie),ke(Oe=>{Ne(we,"for",`option-cond-item-${e.index??""}`),Ne(Ie,"id",`option-cond-item-${e.index??""}`),We!==(We=Oe)&&(Ie.value=(Ie.__value=Oe)??"",Yr(Ie,Oe))},[()=>i().itemId||""]),W(ee,ce)};Re(_e,ee=>{i().type==="has_item"&&ee(Pe)})}var ue=j(_e,2);{var Z=ee=>{var ce=Iv(),we=Je(ce),Ie=E(we),Ue=j(Ie,2);Ue.__input=[wv,l];var Ve=j(we,2),We=E(Ve),Oe=j(We,2);Oe.__input=[kv,l],ke((Xe,Ge)=>{Ne(Ie,"for",`option-cond-stat-${e.index??""}`),Ne(Ue,"id",`option-cond-stat-${e.index??""}`),na(Ue,Xe),Ne(We,"for",`option-cond-stat-val-${e.index??""}`),Ne(Oe,"id",`option-cond-stat-val-${e.index??""}`),na(Oe,Ge)},[()=>i().statName||"",()=>i().statValue||0]),W(ee,ce)};Re(ue,ee=>{i().type==="stat_greater"&&ee(Z)})}var re=j(ue,2);{var te=ee=>{var ce=Ev(),we=E(ce),Ie=j(we,2);Ie.__input=[Sv,l],ke(Ue=>{Ne(we,"for",`option-cond-flag-${e.index??""}`),Ne(Ie,"id",`option-cond-flag-${e.index??""}`),na(Ie,Ue)},[()=>i().flagName||""]),W(ee,ce)};Re(re,ee=>{i().type==="flag_true"&&ee(te)})}var Ae=j(Q,2);Re(Ae,ee=>{}),ke(ee=>{Ne(p,"for",`option-text-${e.index??""}`),Ne(k,"id",`option-text-${e.index??""}`),Ne(P,"for",`option-next-${e.index??""}`),Ne(F,"id",`option-next-${e.index??""}`),Dd(O,f(h)),Ne(de,"for",`option-cond-type-${e.index??""}`),Ne(ge,"id",`option-cond-type-${e.index??""}`),$e!==($e=ee)&&(ge.value=(ge.__value=ee)??"",Yr(ge,ee))},[()=>i().type]),Br(k,()=>t().text,ee=>t().text=ee),Zn(F,()=>t().nextDialogueId,ee=>t().nextDialogueId=ee),sl(Y,()=>t().enabled,ee=>t().enabled=ee),sl(V,()=>t().visible,ee=>t().visible=ee),W(r,b),Ot()}Ft(["change","input"]);var jt=sn(()=>B),it=sn(()=>Jt),jv=X("<option> <!></option>"),Tv=X("<option> </option>"),xv=X("<option> </option>"),Pv=X("<option> </option>"),Rv=X("<option> </option>"),Ov=X('<div class="option-content svelte-1e6637j"><!></div>'),Mv=X('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Lv=X('<div class="empty-links svelte-1e6637j">Нет связей</div>'),Dv=(r,e)=>xr.jumpTo(f(e).id),Fv=X('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),$v=X('<div class="links-list svelte-1e6637j"></div>'),Uv=X('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),Nv=(r,e)=>xr.jumpTo(f(e).id),Bv=X('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),Wv=X('<div class="more-links svelte-1e6637j"> </div>'),Vv=X('<div class="links-list svelte-1e6637j"><!> <!></div>'),qv=X("<option> </option>"),Gv=X('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),Hv=X('<div class="empty-state">Выберите сцену</div>');function zv(r,e){Rt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(S){S.options||(S.options=[]);const p=Yh();S.options.push(p),jt(jt().editingOptionIndex=S.options.length-1)}function i(S){if(jt().editingOptionIndex===S)jt(jt().editingOptionIndex=null);else{jt(jt().editingOptionIndex=S);const p=it().currentDialogue?.options?.[S];p&&!p.visibilityCondition&&(p.visibilityCondition={type:"always"})}}function l(S,p){confirm("Удалить вариант ответа?")&&(S.options?.splice(p,1),jt().editingOptionIndex===p?jt(jt().editingOptionIndex=null):jt().editingOptionIndex&&jt().editingOptionIndex>p&&jt(jt().editingOptionIndex--))}function u(S){if(!S||!jt().data)return"Нет";const p=jt().data.dialogues.find(k=>k.id===S);return p?p.text.substring(0,25)+"...":`❌ ${S}`}function h(){const S=[],p=it().currentDialogue;return p&&(p.nextDialogueId&&S.push({type:"Auto",id:p.nextDialogueId,text:u(p.nextDialogueId)}),p.options?.forEach((k,x)=>{k.nextDialogueId&&S.push({type:`Опция #${x+1}`,id:k.nextDialogueId,text:u(k.nextDialogueId)})})),S}nn();var v=St(),g=Je(v);{var m=S=>{var p=Gv(),k=E(p),x=j(E(k),2);x.__change=o=>{const d=o.target;jt(jt().selectedDialogueId=d.value)};var P=j(k,2),F=j(E(P),2);ke(()=>{it(),yr(()=>{jt()})}),F.__change=o=>{const d=o.target;jt(jt().selectedChapterId=d.value)};var H=E(F);H.value=H.__value="";var L=j(H);Ze(L,1,()=>jt().data.chapters||[],xt,(o,d)=>{var w=jv(),T=E(w),q=j(T);{var se=Fe=>{var je=ls();ke(Be=>me(je,`- ${Be??""}...`),[()=>f(d).description.substring(0,30)]),W(Fe,je)};Re(q,Fe=>{f(d).description&&Fe(se)})}var Ce={};ke(()=>{me(T,`${f(d).title??""} `),Ce!==(Ce=f(d).id)&&(w.value=(w.__value=f(d).id)??"")}),W(o,w)});var U=j(P,2),$=j(E(U),2),C=j(U,2),O=j(E(C),2),ie=j(E(O),2),oe=E(ie);ke(()=>{it(),yr(()=>{})});var ve=E(oe);ve.value=ve.__value="";var fe=j(ve);Ze(fe,1,()=>it().imageResources,xt,(o,d)=>{var w=Tv(),T=E(w),q={};ke(()=>{me(T,f(d).name),q!==(q=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var le=j(fe);Ze(le,1,()=>it().riveResources,xt,(o,d)=>{var w=xv(),T=E(w),q={};ke(()=>{me(T,`${f(d).name??""} (Rive)`),q!==(q=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var Y=j(oe,2),K=j(E(Y));K.__change=function(...o){tn.uploadNewFile?.apply(this,o)};var G=j(O,2),V=j(E(G),2),R=E(V);ke(()=>{it(),yr(()=>{})});var Q=E(R);Q.value=Q.__value="";var ae=j(Q);Ze(ae,1,()=>it().imageResources,xt,(o,d)=>{var w=Pv(),T=E(w),q={};ke(()=>{me(T,f(d).name),q!==(q=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var de=j(ae);Ze(de,1,()=>it().riveResources,xt,(o,d)=>{var w=Rv(),T=E(w),q={};ke(()=>{me(T,`${f(d).name??""} (Rive)`),q!==(q=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var ge=j(C,2),$e=E(ge),_e=j(E($e),2);_e.__click=()=>n(it().currentDialogue);var Pe=j($e,2);Ze(Pe,1,()=>it().currentDialogue.options||[],xt,(o,d,w)=>{var T=Mv();let q;var se=E(T),Ce=E(se);Ce.__click=()=>i(w),Ce.__keydown=et=>{(et.key==="Enter"||et.key===" ")&&(et.preventDefault(),i(w))},Ne(Ce,"aria-controls",`option-content-${w}`);var Fe=E(Ce),je=E(Fe);{var Be=et=>{var qe=ls("👁️‍🗨️");W(et,qe)},Ke=et=>{var qe=St(),kt=Je(qe);{var st=Se=>{var He=ls("🔒");W(Se,He)},ut=Se=>{var He=ls("✅");W(Se,He)};Re(kt,Se=>{f(d).enabled?Se(ut,!1):Se(st)},!0)}W(et,qe)};Re(je,et=>{f(d).visible?et(Ke,!1):et(Be)})}var wt=j(Fe,2),ft=E(wt),Wt=j(Ce,2);Wt.__click=()=>l(it().currentDialogue,w);var $t=j(se,2);{var Ct=et=>{var qe=Ov();Ne(qe,"id",`option-content-${w}`);var kt=E(qe);Cv(kt,{get option(){return f(d)},index:w,get dialogues(){return jt().data.dialogues},get availableItems(){return it().availableItems},get conditionTypes(){return t}}),W(et,qe)};Re($t,et=>{jt().editingOptionIndex===w&&et(Ct)})}ke(et=>{q=Nt(T,1,"option-card svelte-1e6637j",null,q,et),Ne(Ce,"aria-expanded",jt().editingOptionIndex===w),me(ft,`#${w+1} ${f(d).text??""}`)},[()=>({editing:jt().editingOptionIndex===w})]),W(o,T)});var ue=j(ge,2),Z=E(ue),re=E(Z),te=E(re),Ae=E(te),ee=j(te,2);{var ce=o=>{var d=Lv();W(o,d)},we=o=>{var d=$v();Ze(d,5,h,xt,(w,T)=>{var q=Fv(),se=E(q),Ce=E(se),Fe=j(se,2),je=E(Fe),Be=j(Fe,2);Be.__click=[Dv,T];var Ke=j(Be,2),wt=E(Ke);ke(()=>{me(Ce,`${f(T).type??""}:`),me(je,f(T).id),me(wt,f(T).text)}),W(w,q)}),W(o,d)};Re(ee,o=>{h().length===0?o(ce):o(we,!1)})}var Ie=j(re,2),Ue=E(Ie),Ve=E(Ue),We=j(Ue,2);{var Oe=o=>{var d=Uv();W(o,d)},Xe=o=>{var d=Vv(),w=E(d);Ze(w,1,()=>it().backlinks.slice(0,5),xt,(se,Ce)=>{const Fe=hi(()=>xr.getLinkType(f(Ce),it().currentDialogue.id));var je=Bv(),Be=E(je),Ke=E(Be),wt=j(Be,2);let ft;var Wt=E(wt),$t=j(wt,2);$t.__click=[Nv,Ce];var Ct=j($t,2),et=E(Ct);ke((qe,kt)=>{me(Ke,f(Ce).id),ft=Nt(wt,1,"link-type-badge svelte-1e6637j",null,ft,qe),me(Wt,f(Fe)),me(et,`${kt??""}...`)},[()=>({"link-auto":f(Fe)==="Auto","link-option":f(Fe)==="Option"}),()=>f(Ce).text.substring(0,20)]),W(se,je)});var T=j(w,2);{var q=se=>{var Ce=Wv(),Fe=E(Ce);ke(()=>me(Fe,`...ещё ${it().backlinks.length-5}`)),W(se,Ce)};Re(T,se=>{it().backlinks.length>5&&se(q)})}W(o,d)};Re(We,o=>{it().backlinks.length===0?o(Oe):o(Xe,!1)})}var Ge=j(ue,2),_t=j(E(Ge),2);ke(()=>{it(),yr(()=>{jt()})});var lt=E(_t);lt.value=lt.__value="";var Et=j(lt);Ze(Et,1,()=>jt().data.dialogues,xt,(o,d)=>{var w=qv(),T=E(w),q={};ke(se=>{me(T,`${f(d).id??""}: ${se??""}...`),q!==(q=f(d).id)&&(w.value=(w.__value=f(d).id)??"")},[()=>f(d).text.substring(0,30)]),W(o,w)});var At=j(Ge,2),y=E(At);y.__click=()=>xr.deleteDialogue(it().currentDialogue.id),ke(o=>{me(Ae,`👉 Куда ведет (${o??""})`),me(Ve,`👈 Откуда ведут (${it().backlinks.length??""})`)},[()=>h().length]),Br(x,()=>it().currentDialogue.id,o=>it(it().currentDialogue.id=o)),Zn(F,()=>it().currentDialogue.chapterId,o=>it(it().currentDialogue.chapterId=o)),Br($,()=>it().currentDialogue.text,o=>it(it().currentDialogue.text=o)),Zn(oe,()=>it().currentDialogue.backgroundImage,o=>it(it().currentDialogue.backgroundImage=o)),Zn(R,()=>it().currentDialogue.characterImage,o=>it(it().currentDialogue.characterImage=o)),Zn(_t,()=>it().currentDialogue.nextDialogueId,o=>it(it().currentDialogue.nextDialogueId=o)),W(S,p)},b=S=>{var p=Hv();W(S,p)};Re(g,S=>{it().currentDialogue?S(m):S(b,!1)})}W(r,v),Ot()}Ft(["change","click","keydown"]);var Ye=sn(()=>B),Kv=X('<img class="icon-preview svelte-asgatj"/>'),Yv=X('<div class="icon-placeholder svelte-asgatj">📦</div>'),Jv=X("<option> </option>"),Xv=X('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Qv=X("<option> </option>"),Zv=X('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),ep=X('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),tp=X('<div class="items-list svelte-asgatj"></div>'),rp=X('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),np=X('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),ip=X('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function sp(r,e){Rt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!Ye().data)return;Ye().data.items||Ye(Ye().data.items=[]);const P={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Ye().data.items.push(P),Ye(Ye().editingItemIndex=Ye().data.items.length-1)}function i(P){Ye().editingItemIndex===P?Ye(Ye().editingItemIndex=null):Ye(Ye().editingItemIndex=P)}function l(P){confirm("Удалить предмет?")&&Ye().data?.items&&(Ye().data.items.splice(P,1),Ye(Ye().editingItemIndex=null))}function u(P){if(!Ye().data?.items)return;const F=Ye().data.items[P],H={...F,id:`${F.id}_copy_${Date.now()}`,name:`${F.name} (копия)`};Ye().data.items.splice(P+1,0,H),Ye(Ye().editingItemIndex=P+1)}function h(P){return t.find(F=>F.value===P)?.label||P}nn();var v=ip(),g=E(v);g.__click=()=>Ye(Ye().showItems=!Ye().showItems);var m=E(g),b=j(E(m)),S=j(m,2),p=E(S),k=j(g,2);{var x=P=>{var F=np(),H=E(F);{var L=C=>{var O=tp();Ze(O,7,()=>Ye().data.items,ie=>ie.id,(ie,oe,ve)=>{var fe=ep();let le;var Y=E(fe);Y.__click=()=>i(f(ve));var K=E(Y),G=E(K),V=E(G);{var R=We=>{var Oe=Kv();ke(()=>{Ne(Oe,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ye().selectedBucket}/${f(oe).icon}`),Ne(Oe,"alt",f(oe).name)}),W(We,Oe)},Q=We=>{var Oe=Yv();W(We,Oe)};Re(V,We=>{f(oe).icon?We(R):We(Q,!1)})}var ae=j(G,2),de=E(ae),ge=E(de),$e=j(de,2),_e=E($e),Pe=E(_e),ue=j(_e,2);let Z;var re=E(ue),te=j(K,2),Ae=E(te),ee=j(Y,2),ce=E(ee);ce.__click=()=>u(f(ve));var we=j(ce,2);we.__click=()=>i(f(ve));var Ie=j(we,2);Ie.__click=()=>l(f(ve));var Ue=j(ee,2);{var Ve=We=>{var Oe=Zv(),Xe=E(Oe),Ge=E(Xe),_t=E(Ge),lt=j(_t,2),Et=j(Ge,2),At=E(Et),y=j(At,2),o=j(Et,2),d=E(o),w=j(d,2),T=j(o,2),q=E(T),se=j(q,2),Ce=E(se),Fe=j(Ce,2);Fe.__change=qe=>{const kt=qe.target;f(oe).icon=kt.value,yr(()=>Ye())};var je=E(Fe);je.value=je.__value="";var Be=j(je);Ze(Be,1,()=>Ye().storedFiles.filter(qe=>qe.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),xt,(qe,kt)=>{var st=Jv(),ut=E(st),Se={};ke(()=>{me(ut,f(kt).name),Se!==(Se=f(kt).name)&&(st.value=(st.__value=f(kt).name)??"")}),W(qe,st)});var Ke=j(Fe,2),wt=j(E(Ke));wt.__change=function(...qe){tn.uploadNewFile?.apply(this,qe)};var ft=j(se,2);{var Wt=qe=>{var kt=Xv(),st=E(kt),ut=j(st,2),Se=E(ut);ke(()=>{Ne(st,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ye().selectedBucket}/${f(oe).icon}`),me(Se,f(oe).icon)}),W(qe,kt)};Re(ft,qe=>{f(oe).icon&&qe(Wt)})}var $t=j(T,2),Ct=E($t),et=j(Ct,2);ke(()=>{f(oe),yr(()=>{f(ve)})}),Ze(et,5,()=>t,xt,(qe,kt)=>{var st=Qv(),ut=E(st),Se={};ke(()=>{me(ut,f(kt).label),Se!==(Se=f(kt).value)&&(st.value=(st.__value=f(kt).value)??"")}),W(qe,st)}),ke(()=>{Ne(_t,"for",`item-id-${f(ve)??""}`),Ne(lt,"id",`item-id-${f(ve)??""}`),Ne(At,"for",`item-name-${f(ve)??""}`),Ne(y,"id",`item-name-${f(ve)??""}`),Ne(d,"for",`item-desc-${f(ve)??""}`),Ne(w,"id",`item-desc-${f(ve)??""}`),Ne(q,"for",`item-icon-${f(ve)??""}`),Ne(Ce,"id",`item-icon-${f(ve)??""}`),Ne(Ct,"for",`item-type-${f(ve)??""}`),Ne(et,"id",`item-type-${f(ve)??""}`)}),Br(lt,()=>f(oe).id,qe=>(f(oe).id=qe,yr(()=>Ye()))),Br(y,()=>f(oe).name,qe=>(f(oe).name=qe,yr(()=>Ye()))),Br(w,()=>f(oe).description,qe=>(f(oe).description=qe,yr(()=>Ye()))),Br(Ce,()=>f(oe).icon,qe=>(f(oe).icon=qe,yr(()=>Ye()))),Zn(et,()=>f(oe).type,qe=>(f(oe).type=qe,yr(()=>Ye()))),W(We,Oe)};Re(Ue,We=>{Ye().editingItemIndex===f(ve)&&We(Ve)})}ke((We,Oe,Xe)=>{le=Nt(fe,1,"item-row svelte-asgatj",null,le,We),Ne(Y,"aria-label",`Редактировать предмет ${f(oe).name??""}`),me(ge,f(oe).name),me(Pe,f(oe).id),Z=Nt(ue,1,"item-type-badge svelte-asgatj",null,Z,Oe),me(re,Xe),me(Ae,`${f(oe).description??""} || `)},[()=>({editing:Ye().editingItemIndex===f(ve)}),()=>({tool:f(oe).type==="tool",key:f(oe).type==="key",consumable:f(oe).type==="consumable",quest:f(oe).type==="quest",misc:f(oe).type==="misc"}),()=>h(f(oe).type)]),W(ie,fe)}),W(C,O)},U=C=>{var O=rp();W(C,O)};Re(H,C=>{Ye().data?.items?.length?C(L):C(U,!1)})}var $=j(H,2);$.__click=n,W(P,F)};Re(k,P=>{Ye().showItems&&P(x)})}ke(()=>{Ne(g,"title",Ye().showItems?"Скрыть предметы":"Показать предметы"),Ne(g,"aria-expanded",Ye().showItems),me(b,` Предметы (${(Ye().data?.items?.length||0)??""})`),me(p,Ye().showItems?"▼":"▶")}),W(r,v),Ot()}Ft(["click","change"]);Ft(["click"]);class ap{#i=Me(pt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return f(this.#i)}set player(e){ne(this.#i,e,!0)}#r=Me(null);get storyData(){return f(this.#r)}set storyData(e){ne(this.#r,e,!0)}#e=Me("0");get currentDialogueId(){return f(this.#e)}set currentDialogueId(e){ne(this.#e,e,!0)}#s=Me(!0);get isLoading(){return f(this.#s)}set isLoading(e){ne(this.#s,e,!0)}#a=Me("");get error(){return f(this.#a)}set error(e){ne(this.#a,e,!0)}#t=Me(null);get selectedStory(){return f(this.#t)}set selectedStory(e){ne(this.#t,e,!0)}#n=Me(pt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return f(this.#n)}set availableStories(e){ne(this.#n,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Tt=new ap;var _s={exports:{}},op=_s.exports,Ol;function lp(){return Ol||(Ol=1,(function(r,e){(function(n,i){r.exports=i()})(op,()=>(()=>{var t=[,((u,h,v)=>{v.r(h),v.d(h,{default:()=>m});var g=(()=>{var b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var p=S,k,x;p.ready=new Promise((s,a)=>{k=s,x=a});function P(){function s(M){const z=_;c=a=0,_=new Map,z.forEach(J=>{try{J(M)}catch(N){console.error(N)}}),this.pb(),I&&I.Tb()}let a=0,c=0,_=new Map,I=null,A=null;this.requestAnimationFrame=function(M){a||(a=requestAnimationFrame(s.bind(this)));const z=++c;return _.set(z,M),z},this.cancelAnimationFrame=function(M){_.delete(M),a&&_.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(M){A&&(document.body.remove(A),A=null),M||(A=document.createElement("div"),A.style.backgroundColor="black",A.style.position="fixed",A.style.right=0,A.style.top=0,A.style.color="white",A.style.padding="4px",A.innerHTML="RIVE FPS",M=function(z){A.innerHTML="RIVE FPS "+z.toFixed(1)},document.body.appendChild(A)),I=new function(){let z=0,J=0;this.Tb=function(){var N=performance.now();J?(++z,N-=J,1e3<N&&(M(1e3*z/N),z=J=0)):(J=N,z=0)}}},this.Ob=function(){A&&(document.body.remove(A),A=null),I=null},this.pb=function(){}}function F(s){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(_){return _=_+((1<<s)-1)>>s,a.has(_)&&clearTimeout(a.get(_)),a.set(_,setTimeout(function(){a.delete(_),a.length==0?c=-1/0:_==c&&(c=Math.max(...a.keys()),console.assert(c<_))},1e3)),c=Math.max(_,c),c<<s}}const H=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){H&&H();let s=p.decodeAudio;p.decodeAudio=function(I,A){I=s(I),A(I)};let a=p.decodeFont;p.decodeFont=function(I,A){I=a(I),A(I)};const c=p.FileAssetLoader;p.ptrToAsset=I=>{let A=p.ptrToFileAsset(I);return A.isImage?p.ptrToImageAsset(I):A.isFont?p.ptrToFontAsset(I):A.isAudio?p.ptrToAudioAsset(I):A},p.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:I}){this.__parent.__construct.call(this),this.Gb=I},loadContents:function(I,A){return I=p.ptrToAsset(I),this.Gb(I,A)}}),p.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(I){let A=p.ptrToAsset(I);return I=A.cdnUuid,I===""?!1:((function(M,z){var J=new XMLHttpRequest;J.responseType="arraybuffer",J.onreadystatechange=function(){J.readyState==4&&J.status==200&&z(J)},J.open("GET",M,!0),J.send(null)})(A.cdnBaseUrl+"/"+I,M=>{A.decode(new Uint8Array(M.response))}),!0)}}),p.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(I){this.lb.push(I)},loadContents:function(I,A){for(let M of this.lb)if(M.loadContents(I,A))return!0;return!1}});let _=p.computeAlignment;p.computeAlignment=function(I,A,M,z,J=1){return _.call(this,I,A,M,z,J)}};const L="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),U=new function(){function s(){if(!a){let rt=function(at,Te,Mt){if(Te=pe.createShader(Te),pe.shaderSource(Te,Mt),pe.compileShader(Te),Mt=pe.getShaderInfoLog(Te),0<(Mt||"").length)throw Mt;pe.attachShader(at,Te)};var D=document.createElement("canvas"),ye={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let pe;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(pe=D.getContext("webgl",ye),c=1,!pe)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(pe=D.getContext("webgl2",ye))c=2;else if(pe=D.getContext("webgl",ye))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(pe=new Proxy(pe,{get(at,Te){if(at.isContextLost()){if(J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Te),J=!0),typeof at[Te]=="function")return function(){}}else return typeof at[Te]=="function"?function(...Mt){return at[Te].apply(at,Mt)}:at[Te]},set(at,Te,Mt){if(at.isContextLost())J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Te),J=!0);else return at[Te]=Mt,!0}}),_=Math.min(pe.getParameter(pe.MAX_RENDERBUFFER_SIZE),pe.getParameter(pe.MAX_TEXTURE_SIZE)),D=pe.createProgram(),rt(D,pe.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),rt(D,pe.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),pe.bindAttribLocation(D,0,"vertex"),pe.bindAttribLocation(D,1,"uv"),pe.linkProgram(D),ye=pe.getProgramInfoLog(D),0<(ye||"").trim().length)throw ye;I=pe.getUniformLocation(D,"mat"),A=pe.getUniformLocation(D,"translate"),pe.useProgram(D),pe.bindBuffer(pe.ARRAY_BUFFER,pe.createBuffer()),pe.enableVertexAttribArray(0),pe.enableVertexAttribArray(1),pe.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,pe.createBuffer()),pe.uniform1i(pe.getUniformLocation(D,"image"),0),pe.pixelStorei(pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=pe}return!0}let a=null,c=0,_=0,I=null,A=null,M=0,z=0,J=!1;s(),this.hc=function(){return s(),_},this.Mb=function(D){a.deleteTexture&&a.deleteTexture(D)},this.Lb=function(D){if(!s())return null;const ye=a.createTexture();return ye?(a.bindTexture(a.TEXTURE_2D,ye),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,D),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),ye):null};const N=new F(8),be=new F(8),Ee=new F(10),Le=new F(10);this.Qb=function(D,ye,pe,rt,at){if(s()){var Te=N.push(D),Mt=be.push(ye);if(a.canvas){(a.canvas.width!=Te||a.canvas.height!=Mt)&&(a.canvas.width=Te,a.canvas.height=Mt),a.viewport(0,Mt-ye,D,ye),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),pe.sort((ht,Er)=>Er.xb-ht.xb),Te=Ee.push(rt),M!=Te&&(a.bufferData(a.ARRAY_BUFFER,8*Te,a.DYNAMIC_DRAW),M=Te),Te=0;for(var Xt of pe)a.bufferSubData(a.ARRAY_BUFFER,Te,Xt.Ua),Te+=4*Xt.Ua.length;console.assert(Te==4*rt);for(var Sr of pe)a.bufferSubData(a.ARRAY_BUFFER,Te,Sr.Db),Te+=4*Sr.Db.length;console.assert(Te==8*rt),Te=Le.push(at),z!=Te&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*Te,a.DYNAMIC_DRAW),z=Te),Xt=0;for(var vn of pe)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Xt,vn.indices),Xt+=2*vn.indices.length;console.assert(Xt==2*at),vn=0,Sr=!0,Te=Xt=0;for(const ht of pe){ht.image.Ka!=vn&&(a.bindTexture(a.TEXTURE_2D,ht.image.Ja||null),vn=ht.image.Ka),ht.mc?(a.scissor(ht.Za,Mt-ht.$a-ht.kb,ht.Ac,ht.kb),Sr=!0):Sr&&(a.scissor(0,Mt-ye,D,ye),Sr=!1),pe=2/D;const Er=-2/ye;a.uniform4f(I,ht.ha[0]*pe*ht.Ba,ht.ha[1]*Er*ht.Ca,ht.ha[2]*pe*ht.Ba,ht.ha[3]*Er*ht.Ca),a.uniform2f(A,ht.ha[4]*pe*ht.Ba+pe*(ht.Za-ht.ic*ht.Ba)-1,ht.ha[5]*Er*ht.Ca+Er*(ht.$a-ht.jc*ht.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,Te),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,Te+4*rt),a.drawElements(a.TRIANGLES,ht.indices.length,a.UNSIGNED_SHORT,Xt),Te+=4*ht.Ua.length,Xt+=2*ht.indices.length}console.assert(Te==4*rt),console.assert(Xt==2*at)}}},this.canvas=function(){return s()&&a.canvas}},$=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function s(he){switch(he){case N.srcOver:return"source-over";case N.screen:return"screen";case N.overlay:return"overlay";case N.darken:return"darken";case N.lighten:return"lighten";case N.colorDodge:return"color-dodge";case N.colorBurn:return"color-burn";case N.hardLight:return"hard-light";case N.softLight:return"soft-light";case N.difference:return"difference";case N.exclusion:return"exclusion";case N.multiply:return"multiply";case N.hue:return"hue";case N.saturation:return"saturation";case N.color:return"color";case N.luminosity:return"luminosity"}}function a(he){return"rgba("+((16711680&he)>>>16)+","+((65280&he)>>>8)+","+((255&he)>>>0)+","+((4278190080&he)>>>24)/255+")"}function c(){0<Mt.length&&(U.Qb(Te.drawWidth(),Te.drawHeight(),Mt,Xt,Sr),Mt=[],Sr=Xt=0,Te.reset(512,512));for(const he of at){for(const xe of he.H)xe();he.H=[]}at.clear()}$&&$();var _=p.RenderPaintStyle;const I=p.RenderPath,A=p.RenderPaint,M=p.Renderer,z=p.StrokeCap,J=p.StrokeJoin,N=p.BlendMode,be=_.fill,Ee=_.stroke,Le=p.FillRule.evenOdd;let D=1;var ye=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:he,xa:xe}={}){this.__parent.__construct.call(this),this.Ka=D,D=D+1&2147483647||1,this.la=he,this.xa=xe},__destruct:function(){this.Ja&&(U.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(he){var xe=this;xe.xa&&xe.xa(xe);var ct=new Image;xe.Xa=URL.createObjectURL(new Blob([he],{type:"image/png"})),ct.onload=function(){xe.Fb=ct,xe.Ja=U.Lb(ct),xe.size(ct.width,ct.height),xe.la&&xe.la(xe)},ct.src=xe.Xa}}),pe=I.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(he,xe,ct,vt,nt,dt,yt){var It=this.T,_r=It.addPath;he=he.T;const Ht=new DOMMatrix;Ht.a=xe,Ht.b=ct,Ht.c=vt,Ht.d=nt,Ht.e=dt,Ht.f=yt,_r.call(It,he,Ht)},fillRule:function(he){this.Wa=he},moveTo:function(he,xe){this.T.moveTo(he,xe)},lineTo:function(he,xe){this.T.lineTo(he,xe)},cubicTo:function(he,xe,ct,vt,nt,dt){this.T.bezierCurveTo(he,xe,ct,vt,nt,dt)},close:function(){this.T.closePath()}}),rt=A.extend("CanvasRenderPaint",{color:function(he){this.Ya=a(he)},thickness:function(he){this.Ib=he},join:function(he){switch(he){case J.miter:this.Ia="miter";break;case J.round:this.Ia="round";break;case J.bevel:this.Ia="bevel"}},cap:function(he){switch(he){case z.butt:this.Ha="butt";break;case z.round:this.Ha="round";break;case z.square:this.Ha="square"}},style:function(he){this.Hb=he},blendMode:function(he){this.Eb=s(he)},clearGradient:function(){this.ja=null},linearGradient:function(he,xe,ct,vt){this.ja={zb:he,Ab:xe,cb:ct,eb:vt,Ra:[]}},radialGradient:function(he,xe,ct,vt){this.ja={zb:he,Ab:xe,cb:ct,eb:vt,Ra:[],ec:!0}},addStop:function(he,xe){this.ja.Ra.push({color:he,stop:xe})},completeGradient:function(){},draw:function(he,xe,ct){let vt=this.Hb;var nt=this.Ya,dt=this.ja;if(he.globalCompositeOperation=this.Eb,dt!=null){nt=dt.zb;var yt=dt.Ab;const _r=dt.cb;var It=dt.eb;const Ht=dt.Ra;dt.ec?(dt=_r-nt,It-=yt,nt=he.createRadialGradient(nt,yt,0,nt,yt,Math.sqrt(dt*dt+It*It))):nt=he.createLinearGradient(nt,yt,_r,It);for(let cr=0,zt=Ht.length;cr<zt;cr++)yt=Ht[cr],nt.addColorStop(yt.stop,a(yt.color));this.Ya=nt,this.ja=null}switch(vt){case Ee:he.strokeStyle=nt,he.lineWidth=this.Ib,he.lineCap=this.Ha,he.lineJoin=this.Ia,he.stroke(xe);break;case be:he.fillStyle=nt,he.fill(xe,ct)}}});const at=new Set;let Te=null,Mt=[],Xt=0,Sr=0;var vn=p.CanvasRenderer=M.extend("Renderer",{__construct:function(he){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=he.getContext("2d"),this.Va=he,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const he=this.S.length-6;if(6>he)throw"restore() called without matching save().";this.S.splice(he),this.H.push(this.C.restore.bind(this.C))},transform:function(he,xe,ct,vt,nt,dt){const yt=this.S,It=yt.length-6;yt.splice(It,6,yt[It]*he+yt[It+2]*xe,yt[It+1]*he+yt[It+3]*xe,yt[It]*ct+yt[It+2]*vt,yt[It+1]*ct+yt[It+3]*vt,yt[It]*nt+yt[It+2]*dt+yt[It+4],yt[It+1]*nt+yt[It+3]*dt+yt[It+5]),this.H.push(this.C.transform.bind(this.C,he,xe,ct,vt,nt,dt))},rotate:function(he){const xe=Math.sin(he);he=Math.cos(he),this.transform(he,xe,-xe,he,0,0)},_drawPath:function(he,xe){this.H.push(xe.draw.bind(xe,this.C,he.T,he.Wa===Le?"evenodd":"nonzero"))},_drawRiveImage:function(he,xe,ct,vt){var nt=he.Fb;if(nt){var dt=this.C,yt=s(ct);this.H.push(function(){dt.globalCompositeOperation=yt,dt.globalAlpha=vt,dt.drawImage(nt,0,0),dt.globalAlpha=1})}},_getMatrix:function(he){const xe=this.S,ct=xe.length-6;for(let vt=0;6>vt;++vt)he[vt]=xe[ct+vt]},_drawImageMesh:function(he,xe,ct,vt,nt,dt,yt,It,_r,Ht,cr){xe=this.C.canvas.width;var zt=this.C.canvas.height;const Bo=Ht-It,Wo=cr-_r;It=Math.max(It,0),_r=Math.max(_r,0),Ht=Math.min(Ht,xe),cr=Math.min(cr,zt);const Si=Ht-It,Ei=cr-_r;if(console.assert(Si<=Math.min(Bo,xe)),console.assert(Ei<=Math.min(Wo,zt)),!(0>=Si||0>=Ei)){Ht=Si<Bo||Ei<Wo,xe=cr=1;var pn=Math.ceil(Si*cr),gn=Math.ceil(Ei*xe);zt=U.hc(),pn>zt&&(cr*=zt/pn,pn=zt),gn>zt&&(xe*=zt/gn,gn=zt),Te||(Te=new p.DynamicRectanizer(zt),Te.reset(512,512)),zt=Te.addRect(pn,gn),0>zt&&(c(),at.add(this),zt=Te.addRect(pn,gn),console.assert(0<=zt));var Vo=zt&65535,qo=zt>>16;Mt.push({ha:this.S.slice(this.S.length-6),image:he,Za:Vo,$a:qo,ic:It,jc:_r,Ac:pn,kb:gn,Ba:cr,Ca:xe,Ua:new Float32Array(nt),Db:new Float32Array(dt),indices:new Uint16Array(yt),mc:Ht,xb:he.Ka<<1|(Ht?1:0)}),Xt+=nt.length,Sr+=yt.length;var $n=this.C,fc=s(ct);this.H.push(function(){$n.save(),$n.resetTransform(),$n.globalCompositeOperation=fc,$n.globalAlpha=vt;const Go=U.canvas();Go&&$n.drawImage(Go,Vo,qo,pn,gn,It,_r,Si,Ei),$n.restore()})}},_clipPath:function(he){this.H.push(this.C.clip.bind(this.C,he.T,he.Wa===Le?"evenodd":"nonzero"))},clear:function(){at.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(he,xe){this.transform(1,0,0,1,he,xe)}});p.makeRenderer=function(he){const xe=new vn(he),ct=xe.C;return new Proxy(xe,{get(vt,nt){if(typeof vt[nt]=="function")return function(...dt){return vt[nt].apply(vt,dt)};if(typeof ct[nt]=="function"){if(-1<L.indexOf(nt))throw Error("RiveException: Method call to '"+nt+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...dt){xe.H.push(ct[nt].bind(ct,...dt))}}return vt[nt]},set(vt,nt,dt){if(nt in ct)return xe.H.push(()=>{ct[nt]=dt}),!0}})},p.decodeImage=function(he,xe){new ye({la:xe}).decode(he)},p.renderFactory={makeRenderPaint:function(){return new rt},makeRenderPath:function(){return new pe},makeRenderImage:function(){let he=Er;return new ye({xa:()=>{he.total++},la:()=>{if(he.loaded++,he.loaded===he.total){const xe=he.ready;xe&&(xe(),he.ready=null)}}})}};let ht=p.load,Er=null;p.load=function(he,xe,ct=!0){const vt=new p.FallbackFileAssetLoader;return xe!==void 0&&vt.addLoader(xe),ct&&(xe=new p.CDNFileAssetLoader,vt.addLoader(xe)),new Promise(function(nt){let dt=null;Er={total:0,loaded:0,ready:function(){nt(dt)}},dt=ht(he,vt),Er.total==0&&nt(dt)})};let dc=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(he,xe,ct,vt,nt=1){dc.call(this,he,xe,ct,vt,nt)},_=new P,p.requestAnimationFrame=_.requestAnimationFrame.bind(_),p.cancelAnimationFrame=_.cancelAnimationFrame.bind(_),p.enableFPSCounter=_.Rb.bind(_),p.disableFPSCounter=_.Ob,_.pb=c,p.resolveAnimationFrame=c,p.cleanup=function(){Te&&Te.delete()}};var C=Object.assign({},p),O="./this.program",ie=typeof window=="object",oe=typeof importScripts=="function",ve="",fe,le;(ie||oe)&&(oe?ve=self.location.href:typeof document<"u"&&document.currentScript&&(ve=document.currentScript.src),b&&(ve=b),ve.indexOf("blob:")!==0?ve=ve.substr(0,ve.replace(/[?#].*/,"").lastIndexOf("/")+1):ve="",oe&&(le=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),fe=(s,a,c)=>{var _=new XMLHttpRequest;_.open("GET",s,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?a(_.response):c()},_.onerror=c,_.send(null)});var Y=p.print||console.log.bind(console),K=p.printErr||console.error.bind(console);Object.assign(p,C),C=null,p.thisProgram&&(O=p.thisProgram);var G;p.wasmBinary&&(G=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&Ve("no native wasm support detected");var V,R,Q=!1,ae,de,ge,$e,_e,Pe,ue,Z;function re(){var s=V.buffer;p.HEAP8=ae=new Int8Array(s),p.HEAP16=ge=new Int16Array(s),p.HEAP32=_e=new Int32Array(s),p.HEAPU8=de=new Uint8Array(s),p.HEAPU16=$e=new Uint16Array(s),p.HEAPU32=Pe=new Uint32Array(s),p.HEAPF32=ue=new Float32Array(s),p.HEAPF64=Z=new Float64Array(s)}var te,Ae=[],ee=[],ce=[];function we(){var s=p.preRun.shift();Ae.unshift(s)}var Ie=0,Ue=null;function Ve(s){throw p.onAbort&&p.onAbort(s),s="Aborted("+s+")",K(s),Q=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),x(s),s}function We(s){return s.startsWith("data:application/octet-stream;base64,")}var Oe;if(Oe="canvas_advanced.wasm",!We(Oe)){var Xe=Oe;Oe=p.locateFile?p.locateFile(Xe,ve):ve+Xe}function Ge(s){if(s==Oe&&G)return new Uint8Array(G);if(le)return le(s);throw"both async and sync fetching of the wasm failed"}function _t(s){if(!G&&(ie||oe)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>Ge(s));if(fe)return new Promise((a,c)=>{fe(s,_=>a(new Uint8Array(_)),c)})}return Promise.resolve().then(()=>Ge(s))}function lt(s,a,c){return _t(s).then(_=>WebAssembly.instantiate(_,a)).then(_=>_).then(c,_=>{K("failed to asynchronously prepare wasm: "+_),Ve(_)})}function Et(s,a){var c=Oe;return G||typeof WebAssembly.instantiateStreaming!="function"||We(c)||c.startsWith("file://")||typeof fetch!="function"?lt(c,s,a):fetch(c,{credentials:"same-origin"}).then(_=>WebAssembly.instantiateStreaming(_,s).then(a,function(I){return K("wasm streaming compile failed: "+I),K("falling back to ArrayBuffer instantiation"),lt(c,s,a)}))}var At,y,o={460492:(s,a,c,_,I)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=_,window.h.ga.yb=I;let A=window.h;A.D=[],A.yc=function(M){for(var z=0;z<A.D.length;++z)if(A.D[z]==null)return A.D[z]=M,z;return A.D.push(M),A.D.length-1},A.Cb=function(M){for(A.D[M]=null;0<A.D.length&&A.D[A.D.length-1]==null;)A.D.pop()},A.Sc=function(M){for(var z=0;z<A.D.length;++z)if(A.D[z]==M)return A.Cb(z)},A.ra=function(M){return A.D[M]},A.Ta=["touchend","click"],A.unlock=function(){for(var M=0;M<A.D.length;++M){var z=A.D[M];z!=null&&z.J!=null&&z.state===A.ga.yb&&z.J.resume().then(()=>{Do(z.qb)},J=>{console.error("Failed to resume audiocontext",J)})}A.Ta.map(function(J){document.removeEventListener(J,A.unlock,!0)})},A.Ta.map(function(M){document.addEventListener(M,A.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),a=s.sampleRate;return s.close(),a}catch{return 0}},463249:(s,a,c,_,I,A)=>{if(typeof window.h>"u")return-1;var M={},z={};return s==window.h.I.ya&&c!=0&&(z.sampleRate=c),M.J=new(window.AudioContext||window.webkitAudioContext)(z),M.J.suspend(),M.state=window.h.ga.stopped,c=0,s!=window.h.I.ya&&(c=a),M.Z=M.J.createScriptProcessor(_,c,a),M.Z.onaudioprocess=function(J){if((M.sa==null||M.sa.length==0)&&(M.sa=new Float32Array(ue.buffer,I,_*a)),s==window.h.I.capture||s==window.h.I.La){for(var N=0;N<a;N+=1)for(var be=J.inputBuffer.getChannelData(N),Ee=M.sa,Le=0;Le<_;Le+=1)Ee[Le*a+N]=be[Le];Fo(A,_,I)}if(s==window.h.I.ya||s==window.h.I.La)for($o(A,_,I),N=0;N<J.outputBuffer.numberOfChannels;++N)for(be=J.outputBuffer.getChannelData(N),Ee=M.sa,Le=0;Le<_;Le+=1)be[Le]=Ee[Le*a+N];else for(N=0;N<J.outputBuffer.numberOfChannels;++N)J.outputBuffer.getChannelData(N).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(J){M.Da=M.J.createMediaStreamSource(J),M.Da.connect(M.Z),M.Z.connect(M.J.destination)}).catch(function(J){console.log("Failed to get user media: "+J)}),s==window.h.I.ya&&M.Z.connect(M.J.destination),M.qb=A,window.h.yc(M)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},d=s=>{for(;0<s.length;)s.shift()(p)},w=(s,a)=>{for(var c=0,_=s.length-1;0<=_;_--){var I=s[_];I==="."?s.splice(_,1):I===".."?(s.splice(_,1),c++):c&&(s.splice(_,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},T=s=>{var a=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=w(s.split("/").filter(_=>!!_),!a).join("/"))||a||(s="."),s&&c&&(s+="/"),(a?"/":"")+s},q=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},se=s=>{if(s==="/")return"/";s=T(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},Ce=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);Ve("initRandomDevice")},Fe=s=>(Fe=Ce())(s);function je(){for(var s="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=w(s.split("/").filter(_=>!!_),!a).join("/"),(a?"/":"")+s||"."}var Be=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ke=(s,a,c)=>{var _=a+c;for(c=a;s[c]&&!(c>=_);)++c;if(16<c-a&&s.buffer&&Be)return Be.decode(s.subarray(a,c));for(_="";a<c;){var I=s[a++];if(I&128){var A=s[a++]&63;if((I&224)==192)_+=String.fromCharCode((I&31)<<6|A);else{var M=s[a++]&63;I=(I&240)==224?(I&15)<<12|A<<6|M:(I&7)<<18|A<<12|M<<6|s[a++]&63,65536>I?_+=String.fromCharCode(I):(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023))}}else _+=String.fromCharCode(I)}return _},wt=[],ft=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);127>=_?a++:2047>=_?a+=2:55296<=_&&57343>=_?(a+=4,++c):a+=3}return a},Wt=(s,a,c,_)=>{if(!(0<_))return 0;var I=c;_=c+_-1;for(var A=0;A<s.length;++A){var M=s.charCodeAt(A);if(55296<=M&&57343>=M){var z=s.charCodeAt(++A);M=65536+((M&1023)<<10)|z&1023}if(127>=M){if(c>=_)break;a[c++]=M}else{if(2047>=M){if(c+1>=_)break;a[c++]=192|M>>6}else{if(65535>=M){if(c+2>=_)break;a[c++]=224|M>>12}else{if(c+3>=_)break;a[c++]=240|M>>18,a[c++]=128|M>>12&63}a[c++]=128|M>>6&63}a[c++]=128|M&63}}return a[c]=0,c-I};function $t(s,a){var c=Array(ft(s)+1);return s=Wt(s,c,0,c.length),a&&(c.length=s),c}var Ct=[];function et(s,a){Ct[s]={input:[],F:[],V:a},Us(s,qe)}var qe={open:function(s){var a=Ct[s.node.za];if(!a)throw new De(43);s.s=a,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,a,c,_){if(!s.s||!s.s.V.jb)throw new De(60);for(var I=0,A=0;A<_;A++){try{var M=s.s.V.jb(s.s)}catch{throw new De(29)}if(M===void 0&&I===0)throw new De(6);if(M==null)break;I++,a[c+A]=M}return I&&(s.node.timestamp=Date.now()),I},write:function(s,a,c,_){if(!s.s||!s.s.V.Oa)throw new De(60);try{for(var I=0;I<_;I++)s.s.V.Oa(s.s,a[c+I])}catch{throw new De(29)}return _&&(s.node.timestamp=Date.now()),I}},kt={jb:function(){e:{if(!wt.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}wt=$t(s,!0)}s=wt.shift()}return s},Oa:function(s,a){a===null||a===10?(Y(Ke(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(Y(Ke(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},st={Oa:function(s,a){a===null||a===10?(K(Ke(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(K(Ke(s.F,0)),s.F=[])}};function ut(s,a){var c=s.j?s.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=s.j,s.j=new Uint8Array(a),0<s.v&&s.j.set(c.subarray(0,s.v),0))}var Se={O:null,U(){return Se.createNode(null,"/",16895,0)},createNode(s,a,c,_){if((c&61440)===24576||(c&61440)===4096)throw new De(63);return Se.O||(Se.O={dir:{node:{Y:Se.l.Y,P:Se.l.P,ka:Se.l.ka,va:Se.l.va,vb:Se.l.vb,Bb:Se.l.Bb,wb:Se.l.wb,tb:Se.l.tb,Ea:Se.l.Ea},stream:{ba:Se.m.ba}},file:{node:{Y:Se.l.Y,P:Se.l.P},stream:{ba:Se.m.ba,read:Se.m.read,write:Se.m.write,pa:Se.m.pa,mb:Se.m.mb,ob:Se.m.ob}},link:{node:{Y:Se.l.Y,P:Se.l.P,ma:Se.l.ma},stream:{}},ab:{node:{Y:Se.l.Y,P:Se.l.P},stream:Vu}}),c=io(s,a,c,_),(c.mode&61440)===16384?(c.l=Se.O.dir.node,c.m=Se.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Se.O.file.node,c.m=Se.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Se.O.link.node,c.m=Se.O.link.stream):(c.mode&61440)===8192&&(c.l=Se.O.ab.node,c.m=Se.O.ab.stream),c.timestamp=Date.now(),s&&(s.j[a]=c,s.timestamp=c.timestamp),c},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var a={};return a.Jc=(s.mode&61440)===8192?s.id:1,a.Mc=s.id,a.mode=s.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=s.za,(s.mode&61440)===16384?a.size=4096:(s.mode&61440)===32768?a.size=s.v:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Bc=new Date(s.timestamp),a.Nc=new Date(s.timestamp),a.Ic=new Date(s.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.v!=a))if(a==0)s.j=null,s.v=0;else{var c=s.j;s.j=new Uint8Array(a),c&&s.j.set(c.subarray(0,Math.min(a,s.v))),s.v=a}},ka(){throw $s[44]},va(s,a,c,_){return Se.createNode(s,a,c,_)},vb(s,a,c){if((s.mode&61440)===16384){try{var _=Bi(a,c)}catch{}if(_)for(var I in _.j)throw new De(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=c,a.j[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},Bb(s,a){delete s.j[a],s.timestamp=Date.now()},wb(s,a){var c=Bi(s,a),_;for(_ in c.j)throw new De(55);delete s.j[a],s.timestamp=Date.now()},tb(s){var a=[".",".."],c;for(c in s.j)s.j.hasOwnProperty(c)&&a.push(c);return a},Ea(s,a,c){return s=Se.createNode(s,a,41471,0),s.link=c,s},ma(s){if((s.mode&61440)!==40960)throw new De(28);return s.link}},m:{read(s,a,c,_,I){var A=s.node.j;if(I>=s.node.v)return 0;if(s=Math.min(s.node.v-I,_),8<s&&A.subarray)a.set(A.subarray(I,I+s),c);else for(_=0;_<s;_++)a[c+_]=A[I+_];return s},write(s,a,c,_,I,A){if(a.buffer===ae.buffer&&(A=!1),!_)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.j||s.j.subarray)){if(A)return s.j=a.subarray(c,c+_),s.v=_;if(s.v===0&&I===0)return s.j=a.slice(c,c+_),s.v=_;if(I+_<=s.v)return s.j.set(a.subarray(c,c+_),I),_}if(ut(s,I+_),s.j.subarray&&a.subarray)s.j.set(a.subarray(c,c+_),I);else for(A=0;A<_;A++)s.j[I+A]=a[c+A];return s.v=Math.max(s.v,I+_),_},ba(s,a,c){if(c===1?a+=s.position:c===2&&(s.node.mode&61440)===32768&&(a+=s.node.v),0>a)throw new De(28);return a},pa(s,a,c){ut(s.node,a+c),s.node.v=Math.max(s.node.v,a+c)},mb(s,a,c,_,I){if((s.node.mode&61440)!==32768)throw new De(43);if(s=s.node.j,I&2||s.buffer!==ae.buffer){if((0<c||c+a<s.length)&&(s.subarray?s=s.subarray(c,c+a):s=Array.prototype.slice.call(s,c,c+a)),c=!0,Ve(),a=void 0,!a)throw new De(48);ae.set(s,a)}else c=!1,a=s.byteOffset;return{o:a,M:c}},ob(s,a,c,_){return Se.m.write(s,a,0,_,c,!1),0}}};function He(s,a){var c=0;return s&&(c|=365),a&&(c|=146),c}var Vt=null,Mn={},Ni=[],Bu=1,pi=null,to=!0,De=null,$s={},dn=(s,a={})=>{if(s=je(s),!s)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new De(32);s=s.split("/").filter(M=>!!M);for(var c=Vt,_="/",I=0;I<s.length;I++){var A=I===s.length-1;if(A&&a.parent)break;if(c=Bi(c,s[I]),_=T(_+"/"+s[I]),c.wa&&(!A||A&&a.hb)&&(c=c.wa.root),!A||a.gb){for(A=0;(c.mode&61440)===40960;)if(c=qu(_),_=je(q(_),c),c=dn(_,{Qa:a.Qa+1}).node,40<A++)throw new De(32)}}return{path:_,node:c}},ro=s=>{for(var a;;){if(s===s.parent)return s=s.U.nb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}},no=(s,a)=>{for(var c=0,_=0;_<a.length;_++)c=(c<<5)-c+a.charCodeAt(_)|0;return(s+c>>>0)%pi.length},Bi=(s,a)=>{var c;if(c=(c=Wi(s,"x"))?c:s.l.ka?0:2)throw new De(c,s);for(c=pi[no(s.id,a)];c;c=c.lc){var _=c.name;if(c.parent.id===s.id&&_===a)return c}return s.l.ka(s,a)},io=(s,a,c,_)=>(s=new Ro(s,a,c,_),a=no(s.parent.id,s.name),s.lc=pi[a],pi[a]=s),so=s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},Wi=(s,a)=>{if(to)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},ao=(s,a)=>{try{return Bi(s,a),20}catch{}return Wi(s,"wx")},Wu=()=>{for(var s=0;4096>=s;s++)if(!Ni[s])return s;throw new De(33)},Gr=s=>{if(s=Ni[s],!s)throw new De(8);return s},oo=(s,a=-1)=>(_i||(_i=function(){this.h={}},_i.prototype={},Object.defineProperties(_i.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),s=Object.assign(new _i,s),a==-1&&(a=Wu()),s.X=a,Ni[a]=s),Vu={open:s=>{s.m=Mn[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new De(70)}},Us=(s,a)=>{Mn[s]={m:a}},lo=(s,a)=>{var c=a==="/",_=!a;if(c&&Vt)throw new De(10);if(!c&&!_){var I=dn(a,{hb:!1});if(a=I.path,I=I.node,I.wa)throw new De(10);if((I.mode&61440)!==16384)throw new De(54)}a={type:s,Qc:{},nb:a,kc:[]},s=s.U(a),s.U=a,a.root=s,c?Vt=s:I&&(I.wa=a,I.U&&I.U.kc.push(a))},vr=(s,a,c)=>{var _=dn(s,{parent:!0}).node;if(s=se(s),!s||s==="."||s==="..")throw new De(28);var I=ao(_,s);if(I)throw new De(I);if(!_.l.va)throw new De(63);return _.l.va(_,s,a,c)},Vi=(s,a,c)=>{typeof c>"u"&&(c=a,a=438),vr(s,a|8192,c)},Ns=(s,a)=>{if(!je(s))throw new De(44);var c=dn(a,{parent:!0}).node;if(!c)throw new De(44);a=se(a);var _=ao(c,a);if(_)throw new De(_);if(!c.l.Ea)throw new De(63);c.l.Ea(c,a,s)},qu=s=>{if(s=dn(s).node,!s)throw new De(44);if(!s.l.ma)throw new De(28);return je(ro(s.parent),s.l.ma(s))},qi=(s,a,c)=>{if(s==="")throw new De(44);if(typeof a=="string"){var _={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof _>"u")throw Error(`Unknown file open mode: ${a}`);a=_}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var I=s;else{s=T(s);try{I=dn(s,{gb:!(a&131072)}).node}catch{}}if(_=!1,a&64)if(I){if(a&128)throw new De(20)}else I=vr(s,c,0),_=!0;if(!I)throw new De(44);if((I.mode&61440)===8192&&(a&=-513),a&65536&&(I.mode&61440)!==16384)throw new De(54);if(!_&&(c=I?(I.mode&61440)===40960?32:(I.mode&61440)===16384&&(so(a)!=="r"||a&512)?31:Wi(I,so(a)):44))throw new De(c);if(a&512&&!_){if(c=I,c=typeof c=="string"?dn(c,{gb:!0}).node:c,!c.l.P)throw new De(63);if((c.mode&61440)===16384)throw new De(31);if((c.mode&61440)!==32768)throw new De(28);if(_=Wi(c,"w"))throw new De(_);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,I=oo({node:I,path:ro(I),flags:a,seekable:!0,position:0,m:I.m,zc:[],error:!1}),I.m.open&&I.m.open(I),!p.logReadFiles||a&1||(Gi||(Gi={}),s in Gi||(Gi[s]=1)),I},uo=(s,a,c)=>{if(s.X===null)throw new De(8);if(!s.seekable||!s.m.ba)throw new De(70);if(c!=0&&c!=1&&c!=2)throw new De(28);s.position=s.m.ba(s,a,c),s.zc=[]},co=()=>{De||(De=function(s,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(s),this.message="FS error"},De.prototype=Error(),De.prototype.constructor=De,[44].forEach(s=>{$s[s]=new De(s),$s[s].stack="<generic error, no stack>"}))},fo,gi=(s,a,c)=>{s=T("/dev/"+s);var _=He(!!a,!!c);Bs||(Bs=64);var I=Bs++<<8|0;Us(I,{open:A=>{A.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(A,M,z,J)=>{for(var N=0,be=0;be<J;be++){try{var Ee=a()}catch{throw new De(29)}if(Ee===void 0&&N===0)throw new De(6);if(Ee==null)break;N++,M[z+be]=Ee}return N&&(A.node.timestamp=Date.now()),N},write:(A,M,z,J)=>{for(var N=0;N<J;N++)try{c(M[z+N])}catch{throw new De(29)}return J&&(A.node.timestamp=Date.now()),N}}),Vi(s,_,I)},Bs,fn={},_i,Gi,mi=void 0;function Mr(){return mi+=4,_e[mi-4>>2]}function ho(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?`_${s}`:s}function Hi(s,a){return s=ho(s),{[s]:function(){return a.apply(this,arguments)}}[s]}function vo(){this.M=[void 0],this.ib=[]}var ur=new vo,Ln=void 0;function tt(s){throw new Ln(s)}var pr=s=>(s||tt("Cannot use deleted val. handle = "+s),ur.get(s).value),gr=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return ur.pa({ub:1,value:s})}};function po(s){var a=Error,c=Hi(s,function(_){this.name=s,this.message=_,_=Error(_).stack,_!==void 0&&(this.stack=this.toString()+`
`+_.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var go=void 0,_o=void 0;function Ut(s){for(var a="";de[s];)a+=_o[de[s++]];return a}var yi=[];function Ws(){for(;yi.length;){var s=yi.pop();s.g.fa=!1,s.delete()}}var bi=void 0,Lr={};function Vs(s,a){for(a===void 0&&tt("ptr should not be undefined");s.A;)a=s.na(a),s=s.A;return a}var hn={};function mo(s){s=Uo(s);var a=Ut(s);return $r(s),a}function wi(s,a){var c=hn[s];return c===void 0&&tt(a+" has unknown type "+mo(s)),c}function zi(){}var qs=!1;function yo(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function bo(s,a,c){return a===c?s:c.A===void 0?null:(s=bo(s,a,c.A),s===null?null:c.Pb(s))}var wo={};function Gu(s,a){return a=Vs(s,a),Lr[a]}var ko=void 0;function Ki(s){throw new ko(s)}function Yi(s,a){return a.u&&a.o||Ki("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Ki("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Dn(Object.create(s,{g:{value:a}}))}function Dn(s){return typeof FinalizationRegistry>"u"?(Dn=a=>a,s):(qs=new FinalizationRegistry(a=>{yo(a.g)}),Dn=a=>{var c=a.g;return c.G&&qs.register(a,{g:c},a),a},zi=a=>{qs.unregister(a)},Dn(s))}var Ji={};function ki(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function Ii(s){return this.fromWireType(_e[s>>2])}var Fn={},Xi={};function ar(s,a,c){function _(z){z=c(z),z.length!==s.length&&Ki("Mismatched type converter count");for(var J=0;J<s.length;++J)Ir(s[J],z[J])}s.forEach(function(z){Xi[z]=a});var I=Array(a.length),A=[],M=0;a.forEach((z,J)=>{hn.hasOwnProperty(z)?I[J]=hn[z]:(A.push(z),Fn.hasOwnProperty(z)||(Fn[z]=[]),Fn[z].push(()=>{I[J]=hn[z],++M,M===A.length&&_(I)}))}),A.length===0&&_(I)}function Qi(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Hu(s,a,c={}){var _=a.name;if(s||tt(`type "${_}" must have a positive integer typeid pointer`),hn.hasOwnProperty(s)){if(c.$b)return;tt(`Cannot register type '${_}' twice`)}hn[s]=a,delete Xi[s],Fn.hasOwnProperty(s)&&(a=Fn[s],delete Fn[s],a.forEach(I=>I()))}function Ir(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Hu(s,a,c)}function Gs(s){tt(s.g.u.i.name+" instance already deleted")}function Hr(){}function Hs(s,a,c){if(s[a].B===void 0){var _=s[a];s[a]=function(){return s[a].B.hasOwnProperty(arguments.length)||tt(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[a].B})!`),s[a].B[arguments.length].apply(this,arguments)},s[a].B=[],s[a].B[_.ea]=_}}function zs(s,a,c){p.hasOwnProperty(s)?((c===void 0||p[s].B!==void 0&&p[s].B[c]!==void 0)&&tt(`Cannot register public name '${s}' twice`),Hs(p,s,s),p.hasOwnProperty(c)&&tt(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),p[s].B[c]=a):(p[s]=a,c!==void 0&&(p[s].Pc=c))}function zu(s,a,c,_,I,A,M,z){this.name=s,this.constructor=a,this.N=c,this.W=_,this.A=I,this.Ub=A,this.na=M,this.Pb=z,this.rb=[]}function Zi(s,a,c){for(;a!==c;)a.na||tt(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),s=a.na(s),a=a.A;return s}function Ku(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Yu(s,a){if(a===null){if(this.Na&&tt(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return s!==null&&s.push(this.W,c),c}return 0}if(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Zi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&tt("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var _=a.clone();c=this.oc(c,gr(function(){_.delete()})),s!==null&&s.push(this.W,c)}break;default:tt("Unsupporting sharing policy")}return c}function Ju(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Dr(s,a,c,_){this.name=s,this.i=a,this.Na=c,this.ta=_,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Yu:(this.toWireType=_?Ku:Ju,this.K=null)}function Io(s,a,c){p.hasOwnProperty(s)||Ki("Replacing nonexistant public symbol"),p[s].B!==void 0&&c!==void 0?p[s].B[c]=a:(p[s]=a,p[s].ea=c)}var es=[],So=s=>{var a=es[s];return a||(s>=es.length&&(es.length=s+1),es[s]=a=te.get(s)),a},Xu=(s,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),s.includes("j")){var _=p["dynCall_"+s];_=c&&c.length?_.apply(null,[a].concat(c)):_.call(null,a)}else _=So(a).apply(null,c);return _}};function Qt(s,a){s=Ut(s);var c=s.includes("j")?Xu(s,a):So(a);return typeof c!="function"&&tt(`unknown function pointer with signature ${s}: ${a}`),c}var Eo=void 0;function Fr(s,a){function c(A){I[A]||hn[A]||(Xi[A]?Xi[A].forEach(c):(_.push(A),I[A]=!0))}var _=[],I={};throw a.forEach(c),new Eo(`${s}: `+_.map(mo).join([", "]))}function ts(s,a,c,_,I){var A=a.length;2>A&&tt("argTypes array size mismatch! Must at least get return value and 'this' types!");var M=a[1]!==null&&c!==null,z=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){z=!0;break}var J=a[0].name!=="void",N=A-2,be=Array(N),Ee=[],Le=[];return function(){if(arguments.length!==N&&tt(`function ${s} called with ${arguments.length} arguments, expected ${N} args!`),Le.length=0,Ee.length=M?2:1,Ee[0]=I,M){var D=a[1].toWireType(Le,this);Ee[1]=D}for(var ye=0;ye<N;++ye)be[ye]=a[ye+2].toWireType(Le,arguments[ye]),Ee.push(be[ye]);if(ye=_.apply(null,Ee),z)ki(Le);else for(var pe=M?1:2;pe<a.length;pe++){var rt=pe===1?D:be[pe-2];a[pe].K!==null&&a[pe].K(rt)}return D=J?a[0].fromWireType(ye):void 0,D}}function rs(s,a){for(var c=[],_=0;_<s;_++)c.push(Pe[a+4*_>>2]);return c}function Ao(s,a,c){return s instanceof Object||tt(`${c} with invalid "this": ${s}`),s instanceof a.i.constructor||tt(`${c} incompatible with "this" of type ${s.constructor.name}`),s.g.o||tt(`cannot call emscripten binding method ${c} on deleted object`),Zi(s.g.o,s.g.u.i,a.i)}function Ks(s){s>=ur.h&&--ur.get(s).ub===0&&ur.Zb(s)}function Qu(s,a,c){switch(a){case 0:return function(_){return this.fromWireType((c?ae:de)[_])};case 1:return function(_){return this.fromWireType((c?ge:$e)[_>>1])};case 2:return function(_){return this.fromWireType((c?_e:Pe)[_>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Ys(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Zu(s,a){switch(a){case 2:return function(c){return this.fromWireType(ue[c>>2])};case 3:return function(c){return this.fromWireType(Z[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function ec(s,a,c){switch(a){case 0:return c?function(_){return ae[_]}:function(_){return de[_]};case 1:return c?function(_){return ge[_>>1]}:function(_){return $e[_>>1]};case 2:return c?function(_){return _e[_>>2]}:function(_){return Pe[_>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Co=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,tc=(s,a)=>{for(var c=s>>1,_=c+a/2;!(c>=_)&&$e[c];)++c;if(c<<=1,32<c-s&&Co)return Co.decode(de.subarray(s,c));for(c="",_=0;!(_>=a/2);++_){var I=ge[s+2*_>>1];if(I==0)break;c+=String.fromCharCode(I)}return c},rc=(s,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var _=a;c=c<2*s.length?c/2:s.length;for(var I=0;I<c;++I)ge[a>>1]=s.charCodeAt(I),a+=2;return ge[a>>1]=0,a-_},nc=s=>2*s.length,ic=(s,a)=>{for(var c=0,_="";!(c>=a/4);){var I=_e[s+4*c>>2];if(I==0)break;++c,65536<=I?(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023)):_+=String.fromCharCode(I)}return _},sc=(s,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var _=a;c=_+c-4;for(var I=0;I<s.length;++I){var A=s.charCodeAt(I);if(55296<=A&&57343>=A){var M=s.charCodeAt(++I);A=65536+((A&1023)<<10)|M&1023}if(_e[a>>2]=A,a+=4,a+4>c)break}return _e[a>>2]=0,a-_},ac=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);55296<=_&&57343>=_&&++c,a+=4}return a},oc={};function ns(s){var a=oc[s];return a===void 0?Ut(s):a}var is=[];function lc(s){var a=is.length;return is.push(s),a}function uc(s,a){for(var c=Array(s),_=0;_<s;++_)c[_]=wi(Pe[a+4*_>>2],"parameter "+_);return c}var jo=[],Js=[],Xs={},To=()=>{if(!Qs){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:O||"./this.program"},a;for(a in Xs)Xs[a]===void 0?delete s[a]:s[a]=Xs[a];var c=[];for(a in s)c.push(`${a}=${s[a]}`);Qs=c}return Qs},Qs,ss=s=>s%4===0&&(s%100!==0||s%400===0),xo=[31,29,31,30,31,30,31,31,30,31,30,31],Po=[31,28,31,30,31,30,31,31,30,31,30,31],cc=(s,a,c,_)=>{function I(D,ye,pe){for(D=typeof D=="number"?D.toString():D||"";D.length<ye;)D=pe[0]+D;return D}function A(D,ye){return I(D,ye,"0")}function M(D,ye){function pe(at){return 0>at?-1:0<at?1:0}var rt;return(rt=pe(D.getFullYear()-ye.getFullYear()))===0&&(rt=pe(D.getMonth()-ye.getMonth()))===0&&(rt=pe(D.getDate()-ye.getDate())),rt}function z(D){switch(D.getDay()){case 0:return new Date(D.getFullYear()-1,11,29);case 1:return D;case 2:return new Date(D.getFullYear(),0,3);case 3:return new Date(D.getFullYear(),0,2);case 4:return new Date(D.getFullYear(),0,1);case 5:return new Date(D.getFullYear()-1,11,31);case 6:return new Date(D.getFullYear()-1,11,30)}}function J(D){var ye=D.ca;for(D=new Date(new Date(D.da+1900,0,1).getTime());0<ye;){var pe=D.getMonth(),rt=(ss(D.getFullYear())?xo:Po)[pe];if(ye>rt-D.getDate())ye-=rt-D.getDate()+1,D.setDate(1),11>pe?D.setMonth(pe+1):(D.setMonth(0),D.setFullYear(D.getFullYear()+1));else{D.setDate(D.getDate()+ye);break}}return pe=new Date(D.getFullYear()+1,0,4),ye=z(new Date(D.getFullYear(),0,4)),pe=z(pe),0>=M(ye,D)?0>=M(pe,D)?D.getFullYear()+1:D.getFullYear():D.getFullYear()-1}var N=_e[_+40>>2];_={wc:_e[_>>2],vc:_e[_+4>>2],Fa:_e[_+8>>2],Sa:_e[_+12>>2],Ga:_e[_+16>>2],da:_e[_+20>>2],R:_e[_+24>>2],ca:_e[_+28>>2],Rc:_e[_+32>>2],uc:_e[_+36>>2],xc:N&&N?Ke(de,N):""},c=c?Ke(de,c):"",N={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var be in N)c=c.replace(new RegExp(be,"g"),N[be]);var Ee="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Le="January February March April May June July August September October November December".split(" ");N={"%a":D=>Ee[D.R].substring(0,3),"%A":D=>Ee[D.R],"%b":D=>Le[D.Ga].substring(0,3),"%B":D=>Le[D.Ga],"%C":D=>A((D.da+1900)/100|0,2),"%d":D=>A(D.Sa,2),"%e":D=>I(D.Sa,2," "),"%g":D=>J(D).toString().substring(2),"%G":D=>J(D),"%H":D=>A(D.Fa,2),"%I":D=>(D=D.Fa,D==0?D=12:12<D&&(D-=12),A(D,2)),"%j":D=>{for(var ye=0,pe=0;pe<=D.Ga-1;ye+=(ss(D.da+1900)?xo:Po)[pe++]);return A(D.Sa+ye,3)},"%m":D=>A(D.Ga+1,2),"%M":D=>A(D.vc,2),"%n":()=>`
`,"%p":D=>0<=D.Fa&&12>D.Fa?"AM":"PM","%S":D=>A(D.wc,2),"%t":()=>"	","%u":D=>D.R||7,"%U":D=>A(Math.floor((D.ca+7-D.R)/7),2),"%V":D=>{var ye=Math.floor((D.ca+7-(D.R+6)%7)/7);if(2>=(D.R+371-D.ca-2)%7&&ye++,ye)ye==53&&(pe=(D.R+371-D.ca)%7,pe==4||pe==3&&ss(D.da)||(ye=1));else{ye=52;var pe=(D.R+7-D.ca-1)%7;(pe==4||pe==5&&ss(D.da%400-1))&&ye++}return A(ye,2)},"%w":D=>D.R,"%W":D=>A(Math.floor((D.ca+7-(D.R+6)%7)/7),2),"%y":D=>(D.da+1900).toString().substring(2),"%Y":D=>D.da+1900,"%z":D=>{D=D.uc;var ye=0<=D;return D=Math.abs(D)/60,(ye?"+":"-")+("0000"+(D/60*100+D%60)).slice(-4)},"%Z":D=>D.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(be in N)c.includes(be)&&(c=c.replace(new RegExp(be,"g"),N[be](_)));return c=c.replace(/\0\0/g,"%"),be=$t(c,!1),be.length>a?0:(ae.set(be,s),be.length-1)};function Ro(s,a,c,_){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Bu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=_}Object.defineProperties(Ro.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),co(),pi=Array(4096),lo(Se,"/"),vr("/tmp",16895,0),vr("/home",16895,0),vr("/home/web_user",16895,0),(()=>{vr("/dev",16895,0),Us(259,{read:()=>0,write:(_,I,A,M)=>M}),Vi("/dev/null",259),et(1280,kt),et(1536,st),Vi("/dev/tty",1280),Vi("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=Fe(s).byteLength),s[--a]);gi("random",c),gi("urandom",c),vr("/dev/shm",16895,0),vr("/dev/shm/tmp",16895,0)})(),(()=>{vr("/proc",16895,0);var s=vr("/proc/self",16895,0);vr("/proc/self/fd",16895,0),lo({U:()=>{var a=io(s,"fd",16895,73);return a.l={ka:(c,_)=>{var I=Gr(+_);return c={parent:null,U:{nb:"fake"},l:{ma:()=>I.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(vo.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var a=this.ib.pop()||this.M.length;return this.M[a]=s,a},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Ln=p.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},ur.M.push({value:void 0},{value:null},{value:!0},{value:!1}),ur.h=ur.M.length,p.count_emval_handles=function(){for(var s=0,a=ur.h;a<ur.M.length;++a)ur.M[a]!==void 0&&++s;return s},go=p.PureVirtualError=po("PureVirtualError");for(var Oo=Array(256),as=0;256>as;++as)Oo[as]=String.fromCharCode(as);_o=Oo,p.getInheritedInstanceCount=function(){return Object.keys(Lr).length},p.getLiveInheritedInstances=function(){var s=[],a;for(a in Lr)Lr.hasOwnProperty(a)&&s.push(Lr[a]);return s},p.flushPendingDeletes=Ws,p.setDelayFunction=function(s){bi=s,yi.length&&bi&&bi(Ws)},ko=p.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Hr.prototype.isAliasOf=function(s){if(!(this instanceof Hr&&s instanceof Hr))return!1;var a=this.g.u.i,c=this.g.o,_=s.g.u.i;for(s=s.g.o;a.A;)c=a.na(c),a=a.A;for(;_.A;)s=_.na(s),_=_.A;return a===_&&c===s},Hr.prototype.clone=function(){if(this.g.o||Gs(this),this.g.ia)return this.g.count.value+=1,this;var s=Dn,a=Object,c=a.create,_=Object.getPrototypeOf(this),I=this.g;return s=s(c.call(a,_,{g:{value:{count:I.count,fa:I.fa,ia:I.ia,o:I.o,u:I.u,G:I.G,L:I.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Hr.prototype.delete=function(){this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),zi(this),yo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Hr.prototype.isDeleted=function(){return!this.g.o},Hr.prototype.deleteLater=function(){return this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),yi.push(this),yi.length===1&&bi&&bi(Ws),this.g.fa=!0,this},Dr.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Dr.prototype.bb=function(s){this.W&&this.W(s)},Dr.prototype.argPackAdvance=8,Dr.prototype.readValueFromPointer=Ii,Dr.prototype.deleteObject=function(s){s!==null&&s.delete()},Dr.prototype.fromWireType=function(s){function a(){return this.ua?Yi(this.i.N,{u:this.nc,o:c,L:this,G:s}):Yi(this.i.N,{u:this,o:s})}var c=this.Vb(s);if(!c)return this.bb(s),null;var _=Gu(this.i,c);if(_!==void 0)return _.g.count.value===0?(_.g.o=c,_.g.G=s,_.clone()):(_=_.clone(),this.bb(s),_);if(_=this.i.Ub(c),_=wo[_],!_)return a.call(this);_=this.ta?_.Kb:_.pointerType;var I=bo(c,this.i,_.i);return I===null?a.call(this):this.ua?Yi(_.i.N,{u:_,o:I,L:this,G:s}):Yi(_.i.N,{u:_,o:I})},Eo=p.UnboundTypeError=po("UnboundTypeError");var Mo={__syscall_fcntl64:function(s,a,c){mi=c;try{var _=Gr(s);switch(a){case 0:var I=Mr();return 0>I?-28:oo(_,I).X;case 1:case 2:return 0;case 3:return _.flags;case 4:return I=Mr(),_.flags|=I,0;case 5:return I=Mr(),ge[I+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return _e[Lo()>>2]=28,-1;default:return-28}}catch(A){if(typeof fn>"u"||A.name!=="ErrnoError")throw A;return-A.aa}},__syscall_ioctl:function(s,a,c){mi=c;try{var _=Gr(s);switch(a){case 21509:return _.s?0:-59;case 21505:if(!_.s)return-59;if(_.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var I=Mr();_e[I>>2]=25856,_e[I+4>>2]=5,_e[I+8>>2]=191,_e[I+12>>2]=35387;for(var A=0;32>A;A++)ae[I+A+17>>0]=a[A]||0}return 0;case 21510:case 21511:case 21512:return _.s?0:-59;case 21506:case 21507:case 21508:if(!_.s)return-59;if(_.s.V.cc)for(I=Mr(),a=[],A=0;32>A;A++)a.push(ae[I+A+17>>0]);return 0;case 21519:return _.s?(I=Mr(),_e[I>>2]=0):-59;case 21520:return _.s?-28:-59;case 21531:if(I=Mr(),!_.m.ac)throw new De(59);return _.m.ac(_,a,I);case 21523:return _.s?(_.s.V.dc&&(A=[24,80],I=Mr(),ge[I>>1]=A[0],ge[I+2>>1]=A[1]),0):-59;case 21524:return _.s?0:-59;case 21515:return _.s?0:-59;default:return-28}}catch(M){if(typeof fn>"u"||M.name!=="ErrnoError")throw M;return-M.aa}},__syscall_openat:function(s,a,c,_){mi=_;try{a=a?Ke(de,a):"";var I=a;if(I.charAt(0)==="/")a=I;else{var A=s===-100?"/":Gr(s).path;if(I.length==0)throw new De(44);a=T(A+"/"+I)}var M=_?Mr():0;return qi(a,c,M).X}catch(z){if(typeof fn>"u"||z.name!=="ErrnoError")throw z;return-z.aa}},_embind_create_inheriting_constructor:function(s,a,c){s=Ut(s),a=wi(a,"wrapper"),c=pr(c);var _=[].slice,I=a.i,A=I.N,M=I.A.N,z=I.A.constructor;s=Hi(s,function(){I.A.rb.forEach((function(N){if(this[N]===M[N])throw new go(`Pure virtual function ${N} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:A}),this.__construct.apply(this,_.call(arguments))}),A.__construct=function(){this===A&&tt("Pass correct 'this' to __construct");var N=z.implement.apply(void 0,[this].concat(_.call(arguments)));zi(N);var be=N.g;N.notifyOnDestruction(),be.ia=!0,Object.defineProperties(this,{g:{value:be}}),Dn(this),N=be.o,N=Vs(I,N),Lr.hasOwnProperty(N)?tt(`Tried to register registered instance: ${N}`):Lr[N]=this},A.__destruct=function(){this===A&&tt("Pass correct 'this' to __destruct"),zi(this);var N=this.g.o;N=Vs(I,N),Lr.hasOwnProperty(N)?delete Lr[N]:tt(`Tried to unregister unregistered instance: ${N}`)},s.prototype=Object.create(A);for(var J in c)s.prototype[J]=c[J];return gr(s)},_embind_finalize_value_object:function(s){var a=Ji[s];delete Ji[s];var c=a.Pa,_=a.W,I=a.fb,A=I.map(M=>M.Yb).concat(I.map(M=>M.rc));ar([s],A,M=>{var z={};return I.forEach((J,N)=>{var be=M[N],Ee=J.Wb,Le=J.Xb,D=M[N+I.length],ye=J.qc,pe=J.sc;z[J.Sb]={read:rt=>be.fromWireType(Ee(Le,rt)),write:(rt,at)=>{var Te=[];ye(pe,rt,D.toWireType(Te,at)),ki(Te)}}}),[{name:a.name,fromWireType:function(J){var N={},be;for(be in z)N[be]=z[be].read(J);return _(J),N},toWireType:function(J,N){for(var be in z)if(!(be in N))throw new TypeError(`Missing field: "${be}"`);var Ee=c();for(be in z)z[be].write(Ee,N[be]);return J!==null&&J.push(_,Ee),Ee},argPackAdvance:8,readValueFromPointer:Ii,K:_}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,a,c,_,I){var A=Qi(c);a=Ut(a),Ir(s,{name:a,fromWireType:function(M){return!!M},toWireType:function(M,z){return z?_:I},argPackAdvance:8,readValueFromPointer:function(M){if(c===1)var z=ae;else if(c===2)z=ge;else if(c===4)z=_e;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(z[M>>A])},K:null})},_embind_register_class:function(s,a,c,_,I,A,M,z,J,N,be,Ee,Le){be=Ut(be),A=Qt(I,A),z&&(z=Qt(M,z)),N&&(N=Qt(J,N)),Le=Qt(Ee,Le);var D=ho(be);zs(D,function(){Fr(`Cannot construct ${be} due to unbound types`,[_])}),ar([s,a,c],_?[_]:[],function(ye){if(ye=ye[0],_)var pe=ye.i,rt=pe.N;else rt=Hr.prototype;ye=Hi(D,function(){if(Object.getPrototypeOf(this)!==at)throw new Ln("Use 'new' to construct "+be);if(Te.$===void 0)throw new Ln(be+" has no accessible constructor");var Xt=Te.$[arguments.length];if(Xt===void 0)throw new Ln(`Tried to invoke ctor of ${be} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Te.$).toString()}) parameters instead!`);return Xt.apply(this,arguments)});var at=Object.create(rt,{constructor:{value:ye}});ye.prototype=at;var Te=new zu(be,ye,at,Le,pe,A,z,N);Te.A&&(Te.A.oa===void 0&&(Te.A.oa=[]),Te.A.oa.push(Te)),pe=new Dr(be,Te,!0,!1),rt=new Dr(be+"*",Te,!1,!1);var Mt=new Dr(be+" const*",Te,!1,!0);return wo[s]={pointerType:rt,Kb:Mt},Io(D,ye),[pe,rt,Mt]})},_embind_register_class_class_function:function(s,a,c,_,I,A,M){var z=rs(c,_);a=Ut(a),A=Qt(I,A),ar([],[s],function(J){function N(){Fr(`Cannot call ${be} due to unbound types`,z)}J=J[0];var be=`${J.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var Ee=J.i.constructor;return Ee[a]===void 0?(N.ea=c-1,Ee[a]=N):(Hs(Ee,a,be),Ee[a].B[c-1]=N),ar([],z,function(Le){if(Le=ts(be,[Le[0],null].concat(Le.slice(1)),null,A,M),Ee[a].B===void 0?(Le.ea=c-1,Ee[a]=Le):Ee[a].B[c-1]=Le,J.i.oa)for(const D of J.i.oa)D.constructor.hasOwnProperty(a)||(D.constructor[a]=Le);return[]}),[]})},_embind_register_class_class_property:function(s,a,c,_,I,A,M,z){a=Ut(a),A=Qt(I,A),ar([],[s],function(J){J=J[0];var N=`${J.name}.${a}`,be={get(){Fr(`Cannot access ${N} due to unbound types`,[c])},enumerable:!0,configurable:!0};return be.set=z?()=>{Fr(`Cannot access ${N} due to unbound types`,[c])}:()=>{tt(`${N} is a read-only property`)},Object.defineProperty(J.i.constructor,a,be),ar([],[c],function(Ee){Ee=Ee[0];var Le={get(){return Ee.fromWireType(A(_))},enumerable:!0};return z&&(z=Qt(M,z),Le.set=D=>{var ye=[];z(_,Ee.toWireType(ye,D)),ki(ye)}),Object.defineProperty(J.i.constructor,a,Le),[]}),[]})},_embind_register_class_constructor:function(s,a,c,_,I,A){var M=rs(a,c);I=Qt(_,I),ar([],[s],function(z){z=z[0];var J=`constructor ${z.name}`;if(z.i.$===void 0&&(z.i.$=[]),z.i.$[a-1]!==void 0)throw new Ln(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${z.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return z.i.$[a-1]=()=>{Fr(`Cannot construct ${z.name} due to unbound types`,M)},ar([],M,function(N){return N.splice(1,0,null),z.i.$[a-1]=ts(J,N,null,I,A),[]}),[]})},_embind_register_class_function:function(s,a,c,_,I,A,M,z){var J=rs(c,_);a=Ut(a),A=Qt(I,A),ar([],[s],function(N){function be(){Fr(`Cannot call ${Ee} due to unbound types`,J)}N=N[0];var Ee=`${N.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),z&&N.i.rb.push(a);var Le=N.i.N,D=Le[a];return D===void 0||D.B===void 0&&D.className!==N.name&&D.ea===c-2?(be.ea=c-2,be.className=N.name,Le[a]=be):(Hs(Le,a,Ee),Le[a].B[c-2]=be),ar([],J,function(ye){return ye=ts(Ee,ye,N,A,M),Le[a].B===void 0?(ye.ea=c-2,Le[a]=ye):Le[a].B[c-2]=ye,[]}),[]})},_embind_register_class_property:function(s,a,c,_,I,A,M,z,J,N){a=Ut(a),I=Qt(_,I),ar([],[s],function(be){be=be[0];var Ee=`${be.name}.${a}`,Le={get(){Fr(`Cannot access ${Ee} due to unbound types`,[c,M])},enumerable:!0,configurable:!0};return Le.set=J?()=>{Fr(`Cannot access ${Ee} due to unbound types`,[c,M])}:()=>{tt(Ee+" is a read-only property")},Object.defineProperty(be.i.N,a,Le),ar([],J?[c,M]:[c],function(D){var ye=D[0],pe={get(){var at=Ao(this,be,Ee+" getter");return ye.fromWireType(I(A,at))},enumerable:!0};if(J){J=Qt(z,J);var rt=D[1];pe.set=function(at){var Te=Ao(this,be,Ee+" setter"),Mt=[];J(N,Te,rt.toWireType(Mt,at)),ki(Mt)}}return Object.defineProperty(be.i.N,a,pe),[]}),[]})},_embind_register_emval:function(s,a){a=Ut(a),Ir(s,{name:a,fromWireType:function(c){var _=pr(c);return Ks(c),_},toWireType:function(c,_){return gr(_)},argPackAdvance:8,readValueFromPointer:Ii,K:null})},_embind_register_enum:function(s,a,c,_){function I(){}c=Qi(c),a=Ut(a),I.values={},Ir(s,{name:a,constructor:I,fromWireType:function(A){return this.constructor.values[A]},toWireType:function(A,M){return M.value},argPackAdvance:8,readValueFromPointer:Qu(a,c,_),K:null}),zs(a,I)},_embind_register_enum_value:function(s,a,c){var _=wi(s,"enum");a=Ut(a),s=_.constructor,_=Object.create(_.constructor.prototype,{value:{value:c},constructor:{value:Hi(`${_.name}_${a}`,function(){})}}),s.values[c]=_,s[a]=_},_embind_register_float:function(s,a,c){c=Qi(c),a=Ut(a),Ir(s,{name:a,fromWireType:function(_){return _},toWireType:function(_,I){return I},argPackAdvance:8,readValueFromPointer:Zu(a,c),K:null})},_embind_register_function:function(s,a,c,_,I,A){var M=rs(a,c);s=Ut(s),I=Qt(_,I),zs(s,function(){Fr(`Cannot call ${s} due to unbound types`,M)},a-1),ar([],M,function(z){return Io(s,ts(s,[z[0],null].concat(z.slice(1)),null,I,A),a-1),[]})},_embind_register_integer:function(s,a,c,_,I){a=Ut(a),I===-1&&(I=4294967295),I=Qi(c);var A=z=>z;if(_===0){var M=32-8*c;A=z=>z<<M>>>M}c=a.includes("unsigned")?function(z,J){return J>>>0}:function(z,J){return J},Ir(s,{name:a,fromWireType:A,toWireType:c,argPackAdvance:8,readValueFromPointer:ec(a,I,_!==0),K:null})},_embind_register_memory_view:function(s,a,c){function _(A){A>>=2;var M=Pe;return new I(M.buffer,M[A+1],M[A])}var I=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Ut(c),Ir(s,{name:c,fromWireType:_,argPackAdvance:8,readValueFromPointer:_},{$b:!0})},_embind_register_std_string:function(s,a){a=Ut(a);var c=a==="std::string";Ir(s,{name:a,fromWireType:function(_){var I=Pe[_>>2],A=_+4;if(c)for(var M=A,z=0;z<=I;++z){var J=A+z;if(z==I||de[J]==0){if(M=M?Ke(de,M,J-M):"",N===void 0)var N=M;else N+="\0",N+=M;M=J+1}}else{for(N=Array(I),z=0;z<I;++z)N[z]=String.fromCharCode(de[A+z]);N=N.join("")}return $r(_),N},toWireType:function(_,I){I instanceof ArrayBuffer&&(I=new Uint8Array(I));var A=typeof I=="string";A||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int8Array||tt("Cannot pass non-string to std::string");var M=c&&A?ft(I):I.length,z=Zs(4+M+1),J=z+4;if(Pe[z>>2]=M,c&&A)Wt(I,de,J,M+1);else if(A)for(A=0;A<M;++A){var N=I.charCodeAt(A);255<N&&($r(J),tt("String has UTF-16 code units that do not fit in 8 bits")),de[J+A]=N}else for(A=0;A<M;++A)de[J+A]=I[A];return _!==null&&_.push($r,z),z},argPackAdvance:8,readValueFromPointer:Ii,K:function(_){$r(_)}})},_embind_register_std_wstring:function(s,a,c){if(c=Ut(c),a===2)var _=tc,I=rc,A=nc,M=()=>$e,z=1;else a===4&&(_=ic,I=sc,A=ac,M=()=>Pe,z=2);Ir(s,{name:c,fromWireType:function(J){for(var N=Pe[J>>2],be=M(),Ee,Le=J+4,D=0;D<=N;++D){var ye=J+4+D*a;(D==N||be[ye>>z]==0)&&(Le=_(Le,ye-Le),Ee===void 0?Ee=Le:(Ee+="\0",Ee+=Le),Le=ye+a)}return $r(J),Ee},toWireType:function(J,N){typeof N!="string"&&tt(`Cannot pass non-string to C++ string type ${c}`);var be=A(N),Ee=Zs(4+be+a);return Pe[Ee>>2]=be>>z,I(N,Ee+4,be+a),J!==null&&J.push($r,Ee),Ee},argPackAdvance:8,readValueFromPointer:Ii,K:function(J){$r(J)}})},_embind_register_value_object:function(s,a,c,_,I,A){Ji[s]={name:Ut(a),Pa:Qt(c,_),W:Qt(I,A),fb:[]}},_embind_register_value_object_field:function(s,a,c,_,I,A,M,z,J,N){Ji[s].fb.push({Sb:Ut(a),Yb:c,Wb:Qt(_,I),Xb:A,rc:M,qc:Qt(z,J),sc:N})},_embind_register_void:function(s,a){a=Ut(a),Ir(s,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,a,c){s=pr(s),a=wi(a,"emval::as");var _=[],I=gr(_);return Pe[c>>2]=I,a.toWireType(_,s)},_emval_call_method:function(s,a,c,_,I){s=is[s],a=pr(a),c=ns(c);var A=[];return Pe[_>>2]=gr(A),s(a,c,A,I)},_emval_call_void_method:function(s,a,c,_){s=is[s],a=pr(a),c=ns(c),s(a,c,null,_)},_emval_decref:Ks,_emval_get_method_caller:function(s,a){var c=uc(s,a),_=c[0];a=_.name+"_$"+c.slice(1).map(function(M){return M.name}).join("_")+"$";var I=jo[a];if(I!==void 0)return I;var A=Array(s-1);return I=lc((M,z,J,N)=>{for(var be=0,Ee=0;Ee<s-1;++Ee)A[Ee]=c[Ee+1].readValueFromPointer(N+be),be+=c[Ee+1].argPackAdvance;for(M=M[z].apply(M,A),Ee=0;Ee<s-1;++Ee)c[Ee+1].Nb&&c[Ee+1].Nb(A[Ee]);if(!_.fc)return _.toWireType(J,M)}),jo[a]=I},_emval_get_module_property:function(s){return s=ns(s),gr(p[s])},_emval_get_property:function(s,a){return s=pr(s),a=pr(a),gr(s[a])},_emval_incref:function(s){4<s&&(ur.get(s).ub+=1)},_emval_new_array:function(){return gr([])},_emval_new_cstring:function(s){return gr(ns(s))},_emval_new_object:function(){return gr({})},_emval_run_destructors:function(s){var a=pr(s);ki(a),Ks(s)},_emval_set_property:function(s,a,c){s=pr(s),a=pr(a),c=pr(c),s[a]=c},_emval_take_value:function(s,a){return s=wi(s,"_emval_take_value"),s=s.readValueFromPointer(a),gr(s)},abort:()=>{Ve("")},emscripten_asm_const_int:(s,a,c)=>{Js.length=0;var _;for(c>>=2;_=de[a++];)c+=_!=105&c,Js.push(_==105?_e[c]:Z[c++>>1]),++c;return o[s].apply(null,Js)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,a,c)=>de.copyWithin(s,a,a+c),emscripten_resize_heap:s=>{var a=de.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var _=a*(1+.2/c);_=Math.min(_,s+100663296);var I=Math;_=Math.max(s,_);e:{I=I.min.call(I,2147483648,_+(65536-_%65536)%65536)-V.buffer.byteLength+65535>>>16;try{V.grow(I),re();var A=1;break e}catch{}A=void 0}if(A)return!0}return!1},environ_get:(s,a)=>{var c=0;return To().forEach(function(_,I){var A=a+c;for(I=Pe[s+4*I>>2]=A,A=0;A<_.length;++A)ae[I++>>0]=_.charCodeAt(A);ae[I>>0]=0,c+=_.length+1}),0},environ_sizes_get:(s,a)=>{var c=To();Pe[s>>2]=c.length;var _=0;return c.forEach(function(I){_+=I.length+1}),Pe[a>>2]=_,0},fd_close:function(s){try{var a=Gr(s);if(a.X===null)throw new De(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Ni[a.X]=null}return a.X=null,0}catch(c){if(typeof fn>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(s,a,c,_){try{e:{var I=Gr(s);s=a;for(var A,M=a=0;M<c;M++){var z=Pe[s>>2],J=Pe[s+4>>2];s+=8;var N=I,be=z,Ee=J,Le=A,D=ae;if(0>Ee||0>Le)throw new De(28);if(N.X===null)throw new De(8);if((N.flags&2097155)===1)throw new De(8);if((N.node.mode&61440)===16384)throw new De(31);if(!N.m.read)throw new De(28);var ye=typeof Le<"u";if(!ye)Le=N.position;else if(!N.seekable)throw new De(70);var pe=N.m.read(N,D,be,Ee,Le);ye||(N.position+=pe);var rt=pe;if(0>rt){var at=-1;break e}if(a+=rt,rt<J)break;typeof A<"u"&&(A+=rt)}at=a}return Pe[_>>2]=at,0}catch(Te){if(typeof fn>"u"||Te.name!=="ErrnoError")throw Te;return Te.aa}},fd_seek:function(s,a,c,_,I){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var A=Gr(s);return uo(A,a,_),y=[A.position>>>0,(At=A.position,1<=+Math.abs(At)?0<At?+Math.floor(At/4294967296)>>>0:~~+Math.ceil((At-+(~~At>>>0))/4294967296)>>>0:0)],_e[I>>2]=y[0],_e[I+4>>2]=y[1],A.Ma&&a===0&&_===0&&(A.Ma=null),0}catch(M){if(typeof fn>"u"||M.name!=="ErrnoError")throw M;return M.aa}},fd_write:function(s,a,c,_){try{e:{var I=Gr(s);s=a;for(var A,M=a=0;M<c;M++){var z=Pe[s>>2],J=Pe[s+4>>2];s+=8;var N=I,be=z,Ee=J,Le=A,D=ae;if(0>Ee||0>Le)throw new De(28);if(N.X===null)throw new De(8);if((N.flags&2097155)===0)throw new De(8);if((N.node.mode&61440)===16384)throw new De(31);if(!N.m.write)throw new De(28);N.seekable&&N.flags&1024&&uo(N,0,2);var ye=typeof Le<"u";if(!ye)Le=N.position;else if(!N.seekable)throw new De(70);var pe=N.m.write(N,D,be,Ee,Le,void 0);ye||(N.position+=pe);var rt=pe;if(0>rt){var at=-1;break e}a+=rt,typeof A<"u"&&(A+=rt)}at=a}return Pe[_>>2]=at,0}catch(Te){if(typeof fn>"u"||Te.name!=="ErrnoError")throw Te;return Te.aa}},strftime_l:(s,a,c,_)=>cc(s,a,c,_)};(function(){function s(c){if(R=c=c.exports,V=R.memory,re(),te=R.__indirect_function_table,ee.unshift(R.__wasm_call_ctors),Ie--,p.monitorRunDependencies&&p.monitorRunDependencies(Ie),Ie==0&&Ue){var _=Ue;Ue=null,_()}return c}var a={env:Mo,wasi_snapshot_preview1:Mo};if(Ie++,p.monitorRunDependencies&&p.monitorRunDependencies(Ie),p.instantiateWasm)try{return p.instantiateWasm(a,s)}catch(c){K("Module.instantiateWasm callback failed with error: "+c),x(c)}return Et(a,function(c){s(c.instance)}).catch(x),{}})();var $r=s=>($r=R.free)(s),Zs=s=>(Zs=R.malloc)(s),Lo=()=>(Lo=R.__errno_location)(),Do=p._ma_device__on_notification_unlocked=s=>(Do=p._ma_device__on_notification_unlocked=R.ma_device__on_notification_unlocked)(s);p._ma_malloc_emscripten=(s,a)=>(p._ma_malloc_emscripten=R.ma_malloc_emscripten)(s,a),p._ma_free_emscripten=(s,a)=>(p._ma_free_emscripten=R.ma_free_emscripten)(s,a);var Fo=p._ma_device_process_pcm_frames_capture__webaudio=(s,a,c)=>(Fo=p._ma_device_process_pcm_frames_capture__webaudio=R.ma_device_process_pcm_frames_capture__webaudio)(s,a,c),$o=p._ma_device_process_pcm_frames_playback__webaudio=(s,a,c)=>($o=p._ma_device_process_pcm_frames_playback__webaudio=R.ma_device_process_pcm_frames_playback__webaudio)(s,a,c),Uo=s=>(Uo=R.__getTypeName)(s);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=R._embind_initialize_bindings)(),p.dynCall_iiji=(s,a,c,_,I)=>(p.dynCall_iiji=R.dynCall_iiji)(s,a,c,_,I),p.dynCall_jiji=(s,a,c,_,I)=>(p.dynCall_jiji=R.dynCall_jiji)(s,a,c,_,I),p.dynCall_iiiji=(s,a,c,_,I,A)=>(p.dynCall_iiiji=R.dynCall_iiiji)(s,a,c,_,I,A),p.dynCall_iij=(s,a,c,_)=>(p.dynCall_iij=R.dynCall_iij)(s,a,c,_),p.dynCall_jii=(s,a,c)=>(p.dynCall_jii=R.dynCall_jii)(s,a,c),p.dynCall_viijii=(s,a,c,_,I,A,M)=>(p.dynCall_viijii=R.dynCall_viijii)(s,a,c,_,I,A,M),p.dynCall_iiiiij=(s,a,c,_,I,A,M)=>(p.dynCall_iiiiij=R.dynCall_iiiiij)(s,a,c,_,I,A,M),p.dynCall_iiiiijj=(s,a,c,_,I,A,M,z,J)=>(p.dynCall_iiiiijj=R.dynCall_iiiiijj)(s,a,c,_,I,A,M,z,J),p.dynCall_iiiiiijj=(s,a,c,_,I,A,M,z,J,N)=>(p.dynCall_iiiiiijj=R.dynCall_iiiiiijj)(s,a,c,_,I,A,M,z,J,N);var os;Ue=function s(){os||No(),os||(Ue=s)};function No(){function s(){if(!os&&(os=!0,p.calledRun=!0,!Q)){if(p.noFSInit||fo||(fo=!0,co(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?gi("stdin",p.stdin):Ns("/dev/tty","/dev/stdin"),p.stdout?gi("stdout",null,p.stdout):Ns("/dev/tty","/dev/stdout"),p.stderr?gi("stderr",null,p.stderr):Ns("/dev/tty1","/dev/stderr"),qi("/dev/stdin",0),qi("/dev/stdout",1),qi("/dev/stderr",1)),to=!1,d(ee),k(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var a=p.postRun.shift();ce.unshift(a)}d(ce)}}if(!(0<Ie)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)we();d(Ae),0<Ie||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),s()},1)):s())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return No(),S.ready})})();const m=g}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>g.Animation});var g=v(4)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>g});var g=(function(){function m(b,S,p,k){this.animation=b,this.artboard=S,this.playing=k,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(b,S)}return Object.defineProperty(m.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"time",{get:function(){return this.instance.time},set:function(b){this.instance.time=b},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),m.prototype.advance=function(b){this.scrubTo===null?this.instance.advance(b):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},m.prototype.apply=function(b){this.instance.apply(b)},m.prototype.cleanup=function(){this.instance.delete()},m})()}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>b.AudioAssetWrapper,AudioWrapper:()=>b.AudioWrapper,BLANK_URL:()=>m.BLANK_URL,CustomFileAssetLoaderWrapper:()=>b.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>b.FileAssetWrapper,Finalizable:()=>b.Finalizable,FontAssetWrapper:()=>b.FontAssetWrapper,FontWrapper:()=>b.FontWrapper,ImageAssetWrapper:()=>b.ImageAssetWrapper,ImageWrapper:()=>b.ImageWrapper,finalizationRegistry:()=>b.finalizationRegistry,registerTouchInteractions:()=>g.registerTouchInteractions,sanitizeUrl:()=>m.sanitizeUrl});var g=v(6),m=v(7),b=v(8)}),((u,h,v)=>{v.r(h),v.d(h,{registerTouchInteractions:()=>b});var g=void 0,m=function(S,p){var k,x;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((k=S.touches)===null||k===void 0)&&k.length)?(p||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((x=S.changedTouches)===null||x===void 0)&&x.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},b=function(S){var p=S.canvas,k=S.artboard,x=S.stateMachines,P=x===void 0?[]:x,F=S.renderer,H=S.rive,L=S.fit,U=S.alignment,$=S.isTouchScrollEnabled,C=$===void 0?!1:$,O=S.layoutScaleFactor,ie=O===void 0?1:O;if(!p||!P.length||!F||!H||!k||typeof window>"u")return null;var oe=null,ve=!1,fe=function(Y){if(ve&&Y instanceof MouseEvent){Y.type=="mouseup"&&(ve=!1);return}ve=C&&Y.type==="touchend"&&oe==="touchstart",oe=Y.type;var K=Y.currentTarget.getBoundingClientRect(),G=m(Y,C),V=G.clientX,R=G.clientY;if(!(!V&&!R)){var Q=V-K.left,ae=R-K.top,de=H.computeAlignment(L,U,{minX:0,minY:0,maxX:K.width,maxY:K.height},k.bounds,ie),ge=new H.Mat2D;de.invert(ge);var $e=new H.Vec2D(Q,ae),_e=H.mapXY(ge,$e),Pe=_e.x(),ue=_e.y();switch(_e.delete(),ge.delete(),$e.delete(),de.delete(),Y.type){case"mouseout":for(var Z=0,re=P;Z<re.length;Z++){var te=re[Z];te.pointerMove(Pe,ue)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Ae=0,ee=P;Ae<ee.length;Ae++){var te=ee[Ae];te.pointerMove(Pe,ue)}break}case"touchstart":case"mousedown":{for(var ce=0,we=P;ce<we.length;ce++){var te=we[ce];te.pointerDown(Pe,ue)}break}case"touchend":case"mouseup":{for(var Ie=0,Ue=P;Ie<Ue.length;Ie++){var te=Ue[Ie];te.pointerUp(Pe,ue)}break}}}},le=fe.bind(g);return p.addEventListener("mouseover",le),p.addEventListener("mouseout",le),p.addEventListener("mousemove",le),p.addEventListener("mousedown",le),p.addEventListener("mouseup",le),p.addEventListener("touchmove",le,{passive:C}),p.addEventListener("touchstart",le,{passive:C}),p.addEventListener("touchend",le),function(){p.removeEventListener("mouseover",le),p.removeEventListener("mouseout",le),p.removeEventListener("mousemove",le),p.removeEventListener("mousedown",le),p.removeEventListener("mouseup",le),p.removeEventListener("touchmove",le),p.removeEventListener("touchstart",le),p.removeEventListener("touchend",le)}}}),((u,h,v)=>{v.r(h),v.d(h,{BLANK_URL:()=>x,sanitizeUrl:()=>H});var g=/^([^\w]*)(javascript|data|vbscript)/im,m=/&#(\w+)(^\w|;)?/g,b=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,k=[".","/"],x="about:blank";function P(L){return k.indexOf(L[0])>-1}function F(L){var U=L.replace(S,"");return U.replace(m,function($,C){return String.fromCharCode(C)})}function H(L){if(!L)return x;var U=F(L).replace(b,"").replace(S,"").trim();if(!U)return x;if(P(U))return U;var $=U.match(p);if(!$)return U;var C=$[0];return g.test(C)?x:U}}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>F,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>k,FileAssetWrapper:()=>x,Finalizable:()=>m,FontAssetWrapper:()=>H,FontWrapper:()=>p,ImageAssetWrapper:()=>P,ImageWrapper:()=>b,finalizationRegistry:()=>$});var g=(function(){var C=function(O,ie){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(oe,ve){oe.__proto__=ve}||function(oe,ve){for(var fe in ve)Object.prototype.hasOwnProperty.call(ve,fe)&&(oe[fe]=ve[fe])},C(O,ie)};return function(O,ie){if(typeof ie!="function"&&ie!==null)throw new TypeError("Class extends value "+String(ie)+" is not a constructor or null");C(O,ie);function oe(){this.constructor=O}O.prototype=ie===null?Object.create(ie):(oe.prototype=ie.prototype,new oe)}})(),m=(function(){function C(){this.selfUnref=!1}return C})(),b=(function(C){g(O,C);function O(ie){var oe=C.call(this)||this;return oe._nativeImage=ie,oe}return Object.defineProperty(O.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),O.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},O})(m),S=(function(C){g(O,C);function O(ie){var oe=C.call(this)||this;return oe._nativeAudio=ie,oe}return Object.defineProperty(O.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),O.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},O})(m),p=(function(C){g(O,C);function O(ie){var oe=C.call(this)||this;return oe._nativeFont=ie,oe}return Object.defineProperty(O.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),O.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},O})(m),k=(function(){function C(O,ie){this._assetLoaderCallback=ie,this.assetLoader=new O.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return C.prototype.loadContents=function(O,ie){var oe;return O.isImage?oe=new P(O):O.isAudio?oe=new F(O):O.isFont&&(oe=new H(O)),this._assetLoaderCallback(oe,ie)},C})(),x=(function(){function C(O){this._nativeFileAsset=O}return C.prototype.decode=function(O){this._nativeFileAsset.decode(O)},Object.defineProperty(C.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),C})(),P=(function(C){g(O,C);function O(){return C!==null&&C.apply(this,arguments)||this}return O.prototype.setRenderImage=function(ie){this._nativeFileAsset.setRenderImage(ie.nativeImage)},O})(x),F=(function(C){g(O,C);function O(){return C!==null&&C.apply(this,arguments)||this}return O.prototype.setAudioSource=function(ie){this._nativeFileAsset.setAudioSource(ie.nativeAudio)},O})(x),H=(function(C){g(O,C);function O(){return C!==null&&C.apply(this,arguments)||this}return O.prototype.setFont=function(ie){this._nativeFileAsset.setFont(ie.nativeFont)},O})(x),L=(function(){function C(O){}return C.prototype.register=function(O){O.selfUnref=!0},C.prototype.unregister=function(O){},C})(),U=typeof FinalizationRegistry<"u"?FinalizationRegistry:L,$=new U(function(C){C.unref()})})],n={};function i(u){var h=n[u];if(h!==void 0)return h.exports;var v=n[u]={exports:{}};return t[u](v,v.exports,i),v.exports}i.d=(u,h)=>{for(var v in h)i.o(h,v)&&!i.o(u,v)&&Object.defineProperty(u,v,{enumerable:!0,get:h[v]})},i.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),i.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{i.r(l),i.d(l,{Alignment:()=>H,DataEnum:()=>ue,EventType:()=>fe,Fit:()=>F,Layout:()=>L,LoopType:()=>le,Rive:()=>_e,RiveEventType:()=>O,RiveFile:()=>$e,RuntimeLoader:()=>U,StateMachineInput:()=>C,StateMachineInputType:()=>$,Testing:()=>_t,ViewModel:()=>Pe,ViewModelInstance:()=>re,ViewModelInstanceArtboard:()=>Oe,ViewModelInstanceAssetImage:()=>We,ViewModelInstanceBoolean:()=>ce,ViewModelInstanceColor:()=>Ve,ViewModelInstanceEnum:()=>Ie,ViewModelInstanceList:()=>Ue,ViewModelInstanceNumber:()=>ee,ViewModelInstanceString:()=>Ae,ViewModelInstanceTrigger:()=>we,ViewModelInstanceValue:()=>te,decodeAudio:()=>lt,decodeFont:()=>At,decodeImage:()=>Et});var u=i(1),h=i(2),v=i(3),g=i(5),m=(function(){var y=function(o,d){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,T){w.__proto__=T}||function(w,T){for(var q in T)Object.prototype.hasOwnProperty.call(T,q)&&(w[q]=T[q])},y(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");y(o,d);function w(){this.constructor=o}o.prototype=d===null?Object.create(d):(w.prototype=d.prototype,new w)}})(),b=function(){return b=Object.assign||function(y){for(var o,d=1,w=arguments.length;d<w;d++){o=arguments[d];for(var T in o)Object.prototype.hasOwnProperty.call(o,T)&&(y[T]=o[T])}return y},b.apply(this,arguments)},S=function(y,o,d,w){function T(q){return q instanceof d?q:new d(function(se){se(q)})}return new(d||(d=Promise))(function(q,se){function Ce(Be){try{je(w.next(Be))}catch(Ke){se(Ke)}}function Fe(Be){try{je(w.throw(Be))}catch(Ke){se(Ke)}}function je(Be){Be.done?q(Be.value):T(Be.value).then(Ce,Fe)}je((w=w.apply(y,o||[])).next())})},p=function(y,o){var d={label:0,sent:function(){if(q[0]&1)throw q[1];return q[1]},trys:[],ops:[]},w,T,q,se=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return se.next=Ce(0),se.throw=Ce(1),se.return=Ce(2),typeof Symbol=="function"&&(se[Symbol.iterator]=function(){return this}),se;function Ce(je){return function(Be){return Fe([je,Be])}}function Fe(je){if(w)throw new TypeError("Generator is already executing.");for(;se&&(se=0,je[0]&&(d=0)),d;)try{if(w=1,T&&(q=je[0]&2?T.return:je[0]?T.throw||((q=T.return)&&q.call(T),0):T.next)&&!(q=q.call(T,je[1])).done)return q;switch(T=0,q&&(je=[je[0]&2,q.value]),je[0]){case 0:case 1:q=je;break;case 4:return d.label++,{value:je[1],done:!1};case 5:d.label++,T=je[1],je=[0];continue;case 7:je=d.ops.pop(),d.trys.pop();continue;default:if(q=d.trys,!(q=q.length>0&&q[q.length-1])&&(je[0]===6||je[0]===2)){d=0;continue}if(je[0]===3&&(!q||je[1]>q[0]&&je[1]<q[3])){d.label=je[1];break}if(je[0]===6&&d.label<q[1]){d.label=q[1],q=je;break}if(q&&d.label<q[2]){d.label=q[2],d.ops.push(je);break}q[2]&&d.ops.pop(),d.trys.pop();continue}je=o.call(y,d)}catch(Be){je=[6,Be],T=0}finally{w=q=0}if(je[0]&5)throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}},k=function(y,o,d){if(d||arguments.length===2)for(var w=0,T=o.length,q;w<T;w++)(q||!(w in o))&&(q||(q=Array.prototype.slice.call(o,0,w)),q[w]=o[w]);return y.concat(q||Array.prototype.slice.call(o))},x=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),P=function(y){return y&&y.isHandledError?y.message:"Problem loading file; may be corrupt!"},F;(function(y){y.Cover="cover",y.Contain="contain",y.Fill="fill",y.FitWidth="fitWidth",y.FitHeight="fitHeight",y.None="none",y.ScaleDown="scaleDown",y.Layout="layout"})(F||(F={}));var H;(function(y){y.Center="center",y.TopLeft="topLeft",y.TopCenter="topCenter",y.TopRight="topRight",y.CenterLeft="centerLeft",y.CenterRight="centerRight",y.BottomLeft="bottomLeft",y.BottomCenter="bottomCenter",y.BottomRight="bottomRight"})(H||(H={}));var L=(function(){function y(o){var d,w,T,q,se,Ce,Fe;this.fit=(d=o?.fit)!==null&&d!==void 0?d:F.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:H.Center,this.layoutScaleFactor=(T=o?.layoutScaleFactor)!==null&&T!==void 0?T:1,this.minX=(q=o?.minX)!==null&&q!==void 0?q:0,this.minY=(se=o?.minY)!==null&&se!==void 0?se:0,this.maxX=(Ce=o?.maxX)!==null&&Ce!==void 0?Ce:0,this.maxY=(Fe=o?.maxY)!==null&&Fe!==void 0?Fe:0}return y.new=function(o){var d=o.fit,w=o.alignment,T=o.minX,q=o.minY,se=o.maxX,Ce=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new y({fit:d,alignment:w,minX:T,minY:q,maxX:se,maxY:Ce})},y.prototype.copyWith=function(o){var d=o.fit,w=o.alignment,T=o.layoutScaleFactor,q=o.minX,se=o.minY,Ce=o.maxX,Fe=o.maxY;return new y({fit:d??this.fit,alignment:w??this.alignment,layoutScaleFactor:T??this.layoutScaleFactor,minX:q??this.minX,minY:se??this.minY,maxX:Ce??this.maxX,maxY:Fe??this.maxY})},y.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===F.Cover?d=o.Fit.cover:this.fit===F.Contain?d=o.Fit.contain:this.fit===F.Fill?d=o.Fit.fill:this.fit===F.FitWidth?d=o.Fit.fitWidth:this.fit===F.FitHeight?d=o.Fit.fitHeight:this.fit===F.ScaleDown?d=o.Fit.scaleDown:this.fit===F.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},y.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===H.TopLeft?d=o.Alignment.topLeft:this.alignment===H.TopCenter?d=o.Alignment.topCenter:this.alignment===H.TopRight?d=o.Alignment.topRight:this.alignment===H.CenterLeft?d=o.Alignment.centerLeft:this.alignment===H.CenterRight?d=o.Alignment.centerRight:this.alignment===H.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===H.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===H.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},y})(),U=(function(){function y(){}return y.loadRuntime=function(){u.default({locateFile:function(){return y.wasmURL}}).then(function(o){var d;for(y.runtime=o;y.callBackQueue.length>0;)(d=y.callBackQueue.shift())===null||d===void 0||d(y.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var w="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(y.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(y.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),y.setWasmUrl(w),y.loadRuntime();else{var T=["Could not load Rive WASM file from ".concat(y.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(T)}})},y.getInstance=function(o){y.isLoading||(y.isLoading=!0,y.loadRuntime()),y.runtime?o(y.runtime):y.callBackQueue.push(o)},y.awaitInstance=function(){return new Promise(function(o){return y.getInstance(function(d){return o(d)})})},y.setWasmUrl=function(o){y.wasmURL=o},y.getWasmUrl=function(){return y.wasmURL},y.isLoading=!1,y.callBackQueue=[],y.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),y})(),$;(function(y){y[y.Number=56]="Number",y[y.Trigger=58]="Trigger",y[y.Boolean=59]="Boolean"})($||($={}));var C=(function(){function y(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(y.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),y.prototype.fire=function(){this.type===$.Trigger&&this.runtimeInput.fire()},y.prototype.delete=function(){this.runtimeInput=null},y})(),O;(function(y){y[y.General=128]="General",y[y.OpenUrl=131]="OpenUrl"})(O||(O={}));var ie=(function(){function y(o){this.nativeArtboard=o}return y})(),oe=(function(){function y(o,d,w,T){this.stateMachine=o,this.playing=w,this.artboard=T,this.inputs=[],this.instance=new d.StateMachineInstance(o,T),this.initInputs(d)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),y.prototype.advance=function(o){this.instance.advance(o)},y.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},y.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},y.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},y.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var w=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(w,o))}},y.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new C($.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new C($.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new C($.Trigger,o.asTrigger())},y.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},y.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},y})(),ve=(function(){function y(o,d,w,T,q){T===void 0&&(T=[]),q===void 0&&(q=[]),this.runtime=o,this.artboard=d,this.eventManager=w,this.animations=T,this.stateMachines=q}return y.prototype.add=function(o,d,w){if(w===void 0&&(w=!0),o=Ge(o),o.length===0)this.animations.forEach(function(ft){return ft.playing=d}),this.stateMachines.forEach(function(ft){return ft.playing=d});else for(var T=this.animations.map(function(ft){return ft.name}),q=this.stateMachines.map(function(ft){return ft.name}),se=0;se<o.length;se++){var Ce=T.indexOf(o[se]),Fe=q.indexOf(o[se]);if(Ce>=0||Fe>=0)Ce>=0?this.animations[Ce].playing=d:this.stateMachines[Fe].playing=d;else{var je=this.artboard.animationByName(o[se]);if(je){var Be=new v.Animation(je,this.artboard,this.runtime,d);Be.advance(0),Be.apply(1),this.animations.push(Be)}else{var Ke=this.artboard.stateMachineByName(o[se]);if(Ke){var wt=new oe(Ke,this.runtime,d,this.artboard);this.stateMachines.push(wt)}}}}return w&&(d?this.eventManager.fire({type:fe.Play,data:this.playing}):this.eventManager.fire({type:fe.Pause,data:this.paused})),d?this.playing:this.paused},y.prototype.initLinearAnimations=function(o,d){for(var w=this.animations.map(function(Fe){return Fe.name}),T=0;T<o.length;T++){var q=w.indexOf(o[T]);if(q>=0)this.animations[q].playing=d;else{var se=this.artboard.animationByName(o[T]);if(se){var Ce=new v.Animation(se,this.artboard,this.runtime,d);Ce.advance(0),Ce.apply(1),this.animations.push(Ce)}else console.error("Animation with name ".concat(o[T]," not found."))}}},y.prototype.initStateMachines=function(o,d){for(var w=this.stateMachines.map(function(Fe){return Fe.name}),T=0;T<o.length;T++){var q=w.indexOf(o[T]);if(q>=0)this.stateMachines[q].playing=d;else{var se=this.artboard.stateMachineByName(o[T]);if(se){var Ce=new oe(se,this.runtime,d,this.artboard);this.stateMachines.push(Ce),d||Ce.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[T]," not found.")),this.initLinearAnimations([o[T]],d)}}},y.prototype.play=function(o){return this.add(o,!0)},y.prototype.pause=function(o){return this.add(o,!1)},y.prototype.scrub=function(o,d){var w=this.animations.filter(function(T){return o.includes(T.name)});return w.forEach(function(T){return T.scrubTo=d}),w.map(function(T){return T.name})},Object.defineProperty(y.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),y.prototype.stop=function(o){var d=this;o=Ge(o);var w=[];if(o.length===0)w=this.animations.map(function(se){return se.name}).concat(this.stateMachines.map(function(se){return se.name})),this.animations.forEach(function(se){return se.cleanup()}),this.stateMachines.forEach(function(se){return se.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var T=this.animations.filter(function(se){return o.includes(se.name)});T.forEach(function(se){se.cleanup(),d.animations.splice(d.animations.indexOf(se),1)});var q=this.stateMachines.filter(function(se){return o.includes(se.name)});q.forEach(function(se){se.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(se),1)}),w=T.map(function(se){return se.name}).concat(q.map(function(se){return se.name}))}return this.eventManager.fire({type:fe.Stop,data:w}),w},Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),y.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,d)),w},y.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(T){return T.playing});o<d.length;o++){var w=d[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:fe.Loop,data:{animation:w.name,type:le.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:fe.Loop,data:{animation:w.name,type:le.PingPong}}),w.loopCount=0)}},y.prototype.handleStateChanges=function(){for(var o=[],d=0,w=this.stateMachines.filter(function(q){return q.playing});d<w.length;d++){var T=w[d];o.push.apply(o,T.statesChanged)}o.length>0&&this.eventManager.fire({type:fe.StateChange,data:o})},y.prototype.handleAdvancing=function(o){this.eventManager.fire({type:fe.Advance,data:o})},y})(),fe;(function(y){y.Load="load",y.LoadError="loaderror",y.Play="play",y.Pause="pause",y.Stop="stop",y.Loop="loop",y.Draw="draw",y.Advance="advance",y.StateChange="statechange",y.RiveEvent="riveevent",y.AudioStatusChange="audiostatuschange"})(fe||(fe={}));var le;(function(y){y.OneShot="oneshot",y.Loop="loop",y.PingPong="pingpong"})(le||(le={}));var Y=(function(){function y(o){o===void 0&&(o=[]),this.listeners=o}return y.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},y.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},y.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var w=this.listeners[d];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(d,1);break}}},y.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return d.remove(w)}):this.listeners.splice(0,this.listeners.length)},y.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(w){return w.callback(o)})},y})(),K=(function(){function y(o){this.eventManager=o,this.queue=[]}return y.prototype.add=function(o){this.queue.push(o)},y.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},y})(),G;(function(y){y[y.AVAILABLE=0]="AVAILABLE",y[y.UNAVAILABLE=1]="UNAVAILABLE"})(G||(G={}));var V=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=G.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return p(this,function(w){return[2,new Promise(function(T){return setTimeout(T,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(w,T){return setTimeout(T,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:fe.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=G.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===G.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==G.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,w=function(){return S(d,void 0,void 0,function(){return p(this,function(T){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===G.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(Y),R=new V,Q=(function(){function y(){}return y.prototype.observe=function(){},y.prototype.unobserve=function(){},y.prototype.disconnect=function(){},y})(),ae=globalThis.ResizeObserver||Q,de=(function(){function y(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var w=o._elementsMap.get(d.target);w!==null?w.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new ae(this._onObserved)}return y.prototype.add=function(o,d){var w={onResize:d,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},y.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},y})(),ge=new de,$e=(function(){function y(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new Y,o.onLoad&&this.on(fe.Load,o.onLoad),o.onLoadError&&this.on(fe.LoadError,o.onLoadError)}return y.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,w,T,q;return p(this,function(se){switch(se.label){case 0:return this.src?(o=this,[4,Xe(this.src)]):[3,2];case 1:o.buffer=se.sent(),se.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new g.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=w.assetLoader),T=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return T.file=se.sent(),this.destroyed?((q=this.file)===null||q===void 0||q.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:fe.Load,data:this}):this.fireLoadError(y.fileLoadErrorMessage),[2])}})})},y.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return p(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(y.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,U.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return d=w.sent(),this.fireLoadError(d instanceof Error?d.message:y.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},y.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:fe.LoadError,data:o}),new Error(o)},y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},y.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},y.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new ie(d):null},y.missingErrorMessage="Rive source file or data buffer required",y.fileLoadErrorMessage="The file failed to load",y})(),_e=(function(){function y(o){var d=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(T){var q=d._hasZeroSize!==T;d._hasZeroSize=T,T?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():q&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=ge.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new L,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new Y,o.onLoad&&this.on(fe.Load,o.onLoad),o.onLoadError&&this.on(fe.LoadError,o.onLoadError),o.onPlay&&this.on(fe.Play,o.onPlay),o.onPause&&this.on(fe.Pause,o.onPause),o.onStop&&this.on(fe.Stop,o.onStop),o.onLoop&&this.on(fe.Loop,o.onLoop),o.onStateChange&&this.on(fe.StateChange,o.onStateChange),o.onAdvance&&this.on(fe.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(fe.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(fe.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(fe.Play,o.onplay),o.onpause&&!o.onPause&&this.on(fe.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(fe.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(fe.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(fe.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new K(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(y.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),y.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new y(o)},y.prototype.onSystemAudioChanged=function(){this.volume=this._volume},y.prototype.init=function(o){var d=this,w=o.src,T=o.buffer,q=o.riveFile,se=o.animations,Ce=o.stateMachines,Fe=o.artboard,je=o.autoplay,Be=je===void 0?!1:je,Ke=o.useOffscreenRenderer,wt=Ke===void 0?!1:Ke,ft=o.autoBind,Wt=ft===void 0?!1:ft;if(!this.destroyed){if(this.src=w,this.buffer=T,this.riveFile=q,!this.src&&!this.buffer&&!this.riveFile)throw new x(y.missingErrorMessage);var $t=Ge(se),Ct=Ge(Ce);this.loaded=!1,this.readyForPlaying=!1,U.awaitInstance().then(function(et){d.destroyed||(d.runtime=et,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,wt),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(Fe,$t,Ct,Be,Wt).then(function(qe){if(qe)return d.setupRiveListeners()}).catch(function(qe){console.error(qe)}))}).catch(function(et){console.error(et)})}},y.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(q){return q.playing&&d.runtime.hasListeners(q.instance)}).map(function(q){return q.instance}),T=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(T=o.isTouchScrollEnabled),this.eventCleanup=(0,g.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:T,layoutScaleFactor:this._layout.layoutScaleFactor})}},y.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},y.prototype.initializeAudio=function(){var o=this,d;R.status==G.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:fe.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},R.add(this._audioEventListener),R.establishAudio())},y.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},y.prototype.initData=function(o,d,w,T,q){return S(this,void 0,void 0,function(){var se,Ce,Fe,je;return p(this,function(Be){switch(Be.label){case 0:return Be.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(se=new $e({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=se,[4,se.init()]);case 1:if(Be.sent(),this.destroyed)return se.destroyIfUnused(),[2,!1];Be.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,w,T,q),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:fe.Load,data:(je=this.src)!==null&&je!==void 0?je:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Ce=Be.sent(),Fe=P(Ce),console.warn(Fe),this.eventManager.fire({type:fe.LoadError,data:Fe}),[2,Promise.reject(Fe)];case 4:return[2]}})})},y.prototype.initArtboard=function(o,d,w,T,q){if(this.file){var se=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!se){var Ce="Invalid artboard name or no default artboard";console.warn(Ce),this.eventManager.fire({type:fe.LoadError,data:Ce});return}if(this.artboard=se,se.volume=this._volume*R.systemVolume,this.artboard.animationCount()<1){var Ce="Artboard has no animations";throw this.eventManager.fire({type:fe.LoadError,data:Ce}),Ce}this.animator=new ve(this.runtime,this.artboard,this.eventManager);var Fe;if(d.length>0||w.length>0?(Fe=d.concat(w),this.animator.initLinearAnimations(d,T),this.animator.initStateMachines(w,T)):Fe=[this.animator.atLeastOne(T,!1)],this.taskQueue.add({event:{type:T?fe.Play:fe.Pause,data:Fe}}),q){var je=this.file.defaultArtboardViewModel(se);if(je!==null){var Be=je.defaultInstance();if(Be!==null){var Ke=new re(Be,null);this.bindViewModelInstance(Ke)}}}}},y.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},y.prototype.draw=function(o,d){var w;this.frameRequestId=null;var T=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var q=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var se=this.animator.animations.filter(function(Vt){return Vt.playing||Vt.needsScrub}).sort(function(Vt){return Vt.needsScrub?-1:1}),Ce=0,Fe=se;Ce<Fe.length;Ce++){var je=Fe[Ce];je.advance(q),je.instance.didLoop&&(je.loopCount+=1),je.apply(1)}for(var Be=this.animator.stateMachines.filter(function(Vt){return Vt.playing}),Ke=0,wt=Be;Ke<wt.length;Ke++){var ft=wt[Ke],Wt=ft.reportedEventCount();if(Wt)for(var $t=0;$t<Wt;$t++){var Ct=ft.reportedEventAt($t);if(Ct)if(Ct.type===O.OpenUrl){if(this.eventManager.fire({type:fe.RiveEvent,data:Ct}),this.automaticallyHandleEvents){var et=document.createElement("a"),qe=Ct,kt=qe.url,st=qe.target,ut=(0,g.sanitizeUrl)(kt);kt&&et.setAttribute("href",ut),st&&et.setAttribute("target",st),ut&&ut!==g.BLANK_URL&&et.click()}}else this.eventManager.fire({type:fe.RiveEvent,data:Ct})}ft.advanceAndApply(q)}this.animator.stateMachines.length==0&&this.artboard.advance(q);var Se=this.renderer;Se.clear(),Se.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Se),Se.restore(),Se.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(q),this.frameCount++;var He=performance.now();for(this.frameTimes.push(He),this.durations.push(He-T);this.frameTimes[0]<=He-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},y.prototype.alignRenderer=function(){var o=this,d=o.renderer,w=o.runtime,T=o._layout,q=o.artboard;d.align(T.runtimeFit(w),T.runtimeAlignment(w),{minX:T.minX,minY:T.minY,maxX:T.maxX,maxY:T.maxY},q.bounds,this._devicePixelRatioUsed*T.layoutScaleFactor)},Object.defineProperty(y.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),y.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ge.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(R.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},y.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},y.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},y.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},y.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},y.prototype.setTextRunValue=function(o,d){var w=this.retrieveTextRun(o);w&&(w.text=d)},y.prototype.play=function(o,d){var w=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},y.prototype.pause=function(o){var d=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},y.prototype.scrub=function(o,d){var w=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},y.prototype.stop=function(o){var d=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},y.prototype.reset=function(o){var d,w,T=o?.artboard,q=Ge(o?.animations),se=Ge(o?.stateMachines),Ce=(d=o?.autoplay)!==null&&d!==void 0?d:!1,Fe=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(T,q,se,Ce,Fe),this.taskQueue.process()},y.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(y.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),y.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},y.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),w=d.width,T=d.height,q=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=q,this.canvas.width=q*w,this.canvas.height=q*T,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===F.Layout){var se=this._layout.layoutScaleFactor;this.artboard.width=w/se,this.artboard.height=T/se}}},Object.defineProperty(y.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),y.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(w){return w.name===o});return d?.inputs}},y.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,d);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},y.prototype.setBooleanStateAtPath=function(o,d,w){var T=this.retrieveInputAtPath(o,w);T&&(T.type===$.Boolean?T.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},y.prototype.setNumberStateAtPath=function(o,d,w){var T=this.retrieveInputAtPath(o,w);T&&(T.type===$.Number?T.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},y.prototype.fireStateAtPath=function(o,d){var w=this.retrieveInputAtPath(o,d);w&&(w.type===$.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},y.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,d);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},y.prototype.getTextRunValueAtPath=function(o,d){var w=this.retrieveTextAtPath(o,d);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w.text},y.prototype.setTextRunValueAtPath=function(o,d,w){var T=this.retrieveTextAtPath(o,w);if(!T){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}T.text=d},Object.defineProperty(y.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},y.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},y.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},y.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},y.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(y.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var w=this.file.artboardByIndex(d),T={name:w.name,animations:[],stateMachines:[]},q=0;q<w.animationCount();q++){var se=w.animationByIndex(q);T.animations.push(se.name)}for(var Ce=0;Ce<w.stateMachineCount();Ce++){for(var Fe=w.stateMachineByIndex(Ce),je=Fe.name,Be=new this.runtime.StateMachineInstance(Fe,w),Ke=[],wt=0;wt<Be.inputCount();wt++){var ft=Be.input(wt);Ke.push({name:ft.name,type:ft.type})}T.stateMachines.push({name:je,inputs:Ke})}o.artboards.push(T)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*R.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),y.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(y.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),y.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(y.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),y.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Pe(d):null},y.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Pe(d):null},y.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new ue(d)})}return this._dataEnums},y.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Pe(o)}return null},y.prototype.getArtboard=function(o){var d,w;return(w=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&w!==void 0?w:null},y.missingErrorMessage="Rive source file or data buffer required",y.cleanupErrorMessage="Attempt to use file after calling cleanup.",y})(),Pe=(function(){function y(o){this._viewModel=o}return Object.defineProperty(y.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),y.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new re(d,null):null},y.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new re(d,null):null},y.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new re(o,null):null},y.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new re(o,null):null},Object.defineProperty(y.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),y})(),ue=(function(){function y(o){this._dataEnum=o}return Object.defineProperty(y.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),y})(),Z;(function(y){y.Number="number",y.String="string",y.Boolean="boolean",y.Color="color",y.Trigger="trigger",y.Enum="enum",y.List="list",y.Image="image",y.Artboard="artboard"})(Z||(Z={}));var re=(function(){function y(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(y.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),y.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},y.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},y.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var w=this._parents[d];w.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},y.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},y.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},y.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},y.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},y.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},y.prototype.propertyFromPath=function(o,d){var w=o.split("/");return this.propertyFromPathSegments(w,0,d)},y.prototype.viewModelFromPathSegments=function(o,d){var w=this.internalViewModelInstance(o[d]);return w!==null?d==o.length-1?w:w.viewModelFromPathSegments(o,d++):null},y.prototype.propertyFromPathSegments=function(o,d,w){var T,q,se,Ce,Fe,je,Be,Ke,wt,ft,Wt,$t,Ct,et,qe,kt,st,ut;if(d<o.length-1){var Se=this.internalViewModelInstance(o[d]);return Se!==null?Se.propertyFromPathSegments(o,d+1,w):null}var He=null;switch(w){case Z.Number:if(He=(q=(T=this._runtimeInstance)===null||T===void 0?void 0:T.number(o[d]))!==null&&q!==void 0?q:null,He!==null)return new ee(He,this);break;case Z.String:if(He=(Ce=(se=this._runtimeInstance)===null||se===void 0?void 0:se.string(o[d]))!==null&&Ce!==void 0?Ce:null,He!==null)return new Ae(He,this);break;case Z.Boolean:if(He=(je=(Fe=this._runtimeInstance)===null||Fe===void 0?void 0:Fe.boolean(o[d]))!==null&&je!==void 0?je:null,He!==null)return new ce(He,this);break;case Z.Color:if(He=(Ke=(Be=this._runtimeInstance)===null||Be===void 0?void 0:Be.color(o[d]))!==null&&Ke!==void 0?Ke:null,He!==null)return new Ve(He,this);break;case Z.Trigger:if(He=(ft=(wt=this._runtimeInstance)===null||wt===void 0?void 0:wt.trigger(o[d]))!==null&&ft!==void 0?ft:null,He!==null)return new we(He,this);break;case Z.Enum:if(He=($t=(Wt=this._runtimeInstance)===null||Wt===void 0?void 0:Wt.enum(o[d]))!==null&&$t!==void 0?$t:null,He!==null)return new Ie(He,this);break;case Z.List:if(He=(et=(Ct=this._runtimeInstance)===null||Ct===void 0?void 0:Ct.list(o[d]))!==null&&et!==void 0?et:null,He!==null)return new Ue(He,this);break;case Z.Image:if(He=(kt=(qe=this._runtimeInstance)===null||qe===void 0?void 0:qe.image(o[d]))!==null&&kt!==void 0?kt:null,He!==null)return new We(He,this);break;case Z.Artboard:if(He=(ut=(st=this._runtimeInstance)===null||st===void 0?void 0:st.artboard(o[d]))!==null&&ut!==void 0?ut:null,He!==null)return new Oe(He,this);break}return null},y.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(w!==null){var T=new y(w,this);return T.internalIncrementReferenceCount(),this._viewModelInstances.set(o,T),T}return null},y.prototype.number=function(o){var d=this.propertyFromPath(o,Z.Number);return d},y.prototype.string=function(o){var d=this.propertyFromPath(o,Z.String);return d},y.prototype.boolean=function(o){var d=this.propertyFromPath(o,Z.Boolean);return d},y.prototype.color=function(o){var d=this.propertyFromPath(o,Z.Color);return d},y.prototype.trigger=function(o){var d=this.propertyFromPath(o,Z.Trigger);return d},y.prototype.enum=function(o){var d=this.propertyFromPath(o,Z.Enum);return d},y.prototype.list=function(o){var d=this.propertyFromPath(o,Z.List);return d},y.prototype.image=function(o){var d=this.propertyFromPath(o,Z.Image);return d},y.prototype.artboard=function(o){var d=this.propertyFromPath(o,Z.Artboard);return d},y.prototype.viewModel=function(o){var d=o.split("/"),w=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return w!=null?w.internalViewModelInstance(d[d.length-1]):null},y.prototype.internalReplaceViewModel=function(o,d){var w;if(d.runtimeInstance!==null){var T=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,d.runtimeInstance))||!1;if(T){d.internalIncrementReferenceCount();var q=this.internalViewModelInstance(o);q!==null&&(q.removeParent(this),this._children.includes(q)&&(this._children=this._children.filter(function(se){return se!==q})),q.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return T}return!1},y.prototype.replaceViewModel=function(o,d){var w,T=o.split("/"),q=T.length>1?this.viewModelFromPathSegments(T.slice(0,T.length-1),0):this;return(w=q?.internalReplaceViewModel(T[T.length-1],d))!==null&&w!==void 0?w:!1},y.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},y.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(y.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return b({},d)}))||[]},enumerable:!1,configurable:!0}),y.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},y.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(T){T.cleanup()}),this._viewModelInstances.clear();var d=k([],this._children,!0);this._children.length=0;var w=k([],this._parents,!0);this._parents.length=0,d.forEach(function(T){T.removeParent(o)}),w.forEach(function(T){T.removeFromViewModelCallbacks(o)})}},y})(),te=(function(){function y(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return y.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},y.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},y.prototype.internalHandleCallback=function(o){},y.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},y.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},y.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),y})(),Ae=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(te),ee=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(te),ce=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(te),we=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(te),Ie=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(te),Ue=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,w){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,w)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var w=this._viewModelInstanceValue.instanceAt(d);if(w!=null){var T=new re(w,this._parentViewModel);return T}return null},o.prototype.swap=function(d,w){this._viewModelInstanceValue.swap(d,w)},o.prototype.internalHandleCallback=function(d){d()},o})(te),Ve=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,w,T){this._viewModelInstanceValue.rgb(d,w,T)},o.prototype.rgba=function(d,w,T,q){this._viewModelInstanceValue.argb(q,d,w,T)},o.prototype.argb=function(d,w,T,q){this._viewModelInstanceValue.argb(d,w,T,q)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(te),We=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(te),Oe=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(te),Xe=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(T){switch(T.label){case 0:return o=new Request(y),[4,fetch(o)];case 1:return d=T.sent(),[4,d.arrayBuffer()];case 2:return w=T.sent(),[2,w]}})})},Ge=function(y){return typeof y=="string"?[y]:y instanceof Array?y:[]},_t={EventManager:Y,TaskQueueManager:K},lt=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(se){se.decodeAudio(y,q)})}),[4,o];case 1:return d=T.sent(),w=new g.AudioWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})},Et=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(se){se.decodeImage(y,q)})}),[4,o];case 1:return d=T.sent(),w=new g.ImageWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})},At=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(se){se.decodeFont(y,q)})}),[4,o];case 1:return d=T.sent(),w=new g.FontWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})}})(),l})())})(_s)),_s.exports}var up=lp();const $u="dracula",Es="https://vycjpmuyscfygstjjied.supabase.co";var cp=X('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Ml(r,e){Rt(e,!0);let t=ze(e,"bucketName",3,$u),n=Me(null);kr(()=>{if(!f(n))return;const u=new up.Rive({src:`${Es}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:f(n),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var i=cp(),l=E(i);ka(l,u=>ne(n,u),()=>f(n)),W(r,i),Ot()}var dp=X('<div class="body-wrapper svelte-njwbfg"><!></div>');function on(r,e){var t=dp(),n=E(t);Ka(n,()=>e.children),W(r,t)}var fp=X('<button class="btn btn-secondary svelte-19gwkd1">🔄 Заново</button>'),hp=X('<button class="btn btn-danger svelte-19gwkd1">🏳️ Сдаться</button>'),vp=X('<div id="game-header" class="svelte-19gwkd1"><!> <!> <!></div>');function ln(r,e){let t=ze(e,"showGiveUp",3,!1),n=ze(e,"extraContent",3,null);var i=vp(),l=E(i);{var u=b=>{var S=fp();S.__click=function(...p){e.onRestart?.apply(this,p)},W(b,S)};Re(l,b=>{e.onRestart&&b(u)})}var h=j(l,2);{var v=b=>{var S=St(),p=Je(S);Ka(p,n),W(b,S)};Re(h,b=>{n()&&b(v)})}var g=j(h,2);{var m=b=>{var S=hp();S.__click=function(...p){e.onGiveUp?.apply(this,p)},W(b,S)};Re(g,b=>{t()&&e.onGiveUp&&b(m)})}W(r,i)}Ft(["click"]);var pp=X('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),gp=X('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function _p(r,e){Rt(e,!0);let t=ze(e,"rewardItem",3,null),n=ze(e,"items",19,()=>[]),i=ze(e,"bucketName",3,"dracula"),l=ze(e,"label",3,"Награда");function u(){if(!t()||!n()||n().length===0)return null;const p=typeof t()=="string"?t():t().id;return n().find(k=>k.id===p)||null}let h=Dt(u),v=Dt(()=>typeof t()=="object"&&t().name?t().name:null);function g(p){const k=p.target;k.style.display="none"}var m=St(),b=Je(m);{var S=p=>{var k=gp(),x=E(k);{var P=C=>{var O=pp(),ie=E(O);ke(()=>{Ne(ie,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${i()}/${f(h)?.icon||(typeof t()=="object"?t().icon:"")}`),Ne(ie,"alt",f(h)?.name||f(v)||"Награда")}),Sd("error",ie,g),W(C,O)};Re(x,C=>{(f(h)?.icon||typeof t()=="object"&&t().icon)&&C(P)})}var F=j(x,2),H=E(F),L=E(H),U=j(H,2),$=E(U);ke(()=>{me(L,`${l()??""}:`),me($,f(h)?.name||f(v)||"Неизвестный предмет")}),W(p,k)};Re(b,p=>{(f(h)||f(v))&&p(S)})}W(r,m),Ot()}var mp=X('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function un(r,e){let t=ze(e,"rewardItem",3,null),n=ze(e,"items",19,()=>[]),i=ze(e,"bucketName",3,"dracula");var l=mp(),u=E(l);_p(u,{get rewardItem(){return t()},get items(){return n()},get bucketName(){return i()}});var h=j(u,2);{var v=g=>{var m=St(),b=Je(m);Ka(b,()=>e.children),W(g,m)};Re(h,g=>{e.children&&g(v)})}W(r,l)}var yp=X("<button> </button>"),bp=X('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function cn(r,e){Rt(e,!0);let t=ze(e,"modal",7);var n=St(),i=Je(n);{var l=u=>{var h=bp();let v;var g=E(h),m=E(g),b=E(m),S=j(m,2),p=E(S),k=j(S,2);Ze(k,21,()=>t().actions,x=>x.text,(x,P)=>{var F=yp();let H;F.__click=function(...U){f(P).action?.apply(this,U)};var L=E(F);ke(U=>{H=Nt(F,1,"btn",null,H,U),me(L,f(P).text)},[()=>({"btn-secondary":f(P).class==="btn-secondary"})]),W(x,F)}),ke(x=>{v=Nt(h,1,"svelte-s62q14",null,v,x),me(b,t().title),me(p,t().text)},[()=>({active:t().show})]),W(u,h)};Re(i,u=>{t().show&&u(l)})}W(r,n),Ot()}Ft(["click"]);var wp=X('<div role="button" tabindex="0"> </div>'),kp=Ad('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),Ip=X('<span class="cooldown-timer svelte-d67gs4"> </span>'),Sp=X('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),Ep=X('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function Ap(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=8,h=6,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let m=Me(pt([])),b=Me(pt([])),S=Me(pt({})),p=Me(pt([])),k=Me(null),x=Me(!1),P=Me(!1),F=Me(""),H=Me(0),L=Me(0),U=Me(pt({show:!1,title:"",text:"",actions:[]})),$,C;kr(()=>{ve()});function O(){if(!f(b)||f(b).length===0)return 0;let ue=0;for(let Z=0;Z<u;Z++)for(let re=0;re<h;re++)f(b)[Z]&&!f(b)[Z][re]&&ue++;return ue}let ie=Dt(O),oe=Dt(()=>f(L)<1);function ve(){ne(m,[],!0),ne(b,[],!0),ne(k,null),ne(x,!1),ne(P,!1),ne(S,{},!0),ne(p,[],!0),ne(F,""),ne(L,0),_e();let ue=[...new Set(g)];for(;ue.length<u*h/2;)ue=[...ue,...ue];let Z=ue.sort(()=>.5-Math.random()).slice(0,u*h/2),re=[];Z.forEach(Ae=>re.push(Ae,Ae)),re.sort(()=>Math.random()-.5);let te=0;for(let Ae=0;Ae<u;Ae++){let ee=[],ce=[];for(let we=0;we<h;we++)ee.push(re[te++]),ce.push(!1);f(m).push(ee),f(b).push(ce)}setTimeout(G,500)}async function fe(ue,Z){if(f(x)||f(b)[ue][Z]||f(P))return;if(f(p).length>0&&ne(p,[],!0),!f(k)){ne(k,{r:ue,c:Z},!0);return}if(f(k).r===ue&&f(k).c===Z){ne(k,null);return}const re=f(m)[f(k).r][f(k).c],te=f(m)[ue][Z];if(re===te){const Ae=de(f(k).r,f(k).c,ue,Z);if(Ae){ne(x,!0),await ge(Ae),f(b)[f(k).r][f(k).c]=!0,f(b)[ue][Z]=!0,ne(k,null),ne(x,!1),Y(),G();return}}ne(k,{r:ue,c:Z},!0)}async function le(ue,Z,re){(re.key==="Enter"||re.key===" ")&&(re.preventDefault(),await fe(ue,Z))}function Y(){ne(L,v);const ue=setInterval(()=>{Zr(L,-1),f(L)<=0&&clearInterval(ue)},1e3)}function K(){if(f(x)||f(P)||!f(oe))return;let ue=[];for(let re=0;re<u;re++)for(let te=0;te<h;te++)f(b)[re][te]||ue.push({r:re,c:te,icon:f(m)[re][te]});let Z={};ue.forEach(re=>{Z[re.icon]||(Z[re.icon]=[]),Z[re.icon].push(re)});for(const re in Z){const te=Z[re];if(!(te.length<2))for(let Ae=0;Ae<te.length;Ae++)for(let ee=Ae+1;ee<te.length;ee++){const ce=te[Ae],we=te[ee];if(de(ce.r,ce.c,we.r,we.c)){ne(p,[ce,we],!0),setTimeout(()=>ne(p,[],!0),1500);return}}}}function G(){if(f(ie)===0){ne(P,!0),t()?($e("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{_e(),e.onWin?.()},3e3)):$e("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:ve}]);return}V()||(t()?setTimeout(()=>R(),1e3):$e("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{_e(),R()}},{text:"Сдаться",action:()=>{$e("Конец","Попытайте удачу снова!",[{text:"ОК",action:ve}])}}]))}function V(){let ue=[];for(let re=0;re<u;re++)for(let te=0;te<h;te++)f(b)[re][te]||ue.push({r:re,c:te,icon:f(m)[re][te]});let Z={};ue.forEach(re=>{Z[re.icon]||(Z[re.icon]=[]),Z[re.icon].push(re)});for(const re in Z){const te=Z[re];if(!(te.length<2)){for(let Ae=0;Ae<te.length;Ae++)for(let ee=Ae+1;ee<te.length;ee++)if(de(te[Ae].r,te[Ae].c,te[ee].r,te[ee].c))return!0}}return!1}function R(){let ue=[],Z=[];for(let re=0;re<u;re++)for(let te=0;te<h;te++)f(b)[re][te]||(ue.push(f(m)[re][te]),Z.push({r:re,c:te}));ue.length!==0&&(ue.sort(()=>Math.random()-.5),Z.forEach((re,te)=>{f(m)[re.r][re.c]=ue[te],f(S)[`${re.r},${re.c}`]=!0}),setTimeout(()=>{ne(S,{},!0),V()?ne(P,!1):R()},500))}function Q(ue,Z){return ue<0||ue>=u||Z<0||Z>=h?!0:f(b)[ue][Z]}function ae(ue,Z,re,te){if(ue!==re&&Z!==te)return!1;if(ue===re){const Ae=Math.min(Z,te),ee=Math.max(Z,te);for(let ce=Ae+1;ce<ee;ce++)if(!Q(ue,ce))return!1}else{const Ae=Math.min(ue,re),ee=Math.max(ue,re);for(let ce=Ae+1;ce<ee;ce++)if(!Q(ce,Z))return!1}return!0}function de(ue,Z,re,te){if(ae(ue,Z,re,te))return[{r:ue,c:Z},{r:re,c:te}];const Ae={r:ue,c:te};if(Q(Ae.r,Ae.c)&&ae(ue,Z,Ae.r,Ae.c)&&ae(Ae.r,Ae.c,re,te))return[{r:ue,c:Z},Ae,{r:re,c:te}];const ee={r:re,c:Z};if(Q(ee.r,ee.c)&&ae(ue,Z,ee.r,ee.c)&&ae(ee.r,ee.c,re,te))return[{r:ue,c:Z},ee,{r:re,c:te}];for(let ce=-1;ce<=u;ce++){if(ce===ue||ce===re)continue;const we={r:ce,c:Z},Ie={r:ce,c:te};if(Q(we.r,we.c)&&Q(Ie.r,Ie.c)&&ae(ue,Z,we.r,we.c)&&ae(we.r,we.c,Ie.r,Ie.c)&&ae(Ie.r,Ie.c,re,te))return[{r:ue,c:Z},we,Ie,{r:re,c:te}]}for(let ce=-1;ce<=h;ce++){if(ce===Z||ce===te)continue;const we={r:ue,c:ce},Ie={r:re,c:ce};if(Q(we.r,we.c)&&Q(Ie.r,Ie.c)&&ae(ue,Z,we.r,we.c)&&ae(we.r,we.c,Ie.r,Ie.c)&&ae(Ie.r,Ie.c,re,te))return[{r:ue,c:Z},we,Ie,{r:re,c:te}]}return null}async function ge(ue){if(await vu(),!$||!C)return;const Z=$.getBoundingClientRect(),re=C.getBoundingClientRect(),te=C.querySelector(".cell:not(.matched)");if(!te)return;const Ae=te.offsetWidth,ee=te.offsetHeight,ce=window.getComputedStyle(C),we=parseFloat(ce.gap)||4,Ie=re.left-Z.left,Ue=re.top-Z.top,Ve=ue.map(We=>{let Oe,Xe;if(We.r>=0&&We.r<u&&We.c>=0&&We.c<h){const _t=C.children[We.r*h+We.c].getBoundingClientRect();Oe=_t.left-Z.left+_t.width/2,Xe=_t.top-Z.top+_t.height/2}else{const Ge=We.c*(Ae+we)+Ae/2,_t=We.r*(ee+we)+ee/2;Oe=Ie+Ge,Xe=Ue+_t}return`${Oe.toFixed(1)},${Xe.toFixed(1)}`}).join(" ");return ne(F,Ve,!0),Zr(H),new Promise(We=>{setTimeout(()=>{ne(F,""),We()},350)})}function $e(ue,Z,re){ne(U,{show:!0,title:ue,text:Z,actions:re},!0)}function _e(){f(U).show=!1}function Pe(){t()?($e("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{_e(),e.onLose?.()},3e3)):$e("Конец","Попытайте удачу снова!",[{text:"ОК",action:ve}])}on(r,{children:(ue,Z)=>{var re=Ep(),te=Je(re);{let Ve=Dt(()=>t()?Pe:void 0);ln(te,{onRestart:ve,get onGiveUp(){return f(Ve)},get showGiveUp(){return t()}})}var Ae=j(te,2),ee=E(Ae);ir(ee,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),Ze(ee,21,()=>f(m),xt,(Ve,We,Oe)=>{var Xe=St(),Ge=Je(Xe);Ze(Ge,17,()=>f(We),xt,(_t,lt,Et)=>{var At=wp();let y;At.__click=()=>fe(Oe,Et),At.__keydown=d=>le(Oe,Et,d);var o=E(At);ke(d=>{y=Nt(At,1,"cell svelte-d67gs4",null,y,d),me(o,f(lt))},[()=>({selected:f(k)?.r===Oe&&f(k)?.c===Et,matched:f(b)[Oe][Et],shuffling:f(S)[`${Oe},${Et}`],"hint-glow":f(p).some(d=>d.r===Oe&&d.c===Et)})]),W(_t,At)}),W(Ve,Xe)}),ka(ee,Ve=>C=Ve,()=>C);var ce=j(ee,2),we=E(ce);wa(we,()=>f(H),Ve=>{var We=St(),Oe=Je(We);{var Xe=Ge=>{var _t=kp();ke(()=>Ne(_t,"points",f(F))),W(Ge,_t)};Re(Oe,Ge=>{f(F)&&Ge(Xe)})}W(Ve,We)}),ka(Ae,Ve=>$=Ve,()=>$);var Ie=j(Ae,2);un(Ie,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(Ve,We)=>{var Oe=Sp(),Xe=E(Oe),Ge=j(E(Xe)),_t=E(Ge),lt=j(Xe,2);let Et;lt.__click=K;var At=j(E(lt));{var y=o=>{var d=Ip(),w=E(d);ke(()=>me(w,`(${f(L)??""})`)),W(o,d)};Re(At,o=>{f(L)>0&&o(y)})}ke(o=>{me(_t,f(ie)),Et=Nt(lt,1,"btn btn-secondary svelte-d67gs4",null,Et,o),lt.disabled=!f(oe)},[()=>({disabled:!f(oe),"cooldown-active":f(L)>0})]),W(Ve,Oe)},$$slots:{default:!0}});var Ue=j(Ie,2);cn(Ue,{get modal(){return f(U)}}),W(ue,re)}}),Ot()}Ft(["click","keydown"]);function Cp(r,e,t,n,i,l,u,h,v,g){if(!(f(e)||f(t)||!f(n)))for(let m=0;m<i;m++)for(let b=0;b<l;b++){if(f(u)[m]?.[b]||f(h)[m]?.[b])continue;let S=f(v)[m][b];for(let p=0;p<i;p++)for(let k=0;k<l;k++)if(!(m===p&&b===k)&&!(f(u)[p]?.[k]||f(h)[p]?.[k])&&f(v)[p][k]===S){ne(g,[{r:m,c:b},{r:p,c:k}],!0),setTimeout(()=>ne(g,[],!0),1500);return}}}var jp=X('<button type="button"><div class="card-inner svelte-k8c0r2"><div class="card-front svelte-k8c0r2"> </div> <div class="card-back svelte-k8c0r2">?</div></div></button>'),Tp=X('<span class="cooldown-timer svelte-k8c0r2"> </span>'),xp=X('<div class="footer-stats svelte-k8c0r2"><span class="tiles-counter svelte-k8c0r2">Осталось: <strong class="svelte-k8c0r2"> </strong></span> <button>💡 <!></button></div>'),Pp=X('<!> <div id="game-container" class="svelte-k8c0r2"><div id="grid" class="svelte-k8c0r2"></div></div> <!> <!>',1);function Rp(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4,h=4,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let m=Me(pt([])),b=Me(pt([])),S=Me(pt([])),p=Me(pt([])),k=Me(null),x=Me(!1),P=Me(!1),F=Me(0),H=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>{C()});function L(){let Y=0;for(let K=0;K<u;K++)for(let G=0;G<h;G++)f(b)[K]?.[G]||Y++;return Y}let U=Dt(L),$=Dt(()=>f(F)<1);function C(){ne(m,[],!0),ne(b,[],!0),ne(S,[],!0),ne(k,null),ne(x,!1),ne(P,!1),ne(p,[],!0),ne(F,0),le();let Y=[...new Set(g)];for(;Y.length<u*h/2;)Y=[...Y,...Y];let K=Y.sort(()=>.5-Math.random()).slice(0,u*h/2),G=[];K.forEach(R=>G.push(R,R)),G.sort(()=>Math.random()-.5);let V=0;for(let R=0;R<u;R++){let Q=[],ae=[],de=[];for(let ge=0;ge<h;ge++)Q.push(G[V++]),ae.push(!1),de.push(!1);f(m).push(Q),f(b).push(ae),f(S).push(de)}}async function O(Y,K){if(!(f(x)||f(b)[Y]?.[K]||f(P))){if(f(k)&&f(k).r===Y&&f(k).c===K){f(S)[Y][K]=!1,ne(k,null);return}if(!f(S)[Y]?.[K])if(f(p).length>0&&ne(p,[],!0),f(S)[Y][K]=!0,!f(k))ne(k,{r:Y,c:K},!0);else{ne(x,!0);const G={r:Y,c:K},V=f(m)[f(k).r][f(k).c],R=f(m)[G.r][G.c];V===R?setTimeout(()=>{f(b)[f(k).r][f(k).c]=!0,f(b)[G.r][G.c]=!0,f(S)[f(k).r][f(k).c]=!1,f(S)[G.r][G.c]=!1,ne(k,null),ne(x,!1),ie(),oe()},600):setTimeout(()=>{f(S)[f(k).r][f(k).c]=!1,f(S)[G.r][G.c]=!1,ne(k,null),ne(x,!1)},1e3)}}}function ie(){ne(F,v);const Y=setInterval(()=>{Zr(F,-1),f(F)<=0&&clearInterval(Y)},1e3)}function oe(){f(U)===0&&(ne(P,!0),t()?(fe("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{le(),e.onWin?.()},3e3)):fe("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:C}]))}function ve(){t()?(fe("💀 Сдаюсь","Вы сдаюсь...",[]),setTimeout(()=>{le(),e.onLose?.()},3e3)):fe("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:C}])}function fe(Y,K,G){ne(H,{show:!0,title:Y,text:K,actions:G},!0)}function le(){f(H).show=!1}on(r,{children:(Y,K)=>{var G=Pp(),V=Je(G);{let ge=Dt(()=>t()?ve:void 0);ln(V,{onRestart:C,get onGiveUp(){return f(ge)},get showGiveUp(){return t()}})}var R=j(V,2),Q=E(R);ir(Q,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),Ze(Q,21,()=>f(m),xt,(ge,$e,_e)=>{var Pe=St(),ue=Je(Pe);Ze(ue,17,()=>f($e),xt,(Z,re,te)=>{var Ae=jp();let ee;Ae.__click=()=>O(_e,te),Ne(Ae,"aria-label",`Ячейка ${_e}, ${te}`);var ce=E(Ae),we=E(ce),Ie=E(we);ke(Ue=>{ee=Nt(Ae,1,"cell svelte-k8c0r2",null,ee,Ue),me(Ie,f(re))},[()=>({flipped:f(S)[_e]?.[te],matched:f(b)[_e]?.[te],selected:f(k)?.r===_e&&f(k)?.c===te,"hint-glow":f(p).some(Ue=>Ue.r===_e&&Ue.c===te)})]),W(Z,Ae)}),W(ge,Pe)});var ae=j(R,2);un(ae,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(ge,$e)=>{var _e=xp(),Pe=E(_e),ue=j(E(Pe)),Z=E(ue),re=j(Pe,2);let te;re.__click=[Cp,x,P,$,u,h,b,S,m,p];var Ae=j(E(re));{var ee=ce=>{var we=Tp(),Ie=E(we);ke(()=>me(Ie,`(${f(F)??""})`)),W(ce,we)};Re(Ae,ce=>{f(F)>0&&ce(ee)})}ke(ce=>{me(Z,f(U)),te=Nt(re,1,"btn btn-secondary svelte-k8c0r2",null,te,ce),re.disabled=!f($)},[()=>({disabled:!f($),"cooldown-active":f(F)>0})]),W(ge,_e)},$$slots:{default:!0}});var de=j(ae,2);cn(de,{get modal(){return f(H)}}),W(Y,G)}}),Ot()}Ft(["click"]);var Op=X('<div class="flame svelte-1v5x2m5"></div>'),Mp=X('<button type="button"><div class="candle svelte-1v5x2m5"><!></div></button>'),Lp=X('<div class="footer-stats svelte-1v5x2m5"><span class="moves-counter svelte-1v5x2m5">Ходов: <strong class="svelte-1v5x2m5"> </strong></span></div>'),Dp=X('<!> <div id="game-container" class="svelte-1v5x2m5"><div id="grid" class="svelte-1v5x2m5"></div></div> <!> <!>',1);function Fp(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=5,h=5,v=15;let g=Me(pt([])),m=Me(0),b=Me(!1),S=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>k());let p=Dt(()=>f(g).flat().every($=>!$));function k(){ne(g,Array(u).fill(null).map(()=>Array(h).fill(!1)),!0),ne(m,0),ne(b,!1),U();for(let $=0;$<v;$++){const C=Math.floor(Math.random()*u),O=Math.floor(Math.random()*h);x(C,O,!0)}}function x($,C,O=!1){f(g)[$][C]=!f(g)[$][C],$>0&&(f(g)[$-1][C]=!f(g)[$-1][C]),$<u-1&&(f(g)[$+1][C]=!f(g)[$+1][C]),C>0&&(f(g)[$][C-1]=!f(g)[$][C-1]),C<h-1&&(f(g)[$][C+1]=!f(g)[$][C+1]),O||(Zr(m),F())}function P($,C){f(b)||x($,C)}function F(){f(p)&&(ne(b,!0),t()?(L("🕯️ Тьма наступила",`Вы погасили все свечи за ${f(m)} ходов!`,[]),setTimeout(()=>{U(),e.onWin?.()},3e3)):L("🕯️ Тьма наступила",`Вы погасили все свечи за ${f(m)} ходов!`,[{text:"Играть снова",action:k}]))}function H(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function L($,C,O){ne(S,{show:!0,title:$,text:C,actions:O},!0)}function U(){f(S).show=!1}on(r,{children:($,C)=>{var O=Dp(),ie=Je(O);{let Y=Dt(()=>t()?H:void 0);ln(ie,{onRestart:k,get onGiveUp(){return f(Y)},get showGiveUp(){return t()}})}var oe=j(ie,2),ve=E(oe);ir(ve,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),Ze(ve,21,()=>f(g),xt,(Y,K,G)=>{var V=St(),R=Je(V);Ze(R,17,()=>f(K),xt,(Q,ae,de)=>{var ge=Mp();let $e;ge.__click=()=>P(G,de),Ne(ge,"aria-label",`Свеча ${G}, ${de}`);var _e=E(ge),Pe=E(_e);{var ue=Z=>{var re=Op();W(Z,re)};Re(Pe,Z=>{f(ae)&&Z(ue)})}ke(Z=>$e=Nt(ge,1,"cell svelte-1v5x2m5",null,$e,Z),[()=>({lit:f(ae)})]),W(Q,ge)}),W(Y,V)});var fe=j(oe,2);un(fe,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(Y,K)=>{var G=Lp(),V=E(G),R=j(E(V)),Q=E(R);ke(()=>me(Q,f(m))),W(Y,G)},$$slots:{default:!0}});var le=j(fe,2);cn(le,{get modal(){return f(S)}}),W($,O)}}),Ot()}Ft(["click"]);var $p=X('<div class="cell svelte-53kujm"> </div>'),Up=X('<button class="color-btn svelte-53kujm"> </button>'),Np=X('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),Bp=X('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function Wp(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=12,h=25,v=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let g=Me(pt([])),m=Me(0),b=Me(!1),S=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>k());let p=Dt(()=>()=>{const $=f(g)[0][0];return f(g).every(C=>C.every(O=>O===$))});function k(){ne(g,[],!0),ne(m,0),ne(b,!1),U();for(let $=0;$<u;$++){let C=[];for(let O=0;O<u;O++)C.push(Math.floor(Math.random()*v.length));f(g).push(C)}}function x($,C,O,ie){$<0||$>=u||C<0||C>=u||f(g)[$][C]===O&&(f(g)[$][C]=ie,x($-1,C,O,ie),x($+1,C,O,ie),x($,C-1,O,ie),x($,C+1,O,ie))}function P($){if(f(b)||f(m)>=h)return;const C=f(g)[0][0];$!==C&&(x(0,0,C,$),Zr(m),F())}function F(){f(p)()?(ne(b,!0),t()?(L("🎉 Победа!",`Вы захватили мир за ${f(m)} ходов!`,[]),setTimeout(()=>{U(),e.onWin?.()},3e3)):L("🎉 Победа!",`Вы захватили мир за ${f(m)} ходов!`,[{text:"Играть снова",action:k}])):f(m)>=h&&(ne(b,!0),t()?(L("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):L("💀 Поражение","Ходы закончились!",[{text:"Заново",action:k}]))}function H(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function L($,C,O){ne(S,{show:!0,title:$,text:C,actions:O},!0)}function U(){f(S).show=!1}on(r,{children:($,C)=>{var O=Bp(),ie=Je(O);{let K=Dt(()=>t()?H:void 0);ln(ie,{onRestart:k,get onGiveUp(){return f(K)},get showGiveUp(){return t()}})}var oe=j(ie,2),ve=E(oe);ir(ve,"grid-template-columns: repeat(12, 1fr);"),Ze(ve,21,()=>f(g),xt,(K,G)=>{var V=St(),R=Je(V);Ze(R,17,()=>f(G),xt,(Q,ae)=>{var de=$p(),ge=E(de);ke(()=>{ir(de,`background-color: ${v[f(ae)].value??""};`),me(ge,v[f(ae)].icon)}),W(Q,de)}),W(K,V)});var fe=j(oe,2);Ze(fe,21,()=>v,xt,(K,G,V)=>{var R=Up();R.__click=()=>P(V);var Q=E(R);ke(()=>{ir(R,`background-color: ${f(G).value??""};`),R.disabled=f(b)||f(m)>=h,me(Q,f(G).icon)}),W(K,R)});var le=j(fe,2);un(le,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(K,G)=>{var V=Np(),R=E(V),Q=j(E(R)),ae=E(Q),de=j(Q);de.nodeValue=" / 25",ke(()=>me(ae,f(m))),W(K,V)},$$slots:{default:!0}});var Y=j(le,2);cn(Y,{get modal(){return f(S)}}),W($,O)}}),Ot()}Ft(["click"]);var Vp=X('<button type="button"> </button>'),qp=X('<div class="footer-stats svelte-fn2aic"><span class="moves-counter svelte-fn2aic">Ходов: <strong class="svelte-fn2aic"> </strong></span></div>'),Gp=X('<!> <div id="game-container" class="svelte-fn2aic"><div id="grid" class="svelte-fn2aic"></div></div> <!> <!>',1);function Hp(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4;let h=Me(pt([])),v=Me(0),g=Me(!1),m=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>S());let b=Dt(()=>()=>{let U=1;for(let $=0;$<u;$++)for(let C=0;C<u;C++)if($===u-1&&C===u-1){if(f(h)[$][C]!==null)return!1}else{if(f(h)[$][C]!==U)return!1;U++}return!0});function S(){ne(h,[],!0),ne(v,0),ne(g,!1),L();let U=[];for(let C=1;C<u*u;C++)U.push(C);U.push(null);do U=U.sort(()=>Math.random()-.5);while(!p(U));let $=0;for(let C=0;C<u;C++){let O=[];for(let ie=0;ie<u;ie++)O.push(U[$++]);f(h).push(O)}}function p(U){let $=0;for(let O=0;O<U.length;O++)for(let ie=O+1;ie<U.length;ie++)U[O]&&U[ie]&&U[O]>U[ie]&&$++;let C=0;for(let O=0;O<U.length;O++)if(U[O]===null){C=Math.floor(O/u);break}return $%2===(u-C)%2}function k(){for(let U=0;U<u;U++)for(let $=0;$<u;$++)if(f(h)[U][$]===null)return{r:U,c:$};return null}function x(U,$){if(f(g))return;const C=k();if(!C)return;const O=Math.abs(U-C.r),ie=Math.abs($-C.c);(O===1&&ie===0||O===0&&ie===1)&&(f(h)[C.r][C.c]=f(h)[U][$],f(h)[U][$]=null,Zr(v),P())}function P(){f(b)()&&(ne(g,!0),t()?(H("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${f(v)} ходов!`,[]),setTimeout(()=>{L(),e.onWin?.()},3e3)):H("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${f(v)} ходов!`,[{text:"Играть снова",action:S}]))}function F(){t()?(H("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},3e3)):H("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:S}])}function H(U,$,C){ne(m,{show:!0,title:U,text:$,actions:C},!0)}function L(){f(m).show=!1}on(r,{children:(U,$)=>{var C=Gp(),O=Je(C);{let le=Dt(()=>t()?F:void 0);ln(O,{onRestart:S,get onGiveUp(){return f(le)},get showGiveUp(){return t()}})}var ie=j(O,2),oe=E(ie);ir(oe,"grid-template-columns: repeat(4, 1fr);"),Ze(oe,21,()=>f(h),xt,(le,Y,K)=>{var G=St(),V=Je(G);Ze(V,17,()=>f(Y),xt,(R,Q,ae)=>{var de=Vp();let ge;de.__click=()=>x(K,ae);var $e=E(de);ke(_e=>{ge=Nt(de,1,"cell svelte-fn2aic",null,ge,_e),de.disabled=f(Q)===null,Ne(de,"aria-label",f(Q)===null?"Пустая ячейка":`Ячейка ${f(Q)}`),me($e,f(Q))},[()=>({empty:f(Q)===null})]),W(R,de)}),W(le,G)});var ve=j(ie,2);un(ve,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(le,Y)=>{var K=qp(),G=E(K),V=j(E(G)),R=E(V);ke(()=>me(R,f(v))),W(le,K)},$$slots:{default:!0}});var fe=j(ve,2);cn(fe,{get modal(){return f(m)}}),W(U,C)}}),Ot()}Ft(["click"]);function zp(r,e,t){ne(e,r.touches[0].clientX,!0),ne(t,r.touches[0].clientY,!0)}var Kp=X("<div> </div>"),Yp=X('<div class="footer-stats svelte-1o3nb6j"><span class="score-counter svelte-1o3nb6j">Очки: <strong class="svelte-1o3nb6j"> </strong></span></div>'),Jp=X('<!> <div id="game-container" class="svelte-1o3nb6j"><div id="grid" class="svelte-1o3nb6j"></div></div> <!> <!>',1);function Xp(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4,h=2048,v={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},g={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=Me(pt([])),b=Me(0),S=Me(!1),p=Me(!1),k=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>(x(),window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)));function x(){ne(m,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),ne(b,0),ne(S,!1),ne(p,!1),G(),P(),P()}function P(){let V=[];for(let R=0;R<u;R++)for(let Q=0;Q<u;Q++)f(m)[R][Q]===0&&V.push({r:R,c:Q});if(V.length>0){const{r:R,c:Q}=V[Math.floor(Math.random()*V.length)];f(m)[R][Q]=Math.random()<.9?2:4}}function F(V){if(f(S))return;let R=!1;switch(V.key){case"ArrowUp":R=$();break;case"ArrowDown":R=C();break;case"ArrowLeft":R=L();break;case"ArrowRight":R=U();break}R&&(V.preventDefault(),P(),ve())}function H(V){let R=V.filter(ae=>ae!==0),Q=!1;for(let ae=0;ae<R.length-1;ae++)R[ae]===R[ae+1]&&(R[ae]*=2,ne(b,f(b)+R[ae]),R.splice(ae+1,1),Q=!0);for(;R.length<u;)R.push(0);return{newRow:R,moved:Q||V.join(",")!==R.join(",")}}function L(){let V=!1;for(let R=0;R<u;R++){const{newRow:Q,moved:ae}=H(f(m)[R]);f(m)[R]=Q,ae&&(V=!0)}return V}function U(){let V=!1;for(let R=0;R<u;R++){const{newRow:Q,moved:ae}=H([...f(m)[R]].reverse());f(m)[R]=Q.reverse(),ae&&(V=!0)}return V}function $(){let V=!1;for(let R=0;R<u;R++){let Q=[];for(let ge=0;ge<u;ge++)Q.push(f(m)[ge][R]);const{newRow:ae,moved:de}=H(Q);for(let ge=0;ge<u;ge++)f(m)[ge][R]=ae[ge];de&&(V=!0)}return V}function C(){let V=!1;for(let R=0;R<u;R++){let Q=[];for(let ge=0;ge<u;ge++)Q.push(f(m)[ge][R]);const{newRow:ae,moved:de}=H(Q.reverse());Q=ae.reverse();for(let ge=0;ge<u;ge++)f(m)[ge][R]=Q[ge];de&&(V=!0)}return V}let O=Me(0),ie=Me(0);function oe(V){if(f(S))return;const R=V.changedTouches[0].clientX,Q=V.changedTouches[0].clientY,ae=R-f(O),de=Q-f(ie);if(Math.abs(ae)<30&&Math.abs(de)<30)return;let ge=!1;Math.abs(ae)>Math.abs(de)?ge=ae>0?U():L():ge=de>0?C():$(),ge&&(V.preventDefault(),P(),ve())}function ve(){if(!f(p)){for(let V=0;V<u;V++)for(let R=0;R<u;R++)if(f(m)[V][R]>=h){ne(p,!0),t()?(K("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{G(),e.onWin?.()},3e3)):K("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:G},{text:"Новая игра",action:x,class:"btn-secondary"}]);return}}fe()&&!le()&&(ne(S,!0),t()?(K("💀 Конец",`Игра окончена. Очки: ${f(b)}`,[]),setTimeout(()=>{G(),e.onLose?.()},3e3)):K("💀 Конец",`Игра окончена. Очки: ${f(b)}`,[{text:"Новая игра",action:x}]))}function fe(){for(let V=0;V<u;V++)for(let R=0;R<u;R++)if(f(m)[V][R]===0)return!1;return!0}function le(){for(let V=0;V<u;V++)for(let R=0;R<u;R++)if(R<u-1&&f(m)[V][R]===f(m)[V][R+1]||V<u-1&&f(m)[V][R]===f(m)[V+1][R])return!0;return!1}function Y(){t()?(K("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{G(),e.onLose?.()},3e3)):K("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:x}])}function K(V,R,Q){ne(k,{show:!0,title:V,text:R,actions:Q},!0)}function G(){f(k).show=!1}on(r,{children:(V,R)=>{var Q=Jp(),ae=Je(Q);{let Pe=Dt(()=>t()?Y:void 0);ln(ae,{onRestart:x,get onGiveUp(){return f(Pe)},get showGiveUp(){return t()}})}var de=j(ae,2);de.__touchstart=[zp,O,ie],de.__touchend=oe;var ge=E(de);Ze(ge,21,()=>f(m),xt,(Pe,ue)=>{var Z=St(),re=Je(Z);Ze(re,17,()=>f(ue),xt,(te,Ae)=>{var ee=Kp();Nt(ee,1,"cell svelte-1o3nb6j",null,{},{"cell-{cell}":Ae-{}});var ce=E(ee);ke(()=>{ir(ee,`background-color: ${g[f(Ae)]||"#2a2a40"};`),me(ce,f(Ae)>0?v[f(Ae)]||f(Ae):"")}),W(te,ee)}),W(Pe,Z)});var $e=j(de,2);un($e,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(Pe,ue)=>{var Z=Yp(),re=E(Z),te=j(E(re)),Ae=E(te);ke(()=>me(Ae,f(b))),W(Pe,Z)},$$slots:{default:!0}});var _e=j($e,2);cn(_e,{get modal(){return f(k)}}),W(V,Q)}}),Ot()}Ft(["touchstart","touchend"]);var Qp=X('<button type="button"><span class="cell-content svelte-1p9db1h"> </span></button>'),Zp=X('<div class="footer-stats svelte-1p9db1h"><span class="mines-counter svelte-1p9db1h"></span> <span class="flag-counter svelte-1p9db1h"> </span></div>'),eg=X('<!> <div id="game-container" class="svelte-1p9db1h"><div id="grid" class="svelte-1p9db1h"></div></div> <!> <!>',1);function tg(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=8,h=8,v=10;let g=Me(pt([])),m=Me(!1),b=Me(!1),S=Me(!0),p=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>F());let k=Dt(()=>f(g).filter(K=>K.revealed).length),x=u*h,P=Dt(()=>f(b)||f(k)===x-v);function F(){ne(g,Array(x).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),ne(m,!1),ne(b,!1),ne(S,!0),fe()}function H(K){let G=0;for(;G<v;){const V=Math.floor(Math.random()*x);V!==K&&!f(g)[V].isMine&&(f(g)[V].isMine=!0,G++)}for(let V=0;V<x;V++)f(g)[V].isMine||(f(g)[V].adjacentMines=L(V))}function L(K){const G=Math.floor(K/h),V=K%h;let R=0;for(let Q=-1;Q<=1;Q++)for(let ae=-1;ae<=1;ae++){if(Q===0&&ae===0)continue;const de=G+Q,ge=V+ae;if(de>=0&&de<u&&ge>=0&&ge<h){const $e=de*h+ge;f(g)[$e].isMine&&R++}}return R}function U(K){if(!(f(m)||f(g)[K].revealed||f(g)[K].flagged)){if(f(S)&&(H(K),ne(S,!1)),f(g)[K].isMine){O(),ne(m,!0),ne(b,!1),t()?(ve("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{fe(),e.onLose?.()},3e3)):ve("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:F}]);return}C(K),ie()}}function $(K,G){G.preventDefault(),!(f(m)||f(g)[K].revealed)&&(f(g)[K].flagged=!f(g)[K].flagged)}function C(K){if(!(K<0||K>=x)&&!(f(g)[K].revealed||f(g)[K].flagged)&&(f(g)[K].revealed=!0,f(g)[K].adjacentMines===0&&!f(g)[K].isMine)){const G=Math.floor(K/h),V=K%h;for(let R=-1;R<=1;R++)for(let Q=-1;Q<=1;Q++){if(R===0&&Q===0)continue;const ae=G+R,de=V+Q;ae>=0&&ae<u&&de>=0&&de<h&&C(ae*h+de)}}}function O(){for(let K=0;K<x;K++)f(g)[K].isMine&&(f(g)[K].revealed=!0)}function ie(){f(P)&&(ne(b,!0),ne(m,!0),t()?(ve("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{fe(),e.onWin?.()},3e3)):ve("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:F}]))}function oe(){t()?(ve("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{fe(),e.onLose?.()},3e3)):ve("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:F}])}function ve(K,G,V){ne(p,{show:!0,title:K,text:G,actions:V},!0)}function fe(){f(p).show=!1}function le(K){return K.revealed?K.isMine?"💀":K.adjacentMines===0?"":K.adjacentMines.toString():K.flagged?"🕯":""}function Y(K){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][K]||"#ececec"}on(r,{children:(K,G)=>{var V=eg(),R=Je(V);{let $e=Dt(()=>t()?oe:void 0);ln(R,{onRestart:F,get onGiveUp(){return f($e)},get showGiveUp(){return t()}})}var Q=j(R,2),ae=E(Q);ir(ae,"grid-template-columns: repeat(8, 1fr);"),Ze(ae,21,()=>f(g),xt,($e,_e,Pe)=>{var ue=Qp();let Z;ue.__click=()=>U(Pe),ue.__contextmenu=Ae=>$(Pe,Ae);var re=E(ue),te=E(re);ke((Ae,ee,ce)=>{Z=Nt(ue,1,"cell svelte-1p9db1h",null,Z,Ae),Ne(ue,"aria-label",f(_e).revealed?f(_e).isMine?"Мина":`Ячейка с ${f(_e).adjacentMines} минами`:f(_e).flagged?"Флаг":"Неизвестно"),ir(re,`color: ${ee??""}`),me(te,ce)},[()=>({revealed:f(_e).revealed,mine:f(_e).isMine&&f(_e).revealed,flagged:f(_e).flagged}),()=>f(_e).revealed&&!f(_e).isMine?Y(f(_e).adjacentMines):"",()=>le(f(_e))]),W($e,ue)});var de=j(Q,2);un(de,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:($e,_e)=>{var Pe=Zp(),ue=E(Pe);ue.textContent="💀 10";var Z=j(ue,2),re=E(Z);ke(te=>me(re,`🕯 ${te??""}`),[()=>f(g).filter(te=>te.flagged).length]),W($e,Pe)},$$slots:{default:!0}});var ge=j(de,2);cn(ge,{get modal(){return f(p)}}),W(K,V)}}),Ot()}Ft(["click","contextmenu"]);function rg(r,e,t,n){if(f(e).length>0){const i=f(e).pop();i.faceUp=!0,f(t).push(i)}else f(t).length>0&&(ne(e,f(t).reverse().map(i=>({...i,faceUp:!1})),!0),ne(t,[],!0));Zr(n)}function ng(r,e,t){f(e).length!==0&&ne(t,{pile:-2,index:f(e).length-1},!0)}var ig=X('<div class="card back svelte-fcha4g"></div>'),sg=X('<div class="card empty svelte-fcha4g">🔄</div>'),ag=X('<div><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),og=X('<div class="card front svelte-fcha4g"><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),lg=X('<div class="card empty svelte-fcha4g">👻</div>'),ug=X('<button type="button" class="pile foundation svelte-fcha4g"><!></button>'),cg=X('<span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span>',1),dg=X('<button type="button"><!></button>'),fg=X('<div class="tableau svelte-fcha4g" role="button" tabindex="0"></div>'),hg=X('<div class="footer-stats svelte-fcha4g"><span class="moves-counter svelte-fcha4g">Ходов: <strong class="svelte-fcha4g"> </strong></span></div>'),vg=X('<!> <div id="game-container" class="svelte-fcha4g"><div class="top-row svelte-fcha4g"><button type="button" class="pile stock svelte-fcha4g" aria-label="Колода"><!></button> <button type="button" class="pile waste svelte-fcha4g" aria-label="Сброс"><!></button> <div class="foundations svelte-fcha4g"></div></div> <div class="tableaus svelte-fcha4g"></div></div> <!> <!>',1);function pg(r,e){Rt(e,!0);let t=ze(e,"integrated",3,!1),n=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],h={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},v=[1,2,3,4,5,6,7,8,9,10,11,12,13],g={1:"A",11:"J",12:"Q",13:"K"};let m=Me(pt([])),b=Me(pt([])),S=Me(pt([[],[],[],[]])),p=Me(pt([[],[],[],[],[],[],[]])),k=Me(null),x=Me(!1),P=Me(0),F=Me(pt({show:!1,title:"",text:"",actions:[]}));kr(()=>L());let H=Dt(()=>f(S).every(Y=>Y.length===13));function L(){let Y=[];for(const G of u)for(const V of v)Y.push({suit:G,rank:V,faceUp:!1});Y=Y.sort(()=>Math.random()-.5),ne(m,[],!0),ne(b,[],!0),ne(S,[[],[],[],[]],!0),ne(p,[[],[],[],[],[],[],[]],!0);let K=0;for(let G=0;G<7;G++)for(let V=G;V<7;V++){const R=Y[K++];R.faceUp=G===V,f(p)[V].push(R)}for(;K<Y.length;)f(m).push(Y[K++]);ne(k,null),ne(P,0),ne(x,!1),ve()}function U(Y,K){const G=f(p)[Y];if(f(k)){const{pile:V,index:R}=f(k);let Q;V===-2?Q=[f(b)[R]]:Q=f(p)[V].slice(R);const ae=Q[0];if(G.length===0){if(ae.rank===13){C(V,R,Y,-1),ne(k,null);return}}else{const de=G[G.length-1];if((ae.suit==="hearts"||ae.suit==="diamonds")!=(de.suit==="hearts"||de.suit==="diamonds")&&ae.rank===de.rank-1){C(V,R,Y,-1),ne(k,null);return}}if(Q.length===1)for(let de=0;de<4;de++){const ge=f(S)[de];if(ge.length===0){if(ae.rank===1){C(V,R,-1,de),ne(k,null);return}}else{const $e=ge[ge.length-1];if(ae.suit===$e.suit&&ae.rank===$e.rank+1){C(V,R,-1,de),ne(k,null);return}}}ne(k,null)}else K>=0&&G[K]?.faceUp&&ne(k,{pile:Y,index:K},!0)}function $(Y){if(!f(k))return;const{pile:K,index:G}=f(k);let V;K===-2?V=f(b)[G]:V=f(p)[K][G];const R=f(S)[Y];if(R.length===0)V.rank===1&&K>=-1&&(K===-2?[f(b)[G]]:f(p)[K].slice(G)).length===1&&C(K,G,-1,Y);else{const Q=R[R.length-1];V.suit===Q.suit&&V.rank===Q.rank+1&&(K===-2?[f(b)[G]]:f(p)[K].slice(G)).length===1&&C(K,G,-1,Y)}ne(k,null)}function C(Y,K,G,V){let R;Y===-2?R=[f(b).pop()]:(R=f(p)[Y].splice(K),f(p)[Y].length>0&&(f(p)[Y][f(p)[Y].length-1].faceUp=!0)),G>=0?f(p)[G].push(...R):V>=0&&f(S)[V].push(...R),Zr(P),O()}function O(){f(H)&&(ne(x,!0),t()?(oe("🎉 Победа!",`Вы собрали все души за ${f(P)} ходов!`,[]),setTimeout(()=>{ve(),e.onWin?.()},3e3)):oe("🎉 Победа!",`Вы собрали все души за ${f(P)} ходов!`,[{text:"Играть снова",action:L}]))}function ie(){t()?(oe("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ve(),e.onLose?.()},3e3)):oe("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:L}])}function oe(Y,K,G){ne(F,{show:!0,title:Y,text:K,actions:G},!0)}function ve(){f(F).show=!1}function fe(Y){return g[Y]||Y.toString()}function le(Y){return Y==="hearts"||Y==="diamonds"?"#e94560":"#ececec"}on(r,{children:(Y,K)=>{var G=vg(),V=Je(G);{let ee=Dt(()=>t()?ie:void 0);ln(V,{onRestart:L,get onGiveUp(){return f(ee)},get showGiveUp(){return t()}})}var R=j(V,2),Q=E(R),ae=E(Q);ae.__click=[rg,m,b,P];var de=E(ae);{var ge=ee=>{var ce=ig();W(ee,ce)},$e=ee=>{var ce=sg();W(ee,ce)};Re(de,ee=>{f(m).length>0?ee(ge):ee($e,!1)})}var _e=j(ae,2);_e.__click=[ng,b,k];var Pe=E(_e);{var ue=ee=>{var ce=ag();let we;var Ie=E(ce),Ue=E(Ie),Ve=j(Ie,2),We=E(Ve);ke((Oe,Xe,Ge)=>{we=Nt(ce,1,"card front svelte-fcha4g",null,we,Oe),me(Ue,Xe),ir(Ve,`color: ${Ge??""}`),me(We,h[f(b)[f(b).length-1].suit])},[()=>({selected:f(k)?.pile===-2}),()=>fe(f(b)[f(b).length-1].rank),()=>le(f(b)[f(b).length-1].suit)]),W(ee,ce)};Re(Pe,ee=>{f(b).length>0&&ee(ue)})}var Z=j(_e,2);Ze(Z,21,()=>f(S),xt,(ee,ce,we)=>{var Ie=ug();Ie.__click=()=>$(we),Ne(Ie,"aria-label",`Фундамент ${we+1}`);var Ue=E(Ie);{var Ve=Oe=>{var Xe=og(),Ge=E(Xe),_t=E(Ge),lt=j(Ge,2),Et=E(lt);ke((At,y)=>{me(_t,At),ir(lt,`color: ${y??""}`),me(Et,h[f(ce)[f(ce).length-1].suit])},[()=>fe(f(ce)[f(ce).length-1].rank),()=>le(f(ce)[f(ce).length-1].suit)]),W(Oe,Xe)},We=Oe=>{var Xe=lg();W(Oe,Xe)};Re(Ue,Oe=>{f(ce).length>0?Oe(Ve):Oe(We,!1)})}W(ee,Ie)});var re=j(Q,2);Ze(re,21,()=>f(p),xt,(ee,ce,we)=>{var Ie=fg();Ie.__click=()=>U(we,-1),Ie.__keydown=Ue=>{(Ue.key==="Enter"||Ue.key===" ")&&(Ue.preventDefault(),U(we,-1))},Ne(Ie,"aria-label",`Столбец ${we+1}`),Ze(Ie,21,()=>f(ce),xt,(Ue,Ve,We)=>{var Oe=dg();let Xe;Oe.__click=lt=>{lt.stopPropagation(),U(we,We)},ir(Oe,`margin-top: ${We>0?"-80%":"0"}; z-index: ${We};`);var Ge=E(Oe);{var _t=lt=>{var Et=cg(),At=Je(Et),y=E(At),o=j(At,2),d=E(o);ke((w,T)=>{me(y,w),ir(o,`color: ${T??""}`),me(d,h[f(Ve).suit])},[()=>fe(f(Ve).rank),()=>le(f(Ve).suit)]),W(lt,Et)};Re(Ge,lt=>{f(Ve).faceUp&&lt(_t)})}ke((lt,Et)=>{Xe=Nt(Oe,1,"card svelte-fcha4g",null,Xe,lt),Ne(Oe,"aria-label",Et)},[()=>({front:f(Ve).faceUp,back:!f(Ve).faceUp,selected:f(k)?.pile===we&&f(k)?.index===We}),()=>f(Ve).faceUp?`${fe(f(Ve).rank)} ${h[f(Ve).suit]}`:"Лицевая сторона карты"]),W(Ue,Oe)}),W(ee,Ie)});var te=j(R,2);un(te,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return l()},children:(ee,ce)=>{var we=hg(),Ie=E(we),Ue=j(E(Ie)),Ve=E(Ue);ke(()=>me(Ve,f(P))),W(ee,we)},$$slots:{default:!0}});var Ae=j(te,2);cn(Ae,{get modal(){return f(F)}}),W(Y,G)}}),Ot()}Ft(["click","keydown"]);var gg=X('<div class="loading svelte-15dde84">Загрузка игры...</div>'),_g=X('<div class="minigame-container svelte-15dde84"><!></div>');function mg(r,e){Rt(e,!0);let t=ze(e,"bucketName",3,"dracula");function n(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function i(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var l=_g(),u=E(l);{var h=g=>{Ap(g,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},v=g=>{var m=St(),b=Je(m);{var S=k=>{Rp(k,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=k=>{var x=St(),P=Je(x);{var F=L=>{Fp(L,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},H=L=>{var U=St(),$=Je(U);{var C=ie=>{Wp(ie,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},O=ie=>{var oe=St(),ve=Je(oe);{var fe=Y=>{Hp(Y,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},le=Y=>{var K=St(),G=Je(K);{var V=Q=>{Xp(Q,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},R=Q=>{var ae=St(),de=Je(ae);{var ge=_e=>{tg(_e,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},$e=_e=>{var Pe=St(),ue=Je(Pe);{var Z=te=>{pg(te,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},re=te=>{var Ae=gg();W(te,Ae)};Re(ue,te=>{e.gameId==="tower_of_souls"?te(Z):te(re,!1)},!0)}W(_e,Pe)};Re(de,_e=>{e.gameId==="cursed_crypts"?_e(ge):_e($e,!1)},!0)}W(Q,ae)};Re(G,Q=>{e.gameId==="evolution2048"?Q(V):Q(R,!1)},!0)}W(Y,K)};Re(ve,Y=>{e.gameId==="broken_mirror"?Y(fe):Y(le,!1)},!0)}W(ie,oe)};Re($,ie=>{e.gameId==="flood_it"?ie(C):ie(O,!1)},!0)}W(L,U)};Re(P,L=>{e.gameId==="light_out"?L(F):L(H,!1)},!0)}W(k,x)};Re(b,k=>{e.gameId==="memo_monsters"?k(S):k(p,!1)},!0)}W(g,m)};Re(u,g=>{e.gameId==="onet_monsters"?g(h):g(v,!1)})}W(r,l),Ot()}function yg(r,e){f(e)?.nextDialogueId&&Tt.goToDialogue(f(e).nextDialogueId)}var bg=X('<img alt="BG" class="background-image svelte-fl90wm"/>'),wg=X('<div class="background-media svelte-fl90wm"><!></div>'),kg=X('<img alt="Char" class="character-image svelte-fl90wm"/>'),Ig=X('<div class="character-media svelte-fl90wm"><!></div>'),Sg=(r,e,t)=>e(f(t)),Eg=X("<button> </button>"),Ag=X('<div class="options-container svelte-fl90wm"></div>'),Cg=X('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),jg=X('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),Tg=X("<p> </p>");function Uu(r,e){Rt(e,!0);let t=ze(e,"bucketName",3,$u);console.log(t());const n=Dt(()=>e.dialogue||Tt.findDialogue(Tt.currentDialogueId));let i=Me(null);li(()=>{f(n)?.onEnter&&Tt.runActions(f(n).onEnter)});function l(k){if(k.actions&&Tt.runActions(k.actions),k.miniGame){console.log("Запуск мини-игры:",k.miniGame.id),ne(i,{gameId:k.miniGame.id,onWinDialogueId:k.miniGame.onWinDialogueId,onLoseDialogueId:k.miniGame.onLoseDialogueId,rewardItem:k.miniGame.rewardItem},!0);return}k.nextDialogueId&&Tt.goToDialogue(k.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),f(i)?.rewardItem&&Tt.addItem(f(i).rewardItem),f(i)?.onWinDialogueId&&Tt.goToDialogue(f(i).onWinDialogueId),ne(i,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),f(i)?.onLoseDialogueId&&Tt.goToDialogue(f(i).onLoseDialogueId),ne(i,null)}function v(k){return k.visible===!1?!1:Tt.checkVisibilityCondition(k)}function g(k){return k.enabled!==!1}var m=St(),b=Je(m);{var S=k=>{var x=jg(),P=E(x);{var F=le=>{{let Y=Dt(()=>Tt.storyData?.items);mg(le,{get gameId(){return f(i).gameId},onWin:u,onLose:h,get rewardItem(){return f(i).rewardItem},get items(){return f(Y)},get bucketName(){return t()}})}};Re(P,le=>{f(i)&&le(F)})}var H=j(P,2);{var L=le=>{var Y=wg(),K=E(Y);{var G=R=>{var Q=St(),ae=Je(Q);wa(ae,()=>f(n).backgroundImage,de=>{Ml(de,{get fileName(){return f(n).backgroundImage},get bucketName(){return t()}})}),W(R,Q)},V=R=>{var Q=bg();ke(()=>Ne(Q,"src",`${Es}/storage/v1/object/public/${t()}/${f(n).backgroundImage}`)),W(R,Q)};Re(K,R=>{f(n).backgroundImage.endsWith(".riv")?R(G):R(V,!1)})}W(le,Y)};Re(H,le=>{f(n).backgroundImage&&le(L)})}var U=j(H,2);{var $=le=>{var Y=Ig(),K=E(Y);{var G=R=>{var Q=St(),ae=Je(Q);wa(ae,()=>f(n).characterImage,de=>{Ml(de,{get fileName(){return f(n).characterImage},get bucketName(){return t()}})}),W(R,Q)},V=R=>{var Q=kg();ke(()=>Ne(Q,"src",`${Es}/storage/v1/object/public/${t()}/${f(n).characterImage}`)),W(R,Q)};Re(K,R=>{f(n).characterImage.endsWith(".riv")?R(G):R(V,!1)})}W(le,Y)};Re(U,le=>{f(n).characterImage&&le($)})}var C=j(U,2),O=E(C),ie=E(O),oe=j(O,2);{var ve=le=>{var Y=Ag();Ze(Y,21,()=>f(n).options,K=>K.text,(K,G)=>{var V=St(),R=Je(V);{var Q=ae=>{var de=Eg();let ge;de.__click=[Sg,l,G];var $e=E(de);ke((_e,Pe)=>{ge=Nt(de,1,"option-button svelte-fl90wm",null,ge,_e),de.disabled=Pe,me($e,f(G).text)},[()=>({disabled:!g(f(G))}),()=>!g(f(G))]),W(ae,de)};Re(R,ae=>{v(f(G))&&ae(Q)})}W(K,V)}),W(le,Y)},fe=le=>{var Y=St(),K=Je(Y);{var G=V=>{var R=Cg(),Q=E(R);Q.__click=[yg,n],W(V,R)};Re(K,V=>{f(n).nextDialogueId&&V(G)},!0)}W(le,Y)};Re(oe,le=>{f(n).options&&f(n).options.length>0?le(ve):le(fe,!1)})}ke(()=>me(ie,f(n).text)),W(k,x)},p=k=>{var x=Tg(),P=E(x);ke(()=>me(P,`Диалог не найден (ID: ${Tt.currentDialogueId??""})`)),W(k,x)};Re(b,k=>{f(n)?k(S):k(p,!1)})}W(r,m),Ot()}Ft(["click"]);var ha=sn(()=>B),xg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Pg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Rg=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Og=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),Mg=X('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),Lg=X('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Dg=X('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function Fg(r,e){Rt(e,!1);function t(){ha(ha().editingOptionIndex=null)}nn();var n=Dg(),i=E(n),l=j(E(i),2);l.__click=t;var u=j(i,2),h=E(u);{var v=m=>{var b=Mg(),S=E(b);Uu(S,{get dialogue(){return Jt.currentDialogue},index:0,get bucketName(){return ha().selectedBucket}});var p=j(S,2),k=E(p),x=j(E(k),2),P=E(x),F=j(k,2),H=j(E(F),2),L=E(H),U=j(F,2);{var $=le=>{var Y=xg(),K=j(E(Y),2),G=E(K);ke(()=>me(G,Jt.currentDialogue.backgroundImage)),W(le,Y)};Re(U,le=>{Jt.currentDialogue.backgroundImage&&le($)})}var C=j(U,2);{var O=le=>{var Y=Pg(),K=j(E(Y),2),G=E(K);ke(()=>me(G,Jt.currentDialogue.characterImage)),W(le,Y)};Re(C,le=>{Jt.currentDialogue.characterImage&&le(O)})}var ie=j(p,2);{var oe=le=>{var Y=Rg();W(le,Y)};Re(ie,le=>{(!Jt.currentDialogue.options||Jt.currentDialogue.options.length===0)&&le(oe)})}var ve=j(ie,2);{var fe=le=>{var Y=Og();W(le,Y)};Re(ve,le=>{Jt.currentDialogue.options?.some(Y=>!Y.nextDialogueId)&&le(fe)})}ke(()=>{me(P,Jt.currentDialogue.id),me(L,Jt.currentChapter?.title||"Без главы")}),W(m,b)},g=m=>{var b=Lg();W(m,b)};Re(h,m=>{Jt.currentDialogue?m(v):m(g,!1)})}W(r,n),Ot()}Ft(["click"]);const $g=["dracula","zombie","fairy_tale","minigames"];function Nu(){const r=$g.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return bt.updateBucketsList(r),r}var yn=sn(()=>B),Ug=X('<span class="selected-badge svelte-1h9p6cz">Выбрано</span>'),Ng=(r,e,t)=>e(f(t).name),Bg=X('<button class="btn small svelte-1h9p6cz">Выбрать</button>'),Wg=X('<div><div class="bucket-info svelte-1h9p6cz"><div class="story-icon svelte-1h9p6cz"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1h9p6cz"><!></div></div>'),Vg=X('<div class="story-selector svelte-1h9p6cz"><div class="selector-header svelte-1h9p6cz"><h2 class="svelte-1h9p6cz">Выберите историю</h2></div> <div class="buckets-list svelte-1h9p6cz"></div></div>');function qg(r,e){Rt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};kr(()=>{n()});function n(){Nu()}async function i(h){yn(yn().selectedBucket=h),yn(yn().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await tn.loadStoriesList(),await tn.loadStoredResources()}nn();var l=Vg(),u=j(E(l),2);Ze(u,5,()=>yn().availableBuckets,h=>h,(h,v)=>{const g=hi(()=>t[f(v).id]||{title:f(v),description:"Интерактивная история",icon:"📖"});var m=Wg();let b;var S=E(m),p=E(S),k=E(p),x=j(p,2),P=E(x),F=E(P),H=j(P,2),L=E(H),U=j(S,2),$=E(U);{var C=ie=>{var oe=Ug();W(ie,oe)},O=ie=>{var oe=Bg();oe.__click=[Ng,i,v],W(ie,oe)};Re($,ie=>{yn().selectedBucket===f(v).name?ie(C):ie(O,!1)})}ke(ie=>{b=Nt(m,1,"bucket-card svelte-1h9p6cz",null,b,ie),me(k,f(g).icon),me(F,f(g).title),me(L,f(g).description)},[()=>({selected:yn().selectedBucket===f(v).name})]),W(h,m)}),W(r,l),Ot()}Ft(["click"]);var Gg=X("<span> </span>"),Hg=X('<div class="debug-info svelte-1k4krym"><small> </small></div>'),zg=X('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Kg=X('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Yg=X('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Jg(r,e){Rt(e,!0),kr(async()=>{Nu(),B.availableBuckets.length>0&&!B.selectedBucket&&(B.selectedBucket=B.availableBuckets[0].name)}),li(()=>{B.selectedBucket&&(console.log(`[Editor] Bucket выбран: ${B.selectedBucket}`),tn.loadStoredResources().then(()=>{const u=`${B.selectedBucket}_story.json`;return B.currentFileName=u,xr.loadStory(u)}).catch(u=>{console.error("[Editor] Ошибка загрузки истории:",u)}))});var t=St(),n=Je(t);{var i=u=>{qg(u,{})},l=u=>{var h=Yg(),v=E(h),g=E(v),m=E(g);m.__click=()=>B.selectedBucket=null;var b=j(m,2),S=E(b),p=j(g,2),k=E(p),x=E(k),P=j(k,2);{var F=G=>{var V=Gg(),R=E(V);ke(()=>{Nt(V,1,`status-message ${B.statusMessage.type??""}`,"svelte-1k4krym"),me(R,B.statusMessage.text)}),W(G,V)};Re(P,G=>{B.statusMessage.text&&G(F)})}var H=j(P,2);H.__click=function(...G){xr.saveCurrentStory?.apply(this,G)};var L=j(H,2);L.__click=function(...G){xr.saveStoryCopy?.apply(this,G)};var U=j(v,2),$=E(U);sv($,{});var C=j($,2),O=E(C);{var ie=G=>{var V=Hg(),R=E(V),Q=E(R);ke(()=>me(Q,`Загружено: ${B.data.meta?.title??""} |
              Глав: ${(B.data.chapters?.length||0)??""} |
              Диалогов: ${(B.data.dialogues?.length||0)??""} |
              Предметов: ${(B.data.items?.length||0)??""}`)),W(G,V)},oe=G=>{var V=zg();W(G,V)};Re(O,G=>{B.data?G(ie):G(oe,!1)})}var ve=j(O,2);sp(ve,{});var fe=j(ve,2);{var le=G=>{zv(G,{get editor(){return B},get storyActions(){return xr},get resourceActions(){return tn}})},Y=G=>{var V=Kg();W(G,V)};Re(fe,G=>{Jt.currentDialogue?G(le):G(Y,!1)})}var K=j(C,2);Fg(K,{}),ke(()=>{me(S,`Story Editor v3.1 - ${B.selectedBucket??""}`),me(x,B.currentFileName||"Нет файла")}),W(u,h)};Re(n,u=>{B.selectedBucket?u(l,!1):u(i)})}W(r,t),Ot()}Ft(["click"]);var va=sn(()=>Tt),Xg=(r,e,t)=>e(f(t)),Qg=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(f(t)))},Zg=X('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),e_=X('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function t_(r,e){Rt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function n(u){va(va().selectedStory=u)}nn();var i=e_(),l=j(E(i),2);Ze(l,5,()=>va().availableStories,u=>u,(u,h)=>{const v=hi(()=>t[f(h)]||{title:f(h),description:"Интерактивная история",icon:"📖"});var g=Zg();g.__click=[Xg,n,h],g.__keydown=[Qg,n,h];var m=E(g),b=E(m),S=j(m,2),p=E(S),k=E(p),x=j(p,2),P=E(x);ke(()=>{me(b,f(v).icon),me(k,f(v).title),me(P,f(v).description)}),W(u,g)}),W(r,i),Ot()}Ft(["click","keydown"]);var r_=X('<span class="inventory-badge svelte-166jaas"> </span>'),n_=(r,e)=>r.key==="Escape"&&e(),i_=r=>r.stopPropagation(),s_=r=>r.stopPropagation(),a_=(r,e,t)=>e(f(t)),o_=X('<button type="button" class="item-card svelte-166jaas"><div class="item-icon svelte-166jaas"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-166jaas"><span class="item-name svelte-166jaas"> </span> <span class="item-type svelte-166jaas"> </span></div></button>'),l_=X('<div class="items-grid svelte-166jaas"></div>'),u_=X('<div class="empty-inventory svelte-166jaas"><span class="empty-icon svelte-166jaas">🎒</span> <p class="svelte-166jaas">Инвентарь пуст</p> <p class="empty-hint svelte-166jaas">Получайте предметы в ходе игры</p></div>'),c_=X('<div class="inventory-overlay svelte-166jaas" role="dialog" tabindex="-1"><div class="inventory-modal svelte-166jaas" role="dialog" aria-label="Окно инвентаря" tabindex="-1"><div class="inventory-header svelte-166jaas"><h2 class="svelte-166jaas">Инвентарь</h2> <button class="close-button svelte-166jaas">✕</button></div> <div class="stats-section svelte-166jaas"><h3 class="svelte-166jaas">Характеристики</h3> <div class="stats-grid svelte-166jaas"><div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">📚</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Знания</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">💪</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Смелость</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">✨</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Харизма</span> <span class="stat-value svelte-166jaas"> </span></div></div></div></div> <div class="items-section svelte-166jaas"><h3 class="svelte-166jaas"> </h3> <!></div></div></div>'),d_=X('<div class="inventory-wrapper svelte-166jaas"><button class="inventory-button svelte-166jaas">🎒 <!></button> <!></div>');function f_(r,e){Rt(e,!0);let t=Me(!1);const n=Dt(()=>Tt.getInventoryItems()),i=Dt(()=>Tt.player.stats);function l(){ne(t,!f(t))}function u(p){console.log("Выбран предмет:",p.name)}var h=d_(),v=E(h);v.__click=l;var g=j(E(v));{var m=p=>{var k=r_(),x=E(k);ke(()=>me(x,f(n).length)),W(p,k)};Re(g,p=>{f(n).length>0&&p(m)})}var b=j(v,2);{var S=p=>{var k=c_();k.__click=l,k.__keydown=[n_,l];var x=E(k);x.__click=[i_],x.__keydown=[s_];var P=E(x),F=j(E(P),2);F.__click=l;var H=j(P,2),L=j(E(H),2),U=E(L),$=j(E(U),2),C=j(E($),2),O=E(C),ie=j(U,2),oe=j(E(ie),2),ve=j(E(oe),2),fe=E(ve),le=j(ie,2),Y=j(E(le),2),K=j(E(Y),2),G=E(K),V=j(H,2),R=E(V),Q=E(R),ae=j(R,2);{var de=$e=>{var _e=l_();Ze(_e,21,()=>f(n),Pe=>Pe.id,(Pe,ue)=>{var Z=o_();Z.__click=[a_,u,ue];var re=E(Z),te=E(re),Ae=j(re,2),ee=E(Ae),ce=E(ee),we=j(ee,2),Ie=E(we);ke(()=>{Ne(Z,"aria-label",`Предмет: ${f(ue).name}`),Ne(te,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Tt.selectedStory}/${f(ue).icon}`),Ne(te,"alt",f(ue).icon),me(ce,f(ue).name),me(Ie,f(ue).type)}),W(Pe,Z)}),W($e,_e)},ge=$e=>{var _e=u_();W($e,_e)};Re(ae,$e=>{f(n).length>0?$e(de):$e(ge,!1)})}ke(()=>{me(O,f(i).knowledge),me(fe,f(i).courage),me(G,f(i).charisma),me(Q,`Предметы (${f(n).length??""})`)}),W(p,k)};Re(b,p=>{f(t)&&p(S)})}ke(()=>Ne(v,"title",`Инвентарь (${f(n).length??""})`)),W(r,h),Ot()}Ft(["click","keydown"]);var h_=X('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),v_=X('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),p_=X('<div class="game-container svelte-14svm27"><!> <button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),g_=X('<div class="app svelte-14svm27"><!></div>');function __(r,e){Rt(e,!0),li(async()=>{if(Tt.selectedStory){const u=`${Tt.selectedStory}_story.json`,h=`${Es}/storage/v1/object/public/${Tt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await Tt.loadStory(h)}});var t=g_(),n=E(t);{var i=u=>{t_(u,{})},l=u=>{var h=St(),v=Je(h);{var g=b=>{var S=h_();W(b,S)},m=b=>{var S=St(),p=Je(S);{var k=P=>{var F=v_(),H=E(F),L=j(H);L.__click=()=>Tt.selectedStory=null,ke(()=>me(H,`⚠️ ${Tt.error??""} `)),W(P,F)},x=P=>{var F=p_(),H=E(F);f_(H,{});var L=j(H,2);L.__click=()=>Tt.selectedStory=null;var U=j(L,2),$=E(U);{var C=O=>{Uu(O,{get bucketName(){return Tt.selectedStory}})};Re($,O=>{Tt.storyData&&O(C)})}W(P,F)};Re(p,P=>{Tt.error?P(k):P(x,!1)},!0)}W(b,S)};Re(v,b=>{Tt.isLoading?b(g):b(m,!1)},!0)}W(u,h)};Re(n,u=>{Tt.selectedStory?u(l,!1):u(i)})}W(r,t),Ot()}Ft(["click"]);var m_=X('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),y_=X('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function b_(r,e){Rt(e,!1),nn();var t=St(),n=Je(t);{var i=u=>{var h=m_(),v=Je(h);v.__click=function(...m){bt.toggleEditor?.apply(this,m)};var g=j(v,2);Jg(g,{}),W(u,h)},l=u=>{var h=y_(),v=Je(h);v.__click=function(...m){bt.toggleEditor?.apply(this,m)};var g=j(v,2);__(g,{}),W(u,h)};Re(n,u=>{B.showEditor?u(i):u(l,!1)})}W(r,t),Ot()}Ft(["click"]);Cd(b_,{target:document.getElementById("app")});
