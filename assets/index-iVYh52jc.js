(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const xl=!1;var Ci=Array.isArray,cc=Array.prototype.indexOf,Aa=Array.from,aa=Object.defineProperty,Hr=Object.getOwnPropertyDescriptor,Pl=Object.getOwnPropertyDescriptors,dc=Object.prototype,hc=Array.prototype,Ca=Object.getPrototypeOf,No=Object.isExtensible;function fc(n){return n()}function hs(n){for(var e=0;e<n.length;e++)n[e]()}function vc(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const sn=2,Ta=4,bs=8,ni=16,Wn=32,br=64,jl=128,un=256,fs=512,Gt=1024,dn=2048,Zn=4096,bn=8192,wr=16384,xa=32768,Pa=65536,Bo=1<<17,pc=1<<18,Ti=1<<19,Rl=1<<20,oa=1<<21,ja=1<<22,_r=1<<23,Un=Symbol("$state"),gc=Symbol("legacy props"),_c=Symbol(""),Ra=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function mc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ol(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function yc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function bc(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function wc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function kc(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Ic(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ec(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function Sc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ac(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Cc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const ws=1,ks=2,Ml=4,Tc=8,xc=16,Pc=1,jc=2,Rc=4,Oc=8,Mc=16,Lc=1,Dc=2,Ut=Symbol(),$c="http://www.w3.org/1999/xhtml";function Fc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Uc=!1;function Ll(n){return n===this.v}function Dl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Nc(n,e){return n!==e}function $l(n){return!Dl(n,this.v)}let ri=!1,Bc=!1;function Wc(){ri=!0}let Rt=null;function vs(n){Rt=n}function Bt(n,e=!1,t){Rt={p:Rt,c:null,e:null,s:n,x:null,l:ri&&!e?{s:null,u:null,$:[]}:null}}function Wt(n){var e=Rt,t=e.e;if(t!==null){e.e=null;for(var r of t)Xl(r)}return Rt=e.p,{}}function ii(){return!ri||Rt!==null&&Rt.l===null}const Vc=new WeakMap;function qc(n){var e=ut;if(e===null)return ft.f|=_r,n;if((e.f&xa)===0){if((e.f&jl)===0)throw!e.parent&&n instanceof Error&&Fl(n),n;e.b.error(n)}else Oa(n,e)}function Oa(n,e){for(;e!==null;){if((e.f&jl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Fl(n),n}function Fl(n){const e=Vc.get(n);e&&(aa(n,"message",{value:e.message}),aa(n,"stack",{value:e.stack}))}let Ii=[],la=[];function Ul(){var n=Ii;Ii=[],hs(n)}function Hc(){var n=la;la=[],hs(n)}function Nl(n){Ii.length===0&&queueMicrotask(Ul),Ii.push(n)}function zc(){Ii.length>0&&Ul(),la.length>0&&Hc()}function Gc(){for(var n=ut.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&mc(),n}function xi(n){var e=sn|dn,t=ft!==null&&(ft.f&sn)!==0?ft:null;return ut===null||t!==null&&(t.f&un)!==0?e|=un:ut.f|=Ti,{ctx:Rt,deps:null,effects:null,equals:Ll,f:e,fn:n,reactions:null,rv:0,v:Ut,wv:0,parent:t??ut,ac:null}}function Kc(n,e){let t=ut;t===null&&yc();var r=t.b,s=void 0,l=Jr(Ut),u=null,h=!ft;return ud(()=>{try{var f=n();u&&Promise.resolve(f).catch(()=>{})}catch(g){f=Promise.reject(g)}var m=()=>f;s=u?.then(m,m)??Promise.resolve(f),u=s;var _=Ct,w=r.pending;h&&(r.update_pending_count(1),w||_.increment());const S=(g,E=void 0)=>{u=null,w||_.activate(),E?E!==Ra&&(l.f|=_r,Xr(l,E)):((l.f&_r)!==0&&(l.f^=_r),Xr(l,g)),h&&(r.update_pending_count(-1),w||_.decrement()),Vl()};if(s.then(S,g=>S(null,g||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(f=>{function m(_){function w(){_===s?f(l):m(s)}_.then(w,w)}m(s)})}function cn(n){const e=xi(n);return iu(e),e}function si(n){const e=xi(n);return e.equals=$l,e}function Bl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Bn(e[t])}}function Yc(n){for(var e=n.parent;e!==null;){if((e.f&sn)===0)return e;e=e.parent}return null}function Ma(n){var e,t=ut;Xn(Yc(n));try{Bl(n),e=lu(n)}finally{Xn(t)}return e}function Wl(n){var e=Ma(n);if(n.equals(e)||(n.v=e,n.wv=au()),!Ir){var t=(Yn||(n.f&un)!==0)&&n.deps!==null?Zn:Gt;en(n,t)}}function Jc(n,e,t){const r=ii()?xi:si;if(e.length===0){t(n.map(r));return}var s=Ct,l=ut,u=Xc(),h=Gc();Promise.all(e.map(f=>Kc(f))).then(f=>{s?.activate(),u();try{t([...n.map(r),...f])}catch(m){(l.f&wr)===0&&Oa(m,l)}s?.deactivate(),Vl()}).catch(f=>{h.error(f)})}function Xc(){var n=ut,e=ft,t=Rt,r=Ct;return function(){Xn(n),xn(e),vs(t),r?.activate()}}function Vl(){Xn(null),xn(null),vs(null)}const qs=new Set;let Ct=null,us=null,Wo=new Set,ps=[];function ql(){const n=ps.shift();ps.length>0&&queueMicrotask(ql),n()}let yr=[],Is=null,ua=!1,cs=!1;class Kr{current=new Map;#i=new Map;#n=new Set;#e=0;#s=null;#a=!1;#t=[];#r=[];#l=[];#o=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){yr=[],us=null;for(const s of e)this.#v(s);if(this.#t.length===0&&this.#e===0){this.#f();var t=this.#l,r=this.#o;this.#l=[],this.#o=[],this.#u=[],us=Ct,Ct=null,Vo(t),Vo(r),Ct===null?Ct=this:qs.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const s of this.#t)Gr(s);for(const s of this.#r)Gr(s);this.#t=[],this.#r=[]}#v(e){e.f^=Gt;for(var t=e.first;t!==null;){var r=t.f,s=(r&(Wn|br))!==0,l=s&&(r&Gt)!==0,u=l||(r&bn)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(s)t.f^=Gt;else if((r&Ta)!==0)this.#o.push(t);else if((r&Gt)===0)if((r&ja)!==0){var h=t.b?.pending?this.#r:this.#t;h.push(t)}else As(t)&&((t.f&ni)!==0&&this.#u.push(t),Gr(t));var f=t.first;if(f!==null){t=f;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&dn)!==0?this.#d:this.#h).push(t),en(t,Gt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){Ct=this}deactivate(){Ct=null,us=null;for(const e of Wo)if(Wo.delete(e),e(),Ct!==null)break}neuter(){this.#a=!0}flush(){yr.length>0?Hl():this.#f(),Ct===this&&(this.#e===0&&qs.delete(this),this.deactivate())}#f(){if(!this.#a)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)en(e,dn),Yr(e);for(const e of this.#h)en(e,Zn),Yr(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#s??=vc()).promise}static ensure(){if(Ct===null){const e=Ct=new Kr;qs.add(Ct),cs||Kr.enqueue(()=>{Ct===e&&e.flush()})}return Ct}static enqueue(e){ps.length===0&&queueMicrotask(ql),ps.unshift(e)}}function Qc(n){var e=cs;cs=!0;try{for(var t;;){if(zc(),yr.length===0&&(Ct?.flush(),yr.length===0))return Is=null,t;Hl()}}finally{cs=e}}function Hl(){var n=zr;ua=!0;try{var e=0;for(Go(!0);yr.length>0;){var t=Kr.ensure();if(e++>1e3){var r,s;Zc()}t.process(yr),Jn.clear()}}finally{ua=!1,Go(n),Is=null}}function Zc(){try{Ic()}catch(n){Oa(n,Is)}}let vr=null;function Vo(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(wr|bn))===0&&As(r)&&(vr=[],Gr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?tu(r):r.fn=null),vr?.length>0)){Jn.clear();for(const s of vr)Gr(s);vr=[]}}vr=null}}function Yr(n){for(var e=Is=n;e.parent!==null;){e=e.parent;var t=e.f;if(ua&&e===ut&&(t&ni)!==0)return;if((t&(br|Wn))!==0){if((t&Gt)===0)return;e.f^=Gt}}yr.push(e)}const Jn=new Map;function Jr(n,e){var t={f:0,v:n,reactions:null,equals:Ll,rv:0,wv:0};return t}function Ze(n,e){const t=Jr(n);return iu(t),t}function ed(n,e=!1,t=!0){const r=Jr(n);return e||(r.equals=$l),ri&&t&&Rt!==null&&Rt.l!==null&&(Rt.l.s??=[]).push(r),r}function Ie(n,e,t=!1){ft!==null&&(!Tn||(ft.f&Bo)!==0)&&ii()&&(ft.f&(sn|ni|ja|Bo))!==0&&!Nn?.includes(n)&&Cc();let r=t?Ot(e):e;return Xr(n,r)}function Xr(n,e){if(!n.equals(e)){var t=n.v;Ir?Jn.set(n,e):Jn.set(n,t),n.v=e;var r=Kr.ensure();r.capture(n,t),(n.f&sn)!==0&&((n.f&dn)!==0&&Ma(n),en(n,(n.f&un)===0?Gt:Zn)),n.wv=au(),zl(n,dn),ii()&&ut!==null&&(ut.f&Gt)!==0&&(ut.f&(Wn|br))===0&&(ln===null?fd([n]):ln.push(n))}return e}function ca(n,e=1){var t=y(n),r=e===1?t++:t--;return Ie(n,t),r}function Hs(n){Ie(n,n.v+1)}function zl(n,e){var t=n.reactions;if(t!==null)for(var r=ii(),s=t.length,l=0;l<s;l++){var u=t[l],h=u.f;if(!(!r&&u===ut)){var f=(h&dn)===0;f&&en(u,e),(h&sn)!==0?zl(u,Zn):f&&((h&ni)!==0&&vr!==null&&vr.push(u),Yr(u))}}}function Ot(n){if(typeof n!="object"||n===null||Un in n)return n;const e=Ca(n);if(e!==dc&&e!==hc)return n;var t=new Map,r=Ci(n),s=Ze(0),l=mr,u=h=>{if(mr===l)return h();var f=ft,m=mr;xn(null),Yo(l);var _=h();return xn(f),Yo(m),_};return r&&t.set("length",Ze(n.length)),new Proxy(n,{defineProperty(h,f,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Sc();var _=t.get(f);return _===void 0?_=u(()=>{var w=Ze(m.value);return t.set(f,w),w}):Ie(_,m.value,!0),!0},deleteProperty(h,f){var m=t.get(f);if(m===void 0){if(f in h){const _=u(()=>Ze(Ut));t.set(f,_),Hs(s)}}else Ie(m,Ut),Hs(s);return!0},get(h,f,m){if(f===Un)return n;var _=t.get(f),w=f in h;if(_===void 0&&(!w||Hr(h,f)?.writable)&&(_=u(()=>{var g=Ot(w?h[f]:Ut),E=Ze(g);return E}),t.set(f,_)),_!==void 0){var S=y(_);return S===Ut?void 0:S}return Reflect.get(h,f,m)},getOwnPropertyDescriptor(h,f){var m=Reflect.getOwnPropertyDescriptor(h,f);if(m&&"value"in m){var _=t.get(f);_&&(m.value=y(_))}else if(m===void 0){var w=t.get(f),S=w?.v;if(w!==void 0&&S!==Ut)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return m},has(h,f){if(f===Un)return!0;var m=t.get(f),_=m!==void 0&&m.v!==Ut||Reflect.has(h,f);if(m!==void 0||ut!==null&&(!_||Hr(h,f)?.writable)){m===void 0&&(m=u(()=>{var S=_?Ot(h[f]):Ut,g=Ze(S);return g}),t.set(f,m));var w=y(m);if(w===Ut)return!1}return _},set(h,f,m,_){var w=t.get(f),S=f in h;if(r&&f==="length")for(var g=m;g<w.v;g+=1){var E=t.get(g+"");E!==void 0?Ie(E,Ut):g in h&&(E=u(()=>Ze(Ut)),t.set(g+"",E))}if(w===void 0)(!S||Hr(h,f)?.writable)&&(w=u(()=>Ze(void 0)),Ie(w,Ot(m)),t.set(f,w));else{S=w.v!==Ut;var F=u(()=>Ot(m));Ie(w,F)}var O=Reflect.getOwnPropertyDescriptor(h,f);if(O?.set&&O.set.call(_,m),!S){if(r&&typeof f=="string"){var B=t.get("length"),q=Number(f);Number.isInteger(q)&&q>=B.v&&Ie(B,q+1)}Hs(s)}return!0},ownKeys(h){y(s);var f=Reflect.ownKeys(h).filter(w=>{var S=t.get(w);return S===void 0||S.v!==Ut});for(var[m,_]of t)_.v!==Ut&&!(m in h)&&f.push(m);return f},setPrototypeOf(){Ac()}})}function qo(n){try{if(n!==null&&typeof n=="object"&&Un in n)return n[Un]}catch{}return n}function td(n,e){return Object.is(qo(n),qo(e))}var Ho,Gl,Kl,Yl;function nd(){if(Ho===void 0){Ho=window,Gl=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Kl=Hr(e,"firstChild").get,Yl=Hr(e,"nextSibling").get,No(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),No(t)&&(t.__t=void 0)}}function kr(n=""){return document.createTextNode(n)}function Qr(n){return Kl.call(n)}function Es(n){return Yl.call(n)}function C(n,e){return Qr(n)}function jt(n,e){{var t=Qr(n);return t instanceof Comment&&t.data===""?Es(t):t}}function j(n,e=1,t=!1){let r=n;for(;e--;)r=Es(r);return r}function rd(n){n.textContent=""}function La(){return!1}let zo=!1;function id(){zo||(zo=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Da(n){var e=ft,t=ut;xn(null),Xn(null);try{return n()}finally{xn(e),Xn(t)}}function $a(n,e,t,r=t){n.addEventListener(e,()=>Da(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),id()}function Jl(n){ut===null&&ft===null&&kc(),ft!==null&&(ft.f&un)!==0&&ut===null&&wc(),Ir&&bc()}function sd(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Pn(n,e,t,r=!0){var s=ut;s!==null&&(s.f&bn)!==0&&(n|=bn);var l={ctx:Rt,deps:null,nodes_start:null,nodes_end:null,f:n|dn,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Gr(l),l.f|=xa}catch(f){throw Bn(l),f}else e!==null&&Yr(l);if(r){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Ti)===0&&(u=u.first),u!==null&&(u.parent=s,s!==null&&sd(u,s),ft!==null&&(ft.f&sn)!==0&&(n&br)===0)){var h=ft;(h.effects??=[]).push(u)}}return l}function ad(n){const e=Pn(bs,null,!1);return en(e,Gt),e.teardown=n,e}function Zr(n){Jl();var e=ut.f,t=!ft&&(e&Wn)!==0&&(e&xa)===0;if(t){var r=Rt;(r.e??=[]).push(n)}else return Xl(n)}function Xl(n){return Pn(Ta|Rl,n,!1)}function od(n){return Jl(),Pn(bs|Rl,n,!0)}function ld(n){Kr.ensure();const e=Pn(br|Ti,n,!0);return(t={})=>new Promise(r=>{t.outro?Ss(e,()=>{Bn(e),r(void 0)}):(Bn(e),r(void 0))})}function Ql(n){return Pn(Ta,n,!1)}function ud(n){return Pn(ja|Ti,n,!0)}function Fa(n,e=0){return Pn(bs|e,n,!0)}function Ee(n,e=[],t=[]){Jc(e,t,r=>{Pn(bs,()=>n(...r.map(y)),!0)})}function Ua(n,e=0){var t=Pn(ni|e,n,!0);return t}function ei(n,e=!0){return Pn(Wn|Ti,n,!0,e)}function Zl(n){var e=n.teardown;if(e!==null){const t=Ir,r=ft;Ko(!0),xn(null);try{e.call(null)}finally{Ko(t),xn(r)}}}function eu(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&Da(()=>{s.abort(Ra)});var r=t.next;(t.f&br)!==0?t.parent=null:Bn(t,e),t=r}}function cd(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Wn)===0&&Bn(e),e=t}}function Bn(n,e=!0){var t=!1;(e||(n.f&pc)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(dd(n.nodes_start,n.nodes_end),t=!0),eu(n,e&&!t),gs(n,0),en(n,wr);var r=n.transitions;if(r!==null)for(const l of r)l.stop();Zl(n);var s=n.parent;s!==null&&s.first!==null&&tu(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function dd(n,e){for(;n!==null;){var t=n===e?null:Es(n);n.remove(),n=t}}function tu(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ss(n,e){var t=[];Na(n,t,!0),nu(t,()=>{Bn(n),e&&e()})}function nu(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function Na(n,e,t){if((n.f&bn)===0){if(n.f^=bn,n.transitions!==null)for(const u of n.transitions)(u.is_global||t)&&e.push(u);for(var r=n.first;r!==null;){var s=r.next,l=(r.f&Pa)!==0||(r.f&Wn)!==0;Na(r,e,l?t:!1),r=s}}}function Ba(n){ru(n,!0)}function ru(n,e){if((n.f&bn)!==0){n.f^=bn,(n.f&Gt)===0&&(en(n,dn),Yr(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&Pa)!==0||(t.f&Wn)!==0;ru(t,s?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let Br=null;function hd(n){var e=Br;try{if(Br=new Set,Er(n),e!==null)for(var t of Br)e.add(t);return Br}finally{Br=e}}function _n(n){for(var e of hd(n))Xr(e,e.v)}let zr=!1;function Go(n){zr=n}let Ir=!1;function Ko(n){Ir=n}let ft=null,Tn=!1;function xn(n){ft=n}let ut=null;function Xn(n){ut=n}let Nn=null;function iu(n){ft!==null&&(Nn===null?Nn=[n]:Nn.push(n))}let Xt=null,nn=0,ln=null;function fd(n){ln=n}let su=1,Ei=0,mr=Ei;function Yo(n){mr=n}let Yn=!1;function au(){return++su}function As(n){var e=n.f;if((e&dn)!==0)return!0;if((e&Zn)!==0){var t=n.deps,r=(e&un)!==0;if(t!==null){var s,l,u=(e&fs)!==0,h=r&&ut!==null&&!Yn,f=t.length;if((u||h)&&(ut===null||(ut.f&wr)===0)){var m=n,_=m.parent;for(s=0;s<f;s++)l=t[s],(u||!l?.reactions?.includes(m))&&(l.reactions??=[]).push(m);u&&(m.f^=fs),h&&_!==null&&(_.f&un)===0&&(m.f^=un)}for(s=0;s<f;s++)if(l=t[s],As(l)&&Wl(l),l.wv>n.wv)return!0}(!r||ut!==null&&!Yn)&&en(n,Gt)}return!1}function ou(n,e,t=!0){var r=n.reactions;if(r!==null&&!Nn?.includes(n))for(var s=0;s<r.length;s++){var l=r[s];(l.f&sn)!==0?ou(l,e,!1):e===l&&(t?en(l,dn):(l.f&Gt)!==0&&en(l,Zn),Yr(l))}}function lu(n){var e=Xt,t=nn,r=ln,s=ft,l=Yn,u=Nn,h=Rt,f=Tn,m=mr,_=n.f;Xt=null,nn=0,ln=null,Yn=(_&un)!==0&&(Tn||!zr||ft===null),ft=(_&(Wn|br))===0?n:null,Nn=null,vs(n.ctx),Tn=!1,mr=++Ei,n.ac!==null&&(Da(()=>{n.ac.abort(Ra)}),n.ac=null);try{n.f|=oa;var w=n.fn,S=w(),g=n.deps;if(Xt!==null){var E;if(gs(n,nn),g!==null&&nn>0)for(g.length=nn+Xt.length,E=0;E<Xt.length;E++)g[nn+E]=Xt[E];else n.deps=g=Xt;if(!Yn||(_&sn)!==0&&n.reactions!==null)for(E=nn;E<g.length;E++)(g[E].reactions??=[]).push(n)}else g!==null&&nn<g.length&&(gs(n,nn),g.length=nn);if(ii()&&ln!==null&&!Tn&&g!==null&&(n.f&(sn|Zn|dn))===0)for(E=0;E<ln.length;E++)ou(ln[E],n);return s!==null&&s!==n&&(Ei++,ln!==null&&(r===null?r=ln:r.push(...ln))),(n.f&_r)!==0&&(n.f^=_r),S}catch(F){return qc(F)}finally{n.f^=oa,Xt=e,nn=t,ln=r,ft=s,Yn=l,Nn=u,vs(h),Tn=f,mr=m}}function vd(n,e){let t=e.reactions;if(t!==null){var r=cc.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&sn)!==0&&(Xt===null||!Xt.includes(e))&&(en(e,Zn),(e.f&(un|fs))===0&&(e.f^=fs),Bl(e),gs(e,0))}function gs(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)vd(n,t[r])}function Gr(n){var e=n.f;if((e&wr)===0){en(n,Gt);var t=ut,r=zr;ut=n,zr=!0;try{(e&ni)!==0?cd(n):eu(n),Zl(n);var s=lu(n);n.teardown=typeof s=="function"?s:null,n.wv=su;var l;xl&&Bc&&(n.f&dn)!==0&&n.deps}finally{zr=r,ut=t}}}async function uu(){await Promise.resolve(),Qc()}function y(n){var e=n.f,t=(e&sn)!==0;if(Br?.add(n),ft!==null&&!Tn){var r=ut!==null&&(ut.f&wr)!==0;if(!r&&!Nn?.includes(n)){var s=ft.deps;if((ft.f&oa)!==0)n.rv<Ei&&(n.rv=Ei,Xt===null&&s!==null&&s[nn]===n?nn++:Xt===null?Xt=[n]:(!Yn||!Xt.includes(n))&&Xt.push(n));else{(ft.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[ft]:l.includes(ft)||l.push(ft)}}}else if(t&&n.deps===null&&n.effects===null){var u=n,h=u.parent;h!==null&&(h.f&un)===0&&(u.f^=un)}if(Ir){if(Jn.has(n))return Jn.get(n);if(t){u=n;var f=u.v;return((u.f&Gt)===0&&u.reactions!==null||cu(u))&&(f=Ma(u)),Jn.set(u,f),f}}else t&&(u=n,As(u)&&Wl(u));if((n.f&_r)!==0)throw n.v;return n.v}function cu(n){if(n.v===Ut)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Jn.has(e)||(e.f&sn)!==0&&cu(e))return!0;return!1}function Er(n){var e=Tn;try{return Tn=!0,n()}finally{Tn=e}}const pd=-7169;function en(n,e){n.f=n.f&pd|e}function gd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Un in n)da(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Un in t&&da(t)}}}function da(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{da(n[r],e)}catch{}const t=Ca(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Pl(t);for(let s in r){const l=r[s].get;if(l)try{l.call(n)}catch{}}}}}const _d=["touchstart","touchmove"];function md(n){return _d.includes(n)}const du=new Set,ha=new Set;function Yt(n){for(var e=0;e<n.length;e++)du.add(n[e]);for(var t of ha)t(n)}let Jo=null;function ts(n){var e=this,t=e.ownerDocument,r=n.type,s=n.composedPath?.()||[],l=s[0]||n.target;Jo=n;var u=0,h=Jo===n&&n.__root;if(h){var f=s.indexOf(h);if(f!==-1&&(e===document||e===window)){n.__root=e;return}var m=s.indexOf(e);if(m===-1)return;f<=m&&(u=f)}if(l=s[u]||n.target,l!==e){aa(n,"currentTarget",{configurable:!0,get(){return l||t}});var _=ft,w=ut;xn(null),Xn(null);try{for(var S,g=[];l!==null;){var E=l.assignedSlot||l.parentNode||l.host||null;try{var F=l["__"+r];if(F!=null&&(!l.disabled||n.target===l))if(Ci(F)){var[O,...B]=F;O.apply(l,[n,...B])}else F.call(l,n)}catch(q){S?g.push(q):S=q}if(n.cancelBubble||E===e||E===null)break;l=E}if(S){for(let q of g)queueMicrotask(()=>{throw q});throw S}}finally{n.__root=e,delete n.currentTarget,xn(_),Xn(w)}}}function hu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Si(n,e){var t=ut;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function ee(n,e){var t=(e&Lc)!==0,r=(e&Dc)!==0,s,l=!n.startsWith("<!>");return()=>{s===void 0&&(s=hu(l?n:"<!>"+n),t||(s=Qr(s)));var u=r||Gl?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=Qr(u),f=u.lastChild;Si(h,f)}else Si(u,u);return u}}function yd(n,e,t="svg"){var r=!n.startsWith("<!>"),s=`<${t}>${r?n:"<!>"+n}</${t}>`,l;return()=>{if(!l){var u=hu(s),h=Qr(u);l=Qr(h)}var f=l.cloneNode(!0);return Si(f,f),f}}function bd(n,e){return yd(n,e,"svg")}function ns(n=""){{var e=kr(n+"");return Si(e,e),e}}function Kt(){var n=document.createDocumentFragment(),e=document.createComment(""),t=kr();return n.append(e,t),Si(e,t),n}function z(n,e){n!==null&&n.before(e)}function Ae(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function wd(n,e){return kd(n,e)}const Pr=new Map;function kd(n,{target:e,anchor:t,props:r={},events:s,context:l,intro:u=!0}){nd();var h=new Set,f=w=>{for(var S=0;S<w.length;S++){var g=w[S];if(!h.has(g)){h.add(g);var E=md(g);e.addEventListener(g,ts,{passive:E});var F=Pr.get(g);F===void 0?(document.addEventListener(g,ts,{passive:E}),Pr.set(g,1)):Pr.set(g,F+1)}}};f(Aa(du)),ha.add(f);var m=void 0,_=ld(()=>{var w=t??e.appendChild(kr());return ei(()=>{if(l){Bt({});var S=Rt;S.c=l}s&&(r.$$events=s),m=n(w,r)||{},l&&Wt()}),()=>{for(var S of h){e.removeEventListener(S,ts);var g=Pr.get(S);--g===0?(document.removeEventListener(S,ts),Pr.delete(S)):Pr.set(S,g)}ha.delete(f),w!==t&&w.parentNode?.removeChild(w)}});return Id.set(m,_),m}let Id=new WeakMap;function xe(n,e,t=!1){var r=n,s=null,l=null,u=Ut,h=t?Pa:0,f=!1;const m=(g,E=!0)=>{f=!0,S(E,g)};var _=null;function w(){_!==null&&(_.lastChild.remove(),r.before(_),_=null);var g=u?s:l,E=u?l:s;g&&Ba(g),E&&Ss(E,()=>{u?l=null:s=null})}const S=(g,E)=>{if(u!==(u=g)){var F=La(),O=r;if(F&&(_=document.createDocumentFragment(),_.append(O=kr())),u?s??=E&&ei(()=>E(O)):l??=E&&ei(()=>E(O)),F){var B=Ct,q=u?s:l,N=u?l:s;q&&B.skipped_effects.delete(q),N&&B.skipped_effects.add(N),B.add_callback(w)}else w()}};Ua(()=>{f=!1,e(m),f||S(null,null)},h)}function fa(n,e,t){var r=n,s=Ut,l,u,h=null,f=ii()?Nc:Dl;function m(){l&&Ss(l),h!==null&&(h.lastChild.remove(),r.before(h),h=null),l=u}Ua(()=>{if(f(s,s=e())){var _=r,w=La();w&&(h=document.createDocumentFragment(),h.append(_=kr())),u=ei(()=>t(_)),w?Ct.add_callback(m):m()}})}function rn(n,e){return e}function Ed(n,e,t){for(var r=n.items,s=[],l=e.length,u=0;u<l;u++)Na(e[u].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var f=t.parentNode;rd(f),f.append(t),r.clear(),Sn(n,e[0].prev,e[l-1].next)}nu(s,()=>{for(var m=0;m<l;m++){var _=e[m];h||(r.delete(_.k),Sn(n,_.prev,_.next)),Bn(_.e,!h)}})}function kt(n,e,t,r,s,l=null){var u=n,h={flags:e,items:new Map,first:null},f=(e&Ml)!==0;if(f){var m=n;u=m.appendChild(kr())}var _=null,w=!1,S=new Map,g=si(()=>{var B=t();return Ci(B)?B:B==null?[]:Aa(B)}),E,F;function O(){Sd(F,E,h,S,u,s,e,r,t),l!==null&&(E.length===0?_?Ba(_):_=ei(()=>l(u)):_!==null&&Ss(_,()=>{_=null}))}Ua(()=>{F??=ut,E=y(g);var B=E.length;if(!(w&&B===0)){w=B===0;var q,N,K,Y;if(La()){var D=new Set,W=Ct;for(N=0;N<B;N+=1){K=E[N],Y=r(K,N);var re=h.items.get(Y)??S.get(Y);re?(e&(ws|ks))!==0&&fu(re,K,N,e):(q=vu(null,h,null,null,K,Y,N,s,e,t,!0),S.set(Y,q)),D.add(Y)}for(const[Z,be]of h.items)D.has(Z)||W.skipped_effects.add(be.e);W.add_callback(O)}else O();y(g)}})}function Sd(n,e,t,r,s,l,u,h,f){var m=(u&Tc)!==0,_=(u&(ws|ks))!==0,w=e.length,S=t.items,g=t.first,E=g,F,O=null,B,q=[],N=[],K,Y,D,W;if(m)for(W=0;W<w;W+=1)K=e[W],Y=h(K,W),D=S.get(Y),D!==void 0&&(D.a?.measure(),(B??=new Set).add(D));for(W=0;W<w;W+=1){if(K=e[W],Y=h(K,W),D=S.get(Y),D===void 0){var re=r.get(Y);if(re!==void 0){r.delete(Y),S.set(Y,re);var Z=O?O.next:E;Sn(t,O,re),Sn(t,re,Z),zs(re,Z,s),O=re}else{var be=E?E.e.nodes_start:s;O=vu(be,t,O,O===null?t.first:O.next,K,Y,W,l,u,f)}S.set(Y,O),q=[],N=[],E=O.next;continue}if(_&&fu(D,K,W,u),(D.e.f&bn)!==0&&(Ba(D.e),m&&(D.a?.unfix(),(B??=new Set).delete(D))),D!==E){if(F!==void 0&&F.has(D)){if(q.length<N.length){var ue=N[0],X;O=ue.prev;var we=q[0],Me=q[q.length-1];for(X=0;X<q.length;X+=1)zs(q[X],ue,s);for(X=0;X<N.length;X+=1)F.delete(N[X]);Sn(t,we.prev,Me.next),Sn(t,O,we),Sn(t,Me,ue),E=ue,O=Me,W-=1,q=[],N=[]}else F.delete(D),zs(D,E,s),Sn(t,D.prev,D.next),Sn(t,D,O===null?t.first:O.next),Sn(t,O,D),O=D;continue}for(q=[],N=[];E!==null&&E.k!==Y;)(E.e.f&bn)===0&&(F??=new Set).add(E),N.push(E),E=E.next;if(E===null)continue;D=E}q.push(D),O=D,E=D.next}if(E!==null||F!==void 0){for(var ce=F===void 0?[]:Aa(F);E!==null;)(E.e.f&bn)===0&&ce.push(E),E=E.next;var $e=ce.length;if($e>0){var ye=(u&Ml)!==0&&w===0?s:null;if(m){for(W=0;W<$e;W+=1)ce[W].a?.measure();for(W=0;W<$e;W+=1)ce[W].a?.fix()}Ed(t,ce,ye)}}m&&Nl(()=>{if(B!==void 0)for(D of B)D.a?.apply()}),n.first=t.first&&t.first.e,n.last=O&&O.e;for(var ze of r.values())Bn(ze.e);r.clear()}function fu(n,e,t,r){(r&ws)!==0&&Xr(n.v,e),(r&ks)!==0?Xr(n.i,t):n.i=t}function vu(n,e,t,r,s,l,u,h,f,m,_){var w=(f&ws)!==0,S=(f&xc)===0,g=w?S?ed(s,!1,!1):Jr(s):s,E=(f&ks)===0?u:Jr(u),F={i:E,v:g,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var O=document.createDocumentFragment();O.append(n=kr())}return F.e=ei(()=>h(n,g,E,m),Uc),F.e.prev=t&&t.e,F.e.next=r&&r.e,t===null?_||(e.first=F):(t.next=F,t.e.next=F.e),r!==null&&(r.prev=F,r.e.prev=F.e),F}finally{}}function zs(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var u=Es(l);s.before(l),l=u}}function Sn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const Xo=[...` 	
\r\f \v\uFEFF`];function Ad(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var l=s.length,u=0;(u=r.indexOf(s,u))>=0;){var h=u+l;(u===0||Xo.includes(r[u-1]))&&(h===r.length||Xo.includes(r[h]))?r=(u===0?"":r.substring(0,u))+r.substring(h+1):u=h}}return r===""?null:r}function Cd(n,e){return n==null?null:String(n)}function qt(n,e,t,r,s,l){var u=n.__className;if(u!==t||u===void 0){var h=Ad(t,r,l);h==null?n.removeAttribute("class"):n.className=h,n.__className=t}else if(l&&s!==l)for(var f in l){var m=!!l[f];(s==null||m!==!!s[f])&&n.classList.toggle(f,m)}return l}function pu(n,e,t,r){var s=n.__style;if(s!==e){var l=Cd(e);l==null?n.removeAttribute("style"):n.style.cssText=l,n.__style=e}return r}function Gn(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Ci(e))return Fc();for(var r of n.options)r.selected=e.includes(yi(r));return}for(r of n.options){var s=yi(r);if(td(s,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function hr(n){var e=new MutationObserver(()=>{Gn(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ad(()=>{e.disconnect()})}function qr(n,e,t=e){var r=!0;$a(n,"change",s=>{var l=s?"[selected]":":checked",u;if(n.multiple)u=[].map.call(n.querySelectorAll(l),yi);else{var h=n.querySelector(l)??n.querySelector("option:not([disabled])");u=h&&yi(h)}t(u)}),Ql(()=>{var s=e();if(Gn(n,s,r),r&&s===void 0){var l=n.querySelector(":checked");l!==null&&(s=yi(l),t(s))}n.__value=s,r=!1}),hr(n)}function yi(n){return"__value"in n?n.__value:n.value}const Td=Symbol("is custom element"),xd=Symbol("is html");function Gs(n,e){var t=Wa(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Pd(n,e){var t=Wa(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Oe(n,e,t,r){var s=Wa(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[_c]=t),t==null?n.removeAttribute(e):typeof t!="string"&&jd(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Wa(n){return n.__attributes??={[Td]:n.nodeName.includes("-"),[xd]:n.namespaceURI===$c}}var Qo=new Map;function jd(n){var e=n.getAttribute("is")||n.nodeName,t=Qo.get(e);if(t)return t;Qo.set(e,t=[]);for(var r,s=n,l=Element.prototype;l!==s;){r=Pl(s);for(var u in r)r[u].set&&t.push(u);s=Ca(s)}return t}function Fn(n,e,t=e){var r=new WeakSet;$a(n,"input",async s=>{var l=s?n.defaultValue:n.value;if(l=Ks(n)?Ys(l):l,t(l),Ct!==null&&r.add(Ct),await uu(),l!==(l=e())){var u=n.selectionStart,h=n.selectionEnd;n.value=l??"",h!==null&&(n.selectionStart=u,n.selectionEnd=Math.min(h,n.value.length))}}),Er(e)==null&&n.value&&(t(Ks(n)?Ys(n.value):n.value),Ct!==null&&r.add(Ct)),Fa(()=>{var s=e();if(n===document.activeElement){var l=us??Ct;if(r.has(l))return}Ks(n)&&s===Ys(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Zo(n,e,t=e){$a(n,"change",r=>{var s=r?n.defaultChecked:n.checked;t(s)}),Er(e)==null&&t(n.checked),Fa(()=>{var r=e();n.checked=!!r})}function Ks(n){var e=n.type;return e==="number"||e==="range"}function Ys(n){return n===""?null:+n}function el(n,e){return n===e||n?.[Un]===e}function va(n={},e,t,r){return Ql(()=>{var s,l;return Fa(()=>{s=l,l=[],Er(()=>{n!==t(...l)&&(e(n,...l),s&&el(t(...s),n)&&e(null,...s))})}),()=>{Nl(()=>{l&&el(t(...l),n)&&e(null,...l)})}}),n}function er(n=!1){const e=Rt,t=e.l.u;if(!t)return;let r=()=>gd(e.s);if(n){let s=0,l={};const u=xi(()=>{let h=!1;const f=e.s;for(const m in f)f[m]!==l[m]&&(l[m]=f[m],h=!0);return h&&s++,s});r=()=>y(u)}t.b.length&&od(()=>{tl(e,r),hs(t.b)}),Zr(()=>{const s=Er(()=>t.m.map(fc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&Zr(()=>{tl(e,r),hs(t.a)})}function tl(n,e){if(n.l.s)for(const t of n.l.s)y(t);e()}function tr(n){var e=Jr(0);return function(){return arguments.length===1?(Ie(e,y(e)+1),arguments[0]):(y(e),n())}}let rs=!1;function Rd(n){var e=rs;try{return rs=!1,[n(),rs]}finally{rs=e}}function yn(n,e,t,r){var s=!ri||(t&jc)!==0,l=(t&Oc)!==0,u=(t&Mc)!==0,h=r,f=!0,m=()=>(f&&(f=!1,h=u?Er(r):r),h),_;if(l){var w=Un in n||gc in n;_=Hr(n,e)?.set??(w&&e in n?N=>n[e]=N:void 0)}var S,g=!1;l?[S,g]=Rd(()=>n[e]):S=n[e],S===void 0&&r!==void 0&&(S=m(),_&&(s&&Ec(),_(S)));var E;if(s?E=()=>{var N=n[e];return N===void 0?m():(f=!0,N)}:E=()=>{var N=n[e];return N!==void 0&&(h=void 0),N===void 0?h:N},s&&(t&Rc)===0)return E;if(_){var F=n.$$legacy;return(function(N,K){return arguments.length>0?((!s||!K||F||g)&&_(K?E():N),N):E()})}var O=!1,B=((t&Pc)!==0?xi:si)(()=>(O=!1,E()));l&&y(B);var q=ut;return(function(N,K){if(arguments.length>0){const Y=K?y(B):s&&l?Ot(N):N;return Ie(B,Y),O=!0,h!==void 0&&(h=Y),N}return Ir&&O||(q.f&wr)!==0?B.v:y(B)})}function Pi(n){Rt===null&&Ol(),ri&&Rt.l!==null?Md(Rt).m.push(n):Zr(()=>{const e=Er(n);if(typeof e=="function")return e})}function Od(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function gu(){const n=Rt;return n===null&&Ol(),(e,t,r)=>{const s=n.s.$$events?.[e];if(s){const l=Ci(s)?s.slice():[s],u=Od(e,t,r);for(const h of l)h.call(n.x,u);return!u.defaultPrevented}return!0}}function Md(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Ld="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ld);Wc();const L=Ot({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Nt={get currentDialogue(){return L.data?.dialogues.find(n=>n.id===L.selectedDialogueId)},get currentChapter(){return L.data?.chapters?.find(n=>n.id===L.selectedChapterId)},get currentEditingChapter(){return L.data?.chapters?.find(n=>n.id===L.editingChapterId)},get currentEditingOption(){return Nt.currentDialogue&&L.editingOptionIndex!==null?Nt.currentDialogue.options?.[L.editingOptionIndex]:void 0},get chapterDialogues(){return!L.data?.dialogues||!L.selectedChapterId?[]:L.data.dialogues.filter(n=>n.chapterId===L.selectedChapterId)},get imageResources(){return L.storedFiles.filter(n=>n.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return L.storedFiles.filter(n=>n.name.endsWith(".riv"))},get availableItems(){return L.data?.items||[]},get backlinks(){return!L.data||!L.selectedDialogueId?[]:L.data.dialogues.filter(n=>n.nextDialogueId===L.selectedDialogueId?!0:n.options?n.options.some(e=>e.nextDialogueId===L.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},gt={toggleEditor(){L.showEditor=!L.showEditor},toggleItemsPanel(){L.showItems=!L.showItems},setStatus(n,e){L.statusMessage={type:n,text:e}},clearStatus(){L.statusMessage={type:"",text:""}},selectBucket(n){L.selectedBucket=n,L.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},L.storedFiles=[],L.storiesList=[],L.selectedChapterId=null,L.selectedDialogueId=null},updateBucketsList(n){L.availableBuckets=n},selectChapter(n){L.selectedChapterId=n,L.selectedDialogueId=null},selectDialogue(n){L.selectedDialogueId=n},selectOption(n){L.editingOptionIndex=n},selectItem(n){L.editingItemIndex=n},updateStoryData(n){L.data=n},updateStoredFiles(n){L.storedFiles=n},updateStoriesList(n){L.storiesList=n},setCurrentFileName(n){L.currentFileName=n},addDialogue(n){L.data.dialogues=[...L.data.dialogues,n]},updateDialogue(n,e){L.data.dialogues=L.data.dialogues.map(t=>t.id===n?{...t,...e}:t)},deleteDialogue(n){L.data.dialogues=L.data.dialogues.filter(e=>e.id!==n),L.selectedDialogueId===n&&(L.selectedDialogueId=null)},addChapter(n){L.data.chapters=[...L.data.chapters,n]},updateChapter(n,e){L.data.chapters=L.data.chapters.map(t=>t.id===n?{...t,...e}:t)},selectEditingChapter(n){L.editingChapterId=n},deleteChapter(n){L.data.chapters=L.data.chapters.filter(e=>e.id!==n),L.selectedChapterId===n&&(L.selectedChapterId=null,L.selectedDialogueId=null)},addItem(n){L.data.items=[...L.data.items||[],n]},updateItem(n,e){L.data.items&&(L.data.items=L.data.items.map(t=>t.id===n?{...t,...e}:t))},deleteItem(n){L.data.items&&(L.data.items=L.data.items.filter(e=>e.id!==n))},reset(){L.showEditor=!1,L.showItems=!1,L.editingOptionIndex=null,L.editingItemIndex=null,L.selectedChapterId=null,L.selectedDialogueId=null,L.statusMessage={type:"",text:""}}},Dd="modulepreload",$d=function(n,e){return new URL(n,e).href},nl={},ji=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let m=function(_){return Promise.all(_.map(w=>Promise.resolve(w).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");s=m(t.map(_=>{if(_=$d(_,r),_ in nl)return;nl[_]=!0;const w=_.endsWith(".css"),S=w?'[rel="stylesheet"]':"";if(!!r)for(let F=u.length-1;F>=0;F--){const O=u[F];if(O.href===_&&(!w||O.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${S}`))return;const E=document.createElement("link");if(E.rel=w?"stylesheet":Dd,w||(E.as="script"),E.crossOrigin="",E.href=_,f&&E.setAttribute("nonce",f),document.head.appendChild(E),w)return new Promise((F,O)=>{E.addEventListener("load",F),E.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Fd=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:r}=await Promise.resolve().then(()=>ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Va extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ud extends Va{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rl extends Va{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class il extends Va{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var pa;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(pa||(pa={}));var Nd=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Bd{constructor(e,{headers:t={},customFetch:r,region:s=pa.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Fd(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Nd(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:u}=t;let h={},{region:f}=t;f||(f=this.region);const m=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let _;u&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(h["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(h["Content-Type"]="application/json",_=JSON.stringify(u)));const w=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:_}).catch(F=>{throw new Ud(F)}),S=w.headers.get("x-relay-error");if(S&&S==="true")throw new rl(w);if(!w.ok)throw new il(w);let g=((r=w.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),E;return g==="application/json"?E=yield w.json():g==="application/octet-stream"?E=yield w.blob():g==="text/event-stream"?E=w:g==="multipart/form-data"?E=yield w.formData():E=yield w.text(),{data:E,error:null,response:w}}catch(s){return{data:null,error:s,response:s instanceof il||s instanceof rl?s.context:void 0}}})}}function Wd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Vd(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Ft={},jr={},Rr={},Or={},Mr={},Lr={},qd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ti=qd();const Hd=ti.fetch,_u=ti.fetch.bind(ti),mu=ti.Headers,zd=ti.Request,Gd=ti.Response,ai=Object.freeze(Object.defineProperty({__proto__:null,Headers:mu,Request:zd,Response:Gd,default:_u,fetch:Hd},Symbol.toStringTag,{value:"Module"})),Kd=Vd(ai);var is={},sl;function yu(){if(sl)return is;sl=1,Object.defineProperty(is,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return is.default=n,is}var al;function bu(){if(al)return Lr;al=1;var n=Lr&&Lr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Lr,"__esModule",{value:!0});const e=n(Kd),t=n(yu());class r{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let f=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var _,w,S,g;let E=null,F=null,O=null,B=m.status,q=m.statusText;if(m.ok){if(this.method!=="HEAD"){const D=await m.text();D===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?F=D:F=JSON.parse(D))}const K=(w=this.headers.get("Prefer"))===null||w===void 0?void 0:w.match(/count=(exact|planned|estimated)/),Y=(S=m.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");K&&Y&&Y.length>1&&(O=parseInt(Y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(F)&&(F.length>1?(E={code:"PGRST116",details:`Results contain ${F.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},F=null,O=null,B=406,q="Not Acceptable"):F.length===1?F=F[0]:F=null)}else{const K=await m.text();try{E=JSON.parse(K),Array.isArray(E)&&m.status===404&&(F=[],E=null,B=200,q="OK")}catch{m.status===404&&K===""?(B=204,q="No Content"):E={message:K}}if(E&&this.isMaybeSingle&&(!((g=E?.details)===null||g===void 0)&&g.includes("0 rows"))&&(E=null,B=200,q="OK"),E&&this.shouldThrowOnError)throw new t.default(E)}return{error:E,data:F,count:O,status:B,statusText:q}});return this.shouldThrowOnError||(f=f.catch(m=>{var _,w,S;return{error:{message:`${(_=m?.name)!==null&&_!==void 0?_:"FetchError"}: ${m?.message}`,details:`${(w=m?.stack)!==null&&w!==void 0?w:""}`,hint:"",code:`${(S=m?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),f.then(l,u)}returns(){return this}overrideTypes(){return this}}return Lr.default=r,Lr}var ol;function wu(){if(ol)return Mr;ol=1;var n=Mr&&Mr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Mr,"__esModule",{value:!0});const e=n(bu());class t extends e.default{select(s){let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:f=h}={}){const m=f?`${f}.order`:"order",_=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${_?`${_},`:""}${s}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:u,referencedTable:h=u}={}){const f=typeof h>"u"?"offset":`${h}.offset`,m=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(f,`${s}`),this.url.searchParams.set(m,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:f=!1,format:m="text"}={}){var _;const w=[s?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,f?"wal":null].filter(Boolean).join("|"),S=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${S}"; options=${w};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Mr.default=t,Mr}var ll;function qa(){if(ll)return Or;ll=1;var n=Or&&Or.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Or,"__esModule",{value:!0});const e=n(wu());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const m=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${m}.${l}`),this}match(s){return Object.entries(s).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(s,l,u){return this.url.searchParams.append(s,`not.${l}.${u}`),this}or(s,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,u){return this.url.searchParams.append(s,`${l}.${u}`),this}}return Or.default=t,Or}var ul;function ku(){if(ul)return Rr;ul=1;var n=Rr&&Rr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=n(qa());class t{constructor(s,{headers:l={},schema:u,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(s,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let f=!1;const m=(s??"*").split("").map(_=>/\s/.test(_)&&!f?"":(_==='"'&&(f=!f),_)).join("");return this.url.searchParams.set("select",m),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:u=!0}={}){var h;const f="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((_,w)=>_.concat(Object.keys(w)),[]);if(m.length>0){const _=[...new Set(m)].map(w=>`"${w}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:f=!0}={}){var m;const _="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const w=s.reduce((S,g)=>S.concat(Object.keys(g)),[]);if(w.length>0){const S=[...new Set(w)].map(g=>`"${g}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(s,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:s}={}){var l;const u="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Rr.default=t,Rr}var cl;function Yd(){if(cl)return jr;cl=1;var n=jr&&jr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(jr,"__esModule",{value:!0});const e=n(ku()),t=n(qa());class r{constructor(l,{headers:u={},schema:h,fetch:f}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=f}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:f=!1,count:m}={}){var _;let w;const S=new URL(`${this.url}/rpc/${l}`);let g;h||f?(w=h?"HEAD":"GET",Object.entries(u).filter(([F,O])=>O!==void 0).map(([F,O])=>[F,Array.isArray(O)?`{${O.join(",")}}`:`${O}`]).forEach(([F,O])=>{S.searchParams.append(F,O)})):(w="POST",g=u);const E=new Headers(this.headers);return m&&E.set("Prefer",`count=${m}`),new t.default({method:w,url:S,headers:E,schema:this.schemaName,body:g,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return jr.default=r,jr}var dl;function Jd(){if(dl)return Ft;dl=1;var n=Ft&&Ft.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PostgrestError=Ft.PostgrestBuilder=Ft.PostgrestTransformBuilder=Ft.PostgrestFilterBuilder=Ft.PostgrestQueryBuilder=Ft.PostgrestClient=void 0;const e=n(Yd());Ft.PostgrestClient=e.default;const t=n(ku());Ft.PostgrestQueryBuilder=t.default;const r=n(qa());Ft.PostgrestFilterBuilder=r.default;const s=n(wu());Ft.PostgrestTransformBuilder=s.default;const l=n(bu());Ft.PostgrestBuilder=l.default;const u=n(yu());return Ft.PostgrestError=u.default,Ft.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:u.default},Ft}var Xd=Jd();const Qd=Wd(Xd),{PostgrestClient:Zd,PostgrestQueryBuilder:Ig,PostgrestFilterBuilder:Eg,PostgrestTransformBuilder:Sg,PostgrestBuilder:Ag,PostgrestError:Cg}=Qd;class eh{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const th="2.15.1",nh=`realtime-js/${th}`,rh="1.0.0",ga=1e4,ih=1e3,sh=100;var bi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(bi||(bi={}));var Mt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Mt||(Mt={}));var mn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(mn||(mn={}));var _a;(function(n){n.websocket="websocket"})(_a||(_a={}));var pr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(pr||(pr={}));class ah{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=r.decode(e.slice(u,u+s));u=u+s;const f=r.decode(e.slice(u,u+l));u=u+l;const m=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:f,payload:m}}}class Iu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var St;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(St||(St={}));const hl=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,u)=>(l[u]=oh(u,n,e,s),l),{})},oh=(n,e,t,r)=>{const s=e.find(h=>h.name===n),l=s?.type,u=t[n];return l&&!r.includes(l)?Eu(l,u):ma(u)},Eu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return dh(e,t)}switch(n){case St.bool:return lh(e);case St.float4:case St.float8:case St.int2:case St.int4:case St.int8:case St.numeric:case St.oid:return uh(e);case St.json:case St.jsonb:return ch(e);case St.timestamp:return hh(e);case St.abstime:case St.date:case St.daterange:case St.int4range:case St.int8range:case St.money:case St.reltime:case St.text:case St.time:case St.timestamptz:case St.timetz:case St.tsrange:case St.tstzrange:return ma(e);default:return ma(e)}},ma=n=>n,lh=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},uh=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},ch=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},dh=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const u=n.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>Eu(e,h))}return n},hh=n=>typeof n=="string"?n.replace(" ","T"):n,Su=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Js{constructor(e,t,r={},s=ga){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var fl;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(fl||(fl={}));class wi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=wi.syncState(this.state,s,l,u),this.pendingDiffs.forEach(f=>{this.state=wi.syncDiff(this.state,f,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(r.diff,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=wi.syncDiff(this.state,s,l,u),h())}),this.onJoin((s,l,u)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:u})}),this.onLeave((s,l,u)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const l=this.cloneDeep(e),u=this.transformState(t),h={},f={};return this.map(l,(m,_)=>{u[m]||(f[m]=_)}),this.map(u,(m,_)=>{const w=l[m];if(w){const S=_.map(O=>O.presence_ref),g=w.map(O=>O.presence_ref),E=_.filter(O=>g.indexOf(O.presence_ref)<0),F=w.filter(O=>S.indexOf(O.presence_ref)<0);E.length>0&&(h[m]=E),F.length>0&&(f[m]=F)}else h[m]=_}),this.syncDiff(l,{joins:h,leaves:f},r,s)}static syncDiff(e,t,r,s){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(l,(h,f)=>{var m;const _=(m=e[h])!==null&&m!==void 0?m:[];if(e[h]=this.cloneDeep(f),_.length>0){const w=e[h].map(g=>g.presence_ref),S=_.filter(g=>w.indexOf(g.presence_ref)<0);e[h].unshift(...S)}r(h,_,f)}),this.map(u,(h,f)=>{let m=e[h];if(!m)return;const _=f.map(w=>w.presence_ref);m=m.filter(w=>_.indexOf(w.presence_ref)<0),e[h]=m,s(h,m,f),m.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vl;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(vl||(vl={}));var ki;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(ki||(ki={}));var $n;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})($n||($n={}));class Ha{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Mt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Js(this,mn.join,this.params,this.timeout),this.rejoinTimer=new Iu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Mt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Mt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mn.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new wi(this),this.broadcastEndpointURL=Su(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Mt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,f=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(S=>S.filter))!==null&&s!==void 0?s:[],m=!!this.bindings[ki.PRESENCE]&&this.bindings[ki.PRESENCE].length>0,_={},w={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(S=>e?.($n.CHANNEL_ERROR,S)),this._onClose(()=>e?.($n.CLOSED)),this.updateJoinPayload(Object.assign({config:w},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var g;if(this.socket.setAuth(),S===void 0){e?.($n.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,F=(g=E?.length)!==null&&g!==void 0?g:0,O=[];for(let B=0;B<F;B++){const q=E[B],{filter:{event:N,schema:K,table:Y,filter:D}}=q,W=S&&S[B];if(W&&W.event===N&&W.schema===K&&W.table===Y&&W.filter===D)O.push(Object.assign(Object.assign({},q),{id:W.id}));else{this.unsubscribe(),this.state=Mt.errored,e?.($n.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=O,e&&e($n.SUBSCRIBED);return}}).receive("error",S=>{this.state=Mt.errored,e?.($n.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.($n.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===Mt.joined&&e===ki.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=m.body)===null||s===void 0?void 0:s.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,f;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),m.receive("ok",()=>l("ok")),m.receive("error",()=>l("error")),m.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Mt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Js(this,mn.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Mt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,l=setTimeout(()=>s.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Js(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>sh){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,l;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:m,join:_}=mn;if(r&&[h,f,m,_].indexOf(u)>=0&&r!==this._joinRef())return;let S=this._onMessage(u,t,r);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var E,F,O;return((E=g.filter)===null||E===void 0?void 0:E.event)==="*"||((O=(F=g.filter)===null||F===void 0?void 0:F.event)===null||O===void 0?void 0:O.toLocaleLowerCase())===u}).map(g=>g.callback(S,r)):(l=this.bindings[u])===null||l===void 0||l.filter(g=>{var E,F,O,B,q,N;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in g){const K=g.id,Y=(E=g.filter)===null||E===void 0?void 0:E.event;return K&&((F=t.ids)===null||F===void 0?void 0:F.includes(K))&&(Y==="*"||Y?.toLocaleLowerCase()===((O=t.data)===null||O===void 0?void 0:O.type.toLocaleLowerCase()))}else{const K=(q=(B=g?.filter)===null||B===void 0?void 0:B.event)===null||q===void 0?void 0:q.toLocaleLowerCase();return K==="*"||K===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===u}).map(g=>{if(typeof S=="object"&&"ids"in S){const E=S.data,{schema:F,table:O,commit_timestamp:B,type:q,errors:N}=E;S=Object.assign(Object.assign({},{schema:F,table:O,commit_timestamp:B,eventType:q,new:{},old:{},errors:N}),this._getPayloadRecords(E))}g.callback(S,r)})}_isClosed(){return this.state===Mt.closed}_isJoined(){return this.state===Mt.joined}_isJoining(){return this.state===Mt.joining}_isLeaving(){return this.state===Mt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Ha.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(mn.close,{},e)}_onError(e){this._on(mn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Mt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=hl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=hl(e.columns,e.old_record)),t}}const pl=()=>{},ss={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},fh=[1e3,2e3,5e3,1e4],vh=1e4,ph=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class gh{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ga,this.transport=null,this.heartbeatIntervalMs=ss.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=pl,this.ref=0,this.reconnectTimer=null,this.logger=pl,this.conn=null,this.sendBuffer=[],this.serializer=new ah,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...u)=>ji(async()=>{const{default:h}=await Promise.resolve().then(()=>ai);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${_a.websocket}`,this.httpEndpoint=Su(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=eh.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:rh}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case bi.connecting:return pr.Connecting;case bi.open:return pr.Open;case bi.closing:return pr.Closing;default:return pr.Closed}}isConnected(){return this.connectionState()===pr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===r);if(s)return s;{const l=new Ha(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:s,ref:l}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${t} ${r} (${l})`,s),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ih,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ss.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:l,ref:u}=t,h=u?`(${u})`:"",f=l.status||"";this.log("receive",`${f} ${r} ${s} ${h}`.trim(),l),this.channels.filter(m=>m._isMember(r)).forEach(m=>m._trigger(s,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(mn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([ph],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:nh};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(mn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Iu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ss.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,l,u,h,f,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:ga,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:ss.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>fh[_-1]||vh),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((_,w)=>w(JSON.stringify(_))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class za extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Lt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class _h extends za{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ya extends za{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var mh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const Au=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:r}=await Promise.resolve().then(()=>ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},yh=()=>mh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ji(()=>Promise.resolve().then(()=>ai),void 0,import.meta.url)).Response:Response}),ba=n=>{if(Array.isArray(n))return n.map(t=>ba(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=ba(r)}),e},bh=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Sr=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const Xs=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),wh=(n,e,t)=>Sr(void 0,void 0,void 0,function*(){const r=yield yh();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{const l=n.status||500,u=s?.statusCode||l+"";e(new _h(Xs(s),l,u))}).catch(s=>{e(new ya(Xs(s),s))}):e(new ya(Xs(n),n))}),kh=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"||!r?s:(bh(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r)):s.body=r,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Ri(n,e,t,r,s,l){return Sr(this,void 0,void 0,function*(){return new Promise((u,h)=>{n(t,kh(e,r,s,l)).then(f=>{if(!f.ok)throw f;return r?.noResolveJson?f:f.json()}).then(f=>u(f)).catch(f=>wh(f,h,r))})})}function _s(n,e,t,r){return Sr(this,void 0,void 0,function*(){return Ri(n,"GET",e,t,r)})}function An(n,e,t,r,s){return Sr(this,void 0,void 0,function*(){return Ri(n,"POST",e,r,s,t)})}function wa(n,e,t,r,s){return Sr(this,void 0,void 0,function*(){return Ri(n,"PUT",e,r,s,t)})}function Ih(n,e,t,r){return Sr(this,void 0,void 0,function*(){return Ri(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Cu(n,e,t,r,s){return Sr(this,void 0,void 0,function*(){return Ri(n,"DELETE",e,r,s,t)})}var Jt=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const Eh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},gl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Sh{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Au(s)}uploadOrUpdate(e,t,r,s){return Jt(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},gl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f))):(l=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const m=this._removeEmptyFolders(t),_=this._getFinalPath(m),w=yield(e=="PUT"?wa:An)(this.fetch,`${this.url}/object/${_}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:m,id:w.Id,fullPath:w.Key},error:null}}catch(l){if(Lt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return Jt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Jt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let f;const m=Object.assign({upsert:gl.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&r instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",r)):typeof FormData<"u"&&r instanceof FormData?(f=r,f.append("cacheControl",m.cacheControl)):(f=r,_["cache-control"]=`max-age=${m.cacheControl}`,_["content-type"]=m.contentType);const w=yield wa(this.fetch,h.toString(),f,{headers:_});return{data:{path:l,fullPath:w.Key},error:null}}catch(f){if(Lt(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return Jt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield An(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new za("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(r){if(Lt(r))return{data:null,error:r};throw r}})}update(e,t,r){return Jt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Jt(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}copy(e,t,r){return Jt(this,void 0,void 0,function*(){try{return{data:{path:(yield An(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return Jt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield An(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Jt(this,void 0,void 0,function*(){try{const s=yield An(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}download(e,t){return Jt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield _s(this.fetch,`${this.url}/${s}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Lt(h))return{data:null,error:h};throw h}})}info(e){return Jt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield _s(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ba(r),error:null}}catch(r){if(Lt(r))return{data:null,error:r};throw r}})}exists(e){return Jt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ih(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Lt(r)&&r instanceof ya){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&s.push(f);let m=s.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${r}${m}`)}}}remove(e){return Jt(this,void 0,void 0,function*(){try{return{data:yield Cu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}list(e,t,r){return Jt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Eh),t),{prefix:e||""});return{data:yield An(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}listV2(e,t){return Jt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield An(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Lt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ah="2.11.0",Ch={"X-Client-Info":`storage-js/${Ah}`};var Dr=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Th{constructor(e,t={},r,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Ch),t),this.fetch=Au(r)}listBuckets(){return Dr(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Lt(e))return{data:null,error:e};throw e}})}getBucket(e){return Dr(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Dr(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Lt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Dr(this,void 0,void 0,function*(){try{return{data:yield wa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Lt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Dr(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Dr(this,void 0,void 0,function*(){try{return{data:yield Cu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}}class xh extends Th{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Sh(this.url,this.headers,e,this.fetch)}}const Ph="2.56.0";let mi="";typeof Deno<"u"?mi="deno":typeof document<"u"?mi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?mi="react-native":mi="node";const jh={"X-Client-Info":`supabase-js-${mi}/${Ph}`},Rh={headers:jh},Oh={schema:"public"},Mh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Lh={};var Dh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};const $h=n=>{let e;return n?e=n:typeof fetch>"u"?e=_u:e=fetch,(...t)=>e(...t)},Fh=()=>typeof Headers>"u"?mu:Headers,Uh=(n,e,t)=>{const r=$h(t),s=Fh();return(l,u)=>Dh(void 0,void 0,void 0,function*(){var h;const f=(h=yield e())!==null&&h!==void 0?h:n;let m=new s(u?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),r(l,Object.assign(Object.assign({},u),{headers:m}))})};var Nh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};function Bh(n){return n.endsWith("/")?n:n+"/"}function Wh(n,e){var t,r;const{db:s,auth:l,realtime:u,global:h}=n,{db:f,auth:m,realtime:_,global:w}=e,S={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},m),l),realtime:Object.assign(Object.assign({},_),u),storage:{},global:Object.assign(Object.assign(Object.assign({},w),h),{headers:Object.assign(Object.assign({},(t=w?.headers)!==null&&t!==void 0?t:{}),(r=h?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Nh(this,void 0,void 0,function*(){return""})};return n.accessToken?S.accessToken=n.accessToken:delete S.accessToken,S}const Tu="2.71.1",Wr=30*1e3,ka=3,Qs=ka*Wr,Vh="http://localhost:9999",qh="supabase.auth.token",Hh={"X-Client-Info":`gotrue-js/${Tu}`},Ia="X-Supabase-Api-Version",xu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},zh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Gh=600*1e3;class Ga extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function He(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Kh extends Ga{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Yh(n){return He(n)&&n.name==="AuthApiError"}class Pu extends Ga{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class nr extends Ga{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class zn extends nr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Jh(n){return He(n)&&n.name==="AuthSessionMissingError"}class as extends nr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class os extends nr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ls extends nr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Xh(n){return He(n)&&n.name==="AuthImplicitGrantRedirectError"}class _l extends nr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ea extends nr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Zs(n){return He(n)&&n.name==="AuthRetryableFetchError"}class ml extends nr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Sa extends nr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),yl=` 	
\r=`.split(""),Qh=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<yl.length;e+=1)n[yl[e].charCodeAt(0)]=-2;for(let e=0;e<ms.length;e+=1)n[ms[e].charCodeAt(0)]=e;return n})();function bl(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ms[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(ms[r]),e.queuedBits-=6}}function ju(n,e,t){const r=Qh[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function wl(n){const e=[],t=u=>{e.push(String.fromCodePoint(u))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=u=>{tf(u,r,t)};for(let u=0;u<n.length;u+=1)ju(n.charCodeAt(u),s,l);return e.join("")}function Zh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function ef(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Zh(r,e)}}function tf(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function nf(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)ju(n.charCodeAt(s),t,r);return new Uint8Array(e)}function rf(n){const e=[];return ef(n,t=>e.push(t)),new Uint8Array(e)}function sf(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>bl(s,t,r)),bl(null,t,r),e.join("")}function af(n){return Math.round(Date.now()/1e3)+n}function of(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const gn=()=>typeof window<"u"&&typeof document<"u",ur={tested:!1,writable:!1},Ru=()=>{if(!gn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ur.tested)return ur.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ur.tested=!0,ur.writable=!0}catch{ur.tested=!0,ur.writable=!1}return ur.writable};function lf(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Ou=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:r}=await Promise.resolve().then(()=>ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},uf=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Vr=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},cr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Hn=async(n,e)=>{await n.removeItem(e)};class Cs{constructor(){this.promise=new Cs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Cs.promiseConstructor=Promise;function ea(n){const e=n.split(".");if(e.length!==3)throw new Sa("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!zh.test(e[r]))throw new Sa("JWT not in base64url format");return{header:JSON.parse(wl(e[0])),payload:JSON.parse(wl(e[1])),signature:nf(e[2]),raw:{header:e[0],payload:e[1]}}}async function cf(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function df(n,e){return new Promise((r,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await n(l);if(!e(l,null,u)){r(u);return}}catch(u){if(!e(l,u)){s(u);return}}})()})}function hf(n){return("0"+n.toString(16)).substr(-2)}function ff(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,hf).join("")}async function vf(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function pf(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await vf(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function $r(n,e,t=!1){const r=ff();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Vr(n,`${e}-code-verifier`,s);const l=await pf(r);return[l,r===l?"plain":"s256"]}const gf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function _f(n){const e=n.headers.get(Ia);if(!e||!e.match(gf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function mf(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function yf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const bf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Fr(n){if(!bf.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ta(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function kl(n){return JSON.parse(JSON.stringify(n))}var wf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const fr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),kf=[502,503,504];async function Il(n){var e;if(!uf(n))throw new Ea(fr(n),0);if(kf.includes(n.status))throw new Ea(fr(n),n.status);let t;try{t=await n.json()}catch(l){throw new Pu(fr(l),l)}let r;const s=_f(n);if(s&&s.getTime()>=xu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new ml(fr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new zn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new ml(fr(t),n.status,t.weak_password.reasons);throw new Kh(fr(t),n.status||500,r)}const If=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function rt(n,e,t,r){var s;const l=Object.assign({},r?.headers);l[Ia]||(l[Ia]=xu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const u=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await Ef(n,e,t+h,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(f):{data:Object.assign({},f),error:null}}async function Ef(n,e,t,r,s,l){const u=If(e,r,s,l);let h;try{h=await n(t,Object.assign({},u))}catch(f){throw console.error(f),new Ea(fr(f),0)}if(h.ok||await Il(h),r?.noResolveJson)return h;try{return await h.json()}catch(f){await Il(f)}}function Dn(n){var e;let t=null;Tf(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=af(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function El(n){const e=Dn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Kn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Sf(n){return{data:n,error:null}}function Af(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l}=n,u=wf(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function Cf(n){return n}function Tf(n){return n.access_token&&n.refresh_token&&n.expires_in}const na=["global","local","others"];var xf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Pf{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ou(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=na[0]){if(na.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${na.join(", ")}`);try{return await rt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(He(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await rt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Kn})}catch(r){if(He(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=xf(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await rt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Af,redirectTo:t?.redirectTo})}catch(t){if(He(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await rt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Kn})}catch(t){if(He(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,l,u,h,f;try{const m={nextPage:null,lastPage:0,total:0},_=await rt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:Cf});if(_.error)throw _.error;const w=await _.json(),S=(u=_.headers.get("x-total-count"))!==null&&u!==void 0?u:0,g=(f=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return g.length>0&&(g.forEach(E=>{const F=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(E.split(";")[1].split("=")[1]);m[`${O}Page`]=F}),m.total=parseInt(S)),{data:Object.assign(Object.assign({},w),m),error:null}}catch(m){if(He(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){Fr(e);try{return await rt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Kn})}catch(t){if(He(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Fr(e);try{return await rt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Kn})}catch(r){if(He(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Fr(e);try{return await rt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Kn})}catch(r){if(He(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Fr(e.userId);try{const{data:t,error:r}=await rt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(He(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Fr(e.userId),Fr(e.id);try{return{data:await rt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(He(t))return{data:null,error:t};throw t}}}function Sl(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function jf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ur={debug:!!(globalThis&&Ru()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Mu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Rf extends Mu{}async function Of(n,e,t){Ur.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ur.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Ur.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Ur.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Ur.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Rf(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Ur.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}jf();const Mf={url:Vh,storageKey:qh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Hh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Al(n,e,t){return await t()}const Nr={};class Ai{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ai.nextInstanceID,Ai.nextInstanceID+=1,this.instanceID>0&&gn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Mf),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Pf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ou(s.fetch),this.lock=s.lock||Al,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:gn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Of:this.lock=Al,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Ru()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Sl(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Sl(this.memoryStorage)),gn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Nr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Nr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Tu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=lf(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),gn()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Xh(l)){const f=(e=l.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return He(t)?{error:t}:{error:new Pu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Dn}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(He(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,s;try{let l;if("email"in e){const{email:_,password:w,options:S}=e;let g=null,E=null;this.flowType==="pkce"&&([g,E]=await $r(this.storage,this.storageKey)),l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:_,password:w,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:g,code_challenge_method:E},xform:Dn})}else if("phone"in e){const{phone:_,password:w,options:S}=e;l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:w,data:(r=S?.data)!==null&&r!==void 0?r:{},channel:(s=S?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Dn})}else throw new os("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(He(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:El})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:El})}else throw new os("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new as}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(He(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,l,u,h,f,m,_,w,S,g;let E,F;if("message"in e)E=e.message,F=e.signature;else{const{chain:O,wallet:B,statement:q,options:N}=e;let K;if(gn())if(typeof B=="object")K=B;else{const D=window;if("solana"in D&&typeof D.solana=="object"&&("signIn"in D.solana&&typeof D.solana.signIn=="function"||"signMessage"in D.solana&&typeof D.solana.signMessage=="function"))K=D.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof B!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=B}const Y=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in K&&K.signIn){const D=await K.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:Y.host,uri:Y.href}),q?{statement:q}:null));let W;if(Array.isArray(D)&&D[0]&&typeof D[0]=="object")W=D[0];else if(D&&typeof D=="object"&&"signedMessage"in D&&"signature"in D)W=D;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in W&&"signature"in W&&(typeof W.signedMessage=="string"||W.signedMessage instanceof Uint8Array)&&W.signature instanceof Uint8Array)E=typeof W.signedMessage=="string"?W.signedMessage:new TextDecoder().decode(W.signedMessage),F=W.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in K)||typeof K.signMessage!="function"||!("publicKey"in K)||typeof K!="object"||!K.publicKey||!("toBase58"in K.publicKey)||typeof K.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${Y.host} wants you to sign in with your Solana account:`,K.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${Y.href}`,`Issued At: ${(s=(r=N?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=N?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((u=N?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((f=N?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((m=N?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((w=(_=N?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||w===void 0)&&w.length?["Resources",...N.signInWithSolana.resources.map(W=>`- ${W}`)]:[]].join(`
`);const D=await K.signMessage(new TextEncoder().encode(E),"utf8");if(!D||!(D instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");F=D}}try{const{data:O,error:B}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:sf(F)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Dn});if(B)throw B;return!O||!O.session||!O.user?{data:{user:null,session:null},error:new as}:(O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),{data:Object.assign({},O),error:B})}catch(O){if(He(O))return{data:{user:null,session:null},error:O};throw O}}async _exchangeCodeForSession(e){const t=await cr(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:l,error:u}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Dn});if(await Hn(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new as}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:u})}catch(l){if(He(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:l,nonce:u}=e,h=await rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Dn}),{data:f,error:m}=h;return m?{data:{user:null,session:null},error:m}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new as}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:m})}catch(t){if(He(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,l,u;try{if("email"in e){const{email:h,options:f}=e;let m=null,_=null;this.flowType==="pkce"&&([m,_]=await $r(this.storage,this.storageKey));const{error:w}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(r=f?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:_},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:h,options:f}=e,{data:m,error:_}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:_}}throw new os("You must provide either an email or phone number.")}catch(h){if(He(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,r;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:h}=await rt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Dn});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,m=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(s){if(He(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await $r(this.storage,this.storageKey)),await rt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Sf})}catch(l){if(He(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new zn;const{error:s}=await rt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(He(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:l}=e,{error:u}=await rt(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:s,options:l}=e,{data:u,error:h}=await rt(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new os("You must provide either an email or phone number and a type")}catch(t){if(He(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await cr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Qs:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const u=await cr(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ta()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,m,_)=>(!u&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,m,_))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Kn}):await this._useSession(async t=>{var r,s,l;const{data:u,error:h}=t;if(h)throw h;return!(!((r=u.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new zn}:await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:Kn})})}catch(t){if(He(t))return Jh(t)&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:l}=r;if(l)throw l;if(!s.session)throw new zn;const u=s.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await $r(this.storage,this.storageKey));const{data:m,error:_}=await rt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:Kn});if(_)throw _;return u.user=m.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(He(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zn;const t=Date.now()/1e3;let r=t,s=!0,l=null;const{payload:u}=ea(e.access_token);if(u.exp&&(r=u.exp,s=r<=t),s){const{session:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)throw f;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(He(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new zn;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(He(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!gn())throw new ls("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ls(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new _l("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ls("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new _l("No code detected.");const{data:q,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:l,refresh_token:u,expires_in:h,expires_at:f,token_type:m}=e;if(!l||!h||!u||!m)throw new ls("No session defined in URL");const _=Math.round(Date.now()/1e3),w=parseInt(h);let S=_+w;f&&(S=parseInt(f));const g=S-_;g*1e3<=Wr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${w}s`);const E=S-w;_-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,S,_):_-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,S,_);const{data:F,error:O}=await this._getUser(l);if(O)throw O;const B={provider_token:r,provider_refresh_token:s,access_token:l,expires_in:w,expires_at:S,refresh_token:u,token_type:m,user:F.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:B,redirectType:e.type},error:null}}catch(r){if(He(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await cr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{error:l};const u=(r=s.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Yh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=of(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:l},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await $r(this.storage,this.storageKey,!0));try{return await rt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(He(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(He(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async l=>{var u,h,f,m,_;const{data:w,error:S}=l;if(S)throw S;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await rt(this.fetch,"GET",g,{headers:this.headers,jwt:(_=(m=w.session)===null||m===void 0?void 0:m.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return gn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(He(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)throw u;return await rt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(He(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await df(async s=>(s>0&&await cf(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await rt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Dn})),(s,l)=>{const u=200*Math.pow(2,s);return l&&Zs(l)&&Date.now()+u-r<Wr})}catch(r){if(this._debug(t,"error",r),He(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),gn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await cr(this.storage,this.storageKey);if(s&&this.userStorage){let u=await cr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:s.user},await Vr(this.userStorage,this.storageKey+"-user",u)),s.user=(e=u?.user)!==null&&e!==void 0?e:ta()}else if(s&&!s.user&&!s.user){const u=await cr(this.storage,this.storageKey+"-user");u&&u?.user?(s.user=u.user,await Hn(this.storage,this.storageKey+"-user"),await Vr(this.storage,this.storageKey,s)):s.user=ta()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qs;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${Qs}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:u}=await this._callRefreshToken(s.refresh_token);u&&(console.error(u),Zs(u)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(s.access_token);!h&&u?.user?(s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(r,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new zn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Cs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new zn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),He(l)){const u={session:null,error:l};return Zs(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(f){l.push(f)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Vr(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=kl(s);await Vr(this.storage,this.storageKey,l)}else{const s=kl(t);await Vr(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Hn(this.storage,this.storageKey),await Hn(this.storage,this.storageKey+"-code-verifier"),await Hn(this.storage,this.storageKey+"-user"),this.userStorage&&await Hn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&gn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Wr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Wr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Wr}ms, refresh threshold is ${ka} ticks`),s<=ka&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Mu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!gn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,u]=await $r(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});s.push(h.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);s.push(l.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await rt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(He(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:m}=await rt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((s=f?.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(He(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await rt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(He(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await rt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(He(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=r.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:r,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ea(s.access_token);let h=null;u.aal&&(h=u.aal);let f=h;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");const _=u.amr||[];return{data:{currentLevel:h,nextLevel:f,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(h=>h.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(h=>h.kid===e),r&&this.jwks_cached_at+Gh>s)return r;const{data:l,error:u}=await rt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,r=l.keys.find(h=>h.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:E}=await this.getSession();if(E||!g.session)return{data:null,error:E};r=g.session.access_token}const{header:s,payload:l,signature:u,raw:{header:h,payload:f}}=ea(r);t?.allowExpired||mf(l.exp);const m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:l,header:s,signature:u},error:null}}const _=yf(s.alg),w=await crypto.subtle.importKey("jwk",m,_,!0,["verify"]);if(!await crypto.subtle.verify(_,w,u,rf(`${h}.${f}`)))throw new Sa("Invalid JWT signature");return{data:{claims:l,header:s,signature:u},error:null}}catch(r){if(He(r))return{data:null,error:r};throw r}}}Ai.nextInstanceID=0;const Lf=Ai;class Df extends Lf{constructor(e){super(e)}}var $f=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(r.next(_))}catch(w){u(w)}}function f(_){try{m(r.throw(_))}catch(w){u(w)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((r=r.apply(n,e||[])).next())})};class Ff{constructor(e,t,r){var s,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Bh(e),f=new URL(h);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const m=`sb-${f.hostname.split(".")[0]}-auth-token`,_={db:Oh,realtime:Lh,auth:Object.assign(Object.assign({},Mh),{storageKey:m}),global:Rh},w=Wh(r??{},_);this.storageKey=(s=w.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=w.global.headers)!==null&&l!==void 0?l:{},w.accessToken?(this.accessToken=w.accessToken,this.auth=new Proxy({},{get:(S,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=w.auth)!==null&&u!==void 0?u:{},this.headers,w.global.fetch),this.fetch=Uh(t,this._getAccessToken.bind(this),w.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},w.realtime)),this.rest=new Zd(new URL("rest/v1",f).href,{headers:this.headers,schema:w.db.schema,fetch:this.fetch}),this.storage=new xh(this.storageUrl.href,this.headers,this.fetch,r?.storage),w.accessToken||this._listenForAuthEvents()}get functions(){return new Bd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return $f(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:l,flowType:u,lock:h,debug:f},m,_){const w={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Df({url:this.authUrl.href,headers:Object.assign(Object.assign({},w),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:u,lock:h,debug:f,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new gh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Uf=(n,e,t)=>new Ff(n,e,t);function Nf(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Nf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Bf="https://vycjpmuyscfygstjjied.supabase.co",Wf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Cn=Uf(Bf,Wf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Qn={async loadStoriesList(){if(!L.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${L.selectedBucket}`);const n=`${L.selectedBucket}_story.json`,{data:e,error:t}=await Cn.storage.from(L.selectedBucket).list("",{search:n});console.log(`[ResourceStore] Проверка файла ${n}:`,{files:e,error:t}),!t&&e&&e.some(r=>r.name===n)?(L.storiesList=[n],console.log(`[ResourceStore] Найден файл: ${n}`)):(L.storiesList=[],console.warn(`[ResourceStore] Файл ${n} не найден`))},async loadStoredResources(){if(!L.selectedBucket){console.warn("No bucket selected");return}const{data:n}=await Cn.storage.from(L.selectedBucket).list();n&&(L.storedFiles=n.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(n){const e=n.target;if(!e.files||e.files.length===0)return;if(!L.selectedBucket){gt.setStatus("error","Не выбрана история");return}const t=e.files[0];gt.setStatus("loading","Загрузка файла...");const r=await t.arrayBuffer(),s=new Uint8Array(r),{error:l}=await Cn.storage.from(L.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?gt.setStatus("error","Ошибка загрузки"):(gt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(n){if(!L.selectedBucket){gt.setStatus("error","Не выбрана история");return}const{error:e}=await Cn.storage.from(L.selectedBucket).remove([n]);e?gt.setStatus("error","Ошибка удаления файла"):(gt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Vf(n){return n.dialogues&&n.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),n.chapters||(n.chapters=[{id:"main",title:"Основная история",description:""}],n.dialogues&&n.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),n.chapters&&n.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),n.items||(n.items=[]),n.meta||(n.meta={version:"3.1",title:n.title||"Untitled"}),n.miniGames&&Array.isArray(n.miniGames)&&(n.miniGames=n.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),n}function qf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const gr={async createNewStory(){if(!L.selectedBucket){gt.setStatus("error","Не выбрана история (bucket)");return}const n=prompt("Введите имя файла истории:","new_story.json");if(!n)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await Cn.storage.from(L.selectedBucket).upload(n,s,{contentType:"application/json"});l?gt.setStatus("error","Ошибка создания: "+l.message):(await Qn.loadStoriesList(),await this.loadStory(n))},async loadStory(n){if(!L.selectedBucket){gt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${n} из bucket: ${L.selectedBucket}`),gt.setStatus("loading","Загрузка..."),L.currentFileName=n;try{const{data:e,error:t}=await Cn.storage.from(L.selectedBucket).download(n);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let r;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Cn.storage.from(L.selectedBucket).getPublicUrl(n).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);r=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${r.length}`)}else r=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${r.length}`);let s=JSON.parse(r);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Vf(s),console.log("[StoryStore] Присваиваем данные в editor.data"),L.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:L.data.chapters?.length,dialogues:L.data.dialogues?.length}),L.data.chapters&&L.data.chapters.length>0&&(L.selectedChapterId=L.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${L.selectedChapterId}`)),L.data.dialogues&&L.data.dialogues.length>0&&(L.selectedDialogueId=L.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${L.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),gt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),gt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!L.data)return;if(!L.selectedBucket){gt.setStatus("error","Не выбрана история (bucket)");return}gt.setStatus("loading","Сохранение...");const n=JSON.stringify(L.data,null,2);console.log(`[StoryStore] Сохранение файла: ${L.currentFileName}, размер: ${n.length} байт`);const t=new TextEncoder().encode(n),{error:r}=await Cn.storage.from(L.selectedBucket).update(L.currentFileName,t,{contentType:"application/json"});if(r){console.error("[StoryStore] Ошибка сохранения (update):",r),console.log("[StoryStore] Пробуем upload вместо update");const s=await Cn.storage.from(L.selectedBucket).upload(L.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),gt.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),gt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),gt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!L.data)return;if(!L.selectedBucket){gt.setStatus("error","Не выбрана история (bucket)");return}const n=L.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${n}_copy_${e}.json`.trim();const r=prompt("Введите имя для копии:",t);if(!r)return;t=r.trim(),t.endsWith(".json")||(t+=".json"),gt.setStatus("loading","Создание копии...");const s=JSON.stringify(L.data,null,2),u=new TextEncoder().encode(s),{error:h}=await Cn.storage.from(L.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?gt.setStatus("error",`Ошибка копии: ${h.message}`):(await Qn.loadStoriesList(),gt.setStatus("success","Копия сохранена!"))},addChapter(){if(!L.data||!L.data.chapters)return;const n="ch_"+Date.now();L.data.chapters.push({id:n,title:"Новая глава",description:""}),L.selectedChapterId=n,console.log(`[StoryStore] Создана новая глава: ${n}`)},addDialogue(){if(!L.data||!L.selectedChapterId)return;const n="d_"+Date.now();L.data.dialogues.push({id:n,chapterId:L.selectedChapterId,text:"Новый текст...",options:[]}),L.selectedDialogueId=n},deleteDialogue(n){confirm("Удалить диалог "+n+"?")&&L.data&&(L.data.dialogues=L.data.dialogues.filter(e=>e.id!==n),L.data.dialogues.forEach(e=>{e.nextDialogueId===n&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===n&&(t.nextDialogueId="")})}),L.selectedDialogueId===n&&(L.selectedDialogueId=null))},jumpTo(n){const e=L.data?.dialogues.find(t=>t.id===n);e&&(L.selectedChapterId=e.chapterId,L.selectedDialogueId=n)},getLinkType(n,e){return n.nextDialogueId===e?"Auto":"Option"}};var Qt=tr(()=>Nt);function Hf(){gt.selectEditingChapter(null)}var zf=ee('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function Gf(n,e){Bt(e,!1);function t(){Qt().currentEditingChapter&&(gt.updateChapter(Qt().currentEditingChapter.id,{title:Qt().currentEditingChapter.title,description:Qt().currentEditingChapter.description}),gt.selectEditingChapter(null))}function r(){Qt().currentEditingChapter&&confirm(`Удалить главу "${Qt().currentEditingChapter.title}"?`)&&(gt.deleteChapter(Qt().currentEditingChapter.id),gt.selectEditingChapter(null))}er();var s=Kt(),l=jt(s);{var u=h=>{var f=zf(),m=C(f),_=j(C(m),2),w=C(_);w.__click=r;var S=j(m,2),g=j(C(S),2),E=j(S,2),F=j(C(E),2),O=j(E,2),B=C(O);B.__click=[Hf];var q=j(B,2);q.__click=t,Fn(g,()=>Qt().currentEditingChapter.title,N=>Qt(Qt().currentEditingChapter.title=N)),Fn(F,()=>Qt().currentEditingChapter.description,N=>Qt(Qt().currentEditingChapter.description=N)),z(h,f)};xe(l,h=>{Qt().currentEditingChapter&&h(u)})}z(n,s),Wt()}Yt(["click"]);var Zt=tr(()=>L),Kf=(n,e,t)=>e(y(t).id),Yf=ee('<div class="chapter-form-container svelte-xp6igx"><!></div>'),Jf=ee('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),Xf=ee('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),Qf=ee("<div> </div>"),Zf=ee('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function ev(n,e){Bt(e,!1);function t(B){gt.selectEditingChapter(B)}er();var r=Zf(),s=C(r),l=C(s),u=j(C(l),2);u.__click=function(...B){gr.addChapter?.apply(this,B)};var h=j(l,2);kt(h,5,()=>Zt().data?.chapters||[],B=>B.id,(B,q)=>{var N=Jf(),K=jt(N),Y=C(K);let D;Y.__click=()=>Zt(Zt().selectedChapterId=y(q).id);var W=C(Y),re=C(W),Z=j(Y,2);Z.__click=[Kf,t,q];var be=j(K,2);{var ue=X=>{var we=Yf(),Me=C(we);Gf(Me,{}),z(X,we)};xe(be,X=>{Zt().editingChapterId===y(q).id&&X(ue)})}Ee(X=>{D=qt(Y,1,"chapter-item svelte-xp6igx",null,D,X),Oe(Y,"aria-pressed",Zt().selectedChapterId===y(q).id),Oe(Y,"title",y(q).description||"Без описания"),Ae(re,y(q).title)},[()=>({active:Zt().selectedChapterId===y(q).id})]),z(B,N)});var f=j(s,2),m=C(f),_=C(m),w=C(_),S=j(_,2);S.__click=function(...B){gr.addDialogue?.apply(this,B)};var g=j(m,2);kt(g,5,()=>Nt.chapterDialogues,B=>B.id,(B,q)=>{var N=Xf();let K;N.__click=()=>Zt(Zt().selectedDialogueId=y(q).id);var Y=C(N),D=C(Y),W=j(Y,2),re=C(W);Ee((Z,be)=>{K=qt(N,1,"dialogue-item svelte-xp6igx",null,K,Z),Oe(N,"aria-pressed",Zt().selectedDialogueId===y(q).id),Ae(D,y(q).id),Ae(re,`${be??""}...`)},[()=>({active:Zt().selectedDialogueId===y(q).id}),()=>y(q).text.substring(0,25)]),z(B,N)});var E=j(f,2),F=C(E);{var O=B=>{var q=Qf(),N=C(q);Ee(()=>{qt(q,1,`alert ${Zt().statusMessage.type??""}`,"svelte-xp6igx"),Ae(N,Zt().statusMessage.text)}),z(B,q)};xe(F,B=>{Zt().statusMessage.text&&B(O)})}Ee(()=>{Ae(w,`Сцены (${Nt.chapterDialogues.length??""})`),S.disabled=!Zt().selectedChapterId}),z(n,r),Wt()}Yt(["click"]);var tv=ee("<option> </option>"),nv=(n,e)=>e(n.target.checked),rv=(n,e)=>e("id",n.target.value),iv=(n,e)=>e("onWinDialogueId",n.target.value),sv=ee("<option> </option>"),av=(n,e)=>e("onLoseDialogueId",n.target.value),ov=ee("<option> </option>"),lv=(n,e)=>e("rewardItem",n.target.value),uv=ee("<option> </option>"),cv=ee('<div class="minigame-details svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option></select></div> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-92kmf5"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-92kmf5"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),dv=(n,e)=>{const t=n.target.value;e({type:t})},hv=ee("<option> </option>"),fv=(n,e)=>e({itemId:n.target.value}),vv=ee("<option> </option>"),pv=ee('<div class="form-group full-width svelte-92kmf5"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),gv=(n,e)=>e({statName:n.target.value}),_v=(n,e)=>e({statValue:parseInt(n.target.value)||0}),mv=ee('<div class="form-group svelte-92kmf5"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-92kmf5"><label>Значение ></label> <input type="number" class="input"/></div>',1),yv=(n,e)=>e({flagName:n.target.value}),bv=ee('<div class="form-group full-width svelte-92kmf5"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),wv=ee('<div class="option-details svelte-92kmf5"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-92kmf5"><div class="section-header svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-92kmf5"><div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-92kmf5">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-92kmf5">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-92kmf5"><h5 class="svelte-92kmf5">Условие видимости</h5> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function kv(n,e){Bt(e,!0);const t=yn(e,"option",7);function r(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return r(),t().visibilityCondition}function l(he){r(),t().visibilityCondition={...t().visibilityCondition,...he}}const u=cn(()=>!!t().miniGame);function h(he){he?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function f(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function m(he,fe){const oe=f();oe&&(oe[he]=fe)}var _=wv(),w=C(_),S=C(w),g=j(S,2),E=j(w,2),F=C(E),O=j(F,2),B=C(O);B.value=B.__value="";var q=j(B);kt(q,17,()=>e.dialogues,he=>he.id,(he,fe)=>{var oe=tv(),ie=C(oe),Te={};Ee(De=>{Ae(ie,`${y(fe).id??""}: ${De??""}...`),Te!==(Te=y(fe).id)&&(oe.value=(oe.__value=y(fe).id)??"")},[()=>y(fe).text.substring(0,30)]),z(he,oe)});var N=j(E,2),K=C(N),Y=C(K),D=C(Y);D.__change=[nv,h];var W=j(K,2);{var re=he=>{var fe=cv(),oe=C(fe),ie=C(oe),Te=j(ie,2);Te.__change=[rv,m];var De=C(Te);De.value=De.__value="";var et=j(De);et.value=et.__value="onet_monsters";var Xe=j(et);Xe.value=Xe.__value="memo_monsters";var se;hr(Te);var ge=j(oe,2),Ce=C(ge),tt=C(Ce),at=j(tt,2);at.__change=[iv,m];var Tt=C(at);Tt.value=Tt.__value="";var xt=j(Tt);kt(xt,17,()=>e.dialogues,de=>de.id,(de,_e)=>{var Ue=sv(),vt=C(Ue),Fe={};Ee(mt=>{Ae(vt,`${y(_e).id??""}: ${mt??""}...`),Fe!==(Fe=y(_e).id)&&(Ue.value=(Ue.__value=y(_e).id)??"")},[()=>y(_e).text.substring(0,30)]),z(de,Ue)});var nt;hr(at);var p=j(Ce,2),o=C(p),d=j(o,2);d.__change=[av,m];var k=C(d);k.value=k.__value="";var P=j(k);kt(P,17,()=>e.dialogues,de=>de.id,(de,_e)=>{var Ue=ov(),vt=C(Ue),Fe={};Ee(mt=>{Ae(vt,`${y(_e).id??""}: ${mt??""}...`),Fe!==(Fe=y(_e).id)&&(Ue.value=(Ue.__value=y(_e).id)??"")},[()=>y(_e).text.substring(0,30)]),z(de,Ue)});var A;hr(d);var T=j(ge,2),U=C(T),H=j(U,2);H.__change=[lv,m];var G=C(H);G.value=G.__value="";var le=j(G);kt(le,17,()=>e.availableItems,de=>de.id,(de,_e)=>{var Ue=uv(),vt=C(Ue),Fe={};Ee(()=>{Ae(vt,y(_e).name),Fe!==(Fe=y(_e).id)&&(Ue.value=(Ue.__value=y(_e).id)??"")}),z(de,Ue)});var ve;hr(H),Ee((de,_e,Ue,vt)=>{Oe(ie,"for",`option-mg-id-${e.index??""}`),Oe(Te,"id",`option-mg-id-${e.index??""}`),se!==(se=de)&&(Te.value=(Te.__value=de)??"",Gn(Te,de)),Oe(tt,"for",`option-mg-win-${e.index??""}`),Oe(at,"id",`option-mg-win-${e.index??""}`),nt!==(nt=_e)&&(at.value=(at.__value=_e)??"",Gn(at,_e)),Oe(o,"for",`option-mg-lose-${e.index??""}`),Oe(d,"id",`option-mg-lose-${e.index??""}`),A!==(A=Ue)&&(d.value=(d.__value=Ue)??"",Gn(d,Ue)),Oe(U,"for",`option-mg-reward-${e.index??""}`),Oe(H,"id",`option-mg-reward-${e.index??""}`),ve!==(ve=vt)&&(H.value=(H.__value=vt)??"",Gn(H,vt))},[()=>f().id,()=>f().onWinDialogueId,()=>f().onLoseDialogueId,()=>f().rewardItem||""]),z(he,fe)};xe(W,he=>{f()&&he(re)})}var Z=j(N,2),be=C(Z),ue=C(be),X=C(ue),we=j(be,2),Me=C(we),ce=C(Me),$e=j(Z,2),ye=j(C($e),2),ze=C(ye),Ve=C(ze),je=j(Ve,2);je.__change=[dv,l],kt(je,20,()=>e.conditionTypes,he=>he,(he,fe)=>{var oe=hv(),ie=C(oe),Te={};Ee(()=>{Ae(ie,fe),Te!==(Te=fe)&&(oe.value=(oe.__value=fe)??"")}),z(he,oe)});var Ne;hr(je);var Je=j(ze,2);{var Pe=he=>{var fe=pv(),oe=C(fe),ie=j(oe,2);ie.__change=[fv,l];var Te=C(ie);Te.value=Te.__value="";var De=j(Te);kt(De,17,()=>e.availableItems,Xe=>Xe.id,(Xe,se)=>{var ge=vv(),Ce=C(ge),tt={};Ee(()=>{Ae(Ce,y(se).name),tt!==(tt=y(se).id)&&(ge.value=(ge.__value=y(se).id)??"")}),z(Xe,ge)});var et;hr(ie),Ee(Xe=>{Oe(oe,"for",`option-cond-item-${e.index??""}`),Oe(ie,"id",`option-cond-item-${e.index??""}`),et!==(et=Xe)&&(ie.value=(ie.__value=Xe)??"",Gn(ie,Xe))},[()=>s().itemId||""]),z(he,fe)};xe(Je,he=>{s().type==="has_item"&&he(Pe)})}var Le=j(Je,2);{var ct=he=>{var fe=mv(),oe=jt(fe),ie=C(oe),Te=j(ie,2);Te.__input=[gv,l];var De=j(oe,2),et=C(De),Xe=j(et,2);Xe.__input=[_v,l],Ee((se,ge)=>{Oe(ie,"for",`option-cond-stat-${e.index??""}`),Oe(Te,"id",`option-cond-stat-${e.index??""}`),Gs(Te,se),Oe(et,"for",`option-cond-stat-val-${e.index??""}`),Oe(Xe,"id",`option-cond-stat-val-${e.index??""}`),Gs(Xe,ge)},[()=>s().statName||"",()=>s().statValue||""]),z(he,fe)};xe(Le,he=>{s().type==="stat_greater"&&he(ct)})}var Be=j(Le,2);{var yt=he=>{var fe=bv(),oe=C(fe),ie=j(oe,2);ie.__input=[yv,l],Ee(Te=>{Oe(oe,"for",`option-cond-flag-${e.index??""}`),Oe(ie,"id",`option-cond-flag-${e.index??""}`),Gs(ie,Te)},[()=>s().flagName||""]),z(he,fe)};xe(Be,he=>{s().type==="flag_true"&&he(yt)})}Ee(he=>{Oe(S,"for",`option-text-${e.index??""}`),Oe(g,"id",`option-text-${e.index??""}`),Oe(F,"for",`option-next-${e.index??""}`),Oe(O,"id",`option-next-${e.index??""}`),Pd(D,y(u)),Oe(Ve,"for",`option-cond-type-${e.index??""}`),Oe(je,"id",`option-cond-type-${e.index??""}`),Ne!==(Ne=he)&&(je.value=(je.__value=he)??"",Gn(je,he))},[()=>s().type]),Fn(g,()=>t().text,he=>t().text=he),qr(O,()=>t().nextDialogueId,he=>t().nextDialogueId=he),Zo(X,()=>t().enabled,he=>t().enabled=he),Zo(ce,()=>t().visible,he=>t().visible=he),z(n,_),Wt()}Yt(["change","input"]);var Et=tr(()=>L),ht=tr(()=>Nt),Iv=ee("<option> <!></option>"),Ev=ee("<option> </option>"),Sv=ee("<option> </option>"),Av=ee("<option> </option>"),Cv=ee("<option> </option>"),Tv=ee('<div class="option-content svelte-1de8com"><!></div>'),xv=ee('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Pv=ee("<option> </option>"),jv=ee('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-chapter" class="svelte-1de8com">Глава</label> <select id="dialogue-chapter" class="input select svelte-1de8com"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),Rv=ee('<div class="empty-state">Выберите сцену</div>');function Ov(n,e){Bt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function r(_){_.options||(_.options=[]);const w=qf();_.options.push(w),Et(Et().editingOptionIndex=_.options.length-1)}function s(_){if(Et().editingOptionIndex===_)Et(Et().editingOptionIndex=null);else{Et(Et().editingOptionIndex=_);const w=ht().currentDialogue?.options?.[_];w&&!w.visibilityCondition&&(w.visibilityCondition={type:"always"})}}function l(_,w){confirm("Удалить вариант ответа?")&&(_.options?.splice(w,1),Et().editingOptionIndex===w?Et(Et().editingOptionIndex=null):Et().editingOptionIndex&&Et().editingOptionIndex>w&&Et(Et().editingOptionIndex--))}er();var u=Kt(),h=jt(u);{var f=_=>{var w=jv(),S=C(w),g=j(C(S),2);g.__change=fe=>Et(Et().selectedDialogueId=fe.target?.value);var E=j(S,2),F=j(C(E),2);Ee(()=>{ht(),_n(()=>{Et()})}),F.__change=fe=>Et(Et().selectedChapterId=fe.target?.value);var O=C(F);O.value=O.__value="";var B=j(O);kt(B,1,()=>Et().data.chapters||[],rn,(fe,oe)=>{var ie=Iv(),Te=C(ie),De=j(Te);{var et=se=>{var ge=ns();Ee(Ce=>Ae(ge,`- ${Ce??""}...`),[()=>y(oe).description.substring(0,30)]),z(se,ge)};xe(De,se=>{y(oe).description&&se(et)})}var Xe={};Ee(()=>{Ae(Te,`${y(oe).title??""} `),Xe!==(Xe=y(oe).id)&&(ie.value=(ie.__value=y(oe).id)??"")}),z(fe,ie)});var q=j(E,2),N=j(C(q),2),K=j(q,2),Y=j(C(K),2),D=j(C(Y),2),W=C(D);Ee(()=>{ht(),_n(()=>{})});var re=C(W);re.value=re.__value="";var Z=j(re);kt(Z,1,()=>ht().imageResources,rn,(fe,oe)=>{var ie=Ev(),Te=C(ie),De={};Ee(()=>{Ae(Te,y(oe).name),De!==(De=y(oe).name)&&(ie.value=(ie.__value=y(oe).name)??"")}),z(fe,ie)});var be=j(Z);kt(be,1,()=>ht().riveResources,rn,(fe,oe)=>{var ie=Sv(),Te=C(ie),De={};Ee(()=>{Ae(Te,`${y(oe).name??""} (Rive)`),De!==(De=y(oe).name)&&(ie.value=(ie.__value=y(oe).name)??"")}),z(fe,ie)});var ue=j(W,2),X=j(C(ue));X.__change=function(...fe){Qn.uploadNewFile?.apply(this,fe)};var we=j(Y,2),Me=j(C(we),2),ce=C(Me);Ee(()=>{ht(),_n(()=>{})});var $e=C(ce);$e.value=$e.__value="";var ye=j($e);kt(ye,1,()=>ht().imageResources,rn,(fe,oe)=>{var ie=Av(),Te=C(ie),De={};Ee(()=>{Ae(Te,y(oe).name),De!==(De=y(oe).name)&&(ie.value=(ie.__value=y(oe).name)??"")}),z(fe,ie)});var ze=j(ye);kt(ze,1,()=>ht().riveResources,rn,(fe,oe)=>{var ie=Cv(),Te=C(ie),De={};Ee(()=>{Ae(Te,`${y(oe).name??""} (Rive)`),De!==(De=y(oe).name)&&(ie.value=(ie.__value=y(oe).name)??"")}),z(fe,ie)});var Ve=j(K,2),je=C(Ve),Ne=j(C(je),2);Ne.__click=()=>r(ht().currentDialogue);var Je=j(je,2);kt(Je,1,()=>ht().currentDialogue.options||[],rn,(fe,oe,ie)=>{var Te=xv();let De;var et=C(Te),Xe=C(et);Xe.__click=()=>s(ie),Xe.__keydown=o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s(ie))},Oe(Xe,"aria-controls",`option-content-${ie}`);var se=C(Xe),ge=C(se);{var Ce=o=>{var d=ns("👁️‍🗨️");z(o,d)},tt=o=>{var d=Kt(),k=jt(d);{var P=T=>{var U=ns("🔒");z(T,U)},A=T=>{var U=ns("✅");z(T,U)};xe(k,T=>{y(oe).enabled?T(A,!1):T(P)},!0)}z(o,d)};xe(ge,o=>{y(oe).visible?o(tt,!1):o(Ce)})}var at=j(se,2),Tt=C(at),xt=j(Xe,2);xt.__click=()=>l(ht().currentDialogue,ie);var nt=j(et,2);{var p=o=>{var d=Tv();Oe(d,"id",`option-content-${ie}`);var k=C(d);kv(k,{get option(){return y(oe)},index:ie,get dialogues(){return Et().data.dialogues},get availableItems(){return ht().availableItems},get conditionTypes(){return t}}),z(o,d)};xe(nt,o=>{Et().editingOptionIndex===ie&&o(p)})}Ee(o=>{De=qt(Te,1,"option-card svelte-1de8com",null,De,o),Oe(Xe,"aria-expanded",Et().editingOptionIndex===ie),Ae(Tt,`#${ie+1} ${y(oe).text??""}`)},[()=>({editing:Et().editingOptionIndex===ie})]),z(fe,Te)});var Pe=j(Ve,2),Le=j(C(Pe),2);Ee(()=>{ht(),_n(()=>{Et()})});var ct=C(Le);ct.value=ct.__value="";var Be=j(ct);kt(Be,1,()=>Et().data.dialogues,rn,(fe,oe)=>{var ie=Pv(),Te=C(ie),De={};Ee(et=>{Ae(Te,`${y(oe).id??""}: ${et??""}...`),De!==(De=y(oe).id)&&(ie.value=(ie.__value=y(oe).id)??"")},[()=>y(oe).text.substring(0,30)]),z(fe,ie)});var yt=j(Pe,2),he=C(yt);he.__click=()=>gr.deleteDialogue(ht().currentDialogue.id),Fn(g,()=>ht().currentDialogue.id,fe=>ht(ht().currentDialogue.id=fe)),qr(F,()=>ht().currentDialogue.chapterId,fe=>ht(ht().currentDialogue.chapterId=fe)),Fn(N,()=>ht().currentDialogue.text,fe=>ht(ht().currentDialogue.text=fe)),qr(W,()=>ht().currentDialogue.backgroundImage,fe=>ht(ht().currentDialogue.backgroundImage=fe)),qr(ce,()=>ht().currentDialogue.characterImage,fe=>ht(ht().currentDialogue.characterImage=fe)),qr(Le,()=>ht().currentDialogue.nextDialogueId,fe=>ht(ht().currentDialogue.nextDialogueId=fe)),z(_,w)},m=_=>{var w=Rv();z(_,w)};xe(h,_=>{ht().currentDialogue?_(f):_(m,!1)})}z(n,u),Wt()}Yt(["change","click","keydown"]);var We=tr(()=>L),Mv=ee('<img class="icon-preview svelte-asgatj"/>'),Lv=ee('<div class="icon-placeholder svelte-asgatj">📦</div>'),Dv=ee("<option> </option>"),$v=ee('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Fv=ee("<option> </option>"),Uv=ee('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Nv=ee('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),Bv=ee('<div class="items-list svelte-asgatj"></div>'),Wv=ee('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),Vv=ee('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),qv=ee('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function Hv(n,e){Bt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function r(){if(!We().data)return;We().data.items||We(We().data.items=[]);const O={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};We().data.items.push(O),We(We().editingItemIndex=We().data.items.length-1)}function s(O){We().editingItemIndex===O?We(We().editingItemIndex=null):We(We().editingItemIndex=O)}function l(O){confirm("Удалить предмет?")&&We().data?.items&&(We().data.items.splice(O,1),We(We().editingItemIndex=null))}function u(O){if(!We().data?.items)return;const B=We().data.items[O],q={...B,id:`${B.id}_copy_${Date.now()}`,name:`${B.name} (копия)`};We().data.items.splice(O+1,0,q),We(We().editingItemIndex=O+1)}function h(O){return t.find(B=>B.value===O)?.label||O}er();var f=qv(),m=C(f);m.__click=()=>We(We().showItems=!We().showItems);var _=C(m),w=j(C(_)),S=j(_,2),g=C(S),E=j(m,2);{var F=O=>{var B=Vv(),q=C(B);{var N=D=>{var W=Bv();kt(W,7,()=>We().data.items,re=>re.id,(re,Z,be)=>{var ue=Nv();let X;var we=C(ue);we.__click=()=>s(y(be));var Me=C(we),ce=C(Me),$e=C(ce);{var ye=se=>{var ge=Mv();Ee(()=>{Oe(ge,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${We().selectedBucket}/${y(Z).icon}`),Oe(ge,"alt",y(Z).name)}),z(se,ge)},ze=se=>{var ge=Lv();z(se,ge)};xe($e,se=>{y(Z).icon?se(ye):se(ze,!1)})}var Ve=j(ce,2),je=C(Ve),Ne=C(je),Je=j(je,2),Pe=C(Je),Le=C(Pe),ct=j(Pe,2);let Be;var yt=C(ct),he=j(Me,2),fe=C(he),oe=j(we,2),ie=C(oe);ie.__click=()=>u(y(be));var Te=j(ie,2);Te.__click=()=>s(y(be));var De=j(Te,2);De.__click=()=>l(y(be));var et=j(oe,2);{var Xe=se=>{var ge=Uv(),Ce=C(ge),tt=C(Ce),at=C(tt),Tt=j(at,2),xt=j(tt,2),nt=C(xt),p=j(nt,2),o=j(xt,2),d=C(o),k=j(d,2),P=j(o,2),A=C(P),T=j(A,2),U=C(T),H=j(U,2);H.__change=qe=>(y(Z).icon=qe.target.value,_n(()=>We()));var G=C(H);G.value=G.__value="";var le=j(G);kt(le,1,()=>We().storedFiles.filter(qe=>qe.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),rn,(qe,It)=>{var bt=Dv(),Ht=C(bt),Re={};Ee(()=>{Ae(Ht,y(It).name),Re!==(Re=y(It).name)&&(bt.value=(bt.__value=y(It).name)??"")}),z(qe,bt)});var ve=j(H,2),de=j(C(ve));de.__change=function(...qe){Qn.uploadNewFile?.apply(this,qe)};var _e=j(T,2);{var Ue=qe=>{var It=$v(),bt=C(It),Ht=j(bt,2),Re=C(Ht);Ee(()=>{Oe(bt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${We().selectedBucket}/${y(Z).icon}`),Ae(Re,y(Z).icon)}),z(qe,It)};xe(_e,qe=>{y(Z).icon&&qe(Ue)})}var vt=j(P,2),Fe=C(vt),mt=j(Fe,2);Ee(()=>{y(Z),_n(()=>{y(be)})}),kt(mt,5,()=>t,rn,(qe,It)=>{var bt=Fv(),Ht=C(bt),Re={};Ee(()=>{Ae(Ht,y(It).label),Re!==(Re=y(It).value)&&(bt.value=(bt.__value=y(It).value)??"")}),z(qe,bt)}),Ee(()=>{Oe(at,"for",`item-id-${y(be)??""}`),Oe(Tt,"id",`item-id-${y(be)??""}`),Oe(nt,"for",`item-name-${y(be)??""}`),Oe(p,"id",`item-name-${y(be)??""}`),Oe(d,"for",`item-desc-${y(be)??""}`),Oe(k,"id",`item-desc-${y(be)??""}`),Oe(A,"for",`item-icon-${y(be)??""}`),Oe(U,"id",`item-icon-${y(be)??""}`),Oe(Fe,"for",`item-type-${y(be)??""}`),Oe(mt,"id",`item-type-${y(be)??""}`)}),Fn(Tt,()=>y(Z).id,qe=>(y(Z).id=qe,_n(()=>We()))),Fn(p,()=>y(Z).name,qe=>(y(Z).name=qe,_n(()=>We()))),Fn(k,()=>y(Z).description,qe=>(y(Z).description=qe,_n(()=>We()))),Fn(U,()=>y(Z).icon,qe=>(y(Z).icon=qe,_n(()=>We()))),qr(mt,()=>y(Z).type,qe=>(y(Z).type=qe,_n(()=>We()))),z(se,ge)};xe(et,se=>{We().editingItemIndex===y(be)&&se(Xe)})}Ee((se,ge,Ce)=>{X=qt(ue,1,"item-row svelte-asgatj",null,X,se),Oe(we,"aria-label",`Редактировать предмет ${y(Z).name??""}`),Ae(Ne,y(Z).name),Ae(Le,y(Z).id),Be=qt(ct,1,"item-type-badge svelte-asgatj",null,Be,ge),Ae(yt,Ce),Ae(fe,`${y(Z).description??""} || `)},[()=>({editing:We().editingItemIndex===y(be)}),()=>({tool:y(Z).type==="tool",key:y(Z).type==="key",consumable:y(Z).type==="consumable",quest:y(Z).type==="quest",misc:y(Z).type==="misc"}),()=>h(y(Z).type)]),z(re,ue)}),z(D,W)},K=D=>{var W=Wv();z(D,W)};xe(q,D=>{We().data?.items?.length?D(N):D(K,!1)})}var Y=j(q,2);Y.__click=r,z(O,B)};xe(E,O=>{We().showItems&&O(F)})}Ee(()=>{Oe(m,"title",We().showItems?"Скрыть предметы":"Показать предметы"),Oe(m,"aria-expanded",We().showItems),Ae(w,` Предметы (${(We().data?.items?.length||0)??""})`),Ae(g,We().showItems?"▼":"▶")}),z(n,f),Wt()}Yt(["click","change"]);Yt(["click"]);class zv{#i=Ze(Ot({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return y(this.#i)}set player(e){Ie(this.#i,e,!0)}#n=Ze(null);get storyData(){return y(this.#n)}set storyData(e){Ie(this.#n,e,!0)}#e=Ze("0");get currentDialogueId(){return y(this.#e)}set currentDialogueId(e){Ie(this.#e,e,!0)}#s=Ze(!0);get isLoading(){return y(this.#s)}set isLoading(e){Ie(this.#s,e,!0)}#a=Ze("");get error(){return y(this.#a)}set error(e){Ie(this.#a,e,!0)}#t=Ze(null);get selectedStory(){return y(this.#t)}set selectedStory(e){Ie(this.#t,e,!0)}#r=Ze(Ot(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return y(this.#r)}set availableStories(e){Ie(this.#r,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();this.storyData=r,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const r=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${r}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const wt=new zv;var ds={exports:{}},Gv=ds.exports,Cl;function Kv(){return Cl||(Cl=1,(function(n,e){(function(r,s){n.exports=s()})(Gv,()=>(()=>{var t=[,((u,h,f)=>{f.r(h),f.d(h,{default:()=>_});var m=(()=>{var w=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var g=S,E,F;g.ready=new Promise((i,a)=>{E=i,F=a});function O(){function i(x){const $=v;c=a=0,v=new Map,$.forEach(V=>{try{V(x)}catch(M){console.error(M)}}),this.pb(),b&&b.Tb()}let a=0,c=0,v=new Map,b=null,I=null;this.requestAnimationFrame=function(x){a||(a=requestAnimationFrame(i.bind(this)));const $=++c;return v.set($,x),$},this.cancelAnimationFrame=function(x){v.delete(x),a&&v.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(x){I&&(document.body.remove(I),I=null),x||(I=document.createElement("div"),I.style.backgroundColor="black",I.style.position="fixed",I.style.right=0,I.style.top=0,I.style.color="white",I.style.padding="4px",I.innerHTML="RIVE FPS",x=function($){I.innerHTML="RIVE FPS "+$.toFixed(1)},document.body.appendChild(I)),b=new function(){let $=0,V=0;this.Tb=function(){var M=performance.now();V?(++$,M-=V,1e3<M&&(x(1e3*$/M),$=V=0)):(V=M,$=0)}}},this.Ob=function(){I&&(document.body.remove(I),I=null),b=null},this.pb=function(){}}function B(i){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(v){return v=v+((1<<i)-1)>>i,a.has(v)&&clearTimeout(a.get(v)),a.set(v,setTimeout(function(){a.delete(v),a.length==0?c=-1/0:v==c&&(c=Math.max(...a.keys()),console.assert(c<v))},1e3)),c=Math.max(v,c),c<<i}}const q=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){q&&q();let i=g.decodeAudio;g.decodeAudio=function(b,I){b=i(b),I(b)};let a=g.decodeFont;g.decodeFont=function(b,I){b=a(b),I(b)};const c=g.FileAssetLoader;g.ptrToAsset=b=>{let I=g.ptrToFileAsset(b);return I.isImage?g.ptrToImageAsset(b):I.isFont?g.ptrToFontAsset(b):I.isAudio?g.ptrToAudioAsset(b):I},g.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:b}){this.__parent.__construct.call(this),this.Gb=b},loadContents:function(b,I){return b=g.ptrToAsset(b),this.Gb(b,I)}}),g.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(b){let I=g.ptrToAsset(b);return b=I.cdnUuid,b===""?!1:((function(x,$){var V=new XMLHttpRequest;V.responseType="arraybuffer",V.onreadystatechange=function(){V.readyState==4&&V.status==200&&$(V)},V.open("GET",x,!0),V.send(null)})(I.cdnBaseUrl+"/"+b,x=>{I.decode(new Uint8Array(x.response))}),!0)}}),g.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(b){this.lb.push(b)},loadContents:function(b,I){for(let x of this.lb)if(x.loadContents(b,I))return!0;return!1}});let v=g.computeAlignment;g.computeAlignment=function(b,I,x,$,V=1){return v.call(this,b,I,x,$,V)}};const N="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),K=new function(){function i(){if(!a){let Ke=function(Qe,pe,At){if(pe=Q.createShader(pe),Q.shaderSource(pe,At),Q.compileShader(pe),At=Q.getShaderInfoLog(pe),0<(At||"").length)throw At;Q.attachShader(Qe,pe)};var R=document.createElement("canvas"),te={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let Q;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(Q=R.getContext("webgl",te),c=1,!Q)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(Q=R.getContext("webgl2",te))c=2;else if(Q=R.getContext("webgl",te))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(Q=new Proxy(Q,{get(Qe,pe){if(Qe.isContextLost()){if(V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",pe),V=!0),typeof Qe[pe]=="function")return function(){}}else return typeof Qe[pe]=="function"?function(...At){return Qe[pe].apply(Qe,At)}:Qe[pe]},set(Qe,pe,At){if(Qe.isContextLost())V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+pe),V=!0);else return Qe[pe]=At,!0}}),v=Math.min(Q.getParameter(Q.MAX_RENDERBUFFER_SIZE),Q.getParameter(Q.MAX_TEXTURE_SIZE)),R=Q.createProgram(),Ke(R,Q.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ke(R,Q.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),Q.bindAttribLocation(R,0,"vertex"),Q.bindAttribLocation(R,1,"uv"),Q.linkProgram(R),te=Q.getProgramInfoLog(R),0<(te||"").trim().length)throw te;b=Q.getUniformLocation(R,"mat"),I=Q.getUniformLocation(R,"translate"),Q.useProgram(R),Q.bindBuffer(Q.ARRAY_BUFFER,Q.createBuffer()),Q.enableVertexAttribArray(0),Q.enableVertexAttribArray(1),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,Q.createBuffer()),Q.uniform1i(Q.getUniformLocation(R,"image"),0),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=Q}return!0}let a=null,c=0,v=0,b=null,I=null,x=0,$=0,V=!1;i(),this.hc=function(){return i(),v},this.Mb=function(R){a.deleteTexture&&a.deleteTexture(R)},this.Lb=function(R){if(!i())return null;const te=a.createTexture();return te?(a.bindTexture(a.TEXTURE_2D,te),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,R),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),te):null};const M=new B(8),ne=new B(8),ae=new B(10),ke=new B(10);this.Qb=function(R,te,Q,Ke,Qe){if(i()){var pe=M.push(R),At=ne.push(te);if(a.canvas){(a.canvas.width!=pe||a.canvas.height!=At)&&(a.canvas.width=pe,a.canvas.height=At),a.viewport(0,At-te,R,te),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),Q.sort((ot,En)=>En.xb-ot.xb),pe=ae.push(Ke),x!=pe&&(a.bufferData(a.ARRAY_BUFFER,8*pe,a.DYNAMIC_DRAW),x=pe),pe=0;for(var Vt of Q)a.bufferSubData(a.ARRAY_BUFFER,pe,Vt.Ua),pe+=4*Vt.Ua.length;console.assert(pe==4*Ke);for(var In of Q)a.bufferSubData(a.ARRAY_BUFFER,pe,In.Db),pe+=4*In.Db.length;console.assert(pe==8*Ke),pe=ke.push(Qe),$!=pe&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*pe,a.DYNAMIC_DRAW),$=pe),Vt=0;for(var ar of Q)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Vt,ar.indices),Vt+=2*ar.indices.length;console.assert(Vt==2*Qe),ar=0,In=!0,pe=Vt=0;for(const ot of Q){ot.image.Ka!=ar&&(a.bindTexture(a.TEXTURE_2D,ot.image.Ja||null),ar=ot.image.Ka),ot.mc?(a.scissor(ot.Za,At-ot.$a-ot.kb,ot.Ac,ot.kb),In=!0):In&&(a.scissor(0,At-te,R,te),In=!1),Q=2/R;const En=-2/te;a.uniform4f(b,ot.ha[0]*Q*ot.Ba,ot.ha[1]*En*ot.Ca,ot.ha[2]*Q*ot.Ba,ot.ha[3]*En*ot.Ca),a.uniform2f(I,ot.ha[4]*Q*ot.Ba+Q*(ot.Za-ot.ic*ot.Ba)-1,ot.ha[5]*En*ot.Ca+En*(ot.$a-ot.jc*ot.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,pe),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,pe+4*Ke),a.drawElements(a.TRIANGLES,ot.indices.length,a.UNSIGNED_SHORT,Vt),pe+=4*ot.Ua.length,Vt+=2*ot.indices.length}console.assert(pe==4*Ke),console.assert(Vt==2*Qe)}}},this.canvas=function(){return i()&&a.canvas}},Y=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(J){switch(J){case M.srcOver:return"source-over";case M.screen:return"screen";case M.overlay:return"overlay";case M.darken:return"darken";case M.lighten:return"lighten";case M.colorDodge:return"color-dodge";case M.colorBurn:return"color-burn";case M.hardLight:return"hard-light";case M.softLight:return"soft-light";case M.difference:return"difference";case M.exclusion:return"exclusion";case M.multiply:return"multiply";case M.hue:return"hue";case M.saturation:return"saturation";case M.color:return"color";case M.luminosity:return"luminosity"}}function a(J){return"rgba("+((16711680&J)>>>16)+","+((65280&J)>>>8)+","+((255&J)>>>0)+","+((4278190080&J)>>>24)/255+")"}function c(){0<At.length&&(K.Qb(pe.drawWidth(),pe.drawHeight(),At,Vt,In),At=[],In=Vt=0,pe.reset(512,512));for(const J of Qe){for(const me of J.H)me();J.H=[]}Qe.clear()}Y&&Y();var v=g.RenderPaintStyle;const b=g.RenderPath,I=g.RenderPaint,x=g.Renderer,$=g.StrokeCap,V=g.StrokeJoin,M=g.BlendMode,ne=v.fill,ae=v.stroke,ke=g.FillRule.evenOdd;let R=1;var te=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:J,xa:me}={}){this.__parent.__construct.call(this),this.Ka=R,R=R+1&2147483647||1,this.la=J,this.xa=me},__destruct:function(){this.Ja&&(K.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(J){var me=this;me.xa&&me.xa(me);var it=new Image;me.Xa=URL.createObjectURL(new Blob([J],{type:"image/png"})),it.onload=function(){me.Fb=it,me.Ja=K.Lb(it),me.size(it.width,it.height),me.la&&me.la(me)},it.src=me.Xa}}),Q=b.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(J,me,it,lt,Ye,st,pt){var _t=this.T,pn=_t.addPath;J=J.T;const Dt=new DOMMatrix;Dt.a=me,Dt.b=it,Dt.c=lt,Dt.d=Ye,Dt.e=st,Dt.f=pt,pn.call(_t,J,Dt)},fillRule:function(J){this.Wa=J},moveTo:function(J,me){this.T.moveTo(J,me)},lineTo:function(J,me){this.T.lineTo(J,me)},cubicTo:function(J,me,it,lt,Ye,st){this.T.bezierCurveTo(J,me,it,lt,Ye,st)},close:function(){this.T.closePath()}}),Ke=I.extend("CanvasRenderPaint",{color:function(J){this.Ya=a(J)},thickness:function(J){this.Ib=J},join:function(J){switch(J){case V.miter:this.Ia="miter";break;case V.round:this.Ia="round";break;case V.bevel:this.Ia="bevel"}},cap:function(J){switch(J){case $.butt:this.Ha="butt";break;case $.round:this.Ha="round";break;case $.square:this.Ha="square"}},style:function(J){this.Hb=J},blendMode:function(J){this.Eb=i(J)},clearGradient:function(){this.ja=null},linearGradient:function(J,me,it,lt){this.ja={zb:J,Ab:me,cb:it,eb:lt,Ra:[]}},radialGradient:function(J,me,it,lt){this.ja={zb:J,Ab:me,cb:it,eb:lt,Ra:[],ec:!0}},addStop:function(J,me){this.ja.Ra.push({color:J,stop:me})},completeGradient:function(){},draw:function(J,me,it){let lt=this.Hb;var Ye=this.Ya,st=this.ja;if(J.globalCompositeOperation=this.Eb,st!=null){Ye=st.zb;var pt=st.Ab;const pn=st.cb;var _t=st.eb;const Dt=st.Ra;st.ec?(st=pn-Ye,_t-=pt,Ye=J.createRadialGradient(Ye,pt,0,Ye,pt,Math.sqrt(st*st+_t*_t))):Ye=J.createLinearGradient(Ye,pt,pn,_t);for(let on=0,$t=Dt.length;on<$t;on++)pt=Dt[on],Ye.addColorStop(pt.stop,a(pt.color));this.Ya=Ye,this.ja=null}switch(lt){case ae:J.strokeStyle=Ye,J.lineWidth=this.Ib,J.lineCap=this.Ha,J.lineJoin=this.Ia,J.stroke(me);break;case ne:J.fillStyle=Ye,J.fill(me,it)}}});const Qe=new Set;let pe=null,At=[],Vt=0,In=0;var ar=g.CanvasRenderer=x.extend("Renderer",{__construct:function(J){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=J.getContext("2d"),this.Va=J,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const J=this.S.length-6;if(6>J)throw"restore() called without matching save().";this.S.splice(J),this.H.push(this.C.restore.bind(this.C))},transform:function(J,me,it,lt,Ye,st){const pt=this.S,_t=pt.length-6;pt.splice(_t,6,pt[_t]*J+pt[_t+2]*me,pt[_t+1]*J+pt[_t+3]*me,pt[_t]*it+pt[_t+2]*lt,pt[_t+1]*it+pt[_t+3]*lt,pt[_t]*Ye+pt[_t+2]*st+pt[_t+4],pt[_t+1]*Ye+pt[_t+3]*st+pt[_t+5]),this.H.push(this.C.transform.bind(this.C,J,me,it,lt,Ye,st))},rotate:function(J){const me=Math.sin(J);J=Math.cos(J),this.transform(J,me,-me,J,0,0)},_drawPath:function(J,me){this.H.push(me.draw.bind(me,this.C,J.T,J.Wa===ke?"evenodd":"nonzero"))},_drawRiveImage:function(J,me,it,lt){var Ye=J.Fb;if(Ye){var st=this.C,pt=i(it);this.H.push(function(){st.globalCompositeOperation=pt,st.globalAlpha=lt,st.drawImage(Ye,0,0),st.globalAlpha=1})}},_getMatrix:function(J){const me=this.S,it=me.length-6;for(let lt=0;6>lt;++lt)J[lt]=me[it+lt]},_drawImageMesh:function(J,me,it,lt,Ye,st,pt,_t,pn,Dt,on){me=this.C.canvas.width;var $t=this.C.canvas.height;const Lo=Dt-_t,Do=on-pn;_t=Math.max(_t,0),pn=Math.max(pn,0),Dt=Math.min(Dt,me),on=Math.min(on,$t);const gi=Dt-_t,_i=on-pn;if(console.assert(gi<=Math.min(Lo,me)),console.assert(_i<=Math.min(Do,$t)),!(0>=gi||0>=_i)){Dt=gi<Lo||_i<Do,me=on=1;var or=Math.ceil(gi*on),lr=Math.ceil(_i*me);$t=K.hc(),or>$t&&(on*=$t/or,or=$t),lr>$t&&(me*=$t/lr,lr=$t),pe||(pe=new g.DynamicRectanizer($t),pe.reset(512,512)),$t=pe.addRect(or,lr),0>$t&&(c(),Qe.add(this),$t=pe.addRect(or,lr),console.assert(0<=$t));var $o=$t&65535,Fo=$t>>16;At.push({ha:this.S.slice(this.S.length-6),image:J,Za:$o,$a:Fo,ic:_t,jc:pn,Ac:or,kb:lr,Ba:on,Ca:me,Ua:new Float32Array(Ye),Db:new Float32Array(st),indices:new Uint16Array(pt),mc:Dt,xb:J.Ka<<1|(Dt?1:0)}),Vt+=Ye.length,In+=pt.length;var xr=this.C,uc=i(it);this.H.push(function(){xr.save(),xr.resetTransform(),xr.globalCompositeOperation=uc,xr.globalAlpha=lt;const Uo=K.canvas();Uo&&xr.drawImage(Uo,$o,Fo,or,lr,_t,pn,gi,_i),xr.restore()})}},_clipPath:function(J){this.H.push(this.C.clip.bind(this.C,J.T,J.Wa===ke?"evenodd":"nonzero"))},clear:function(){Qe.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(J,me){this.transform(1,0,0,1,J,me)}});g.makeRenderer=function(J){const me=new ar(J),it=me.C;return new Proxy(me,{get(lt,Ye){if(typeof lt[Ye]=="function")return function(...st){return lt[Ye].apply(lt,st)};if(typeof it[Ye]=="function"){if(-1<N.indexOf(Ye))throw Error("RiveException: Method call to '"+Ye+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...st){me.H.push(it[Ye].bind(it,...st))}}return lt[Ye]},set(lt,Ye,st){if(Ye in it)return me.H.push(()=>{it[Ye]=st}),!0}})},g.decodeImage=function(J,me){new te({la:me}).decode(J)},g.renderFactory={makeRenderPaint:function(){return new Ke},makeRenderPath:function(){return new Q},makeRenderImage:function(){let J=En;return new te({xa:()=>{J.total++},la:()=>{if(J.loaded++,J.loaded===J.total){const me=J.ready;me&&(me(),J.ready=null)}}})}};let ot=g.load,En=null;g.load=function(J,me,it=!0){const lt=new g.FallbackFileAssetLoader;return me!==void 0&&lt.addLoader(me),it&&(me=new g.CDNFileAssetLoader,lt.addLoader(me)),new Promise(function(Ye){let st=null;En={total:0,loaded:0,ready:function(){Ye(st)}},st=ot(J,lt),En.total==0&&Ye(st)})};let lc=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(J,me,it,lt,Ye=1){lc.call(this,J,me,it,lt,Ye)},v=new O,g.requestAnimationFrame=v.requestAnimationFrame.bind(v),g.cancelAnimationFrame=v.cancelAnimationFrame.bind(v),g.enableFPSCounter=v.Rb.bind(v),g.disableFPSCounter=v.Ob,v.pb=c,g.resolveAnimationFrame=c,g.cleanup=function(){pe&&pe.delete()}};var D=Object.assign({},g),W="./this.program",re=typeof window=="object",Z=typeof importScripts=="function",be="",ue,X;(re||Z)&&(Z?be=self.location.href:typeof document<"u"&&document.currentScript&&(be=document.currentScript.src),w&&(be=w),be.indexOf("blob:")!==0?be=be.substr(0,be.replace(/[?#].*/,"").lastIndexOf("/")+1):be="",Z&&(X=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),ue=(i,a,c)=>{var v=new XMLHttpRequest;v.open("GET",i,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var we=g.print||console.log.bind(console),Me=g.printErr||console.error.bind(console);Object.assign(g,D),D=null,g.thisProgram&&(W=g.thisProgram);var ce;g.wasmBinary&&(ce=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&Xe("no native wasm support detected");var $e,ye,ze=!1,Ve,je,Ne,Je,Pe,Le,ct,Be;function yt(){var i=$e.buffer;g.HEAP8=Ve=new Int8Array(i),g.HEAP16=Ne=new Int16Array(i),g.HEAP32=Pe=new Int32Array(i),g.HEAPU8=je=new Uint8Array(i),g.HEAPU16=Je=new Uint16Array(i),g.HEAPU32=Le=new Uint32Array(i),g.HEAPF32=ct=new Float32Array(i),g.HEAPF64=Be=new Float64Array(i)}var he,fe=[],oe=[],ie=[];function Te(){var i=g.preRun.shift();fe.unshift(i)}var De=0,et=null;function Xe(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",Me(i),ze=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),F(i),i}function se(i){return i.startsWith("data:application/octet-stream;base64,")}var ge;if(ge="canvas_advanced.wasm",!se(ge)){var Ce=ge;ge=g.locateFile?g.locateFile(Ce,be):be+Ce}function tt(i){if(i==ge&&ce)return new Uint8Array(ce);if(X)return X(i);throw"both async and sync fetching of the wasm failed"}function at(i){if(!ce&&(re||Z)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>tt(i));if(ue)return new Promise((a,c)=>{ue(i,v=>a(new Uint8Array(v)),c)})}return Promise.resolve().then(()=>tt(i))}function Tt(i,a,c){return at(i).then(v=>WebAssembly.instantiate(v,a)).then(v=>v).then(c,v=>{Me("failed to asynchronously prepare wasm: "+v),Xe(v)})}function xt(i,a){var c=ge;return ce||typeof WebAssembly.instantiateStreaming!="function"||se(c)||c.startsWith("file://")||typeof fetch!="function"?Tt(c,i,a):fetch(c,{credentials:"same-origin"}).then(v=>WebAssembly.instantiateStreaming(v,i).then(a,function(b){return Me("wasm streaming compile failed: "+b),Me("falling back to ArrayBuffer instantiation"),Tt(c,i,a)}))}var nt,p,o={460492:(i,a,c,v,b)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=v,window.h.ga.yb=b;let I=window.h;I.D=[],I.yc=function(x){for(var $=0;$<I.D.length;++$)if(I.D[$]==null)return I.D[$]=x,$;return I.D.push(x),I.D.length-1},I.Cb=function(x){for(I.D[x]=null;0<I.D.length&&I.D[I.D.length-1]==null;)I.D.pop()},I.Sc=function(x){for(var $=0;$<I.D.length;++$)if(I.D[$]==x)return I.Cb($)},I.ra=function(x){return I.D[x]},I.Ta=["touchend","click"],I.unlock=function(){for(var x=0;x<I.D.length;++x){var $=I.D[x];$!=null&&$.J!=null&&$.state===I.ga.yb&&$.J.resume().then(()=>{Po($.qb)},V=>{console.error("Failed to resume audiocontext",V)})}I.Ta.map(function(V){document.removeEventListener(V,I.unlock,!0)})},I.Ta.map(function(x){document.addEventListener(x,I.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,c,v,b,I)=>{if(typeof window.h>"u")return-1;var x={},$={};return i==window.h.I.ya&&c!=0&&($.sampleRate=c),x.J=new(window.AudioContext||window.webkitAudioContext)($),x.J.suspend(),x.state=window.h.ga.stopped,c=0,i!=window.h.I.ya&&(c=a),x.Z=x.J.createScriptProcessor(v,c,a),x.Z.onaudioprocess=function(V){if((x.sa==null||x.sa.length==0)&&(x.sa=new Float32Array(ct.buffer,b,v*a)),i==window.h.I.capture||i==window.h.I.La){for(var M=0;M<a;M+=1)for(var ne=V.inputBuffer.getChannelData(M),ae=x.sa,ke=0;ke<v;ke+=1)ae[ke*a+M]=ne[ke];jo(I,v,b)}if(i==window.h.I.ya||i==window.h.I.La)for(Ro(I,v,b),M=0;M<V.outputBuffer.numberOfChannels;++M)for(ne=V.outputBuffer.getChannelData(M),ae=x.sa,ke=0;ke<v;ke+=1)ne[ke]=ae[ke*a+M];else for(M=0;M<V.outputBuffer.numberOfChannels;++M)V.outputBuffer.getChannelData(M).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(V){x.Da=x.J.createMediaStreamSource(V),x.Da.connect(x.Z),x.Z.connect(x.J.destination)}).catch(function(V){console.log("Failed to get user media: "+V)}),i==window.h.I.ya&&x.Z.connect(x.J.destination),x.qb=I,window.h.yc(x)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(g)},k=(i,a)=>{for(var c=0,v=i.length-1;0<=v;v--){var b=i[v];b==="."?i.splice(v,1):b===".."?(i.splice(v,1),c++):c&&(i.splice(v,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},P=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=k(i.split("/").filter(v=>!!v),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},A=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},T=i=>{if(i==="/")return"/";i=P(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},U=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Xe("initRandomDevice")},H=i=>(H=U())(i);function G(){for(var i="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=k(i.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+i||"."}var le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ve=(i,a,c)=>{var v=a+c;for(c=a;i[c]&&!(c>=v);)++c;if(16<c-a&&i.buffer&&le)return le.decode(i.subarray(a,c));for(v="";a<c;){var b=i[a++];if(b&128){var I=i[a++]&63;if((b&224)==192)v+=String.fromCharCode((b&31)<<6|I);else{var x=i[a++]&63;b=(b&240)==224?(b&15)<<12|I<<6|x:(b&7)<<18|I<<12|x<<6|i[a++]&63,65536>b?v+=String.fromCharCode(b):(b-=65536,v+=String.fromCharCode(55296|b>>10,56320|b&1023))}}else v+=String.fromCharCode(b)}return v},de=[],_e=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);127>=v?a++:2047>=v?a+=2:55296<=v&&57343>=v?(a+=4,++c):a+=3}return a},Ue=(i,a,c,v)=>{if(!(0<v))return 0;var b=c;v=c+v-1;for(var I=0;I<i.length;++I){var x=i.charCodeAt(I);if(55296<=x&&57343>=x){var $=i.charCodeAt(++I);x=65536+((x&1023)<<10)|$&1023}if(127>=x){if(c>=v)break;a[c++]=x}else{if(2047>=x){if(c+1>=v)break;a[c++]=192|x>>6}else{if(65535>=x){if(c+2>=v)break;a[c++]=224|x>>12}else{if(c+3>=v)break;a[c++]=240|x>>18,a[c++]=128|x>>12&63}a[c++]=128|x>>6&63}a[c++]=128|x&63}}return a[c]=0,c-b};function vt(i,a){var c=Array(_e(i)+1);return i=Ue(i,c,0,c.length),a&&(c.length=i),c}var Fe=[];function mt(i,a){Fe[i]={input:[],F:[],V:a},xs(i,qe)}var qe={open:function(i){var a=Fe[i.node.za];if(!a)throw new Se(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,c,v){if(!i.s||!i.s.V.jb)throw new Se(60);for(var b=0,I=0;I<v;I++){try{var x=i.s.V.jb(i.s)}catch{throw new Se(29)}if(x===void 0&&b===0)throw new Se(6);if(x==null)break;b++,a[c+I]=x}return b&&(i.node.timestamp=Date.now()),b},write:function(i,a,c,v){if(!i.s||!i.s.V.Oa)throw new Se(60);try{for(var b=0;b<v;b++)i.s.V.Oa(i.s,a[c+b])}catch{throw new Se(29)}return v&&(i.node.timestamp=Date.now()),b}},It={jb:function(){e:{if(!de.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}de=vt(i,!0)}i=de.shift()}return i},Oa:function(i,a){a===null||a===10?(we(ve(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(we(ve(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},bt={Oa:function(i,a){a===null||a===10?(Me(ve(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Me(ve(i.F,0)),i.F=[])}};function Ht(i,a){var c=i.j?i.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(c.subarray(0,i.v),0))}var Re={O:null,U(){return Re.createNode(null,"/",16895,0)},createNode(i,a,c,v){if((c&61440)===24576||(c&61440)===4096)throw new Se(63);return Re.O||(Re.O={dir:{node:{Y:Re.l.Y,P:Re.l.P,ka:Re.l.ka,va:Re.l.va,vb:Re.l.vb,Bb:Re.l.Bb,wb:Re.l.wb,tb:Re.l.tb,Ea:Re.l.Ea},stream:{ba:Re.m.ba}},file:{node:{Y:Re.l.Y,P:Re.l.P},stream:{ba:Re.m.ba,read:Re.m.read,write:Re.m.write,pa:Re.m.pa,mb:Re.m.mb,ob:Re.m.ob}},link:{node:{Y:Re.l.Y,P:Re.l.P,ma:Re.l.ma},stream:{}},ab:{node:{Y:Re.l.Y,P:Re.l.P},stream:Nu}}),c=Qa(i,a,c,v),(c.mode&61440)===16384?(c.l=Re.O.dir.node,c.m=Re.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Re.O.file.node,c.m=Re.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Re.O.link.node,c.m=Re.O.link.stream):(c.mode&61440)===8192&&(c.l=Re.O.ab.node,c.m=Re.O.ab.stream),c.timestamp=Date.now(),i&&(i.j[a]=c,i.timestamp=c.timestamp),c},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var c=i.j;i.j=new Uint8Array(a),c&&i.j.set(c.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw Ts[44]},va(i,a,c,v){return Re.createNode(i,a,c,v)},vb(i,a,c){if((i.mode&61440)===16384){try{var v=Mi(a,c)}catch{}if(v)for(var b in v.j)throw new Se(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=c,a.j[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var c=Mi(i,a),v;for(v in c.j)throw new Se(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],c;for(c in i.j)i.j.hasOwnProperty(c)&&a.push(c);return a},Ea(i,a,c){return i=Re.createNode(i,a,41471,0),i.link=c,i},ma(i){if((i.mode&61440)!==40960)throw new Se(28);return i.link}},m:{read(i,a,c,v,b){var I=i.node.j;if(b>=i.node.v)return 0;if(i=Math.min(i.node.v-b,v),8<i&&I.subarray)a.set(I.subarray(b,b+i),c);else for(v=0;v<i;v++)a[c+v]=I[b+v];return i},write(i,a,c,v,b,I){if(a.buffer===Ve.buffer&&(I=!1),!v)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(I)return i.j=a.subarray(c,c+v),i.v=v;if(i.v===0&&b===0)return i.j=a.slice(c,c+v),i.v=v;if(b+v<=i.v)return i.j.set(a.subarray(c,c+v),b),v}if(Ht(i,b+v),i.j.subarray&&a.subarray)i.j.set(a.subarray(c,c+v),b);else for(I=0;I<v;I++)i.j[b+I]=a[c+I];return i.v=Math.max(i.v,b+v),v},ba(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new Se(28);return a},pa(i,a,c){Ht(i.node,a+c),i.node.v=Math.max(i.node.v,a+c)},mb(i,a,c,v,b){if((i.node.mode&61440)!==32768)throw new Se(43);if(i=i.node.j,b&2||i.buffer!==Ve.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,Xe(),a=void 0,!a)throw new Se(48);Ve.set(i,a)}else c=!1,a=i.byteOffset;return{o:a,M:c}},ob(i,a,c,v){return Re.m.write(i,a,0,v,c,!1),0}}};function dt(i,a){var c=0;return i&&(c|=365),a&&(c|=146),c}var wn=null,Ka={},Oi=[],Fu=1,oi=null,Ya=!0,Se=null,Ts={},rr=(i,a={})=>{if(i=G(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new Se(32);i=i.split("/").filter(x=>!!x);for(var c=wn,v="/",b=0;b<i.length;b++){var I=b===i.length-1;if(I&&a.parent)break;if(c=Mi(c,i[b]),v=P(v+"/"+i[b]),c.wa&&(!I||I&&a.hb)&&(c=c.wa.root),!I||a.gb){for(I=0;(c.mode&61440)===40960;)if(c=Bu(v),v=G(A(v),c),c=rr(v,{Qa:a.Qa+1}).node,40<I++)throw new Se(32)}}return{path:v,node:c}},Ja=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},Xa=(i,a)=>{for(var c=0,v=0;v<a.length;v++)c=(c<<5)-c+a.charCodeAt(v)|0;return(i+c>>>0)%oi.length},Mi=(i,a)=>{var c;if(c=(c=Li(i,"x"))?c:i.l.ka?0:2)throw new Se(c,i);for(c=oi[Xa(i.id,a)];c;c=c.lc){var v=c.name;if(c.parent.id===i.id&&v===a)return c}return i.l.ka(i,a)},Qa=(i,a,c,v)=>(i=new Ao(i,a,c,v),a=Xa(i.parent.id,i.name),i.lc=oi[a],oi[a]=i),Za=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},Li=(i,a)=>{if(Ya)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},eo=(i,a)=>{try{return Mi(i,a),20}catch{}return Li(i,"wx")},Uu=()=>{for(var i=0;4096>=i;i++)if(!Oi[i])return i;throw new Se(33)},Vn=i=>{if(i=Oi[i],!i)throw new Se(8);return i},to=(i,a=-1)=>(ui||(ui=function(){this.h={}},ui.prototype={},Object.defineProperties(ui.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),i=Object.assign(new ui,i),a==-1&&(a=Uu()),i.X=a,Oi[a]=i),Nu={open:i=>{i.m=Ka[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new Se(70)}},xs=(i,a)=>{Ka[i]={m:a}},no=(i,a)=>{var c=a==="/",v=!a;if(c&&wn)throw new Se(10);if(!c&&!v){var b=rr(a,{hb:!1});if(a=b.path,b=b.node,b.wa)throw new Se(10);if((b.mode&61440)!==16384)throw new Se(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,c?wn=i:b&&(b.wa=a,b.U&&b.U.kc.push(a))},hn=(i,a,c)=>{var v=rr(i,{parent:!0}).node;if(i=T(i),!i||i==="."||i==="..")throw new Se(28);var b=eo(v,i);if(b)throw new Se(b);if(!v.l.va)throw new Se(63);return v.l.va(v,i,a,c)},Di=(i,a,c)=>{typeof c>"u"&&(c=a,a=438),hn(i,a|8192,c)},Ps=(i,a)=>{if(!G(i))throw new Se(44);var c=rr(a,{parent:!0}).node;if(!c)throw new Se(44);a=T(a);var v=eo(c,a);if(v)throw new Se(v);if(!c.l.Ea)throw new Se(63);c.l.Ea(c,a,i)},Bu=i=>{if(i=rr(i).node,!i)throw new Se(44);if(!i.l.ma)throw new Se(28);return G(Ja(i.parent),i.l.ma(i))},$i=(i,a,c)=>{if(i==="")throw new Se(44);if(typeof a=="string"){var v={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof v>"u")throw Error(`Unknown file open mode: ${a}`);a=v}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var b=i;else{i=P(i);try{b=rr(i,{gb:!(a&131072)}).node}catch{}}if(v=!1,a&64)if(b){if(a&128)throw new Se(20)}else b=hn(i,c,0),v=!0;if(!b)throw new Se(44);if((b.mode&61440)===8192&&(a&=-513),a&65536&&(b.mode&61440)!==16384)throw new Se(54);if(!v&&(c=b?(b.mode&61440)===40960?32:(b.mode&61440)===16384&&(Za(a)!=="r"||a&512)?31:Li(b,Za(a)):44))throw new Se(c);if(a&512&&!v){if(c=b,c=typeof c=="string"?rr(c,{gb:!0}).node:c,!c.l.P)throw new Se(63);if((c.mode&61440)===16384)throw new Se(31);if((c.mode&61440)!==32768)throw new Se(28);if(v=Li(c,"w"))throw new Se(v);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,b=to({node:b,path:Ja(b),flags:a,seekable:!0,position:0,m:b.m,zc:[],error:!1}),b.m.open&&b.m.open(b),!g.logReadFiles||a&1||(Fi||(Fi={}),i in Fi||(Fi[i]=1)),b},ro=(i,a,c)=>{if(i.X===null)throw new Se(8);if(!i.seekable||!i.m.ba)throw new Se(70);if(c!=0&&c!=1&&c!=2)throw new Se(28);i.position=i.m.ba(i,a,c),i.zc=[]},io=()=>{Se||(Se=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(i),this.message="FS error"},Se.prototype=Error(),Se.prototype.constructor=Se,[44].forEach(i=>{Ts[i]=new Se(i),Ts[i].stack="<generic error, no stack>"}))},so,li=(i,a,c)=>{i=P("/dev/"+i);var v=dt(!!a,!!c);js||(js=64);var b=js++<<8|0;xs(b,{open:I=>{I.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(I,x,$,V)=>{for(var M=0,ne=0;ne<V;ne++){try{var ae=a()}catch{throw new Se(29)}if(ae===void 0&&M===0)throw new Se(6);if(ae==null)break;M++,x[$+ne]=ae}return M&&(I.node.timestamp=Date.now()),M},write:(I,x,$,V)=>{for(var M=0;M<V;M++)try{c(x[$+M])}catch{throw new Se(29)}return V&&(I.node.timestamp=Date.now()),M}}),Di(i,v,b)},js,ir={},ui,Fi,ci=void 0;function jn(){return ci+=4,Pe[ci-4>>2]}function ao(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Ui(i,a){return i=ao(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function oo(){this.M=[void 0],this.ib=[]}var an=new oo,Ar=void 0;function Ge(i){throw new Ar(i)}var fn=i=>(i||Ge("Cannot use deleted val. handle = "+i),an.get(i).value),vn=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return an.pa({ub:1,value:i})}};function lo(i){var a=Error,c=Ui(i,function(v){this.name=i,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var uo=void 0,co=void 0;function Pt(i){for(var a="";je[i];)a+=co[je[i++]];return a}var di=[];function Rs(){for(;di.length;){var i=di.pop();i.g.fa=!1,i.delete()}}var hi=void 0,Rn={};function Os(i,a){for(a===void 0&&Ge("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var sr={};function ho(i){i=Oo(i);var a=Pt(i);return Ln(i),a}function fi(i,a){var c=sr[i];return c===void 0&&Ge(a+" has unknown type "+ho(i)),c}function Ni(){}var Ms=!1;function fo(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function vo(i,a,c){return a===c?i:c.A===void 0?null:(i=vo(i,a,c.A),i===null?null:c.Pb(i))}var po={};function Wu(i,a){return a=Os(i,a),Rn[a]}var go=void 0;function Bi(i){throw new go(i)}function Wi(i,a){return a.u&&a.o||Bi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Bi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Cr(Object.create(i,{g:{value:a}}))}function Cr(i){return typeof FinalizationRegistry>"u"?(Cr=a=>a,i):(Ms=new FinalizationRegistry(a=>{fo(a.g)}),Cr=a=>{var c=a.g;return c.G&&Ms.register(a,{g:c},a),a},Ni=a=>{Ms.unregister(a)},Cr(i))}var Vi={};function vi(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function pi(i){return this.fromWireType(Pe[i>>2])}var Tr={},qi={};function tn(i,a,c){function v($){$=c($),$.length!==i.length&&Bi("Mismatched type converter count");for(var V=0;V<i.length;++V)kn(i[V],$[V])}i.forEach(function($){qi[$]=a});var b=Array(a.length),I=[],x=0;a.forEach(($,V)=>{sr.hasOwnProperty($)?b[V]=sr[$]:(I.push($),Tr.hasOwnProperty($)||(Tr[$]=[]),Tr[$].push(()=>{b[V]=sr[$],++x,x===I.length&&v(b)}))}),I.length===0&&v(b)}function Hi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Vu(i,a,c={}){var v=a.name;if(i||Ge(`type "${v}" must have a positive integer typeid pointer`),sr.hasOwnProperty(i)){if(c.$b)return;Ge(`Cannot register type '${v}' twice`)}sr[i]=a,delete qi[i],Tr.hasOwnProperty(i)&&(a=Tr[i],delete Tr[i],a.forEach(b=>b()))}function kn(i,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Vu(i,a,c)}function Ls(i){Ge(i.g.u.i.name+" instance already deleted")}function qn(){}function Ds(i,a,c){if(i[a].B===void 0){var v=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||Ge(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[v.ea]=v}}function $s(i,a,c){g.hasOwnProperty(i)?((c===void 0||g[i].B!==void 0&&g[i].B[c]!==void 0)&&Ge(`Cannot register public name '${i}' twice`),Ds(g,i,i),g.hasOwnProperty(c)&&Ge(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),g[i].B[c]=a):(g[i]=a,c!==void 0&&(g[i].Pc=c))}function qu(i,a,c,v,b,I,x,$){this.name=i,this.constructor=a,this.N=c,this.W=v,this.A=b,this.Ub=I,this.na=x,this.Pb=$,this.rb=[]}function zi(i,a,c){for(;a!==c;)a.na||Ge(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function Hu(i,a){return a===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(a.g||Ge(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),zi(a.g.o,a.g.u.i,this.i))}function zu(i,a){if(a===null){if(this.Na&&Ge(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return i!==null&&i.push(this.W,c),c}return 0}if(a.g||Ge(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&Ge(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=zi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&Ge("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:Ge(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var v=a.clone();c=this.oc(c,vn(function(){v.delete()})),i!==null&&i.push(this.W,c)}break;default:Ge("Unsupporting sharing policy")}return c}function Gu(i,a){return a===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(a.g||Ge(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&Ge(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),zi(a.g.o,a.g.u.i,this.i))}function On(i,a,c,v){this.name=i,this.i=a,this.Na=c,this.ta=v,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=zu:(this.toWireType=v?Hu:Gu,this.K=null)}function _o(i,a,c){g.hasOwnProperty(i)||Bi("Replacing nonexistant public symbol"),g[i].B!==void 0&&c!==void 0?g[i].B[c]=a:(g[i]=a,g[i].ea=c)}var Gi=[],mo=i=>{var a=Gi[i];return a||(i>=Gi.length&&(Gi.length=i+1),Gi[i]=a=he.get(i)),a},Ku=(i,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),i.includes("j")){var v=g["dynCall_"+i];v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)}else v=mo(a).apply(null,c);return v}};function zt(i,a){i=Pt(i);var c=i.includes("j")?Ku(i,a):mo(a);return typeof c!="function"&&Ge(`unknown function pointer with signature ${i}: ${a}`),c}var yo=void 0;function Mn(i,a){function c(I){b[I]||sr[I]||(qi[I]?qi[I].forEach(c):(v.push(I),b[I]=!0))}var v=[],b={};throw a.forEach(c),new yo(`${i}: `+v.map(ho).join([", "]))}function Ki(i,a,c,v,b){var I=a.length;2>I&&Ge("argTypes array size mismatch! Must at least get return value and 'this' types!");var x=a[1]!==null&&c!==null,$=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){$=!0;break}var V=a[0].name!=="void",M=I-2,ne=Array(M),ae=[],ke=[];return function(){if(arguments.length!==M&&Ge(`function ${i} called with ${arguments.length} arguments, expected ${M} args!`),ke.length=0,ae.length=x?2:1,ae[0]=b,x){var R=a[1].toWireType(ke,this);ae[1]=R}for(var te=0;te<M;++te)ne[te]=a[te+2].toWireType(ke,arguments[te]),ae.push(ne[te]);if(te=v.apply(null,ae),$)vi(ke);else for(var Q=x?1:2;Q<a.length;Q++){var Ke=Q===1?R:ne[Q-2];a[Q].K!==null&&a[Q].K(Ke)}return R=V?a[0].fromWireType(te):void 0,R}}function Yi(i,a){for(var c=[],v=0;v<i;v++)c.push(Le[a+4*v>>2]);return c}function bo(i,a,c){return i instanceof Object||Ge(`${c} with invalid "this": ${i}`),i instanceof a.i.constructor||Ge(`${c} incompatible with "this" of type ${i.constructor.name}`),i.g.o||Ge(`cannot call emscripten binding method ${c} on deleted object`),zi(i.g.o,i.g.u.i,a.i)}function Fs(i){i>=an.h&&--an.get(i).ub===0&&an.Zb(i)}function Yu(i,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?Ve:je)[v])};case 1:return function(v){return this.fromWireType((c?Ne:Je)[v>>1])};case 2:return function(v){return this.fromWireType((c?Pe:Le)[v>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Us(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Ju(i,a){switch(a){case 2:return function(c){return this.fromWireType(ct[c>>2])};case 3:return function(c){return this.fromWireType(Be[c>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Xu(i,a,c){switch(a){case 0:return c?function(v){return Ve[v]}:function(v){return je[v]};case 1:return c?function(v){return Ne[v>>1]}:function(v){return Je[v>>1]};case 2:return c?function(v){return Pe[v>>2]}:function(v){return Le[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var wo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Qu=(i,a)=>{for(var c=i>>1,v=c+a/2;!(c>=v)&&Je[c];)++c;if(c<<=1,32<c-i&&wo)return wo.decode(je.subarray(i,c));for(c="",v=0;!(v>=a/2);++v){var b=Ne[i+2*v>>1];if(b==0)break;c+=String.fromCharCode(b)}return c},Zu=(i,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*i.length?c/2:i.length;for(var b=0;b<c;++b)Ne[a>>1]=i.charCodeAt(b),a+=2;return Ne[a>>1]=0,a-v},ec=i=>2*i.length,tc=(i,a)=>{for(var c=0,v="";!(c>=a/4);){var b=Pe[i+4*c>>2];if(b==0)break;++c,65536<=b?(b-=65536,v+=String.fromCharCode(55296|b>>10,56320|b&1023)):v+=String.fromCharCode(b)}return v},nc=(i,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var b=0;b<i.length;++b){var I=i.charCodeAt(b);if(55296<=I&&57343>=I){var x=i.charCodeAt(++b);I=65536+((I&1023)<<10)|x&1023}if(Pe[a>>2]=I,a+=4,a+4>c)break}return Pe[a>>2]=0,a-v},rc=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a},ic={};function Ji(i){var a=ic[i];return a===void 0?Pt(i):a}var Xi=[];function sc(i){var a=Xi.length;return Xi.push(i),a}function ac(i,a){for(var c=Array(i),v=0;v<i;++v)c[v]=fi(Le[a+4*v>>2],"parameter "+v);return c}var ko=[],Ns=[],Bs={},Io=()=>{if(!Ws){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:W||"./this.program"},a;for(a in Bs)Bs[a]===void 0?delete i[a]:i[a]=Bs[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);Ws=c}return Ws},Ws,Qi=i=>i%4===0&&(i%100!==0||i%400===0),Eo=[31,29,31,30,31,30,31,31,30,31,30,31],So=[31,28,31,30,31,30,31,31,30,31,30,31],oc=(i,a,c,v)=>{function b(R,te,Q){for(R=typeof R=="number"?R.toString():R||"";R.length<te;)R=Q[0]+R;return R}function I(R,te){return b(R,te,"0")}function x(R,te){function Q(Qe){return 0>Qe?-1:0<Qe?1:0}var Ke;return(Ke=Q(R.getFullYear()-te.getFullYear()))===0&&(Ke=Q(R.getMonth()-te.getMonth()))===0&&(Ke=Q(R.getDate()-te.getDate())),Ke}function $(R){switch(R.getDay()){case 0:return new Date(R.getFullYear()-1,11,29);case 1:return R;case 2:return new Date(R.getFullYear(),0,3);case 3:return new Date(R.getFullYear(),0,2);case 4:return new Date(R.getFullYear(),0,1);case 5:return new Date(R.getFullYear()-1,11,31);case 6:return new Date(R.getFullYear()-1,11,30)}}function V(R){var te=R.ca;for(R=new Date(new Date(R.da+1900,0,1).getTime());0<te;){var Q=R.getMonth(),Ke=(Qi(R.getFullYear())?Eo:So)[Q];if(te>Ke-R.getDate())te-=Ke-R.getDate()+1,R.setDate(1),11>Q?R.setMonth(Q+1):(R.setMonth(0),R.setFullYear(R.getFullYear()+1));else{R.setDate(R.getDate()+te);break}}return Q=new Date(R.getFullYear()+1,0,4),te=$(new Date(R.getFullYear(),0,4)),Q=$(Q),0>=x(te,R)?0>=x(Q,R)?R.getFullYear()+1:R.getFullYear():R.getFullYear()-1}var M=Pe[v+40>>2];v={wc:Pe[v>>2],vc:Pe[v+4>>2],Fa:Pe[v+8>>2],Sa:Pe[v+12>>2],Ga:Pe[v+16>>2],da:Pe[v+20>>2],R:Pe[v+24>>2],ca:Pe[v+28>>2],Rc:Pe[v+32>>2],uc:Pe[v+36>>2],xc:M&&M?ve(je,M):""},c=c?ve(je,c):"",M={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ne in M)c=c.replace(new RegExp(ne,"g"),M[ne]);var ae="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ke="January February March April May June July August September October November December".split(" ");M={"%a":R=>ae[R.R].substring(0,3),"%A":R=>ae[R.R],"%b":R=>ke[R.Ga].substring(0,3),"%B":R=>ke[R.Ga],"%C":R=>I((R.da+1900)/100|0,2),"%d":R=>I(R.Sa,2),"%e":R=>b(R.Sa,2," "),"%g":R=>V(R).toString().substring(2),"%G":R=>V(R),"%H":R=>I(R.Fa,2),"%I":R=>(R=R.Fa,R==0?R=12:12<R&&(R-=12),I(R,2)),"%j":R=>{for(var te=0,Q=0;Q<=R.Ga-1;te+=(Qi(R.da+1900)?Eo:So)[Q++]);return I(R.Sa+te,3)},"%m":R=>I(R.Ga+1,2),"%M":R=>I(R.vc,2),"%n":()=>`
`,"%p":R=>0<=R.Fa&&12>R.Fa?"AM":"PM","%S":R=>I(R.wc,2),"%t":()=>"	","%u":R=>R.R||7,"%U":R=>I(Math.floor((R.ca+7-R.R)/7),2),"%V":R=>{var te=Math.floor((R.ca+7-(R.R+6)%7)/7);if(2>=(R.R+371-R.ca-2)%7&&te++,te)te==53&&(Q=(R.R+371-R.ca)%7,Q==4||Q==3&&Qi(R.da)||(te=1));else{te=52;var Q=(R.R+7-R.ca-1)%7;(Q==4||Q==5&&Qi(R.da%400-1))&&te++}return I(te,2)},"%w":R=>R.R,"%W":R=>I(Math.floor((R.ca+7-(R.R+6)%7)/7),2),"%y":R=>(R.da+1900).toString().substring(2),"%Y":R=>R.da+1900,"%z":R=>{R=R.uc;var te=0<=R;return R=Math.abs(R)/60,(te?"+":"-")+("0000"+(R/60*100+R%60)).slice(-4)},"%Z":R=>R.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(ne in M)c.includes(ne)&&(c=c.replace(new RegExp(ne,"g"),M[ne](v)));return c=c.replace(/\0\0/g,"%"),ne=vt(c,!1),ne.length>a?0:(Ve.set(ne,i),ne.length-1)};function Ao(i,a,c,v){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Fu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=v}Object.defineProperties(Ao.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),io(),oi=Array(4096),no(Re,"/"),hn("/tmp",16895,0),hn("/home",16895,0),hn("/home/web_user",16895,0),(()=>{hn("/dev",16895,0),xs(259,{read:()=>0,write:(v,b,I,x)=>x}),Di("/dev/null",259),mt(1280,It),mt(1536,bt),Di("/dev/tty",1280),Di("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=H(i).byteLength),i[--a]);li("random",c),li("urandom",c),hn("/dev/shm",16895,0),hn("/dev/shm/tmp",16895,0)})(),(()=>{hn("/proc",16895,0);var i=hn("/proc/self",16895,0);hn("/proc/self/fd",16895,0),no({U:()=>{var a=Qa(i,"fd",16895,73);return a.l={ka:(c,v)=>{var b=Vn(+v);return c={parent:null,U:{nb:"fake"},l:{ma:()=>b.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(oo.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Ar=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},an.M.push({value:void 0},{value:null},{value:!0},{value:!1}),an.h=an.M.length,g.count_emval_handles=function(){for(var i=0,a=an.h;a<an.M.length;++a)an.M[a]!==void 0&&++i;return i},uo=g.PureVirtualError=lo("PureVirtualError");for(var Co=Array(256),Zi=0;256>Zi;++Zi)Co[Zi]=String.fromCharCode(Zi);co=Co,g.getInheritedInstanceCount=function(){return Object.keys(Rn).length},g.getLiveInheritedInstances=function(){var i=[],a;for(a in Rn)Rn.hasOwnProperty(a)&&i.push(Rn[a]);return i},g.flushPendingDeletes=Rs,g.setDelayFunction=function(i){hi=i,di.length&&hi&&hi(Rs)},go=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},qn.prototype.isAliasOf=function(i){if(!(this instanceof qn&&i instanceof qn))return!1;var a=this.g.u.i,c=this.g.o,v=i.g.u.i;for(i=i.g.o;a.A;)c=a.na(c),a=a.A;for(;v.A;)i=v.na(i),v=v.A;return a===v&&c===i},qn.prototype.clone=function(){if(this.g.o||Ls(this),this.g.ia)return this.g.count.value+=1,this;var i=Cr,a=Object,c=a.create,v=Object.getPrototypeOf(this),b=this.g;return i=i(c.call(a,v,{g:{value:{count:b.count,fa:b.fa,ia:b.ia,o:b.o,u:b.u,G:b.G,L:b.L}}})),i.g.count.value+=1,i.g.fa=!1,i},qn.prototype.delete=function(){this.g.o||Ls(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),Ni(this),fo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},qn.prototype.isDeleted=function(){return!this.g.o},qn.prototype.deleteLater=function(){return this.g.o||Ls(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),di.push(this),di.length===1&&hi&&hi(Rs),this.g.fa=!0,this},On.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},On.prototype.bb=function(i){this.W&&this.W(i)},On.prototype.argPackAdvance=8,On.prototype.readValueFromPointer=pi,On.prototype.deleteObject=function(i){i!==null&&i.delete()},On.prototype.fromWireType=function(i){function a(){return this.ua?Wi(this.i.N,{u:this.nc,o:c,L:this,G:i}):Wi(this.i.N,{u:this,o:i})}var c=this.Vb(i);if(!c)return this.bb(i),null;var v=Wu(this.i,c);if(v!==void 0)return v.g.count.value===0?(v.g.o=c,v.g.G=i,v.clone()):(v=v.clone(),this.bb(i),v);if(v=this.i.Ub(c),v=po[v],!v)return a.call(this);v=this.ta?v.Kb:v.pointerType;var b=vo(c,this.i,v.i);return b===null?a.call(this):this.ua?Wi(v.i.N,{u:v,o:b,L:this,G:i}):Wi(v.i.N,{u:v,o:b})},yo=g.UnboundTypeError=lo("UnboundTypeError");var To={__syscall_fcntl64:function(i,a,c){ci=c;try{var v=Vn(i);switch(a){case 0:var b=jn();return 0>b?-28:to(v,b).X;case 1:case 2:return 0;case 3:return v.flags;case 4:return b=jn(),v.flags|=b,0;case 5:return b=jn(),Ne[b+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Pe[xo()>>2]=28,-1;default:return-28}}catch(I){if(typeof ir>"u"||I.name!=="ErrnoError")throw I;return-I.aa}},__syscall_ioctl:function(i,a,c){ci=c;try{var v=Vn(i);switch(a){case 21509:return v.s?0:-59;case 21505:if(!v.s)return-59;if(v.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var b=jn();Pe[b>>2]=25856,Pe[b+4>>2]=5,Pe[b+8>>2]=191,Pe[b+12>>2]=35387;for(var I=0;32>I;I++)Ve[b+I+17>>0]=a[I]||0}return 0;case 21510:case 21511:case 21512:return v.s?0:-59;case 21506:case 21507:case 21508:if(!v.s)return-59;if(v.s.V.cc)for(b=jn(),a=[],I=0;32>I;I++)a.push(Ve[b+I+17>>0]);return 0;case 21519:return v.s?(b=jn(),Pe[b>>2]=0):-59;case 21520:return v.s?-28:-59;case 21531:if(b=jn(),!v.m.ac)throw new Se(59);return v.m.ac(v,a,b);case 21523:return v.s?(v.s.V.dc&&(I=[24,80],b=jn(),Ne[b>>1]=I[0],Ne[b+2>>1]=I[1]),0):-59;case 21524:return v.s?0:-59;case 21515:return v.s?0:-59;default:return-28}}catch(x){if(typeof ir>"u"||x.name!=="ErrnoError")throw x;return-x.aa}},__syscall_openat:function(i,a,c,v){ci=v;try{a=a?ve(je,a):"";var b=a;if(b.charAt(0)==="/")a=b;else{var I=i===-100?"/":Vn(i).path;if(b.length==0)throw new Se(44);a=P(I+"/"+b)}var x=v?jn():0;return $i(a,c,x).X}catch($){if(typeof ir>"u"||$.name!=="ErrnoError")throw $;return-$.aa}},_embind_create_inheriting_constructor:function(i,a,c){i=Pt(i),a=fi(a,"wrapper"),c=fn(c);var v=[].slice,b=a.i,I=b.N,x=b.A.N,$=b.A.constructor;i=Ui(i,function(){b.A.rb.forEach((function(M){if(this[M]===x[M])throw new uo(`Pure virtual function ${M} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:I}),this.__construct.apply(this,v.call(arguments))}),I.__construct=function(){this===I&&Ge("Pass correct 'this' to __construct");var M=$.implement.apply(void 0,[this].concat(v.call(arguments)));Ni(M);var ne=M.g;M.notifyOnDestruction(),ne.ia=!0,Object.defineProperties(this,{g:{value:ne}}),Cr(this),M=ne.o,M=Os(b,M),Rn.hasOwnProperty(M)?Ge(`Tried to register registered instance: ${M}`):Rn[M]=this},I.__destruct=function(){this===I&&Ge("Pass correct 'this' to __destruct"),Ni(this);var M=this.g.o;M=Os(b,M),Rn.hasOwnProperty(M)?delete Rn[M]:Ge(`Tried to unregister unregistered instance: ${M}`)},i.prototype=Object.create(I);for(var V in c)i.prototype[V]=c[V];return vn(i)},_embind_finalize_value_object:function(i){var a=Vi[i];delete Vi[i];var c=a.Pa,v=a.W,b=a.fb,I=b.map(x=>x.Yb).concat(b.map(x=>x.rc));tn([i],I,x=>{var $={};return b.forEach((V,M)=>{var ne=x[M],ae=V.Wb,ke=V.Xb,R=x[M+b.length],te=V.qc,Q=V.sc;$[V.Sb]={read:Ke=>ne.fromWireType(ae(ke,Ke)),write:(Ke,Qe)=>{var pe=[];te(Q,Ke,R.toWireType(pe,Qe)),vi(pe)}}}),[{name:a.name,fromWireType:function(V){var M={},ne;for(ne in $)M[ne]=$[ne].read(V);return v(V),M},toWireType:function(V,M){for(var ne in $)if(!(ne in M))throw new TypeError(`Missing field: "${ne}"`);var ae=c();for(ne in $)$[ne].write(ae,M[ne]);return V!==null&&V.push(v,ae),ae},argPackAdvance:8,readValueFromPointer:pi,K:v}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,c,v,b){var I=Hi(c);a=Pt(a),kn(i,{name:a,fromWireType:function(x){return!!x},toWireType:function(x,$){return $?v:b},argPackAdvance:8,readValueFromPointer:function(x){if(c===1)var $=Ve;else if(c===2)$=Ne;else if(c===4)$=Pe;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType($[x>>I])},K:null})},_embind_register_class:function(i,a,c,v,b,I,x,$,V,M,ne,ae,ke){ne=Pt(ne),I=zt(b,I),$&&($=zt(x,$)),M&&(M=zt(V,M)),ke=zt(ae,ke);var R=ao(ne);$s(R,function(){Mn(`Cannot construct ${ne} due to unbound types`,[v])}),tn([i,a,c],v?[v]:[],function(te){if(te=te[0],v)var Q=te.i,Ke=Q.N;else Ke=qn.prototype;te=Ui(R,function(){if(Object.getPrototypeOf(this)!==Qe)throw new Ar("Use 'new' to construct "+ne);if(pe.$===void 0)throw new Ar(ne+" has no accessible constructor");var Vt=pe.$[arguments.length];if(Vt===void 0)throw new Ar(`Tried to invoke ctor of ${ne} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(pe.$).toString()}) parameters instead!`);return Vt.apply(this,arguments)});var Qe=Object.create(Ke,{constructor:{value:te}});te.prototype=Qe;var pe=new qu(ne,te,Qe,ke,Q,I,$,M);pe.A&&(pe.A.oa===void 0&&(pe.A.oa=[]),pe.A.oa.push(pe)),Q=new On(ne,pe,!0,!1),Ke=new On(ne+"*",pe,!1,!1);var At=new On(ne+" const*",pe,!1,!0);return po[i]={pointerType:Ke,Kb:At},_o(R,te),[Q,Ke,At]})},_embind_register_class_class_function:function(i,a,c,v,b,I,x){var $=Yi(c,v);a=Pt(a),I=zt(b,I),tn([],[i],function(V){function M(){Mn(`Cannot call ${ne} due to unbound types`,$)}V=V[0];var ne=`${V.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var ae=V.i.constructor;return ae[a]===void 0?(M.ea=c-1,ae[a]=M):(Ds(ae,a,ne),ae[a].B[c-1]=M),tn([],$,function(ke){if(ke=Ki(ne,[ke[0],null].concat(ke.slice(1)),null,I,x),ae[a].B===void 0?(ke.ea=c-1,ae[a]=ke):ae[a].B[c-1]=ke,V.i.oa)for(const R of V.i.oa)R.constructor.hasOwnProperty(a)||(R.constructor[a]=ke);return[]}),[]})},_embind_register_class_class_property:function(i,a,c,v,b,I,x,$){a=Pt(a),I=zt(b,I),tn([],[i],function(V){V=V[0];var M=`${V.name}.${a}`,ne={get(){Mn(`Cannot access ${M} due to unbound types`,[c])},enumerable:!0,configurable:!0};return ne.set=$?()=>{Mn(`Cannot access ${M} due to unbound types`,[c])}:()=>{Ge(`${M} is a read-only property`)},Object.defineProperty(V.i.constructor,a,ne),tn([],[c],function(ae){ae=ae[0];var ke={get(){return ae.fromWireType(I(v))},enumerable:!0};return $&&($=zt(x,$),ke.set=R=>{var te=[];$(v,ae.toWireType(te,R)),vi(te)}),Object.defineProperty(V.i.constructor,a,ke),[]}),[]})},_embind_register_class_constructor:function(i,a,c,v,b,I){var x=Yi(a,c);b=zt(v,b),tn([],[i],function($){$=$[0];var V=`constructor ${$.name}`;if($.i.$===void 0&&($.i.$=[]),$.i.$[a-1]!==void 0)throw new Ar(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${$.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return $.i.$[a-1]=()=>{Mn(`Cannot construct ${$.name} due to unbound types`,x)},tn([],x,function(M){return M.splice(1,0,null),$.i.$[a-1]=Ki(V,M,null,b,I),[]}),[]})},_embind_register_class_function:function(i,a,c,v,b,I,x,$){var V=Yi(c,v);a=Pt(a),I=zt(b,I),tn([],[i],function(M){function ne(){Mn(`Cannot call ${ae} due to unbound types`,V)}M=M[0];var ae=`${M.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),$&&M.i.rb.push(a);var ke=M.i.N,R=ke[a];return R===void 0||R.B===void 0&&R.className!==M.name&&R.ea===c-2?(ne.ea=c-2,ne.className=M.name,ke[a]=ne):(Ds(ke,a,ae),ke[a].B[c-2]=ne),tn([],V,function(te){return te=Ki(ae,te,M,I,x),ke[a].B===void 0?(te.ea=c-2,ke[a]=te):ke[a].B[c-2]=te,[]}),[]})},_embind_register_class_property:function(i,a,c,v,b,I,x,$,V,M){a=Pt(a),b=zt(v,b),tn([],[i],function(ne){ne=ne[0];var ae=`${ne.name}.${a}`,ke={get(){Mn(`Cannot access ${ae} due to unbound types`,[c,x])},enumerable:!0,configurable:!0};return ke.set=V?()=>{Mn(`Cannot access ${ae} due to unbound types`,[c,x])}:()=>{Ge(ae+" is a read-only property")},Object.defineProperty(ne.i.N,a,ke),tn([],V?[c,x]:[c],function(R){var te=R[0],Q={get(){var Qe=bo(this,ne,ae+" getter");return te.fromWireType(b(I,Qe))},enumerable:!0};if(V){V=zt($,V);var Ke=R[1];Q.set=function(Qe){var pe=bo(this,ne,ae+" setter"),At=[];V(M,pe,Ke.toWireType(At,Qe)),vi(At)}}return Object.defineProperty(ne.i.N,a,Q),[]}),[]})},_embind_register_emval:function(i,a){a=Pt(a),kn(i,{name:a,fromWireType:function(c){var v=fn(c);return Fs(c),v},toWireType:function(c,v){return vn(v)},argPackAdvance:8,readValueFromPointer:pi,K:null})},_embind_register_enum:function(i,a,c,v){function b(){}c=Hi(c),a=Pt(a),b.values={},kn(i,{name:a,constructor:b,fromWireType:function(I){return this.constructor.values[I]},toWireType:function(I,x){return x.value},argPackAdvance:8,readValueFromPointer:Yu(a,c,v),K:null}),$s(a,b)},_embind_register_enum_value:function(i,a,c){var v=fi(i,"enum");a=Pt(a),i=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:Ui(`${v.name}_${a}`,function(){})}}),i.values[c]=v,i[a]=v},_embind_register_float:function(i,a,c){c=Hi(c),a=Pt(a),kn(i,{name:a,fromWireType:function(v){return v},toWireType:function(v,b){return b},argPackAdvance:8,readValueFromPointer:Ju(a,c),K:null})},_embind_register_function:function(i,a,c,v,b,I){var x=Yi(a,c);i=Pt(i),b=zt(v,b),$s(i,function(){Mn(`Cannot call ${i} due to unbound types`,x)},a-1),tn([],x,function($){return _o(i,Ki(i,[$[0],null].concat($.slice(1)),null,b,I),a-1),[]})},_embind_register_integer:function(i,a,c,v,b){a=Pt(a),b===-1&&(b=4294967295),b=Hi(c);var I=$=>$;if(v===0){var x=32-8*c;I=$=>$<<x>>>x}c=a.includes("unsigned")?function($,V){return V>>>0}:function($,V){return V},kn(i,{name:a,fromWireType:I,toWireType:c,argPackAdvance:8,readValueFromPointer:Xu(a,b,v!==0),K:null})},_embind_register_memory_view:function(i,a,c){function v(I){I>>=2;var x=Le;return new b(x.buffer,x[I+1],x[I])}var b=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Pt(c),kn(i,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{$b:!0})},_embind_register_std_string:function(i,a){a=Pt(a);var c=a==="std::string";kn(i,{name:a,fromWireType:function(v){var b=Le[v>>2],I=v+4;if(c)for(var x=I,$=0;$<=b;++$){var V=I+$;if($==b||je[V]==0){if(x=x?ve(je,x,V-x):"",M===void 0)var M=x;else M+="\0",M+=x;x=V+1}}else{for(M=Array(b),$=0;$<b;++$)M[$]=String.fromCharCode(je[I+$]);M=M.join("")}return Ln(v),M},toWireType:function(v,b){b instanceof ArrayBuffer&&(b=new Uint8Array(b));var I=typeof b=="string";I||b instanceof Uint8Array||b instanceof Uint8ClampedArray||b instanceof Int8Array||Ge("Cannot pass non-string to std::string");var x=c&&I?_e(b):b.length,$=Vs(4+x+1),V=$+4;if(Le[$>>2]=x,c&&I)Ue(b,je,V,x+1);else if(I)for(I=0;I<x;++I){var M=b.charCodeAt(I);255<M&&(Ln(V),Ge("String has UTF-16 code units that do not fit in 8 bits")),je[V+I]=M}else for(I=0;I<x;++I)je[V+I]=b[I];return v!==null&&v.push(Ln,$),$},argPackAdvance:8,readValueFromPointer:pi,K:function(v){Ln(v)}})},_embind_register_std_wstring:function(i,a,c){if(c=Pt(c),a===2)var v=Qu,b=Zu,I=ec,x=()=>Je,$=1;else a===4&&(v=tc,b=nc,I=rc,x=()=>Le,$=2);kn(i,{name:c,fromWireType:function(V){for(var M=Le[V>>2],ne=x(),ae,ke=V+4,R=0;R<=M;++R){var te=V+4+R*a;(R==M||ne[te>>$]==0)&&(ke=v(ke,te-ke),ae===void 0?ae=ke:(ae+="\0",ae+=ke),ke=te+a)}return Ln(V),ae},toWireType:function(V,M){typeof M!="string"&&Ge(`Cannot pass non-string to C++ string type ${c}`);var ne=I(M),ae=Vs(4+ne+a);return Le[ae>>2]=ne>>$,b(M,ae+4,ne+a),V!==null&&V.push(Ln,ae),ae},argPackAdvance:8,readValueFromPointer:pi,K:function(V){Ln(V)}})},_embind_register_value_object:function(i,a,c,v,b,I){Vi[i]={name:Pt(a),Pa:zt(c,v),W:zt(b,I),fb:[]}},_embind_register_value_object_field:function(i,a,c,v,b,I,x,$,V,M){Vi[i].fb.push({Sb:Pt(a),Yb:c,Wb:zt(v,b),Xb:I,rc:x,qc:zt($,V),sc:M})},_embind_register_void:function(i,a){a=Pt(a),kn(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,c){i=fn(i),a=fi(a,"emval::as");var v=[],b=vn(v);return Le[c>>2]=b,a.toWireType(v,i)},_emval_call_method:function(i,a,c,v,b){i=Xi[i],a=fn(a),c=Ji(c);var I=[];return Le[v>>2]=vn(I),i(a,c,I,b)},_emval_call_void_method:function(i,a,c,v){i=Xi[i],a=fn(a),c=Ji(c),i(a,c,null,v)},_emval_decref:Fs,_emval_get_method_caller:function(i,a){var c=ac(i,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(x){return x.name}).join("_")+"$";var b=ko[a];if(b!==void 0)return b;var I=Array(i-1);return b=sc((x,$,V,M)=>{for(var ne=0,ae=0;ae<i-1;++ae)I[ae]=c[ae+1].readValueFromPointer(M+ne),ne+=c[ae+1].argPackAdvance;for(x=x[$].apply(x,I),ae=0;ae<i-1;++ae)c[ae+1].Nb&&c[ae+1].Nb(I[ae]);if(!v.fc)return v.toWireType(V,x)}),ko[a]=b},_emval_get_module_property:function(i){return i=Ji(i),vn(g[i])},_emval_get_property:function(i,a){return i=fn(i),a=fn(a),vn(i[a])},_emval_incref:function(i){4<i&&(an.get(i).ub+=1)},_emval_new_array:function(){return vn([])},_emval_new_cstring:function(i){return vn(Ji(i))},_emval_new_object:function(){return vn({})},_emval_run_destructors:function(i){var a=fn(i);vi(a),Fs(i)},_emval_set_property:function(i,a,c){i=fn(i),a=fn(a),c=fn(c),i[a]=c},_emval_take_value:function(i,a){return i=fi(i,"_emval_take_value"),i=i.readValueFromPointer(a),vn(i)},abort:()=>{Xe("")},emscripten_asm_const_int:(i,a,c)=>{Ns.length=0;var v;for(c>>=2;v=je[a++];)c+=v!=105&c,Ns.push(v==105?Pe[c]:Be[c++>>1]),++c;return o[i].apply(null,Ns)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,c)=>je.copyWithin(i,a,a+c),emscripten_resize_heap:i=>{var a=je.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,i+100663296);var b=Math;v=Math.max(i,v);e:{b=b.min.call(b,2147483648,v+(65536-v%65536)%65536)-$e.buffer.byteLength+65535>>>16;try{$e.grow(b),yt();var I=1;break e}catch{}I=void 0}if(I)return!0}return!1},environ_get:(i,a)=>{var c=0;return Io().forEach(function(v,b){var I=a+c;for(b=Le[i+4*b>>2]=I,I=0;I<v.length;++I)Ve[b++>>0]=v.charCodeAt(I);Ve[b>>0]=0,c+=v.length+1}),0},environ_sizes_get:(i,a)=>{var c=Io();Le[i>>2]=c.length;var v=0;return c.forEach(function(b){v+=b.length+1}),Le[a>>2]=v,0},fd_close:function(i){try{var a=Vn(i);if(a.X===null)throw new Se(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Oi[a.X]=null}return a.X=null,0}catch(c){if(typeof ir>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(i,a,c,v){try{e:{var b=Vn(i);i=a;for(var I,x=a=0;x<c;x++){var $=Le[i>>2],V=Le[i+4>>2];i+=8;var M=b,ne=$,ae=V,ke=I,R=Ve;if(0>ae||0>ke)throw new Se(28);if(M.X===null)throw new Se(8);if((M.flags&2097155)===1)throw new Se(8);if((M.node.mode&61440)===16384)throw new Se(31);if(!M.m.read)throw new Se(28);var te=typeof ke<"u";if(!te)ke=M.position;else if(!M.seekable)throw new Se(70);var Q=M.m.read(M,R,ne,ae,ke);te||(M.position+=Q);var Ke=Q;if(0>Ke){var Qe=-1;break e}if(a+=Ke,Ke<V)break;typeof I<"u"&&(I+=Ke)}Qe=a}return Le[v>>2]=Qe,0}catch(pe){if(typeof ir>"u"||pe.name!=="ErrnoError")throw pe;return pe.aa}},fd_seek:function(i,a,c,v,b){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var I=Vn(i);return ro(I,a,v),p=[I.position>>>0,(nt=I.position,1<=+Math.abs(nt)?0<nt?+Math.floor(nt/4294967296)>>>0:~~+Math.ceil((nt-+(~~nt>>>0))/4294967296)>>>0:0)],Pe[b>>2]=p[0],Pe[b+4>>2]=p[1],I.Ma&&a===0&&v===0&&(I.Ma=null),0}catch(x){if(typeof ir>"u"||x.name!=="ErrnoError")throw x;return x.aa}},fd_write:function(i,a,c,v){try{e:{var b=Vn(i);i=a;for(var I,x=a=0;x<c;x++){var $=Le[i>>2],V=Le[i+4>>2];i+=8;var M=b,ne=$,ae=V,ke=I,R=Ve;if(0>ae||0>ke)throw new Se(28);if(M.X===null)throw new Se(8);if((M.flags&2097155)===0)throw new Se(8);if((M.node.mode&61440)===16384)throw new Se(31);if(!M.m.write)throw new Se(28);M.seekable&&M.flags&1024&&ro(M,0,2);var te=typeof ke<"u";if(!te)ke=M.position;else if(!M.seekable)throw new Se(70);var Q=M.m.write(M,R,ne,ae,ke,void 0);te||(M.position+=Q);var Ke=Q;if(0>Ke){var Qe=-1;break e}a+=Ke,typeof I<"u"&&(I+=Ke)}Qe=a}return Le[v>>2]=Qe,0}catch(pe){if(typeof ir>"u"||pe.name!=="ErrnoError")throw pe;return pe.aa}},strftime_l:(i,a,c,v)=>oc(i,a,c,v)};(function(){function i(c){if(ye=c=c.exports,$e=ye.memory,yt(),he=ye.__indirect_function_table,oe.unshift(ye.__wasm_call_ctors),De--,g.monitorRunDependencies&&g.monitorRunDependencies(De),De==0&&et){var v=et;et=null,v()}return c}var a={env:To,wasi_snapshot_preview1:To};if(De++,g.monitorRunDependencies&&g.monitorRunDependencies(De),g.instantiateWasm)try{return g.instantiateWasm(a,i)}catch(c){Me("Module.instantiateWasm callback failed with error: "+c),F(c)}return xt(a,function(c){i(c.instance)}).catch(F),{}})();var Ln=i=>(Ln=ye.free)(i),Vs=i=>(Vs=ye.malloc)(i),xo=()=>(xo=ye.__errno_location)(),Po=g._ma_device__on_notification_unlocked=i=>(Po=g._ma_device__on_notification_unlocked=ye.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,a)=>(g._ma_malloc_emscripten=ye.ma_malloc_emscripten)(i,a),g._ma_free_emscripten=(i,a)=>(g._ma_free_emscripten=ye.ma_free_emscripten)(i,a);var jo=g._ma_device_process_pcm_frames_capture__webaudio=(i,a,c)=>(jo=g._ma_device_process_pcm_frames_capture__webaudio=ye.ma_device_process_pcm_frames_capture__webaudio)(i,a,c),Ro=g._ma_device_process_pcm_frames_playback__webaudio=(i,a,c)=>(Ro=g._ma_device_process_pcm_frames_playback__webaudio=ye.ma_device_process_pcm_frames_playback__webaudio)(i,a,c),Oo=i=>(Oo=ye.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=ye._embind_initialize_bindings)(),g.dynCall_iiji=(i,a,c,v,b)=>(g.dynCall_iiji=ye.dynCall_iiji)(i,a,c,v,b),g.dynCall_jiji=(i,a,c,v,b)=>(g.dynCall_jiji=ye.dynCall_jiji)(i,a,c,v,b),g.dynCall_iiiji=(i,a,c,v,b,I)=>(g.dynCall_iiiji=ye.dynCall_iiiji)(i,a,c,v,b,I),g.dynCall_iij=(i,a,c,v)=>(g.dynCall_iij=ye.dynCall_iij)(i,a,c,v),g.dynCall_jii=(i,a,c)=>(g.dynCall_jii=ye.dynCall_jii)(i,a,c),g.dynCall_viijii=(i,a,c,v,b,I,x)=>(g.dynCall_viijii=ye.dynCall_viijii)(i,a,c,v,b,I,x),g.dynCall_iiiiij=(i,a,c,v,b,I,x)=>(g.dynCall_iiiiij=ye.dynCall_iiiiij)(i,a,c,v,b,I,x),g.dynCall_iiiiijj=(i,a,c,v,b,I,x,$,V)=>(g.dynCall_iiiiijj=ye.dynCall_iiiiijj)(i,a,c,v,b,I,x,$,V),g.dynCall_iiiiiijj=(i,a,c,v,b,I,x,$,V,M)=>(g.dynCall_iiiiiijj=ye.dynCall_iiiiiijj)(i,a,c,v,b,I,x,$,V,M);var es;et=function i(){es||Mo(),es||(et=i)};function Mo(){function i(){if(!es&&(es=!0,g.calledRun=!0,!ze)){if(g.noFSInit||so||(so=!0,io(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?li("stdin",g.stdin):Ps("/dev/tty","/dev/stdin"),g.stdout?li("stdout",null,g.stdout):Ps("/dev/tty","/dev/stdout"),g.stderr?li("stderr",null,g.stderr):Ps("/dev/tty1","/dev/stderr"),$i("/dev/stdin",0),$i("/dev/stdout",1),$i("/dev/stderr",1)),Ya=!1,d(oe),E(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var a=g.postRun.shift();ie.unshift(a)}d(ie)}}if(!(0<De)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Te();d(fe),0<De||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Mo(),S.ready})})();const _=m}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m.Animation});var m=f(4)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m});var m=(function(){function _(w,S,g,E){this.animation=w,this.artboard=S,this.playing=E,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(w,S)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(w){this.instance.time=w},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(w){this.scrubTo===null?this.instance.advance(w):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(w){this.instance.apply(w)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>w.AudioAssetWrapper,AudioWrapper:()=>w.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>w.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>w.FileAssetWrapper,Finalizable:()=>w.Finalizable,FontAssetWrapper:()=>w.FontAssetWrapper,FontWrapper:()=>w.FontWrapper,ImageAssetWrapper:()=>w.ImageAssetWrapper,ImageWrapper:()=>w.ImageWrapper,finalizationRegistry:()=>w.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var m=f(6),_=f(7),w=f(8)}),((u,h,f)=>{f.r(h),f.d(h,{registerTouchInteractions:()=>w});var m=void 0,_=function(S,g){var E,F;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((E=S.touches)===null||E===void 0)&&E.length)?(g||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((F=S.changedTouches)===null||F===void 0)&&F.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},w=function(S){var g=S.canvas,E=S.artboard,F=S.stateMachines,O=F===void 0?[]:F,B=S.renderer,q=S.rive,N=S.fit,K=S.alignment,Y=S.isTouchScrollEnabled,D=Y===void 0?!1:Y,W=S.layoutScaleFactor,re=W===void 0?1:W;if(!g||!O.length||!B||!q||!E||typeof window>"u")return null;var Z=null,be=!1,ue=function(we){if(be&&we instanceof MouseEvent){we.type=="mouseup"&&(be=!1);return}be=D&&we.type==="touchend"&&Z==="touchstart",Z=we.type;var Me=we.currentTarget.getBoundingClientRect(),ce=_(we,D),$e=ce.clientX,ye=ce.clientY;if(!(!$e&&!ye)){var ze=$e-Me.left,Ve=ye-Me.top,je=q.computeAlignment(N,K,{minX:0,minY:0,maxX:Me.width,maxY:Me.height},E.bounds,re),Ne=new q.Mat2D;je.invert(Ne);var Je=new q.Vec2D(ze,Ve),Pe=q.mapXY(Ne,Je),Le=Pe.x(),ct=Pe.y();switch(Pe.delete(),Ne.delete(),Je.delete(),je.delete(),we.type){case"mouseout":for(var Be=0,yt=O;Be<yt.length;Be++){var he=yt[Be];he.pointerMove(Le,ct)}break;case"touchmove":case"mouseover":case"mousemove":{for(var fe=0,oe=O;fe<oe.length;fe++){var he=oe[fe];he.pointerMove(Le,ct)}break}case"touchstart":case"mousedown":{for(var ie=0,Te=O;ie<Te.length;ie++){var he=Te[ie];he.pointerDown(Le,ct)}break}case"touchend":case"mouseup":{for(var De=0,et=O;De<et.length;De++){var he=et[De];he.pointerUp(Le,ct)}break}}}},X=ue.bind(m);return g.addEventListener("mouseover",X),g.addEventListener("mouseout",X),g.addEventListener("mousemove",X),g.addEventListener("mousedown",X),g.addEventListener("mouseup",X),g.addEventListener("touchmove",X,{passive:D}),g.addEventListener("touchstart",X,{passive:D}),g.addEventListener("touchend",X),function(){g.removeEventListener("mouseover",X),g.removeEventListener("mouseout",X),g.removeEventListener("mousemove",X),g.removeEventListener("mousedown",X),g.removeEventListener("mouseup",X),g.removeEventListener("touchmove",X),g.removeEventListener("touchstart",X),g.removeEventListener("touchend",X)}}}),((u,h,f)=>{f.r(h),f.d(h,{BLANK_URL:()=>F,sanitizeUrl:()=>q});var m=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,w=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,E=[".","/"],F="about:blank";function O(N){return E.indexOf(N[0])>-1}function B(N){var K=N.replace(S,"");return K.replace(_,function(Y,D){return String.fromCharCode(D)})}function q(N){if(!N)return F;var K=B(N).replace(w,"").replace(S,"").trim();if(!K)return F;if(O(K))return K;var Y=K.match(g);if(!Y)return K;var D=Y[0];return m.test(D)?F:K}}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>B,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>E,FileAssetWrapper:()=>F,Finalizable:()=>_,FontAssetWrapper:()=>q,FontWrapper:()=>g,ImageAssetWrapper:()=>O,ImageWrapper:()=>w,finalizationRegistry:()=>Y});var m=(function(){var D=function(W,re){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,be){Z.__proto__=be}||function(Z,be){for(var ue in be)Object.prototype.hasOwnProperty.call(be,ue)&&(Z[ue]=be[ue])},D(W,re)};return function(W,re){if(typeof re!="function"&&re!==null)throw new TypeError("Class extends value "+String(re)+" is not a constructor or null");D(W,re);function Z(){this.constructor=W}W.prototype=re===null?Object.create(re):(Z.prototype=re.prototype,new Z)}})(),_=(function(){function D(){this.selfUnref=!1}return D})(),w=(function(D){m(W,D);function W(re){var Z=D.call(this)||this;return Z._nativeImage=re,Z}return Object.defineProperty(W.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},W})(_),S=(function(D){m(W,D);function W(re){var Z=D.call(this)||this;return Z._nativeAudio=re,Z}return Object.defineProperty(W.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},W})(_),g=(function(D){m(W,D);function W(re){var Z=D.call(this)||this;return Z._nativeFont=re,Z}return Object.defineProperty(W.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},W})(_),E=(function(){function D(W,re){this._assetLoaderCallback=re,this.assetLoader=new W.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return D.prototype.loadContents=function(W,re){var Z;return W.isImage?Z=new O(W):W.isAudio?Z=new B(W):W.isFont&&(Z=new q(W)),this._assetLoaderCallback(Z,re)},D})(),F=(function(){function D(W){this._nativeFileAsset=W}return D.prototype.decode=function(W){this._nativeFileAsset.decode(W)},Object.defineProperty(D.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),D})(),O=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setRenderImage=function(re){this._nativeFileAsset.setRenderImage(re.nativeImage)},W})(F),B=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setAudioSource=function(re){this._nativeFileAsset.setAudioSource(re.nativeAudio)},W})(F),q=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setFont=function(re){this._nativeFileAsset.setFont(re.nativeFont)},W})(F),N=(function(){function D(W){}return D.prototype.register=function(W){W.selfUnref=!0},D.prototype.unregister=function(W){},D})(),K=typeof FinalizationRegistry<"u"?FinalizationRegistry:N,Y=new K(function(D){D.unref()})})],r={};function s(u){var h=r[u];if(h!==void 0)return h.exports;var f=r[u]={exports:{}};return t[u](f,f.exports,s),f.exports}s.d=(u,h)=>{for(var f in h)s.o(h,f)&&!s.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},s.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>q,DataEnum:()=>ct,EventType:()=>ue,Fit:()=>B,Layout:()=>N,LoopType:()=>X,Rive:()=>Pe,RiveEventType:()=>W,RiveFile:()=>Je,RuntimeLoader:()=>K,StateMachineInput:()=>D,StateMachineInputType:()=>Y,Testing:()=>at,ViewModel:()=>Le,ViewModelInstance:()=>yt,ViewModelInstanceArtboard:()=>ge,ViewModelInstanceAssetImage:()=>se,ViewModelInstanceBoolean:()=>ie,ViewModelInstanceColor:()=>Xe,ViewModelInstanceEnum:()=>De,ViewModelInstanceList:()=>et,ViewModelInstanceNumber:()=>oe,ViewModelInstanceString:()=>fe,ViewModelInstanceTrigger:()=>Te,ViewModelInstanceValue:()=>he,decodeAudio:()=>Tt,decodeFont:()=>nt,decodeImage:()=>xt});var u=s(1),h=s(2),f=s(3),m=s(5),_=(function(){var p=function(o,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,P){k.__proto__=P}||function(k,P){for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(k[A]=P[A])},p(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(o,d);function k(){this.constructor=o}o.prototype=d===null?Object.create(d):(k.prototype=d.prototype,new k)}})(),w=function(){return w=Object.assign||function(p){for(var o,d=1,k=arguments.length;d<k;d++){o=arguments[d];for(var P in o)Object.prototype.hasOwnProperty.call(o,P)&&(p[P]=o[P])}return p},w.apply(this,arguments)},S=function(p,o,d,k){function P(A){return A instanceof d?A:new d(function(T){T(A)})}return new(d||(d=Promise))(function(A,T){function U(le){try{G(k.next(le))}catch(ve){T(ve)}}function H(le){try{G(k.throw(le))}catch(ve){T(ve)}}function G(le){le.done?A(le.value):P(le.value).then(U,H)}G((k=k.apply(p,o||[])).next())})},g=function(p,o){var d={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},k,P,A,T=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return T.next=U(0),T.throw=U(1),T.return=U(2),typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function U(G){return function(le){return H([G,le])}}function H(G){if(k)throw new TypeError("Generator is already executing.");for(;T&&(T=0,G[0]&&(d=0)),d;)try{if(k=1,P&&(A=G[0]&2?P.return:G[0]?P.throw||((A=P.return)&&A.call(P),0):P.next)&&!(A=A.call(P,G[1])).done)return A;switch(P=0,A&&(G=[G[0]&2,A.value]),G[0]){case 0:case 1:A=G;break;case 4:return d.label++,{value:G[1],done:!1};case 5:d.label++,P=G[1],G=[0];continue;case 7:G=d.ops.pop(),d.trys.pop();continue;default:if(A=d.trys,!(A=A.length>0&&A[A.length-1])&&(G[0]===6||G[0]===2)){d=0;continue}if(G[0]===3&&(!A||G[1]>A[0]&&G[1]<A[3])){d.label=G[1];break}if(G[0]===6&&d.label<A[1]){d.label=A[1],A=G;break}if(A&&d.label<A[2]){d.label=A[2],d.ops.push(G);break}A[2]&&d.ops.pop(),d.trys.pop();continue}G=o.call(p,d)}catch(le){G=[6,le],P=0}finally{k=A=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}},E=function(p,o,d){if(d||arguments.length===2)for(var k=0,P=o.length,A;k<P;k++)(A||!(k in o))&&(A||(A=Array.prototype.slice.call(o,0,k)),A[k]=o[k]);return p.concat(A||Array.prototype.slice.call(o))},F=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),O=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},B;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(B||(B={}));var q;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(q||(q={}));var N=(function(){function p(o){var d,k,P,A,T,U,H;this.fit=(d=o?.fit)!==null&&d!==void 0?d:B.Contain,this.alignment=(k=o?.alignment)!==null&&k!==void 0?k:q.Center,this.layoutScaleFactor=(P=o?.layoutScaleFactor)!==null&&P!==void 0?P:1,this.minX=(A=o?.minX)!==null&&A!==void 0?A:0,this.minY=(T=o?.minY)!==null&&T!==void 0?T:0,this.maxX=(U=o?.maxX)!==null&&U!==void 0?U:0,this.maxY=(H=o?.maxY)!==null&&H!==void 0?H:0}return p.new=function(o){var d=o.fit,k=o.alignment,P=o.minX,A=o.minY,T=o.maxX,U=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:d,alignment:k,minX:P,minY:A,maxX:T,maxY:U})},p.prototype.copyWith=function(o){var d=o.fit,k=o.alignment,P=o.layoutScaleFactor,A=o.minX,T=o.minY,U=o.maxX,H=o.maxY;return new p({fit:d??this.fit,alignment:k??this.alignment,layoutScaleFactor:P??this.layoutScaleFactor,minX:A??this.minX,minY:T??this.minY,maxX:U??this.maxX,maxY:H??this.maxY})},p.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===B.Cover?d=o.Fit.cover:this.fit===B.Contain?d=o.Fit.contain:this.fit===B.Fill?d=o.Fit.fill:this.fit===B.FitWidth?d=o.Fit.fitWidth:this.fit===B.FitHeight?d=o.Fit.fitHeight:this.fit===B.ScaleDown?d=o.Fit.scaleDown:this.fit===B.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},p.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===q.TopLeft?d=o.Alignment.topLeft:this.alignment===q.TopCenter?d=o.Alignment.topCenter:this.alignment===q.TopRight?d=o.Alignment.topRight:this.alignment===q.CenterLeft?d=o.Alignment.centerLeft:this.alignment===q.CenterRight?d=o.Alignment.centerRight:this.alignment===q.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===q.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===q.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},p})(),K=(function(){function p(){}return p.loadRuntime=function(){u.default({locateFile:function(){return p.wasmURL}}).then(function(o){var d;for(p.runtime=o;p.callBackQueue.length>0;)(d=p.callBackQueue.shift())===null||d===void 0||d(p.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var k="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==k)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),p.setWasmUrl(k),p.loadRuntime();else{var P=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(k,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(P)}})},p.getInstance=function(o){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?o(p.runtime):p.callBackQueue.push(o)},p.awaitInstance=function(){return new Promise(function(o){return p.getInstance(function(d){return o(d)})})},p.setWasmUrl=function(o){p.wasmURL=o},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),p})(),Y;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(Y||(Y={}));var D=(function(){function p(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===Y.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),W;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(W||(W={}));var re=(function(){function p(o){this.nativeArtboard=o}return p})(),Z=(function(){function p(o,d,k,P){this.stateMachine=o,this.playing=k,this.artboard=P,this.inputs=[],this.instance=new d.StateMachineInstance(o,P),this.initInputs(d)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),p.prototype.advance=function(o){this.instance.advance(o)},p.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},p.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var k=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(k,o))}},p.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new D(Y.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new D(Y.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new D(Y.Trigger,o.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},p})(),be=(function(){function p(o,d,k,P,A){P===void 0&&(P=[]),A===void 0&&(A=[]),this.runtime=o,this.artboard=d,this.eventManager=k,this.animations=P,this.stateMachines=A}return p.prototype.add=function(o,d,k){if(k===void 0&&(k=!0),o=tt(o),o.length===0)this.animations.forEach(function(_e){return _e.playing=d}),this.stateMachines.forEach(function(_e){return _e.playing=d});else for(var P=this.animations.map(function(_e){return _e.name}),A=this.stateMachines.map(function(_e){return _e.name}),T=0;T<o.length;T++){var U=P.indexOf(o[T]),H=A.indexOf(o[T]);if(U>=0||H>=0)U>=0?this.animations[U].playing=d:this.stateMachines[H].playing=d;else{var G=this.artboard.animationByName(o[T]);if(G){var le=new f.Animation(G,this.artboard,this.runtime,d);le.advance(0),le.apply(1),this.animations.push(le)}else{var ve=this.artboard.stateMachineByName(o[T]);if(ve){var de=new Z(ve,this.runtime,d,this.artboard);this.stateMachines.push(de)}}}}return k&&(d?this.eventManager.fire({type:ue.Play,data:this.playing}):this.eventManager.fire({type:ue.Pause,data:this.paused})),d?this.playing:this.paused},p.prototype.initLinearAnimations=function(o,d){for(var k=this.animations.map(function(H){return H.name}),P=0;P<o.length;P++){var A=k.indexOf(o[P]);if(A>=0)this.animations[A].playing=d;else{var T=this.artboard.animationByName(o[P]);if(T){var U=new f.Animation(T,this.artboard,this.runtime,d);U.advance(0),U.apply(1),this.animations.push(U)}else console.error("Animation with name ".concat(o[P]," not found."))}}},p.prototype.initStateMachines=function(o,d){for(var k=this.stateMachines.map(function(H){return H.name}),P=0;P<o.length;P++){var A=k.indexOf(o[P]);if(A>=0)this.stateMachines[A].playing=d;else{var T=this.artboard.stateMachineByName(o[P]);if(T){var U=new Z(T,this.runtime,d,this.artboard);this.stateMachines.push(U),d||U.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[P]," not found.")),this.initLinearAnimations([o[P]],d)}}},p.prototype.play=function(o){return this.add(o,!0)},p.prototype.pause=function(o){return this.add(o,!1)},p.prototype.scrub=function(o,d){var k=this.animations.filter(function(P){return o.includes(P.name)});return k.forEach(function(P){return P.scrubTo=d}),k.map(function(P){return P.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(o){var d=this;o=tt(o);var k=[];if(o.length===0)k=this.animations.map(function(T){return T.name}).concat(this.stateMachines.map(function(T){return T.name})),this.animations.forEach(function(T){return T.cleanup()}),this.stateMachines.forEach(function(T){return T.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var P=this.animations.filter(function(T){return o.includes(T.name)});P.forEach(function(T){T.cleanup(),d.animations.splice(d.animations.indexOf(T),1)});var A=this.stateMachines.filter(function(T){return o.includes(T.name)});A.forEach(function(T){T.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(T),1)}),k=P.map(function(T){return T.name}).concat(A.map(function(T){return T.name}))}return this.eventManager.fire({type:ue.Stop,data:k}),k},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var k;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([k=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([k=this.artboard.stateMachineByIndex(0).name],o,d)),k},p.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(P){return P.playing});o<d.length;o++){var k=d[o];k.loopValue===0&&k.loopCount?(k.loopCount=0,this.stop(k.name)):k.loopValue===1&&k.loopCount?(this.eventManager.fire({type:ue.Loop,data:{animation:k.name,type:X.Loop}}),k.loopCount=0):k.loopValue===2&&k.loopCount>1&&(this.eventManager.fire({type:ue.Loop,data:{animation:k.name,type:X.PingPong}}),k.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var o=[],d=0,k=this.stateMachines.filter(function(A){return A.playing});d<k.length;d++){var P=k[d];o.push.apply(o,P.statesChanged)}o.length>0&&this.eventManager.fire({type:ue.StateChange,data:o})},p.prototype.handleAdvancing=function(o){this.eventManager.fire({type:ue.Advance,data:o})},p})(),ue;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(ue||(ue={}));var X;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(X||(X={}));var we=(function(){function p(o){o===void 0&&(o=[]),this.listeners=o}return p.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},p.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},p.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var k=this.listeners[d];if(k.type===o.type&&k.callback===o.callback){this.listeners.splice(d,1);break}}},p.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(k){return k.type===o}).forEach(function(k){return d.remove(k)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(k){return k.callback(o)})},p})(),Me=(function(){function p(o){this.eventManager=o,this.queue=[]}return p.prototype.add=function(o){this.queue.push(o)},p.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},p})(),ce;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(ce||(ce={}));var $e=(function(p){_(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=ce.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return g(this,function(k){return[2,new Promise(function(P){return setTimeout(P,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return[2,new Promise(function(k,P){return setTimeout(P,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:ue.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return this._enabled||(this._enabled=!0,this._status=ce.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!(this._status===ce.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==ce.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,k=function(){return S(d,void 0,void 0,function(){return g(this,function(P){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",k,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return g(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===ce.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(we),ye=new $e,ze=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),Ve=globalThis.ResizeObserver||ze,je=(function(){function p(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var k=o._elementsMap.get(d.target);k!==null?k.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new Ve(this._onObserved)}return p.prototype.add=function(o,d){var k={onResize:d,element:o};return this._elementsMap.set(o,k),this._resizeObserver.observe(o),k},p.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},p})(),Ne=new je,Je=(function(){function p(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new we,o.onLoad&&this.on(ue.Load,o.onLoad),o.onLoadError&&this.on(ue.LoadError,o.onLoadError)}return p.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,k,P,A;return g(this,function(T){switch(T.label){case 0:return this.src?(o=this,[4,Ce(this.src)]):[3,2];case 1:o.buffer=T.sent(),T.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(k=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=k.assetLoader),P=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return P.file=T.sent(),this.destroyed?((A=this.file)===null||A===void 0||A.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:ue.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return g(this,function(k){switch(k.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];k.label=1;case 1:return k.trys.push([1,4,,5]),o=this,[4,K.awaitInstance()];case 2:return o.runtime=k.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return k.sent(),[3,5];case 4:return d=k.sent(),this.fireLoadError(d instanceof Error?d.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:ue.LoadError,data:o}),new Error(o)},p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new re(d):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),Pe=(function(){function p(o){var d=this,k;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(P){var A=d._hasZeroSize!==P;d._hasZeroSize=P,P?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():A&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=Ne.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(k=o.layout)!==null&&k!==void 0?k:new N,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new we,o.onLoad&&this.on(ue.Load,o.onLoad),o.onLoadError&&this.on(ue.LoadError,o.onLoadError),o.onPlay&&this.on(ue.Play,o.onPlay),o.onPause&&this.on(ue.Pause,o.onPause),o.onStop&&this.on(ue.Stop,o.onStop),o.onLoop&&this.on(ue.Loop,o.onLoop),o.onStateChange&&this.on(ue.StateChange,o.onStateChange),o.onAdvance&&this.on(ue.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(ue.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(ue.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(ue.Play,o.onplay),o.onpause&&!o.onPause&&this.on(ue.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(ue.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(ue.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(ue.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Me(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(o)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(o){var d=this,k=o.src,P=o.buffer,A=o.riveFile,T=o.animations,U=o.stateMachines,H=o.artboard,G=o.autoplay,le=G===void 0?!1:G,ve=o.useOffscreenRenderer,de=ve===void 0?!1:ve,_e=o.autoBind,Ue=_e===void 0?!1:_e;if(!this.destroyed){if(this.src=k,this.buffer=P,this.riveFile=A,!this.src&&!this.buffer&&!this.riveFile)throw new F(p.missingErrorMessage);var vt=tt(T),Fe=tt(U);this.loaded=!1,this.readyForPlaying=!1,K.awaitInstance().then(function(mt){d.destroyed||(d.runtime=mt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,de),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(H,vt,Fe,le,Ue).then(function(qe){if(qe)return d.setupRiveListeners()}).catch(function(qe){console.error(qe)}))}).catch(function(mt){console.error(mt)})}},p.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var k=(this.animator.stateMachines||[]).filter(function(A){return A.playing&&d.runtime.hasListeners(A.instance)}).map(function(A){return A.instance}),P=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(P=o.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:k,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:P,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var o=this,d;ye.status==ce.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:ue.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},ye.add(this._audioEventListener),ye.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(o,d,k,P,A){return S(this,void 0,void 0,function(){var T,U,H,G;return g(this,function(le){switch(le.label){case 0:return le.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(T=new Je({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=T,[4,T.init()]);case 1:if(le.sent(),this.destroyed)return T.destroyIfUnused(),[2,!1];le.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,k,P,A),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:ue.Load,data:(G=this.src)!==null&&G!==void 0?G:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return U=le.sent(),H=O(U),console.warn(H),this.eventManager.fire({type:ue.LoadError,data:H}),[2,Promise.reject(H)];case 4:return[2]}})})},p.prototype.initArtboard=function(o,d,k,P,A){if(this.file){var T=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!T){var U="Invalid artboard name or no default artboard";console.warn(U),this.eventManager.fire({type:ue.LoadError,data:U});return}if(this.artboard=T,T.volume=this._volume*ye.systemVolume,this.artboard.animationCount()<1){var U="Artboard has no animations";throw this.eventManager.fire({type:ue.LoadError,data:U}),U}this.animator=new be(this.runtime,this.artboard,this.eventManager);var H;if(d.length>0||k.length>0?(H=d.concat(k),this.animator.initLinearAnimations(d,P),this.animator.initStateMachines(k,P)):H=[this.animator.atLeastOne(P,!1)],this.taskQueue.add({event:{type:P?ue.Play:ue.Pause,data:H}}),A){var G=this.file.defaultArtboardViewModel(T);if(G!==null){var le=G.defaultInstance();if(le!==null){var ve=new yt(le,null);this.bindViewModelInstance(ve)}}}}},p.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(o,d){var k;this.frameRequestId=null;var P=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var A=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var T=this.animator.animations.filter(function(wn){return wn.playing||wn.needsScrub}).sort(function(wn){return wn.needsScrub?-1:1}),U=0,H=T;U<H.length;U++){var G=H[U];G.advance(A),G.instance.didLoop&&(G.loopCount+=1),G.apply(1)}for(var le=this.animator.stateMachines.filter(function(wn){return wn.playing}),ve=0,de=le;ve<de.length;ve++){var _e=de[ve],Ue=_e.reportedEventCount();if(Ue)for(var vt=0;vt<Ue;vt++){var Fe=_e.reportedEventAt(vt);if(Fe)if(Fe.type===W.OpenUrl){if(this.eventManager.fire({type:ue.RiveEvent,data:Fe}),this.automaticallyHandleEvents){var mt=document.createElement("a"),qe=Fe,It=qe.url,bt=qe.target,Ht=(0,m.sanitizeUrl)(It);It&&mt.setAttribute("href",Ht),bt&&mt.setAttribute("target",bt),Ht&&Ht!==m.BLANK_URL&&mt.click()}}else this.eventManager.fire({type:ue.RiveEvent,data:Fe})}_e.advanceAndApply(A)}this.animator.stateMachines.length==0&&this.artboard.advance(A);var Re=this.renderer;Re.clear(),Re.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Re),Re.restore(),Re.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(A),this.frameCount++;var dt=performance.now();for(this.frameTimes.push(dt),this.durations.push(dt-P);this.frameTimes[0]<=dt-1e3;)this.frameTimes.shift(),this.durations.shift();(k=this._viewModelInstance)===null||k===void 0||k.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var o=this,d=o.renderer,k=o.runtime,P=o._layout,A=o.artboard;d.align(P.runtimeFit(k),P.runtimeAlignment(k),{minX:P.minX,minY:P.minY,maxX:P.maxX,maxY:P.maxY},A.bounds,this._devicePixelRatioUsed*P.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&Ne.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ye.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var k=this.artboard.textRun(o);if(!k){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return k},p.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},p.prototype.setTextRunValue=function(o,d){var k=this.retrieveTextRun(o);k&&(k.text=d)},p.prototype.play=function(o,d){var k=this;if(o=tt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(o){var d=this;if(o=tt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},p.prototype.scrub=function(o,d){var k=this;if(o=tt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},p.prototype.stop=function(o){var d=this;if(o=tt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(o){var d,k,P=o?.artboard,A=tt(o?.animations),T=tt(o?.stateMachines),U=(d=o?.autoplay)!==null&&d!==void 0?d:!1,H=(k=o?.autoBind)!==null&&k!==void 0?k:!1;this.cleanupInstances(),this.initArtboard(P,A,T,U,H),this.taskQueue.process()},p.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),k=d.width,P=d.height,A=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=A,this.canvas.width=A*k,this.canvas.height=A*P,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===B.Layout){var T=this._layout.layoutScaleFactor;this.artboard.width=k/T,this.artboard.height=P/T}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(k){return k.name===o});return d?.inputs}},p.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var k=this.artboard.inputByPath(o,d);if(!k){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k},p.prototype.setBooleanStateAtPath=function(o,d,k){var P=this.retrieveInputAtPath(o,k);P&&(P.type===Y.Boolean?P.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(k,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(o,d,k){var P=this.retrieveInputAtPath(o,k);P&&(P.type===Y.Number?P.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(k,"' is not a number")))},p.prototype.fireStateAtPath=function(o,d){var k=this.retrieveInputAtPath(o,d);k&&(k.type===Y.Trigger?k.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var k=this.artboard.textByPath(o,d);if(!k){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k},p.prototype.getTextRunValueAtPath=function(o,d){var k=this.retrieveTextAtPath(o,d);if(!k){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k.text},p.prototype.setTextRunValueAtPath=function(o,d,k){var P=this.retrieveTextAtPath(o,k);if(!P){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(k,"'"));return}P.text=d},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var k=this.file.artboardByIndex(d),P={name:k.name,animations:[],stateMachines:[]},A=0;A<k.animationCount();A++){var T=k.animationByIndex(A);P.animations.push(T.name)}for(var U=0;U<k.stateMachineCount();U++){for(var H=k.stateMachineByIndex(U),G=H.name,le=new this.runtime.StateMachineInstance(H,k),ve=[],de=0;de<le.inputCount();de++){var _e=le.input(de);ve.push({name:_e.name,type:_e.type})}P.stateMachines.push({name:G,inputs:ve})}o.artboards.push(P)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*ye.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(k){return k.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Le(d):null},p.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Le(d):null},p.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new ct(d)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Le(o)}return null},p.prototype.getArtboard=function(o){var d,k;return(k=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&k!==void 0?k:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),Le=(function(){function p(o){this._viewModel=o}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new yt(d,null):null},p.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new yt(d,null):null},p.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new yt(o,null):null},p.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new yt(o,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),ct=(function(){function p(o){this._dataEnum=o}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),Be;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(Be||(Be={}));var yt=(function(){function p(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},p.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},p.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var k=this._parents[d];k.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},p.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(k){k.addToViewModelCallbacks(d)}))},p.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(k){return k!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(d)}))},p.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(k){k.addToViewModelCallbacks(d)}))},p.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(k){return k!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(d)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},p.prototype.propertyFromPath=function(o,d){var k=o.split("/");return this.propertyFromPathSegments(k,0,d)},p.prototype.viewModelFromPathSegments=function(o,d){var k=this.internalViewModelInstance(o[d]);return k!==null?d==o.length-1?k:k.viewModelFromPathSegments(o,d++):null},p.prototype.propertyFromPathSegments=function(o,d,k){var P,A,T,U,H,G,le,ve,de,_e,Ue,vt,Fe,mt,qe,It,bt,Ht;if(d<o.length-1){var Re=this.internalViewModelInstance(o[d]);return Re!==null?Re.propertyFromPathSegments(o,d+1,k):null}var dt=null;switch(k){case Be.Number:if(dt=(A=(P=this._runtimeInstance)===null||P===void 0?void 0:P.number(o[d]))!==null&&A!==void 0?A:null,dt!==null)return new oe(dt,this);break;case Be.String:if(dt=(U=(T=this._runtimeInstance)===null||T===void 0?void 0:T.string(o[d]))!==null&&U!==void 0?U:null,dt!==null)return new fe(dt,this);break;case Be.Boolean:if(dt=(G=(H=this._runtimeInstance)===null||H===void 0?void 0:H.boolean(o[d]))!==null&&G!==void 0?G:null,dt!==null)return new ie(dt,this);break;case Be.Color:if(dt=(ve=(le=this._runtimeInstance)===null||le===void 0?void 0:le.color(o[d]))!==null&&ve!==void 0?ve:null,dt!==null)return new Xe(dt,this);break;case Be.Trigger:if(dt=(_e=(de=this._runtimeInstance)===null||de===void 0?void 0:de.trigger(o[d]))!==null&&_e!==void 0?_e:null,dt!==null)return new Te(dt,this);break;case Be.Enum:if(dt=(vt=(Ue=this._runtimeInstance)===null||Ue===void 0?void 0:Ue.enum(o[d]))!==null&&vt!==void 0?vt:null,dt!==null)return new De(dt,this);break;case Be.List:if(dt=(mt=(Fe=this._runtimeInstance)===null||Fe===void 0?void 0:Fe.list(o[d]))!==null&&mt!==void 0?mt:null,dt!==null)return new et(dt,this);break;case Be.Image:if(dt=(It=(qe=this._runtimeInstance)===null||qe===void 0?void 0:qe.image(o[d]))!==null&&It!==void 0?It:null,dt!==null)return new se(dt,this);break;case Be.Artboard:if(dt=(Ht=(bt=this._runtimeInstance)===null||bt===void 0?void 0:bt.artboard(o[d]))!==null&&Ht!==void 0?Ht:null,dt!==null)return new ge(dt,this);break}return null},p.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var k=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(k!==null){var P=new p(k,this);return P.internalIncrementReferenceCount(),this._viewModelInstances.set(o,P),P}return null},p.prototype.number=function(o){var d=this.propertyFromPath(o,Be.Number);return d},p.prototype.string=function(o){var d=this.propertyFromPath(o,Be.String);return d},p.prototype.boolean=function(o){var d=this.propertyFromPath(o,Be.Boolean);return d},p.prototype.color=function(o){var d=this.propertyFromPath(o,Be.Color);return d},p.prototype.trigger=function(o){var d=this.propertyFromPath(o,Be.Trigger);return d},p.prototype.enum=function(o){var d=this.propertyFromPath(o,Be.Enum);return d},p.prototype.list=function(o){var d=this.propertyFromPath(o,Be.List);return d},p.prototype.image=function(o){var d=this.propertyFromPath(o,Be.Image);return d},p.prototype.artboard=function(o){var d=this.propertyFromPath(o,Be.Artboard);return d},p.prototype.viewModel=function(o){var d=o.split("/"),k=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return k!=null?k.internalViewModelInstance(d[d.length-1]):null},p.prototype.internalReplaceViewModel=function(o,d){var k;if(d.runtimeInstance!==null){var P=((k=this._runtimeInstance)===null||k===void 0?void 0:k.replaceViewModel(o,d.runtimeInstance))||!1;if(P){d.internalIncrementReferenceCount();var A=this.internalViewModelInstance(o);A!==null&&(A.removeParent(this),this._children.includes(A)&&(this._children=this._children.filter(function(T){return T!==A})),A.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return P}return!1},p.prototype.replaceViewModel=function(o,d){var k,P=o.split("/"),A=P.length>1?this.viewModelFromPathSegments(P.slice(0,P.length-1),0):this;return(k=A?.internalReplaceViewModel(P[P.length-1],d))!==null&&k!==void 0?k:!1},p.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return w({},d)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(P){P.cleanup()}),this._viewModelInstances.clear();var d=E([],this._children,!0);this._children.length=0;var k=E([],this._parents,!0);this._parents.length=0,d.forEach(function(P){P.removeParent(o)}),k.forEach(function(P){P.removeFromViewModelCallbacks(o)})}},p})(),he=(function(){function p(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return p.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(o){},p.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),fe=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(he),oe=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(he),ie=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(he),Te=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(he),De=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(he),et=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,k){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,k)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var k=this._viewModelInstanceValue.instanceAt(d);if(k!=null){var P=new yt(k,this._parentViewModel);return P}return null},o.prototype.swap=function(d,k){this._viewModelInstanceValue.swap(d,k)},o.prototype.internalHandleCallback=function(d){d()},o})(he),Xe=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,k,P){this._viewModelInstanceValue.rgb(d,k,P)},o.prototype.rgba=function(d,k,P,A){this._viewModelInstanceValue.argb(A,d,k,P)},o.prototype.argb=function(d,k,P,A){this._viewModelInstanceValue.argb(d,k,P,A)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(he),se=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var k;this._viewModelInstanceValue.value((k=d?.nativeImage)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(he),ge=(function(p){_(o,p);function o(d,k){return p.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var k;this._viewModelInstanceValue.value((k=d?.nativeArtboard)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(he),Ce=function(p){return S(void 0,void 0,void 0,function(){var o,d,k;return g(this,function(P){switch(P.label){case 0:return o=new Request(p),[4,fetch(o)];case 1:return d=P.sent(),[4,d.arrayBuffer()];case 2:return k=P.sent(),[2,k]}})})},tt=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},at={EventManager:we,TaskQueueManager:Me},Tt=function(p){return S(void 0,void 0,void 0,function(){var o,d,k;return g(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeAudio(p,A)})}),[4,o];case 1:return d=P.sent(),k=new m.AudioWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})},xt=function(p){return S(void 0,void 0,void 0,function(){var o,d,k;return g(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeImage(p,A)})}),[4,o];case 1:return d=P.sent(),k=new m.ImageWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})},nt=function(p){return S(void 0,void 0,void 0,function(){var o,d,k;return g(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeFont(p,A)})}),[4,o];case 1:return d=P.sent(),k=new m.FontWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})}})(),l})())})(ds)),ds.exports}var Yv=Kv();const Lu="dracula",ys="https://vycjpmuyscfygstjjied.supabase.co";var Jv=ee('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Tl(n,e){Bt(e,!0);let t=yn(e,"bucketName",3,Lu),r=Ze(void 0);Pi(()=>{if(!y(r))return;const u=new Yv.Rive({src:`${ys}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:y(r),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var s=Jv(),l=C(s);va(l,u=>Ie(r,u),()=>y(r)),z(n,s),Wt()}function Xv(n,e,t,r,s,l){e()?t.onLose?t.onLose():r("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var Qv=ee('<button class="btn btn-danger svelte-545h2y">🏳️ Сдаться</button>'),Zv=ee('<div role="button" tabindex="0"> </div>'),ep=bd('<polyline class="connection-line svelte-545h2y" vector-effect="non-scaling-stroke"></polyline>'),tp=ee('<div class="item-icon reward-glow svelte-545h2y"><img class="icon-preview svelte-545h2y" height="64px"/></div>'),np=ee('<div id="reward-panel" class="svelte-545h2y"><!> <div class="reward-info svelte-545h2y"><div class="reward-label svelte-545h2y">Награда:</div> <div class="reward-name svelte-545h2y"> </div></div></div>'),rp=ee('<span class="cooldown-timer svelte-545h2y"> </span>'),ip=ee("<button> </button>"),sp=ee('<div id="modal-overlay"><div class="modal-content svelte-545h2y"><div class="modal-title svelte-545h2y"> </div> <div class="modal-text svelte-545h2y"> </div> <div class="modal-buttons svelte-545h2y"></div></div></div>'),ap=ee('<div class="body-wrapper svelte-545h2y"><div id="game-header" class="svelte-545h2y"><button class="btn btn-secondary svelte-545h2y">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-545h2y"><div id="grid" class="svelte-545h2y"></div> <svg id="line-layer" class="svelte-545h2y"><!></svg></div> <div id="game-header" class="svelte-545h2y"><!> <span class="tiles-counter svelte-545h2y">Осталось: <strong class="svelte-545h2y"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function op(n,e){Bt(e,!0);let t=yn(e,"integrated",3,!1),r=yn(e,"rewardItem",3,null),s=yn(e,"items",19,()=>[]),l=yn(e,"bucketName",3,"dracula");const u=gu(),h=8,f=6,m=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=Ze(Ot([])),w=Ze(Ot([])),S=Ze(Ot({})),g=Ze(Ot([])),E=Ze(null),F=Ze(!1),O=Ze(!1),B=Ze(Ot([])),q=Ze(0),N=Ze(0);const K=5;let Y=Ze(Ot({show:!1,title:"",text:"",actions:[]})),D,W;Pi(()=>{we()});function re(){if(!y(w)||y(w).length===0)return 0;let A=0;for(let T=0;T<h;T++)for(let U=0;U<f;U++)y(w)[T]&&!y(w)[T][U]&&A++;return A}let Z=cn(re),be=cn(()=>y(N)<1);function ue(){if(!r()||!s()||s().length===0)return null;const A=typeof r()=="string"?r():r().id;return s().find(T=>T.id===A)}let X=cn(ue);function we(){Ie(_,[],!0),Ie(w,[],!0),Ie(E,null),Ie(F,!1),Ie(O,!1),Ie(S,{},!0),Ie(g,[],!0),Ie(B,[],!0),Ie(N,0),Be();let A=[...new Set(m)];for(;A.length<h*f/2;)A=[...A,...A];let T=A.sort(()=>.5-Math.random()).slice(0,h*f/2),U=[];T.forEach(G=>U.push(G,G)),U.sort(()=>Math.random()-.5);let H=0;for(let G=0;G<h;G++){let le=[],ve=[];for(let de=0;de<f;de++)le.push(U[H++]),ve.push(!1);y(_).push(le),y(w).push(ve)}setTimeout(ze,500)}async function Me(A,T){if(y(F)||y(w)[A][T]||y(O))return;if(y(g).length>0&&Ie(g,[],!0),!y(E)){Ie(E,{r:A,c:T},!0);return}if(y(E).r===A&&y(E).c===T){Ie(E,null);return}const U=y(_)[y(E).r][y(E).c],H=y(_)[A][T];if(U===H){const G=Pe(y(E).r,y(E).c,A,T);if(G){Ie(F,!0),await Le(G),y(w)[y(E).r][y(E).c]=!0,y(w)[A][T]=!0,Ie(E,null),Ie(F,!1),$e(),ze();return}}Ie(E,{r:A,c:T},!0)}async function ce(A,T,U){(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),await Me(A,T))}function $e(){Ie(N,K);const A=setInterval(()=>{ca(N,-1),y(N)<=0&&clearInterval(A)},1e3)}function ye(){if(y(F)||y(O)||!y(be))return;let A=[];for(let U=0;U<h;U++)for(let H=0;H<f;H++)y(w)[U][H]||A.push({r:U,c:H,icon:y(_)[U][H]});let T={};A.forEach(U=>{T[U.icon]||(T[U.icon]=[]),T[U.icon].push(U)});for(let U in T){let H=T[U];if(!(H.length<2))for(let G=0;G<H.length;G++)for(let le=G+1;le<H.length;le++){let ve=H[G],de=H[le];if(Pe(ve.r,ve.c,de.r,de.c)){Ie(g,[ve,de],!0),setTimeout(()=>Ie(g,[],!0),1500);return}}}ct("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:Be}])}function ze(){if(y(Z)===0){Ie(O,!0),t()?e.onWin?e.onWin():u("win"):ct("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:we}]);return}Ve()||(t()?setTimeout(()=>je(),1e3):ct("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{Be(),je()}},{text:"Сдаться",action:()=>{ct("Конец","Попытайте удачу снова!",[{text:"ОК",action:we}])}}]))}function Ve(){let A=[];for(let U=0;U<h;U++)for(let H=0;H<f;H++)y(w)[U][H]||A.push({r:U,c:H,icon:y(_)[U][H]});let T={};A.forEach(U=>{T[U.icon]||(T[U.icon]=[]),T[U.icon].push(U)});for(let U in T){let H=T[U];if(!(H.length<2)){for(let G=0;G<H.length;G++)for(let le=G+1;le<H.length;le++)if(Pe(H[G].r,H[G].c,H[le].r,H[le].c))return!0}}return!1}function je(){let A=[],T=[];for(let U=0;U<h;U++)for(let H=0;H<f;H++)y(w)[U][H]||(A.push(y(_)[U][H]),T.push({r:U,c:H}));A.length!==0&&(A.sort(()=>Math.random()-.5),T.forEach((U,H)=>{y(_)[U.r][U.c]=A[H],y(S)[`${U.r},${U.c}`]=!0}),setTimeout(()=>{Ie(S,{},!0),Ve()?Ie(O,!1):je()},500))}function Ne(A,T){return A<0||A>=h||T<0||T>=f?!0:y(w)[A][T]}function Je(A,T,U,H){if(A!==U&&T!==H)return!1;if(A===U){const G=Math.min(T,H),le=Math.max(T,H);for(let ve=G+1;ve<le;ve++)if(!Ne(A,ve))return!1}else{const G=Math.min(A,U),le=Math.max(A,U);for(let ve=G+1;ve<le;ve++)if(!Ne(ve,T))return!1}return!0}function Pe(A,T,U,H){if(Je(A,T,U,H))return[{r:A,c:T},{r:U,c:H}];let G={r:A,c:H};if(Ne(G.r,G.c)&&Je(A,T,G.r,G.c)&&Je(G.r,G.c,U,H))return[{r:A,c:T},G,{r:U,c:H}];let le={r:U,c:T};if(Ne(le.r,le.c)&&Je(A,T,le.r,le.c)&&Je(le.r,le.c,U,H))return[{r:A,c:T},le,{r:U,c:H}];for(let ve=-1;ve<=h;ve++){if(ve===A||ve===U)continue;let de={r:ve,c:T},_e={r:ve,c:H};if(Ne(de.r,de.c)&&Ne(_e.r,_e.c)&&Je(A,T,de.r,de.c)&&Je(de.r,de.c,_e.r,_e.c)&&Je(_e.r,_e.c,U,H))return[{r:A,c:T},de,_e,{r:U,c:H}]}for(let ve=-1;ve<=f;ve++){if(ve===T||ve===H)continue;let de={r:A,c:ve},_e={r:U,c:ve};if(Ne(de.r,de.c)&&Ne(_e.r,_e.c)&&Je(A,T,de.r,de.c)&&Je(de.r,de.c,_e.r,_e.c)&&Je(_e.r,_e.c,U,H))return[{r:A,c:T},de,_e,{r:U,c:H}]}return null}async function Le(A){if(await uu(),!D||!W)return;const T=D.getBoundingClientRect(),U=W.getBoundingClientRect(),H=W.querySelector(".cell");if(!H)return;const G=H.offsetWidth,le=H.offsetHeight,ve=window.getComputedStyle(W),de=parseFloat(ve.gap)||4,_e=U.left-T.left,Ue=U.top-T.top,vt=A.map(Fe=>{let mt,qe;if(Fe.r>=0&&Fe.r<h&&Fe.c>=0&&Fe.c<f){const bt=W.children[Fe.r*f+Fe.c].getBoundingClientRect();mt=bt.left-T.left+bt.width/2,qe=bt.top-T.top+bt.height/2}else{const It=Fe.c*(G+de)+G/2,bt=Fe.r*(le+de)+le/2;mt=_e+It,qe=Ue+bt}return`${mt.toFixed(1)},${qe.toFixed(1)}`}).join(" ");return Ie(B,vt,!0),ca(q),new Promise(Fe=>{setTimeout(()=>{Ie(B,[],!0),Fe()},350)})}function ct(A,T,U){t()||Ie(Y,{show:!0,title:A,text:T,actions:U},!0)}function Be(){y(Y).show=!1}var yt=ap(),he=jt(yt),fe=C(he),oe=C(fe);oe.__click=we;var ie=j(oe,2);{var Te=A=>{var T=Qv();T.__click=[Xv,t,e,u,ct,we],z(A,T)};xe(ie,A=>{t()&&A(Te)})}var De=j(fe,2),et=C(De);pu(et,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),kt(et,21,()=>y(_),rn,(A,T,U)=>{var H=Kt(),G=jt(H);kt(G,17,()=>y(T),rn,(le,ve,de)=>{var _e=Zv();let Ue;_e.__click=()=>Me(U,de),_e.__keydown=Fe=>ce(U,de,Fe);var vt=C(_e);Ee(Fe=>{Ue=qt(_e,1,"cell svelte-545h2y",null,Ue,Fe),Ae(vt,y(ve))},[()=>({selected:y(E)?.r===U&&y(E)?.c===de,matched:y(w)[U][de],shuffling:y(S)[`${U},${de}`],"hint-glow":y(g).some(Fe=>Fe.r===U&&Fe.c===de)})]),z(le,_e)}),z(A,H)}),va(et,A=>W=A,()=>W);var Xe=j(et,2),se=C(Xe);fa(se,()=>y(q),A=>{var T=Kt(),U=jt(T);{var H=G=>{var le=ep();Ee(()=>Oe(le,"points",y(B))),z(G,le)};xe(U,G=>{y(B)&&G(H)})}z(A,T)}),va(De,A=>D=A,()=>D);var ge=j(De,2),Ce=C(ge);{var tt=A=>{var T=np(),U=C(T);{var H=de=>{var _e=tp(),Ue=C(_e);Ee(()=>{Oe(Ue,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${y(X).icon}`),Oe(Ue,"alt",y(X).name)}),z(de,_e)};xe(U,de=>{y(X).icon&&de(H)})}var G=j(U,2),le=j(C(G),2),ve=C(le);Ee(()=>Ae(ve,y(X).name)),z(A,T)};xe(Ce,A=>{y(X)&&A(tt)})}var at=j(Ce,2),Tt=j(C(at)),xt=C(Tt),nt=j(at,2);let p;nt.__click=ye;var o=j(C(nt));{var d=A=>{var T=rp(),U=C(T);Ee(()=>Ae(U,`(${y(N)??""})`)),z(A,T)};xe(o,A=>{y(N)>0&&A(d)})}var k=j(he,2);{var P=A=>{var T=sp();let U;var H=C(T),G=C(H),le=C(G),ve=j(G,2),de=C(ve),_e=j(ve,2);kt(_e,21,()=>y(Y).actions,Ue=>Ue.text,(Ue,vt)=>{var Fe=ip();let mt;Fe.__click=function(...It){y(vt).action?.apply(this,It)};var qe=C(Fe);Ee(It=>{mt=qt(Fe,1,"btn svelte-545h2y",null,mt,It),Ae(qe,y(vt).text)},[()=>({"btn-secondary":y(vt).class==="btn-secondary"})]),z(Ue,Fe)}),Ee(Ue=>{U=qt(T,1,"svelte-545h2y",null,U,Ue),Ae(le,y(Y).title),Ae(de,y(Y).text)},[()=>({active:y(Y).show})]),z(A,T)};xe(k,A=>{y(Y).show&&A(P)})}Ee(A=>{Ae(xt,y(Z)),p=qt(nt,1,"btn btn-secondary svelte-545h2y",null,p,A),nt.disabled=!y(be)},[()=>({disabled:!y(be),"cooldown-active":y(N)>0})]),z(n,yt),Wt()}Yt(["click","keydown"]);function lp(n,e,t,r,s,l,u,h,f,m){if(!(y(e)||y(t)||!y(r)))for(let _=0;_<s;_++)for(let w=0;w<l;w++){if(y(u)[_][w]||y(h)[_][w])continue;let S=y(f)[_][w];for(let g=0;g<s;g++)for(let E=0;E<l;E++)if(!(_===g&&w===E)&&!(y(u)[g][E]||y(h)[g][E])&&y(f)[g][E]===S){Ie(m,[{r:_,c:w},{r:g,c:E}],!0),setTimeout(()=>Ie(m,[],!0),1500);return}}}function up(n,e,t,r,s,l){e()?t.onLose?t.onLose():r("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var cp=ee('<button class="btn btn-danger svelte-q16t3v">🏳️ Сдаться</button>'),dp=ee('<div role="button" tabindex="0"><div class="card-inner svelte-q16t3v"><div class="card-front svelte-q16t3v"> </div> <div class="card-back svelte-q16t3v">?</div></div></div>'),hp=ee('<div class="item-icon reward-glow svelte-q16t3v"><img class="icon-preview svelte-q16t3v" height="64px"/></div>'),fp=ee('<div id="reward-panel" class="svelte-q16t3v"><!> <div class="reward-info svelte-q16t3v"><div class="reward-label svelte-q16t3v">Награда:</div> <div class="reward-name svelte-q16t3v"> </div></div></div>'),vp=ee('<span class="cooldown-timer svelte-q16t3v"> </span>'),pp=ee("<button> </button>"),gp=ee('<div id="modal-overlay"><div class="modal-content svelte-q16t3v"><div class="modal-title svelte-q16t3v"> </div> <div class="modal-text svelte-q16t3v"> </div> <div class="modal-buttons svelte-q16t3v"></div></div></div>'),_p=ee('<div class="body-wrapper svelte-q16t3v"><div id="game-header" class="svelte-q16t3v"><button class="btn btn-secondary svelte-q16t3v">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-q16t3v"><div id="grid" class="svelte-q16t3v"></div></div> <div id="game-header" class="svelte-q16t3v"><!> <span class="tiles-counter svelte-q16t3v">Осталось: <strong class="svelte-q16t3v"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function mp(n,e){Bt(e,!0);let t=yn(e,"integrated",3,!1),r=yn(e,"rewardItem",3,null),s=yn(e,"items",19,()=>[]),l=yn(e,"bucketName",3,"dracula");const u=gu(),h=4,f=4,m=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=Ze(Ot([])),w=Ze(Ot([])),S=Ze(Ot([])),g=Ze(Ot([])),E=Ze(null),F=Ze(!1),O=Ze(!1),B=Ze(0);const q=5;let N=Ze(Ot({show:!1,title:"",text:"",actions:[]}));Pi(()=>{Z()});function K(){if(!y(w)||y(w).length===0)return 0;let se=0;for(let ge=0;ge<h;ge++)for(let Ce=0;Ce<f;Ce++)y(w)[ge]&&!y(w)[ge][Ce]&&se++;return se}let Y=cn(K),D=cn(()=>y(B)<1);function W(){if(!r()||!s()||s().length===0)return null;const se=typeof r()=="string"?r():r().id;return s().find(ge=>ge.id===se)}let re=cn(W);function Z(){Ie(_,[],!0),Ie(w,[],!0),Ie(S,[],!0),Ie(E,null),Ie(F,!1),Ie(O,!1),Ie(g,[],!0),Ie(B,0),ce();let se=[...new Set(m)];for(;se.length<h*f/2;)se=[...se,...se];let ge=se.sort(()=>.5-Math.random()).slice(0,h*f/2),Ce=[];ge.forEach(at=>Ce.push(at,at)),Ce.sort(()=>Math.random()-.5);let tt=0;for(let at=0;at<h;at++){let Tt=[],xt=[],nt=[];for(let p=0;p<f;p++)Tt.push(Ce[tt++]),xt.push(!1),nt.push(!1);y(_).push(Tt),y(w).push(xt),y(S).push(nt)}}async function be(se,ge){if(!(y(F)||y(w)[se][ge]||y(O))){if(y(E)&&y(E).r===se&&y(E).c===ge){y(S)[se][ge]=!1,Ie(E,null);return}if(!y(S)[se][ge])if(y(g).length>0&&Ie(g,[],!0),y(S)[se][ge]=!0,!y(E))Ie(E,{r:se,c:ge},!0);else{Ie(F,!0);const Ce={r:se,c:ge},tt=y(_)[y(E).r][y(E).c],at=y(_)[Ce.r][Ce.c];tt===at?setTimeout(()=>{y(w)[y(E).r][y(E).c]=!0,y(w)[Ce.r][Ce.c]=!0,y(S)[y(E).r][y(E).c]=!1,y(S)[Ce.r][Ce.c]=!1,Ie(E,null),Ie(F,!1),X(),we()},600):setTimeout(()=>{y(S)[y(E).r][y(E).c]=!1,y(S)[Ce.r][Ce.c]=!1,Ie(E,null),Ie(F,!1)},1e3)}}}async function ue(se,ge,Ce){(Ce.key==="Enter"||Ce.key===" ")&&(Ce.preventDefault(),await be(se,ge))}function X(){Ie(B,q);const se=setInterval(()=>{ca(B,-1),y(B)<=0&&clearInterval(se)},1e3)}function we(){if(y(Y)===0){Ie(O,!0),t()?e.onWin?e.onWin():u("win"):Me("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:Z}]);return}}function Me(se,ge,Ce){t()||Ie(N,{show:!0,title:se,text:ge,actions:Ce},!0)}function ce(){y(N).show=!1}var $e=_p(),ye=jt($e),ze=C(ye),Ve=C(ze);Ve.__click=Z;var je=j(Ve,2);{var Ne=se=>{var ge=cp();ge.__click=[up,t,e,u,Me,Z],z(se,ge)};xe(je,se=>{t()&&se(Ne)})}var Je=j(ze,2),Pe=C(Je);pu(Pe,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),kt(Pe,21,()=>y(_),rn,(se,ge,Ce)=>{var tt=Kt(),at=jt(tt);kt(at,17,()=>y(ge),rn,(Tt,xt,nt)=>{var p=dp();let o;p.__click=()=>be(Ce,nt),p.__keydown=A=>ue(Ce,nt,A);var d=C(p),k=C(d),P=C(k);Ee(A=>{o=qt(p,1,"cell svelte-q16t3v",null,o,A),Ae(P,y(xt))},[()=>({flipped:y(S)[Ce][nt],matched:y(w)[Ce][nt],selected:y(E)?.r===Ce&&y(E)?.c===nt,"hint-glow":y(g).some(A=>A.r===Ce&&A.c===nt)})]),z(Tt,p)}),z(se,tt)});var Le=j(Je,2),ct=C(Le);{var Be=se=>{var ge=fp(),Ce=C(ge);{var tt=nt=>{var p=hp(),o=C(p);Ee(()=>{Oe(o,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${y(re).icon}`),Oe(o,"alt",y(re).name)}),z(nt,p)};xe(Ce,nt=>{y(re).icon&&nt(tt)})}var at=j(Ce,2),Tt=j(C(at),2),xt=C(Tt);Ee(()=>Ae(xt,y(re).name)),z(se,ge)};xe(ct,se=>{y(re)&&se(Be)})}var yt=j(ct,2),he=j(C(yt)),fe=C(he),oe=j(yt,2);let ie;oe.__click=[lp,F,O,D,h,f,w,S,_,g];var Te=j(C(oe));{var De=se=>{var ge=vp(),Ce=C(ge);Ee(()=>Ae(Ce,`(${y(B)??""})`)),z(se,ge)};xe(Te,se=>{y(B)>0&&se(De)})}var et=j(ye,2);{var Xe=se=>{var ge=gp();let Ce;var tt=C(ge),at=C(tt),Tt=C(at),xt=j(at,2),nt=C(xt),p=j(xt,2);kt(p,21,()=>y(N).actions,o=>o.text,(o,d)=>{var k=pp();let P;k.__click=function(...T){y(d).action?.apply(this,T)};var A=C(k);Ee(T=>{P=qt(k,1,"btn svelte-q16t3v",null,P,T),Ae(A,y(d).text)},[()=>({"btn-secondary":y(d).class==="btn-secondary"})]),z(o,k)}),Ee(o=>{Ce=qt(ge,1,"svelte-q16t3v",null,Ce,o),Ae(Tt,y(N).title),Ae(nt,y(N).text)},[()=>({active:y(N).show})]),z(se,ge)};xe(et,se=>{y(N).show&&se(Xe)})}Ee(se=>{Ae(fe,y(Y)),ie=qt(oe,1,"btn btn-secondary svelte-q16t3v",null,ie,se),oe.disabled=!y(D)},[()=>({disabled:!y(D),"cooldown-active":y(B)>0})]),z(n,$e),Wt()}Yt(["click","keydown"]);var yp=ee('<div class="loading svelte-15dde84">Загрузка игры...</div>'),bp=ee('<div class="minigame-container svelte-15dde84"><!></div>');function wp(n,e){Bt(e,!0);function t(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function r(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var s=bp(),l=C(s);{var u=f=>{op(f,{onWin:t,onLose:r,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},h=f=>{var m=Kt(),_=jt(m);{var w=g=>{mp(g,{onWin:t,onLose:r,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},S=g=>{var E=yp();z(g,E)};xe(_,g=>{e.gameId==="memo_monsters"?g(w):g(S,!1)},!0)}z(f,m)};xe(l,f=>{e.gameId==="onet_monsters"?f(u):f(h,!1)})}z(n,s),Wt()}function kp(n,e){y(e)?.nextDialogueId&&wt.goToDialogue(y(e).nextDialogueId)}var Ip=ee('<img alt="BG" class="background-image svelte-fl90wm"/>'),Ep=ee('<div class="background-media svelte-fl90wm"><!></div>'),Sp=ee('<img alt="Char" class="character-image svelte-fl90wm"/>'),Ap=ee('<div class="character-media svelte-fl90wm"><!></div>'),Cp=(n,e,t)=>e(y(t)),Tp=ee("<button> </button>"),xp=ee('<div class="options-container svelte-fl90wm"></div>'),Pp=ee('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),jp=ee('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),Rp=ee("<p> </p>");function Du(n,e){Bt(e,!0);let t=yn(e,"bucketName",3,Lu);console.log(t());const r=cn(()=>e.dialogue||wt.findDialogue(wt.currentDialogueId));let s=Ze(null);Zr(()=>{y(r)?.onEnter&&wt.runActions(y(r).onEnter)});function l(E){if(E.actions&&wt.runActions(E.actions),E.miniGame){console.log("Запуск мини-игры:",E.miniGame.id),Ie(s,{gameId:E.miniGame.id,onWinDialogueId:E.miniGame.onWinDialogueId,onLoseDialogueId:E.miniGame.onLoseDialogueId,rewardItem:E.miniGame.rewardItem},!0);return}E.nextDialogueId&&wt.goToDialogue(E.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),y(s)?.rewardItem&&wt.addItem(y(s).rewardItem),y(s)?.onWinDialogueId&&wt.goToDialogue(y(s).onWinDialogueId),Ie(s,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),y(s)?.onLoseDialogueId&&wt.goToDialogue(y(s).onLoseDialogueId),Ie(s,null)}function f(E){return E.visible===!1?!1:wt.checkVisibilityCondition(E)}function m(E){return E.enabled!==!1}var _=Kt(),w=jt(_);{var S=E=>{var F=jp(),O=C(F);{var B=X=>{{let we=cn(()=>wt.storyData?.items);wp(X,{get gameId(){return y(s).gameId},onWin:u,onLose:h,get rewardItem(){return y(s).rewardItem},get items(){return y(we)},get bucketName(){return t()}})}};xe(O,X=>{y(s)&&X(B)})}var q=j(O,2);{var N=X=>{var we=Ep(),Me=C(we);{var ce=ye=>{var ze=Kt(),Ve=jt(ze);fa(Ve,()=>y(r).backgroundImage,je=>{Tl(je,{get fileName(){return y(r).backgroundImage},get bucketName(){return t()}})}),z(ye,ze)},$e=ye=>{var ze=Ip();Ee(()=>Oe(ze,"src",`${ys}/storage/v1/object/public/${t()}/${y(r).backgroundImage}`)),z(ye,ze)};xe(Me,ye=>{y(r).backgroundImage.endsWith(".riv")?ye(ce):ye($e,!1)})}z(X,we)};xe(q,X=>{y(r).backgroundImage&&X(N)})}var K=j(q,2);{var Y=X=>{var we=Ap(),Me=C(we);{var ce=ye=>{var ze=Kt(),Ve=jt(ze);fa(Ve,()=>y(r).characterImage,je=>{Tl(je,{get fileName(){return y(r).characterImage},get bucketName(){return t()}})}),z(ye,ze)},$e=ye=>{var ze=Sp();Ee(()=>Oe(ze,"src",`${ys}/storage/v1/object/public/${t()}/${y(r).characterImage}`)),z(ye,ze)};xe(Me,ye=>{y(r).characterImage.endsWith(".riv")?ye(ce):ye($e,!1)})}z(X,we)};xe(K,X=>{y(r).characterImage&&X(Y)})}var D=j(K,2),W=C(D),re=C(W),Z=j(W,2);{var be=X=>{var we=xp();kt(we,21,()=>y(r).options,Me=>Me.text,(Me,ce)=>{var $e=Kt(),ye=jt($e);{var ze=Ve=>{var je=Tp();let Ne;je.__click=[Cp,l,ce];var Je=C(je);Ee((Pe,Le)=>{Ne=qt(je,1,"option-button svelte-fl90wm",null,Ne,Pe),je.disabled=Le,Ae(Je,y(ce).text)},[()=>({disabled:!m(y(ce))}),()=>!m(y(ce))]),z(Ve,je)};xe(ye,Ve=>{f(y(ce))&&Ve(ze)})}z(Me,$e)}),z(X,we)},ue=X=>{var we=Kt(),Me=jt(we);{var ce=$e=>{var ye=Pp(),ze=C(ye);ze.__click=[kp,r],z($e,ye)};xe(Me,$e=>{y(r).nextDialogueId&&$e(ce)},!0)}z(X,we)};xe(Z,X=>{y(r).options&&y(r).options.length>0?X(be):X(ue,!1)})}Ee(()=>Ae(re,y(r).text)),z(E,F)},g=E=>{var F=Rp(),O=C(F);Ee(()=>Ae(O,`Диалог не найден (ID: ${wt.currentDialogueId??""})`)),z(E,F)};xe(w,E=>{y(r)?E(S):E(g,!1)})}z(n,_),Wt()}Yt(["click"]);var ra=tr(()=>L),Op=ee('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Mp=ee('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Lp=ee('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Dp=ee('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),$p=ee('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),Fp=ee('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Up=ee('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function Np(n,e){Bt(e,!1);function t(){ra(ra().editingOptionIndex=null)}er();var r=Up(),s=C(r),l=j(C(s),2);l.__click=t;var u=j(s,2),h=C(u);{var f=_=>{var w=$p(),S=C(w);{let X=si(()=>ra().selectedBucket||void 0);Du(S,{get dialogue(){return Nt.currentDialogue},index:0,get bucketName(){return y(X)}})}var g=j(S,2),E=C(g),F=j(C(E),2),O=C(F),B=j(E,2),q=j(C(B),2),N=C(q),K=j(B,2);{var Y=X=>{var we=Op(),Me=j(C(we),2),ce=C(Me);Ee(()=>Ae(ce,Nt.currentDialogue.backgroundImage)),z(X,we)};xe(K,X=>{Nt.currentDialogue.backgroundImage&&X(Y)})}var D=j(K,2);{var W=X=>{var we=Mp(),Me=j(C(we),2),ce=C(Me);Ee(()=>Ae(ce,Nt.currentDialogue.characterImage)),z(X,we)};xe(D,X=>{Nt.currentDialogue.characterImage&&X(W)})}var re=j(g,2);{var Z=X=>{var we=Lp();z(X,we)};xe(re,X=>{(!Nt.currentDialogue.options||Nt.currentDialogue.options.length===0)&&X(Z)})}var be=j(re,2);{var ue=X=>{var we=Dp();z(X,we)};xe(be,X=>{Nt.currentDialogue.options?.some(we=>!we.nextDialogueId)&&X(ue)})}Ee(()=>{Ae(O,Nt.currentDialogue.id),Ae(N,Nt.currentChapter?.title||"Без главы")}),z(_,w)},m=_=>{var w=Fp();z(_,w)};xe(h,_=>{Nt.currentDialogue?_(f):_(m,!1)})}z(n,r),Wt()}Yt(["click"]);const Bp=["dracula","zombie","fairy_tale","minigames"];function $u(){const n=Bp.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return gt.updateBucketsList(n),n}var dr=tr(()=>L),Wp=ee('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),Vp=(n,e,t)=>e(y(t).name),qp=ee('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),Hp=ee('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),zp=ee('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function Gp(n,e){Bt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};Pi(()=>{r()});function r(){$u()}async function s(h){dr(dr().selectedBucket=h),dr(dr().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Qn.loadStoriesList(),await Qn.loadStoredResources()}er();var l=zp(),u=j(C(l),2);kt(u,5,()=>dr().availableBuckets,h=>h,(h,f)=>{const m=si(()=>t[y(f).id]||{title:y(f),description:"Интерактивная история",icon:"📖"});var _=Hp();let w;var S=C(_),g=C(S),E=C(g),F=j(g,2),O=C(F),B=C(O),q=j(O,2),N=C(q),K=j(S,2),Y=C(K);{var D=re=>{var Z=Wp();z(re,Z)},W=re=>{var Z=qp();Z.__click=[Vp,s,f],z(re,Z)};xe(Y,re=>{dr().selectedBucket===y(f).name?re(D):re(W,!1)})}Ee(re=>{w=qt(_,1,"bucket-card svelte-1cmn6ru",null,w,re),Ae(E,y(m).icon),Ae(B,y(m).title),Ae(N,y(m).description)},[()=>({selected:dr().selectedBucket===y(f).name})]),z(h,_)}),z(n,l),Wt()}Yt(["click"]);var Kp=ee("<span> </span>"),Yp=ee('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Jp=ee('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Xp=ee('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Qp=ee('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Zp(n,e){Bt(e,!0),Pi(async()=>{$u(),L.availableBuckets.length>0&&!L.selectedBucket&&(L.selectedBucket=L.availableBuckets[0].name)}),Zr(async()=>{if(L.selectedBucket){console.log(`[Editor] Bucket выбран: ${L.selectedBucket}`),await Qn.loadStoredResources();const u=`${L.selectedBucket}_story.json`;L.currentFileName=u,await gr.loadStory(u)}});var t=Kt(),r=jt(t);{var s=u=>{Gp(u,{})},l=u=>{var h=Qp(),f=C(h),m=C(f),_=C(m);_.__click=()=>L.selectedBucket=null;var w=j(_,2),S=C(w),g=j(m,2),E=C(g),F=C(E),O=j(E,2);{var B=ce=>{var $e=Kp(),ye=C($e);Ee(()=>{qt($e,1,`status-message ${L.statusMessage.type??""}`,"svelte-1k4krym"),Ae(ye,L.statusMessage.text)}),z(ce,$e)};xe(O,ce=>{L.statusMessage.text&&ce(B)})}var q=j(O,2);q.__click=function(...ce){gr.saveCurrentStory?.apply(this,ce)};var N=j(q,2);N.__click=function(...ce){gr.saveStoryCopy?.apply(this,ce)};var K=j(f,2),Y=C(K);ev(Y,{});var D=j(Y,2),W=C(D);{var re=ce=>{var $e=Yp(),ye=C($e),ze=C(ye);Ee(()=>Ae(ze,`Загружено: ${L.data.meta?.title??""} |
              Глав: ${(L.data.chapters?.length||0)??""} |
              Диалогов: ${(L.data.dialogues?.length||0)??""} |
              Предметов: ${(L.data.items?.length||0)??""}`)),z(ce,$e)},Z=ce=>{var $e=Jp();z(ce,$e)};xe(W,ce=>{L.data?ce(re):ce(Z,!1)})}var be=j(W,2);Hv(be,{});var ue=j(be,2);{var X=ce=>{Ov(ce,{get editor(){return L},get storyActions(){return gr},get resourceActions(){return Qn}})},we=ce=>{var $e=Xp();z(ce,$e)};xe(ue,ce=>{Nt.currentDialogue?ce(X):ce(we,!1)})}var Me=j(D,2);Np(Me,{}),Ee(()=>{Ae(S,`Story Editor v3.1 - ${L.selectedBucket??""}`),Ae(F,L.currentFileName||"Нет файла")}),z(u,h)};xe(r,u=>{L.selectedBucket?u(l,!1):u(s)})}z(n,t),Wt()}Yt(["click"]);var ia=tr(()=>wt),eg=(n,e,t)=>e(y(t)),tg=(n,e,t)=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e(y(t)))},ng=ee('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),rg=ee('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function ig(n,e){Bt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function r(u){ia(ia().selectedStory=u)}er();var s=rg(),l=j(C(s),2);kt(l,5,()=>ia().availableStories,u=>u,(u,h)=>{const f=si(()=>t[y(h)]||{title:y(h),description:"Интерактивная история",icon:"📖"});var m=ng();m.__click=[eg,r,h],m.__keydown=[tg,r,h];var _=C(m),w=C(_),S=j(_,2),g=C(S),E=C(g),F=j(g,2),O=C(F);Ee(()=>{Ae(w,y(f).icon),Ae(E,y(f).title),Ae(O,y(f).description)}),z(u,m)}),z(n,s),Wt()}Yt(["click","keydown"]);function sa(n,e){Ie(e,!y(e))}var sg=ee('<span class="inventory-badge svelte-1nth01l"> </span>'),ag=(n=>n.stopPropagation()),og=(n,e,t)=>e(y(t)),lg=ee('<div class="item-card svelte-1nth01l"><div class="item-icon svelte-1nth01l"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-1nth01l"><span class="item-name svelte-1nth01l"> </span> <span class="item-type svelte-1nth01l"> </span></div></div>'),ug=ee('<div class="items-grid svelte-1nth01l"></div>'),cg=ee('<div class="empty-inventory svelte-1nth01l"><span class="empty-icon svelte-1nth01l">🎒</span> <p class="svelte-1nth01l">Инвентарь пуст</p> <p class="empty-hint svelte-1nth01l">Получайте предметы в ходе игры</p></div>'),dg=ee('<div class="inventory-overlay svelte-1nth01l"><div class="inventory-modal svelte-1nth01l"><div class="inventory-header svelte-1nth01l"><h2 class="svelte-1nth01l">Инвентарь</h2> <button class="close-button svelte-1nth01l">✕</button></div> <div class="stats-section svelte-1nth01l"><h3 class="svelte-1nth01l">Характеристики</h3> <div class="stats-grid svelte-1nth01l"><div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">📚</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Знания</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">💪</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Смелость</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">✨</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Харизма</span> <span class="stat-value svelte-1nth01l"> </span></div></div></div></div> <div class="items-section svelte-1nth01l"><h3 class="svelte-1nth01l"> </h3> <!></div></div></div>'),hg=ee('<div class="inventory-wrapper svelte-1nth01l"><button class="inventory-button svelte-1nth01l">🎒 <!></button> <!></div>');function fg(n,e){Bt(e,!0);let t=Ze(!1);const r=cn(()=>wt.getInventoryItems()),s=cn(()=>wt.player.stats);function l(S){console.log("Выбран предмет:",S.name)}var u=hg(),h=C(u);h.__click=[sa,t];var f=j(C(h));{var m=S=>{var g=sg(),E=C(g);Ee(()=>Ae(E,y(r).length)),z(S,g)};xe(f,S=>{y(r).length>0&&S(m)})}var _=j(h,2);{var w=S=>{var g=dg();g.__click=[sa,t];var E=C(g);E.__click=[ag];var F=C(E),O=j(C(F),2);O.__click=[sa,t];var B=j(F,2),q=j(C(B),2),N=C(q),K=j(C(N),2),Y=j(C(K),2),D=C(Y),W=j(N,2),re=j(C(W),2),Z=j(C(re),2),be=C(Z),ue=j(W,2),X=j(C(ue),2),we=j(C(X),2),Me=C(we),ce=j(B,2),$e=C(ce),ye=C($e),ze=j($e,2);{var Ve=Ne=>{var Je=ug();kt(Je,21,()=>y(r),Pe=>Pe.id,(Pe,Le)=>{var ct=lg();ct.__click=[og,l,Le];var Be=C(ct),yt=C(Be),he=j(Be,2),fe=C(he),oe=C(fe),ie=j(fe,2),Te=C(ie);Ee(()=>{Oe(yt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${wt.selectedStory}/${y(Le).icon}`),Oe(yt,"alt",y(Le).icon),Ae(oe,y(Le).name),Ae(Te,y(Le).type)}),z(Pe,ct)}),z(Ne,Je)},je=Ne=>{var Je=cg();z(Ne,Je)};xe(ze,Ne=>{y(r).length>0?Ne(Ve):Ne(je,!1)})}Ee(()=>{Ae(D,y(s).knowledge),Ae(be,y(s).courage),Ae(Me,y(s).charisma),Ae(ye,`Предметы (${y(r).length??""})`)}),z(S,g)};xe(_,S=>{y(t)&&S(w)})}Ee(()=>Oe(h,"title",`Инвентарь (${y(r).length??""})`)),z(n,u),Wt()}Yt(["click"]);var vg=ee('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),pg=ee('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),gg=ee('<div class="game-container svelte-14svm27"><!> <button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),_g=ee('<div class="app svelte-14svm27"><!></div>');function mg(n,e){Bt(e,!0),Zr(async()=>{if(wt.selectedStory){const u=`${wt.selectedStory}_story.json`,h=`${ys}/storage/v1/object/public/${wt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await wt.loadStory(h)}});var t=_g(),r=C(t);{var s=u=>{ig(u,{})},l=u=>{var h=Kt(),f=jt(h);{var m=w=>{var S=vg();z(w,S)},_=w=>{var S=Kt(),g=jt(S);{var E=O=>{var B=pg(),q=C(B),N=j(q);N.__click=()=>wt.selectedStory=null,Ee(()=>Ae(q,`⚠️ ${wt.error??""} `)),z(O,B)},F=O=>{var B=gg(),q=C(B);fg(q,{});var N=j(q,2);N.__click=()=>wt.selectedStory=null;var K=j(N,2),Y=C(K);{var D=W=>{{let re=cn(()=>wt.selectedStory||void 0);Du(W,{get bucketName(){return y(re)}})}};xe(Y,W=>{wt.storyData&&W(D)})}z(O,B)};xe(g,O=>{wt.error?O(E):O(F,!1)},!0)}z(w,S)};xe(f,w=>{wt.isLoading?w(m):w(_,!1)},!0)}z(u,h)};xe(r,u=>{wt.selectedStory?u(l,!1):u(s)})}z(n,t),Wt()}Yt(["click"]);var yg=ee('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),bg=ee('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function wg(n,e){Bt(e,!1),er();var t=Kt(),r=jt(t);{var s=u=>{var h=yg(),f=jt(h);f.__click=function(..._){gt.toggleEditor?.apply(this,_)};var m=j(f,2);Zp(m,{}),z(u,h)},l=u=>{var h=bg(),f=jt(h);f.__click=function(..._){gt.toggleEditor?.apply(this,_)};var m=j(f,2);mg(m,{}),z(u,h)};xe(r,u=>{L.showEditor?u(s):u(l,!1)})}z(n,t),Wt()}Yt(["click"]);wd(wg,{target:document.getElementById("app")});
