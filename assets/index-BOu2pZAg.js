(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const Cl=!1;var Ii=Array.isArray,oc=Array.prototype.indexOf,Ia=Array.from,sa=Object.defineProperty,Wn=Object.getOwnPropertyDescriptor,Tl=Object.getOwnPropertyDescriptors,lc=Object.prototype,uc=Array.prototype,Aa=Object.getPrototypeOf,Fo=Object.isExtensible;function cc(r){return r()}function us(r){for(var e=0;e<r.length;e++)r[e]()}function dc(){var r,e,t=new Promise((n,s)=>{r=n,e=s});return{promise:t,resolve:r,reject:e}}const rr=2,Ca=4,_s=8,ei=16,Nr=32,_n=64,Pl=128,lr=256,cs=512,Bt=1024,ur=2048,Jr=4096,mr=8192,yn=16384,Ta=32768,Pa=65536,Uo=1<<17,hc=1<<18,Ai=1<<19,xl=1<<20,aa=1<<21,xa=1<<22,pn=1<<23,$r=Symbol("$state"),fc=Symbol("legacy props"),vc=Symbol(""),ja=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function pc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function jl(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function gc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function mc(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function _c(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function yc(r){throw new Error("https://svelte.dev/e/effect_orphan")}function wc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function bc(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function kc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ec(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Sc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const ys=1,ws=2,Rl=4,Ic=8,Ac=16,Cc=1,Tc=2,Pc=4,xc=8,jc=16,Rc=1,Oc=2,Mt=Symbol(),Mc="http://www.w3.org/1999/xhtml";function Lc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Dc=!1;function Ol(r){return r===this.v}function Ml(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function $c(r,e){return r!==e}function Ll(r){return!Ml(r,this.v)}let ti=!1,Fc=!1;function Uc(){ti=!0}let At=null;function ds(r){At=r}function Wt(r,e=!1,t){At={p:At,c:null,e:null,s:r,x:null,l:ti&&!e?{s:null,u:null,$:[]}:null}}function Vt(r){var e=At,t=e.e;if(t!==null){e.e=null;for(var n of t)Yl(n)}return At=e.p,{}}function ri(){return!ti||At!==null&&At.l===null}const Nc=new WeakMap;function Bc(r){var e=Qe;if(e===null)return tt.f|=pn,r;if((e.f&Ta)===0){if((e.f&Pl)===0)throw!e.parent&&r instanceof Error&&Dl(r),r;e.b.error(r)}else Ra(r,e)}function Ra(r,e){for(;e!==null;){if((e.f&Pl)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&Dl(r),r}function Dl(r){const e=Nc.get(r);e&&(sa(r,"message",{value:e.message}),sa(r,"stack",{value:e.stack}))}let bi=[],oa=[];function $l(){var r=bi;bi=[],us(r)}function Wc(){var r=oa;oa=[],us(r)}function Fl(r){bi.length===0&&queueMicrotask($l),bi.push(r)}function Vc(){bi.length>0&&$l(),oa.length>0&&Wc()}function qc(){for(var r=Qe.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&pc(),r}function Ci(r){var e=rr|ur,t=tt!==null&&(tt.f&rr)!==0?tt:null;return Qe===null||t!==null&&(t.f&lr)!==0?e|=lr:Qe.f|=Ai,{ctx:At,deps:null,effects:null,equals:Ol,f:e,fn:r,reactions:null,rv:0,v:Mt,wv:0,parent:t??Qe,ac:null}}function zc(r,e){let t=Qe;t===null&&gc();var n=t.b,s=void 0,l=Kn(Mt),u=null,h=!tt;return ad(()=>{try{var f=r();u&&Promise.resolve(f).catch(()=>{})}catch(p){f=Promise.reject(p)}var m=()=>f;s=u?.then(m,m)??Promise.resolve(f),u=s;var _=bt,b=n.pending;h&&(n.update_pending_count(1),b||_.increment());const I=(p,A=void 0)=>{u=null,b||_.activate(),A?A!==ja&&(l.f|=pn,Yn(l,A)):((l.f&pn)!==0&&(l.f^=pn),Yn(l,p)),h&&(n.update_pending_count(-1),b||_.decrement()),Bl()};if(s.then(I,p=>I(null,p||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(f=>{function m(_){function b(){_===s?f(l):m(s)}_.then(b,b)}m(s)})}function Vn(r){const e=Ci(r);return ru(e),e}function ni(r){const e=Ci(r);return e.equals=Ll,e}function Ul(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Ur(e[t])}}function Hc(r){for(var e=r.parent;e!==null;){if((e.f&rr)===0)return e;e=e.parent}return null}function Oa(r){var e,t=Qe;Kr(Hc(r));try{Ul(r),e=au(r)}finally{Kr(t)}return e}function Nl(r){var e=Oa(r);if(r.equals(e)||(r.v=e,r.wv=iu()),!bn){var t=(Hr||(r.f&lr)!==0)&&r.deps!==null?Jr:Bt;Xt(r,t)}}function Gc(r,e,t){const n=ri()?Ci:ni;if(e.length===0){t(r.map(n));return}var s=bt,l=Qe,u=Kc(),h=qc();Promise.all(e.map(f=>zc(f))).then(f=>{s?.activate(),u();try{t([...r.map(n),...f])}catch(m){(l.f&yn)===0&&Ra(m,l)}s?.deactivate(),Bl()}).catch(f=>{h.error(f)})}function Kc(){var r=Qe,e=tt,t=At,n=bt;return function(){Kr(r),Cr(e),ds(t),n?.activate()}}function Bl(){Kr(null),Cr(null),ds(null)}const Vs=new Set;let bt=null,as=null,No=new Set,hs=[];function Wl(){const r=hs.shift();hs.length>0&&queueMicrotask(Wl),r()}let mn=[],bs=null,la=!1,os=!1;class Hn{current=new Map;#i=new Map;#r=new Set;#e=0;#s=null;#a=!1;#t=[];#n=[];#l=[];#o=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){mn=[],as=null;for(const s of e)this.#v(s);if(this.#t.length===0&&this.#e===0){this.#f();var t=this.#l,n=this.#o;this.#l=[],this.#o=[],this.#u=[],as=bt,bt=null,Bo(t),Bo(n),bt===null?bt=this:Vs.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const s of this.#t)zn(s);for(const s of this.#n)zn(s);this.#t=[],this.#n=[]}#v(e){e.f^=Bt;for(var t=e.first;t!==null;){var n=t.f,s=(n&(Nr|_n))!==0,l=s&&(n&Bt)!==0,u=l||(n&mr)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(s)t.f^=Bt;else if((n&Ca)!==0)this.#o.push(t);else if((n&Bt)===0)if((n&xa)!==0){var h=t.b?.pending?this.#n:this.#t;h.push(t)}else Ss(t)&&((t.f&ei)!==0&&this.#u.push(t),zn(t));var f=t.first;if(f!==null){t=f;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&ur)!==0?this.#d:this.#h).push(t),Xt(t,Bt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){bt=this}deactivate(){bt=null,as=null;for(const e of No)if(No.delete(e),e(),bt!==null)break}neuter(){this.#a=!0}flush(){mn.length>0?Vl():this.#f(),bt===this&&(this.#e===0&&Vs.delete(this),this.deactivate())}#f(){if(!this.#a)for(const e of this.#r)e();this.#r.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)Xt(e,ur),Gn(e);for(const e of this.#h)Xt(e,Jr),Gn(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#r.add(e)}settled(){return(this.#s??=dc()).promise}static ensure(){if(bt===null){const e=bt=new Hn;Vs.add(bt),os||Hn.enqueue(()=>{bt===e&&e.flush()})}return bt}static enqueue(e){hs.length===0&&queueMicrotask(Wl),hs.unshift(e)}}function Yc(r){var e=os;os=!0;try{for(var t;;){if(Vc(),mn.length===0&&(bt?.flush(),mn.length===0))return bs=null,t;Vl()}}finally{os=e}}function Vl(){var r=qn;la=!0;try{var e=0;for(Ho(!0);mn.length>0;){var t=Hn.ensure();if(e++>1e3){var n,s;Jc()}t.process(mn),Gr.clear()}}finally{la=!1,Ho(r),bs=null}}function Jc(){try{wc()}catch(r){Ra(r,bs)}}let dn=null;function Bo(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(yn|mr))===0&&Ss(n)&&(dn=[],zn(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?Zl(n):n.fn=null),dn?.length>0)){Gr.clear();for(const s of dn)zn(s);dn=[]}}dn=null}}function Gn(r){for(var e=bs=r;e.parent!==null;){e=e.parent;var t=e.f;if(la&&e===Qe&&(t&ei)!==0)return;if((t&(_n|Nr))!==0){if((t&Bt)===0)return;e.f^=Bt}}mn.push(e)}const Gr=new Map;function Kn(r,e){var t={f:0,v:r,reactions:null,equals:Ol,rv:0,wv:0};return t}function ft(r,e){const t=Kn(r);return ru(t),t}function Xc(r,e=!1,t=!0){const n=Kn(r);return e||(n.equals=Ll),ti&&t&&At!==null&&At.l!==null&&(At.l.s??=[]).push(n),n}function Oe(r,e,t=!1){tt!==null&&(!Ir||(tt.f&Uo)!==0)&&ri()&&(tt.f&(rr|ei|xa|Uo))!==0&&!Fr?.includes(r)&&Sc();let n=t?Gt(e):e;return Yn(r,n)}function Yn(r,e){if(!r.equals(e)){var t=r.v;bn?Gr.set(r,e):Gr.set(r,t),r.v=e;var n=Hn.ensure();n.capture(r,t),(r.f&rr)!==0&&((r.f&ur)!==0&&Oa(r),Xt(r,(r.f&lr)===0?Bt:Jr)),r.wv=iu(),ql(r,ur),ri()&&Qe!==null&&(Qe.f&Bt)!==0&&(Qe.f&(Nr|_n))===0&&(ar===null?cd([r]):ar.push(r))}return e}function Wo(r,e=1){var t=E(r),n=e===1?t++:t--;return Oe(r,t),n}function qs(r){Oe(r,r.v+1)}function ql(r,e){var t=r.reactions;if(t!==null)for(var n=ri(),s=t.length,l=0;l<s;l++){var u=t[l],h=u.f;if(!(!n&&u===Qe)){var f=(h&ur)===0;f&&Xt(u,e),(h&rr)!==0?ql(u,Jr):f&&((h&ei)!==0&&dn!==null&&dn.push(u),Gn(u))}}}function Gt(r){if(typeof r!="object"||r===null||$r in r)return r;const e=Aa(r);if(e!==lc&&e!==uc)return r;var t=new Map,n=Ii(r),s=ft(0),l=gn,u=h=>{if(gn===l)return h();var f=tt,m=gn;Cr(null),Ko(l);var _=h();return Cr(f),Ko(m),_};return n&&t.set("length",ft(r.length)),new Proxy(r,{defineProperty(h,f,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&kc();var _=t.get(f);return _===void 0?_=u(()=>{var b=ft(m.value);return t.set(f,b),b}):Oe(_,m.value,!0),!0},deleteProperty(h,f){var m=t.get(f);if(m===void 0){if(f in h){const _=u(()=>ft(Mt));t.set(f,_),qs(s)}}else Oe(m,Mt),qs(s);return!0},get(h,f,m){if(f===$r)return r;var _=t.get(f),b=f in h;if(_===void 0&&(!b||Wn(h,f)?.writable)&&(_=u(()=>{var p=Gt(b?h[f]:Mt),A=ft(p);return A}),t.set(f,_)),_!==void 0){var I=E(_);return I===Mt?void 0:I}return Reflect.get(h,f,m)},getOwnPropertyDescriptor(h,f){var m=Reflect.getOwnPropertyDescriptor(h,f);if(m&&"value"in m){var _=t.get(f);_&&(m.value=E(_))}else if(m===void 0){var b=t.get(f),I=b?.v;if(b!==void 0&&I!==Mt)return{enumerable:!0,configurable:!0,value:I,writable:!0}}return m},has(h,f){if(f===$r)return!0;var m=t.get(f),_=m!==void 0&&m.v!==Mt||Reflect.has(h,f);if(m!==void 0||Qe!==null&&(!_||Wn(h,f)?.writable)){m===void 0&&(m=u(()=>{var I=_?Gt(h[f]):Mt,p=ft(I);return p}),t.set(f,m));var b=E(m);if(b===Mt)return!1}return _},set(h,f,m,_){var b=t.get(f),I=f in h;if(n&&f==="length")for(var p=m;p<b.v;p+=1){var A=t.get(p+"");A!==void 0?Oe(A,Mt):p in h&&(A=u(()=>ft(Mt)),t.set(p+"",A))}if(b===void 0)(!I||Wn(h,f)?.writable)&&(b=u(()=>ft(void 0)),Oe(b,Gt(m)),t.set(f,b));else{I=b.v!==Mt;var U=u(()=>Gt(m));Oe(b,U)}var M=Reflect.getOwnPropertyDescriptor(h,f);if(M?.set&&M.set.call(_,m),!I){if(n&&typeof f=="string"){var W=t.get("length"),q=Number(f);Number.isInteger(q)&&q>=W.v&&Oe(W,q+1)}qs(s)}return!0},ownKeys(h){E(s);var f=Reflect.ownKeys(h).filter(b=>{var I=t.get(b);return I===void 0||I.v!==Mt});for(var[m,_]of t)_.v!==Mt&&!(m in h)&&f.push(m);return f},setPrototypeOf(){Ec()}})}function Vo(r){try{if(r!==null&&typeof r=="object"&&$r in r)return r[$r]}catch{}return r}function Qc(r,e){return Object.is(Vo(r),Vo(e))}var qo,zl,Hl,Gl;function Zc(){if(qo===void 0){qo=window,zl=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Hl=Wn(e,"firstChild").get,Gl=Wn(e,"nextSibling").get,Fo(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Fo(t)&&(t.__t=void 0)}}function wn(r=""){return document.createTextNode(r)}function Jn(r){return Hl.call(r)}function ks(r){return Gl.call(r)}function x(r,e){return Jn(r)}function xt(r,e){{var t=Jn(r);return t instanceof Comment&&t.data===""?ks(t):t}}function F(r,e=1,t=!1){let n=r;for(;e--;)n=ks(n);return n}function ed(r){r.textContent=""}function Ma(){return!1}let zo=!1;function td(){zo||(zo=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function La(r){var e=tt,t=Qe;Cr(null),Kr(null);try{return r()}finally{Cr(e),Kr(t)}}function Da(r,e,t,n=t){r.addEventListener(e,()=>La(t));const s=r.__on_r;s?r.__on_r=()=>{s(),n(!0)}:r.__on_r=()=>n(!0),td()}function Kl(r){Qe===null&&tt===null&&yc(),tt!==null&&(tt.f&lr)!==0&&Qe===null&&_c(),bn&&mc()}function rd(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Tr(r,e,t,n=!0){var s=Qe;s!==null&&(s.f&mr)!==0&&(r|=mr);var l={ctx:At,deps:null,nodes_start:null,nodes_end:null,f:r|ur,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{zn(l),l.f|=Ta}catch(f){throw Ur(l),f}else e!==null&&Gn(l);if(n){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Ai)===0&&(u=u.first),u!==null&&(u.parent=s,s!==null&&rd(u,s),tt!==null&&(tt.f&rr)!==0&&(r&_n)===0)){var h=tt;(h.effects??=[]).push(u)}}return l}function nd(r){const e=Tr(_s,null,!1);return Xt(e,Bt),e.teardown=r,e}function Xn(r){Kl();var e=Qe.f,t=!tt&&(e&Nr)!==0&&(e&Ta)===0;if(t){var n=At;(n.e??=[]).push(r)}else return Yl(r)}function Yl(r){return Tr(Ca|xl,r,!1)}function id(r){return Kl(),Tr(_s|xl,r,!0)}function sd(r){Hn.ensure();const e=Tr(_n|Ai,r,!0);return(t={})=>new Promise(n=>{t.outro?Es(e,()=>{Ur(e),n(void 0)}):(Ur(e),n(void 0))})}function Jl(r){return Tr(Ca,r,!1)}function ad(r){return Tr(xa|Ai,r,!0)}function $a(r,e=0){return Tr(_s|e,r,!0)}function be(r,e=[],t=[]){Gc(e,t,n=>{Tr(_s,()=>r(...n.map(E)),!0)})}function Fa(r,e=0){var t=Tr(ei|e,r,!0);return t}function Qn(r,e=!0){return Tr(Nr|Ai,r,!0,e)}function Xl(r){var e=r.teardown;if(e!==null){const t=bn,n=tt;Go(!0),Cr(null);try{e.call(null)}finally{Go(t),Cr(n)}}}function Ql(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const s=t.ac;s!==null&&La(()=>{s.abort(ja)});var n=t.next;(t.f&_n)!==0?t.parent=null:Ur(t,e),t=n}}function od(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Nr)===0&&Ur(e),e=t}}function Ur(r,e=!0){var t=!1;(e||(r.f&hc)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(ld(r.nodes_start,r.nodes_end),t=!0),Ql(r,e&&!t),fs(r,0),Xt(r,yn);var n=r.transitions;if(n!==null)for(const l of n)l.stop();Xl(r);var s=r.parent;s!==null&&s.first!==null&&Zl(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function ld(r,e){for(;r!==null;){var t=r===e?null:ks(r);r.remove(),r=t}}function Zl(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Es(r,e){var t=[];Ua(r,t,!0),eu(t,()=>{Ur(r),e&&e()})}function eu(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var s of r)s.out(n)}else e()}function Ua(r,e,t){if((r.f&mr)===0){if(r.f^=mr,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var n=r.first;n!==null;){var s=n.next,l=(n.f&Pa)!==0||(n.f&Nr)!==0;Ua(n,e,l?t:!1),n=s}}}function Na(r){tu(r,!0)}function tu(r,e){if((r.f&mr)!==0){r.f^=mr,(r.f&Bt)===0&&(Xt(r,ur),Gn(r));for(var t=r.first;t!==null;){var n=t.next,s=(t.f&Pa)!==0||(t.f&Nr)!==0;tu(t,s?e:!1),t=n}if(r.transitions!==null)for(const l of r.transitions)(l.is_global||e)&&l.in()}}let Un=null;function ud(r){var e=Un;try{if(Un=new Set,kn(r),e!==null)for(var t of Un)e.add(t);return Un}finally{Un=e}}function pr(r){for(var e of ud(r))Yn(e,e.v)}let qn=!1;function Ho(r){qn=r}let bn=!1;function Go(r){bn=r}let tt=null,Ir=!1;function Cr(r){tt=r}let Qe=null;function Kr(r){Qe=r}let Fr=null;function ru(r){tt!==null&&(Fr===null?Fr=[r]:Fr.push(r))}let Ht=null,tr=0,ar=null;function cd(r){ar=r}let nu=1,ki=0,gn=ki;function Ko(r){gn=r}let Hr=!1;function iu(){return++nu}function Ss(r){var e=r.f;if((e&ur)!==0)return!0;if((e&Jr)!==0){var t=r.deps,n=(e&lr)!==0;if(t!==null){var s,l,u=(e&cs)!==0,h=n&&Qe!==null&&!Hr,f=t.length;if((u||h)&&(Qe===null||(Qe.f&yn)===0)){var m=r,_=m.parent;for(s=0;s<f;s++)l=t[s],(u||!l?.reactions?.includes(m))&&(l.reactions??=[]).push(m);u&&(m.f^=cs),h&&_!==null&&(_.f&lr)===0&&(m.f^=lr)}for(s=0;s<f;s++)if(l=t[s],Ss(l)&&Nl(l),l.wv>r.wv)return!0}(!n||Qe!==null&&!Hr)&&Xt(r,Bt)}return!1}function su(r,e,t=!0){var n=r.reactions;if(n!==null&&!Fr?.includes(r))for(var s=0;s<n.length;s++){var l=n[s];(l.f&rr)!==0?su(l,e,!1):e===l&&(t?Xt(l,ur):(l.f&Bt)!==0&&Xt(l,Jr),Gn(l))}}function au(r){var e=Ht,t=tr,n=ar,s=tt,l=Hr,u=Fr,h=At,f=Ir,m=gn,_=r.f;Ht=null,tr=0,ar=null,Hr=(_&lr)!==0&&(Ir||!qn||tt===null),tt=(_&(Nr|_n))===0?r:null,Fr=null,ds(r.ctx),Ir=!1,gn=++ki,r.ac!==null&&(La(()=>{r.ac.abort(ja)}),r.ac=null);try{r.f|=aa;var b=r.fn,I=b(),p=r.deps;if(Ht!==null){var A;if(fs(r,tr),p!==null&&tr>0)for(p.length=tr+Ht.length,A=0;A<Ht.length;A++)p[tr+A]=Ht[A];else r.deps=p=Ht;if(!Hr||(_&rr)!==0&&r.reactions!==null)for(A=tr;A<p.length;A++)(p[A].reactions??=[]).push(r)}else p!==null&&tr<p.length&&(fs(r,tr),p.length=tr);if(ri()&&ar!==null&&!Ir&&p!==null&&(r.f&(rr|Jr|ur))===0)for(A=0;A<ar.length;A++)su(ar[A],r);return s!==null&&s!==r&&(ki++,ar!==null&&(n===null?n=ar:n.push(...ar))),(r.f&pn)!==0&&(r.f^=pn),I}catch(U){return Bc(U)}finally{r.f^=aa,Ht=e,tr=t,ar=n,tt=s,Hr=l,Fr=u,ds(h),Ir=f,gn=m}}function dd(r,e){let t=e.reactions;if(t!==null){var n=oc.call(t,r);if(n!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[n]=t[s],t.pop())}}t===null&&(e.f&rr)!==0&&(Ht===null||!Ht.includes(e))&&(Xt(e,Jr),(e.f&(lr|cs))===0&&(e.f^=cs),Ul(e),fs(e,0))}function fs(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)dd(r,t[n])}function zn(r){var e=r.f;if((e&yn)===0){Xt(r,Bt);var t=Qe,n=qn;Qe=r,qn=!0;try{(e&ei)!==0?od(r):Ql(r),Xl(r);var s=au(r);r.teardown=typeof s=="function"?s:null,r.wv=nu;var l;Cl&&Fc&&(r.f&ur)!==0&&r.deps}finally{qn=n,Qe=t}}}async function ou(){await Promise.resolve(),Yc()}function E(r){var e=r.f,t=(e&rr)!==0;if(Un?.add(r),tt!==null&&!Ir){var n=Qe!==null&&(Qe.f&yn)!==0;if(!n&&!Fr?.includes(r)){var s=tt.deps;if((tt.f&aa)!==0)r.rv<ki&&(r.rv=ki,Ht===null&&s!==null&&s[tr]===r?tr++:Ht===null?Ht=[r]:(!Hr||!Ht.includes(r))&&Ht.push(r));else{(tt.deps??=[]).push(r);var l=r.reactions;l===null?r.reactions=[tt]:l.includes(tt)||l.push(tt)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&lr)===0&&(u.f^=lr)}if(bn){if(Gr.has(r))return Gr.get(r);if(t){u=r;var f=u.v;return((u.f&Bt)===0&&u.reactions!==null||lu(u))&&(f=Oa(u)),Gr.set(u,f),f}}else t&&(u=r,Ss(u)&&Nl(u));if((r.f&pn)!==0)throw r.v;return r.v}function lu(r){if(r.v===Mt)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(Gr.has(e)||(e.f&rr)!==0&&lu(e))return!0;return!1}function kn(r){var e=Ir;try{return Ir=!0,r()}finally{Ir=e}}const hd=-7169;function Xt(r,e){r.f=r.f&hd|e}function fd(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if($r in r)ua(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&$r in t&&ua(t)}}}function ua(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{ua(r[n],e)}catch{}const t=Aa(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Tl(t);for(let s in n){const l=n[s].get;if(l)try{l.call(r)}catch{}}}}}const vd=["touchstart","touchmove"];function pd(r){return vd.includes(r)}const uu=new Set,ca=new Set;function Qt(r){for(var e=0;e<r.length;e++)uu.add(r[e]);for(var t of ca)t(r)}let Yo=null;function Qi(r){var e=this,t=e.ownerDocument,n=r.type,s=r.composedPath?.()||[],l=s[0]||r.target;Yo=r;var u=0,h=Yo===r&&r.__root;if(h){var f=s.indexOf(h);if(f!==-1&&(e===document||e===window)){r.__root=e;return}var m=s.indexOf(e);if(m===-1)return;f<=m&&(u=f)}if(l=s[u]||r.target,l!==e){sa(r,"currentTarget",{configurable:!0,get(){return l||t}});var _=tt,b=Qe;Cr(null),Kr(null);try{for(var I,p=[];l!==null;){var A=l.assignedSlot||l.parentNode||l.host||null;try{var U=l["__"+n];if(U!=null&&(!l.disabled||r.target===l))if(Ii(U)){var[M,...W]=U;M.apply(l,[r,...W])}else U.call(l,r)}catch(q){I?p.push(q):I=q}if(r.cancelBubble||A===e||A===null)break;l=A}if(I){for(let q of p)queueMicrotask(()=>{throw q});throw I}}finally{r.__root=e,delete r.currentTarget,Cr(_),Kr(b)}}}function cu(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function Ei(r,e){var t=Qe;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function ne(r,e){var t=(e&Rc)!==0,n=(e&Oc)!==0,s,l=!r.startsWith("<!>");return()=>{s===void 0&&(s=cu(l?r:"<!>"+r),t||(s=Jn(s)));var u=n||zl?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=Jn(u),f=u.lastChild;Ei(h,f)}else Ei(u,u);return u}}function gd(r,e,t="svg"){var n=!r.startsWith("<!>"),s=`<${t}>${n?r:"<!>"+r}</${t}>`,l;return()=>{if(!l){var u=cu(s),h=Jn(u);l=Jn(h)}var f=l.cloneNode(!0);return Ei(f,f),f}}function md(r,e){return gd(r,e,"svg")}function Zi(r=""){{var e=wn(r+"");return Ei(e,e),e}}function Jt(){var r=document.createDocumentFragment(),e=document.createComment(""),t=wn();return r.append(e,t),Ei(e,t),r}function K(r,e){r!==null&&r.before(e)}function Ae(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function _d(r,e){return yd(r,e)}const Tn=new Map;function yd(r,{target:e,anchor:t,props:n={},events:s,context:l,intro:u=!0}){Zc();var h=new Set,f=b=>{for(var I=0;I<b.length;I++){var p=b[I];if(!h.has(p)){h.add(p);var A=pd(p);e.addEventListener(p,Qi,{passive:A});var U=Tn.get(p);U===void 0?(document.addEventListener(p,Qi,{passive:A}),Tn.set(p,1)):Tn.set(p,U+1)}}};f(Ia(uu)),ca.add(f);var m=void 0,_=sd(()=>{var b=t??e.appendChild(wn());return Qn(()=>{if(l){Wt({});var I=At;I.c=l}s&&(n.$$events=s),m=r(b,n)||{},l&&Vt()}),()=>{for(var I of h){e.removeEventListener(I,Qi);var p=Tn.get(I);--p===0?(document.removeEventListener(I,Qi),Tn.delete(I)):Tn.set(I,p)}ca.delete(f),b!==t&&b.parentNode?.removeChild(b)}});return wd.set(m,_),m}let wd=new WeakMap;function je(r,e,t=!1){var n=r,s=null,l=null,u=Mt,h=t?Pa:0,f=!1;const m=(p,A=!0)=>{f=!0,I(A,p)};var _=null;function b(){_!==null&&(_.lastChild.remove(),n.before(_),_=null);var p=u?s:l,A=u?l:s;p&&Na(p),A&&Es(A,()=>{u?l=null:s=null})}const I=(p,A)=>{if(u!==(u=p)){var U=Ma(),M=n;if(U&&(_=document.createDocumentFragment(),_.append(M=wn())),u?s??=A&&Qn(()=>A(M)):l??=A&&Qn(()=>A(M)),U){var W=bt,q=u?s:l,N=u?l:s;q&&W.skipped_effects.delete(q),N&&W.skipped_effects.add(N),W.add_callback(b)}else b()}};Fa(()=>{f=!1,e(m),f||I(null,null)},h)}function da(r,e,t){var n=r,s=Mt,l,u,h=null,f=ri()?$c:Ml;function m(){l&&Es(l),h!==null&&(h.lastChild.remove(),n.before(h),h=null),l=u}Fa(()=>{if(f(s,s=e())){var _=n,b=Ma();b&&(h=document.createDocumentFragment(),h.append(_=wn())),u=Qn(()=>t(_)),b?bt.add_callback(m):m()}})}function Ft(r,e){return e}function bd(r,e,t){for(var n=r.items,s=[],l=e.length,u=0;u<l;u++)Ua(e[u].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var f=t.parentNode;ed(f),f.append(t),n.clear(),kr(r,e[0].prev,e[l-1].next)}eu(s,()=>{for(var m=0;m<l;m++){var _=e[m];h||(n.delete(_.k),kr(r,_.prev,_.next)),Ur(_.e,!h)}})}function Et(r,e,t,n,s,l=null){var u=r,h={flags:e,items:new Map,first:null},f=(e&Rl)!==0;if(f){var m=r;u=m.appendChild(wn())}var _=null,b=!1,I=new Map,p=ni(()=>{var W=t();return Ii(W)?W:W==null?[]:Ia(W)}),A,U;function M(){kd(U,A,h,I,u,s,e,n,t),l!==null&&(A.length===0?_?Na(_):_=Qn(()=>l(u)):_!==null&&Es(_,()=>{_=null}))}Fa(()=>{U??=Qe,A=E(p);var W=A.length;if(!(b&&W===0)){b=W===0;var q,N,G,X;if(Ma()){var $=new Set,B=bt;for(N=0;N<W;N+=1){G=A[N],X=n(G,N);var oe=h.items.get(X)??I.get(X);oe?(e&(ys|ws))!==0&&du(oe,G,N,e):(q=hu(null,h,null,null,G,X,N,s,e,t,!0),I.set(X,q)),$.add(X)}for(const[ee,ge]of h.items)$.has(ee)||B.skipped_effects.add(ge.e);B.add_callback(M)}else M();E(p)}})}function kd(r,e,t,n,s,l,u,h,f){var m=(u&Ic)!==0,_=(u&(ys|ws))!==0,b=e.length,I=t.items,p=t.first,A=p,U,M=null,W,q=[],N=[],G,X,$,B;if(m)for(B=0;B<b;B+=1)G=e[B],X=h(G,B),$=I.get(X),$!==void 0&&($.a?.measure(),(W??=new Set).add($));for(B=0;B<b;B+=1){if(G=e[B],X=h(G,B),$=I.get(X),$===void 0){var oe=n.get(X);if(oe!==void 0){n.delete(X),I.set(X,oe);var ee=M?M.next:A;kr(t,M,oe),kr(t,oe,ee),zs(oe,ee,s),M=oe}else{var ge=A?A.e.nodes_start:s;M=hu(ge,t,M,M===null?t.first:M.next,G,X,B,l,u,f)}I.set(X,M),q=[],N=[],A=M.next;continue}if(_&&du($,G,B,u),($.e.f&mr)!==0&&(Na($.e),m&&($.a?.unfix(),(W??=new Set).delete($))),$!==A){if(U!==void 0&&U.has($)){if(q.length<N.length){var Q=N[0],te;M=Q.prev;var me=q[0],Te=q[q.length-1];for(te=0;te<q.length;te+=1)zs(q[te],Q,s);for(te=0;te<N.length;te+=1)U.delete(N[te]);kr(t,me.prev,Te.next),kr(t,M,me),kr(t,Te,Q),A=Q,M=Te,B-=1,q=[],N=[]}else U.delete($),zs($,A,s),kr(t,$.prev,$.next),kr(t,$,M===null?t.first:M.next),kr(t,M,$),M=$;continue}for(q=[],N=[];A!==null&&A.k!==X;)(A.e.f&mr)===0&&(U??=new Set).add(A),N.push(A),A=A.next;if(A===null)continue;$=A}q.push($),M=$,A=$.next}if(A!==null||U!==void 0){for(var ce=U===void 0?[]:Ia(U);A!==null;)(A.e.f&mr)===0&&ce.push(A),A=A.next;var _e=ce.length;if(_e>0){var pe=(u&Rl)!==0&&b===0?s:null;if(m){for(B=0;B<_e;B+=1)ce[B].a?.measure();for(B=0;B<_e;B+=1)ce[B].a?.fix()}bd(t,ce,pe)}}m&&Fl(()=>{if(W!==void 0)for($ of W)$.a?.apply()}),r.first=t.first&&t.first.e,r.last=M&&M.e;for(var ct of n.values())Ur(ct.e);n.clear()}function du(r,e,t,n){(n&ys)!==0&&Yn(r.v,e),(n&ws)!==0?Yn(r.i,t):r.i=t}function hu(r,e,t,n,s,l,u,h,f,m,_){var b=(f&ys)!==0,I=(f&Ac)===0,p=b?I?Xc(s,!1,!1):Kn(s):s,A=(f&ws)===0?u:Kn(u),U={i:A,v:p,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var M=document.createDocumentFragment();M.append(r=wn())}return U.e=Qn(()=>h(r,p,A,m),Dc),U.e.prev=t&&t.e,U.e.next=n&&n.e,t===null?_||(e.first=U):(t.next=U,t.e.next=U.e),n!==null&&(n.prev=U,n.e.prev=U.e),U}finally{}}function zs(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var u=ks(l);s.before(l),l=u}}function kr(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const Jo=[...` 	
\r\f \v\uFEFF`];function Ed(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var l=s.length,u=0;(u=n.indexOf(s,u))>=0;){var h=u+l;(u===0||Jo.includes(n[u-1]))&&(h===n.length||Jo.includes(n[h]))?n=(u===0?"":n.substring(0,u))+n.substring(h+1):u=h}}return n===""?null:n}function Sd(r,e){return String(r)}function or(r,e,t,n,s,l){var u=r.__className;if(u!==t||u===void 0){var h=Ed(t,n,l);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(l&&s!==l)for(var f in l){var m=!!l[f];(s==null||m!==!!s[f])&&r.classList.toggle(f,m)}return l}function Id(r,e,t,n){var s=r.__style;if(s!==e){var l=Sd(e);l==null?r.removeAttribute("style"):r.style.cssText=l,r.__style=e}return n}function vs(r,e,t=!1){if(r.multiple){if(e==null)return;if(!Ii(e))return Lc();for(var n of r.options)n.selected=e.includes(mi(n));return}for(n of r.options){var s=mi(n);if(Qc(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function ha(r){var e=new MutationObserver(()=>{vs(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),nd(()=>{e.disconnect()})}function Ar(r,e,t=e){var n=!0;Da(r,"change",s=>{var l=s?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(l),mi);else{var h=r.querySelector(l)??r.querySelector("option:not([disabled])");u=h&&mi(h)}t(u)}),Jl(()=>{var s=e();if(vs(r,s,n),n&&s===void 0){var l=r.querySelector(":checked");l!==null&&(s=mi(l),t(s))}r.__value=s,n=!1}),ha(r)}function mi(r){return"__value"in r?r.__value:r.value}const Ad=Symbol("is custom element"),Cd=Symbol("is html");function Hs(r,e){var t=fu(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function xe(r,e,t,n){var s=fu(r);s[e]!==(s[e]=t)&&(e==="loading"&&(r[vc]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Td(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function fu(r){return r.__attributes??={[Ad]:r.nodeName.includes("-"),[Cd]:r.namespaceURI===Mc}}var Xo=new Map;function Td(r){var e=r.getAttribute("is")||r.nodeName,t=Xo.get(e);if(t)return t;Xo.set(e,t=[]);for(var n,s=r,l=Element.prototype;l!==s;){n=Tl(s);for(var u in n)n[u].set&&t.push(u);s=Aa(s)}return t}function Dr(r,e,t=e){var n=new WeakSet;Da(r,"input",async s=>{var l=s?r.defaultValue:r.value;if(l=Ks(r)?Ys(l):l,t(l),bt!==null&&n.add(bt),await ou(),l!==(l=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=l??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),kn(e)==null&&r.value&&(t(Ks(r)?Ys(r.value):r.value),bt!==null&&n.add(bt)),$a(()=>{var s=e();if(r===document.activeElement){var l=as??bt;if(n.has(l))return}Ks(r)&&s===Ys(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Gs(r,e,t=e){Da(r,"change",n=>{var s=n?r.defaultChecked:r.checked;t(s)}),kn(e)==null&&t(r.checked),$a(()=>{var n=e();r.checked=!!n})}function Ks(r){var e=r.type;return e==="number"||e==="range"}function Ys(r){return r===""?null:+r}function Qo(r,e){return r===e||r?.[$r]===e}function fa(r={},e,t,n){return Jl(()=>{var s,l;return $a(()=>{s=l,l=[],kn(()=>{r!==t(...l)&&(e(r,...l),s&&Qo(t(...s),r)&&e(null,...s))})}),()=>{Fl(()=>{l&&Qo(t(...l),r)&&e(null,...l)})}}),r}function Xr(r=!1){const e=At,t=e.l.u;if(!t)return;let n=()=>fd(e.s);if(r){let s=0,l={};const u=Ci(()=>{let h=!1;const f=e.s;for(const m in f)f[m]!==l[m]&&(l[m]=f[m],h=!0);return h&&s++,s});n=()=>E(u)}t.b.length&&id(()=>{Zo(e,n),us(t.b)}),Xn(()=>{const s=kn(()=>t.m.map(cc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&Xn(()=>{Zo(e,n),us(t.a)})}function Zo(r,e){if(r.l.s)for(const t of r.l.s)E(t);e()}function Qr(r){var e=Kn(0);return function(){return arguments.length===1?(Oe(e,E(e)+1),arguments[0]):(E(e),r())}}let es=!1;function Pd(r){var e=es;try{return es=!1,[r(),es]}finally{es=e}}function fn(r,e,t,n){var s=!ti||(t&Tc)!==0,l=(t&xc)!==0,u=(t&jc)!==0,h=n,f=!0,m=()=>(f&&(f=!1,h=u?kn(n):n),h),_;if(l){var b=$r in r||fc in r;_=Wn(r,e)?.set??(b&&e in r?N=>r[e]=N:void 0)}var I,p=!1;l?[I,p]=Pd(()=>r[e]):I=r[e],I===void 0&&n!==void 0&&(I=m(),_&&(s&&bc(),_(I)));var A;if(s?A=()=>{var N=r[e];return N===void 0?m():(f=!0,N)}:A=()=>{var N=r[e];return N!==void 0&&(h=void 0),N===void 0?h:N},s&&(t&Pc)===0)return A;if(_){var U=r.$$legacy;return(function(N,G){return arguments.length>0?((!s||!G||U||p)&&_(G?A():N),N):A()})}var M=!1,W=((t&Cc)!==0?Ci:ni)(()=>(M=!1,A()));l&&E(W);var q=Qe;return(function(N,G){if(arguments.length>0){const X=G?E(W):s&&l?Gt(N):N;return Oe(W,X),M=!0,h!==void 0&&(h=X),N}return bn&&M||(q.f&yn)!==0?W.v:E(W)})}function Is(r){At===null&&jl(),ti&&At.l!==null?Rd(At).m.push(r):Xn(()=>{const e=kn(r);if(typeof e=="function")return e})}function xd(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}function jd(){const r=At;return r===null&&jl(),(e,t,n)=>{const s=r.s.$$events?.[e];if(s){const l=Ii(s)?s.slice():[s],u=xd(e,t,n);for(const h of l)h.call(r.x,u);return!u.defaultPrevented}return!0}}function Rd(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Od="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Od);Uc();const O=Gt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Lt={get currentDialogue(){return O.data?.dialogues.find(r=>r.id===O.selectedDialogueId)},get currentChapter(){return O.data?.chapters?.find(r=>r.id===O.selectedChapterId)},get currentEditingChapter(){return O.data?.chapters?.find(r=>r.id===O.editingChapterId)},get currentEditingOption(){return Lt.currentDialogue&&O.editingOptionIndex!==null?Lt.currentDialogue.options?.[O.editingOptionIndex]:void 0},get chapterDialogues(){return!O.data?.dialogues||!O.selectedChapterId?[]:O.data.dialogues.filter(r=>r.chapterId===O.selectedChapterId)},get imageResources(){return O.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return O.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return O.data?.items||[]},get backlinks(){return!O.data||!O.selectedDialogueId?[]:O.data.dialogues.filter(r=>r.nextDialogueId===O.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===O.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},it={toggleEditor(){O.showEditor=!O.showEditor},toggleItemsPanel(){O.showItems=!O.showItems},setStatus(r,e){O.statusMessage={type:r,text:e}},clearStatus(){O.statusMessage={type:"",text:""}},selectBucket(r){O.selectedBucket=r,O.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},O.storedFiles=[],O.storiesList=[],O.selectedChapterId=null,O.selectedDialogueId=null},updateBucketsList(r){O.availableBuckets=r},selectChapter(r){O.selectedChapterId=r,O.selectedDialogueId=null},selectDialogue(r){O.selectedDialogueId=r},selectOption(r){O.editingOptionIndex=r},selectItem(r){O.editingItemIndex=r},updateStoryData(r){O.data=r},updateStoredFiles(r){O.storedFiles=r},updateStoriesList(r){O.storiesList=r},setCurrentFileName(r){O.currentFileName=r},addDialogue(r){O.data.dialogues=[...O.data.dialogues,r]},updateDialogue(r,e){O.data.dialogues=O.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){O.data.dialogues=O.data.dialogues.filter(e=>e.id!==r),O.selectedDialogueId===r&&(O.selectedDialogueId=null)},addChapter(r){O.data.chapters=[...O.data.chapters,r]},updateChapter(r,e){O.data.chapters=O.data.chapters.map(t=>t.id===r?{...t,...e}:t)},selectEditingChapter(r){O.editingChapterId=r},deleteChapter(r){O.data.chapters=O.data.chapters.filter(e=>e.id!==r),O.selectedChapterId===r&&(O.selectedChapterId=null,O.selectedDialogueId=null)},addItem(r){O.data.items=[...O.data.items||[],r]},updateItem(r,e){O.data.items&&(O.data.items=O.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){O.data.items&&(O.data.items=O.data.items.filter(e=>e.id!==r))},reset(){O.showEditor=!1,O.showItems=!1,O.editingOptionIndex=null,O.editingItemIndex=null,O.selectedChapterId=null,O.selectedDialogueId=null,O.statusMessage={type:"",text:""}}},Md="modulepreload",Ld=function(r,e){return new URL(r,e).href},el={},Ti=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let m=function(_){return Promise.all(_.map(b=>Promise.resolve(b).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");s=m(t.map(_=>{if(_=Ld(_,n),_ in el)return;el[_]=!0;const b=_.endsWith(".css"),I=b?'[rel="stylesheet"]':"";if(!!n)for(let U=u.length-1;U>=0;U--){const M=u[U];if(M.href===_&&(!b||M.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${I}`))return;const A=document.createElement("link");if(A.rel=b?"stylesheet":Md,b||(A.as="script"),A.crossOrigin="",A.href=_,f&&A.setAttribute("nonce",f),document.head.appendChild(A),b)return new Promise((U,M)=>{A.addEventListener("load",U),A.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Dd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:n}=await Promise.resolve().then(()=>ii);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Ba extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class $d extends Ba{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class tl extends Ba{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class rl extends Ba{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var va;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(va||(va={}));var Fd=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class Ud{constructor(e,{headers:t={},customFetch:n,region:s=va.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Dd(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Fd(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:u}=t;let h={},{region:f}=t;f||(f=this.region);const m=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let _;u&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(h["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(h["Content-Type"]="application/json",_=JSON.stringify(u)));const b=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:_}).catch(U=>{throw new $d(U)}),I=b.headers.get("x-relay-error");if(I&&I==="true")throw new tl(b);if(!b.ok)throw new rl(b);let p=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),A;return p==="application/json"?A=yield b.json():p==="application/octet-stream"?A=yield b.blob():p==="text/event-stream"?A=b:p==="multipart/form-data"?A=yield b.formData():A=yield b.text(),{data:A,error:null,response:b}}catch(s){return{data:null,error:s,response:s instanceof rl||s instanceof tl?s.context:void 0}}})}}function Nd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Bd(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Ot={},Pn={},xn={},jn={},Rn={},On={},Wd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Zn=Wd();const Vd=Zn.fetch,vu=Zn.fetch.bind(Zn),pu=Zn.Headers,qd=Zn.Request,zd=Zn.Response,ii=Object.freeze(Object.defineProperty({__proto__:null,Headers:pu,Request:qd,Response:zd,default:vu,fetch:Vd},Symbol.toStringTag,{value:"Module"})),Hd=Bd(ii);var ts={},nl;function gu(){if(nl)return ts;nl=1,Object.defineProperty(ts,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return ts.default=r,ts}var il;function mu(){if(il)return On;il=1;var r=On&&On.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(On,"__esModule",{value:!0});const e=r(Hd),t=r(gu());class n{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let f=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var _,b,I,p;let A=null,U=null,M=null,W=m.status,q=m.statusText;if(m.ok){if(this.method!=="HEAD"){const $=await m.text();$===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?U=$:U=JSON.parse($))}const G=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),X=(I=m.headers.get("content-range"))===null||I===void 0?void 0:I.split("/");G&&X&&X.length>1&&(M=parseInt(X[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(U)&&(U.length>1?(A={code:"PGRST116",details:`Results contain ${U.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},U=null,M=null,W=406,q="Not Acceptable"):U.length===1?U=U[0]:U=null)}else{const G=await m.text();try{A=JSON.parse(G),Array.isArray(A)&&m.status===404&&(U=[],A=null,W=200,q="OK")}catch{m.status===404&&G===""?(W=204,q="No Content"):A={message:G}}if(A&&this.isMaybeSingle&&(!((p=A?.details)===null||p===void 0)&&p.includes("0 rows"))&&(A=null,W=200,q="OK"),A&&this.shouldThrowOnError)throw new t.default(A)}return{error:A,data:U,count:M,status:W,statusText:q}});return this.shouldThrowOnError||(f=f.catch(m=>{var _,b,I;return{error:{message:`${(_=m?.name)!==null&&_!==void 0?_:"FetchError"}: ${m?.message}`,details:`${(b=m?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(I=m?.code)!==null&&I!==void 0?I:""}`},data:null,count:null,status:0,statusText:""}})),f.then(l,u)}returns(){return this}overrideTypes(){return this}}return On.default=n,On}var sl;function _u(){if(sl)return Rn;sl=1;var r=Rn&&Rn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rn,"__esModule",{value:!0});const e=r(mu());class t extends e.default{select(s){let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:f=h}={}){const m=f?`${f}.order`:"order",_=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${_?`${_},`:""}${s}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:u,referencedTable:h=u}={}){const f=typeof h>"u"?"offset":`${h}.offset`,m=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(f,`${s}`),this.url.searchParams.set(m,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:f=!1,format:m="text"}={}){var _;const b=[s?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,f?"wal":null].filter(Boolean).join("|"),I=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${I}"; options=${b};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Rn.default=t,Rn}var al;function Wa(){if(al)return jn;al=1;var r=jn&&jn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jn,"__esModule",{value:!0});const e=r(_u());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const m=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${m}.${l}`),this}match(s){return Object.entries(s).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(s,l,u){return this.url.searchParams.append(s,`not.${l}.${u}`),this}or(s,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,u){return this.url.searchParams.append(s,`${l}.${u}`),this}}return jn.default=t,jn}var ol;function yu(){if(ol)return xn;ol=1;var r=xn&&xn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xn,"__esModule",{value:!0});const e=r(Wa());class t{constructor(s,{headers:l={},schema:u,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(s,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let f=!1;const m=(s??"*").split("").map(_=>/\s/.test(_)&&!f?"":(_==='"'&&(f=!f),_)).join("");return this.url.searchParams.set("select",m),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:u=!0}={}){var h;const f="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((_,b)=>_.concat(Object.keys(b)),[]);if(m.length>0){const _=[...new Set(m)].map(b=>`"${b}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:f=!0}={}){var m;const _="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const b=s.reduce((I,p)=>I.concat(Object.keys(p)),[]);if(b.length>0){const I=[...new Set(b)].map(p=>`"${p}"`);this.url.searchParams.set("columns",I.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(s,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:s}={}){var l;const u="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return xn.default=t,xn}var ll;function Gd(){if(ll)return Pn;ll=1;var r=Pn&&Pn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pn,"__esModule",{value:!0});const e=r(yu()),t=r(Wa());class n{constructor(l,{headers:u={},schema:h,fetch:f}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=f}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:f=!1,count:m}={}){var _;let b;const I=new URL(`${this.url}/rpc/${l}`);let p;h||f?(b=h?"HEAD":"GET",Object.entries(u).filter(([U,M])=>M!==void 0).map(([U,M])=>[U,Array.isArray(M)?`{${M.join(",")}}`:`${M}`]).forEach(([U,M])=>{I.searchParams.append(U,M)})):(b="POST",p=u);const A=new Headers(this.headers);return m&&A.set("Prefer",`count=${m}`),new t.default({method:b,url:I,headers:A,schema:this.schemaName,body:p,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return Pn.default=n,Pn}var ul;function Kd(){if(ul)return Ot;ul=1;var r=Ot&&Ot.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.PostgrestError=Ot.PostgrestBuilder=Ot.PostgrestTransformBuilder=Ot.PostgrestFilterBuilder=Ot.PostgrestQueryBuilder=Ot.PostgrestClient=void 0;const e=r(Gd());Ot.PostgrestClient=e.default;const t=r(yu());Ot.PostgrestQueryBuilder=t.default;const n=r(Wa());Ot.PostgrestFilterBuilder=n.default;const s=r(_u());Ot.PostgrestTransformBuilder=s.default;const l=r(mu());Ot.PostgrestBuilder=l.default;const u=r(gu());return Ot.PostgrestError=u.default,Ot.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:u.default},Ot}var Yd=Kd();const Jd=Nd(Yd),{PostgrestClient:Xd,PostgrestQueryBuilder:Xp,PostgrestFilterBuilder:Qp,PostgrestTransformBuilder:Zp,PostgrestBuilder:eg,PostgrestError:tg}=Jd;class Qd{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Zd="2.15.1",eh=`realtime-js/${Zd}`,th="1.0.0",pa=1e4,rh=1e3,nh=100;var _i;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(_i||(_i={}));var Tt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Tt||(Tt={}));var gr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(gr||(gr={}));var ga;(function(r){r.websocket="websocket"})(ga||(ga={}));var hn;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(hn||(hn={}));class ih{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=n.decode(e.slice(u,u+s));u=u+s;const f=n.decode(e.slice(u,u+l));u=u+l;const m=JSON.parse(n.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:f,payload:m}}}class wu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var _t;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(_t||(_t={}));const cl=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((l,u)=>(l[u]=sh(u,r,e,s),l),{})},sh=(r,e,t,n)=>{const s=e.find(h=>h.name===r),l=s?.type,u=t[r];return l&&!n.includes(l)?bu(l,u):ma(u)},bu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return uh(e,t)}switch(r){case _t.bool:return ah(e);case _t.float4:case _t.float8:case _t.int2:case _t.int4:case _t.int8:case _t.numeric:case _t.oid:return oh(e);case _t.json:case _t.jsonb:return lh(e);case _t.timestamp:return ch(e);case _t.abstime:case _t.date:case _t.daterange:case _t.int4range:case _t.int8range:case _t.money:case _t.reltime:case _t.text:case _t.time:case _t.timestamptz:case _t.timetz:case _t.tsrange:case _t.tstzrange:return ma(e);default:return ma(e)}},ma=r=>r,ah=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},oh=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},lh=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},uh=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let l;const u=r.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>bu(e,h))}return r},ch=r=>typeof r=="string"?r.replace(" ","T"):r,ku=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Js{constructor(e,t,n={},s=pa){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var dl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(dl||(dl={}));class yi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=yi.syncState(this.state,s,l,u),this.pendingDiffs.forEach(f=>{this.state=yi.syncDiff(this.state,f,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=yi.syncDiff(this.state,s,l,u),h())}),this.onJoin((s,l,u)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:u})}),this.onLeave((s,l,u)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const l=this.cloneDeep(e),u=this.transformState(t),h={},f={};return this.map(l,(m,_)=>{u[m]||(f[m]=_)}),this.map(u,(m,_)=>{const b=l[m];if(b){const I=_.map(M=>M.presence_ref),p=b.map(M=>M.presence_ref),A=_.filter(M=>p.indexOf(M.presence_ref)<0),U=b.filter(M=>I.indexOf(M.presence_ref)<0);A.length>0&&(h[m]=A),U.length>0&&(f[m]=U)}else h[m]=_}),this.syncDiff(l,{joins:h,leaves:f},n,s)}static syncDiff(e,t,n,s){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(l,(h,f)=>{var m;const _=(m=e[h])!==null&&m!==void 0?m:[];if(e[h]=this.cloneDeep(f),_.length>0){const b=e[h].map(p=>p.presence_ref),I=_.filter(p=>b.indexOf(p.presence_ref)<0);e[h].unshift(...I)}n(h,_,f)}),this.map(u,(h,f)=>{let m=e[h];if(!m)return;const _=f.map(b=>b.presence_ref);m=m.filter(b=>_.indexOf(b.presence_ref)<0),e[h]=m,s(h,m,f),m.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var hl;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(hl||(hl={}));var wi;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(wi||(wi={}));var Lr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Lr||(Lr={}));class Va{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Tt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Js(this,gr.join,this.params,this.timeout),this.rejoinTimer=new wu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Tt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Tt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(gr.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new yi(this),this.broadcastEndpointURL=ku(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Tt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,f=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(I=>I.filter))!==null&&s!==void 0?s:[],m=!!this.bindings[wi.PRESENCE]&&this.bindings[wi.PRESENCE].length>0,_={},b={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(I=>e?.(Lr.CHANNEL_ERROR,I)),this._onClose(()=>e?.(Lr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:I})=>{var p;if(this.socket.setAuth(),I===void 0){e?.(Lr.SUBSCRIBED);return}else{const A=this.bindings.postgres_changes,U=(p=A?.length)!==null&&p!==void 0?p:0,M=[];for(let W=0;W<U;W++){const q=A[W],{filter:{event:N,schema:G,table:X,filter:$}}=q,B=I&&I[W];if(B&&B.event===N&&B.schema===G&&B.table===X&&B.filter===$)M.push(Object.assign(Object.assign({},q),{id:B.id}));else{this.unsubscribe(),this.state=Tt.errored,e?.(Lr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=M,e&&e(Lr.SUBSCRIBED);return}}).receive("error",I=>{this.state=Tt.errored,e?.(Lr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(I).join(", ")||"error")))}).receive("timeout",()=>{e?.(Lr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Tt.joined&&e===wi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=m.body)===null||s===void 0?void 0:s.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,f;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),m.receive("ok",()=>l("ok")),m.receive("error",()=>l("error")),m.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Tt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(gr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Js(this,gr.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Tt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,l=setTimeout(()=>s.abort(),n),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),u}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Js(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>nh){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,l;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:m,join:_}=gr;if(n&&[h,f,m,_].indexOf(u)>=0&&n!==this._joinRef())return;let I=this._onMessage(u,t,n);if(t&&!I)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var A,U,M;return((A=p.filter)===null||A===void 0?void 0:A.event)==="*"||((M=(U=p.filter)===null||U===void 0?void 0:U.event)===null||M===void 0?void 0:M.toLocaleLowerCase())===u}).map(p=>p.callback(I,n)):(l=this.bindings[u])===null||l===void 0||l.filter(p=>{var A,U,M,W,q,N;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const G=p.id,X=(A=p.filter)===null||A===void 0?void 0:A.event;return G&&((U=t.ids)===null||U===void 0?void 0:U.includes(G))&&(X==="*"||X?.toLocaleLowerCase()===((M=t.data)===null||M===void 0?void 0:M.type.toLocaleLowerCase()))}else{const G=(q=(W=p?.filter)===null||W===void 0?void 0:W.event)===null||q===void 0?void 0:q.toLocaleLowerCase();return G==="*"||G===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof I=="object"&&"ids"in I){const A=I.data,{schema:U,table:M,commit_timestamp:W,type:q,errors:N}=A;I=Object.assign(Object.assign({},{schema:U,table:M,commit_timestamp:W,eventType:q,new:{},old:{},errors:N}),this._getPayloadRecords(A))}p.callback(I,n)})}_isClosed(){return this.state===Tt.closed}_isJoined(){return this.state===Tt.joined}_isJoining(){return this.state===Tt.joining}_isLeaving(){return this.state===Tt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&Va.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(gr.close,{},e)}_onError(e){this._on(gr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Tt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=cl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=cl(e.columns,e.old_record)),t}}const fl=()=>{},rs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},dh=[1e3,2e3,5e3,1e4],hh=1e4,fh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class vh{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pa,this.transport=null,this.heartbeatIntervalMs=rs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=fl,this.ref=0,this.reconnectTimer=null,this.logger=fl,this.conn=null,this.sendBuffer=[],this.serializer=new ih,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...u)=>Ti(async()=>{const{default:h}=await Promise.resolve().then(()=>ii);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ga.websocket}`,this.httpEndpoint=ku(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Qd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:th}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case _i.connecting:return hn.Connecting;case _i.open:return hn.Open;case _i.closing:return hn.Closing;default:return hn.Closed}}isConnected(){return this.connectionState()===hn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===n);if(s)return s;{const l=new Va(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:n,payload:s,ref:l}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${t} ${n} (${l})`,s),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(rh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},rs.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:l,ref:u}=t,h=u?`(${u})`:"",f=l.status||"";this.log("receive",`${f} ${n} ${s} ${h}`.trim(),l),this.channels.filter(m=>m._isMember(n)).forEach(m=>m._trigger(s,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(gr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([fh],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:eh};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(gr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new wu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},rs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,l,u,h,f,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:pa,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:rs.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>dh[_-1]||hh),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((_,b)=>b(JSON.stringify(_))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class qa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Pt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class ph extends qa{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class _a extends qa{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var gh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Eu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:n}=await Promise.resolve().then(()=>ii);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},mh=()=>gh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ti(()=>Promise.resolve().then(()=>ii),void 0,import.meta.url)).Response:Response}),ya=r=>{if(Array.isArray(r))return r.map(t=>ya(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=ya(n)}),e},_h=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var En=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Xs=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),yh=(r,e,t)=>En(void 0,void 0,void 0,function*(){const n=yield mh();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{const l=r.status||500,u=s?.statusCode||l+"";e(new ph(Xs(s),l,u))}).catch(s=>{e(new _a(Xs(s),s))}):e(new _a(Xs(r),r))}),wh=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"||!n?s:(_h(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Pi(r,e,t,n,s,l){return En(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,wh(e,n,s,l)).then(f=>{if(!f.ok)throw f;return n?.noResolveJson?f:f.json()}).then(f=>u(f)).catch(f=>yh(f,h,n))})})}function ps(r,e,t,n){return En(this,void 0,void 0,function*(){return Pi(r,"GET",e,t,n)})}function Er(r,e,t,n,s){return En(this,void 0,void 0,function*(){return Pi(r,"POST",e,n,s,t)})}function wa(r,e,t,n,s){return En(this,void 0,void 0,function*(){return Pi(r,"PUT",e,n,s,t)})}function bh(r,e,t,n){return En(this,void 0,void 0,function*(){return Pi(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function Su(r,e,t,n,s){return En(this,void 0,void 0,function*(){return Pi(r,"DELETE",e,n,s,t)})}var zt=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const kh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},vl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Eh{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Eu(s)}uploadOrUpdate(e,t,n,s){return zt(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},vl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f))):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const m=this._removeEmptyFolders(t),_=this._getFinalPath(m),b=yield(e=="PUT"?wa:Er)(this.fetch,`${this.url}/object/${_}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:m,id:b.Id,fullPath:b.Key},error:null}}catch(l){if(Pt(l))return{data:null,error:l};throw l}})}upload(e,t,n){return zt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return zt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let f;const m=Object.assign({upsert:vl.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&n instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",n)):typeof FormData<"u"&&n instanceof FormData?(f=n,f.append("cacheControl",m.cacheControl)):(f=n,_["cache-control"]=`max-age=${m.cacheControl}`,_["content-type"]=m.contentType);const b=yield wa(this.fetch,h.toString(),f,{headers:_});return{data:{path:l,fullPath:b.Key},error:null}}catch(f){if(Pt(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return zt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield Er(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new qa("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}})}update(e,t,n){return zt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return zt(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}copy(e,t,n){return zt(this,void 0,void 0,function*(){try{return{data:{path:(yield Er(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return zt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield Er(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const u=n?.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return zt(this,void 0,void 0,function*(){try{const s=yield Er(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}download(e,t){return zt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield ps(this.fetch,`${this.url}/${s}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Pt(h))return{data:null,error:h};throw h}})}info(e){return zt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield ps(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ya(n),error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}})}exists(e){return zt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield bh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Pt(n)&&n instanceof _a){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&s.push(f);let m=s.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${m}`)}}}remove(e){return zt(this,void 0,void 0,function*(){try{return{data:yield Su(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}list(e,t,n){return zt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},kh),t),{prefix:e||""});return{data:yield Er(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(Pt(s))return{data:null,error:s};throw s}})}listV2(e,t){return zt(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Er(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Sh="2.11.0",Ih={"X-Client-Info":`storage-js/${Sh}`};var Mn=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class Ah{constructor(e,t={},n,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Ih),t),this.fetch=Eu(n)}listBuckets(){return Mn(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Pt(e))return{data:null,error:e};throw e}})}getBucket(e){return Mn(this,void 0,void 0,function*(){try{return{data:yield ps(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Mn(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Mn(this,void 0,void 0,function*(){try{return{data:yield wa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Mn(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Mn(this,void 0,void 0,function*(){try{return{data:yield Su(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Pt(t))return{data:null,error:t};throw t}})}}class Ch extends Ah{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new Eh(this.url,this.headers,e,this.fetch)}}const Th="2.56.0";let gi="";typeof Deno<"u"?gi="deno":typeof document<"u"?gi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?gi="react-native":gi="node";const Ph={"X-Client-Info":`supabase-js-${gi}/${Th}`},xh={headers:Ph},jh={schema:"public"},Rh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Oh={};var Mh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Lh=r=>{let e;return r?e=r:typeof fetch>"u"?e=vu:e=fetch,(...t)=>e(...t)},Dh=()=>typeof Headers>"u"?pu:Headers,$h=(r,e,t)=>{const n=Lh(t),s=Dh();return(l,u)=>Mh(void 0,void 0,void 0,function*(){var h;const f=(h=yield e())!==null&&h!==void 0?h:r;let m=new s(u?.headers);return m.has("apikey")||m.set("apikey",r),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),n(l,Object.assign(Object.assign({},u),{headers:m}))})};var Fh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};function Uh(r){return r.endsWith("/")?r:r+"/"}function Nh(r,e){var t,n;const{db:s,auth:l,realtime:u,global:h}=r,{db:f,auth:m,realtime:_,global:b}=e,I={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},m),l),realtime:Object.assign(Object.assign({},_),u),storage:{},global:Object.assign(Object.assign(Object.assign({},b),h),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Fh(this,void 0,void 0,function*(){return""})};return r.accessToken?I.accessToken=r.accessToken:delete I.accessToken,I}const Iu="2.71.1",Nn=30*1e3,ba=3,Qs=ba*Nn,Bh="http://localhost:9999",Wh="supabase.auth.token",Vh={"X-Client-Info":`gotrue-js/${Iu}`},ka="X-Supabase-Api-Version",Au={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},qh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,zh=600*1e3;class za extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Fe(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Hh extends za{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Gh(r){return Fe(r)&&r.name==="AuthApiError"}class Cu extends za{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Zr extends za{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class qr extends Zr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Kh(r){return Fe(r)&&r.name==="AuthSessionMissingError"}class ns extends Zr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class is extends Zr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ss extends Zr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Yh(r){return Fe(r)&&r.name==="AuthImplicitGrantRedirectError"}class pl extends Zr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ea extends Zr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Zs(r){return Fe(r)&&r.name==="AuthRetryableFetchError"}class gl extends Zr{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Sa extends Zr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const gs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ml=` 	
\r=`.split(""),Jh=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<ml.length;e+=1)r[ml[e].charCodeAt(0)]=-2;for(let e=0;e<gs.length;e+=1)r[gs[e].charCodeAt(0)]=e;return r})();function _l(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(gs[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(gs[n]),e.queuedBits-=6}}function Tu(r,e,t){const n=Jh[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function yl(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=u=>{Zh(u,n,t)};for(let u=0;u<r.length;u+=1)Tu(r.charCodeAt(u),s,l);return e.join("")}function Xh(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Qh(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Xh(n,e)}}function Zh(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ef(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)Tu(r.charCodeAt(s),t,n);return new Uint8Array(e)}function tf(r){const e=[];return Qh(r,t=>e.push(t)),new Uint8Array(e)}function rf(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>_l(s,t,n)),_l(null,t,n),e.join("")}function nf(r){return Math.round(Date.now()/1e3)+r}function sf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const vr=()=>typeof window<"u"&&typeof document<"u",on={tested:!1,writable:!1},Pu=()=>{if(!vr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(on.tested)return on.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),on.tested=!0,on.writable=!0}catch{on.tested=!0,on.writable=!1}return on.writable};function af(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const xu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:n}=await Promise.resolve().then(()=>ii);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},of=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Bn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ln=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Vr=async(r,e)=>{await r.removeItem(e)};class As{constructor(){this.promise=new As.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}As.promiseConstructor=Promise;function ea(r){const e=r.split(".");if(e.length!==3)throw new Sa("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!qh.test(e[n]))throw new Sa("JWT not in base64url format");return{header:JSON.parse(yl(e[0])),payload:JSON.parse(yl(e[1])),signature:ef(e[2]),raw:{header:e[0],payload:e[1]}}}async function lf(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function uf(r,e){return new Promise((n,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await r(l);if(!e(l,null,u)){n(u);return}}catch(u){if(!e(l,u)){s(u);return}}})()})}function cf(r){return("0"+r.toString(16)).substr(-2)}function df(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,cf).join("")}async function hf(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function ff(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await hf(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ln(r,e,t=!1){const n=df();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await Bn(r,`${e}-code-verifier`,s);const l=await ff(n);return[l,n===l?"plain":"s256"]}const vf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function pf(r){const e=r.headers.get(ka);if(!e||!e.match(vf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function gf(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function mf(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const _f=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Dn(r){if(!_f.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ta(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function wl(r){return JSON.parse(JSON.stringify(r))}var yf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const cn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),wf=[502,503,504];async function bl(r){var e;if(!of(r))throw new Ea(cn(r),0);if(wf.includes(r.status))throw new Ea(cn(r),r.status);let t;try{t=await r.json()}catch(l){throw new Cu(cn(l),l)}let n;const s=pf(r);if(s&&s.getTime()>=Au["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new gl(cn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new qr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new gl(cn(t),r.status,t.weak_password.reasons);throw new Hh(cn(t),r.status||500,n)}const bf=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function He(r,e,t,n){var s;const l=Object.assign({},n?.headers);l[ka]||(l[ka]=Au["2024-01-01"].name),n?.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const u=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(u.redirect_to=n.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await kf(r,e,t+h,{headers:l,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(f):{data:Object.assign({},f),error:null}}async function kf(r,e,t,n,s,l){const u=bf(e,n,s,l);let h;try{h=await r(t,Object.assign({},u))}catch(f){throw console.error(f),new Ea(cn(f),0)}if(h.ok||await bl(h),n?.noResolveJson)return h;try{return await h.json()}catch(f){await bl(f)}}function Mr(r){var e;let t=null;Af(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=nf(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function kl(r){const e=Mr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function zr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Ef(r){return{data:r,error:null}}function Sf(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l}=r,u=yf(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function If(r){return r}function Af(r){return r.access_token&&r.refresh_token&&r.expires_in}const ra=["global","local","others"];var Cf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class Tf{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=xu(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ra[0]){if(ra.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ra.join(", ")}`);try{return await He(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Fe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await He(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:zr})}catch(n){if(Fe(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Cf(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await He(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Sf,redirectTo:t?.redirectTo})}catch(t){if(Fe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await He(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:zr})}catch(t){if(Fe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,l,u,h,f;try{const m={nextPage:null,lastPage:0,total:0},_=await He(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:If});if(_.error)throw _.error;const b=await _.json(),I=(u=_.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(f=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return p.length>0&&(p.forEach(A=>{const U=parseInt(A.split(";")[0].split("=")[1].substring(0,1)),M=JSON.parse(A.split(";")[1].split("=")[1]);m[`${M}Page`]=U}),m.total=parseInt(I)),{data:Object.assign(Object.assign({},b),m),error:null}}catch(m){if(Fe(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){Dn(e);try{return await He(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:zr})}catch(t){if(Fe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Dn(e);try{return await He(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:zr})}catch(n){if(Fe(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Dn(e);try{return await He(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:zr})}catch(n){if(Fe(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Dn(e.userId);try{const{data:t,error:n}=await He(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(Fe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Dn(e.userId),Dn(e.id);try{return{data:await He(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Fe(t))return{data:null,error:t};throw t}}}function El(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Pf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const $n={debug:!!(globalThis&&Pu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ju extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class xf extends ju{}async function jf(r,e,t){$n.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),$n.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){$n.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{$n.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw $n.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new xf(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if($n.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Pf();const Rf={url:Bh,storageKey:Wh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Sl(r,e,t){return await t()}const Fn={};class Si{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Si.nextInstanceID,Si.nextInstanceID+=1,this.instanceID>0&&vr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Rf),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Tf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=xu(s.fetch),this.lock=s.lock||Sl,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:vr()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=jf:this.lock=Sl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Pu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=El(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=El(this.memoryStorage)),vr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Fn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Fn[this.storageKey]=Object.assign(Object.assign({},Fn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Fn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fn[this.storageKey]=Object.assign(Object.assign({},Fn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Iu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=af(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),vr()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Yh(l)){const f=(e=l.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Fe(t)?{error:t}:{error:new Cu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const l=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Mr}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(Fe(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,n,s;try{let l;if("email"in e){const{email:_,password:b,options:I}=e;let p=null,A=null;this.flowType==="pkce"&&([p,A]=await Ln(this.storage,this.storageKey)),l=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:I?.emailRedirectTo,body:{email:_,password:b,data:(t=I?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:I?.captchaToken},code_challenge:p,code_challenge_method:A},xform:Mr})}else if("phone"in e){const{phone:_,password:b,options:I}=e;l=await He(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:b,data:(n=I?.data)!==null&&n!==void 0?n:{},channel:(s=I?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:I?.captchaToken}},xform:Mr})}else throw new is("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(Fe(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:kl})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await He(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:kl})}else throw new is("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new ns}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(Fe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,l,u,h,f,m,_,b,I,p;let A,U;if("message"in e)A=e.message,U=e.signature;else{const{chain:M,wallet:W,statement:q,options:N}=e;let G;if(vr())if(typeof W=="object")G=W;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))G=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof W!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");G=W}const X=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in G&&G.signIn){const $=await G.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:X.host,uri:X.href}),q?{statement:q}:null));let B;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")B=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)B=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)A=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),U=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in G)||typeof G.signMessage!="function"||!("publicKey"in G)||typeof G!="object"||!G.publicKey||!("toBase58"in G.publicKey)||typeof G.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");A=[`${X.host} wants you to sign in with your Solana account:`,G.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${X.href}`,`Issued At: ${(s=(n=N?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=N?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((u=N?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((f=N?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((m=N?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((b=(_=N?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||b===void 0)&&b.length?["Resources",...N.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const $=await G.signMessage(new TextEncoder().encode(A),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");U=$}}try{const{data:M,error:W}=await He(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:A,signature:rf(U)},!((I=e.options)===null||I===void 0)&&I.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Mr});if(W)throw W;return!M||!M.session||!M.user?{data:{user:null,session:null},error:new ns}:(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",M.session)),{data:Object.assign({},M),error:W})}catch(M){if(Fe(M))return{data:{user:null,session:null},error:M};throw M}}async _exchangeCodeForSession(e){const t=await ln(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:l,error:u}=await He(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Mr});if(await Vr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new ns}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:u})}catch(l){if(Fe(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:l,nonce:u}=e,h=await He(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Mr}),{data:f,error:m}=h;return m?{data:{user:null,session:null},error:m}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new ns}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:m})}catch(t){if(Fe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,l,u;try{if("email"in e){const{email:h,options:f}=e;let m=null,_=null;this.flowType==="pkce"&&([m,_]=await Ln(this.storage,this.storageKey));const{error:b}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(n=f?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:_},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:h,options:f}=e,{data:m,error:_}=await He(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:_}}throw new is("You must provide either an email or phone number.")}catch(h){if(Fe(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:u,error:h}=await He(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Mr});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,m=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(s){if(Fe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Ln(this.storage,this.storageKey)),await He(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Ef})}catch(l){if(Fe(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new qr;const{error:s}=await He(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Fe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:l}=e,{error:u}=await He(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:n,type:s,options:l}=e,{data:u,error:h}=await He(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new is("You must provide either an email or phone number and a type")}catch(t){if(Fe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ln(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Qs:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const u=await ln(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ta()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,m,_)=>(!u&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,m,_))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:zr}):await this._useSession(async t=>{var n,s,l;const{data:u,error:h}=t;if(h)throw h;return!(!((n=u.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new qr}:await He(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:zr})})}catch(t){if(Fe(t))return Kh(t)&&(await this._removeSession(),await Vr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:l}=n;if(l)throw l;if(!s.session)throw new qr;const u=s.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await Ln(this.storage,this.storageKey));const{data:m,error:_}=await He(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:zr});if(_)throw _;return u.user=m.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(n){if(Fe(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new qr;const t=Date.now()/1e3;let n=t,s=!0,l=null;const{payload:u}=ea(e.access_token);if(u.exp&&(n=u.exp,s=n<=t),s){const{session:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)throw f;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Fe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(n=u.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new qr;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Fe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!vr())throw new ss("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ss(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new pl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ss("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new pl("No code detected.");const{data:q,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const G=new URL(window.location.href);return G.searchParams.delete("code"),window.history.replaceState(window.history.state,"",G.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:l,refresh_token:u,expires_in:h,expires_at:f,token_type:m}=e;if(!l||!h||!u||!m)throw new ss("No session defined in URL");const _=Math.round(Date.now()/1e3),b=parseInt(h);let I=_+b;f&&(I=parseInt(f));const p=I-_;p*1e3<=Nn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${b}s`);const A=I-b;_-A>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",A,I,_):_-A<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",A,I,_);const{data:U,error:M}=await this._getUser(l);if(M)throw M;const W={provider_token:n,provider_refresh_token:s,access_token:l,expires_in:b,expires_at:I,refresh_token:u,token_type:m,user:U.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:W,redirectType:e.type},error:null}}catch(n){if(Fe(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ln(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{error:l};const u=(n=s.session)===null||n===void 0?void 0:n.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Gh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Vr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=sf(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:l},error:u}=t;if(u)throw u;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Ln(this.storage,this.storageKey,!0));try{return await He(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Fe(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Fe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async l=>{var u,h,f,m,_;const{data:b,error:I}=l;if(I)throw I;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await He(this.fetch,"GET",p,{headers:this.headers,jwt:(_=(m=b.session)===null||m===void 0?void 0:m.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return vr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(Fe(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:u}=t;if(u)throw u;return await He(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Fe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await uf(async s=>(s>0&&await lf(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await He(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Mr})),(s,l)=>{const u=200*Math.pow(2,s);return l&&Zs(l)&&Date.now()+u-n<Nn})}catch(n){if(this._debug(t,"error",n),Fe(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),vr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await ln(this.storage,this.storageKey);if(s&&this.userStorage){let u=await ln(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:s.user},await Bn(this.userStorage,this.storageKey+"-user",u)),s.user=(e=u?.user)!==null&&e!==void 0?e:ta()}else if(s&&!s.user&&!s.user){const u=await ln(this.storage,this.storageKey+"-user");u&&u?.user?(s.user=u.user,await Vr(this.storage,this.storageKey+"-user"),await Bn(this.storage,this.storageKey,s)):s.user=ta()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qs;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${Qs}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:u}=await this._callRefreshToken(s.refresh_token);u&&(console.error(u),Zs(u)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(s.access_token);!h&&u?.user?(s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(n,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new qr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new As;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new qr;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),Fe(l)){const u={session:null,error:l};return Zs(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(f){l.push(f)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Bn(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=wl(s);await Bn(this.storage,this.storageKey,l)}else{const s=wl(t);await Bn(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Vr(this.storage,this.storageKey),await Vr(this.storage,this.storageKey+"-code-verifier"),await Vr(this.storage,this.storageKey+"-user"),this.userStorage&&await Vr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Nn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Nn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Nn}ms, refresh threshold is ${ba} ticks`),s<=ba&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ju)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!vr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,u]=await Ln(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});s.push(h.toString())}if(n?.queryParams){const l=new URLSearchParams(n.queryParams);s.push(l.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await He(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Fe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:m}=await He(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((s=f?.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(Fe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await He(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(Fe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await He(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Fe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],s=n.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=n.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:n,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ea(s.access_token);let h=null;u.aal&&(h=u.aal);let f=h;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(f="aal2");const _=u.amr||[];return{data:{currentLevel:h,nextLevel:f,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+zh>s)return n;const{data:l,error:u}=await He(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,n=l.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:A}=await this.getSession();if(A||!p.session)return{data:null,error:A};n=p.session.access_token}const{header:s,payload:l,signature:u,raw:{header:h,payload:f}}=ea(n);t?.allowExpired||gf(l.exp);const m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:l,header:s,signature:u},error:null}}const _=mf(s.alg),b=await crypto.subtle.importKey("jwk",m,_,!0,["verify"]);if(!await crypto.subtle.verify(_,b,u,tf(`${h}.${f}`)))throw new Sa("Invalid JWT signature");return{data:{claims:l,header:s,signature:u},error:null}}catch(n){if(Fe(n))return{data:null,error:n};throw n}}}Si.nextInstanceID=0;const Of=Si;class Mf extends Of{constructor(e){super(e)}}var Lf=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class Df{constructor(e,t,n){var s,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Uh(e),f=new URL(h);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const m=`sb-${f.hostname.split(".")[0]}-auth-token`,_={db:jh,realtime:Oh,auth:Object.assign(Object.assign({},Rh),{storageKey:m}),global:xh},b=Nh(n??{},_);this.storageKey=(s=b.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=b.global.headers)!==null&&l!==void 0?l:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(I,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=b.auth)!==null&&u!==void 0?u:{},this.headers,b.global.fetch),this.fetch=$h(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new Xd(new URL("rest/v1",f).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new Ch(this.storageUrl.href,this.headers,this.fetch,n?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Ud(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Lf(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:l,flowType:u,lock:h,debug:f},m,_){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Mf({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:u,lock:h,debug:f,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new vh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const $f=(r,e,t)=>new Df(r,e,t);function Ff(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Ff()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Uf="https://vycjpmuyscfygstjjied.supabase.co",Nf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Sr=$f(Uf,Nf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Yr={async loadStoriesList(){if(!O.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${O.selectedBucket}`);const r=`${O.selectedBucket}_story.json`,{data:e,error:t}=await Sr.storage.from(O.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(O.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(O.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!O.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await Sr.storage.from(O.selectedBucket).list();r&&(O.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!O.selectedBucket){it.setStatus("error","Не выбрана история");return}const t=e.files[0];it.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),s=new Uint8Array(n),{error:l}=await Sr.storage.from(O.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?it.setStatus("error","Ошибка загрузки"):(it.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!O.selectedBucket){it.setStatus("error","Не выбрана история");return}const{error:e}=await Sr.storage.from(O.selectedBucket).remove([r]);e?it.setStatus("error","Ошибка удаления файла"):(it.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Bf(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function Wf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const vn={async createNewStory(){if(!O.selectedBucket){it.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await Sr.storage.from(O.selectedBucket).upload(r,s,{contentType:"application/json"});l?it.setStatus("error","Ошибка создания: "+l.message):(await Yr.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!O.selectedBucket){it.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${O.selectedBucket}`),it.setStatus("loading","Загрузка..."),O.currentFileName=r;try{const{data:e,error:t}=await Sr.storage.from(O.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Sr.storage.from(O.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);n=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let s=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Bf(s),console.log("[StoryStore] Присваиваем данные в editor.data"),O.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:O.data.chapters?.length,dialogues:O.data.dialogues?.length}),O.data.chapters&&O.data.chapters.length>0&&(O.selectedChapterId=O.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${O.selectedChapterId}`)),O.data.dialogues&&O.data.dialogues.length>0&&(O.selectedDialogueId=O.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${O.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),it.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),it.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!O.data)return;if(!O.selectedBucket){it.setStatus("error","Не выбрана история (bucket)");return}it.setStatus("loading","Сохранение...");const r=JSON.stringify(O.data,null,2);console.log(`[StoryStore] Сохранение файла: ${O.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await Sr.storage.from(O.selectedBucket).update(O.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const s=await Sr.storage.from(O.selectedBucket).upload(O.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),it.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),it.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),it.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!O.data)return;if(!O.selectedBucket){it.setStatus("error","Не выбрана история (bucket)");return}const r=O.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),it.setStatus("loading","Создание копии...");const s=JSON.stringify(O.data,null,2),u=new TextEncoder().encode(s),{error:h}=await Sr.storage.from(O.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?it.setStatus("error",`Ошибка копии: ${h.message}`):(await Yr.loadStoriesList(),it.setStatus("success","Копия сохранена!"))},addChapter(){if(!O.data||!O.data.chapters)return;const r="ch_"+Date.now();O.data.chapters.push({id:r,title:"Новая глава",description:""}),O.selectedChapterId=r},addDialogue(){if(!O.data||!O.selectedChapterId)return;const r="d_"+Date.now();O.data.dialogues.push({id:r,chapterId:O.selectedChapterId,text:"Новый текст...",options:[]}),O.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&O.data&&(O.data.dialogues=O.data.dialogues.filter(e=>e.id!==r),O.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),O.selectedDialogueId===r&&(O.selectedDialogueId=null))},jumpTo(r){const e=O.data?.dialogues.find(t=>t.id===r);e&&(O.selectedChapterId=e.chapterId,O.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var Kt=Qr(()=>Lt);function Vf(){it.selectEditingChapter(null)}var qf=ne('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function zf(r,e){Wt(e,!1);function t(){Kt().currentEditingChapter&&(it.updateChapter(Kt().currentEditingChapter.id,{title:Kt().currentEditingChapter.title,description:Kt().currentEditingChapter.description}),it.selectEditingChapter(null))}function n(){Kt().currentEditingChapter&&confirm(`Удалить главу "${Kt().currentEditingChapter.title}"?`)&&(it.deleteChapter(Kt().currentEditingChapter.id),it.selectEditingChapter(null))}Xr();var s=Jt(),l=xt(s);{var u=h=>{var f=qf(),m=x(f),_=F(x(m),2),b=x(_);b.__click=n;var I=F(m,2),p=F(x(I),2),A=F(I,2),U=F(x(A),2),M=F(A,2),W=x(M);W.__click=[Vf];var q=F(W,2);q.__click=t,Dr(p,()=>Kt().currentEditingChapter.title,N=>Kt(Kt().currentEditingChapter.title=N)),Dr(U,()=>Kt().currentEditingChapter.description,N=>Kt(Kt().currentEditingChapter.description=N)),K(h,f)};je(l,h=>{Kt().currentEditingChapter&&h(u)})}K(r,s),Vt()}Qt(["click"]);var Yt=Qr(()=>O),Hf=(r,e,t)=>e(E(t).id),Gf=ne('<div class="chapter-form-container svelte-xp6igx"><!></div>'),Kf=ne('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),Yf=ne('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),Jf=ne("<div> </div>"),Xf=ne('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function Qf(r,e){Wt(e,!1);function t(W){it.selectEditingChapter(W)}Xr();var n=Xf(),s=x(n),l=x(s),u=F(x(l),2);u.__click=function(...W){vn.addChapter?.apply(this,W)};var h=F(l,2);Et(h,5,()=>Yt().data?.chapters||[],W=>W.id,(W,q)=>{var N=Kf(),G=xt(N),X=x(G);let $;X.__click=()=>Yt(Yt().selectedChapterId=E(q).id);var B=x(X),oe=x(B),ee=F(X,2);ee.__click=[Hf,t,q];var ge=F(G,2);{var Q=te=>{var me=Gf(),Te=x(me);zf(Te,{}),K(te,me)};je(ge,te=>{Yt().editingChapterId===E(q).id&&te(Q)})}be(te=>{$=or(X,1,"chapter-item svelte-xp6igx",null,$,te),xe(X,"aria-pressed",Yt().selectedChapterId===E(q).id),Ae(oe,E(q).title)},[()=>({active:Yt().selectedChapterId===E(q).id})]),K(W,N)});var f=F(s,2),m=x(f),_=x(m),b=x(_),I=F(_,2);I.__click=function(...W){vn.addDialogue?.apply(this,W)};var p=F(m,2);Et(p,5,()=>Lt.chapterDialogues,W=>W.id,(W,q)=>{var N=Yf();let G;N.__click=()=>Yt(Yt().selectedDialogueId=E(q).id);var X=x(N),$=x(X),B=F(X,2),oe=x(B);be((ee,ge)=>{G=or(N,1,"dialogue-item svelte-xp6igx",null,G,ee),xe(N,"aria-pressed",Yt().selectedDialogueId===E(q).id),Ae($,E(q).id),Ae(oe,`${ge??""}...`)},[()=>({active:Yt().selectedDialogueId===E(q).id}),()=>E(q).text.substring(0,25)]),K(W,N)});var A=F(f,2),U=x(A);{var M=W=>{var q=Jf(),N=x(q);be(()=>{or(q,1,`alert ${Yt().statusMessage.type??""}`,"svelte-xp6igx"),Ae(N,Yt().statusMessage.text)}),K(W,q)};je(U,W=>{Yt().statusMessage.text&&W(M)})}be(()=>{Ae(b,`Сцены (${Lt.chapterDialogues.length??""})`),I.disabled=!Yt().selectedChapterId}),K(r,n),Vt()}Qt(["click"]);var Zf=ne("<option> </option>"),ev=(r,e)=>{r.target.checked&&!e().miniGame&&(e().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""})},tv=ne("<option> </option>"),rv=ne("<option> </option>"),nv=ne("<option> </option>"),iv=ne('<div class="minigame-details svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option></select></div> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-92kmf5"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-92kmf5"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),sv=(r,e)=>{const t=r.target.value;e({type:t})},av=ne("<option> </option>"),ov=(r,e)=>e({itemId:r.target.value}),lv=ne("<option> </option>"),uv=ne('<div class="form-group full-width svelte-92kmf5"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),cv=(r,e)=>e({statName:r.target.value}),dv=(r,e)=>e({statValue:parseInt(r.target.value)||0}),hv=ne('<div class="form-group svelte-92kmf5"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-92kmf5"><label>Значение ></label> <input type="number" class="input"/></div>',1),fv=(r,e)=>e({flagName:r.target.value}),vv=ne('<div class="form-group full-width svelte-92kmf5"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),pv=ne('<div class="option-details svelte-92kmf5"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-92kmf5"><div class="section-header svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-92kmf5"><div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-92kmf5">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-92kmf5">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-92kmf5"><h5 class="svelte-92kmf5">Условие видимости</h5> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function gv(r,e){Wt(e,!0);const t=fn(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return n(),t().visibilityCondition}function l(ae){n(),t().visibilityCondition={...t().visibilityCondition,...ae}}var u=pv(),h=x(u),f=x(h),m=F(f,2),_=F(h,2),b=x(_),I=F(b,2),p=x(I);p.value=p.__value="";var A=F(p);Et(A,17,()=>e.dialogues,Ft,(ae,Me)=>{var ye=Zf(),De=x(ye),Pe={};be(ke=>{Ae(De,`${E(Me).id??""}: ${ke??""}...`),Pe!==(Pe=E(Me).id)&&(ye.value=(ye.__value=E(Me).id)??"")},[()=>E(Me).text.substring(0,30)]),K(ae,ye)});var U=F(_,2),M=x(U),W=x(M),q=x(W);q.__change=[ev,t];var N=F(M,2);{var G=ae=>{var Me=iv(),ye=x(Me),De=x(ye),Pe=F(De,2),ke=x(Pe);ke.value=ke.__value="";var Ee=F(ke);Ee.value=Ee.__value="onet_monsters";var he=F(ye,2),ze=x(he),Ce=x(ze),dt=F(Ce,2),st=x(dt);st.value=st.__value="";var at=F(st);Et(at,17,()=>e.dialogues,Ft,(w,C)=>{var S=tv(),T=x(S),L={};be(z=>{Ae(T,`${E(C).id??""}: ${z??""}...`),L!==(L=E(C).id)&&(S.value=(S.__value=E(C).id)??"")},[()=>E(C).text.substring(0,30)]),K(w,S)});var ut=F(ze,2),Dt=x(ut),vt=F(Dt,2),qt=x(vt);qt.value=qt.__value="";var Zt=F(qt);Et(Zt,17,()=>e.dialogues,Ft,(w,C)=>{var S=rv(),T=x(S),L={};be(z=>{Ae(T,`${E(C).id??""}: ${z??""}...`),L!==(L=E(C).id)&&(S.value=(S.__value=E(C).id)??"")},[()=>E(C).text.substring(0,30)]),K(w,S)});var nr=F(he,2),Ct=x(nr),g=F(Ct,2),o=x(g);o.value=o.__value="";var d=F(o);Et(d,17,()=>e.availableItems,Ft,(w,C)=>{var S=nv(),T=x(S),L={};be(()=>{Ae(T,E(C).name),L!==(L=E(C).id)&&(S.value=(S.__value=E(C).id)??"")}),K(w,S)}),be(()=>{xe(De,"for",`option-mg-id-${e.index??""}`),xe(Pe,"id",`option-mg-id-${e.index??""}`),xe(Ce,"for",`option-mg-win-${e.index??""}`),xe(dt,"id",`option-mg-win-${e.index??""}`),xe(Dt,"for",`option-mg-lose-${e.index??""}`),xe(vt,"id",`option-mg-lose-${e.index??""}`),xe(Ct,"for",`option-mg-reward-${e.index??""}`),xe(g,"id",`option-mg-reward-${e.index??""}`)}),Ar(Pe,()=>t().miniGame.id,w=>t().miniGame.id=w),Ar(dt,()=>t().miniGame.onWinDialogueId,w=>t().miniGame.onWinDialogueId=w),Ar(vt,()=>t().miniGame.onLoseDialogueId,w=>t().miniGame.onLoseDialogueId=w),Ar(g,()=>t().miniGame.rewardItem,w=>t().miniGame.rewardItem=w),K(ae,Me)};je(N,ae=>{t().miniGame&&ae(G)})}var X=F(U,2),$=x(X),B=x($),oe=x(B),ee=F($,2),ge=x(ee),Q=x(ge),te=F(X,2),me=F(x(te),2),Te=x(me),ce=x(Te),_e=F(ce,2);_e.__change=[sv,l],Et(_e,21,()=>e.conditionTypes,Ft,(ae,Me)=>{var ye=av(),De=x(ye),Pe={};be(()=>{Ae(De,E(Me)),Pe!==(Pe=E(Me))&&(ye.value=(ye.__value=E(Me))??"")}),K(ae,ye)});var pe;ha(_e);var ct=F(Te,2);{var Ge=ae=>{var Me=uv(),ye=x(Me),De=F(ye,2);De.__change=[ov,l];var Pe=x(De);Pe.value=Pe.__value="";var ke=F(Pe);Et(ke,17,()=>e.availableItems,Ft,(he,ze)=>{var Ce=lv(),dt=x(Ce),st={};be(()=>{Ae(dt,E(ze).name),st!==(st=E(ze).id)&&(Ce.value=(Ce.__value=E(ze).id)??"")}),K(he,Ce)});var Ee;ha(De),be(he=>{xe(ye,"for",`option-cond-item-${e.index??""}`),xe(De,"id",`option-cond-item-${e.index??""}`),Ee!==(Ee=he)&&(De.value=(De.__value=he)??"",vs(De,he))},[()=>s().itemId||""]),K(ae,Me)};je(ct,ae=>{s().type==="has_item"&&ae(Ge)})}var qe=F(ct,2);{var rt=ae=>{var Me=hv(),ye=xt(Me),De=x(ye),Pe=F(De,2);Pe.__input=[cv,l];var ke=F(ye,2),Ee=x(ke),he=F(Ee,2);he.__input=[dv,l],be((ze,Ce)=>{xe(De,"for",`option-cond-stat-${e.index??""}`),xe(Pe,"id",`option-cond-stat-${e.index??""}`),Hs(Pe,ze),xe(Ee,"for",`option-cond-stat-val-${e.index??""}`),xe(he,"id",`option-cond-stat-val-${e.index??""}`),Hs(he,Ce)},[()=>s().statName||"",()=>s().statValue||""]),K(ae,Me)};je(qe,ae=>{s().type==="stat_greater"&&ae(rt)})}var lt=F(qe,2);{var Re=ae=>{var Me=vv(),ye=x(Me),De=F(ye,2);De.__input=[fv,l],be(Pe=>{xe(ye,"for",`option-cond-flag-${e.index??""}`),xe(De,"id",`option-cond-flag-${e.index??""}`),Hs(De,Pe)},[()=>s().flagName||""]),K(ae,Me)};je(lt,ae=>{s().type==="flag_true"&&ae(Re)})}be(ae=>{xe(f,"for",`option-text-${e.index??""}`),xe(m,"id",`option-text-${e.index??""}`),xe(b,"for",`option-next-${e.index??""}`),xe(I,"id",`option-next-${e.index??""}`),xe(ce,"for",`option-cond-type-${e.index??""}`),xe(_e,"id",`option-cond-type-${e.index??""}`),pe!==(pe=ae)&&(_e.value=(_e.__value=ae)??"",vs(_e,ae))},[()=>s().type]),Dr(m,()=>t().text,ae=>t().text=ae),Ar(I,()=>t().nextDialogueId,ae=>t().nextDialogueId=ae),Gs(q,()=>t().miniGame,ae=>t().miniGame=ae),Gs(oe,()=>t().enabled,ae=>t().enabled=ae),Gs(Q,()=>t().visible,ae=>t().visible=ae),K(r,u),Vt()}Qt(["change","input"]);var mt=Qr(()=>O),et=Qr(()=>Lt),mv=ne("<option> <!></option>"),_v=ne("<option> </option>"),yv=ne("<option> </option>"),wv=ne("<option> </option>"),bv=ne("<option> </option>"),kv=ne('<div class="option-content svelte-1de8com"><!></div>'),Ev=ne('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Sv=ne("<option> </option>"),Iv=ne('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-chapter" class="svelte-1de8com">Глава</label> <select id="dialogue-chapter" class="input select svelte-1de8com"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),Av=ne('<div class="empty-state">Выберите сцену</div>');function Cv(r,e){Wt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(_){_.options||(_.options=[]);const b=Wf();_.options.push(b),mt(mt().editingOptionIndex=_.options.length-1)}function s(_){if(mt().editingOptionIndex===_)mt(mt().editingOptionIndex=null);else{mt(mt().editingOptionIndex=_);const b=et().currentDialogue?.options?.[_];b&&!b.visibilityCondition&&(b.visibilityCondition={type:"always"})}}function l(_,b){confirm("Удалить вариант ответа?")&&(_.options?.splice(b,1),mt().editingOptionIndex===b?mt(mt().editingOptionIndex=null):mt().editingOptionIndex&&mt().editingOptionIndex>b&&mt(mt().editingOptionIndex--))}Xr();var u=Jt(),h=xt(u);{var f=_=>{var b=Iv(),I=x(b),p=F(x(I),2);p.__change=ke=>mt(mt().selectedDialogueId=ke.target?.value);var A=F(I,2),U=F(x(A),2);be(()=>{et(),pr(()=>{mt()})}),U.__change=ke=>mt(mt().selectedChapterId=ke.target?.value);var M=x(U);M.value=M.__value="";var W=F(M);Et(W,1,()=>mt().data.chapters||[],Ft,(ke,Ee)=>{var he=mv(),ze=x(he),Ce=F(ze);{var dt=at=>{var ut=Zi();be(Dt=>Ae(ut,`- ${Dt??""}...`),[()=>E(Ee).description.substring(0,30)]),K(at,ut)};je(Ce,at=>{E(Ee).description&&at(dt)})}var st={};be(()=>{Ae(ze,`${E(Ee).title??""} `),st!==(st=E(Ee).id)&&(he.value=(he.__value=E(Ee).id)??"")}),K(ke,he)});var q=F(A,2),N=F(x(q),2),G=F(q,2),X=F(x(G),2),$=F(x(X),2),B=x($);be(()=>{et(),pr(()=>{})});var oe=x(B);oe.value=oe.__value="";var ee=F(oe);Et(ee,1,()=>et().imageResources,Ft,(ke,Ee)=>{var he=_v(),ze=x(he),Ce={};be(()=>{Ae(ze,E(Ee).name),Ce!==(Ce=E(Ee).name)&&(he.value=(he.__value=E(Ee).name)??"")}),K(ke,he)});var ge=F(ee);Et(ge,1,()=>et().riveResources,Ft,(ke,Ee)=>{var he=yv(),ze=x(he),Ce={};be(()=>{Ae(ze,`${E(Ee).name??""} (Rive)`),Ce!==(Ce=E(Ee).name)&&(he.value=(he.__value=E(Ee).name)??"")}),K(ke,he)});var Q=F(B,2),te=F(x(Q));te.__change=function(...ke){Yr.uploadNewFile?.apply(this,ke)};var me=F(X,2),Te=F(x(me),2),ce=x(Te);be(()=>{et(),pr(()=>{})});var _e=x(ce);_e.value=_e.__value="";var pe=F(_e);Et(pe,1,()=>et().imageResources,Ft,(ke,Ee)=>{var he=wv(),ze=x(he),Ce={};be(()=>{Ae(ze,E(Ee).name),Ce!==(Ce=E(Ee).name)&&(he.value=(he.__value=E(Ee).name)??"")}),K(ke,he)});var ct=F(pe);Et(ct,1,()=>et().riveResources,Ft,(ke,Ee)=>{var he=bv(),ze=x(he),Ce={};be(()=>{Ae(ze,`${E(Ee).name??""} (Rive)`),Ce!==(Ce=E(Ee).name)&&(he.value=(he.__value=E(Ee).name)??"")}),K(ke,he)});var Ge=F(G,2),qe=x(Ge),rt=F(x(qe),2);rt.__click=()=>n(et().currentDialogue);var lt=F(qe,2);Et(lt,1,()=>et().currentDialogue.options||[],Ft,(ke,Ee,he)=>{var ze=Ev();let Ce;var dt=x(ze),st=x(dt);st.__click=()=>s(he),st.__keydown=o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s(he))},xe(st,"aria-controls",`option-content-${he}`);var at=x(st),ut=x(at);{var Dt=o=>{var d=Zi("👁️‍🗨️");K(o,d)},vt=o=>{var d=Jt(),w=xt(d);{var C=T=>{var L=Zi("🔒");K(T,L)},S=T=>{var L=Zi("✅");K(T,L)};je(w,T=>{E(Ee).enabled?T(S,!1):T(C)},!0)}K(o,d)};je(ut,o=>{E(Ee).visible?o(vt,!1):o(Dt)})}var qt=F(at,2),Zt=x(qt),nr=F(st,2);nr.__click=()=>l(et().currentDialogue,he);var Ct=F(dt,2);{var g=o=>{var d=kv();xe(d,"id",`option-content-${he}`);var w=x(d);gv(w,{get option(){return E(Ee)},index:he,get dialogues(){return mt().data.dialogues},get availableItems(){return et().availableItems},get conditionTypes(){return t}}),K(o,d)};je(Ct,o=>{mt().editingOptionIndex===he&&o(g)})}be(o=>{Ce=or(ze,1,"option-card svelte-1de8com",null,Ce,o),xe(st,"aria-expanded",mt().editingOptionIndex===he),Ae(Zt,`#${he+1} ${E(Ee).text??""}`)},[()=>({editing:mt().editingOptionIndex===he})]),K(ke,ze)});var Re=F(Ge,2),ae=F(x(Re),2);be(()=>{et(),pr(()=>{mt()})});var Me=x(ae);Me.value=Me.__value="";var ye=F(Me);Et(ye,1,()=>mt().data.dialogues,Ft,(ke,Ee)=>{var he=Sv(),ze=x(he),Ce={};be(dt=>{Ae(ze,`${E(Ee).id??""}: ${dt??""}...`),Ce!==(Ce=E(Ee).id)&&(he.value=(he.__value=E(Ee).id)??"")},[()=>E(Ee).text.substring(0,30)]),K(ke,he)});var De=F(Re,2),Pe=x(De);Pe.__click=()=>vn.deleteDialogue(et().currentDialogue.id),Dr(p,()=>et().currentDialogue.id,ke=>et(et().currentDialogue.id=ke)),Ar(U,()=>et().currentDialogue.chapterId,ke=>et(et().currentDialogue.chapterId=ke)),Dr(N,()=>et().currentDialogue.text,ke=>et(et().currentDialogue.text=ke)),Ar(B,()=>et().currentDialogue.backgroundImage,ke=>et(et().currentDialogue.backgroundImage=ke)),Ar(ce,()=>et().currentDialogue.characterImage,ke=>et(et().currentDialogue.characterImage=ke)),Ar(ae,()=>et().currentDialogue.nextDialogueId,ke=>et(et().currentDialogue.nextDialogueId=ke)),K(_,b)},m=_=>{var b=Av();K(_,b)};je(h,_=>{et().currentDialogue?_(f):_(m,!1)})}K(r,u),Vt()}Qt(["change","click","keydown"]);var Le=Qr(()=>O),Tv=ne('<img class="icon-preview svelte-asgatj"/>'),Pv=ne('<div class="icon-placeholder svelte-asgatj">📦</div>'),xv=ne("<option> </option>"),jv=ne('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Rv=ne("<option> </option>"),Ov=ne('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Mv=ne('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),Lv=ne('<div class="items-list svelte-asgatj"></div>'),Dv=ne('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),$v=ne('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),Fv=ne('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function Uv(r,e){Wt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!Le().data)return;Le().data.items||Le(Le().data.items=[]);const M={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Le().data.items.push(M),Le(Le().editingItemIndex=Le().data.items.length-1)}function s(M){Le().editingItemIndex===M?Le(Le().editingItemIndex=null):Le(Le().editingItemIndex=M)}function l(M){confirm("Удалить предмет?")&&Le().data?.items&&(Le().data.items.splice(M,1),Le(Le().editingItemIndex=null))}function u(M){if(!Le().data?.items)return;const W=Le().data.items[M],q={...W,id:`${W.id}_copy_${Date.now()}`,name:`${W.name} (копия)`};Le().data.items.splice(M+1,0,q),Le(Le().editingItemIndex=M+1)}function h(M){return t.find(W=>W.value===M)?.label||M}Xr();var f=Fv(),m=x(f);m.__click=()=>Le(Le().showItems=!Le().showItems);var _=x(m),b=F(x(_)),I=F(_,2),p=x(I),A=F(m,2);{var U=M=>{var W=$v(),q=x(W);{var N=$=>{var B=Lv();Et(B,7,()=>Le().data.items,oe=>oe.id,(oe,ee,ge)=>{var Q=Mv();let te;var me=x(Q);me.__click=()=>s(E(ge));var Te=x(me),ce=x(Te),_e=x(ce);{var pe=at=>{var ut=Tv();be(()=>{xe(ut,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Le().selectedBucket}/${E(ee).icon}`),xe(ut,"alt",E(ee).name)}),K(at,ut)},ct=at=>{var ut=Pv();K(at,ut)};je(_e,at=>{E(ee).icon?at(pe):at(ct,!1)})}var Ge=F(ce,2),qe=x(Ge),rt=x(qe),lt=F(qe,2),Re=x(lt),ae=x(Re),Me=F(Re,2);let ye;var De=x(Me),Pe=F(Te,2),ke=x(Pe),Ee=F(me,2),he=x(Ee);he.__click=()=>u(E(ge));var ze=F(he,2);ze.__click=()=>s(E(ge));var Ce=F(ze,2);Ce.__click=()=>l(E(ge));var dt=F(Ee,2);{var st=at=>{var ut=Ov(),Dt=x(ut),vt=x(Dt),qt=x(vt),Zt=F(qt,2),nr=F(vt,2),Ct=x(nr),g=F(Ct,2),o=F(nr,2),d=x(o),w=F(d,2),C=F(o,2),S=x(C),T=F(S,2),L=x(T),z=F(L,2);z.__change=$e=>(E(ee).icon=$e.target.value,pr(()=>Le()));var H=x(z);H.value=H.__value="";var se=F(H);Et(se,1,()=>Le().storedFiles.filter($e=>$e.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Ft,($e,gt)=>{var ht=xv(),Ut=x(ht),Ie={};be(()=>{Ae(Ut,E(gt).name),Ie!==(Ie=E(gt).name)&&(ht.value=(ht.__value=E(gt).name)??"")}),K($e,ht)});var de=F(z,2),we=F(x(de));we.__change=function(...$e){Yr.uploadNewFile?.apply(this,$e)};var Se=F(T,2);{var pt=$e=>{var gt=jv(),ht=x(gt),Ut=F(ht,2),Ie=x(Ut);be(()=>{xe(ht,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Le().selectedBucket}/${E(ee).icon}`),Ae(Ie,E(ee).icon)}),K($e,gt)};je(Se,$e=>{E(ee).icon&&$e(pt)})}var St=F(C,2),We=x(St),yt=F(We,2);be(()=>{E(ee),pr(()=>{E(ge)})}),Et(yt,5,()=>t,Ft,($e,gt)=>{var ht=Rv(),Ut=x(ht),Ie={};be(()=>{Ae(Ut,E(gt).label),Ie!==(Ie=E(gt).value)&&(ht.value=(ht.__value=E(gt).value)??"")}),K($e,ht)}),be(()=>{xe(qt,"for",`item-id-${E(ge)??""}`),xe(Zt,"id",`item-id-${E(ge)??""}`),xe(Ct,"for",`item-name-${E(ge)??""}`),xe(g,"id",`item-name-${E(ge)??""}`),xe(d,"for",`item-desc-${E(ge)??""}`),xe(w,"id",`item-desc-${E(ge)??""}`),xe(S,"for",`item-icon-${E(ge)??""}`),xe(L,"id",`item-icon-${E(ge)??""}`),xe(We,"for",`item-type-${E(ge)??""}`),xe(yt,"id",`item-type-${E(ge)??""}`)}),Dr(Zt,()=>E(ee).id,$e=>(E(ee).id=$e,pr(()=>Le()))),Dr(g,()=>E(ee).name,$e=>(E(ee).name=$e,pr(()=>Le()))),Dr(w,()=>E(ee).description,$e=>(E(ee).description=$e,pr(()=>Le()))),Dr(L,()=>E(ee).icon,$e=>(E(ee).icon=$e,pr(()=>Le()))),Ar(yt,()=>E(ee).type,$e=>(E(ee).type=$e,pr(()=>Le()))),K(at,ut)};je(dt,at=>{Le().editingItemIndex===E(ge)&&at(st)})}be((at,ut,Dt)=>{te=or(Q,1,"item-row svelte-asgatj",null,te,at),xe(me,"aria-label",`Редактировать предмет ${E(ee).name??""}`),Ae(rt,E(ee).name),Ae(ae,E(ee).id),ye=or(Me,1,"item-type-badge svelte-asgatj",null,ye,ut),Ae(De,Dt),Ae(ke,`${E(ee).description??""} || `)},[()=>({editing:Le().editingItemIndex===E(ge)}),()=>({tool:E(ee).type==="tool",key:E(ee).type==="key",consumable:E(ee).type==="consumable",quest:E(ee).type==="quest",misc:E(ee).type==="misc"}),()=>h(E(ee).type)]),K(oe,Q)}),K($,B)},G=$=>{var B=Dv();K($,B)};je(q,$=>{Le().data?.items?.length?$(N):$(G,!1)})}var X=F(q,2);X.__click=n,K(M,W)};je(A,M=>{Le().showItems&&M(U)})}be(()=>{xe(m,"title",Le().showItems?"Скрыть предметы":"Показать предметы"),xe(m,"aria-expanded",Le().showItems),Ae(b,` Предметы (${(Le().data?.items?.length||0)??""})`),Ae(p,Le().showItems?"▼":"▶")}),K(r,f),Vt()}Qt(["click","change"]);Qt(["click"]);class Nv{#i=ft(Gt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return E(this.#i)}set player(e){Oe(this.#i,e,!0)}#r=ft(null);get storyData(){return E(this.#r)}set storyData(e){Oe(this.#r,e,!0)}#e=ft("0");get currentDialogueId(){return E(this.#e)}set currentDialogueId(e){Oe(this.#e,e,!0)}#s=ft(!0);get isLoading(){return E(this.#s)}set isLoading(e){Oe(this.#s,e,!0)}#a=ft("");get error(){return E(this.#a)}set error(e){Oe(this.#a,e,!0)}#t=ft(null);get selectedStory(){return E(this.#t)}set selectedStory(e){Oe(this.#t,e,!0)}#n=ft(Gt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return E(this.#n)}set availableStories(e){Oe(this.#n,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){return e.visibleIf&&e.visibleIf.hasItem?this.hasItem(e.visibleIf.hasItem):!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const kt=new Nv;var ls={exports:{}},Bv=ls.exports,Il;function Wv(){return Il||(Il=1,(function(r,e){(function(n,s){r.exports=s()})(Bv,()=>(()=>{var t=[,((u,h,f)=>{f.r(h),f.d(h,{default:()=>_});var m=(()=>{var b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(I={}){var p=I,A,U;p.ready=new Promise((i,a)=>{A=i,U=a});function M(){function i(P){const D=v;c=a=0,v=new Map,D.forEach(V=>{try{V(P)}catch(R){console.error(R)}}),this.pb(),y&&y.Tb()}let a=0,c=0,v=new Map,y=null,k=null;this.requestAnimationFrame=function(P){a||(a=requestAnimationFrame(i.bind(this)));const D=++c;return v.set(D,P),D},this.cancelAnimationFrame=function(P){v.delete(P),a&&v.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(P){k&&(document.body.remove(k),k=null),P||(k=document.createElement("div"),k.style.backgroundColor="black",k.style.position="fixed",k.style.right=0,k.style.top=0,k.style.color="white",k.style.padding="4px",k.innerHTML="RIVE FPS",P=function(D){k.innerHTML="RIVE FPS "+D.toFixed(1)},document.body.appendChild(k)),y=new function(){let D=0,V=0;this.Tb=function(){var R=performance.now();V?(++D,R-=V,1e3<R&&(P(1e3*D/R),D=V=0)):(V=R,D=0)}}},this.Ob=function(){k&&(document.body.remove(k),k=null),y=null},this.pb=function(){}}function W(i){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(v){return v=v+((1<<i)-1)>>i,a.has(v)&&clearTimeout(a.get(v)),a.set(v,setTimeout(function(){a.delete(v),a.length==0?c=-1/0:v==c&&(c=Math.max(...a.keys()),console.assert(c<v))},1e3)),c=Math.max(v,c),c<<i}}const q=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){q&&q();let i=p.decodeAudio;p.decodeAudio=function(y,k){y=i(y),k(y)};let a=p.decodeFont;p.decodeFont=function(y,k){y=a(y),k(y)};const c=p.FileAssetLoader;p.ptrToAsset=y=>{let k=p.ptrToFileAsset(y);return k.isImage?p.ptrToImageAsset(y):k.isFont?p.ptrToFontAsset(y):k.isAudio?p.ptrToAudioAsset(y):k},p.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:y}){this.__parent.__construct.call(this),this.Gb=y},loadContents:function(y,k){return y=p.ptrToAsset(y),this.Gb(y,k)}}),p.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(y){let k=p.ptrToAsset(y);return y=k.cdnUuid,y===""?!1:((function(P,D){var V=new XMLHttpRequest;V.responseType="arraybuffer",V.onreadystatechange=function(){V.readyState==4&&V.status==200&&D(V)},V.open("GET",P,!0),V.send(null)})(k.cdnBaseUrl+"/"+y,P=>{k.decode(new Uint8Array(P.response))}),!0)}}),p.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(y){this.lb.push(y)},loadContents:function(y,k){for(let P of this.lb)if(P.loadContents(y,k))return!0;return!1}});let v=p.computeAlignment;p.computeAlignment=function(y,k,P,D,V=1){return v.call(this,y,k,P,D,V)}};const N="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),G=new function(){function i(){if(!a){let Ne=function(Ve,le,wt){if(le=J.createShader(le),J.shaderSource(le,wt),J.compileShader(le),wt=J.getShaderInfoLog(le),0<(wt||"").length)throw wt;J.attachShader(Ve,le)};var j=document.createElement("canvas"),Z={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let J;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(J=j.getContext("webgl",Z),c=1,!J)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(J=j.getContext("webgl2",Z))c=2;else if(J=j.getContext("webgl",Z))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(J=new Proxy(J,{get(Ve,le){if(Ve.isContextLost()){if(V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",le),V=!0),typeof Ve[le]=="function")return function(){}}else return typeof Ve[le]=="function"?function(...wt){return Ve[le].apply(Ve,wt)}:Ve[le]},set(Ve,le,wt){if(Ve.isContextLost())V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+le),V=!0);else return Ve[le]=wt,!0}}),v=Math.min(J.getParameter(J.MAX_RENDERBUFFER_SIZE),J.getParameter(J.MAX_TEXTURE_SIZE)),j=J.createProgram(),Ne(j,J.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ne(j,J.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),J.bindAttribLocation(j,0,"vertex"),J.bindAttribLocation(j,1,"uv"),J.linkProgram(j),Z=J.getProgramInfoLog(j),0<(Z||"").trim().length)throw Z;y=J.getUniformLocation(j,"mat"),k=J.getUniformLocation(j,"translate"),J.useProgram(j),J.bindBuffer(J.ARRAY_BUFFER,J.createBuffer()),J.enableVertexAttribArray(0),J.enableVertexAttribArray(1),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,J.createBuffer()),J.uniform1i(J.getUniformLocation(j,"image"),0),J.pixelStorei(J.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=J}return!0}let a=null,c=0,v=0,y=null,k=null,P=0,D=0,V=!1;i(),this.hc=function(){return i(),v},this.Mb=function(j){a.deleteTexture&&a.deleteTexture(j)},this.Lb=function(j){if(!i())return null;const Z=a.createTexture();return Z?(a.bindTexture(a.TEXTURE_2D,Z),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,j),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),Z):null};const R=new W(8),re=new W(8),ie=new W(10),fe=new W(10);this.Qb=function(j,Z,J,Ne,Ve){if(i()){var le=R.push(j),wt=re.push(Z);if(a.canvas){(a.canvas.width!=le||a.canvas.height!=wt)&&(a.canvas.width=le,a.canvas.height=wt),a.viewport(0,wt-Z,j,Z),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),J.sort((Je,br)=>br.xb-Je.xb),le=ie.push(Ne),P!=le&&(a.bufferData(a.ARRAY_BUFFER,8*le,a.DYNAMIC_DRAW),P=le),le=0;for(var $t of J)a.bufferSubData(a.ARRAY_BUFFER,le,$t.Ua),le+=4*$t.Ua.length;console.assert(le==4*Ne);for(var wr of J)a.bufferSubData(a.ARRAY_BUFFER,le,wr.Db),le+=4*wr.Db.length;console.assert(le==8*Ne),le=fe.push(Ve),D!=le&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*le,a.DYNAMIC_DRAW),D=le),$t=0;for(var nn of J)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,$t,nn.indices),$t+=2*nn.indices.length;console.assert($t==2*Ve),nn=0,wr=!0,le=$t=0;for(const Je of J){Je.image.Ka!=nn&&(a.bindTexture(a.TEXTURE_2D,Je.image.Ja||null),nn=Je.image.Ka),Je.mc?(a.scissor(Je.Za,wt-Je.$a-Je.kb,Je.Ac,Je.kb),wr=!0):wr&&(a.scissor(0,wt-Z,j,Z),wr=!1),J=2/j;const br=-2/Z;a.uniform4f(y,Je.ha[0]*J*Je.Ba,Je.ha[1]*br*Je.Ca,Je.ha[2]*J*Je.Ba,Je.ha[3]*br*Je.Ca),a.uniform2f(k,Je.ha[4]*J*Je.Ba+J*(Je.Za-Je.ic*Je.Ba)-1,Je.ha[5]*br*Je.Ca+br*(Je.$a-Je.jc*Je.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,le),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,le+4*Ne),a.drawElements(a.TRIANGLES,Je.indices.length,a.UNSIGNED_SHORT,$t),le+=4*Je.Ua.length,$t+=2*Je.indices.length}console.assert(le==4*Ne),console.assert($t==2*Ve)}}},this.canvas=function(){return i()&&a.canvas}},X=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function i(Y){switch(Y){case R.srcOver:return"source-over";case R.screen:return"screen";case R.overlay:return"overlay";case R.darken:return"darken";case R.lighten:return"lighten";case R.colorDodge:return"color-dodge";case R.colorBurn:return"color-burn";case R.hardLight:return"hard-light";case R.softLight:return"soft-light";case R.difference:return"difference";case R.exclusion:return"exclusion";case R.multiply:return"multiply";case R.hue:return"hue";case R.saturation:return"saturation";case R.color:return"color";case R.luminosity:return"luminosity"}}function a(Y){return"rgba("+((16711680&Y)>>>16)+","+((65280&Y)>>>8)+","+((255&Y)>>>0)+","+((4278190080&Y)>>>24)/255+")"}function c(){0<wt.length&&(G.Qb(le.drawWidth(),le.drawHeight(),wt,$t,wr),wt=[],wr=$t=0,le.reset(512,512));for(const Y of Ve){for(const ue of Y.H)ue();Y.H=[]}Ve.clear()}X&&X();var v=p.RenderPaintStyle;const y=p.RenderPath,k=p.RenderPaint,P=p.Renderer,D=p.StrokeCap,V=p.StrokeJoin,R=p.BlendMode,re=v.fill,ie=v.stroke,fe=p.FillRule.evenOdd;let j=1;var Z=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:Y,xa:ue}={}){this.__parent.__construct.call(this),this.Ka=j,j=j+1&2147483647||1,this.la=Y,this.xa=ue},__destruct:function(){this.Ja&&(G.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(Y){var ue=this;ue.xa&&ue.xa(ue);var Ke=new Image;ue.Xa=URL.createObjectURL(new Blob([Y],{type:"image/png"})),Ke.onload=function(){ue.Fb=Ke,ue.Ja=G.Lb(Ke),ue.size(Ke.width,Ke.height),ue.la&&ue.la(ue)},Ke.src=ue.Xa}}),J=y.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(Y,ue,Ke,Xe,Be,Ye,nt){var ot=this.T,fr=ot.addPath;Y=Y.T;const jt=new DOMMatrix;jt.a=ue,jt.b=Ke,jt.c=Xe,jt.d=Be,jt.e=Ye,jt.f=nt,fr.call(ot,Y,jt)},fillRule:function(Y){this.Wa=Y},moveTo:function(Y,ue){this.T.moveTo(Y,ue)},lineTo:function(Y,ue){this.T.lineTo(Y,ue)},cubicTo:function(Y,ue,Ke,Xe,Be,Ye){this.T.bezierCurveTo(Y,ue,Ke,Xe,Be,Ye)},close:function(){this.T.closePath()}}),Ne=k.extend("CanvasRenderPaint",{color:function(Y){this.Ya=a(Y)},thickness:function(Y){this.Ib=Y},join:function(Y){switch(Y){case V.miter:this.Ia="miter";break;case V.round:this.Ia="round";break;case V.bevel:this.Ia="bevel"}},cap:function(Y){switch(Y){case D.butt:this.Ha="butt";break;case D.round:this.Ha="round";break;case D.square:this.Ha="square"}},style:function(Y){this.Hb=Y},blendMode:function(Y){this.Eb=i(Y)},clearGradient:function(){this.ja=null},linearGradient:function(Y,ue,Ke,Xe){this.ja={zb:Y,Ab:ue,cb:Ke,eb:Xe,Ra:[]}},radialGradient:function(Y,ue,Ke,Xe){this.ja={zb:Y,Ab:ue,cb:Ke,eb:Xe,Ra:[],ec:!0}},addStop:function(Y,ue){this.ja.Ra.push({color:Y,stop:ue})},completeGradient:function(){},draw:function(Y,ue,Ke){let Xe=this.Hb;var Be=this.Ya,Ye=this.ja;if(Y.globalCompositeOperation=this.Eb,Ye!=null){Be=Ye.zb;var nt=Ye.Ab;const fr=Ye.cb;var ot=Ye.eb;const jt=Ye.Ra;Ye.ec?(Ye=fr-Be,ot-=nt,Be=Y.createRadialGradient(Be,nt,0,Be,nt,Math.sqrt(Ye*Ye+ot*ot))):Be=Y.createLinearGradient(Be,nt,fr,ot);for(let sr=0,Rt=jt.length;sr<Rt;sr++)nt=jt[sr],Be.addColorStop(nt.stop,a(nt.color));this.Ya=Be,this.ja=null}switch(Xe){case ie:Y.strokeStyle=Be,Y.lineWidth=this.Ib,Y.lineCap=this.Ha,Y.lineJoin=this.Ia,Y.stroke(ue);break;case re:Y.fillStyle=Be,Y.fill(ue,Ke)}}});const Ve=new Set;let le=null,wt=[],$t=0,wr=0;var nn=p.CanvasRenderer=P.extend("Renderer",{__construct:function(Y){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=Y.getContext("2d"),this.Va=Y,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const Y=this.S.length-6;if(6>Y)throw"restore() called without matching save().";this.S.splice(Y),this.H.push(this.C.restore.bind(this.C))},transform:function(Y,ue,Ke,Xe,Be,Ye){const nt=this.S,ot=nt.length-6;nt.splice(ot,6,nt[ot]*Y+nt[ot+2]*ue,nt[ot+1]*Y+nt[ot+3]*ue,nt[ot]*Ke+nt[ot+2]*Xe,nt[ot+1]*Ke+nt[ot+3]*Xe,nt[ot]*Be+nt[ot+2]*Ye+nt[ot+4],nt[ot+1]*Be+nt[ot+3]*Ye+nt[ot+5]),this.H.push(this.C.transform.bind(this.C,Y,ue,Ke,Xe,Be,Ye))},rotate:function(Y){const ue=Math.sin(Y);Y=Math.cos(Y),this.transform(Y,ue,-ue,Y,0,0)},_drawPath:function(Y,ue){this.H.push(ue.draw.bind(ue,this.C,Y.T,Y.Wa===fe?"evenodd":"nonzero"))},_drawRiveImage:function(Y,ue,Ke,Xe){var Be=Y.Fb;if(Be){var Ye=this.C,nt=i(Ke);this.H.push(function(){Ye.globalCompositeOperation=nt,Ye.globalAlpha=Xe,Ye.drawImage(Be,0,0),Ye.globalAlpha=1})}},_getMatrix:function(Y){const ue=this.S,Ke=ue.length-6;for(let Xe=0;6>Xe;++Xe)Y[Xe]=ue[Ke+Xe]},_drawImageMesh:function(Y,ue,Ke,Xe,Be,Ye,nt,ot,fr,jt,sr){ue=this.C.canvas.width;var Rt=this.C.canvas.height;const Oo=jt-ot,Mo=sr-fr;ot=Math.max(ot,0),fr=Math.max(fr,0),jt=Math.min(jt,ue),sr=Math.min(sr,Rt);const vi=jt-ot,pi=sr-fr;if(console.assert(vi<=Math.min(Oo,ue)),console.assert(pi<=Math.min(Mo,Rt)),!(0>=vi||0>=pi)){jt=vi<Oo||pi<Mo,ue=sr=1;var sn=Math.ceil(vi*sr),an=Math.ceil(pi*ue);Rt=G.hc(),sn>Rt&&(sr*=Rt/sn,sn=Rt),an>Rt&&(ue*=Rt/an,an=Rt),le||(le=new p.DynamicRectanizer(Rt),le.reset(512,512)),Rt=le.addRect(sn,an),0>Rt&&(c(),Ve.add(this),Rt=le.addRect(sn,an),console.assert(0<=Rt));var Lo=Rt&65535,Do=Rt>>16;wt.push({ha:this.S.slice(this.S.length-6),image:Y,Za:Lo,$a:Do,ic:ot,jc:fr,Ac:sn,kb:an,Ba:sr,Ca:ue,Ua:new Float32Array(Be),Db:new Float32Array(Ye),indices:new Uint16Array(nt),mc:jt,xb:Y.Ka<<1|(jt?1:0)}),$t+=Be.length,wr+=nt.length;var Cn=this.C,ac=i(Ke);this.H.push(function(){Cn.save(),Cn.resetTransform(),Cn.globalCompositeOperation=ac,Cn.globalAlpha=Xe;const $o=G.canvas();$o&&Cn.drawImage($o,Lo,Do,sn,an,ot,fr,vi,pi),Cn.restore()})}},_clipPath:function(Y){this.H.push(this.C.clip.bind(this.C,Y.T,Y.Wa===fe?"evenodd":"nonzero"))},clear:function(){Ve.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(Y,ue){this.transform(1,0,0,1,Y,ue)}});p.makeRenderer=function(Y){const ue=new nn(Y),Ke=ue.C;return new Proxy(ue,{get(Xe,Be){if(typeof Xe[Be]=="function")return function(...Ye){return Xe[Be].apply(Xe,Ye)};if(typeof Ke[Be]=="function"){if(-1<N.indexOf(Be))throw Error("RiveException: Method call to '"+Be+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ye){ue.H.push(Ke[Be].bind(Ke,...Ye))}}return Xe[Be]},set(Xe,Be,Ye){if(Be in Ke)return ue.H.push(()=>{Ke[Be]=Ye}),!0}})},p.decodeImage=function(Y,ue){new Z({la:ue}).decode(Y)},p.renderFactory={makeRenderPaint:function(){return new Ne},makeRenderPath:function(){return new J},makeRenderImage:function(){let Y=br;return new Z({xa:()=>{Y.total++},la:()=>{if(Y.loaded++,Y.loaded===Y.total){const ue=Y.ready;ue&&(ue(),Y.ready=null)}}})}};let Je=p.load,br=null;p.load=function(Y,ue,Ke=!0){const Xe=new p.FallbackFileAssetLoader;return ue!==void 0&&Xe.addLoader(ue),Ke&&(ue=new p.CDNFileAssetLoader,Xe.addLoader(ue)),new Promise(function(Be){let Ye=null;br={total:0,loaded:0,ready:function(){Be(Ye)}},Ye=Je(Y,Xe),br.total==0&&Be(Ye)})};let sc=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(Y,ue,Ke,Xe,Be=1){sc.call(this,Y,ue,Ke,Xe,Be)},v=new M,p.requestAnimationFrame=v.requestAnimationFrame.bind(v),p.cancelAnimationFrame=v.cancelAnimationFrame.bind(v),p.enableFPSCounter=v.Rb.bind(v),p.disableFPSCounter=v.Ob,v.pb=c,p.resolveAnimationFrame=c,p.cleanup=function(){le&&le.delete()}};var $=Object.assign({},p),B="./this.program",oe=typeof window=="object",ee=typeof importScripts=="function",ge="",Q,te;(oe||ee)&&(ee?ge=self.location.href:typeof document<"u"&&document.currentScript&&(ge=document.currentScript.src),b&&(ge=b),ge.indexOf("blob:")!==0?ge=ge.substr(0,ge.replace(/[?#].*/,"").lastIndexOf("/")+1):ge="",ee&&(te=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),Q=(i,a,c)=>{var v=new XMLHttpRequest;v.open("GET",i,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var me=p.print||console.log.bind(console),Te=p.printErr||console.error.bind(console);Object.assign(p,$),$=null,p.thisProgram&&(B=p.thisProgram);var ce;p.wasmBinary&&(ce=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&st("no native wasm support detected");var _e,pe,ct=!1,Ge,qe,rt,lt,Re,ae,Me,ye;function De(){var i=_e.buffer;p.HEAP8=Ge=new Int8Array(i),p.HEAP16=rt=new Int16Array(i),p.HEAP32=Re=new Int32Array(i),p.HEAPU8=qe=new Uint8Array(i),p.HEAPU16=lt=new Uint16Array(i),p.HEAPU32=ae=new Uint32Array(i),p.HEAPF32=Me=new Float32Array(i),p.HEAPF64=ye=new Float64Array(i)}var Pe,ke=[],Ee=[],he=[];function ze(){var i=p.preRun.shift();ke.unshift(i)}var Ce=0,dt=null;function st(i){throw p.onAbort&&p.onAbort(i),i="Aborted("+i+")",Te(i),ct=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),U(i),i}function at(i){return i.startsWith("data:application/octet-stream;base64,")}var ut;if(ut="canvas_advanced.wasm",!at(ut)){var Dt=ut;ut=p.locateFile?p.locateFile(Dt,ge):ge+Dt}function vt(i){if(i==ut&&ce)return new Uint8Array(ce);if(te)return te(i);throw"both async and sync fetching of the wasm failed"}function qt(i){if(!ce&&(oe||ee)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>vt(i));if(Q)return new Promise((a,c)=>{Q(i,v=>a(new Uint8Array(v)),c)})}return Promise.resolve().then(()=>vt(i))}function Zt(i,a,c){return qt(i).then(v=>WebAssembly.instantiate(v,a)).then(v=>v).then(c,v=>{Te("failed to asynchronously prepare wasm: "+v),st(v)})}function nr(i,a){var c=ut;return ce||typeof WebAssembly.instantiateStreaming!="function"||at(c)||c.startsWith("file://")||typeof fetch!="function"?Zt(c,i,a):fetch(c,{credentials:"same-origin"}).then(v=>WebAssembly.instantiateStreaming(v,i).then(a,function(y){return Te("wasm streaming compile failed: "+y),Te("falling back to ArrayBuffer instantiation"),Zt(c,i,a)}))}var Ct,g,o={460492:(i,a,c,v,y)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=v,window.h.ga.yb=y;let k=window.h;k.D=[],k.yc=function(P){for(var D=0;D<k.D.length;++D)if(k.D[D]==null)return k.D[D]=P,D;return k.D.push(P),k.D.length-1},k.Cb=function(P){for(k.D[P]=null;0<k.D.length&&k.D[k.D.length-1]==null;)k.D.pop()},k.Sc=function(P){for(var D=0;D<k.D.length;++D)if(k.D[D]==P)return k.Cb(D)},k.ra=function(P){return k.D[P]},k.Ta=["touchend","click"],k.unlock=function(){for(var P=0;P<k.D.length;++P){var D=k.D[P];D!=null&&D.J!=null&&D.state===k.ga.yb&&D.J.resume().then(()=>{To(D.qb)},V=>{console.error("Failed to resume audiocontext",V)})}k.Ta.map(function(V){document.removeEventListener(V,k.unlock,!0)})},k.Ta.map(function(P){document.addEventListener(P,k.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,c,v,y,k)=>{if(typeof window.h>"u")return-1;var P={},D={};return i==window.h.I.ya&&c!=0&&(D.sampleRate=c),P.J=new(window.AudioContext||window.webkitAudioContext)(D),P.J.suspend(),P.state=window.h.ga.stopped,c=0,i!=window.h.I.ya&&(c=a),P.Z=P.J.createScriptProcessor(v,c,a),P.Z.onaudioprocess=function(V){if((P.sa==null||P.sa.length==0)&&(P.sa=new Float32Array(Me.buffer,y,v*a)),i==window.h.I.capture||i==window.h.I.La){for(var R=0;R<a;R+=1)for(var re=V.inputBuffer.getChannelData(R),ie=P.sa,fe=0;fe<v;fe+=1)ie[fe*a+R]=re[fe];Po(k,v,y)}if(i==window.h.I.ya||i==window.h.I.La)for(xo(k,v,y),R=0;R<V.outputBuffer.numberOfChannels;++R)for(re=V.outputBuffer.getChannelData(R),ie=P.sa,fe=0;fe<v;fe+=1)re[fe]=ie[fe*a+R];else for(R=0;R<V.outputBuffer.numberOfChannels;++R)V.outputBuffer.getChannelData(R).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(V){P.Da=P.J.createMediaStreamSource(V),P.Da.connect(P.Z),P.Z.connect(P.J.destination)}).catch(function(V){console.log("Failed to get user media: "+V)}),i==window.h.I.ya&&P.Z.connect(P.J.destination),P.qb=k,window.h.yc(P)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(p)},w=(i,a)=>{for(var c=0,v=i.length-1;0<=v;v--){var y=i[v];y==="."?i.splice(v,1):y===".."?(i.splice(v,1),c++):c&&(i.splice(v,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},C=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=w(i.split("/").filter(v=>!!v),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},S=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},T=i=>{if(i==="/")return"/";i=C(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},L=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);st("initRandomDevice")},z=i=>(z=L())(i);function H(){for(var i="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=w(i.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+i||"."}var se=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,de=(i,a,c)=>{var v=a+c;for(c=a;i[c]&&!(c>=v);)++c;if(16<c-a&&i.buffer&&se)return se.decode(i.subarray(a,c));for(v="";a<c;){var y=i[a++];if(y&128){var k=i[a++]&63;if((y&224)==192)v+=String.fromCharCode((y&31)<<6|k);else{var P=i[a++]&63;y=(y&240)==224?(y&15)<<12|k<<6|P:(y&7)<<18|k<<12|P<<6|i[a++]&63,65536>y?v+=String.fromCharCode(y):(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else v+=String.fromCharCode(y)}return v},we=[],Se=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);127>=v?a++:2047>=v?a+=2:55296<=v&&57343>=v?(a+=4,++c):a+=3}return a},pt=(i,a,c,v)=>{if(!(0<v))return 0;var y=c;v=c+v-1;for(var k=0;k<i.length;++k){var P=i.charCodeAt(k);if(55296<=P&&57343>=P){var D=i.charCodeAt(++k);P=65536+((P&1023)<<10)|D&1023}if(127>=P){if(c>=v)break;a[c++]=P}else{if(2047>=P){if(c+1>=v)break;a[c++]=192|P>>6}else{if(65535>=P){if(c+2>=v)break;a[c++]=224|P>>12}else{if(c+3>=v)break;a[c++]=240|P>>18,a[c++]=128|P>>12&63}a[c++]=128|P>>6&63}a[c++]=128|P&63}}return a[c]=0,c-y};function St(i,a){var c=Array(Se(i)+1);return i=pt(i,c,0,c.length),a&&(c.length=i),c}var We=[];function yt(i,a){We[i]={input:[],F:[],V:a},Ts(i,$e)}var $e={open:function(i){var a=We[i.node.za];if(!a)throw new ve(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,c,v){if(!i.s||!i.s.V.jb)throw new ve(60);for(var y=0,k=0;k<v;k++){try{var P=i.s.V.jb(i.s)}catch{throw new ve(29)}if(P===void 0&&y===0)throw new ve(6);if(P==null)break;y++,a[c+k]=P}return y&&(i.node.timestamp=Date.now()),y},write:function(i,a,c,v){if(!i.s||!i.s.V.Oa)throw new ve(60);try{for(var y=0;y<v;y++)i.s.V.Oa(i.s,a[c+y])}catch{throw new ve(29)}return v&&(i.node.timestamp=Date.now()),y}},gt={jb:function(){e:{if(!we.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}we=St(i,!0)}i=we.shift()}return i},Oa:function(i,a){a===null||a===10?(me(de(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(me(de(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},ht={Oa:function(i,a){a===null||a===10?(Te(de(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Te(de(i.F,0)),i.F=[])}};function Ut(i,a){var c=i.j?i.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(c.subarray(0,i.v),0))}var Ie={O:null,U(){return Ie.createNode(null,"/",16895,0)},createNode(i,a,c,v){if((c&61440)===24576||(c&61440)===4096)throw new ve(63);return Ie.O||(Ie.O={dir:{node:{Y:Ie.l.Y,P:Ie.l.P,ka:Ie.l.ka,va:Ie.l.va,vb:Ie.l.vb,Bb:Ie.l.Bb,wb:Ie.l.wb,tb:Ie.l.tb,Ea:Ie.l.Ea},stream:{ba:Ie.m.ba}},file:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:{ba:Ie.m.ba,read:Ie.m.read,write:Ie.m.write,pa:Ie.m.pa,mb:Ie.m.mb,ob:Ie.m.ob}},link:{node:{Y:Ie.l.Y,P:Ie.l.P,ma:Ie.l.ma},stream:{}},ab:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:$u}}),c=Ja(i,a,c,v),(c.mode&61440)===16384?(c.l=Ie.O.dir.node,c.m=Ie.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Ie.O.file.node,c.m=Ie.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Ie.O.link.node,c.m=Ie.O.link.stream):(c.mode&61440)===8192&&(c.l=Ie.O.ab.node,c.m=Ie.O.ab.stream),c.timestamp=Date.now(),i&&(i.j[a]=c,i.timestamp=c.timestamp),c},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var c=i.j;i.j=new Uint8Array(a),c&&i.j.set(c.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw Cs[44]},va(i,a,c,v){return Ie.createNode(i,a,c,v)},vb(i,a,c){if((i.mode&61440)===16384){try{var v=ji(a,c)}catch{}if(v)for(var y in v.j)throw new ve(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=c,a.j[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var c=ji(i,a),v;for(v in c.j)throw new ve(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],c;for(c in i.j)i.j.hasOwnProperty(c)&&a.push(c);return a},Ea(i,a,c){return i=Ie.createNode(i,a,41471,0),i.link=c,i},ma(i){if((i.mode&61440)!==40960)throw new ve(28);return i.link}},m:{read(i,a,c,v,y){var k=i.node.j;if(y>=i.node.v)return 0;if(i=Math.min(i.node.v-y,v),8<i&&k.subarray)a.set(k.subarray(y,y+i),c);else for(v=0;v<i;v++)a[c+v]=k[y+v];return i},write(i,a,c,v,y,k){if(a.buffer===Ge.buffer&&(k=!1),!v)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(k)return i.j=a.subarray(c,c+v),i.v=v;if(i.v===0&&y===0)return i.j=a.slice(c,c+v),i.v=v;if(y+v<=i.v)return i.j.set(a.subarray(c,c+v),y),v}if(Ut(i,y+v),i.j.subarray&&a.subarray)i.j.set(a.subarray(c,c+v),y);else for(k=0;k<v;k++)i.j[y+k]=a[c+k];return i.v=Math.max(i.v,y+v),v},ba(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new ve(28);return a},pa(i,a,c){Ut(i.node,a+c),i.node.v=Math.max(i.node.v,a+c)},mb(i,a,c,v,y){if((i.node.mode&61440)!==32768)throw new ve(43);if(i=i.node.j,y&2||i.buffer!==Ge.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,st(),a=void 0,!a)throw new ve(48);Ge.set(i,a)}else c=!1,a=i.byteOffset;return{o:a,M:c}},ob(i,a,c,v){return Ie.m.write(i,a,0,v,c,!1),0}}};function Ze(i,a){var c=0;return i&&(c|=365),a&&(c|=146),c}var _r=null,Ha={},xi=[],Lu=1,si=null,Ga=!0,ve=null,Cs={},en=(i,a={})=>{if(i=H(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new ve(32);i=i.split("/").filter(P=>!!P);for(var c=_r,v="/",y=0;y<i.length;y++){var k=y===i.length-1;if(k&&a.parent)break;if(c=ji(c,i[y]),v=C(v+"/"+i[y]),c.wa&&(!k||k&&a.hb)&&(c=c.wa.root),!k||a.gb){for(k=0;(c.mode&61440)===40960;)if(c=Fu(v),v=H(S(v),c),c=en(v,{Qa:a.Qa+1}).node,40<k++)throw new ve(32)}}return{path:v,node:c}},Ka=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},Ya=(i,a)=>{for(var c=0,v=0;v<a.length;v++)c=(c<<5)-c+a.charCodeAt(v)|0;return(i+c>>>0)%si.length},ji=(i,a)=>{var c;if(c=(c=Ri(i,"x"))?c:i.l.ka?0:2)throw new ve(c,i);for(c=si[Ya(i.id,a)];c;c=c.lc){var v=c.name;if(c.parent.id===i.id&&v===a)return c}return i.l.ka(i,a)},Ja=(i,a,c,v)=>(i=new So(i,a,c,v),a=Ya(i.parent.id,i.name),i.lc=si[a],si[a]=i),Xa=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},Ri=(i,a)=>{if(Ga)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Qa=(i,a)=>{try{return ji(i,a),20}catch{}return Ri(i,"wx")},Du=()=>{for(var i=0;4096>=i;i++)if(!xi[i])return i;throw new ve(33)},Br=i=>{if(i=xi[i],!i)throw new ve(8);return i},Za=(i,a=-1)=>(oi||(oi=function(){this.h={}},oi.prototype={},Object.defineProperties(oi.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),i=Object.assign(new oi,i),a==-1&&(a=Du()),i.X=a,xi[a]=i),$u={open:i=>{i.m=Ha[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new ve(70)}},Ts=(i,a)=>{Ha[i]={m:a}},eo=(i,a)=>{var c=a==="/",v=!a;if(c&&_r)throw new ve(10);if(!c&&!v){var y=en(a,{hb:!1});if(a=y.path,y=y.node,y.wa)throw new ve(10);if((y.mode&61440)!==16384)throw new ve(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,c?_r=i:y&&(y.wa=a,y.U&&y.U.kc.push(a))},cr=(i,a,c)=>{var v=en(i,{parent:!0}).node;if(i=T(i),!i||i==="."||i==="..")throw new ve(28);var y=Qa(v,i);if(y)throw new ve(y);if(!v.l.va)throw new ve(63);return v.l.va(v,i,a,c)},Oi=(i,a,c)=>{typeof c>"u"&&(c=a,a=438),cr(i,a|8192,c)},Ps=(i,a)=>{if(!H(i))throw new ve(44);var c=en(a,{parent:!0}).node;if(!c)throw new ve(44);a=T(a);var v=Qa(c,a);if(v)throw new ve(v);if(!c.l.Ea)throw new ve(63);c.l.Ea(c,a,i)},Fu=i=>{if(i=en(i).node,!i)throw new ve(44);if(!i.l.ma)throw new ve(28);return H(Ka(i.parent),i.l.ma(i))},Mi=(i,a,c)=>{if(i==="")throw new ve(44);if(typeof a=="string"){var v={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof v>"u")throw Error(`Unknown file open mode: ${a}`);a=v}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var y=i;else{i=C(i);try{y=en(i,{gb:!(a&131072)}).node}catch{}}if(v=!1,a&64)if(y){if(a&128)throw new ve(20)}else y=cr(i,c,0),v=!0;if(!y)throw new ve(44);if((y.mode&61440)===8192&&(a&=-513),a&65536&&(y.mode&61440)!==16384)throw new ve(54);if(!v&&(c=y?(y.mode&61440)===40960?32:(y.mode&61440)===16384&&(Xa(a)!=="r"||a&512)?31:Ri(y,Xa(a)):44))throw new ve(c);if(a&512&&!v){if(c=y,c=typeof c=="string"?en(c,{gb:!0}).node:c,!c.l.P)throw new ve(63);if((c.mode&61440)===16384)throw new ve(31);if((c.mode&61440)!==32768)throw new ve(28);if(v=Ri(c,"w"))throw new ve(v);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,y=Za({node:y,path:Ka(y),flags:a,seekable:!0,position:0,m:y.m,zc:[],error:!1}),y.m.open&&y.m.open(y),!p.logReadFiles||a&1||(Li||(Li={}),i in Li||(Li[i]=1)),y},to=(i,a,c)=>{if(i.X===null)throw new ve(8);if(!i.seekable||!i.m.ba)throw new ve(70);if(c!=0&&c!=1&&c!=2)throw new ve(28);i.position=i.m.ba(i,a,c),i.zc=[]},ro=()=>{ve||(ve=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(i),this.message="FS error"},ve.prototype=Error(),ve.prototype.constructor=ve,[44].forEach(i=>{Cs[i]=new ve(i),Cs[i].stack="<generic error, no stack>"}))},no,ai=(i,a,c)=>{i=C("/dev/"+i);var v=Ze(!!a,!!c);xs||(xs=64);var y=xs++<<8|0;Ts(y,{open:k=>{k.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(k,P,D,V)=>{for(var R=0,re=0;re<V;re++){try{var ie=a()}catch{throw new ve(29)}if(ie===void 0&&R===0)throw new ve(6);if(ie==null)break;R++,P[D+re]=ie}return R&&(k.node.timestamp=Date.now()),R},write:(k,P,D,V)=>{for(var R=0;R<V;R++)try{c(P[D+R])}catch{throw new ve(29)}return V&&(k.node.timestamp=Date.now()),R}}),Oi(i,v,y)},xs,tn={},oi,Li,li=void 0;function Pr(){return li+=4,Re[li-4>>2]}function io(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Di(i,a){return i=io(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function so(){this.M=[void 0],this.ib=[]}var ir=new so,Sn=void 0;function Ue(i){throw new Sn(i)}var dr=i=>(i||Ue("Cannot use deleted val. handle = "+i),ir.get(i).value),hr=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return ir.pa({ub:1,value:i})}};function ao(i){var a=Error,c=Di(i,function(v){this.name=i,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var oo=void 0,lo=void 0;function It(i){for(var a="";qe[i];)a+=lo[qe[i++]];return a}var ui=[];function js(){for(;ui.length;){var i=ui.pop();i.g.fa=!1,i.delete()}}var ci=void 0,xr={};function Rs(i,a){for(a===void 0&&Ue("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var rn={};function uo(i){i=jo(i);var a=It(i);return Or(i),a}function di(i,a){var c=rn[i];return c===void 0&&Ue(a+" has unknown type "+uo(i)),c}function $i(){}var Os=!1;function co(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function ho(i,a,c){return a===c?i:c.A===void 0?null:(i=ho(i,a,c.A),i===null?null:c.Pb(i))}var fo={};function Uu(i,a){return a=Rs(i,a),xr[a]}var vo=void 0;function Fi(i){throw new vo(i)}function Ui(i,a){return a.u&&a.o||Fi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Fi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},In(Object.create(i,{g:{value:a}}))}function In(i){return typeof FinalizationRegistry>"u"?(In=a=>a,i):(Os=new FinalizationRegistry(a=>{co(a.g)}),In=a=>{var c=a.g;return c.G&&Os.register(a,{g:c},a),a},$i=a=>{Os.unregister(a)},In(i))}var Ni={};function hi(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function fi(i){return this.fromWireType(Re[i>>2])}var An={},Bi={};function er(i,a,c){function v(D){D=c(D),D.length!==i.length&&Fi("Mismatched type converter count");for(var V=0;V<i.length;++V)yr(i[V],D[V])}i.forEach(function(D){Bi[D]=a});var y=Array(a.length),k=[],P=0;a.forEach((D,V)=>{rn.hasOwnProperty(D)?y[V]=rn[D]:(k.push(D),An.hasOwnProperty(D)||(An[D]=[]),An[D].push(()=>{y[V]=rn[D],++P,P===k.length&&v(y)}))}),k.length===0&&v(y)}function Wi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Nu(i,a,c={}){var v=a.name;if(i||Ue(`type "${v}" must have a positive integer typeid pointer`),rn.hasOwnProperty(i)){if(c.$b)return;Ue(`Cannot register type '${v}' twice`)}rn[i]=a,delete Bi[i],An.hasOwnProperty(i)&&(a=An[i],delete An[i],a.forEach(y=>y()))}function yr(i,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Nu(i,a,c)}function Ms(i){Ue(i.g.u.i.name+" instance already deleted")}function Wr(){}function Ls(i,a,c){if(i[a].B===void 0){var v=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||Ue(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[v.ea]=v}}function Ds(i,a,c){p.hasOwnProperty(i)?((c===void 0||p[i].B!==void 0&&p[i].B[c]!==void 0)&&Ue(`Cannot register public name '${i}' twice`),Ls(p,i,i),p.hasOwnProperty(c)&&Ue(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),p[i].B[c]=a):(p[i]=a,c!==void 0&&(p[i].Pc=c))}function Bu(i,a,c,v,y,k,P,D){this.name=i,this.constructor=a,this.N=c,this.W=v,this.A=y,this.Ub=k,this.na=P,this.Pb=D,this.rb=[]}function Vi(i,a,c){for(;a!==c;)a.na||Ue(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function Wu(i,a){return a===null?(this.Na&&Ue(`null is not a valid ${this.name}`),0):(a.g||Ue(`Cannot pass "${Fs(a)}" as a ${this.name}`),a.g.o||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),Vi(a.g.o,a.g.u.i,this.i))}function Vu(i,a){if(a===null){if(this.Na&&Ue(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return i!==null&&i.push(this.W,c),c}return 0}if(a.g||Ue(`Cannot pass "${Fs(a)}" as a ${this.name}`),a.g.o||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&Ue(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Vi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&Ue("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:Ue(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var v=a.clone();c=this.oc(c,hr(function(){v.delete()})),i!==null&&i.push(this.W,c)}break;default:Ue("Unsupporting sharing policy")}return c}function qu(i,a){return a===null?(this.Na&&Ue(`null is not a valid ${this.name}`),0):(a.g||Ue(`Cannot pass "${Fs(a)}" as a ${this.name}`),a.g.o||Ue(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&Ue(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Vi(a.g.o,a.g.u.i,this.i))}function jr(i,a,c,v){this.name=i,this.i=a,this.Na=c,this.ta=v,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Vu:(this.toWireType=v?Wu:qu,this.K=null)}function po(i,a,c){p.hasOwnProperty(i)||Fi("Replacing nonexistant public symbol"),p[i].B!==void 0&&c!==void 0?p[i].B[c]=a:(p[i]=a,p[i].ea=c)}var qi=[],go=i=>{var a=qi[i];return a||(i>=qi.length&&(qi.length=i+1),qi[i]=a=Pe.get(i)),a},zu=(i,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),i.includes("j")){var v=p["dynCall_"+i];v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)}else v=go(a).apply(null,c);return v}};function Nt(i,a){i=It(i);var c=i.includes("j")?zu(i,a):go(a);return typeof c!="function"&&Ue(`unknown function pointer with signature ${i}: ${a}`),c}var mo=void 0;function Rr(i,a){function c(k){y[k]||rn[k]||(Bi[k]?Bi[k].forEach(c):(v.push(k),y[k]=!0))}var v=[],y={};throw a.forEach(c),new mo(`${i}: `+v.map(uo).join([", "]))}function zi(i,a,c,v,y){var k=a.length;2>k&&Ue("argTypes array size mismatch! Must at least get return value and 'this' types!");var P=a[1]!==null&&c!==null,D=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){D=!0;break}var V=a[0].name!=="void",R=k-2,re=Array(R),ie=[],fe=[];return function(){if(arguments.length!==R&&Ue(`function ${i} called with ${arguments.length} arguments, expected ${R} args!`),fe.length=0,ie.length=P?2:1,ie[0]=y,P){var j=a[1].toWireType(fe,this);ie[1]=j}for(var Z=0;Z<R;++Z)re[Z]=a[Z+2].toWireType(fe,arguments[Z]),ie.push(re[Z]);if(Z=v.apply(null,ie),D)hi(fe);else for(var J=P?1:2;J<a.length;J++){var Ne=J===1?j:re[J-2];a[J].K!==null&&a[J].K(Ne)}return j=V?a[0].fromWireType(Z):void 0,j}}function Hi(i,a){for(var c=[],v=0;v<i;v++)c.push(ae[a+4*v>>2]);return c}function _o(i,a,c){return i instanceof Object||Ue(`${c} with invalid "this": ${i}`),i instanceof a.i.constructor||Ue(`${c} incompatible with "this" of type ${i.constructor.name}`),i.g.o||Ue(`cannot call emscripten binding method ${c} on deleted object`),Vi(i.g.o,i.g.u.i,a.i)}function $s(i){i>=ir.h&&--ir.get(i).ub===0&&ir.Zb(i)}function Hu(i,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?Ge:qe)[v])};case 1:return function(v){return this.fromWireType((c?rt:lt)[v>>1])};case 2:return function(v){return this.fromWireType((c?Re:ae)[v>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Fs(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Gu(i,a){switch(a){case 2:return function(c){return this.fromWireType(Me[c>>2])};case 3:return function(c){return this.fromWireType(ye[c>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Ku(i,a,c){switch(a){case 0:return c?function(v){return Ge[v]}:function(v){return qe[v]};case 1:return c?function(v){return rt[v>>1]}:function(v){return lt[v>>1]};case 2:return c?function(v){return Re[v>>2]}:function(v){return ae[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var yo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Yu=(i,a)=>{for(var c=i>>1,v=c+a/2;!(c>=v)&&lt[c];)++c;if(c<<=1,32<c-i&&yo)return yo.decode(qe.subarray(i,c));for(c="",v=0;!(v>=a/2);++v){var y=rt[i+2*v>>1];if(y==0)break;c+=String.fromCharCode(y)}return c},Ju=(i,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*i.length?c/2:i.length;for(var y=0;y<c;++y)rt[a>>1]=i.charCodeAt(y),a+=2;return rt[a>>1]=0,a-v},Xu=i=>2*i.length,Qu=(i,a)=>{for(var c=0,v="";!(c>=a/4);){var y=Re[i+4*c>>2];if(y==0)break;++c,65536<=y?(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023)):v+=String.fromCharCode(y)}return v},Zu=(i,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var y=0;y<i.length;++y){var k=i.charCodeAt(y);if(55296<=k&&57343>=k){var P=i.charCodeAt(++y);k=65536+((k&1023)<<10)|P&1023}if(Re[a>>2]=k,a+=4,a+4>c)break}return Re[a>>2]=0,a-v},ec=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a},tc={};function Gi(i){var a=tc[i];return a===void 0?It(i):a}var Ki=[];function rc(i){var a=Ki.length;return Ki.push(i),a}function nc(i,a){for(var c=Array(i),v=0;v<i;++v)c[v]=di(ae[a+4*v>>2],"parameter "+v);return c}var wo=[],Us=[],Ns={},bo=()=>{if(!Bs){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:B||"./this.program"},a;for(a in Ns)Ns[a]===void 0?delete i[a]:i[a]=Ns[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);Bs=c}return Bs},Bs,Yi=i=>i%4===0&&(i%100!==0||i%400===0),ko=[31,29,31,30,31,30,31,31,30,31,30,31],Eo=[31,28,31,30,31,30,31,31,30,31,30,31],ic=(i,a,c,v)=>{function y(j,Z,J){for(j=typeof j=="number"?j.toString():j||"";j.length<Z;)j=J[0]+j;return j}function k(j,Z){return y(j,Z,"0")}function P(j,Z){function J(Ve){return 0>Ve?-1:0<Ve?1:0}var Ne;return(Ne=J(j.getFullYear()-Z.getFullYear()))===0&&(Ne=J(j.getMonth()-Z.getMonth()))===0&&(Ne=J(j.getDate()-Z.getDate())),Ne}function D(j){switch(j.getDay()){case 0:return new Date(j.getFullYear()-1,11,29);case 1:return j;case 2:return new Date(j.getFullYear(),0,3);case 3:return new Date(j.getFullYear(),0,2);case 4:return new Date(j.getFullYear(),0,1);case 5:return new Date(j.getFullYear()-1,11,31);case 6:return new Date(j.getFullYear()-1,11,30)}}function V(j){var Z=j.ca;for(j=new Date(new Date(j.da+1900,0,1).getTime());0<Z;){var J=j.getMonth(),Ne=(Yi(j.getFullYear())?ko:Eo)[J];if(Z>Ne-j.getDate())Z-=Ne-j.getDate()+1,j.setDate(1),11>J?j.setMonth(J+1):(j.setMonth(0),j.setFullYear(j.getFullYear()+1));else{j.setDate(j.getDate()+Z);break}}return J=new Date(j.getFullYear()+1,0,4),Z=D(new Date(j.getFullYear(),0,4)),J=D(J),0>=P(Z,j)?0>=P(J,j)?j.getFullYear()+1:j.getFullYear():j.getFullYear()-1}var R=Re[v+40>>2];v={wc:Re[v>>2],vc:Re[v+4>>2],Fa:Re[v+8>>2],Sa:Re[v+12>>2],Ga:Re[v+16>>2],da:Re[v+20>>2],R:Re[v+24>>2],ca:Re[v+28>>2],Rc:Re[v+32>>2],uc:Re[v+36>>2],xc:R&&R?de(qe,R):""},c=c?de(qe,c):"",R={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var re in R)c=c.replace(new RegExp(re,"g"),R[re]);var ie="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),fe="January February March April May June July August September October November December".split(" ");R={"%a":j=>ie[j.R].substring(0,3),"%A":j=>ie[j.R],"%b":j=>fe[j.Ga].substring(0,3),"%B":j=>fe[j.Ga],"%C":j=>k((j.da+1900)/100|0,2),"%d":j=>k(j.Sa,2),"%e":j=>y(j.Sa,2," "),"%g":j=>V(j).toString().substring(2),"%G":j=>V(j),"%H":j=>k(j.Fa,2),"%I":j=>(j=j.Fa,j==0?j=12:12<j&&(j-=12),k(j,2)),"%j":j=>{for(var Z=0,J=0;J<=j.Ga-1;Z+=(Yi(j.da+1900)?ko:Eo)[J++]);return k(j.Sa+Z,3)},"%m":j=>k(j.Ga+1,2),"%M":j=>k(j.vc,2),"%n":()=>`
`,"%p":j=>0<=j.Fa&&12>j.Fa?"AM":"PM","%S":j=>k(j.wc,2),"%t":()=>"	","%u":j=>j.R||7,"%U":j=>k(Math.floor((j.ca+7-j.R)/7),2),"%V":j=>{var Z=Math.floor((j.ca+7-(j.R+6)%7)/7);if(2>=(j.R+371-j.ca-2)%7&&Z++,Z)Z==53&&(J=(j.R+371-j.ca)%7,J==4||J==3&&Yi(j.da)||(Z=1));else{Z=52;var J=(j.R+7-j.ca-1)%7;(J==4||J==5&&Yi(j.da%400-1))&&Z++}return k(Z,2)},"%w":j=>j.R,"%W":j=>k(Math.floor((j.ca+7-(j.R+6)%7)/7),2),"%y":j=>(j.da+1900).toString().substring(2),"%Y":j=>j.da+1900,"%z":j=>{j=j.uc;var Z=0<=j;return j=Math.abs(j)/60,(Z?"+":"-")+("0000"+(j/60*100+j%60)).slice(-4)},"%Z":j=>j.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(re in R)c.includes(re)&&(c=c.replace(new RegExp(re,"g"),R[re](v)));return c=c.replace(/\0\0/g,"%"),re=St(c,!1),re.length>a?0:(Ge.set(re,i),re.length-1)};function So(i,a,c,v){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Lu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=v}Object.defineProperties(So.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),ro(),si=Array(4096),eo(Ie,"/"),cr("/tmp",16895,0),cr("/home",16895,0),cr("/home/web_user",16895,0),(()=>{cr("/dev",16895,0),Ts(259,{read:()=>0,write:(v,y,k,P)=>P}),Oi("/dev/null",259),yt(1280,gt),yt(1536,ht),Oi("/dev/tty",1280),Oi("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=z(i).byteLength),i[--a]);ai("random",c),ai("urandom",c),cr("/dev/shm",16895,0),cr("/dev/shm/tmp",16895,0)})(),(()=>{cr("/proc",16895,0);var i=cr("/proc/self",16895,0);cr("/proc/self/fd",16895,0),eo({U:()=>{var a=Ja(i,"fd",16895,73);return a.l={ka:(c,v)=>{var y=Br(+v);return c={parent:null,U:{nb:"fake"},l:{ma:()=>y.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(so.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Sn=p.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},ir.M.push({value:void 0},{value:null},{value:!0},{value:!1}),ir.h=ir.M.length,p.count_emval_handles=function(){for(var i=0,a=ir.h;a<ir.M.length;++a)ir.M[a]!==void 0&&++i;return i},oo=p.PureVirtualError=ao("PureVirtualError");for(var Io=Array(256),Ji=0;256>Ji;++Ji)Io[Ji]=String.fromCharCode(Ji);lo=Io,p.getInheritedInstanceCount=function(){return Object.keys(xr).length},p.getLiveInheritedInstances=function(){var i=[],a;for(a in xr)xr.hasOwnProperty(a)&&i.push(xr[a]);return i},p.flushPendingDeletes=js,p.setDelayFunction=function(i){ci=i,ui.length&&ci&&ci(js)},vo=p.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},Wr.prototype.isAliasOf=function(i){if(!(this instanceof Wr&&i instanceof Wr))return!1;var a=this.g.u.i,c=this.g.o,v=i.g.u.i;for(i=i.g.o;a.A;)c=a.na(c),a=a.A;for(;v.A;)i=v.na(i),v=v.A;return a===v&&c===i},Wr.prototype.clone=function(){if(this.g.o||Ms(this),this.g.ia)return this.g.count.value+=1,this;var i=In,a=Object,c=a.create,v=Object.getPrototypeOf(this),y=this.g;return i=i(c.call(a,v,{g:{value:{count:y.count,fa:y.fa,ia:y.ia,o:y.o,u:y.u,G:y.G,L:y.L}}})),i.g.count.value+=1,i.g.fa=!1,i},Wr.prototype.delete=function(){this.g.o||Ms(this),this.g.fa&&!this.g.ia&&Ue("Object already scheduled for deletion"),$i(this),co(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Wr.prototype.isDeleted=function(){return!this.g.o},Wr.prototype.deleteLater=function(){return this.g.o||Ms(this),this.g.fa&&!this.g.ia&&Ue("Object already scheduled for deletion"),ui.push(this),ui.length===1&&ci&&ci(js),this.g.fa=!0,this},jr.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},jr.prototype.bb=function(i){this.W&&this.W(i)},jr.prototype.argPackAdvance=8,jr.prototype.readValueFromPointer=fi,jr.prototype.deleteObject=function(i){i!==null&&i.delete()},jr.prototype.fromWireType=function(i){function a(){return this.ua?Ui(this.i.N,{u:this.nc,o:c,L:this,G:i}):Ui(this.i.N,{u:this,o:i})}var c=this.Vb(i);if(!c)return this.bb(i),null;var v=Uu(this.i,c);if(v!==void 0)return v.g.count.value===0?(v.g.o=c,v.g.G=i,v.clone()):(v=v.clone(),this.bb(i),v);if(v=this.i.Ub(c),v=fo[v],!v)return a.call(this);v=this.ta?v.Kb:v.pointerType;var y=ho(c,this.i,v.i);return y===null?a.call(this):this.ua?Ui(v.i.N,{u:v,o:y,L:this,G:i}):Ui(v.i.N,{u:v,o:y})},mo=p.UnboundTypeError=ao("UnboundTypeError");var Ao={__syscall_fcntl64:function(i,a,c){li=c;try{var v=Br(i);switch(a){case 0:var y=Pr();return 0>y?-28:Za(v,y).X;case 1:case 2:return 0;case 3:return v.flags;case 4:return y=Pr(),v.flags|=y,0;case 5:return y=Pr(),rt[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Re[Co()>>2]=28,-1;default:return-28}}catch(k){if(typeof tn>"u"||k.name!=="ErrnoError")throw k;return-k.aa}},__syscall_ioctl:function(i,a,c){li=c;try{var v=Br(i);switch(a){case 21509:return v.s?0:-59;case 21505:if(!v.s)return-59;if(v.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var y=Pr();Re[y>>2]=25856,Re[y+4>>2]=5,Re[y+8>>2]=191,Re[y+12>>2]=35387;for(var k=0;32>k;k++)Ge[y+k+17>>0]=a[k]||0}return 0;case 21510:case 21511:case 21512:return v.s?0:-59;case 21506:case 21507:case 21508:if(!v.s)return-59;if(v.s.V.cc)for(y=Pr(),a=[],k=0;32>k;k++)a.push(Ge[y+k+17>>0]);return 0;case 21519:return v.s?(y=Pr(),Re[y>>2]=0):-59;case 21520:return v.s?-28:-59;case 21531:if(y=Pr(),!v.m.ac)throw new ve(59);return v.m.ac(v,a,y);case 21523:return v.s?(v.s.V.dc&&(k=[24,80],y=Pr(),rt[y>>1]=k[0],rt[y+2>>1]=k[1]),0):-59;case 21524:return v.s?0:-59;case 21515:return v.s?0:-59;default:return-28}}catch(P){if(typeof tn>"u"||P.name!=="ErrnoError")throw P;return-P.aa}},__syscall_openat:function(i,a,c,v){li=v;try{a=a?de(qe,a):"";var y=a;if(y.charAt(0)==="/")a=y;else{var k=i===-100?"/":Br(i).path;if(y.length==0)throw new ve(44);a=C(k+"/"+y)}var P=v?Pr():0;return Mi(a,c,P).X}catch(D){if(typeof tn>"u"||D.name!=="ErrnoError")throw D;return-D.aa}},_embind_create_inheriting_constructor:function(i,a,c){i=It(i),a=di(a,"wrapper"),c=dr(c);var v=[].slice,y=a.i,k=y.N,P=y.A.N,D=y.A.constructor;i=Di(i,function(){y.A.rb.forEach((function(R){if(this[R]===P[R])throw new oo(`Pure virtual function ${R} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:k}),this.__construct.apply(this,v.call(arguments))}),k.__construct=function(){this===k&&Ue("Pass correct 'this' to __construct");var R=D.implement.apply(void 0,[this].concat(v.call(arguments)));$i(R);var re=R.g;R.notifyOnDestruction(),re.ia=!0,Object.defineProperties(this,{g:{value:re}}),In(this),R=re.o,R=Rs(y,R),xr.hasOwnProperty(R)?Ue(`Tried to register registered instance: ${R}`):xr[R]=this},k.__destruct=function(){this===k&&Ue("Pass correct 'this' to __destruct"),$i(this);var R=this.g.o;R=Rs(y,R),xr.hasOwnProperty(R)?delete xr[R]:Ue(`Tried to unregister unregistered instance: ${R}`)},i.prototype=Object.create(k);for(var V in c)i.prototype[V]=c[V];return hr(i)},_embind_finalize_value_object:function(i){var a=Ni[i];delete Ni[i];var c=a.Pa,v=a.W,y=a.fb,k=y.map(P=>P.Yb).concat(y.map(P=>P.rc));er([i],k,P=>{var D={};return y.forEach((V,R)=>{var re=P[R],ie=V.Wb,fe=V.Xb,j=P[R+y.length],Z=V.qc,J=V.sc;D[V.Sb]={read:Ne=>re.fromWireType(ie(fe,Ne)),write:(Ne,Ve)=>{var le=[];Z(J,Ne,j.toWireType(le,Ve)),hi(le)}}}),[{name:a.name,fromWireType:function(V){var R={},re;for(re in D)R[re]=D[re].read(V);return v(V),R},toWireType:function(V,R){for(var re in D)if(!(re in R))throw new TypeError(`Missing field: "${re}"`);var ie=c();for(re in D)D[re].write(ie,R[re]);return V!==null&&V.push(v,ie),ie},argPackAdvance:8,readValueFromPointer:fi,K:v}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,c,v,y){var k=Wi(c);a=It(a),yr(i,{name:a,fromWireType:function(P){return!!P},toWireType:function(P,D){return D?v:y},argPackAdvance:8,readValueFromPointer:function(P){if(c===1)var D=Ge;else if(c===2)D=rt;else if(c===4)D=Re;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(D[P>>k])},K:null})},_embind_register_class:function(i,a,c,v,y,k,P,D,V,R,re,ie,fe){re=It(re),k=Nt(y,k),D&&(D=Nt(P,D)),R&&(R=Nt(V,R)),fe=Nt(ie,fe);var j=io(re);Ds(j,function(){Rr(`Cannot construct ${re} due to unbound types`,[v])}),er([i,a,c],v?[v]:[],function(Z){if(Z=Z[0],v)var J=Z.i,Ne=J.N;else Ne=Wr.prototype;Z=Di(j,function(){if(Object.getPrototypeOf(this)!==Ve)throw new Sn("Use 'new' to construct "+re);if(le.$===void 0)throw new Sn(re+" has no accessible constructor");var $t=le.$[arguments.length];if($t===void 0)throw new Sn(`Tried to invoke ctor of ${re} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(le.$).toString()}) parameters instead!`);return $t.apply(this,arguments)});var Ve=Object.create(Ne,{constructor:{value:Z}});Z.prototype=Ve;var le=new Bu(re,Z,Ve,fe,J,k,D,R);le.A&&(le.A.oa===void 0&&(le.A.oa=[]),le.A.oa.push(le)),J=new jr(re,le,!0,!1),Ne=new jr(re+"*",le,!1,!1);var wt=new jr(re+" const*",le,!1,!0);return fo[i]={pointerType:Ne,Kb:wt},po(j,Z),[J,Ne,wt]})},_embind_register_class_class_function:function(i,a,c,v,y,k,P){var D=Hi(c,v);a=It(a),k=Nt(y,k),er([],[i],function(V){function R(){Rr(`Cannot call ${re} due to unbound types`,D)}V=V[0];var re=`${V.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var ie=V.i.constructor;return ie[a]===void 0?(R.ea=c-1,ie[a]=R):(Ls(ie,a,re),ie[a].B[c-1]=R),er([],D,function(fe){if(fe=zi(re,[fe[0],null].concat(fe.slice(1)),null,k,P),ie[a].B===void 0?(fe.ea=c-1,ie[a]=fe):ie[a].B[c-1]=fe,V.i.oa)for(const j of V.i.oa)j.constructor.hasOwnProperty(a)||(j.constructor[a]=fe);return[]}),[]})},_embind_register_class_class_property:function(i,a,c,v,y,k,P,D){a=It(a),k=Nt(y,k),er([],[i],function(V){V=V[0];var R=`${V.name}.${a}`,re={get(){Rr(`Cannot access ${R} due to unbound types`,[c])},enumerable:!0,configurable:!0};return re.set=D?()=>{Rr(`Cannot access ${R} due to unbound types`,[c])}:()=>{Ue(`${R} is a read-only property`)},Object.defineProperty(V.i.constructor,a,re),er([],[c],function(ie){ie=ie[0];var fe={get(){return ie.fromWireType(k(v))},enumerable:!0};return D&&(D=Nt(P,D),fe.set=j=>{var Z=[];D(v,ie.toWireType(Z,j)),hi(Z)}),Object.defineProperty(V.i.constructor,a,fe),[]}),[]})},_embind_register_class_constructor:function(i,a,c,v,y,k){var P=Hi(a,c);y=Nt(v,y),er([],[i],function(D){D=D[0];var V=`constructor ${D.name}`;if(D.i.$===void 0&&(D.i.$=[]),D.i.$[a-1]!==void 0)throw new Sn(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${D.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return D.i.$[a-1]=()=>{Rr(`Cannot construct ${D.name} due to unbound types`,P)},er([],P,function(R){return R.splice(1,0,null),D.i.$[a-1]=zi(V,R,null,y,k),[]}),[]})},_embind_register_class_function:function(i,a,c,v,y,k,P,D){var V=Hi(c,v);a=It(a),k=Nt(y,k),er([],[i],function(R){function re(){Rr(`Cannot call ${ie} due to unbound types`,V)}R=R[0];var ie=`${R.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),D&&R.i.rb.push(a);var fe=R.i.N,j=fe[a];return j===void 0||j.B===void 0&&j.className!==R.name&&j.ea===c-2?(re.ea=c-2,re.className=R.name,fe[a]=re):(Ls(fe,a,ie),fe[a].B[c-2]=re),er([],V,function(Z){return Z=zi(ie,Z,R,k,P),fe[a].B===void 0?(Z.ea=c-2,fe[a]=Z):fe[a].B[c-2]=Z,[]}),[]})},_embind_register_class_property:function(i,a,c,v,y,k,P,D,V,R){a=It(a),y=Nt(v,y),er([],[i],function(re){re=re[0];var ie=`${re.name}.${a}`,fe={get(){Rr(`Cannot access ${ie} due to unbound types`,[c,P])},enumerable:!0,configurable:!0};return fe.set=V?()=>{Rr(`Cannot access ${ie} due to unbound types`,[c,P])}:()=>{Ue(ie+" is a read-only property")},Object.defineProperty(re.i.N,a,fe),er([],V?[c,P]:[c],function(j){var Z=j[0],J={get(){var Ve=_o(this,re,ie+" getter");return Z.fromWireType(y(k,Ve))},enumerable:!0};if(V){V=Nt(D,V);var Ne=j[1];J.set=function(Ve){var le=_o(this,re,ie+" setter"),wt=[];V(R,le,Ne.toWireType(wt,Ve)),hi(wt)}}return Object.defineProperty(re.i.N,a,J),[]}),[]})},_embind_register_emval:function(i,a){a=It(a),yr(i,{name:a,fromWireType:function(c){var v=dr(c);return $s(c),v},toWireType:function(c,v){return hr(v)},argPackAdvance:8,readValueFromPointer:fi,K:null})},_embind_register_enum:function(i,a,c,v){function y(){}c=Wi(c),a=It(a),y.values={},yr(i,{name:a,constructor:y,fromWireType:function(k){return this.constructor.values[k]},toWireType:function(k,P){return P.value},argPackAdvance:8,readValueFromPointer:Hu(a,c,v),K:null}),Ds(a,y)},_embind_register_enum_value:function(i,a,c){var v=di(i,"enum");a=It(a),i=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:Di(`${v.name}_${a}`,function(){})}}),i.values[c]=v,i[a]=v},_embind_register_float:function(i,a,c){c=Wi(c),a=It(a),yr(i,{name:a,fromWireType:function(v){return v},toWireType:function(v,y){return y},argPackAdvance:8,readValueFromPointer:Gu(a,c),K:null})},_embind_register_function:function(i,a,c,v,y,k){var P=Hi(a,c);i=It(i),y=Nt(v,y),Ds(i,function(){Rr(`Cannot call ${i} due to unbound types`,P)},a-1),er([],P,function(D){return po(i,zi(i,[D[0],null].concat(D.slice(1)),null,y,k),a-1),[]})},_embind_register_integer:function(i,a,c,v,y){a=It(a),y===-1&&(y=4294967295),y=Wi(c);var k=D=>D;if(v===0){var P=32-8*c;k=D=>D<<P>>>P}c=a.includes("unsigned")?function(D,V){return V>>>0}:function(D,V){return V},yr(i,{name:a,fromWireType:k,toWireType:c,argPackAdvance:8,readValueFromPointer:Ku(a,y,v!==0),K:null})},_embind_register_memory_view:function(i,a,c){function v(k){k>>=2;var P=ae;return new y(P.buffer,P[k+1],P[k])}var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=It(c),yr(i,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{$b:!0})},_embind_register_std_string:function(i,a){a=It(a);var c=a==="std::string";yr(i,{name:a,fromWireType:function(v){var y=ae[v>>2],k=v+4;if(c)for(var P=k,D=0;D<=y;++D){var V=k+D;if(D==y||qe[V]==0){if(P=P?de(qe,P,V-P):"",R===void 0)var R=P;else R+="\0",R+=P;P=V+1}}else{for(R=Array(y),D=0;D<y;++D)R[D]=String.fromCharCode(qe[k+D]);R=R.join("")}return Or(v),R},toWireType:function(v,y){y instanceof ArrayBuffer&&(y=new Uint8Array(y));var k=typeof y=="string";k||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Int8Array||Ue("Cannot pass non-string to std::string");var P=c&&k?Se(y):y.length,D=Ws(4+P+1),V=D+4;if(ae[D>>2]=P,c&&k)pt(y,qe,V,P+1);else if(k)for(k=0;k<P;++k){var R=y.charCodeAt(k);255<R&&(Or(V),Ue("String has UTF-16 code units that do not fit in 8 bits")),qe[V+k]=R}else for(k=0;k<P;++k)qe[V+k]=y[k];return v!==null&&v.push(Or,D),D},argPackAdvance:8,readValueFromPointer:fi,K:function(v){Or(v)}})},_embind_register_std_wstring:function(i,a,c){if(c=It(c),a===2)var v=Yu,y=Ju,k=Xu,P=()=>lt,D=1;else a===4&&(v=Qu,y=Zu,k=ec,P=()=>ae,D=2);yr(i,{name:c,fromWireType:function(V){for(var R=ae[V>>2],re=P(),ie,fe=V+4,j=0;j<=R;++j){var Z=V+4+j*a;(j==R||re[Z>>D]==0)&&(fe=v(fe,Z-fe),ie===void 0?ie=fe:(ie+="\0",ie+=fe),fe=Z+a)}return Or(V),ie},toWireType:function(V,R){typeof R!="string"&&Ue(`Cannot pass non-string to C++ string type ${c}`);var re=k(R),ie=Ws(4+re+a);return ae[ie>>2]=re>>D,y(R,ie+4,re+a),V!==null&&V.push(Or,ie),ie},argPackAdvance:8,readValueFromPointer:fi,K:function(V){Or(V)}})},_embind_register_value_object:function(i,a,c,v,y,k){Ni[i]={name:It(a),Pa:Nt(c,v),W:Nt(y,k),fb:[]}},_embind_register_value_object_field:function(i,a,c,v,y,k,P,D,V,R){Ni[i].fb.push({Sb:It(a),Yb:c,Wb:Nt(v,y),Xb:k,rc:P,qc:Nt(D,V),sc:R})},_embind_register_void:function(i,a){a=It(a),yr(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,c){i=dr(i),a=di(a,"emval::as");var v=[],y=hr(v);return ae[c>>2]=y,a.toWireType(v,i)},_emval_call_method:function(i,a,c,v,y){i=Ki[i],a=dr(a),c=Gi(c);var k=[];return ae[v>>2]=hr(k),i(a,c,k,y)},_emval_call_void_method:function(i,a,c,v){i=Ki[i],a=dr(a),c=Gi(c),i(a,c,null,v)},_emval_decref:$s,_emval_get_method_caller:function(i,a){var c=nc(i,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(P){return P.name}).join("_")+"$";var y=wo[a];if(y!==void 0)return y;var k=Array(i-1);return y=rc((P,D,V,R)=>{for(var re=0,ie=0;ie<i-1;++ie)k[ie]=c[ie+1].readValueFromPointer(R+re),re+=c[ie+1].argPackAdvance;for(P=P[D].apply(P,k),ie=0;ie<i-1;++ie)c[ie+1].Nb&&c[ie+1].Nb(k[ie]);if(!v.fc)return v.toWireType(V,P)}),wo[a]=y},_emval_get_module_property:function(i){return i=Gi(i),hr(p[i])},_emval_get_property:function(i,a){return i=dr(i),a=dr(a),hr(i[a])},_emval_incref:function(i){4<i&&(ir.get(i).ub+=1)},_emval_new_array:function(){return hr([])},_emval_new_cstring:function(i){return hr(Gi(i))},_emval_new_object:function(){return hr({})},_emval_run_destructors:function(i){var a=dr(i);hi(a),$s(i)},_emval_set_property:function(i,a,c){i=dr(i),a=dr(a),c=dr(c),i[a]=c},_emval_take_value:function(i,a){return i=di(i,"_emval_take_value"),i=i.readValueFromPointer(a),hr(i)},abort:()=>{st("")},emscripten_asm_const_int:(i,a,c)=>{Us.length=0;var v;for(c>>=2;v=qe[a++];)c+=v!=105&c,Us.push(v==105?Re[c]:ye[c++>>1]),++c;return o[i].apply(null,Us)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,c)=>qe.copyWithin(i,a,a+c),emscripten_resize_heap:i=>{var a=qe.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,i+100663296);var y=Math;v=Math.max(i,v);e:{y=y.min.call(y,2147483648,v+(65536-v%65536)%65536)-_e.buffer.byteLength+65535>>>16;try{_e.grow(y),De();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},environ_get:(i,a)=>{var c=0;return bo().forEach(function(v,y){var k=a+c;for(y=ae[i+4*y>>2]=k,k=0;k<v.length;++k)Ge[y++>>0]=v.charCodeAt(k);Ge[y>>0]=0,c+=v.length+1}),0},environ_sizes_get:(i,a)=>{var c=bo();ae[i>>2]=c.length;var v=0;return c.forEach(function(y){v+=y.length+1}),ae[a>>2]=v,0},fd_close:function(i){try{var a=Br(i);if(a.X===null)throw new ve(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{xi[a.X]=null}return a.X=null,0}catch(c){if(typeof tn>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(i,a,c,v){try{e:{var y=Br(i);i=a;for(var k,P=a=0;P<c;P++){var D=ae[i>>2],V=ae[i+4>>2];i+=8;var R=y,re=D,ie=V,fe=k,j=Ge;if(0>ie||0>fe)throw new ve(28);if(R.X===null)throw new ve(8);if((R.flags&2097155)===1)throw new ve(8);if((R.node.mode&61440)===16384)throw new ve(31);if(!R.m.read)throw new ve(28);var Z=typeof fe<"u";if(!Z)fe=R.position;else if(!R.seekable)throw new ve(70);var J=R.m.read(R,j,re,ie,fe);Z||(R.position+=J);var Ne=J;if(0>Ne){var Ve=-1;break e}if(a+=Ne,Ne<V)break;typeof k<"u"&&(k+=Ne)}Ve=a}return ae[v>>2]=Ve,0}catch(le){if(typeof tn>"u"||le.name!=="ErrnoError")throw le;return le.aa}},fd_seek:function(i,a,c,v,y){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var k=Br(i);return to(k,a,v),g=[k.position>>>0,(Ct=k.position,1<=+Math.abs(Ct)?0<Ct?+Math.floor(Ct/4294967296)>>>0:~~+Math.ceil((Ct-+(~~Ct>>>0))/4294967296)>>>0:0)],Re[y>>2]=g[0],Re[y+4>>2]=g[1],k.Ma&&a===0&&v===0&&(k.Ma=null),0}catch(P){if(typeof tn>"u"||P.name!=="ErrnoError")throw P;return P.aa}},fd_write:function(i,a,c,v){try{e:{var y=Br(i);i=a;for(var k,P=a=0;P<c;P++){var D=ae[i>>2],V=ae[i+4>>2];i+=8;var R=y,re=D,ie=V,fe=k,j=Ge;if(0>ie||0>fe)throw new ve(28);if(R.X===null)throw new ve(8);if((R.flags&2097155)===0)throw new ve(8);if((R.node.mode&61440)===16384)throw new ve(31);if(!R.m.write)throw new ve(28);R.seekable&&R.flags&1024&&to(R,0,2);var Z=typeof fe<"u";if(!Z)fe=R.position;else if(!R.seekable)throw new ve(70);var J=R.m.write(R,j,re,ie,fe,void 0);Z||(R.position+=J);var Ne=J;if(0>Ne){var Ve=-1;break e}a+=Ne,typeof k<"u"&&(k+=Ne)}Ve=a}return ae[v>>2]=Ve,0}catch(le){if(typeof tn>"u"||le.name!=="ErrnoError")throw le;return le.aa}},strftime_l:(i,a,c,v)=>ic(i,a,c,v)};(function(){function i(c){if(pe=c=c.exports,_e=pe.memory,De(),Pe=pe.__indirect_function_table,Ee.unshift(pe.__wasm_call_ctors),Ce--,p.monitorRunDependencies&&p.monitorRunDependencies(Ce),Ce==0&&dt){var v=dt;dt=null,v()}return c}var a={env:Ao,wasi_snapshot_preview1:Ao};if(Ce++,p.monitorRunDependencies&&p.monitorRunDependencies(Ce),p.instantiateWasm)try{return p.instantiateWasm(a,i)}catch(c){Te("Module.instantiateWasm callback failed with error: "+c),U(c)}return nr(a,function(c){i(c.instance)}).catch(U),{}})();var Or=i=>(Or=pe.free)(i),Ws=i=>(Ws=pe.malloc)(i),Co=()=>(Co=pe.__errno_location)(),To=p._ma_device__on_notification_unlocked=i=>(To=p._ma_device__on_notification_unlocked=pe.ma_device__on_notification_unlocked)(i);p._ma_malloc_emscripten=(i,a)=>(p._ma_malloc_emscripten=pe.ma_malloc_emscripten)(i,a),p._ma_free_emscripten=(i,a)=>(p._ma_free_emscripten=pe.ma_free_emscripten)(i,a);var Po=p._ma_device_process_pcm_frames_capture__webaudio=(i,a,c)=>(Po=p._ma_device_process_pcm_frames_capture__webaudio=pe.ma_device_process_pcm_frames_capture__webaudio)(i,a,c),xo=p._ma_device_process_pcm_frames_playback__webaudio=(i,a,c)=>(xo=p._ma_device_process_pcm_frames_playback__webaudio=pe.ma_device_process_pcm_frames_playback__webaudio)(i,a,c),jo=i=>(jo=pe.__getTypeName)(i);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=pe._embind_initialize_bindings)(),p.dynCall_iiji=(i,a,c,v,y)=>(p.dynCall_iiji=pe.dynCall_iiji)(i,a,c,v,y),p.dynCall_jiji=(i,a,c,v,y)=>(p.dynCall_jiji=pe.dynCall_jiji)(i,a,c,v,y),p.dynCall_iiiji=(i,a,c,v,y,k)=>(p.dynCall_iiiji=pe.dynCall_iiiji)(i,a,c,v,y,k),p.dynCall_iij=(i,a,c,v)=>(p.dynCall_iij=pe.dynCall_iij)(i,a,c,v),p.dynCall_jii=(i,a,c)=>(p.dynCall_jii=pe.dynCall_jii)(i,a,c),p.dynCall_viijii=(i,a,c,v,y,k,P)=>(p.dynCall_viijii=pe.dynCall_viijii)(i,a,c,v,y,k,P),p.dynCall_iiiiij=(i,a,c,v,y,k,P)=>(p.dynCall_iiiiij=pe.dynCall_iiiiij)(i,a,c,v,y,k,P),p.dynCall_iiiiijj=(i,a,c,v,y,k,P,D,V)=>(p.dynCall_iiiiijj=pe.dynCall_iiiiijj)(i,a,c,v,y,k,P,D,V),p.dynCall_iiiiiijj=(i,a,c,v,y,k,P,D,V,R)=>(p.dynCall_iiiiiijj=pe.dynCall_iiiiiijj)(i,a,c,v,y,k,P,D,V,R);var Xi;dt=function i(){Xi||Ro(),Xi||(dt=i)};function Ro(){function i(){if(!Xi&&(Xi=!0,p.calledRun=!0,!ct)){if(p.noFSInit||no||(no=!0,ro(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?ai("stdin",p.stdin):Ps("/dev/tty","/dev/stdin"),p.stdout?ai("stdout",null,p.stdout):Ps("/dev/tty","/dev/stdout"),p.stderr?ai("stderr",null,p.stderr):Ps("/dev/tty1","/dev/stderr"),Mi("/dev/stdin",0),Mi("/dev/stdout",1),Mi("/dev/stderr",1)),Ga=!1,d(Ee),A(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var a=p.postRun.shift();he.unshift(a)}d(he)}}if(!(0<Ce)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)ze();d(ke),0<Ce||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),i()},1)):i())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return Ro(),I.ready})})();const _=m}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m.Animation});var m=f(4)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m});var m=(function(){function _(b,I,p,A){this.animation=b,this.artboard=I,this.playing=A,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(b,I)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(b){this.instance.time=b},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(b){this.scrubTo===null?this.instance.advance(b):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(b){this.instance.apply(b)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>b.AudioAssetWrapper,AudioWrapper:()=>b.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>b.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>b.FileAssetWrapper,Finalizable:()=>b.Finalizable,FontAssetWrapper:()=>b.FontAssetWrapper,FontWrapper:()=>b.FontWrapper,ImageAssetWrapper:()=>b.ImageAssetWrapper,ImageWrapper:()=>b.ImageWrapper,finalizationRegistry:()=>b.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var m=f(6),_=f(7),b=f(8)}),((u,h,f)=>{f.r(h),f.d(h,{registerTouchInteractions:()=>b});var m=void 0,_=function(I,p){var A,U;return["touchstart","touchmove"].indexOf(I.type)>-1&&(!((A=I.touches)===null||A===void 0)&&A.length)?(p||I.preventDefault(),{clientX:I.touches[0].clientX,clientY:I.touches[0].clientY}):I.type==="touchend"&&(!((U=I.changedTouches)===null||U===void 0)&&U.length)?{clientX:I.changedTouches[0].clientX,clientY:I.changedTouches[0].clientY}:{clientX:I.clientX,clientY:I.clientY}},b=function(I){var p=I.canvas,A=I.artboard,U=I.stateMachines,M=U===void 0?[]:U,W=I.renderer,q=I.rive,N=I.fit,G=I.alignment,X=I.isTouchScrollEnabled,$=X===void 0?!1:X,B=I.layoutScaleFactor,oe=B===void 0?1:B;if(!p||!M.length||!W||!q||!A||typeof window>"u")return null;var ee=null,ge=!1,Q=function(me){if(ge&&me instanceof MouseEvent){me.type=="mouseup"&&(ge=!1);return}ge=$&&me.type==="touchend"&&ee==="touchstart",ee=me.type;var Te=me.currentTarget.getBoundingClientRect(),ce=_(me,$),_e=ce.clientX,pe=ce.clientY;if(!(!_e&&!pe)){var ct=_e-Te.left,Ge=pe-Te.top,qe=q.computeAlignment(N,G,{minX:0,minY:0,maxX:Te.width,maxY:Te.height},A.bounds,oe),rt=new q.Mat2D;qe.invert(rt);var lt=new q.Vec2D(ct,Ge),Re=q.mapXY(rt,lt),ae=Re.x(),Me=Re.y();switch(Re.delete(),rt.delete(),lt.delete(),qe.delete(),me.type){case"mouseout":for(var ye=0,De=M;ye<De.length;ye++){var Pe=De[ye];Pe.pointerMove(ae,Me)}break;case"touchmove":case"mouseover":case"mousemove":{for(var ke=0,Ee=M;ke<Ee.length;ke++){var Pe=Ee[ke];Pe.pointerMove(ae,Me)}break}case"touchstart":case"mousedown":{for(var he=0,ze=M;he<ze.length;he++){var Pe=ze[he];Pe.pointerDown(ae,Me)}break}case"touchend":case"mouseup":{for(var Ce=0,dt=M;Ce<dt.length;Ce++){var Pe=dt[Ce];Pe.pointerUp(ae,Me)}break}}}},te=Q.bind(m);return p.addEventListener("mouseover",te),p.addEventListener("mouseout",te),p.addEventListener("mousemove",te),p.addEventListener("mousedown",te),p.addEventListener("mouseup",te),p.addEventListener("touchmove",te,{passive:$}),p.addEventListener("touchstart",te,{passive:$}),p.addEventListener("touchend",te),function(){p.removeEventListener("mouseover",te),p.removeEventListener("mouseout",te),p.removeEventListener("mousemove",te),p.removeEventListener("mousedown",te),p.removeEventListener("mouseup",te),p.removeEventListener("touchmove",te),p.removeEventListener("touchstart",te),p.removeEventListener("touchend",te)}}}),((u,h,f)=>{f.r(h),f.d(h,{BLANK_URL:()=>U,sanitizeUrl:()=>q});var m=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,b=/&(newline|tab);/gi,I=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,A=[".","/"],U="about:blank";function M(N){return A.indexOf(N[0])>-1}function W(N){var G=N.replace(I,"");return G.replace(_,function(X,$){return String.fromCharCode($)})}function q(N){if(!N)return U;var G=W(N).replace(b,"").replace(I,"").trim();if(!G)return U;if(M(G))return G;var X=G.match(p);if(!X)return G;var $=X[0];return m.test($)?U:G}}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>W,AudioWrapper:()=>I,CustomFileAssetLoaderWrapper:()=>A,FileAssetWrapper:()=>U,Finalizable:()=>_,FontAssetWrapper:()=>q,FontWrapper:()=>p,ImageAssetWrapper:()=>M,ImageWrapper:()=>b,finalizationRegistry:()=>X});var m=(function(){var $=function(B,oe){return $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ee,ge){ee.__proto__=ge}||function(ee,ge){for(var Q in ge)Object.prototype.hasOwnProperty.call(ge,Q)&&(ee[Q]=ge[Q])},$(B,oe)};return function(B,oe){if(typeof oe!="function"&&oe!==null)throw new TypeError("Class extends value "+String(oe)+" is not a constructor or null");$(B,oe);function ee(){this.constructor=B}B.prototype=oe===null?Object.create(oe):(ee.prototype=oe.prototype,new ee)}})(),_=(function(){function $(){this.selfUnref=!1}return $})(),b=(function($){m(B,$);function B(oe){var ee=$.call(this)||this;return ee._nativeImage=oe,ee}return Object.defineProperty(B.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},B})(_),I=(function($){m(B,$);function B(oe){var ee=$.call(this)||this;return ee._nativeAudio=oe,ee}return Object.defineProperty(B.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},B})(_),p=(function($){m(B,$);function B(oe){var ee=$.call(this)||this;return ee._nativeFont=oe,ee}return Object.defineProperty(B.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},B})(_),A=(function(){function $(B,oe){this._assetLoaderCallback=oe,this.assetLoader=new B.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return $.prototype.loadContents=function(B,oe){var ee;return B.isImage?ee=new M(B):B.isAudio?ee=new W(B):B.isFont&&(ee=new q(B)),this._assetLoaderCallback(ee,oe)},$})(),U=(function(){function $(B){this._nativeFileAsset=B}return $.prototype.decode=function(B){this._nativeFileAsset.decode(B)},Object.defineProperty($.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),$})(),M=(function($){m(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setRenderImage=function(oe){this._nativeFileAsset.setRenderImage(oe.nativeImage)},B})(U),W=(function($){m(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setAudioSource=function(oe){this._nativeFileAsset.setAudioSource(oe.nativeAudio)},B})(U),q=(function($){m(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setFont=function(oe){this._nativeFileAsset.setFont(oe.nativeFont)},B})(U),N=(function(){function $(B){}return $.prototype.register=function(B){B.selfUnref=!0},$.prototype.unregister=function(B){},$})(),G=typeof FinalizationRegistry<"u"?FinalizationRegistry:N,X=new G(function($){$.unref()})})],n={};function s(u){var h=n[u];if(h!==void 0)return h.exports;var f=n[u]={exports:{}};return t[u](f,f.exports,s),f.exports}s.d=(u,h)=>{for(var f in h)s.o(h,f)&&!s.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},s.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>q,DataEnum:()=>Me,EventType:()=>Q,Fit:()=>W,Layout:()=>N,LoopType:()=>te,Rive:()=>Re,RiveEventType:()=>B,RiveFile:()=>lt,RuntimeLoader:()=>G,StateMachineInput:()=>$,StateMachineInputType:()=>X,Testing:()=>qt,ViewModel:()=>ae,ViewModelInstance:()=>De,ViewModelInstanceArtboard:()=>ut,ViewModelInstanceAssetImage:()=>at,ViewModelInstanceBoolean:()=>he,ViewModelInstanceColor:()=>st,ViewModelInstanceEnum:()=>Ce,ViewModelInstanceList:()=>dt,ViewModelInstanceNumber:()=>Ee,ViewModelInstanceString:()=>ke,ViewModelInstanceTrigger:()=>ze,ViewModelInstanceValue:()=>Pe,decodeAudio:()=>Zt,decodeFont:()=>Ct,decodeImage:()=>nr});var u=s(1),h=s(2),f=s(3),m=s(5),_=(function(){var g=function(o,d){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,C){w.__proto__=C}||function(w,C){for(var S in C)Object.prototype.hasOwnProperty.call(C,S)&&(w[S]=C[S])},g(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");g(o,d);function w(){this.constructor=o}o.prototype=d===null?Object.create(d):(w.prototype=d.prototype,new w)}})(),b=function(){return b=Object.assign||function(g){for(var o,d=1,w=arguments.length;d<w;d++){o=arguments[d];for(var C in o)Object.prototype.hasOwnProperty.call(o,C)&&(g[C]=o[C])}return g},b.apply(this,arguments)},I=function(g,o,d,w){function C(S){return S instanceof d?S:new d(function(T){T(S)})}return new(d||(d=Promise))(function(S,T){function L(se){try{H(w.next(se))}catch(de){T(de)}}function z(se){try{H(w.throw(se))}catch(de){T(de)}}function H(se){se.done?S(se.value):C(se.value).then(L,z)}H((w=w.apply(g,o||[])).next())})},p=function(g,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},w,C,S,T=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return T.next=L(0),T.throw=L(1),T.return=L(2),typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function L(H){return function(se){return z([H,se])}}function z(H){if(w)throw new TypeError("Generator is already executing.");for(;T&&(T=0,H[0]&&(d=0)),d;)try{if(w=1,C&&(S=H[0]&2?C.return:H[0]?C.throw||((S=C.return)&&S.call(C),0):C.next)&&!(S=S.call(C,H[1])).done)return S;switch(C=0,S&&(H=[H[0]&2,S.value]),H[0]){case 0:case 1:S=H;break;case 4:return d.label++,{value:H[1],done:!1};case 5:d.label++,C=H[1],H=[0];continue;case 7:H=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(H[0]===6||H[0]===2)){d=0;continue}if(H[0]===3&&(!S||H[1]>S[0]&&H[1]<S[3])){d.label=H[1];break}if(H[0]===6&&d.label<S[1]){d.label=S[1],S=H;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(H);break}S[2]&&d.ops.pop(),d.trys.pop();continue}H=o.call(g,d)}catch(se){H=[6,se],C=0}finally{w=S=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},A=function(g,o,d){if(d||arguments.length===2)for(var w=0,C=o.length,S;w<C;w++)(S||!(w in o))&&(S||(S=Array.prototype.slice.call(o,0,w)),S[w]=o[w]);return g.concat(S||Array.prototype.slice.call(o))},U=(function(g){_(o,g);function o(){var d=g!==null&&g.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),M=function(g){return g&&g.isHandledError?g.message:"Problem loading file; may be corrupt!"},W;(function(g){g.Cover="cover",g.Contain="contain",g.Fill="fill",g.FitWidth="fitWidth",g.FitHeight="fitHeight",g.None="none",g.ScaleDown="scaleDown",g.Layout="layout"})(W||(W={}));var q;(function(g){g.Center="center",g.TopLeft="topLeft",g.TopCenter="topCenter",g.TopRight="topRight",g.CenterLeft="centerLeft",g.CenterRight="centerRight",g.BottomLeft="bottomLeft",g.BottomCenter="bottomCenter",g.BottomRight="bottomRight"})(q||(q={}));var N=(function(){function g(o){var d,w,C,S,T,L,z;this.fit=(d=o?.fit)!==null&&d!==void 0?d:W.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:q.Center,this.layoutScaleFactor=(C=o?.layoutScaleFactor)!==null&&C!==void 0?C:1,this.minX=(S=o?.minX)!==null&&S!==void 0?S:0,this.minY=(T=o?.minY)!==null&&T!==void 0?T:0,this.maxX=(L=o?.maxX)!==null&&L!==void 0?L:0,this.maxY=(z=o?.maxY)!==null&&z!==void 0?z:0}return g.new=function(o){var d=o.fit,w=o.alignment,C=o.minX,S=o.minY,T=o.maxX,L=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new g({fit:d,alignment:w,minX:C,minY:S,maxX:T,maxY:L})},g.prototype.copyWith=function(o){var d=o.fit,w=o.alignment,C=o.layoutScaleFactor,S=o.minX,T=o.minY,L=o.maxX,z=o.maxY;return new g({fit:d??this.fit,alignment:w??this.alignment,layoutScaleFactor:C??this.layoutScaleFactor,minX:S??this.minX,minY:T??this.minY,maxX:L??this.maxX,maxY:z??this.maxY})},g.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===W.Cover?d=o.Fit.cover:this.fit===W.Contain?d=o.Fit.contain:this.fit===W.Fill?d=o.Fit.fill:this.fit===W.FitWidth?d=o.Fit.fitWidth:this.fit===W.FitHeight?d=o.Fit.fitHeight:this.fit===W.ScaleDown?d=o.Fit.scaleDown:this.fit===W.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},g.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===q.TopLeft?d=o.Alignment.topLeft:this.alignment===q.TopCenter?d=o.Alignment.topCenter:this.alignment===q.TopRight?d=o.Alignment.topRight:this.alignment===q.CenterLeft?d=o.Alignment.centerLeft:this.alignment===q.CenterRight?d=o.Alignment.centerRight:this.alignment===q.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===q.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===q.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},g})(),G=(function(){function g(){}return g.loadRuntime=function(){u.default({locateFile:function(){return g.wasmURL}}).then(function(o){var d;for(g.runtime=o;g.callBackQueue.length>0;)(d=g.callBackQueue.shift())===null||d===void 0||d(g.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var w="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(g.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(g.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),g.setWasmUrl(w),g.loadRuntime();else{var C=["Could not load Rive WASM file from ".concat(g.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(C)}})},g.getInstance=function(o){g.isLoading||(g.isLoading=!0,g.loadRuntime()),g.runtime?o(g.runtime):g.callBackQueue.push(o)},g.awaitInstance=function(){return new Promise(function(o){return g.getInstance(function(d){return o(d)})})},g.setWasmUrl=function(o){g.wasmURL=o},g.getWasmUrl=function(){return g.wasmURL},g.isLoading=!1,g.callBackQueue=[],g.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),g})(),X;(function(g){g[g.Number=56]="Number",g[g.Trigger=58]="Trigger",g[g.Boolean=59]="Boolean"})(X||(X={}));var $=(function(){function g(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(g.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),g.prototype.fire=function(){this.type===X.Trigger&&this.runtimeInput.fire()},g.prototype.delete=function(){this.runtimeInput=null},g})(),B;(function(g){g[g.General=128]="General",g[g.OpenUrl=131]="OpenUrl"})(B||(B={}));var oe=(function(){function g(o){this.nativeArtboard=o}return g})(),ee=(function(){function g(o,d,w,C){this.stateMachine=o,this.playing=w,this.artboard=C,this.inputs=[],this.instance=new d.StateMachineInstance(o,C),this.initInputs(d)}return Object.defineProperty(g.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),g.prototype.advance=function(o){this.instance.advance(o)},g.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},g.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},g.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},g.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var w=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(w,o))}},g.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new $(X.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new $(X.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new $(X.Trigger,o.asTrigger())},g.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},g.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},g})(),ge=(function(){function g(o,d,w,C,S){C===void 0&&(C=[]),S===void 0&&(S=[]),this.runtime=o,this.artboard=d,this.eventManager=w,this.animations=C,this.stateMachines=S}return g.prototype.add=function(o,d,w){if(w===void 0&&(w=!0),o=vt(o),o.length===0)this.animations.forEach(function(Se){return Se.playing=d}),this.stateMachines.forEach(function(Se){return Se.playing=d});else for(var C=this.animations.map(function(Se){return Se.name}),S=this.stateMachines.map(function(Se){return Se.name}),T=0;T<o.length;T++){var L=C.indexOf(o[T]),z=S.indexOf(o[T]);if(L>=0||z>=0)L>=0?this.animations[L].playing=d:this.stateMachines[z].playing=d;else{var H=this.artboard.animationByName(o[T]);if(H){var se=new f.Animation(H,this.artboard,this.runtime,d);se.advance(0),se.apply(1),this.animations.push(se)}else{var de=this.artboard.stateMachineByName(o[T]);if(de){var we=new ee(de,this.runtime,d,this.artboard);this.stateMachines.push(we)}}}}return w&&(d?this.eventManager.fire({type:Q.Play,data:this.playing}):this.eventManager.fire({type:Q.Pause,data:this.paused})),d?this.playing:this.paused},g.prototype.initLinearAnimations=function(o,d){for(var w=this.animations.map(function(z){return z.name}),C=0;C<o.length;C++){var S=w.indexOf(o[C]);if(S>=0)this.animations[S].playing=d;else{var T=this.artboard.animationByName(o[C]);if(T){var L=new f.Animation(T,this.artboard,this.runtime,d);L.advance(0),L.apply(1),this.animations.push(L)}else console.error("Animation with name ".concat(o[C]," not found."))}}},g.prototype.initStateMachines=function(o,d){for(var w=this.stateMachines.map(function(z){return z.name}),C=0;C<o.length;C++){var S=w.indexOf(o[C]);if(S>=0)this.stateMachines[S].playing=d;else{var T=this.artboard.stateMachineByName(o[C]);if(T){var L=new ee(T,this.runtime,d,this.artboard);this.stateMachines.push(L),d||L.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[C]," not found.")),this.initLinearAnimations([o[C]],d)}}},g.prototype.play=function(o){return this.add(o,!0)},g.prototype.pause=function(o){return this.add(o,!1)},g.prototype.scrub=function(o,d){var w=this.animations.filter(function(C){return o.includes(C.name)});return w.forEach(function(C){return C.scrubTo=d}),w.map(function(C){return C.name})},Object.defineProperty(g.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),g.prototype.stop=function(o){var d=this;o=vt(o);var w=[];if(o.length===0)w=this.animations.map(function(T){return T.name}).concat(this.stateMachines.map(function(T){return T.name})),this.animations.forEach(function(T){return T.cleanup()}),this.stateMachines.forEach(function(T){return T.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var C=this.animations.filter(function(T){return o.includes(T.name)});C.forEach(function(T){T.cleanup(),d.animations.splice(d.animations.indexOf(T),1)});var S=this.stateMachines.filter(function(T){return o.includes(T.name)});S.forEach(function(T){T.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(T),1)}),w=C.map(function(T){return T.name}).concat(S.map(function(T){return T.name}))}return this.eventManager.fire({type:Q.Stop,data:w}),w},Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),g.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,d)),w},g.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(C){return C.playing});o<d.length;o++){var w=d[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:Q.Loop,data:{animation:w.name,type:te.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:Q.Loop,data:{animation:w.name,type:te.PingPong}}),w.loopCount=0)}},g.prototype.handleStateChanges=function(){for(var o=[],d=0,w=this.stateMachines.filter(function(S){return S.playing});d<w.length;d++){var C=w[d];o.push.apply(o,C.statesChanged)}o.length>0&&this.eventManager.fire({type:Q.StateChange,data:o})},g.prototype.handleAdvancing=function(o){this.eventManager.fire({type:Q.Advance,data:o})},g})(),Q;(function(g){g.Load="load",g.LoadError="loaderror",g.Play="play",g.Pause="pause",g.Stop="stop",g.Loop="loop",g.Draw="draw",g.Advance="advance",g.StateChange="statechange",g.RiveEvent="riveevent",g.AudioStatusChange="audiostatuschange"})(Q||(Q={}));var te;(function(g){g.OneShot="oneshot",g.Loop="loop",g.PingPong="pingpong"})(te||(te={}));var me=(function(){function g(o){o===void 0&&(o=[]),this.listeners=o}return g.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},g.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},g.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var w=this.listeners[d];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(d,1);break}}},g.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return d.remove(w)}):this.listeners.splice(0,this.listeners.length)},g.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(w){return w.callback(o)})},g})(),Te=(function(){function g(o){this.eventManager=o,this.queue=[]}return g.prototype.add=function(o){this.queue.push(o)},g.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},g})(),ce;(function(g){g[g.AVAILABLE=0]="AVAILABLE",g[g.UNAVAILABLE=1]="UNAVAILABLE"})(ce||(ce={}));var _e=(function(g){_(o,g);function o(){var d=g!==null&&g.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=ce.UNAVAILABLE,d}return o.prototype.delay=function(d){return I(this,void 0,void 0,function(){return p(this,function(w){return[2,new Promise(function(C){return setTimeout(C,d)})]})})},o.prototype.timeout=function(){return I(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(w,C){return setTimeout(C,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:Q.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return I(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=ce.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return I(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===ce.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return I(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==ce.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,w=function(){return I(d,void 0,void 0,function(){return p(this,function(C){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return I(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===ce.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(me),pe=new _e,ct=(function(){function g(){}return g.prototype.observe=function(){},g.prototype.unobserve=function(){},g.prototype.disconnect=function(){},g})(),Ge=globalThis.ResizeObserver||ct,qe=(function(){function g(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var w=o._elementsMap.get(d.target);w!==null?w.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new Ge(this._onObserved)}return g.prototype.add=function(o,d){var w={onResize:d,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},g.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},g})(),rt=new qe,lt=(function(){function g(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new me,o.onLoad&&this.on(Q.Load,o.onLoad),o.onLoadError&&this.on(Q.LoadError,o.onLoadError)}return g.prototype.initData=function(){return I(this,void 0,void 0,function(){var o,d,w,C,S;return p(this,function(T){switch(T.label){case 0:return this.src?(o=this,[4,Dt(this.src)]):[3,2];case 1:o.buffer=T.sent(),T.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=w.assetLoader),C=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return C.file=T.sent(),this.destroyed?((S=this.file)===null||S===void 0||S.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Q.Load,data:this}):this.fireLoadError(g.fileLoadErrorMessage),[2])}})})},g.prototype.init=function(){return I(this,void 0,void 0,function(){var o,d;return p(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(g.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,G.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return d=w.sent(),this.fireLoadError(d instanceof Error?d.message:g.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},g.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:Q.LoadError,data:o}),new Error(o)},g.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},g.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},g.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},g.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},g.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new oe(d):null},g.missingErrorMessage="Rive source file or data buffer required",g.fileLoadErrorMessage="The file failed to load",g})(),Re=(function(){function g(o){var d=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(C){var S=d._hasZeroSize!==C;d._hasZeroSize=C,C?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():S&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=rt.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new N,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new me,o.onLoad&&this.on(Q.Load,o.onLoad),o.onLoadError&&this.on(Q.LoadError,o.onLoadError),o.onPlay&&this.on(Q.Play,o.onPlay),o.onPause&&this.on(Q.Pause,o.onPause),o.onStop&&this.on(Q.Stop,o.onStop),o.onLoop&&this.on(Q.Loop,o.onLoop),o.onStateChange&&this.on(Q.StateChange,o.onStateChange),o.onAdvance&&this.on(Q.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(Q.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(Q.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(Q.Play,o.onplay),o.onpause&&!o.onPause&&this.on(Q.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(Q.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(Q.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(Q.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Te(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(g.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),g.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new g(o)},g.prototype.onSystemAudioChanged=function(){this.volume=this._volume},g.prototype.init=function(o){var d=this,w=o.src,C=o.buffer,S=o.riveFile,T=o.animations,L=o.stateMachines,z=o.artboard,H=o.autoplay,se=H===void 0?!1:H,de=o.useOffscreenRenderer,we=de===void 0?!1:de,Se=o.autoBind,pt=Se===void 0?!1:Se;if(!this.destroyed){if(this.src=w,this.buffer=C,this.riveFile=S,!this.src&&!this.buffer&&!this.riveFile)throw new U(g.missingErrorMessage);var St=vt(T),We=vt(L);this.loaded=!1,this.readyForPlaying=!1,G.awaitInstance().then(function(yt){d.destroyed||(d.runtime=yt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,we),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(z,St,We,se,pt).then(function($e){if($e)return d.setupRiveListeners()}).catch(function($e){console.error($e)}))}).catch(function(yt){console.error(yt)})}},g.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(S){return S.playing&&d.runtime.hasListeners(S.instance)}).map(function(S){return S.instance}),C=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(C=o.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:C,layoutScaleFactor:this._layout.layoutScaleFactor})}},g.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},g.prototype.initializeAudio=function(){var o=this,d;pe.status==ce.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Q.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},pe.add(this._audioEventListener),pe.establishAudio())},g.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},g.prototype.initData=function(o,d,w,C,S){return I(this,void 0,void 0,function(){var T,L,z,H;return p(this,function(se){switch(se.label){case 0:return se.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(T=new lt({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=T,[4,T.init()]);case 1:if(se.sent(),this.destroyed)return T.destroyIfUnused(),[2,!1];se.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,w,C,S),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Q.Load,data:(H=this.src)!==null&&H!==void 0?H:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return L=se.sent(),z=M(L),console.warn(z),this.eventManager.fire({type:Q.LoadError,data:z}),[2,Promise.reject(z)];case 4:return[2]}})})},g.prototype.initArtboard=function(o,d,w,C,S){if(this.file){var T=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!T){var L="Invalid artboard name or no default artboard";console.warn(L),this.eventManager.fire({type:Q.LoadError,data:L});return}if(this.artboard=T,T.volume=this._volume*pe.systemVolume,this.artboard.animationCount()<1){var L="Artboard has no animations";throw this.eventManager.fire({type:Q.LoadError,data:L}),L}this.animator=new ge(this.runtime,this.artboard,this.eventManager);var z;if(d.length>0||w.length>0?(z=d.concat(w),this.animator.initLinearAnimations(d,C),this.animator.initStateMachines(w,C)):z=[this.animator.atLeastOne(C,!1)],this.taskQueue.add({event:{type:C?Q.Play:Q.Pause,data:z}}),S){var H=this.file.defaultArtboardViewModel(T);if(H!==null){var se=H.defaultInstance();if(se!==null){var de=new De(se,null);this.bindViewModelInstance(de)}}}}},g.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},g.prototype.draw=function(o,d){var w;this.frameRequestId=null;var C=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var S=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var T=this.animator.animations.filter(function(_r){return _r.playing||_r.needsScrub}).sort(function(_r){return _r.needsScrub?-1:1}),L=0,z=T;L<z.length;L++){var H=z[L];H.advance(S),H.instance.didLoop&&(H.loopCount+=1),H.apply(1)}for(var se=this.animator.stateMachines.filter(function(_r){return _r.playing}),de=0,we=se;de<we.length;de++){var Se=we[de],pt=Se.reportedEventCount();if(pt)for(var St=0;St<pt;St++){var We=Se.reportedEventAt(St);if(We)if(We.type===B.OpenUrl){if(this.eventManager.fire({type:Q.RiveEvent,data:We}),this.automaticallyHandleEvents){var yt=document.createElement("a"),$e=We,gt=$e.url,ht=$e.target,Ut=(0,m.sanitizeUrl)(gt);gt&&yt.setAttribute("href",Ut),ht&&yt.setAttribute("target",ht),Ut&&Ut!==m.BLANK_URL&&yt.click()}}else this.eventManager.fire({type:Q.RiveEvent,data:We})}Se.advanceAndApply(S)}this.animator.stateMachines.length==0&&this.artboard.advance(S);var Ie=this.renderer;Ie.clear(),Ie.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Ie),Ie.restore(),Ie.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(S),this.frameCount++;var Ze=performance.now();for(this.frameTimes.push(Ze),this.durations.push(Ze-C);this.frameTimes[0]<=Ze-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},g.prototype.alignRenderer=function(){var o=this,d=o.renderer,w=o.runtime,C=o._layout,S=o.artboard;d.align(C.runtimeFit(w),C.runtimeAlignment(w),{minX:C.minX,minY:C.minY,maxX:C.maxX,maxY:C.maxY},S.bounds,this._devicePixelRatioUsed*C.layoutScaleFactor)},Object.defineProperty(g.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),g.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&rt.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(pe.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},g.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},g.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},g.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},g.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},g.prototype.setTextRunValue=function(o,d){var w=this.retrieveTextRun(o);w&&(w.text=d)},g.prototype.play=function(o,d){var w=this;if(o=vt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},g.prototype.pause=function(o){var d=this;if(o=vt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},g.prototype.scrub=function(o,d){var w=this;if(o=vt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},g.prototype.stop=function(o){var d=this;if(o=vt(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},g.prototype.reset=function(o){var d,w,C=o?.artboard,S=vt(o?.animations),T=vt(o?.stateMachines),L=(d=o?.autoplay)!==null&&d!==void 0?d:!1,z=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(C,S,T,L,z),this.taskQueue.process()},g.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),g.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},g.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),w=d.width,C=d.height,S=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=S,this.canvas.width=S*w,this.canvas.height=S*C,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===W.Layout){var T=this._layout.layoutScaleFactor;this.artboard.width=w/T,this.artboard.height=C/T}}},Object.defineProperty(g.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),g.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(w){return w.name===o});return d?.inputs}},g.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,d);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},g.prototype.setBooleanStateAtPath=function(o,d,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===X.Boolean?C.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},g.prototype.setNumberStateAtPath=function(o,d,w){var C=this.retrieveInputAtPath(o,w);C&&(C.type===X.Number?C.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},g.prototype.fireStateAtPath=function(o,d){var w=this.retrieveInputAtPath(o,d);w&&(w.type===X.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},g.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,d);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},g.prototype.getTextRunValueAtPath=function(o,d){var w=this.retrieveTextAtPath(o,d);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w.text},g.prototype.setTextRunValueAtPath=function(o,d,w){var C=this.retrieveTextAtPath(o,w);if(!C){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}C.text=d},Object.defineProperty(g.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),g.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},g.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},g.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},g.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},g.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},g.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},g.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(g.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var w=this.file.artboardByIndex(d),C={name:w.name,animations:[],stateMachines:[]},S=0;S<w.animationCount();S++){var T=w.animationByIndex(S);C.animations.push(T.name)}for(var L=0;L<w.stateMachineCount();L++){for(var z=w.stateMachineByIndex(L),H=z.name,se=new this.runtime.StateMachineInstance(z,w),de=[],we=0;we<se.inputCount();we++){var Se=se.input(we);de.push({name:Se.name,type:Se.type})}C.stateMachines.push({name:H,inputs:de})}o.artboards.push(C)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*pe.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),g.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(g.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),g.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(g.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),g.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new ae(d):null},g.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new ae(d):null},g.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new Me(d)})}return this._dataEnums},g.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new ae(o)}return null},g.prototype.getArtboard=function(o){var d,w;return(w=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&w!==void 0?w:null},g.missingErrorMessage="Rive source file or data buffer required",g.cleanupErrorMessage="Attempt to use file after calling cleanup.",g})(),ae=(function(){function g(o){this._viewModel=o}return Object.defineProperty(g.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),g.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new De(d,null):null},g.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new De(d,null):null},g.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new De(o,null):null},g.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new De(o,null):null},Object.defineProperty(g.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),g})(),Me=(function(){function g(o){this._dataEnum=o}return Object.defineProperty(g.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),g})(),ye;(function(g){g.Number="number",g.String="string",g.Boolean="boolean",g.Color="color",g.Trigger="trigger",g.Enum="enum",g.List="list",g.Image="image",g.Artboard="artboard"})(ye||(ye={}));var De=(function(){function g(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(g.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),g.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},g.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},g.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var w=this._parents[d];w.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},g.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},g.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},g.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},g.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},g.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},g.prototype.propertyFromPath=function(o,d){var w=o.split("/");return this.propertyFromPathSegments(w,0,d)},g.prototype.viewModelFromPathSegments=function(o,d){var w=this.internalViewModelInstance(o[d]);return w!==null?d==o.length-1?w:w.viewModelFromPathSegments(o,d++):null},g.prototype.propertyFromPathSegments=function(o,d,w){var C,S,T,L,z,H,se,de,we,Se,pt,St,We,yt,$e,gt,ht,Ut;if(d<o.length-1){var Ie=this.internalViewModelInstance(o[d]);return Ie!==null?Ie.propertyFromPathSegments(o,d+1,w):null}var Ze=null;switch(w){case ye.Number:if(Ze=(S=(C=this._runtimeInstance)===null||C===void 0?void 0:C.number(o[d]))!==null&&S!==void 0?S:null,Ze!==null)return new Ee(Ze,this);break;case ye.String:if(Ze=(L=(T=this._runtimeInstance)===null||T===void 0?void 0:T.string(o[d]))!==null&&L!==void 0?L:null,Ze!==null)return new ke(Ze,this);break;case ye.Boolean:if(Ze=(H=(z=this._runtimeInstance)===null||z===void 0?void 0:z.boolean(o[d]))!==null&&H!==void 0?H:null,Ze!==null)return new he(Ze,this);break;case ye.Color:if(Ze=(de=(se=this._runtimeInstance)===null||se===void 0?void 0:se.color(o[d]))!==null&&de!==void 0?de:null,Ze!==null)return new st(Ze,this);break;case ye.Trigger:if(Ze=(Se=(we=this._runtimeInstance)===null||we===void 0?void 0:we.trigger(o[d]))!==null&&Se!==void 0?Se:null,Ze!==null)return new ze(Ze,this);break;case ye.Enum:if(Ze=(St=(pt=this._runtimeInstance)===null||pt===void 0?void 0:pt.enum(o[d]))!==null&&St!==void 0?St:null,Ze!==null)return new Ce(Ze,this);break;case ye.List:if(Ze=(yt=(We=this._runtimeInstance)===null||We===void 0?void 0:We.list(o[d]))!==null&&yt!==void 0?yt:null,Ze!==null)return new dt(Ze,this);break;case ye.Image:if(Ze=(gt=($e=this._runtimeInstance)===null||$e===void 0?void 0:$e.image(o[d]))!==null&&gt!==void 0?gt:null,Ze!==null)return new at(Ze,this);break;case ye.Artboard:if(Ze=(Ut=(ht=this._runtimeInstance)===null||ht===void 0?void 0:ht.artboard(o[d]))!==null&&Ut!==void 0?Ut:null,Ze!==null)return new ut(Ze,this);break}return null},g.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(w!==null){var C=new g(w,this);return C.internalIncrementReferenceCount(),this._viewModelInstances.set(o,C),C}return null},g.prototype.number=function(o){var d=this.propertyFromPath(o,ye.Number);return d},g.prototype.string=function(o){var d=this.propertyFromPath(o,ye.String);return d},g.prototype.boolean=function(o){var d=this.propertyFromPath(o,ye.Boolean);return d},g.prototype.color=function(o){var d=this.propertyFromPath(o,ye.Color);return d},g.prototype.trigger=function(o){var d=this.propertyFromPath(o,ye.Trigger);return d},g.prototype.enum=function(o){var d=this.propertyFromPath(o,ye.Enum);return d},g.prototype.list=function(o){var d=this.propertyFromPath(o,ye.List);return d},g.prototype.image=function(o){var d=this.propertyFromPath(o,ye.Image);return d},g.prototype.artboard=function(o){var d=this.propertyFromPath(o,ye.Artboard);return d},g.prototype.viewModel=function(o){var d=o.split("/"),w=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return w!=null?w.internalViewModelInstance(d[d.length-1]):null},g.prototype.internalReplaceViewModel=function(o,d){var w;if(d.runtimeInstance!==null){var C=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,d.runtimeInstance))||!1;if(C){d.internalIncrementReferenceCount();var S=this.internalViewModelInstance(o);S!==null&&(S.removeParent(this),this._children.includes(S)&&(this._children=this._children.filter(function(T){return T!==S})),S.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return C}return!1},g.prototype.replaceViewModel=function(o,d){var w,C=o.split("/"),S=C.length>1?this.viewModelFromPathSegments(C.slice(0,C.length-1),0):this;return(w=S?.internalReplaceViewModel(C[C.length-1],d))!==null&&w!==void 0?w:!1},g.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},g.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(g.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return b({},d)}))||[]},enumerable:!1,configurable:!0}),g.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},g.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(C){C.cleanup()}),this._viewModelInstances.clear();var d=A([],this._children,!0);this._children.length=0;var w=A([],this._parents,!0);this._parents.length=0,d.forEach(function(C){C.removeParent(o)}),w.forEach(function(C){C.removeFromViewModelCallbacks(o)})}},g})(),Pe=(function(){function g(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return g.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},g.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},g.prototype.internalHandleCallback=function(o){},g.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},g.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},g.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),g})(),ke=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Pe),Ee=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Pe),he=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Pe),ze=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(Pe),Ce=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Pe),dt=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,w){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,w)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var w=this._viewModelInstanceValue.instanceAt(d);if(w!=null){var C=new De(w,this._parentViewModel);return C}return null},o.prototype.swap=function(d,w){this._viewModelInstanceValue.swap(d,w)},o.prototype.internalHandleCallback=function(d){d()},o})(Pe),st=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,w,C){this._viewModelInstanceValue.rgb(d,w,C)},o.prototype.rgba=function(d,w,C,S){this._viewModelInstanceValue.argb(S,d,w,C)},o.prototype.argb=function(d,w,C,S){this._viewModelInstanceValue.argb(d,w,C,S)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Pe),at=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Pe),ut=(function(g){_(o,g);function o(d,w){return g.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Pe),Dt=function(g){return I(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(C){switch(C.label){case 0:return o=new Request(g),[4,fetch(o)];case 1:return d=C.sent(),[4,d.arrayBuffer()];case 2:return w=C.sent(),[2,w]}})})},vt=function(g){return typeof g=="string"?[g]:g instanceof Array?g:[]},qt={EventManager:me,TaskQueueManager:Te},Zt=function(g){return I(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(C){switch(C.label){case 0:return o=new Promise(function(S){return G.getInstance(function(T){T.decodeAudio(g,S)})}),[4,o];case 1:return d=C.sent(),w=new m.AudioWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},nr=function(g){return I(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(C){switch(C.label){case 0:return o=new Promise(function(S){return G.getInstance(function(T){T.decodeImage(g,S)})}),[4,o];case 1:return d=C.sent(),w=new m.ImageWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})},Ct=function(g){return I(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(C){switch(C.label){case 0:return o=new Promise(function(S){return G.getInstance(function(T){T.decodeFont(g,S)})}),[4,o];case 1:return d=C.sent(),w=new m.FontWrapper(d),m.finalizationRegistry.register(w,d),[2,w]}})})}})(),l})())})(ls)),ls.exports}var Vv=Wv();const Ru="dracula",ms="https://vycjpmuyscfygstjjied.supabase.co";var qv=ne('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Al(r,e){Wt(e,!0);let t=fn(e,"bucketName",3,Ru),n=ft(void 0);Is(()=>{if(!E(n))return;const u=new Vv.Rive({src:`${ms}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:E(n),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var s=qv(),l=x(s);fa(l,u=>Oe(n,u),()=>E(n)),K(r,s),Vt()}function zv(r,e,t,n,s,l){e()?t.onLose?t.onLose():n("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var Hv=ne('<button class="btn btn-danger svelte-43z9sr">🏳️ Сдаться</button>'),Gv=ne('<div class="item-icon svelte-43z9sr"><img class="icon-preview svelte-43z9sr" height="64px"/></div>'),Kv=ne('<div id="reward-panel" class="svelte-43z9sr"><!> <div class="reward-info svelte-43z9sr"><div class="reward-label svelte-43z9sr">Награда:</div> <div class="reward-name svelte-43z9sr"> </div></div></div>'),Yv=ne('<span class="cooldown-timer svelte-43z9sr"> </span>'),Jv=ne('<div role="button" tabindex="0"> </div>'),Xv=md('<polyline class="connection-line svelte-43z9sr" vector-effect="non-scaling-stroke"></polyline>'),Qv=ne("<button> </button>"),Zv=ne('<div id="modal-overlay"><div class="modal-content svelte-43z9sr"><div class="modal-title svelte-43z9sr"> </div> <div class="modal-text svelte-43z9sr"> </div> <div class="modal-buttons svelte-43z9sr"></div></div></div>'),ep=ne('<div class="body-wrapper svelte-43z9sr"><div id="game-header" class="svelte-43z9sr"><button class="btn btn-secondary svelte-43z9sr">🔄 Новая игра</button> <!></div> <!> <div id="game-header" class="svelte-43z9sr"><span class="tiles-counter svelte-43z9sr">Осталось: <strong class="svelte-43z9sr"> </strong></span> <button>💡 Подсказка <!></button></div> <div id="game-container" class="svelte-43z9sr"><div id="grid" class="svelte-43z9sr"></div> <svg id="line-layer" class="svelte-43z9sr"><!></svg></div></div> <!>',1);function tp(r,e){Wt(e,!0);let t=fn(e,"integrated",3,!1),n=fn(e,"rewardItem",3,null),s=fn(e,"items",19,()=>[]),l=fn(e,"bucketName",3,"dracula");const u=jd(),h=8,f=6,m=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=ft(Gt([])),b=ft(Gt([])),I=ft(Gt({})),p=ft(Gt([])),A=ft(null),U=ft(!1),M=ft(!1),W=ft(Gt([])),q=ft(0),N=ft(0);const G=5;let X=ft(Gt({show:!1,title:"",text:"",actions:[]})),$,B;Is(()=>{me()});function oe(){if(!E(b)||E(b).length===0)return 0;let S=0;for(let T=0;T<h;T++)for(let L=0;L<f;L++)E(b)[T]&&!E(b)[T][L]&&S++;return S}let ee=Vn(oe),ge=Vn(()=>E(N)===0);function Q(){if(!n()||!s()||s().length===0)return null;const S=typeof n()=="string"?n():n().id;return s().find(T=>T.id===S)}let te=Vn(Q);function me(){Oe(_,[],!0),Oe(b,[],!0),Oe(A,null),Oe(U,!1),Oe(M,!1),Oe(I,{},!0),Oe(p,[],!0),Oe(W,[],!0),Oe(N,0),ye();let S=[...new Set(m)];for(;S.length<h*f/2;)S=[...S,...S];let T=S.sort(()=>.5-Math.random()).slice(0,h*f/2),L=[];T.forEach(H=>L.push(H,H)),L.sort(()=>Math.random()-.5);let z=0;for(let H=0;H<h;H++){let se=[],de=[];for(let we=0;we<f;we++)se.push(L[z++]),de.push(!1);E(_).push(se),E(b).push(de)}setTimeout(ct,500)}async function Te(S,T){if(E(U)||E(b)[S][T]||E(M))return;if(E(p).length>0&&Oe(p,[],!0),!E(A)){Oe(A,{r:S,c:T},!0);return}if(E(A).r===S&&E(A).c===T){Oe(A,null);return}const L=E(_)[E(A).r][E(A).c],z=E(_)[S][T];if(L===z){const H=Re(E(A).r,E(A).c,S,T);if(H){Oe(U,!0),await ae(H),E(b)[E(A).r][E(A).c]=!0,E(b)[S][T]=!0,Oe(A,null),Oe(U,!1),_e(),ct();return}}Oe(A,{r:S,c:T},!0)}async function ce(S,T,L){(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),await Te(S,T))}function _e(){Oe(N,G);const S=setInterval(()=>{Wo(N,-1),E(N)<=0&&clearInterval(S)},1e3)}function pe(){if(E(U)||E(M)||!E(ge))return;let S=[];for(let L=0;L<h;L++)for(let z=0;z<f;z++)E(b)[L][z]||S.push({r:L,c:z,icon:E(_)[L][z]});let T={};S.forEach(L=>{T[L.icon]||(T[L.icon]=[]),T[L.icon].push(L)});for(let L in T){let z=T[L];if(!(z.length<2))for(let H=0;H<z.length;H++)for(let se=H+1;se<z.length;se++){let de=z[H],we=z[se];if(Re(de.r,de.c,we.r,we.c)){Oe(p,[de,we],!0),setTimeout(()=>Oe(p,[],!0),1500);return}}}Me("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:ye}])}function ct(){if(E(ee)===0){Oe(M,!0),t()?e.onWin?e.onWin():u("win"):Me("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:me}]);return}Ge()||(t()?setTimeout(()=>qe(),1e3):Me("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ye(),qe()}},{text:"Сдаться",action:()=>{Me("Конец","Попытайте удачу снова!",[{text:"ОК",action:me}])}}]))}function Ge(){let S=[];for(let L=0;L<h;L++)for(let z=0;z<f;z++)E(b)[L][z]||S.push({r:L,c:z,icon:E(_)[L][z]});let T={};S.forEach(L=>{T[L.icon]||(T[L.icon]=[]),T[L.icon].push(L)});for(let L in T){let z=T[L];if(!(z.length<2)){for(let H=0;H<z.length;H++)for(let se=H+1;se<z.length;se++)if(Re(z[H].r,z[H].c,z[se].r,z[se].c))return!0}}return!1}function qe(){let S=[],T=[];for(let L=0;L<h;L++)for(let z=0;z<f;z++)E(b)[L][z]||(S.push(E(_)[L][z]),T.push({r:L,c:z}));S.length!==0&&(S.sort(()=>Math.random()-.5),T.forEach((L,z)=>{E(_)[L.r][L.c]=S[z],E(I)[`${L.r},${L.c}`]=!0}),setTimeout(()=>{Oe(I,{},!0),Ge()?Oe(M,!1):qe()},500))}function rt(S,T){return S<0||S>=h||T<0||T>=f?!0:E(b)[S][T]}function lt(S,T,L,z){if(S!==L&&T!==z)return!1;if(S===L){const H=Math.min(T,z),se=Math.max(T,z);for(let de=H+1;de<se;de++)if(!rt(S,de))return!1}else{const H=Math.min(S,L),se=Math.max(S,L);for(let de=H+1;de<se;de++)if(!rt(de,T))return!1}return!0}function Re(S,T,L,z){if(lt(S,T,L,z))return[{r:S,c:T},{r:L,c:z}];let H={r:S,c:z};if(rt(H.r,H.c)&&lt(S,T,H.r,H.c)&&lt(H.r,H.c,L,z))return[{r:S,c:T},H,{r:L,c:z}];let se={r:L,c:T};if(rt(se.r,se.c)&&lt(S,T,se.r,se.c)&&lt(se.r,se.c,L,z))return[{r:S,c:T},se,{r:L,c:z}];for(let de=-1;de<=h;de++){if(de===S||de===L)continue;let we={r:de,c:T},Se={r:de,c:z};if(rt(we.r,we.c)&&rt(Se.r,Se.c)&&lt(S,T,we.r,we.c)&&lt(we.r,we.c,Se.r,Se.c)&&lt(Se.r,Se.c,L,z))return[{r:S,c:T},we,Se,{r:L,c:z}]}for(let de=-1;de<=f;de++){if(de===T||de===z)continue;let we={r:S,c:de},Se={r:L,c:de};if(rt(we.r,we.c)&&rt(Se.r,Se.c)&&lt(S,T,we.r,we.c)&&lt(we.r,we.c,Se.r,Se.c)&&lt(Se.r,Se.c,L,z))return[{r:S,c:T},we,Se,{r:L,c:z}]}return null}async function ae(S){if(await ou(),!$||!B)return;const T=$.getBoundingClientRect(),L=B.getBoundingClientRect(),z=B.querySelector(".cell");if(!z)return;const H=z.offsetWidth,se=z.offsetHeight,de=window.getComputedStyle(B),we=parseFloat(de.gap)||4,Se=L.left-T.left,pt=L.top-T.top,St=S.map(We=>{let yt,$e;if(We.r>=0&&We.r<h&&We.c>=0&&We.c<f){const ht=B.children[We.r*f+We.c].getBoundingClientRect();yt=ht.left-T.left+ht.width/2,$e=ht.top-T.top+ht.height/2}else{const gt=We.c*(H+we)+H/2,ht=We.r*(se+we)+se/2;yt=Se+gt,$e=pt+ht}return`${yt.toFixed(1)},${$e.toFixed(1)}`}).join(" ");return Oe(W,St,!0),Wo(q),new Promise(We=>{setTimeout(()=>{Oe(W,[],!0),We()},350)})}function Me(S,T,L){t()||Oe(X,{show:!0,title:S,text:T,actions:L},!0)}function ye(){E(X).show=!1}var De=ep(),Pe=xt(De),ke=x(Pe),Ee=x(ke);Ee.__click=me;var he=F(Ee,2);{var ze=S=>{var T=Hv();T.__click=[zv,t,e,u,Me,me],K(S,T)};je(he,S=>{t()&&S(ze)})}var Ce=F(ke,2);{var dt=S=>{var T=Kv(),L=x(T);{var z=we=>{var Se=Gv(),pt=x(Se);be(()=>{xe(pt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${E(te).icon}`),xe(pt,"alt",E(te).name)}),K(we,Se)};je(L,we=>{E(te).icon&&we(z)})}var H=F(L,2),se=F(x(H),2),de=x(se);be(()=>Ae(de,E(te).name)),K(S,T)};je(Ce,S=>{E(te)&&S(dt)})}var st=F(Ce,2),at=x(st),ut=F(x(at)),Dt=x(ut),vt=F(at,2);let qt;vt.__click=pe;var Zt=F(x(vt));{var nr=S=>{var T=Yv(),L=x(T);be(()=>Ae(L,`(${E(N)??""})`)),K(S,T)};je(Zt,S=>{E(N)>0&&S(nr)})}var Ct=F(st,2),g=x(Ct);Id(g,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),Et(g,21,()=>E(_),Ft,(S,T,L)=>{var z=Jt(),H=xt(z);Et(H,17,()=>E(T),Ft,(se,de,we)=>{var Se=Jv();let pt;Se.__click=()=>Te(L,we),Se.__keydown=We=>ce(L,we,We);var St=x(Se);be(We=>{pt=or(Se,1,"cell svelte-43z9sr",null,pt,We),Ae(St,E(de))},[()=>({selected:E(A)?.r===L&&E(A)?.c===we,matched:E(b)[L][we],shuffling:E(I)[`${L},${we}`],"hint-glow":E(p).some(We=>We.r===L&&We.c===we)})]),K(se,Se)}),K(S,z)}),fa(g,S=>B=S,()=>B);var o=F(g,2),d=x(o);da(d,()=>E(q),S=>{var T=Jt(),L=xt(T);{var z=H=>{var se=Xv();be(()=>xe(se,"points",E(W))),K(H,se)};je(L,H=>{E(W)&&H(z)})}K(S,T)}),fa(Ct,S=>$=S,()=>$);var w=F(Pe,2);{var C=S=>{var T=Zv();let L;var z=x(T),H=x(z),se=x(H),de=F(H,2),we=x(de),Se=F(de,2);Et(Se,21,()=>E(X).actions,pt=>pt.text,(pt,St)=>{var We=Qv();let yt;We.__click=function(...gt){E(St).action?.apply(this,gt)};var $e=x(We);be(gt=>{yt=or(We,1,"btn svelte-43z9sr",null,yt,gt),Ae($e,E(St).text)},[()=>({"btn-secondary":E(St).class==="btn-secondary"})]),K(pt,We)}),be(pt=>{L=or(T,1,"svelte-43z9sr",null,L,pt),Ae(se,E(X).title),Ae(we,E(X).text)},[()=>({active:E(X).show})]),K(S,T)};je(w,S=>{E(X).show&&S(C)})}be(S=>{Ae(Dt,E(ee)),qt=or(vt,1,"btn btn-secondary svelte-43z9sr",null,qt,S),vt.disabled=!E(ge)},[()=>({disabled:!E(ge),"cooldown-active":E(N)>0})]),K(r,De),Vt()}Qt(["click","keydown"]);var rp=ne('<div class="loading svelte-15dde84">Загрузка игры...</div>'),np=ne('<div class="minigame-container svelte-15dde84"><!></div>');function ip(r,e){Wt(e,!0);function t(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function n(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var s=np(),l=x(s);{var u=f=>{tp(f,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},bucketName:"minigames"})},h=f=>{var m=rp();K(f,m)};je(l,f=>{e.gameId==="onet_monsters"?f(u):f(h,!1)})}K(r,s),Vt()}function sp(r,e){E(e)?.nextDialogueId&&kt.goToDialogue(E(e).nextDialogueId)}var ap=ne('<img alt="BG" class="background-image svelte-dd9wj5"/>'),op=ne('<div class="background-media svelte-dd9wj5"><!></div>'),lp=ne('<img alt="Char" class="character-image svelte-dd9wj5"/>'),up=ne('<div class="character-media svelte-dd9wj5"><!></div>'),cp=(r,e,t)=>e(E(t)),dp=ne('<button class="option-button svelte-dd9wj5"> </button>'),hp=ne('<div class="options-container svelte-dd9wj5"></div>'),fp=ne('<div class="next-container svelte-dd9wj5"><button class="next-button svelte-dd9wj5">Далее...</button></div>'),vp=ne('<div class="dialogue-container svelte-dd9wj5"><!> <!> <!> <div class="dialogue-content svelte-dd9wj5"><div class="dialogue-text svelte-dd9wj5"> </div> <!></div></div>'),pp=ne("<p> </p>");function Ou(r,e){Wt(e,!0);let t=fn(e,"bucketName",3,Ru);console.log(t());const n=Vn(()=>e.dialogue||kt.findDialogue(kt.currentDialogueId));let s=ft(null);Xn(()=>{E(n)?.onEnter&&kt.runActions(E(n).onEnter)});function l(p){if(p.actions&&kt.runActions(p.actions),p.miniGame){console.log("Запуск мини-игры:",p.miniGame.id),Oe(s,{gameId:p.miniGame.id,onWinDialogueId:p.miniGame.onWinDialogueId,onLoseDialogueId:p.miniGame.onLoseDialogueId,rewardItem:p.miniGame.rewardItem},!0);return}p.nextDialogueId&&kt.goToDialogue(p.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),E(s)?.rewardItem&&kt.addItem(E(s).rewardItem),E(s)?.onWinDialogueId&&kt.goToDialogue(E(s).onWinDialogueId),Oe(s,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),E(s)?.onLoseDialogueId&&kt.goToDialogue(E(s).onLoseDialogueId),Oe(s,null)}function f(p){return p.visibleIf&&p.visibleIf.hasItem?kt.hasItem(p.visibleIf.hasItem):!0}var m=Jt(),_=xt(m);{var b=p=>{var A=vp(),U=x(A);{var M=Q=>{{let te=Vn(()=>kt.storyData?.items);ip(Q,{get gameId(){return E(s).gameId},onWin:u,onLose:h,get rewardItem(){return E(s).rewardItem},get items(){return E(te)}})}};je(U,Q=>{E(s)&&Q(M)})}var W=F(U,2);{var q=Q=>{var te=op(),me=x(te);{var Te=_e=>{var pe=Jt(),ct=xt(pe);da(ct,()=>E(n).backgroundImage,Ge=>{Al(Ge,{get fileName(){return E(n).backgroundImage},get bucketName(){return t()}})}),K(_e,pe)},ce=_e=>{var pe=ap();be(()=>xe(pe,"src",`${ms}/storage/v1/object/public/${t()}/${E(n).backgroundImage}`)),K(_e,pe)};je(me,_e=>{E(n).backgroundImage.endsWith(".riv")?_e(Te):_e(ce,!1)})}K(Q,te)};je(W,Q=>{E(n).backgroundImage&&Q(q)})}var N=F(W,2);{var G=Q=>{var te=up(),me=x(te);{var Te=_e=>{var pe=Jt(),ct=xt(pe);da(ct,()=>E(n).characterImage,Ge=>{Al(Ge,{get fileName(){return E(n).characterImage},get bucketName(){return t()}})}),K(_e,pe)},ce=_e=>{var pe=lp();be(()=>xe(pe,"src",`${ms}/storage/v1/object/public/${t()}/${E(n).characterImage}`)),K(_e,pe)};je(me,_e=>{E(n).characterImage.endsWith(".riv")?_e(Te):_e(ce,!1)})}K(Q,te)};je(N,Q=>{E(n).characterImage&&Q(G)})}var X=F(N,2),$=x(X),B=x($),oe=F($,2);{var ee=Q=>{var te=hp();Et(te,21,()=>E(n).options,me=>me.text,(me,Te)=>{var ce=Jt(),_e=xt(ce);{var pe=ct=>{var Ge=dp();Ge.__click=[cp,l,Te];var qe=x(Ge);be(()=>Ae(qe,E(Te).text)),K(ct,Ge)};je(_e,ct=>{f(E(Te))&&ct(pe)})}K(me,ce)}),K(Q,te)},ge=Q=>{var te=Jt(),me=xt(te);{var Te=ce=>{var _e=fp(),pe=x(_e);pe.__click=[sp,n],K(ce,_e)};je(me,ce=>{E(n).nextDialogueId&&ce(Te)},!0)}K(Q,te)};je(oe,Q=>{E(n).options&&E(n).options.length>0?Q(ee):Q(ge,!1)})}be(()=>Ae(B,E(n).text)),K(p,A)},I=p=>{var A=pp(),U=x(A);be(()=>Ae(U,`Диалог не найден (ID: ${kt.currentDialogueId??""})`)),K(p,A)};je(_,p=>{E(n)?p(b):p(I,!1)})}K(r,m),Vt()}Qt(["click"]);var na=Qr(()=>O),gp=ne('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),mp=ne('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),_p=ne('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),yp=ne('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),wp=ne('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),bp=ne('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),kp=ne('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function Ep(r,e){Wt(e,!1);function t(){na(na().editingOptionIndex=null)}Xr();var n=kp(),s=x(n),l=F(x(s),2);l.__click=t;var u=F(s,2),h=x(u);{var f=_=>{var b=wp(),I=x(b);{let te=ni(()=>na().selectedBucket||void 0);Ou(I,{get dialogue(){return Lt.currentDialogue},index:0,get bucketName(){return E(te)}})}var p=F(I,2),A=x(p),U=F(x(A),2),M=x(U),W=F(A,2),q=F(x(W),2),N=x(q),G=F(W,2);{var X=te=>{var me=gp(),Te=F(x(me),2),ce=x(Te);be(()=>Ae(ce,Lt.currentDialogue.backgroundImage)),K(te,me)};je(G,te=>{Lt.currentDialogue.backgroundImage&&te(X)})}var $=F(G,2);{var B=te=>{var me=mp(),Te=F(x(me),2),ce=x(Te);be(()=>Ae(ce,Lt.currentDialogue.characterImage)),K(te,me)};je($,te=>{Lt.currentDialogue.characterImage&&te(B)})}var oe=F(p,2);{var ee=te=>{var me=_p();K(te,me)};je(oe,te=>{(!Lt.currentDialogue.options||Lt.currentDialogue.options.length===0)&&te(ee)})}var ge=F(oe,2);{var Q=te=>{var me=yp();K(te,me)};je(ge,te=>{Lt.currentDialogue.options?.some(me=>!me.nextDialogueId)&&te(Q)})}be(()=>{Ae(M,Lt.currentDialogue.id),Ae(N,Lt.currentChapter?.title||"Без главы")}),K(_,b)},m=_=>{var b=bp();K(_,b)};je(h,_=>{Lt.currentDialogue?_(f):_(m,!1)})}K(r,n),Vt()}Qt(["click"]);const Sp=["dracula","zombie","fairy_tale","minigames"];function Mu(){const r=Sp.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return it.updateBucketsList(r),r}var un=Qr(()=>O),Ip=ne('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),Ap=(r,e,t)=>e(E(t).name),Cp=ne('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),Tp=ne('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),Pp=ne('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function xp(r,e){Wt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};Is(()=>{n()});function n(){Mu()}async function s(h){un(un().selectedBucket=h),un(un().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Yr.loadStoriesList(),await Yr.loadStoredResources()}Xr();var l=Pp(),u=F(x(l),2);Et(u,5,()=>un().availableBuckets,h=>h,(h,f)=>{const m=ni(()=>t[E(f).id]||{title:E(f),description:"Интерактивная история",icon:"📖"});var _=Tp();let b;var I=x(_),p=x(I),A=x(p),U=F(p,2),M=x(U),W=x(M),q=F(M,2),N=x(q),G=F(I,2),X=x(G);{var $=oe=>{var ee=Ip();K(oe,ee)},B=oe=>{var ee=Cp();ee.__click=[Ap,s,f],K(oe,ee)};je(X,oe=>{un().selectedBucket===E(f).name?oe($):oe(B,!1)})}be(oe=>{b=or(_,1,"bucket-card svelte-1cmn6ru",null,b,oe),Ae(A,E(m).icon),Ae(W,E(m).title),Ae(N,E(m).description)},[()=>({selected:un().selectedBucket===E(f).name})]),K(h,_)}),K(r,l),Vt()}Qt(["click"]);var jp=ne("<span> </span>"),Rp=ne('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Op=ne('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Mp=ne('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Lp=ne('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Dp(r,e){Wt(e,!0),Is(async()=>{Mu(),O.availableBuckets.length>0&&!O.selectedBucket&&(O.selectedBucket=O.availableBuckets[0].name)}),Xn(async()=>{if(O.selectedBucket){console.log(`[Editor] Bucket выбран: ${O.selectedBucket}`),await Yr.loadStoredResources();const u=`${O.selectedBucket}_story.json`;O.currentFileName=u,await vn.loadStory(u)}});var t=Jt(),n=xt(t);{var s=u=>{xp(u,{})},l=u=>{var h=Lp(),f=x(h),m=x(f),_=x(m);_.__click=()=>O.selectedBucket=null;var b=F(_,2),I=x(b),p=F(m,2),A=x(p),U=x(A),M=F(A,2);{var W=ce=>{var _e=jp(),pe=x(_e);be(()=>{or(_e,1,`status-message ${O.statusMessage.type??""}`,"svelte-1k4krym"),Ae(pe,O.statusMessage.text)}),K(ce,_e)};je(M,ce=>{O.statusMessage.text&&ce(W)})}var q=F(M,2);q.__click=function(...ce){vn.saveCurrentStory?.apply(this,ce)};var N=F(q,2);N.__click=function(...ce){vn.saveStoryCopy?.apply(this,ce)};var G=F(f,2),X=x(G);Qf(X,{});var $=F(X,2),B=x($);{var oe=ce=>{var _e=Rp(),pe=x(_e),ct=x(pe);be(()=>Ae(ct,`Загружено: ${O.data.meta?.title??""} |
              Глав: ${(O.data.chapters?.length||0)??""} |
              Диалогов: ${(O.data.dialogues?.length||0)??""} |
              Предметов: ${(O.data.items?.length||0)??""}`)),K(ce,_e)},ee=ce=>{var _e=Op();K(ce,_e)};je(B,ce=>{O.data?ce(oe):ce(ee,!1)})}var ge=F(B,2);Uv(ge,{});var Q=F(ge,2);{var te=ce=>{Cv(ce,{get editor(){return O},get storyActions(){return vn},get resourceActions(){return Yr}})},me=ce=>{var _e=Mp();K(ce,_e)};je(Q,ce=>{Lt.currentDialogue?ce(te):ce(me,!1)})}var Te=F($,2);Ep(Te,{}),be(()=>{Ae(I,`Story Editor v3.1 - ${O.selectedBucket??""}`),Ae(U,O.currentFileName||"Нет файла")}),K(u,h)};je(n,u=>{O.selectedBucket?u(l,!1):u(s)})}K(r,t),Vt()}Qt(["click"]);var ia=Qr(()=>kt),$p=(r,e,t)=>e(E(t)),Fp=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(E(t)))},Up=ne('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),Np=ne('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function Bp(r,e){Wt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function n(u){ia(ia().selectedStory=u)}Xr();var s=Np(),l=F(x(s),2);Et(l,5,()=>ia().availableStories,u=>u,(u,h)=>{const f=ni(()=>t[E(h)]||{title:E(h),description:"Интерактивная история",icon:"📖"});var m=Up();m.__click=[$p,n,h],m.__keydown=[Fp,n,h];var _=x(m),b=x(_),I=F(_,2),p=x(I),A=x(p),U=F(p,2),M=x(U);be(()=>{Ae(b,E(f).icon),Ae(A,E(f).title),Ae(M,E(f).description)}),K(u,m)}),K(r,s),Vt()}Qt(["click","keydown"]);var Wp=ne('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),Vp=ne('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),qp=ne('<div class="game-container svelte-14svm27"><button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),zp=ne('<div class="app svelte-14svm27"><!></div>');function Hp(r,e){Wt(e,!0),Xn(async()=>{if(kt.selectedStory){const u=`${kt.selectedStory}_story.json`,h=`${ms}/storage/v1/object/public/${kt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await kt.loadStory(h)}});var t=zp(),n=x(t);{var s=u=>{Bp(u,{})},l=u=>{var h=Jt(),f=xt(h);{var m=b=>{var I=Wp();K(b,I)},_=b=>{var I=Jt(),p=xt(I);{var A=M=>{var W=Vp(),q=x(W),N=F(q);N.__click=()=>kt.selectedStory=null,be(()=>Ae(q,`⚠️ ${kt.error??""} `)),K(M,W)},U=M=>{var W=qp(),q=x(W);q.__click=()=>kt.selectedStory=null;var N=F(q,2),G=x(N);{var X=$=>{{let B=Vn(()=>kt.selectedStory||void 0);Ou($,{get bucketName(){return E(B)}})}};je(G,$=>{kt.storyData&&$(X)})}K(M,W)};je(p,M=>{kt.error?M(A):M(U,!1)},!0)}K(b,I)};je(f,b=>{kt.isLoading?b(m):b(_,!1)},!0)}K(u,h)};je(n,u=>{kt.selectedStory?u(l,!1):u(s)})}K(r,t),Vt()}Qt(["click"]);var Gp=ne('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),Kp=ne('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function Yp(r,e){Wt(e,!1),Xr();var t=Jt(),n=xt(t);{var s=u=>{var h=Gp(),f=xt(h);f.__click=function(..._){it.toggleEditor?.apply(this,_)};var m=F(f,2);Dp(m,{}),K(u,h)},l=u=>{var h=Kp(),f=xt(h);f.__click=function(..._){it.toggleEditor?.apply(this,_)};var m=F(f,2);Hp(m,{}),K(u,h)};je(n,u=>{O.showEditor?u(s):u(l,!1)})}K(r,t),Vt()}Qt(["click"]);_d(Yp,{target:document.getElementById("app")});
