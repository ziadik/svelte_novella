(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const Dl=!1;var As=Array.isArray,pc=Array.prototype.indexOf,Da=Array.from,ga=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,Fl=Object.getOwnPropertyDescriptors,gc=Object.prototype,_c=Array.prototype,Fa=Object.getPrototypeOf,Ho=Object.isExtensible;const mc=()=>{};function yc(n){return n()}function ms(n){for(var e=0;e<n.length;e++)n[e]()}function wc(){var n,e,t=new Promise((r,i)=>{n=r,e=i});return{promise:t,resolve:n,reject:e}}const un=2,$a=4,Cs=8,ci=16,Gn=32,jr=64,$l=128,hn=256,ys=512,Zt=1024,vn=2048,rr=4096,kn=8192,Tr=16384,Ua=32768,js=65536,Ko=1<<17,bc=1<<18,Di=1<<19,Ul=1<<20,_a=1<<21,Na=1<<22,Sr=1<<23,Vn=Symbol("$state"),kc=Symbol("legacy props"),Ic=Symbol(""),Ba=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Sc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ec(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ac(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Cc(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function jc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Tc(n){throw new Error("https://svelte.dev/e/effect_orphan")}function xc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Pc(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function Rc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Oc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Mc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Ts=1,xs=2,Nl=4,Lc=8,Dc=16,Fc=1,$c=2,Uc=4,Nc=8,Bc=16,Wc=1,Vc=2,Yt=Symbol(),qc="http://www.w3.org/1999/xhtml";function Gc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let zc=!1;function Bl(n){return n===this.v}function Wl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Hc(n,e){return n!==e}function Vl(n){return!Wl(n,this.v)}let di=!1,Kc=!1;function Yc(){di=!0}let Bt=null;function ws(n){Bt=n}function Rt(n,e=!1,t){Bt={p:Bt,c:null,e:null,s:n,x:null,l:di&&!e?{s:null,u:null,$:[]}:null}}function Ot(n){var e=Bt,t=e.e;if(t!==null){e.e=null;for(var r of t)ru(r)}return Bt=e.p,{}}function fi(){return!di||Bt!==null&&Bt.l===null}const Jc=new WeakMap;function Xc(n){var e=gt;if(e===null)return mt.f|=Sr,n;if((e.f&Ua)===0){if((e.f&$l)===0)throw!e.parent&&n instanceof Error&&ql(n),n;e.b.error(n)}else Wa(n,e)}function Wa(n,e){for(;e!==null;){if((e.f&$l)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&ql(n),n}function ql(n){const e=Jc.get(n);e&&(ga(n,"message",{value:e.message}),ga(n,"stack",{value:e.stack}))}let Ri=[],ma=[];function Gl(){var n=Ri;Ri=[],ms(n)}function Qc(){var n=ma;ma=[],ms(n)}function Va(n){Ri.length===0&&queueMicrotask(Gl),Ri.push(n)}function Zc(){Ri.length>0&&Gl(),ma.length>0&&Qc()}function ed(){for(var n=gt.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&Sc(),n}function Fi(n){var e=un|vn,t=mt!==null&&(mt.f&un)!==0?mt:null;return gt===null||t!==null&&(t.f&hn)!==0?e|=hn:gt.f|=Di,{ctx:Bt,deps:null,effects:null,equals:Bl,f:e,fn:n,reactions:null,rv:0,v:Yt,wv:0,parent:t??gt,ac:null}}function td(n,e){let t=gt;t===null&&Ac();var r=t.b,i=void 0,l=si(Yt),u=null,f=!mt;return pd(()=>{try{var v=n();u&&Promise.resolve(v).catch(()=>{})}catch(p){v=Promise.reject(p)}var g=()=>v;i=u?.then(g,g)??Promise.resolve(v),u=i;var m=Lt,w=r.pending;f&&(r.update_pending_count(1),w||m.increment());const S=(p,k=void 0)=>{u=null,w||m.activate(),k?k!==Ba&&(l.f|=Sr,ai(l,k)):((l.f&Sr)!==0&&(l.f^=Sr),ai(l,p)),f&&(r.update_pending_count(-1),w||m.decrement()),Kl()};if(i.then(S,p=>S(null,p||"unknown")),m)return()=>{queueMicrotask(()=>m.neuter())}}),new Promise(v=>{function g(m){function w(){m===i?v(l):g(i)}m.then(w,w)}g(i)})}function Dt(n){const e=Fi(n);return cu(e),e}function hi(n){const e=Fi(n);return e.equals=Vl,e}function zl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Rn(e[t])}}function nd(n){for(var e=n.parent;e!==null;){if((e.f&un)===0)return e;e=e.parent}return null}function qa(n){var e,t=gt;tr(nd(n));try{zl(n),e=vu(n)}finally{tr(t)}return e}function Hl(n){var e=qa(n);if(n.equals(e)||(n.v=e,n.wv=fu()),!Pr){var t=(Qn||(n.f&hn)!==0)&&n.deps!==null?rr:Zt;an(n,t)}}function rd(n,e,t){const r=fi()?Fi:hi;if(e.length===0){t(n.map(r));return}var i=Lt,l=gt,u=id(),f=ed();Promise.all(e.map(v=>td(v))).then(v=>{i?.activate(),u();try{t([...n.map(r),...v])}catch(g){(l.f&Tr)===0&&Wa(g,l)}i?.deactivate(),Kl()}).catch(v=>{f.error(v)})}function id(){var n=gt,e=mt,t=Bt,r=Lt;return function(){tr(n),On(e),ws(t),r?.activate()}}function Kl(){tr(null),On(null),ws(null)}const ea=new Set;let Lt=null,ps=null,Yo=new Set,bs=[];function Yl(){const n=bs.shift();bs.length>0&&queueMicrotask(Yl),n()}let Ar=[],Ps=null,ya=!1,gs=!1;class ri{current=new Map;#i=new Map;#n=new Set;#e=0;#s=null;#a=!1;#t=[];#r=[];#l=[];#o=[];#u=[];#d=[];#f=[];skipped_effects=new Set;process(e){Ar=[],ps=null;for(const i of e)this.#v(i);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#l,r=this.#o;this.#l=[],this.#o=[],this.#u=[],ps=Lt,Lt=null,Jo(t),Jo(r),Lt===null?Lt=this:ea.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const i of this.#t)ni(i);for(const i of this.#r)ni(i);this.#t=[],this.#r=[]}#v(e){e.f^=Zt;for(var t=e.first;t!==null;){var r=t.f,i=(r&(Gn|jr))!==0,l=i&&(r&Zt)!==0,u=l||(r&kn)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(i)t.f^=Zt;else if((r&$a)!==0)this.#o.push(t);else if((r&Zt)===0)if((r&Na)!==0){var f=t.b?.pending?this.#r:this.#t;f.push(t)}else Ds(t)&&((t.f&ci)!==0&&this.#u.push(t),ni(t));var v=t.first;if(v!==null){t=v;continue}}var g=t.parent;for(t=t.next;t===null&&g!==null;)t=g.next,g=g.parent}}#c(e){for(const t of e)((t.f&vn)!==0?this.#d:this.#f).push(t),an(t,Zt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){Lt=this}deactivate(){Lt=null,ps=null;for(const e of Yo)if(Yo.delete(e),e(),Lt!==null)break}neuter(){this.#a=!0}flush(){Ar.length>0?Jl():this.#h(),Lt===this&&(this.#e===0&&ea.delete(this),this.deactivate())}#h(){if(!this.#a)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)an(e,vn),ii(e);for(const e of this.#f)an(e,rr),ii(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#s??=wc()).promise}static ensure(){if(Lt===null){const e=Lt=new ri;ea.add(Lt),gs||ri.enqueue(()=>{Lt===e&&e.flush()})}return Lt}static enqueue(e){bs.length===0&&queueMicrotask(Yl),bs.unshift(e)}}function sd(n){var e=gs;gs=!0;try{for(var t;;){if(Zc(),Ar.length===0&&(Lt?.flush(),Ar.length===0))return Ps=null,t;Jl()}}finally{gs=e}}function Jl(){var n=ti;ya=!0;try{var e=0;for(el(!0);Ar.length>0;){var t=ri.ensure();if(e++>1e3){var r,i;ad()}t.process(Ar),Zn.clear()}}finally{ya=!1,el(n),Ps=null}}function ad(){try{xc()}catch(n){Wa(n,Ps)}}let kr=null;function Jo(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(Tr|kn))===0&&Ds(r)&&(kr=[],ni(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?ou(r):r.fn=null),kr?.length>0)){Zn.clear();for(const i of kr)ni(i);kr=[]}}kr=null}}function ii(n){for(var e=Ps=n;e.parent!==null;){e=e.parent;var t=e.f;if(ya&&e===gt&&(t&ci)!==0)return;if((t&(jr|Gn))!==0){if((t&Zt)===0)return;e.f^=Zt}}Ar.push(e)}const Zn=new Map;function si(n,e){var t={f:0,v:n,reactions:null,equals:Bl,rv:0,wv:0};return t}function Re(n,e){const t=si(n);return cu(t),t}function od(n,e=!1,t=!0){const r=si(n);return e||(r.equals=Vl),di&&t&&Bt!==null&&Bt.l!==null&&(Bt.l.s??=[]).push(r),r}function ne(n,e,t=!1){mt!==null&&(!xn||(mt.f&Ko)!==0)&&fi()&&(mt.f&(un|ci|Na|Ko))!==0&&!qn?.includes(n)&&Mc();let r=t?pt(e):e;return ai(n,r)}function ai(n,e){if(!n.equals(e)){var t=n.v;Pr?Zn.set(n,e):Zn.set(n,t),n.v=e;var r=ri.ensure();r.capture(n,t),(n.f&un)!==0&&((n.f&vn)!==0&&qa(n),an(n,(n.f&hn)===0?Zt:rr)),n.wv=fu(),Xl(n,vn),fi()&&gt!==null&&(gt.f&Zt)!==0&&(gt.f&(Gn|jr))===0&&(fn===null?yd([n]):fn.push(n))}return e}function er(n,e=1){var t=h(n),r=e===1?t++:t--;return ne(n,t),r}function ta(n){ne(n,n.v+1)}function Xl(n,e){var t=n.reactions;if(t!==null)for(var r=fi(),i=t.length,l=0;l<i;l++){var u=t[l],f=u.f;if(!(!r&&u===gt)){var v=(f&vn)===0;v&&an(u,e),(f&un)!==0?Xl(u,rr):v&&((f&ci)!==0&&kr!==null&&kr.push(u),ii(u))}}}function pt(n){if(typeof n!="object"||n===null||Vn in n)return n;const e=Fa(n);if(e!==gc&&e!==_c)return n;var t=new Map,r=As(n),i=Re(0),l=Er,u=f=>{if(Er===l)return f();var v=mt,g=Er;On(null),nl(l);var m=f();return On(v),nl(g),m};return r&&t.set("length",Re(n.length)),new Proxy(n,{defineProperty(f,v,g){(!("value"in g)||g.configurable===!1||g.enumerable===!1||g.writable===!1)&&Rc();var m=t.get(v);return m===void 0?m=u(()=>{var w=Re(g.value);return t.set(v,w),w}):ne(m,g.value,!0),!0},deleteProperty(f,v){var g=t.get(v);if(g===void 0){if(v in f){const m=u(()=>Re(Yt));t.set(v,m),ta(i)}}else ne(g,Yt),ta(i);return!0},get(f,v,g){if(v===Vn)return n;var m=t.get(v),w=v in f;if(m===void 0&&(!w||ei(f,v)?.writable)&&(m=u(()=>{var p=pt(w?f[v]:Yt),k=Re(p);return k}),t.set(v,m)),m!==void 0){var S=h(m);return S===Yt?void 0:S}return Reflect.get(f,v,g)},getOwnPropertyDescriptor(f,v){var g=Reflect.getOwnPropertyDescriptor(f,v);if(g&&"value"in g){var m=t.get(v);m&&(g.value=h(m))}else if(g===void 0){var w=t.get(v),S=w?.v;if(w!==void 0&&S!==Yt)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return g},has(f,v){if(v===Vn)return!0;var g=t.get(v),m=g!==void 0&&g.v!==Yt||Reflect.has(f,v);if(g!==void 0||gt!==null&&(!m||ei(f,v)?.writable)){g===void 0&&(g=u(()=>{var S=m?pt(f[v]):Yt,p=Re(S);return p}),t.set(v,g));var w=h(g);if(w===Yt)return!1}return m},set(f,v,g,m){var w=t.get(v),S=v in f;if(r&&v==="length")for(var p=g;p<w.v;p+=1){var k=t.get(p+"");k!==void 0?ne(k,Yt):p in f&&(k=u(()=>Re(Yt)),t.set(p+"",k))}if(w===void 0)(!S||ei(f,v)?.writable)&&(w=u(()=>Re(void 0)),ne(w,pt(g)),t.set(v,w));else{S=w.v!==Yt;var R=u(()=>pt(g));ne(w,R)}var x=Reflect.getOwnPropertyDescriptor(f,v);if(x?.set&&x.set.call(m,g),!S){if(r&&typeof v=="string"){var F=t.get("length"),z=Number(v);Number.isInteger(z)&&z>=F.v&&ne(F,z+1)}ta(i)}return!0},ownKeys(f){h(i);var v=Reflect.ownKeys(f).filter(w=>{var S=t.get(w);return S===void 0||S.v!==Yt});for(var[g,m]of t)m.v!==Yt&&!(g in f)&&v.push(g);return v},setPrototypeOf(){Oc()}})}function Xo(n){try{if(n!==null&&typeof n=="object"&&Vn in n)return n[Vn]}catch{}return n}function ld(n,e){return Object.is(Xo(n),Xo(e))}var Qo,Ql,Zl,eu;function ud(){if(Qo===void 0){Qo=window,Ql=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Zl=ei(e,"firstChild").get,eu=ei(e,"nextSibling").get,Ho(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Ho(t)&&(t.__t=void 0)}}function xr(n=""){return document.createTextNode(n)}function oi(n){return Zl.call(n)}function Rs(n){return eu.call(n)}function E(n,e){return oi(n)}function Ze(n,e){{var t=oi(n);return t instanceof Comment&&t.data===""?Rs(t):t}}function j(n,e=1,t=!1){let r=n;for(;e--;)r=Rs(r);return r}function cd(n){n.textContent=""}function Ga(){return!1}let Zo=!1;function dd(){Zo||(Zo=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Os(n){var e=mt,t=gt;On(null),tr(null);try{return n()}finally{On(e),tr(t)}}function za(n,e,t,r=t){n.addEventListener(e,()=>Os(t));const i=n.__on_r;i?n.__on_r=()=>{i(),r(!0)}:n.__on_r=()=>r(!0),dd()}function tu(n){gt===null&&mt===null&&Tc(),mt!==null&&(mt.f&hn)!==0&&gt===null&&jc(),Pr&&Cc()}function fd(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Mn(n,e,t,r=!0){var i=gt;i!==null&&(i.f&kn)!==0&&(n|=kn);var l={ctx:Bt,deps:null,nodes_start:null,nodes_end:null,f:n|vn,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{ni(l),l.f|=Ua}catch(v){throw Rn(l),v}else e!==null&&ii(l);if(r){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Di)===0&&(u=u.first),u!==null&&(u.parent=i,i!==null&&fd(u,i),mt!==null&&(mt.f&un)!==0&&(n&jr)===0)){var f=mt;(f.effects??=[]).push(u)}}return l}function nu(n){const e=Mn(Cs,null,!1);return an(e,Zt),e.teardown=n,e}function li(n){tu();var e=gt.f,t=!mt&&(e&Gn)!==0&&(e&Ua)===0;if(t){var r=Bt;(r.e??=[]).push(n)}else return ru(n)}function ru(n){return Mn($a|Ul,n,!1)}function hd(n){return tu(),Mn(Cs|Ul,n,!0)}function vd(n){ri.ensure();const e=Mn(jr|Di,n,!0);return(t={})=>new Promise(r=>{t.outro?Ls(e,()=>{Rn(e),r(void 0)}):(Rn(e),r(void 0))})}function iu(n){return Mn($a,n,!1)}function pd(n){return Mn(Na|Di,n,!0)}function Ha(n,e=0){return Mn(Cs|e,n,!0)}function ke(n,e=[],t=[]){rd(e,t,r=>{Mn(Cs,()=>n(...r.map(h)),!0)})}function Ms(n,e=0){var t=Mn(ci|e,n,!0);return t}function Cr(n,e=!0){return Mn(Gn|Di,n,!0,e)}function su(n){var e=n.teardown;if(e!==null){const t=Pr,r=mt;tl(!0),On(null);try{e.call(null)}finally{tl(t),On(r)}}}function au(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const i=t.ac;i!==null&&Os(()=>{i.abort(Ba)});var r=t.next;(t.f&jr)!==0?t.parent=null:Rn(t,e),t=r}}function gd(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Gn)===0&&Rn(e),e=t}}function Rn(n,e=!0){var t=!1;(e||(n.f&bc)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(_d(n.nodes_start,n.nodes_end),t=!0),au(n,e&&!t),ks(n,0),an(n,Tr);var r=n.transitions;if(r!==null)for(const l of r)l.stop();su(n);var i=n.parent;i!==null&&i.first!==null&&ou(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function _d(n,e){for(;n!==null;){var t=n===e?null:Rs(n);n.remove(),n=t}}function ou(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ls(n,e){var t=[];Ka(n,t,!0),lu(t,()=>{Rn(n),e&&e()})}function lu(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var i of n)i.out(r)}else e()}function Ka(n,e,t){if((n.f&kn)===0){if(n.f^=kn,n.transitions!==null)for(const u of n.transitions)(u.is_global||t)&&e.push(u);for(var r=n.first;r!==null;){var i=r.next,l=(r.f&js)!==0||(r.f&Gn)!==0;Ka(r,e,l?t:!1),r=i}}}function Ya(n){uu(n,!0)}function uu(n,e){if((n.f&kn)!==0){n.f^=kn,(n.f&Zt)===0&&(an(n,vn),ii(n));for(var t=n.first;t!==null;){var r=t.next,i=(t.f&js)!==0||(t.f&Gn)!==0;uu(t,i?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let Jr=null;function md(n){var e=Jr;try{if(Jr=new Set,Rr(n),e!==null)for(var t of Jr)e.add(t);return Jr}finally{Jr=e}}function wn(n){for(var e of md(n))ai(e,e.v)}let ti=!1;function el(n){ti=n}let Pr=!1;function tl(n){Pr=n}let mt=null,xn=!1;function On(n){mt=n}let gt=null;function tr(n){gt=n}let qn=null;function cu(n){mt!==null&&(qn===null?qn=[n]:qn.push(n))}let tn=null,ln=0,fn=null;function yd(n){fn=n}let du=1,Oi=0,Er=Oi;function nl(n){Er=n}let Qn=!1;function fu(){return++du}function Ds(n){var e=n.f;if((e&vn)!==0)return!0;if((e&rr)!==0){var t=n.deps,r=(e&hn)!==0;if(t!==null){var i,l,u=(e&ys)!==0,f=r&&gt!==null&&!Qn,v=t.length;if((u||f)&&(gt===null||(gt.f&Tr)===0)){var g=n,m=g.parent;for(i=0;i<v;i++)l=t[i],(u||!l?.reactions?.includes(g))&&(l.reactions??=[]).push(g);u&&(g.f^=ys),f&&m!==null&&(m.f&hn)===0&&(g.f^=hn)}for(i=0;i<v;i++)if(l=t[i],Ds(l)&&Hl(l),l.wv>n.wv)return!0}(!r||gt!==null&&!Qn)&&an(n,Zt)}return!1}function hu(n,e,t=!0){var r=n.reactions;if(r!==null&&!qn?.includes(n))for(var i=0;i<r.length;i++){var l=r[i];(l.f&un)!==0?hu(l,e,!1):e===l&&(t?an(l,vn):(l.f&Zt)!==0&&an(l,rr),ii(l))}}function vu(n){var e=tn,t=ln,r=fn,i=mt,l=Qn,u=qn,f=Bt,v=xn,g=Er,m=n.f;tn=null,ln=0,fn=null,Qn=(m&hn)!==0&&(xn||!ti||mt===null),mt=(m&(Gn|jr))===0?n:null,qn=null,ws(n.ctx),xn=!1,Er=++Oi,n.ac!==null&&(Os(()=>{n.ac.abort(Ba)}),n.ac=null);try{n.f|=_a;var w=n.fn,S=w(),p=n.deps;if(tn!==null){var k;if(ks(n,ln),p!==null&&ln>0)for(p.length=ln+tn.length,k=0;k<tn.length;k++)p[ln+k]=tn[k];else n.deps=p=tn;if(!Qn||(m&un)!==0&&n.reactions!==null)for(k=ln;k<p.length;k++)(p[k].reactions??=[]).push(n)}else p!==null&&ln<p.length&&(ks(n,ln),p.length=ln);if(fi()&&fn!==null&&!xn&&p!==null&&(n.f&(un|rr|vn))===0)for(k=0;k<fn.length;k++)hu(fn[k],n);return i!==null&&i!==n&&(Oi++,fn!==null&&(r===null?r=fn:r.push(...fn))),(n.f&Sr)!==0&&(n.f^=Sr),S}catch(R){return Xc(R)}finally{n.f^=_a,tn=e,ln=t,fn=r,mt=i,Qn=l,qn=u,ws(f),xn=v,Er=g}}function wd(n,e){let t=e.reactions;if(t!==null){var r=pc.call(t,n);if(r!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[r]=t[i],t.pop())}}t===null&&(e.f&un)!==0&&(tn===null||!tn.includes(e))&&(an(e,rr),(e.f&(hn|ys))===0&&(e.f^=ys),zl(e),ks(e,0))}function ks(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)wd(n,t[r])}function ni(n){var e=n.f;if((e&Tr)===0){an(n,Zt);var t=gt,r=ti;gt=n,ti=!0;try{(e&ci)!==0?gd(n):au(n),su(n);var i=vu(n);n.teardown=typeof i=="function"?i:null,n.wv=du;var l;Dl&&Kc&&(n.f&vn)!==0&&n.deps}finally{ti=r,gt=t}}}async function pu(){await Promise.resolve(),sd()}function h(n){var e=n.f,t=(e&un)!==0;if(Jr?.add(n),mt!==null&&!xn){var r=gt!==null&&(gt.f&Tr)!==0;if(!r&&!qn?.includes(n)){var i=mt.deps;if((mt.f&_a)!==0)n.rv<Oi&&(n.rv=Oi,tn===null&&i!==null&&i[ln]===n?ln++:tn===null?tn=[n]:(!Qn||!tn.includes(n))&&tn.push(n));else{(mt.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[mt]:l.includes(mt)||l.push(mt)}}}else if(t&&n.deps===null&&n.effects===null){var u=n,f=u.parent;f!==null&&(f.f&hn)===0&&(u.f^=hn)}if(Pr){if(Zn.has(n))return Zn.get(n);if(t){u=n;var v=u.v;return((u.f&Zt)===0&&u.reactions!==null||gu(u))&&(v=qa(u)),Zn.set(u,v),v}}else t&&(u=n,Ds(u)&&Hl(u));if((n.f&Sr)!==0)throw n.v;return n.v}function gu(n){if(n.v===Yt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Zn.has(e)||(e.f&un)!==0&&gu(e))return!0;return!1}function Rr(n){var e=xn;try{return xn=!0,n()}finally{xn=e}}const bd=-7169;function an(n,e){n.f=n.f&bd|e}function kd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Vn in n)wa(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Vn in t&&wa(t)}}}function wa(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{wa(n[r],e)}catch{}const t=Fa(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Fl(t);for(let i in r){const l=r[i].get;if(l)try{l.call(n)}catch{}}}}}const Id=["touchstart","touchmove"];function Sd(n){return Id.includes(n)}const _u=new Set,ba=new Set;function Ed(n,e,t,r={}){function i(l){if(r.capture||Ai.call(e,l),!l.cancelBubble)return Os(()=>t?.call(this,l))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Va(()=>{e.addEventListener(n,i,r)}):e.addEventListener(n,i,r),i}function ka(n,e,t,r,i){var l={capture:r,passive:i},u=Ed(n,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&nu(()=>{e.removeEventListener(n,u,l)})}function Ft(n){for(var e=0;e<n.length;e++)_u.add(n[e]);for(var t of ba)t(n)}let rl=null;function Ai(n){var e=this,t=e.ownerDocument,r=n.type,i=n.composedPath?.()||[],l=i[0]||n.target;rl=n;var u=0,f=rl===n&&n.__root;if(f){var v=i.indexOf(f);if(v!==-1&&(e===document||e===window)){n.__root=e;return}var g=i.indexOf(e);if(g===-1)return;v<=g&&(u=v)}if(l=i[u]||n.target,l!==e){ga(n,"currentTarget",{configurable:!0,get(){return l||t}});var m=mt,w=gt;On(null),tr(null);try{for(var S,p=[];l!==null;){var k=l.assignedSlot||l.parentNode||l.host||null;try{var R=l["__"+r];if(R!=null&&(!l.disabled||n.target===l))if(As(R)){var[x,...F]=R;x.apply(l,[n,...F])}else R.call(l,n)}catch(z){S?p.push(z):S=z}if(n.cancelBubble||k===e||k===null)break;l=k}if(S){for(let z of p)queueMicrotask(()=>{throw z});throw S}}finally{n.__root=e,delete n.currentTarget,On(m),tr(w)}}}function mu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Mi(n,e){var t=gt;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function X(n,e){var t=(e&Wc)!==0,r=(e&Vc)!==0,i,l=!n.startsWith("<!>");return()=>{i===void 0&&(i=mu(l?n:"<!>"+n),t||(i=oi(i)));var u=r||Ql?document.importNode(i,!0):i.cloneNode(!0);if(t){var f=oi(u),v=u.lastChild;Mi(f,v)}else Mi(u,u);return u}}function Ad(n,e,t="svg"){var r=!n.startsWith("<!>"),i=`<${t}>${r?n:"<!>"+n}</${t}>`,l;return()=>{if(!l){var u=mu(i),f=oi(u);l=oi(f)}var v=l.cloneNode(!0);return Mi(v,v),v}}function Cd(n,e){return Ad(n,e,"svg")}function ls(n=""){{var e=xr(n+"");return Mi(e,e),e}}function At(){var n=document.createDocumentFragment(),e=document.createComment(""),t=xr();return n.append(e,t),Mi(e,t),n}function W(n,e){n!==null&&n.before(e)}function _e(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function jd(n,e){return Td(n,e)}const Ur=new Map;function Td(n,{target:e,anchor:t,props:r={},events:i,context:l,intro:u=!0}){ud();var f=new Set,v=w=>{for(var S=0;S<w.length;S++){var p=w[S];if(!f.has(p)){f.add(p);var k=Sd(p);e.addEventListener(p,Ai,{passive:k});var R=Ur.get(p);R===void 0?(document.addEventListener(p,Ai,{passive:k}),Ur.set(p,1)):Ur.set(p,R+1)}}};v(Da(_u)),ba.add(v);var g=void 0,m=vd(()=>{var w=t??e.appendChild(xr());return Cr(()=>{if(l){Rt({});var S=Bt;S.c=l}i&&(r.$$events=i),g=n(w,r)||{},l&&Ot()}),()=>{for(var S of f){e.removeEventListener(S,Ai);var p=Ur.get(S);--p===0?(document.removeEventListener(S,Ai),Ur.delete(S)):Ur.set(S,p)}ba.delete(v),w!==t&&w.parentNode?.removeChild(w)}});return xd.set(g,m),g}let xd=new WeakMap;function Oe(n,e,t=!1){var r=n,i=null,l=null,u=Yt,f=t?js:0,v=!1;const g=(p,k=!0)=>{v=!0,S(k,p)};var m=null;function w(){m!==null&&(m.lastChild.remove(),r.before(m),m=null);var p=u?i:l,k=u?l:i;p&&Ya(p),k&&Ls(k,()=>{u?l=null:i=null})}const S=(p,k)=>{if(u!==(u=p)){var R=Ga(),x=r;if(R&&(m=document.createDocumentFragment(),m.append(x=xr())),u?i??=k&&Cr(()=>k(x)):l??=k&&Cr(()=>k(x)),R){var F=Lt,z=u?i:l,M=u?l:i;z&&F.skipped_effects.delete(z),M&&F.skipped_effects.add(M),F.add_callback(w)}else w()}};Ms(()=>{v=!1,e(g),v||S(null,null)},f)}function Ia(n,e,t){var r=n,i=Yt,l,u,f=null,v=fi()?Hc:Wl;function g(){l&&Ls(l),f!==null&&(f.lastChild.remove(),r.before(f),f=null),l=u}Ms(()=>{if(v(i,i=e())){var m=r,w=Ga();w&&(f=document.createDocumentFragment(),f.append(m=xr())),u=Cr(()=>t(m)),w?Lt.add_callback(g):g()}})}function Tt(n,e){return e}function Pd(n,e,t){for(var r=n.items,i=[],l=e.length,u=0;u<l;u++)Ka(e[u].e,i,!0);var f=l>0&&i.length===0&&t!==null;if(f){var v=t.parentNode;cd(v),v.append(t),r.clear(),Cn(n,e[0].prev,e[l-1].next)}lu(i,()=>{for(var g=0;g<l;g++){var m=e[g];f||(r.delete(m.k),Cn(n,m.prev,m.next)),Rn(m.e,!f)}})}function Qe(n,e,t,r,i,l=null){var u=n,f={flags:e,items:new Map,first:null},v=(e&Nl)!==0;if(v){var g=n;u=g.appendChild(xr())}var m=null,w=!1,S=new Map,p=hi(()=>{var F=t();return As(F)?F:F==null?[]:Da(F)}),k,R;function x(){Rd(R,k,f,S,u,i,e,r,t),l!==null&&(k.length===0?m?Ya(m):m=Cr(()=>l(u)):m!==null&&Ls(m,()=>{m=null}))}Ms(()=>{R??=gt,k=h(p);var F=k.length;if(!(w&&F===0)){w=F===0;var z,M,U,$;if(Ga()){var C=new Set,P=Lt;for(M=0;M<F;M+=1){U=k[M],$=r(U,M);var ie=f.items.get($)??S.get($);ie?(e&(Ts|xs))!==0&&yu(ie,U,M,e):(z=wu(null,f,null,null,U,$,M,i,e,t,!0),S.set($,z)),C.add($)}for(const[oe,pe]of f.items)C.has(oe)||P.skipped_effects.add(pe.e);P.add_callback(x)}else x();h(p)}})}function Rd(n,e,t,r,i,l,u,f,v){var g=(u&Lc)!==0,m=(u&(Ts|xs))!==0,w=e.length,S=t.items,p=t.first,k=p,R,x=null,F,z=[],M=[],U,$,C,P;if(g)for(P=0;P<w;P+=1)U=e[P],$=f(U,P),C=S.get($),C!==void 0&&(C.a?.measure(),(F??=new Set).add(C));for(P=0;P<w;P+=1){if(U=e[P],$=f(U,P),C=S.get($),C===void 0){var ie=r.get($);if(ie!==void 0){r.delete($),S.set($,ie);var oe=x?x.next:k;Cn(t,x,ie),Cn(t,ie,oe),na(ie,oe,i),x=ie}else{var pe=k?k.e.nodes_start:i;x=wu(pe,t,x,x===null?t.first:x.next,U,$,P,l,u,v)}S.set($,x),z=[],M=[],k=x.next;continue}if(m&&yu(C,U,P,u),(C.e.f&kn)!==0&&(Ya(C.e),g&&(C.a?.unfix(),(F??=new Set).delete(C))),C!==k){if(R!==void 0&&R.has(C)){if(z.length<M.length){var fe=M[0],ce;x=fe.prev;var Y=z[0],K=z[z.length-1];for(ce=0;ce<z.length;ce+=1)na(z[ce],fe,i);for(ce=0;ce<M.length;ce+=1)R.delete(M[ce]);Cn(t,Y.prev,K.next),Cn(t,x,Y),Cn(t,K,fe),k=fe,x=K,P-=1,z=[],M=[]}else R.delete(C),na(C,k,i),Cn(t,C.prev,C.next),Cn(t,C,x===null?t.first:x.next),Cn(t,x,C),x=C;continue}for(z=[],M=[];k!==null&&k.k!==$;)(k.e.f&kn)===0&&(R??=new Set).add(k),M.push(k),k=k.next;if(k===null)continue;C=k}z.push(C),x=C,k=C.next}if(k!==null||R!==void 0){for(var G=R===void 0?[]:Da(R);k!==null;)(k.e.f&kn)===0&&G.push(k),k=k.next;var ee=G.length;if(ee>0){var L=(u&Nl)!==0&&w===0?i:null;if(g){for(P=0;P<ee;P+=1)G[P].a?.measure();for(P=0;P<ee;P+=1)G[P].a?.fix()}Pd(t,G,L)}}g&&Va(()=>{if(F!==void 0)for(C of F)C.a?.apply()}),n.first=t.first&&t.first.e,n.last=x&&x.e;for(var V of r.values())Rn(V.e);r.clear()}function yu(n,e,t,r){(r&Ts)!==0&&ai(n.v,e),(r&xs)!==0?ai(n.i,t):n.i=t}function wu(n,e,t,r,i,l,u,f,v,g,m){var w=(v&Ts)!==0,S=(v&Dc)===0,p=w?S?od(i,!1,!1):si(i):i,k=(v&xs)===0?u:si(u),R={i:k,v:p,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var x=document.createDocumentFragment();x.append(n=xr())}return R.e=Cr(()=>f(n,p,k,g),zc),R.e.prev=t&&t.e,R.e.next=r&&r.e,t===null?m||(e.first=R):(t.next=R,t.e.next=R.e),r!==null&&(r.prev=R,r.e.prev=R.e),R}finally{}}function na(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var u=Rs(l);i.before(l),l=u}}function Cn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Od(n,e,t,r,i){var l=e.$$slots?.[t],u=!1;l===!0&&(l=e.children,u=!0),l===void 0||l(n,u?()=>r:r)}function bu(n,e,...t){var r=n,i=mc,l;Ms(()=>{i!==(i=e())&&(l&&(Rn(l),l=null),l=Cr(()=>i(r,...t)))},js)}const il=[...` 	
\r\f \v\uFEFF`];function Md(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var i in t)if(t[i])r=r?r+" "+i:i;else if(r.length)for(var l=i.length,u=0;(u=r.indexOf(i,u))>=0;){var f=u+l;(u===0||il.includes(r[u-1]))&&(f===r.length||il.includes(r[f]))?r=(u===0?"":r.substring(0,u))+r.substring(f+1):u=f}}return r===""?null:r}function Ld(n,e){return n==null?null:String(n)}function Nt(n,e,t,r,i,l){var u=n.__className;if(u!==t||u===void 0){var f=Md(t,r,l);f==null?n.removeAttribute("class"):n.className=f,n.__className=t}else if(l&&i!==l)for(var v in l){var g=!!l[v];(i==null||g!==!!i[v])&&n.classList.toggle(v,g)}return l}function sn(n,e,t,r){var i=n.__style;if(i!==e){var l=Ld(e);l==null?n.removeAttribute("style"):n.style.cssText=l,n.__style=e}return r}function Jn(n,e,t=!1){if(n.multiple){if(e==null)return;if(!As(e))return Gc();for(var r of n.options)r.selected=e.includes(ji(r));return}for(r of n.options){var i=ji(r);if(ld(i,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function wr(n){var e=new MutationObserver(()=>{Jn(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),nu(()=>{e.disconnect()})}function Zr(n,e,t=e){var r=!0;za(n,"change",i=>{var l=i?"[selected]":":checked",u;if(n.multiple)u=[].map.call(n.querySelectorAll(l),ji);else{var f=n.querySelector(l)??n.querySelector("option:not([disabled])");u=f&&ji(f)}t(u)}),iu(()=>{var i=e();if(Jn(n,i,r),r&&i===void 0){var l=n.querySelector(":checked");l!==null&&(i=ji(l),t(i))}n.__value=i,r=!1}),wr(n)}function ji(n){return"__value"in n?n.__value:n.value}const Dd=Symbol("is custom element"),Fd=Symbol("is html");function ra(n,e){var t=Ja(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function $d(n,e){var t=Ja(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function We(n,e,t,r){var i=Ja(n);i[e]!==(i[e]=t)&&(e==="loading"&&(n[Ic]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Ud(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Ja(n){return n.__attributes??={[Dd]:n.nodeName.includes("-"),[Fd]:n.namespaceURI===qc}}var sl=new Map;function Ud(n){var e=n.getAttribute("is")||n.nodeName,t=sl.get(e);if(t)return t;sl.set(e,t=[]);for(var r,i=n,l=Element.prototype;l!==i;){r=Fl(i);for(var u in r)r[u].set&&t.push(u);i=Fa(i)}return t}function Wn(n,e,t=e){var r=new WeakSet;za(n,"input",async i=>{var l=i?n.defaultValue:n.value;if(l=ia(n)?sa(l):l,t(l),Lt!==null&&r.add(Lt),await pu(),l!==(l=e())){var u=n.selectionStart,f=n.selectionEnd;n.value=l??"",f!==null&&(n.selectionStart=u,n.selectionEnd=Math.min(f,n.value.length))}}),Rr(e)==null&&n.value&&(t(ia(n)?sa(n.value):n.value),Lt!==null&&r.add(Lt)),Ha(()=>{var i=e();if(n===document.activeElement){var l=ps??Lt;if(r.has(l))return}ia(n)&&i===sa(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function al(n,e,t=e){za(n,"change",r=>{var i=r?n.defaultChecked:n.checked;t(i)}),Rr(e)==null&&t(n.checked),Ha(()=>{var r=e();n.checked=!!r})}function ia(n){var e=n.type;return e==="number"||e==="range"}function sa(n){return n===""?null:+n}function ol(n,e){return n===e||n?.[Vn]===e}function Sa(n={},e,t,r){return iu(()=>{var i,l;return Ha(()=>{i=l,l=[],Rr(()=>{n!==t(...l)&&(e(n,...l),i&&ol(t(...i),n)&&e(null,...i))})}),()=>{Va(()=>{l&&ol(t(...l),n)&&e(null,...l)})}}),n}function ir(n=!1){const e=Bt,t=e.l.u;if(!t)return;let r=()=>kd(e.s);if(n){let i=0,l={};const u=Fi(()=>{let f=!1;const v=e.s;for(const g in v)v[g]!==l[g]&&(l[g]=v[g],f=!0);return f&&i++,i});r=()=>h(u)}t.b.length&&hd(()=>{ll(e,r),ms(t.b)}),li(()=>{const i=Rr(()=>t.m.map(yc));return()=>{for(const l of i)typeof l=="function"&&l()}}),t.a.length&&li(()=>{ll(e,r),ms(t.a)})}function ll(n,e){if(n.l.s)for(const t of n.l.s)h(t);e()}function sr(n){var e=si(0);return function(){return arguments.length===1?(ne(e,h(e)+1),arguments[0]):(h(e),n())}}let us=!1;function Nd(n){var e=us;try{return us=!1,[n(),us]}finally{us=e}}function He(n,e,t,r){var i=!di||(t&$c)!==0,l=(t&Nc)!==0,u=(t&Bc)!==0,f=r,v=!0,g=()=>(v&&(v=!1,f=u?Rr(r):r),f),m;if(l){var w=Vn in n||kc in n;m=ei(n,e)?.set??(w&&e in n?M=>n[e]=M:void 0)}var S,p=!1;l?[S,p]=Nd(()=>n[e]):S=n[e],S===void 0&&r!==void 0&&(S=g(),m&&(i&&Pc(),m(S)));var k;if(i?k=()=>{var M=n[e];return M===void 0?g():(v=!0,M)}:k=()=>{var M=n[e];return M!==void 0&&(f=void 0),M===void 0?f:M},i&&(t&Uc)===0)return k;if(m){var R=n.$$legacy;return(function(M,U){return arguments.length>0?((!i||!U||R||p)&&m(U?k():M),M):k()})}var x=!1,F=((t&Fc)!==0?Fi:hi)(()=>(x=!1,k()));l&&h(F);var z=gt;return(function(M,U){if(arguments.length>0){const $=U?h(F):i&&l?pt(M):M;return ne(F,$),x=!0,f!==void 0&&(f=$),M}return Pr&&x||(z.f&Tr)!==0?F.v:h(F)})}function In(n){Bt===null&&Ec(),di&&Bt.l!==null?Bd(Bt).m.push(n):li(()=>{const e=Rr(n);if(typeof e=="function")return e})}function Bd(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Wd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Wd);Yc();const B=pt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Jt={get currentDialogue(){return B.data?.dialogues.find(n=>n.id===B.selectedDialogueId)},get currentChapter(){return B.data?.chapters?.find(n=>n.id===B.selectedChapterId)},get currentEditingChapter(){return B.data?.chapters?.find(n=>n.id===B.editingChapterId)},get currentEditingOption(){return Jt.currentDialogue&&B.editingOptionIndex!==null?Jt.currentDialogue.options?.[B.editingOptionIndex]:void 0},get chapterDialogues(){return!B.data?.dialogues||!B.selectedChapterId?[]:B.data.dialogues.filter(n=>n.chapterId===B.selectedChapterId)},get imageResources(){return B.storedFiles.filter(n=>n.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return B.storedFiles.filter(n=>n.name.endsWith(".riv"))},get availableItems(){return B.data?.items||[]},get backlinks(){return!B.data||!B.selectedDialogueId?[]:B.data.dialogues.filter(n=>n.nextDialogueId===B.selectedDialogueId?!0:n.options?n.options.some(e=>e.nextDialogueId===B.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},wt={toggleEditor(){B.showEditor=!B.showEditor},toggleItemsPanel(){B.showItems=!B.showItems},setStatus(n,e){B.statusMessage={type:n,text:e}},clearStatus(){B.statusMessage={type:"",text:""}},selectBucket(n){B.selectedBucket=n,B.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},B.storedFiles=[],B.storiesList=[],B.selectedChapterId=null,B.selectedDialogueId=null},updateBucketsList(n){B.availableBuckets=n},selectChapter(n){B.selectedChapterId=n,B.selectedDialogueId=null},selectDialogue(n){B.selectedDialogueId=n},selectOption(n){B.editingOptionIndex=n},selectItem(n){B.editingItemIndex=n},updateStoryData(n){B.data=n},updateStoredFiles(n){B.storedFiles=n},updateStoriesList(n){B.storiesList=n},setCurrentFileName(n){B.currentFileName=n},addDialogue(n){B.data.dialogues=[...B.data.dialogues,n]},updateDialogue(n,e){B.data.dialogues=B.data.dialogues.map(t=>t.id===n?{...t,...e}:t)},deleteDialogue(n){B.data.dialogues=B.data.dialogues.filter(e=>e.id!==n),B.selectedDialogueId===n&&(B.selectedDialogueId=null)},addChapter(n){B.data.chapters=[...B.data.chapters||[],n]},updateChapter(n,e){B.data.chapters&&(B.data.chapters=B.data.chapters.map(t=>t.id===n?{...t,...e}:t))},selectEditingChapter(n){B.editingChapterId=n},deleteChapter(n){B.data.chapters&&(B.data.chapters=B.data.chapters.filter(e=>e.id!==n),B.selectedChapterId===n&&(B.selectedChapterId=null,B.selectedDialogueId=null))},addItem(n){B.data.items=[...B.data.items||[],n]},updateItem(n,e){B.data.items&&(B.data.items=B.data.items.map(t=>t.id===n?{...t,...e}:t))},deleteItem(n){B.data.items&&(B.data.items=B.data.items.filter(e=>e.id!==n))},reset(){B.showEditor=!1,B.showItems=!1,B.editingOptionIndex=null,B.editingItemIndex=null,B.selectedChapterId=null,B.selectedDialogueId=null,B.statusMessage={type:"",text:""}}},Vd="modulepreload",qd=function(n,e){return new URL(n,e).href},ul={},$i=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let g=function(m){return Promise.all(m.map(w=>Promise.resolve(w).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),v=f?.nonce||f?.getAttribute("nonce");i=g(t.map(m=>{if(m=qd(m,r),m in ul)return;ul[m]=!0;const w=m.endsWith(".css"),S=w?'[rel="stylesheet"]':"";if(!!r)for(let R=u.length-1;R>=0;R--){const x=u[R];if(x.href===m&&(!w||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${S}`))return;const k=document.createElement("link");if(k.rel=w?"stylesheet":Vd,w||(k.as="script"),k.crossOrigin="",k.href=m,v&&k.setAttribute("nonce",v),document.head.appendChild(k),w)return new Promise((R,x)=>{k.addEventListener("load",R),k.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return i.then(u=>{for(const f of u||[])f.status==="rejected"&&l(f.reason);return e().catch(l)})},Gd=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Xa extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class zd extends Xa{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class cl extends Xa{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class dl extends Xa{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ea;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Ea||(Ea={}));var Hd=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};class Kd{constructor(e,{headers:t={},customFetch:r,region:i=Ea.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Gd(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Hd(this,void 0,void 0,function*(){try{const{headers:i,method:l,body:u}=t;let f={},{region:v}=t;v||(v=this.region);const g=new URL(`${this.url}/${e}`);v&&v!=="any"&&(f["x-region"]=v,g.searchParams.set("forceFunctionRegion",v));let m;u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",m=u):typeof u=="string"?(f["Content-Type"]="text/plain",m=u):typeof FormData<"u"&&u instanceof FormData?m=u:(f["Content-Type"]="application/json",m=JSON.stringify(u)));const w=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),i),body:m}).catch(R=>{throw new zd(R)}),S=w.headers.get("x-relay-error");if(S&&S==="true")throw new cl(w);if(!w.ok)throw new dl(w);let p=((r=w.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),k;return p==="application/json"?k=yield w.json():p==="application/octet-stream"?k=yield w.blob():p==="text/event-stream"?k=w:p==="multipart/form-data"?k=yield w.formData():k=yield w.text(),{data:k,error:null,response:w}}catch(i){return{data:null,error:i,response:i instanceof dl||i instanceof cl?i.context:void 0}}})}}function Yd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Jd(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Kt={},Nr={},Br={},Wr={},Vr={},qr={},Xd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ui=Xd();const Qd=ui.fetch,ku=ui.fetch.bind(ui),Iu=ui.Headers,Zd=ui.Request,ef=ui.Response,vi=Object.freeze(Object.defineProperty({__proto__:null,Headers:Iu,Request:Zd,Response:ef,default:ku,fetch:Qd},Symbol.toStringTag,{value:"Module"})),tf=Jd(vi);var cs={},fl;function Su(){if(fl)return cs;fl=1,Object.defineProperty(cs,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return cs.default=n,cs}var hl;function Eu(){if(hl)return qr;hl=1;var n=qr&&qr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qr,"__esModule",{value:!0});const e=n(tf),t=n(Su());class r{constructor(l){var u,f;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(f=l.isMaybeSingle)!==null&&f!==void 0?f:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let v=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var m,w,S,p;let k=null,R=null,x=null,F=g.status,z=g.statusText;if(g.ok){if(this.method!=="HEAD"){const C=await g.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?R=C:R=JSON.parse(C))}const U=(w=this.headers.get("Prefer"))===null||w===void 0?void 0:w.match(/count=(exact|planned|estimated)/),$=(S=g.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");U&&$&&$.length>1&&(x=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(R)&&(R.length>1?(k={code:"PGRST116",details:`Results contain ${R.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},R=null,x=null,F=406,z="Not Acceptable"):R.length===1?R=R[0]:R=null)}else{const U=await g.text();try{k=JSON.parse(U),Array.isArray(k)&&g.status===404&&(R=[],k=null,F=200,z="OK")}catch{g.status===404&&U===""?(F=204,z="No Content"):k={message:U}}if(k&&this.isMaybeSingle&&(!((p=k?.details)===null||p===void 0)&&p.includes("0 rows"))&&(k=null,F=200,z="OK"),k&&this.shouldThrowOnError)throw new t.default(k)}return{error:k,data:R,count:x,status:F,statusText:z}});return this.shouldThrowOnError||(v=v.catch(g=>{var m,w,S;return{error:{message:`${(m=g?.name)!==null&&m!==void 0?m:"FetchError"}: ${g?.message}`,details:`${(w=g?.stack)!==null&&w!==void 0?w:""}`,hint:"",code:`${(S=g?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,u)}returns(){return this}overrideTypes(){return this}}return qr.default=r,qr}var vl;function Au(){if(vl)return Vr;vl=1;var n=Vr&&Vr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Vr,"__esModule",{value:!0});const e=n(Eu());class t extends e.default{select(i){let l=!1;const u=(i??"*").split("").map(f=>/\s/.test(f)&&!l?"":(f==='"'&&(l=!l),f)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:l=!0,nullsFirst:u,foreignTable:f,referencedTable:v=f}={}){const g=v?`${v}.order`:"order",m=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${m?`${m},`:""}${i}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:l,referencedTable:u=l}={}){const f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(f,`${i}`),this}range(i,l,{foreignTable:u,referencedTable:f=u}={}){const v=typeof f>"u"?"offset":`${f}.offset`,g=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(v,`${i}`),this.url.searchParams.set(g,`${l-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:l=!1,settings:u=!1,buffers:f=!1,wal:v=!1,format:g="text"}={}){var m;const w=[i?"analyze":null,l?"verbose":null,u?"settings":null,f?"buffers":null,v?"wal":null].filter(Boolean).join("|"),S=(m=this.headers.get("Accept"))!==null&&m!==void 0?m:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${g}; for="${S}"; options=${w};`),g==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Vr.default=t,Vr}var pl;function Qa(){if(pl)return Wr;pl=1;var n=Wr&&Wr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});const e=n(Au());class t extends e.default{eq(i,l){return this.url.searchParams.append(i,`eq.${l}`),this}neq(i,l){return this.url.searchParams.append(i,`neq.${l}`),this}gt(i,l){return this.url.searchParams.append(i,`gt.${l}`),this}gte(i,l){return this.url.searchParams.append(i,`gte.${l}`),this}lt(i,l){return this.url.searchParams.append(i,`lt.${l}`),this}lte(i,l){return this.url.searchParams.append(i,`lte.${l}`),this}like(i,l){return this.url.searchParams.append(i,`like.${l}`),this}likeAllOf(i,l){return this.url.searchParams.append(i,`like(all).{${l.join(",")}}`),this}likeAnyOf(i,l){return this.url.searchParams.append(i,`like(any).{${l.join(",")}}`),this}ilike(i,l){return this.url.searchParams.append(i,`ilike.${l}`),this}ilikeAllOf(i,l){return this.url.searchParams.append(i,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(i,l){return this.url.searchParams.append(i,`ilike(any).{${l.join(",")}}`),this}is(i,l){return this.url.searchParams.append(i,`is.${l}`),this}in(i,l){const u=Array.from(new Set(l)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cs.{${l.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(l)}`),this}containedBy(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cd.{${l.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(l)}`),this}rangeGt(i,l){return this.url.searchParams.append(i,`sr.${l}`),this}rangeGte(i,l){return this.url.searchParams.append(i,`nxl.${l}`),this}rangeLt(i,l){return this.url.searchParams.append(i,`sl.${l}`),this}rangeLte(i,l){return this.url.searchParams.append(i,`nxr.${l}`),this}rangeAdjacent(i,l){return this.url.searchParams.append(i,`adj.${l}`),this}overlaps(i,l){return typeof l=="string"?this.url.searchParams.append(i,`ov.${l}`):this.url.searchParams.append(i,`ov.{${l.join(",")}}`),this}textSearch(i,l,{config:u,type:f}={}){let v="";f==="plain"?v="pl":f==="phrase"?v="ph":f==="websearch"&&(v="w");const g=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${v}fts${g}.${l}`),this}match(i){return Object.entries(i).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(i,l,u){return this.url.searchParams.append(i,`not.${l}.${u}`),this}or(i,{foreignTable:l,referencedTable:u=l}={}){const f=u?`${u}.or`:"or";return this.url.searchParams.append(f,`(${i})`),this}filter(i,l,u){return this.url.searchParams.append(i,`${l}.${u}`),this}}return Wr.default=t,Wr}var gl;function Cu(){if(gl)return Br;gl=1;var n=Br&&Br.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Br,"__esModule",{value:!0});const e=n(Qa());class t{constructor(i,{headers:l={},schema:u,fetch:f}){this.url=i,this.headers=new Headers(l),this.schema=u,this.fetch=f}select(i,{head:l=!1,count:u}={}){const f=l?"HEAD":"GET";let v=!1;const g=(i??"*").split("").map(m=>/\s/.test(m)&&!v?"":(m==='"'&&(v=!v),m)).join("");return this.url.searchParams.set("select",g),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:l,defaultToNull:u=!0}={}){var f;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const g=i.reduce((m,w)=>m.concat(Object.keys(w)),[]);if(g.length>0){const m=[...new Set(g)].map(w=>`"${w}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(i,{onConflict:l,ignoreDuplicates:u=!1,count:f,defaultToNull:v=!0}={}){var g;const m="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),f&&this.headers.append("Prefer",`count=${f}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const w=i.reduce((S,p)=>S.concat(Object.keys(p)),[]);if(w.length>0){const S=[...new Set(w)].map(p=>`"${p}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}update(i,{count:l}={}){var u;const f="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:i}={}){var l;const u="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Br.default=t,Br}var _l;function nf(){if(_l)return Nr;_l=1;var n=Nr&&Nr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Nr,"__esModule",{value:!0});const e=n(Cu()),t=n(Qa());class r{constructor(l,{headers:u={},schema:f,fetch:v}={}){this.url=l,this.headers=new Headers(u),this.schemaName=f,this.fetch=v}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:f=!1,get:v=!1,count:g}={}){var m;let w;const S=new URL(`${this.url}/rpc/${l}`);let p;f||v?(w=f?"HEAD":"GET",Object.entries(u).filter(([R,x])=>x!==void 0).map(([R,x])=>[R,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([R,x])=>{S.searchParams.append(R,x)})):(w="POST",p=u);const k=new Headers(this.headers);return g&&k.set("Prefer",`count=${g}`),new t.default({method:w,url:S,headers:k,schema:this.schemaName,body:p,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}}return Nr.default=r,Nr}var ml;function rf(){if(ml)return Kt;ml=1;var n=Kt&&Kt.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PostgrestError=Kt.PostgrestBuilder=Kt.PostgrestTransformBuilder=Kt.PostgrestFilterBuilder=Kt.PostgrestQueryBuilder=Kt.PostgrestClient=void 0;const e=n(nf());Kt.PostgrestClient=e.default;const t=n(Cu());Kt.PostgrestQueryBuilder=t.default;const r=n(Qa());Kt.PostgrestFilterBuilder=r.default;const i=n(Au());Kt.PostgrestTransformBuilder=i.default;const l=n(Eu());Kt.PostgrestBuilder=l.default;const u=n(Su());return Kt.PostgrestError=u.default,Kt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:u.default},Kt}var sf=rf();const af=Yd(sf),{PostgrestClient:of,PostgrestQueryBuilder:b_,PostgrestFilterBuilder:k_,PostgrestTransformBuilder:I_,PostgrestBuilder:S_,PostgrestError:E_}=af;class lf{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const uf="2.15.1",cf=`realtime-js/${uf}`,df="1.0.0",Aa=1e4,ff=1e3,hf=100;var Ti;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ti||(Ti={}));var qt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(qt||(qt={}));var bn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(bn||(bn={}));var Ca;(function(n){n.websocket="websocket"})(Ca||(Ca={}));var Ir;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ir||(Ir={}));class vf{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const f=r.decode(e.slice(u,u+i));u=u+i;const v=r.decode(e.slice(u,u+l));u=u+l;const g=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:f,event:v,payload:g}}}class ju{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Pt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Pt||(Pt={}));const yl=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,u)=>(l[u]=pf(u,n,e,i),l),{})},pf=(n,e,t,r)=>{const i=e.find(f=>f.name===n),l=i?.type,u=t[n];return l&&!r.includes(l)?Tu(l,u):ja(u)},Tu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return yf(e,t)}switch(n){case Pt.bool:return gf(e);case Pt.float4:case Pt.float8:case Pt.int2:case Pt.int4:case Pt.int8:case Pt.numeric:case Pt.oid:return _f(e);case Pt.json:case Pt.jsonb:return mf(e);case Pt.timestamp:return wf(e);case Pt.abstime:case Pt.date:case Pt.daterange:case Pt.int4range:case Pt.int8range:case Pt.money:case Pt.reltime:case Pt.text:case Pt.time:case Pt.timestamptz:case Pt.timetz:case Pt.tsrange:case Pt.tstzrange:return ja(e);default:return ja(e)}},ja=n=>n,gf=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},_f=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},mf=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},yf=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const u=n.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(f=>Tu(e,f))}return n},wf=n=>typeof n=="string"?n.replace(" ","T"):n,xu=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class aa{constructor(e,t,r={},i=Aa){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var wl;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(wl||(wl={}));class xi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:l,onLeave:u,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xi.syncState(this.state,i,l,u),this.pendingDiffs.forEach(v=>{this.state=xi.syncDiff(this.state,v,l,u)}),this.pendingDiffs=[],f()}),this.channel._on(r.diff,{},i=>{const{onJoin:l,onLeave:u,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=xi.syncDiff(this.state,i,l,u),f())}),this.onJoin((i,l,u)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:l,newPresences:u})}),this.onLeave((i,l,u)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const l=this.cloneDeep(e),u=this.transformState(t),f={},v={};return this.map(l,(g,m)=>{u[g]||(v[g]=m)}),this.map(u,(g,m)=>{const w=l[g];if(w){const S=m.map(x=>x.presence_ref),p=w.map(x=>x.presence_ref),k=m.filter(x=>p.indexOf(x.presence_ref)<0),R=w.filter(x=>S.indexOf(x.presence_ref)<0);k.length>0&&(f[g]=k),R.length>0&&(v[g]=R)}else f[g]=m}),this.syncDiff(l,{joins:f,leaves:v},r,i)}static syncDiff(e,t,r,i){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(l,(f,v)=>{var g;const m=(g=e[f])!==null&&g!==void 0?g:[];if(e[f]=this.cloneDeep(v),m.length>0){const w=e[f].map(p=>p.presence_ref),S=m.filter(p=>w.indexOf(p.presence_ref)<0);e[f].unshift(...S)}r(f,m,v)}),this.map(u,(f,v)=>{let g=e[f];if(!g)return;const m=v.map(w=>w.presence_ref);g=g.filter(w=>m.indexOf(w.presence_ref)<0),e[f]=g,i(f,g,v),g.length===0&&delete e[f]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bl;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(bl||(bl={}));var Pi;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Pi||(Pi={}));var Bn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Bn||(Bn={}));class Za{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new aa(this,bn.join,this.params,this.timeout),this.rejoinTimer=new ju(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(bn.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new xi(this),this.broadcastEndpointURL=xu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==qt.closed){const{config:{broadcast:l,presence:u,private:f}}=this.params,v=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(S=>S.filter))!==null&&i!==void 0?i:[],g=!!this.bindings[Pi.PRESENCE]&&this.bindings[Pi.PRESENCE].length>0,m={},w={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:g}),postgres_changes:v,private:f};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(S=>e?.(Bn.CHANNEL_ERROR,S)),this._onClose(()=>e?.(Bn.CLOSED)),this.updateJoinPayload(Object.assign({config:w},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var p;if(this.socket.setAuth(),S===void 0){e?.(Bn.SUBSCRIBED);return}else{const k=this.bindings.postgres_changes,R=(p=k?.length)!==null&&p!==void 0?p:0,x=[];for(let F=0;F<R;F++){const z=k[F],{filter:{event:M,schema:U,table:$,filter:C}}=z,P=S&&S[F];if(P&&P.event===M&&P.schema===U&&P.table===$&&P.filter===C)x.push(Object.assign(Object.assign({},z),{id:P.id}));else{this.unsubscribe(),this.state=qt.errored,e?.(Bn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(Bn.SUBSCRIBED);return}}).receive("error",S=>{this.state=qt.errored,e?.(Bn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.(Bn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===qt.joined&&e===Pi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const g=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=g.body)===null||i===void 0?void 0:i.cancel()),g.ok?"ok":"error"}catch(g){return g.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,f,v;const g=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(f=(u=this.params)===null||u===void 0?void 0:u.config)===null||f===void 0?void 0:f.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),g.receive("ok",()=>l("ok")),g.receive("error",()=>l("error")),g.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(bn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new aa(this,bn.leave,{},e),r.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const i=new AbortController,l=setTimeout(()=>i.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(l),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new aa(this,e,t,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>hf){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,l;const u=e.toLocaleLowerCase(),{close:f,error:v,leave:g,join:m}=bn;if(r&&[f,v,g,m].indexOf(u)>=0&&r!==this._joinRef())return;let S=this._onMessage(u,t,r);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var k,R,x;return((k=p.filter)===null||k===void 0?void 0:k.event)==="*"||((x=(R=p.filter)===null||R===void 0?void 0:R.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===u}).map(p=>p.callback(S,r)):(l=this.bindings[u])===null||l===void 0||l.filter(p=>{var k,R,x,F,z,M;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const U=p.id,$=(k=p.filter)===null||k===void 0?void 0:k.event;return U&&((R=t.ids)===null||R===void 0?void 0:R.includes(U))&&($==="*"||$?.toLocaleLowerCase()===((x=t.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const U=(z=(F=p?.filter)===null||F===void 0?void 0:F.event)===null||z===void 0?void 0:z.toLocaleLowerCase();return U==="*"||U===((M=t?.event)===null||M===void 0?void 0:M.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof S=="object"&&"ids"in S){const k=S.data,{schema:R,table:x,commit_timestamp:F,type:z,errors:M}=k;S=Object.assign(Object.assign({},{schema:R,table:x,commit_timestamp:F,eventType:z,new:{},old:{},errors:M}),this._getPayloadRecords(k))}p.callback(S,r)})}_isClosed(){return this.state===qt.closed}_isJoined(){return this.state===qt.joined}_isJoining(){return this.state===qt.joining}_isLeaving(){return this.state===qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),l={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(l):this.bindings[i]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var l;return!(((l=i.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Za.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(bn.close,{},e)}_onError(e){this._on(bn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=yl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=yl(e.columns,e.old_record)),t}}const kl=()=>{},ds={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},bf=[1e3,2e3,5e3,1e4],kf=1e4,If=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Sf{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Aa,this.transport=null,this.heartbeatIntervalMs=ds.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kl,this.ref=0,this.reconnectTimer=null,this.logger=kl,this.conn=null,this.sendBuffer=[],this.serializer=new vf,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...u)=>$i(async()=>{const{default:f}=await Promise.resolve().then(()=>vi);return{default:f}},void 0,import.meta.url).then(({default:f})=>f(...u)).catch(f=>{throw new Error(`Failed to load @supabase/node-fetch: ${f.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ca.websocket}`,this.httpEndpoint=xu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lf.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:df}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ti.connecting:return Ir.Connecting;case Ti.open:return Ir.Open;case Ti.closing:return Ir.Closing;default:return Ir.Closed}}isConnected(){return this.connectionState()===Ir.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(l=>l.topic===r);if(i)return i;{const l=new Za(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:i,ref:l}=e,u=()=>{this.encode(e,f=>{var v;(v=this.conn)===null||v===void 0||v.send(f)})};this.log("push",`${t} ${r} (${l})`,i),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ff,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ds.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:l,ref:u}=t,f=u?`(${u})`:"",v=l.status||"";this.log("receive",`${v} ${r} ${i} ${f}`.trim(),l),this.channels.filter(g=>g._isMember(r)).forEach(g=>g._trigger(i,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(bn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([If],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const i={access_token:t,version:cf};t&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(bn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ju(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ds.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,i,l,u,f,v,g;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Aa,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:ds.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(m=>bf[m-1]||kf),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((m,w)=>w(JSON.stringify(m))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class eo extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Gt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ef extends eo{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ta extends eo{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Af=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};const Pu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Cf=()=>Af(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $i(()=>Promise.resolve().then(()=>vi),void 0,import.meta.url)).Response:Response}),xa=n=>{if(Array.isArray(n))return n.map(t=>xa(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[i]=xa(r)}),e},jf=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Or=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};const oa=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Tf=(n,e,t)=>Or(void 0,void 0,void 0,function*(){const r=yield Cf();n instanceof r&&!t?.noResolveJson?n.json().then(i=>{const l=n.status||500,u=i?.statusCode||l+"";e(new Ef(oa(i),l,u))}).catch(i=>{e(new Ta(oa(i),i))}):e(new Ta(oa(n),n))}),xf=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"||!r?i:(jf(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(r)):i.body=r,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function Ui(n,e,t,r,i,l){return Or(this,void 0,void 0,function*(){return new Promise((u,f)=>{n(t,xf(e,r,i,l)).then(v=>{if(!v.ok)throw v;return r?.noResolveJson?v:v.json()}).then(v=>u(v)).catch(v=>Tf(v,f,r))})})}function Is(n,e,t,r){return Or(this,void 0,void 0,function*(){return Ui(n,"GET",e,t,r)})}function jn(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"POST",e,r,i,t)})}function Pa(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"PUT",e,r,i,t)})}function Pf(n,e,t,r){return Or(this,void 0,void 0,function*(){return Ui(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Ru(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"DELETE",e,r,i,t)})}var en=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};const Rf={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Il={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Of{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Pu(i)}uploadOrUpdate(e,t,r,i){return en(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},Il),i);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const v=u.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=r,f["cache-control"]=`max-age=${u.cacheControl}`,f["content-type"]=u.contentType,v&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),i?.headers&&(f=Object.assign(Object.assign({},f),i.headers));const g=this._removeEmptyFolders(t),m=this._getFinalPath(g),w=yield(e=="PUT"?Pa:jn)(this.fetch,`${this.url}/object/${m}`,l,Object.assign({headers:f},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:g,id:w.Id,fullPath:w.Key},error:null}}catch(l){if(Gt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return en(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),f=new URL(this.url+`/object/upload/sign/${u}`);f.searchParams.set("token",t);try{let v;const g=Object.assign({upsert:Il.upsert},i),m=Object.assign(Object.assign({},this.headers),{"x-upsert":String(g.upsert)});typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",g.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",g.cacheControl)):(v=r,m["cache-control"]=`max-age=${g.cacheControl}`,m["content-type"]=g.contentType);const w=yield Pa(this.fetch,f.toString(),v,{headers:m});return{data:{path:l,fullPath:w.Key},error:null}}catch(v){if(Gt(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return en(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const l=yield jn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),u=new URL(this.url+l.url),f=u.searchParams.get("token");if(!f)throw new eo("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:f},error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}update(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return en(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}copy(e,t,r){return en(this,void 0,void 0,function*(){try{return{data:{path:(yield jn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return en(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),l=yield jn(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return en(this,void 0,void 0,function*(){try{const i=yield jn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}download(e,t){return en(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const f=this._getFinalPath(e);return{data:yield(yield Is(this.fetch,`${this.url}/${i}/${f}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(f){if(Gt(f))return{data:null,error:f};throw f}})}info(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Is(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:xa(r),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}exists(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Pf(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Gt(r)&&r instanceof Ta){const i=r.originalError;if([400,404].includes(i?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&i.push(l);const f=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&i.push(v);let g=i.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${g}`)}}}remove(e){return en(this,void 0,void 0,function*(){try{return{data:yield Ru(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}list(e,t,r){return en(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Rf),t),{prefix:e||""});return{data:yield jn(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}listV2(e,t){return en(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield jn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Mf="2.11.0",Lf={"X-Client-Info":`storage-js/${Mf}`};var Gr=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};class Df{constructor(e,t={},r,i){const l=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Lf),t),this.fetch=Pu(r)}listBuckets(){return Gr(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Gt(e))return{data:null,error:e};throw e}})}getBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Gr(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Gr(this,void 0,void 0,function*(){try{return{data:yield Pa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield Ru(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}}class Ff extends Df{constructor(e,t={},r,i){super(e,t,r,i)}from(e){return new Of(this.url,this.headers,e,this.fetch)}}const $f="2.56.0";let Ci="";typeof Deno<"u"?Ci="deno":typeof document<"u"?Ci="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ci="react-native":Ci="node";const Uf={"X-Client-Info":`supabase-js-${Ci}/${$f}`},Nf={headers:Uf},Bf={schema:"public"},Wf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vf={};var qf=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};const Gf=n=>{let e;return n?e=n:typeof fetch>"u"?e=ku:e=fetch,(...t)=>e(...t)},zf=()=>typeof Headers>"u"?Iu:Headers,Hf=(n,e,t)=>{const r=Gf(t),i=zf();return(l,u)=>qf(void 0,void 0,void 0,function*(){var f;const v=(f=yield e())!==null&&f!==void 0?f:n;let g=new i(u?.headers);return g.has("apikey")||g.set("apikey",n),g.has("Authorization")||g.set("Authorization",`Bearer ${v}`),r(l,Object.assign(Object.assign({},u),{headers:g}))})};var Kf=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};function Yf(n){return n.endsWith("/")?n:n+"/"}function Jf(n,e){var t,r;const{db:i,auth:l,realtime:u,global:f}=n,{db:v,auth:g,realtime:m,global:w}=e,S={db:Object.assign(Object.assign({},v),i),auth:Object.assign(Object.assign({},g),l),realtime:Object.assign(Object.assign({},m),u),storage:{},global:Object.assign(Object.assign(Object.assign({},w),f),{headers:Object.assign(Object.assign({},(t=w?.headers)!==null&&t!==void 0?t:{}),(r=f?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Kf(this,void 0,void 0,function*(){return""})};return n.accessToken?S.accessToken=n.accessToken:delete S.accessToken,S}const Ou="2.71.1",Xr=30*1e3,Ra=3,la=Ra*Xr,Xf="http://localhost:9999",Qf="supabase.auth.token",Zf={"X-Client-Info":`gotrue-js/${Ou}`},Oa="X-Supabase-Api-Version",Mu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},eh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,th=600*1e3;class to extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Xe(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class nh extends to{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function rh(n){return Xe(n)&&n.name==="AuthApiError"}class Lu extends to{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ar extends to{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class Yn extends ar{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ih(n){return Xe(n)&&n.name==="AuthSessionMissingError"}class fs extends ar{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class hs extends ar{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vs extends ar{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function sh(n){return Xe(n)&&n.name==="AuthImplicitGrantRedirectError"}class Sl extends ar{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ma extends ar{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ua(n){return Xe(n)&&n.name==="AuthRetryableFetchError"}class El extends ar{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class La extends ar{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Al=` 	
\r=`.split(""),ah=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Al.length;e+=1)n[Al[e].charCodeAt(0)]=-2;for(let e=0;e<Ss.length;e+=1)n[Ss[e].charCodeAt(0)]=e;return n})();function Cl(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ss[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ss[r]),e.queuedBits-=6}}function Du(n,e,t){const r=ah[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function jl(n){const e=[],t=u=>{e.push(String.fromCodePoint(u))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},l=u=>{uh(u,r,t)};for(let u=0;u<n.length;u+=1)Du(n.charCodeAt(u),i,l);return e.join("")}function oh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function lh(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}oh(r,e)}}function uh(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ch(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)Du(n.charCodeAt(i),t,r);return new Uint8Array(e)}function dh(n){const e=[];return lh(n,t=>e.push(t)),new Uint8Array(e)}function fh(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return n.forEach(i=>Cl(i,t,r)),Cl(null,t,r),e.join("")}function hh(n){return Math.round(Date.now()/1e3)+n}function vh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const yn=()=>typeof window<"u"&&typeof document<"u",_r={tested:!1,writable:!1},Fu=()=>{if(!yn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_r.tested)return _r.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),_r.tested=!0,_r.writable=!0}catch{_r.tested=!0,_r.writable=!1}return _r.writable};function ph(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,l)=>{e[l]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const $u=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},gh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Qr=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},mr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Kn=async(n,e)=>{await n.removeItem(e)};class Fs{constructor(){this.promise=new Fs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Fs.promiseConstructor=Promise;function ca(n){const e=n.split(".");if(e.length!==3)throw new La("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!eh.test(e[r]))throw new La("JWT not in base64url format");return{header:JSON.parse(jl(e[0])),payload:JSON.parse(jl(e[1])),signature:ch(e[2]),raw:{header:e[0],payload:e[1]}}}async function _h(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function mh(n,e){return new Promise((r,i)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await n(l);if(!e(l,null,u)){r(u);return}}catch(u){if(!e(l,u)){i(u);return}}})()})}function yh(n){return("0"+n.toString(16)).substr(-2)}function wh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let l=0;l<56;l++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,yh).join("")}async function bh(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(l=>String.fromCharCode(l)).join("")}async function kh(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await bh(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function zr(n,e,t=!1){const r=wh();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await Qr(n,`${e}-code-verifier`,i);const l=await kh(r);return[l,r===l?"plain":"s256"]}const Ih=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Sh(n){const e=n.headers.get(Oa);if(!e||!e.match(Ih))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Eh(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Ah(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ch=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Hr(n){if(!Ch.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function da(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Tl(n){return JSON.parse(JSON.stringify(n))}var jh=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const br=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Th=[502,503,504];async function xl(n){var e;if(!gh(n))throw new Ma(br(n),0);if(Th.includes(n.status))throw new Ma(br(n),n.status);let t;try{t=await n.json()}catch(l){throw new Lu(br(l),l)}let r;const i=Sh(n);if(i&&i.getTime()>=Mu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new El(br(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Yn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new El(br(t),n.status,t.weak_password.reasons);throw new nh(br(t),n.status||500,r)}const xh=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function ot(n,e,t,r){var i;const l=Object.assign({},r?.headers);l[Oa]||(l[Oa]=Mu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const u=(i=r?.query)!==null&&i!==void 0?i:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const f=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",v=await Ph(n,e,t+f,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(v):{data:Object.assign({},v),error:null}}async function Ph(n,e,t,r,i,l){const u=xh(e,r,i,l);let f;try{f=await n(t,Object.assign({},u))}catch(v){throw console.error(v),new Ma(br(v),0)}if(f.ok||await xl(f),r?.noResolveJson)return f;try{return await f.json()}catch(v){await xl(v)}}function Nn(n){var e;let t=null;Lh(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=hh(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Pl(n){const e=Nn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Xn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Rh(n){return{data:n,error:null}}function Oh(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:l}=n,u=jh(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:l},v=Object.assign({},u);return{data:{properties:f,user:v},error:null}}function Mh(n){return n}function Lh(n){return n.access_token&&n.refresh_token&&n.expires_in}const fa=["global","local","others"];var Dh=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class Fh{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=$u(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=fa[0]){if(fa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fa.join(", ")}`);try{return await ot(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Xe(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ot(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Xn})}catch(r){if(Xe(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Dh(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r?.newEmail,delete i.newEmail),await ot(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Oh,redirectTo:t?.redirectTo})}catch(t){if(Xe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ot(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Xn})}catch(t){if(Xe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,l,u,f,v;try{const g={nextPage:null,lastPage:0,total:0},m=await ot(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:Mh});if(m.error)throw m.error;const w=await m.json(),S=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(v=(f=m.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&v!==void 0?v:[];return p.length>0&&(p.forEach(k=>{const R=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(k.split(";")[1].split("=")[1]);g[`${x}Page`]=R}),g.total=parseInt(S)),{data:Object.assign(Object.assign({},w),g),error:null}}catch(g){if(Xe(g))return{data:{users:[]},error:g};throw g}}async getUserById(e){Hr(e);try{return await ot(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Xn})}catch(t){if(Xe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Hr(e);try{return await ot(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Xn})}catch(r){if(Xe(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Hr(e);try{return await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Xn})}catch(r){if(Xe(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Hr(e.userId);try{const{data:t,error:r}=await ot(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(Xe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Hr(e.userId),Hr(e.id);try{return{data:await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Xe(t))return{data:null,error:t};throw t}}}function Rl(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function $h(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Kr={debug:!!(globalThis&&Fu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Uu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Uh extends Uu{}async function Nh(n,e,t){Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Uh(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Kr.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}$h();const Bh={url:Xf,storageKey:Qf,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ol(n,e,t){return await t()}const Yr={};class Li{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Li.nextInstanceID,Li.nextInstanceID+=1,this.instanceID>0&&yn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Bh),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Fh({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=$u(i.fetch),this.lock=i.lock||Ol,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:yn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Nh:this.lock=Ol,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Fu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Rl(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Rl(this.memoryStorage)),yn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ou}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ph(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),yn()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),sh(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:f}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",f),await this._saveSession(u),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Xe(t)?{error:t}:{error:new Lu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Nn}),{data:u,error:f}=l;if(f||!u)return{data:{user:null,session:null},error:f};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Xe(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,i;try{let l;if("email"in e){const{email:m,password:w,options:S}=e;let p=null,k=null;this.flowType==="pkce"&&([p,k]=await zr(this.storage,this.storageKey)),l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:m,password:w,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:p,code_challenge_method:k},xform:Nn})}else if("phone"in e){const{phone:m,password:w,options:S}=e;l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:w,data:(r=S?.data)!==null&&r!==void 0?r:{},channel:(i=S?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Nn})}else throw new hs("You must provide either an email or phone number and a password");const{data:u,error:f}=l;if(f||!u)return{data:{user:null,session:null},error:f};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Xe(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:f}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Pl})}else if("phone"in e){const{phone:l,password:u,options:f}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Pl})}else throw new hs("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new fs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(Xe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,i,l,u,f,v,g,m,w,S,p;let k,R;if("message"in e)k=e.message,R=e.signature;else{const{chain:x,wallet:F,statement:z,options:M}=e;let U;if(yn())if(typeof F=="object")U=F;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))U=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof F!="object"||!M?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");U=F}const $=new URL((t=M?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in U&&U.signIn){const C=await U.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},M?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),z?{statement:z}:null));let P;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")P=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)P=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)k=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),R=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in U)||typeof U.signMessage!="function"||!("publicKey"in U)||typeof U!="object"||!U.publicKey||!("toBase58"in U.publicKey)||typeof U.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");k=[`${$.host} wants you to sign in with your Solana account:`,U.publicKey.toBase58(),...z?["",z,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(i=(r=M?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((l=M?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${M.signInWithSolana.notBefore}`]:[],...!((u=M?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${M.signInWithSolana.expirationTime}`]:[],...!((f=M?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${M.signInWithSolana.chainId}`]:[],...!((v=M?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${M.signInWithSolana.nonce}`]:[],...!((g=M?.signInWithSolana)===null||g===void 0)&&g.requestId?[`Request ID: ${M.signInWithSolana.requestId}`]:[],...!((w=(m=M?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||w===void 0)&&w.length?["Resources",...M.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const C=await U.signMessage(new TextEncoder().encode(k),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");R=C}}try{const{data:x,error:F}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:k,signature:fh(R)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Nn});if(F)throw F;return!x||!x.session||!x.user?{data:{user:null,session:null},error:new fs}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign({},x),error:F})}catch(x){if(Xe(x))return{data:{user:null,session:null},error:x};throw x}}async _exchangeCodeForSession(e){const t=await mr(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:l,error:u}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Nn});if(await Kn(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new fs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:i??null}),error:u})}catch(l){if(Xe(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:l,nonce:u}=e,f=await ot(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Nn}),{data:v,error:g}=f;return g?{data:{user:null,session:null},error:g}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new fs}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:g})}catch(t){if(Xe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,l,u;try{if("email"in e){const{email:f,options:v}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await zr(this.storage,this.storageKey));const{error:w}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(r=v?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:g,code_challenge_method:m},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:f,options:v}=e,{data:g,error:m}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(i=v?.data)!==null&&i!==void 0?i:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(u=v?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:g?.message_id},error:m}}throw new hs("You must provide either an email or phone number.")}catch(f){if(Xe(f))return{data:{user:null,session:null},error:f};throw f}}async verifyOtp(e){var t,r;try{let i,l;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:f}=await ot(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:i,xform:Nn});if(f)throw f;if(!u)throw new Error("An error occurred on token verification.");const v=u.session,g=u.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(i){if(Xe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await zr(this.storage,this.storageKey)),await ot(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Rh})}catch(l){if(Xe(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Yn;const{error:i}=await ot(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Xe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:l}=e,{error:u}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:i,options:l}=e,{data:u,error:f}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:f}}throw new hs("You must provide either an email or phone number and a type")}catch(t){if(Xe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await mr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<la:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const u=await mr(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=da()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,g,m)=>(!u&&g==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,g,m))})}return{data:{session:e},error:null}}const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Xn}):await this._useSession(async t=>{var r,i,l;const{data:u,error:f}=t;if(f)throw f;return!(!((r=u.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yn}:await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&l!==void 0?l:void 0,xform:Xn})})}catch(t){if(Xe(t))return ih(t)&&(await this._removeSession(),await Kn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:l}=r;if(l)throw l;if(!i.session)throw new Yn;const u=i.session;let f=null,v=null;this.flowType==="pkce"&&e.email!=null&&([f,v]=await zr(this.storage,this.storageKey));const{data:g,error:m}=await ot(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:v}),jwt:u.access_token,xform:Xn});if(m)throw m;return u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(Xe(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yn;const t=Date.now()/1e3;let r=t,i=!0,l=null;const{payload:u}=ca(e.access_token);if(u.exp&&(r=u.exp,i=r<=t),i){const{session:f,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!f)return{data:{user:null,session:null},error:null};l=f}else{const{data:f,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Xe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:f}=t;if(f)throw f;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Yn;const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Xe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!yn())throw new vs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Sl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Sl("No code detected.");const{data:z,error:M}=await this._exchangeCodeForSession(e.code);if(M)throw M;const U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:z.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:l,refresh_token:u,expires_in:f,expires_at:v,token_type:g}=e;if(!l||!f||!u||!g)throw new vs("No session defined in URL");const m=Math.round(Date.now()/1e3),w=parseInt(f);let S=m+w;v&&(S=parseInt(v));const p=S-m;p*1e3<=Xr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${w}s`);const k=S-w;m-k>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",k,S,m):m-k<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",k,S,m);const{data:R,error:x}=await this._getUser(l);if(x)throw x;const F={provider_token:r,provider_refresh_token:i,access_token:l,expires_in:w,expires_at:S,refresh_token:u,token_type:g,user:R.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:F,redirectType:e.type},error:null}}catch(r){if(Xe(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:l}=t;if(l)return{error:l};const u=(r=i.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:f}=await this.admin.signOut(u,e);if(f&&!(rh(f)&&(f.status===404||f.status===401||f.status===403)))return{error:f}}return e!=="others"&&(await this._removeSession(),await Kn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=vh(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:l},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await zr(this.storage,this.storageKey,!0));try{return await ot(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Xe(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Xe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async l=>{var u,f,v,g,m;const{data:w,error:S}=l;if(S)throw S;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await ot(this.fetch,"GET",p,{headers:this.headers,jwt:(m=(g=w.session)===null||g===void 0?void 0:g.access_token)!==null&&m!==void 0?m:void 0})});if(i)throw i;return yn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Xe(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:l,error:u}=t;if(u)throw u;return await ot(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(Xe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await mh(async i=>(i>0&&await _h(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await ot(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Nn})),(i,l)=>{const u=200*Math.pow(2,i);return l&&ua(l)&&Date.now()+u-r<Xr})}catch(r){if(this._debug(t,"error",r),Xe(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),yn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await mr(this.storage,this.storageKey);if(i&&this.userStorage){let u=await mr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},await Qr(this.userStorage,this.storageKey+"-user",u)),i.user=(e=u?.user)!==null&&e!==void 0?e:da()}else if(i&&!i.user&&!i.user){const u=await mr(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,await Kn(this.storage,this.storageKey+"-user"),await Qr(this.storage,this.storageKey,i)):i.user=da()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const l=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<la;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${la}s`),l){if(this.autoRefreshToken&&i.refresh_token){const{error:u}=await this._callRefreshToken(i.refresh_token);u&&(console.error(u),ua(u)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:f}=await this._getUser(i.access_token);!f&&u?.user?(i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(r,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Yn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Fs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new Yn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const f={session:l.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(l){if(this._debug(i,"error",l),Xe(l)){const u={session:null,error:l};return ua(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(u),l.length>0){for(let f=0;f<l.length;f+=1)console.error(l[f]);throw l[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Qr(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const l=Tl(i);await Qr(this.storage,this.storageKey,l)}else{const i=Tl(t);await Qr(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Kn(this.storage,this.storageKey),await Kn(this.storage,this.storageKey+"-code-verifier"),await Kn(this.storage,this.storageKey+"-user"),this.userStorage&&await Kn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&yn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Xr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Xr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Xr}ms, refresh threshold is ${Ra} ticks`),i<=Ra&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Uu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!yn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,u]=await zr(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(f.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);i.push(l.toString())}return r?.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Xe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:l,error:u}=t;if(u)return{data:null,error:u};const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:g}=await ot(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return g?{data:null,error:g}:(e.factorType==="totp"&&(!((i=v?.totp)===null||i===void 0)&&i.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(Xe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:f}=await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:f})})}catch(t){if(Xe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Xe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],i=r.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=r.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:r,totp:i,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:l}=e;if(l)return{data:null,error:l};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ca(i.access_token);let f=null;u.aal&&(f=u.aal);let v=f;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(v="aal2");const m=u.amr||[];return{data:{currentLevel:f,nextLevel:v,currentAuthenticationMethods:m},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(f=>f.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(f=>f.kid===e),r&&this.jwks_cached_at+th>i)return r;const{data:l,error:u}=await ot(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=i,r=l.keys.find(f=>f.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:p,error:k}=await this.getSession();if(k||!p.session)return{data:null,error:k};r=p.session.access_token}const{header:i,payload:l,signature:u,raw:{header:f,payload:v}}=ca(r);t?.allowExpired||Eh(l.exp);const g=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!g){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:l,header:i,signature:u},error:null}}const m=Ah(i.alg),w=await crypto.subtle.importKey("jwk",g,m,!0,["verify"]);if(!await crypto.subtle.verify(m,w,u,dh(`${f}.${v}`)))throw new La("Invalid JWT signature");return{data:{claims:l,header:i,signature:u},error:null}}catch(r){if(Xe(r))return{data:null,error:r};throw r}}}Li.nextInstanceID=0;const Wh=Li;class Vh extends Wh{constructor(e){super(e)}}var qh=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(m){try{g(r.next(m))}catch(w){u(w)}}function v(m){try{g(r.throw(m))}catch(w){u(w)}}function g(m){m.done?l(m.value):i(m.value).then(f,v)}g((r=r.apply(n,e||[])).next())})};class Gh{constructor(e,t,r){var i,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=Yf(e),v=new URL(f);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const g=`sb-${v.hostname.split(".")[0]}-auth-token`,m={db:Bf,realtime:Vf,auth:Object.assign(Object.assign({},Wf),{storageKey:g}),global:Nf},w=Jf(r??{},m);this.storageKey=(i=w.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(l=w.global.headers)!==null&&l!==void 0?l:{},w.accessToken?(this.accessToken=w.accessToken,this.auth=new Proxy({},{get:(S,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=w.auth)!==null&&u!==void 0?u:{},this.headers,w.global.fetch),this.fetch=Hf(t,this._getAccessToken.bind(this),w.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},w.realtime)),this.rest=new of(new URL("rest/v1",v).href,{headers:this.headers,schema:w.db.schema,fetch:this.fetch}),this.storage=new Ff(this.storageUrl.href,this.headers,this.fetch,r?.storage),w.accessToken||this._listenForAuthEvents()}get functions(){return new Kd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return qh(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:l,flowType:u,lock:f,debug:v},g,m){const w={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Vh({url:this.authUrl.href,headers:Object.assign(Object.assign({},w),g),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:u,lock:f,debug:v,fetch:m,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Sf(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const zh=(n,e,t)=>new Gh(n,e,t);function Hh(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Hh()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Kh="https://vycjpmuyscfygstjjied.supabase.co",Yh="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Tn=zh(Kh,Yh,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),nr={async loadStoriesList(){if(!B.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${B.selectedBucket}`);const n=`${B.selectedBucket}_story.json`,{data:e,error:t}=await Tn.storage.from(B.selectedBucket).list("",{search:n});console.log(`[ResourceStore] Проверка файла ${n}:`,{files:e,error:t}),!t&&e&&e.some(r=>r.name===n)?(B.storiesList=[n],console.log(`[ResourceStore] Найден файл: ${n}`)):(B.storiesList=[],console.warn(`[ResourceStore] Файл ${n} не найден`))},async loadStoredResources(){if(!B.selectedBucket){console.warn("No bucket selected");return}const{data:n}=await Tn.storage.from(B.selectedBucket).list();n&&(B.storedFiles=n.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(n){const e=n.target;if(!e.files||e.files.length===0)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история");return}const t=e.files[0];wt.setStatus("loading","Загрузка файла...");const r=await t.arrayBuffer(),i=new Uint8Array(r),{error:l}=await Tn.storage.from(B.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});l?wt.setStatus("error","Ошибка загрузки"):(wt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(n){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история");return}const{error:e}=await Tn.storage.from(B.selectedBucket).remove([n]);e?wt.setStatus("error","Ошибка удаления файла"):(wt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Jh(n){return n.dialogues&&n.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),n.chapters||(n.chapters=[{id:"main",title:"Основная история",description:""}],n.dialogues&&n.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),n.chapters&&n.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),n.items||(n.items=[]),n.meta||(n.meta={version:"3.1",title:n.title||"Untitled"}),n.miniGames&&Array.isArray(n.miniGames)&&(n.miniGames=n.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),n}function Xh(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const Pn={async createNewStory(){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}const n=prompt("Введите имя файла истории:","new_story.json");if(!n)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:l}=await Tn.storage.from(B.selectedBucket).upload(n,i,{contentType:"application/json"});l?wt.setStatus("error","Ошибка создания: "+l.message):(await nr.loadStoriesList(),await this.loadStory(n))},async loadStory(n){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${n} из bucket: ${B.selectedBucket}`),wt.setStatus("loading","Загрузка..."),B.currentFileName=n;try{const{data:e,error:t}=await Tn.storage.from(B.selectedBucket).download(n);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let r;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Tn.storage.from(B.selectedBucket).getPublicUrl(n).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);r=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${r.length}`)}else r=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${r.length}`);let i=JSON.parse(r);console.log("[StoryStore] Данные распарсены:",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=Jh(i),console.log("[StoryStore] Присваиваем данные в editor.data"),B.data=i,console.log("[StoryStore] editor.data обновлен:",{chapters:B.data.chapters?.length,dialogues:B.data.dialogues?.length}),B.data.chapters&&B.data.chapters.length>0&&(B.selectedChapterId=B.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${B.selectedChapterId}`)),B.data.dialogues&&B.data.dialogues.length>0&&(B.selectedDialogueId=B.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${B.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),wt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),wt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!B.data)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}wt.setStatus("loading","Сохранение...");const n=JSON.stringify(B.data,null,2);console.log(`[StoryStore] Сохранение файла: ${B.currentFileName}, размер: ${n.length} байт`);const t=new TextEncoder().encode(n),{error:r}=await Tn.storage.from(B.selectedBucket).update(B.currentFileName,t,{contentType:"application/json"});if(r){console.error("[StoryStore] Ошибка сохранения (update):",r),console.log("[StoryStore] Пробуем upload вместо update");const i=await Tn.storage.from(B.selectedBucket).upload(B.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore] Ошибка сохранения (upload):",i.error),wt.setStatus("error","Ошибка сохранения: "+i.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),wt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),wt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!B.data)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}const n=B.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${n}_copy_${e}.json`.trim();const r=prompt("Введите имя для копии:",t);if(!r)return;t=r.trim(),t.endsWith(".json")||(t+=".json"),wt.setStatus("loading","Создание копии...");const i=JSON.stringify(B.data,null,2),u=new TextEncoder().encode(i),{error:f}=await Tn.storage.from(B.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});f?wt.setStatus("error",`Ошибка копии: ${f.message}`):(await nr.loadStoriesList(),wt.setStatus("success","Копия сохранена!"))},addChapter(){if(!B.data||!B.data.chapters)return;const n="ch_"+Date.now();B.data.chapters.push({id:n,title:"Новая глава",description:""}),B.selectedChapterId=n,console.log(`[StoryStore] Создана новая глава: ${n}`)},addDialogue(){if(!B.data||!B.selectedChapterId)return;const n="d_"+Date.now();B.data.dialogues.push({id:n,chapterId:B.selectedChapterId,text:"Новый текст...",options:[]}),B.selectedDialogueId=n},deleteDialogue(n){confirm("Удалить диалог "+n+"?")&&B.data&&(B.data.dialogues=B.data.dialogues.filter(e=>e.id!==n),B.data.dialogues.forEach(e=>{e.nextDialogueId===n&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===n&&(t.nextDialogueId="")})}),B.selectedDialogueId===n&&(B.selectedDialogueId=null))},jumpTo(n){const e=B.data?.dialogues.find(t=>t.id===n);e&&(B.selectedChapterId=e.chapterId,B.selectedDialogueId=n)},getLinkType(n,e){return n.nextDialogueId===e?"Auto":"Option"}};var nn=sr(()=>Jt);function Qh(){wt.selectEditingChapter(null)}var Zh=X('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function ev(n,e){Rt(e,!1);function t(){nn().currentEditingChapter&&(wt.updateChapter(nn().currentEditingChapter.id,{title:nn().currentEditingChapter.title,description:nn().currentEditingChapter.description}),wt.selectEditingChapter(null))}function r(){nn().currentEditingChapter&&confirm(`Удалить главу "${nn().currentEditingChapter.title}"?`)&&(wt.deleteChapter(nn().currentEditingChapter.id),wt.selectEditingChapter(null))}ir();var i=At(),l=Ze(i);{var u=f=>{var v=Zh(),g=E(v),m=j(E(g),2),w=E(m);w.__click=r;var S=j(g,2),p=j(E(S),2),k=j(S,2),R=j(E(k),2),x=j(k,2),F=E(x);F.__click=[Qh];var z=j(F,2);z.__click=t,Wn(p,()=>nn().currentEditingChapter.title,M=>nn(nn().currentEditingChapter.title=M)),Wn(R,()=>nn().currentEditingChapter.description,M=>nn(nn().currentEditingChapter.description=M)),W(f,v)};Oe(l,f=>{nn().currentEditingChapter&&f(u)})}W(n,i),Ot()}Ft(["click"]);var rn=sr(()=>B),tv=(n,e,t)=>e(h(t).id),nv=X('<div class="chapter-form-container svelte-xp6igx"><!></div>'),rv=X('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),iv=X('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),sv=X("<div> </div>"),av=X('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function ov(n,e){Rt(e,!1);function t(F){wt.selectEditingChapter(F)}ir();var r=av(),i=E(r),l=E(i),u=j(E(l),2);u.__click=function(...F){Pn.addChapter?.apply(this,F)};var f=j(l,2);Qe(f,5,()=>rn().data?.chapters||[],F=>F.id,(F,z)=>{var M=rv(),U=Ze(M),$=E(U);let C;$.__click=()=>rn(rn().selectedChapterId=h(z).id);var P=E($),ie=E(P),oe=j($,2);oe.__click=[tv,t,z];var pe=j(U,2);{var fe=ce=>{var Y=nv(),K=E(Y);ev(K,{}),W(ce,Y)};Oe(pe,ce=>{rn().editingChapterId===h(z).id&&ce(fe)})}ke(ce=>{C=Nt($,1,"chapter-item svelte-xp6igx",null,C,ce),We($,"aria-pressed",rn().selectedChapterId===h(z).id),We($,"title",h(z).description||"Без описания"),_e(ie,h(z).title)},[()=>({active:rn().selectedChapterId===h(z).id})]),W(F,M)});var v=j(i,2),g=E(v),m=E(g),w=E(m),S=j(m,2);S.__click=function(...F){Pn.addDialogue?.apply(this,F)};var p=j(g,2);Qe(p,5,()=>Jt.chapterDialogues,F=>F.id,(F,z)=>{var M=iv();let U;M.__click=()=>rn(rn().selectedDialogueId=h(z).id);var $=E(M),C=E($),P=j($,2),ie=E(P);ke((oe,pe)=>{U=Nt(M,1,"dialogue-item svelte-xp6igx",null,U,oe),We(M,"aria-pressed",rn().selectedDialogueId===h(z).id),_e(C,h(z).id),_e(ie,`${pe??""}...`)},[()=>({active:rn().selectedDialogueId===h(z).id}),()=>h(z).text.substring(0,25)]),W(F,M)});var k=j(v,2),R=E(k);{var x=F=>{var z=sv(),M=E(z);ke(()=>{Nt(z,1,`alert ${rn().statusMessage.type??""}`,"svelte-xp6igx"),_e(M,rn().statusMessage.text)}),W(F,z)};Oe(R,F=>{rn().statusMessage.text&&F(x)})}ke(()=>{_e(w,`Сцены (${Jt.chapterDialogues.length??""})`),S.disabled=!rn().selectedChapterId}),W(n,r),Ot()}Ft(["click"]);var lv=X("<option> </option>"),uv=(n,e)=>{const t=n.target;e(t.checked)},cv=(n,e)=>{const t=n.target;e("id",t.value)},dv=(n,e)=>{const t=n.target;e("onWinDialogueId",t.value)},fv=X("<option> </option>"),hv=(n,e)=>{const t=n.target;e("onLoseDialogueId",t.value)},vv=X("<option> </option>"),pv=(n,e)=>{const t=n.target;e("rewardItem",t.value)},gv=X("<option> </option>"),_v=X('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),mv=(n,e)=>{const t=n.target;e(t.value)},yv=X("<option> </option>"),wv=(n,e)=>{const t=n.target;e({itemId:t.value})},bv=X("<option> </option>"),kv=X('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),Iv=(n,e)=>{const t=n.target;e({statName:t.value})},Sv=(n,e)=>{const t=n.target,r=parseInt(t.value);e({statValue:isNaN(r)?0:r})},Ev=X('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),Av=(n,e)=>{const t=n.target;e({flagName:t.value})},Cv=X('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),jv=X('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function Tv(n,e){Rt(e,!0);const t=He(e,"option",7);function r(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return r(),t().visibilityCondition}function l(Q){r();const ue=t().visibilityCondition;Object.assign(ue,Q),t().visibilityCondition={...ue}}function u(Q){r();const ue={type:Q};switch(Q){case"has_item":ue.itemId=i().itemId||"";break;case"stat_greater":ue.statName=i().statName||"",ue.statValue=i().statValue||0;break;case"flag_true":ue.flagName=i().flagName||"";break}t().visibilityCondition=ue}const f=Dt(()=>!!t().miniGame);function v(Q){Q?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function g(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function m(Q,ue){const be=g();be&&(be[Q]=ue)}var w=jv(),S=E(w),p=E(S),k=j(p,2),R=j(S,2),x=E(R),F=j(x,2),z=E(F);z.value=z.__value="";var M=j(z);Qe(M,17,()=>e.dialogues,Q=>Q.id,(Q,ue)=>{var be=lv(),je=E(be),Ne={};ke(Ve=>{_e(je,`${h(ue).id??""}: ${Ve??""}...`),Ne!==(Ne=h(ue).id)&&(be.value=(be.__value=h(ue).id)??"")},[()=>h(ue).text.substring(0,30)]),W(Q,be)});var U=j(R,2),$=E(U),C=E($),P=E(C);P.__change=[uv,v];var ie=j($,2);{var oe=Q=>{var ue=_v(),be=E(ue),je=E(be),Ne=j(je,2);Ne.__change=[cv,m];var Ve=E(Ne);Ve.value=Ve.__value="";var Be=j(Ve);Be.value=Be.__value="onet_monsters";var Le=j(Be);Le.value=Le.__value="memo_monsters";var Je=j(Le);Je.value=Je.__value="light_out";var Ge=j(Je);Ge.value=Ge.__value="flood_it";var _t=j(Ge);_t.value=_t.__value="broken_mirror";var lt=j(_t);lt.value=lt.__value="evolution2048";var xt=j(lt);xt.value=xt.__value="cursed_crypts";var St=j(xt);St.value=St.__value="tower_of_souls";var y;wr(Ne);var o=j(be,2),d=E(o),b=E(d),T=j(b,2);T.__change=[dv,m];var q=E(T);q.value=q.__value="";var ae=j(q);Qe(ae,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Ie=fv(),ze=E(Ie),Vt={};ke(Mr=>{_e(ze,`${h(ut).id??""}: ${Mr??""}...`),Vt!==(Vt=h(ut).id)&&(Ie.value=(Ie.__value=h(ut).id)??"")},[()=>h(ut).text.substring(0,30)]),W(st,Ie)});var Ae;wr(T);var $e=j(d,2),Ce=E($e),Ue=j(Ce,2);Ue.__change=[hv,m];var Ke=E(Ue);Ke.value=Ke.__value="";var bt=j(Ke);Qe(bt,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Ie=vv(),ze=E(Ie),Vt={};ke(Mr=>{_e(ze,`${h(ut).id??""}: ${Mr??""}...`),Vt!==(Vt=h(ut).id)&&(Ie.value=(Ie.__value=h(ut).id)??"")},[()=>h(ut).text.substring(0,30)]),W(st,Ie)});var ft;wr(Ue);var Wt=j(o,2),$t=E(Wt),Et=j($t,2);Et.__change=[pv,m];var et=E(Et);et.value=et.__value="";var qe=j(et);Qe(qe,17,()=>e.availableItems,st=>st.id,(st,ut)=>{var Ie=gv(),ze=E(Ie),Vt={};ke(()=>{_e(ze,h(ut).name),Vt!==(Vt=h(ut).id)&&(Ie.value=(Ie.__value=h(ut).id)??"")}),W(st,Ie)});var kt;wr(Et),ke((st,ut,Ie,ze)=>{We(je,"for",`option-mg-id-${e.index??""}`),We(Ne,"id",`option-mg-id-${e.index??""}`),y!==(y=st)&&(Ne.value=(Ne.__value=st)??"",Jn(Ne,st)),We(b,"for",`option-mg-win-${e.index??""}`),We(T,"id",`option-mg-win-${e.index??""}`),Ae!==(Ae=ut)&&(T.value=(T.__value=ut)??"",Jn(T,ut)),We(Ce,"for",`option-mg-lose-${e.index??""}`),We(Ue,"id",`option-mg-lose-${e.index??""}`),ft!==(ft=Ie)&&(Ue.value=(Ue.__value=Ie)??"",Jn(Ue,Ie)),We($t,"for",`option-mg-reward-${e.index??""}`),We(Et,"id",`option-mg-reward-${e.index??""}`),kt!==(kt=ze)&&(Et.value=(Et.__value=ze)??"",Jn(Et,ze))},[()=>g().id,()=>g().onWinDialogueId,()=>g().onLoseDialogueId,()=>g().rewardItem||""]),W(Q,ue)};Oe(ie,Q=>{g()&&Q(oe)})}var pe=j(U,2),fe=E(pe),ce=E(fe),Y=E(ce),K=j(fe,2),G=E(K),ee=E(G),L=j(pe,2),V=j(E(L),2),se=E(V),le=E(se),me=j(le,2);me.__change=[mv,u],Qe(me,20,()=>e.conditionTypes,Q=>Q,(Q,ue)=>{var be=yv(),je=E(be),Ne={};ke(()=>{_e(je,ue),Ne!==(Ne=ue)&&(be.value=(be.__value=ue)??"")}),W(Q,be)});var Ee;wr(me);var ge=j(se,2);{var Me=Q=>{var ue=kv(),be=E(ue),je=j(be,2);je.__change=[wv,l];var Ne=E(je);Ne.value=Ne.__value="";var Ve=j(Ne);Qe(Ve,17,()=>e.availableItems,Le=>Le.id,(Le,Je)=>{var Ge=bv(),_t=E(Ge),lt={};ke(()=>{_e(_t,h(Je).name),lt!==(lt=h(Je).id)&&(Ge.value=(Ge.__value=h(Je).id)??"")}),W(Le,Ge)});var Be;wr(je),ke(Le=>{We(be,"for",`option-cond-item-${e.index??""}`),We(je,"id",`option-cond-item-${e.index??""}`),Be!==(Be=Le)&&(je.value=(je.__value=Le)??"",Jn(je,Le))},[()=>i().itemId||""]),W(Q,ue)};Oe(ge,Q=>{i().type==="has_item"&&Q(Me)})}var de=j(ge,2);{var te=Q=>{var ue=Ev(),be=Ze(ue),je=E(be),Ne=j(je,2);Ne.__input=[Iv,l];var Ve=j(be,2),Be=E(Ve),Le=j(Be,2);Le.__input=[Sv,l],ke((Je,Ge)=>{We(je,"for",`option-cond-stat-${e.index??""}`),We(Ne,"id",`option-cond-stat-${e.index??""}`),ra(Ne,Je),We(Be,"for",`option-cond-stat-val-${e.index??""}`),We(Le,"id",`option-cond-stat-val-${e.index??""}`),ra(Le,Ge)},[()=>i().statName||"",()=>i().statValue||0]),W(Q,ue)};Oe(de,Q=>{i().type==="stat_greater"&&Q(te)})}var Z=j(de,2);{var re=Q=>{var ue=Cv(),be=E(ue),je=j(be,2);je.__input=[Av,l],ke(Ne=>{We(be,"for",`option-cond-flag-${e.index??""}`),We(je,"id",`option-cond-flag-${e.index??""}`),ra(je,Ne)},[()=>i().flagName||""]),W(Q,ue)};Oe(Z,Q=>{i().type==="flag_true"&&Q(re)})}var Te=j(V,2);Oe(Te,Q=>{}),ke(Q=>{We(p,"for",`option-text-${e.index??""}`),We(k,"id",`option-text-${e.index??""}`),We(x,"for",`option-next-${e.index??""}`),We(F,"id",`option-next-${e.index??""}`),$d(P,h(f)),We(le,"for",`option-cond-type-${e.index??""}`),We(me,"id",`option-cond-type-${e.index??""}`),Ee!==(Ee=Q)&&(me.value=(me.__value=Q)??"",Jn(me,Q))},[()=>i().type]),Wn(k,()=>t().text,Q=>t().text=Q),Zr(F,()=>t().nextDialogueId,Q=>t().nextDialogueId=Q),al(Y,()=>t().enabled,Q=>t().enabled=Q),al(ee,()=>t().visible,Q=>t().visible=Q),W(n,w),Ot()}Ft(["change","input"]);var Ct=sr(()=>B),it=sr(()=>Jt),xv=X("<option> <!></option>"),Pv=X("<option> </option>"),Rv=X("<option> </option>"),Ov=X("<option> </option>"),Mv=X("<option> </option>"),Lv=X('<div class="option-content svelte-1e6637j"><!></div>'),Dv=X('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Fv=X('<div class="empty-links svelte-1e6637j">Нет связей</div>'),$v=(n,e)=>Pn.jumpTo(h(e).id),Uv=X('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),Nv=X('<div class="links-list svelte-1e6637j"></div>'),Bv=X('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),Wv=(n,e)=>Pn.jumpTo(h(e).id),Vv=X('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),qv=X('<div class="more-links svelte-1e6637j"> </div>'),Gv=X('<div class="links-list svelte-1e6637j"><!> <!></div>'),zv=X("<option> </option>"),Hv=X('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),Kv=X('<div class="empty-state">Выберите сцену</div>');function Yv(n,e){Rt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function r(S){S.options||(S.options=[]);const p=Xh();S.options.push(p),Ct(Ct().editingOptionIndex=S.options.length-1)}function i(S){if(Ct().editingOptionIndex===S)Ct(Ct().editingOptionIndex=null);else{Ct(Ct().editingOptionIndex=S);const p=it().currentDialogue?.options?.[S];p&&!p.visibilityCondition&&(p.visibilityCondition={type:"always"})}}function l(S,p){confirm("Удалить вариант ответа?")&&(S.options?.splice(p,1),Ct().editingOptionIndex===p?Ct(Ct().editingOptionIndex=null):Ct().editingOptionIndex&&Ct().editingOptionIndex>p&&Ct(Ct().editingOptionIndex--))}function u(S){if(!S||!Ct().data)return"Нет";const p=Ct().data.dialogues.find(k=>k.id===S);return p?p.text.substring(0,25)+"...":`❌ ${S}`}function f(){const S=[],p=it().currentDialogue;return p&&(p.nextDialogueId&&S.push({type:"Auto",id:p.nextDialogueId,text:u(p.nextDialogueId)}),p.options?.forEach((k,R)=>{k.nextDialogueId&&S.push({type:`Опция #${R+1}`,id:k.nextDialogueId,text:u(k.nextDialogueId)})})),S}ir();var v=At(),g=Ze(v);{var m=S=>{var p=Hv(),k=E(p),R=j(E(k),2);R.__change=o=>{const d=o.target;Ct(Ct().selectedDialogueId=d.value)};var x=j(k,2),F=j(E(x),2);ke(()=>{it(),wn(()=>{Ct()})}),F.__change=o=>{const d=o.target;Ct(Ct().selectedChapterId=d.value)};var z=E(F);z.value=z.__value="";var M=j(z);Qe(M,1,()=>Ct().data.chapters||[],Tt,(o,d)=>{var b=xv(),T=E(b),q=j(T);{var ae=$e=>{var Ce=ls();ke(Ue=>_e(Ce,`- ${Ue??""}...`),[()=>h(d).description.substring(0,30)]),W($e,Ce)};Oe(q,$e=>{h(d).description&&$e(ae)})}var Ae={};ke(()=>{_e(T,`${h(d).title??""} `),Ae!==(Ae=h(d).id)&&(b.value=(b.__value=h(d).id)??"")}),W(o,b)});var U=j(x,2),$=j(E(U),2),C=j(U,2),P=j(E(C),2),ie=j(E(P),2),oe=E(ie);ke(()=>{it(),wn(()=>{})});var pe=E(oe);pe.value=pe.__value="";var fe=j(pe);Qe(fe,1,()=>it().imageResources,Tt,(o,d)=>{var b=Pv(),T=E(b),q={};ke(()=>{_e(T,h(d).name),q!==(q=h(d).name)&&(b.value=(b.__value=h(d).name)??"")}),W(o,b)});var ce=j(fe);Qe(ce,1,()=>it().riveResources,Tt,(o,d)=>{var b=Rv(),T=E(b),q={};ke(()=>{_e(T,`${h(d).name??""} (Rive)`),q!==(q=h(d).name)&&(b.value=(b.__value=h(d).name)??"")}),W(o,b)});var Y=j(oe,2),K=j(E(Y));K.__change=function(...o){nr.uploadNewFile?.apply(this,o)};var G=j(P,2),ee=j(E(G),2),L=E(ee);ke(()=>{it(),wn(()=>{})});var V=E(L);V.value=V.__value="";var se=j(V);Qe(se,1,()=>it().imageResources,Tt,(o,d)=>{var b=Ov(),T=E(b),q={};ke(()=>{_e(T,h(d).name),q!==(q=h(d).name)&&(b.value=(b.__value=h(d).name)??"")}),W(o,b)});var le=j(se);Qe(le,1,()=>it().riveResources,Tt,(o,d)=>{var b=Mv(),T=E(b),q={};ke(()=>{_e(T,`${h(d).name??""} (Rive)`),q!==(q=h(d).name)&&(b.value=(b.__value=h(d).name)??"")}),W(o,b)});var me=j(C,2),Ee=E(me),ge=j(E(Ee),2);ge.__click=()=>r(it().currentDialogue);var Me=j(Ee,2);Qe(Me,1,()=>it().currentDialogue.options||[],Tt,(o,d,b)=>{var T=Dv();let q;var ae=E(T),Ae=E(ae);Ae.__click=()=>i(b),Ae.__keydown=et=>{(et.key==="Enter"||et.key===" ")&&(et.preventDefault(),i(b))},We(Ae,"aria-controls",`option-content-${b}`);var $e=E(Ae),Ce=E($e);{var Ue=et=>{var qe=ls("👁️‍🗨️");W(et,qe)},Ke=et=>{var qe=At(),kt=Ze(qe);{var st=Ie=>{var ze=ls("🔒");W(Ie,ze)},ut=Ie=>{var ze=ls("✅");W(Ie,ze)};Oe(kt,Ie=>{h(d).enabled?Ie(ut,!1):Ie(st)},!0)}W(et,qe)};Oe(Ce,et=>{h(d).visible?et(Ke,!1):et(Ue)})}var bt=j($e,2),ft=E(bt),Wt=j(Ae,2);Wt.__click=()=>l(it().currentDialogue,b);var $t=j(ae,2);{var Et=et=>{var qe=Lv();We(qe,"id",`option-content-${b}`);var kt=E(qe);Tv(kt,{get option(){return h(d)},index:b,get dialogues(){return Ct().data.dialogues},get availableItems(){return it().availableItems},get conditionTypes(){return t}}),W(et,qe)};Oe($t,et=>{Ct().editingOptionIndex===b&&et(Et)})}ke(et=>{q=Nt(T,1,"option-card svelte-1e6637j",null,q,et),We(Ae,"aria-expanded",Ct().editingOptionIndex===b),_e(ft,`#${b+1} ${h(d).text??""}`)},[()=>({editing:Ct().editingOptionIndex===b})]),W(o,T)});var de=j(me,2),te=E(de),Z=E(te),re=E(Z),Te=E(re),Q=j(re,2);{var ue=o=>{var d=Fv();W(o,d)},be=o=>{var d=Nv();Qe(d,5,f,Tt,(b,T)=>{var q=Uv(),ae=E(q),Ae=E(ae),$e=j(ae,2),Ce=E($e),Ue=j($e,2);Ue.__click=[$v,T];var Ke=j(Ue,2),bt=E(Ke);ke(()=>{_e(Ae,`${h(T).type??""}:`),_e(Ce,h(T).id),_e(bt,h(T).text)}),W(b,q)}),W(o,d)};Oe(Q,o=>{f().length===0?o(ue):o(be,!1)})}var je=j(Z,2),Ne=E(je),Ve=E(Ne),Be=j(Ne,2);{var Le=o=>{var d=Bv();W(o,d)},Je=o=>{var d=Gv(),b=E(d);Qe(b,1,()=>it().backlinks.slice(0,5),Tt,(ae,Ae)=>{const $e=hi(()=>Pn.getLinkType(h(Ae),it().currentDialogue.id));var Ce=Vv(),Ue=E(Ce),Ke=E(Ue),bt=j(Ue,2);let ft;var Wt=E(bt),$t=j(bt,2);$t.__click=[Wv,Ae];var Et=j($t,2),et=E(Et);ke((qe,kt)=>{_e(Ke,h(Ae).id),ft=Nt(bt,1,"link-type-badge svelte-1e6637j",null,ft,qe),_e(Wt,h($e)),_e(et,`${kt??""}...`)},[()=>({"link-auto":h($e)==="Auto","link-option":h($e)==="Option"}),()=>h(Ae).text.substring(0,20)]),W(ae,Ce)});var T=j(b,2);{var q=ae=>{var Ae=qv(),$e=E(Ae);ke(()=>_e($e,`...ещё ${it().backlinks.length-5}`)),W(ae,Ae)};Oe(T,ae=>{it().backlinks.length>5&&ae(q)})}W(o,d)};Oe(Be,o=>{it().backlinks.length===0?o(Le):o(Je,!1)})}var Ge=j(de,2),_t=j(E(Ge),2);ke(()=>{it(),wn(()=>{Ct()})});var lt=E(_t);lt.value=lt.__value="";var xt=j(lt);Qe(xt,1,()=>Ct().data.dialogues,Tt,(o,d)=>{var b=zv(),T=E(b),q={};ke(ae=>{_e(T,`${h(d).id??""}: ${ae??""}...`),q!==(q=h(d).id)&&(b.value=(b.__value=h(d).id)??"")},[()=>h(d).text.substring(0,30)]),W(o,b)});var St=j(Ge,2),y=E(St);y.__click=()=>Pn.deleteDialogue(it().currentDialogue.id),ke(o=>{_e(Te,`👉 Куда ведет (${o??""})`),_e(Ve,`👈 Откуда ведут (${it().backlinks.length??""})`)},[()=>f().length]),Wn(R,()=>it().currentDialogue.id,o=>it(it().currentDialogue.id=o)),Zr(F,()=>it().currentDialogue.chapterId,o=>it(it().currentDialogue.chapterId=o)),Wn($,()=>it().currentDialogue.text,o=>it(it().currentDialogue.text=o)),Zr(oe,()=>it().currentDialogue.backgroundImage,o=>it(it().currentDialogue.backgroundImage=o)),Zr(L,()=>it().currentDialogue.characterImage,o=>it(it().currentDialogue.characterImage=o)),Zr(_t,()=>it().currentDialogue.nextDialogueId,o=>it(it().currentDialogue.nextDialogueId=o)),W(S,p)},w=S=>{var p=Kv();W(S,p)};Oe(g,S=>{it().currentDialogue?S(m):S(w,!1)})}W(n,v),Ot()}Ft(["change","click","keydown"]);var Ye=sr(()=>B),Jv=X('<img class="icon-preview svelte-asgatj"/>'),Xv=X('<div class="icon-placeholder svelte-asgatj">📦</div>'),Qv=X("<option> </option>"),Zv=X('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),ep=X("<option> </option>"),tp=X('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),np=X('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),rp=X('<div class="items-list svelte-asgatj"></div>'),ip=X('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),sp=X('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),ap=X('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function op(n,e){Rt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function r(){if(!Ye().data)return;Ye().data.items||Ye(Ye().data.items=[]);const x={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Ye().data.items.push(x),Ye(Ye().editingItemIndex=Ye().data.items.length-1)}function i(x){Ye().editingItemIndex===x?Ye(Ye().editingItemIndex=null):Ye(Ye().editingItemIndex=x)}function l(x){confirm("Удалить предмет?")&&Ye().data?.items&&(Ye().data.items.splice(x,1),Ye(Ye().editingItemIndex=null))}function u(x){if(!Ye().data?.items)return;const F=Ye().data.items[x],z={...F,id:`${F.id}_copy_${Date.now()}`,name:`${F.name} (копия)`};Ye().data.items.splice(x+1,0,z),Ye(Ye().editingItemIndex=x+1)}function f(x){return t.find(F=>F.value===x)?.label||x}ir();var v=ap(),g=E(v);g.__click=()=>Ye(Ye().showItems=!Ye().showItems);var m=E(g),w=j(E(m)),S=j(m,2),p=E(S),k=j(g,2);{var R=x=>{var F=sp(),z=E(F);{var M=C=>{var P=rp();Qe(P,7,()=>Ye().data.items,ie=>ie.id,(ie,oe,pe)=>{var fe=np();let ce;var Y=E(fe);Y.__click=()=>i(h(pe));var K=E(Y),G=E(K),ee=E(G);{var L=Be=>{var Le=Jv();ke(()=>{We(Le,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ye().selectedBucket}/${h(oe).icon}`),We(Le,"alt",h(oe).name)}),W(Be,Le)},V=Be=>{var Le=Xv();W(Be,Le)};Oe(ee,Be=>{h(oe).icon?Be(L):Be(V,!1)})}var se=j(G,2),le=E(se),me=E(le),Ee=j(le,2),ge=E(Ee),Me=E(ge),de=j(ge,2);let te;var Z=E(de),re=j(K,2),Te=E(re),Q=j(Y,2),ue=E(Q);ue.__click=()=>u(h(pe));var be=j(ue,2);be.__click=()=>i(h(pe));var je=j(be,2);je.__click=()=>l(h(pe));var Ne=j(Q,2);{var Ve=Be=>{var Le=tp(),Je=E(Le),Ge=E(Je),_t=E(Ge),lt=j(_t,2),xt=j(Ge,2),St=E(xt),y=j(St,2),o=j(xt,2),d=E(o),b=j(d,2),T=j(o,2),q=E(T),ae=j(q,2),Ae=E(ae),$e=j(Ae,2);$e.__change=qe=>{const kt=qe.target;h(oe).icon=kt.value,wn(()=>Ye())};var Ce=E($e);Ce.value=Ce.__value="";var Ue=j(Ce);Qe(Ue,1,()=>Ye().storedFiles.filter(qe=>qe.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Tt,(qe,kt)=>{var st=Qv(),ut=E(st),Ie={};ke(()=>{_e(ut,h(kt).name),Ie!==(Ie=h(kt).name)&&(st.value=(st.__value=h(kt).name)??"")}),W(qe,st)});var Ke=j($e,2),bt=j(E(Ke));bt.__change=function(...qe){nr.uploadNewFile?.apply(this,qe)};var ft=j(ae,2);{var Wt=qe=>{var kt=Zv(),st=E(kt),ut=j(st,2),Ie=E(ut);ke(()=>{We(st,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ye().selectedBucket}/${h(oe).icon}`),_e(Ie,h(oe).icon)}),W(qe,kt)};Oe(ft,qe=>{h(oe).icon&&qe(Wt)})}var $t=j(T,2),Et=E($t),et=j(Et,2);ke(()=>{h(oe),wn(()=>{h(pe)})}),Qe(et,5,()=>t,Tt,(qe,kt)=>{var st=ep(),ut=E(st),Ie={};ke(()=>{_e(ut,h(kt).label),Ie!==(Ie=h(kt).value)&&(st.value=(st.__value=h(kt).value)??"")}),W(qe,st)}),ke(()=>{We(_t,"for",`item-id-${h(pe)??""}`),We(lt,"id",`item-id-${h(pe)??""}`),We(St,"for",`item-name-${h(pe)??""}`),We(y,"id",`item-name-${h(pe)??""}`),We(d,"for",`item-desc-${h(pe)??""}`),We(b,"id",`item-desc-${h(pe)??""}`),We(q,"for",`item-icon-${h(pe)??""}`),We(Ae,"id",`item-icon-${h(pe)??""}`),We(Et,"for",`item-type-${h(pe)??""}`),We(et,"id",`item-type-${h(pe)??""}`)}),Wn(lt,()=>h(oe).id,qe=>(h(oe).id=qe,wn(()=>Ye()))),Wn(y,()=>h(oe).name,qe=>(h(oe).name=qe,wn(()=>Ye()))),Wn(b,()=>h(oe).description,qe=>(h(oe).description=qe,wn(()=>Ye()))),Wn(Ae,()=>h(oe).icon,qe=>(h(oe).icon=qe,wn(()=>Ye()))),Zr(et,()=>h(oe).type,qe=>(h(oe).type=qe,wn(()=>Ye()))),W(Be,Le)};Oe(Ne,Be=>{Ye().editingItemIndex===h(pe)&&Be(Ve)})}ke((Be,Le,Je)=>{ce=Nt(fe,1,"item-row svelte-asgatj",null,ce,Be),We(Y,"aria-label",`Редактировать предмет ${h(oe).name??""}`),_e(me,h(oe).name),_e(Me,h(oe).id),te=Nt(de,1,"item-type-badge svelte-asgatj",null,te,Le),_e(Z,Je),_e(Te,`${h(oe).description??""} || `)},[()=>({editing:Ye().editingItemIndex===h(pe)}),()=>({tool:h(oe).type==="tool",key:h(oe).type==="key",consumable:h(oe).type==="consumable",quest:h(oe).type==="quest",misc:h(oe).type==="misc"}),()=>f(h(oe).type)]),W(ie,fe)}),W(C,P)},U=C=>{var P=ip();W(C,P)};Oe(z,C=>{Ye().data?.items?.length?C(M):C(U,!1)})}var $=j(z,2);$.__click=r,W(x,F)};Oe(k,x=>{Ye().showItems&&x(R)})}ke(()=>{We(g,"title",Ye().showItems?"Скрыть предметы":"Показать предметы"),We(g,"aria-expanded",Ye().showItems),_e(w,` Предметы (${(Ye().data?.items?.length||0)??""})`),_e(p,Ye().showItems?"▼":"▶")}),W(n,v),Ot()}Ft(["click","change"]);Ft(["click"]);class lp{#i=Re(pt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return h(this.#i)}set player(e){ne(this.#i,e,!0)}#n=Re(null);get storyData(){return h(this.#n)}set storyData(e){ne(this.#n,e,!0)}#e=Re("0");get currentDialogueId(){return h(this.#e)}set currentDialogueId(e){ne(this.#e,e,!0)}#s=Re(!0);get isLoading(){return h(this.#s)}set isLoading(e){ne(this.#s,e,!0)}#a=Re("");get error(){return h(this.#a)}set error(e){ne(this.#a,e,!0)}#t=Re(null);get selectedStory(){return h(this.#t)}set selectedStory(e){ne(this.#t,e,!0)}#r=Re(pt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return h(this.#r)}set availableStories(e){ne(this.#r,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();this.storyData=r,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const r=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${r}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const jt=new lp;var _s={exports:{}},up=_s.exports,Ml;function cp(){return Ml||(Ml=1,(function(n,e){(function(r,i){n.exports=i()})(up,()=>(()=>{var t=[,((u,f,v)=>{v.r(f),v.d(f,{default:()=>m});var g=(()=>{var w=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var p=S,k,R;p.ready=new Promise((s,a)=>{k=s,R=a});function x(){function s(O){const H=_;c=a=0,_=new Map,H.forEach(J=>{try{J(O)}catch(N){console.error(N)}}),this.pb(),I&&I.Tb()}let a=0,c=0,_=new Map,I=null,A=null;this.requestAnimationFrame=function(O){a||(a=requestAnimationFrame(s.bind(this)));const H=++c;return _.set(H,O),H},this.cancelAnimationFrame=function(O){_.delete(O),a&&_.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(O){A&&(document.body.remove(A),A=null),O||(A=document.createElement("div"),A.style.backgroundColor="black",A.style.position="fixed",A.style.right=0,A.style.top=0,A.style.color="white",A.style.padding="4px",A.innerHTML="RIVE FPS",O=function(H){A.innerHTML="RIVE FPS "+H.toFixed(1)},document.body.appendChild(A)),I=new function(){let H=0,J=0;this.Tb=function(){var N=performance.now();J?(++H,N-=J,1e3<N&&(O(1e3*H/N),H=J=0)):(J=N,H=0)}}},this.Ob=function(){A&&(document.body.remove(A),A=null),I=null},this.pb=function(){}}function F(s){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(_){return _=_+((1<<s)-1)>>s,a.has(_)&&clearTimeout(a.get(_)),a.set(_,setTimeout(function(){a.delete(_),a.length==0?c=-1/0:_==c&&(c=Math.max(...a.keys()),console.assert(c<_))},1e3)),c=Math.max(_,c),c<<s}}const z=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){z&&z();let s=p.decodeAudio;p.decodeAudio=function(I,A){I=s(I),A(I)};let a=p.decodeFont;p.decodeFont=function(I,A){I=a(I),A(I)};const c=p.FileAssetLoader;p.ptrToAsset=I=>{let A=p.ptrToFileAsset(I);return A.isImage?p.ptrToImageAsset(I):A.isFont?p.ptrToFontAsset(I):A.isAudio?p.ptrToAudioAsset(I):A},p.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:I}){this.__parent.__construct.call(this),this.Gb=I},loadContents:function(I,A){return I=p.ptrToAsset(I),this.Gb(I,A)}}),p.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(I){let A=p.ptrToAsset(I);return I=A.cdnUuid,I===""?!1:((function(O,H){var J=new XMLHttpRequest;J.responseType="arraybuffer",J.onreadystatechange=function(){J.readyState==4&&J.status==200&&H(J)},J.open("GET",O,!0),J.send(null)})(A.cdnBaseUrl+"/"+I,O=>{A.decode(new Uint8Array(O.response))}),!0)}}),p.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(I){this.lb.push(I)},loadContents:function(I,A){for(let O of this.lb)if(O.loadContents(I,A))return!0;return!1}});let _=p.computeAlignment;p.computeAlignment=function(I,A,O,H,J=1){return _.call(this,I,A,O,H,J)}};const M="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),U=new function(){function s(){if(!a){let nt=function(at,xe,Mt){if(xe=ve.createShader(xe),ve.shaderSource(xe,Mt),ve.compileShader(xe),Mt=ve.getShaderInfoLog(xe),0<(Mt||"").length)throw Mt;ve.attachShader(at,xe)};var D=document.createElement("canvas"),ye={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let ve;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(ve=D.getContext("webgl",ye),c=1,!ve)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(ve=D.getContext("webgl2",ye))c=2;else if(ve=D.getContext("webgl",ye))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(ve=new Proxy(ve,{get(at,xe){if(at.isContextLost()){if(J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",xe),J=!0),typeof at[xe]=="function")return function(){}}else return typeof at[xe]=="function"?function(...Mt){return at[xe].apply(at,Mt)}:at[xe]},set(at,xe,Mt){if(at.isContextLost())J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+xe),J=!0);else return at[xe]=Mt,!0}}),_=Math.min(ve.getParameter(ve.MAX_RENDERBUFFER_SIZE),ve.getParameter(ve.MAX_TEXTURE_SIZE)),D=ve.createProgram(),nt(D,ve.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),nt(D,ve.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),ve.bindAttribLocation(D,0,"vertex"),ve.bindAttribLocation(D,1,"uv"),ve.linkProgram(D),ye=ve.getProgramInfoLog(D),0<(ye||"").trim().length)throw ye;I=ve.getUniformLocation(D,"mat"),A=ve.getUniformLocation(D,"translate"),ve.useProgram(D),ve.bindBuffer(ve.ARRAY_BUFFER,ve.createBuffer()),ve.enableVertexAttribArray(0),ve.enableVertexAttribArray(1),ve.bindBuffer(ve.ELEMENT_ARRAY_BUFFER,ve.createBuffer()),ve.uniform1i(ve.getUniformLocation(D,"image"),0),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=ve}return!0}let a=null,c=0,_=0,I=null,A=null,O=0,H=0,J=!1;s(),this.hc=function(){return s(),_},this.Mb=function(D){a.deleteTexture&&a.deleteTexture(D)},this.Lb=function(D){if(!s())return null;const ye=a.createTexture();return ye?(a.bindTexture(a.TEXTURE_2D,ye),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,D),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),ye):null};const N=new F(8),we=new F(8),Se=new F(10),De=new F(10);this.Qb=function(D,ye,ve,nt,at){if(s()){var xe=N.push(D),Mt=we.push(ye);if(a.canvas){(a.canvas.width!=xe||a.canvas.height!=Mt)&&(a.canvas.width=xe,a.canvas.height=Mt),a.viewport(0,Mt-ye,D,ye),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),ve.sort((ht,An)=>An.xb-ht.xb),xe=Se.push(nt),O!=xe&&(a.bufferData(a.ARRAY_BUFFER,8*xe,a.DYNAMIC_DRAW),O=xe),xe=0;for(var Xt of ve)a.bufferSubData(a.ARRAY_BUFFER,xe,Xt.Ua),xe+=4*Xt.Ua.length;console.assert(xe==4*nt);for(var En of ve)a.bufferSubData(a.ARRAY_BUFFER,xe,En.Db),xe+=4*En.Db.length;console.assert(xe==8*nt),xe=De.push(at),H!=xe&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*xe,a.DYNAMIC_DRAW),H=xe),Xt=0;for(var vr of ve)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Xt,vr.indices),Xt+=2*vr.indices.length;console.assert(Xt==2*at),vr=0,En=!0,xe=Xt=0;for(const ht of ve){ht.image.Ka!=vr&&(a.bindTexture(a.TEXTURE_2D,ht.image.Ja||null),vr=ht.image.Ka),ht.mc?(a.scissor(ht.Za,Mt-ht.$a-ht.kb,ht.Ac,ht.kb),En=!0):En&&(a.scissor(0,Mt-ye,D,ye),En=!1),ve=2/D;const An=-2/ye;a.uniform4f(I,ht.ha[0]*ve*ht.Ba,ht.ha[1]*An*ht.Ca,ht.ha[2]*ve*ht.Ba,ht.ha[3]*An*ht.Ca),a.uniform2f(A,ht.ha[4]*ve*ht.Ba+ve*(ht.Za-ht.ic*ht.Ba)-1,ht.ha[5]*An*ht.Ca+An*(ht.$a-ht.jc*ht.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,xe),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,xe+4*nt),a.drawElements(a.TRIANGLES,ht.indices.length,a.UNSIGNED_SHORT,Xt),xe+=4*ht.Ua.length,Xt+=2*ht.indices.length}console.assert(xe==4*nt),console.assert(Xt==2*at)}}},this.canvas=function(){return s()&&a.canvas}},$=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function s(he){switch(he){case N.srcOver:return"source-over";case N.screen:return"screen";case N.overlay:return"overlay";case N.darken:return"darken";case N.lighten:return"lighten";case N.colorDodge:return"color-dodge";case N.colorBurn:return"color-burn";case N.hardLight:return"hard-light";case N.softLight:return"soft-light";case N.difference:return"difference";case N.exclusion:return"exclusion";case N.multiply:return"multiply";case N.hue:return"hue";case N.saturation:return"saturation";case N.color:return"color";case N.luminosity:return"luminosity"}}function a(he){return"rgba("+((16711680&he)>>>16)+","+((65280&he)>>>8)+","+((255&he)>>>0)+","+((4278190080&he)>>>24)/255+")"}function c(){0<Mt.length&&(U.Qb(xe.drawWidth(),xe.drawHeight(),Mt,Xt,En),Mt=[],En=Xt=0,xe.reset(512,512));for(const he of at){for(const Pe of he.H)Pe();he.H=[]}at.clear()}$&&$();var _=p.RenderPaintStyle;const I=p.RenderPath,A=p.RenderPaint,O=p.Renderer,H=p.StrokeCap,J=p.StrokeJoin,N=p.BlendMode,we=_.fill,Se=_.stroke,De=p.FillRule.evenOdd;let D=1;var ye=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:he,xa:Pe}={}){this.__parent.__construct.call(this),this.Ka=D,D=D+1&2147483647||1,this.la=he,this.xa=Pe},__destruct:function(){this.Ja&&(U.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(he){var Pe=this;Pe.xa&&Pe.xa(Pe);var ct=new Image;Pe.Xa=URL.createObjectURL(new Blob([he],{type:"image/png"})),ct.onload=function(){Pe.Fb=ct,Pe.Ja=U.Lb(ct),Pe.size(ct.width,ct.height),Pe.la&&Pe.la(Pe)},ct.src=Pe.Xa}}),ve=I.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(he,Pe,ct,vt,rt,dt,yt){var It=this.T,mn=It.addPath;he=he.T;const zt=new DOMMatrix;zt.a=Pe,zt.b=ct,zt.c=vt,zt.d=rt,zt.e=dt,zt.f=yt,mn.call(It,he,zt)},fillRule:function(he){this.Wa=he},moveTo:function(he,Pe){this.T.moveTo(he,Pe)},lineTo:function(he,Pe){this.T.lineTo(he,Pe)},cubicTo:function(he,Pe,ct,vt,rt,dt){this.T.bezierCurveTo(he,Pe,ct,vt,rt,dt)},close:function(){this.T.closePath()}}),nt=A.extend("CanvasRenderPaint",{color:function(he){this.Ya=a(he)},thickness:function(he){this.Ib=he},join:function(he){switch(he){case J.miter:this.Ia="miter";break;case J.round:this.Ia="round";break;case J.bevel:this.Ia="bevel"}},cap:function(he){switch(he){case H.butt:this.Ha="butt";break;case H.round:this.Ha="round";break;case H.square:this.Ha="square"}},style:function(he){this.Hb=he},blendMode:function(he){this.Eb=s(he)},clearGradient:function(){this.ja=null},linearGradient:function(he,Pe,ct,vt){this.ja={zb:he,Ab:Pe,cb:ct,eb:vt,Ra:[]}},radialGradient:function(he,Pe,ct,vt){this.ja={zb:he,Ab:Pe,cb:ct,eb:vt,Ra:[],ec:!0}},addStop:function(he,Pe){this.ja.Ra.push({color:he,stop:Pe})},completeGradient:function(){},draw:function(he,Pe,ct){let vt=this.Hb;var rt=this.Ya,dt=this.ja;if(he.globalCompositeOperation=this.Eb,dt!=null){rt=dt.zb;var yt=dt.Ab;const mn=dt.cb;var It=dt.eb;const zt=dt.Ra;dt.ec?(dt=mn-rt,It-=yt,rt=he.createRadialGradient(rt,yt,0,rt,yt,Math.sqrt(dt*dt+It*It))):rt=he.createLinearGradient(rt,yt,mn,It);for(let dn=0,Ht=zt.length;dn<Ht;dn++)yt=zt[dn],rt.addColorStop(yt.stop,a(yt.color));this.Ya=rt,this.ja=null}switch(vt){case Se:he.strokeStyle=rt,he.lineWidth=this.Ib,he.lineCap=this.Ha,he.lineJoin=this.Ia,he.stroke(Pe);break;case we:he.fillStyle=rt,he.fill(Pe,ct)}}});const at=new Set;let xe=null,Mt=[],Xt=0,En=0;var vr=p.CanvasRenderer=O.extend("Renderer",{__construct:function(he){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=he.getContext("2d"),this.Va=he,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const he=this.S.length-6;if(6>he)throw"restore() called without matching save().";this.S.splice(he),this.H.push(this.C.restore.bind(this.C))},transform:function(he,Pe,ct,vt,rt,dt){const yt=this.S,It=yt.length-6;yt.splice(It,6,yt[It]*he+yt[It+2]*Pe,yt[It+1]*he+yt[It+3]*Pe,yt[It]*ct+yt[It+2]*vt,yt[It+1]*ct+yt[It+3]*vt,yt[It]*rt+yt[It+2]*dt+yt[It+4],yt[It+1]*rt+yt[It+3]*dt+yt[It+5]),this.H.push(this.C.transform.bind(this.C,he,Pe,ct,vt,rt,dt))},rotate:function(he){const Pe=Math.sin(he);he=Math.cos(he),this.transform(he,Pe,-Pe,he,0,0)},_drawPath:function(he,Pe){this.H.push(Pe.draw.bind(Pe,this.C,he.T,he.Wa===De?"evenodd":"nonzero"))},_drawRiveImage:function(he,Pe,ct,vt){var rt=he.Fb;if(rt){var dt=this.C,yt=s(ct);this.H.push(function(){dt.globalCompositeOperation=yt,dt.globalAlpha=vt,dt.drawImage(rt,0,0),dt.globalAlpha=1})}},_getMatrix:function(he){const Pe=this.S,ct=Pe.length-6;for(let vt=0;6>vt;++vt)he[vt]=Pe[ct+vt]},_drawImageMesh:function(he,Pe,ct,vt,rt,dt,yt,It,mn,zt,dn){Pe=this.C.canvas.width;var Ht=this.C.canvas.height;const Wo=zt-It,Vo=dn-mn;It=Math.max(It,0),mn=Math.max(mn,0),zt=Math.min(zt,Pe),dn=Math.min(dn,Ht);const Si=zt-It,Ei=dn-mn;if(console.assert(Si<=Math.min(Wo,Pe)),console.assert(Ei<=Math.min(Vo,Ht)),!(0>=Si||0>=Ei)){zt=Si<Wo||Ei<Vo,Pe=dn=1;var pr=Math.ceil(Si*dn),gr=Math.ceil(Ei*Pe);Ht=U.hc(),pr>Ht&&(dn*=Ht/pr,pr=Ht),gr>Ht&&(Pe*=Ht/gr,gr=Ht),xe||(xe=new p.DynamicRectanizer(Ht),xe.reset(512,512)),Ht=xe.addRect(pr,gr),0>Ht&&(c(),at.add(this),Ht=xe.addRect(pr,gr),console.assert(0<=Ht));var qo=Ht&65535,Go=Ht>>16;Mt.push({ha:this.S.slice(this.S.length-6),image:he,Za:qo,$a:Go,ic:It,jc:mn,Ac:pr,kb:gr,Ba:dn,Ca:Pe,Ua:new Float32Array(rt),Db:new Float32Array(dt),indices:new Uint16Array(yt),mc:zt,xb:he.Ka<<1|(zt?1:0)}),Xt+=rt.length,En+=yt.length;var $r=this.C,vc=s(ct);this.H.push(function(){$r.save(),$r.resetTransform(),$r.globalCompositeOperation=vc,$r.globalAlpha=vt;const zo=U.canvas();zo&&$r.drawImage(zo,qo,Go,pr,gr,It,mn,Si,Ei),$r.restore()})}},_clipPath:function(he){this.H.push(this.C.clip.bind(this.C,he.T,he.Wa===De?"evenodd":"nonzero"))},clear:function(){at.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(he,Pe){this.transform(1,0,0,1,he,Pe)}});p.makeRenderer=function(he){const Pe=new vr(he),ct=Pe.C;return new Proxy(Pe,{get(vt,rt){if(typeof vt[rt]=="function")return function(...dt){return vt[rt].apply(vt,dt)};if(typeof ct[rt]=="function"){if(-1<M.indexOf(rt))throw Error("RiveException: Method call to '"+rt+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...dt){Pe.H.push(ct[rt].bind(ct,...dt))}}return vt[rt]},set(vt,rt,dt){if(rt in ct)return Pe.H.push(()=>{ct[rt]=dt}),!0}})},p.decodeImage=function(he,Pe){new ye({la:Pe}).decode(he)},p.renderFactory={makeRenderPaint:function(){return new nt},makeRenderPath:function(){return new ve},makeRenderImage:function(){let he=An;return new ye({xa:()=>{he.total++},la:()=>{if(he.loaded++,he.loaded===he.total){const Pe=he.ready;Pe&&(Pe(),he.ready=null)}}})}};let ht=p.load,An=null;p.load=function(he,Pe,ct=!0){const vt=new p.FallbackFileAssetLoader;return Pe!==void 0&&vt.addLoader(Pe),ct&&(Pe=new p.CDNFileAssetLoader,vt.addLoader(Pe)),new Promise(function(rt){let dt=null;An={total:0,loaded:0,ready:function(){rt(dt)}},dt=ht(he,vt),An.total==0&&rt(dt)})};let hc=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(he,Pe,ct,vt,rt=1){hc.call(this,he,Pe,ct,vt,rt)},_=new x,p.requestAnimationFrame=_.requestAnimationFrame.bind(_),p.cancelAnimationFrame=_.cancelAnimationFrame.bind(_),p.enableFPSCounter=_.Rb.bind(_),p.disableFPSCounter=_.Ob,_.pb=c,p.resolveAnimationFrame=c,p.cleanup=function(){xe&&xe.delete()}};var C=Object.assign({},p),P="./this.program",ie=typeof window=="object",oe=typeof importScripts=="function",pe="",fe,ce;(ie||oe)&&(oe?pe=self.location.href:typeof document<"u"&&document.currentScript&&(pe=document.currentScript.src),w&&(pe=w),pe.indexOf("blob:")!==0?pe=pe.substr(0,pe.replace(/[?#].*/,"").lastIndexOf("/")+1):pe="",oe&&(ce=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),fe=(s,a,c)=>{var _=new XMLHttpRequest;_.open("GET",s,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?a(_.response):c()},_.onerror=c,_.send(null)});var Y=p.print||console.log.bind(console),K=p.printErr||console.error.bind(console);Object.assign(p,C),C=null,p.thisProgram&&(P=p.thisProgram);var G;p.wasmBinary&&(G=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&Ve("no native wasm support detected");var ee,L,V=!1,se,le,me,Ee,ge,Me,de,te;function Z(){var s=ee.buffer;p.HEAP8=se=new Int8Array(s),p.HEAP16=me=new Int16Array(s),p.HEAP32=ge=new Int32Array(s),p.HEAPU8=le=new Uint8Array(s),p.HEAPU16=Ee=new Uint16Array(s),p.HEAPU32=Me=new Uint32Array(s),p.HEAPF32=de=new Float32Array(s),p.HEAPF64=te=new Float64Array(s)}var re,Te=[],Q=[],ue=[];function be(){var s=p.preRun.shift();Te.unshift(s)}var je=0,Ne=null;function Ve(s){throw p.onAbort&&p.onAbort(s),s="Aborted("+s+")",K(s),V=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),R(s),s}function Be(s){return s.startsWith("data:application/octet-stream;base64,")}var Le;if(Le="canvas_advanced.wasm",!Be(Le)){var Je=Le;Le=p.locateFile?p.locateFile(Je,pe):pe+Je}function Ge(s){if(s==Le&&G)return new Uint8Array(G);if(ce)return ce(s);throw"both async and sync fetching of the wasm failed"}function _t(s){if(!G&&(ie||oe)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>Ge(s));if(fe)return new Promise((a,c)=>{fe(s,_=>a(new Uint8Array(_)),c)})}return Promise.resolve().then(()=>Ge(s))}function lt(s,a,c){return _t(s).then(_=>WebAssembly.instantiate(_,a)).then(_=>_).then(c,_=>{K("failed to asynchronously prepare wasm: "+_),Ve(_)})}function xt(s,a){var c=Le;return G||typeof WebAssembly.instantiateStreaming!="function"||Be(c)||c.startsWith("file://")||typeof fetch!="function"?lt(c,s,a):fetch(c,{credentials:"same-origin"}).then(_=>WebAssembly.instantiateStreaming(_,s).then(a,function(I){return K("wasm streaming compile failed: "+I),K("falling back to ArrayBuffer instantiation"),lt(c,s,a)}))}var St,y,o={460492:(s,a,c,_,I)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=_,window.h.ga.yb=I;let A=window.h;A.D=[],A.yc=function(O){for(var H=0;H<A.D.length;++H)if(A.D[H]==null)return A.D[H]=O,H;return A.D.push(O),A.D.length-1},A.Cb=function(O){for(A.D[O]=null;0<A.D.length&&A.D[A.D.length-1]==null;)A.D.pop()},A.Sc=function(O){for(var H=0;H<A.D.length;++H)if(A.D[H]==O)return A.Cb(H)},A.ra=function(O){return A.D[O]},A.Ta=["touchend","click"],A.unlock=function(){for(var O=0;O<A.D.length;++O){var H=A.D[O];H!=null&&H.J!=null&&H.state===A.ga.yb&&H.J.resume().then(()=>{Fo(H.qb)},J=>{console.error("Failed to resume audiocontext",J)})}A.Ta.map(function(J){document.removeEventListener(J,A.unlock,!0)})},A.Ta.map(function(O){document.addEventListener(O,A.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),a=s.sampleRate;return s.close(),a}catch{return 0}},463249:(s,a,c,_,I,A)=>{if(typeof window.h>"u")return-1;var O={},H={};return s==window.h.I.ya&&c!=0&&(H.sampleRate=c),O.J=new(window.AudioContext||window.webkitAudioContext)(H),O.J.suspend(),O.state=window.h.ga.stopped,c=0,s!=window.h.I.ya&&(c=a),O.Z=O.J.createScriptProcessor(_,c,a),O.Z.onaudioprocess=function(J){if((O.sa==null||O.sa.length==0)&&(O.sa=new Float32Array(de.buffer,I,_*a)),s==window.h.I.capture||s==window.h.I.La){for(var N=0;N<a;N+=1)for(var we=J.inputBuffer.getChannelData(N),Se=O.sa,De=0;De<_;De+=1)Se[De*a+N]=we[De];$o(A,_,I)}if(s==window.h.I.ya||s==window.h.I.La)for(Uo(A,_,I),N=0;N<J.outputBuffer.numberOfChannels;++N)for(we=J.outputBuffer.getChannelData(N),Se=O.sa,De=0;De<_;De+=1)we[De]=Se[De*a+N];else for(N=0;N<J.outputBuffer.numberOfChannels;++N)J.outputBuffer.getChannelData(N).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(J){O.Da=O.J.createMediaStreamSource(J),O.Da.connect(O.Z),O.Z.connect(O.J.destination)}).catch(function(J){console.log("Failed to get user media: "+J)}),s==window.h.I.ya&&O.Z.connect(O.J.destination),O.qb=A,window.h.yc(O)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},d=s=>{for(;0<s.length;)s.shift()(p)},b=(s,a)=>{for(var c=0,_=s.length-1;0<=_;_--){var I=s[_];I==="."?s.splice(_,1):I===".."?(s.splice(_,1),c++):c&&(s.splice(_,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},T=s=>{var a=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=b(s.split("/").filter(_=>!!_),!a).join("/"))||a||(s="."),s&&c&&(s+="/"),(a?"/":"")+s},q=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},ae=s=>{if(s==="/")return"/";s=T(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},Ae=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);Ve("initRandomDevice")},$e=s=>($e=Ae())(s);function Ce(){for(var s="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=b(s.split("/").filter(_=>!!_),!a).join("/"),(a?"/":"")+s||"."}var Ue=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ke=(s,a,c)=>{var _=a+c;for(c=a;s[c]&&!(c>=_);)++c;if(16<c-a&&s.buffer&&Ue)return Ue.decode(s.subarray(a,c));for(_="";a<c;){var I=s[a++];if(I&128){var A=s[a++]&63;if((I&224)==192)_+=String.fromCharCode((I&31)<<6|A);else{var O=s[a++]&63;I=(I&240)==224?(I&15)<<12|A<<6|O:(I&7)<<18|A<<12|O<<6|s[a++]&63,65536>I?_+=String.fromCharCode(I):(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023))}}else _+=String.fromCharCode(I)}return _},bt=[],ft=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);127>=_?a++:2047>=_?a+=2:55296<=_&&57343>=_?(a+=4,++c):a+=3}return a},Wt=(s,a,c,_)=>{if(!(0<_))return 0;var I=c;_=c+_-1;for(var A=0;A<s.length;++A){var O=s.charCodeAt(A);if(55296<=O&&57343>=O){var H=s.charCodeAt(++A);O=65536+((O&1023)<<10)|H&1023}if(127>=O){if(c>=_)break;a[c++]=O}else{if(2047>=O){if(c+1>=_)break;a[c++]=192|O>>6}else{if(65535>=O){if(c+2>=_)break;a[c++]=224|O>>12}else{if(c+3>=_)break;a[c++]=240|O>>18,a[c++]=128|O>>12&63}a[c++]=128|O>>6&63}a[c++]=128|O&63}}return a[c]=0,c-I};function $t(s,a){var c=Array(ft(s)+1);return s=Wt(s,c,0,c.length),a&&(c.length=s),c}var Et=[];function et(s,a){Et[s]={input:[],F:[],V:a},Us(s,qe)}var qe={open:function(s){var a=Et[s.node.za];if(!a)throw new Fe(43);s.s=a,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,a,c,_){if(!s.s||!s.s.V.jb)throw new Fe(60);for(var I=0,A=0;A<_;A++){try{var O=s.s.V.jb(s.s)}catch{throw new Fe(29)}if(O===void 0&&I===0)throw new Fe(6);if(O==null)break;I++,a[c+A]=O}return I&&(s.node.timestamp=Date.now()),I},write:function(s,a,c,_){if(!s.s||!s.s.V.Oa)throw new Fe(60);try{for(var I=0;I<_;I++)s.s.V.Oa(s.s,a[c+I])}catch{throw new Fe(29)}return _&&(s.node.timestamp=Date.now()),I}},kt={jb:function(){e:{if(!bt.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}bt=$t(s,!0)}s=bt.shift()}return s},Oa:function(s,a){a===null||a===10?(Y(Ke(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(Y(Ke(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},st={Oa:function(s,a){a===null||a===10?(K(Ke(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(K(Ke(s.F,0)),s.F=[])}};function ut(s,a){var c=s.j?s.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=s.j,s.j=new Uint8Array(a),0<s.v&&s.j.set(c.subarray(0,s.v),0))}var Ie={O:null,U(){return Ie.createNode(null,"/",16895,0)},createNode(s,a,c,_){if((c&61440)===24576||(c&61440)===4096)throw new Fe(63);return Ie.O||(Ie.O={dir:{node:{Y:Ie.l.Y,P:Ie.l.P,ka:Ie.l.ka,va:Ie.l.va,vb:Ie.l.vb,Bb:Ie.l.Bb,wb:Ie.l.wb,tb:Ie.l.tb,Ea:Ie.l.Ea},stream:{ba:Ie.m.ba}},file:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:{ba:Ie.m.ba,read:Ie.m.read,write:Ie.m.write,pa:Ie.m.pa,mb:Ie.m.mb,ob:Ie.m.ob}},link:{node:{Y:Ie.l.Y,P:Ie.l.P,ma:Ie.l.ma},stream:{}},ab:{node:{Y:Ie.l.Y,P:Ie.l.P},stream:Gu}}),c=so(s,a,c,_),(c.mode&61440)===16384?(c.l=Ie.O.dir.node,c.m=Ie.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Ie.O.file.node,c.m=Ie.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Ie.O.link.node,c.m=Ie.O.link.stream):(c.mode&61440)===8192&&(c.l=Ie.O.ab.node,c.m=Ie.O.ab.stream),c.timestamp=Date.now(),s&&(s.j[a]=c,s.timestamp=c.timestamp),c},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var a={};return a.Jc=(s.mode&61440)===8192?s.id:1,a.Mc=s.id,a.mode=s.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=s.za,(s.mode&61440)===16384?a.size=4096:(s.mode&61440)===32768?a.size=s.v:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Bc=new Date(s.timestamp),a.Nc=new Date(s.timestamp),a.Ic=new Date(s.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.v!=a))if(a==0)s.j=null,s.v=0;else{var c=s.j;s.j=new Uint8Array(a),c&&s.j.set(c.subarray(0,Math.min(a,s.v))),s.v=a}},ka(){throw $s[44]},va(s,a,c,_){return Ie.createNode(s,a,c,_)},vb(s,a,c){if((s.mode&61440)===16384){try{var _=Bi(a,c)}catch{}if(_)for(var I in _.j)throw new Fe(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=c,a.j[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},Bb(s,a){delete s.j[a],s.timestamp=Date.now()},wb(s,a){var c=Bi(s,a),_;for(_ in c.j)throw new Fe(55);delete s.j[a],s.timestamp=Date.now()},tb(s){var a=[".",".."],c;for(c in s.j)s.j.hasOwnProperty(c)&&a.push(c);return a},Ea(s,a,c){return s=Ie.createNode(s,a,41471,0),s.link=c,s},ma(s){if((s.mode&61440)!==40960)throw new Fe(28);return s.link}},m:{read(s,a,c,_,I){var A=s.node.j;if(I>=s.node.v)return 0;if(s=Math.min(s.node.v-I,_),8<s&&A.subarray)a.set(A.subarray(I,I+s),c);else for(_=0;_<s;_++)a[c+_]=A[I+_];return s},write(s,a,c,_,I,A){if(a.buffer===se.buffer&&(A=!1),!_)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.j||s.j.subarray)){if(A)return s.j=a.subarray(c,c+_),s.v=_;if(s.v===0&&I===0)return s.j=a.slice(c,c+_),s.v=_;if(I+_<=s.v)return s.j.set(a.subarray(c,c+_),I),_}if(ut(s,I+_),s.j.subarray&&a.subarray)s.j.set(a.subarray(c,c+_),I);else for(A=0;A<_;A++)s.j[I+A]=a[c+A];return s.v=Math.max(s.v,I+_),_},ba(s,a,c){if(c===1?a+=s.position:c===2&&(s.node.mode&61440)===32768&&(a+=s.node.v),0>a)throw new Fe(28);return a},pa(s,a,c){ut(s.node,a+c),s.node.v=Math.max(s.node.v,a+c)},mb(s,a,c,_,I){if((s.node.mode&61440)!==32768)throw new Fe(43);if(s=s.node.j,I&2||s.buffer!==se.buffer){if((0<c||c+a<s.length)&&(s.subarray?s=s.subarray(c,c+a):s=Array.prototype.slice.call(s,c,c+a)),c=!0,Ve(),a=void 0,!a)throw new Fe(48);se.set(s,a)}else c=!1,a=s.byteOffset;return{o:a,M:c}},ob(s,a,c,_){return Ie.m.write(s,a,0,_,c,!1),0}}};function ze(s,a){var c=0;return s&&(c|=365),a&&(c|=146),c}var Vt=null,Mr={},Ni=[],Vu=1,pi=null,no=!0,Fe=null,$s={},dr=(s,a={})=>{if(s=Ce(s),!s)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new Fe(32);s=s.split("/").filter(O=>!!O);for(var c=Vt,_="/",I=0;I<s.length;I++){var A=I===s.length-1;if(A&&a.parent)break;if(c=Bi(c,s[I]),_=T(_+"/"+s[I]),c.wa&&(!A||A&&a.hb)&&(c=c.wa.root),!A||a.gb){for(A=0;(c.mode&61440)===40960;)if(c=zu(_),_=Ce(q(_),c),c=dr(_,{Qa:a.Qa+1}).node,40<A++)throw new Fe(32)}}return{path:_,node:c}},ro=s=>{for(var a;;){if(s===s.parent)return s=s.U.nb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}},io=(s,a)=>{for(var c=0,_=0;_<a.length;_++)c=(c<<5)-c+a.charCodeAt(_)|0;return(s+c>>>0)%pi.length},Bi=(s,a)=>{var c;if(c=(c=Wi(s,"x"))?c:s.l.ka?0:2)throw new Fe(c,s);for(c=pi[io(s.id,a)];c;c=c.lc){var _=c.name;if(c.parent.id===s.id&&_===a)return c}return s.l.ka(s,a)},so=(s,a,c,_)=>(s=new Oo(s,a,c,_),a=io(s.parent.id,s.name),s.lc=pi[a],pi[a]=s),ao=s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},Wi=(s,a)=>{if(no)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},oo=(s,a)=>{try{return Bi(s,a),20}catch{}return Wi(s,"wx")},qu=()=>{for(var s=0;4096>=s;s++)if(!Ni[s])return s;throw new Fe(33)},zn=s=>{if(s=Ni[s],!s)throw new Fe(8);return s},lo=(s,a=-1)=>(_i||(_i=function(){this.h={}},_i.prototype={},Object.defineProperties(_i.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),s=Object.assign(new _i,s),a==-1&&(a=qu()),s.X=a,Ni[a]=s),Gu={open:s=>{s.m=Mr[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new Fe(70)}},Us=(s,a)=>{Mr[s]={m:a}},uo=(s,a)=>{var c=a==="/",_=!a;if(c&&Vt)throw new Fe(10);if(!c&&!_){var I=dr(a,{hb:!1});if(a=I.path,I=I.node,I.wa)throw new Fe(10);if((I.mode&61440)!==16384)throw new Fe(54)}a={type:s,Qc:{},nb:a,kc:[]},s=s.U(a),s.U=a,a.root=s,c?Vt=s:I&&(I.wa=a,I.U&&I.U.kc.push(a))},pn=(s,a,c)=>{var _=dr(s,{parent:!0}).node;if(s=ae(s),!s||s==="."||s==="..")throw new Fe(28);var I=oo(_,s);if(I)throw new Fe(I);if(!_.l.va)throw new Fe(63);return _.l.va(_,s,a,c)},Vi=(s,a,c)=>{typeof c>"u"&&(c=a,a=438),pn(s,a|8192,c)},Ns=(s,a)=>{if(!Ce(s))throw new Fe(44);var c=dr(a,{parent:!0}).node;if(!c)throw new Fe(44);a=ae(a);var _=oo(c,a);if(_)throw new Fe(_);if(!c.l.Ea)throw new Fe(63);c.l.Ea(c,a,s)},zu=s=>{if(s=dr(s).node,!s)throw new Fe(44);if(!s.l.ma)throw new Fe(28);return Ce(ro(s.parent),s.l.ma(s))},qi=(s,a,c)=>{if(s==="")throw new Fe(44);if(typeof a=="string"){var _={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof _>"u")throw Error(`Unknown file open mode: ${a}`);a=_}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var I=s;else{s=T(s);try{I=dr(s,{gb:!(a&131072)}).node}catch{}}if(_=!1,a&64)if(I){if(a&128)throw new Fe(20)}else I=pn(s,c,0),_=!0;if(!I)throw new Fe(44);if((I.mode&61440)===8192&&(a&=-513),a&65536&&(I.mode&61440)!==16384)throw new Fe(54);if(!_&&(c=I?(I.mode&61440)===40960?32:(I.mode&61440)===16384&&(ao(a)!=="r"||a&512)?31:Wi(I,ao(a)):44))throw new Fe(c);if(a&512&&!_){if(c=I,c=typeof c=="string"?dr(c,{gb:!0}).node:c,!c.l.P)throw new Fe(63);if((c.mode&61440)===16384)throw new Fe(31);if((c.mode&61440)!==32768)throw new Fe(28);if(_=Wi(c,"w"))throw new Fe(_);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,I=lo({node:I,path:ro(I),flags:a,seekable:!0,position:0,m:I.m,zc:[],error:!1}),I.m.open&&I.m.open(I),!p.logReadFiles||a&1||(Gi||(Gi={}),s in Gi||(Gi[s]=1)),I},co=(s,a,c)=>{if(s.X===null)throw new Fe(8);if(!s.seekable||!s.m.ba)throw new Fe(70);if(c!=0&&c!=1&&c!=2)throw new Fe(28);s.position=s.m.ba(s,a,c),s.zc=[]},fo=()=>{Fe||(Fe=function(s,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(s),this.message="FS error"},Fe.prototype=Error(),Fe.prototype.constructor=Fe,[44].forEach(s=>{$s[s]=new Fe(s),$s[s].stack="<generic error, no stack>"}))},ho,gi=(s,a,c)=>{s=T("/dev/"+s);var _=ze(!!a,!!c);Bs||(Bs=64);var I=Bs++<<8|0;Us(I,{open:A=>{A.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(A,O,H,J)=>{for(var N=0,we=0;we<J;we++){try{var Se=a()}catch{throw new Fe(29)}if(Se===void 0&&N===0)throw new Fe(6);if(Se==null)break;N++,O[H+we]=Se}return N&&(A.node.timestamp=Date.now()),N},write:(A,O,H,J)=>{for(var N=0;N<J;N++)try{c(O[H+N])}catch{throw new Fe(29)}return J&&(A.node.timestamp=Date.now()),N}}),Vi(s,_,I)},Bs,fr={},_i,Gi,mi=void 0;function Ln(){return mi+=4,ge[mi-4>>2]}function vo(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?`_${s}`:s}function zi(s,a){return s=vo(s),{[s]:function(){return a.apply(this,arguments)}}[s]}function po(){this.M=[void 0],this.ib=[]}var cn=new po,Lr=void 0;function tt(s){throw new Lr(s)}var gn=s=>(s||tt("Cannot use deleted val. handle = "+s),cn.get(s).value),_n=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return cn.pa({ub:1,value:s})}};function go(s){var a=Error,c=zi(s,function(_){this.name=s,this.message=_,_=Error(_).stack,_!==void 0&&(this.stack=this.toString()+`
`+_.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var _o=void 0,mo=void 0;function Ut(s){for(var a="";le[s];)a+=mo[le[s++]];return a}var yi=[];function Ws(){for(;yi.length;){var s=yi.pop();s.g.fa=!1,s.delete()}}var wi=void 0,Dn={};function Vs(s,a){for(a===void 0&&tt("ptr should not be undefined");s.A;)a=s.na(a),s=s.A;return a}var hr={};function yo(s){s=No(s);var a=Ut(s);return Un(s),a}function bi(s,a){var c=hr[s];return c===void 0&&tt(a+" has unknown type "+yo(s)),c}function Hi(){}var qs=!1;function wo(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function bo(s,a,c){return a===c?s:c.A===void 0?null:(s=bo(s,a,c.A),s===null?null:c.Pb(s))}var ko={};function Hu(s,a){return a=Vs(s,a),Dn[a]}var Io=void 0;function Ki(s){throw new Io(s)}function Yi(s,a){return a.u&&a.o||Ki("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Ki("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Dr(Object.create(s,{g:{value:a}}))}function Dr(s){return typeof FinalizationRegistry>"u"?(Dr=a=>a,s):(qs=new FinalizationRegistry(a=>{wo(a.g)}),Dr=a=>{var c=a.g;return c.G&&qs.register(a,{g:c},a),a},Hi=a=>{qs.unregister(a)},Dr(s))}var Ji={};function ki(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function Ii(s){return this.fromWireType(ge[s>>2])}var Fr={},Xi={};function on(s,a,c){function _(H){H=c(H),H.length!==s.length&&Ki("Mismatched type converter count");for(var J=0;J<s.length;++J)Sn(s[J],H[J])}s.forEach(function(H){Xi[H]=a});var I=Array(a.length),A=[],O=0;a.forEach((H,J)=>{hr.hasOwnProperty(H)?I[J]=hr[H]:(A.push(H),Fr.hasOwnProperty(H)||(Fr[H]=[]),Fr[H].push(()=>{I[J]=hr[H],++O,O===A.length&&_(I)}))}),A.length===0&&_(I)}function Qi(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Ku(s,a,c={}){var _=a.name;if(s||tt(`type "${_}" must have a positive integer typeid pointer`),hr.hasOwnProperty(s)){if(c.$b)return;tt(`Cannot register type '${_}' twice`)}hr[s]=a,delete Xi[s],Fr.hasOwnProperty(s)&&(a=Fr[s],delete Fr[s],a.forEach(I=>I()))}function Sn(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Ku(s,a,c)}function Gs(s){tt(s.g.u.i.name+" instance already deleted")}function Hn(){}function zs(s,a,c){if(s[a].B===void 0){var _=s[a];s[a]=function(){return s[a].B.hasOwnProperty(arguments.length)||tt(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[a].B})!`),s[a].B[arguments.length].apply(this,arguments)},s[a].B=[],s[a].B[_.ea]=_}}function Hs(s,a,c){p.hasOwnProperty(s)?((c===void 0||p[s].B!==void 0&&p[s].B[c]!==void 0)&&tt(`Cannot register public name '${s}' twice`),zs(p,s,s),p.hasOwnProperty(c)&&tt(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),p[s].B[c]=a):(p[s]=a,c!==void 0&&(p[s].Pc=c))}function Yu(s,a,c,_,I,A,O,H){this.name=s,this.constructor=a,this.N=c,this.W=_,this.A=I,this.Ub=A,this.na=O,this.Pb=H,this.rb=[]}function Zi(s,a,c){for(;a!==c;)a.na||tt(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),s=a.na(s),a=a.A;return s}function Ju(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Xu(s,a){if(a===null){if(this.Na&&tt(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return s!==null&&s.push(this.W,c),c}return 0}if(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Zi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&tt("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var _=a.clone();c=this.oc(c,_n(function(){_.delete()})),s!==null&&s.push(this.W,c)}break;default:tt("Unsupporting sharing policy")}return c}function Qu(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Fn(s,a,c,_){this.name=s,this.i=a,this.Na=c,this.ta=_,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Xu:(this.toWireType=_?Ju:Qu,this.K=null)}function So(s,a,c){p.hasOwnProperty(s)||Ki("Replacing nonexistant public symbol"),p[s].B!==void 0&&c!==void 0?p[s].B[c]=a:(p[s]=a,p[s].ea=c)}var es=[],Eo=s=>{var a=es[s];return a||(s>=es.length&&(es.length=s+1),es[s]=a=re.get(s)),a},Zu=(s,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),s.includes("j")){var _=p["dynCall_"+s];_=c&&c.length?_.apply(null,[a].concat(c)):_.call(null,a)}else _=Eo(a).apply(null,c);return _}};function Qt(s,a){s=Ut(s);var c=s.includes("j")?Zu(s,a):Eo(a);return typeof c!="function"&&tt(`unknown function pointer with signature ${s}: ${a}`),c}var Ao=void 0;function $n(s,a){function c(A){I[A]||hr[A]||(Xi[A]?Xi[A].forEach(c):(_.push(A),I[A]=!0))}var _=[],I={};throw a.forEach(c),new Ao(`${s}: `+_.map(yo).join([", "]))}function ts(s,a,c,_,I){var A=a.length;2>A&&tt("argTypes array size mismatch! Must at least get return value and 'this' types!");var O=a[1]!==null&&c!==null,H=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){H=!0;break}var J=a[0].name!=="void",N=A-2,we=Array(N),Se=[],De=[];return function(){if(arguments.length!==N&&tt(`function ${s} called with ${arguments.length} arguments, expected ${N} args!`),De.length=0,Se.length=O?2:1,Se[0]=I,O){var D=a[1].toWireType(De,this);Se[1]=D}for(var ye=0;ye<N;++ye)we[ye]=a[ye+2].toWireType(De,arguments[ye]),Se.push(we[ye]);if(ye=_.apply(null,Se),H)ki(De);else for(var ve=O?1:2;ve<a.length;ve++){var nt=ve===1?D:we[ve-2];a[ve].K!==null&&a[ve].K(nt)}return D=J?a[0].fromWireType(ye):void 0,D}}function ns(s,a){for(var c=[],_=0;_<s;_++)c.push(Me[a+4*_>>2]);return c}function Co(s,a,c){return s instanceof Object||tt(`${c} with invalid "this": ${s}`),s instanceof a.i.constructor||tt(`${c} incompatible with "this" of type ${s.constructor.name}`),s.g.o||tt(`cannot call emscripten binding method ${c} on deleted object`),Zi(s.g.o,s.g.u.i,a.i)}function Ks(s){s>=cn.h&&--cn.get(s).ub===0&&cn.Zb(s)}function ec(s,a,c){switch(a){case 0:return function(_){return this.fromWireType((c?se:le)[_])};case 1:return function(_){return this.fromWireType((c?me:Ee)[_>>1])};case 2:return function(_){return this.fromWireType((c?ge:Me)[_>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Ys(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function tc(s,a){switch(a){case 2:return function(c){return this.fromWireType(de[c>>2])};case 3:return function(c){return this.fromWireType(te[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function nc(s,a,c){switch(a){case 0:return c?function(_){return se[_]}:function(_){return le[_]};case 1:return c?function(_){return me[_>>1]}:function(_){return Ee[_>>1]};case 2:return c?function(_){return ge[_>>2]}:function(_){return Me[_>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var jo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,rc=(s,a)=>{for(var c=s>>1,_=c+a/2;!(c>=_)&&Ee[c];)++c;if(c<<=1,32<c-s&&jo)return jo.decode(le.subarray(s,c));for(c="",_=0;!(_>=a/2);++_){var I=me[s+2*_>>1];if(I==0)break;c+=String.fromCharCode(I)}return c},ic=(s,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var _=a;c=c<2*s.length?c/2:s.length;for(var I=0;I<c;++I)me[a>>1]=s.charCodeAt(I),a+=2;return me[a>>1]=0,a-_},sc=s=>2*s.length,ac=(s,a)=>{for(var c=0,_="";!(c>=a/4);){var I=ge[s+4*c>>2];if(I==0)break;++c,65536<=I?(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023)):_+=String.fromCharCode(I)}return _},oc=(s,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var _=a;c=_+c-4;for(var I=0;I<s.length;++I){var A=s.charCodeAt(I);if(55296<=A&&57343>=A){var O=s.charCodeAt(++I);A=65536+((A&1023)<<10)|O&1023}if(ge[a>>2]=A,a+=4,a+4>c)break}return ge[a>>2]=0,a-_},lc=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);55296<=_&&57343>=_&&++c,a+=4}return a},uc={};function rs(s){var a=uc[s];return a===void 0?Ut(s):a}var is=[];function cc(s){var a=is.length;return is.push(s),a}function dc(s,a){for(var c=Array(s),_=0;_<s;++_)c[_]=bi(Me[a+4*_>>2],"parameter "+_);return c}var To=[],Js=[],Xs={},xo=()=>{if(!Qs){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:P||"./this.program"},a;for(a in Xs)Xs[a]===void 0?delete s[a]:s[a]=Xs[a];var c=[];for(a in s)c.push(`${a}=${s[a]}`);Qs=c}return Qs},Qs,ss=s=>s%4===0&&(s%100!==0||s%400===0),Po=[31,29,31,30,31,30,31,31,30,31,30,31],Ro=[31,28,31,30,31,30,31,31,30,31,30,31],fc=(s,a,c,_)=>{function I(D,ye,ve){for(D=typeof D=="number"?D.toString():D||"";D.length<ye;)D=ve[0]+D;return D}function A(D,ye){return I(D,ye,"0")}function O(D,ye){function ve(at){return 0>at?-1:0<at?1:0}var nt;return(nt=ve(D.getFullYear()-ye.getFullYear()))===0&&(nt=ve(D.getMonth()-ye.getMonth()))===0&&(nt=ve(D.getDate()-ye.getDate())),nt}function H(D){switch(D.getDay()){case 0:return new Date(D.getFullYear()-1,11,29);case 1:return D;case 2:return new Date(D.getFullYear(),0,3);case 3:return new Date(D.getFullYear(),0,2);case 4:return new Date(D.getFullYear(),0,1);case 5:return new Date(D.getFullYear()-1,11,31);case 6:return new Date(D.getFullYear()-1,11,30)}}function J(D){var ye=D.ca;for(D=new Date(new Date(D.da+1900,0,1).getTime());0<ye;){var ve=D.getMonth(),nt=(ss(D.getFullYear())?Po:Ro)[ve];if(ye>nt-D.getDate())ye-=nt-D.getDate()+1,D.setDate(1),11>ve?D.setMonth(ve+1):(D.setMonth(0),D.setFullYear(D.getFullYear()+1));else{D.setDate(D.getDate()+ye);break}}return ve=new Date(D.getFullYear()+1,0,4),ye=H(new Date(D.getFullYear(),0,4)),ve=H(ve),0>=O(ye,D)?0>=O(ve,D)?D.getFullYear()+1:D.getFullYear():D.getFullYear()-1}var N=ge[_+40>>2];_={wc:ge[_>>2],vc:ge[_+4>>2],Fa:ge[_+8>>2],Sa:ge[_+12>>2],Ga:ge[_+16>>2],da:ge[_+20>>2],R:ge[_+24>>2],ca:ge[_+28>>2],Rc:ge[_+32>>2],uc:ge[_+36>>2],xc:N&&N?Ke(le,N):""},c=c?Ke(le,c):"",N={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var we in N)c=c.replace(new RegExp(we,"g"),N[we]);var Se="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),De="January February March April May June July August September October November December".split(" ");N={"%a":D=>Se[D.R].substring(0,3),"%A":D=>Se[D.R],"%b":D=>De[D.Ga].substring(0,3),"%B":D=>De[D.Ga],"%C":D=>A((D.da+1900)/100|0,2),"%d":D=>A(D.Sa,2),"%e":D=>I(D.Sa,2," "),"%g":D=>J(D).toString().substring(2),"%G":D=>J(D),"%H":D=>A(D.Fa,2),"%I":D=>(D=D.Fa,D==0?D=12:12<D&&(D-=12),A(D,2)),"%j":D=>{for(var ye=0,ve=0;ve<=D.Ga-1;ye+=(ss(D.da+1900)?Po:Ro)[ve++]);return A(D.Sa+ye,3)},"%m":D=>A(D.Ga+1,2),"%M":D=>A(D.vc,2),"%n":()=>`
`,"%p":D=>0<=D.Fa&&12>D.Fa?"AM":"PM","%S":D=>A(D.wc,2),"%t":()=>"	","%u":D=>D.R||7,"%U":D=>A(Math.floor((D.ca+7-D.R)/7),2),"%V":D=>{var ye=Math.floor((D.ca+7-(D.R+6)%7)/7);if(2>=(D.R+371-D.ca-2)%7&&ye++,ye)ye==53&&(ve=(D.R+371-D.ca)%7,ve==4||ve==3&&ss(D.da)||(ye=1));else{ye=52;var ve=(D.R+7-D.ca-1)%7;(ve==4||ve==5&&ss(D.da%400-1))&&ye++}return A(ye,2)},"%w":D=>D.R,"%W":D=>A(Math.floor((D.ca+7-(D.R+6)%7)/7),2),"%y":D=>(D.da+1900).toString().substring(2),"%Y":D=>D.da+1900,"%z":D=>{D=D.uc;var ye=0<=D;return D=Math.abs(D)/60,(ye?"+":"-")+("0000"+(D/60*100+D%60)).slice(-4)},"%Z":D=>D.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(we in N)c.includes(we)&&(c=c.replace(new RegExp(we,"g"),N[we](_)));return c=c.replace(/\0\0/g,"%"),we=$t(c,!1),we.length>a?0:(se.set(we,s),we.length-1)};function Oo(s,a,c,_){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Vu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=_}Object.defineProperties(Oo.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),fo(),pi=Array(4096),uo(Ie,"/"),pn("/tmp",16895,0),pn("/home",16895,0),pn("/home/web_user",16895,0),(()=>{pn("/dev",16895,0),Us(259,{read:()=>0,write:(_,I,A,O)=>O}),Vi("/dev/null",259),et(1280,kt),et(1536,st),Vi("/dev/tty",1280),Vi("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=$e(s).byteLength),s[--a]);gi("random",c),gi("urandom",c),pn("/dev/shm",16895,0),pn("/dev/shm/tmp",16895,0)})(),(()=>{pn("/proc",16895,0);var s=pn("/proc/self",16895,0);pn("/proc/self/fd",16895,0),uo({U:()=>{var a=so(s,"fd",16895,73);return a.l={ka:(c,_)=>{var I=zn(+_);return c={parent:null,U:{nb:"fake"},l:{ma:()=>I.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(po.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var a=this.ib.pop()||this.M.length;return this.M[a]=s,a},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Lr=p.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},cn.M.push({value:void 0},{value:null},{value:!0},{value:!1}),cn.h=cn.M.length,p.count_emval_handles=function(){for(var s=0,a=cn.h;a<cn.M.length;++a)cn.M[a]!==void 0&&++s;return s},_o=p.PureVirtualError=go("PureVirtualError");for(var Mo=Array(256),as=0;256>as;++as)Mo[as]=String.fromCharCode(as);mo=Mo,p.getInheritedInstanceCount=function(){return Object.keys(Dn).length},p.getLiveInheritedInstances=function(){var s=[],a;for(a in Dn)Dn.hasOwnProperty(a)&&s.push(Dn[a]);return s},p.flushPendingDeletes=Ws,p.setDelayFunction=function(s){wi=s,yi.length&&wi&&wi(Ws)},Io=p.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Hn.prototype.isAliasOf=function(s){if(!(this instanceof Hn&&s instanceof Hn))return!1;var a=this.g.u.i,c=this.g.o,_=s.g.u.i;for(s=s.g.o;a.A;)c=a.na(c),a=a.A;for(;_.A;)s=_.na(s),_=_.A;return a===_&&c===s},Hn.prototype.clone=function(){if(this.g.o||Gs(this),this.g.ia)return this.g.count.value+=1,this;var s=Dr,a=Object,c=a.create,_=Object.getPrototypeOf(this),I=this.g;return s=s(c.call(a,_,{g:{value:{count:I.count,fa:I.fa,ia:I.ia,o:I.o,u:I.u,G:I.G,L:I.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Hn.prototype.delete=function(){this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),Hi(this),wo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Hn.prototype.isDeleted=function(){return!this.g.o},Hn.prototype.deleteLater=function(){return this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),yi.push(this),yi.length===1&&wi&&wi(Ws),this.g.fa=!0,this},Fn.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Fn.prototype.bb=function(s){this.W&&this.W(s)},Fn.prototype.argPackAdvance=8,Fn.prototype.readValueFromPointer=Ii,Fn.prototype.deleteObject=function(s){s!==null&&s.delete()},Fn.prototype.fromWireType=function(s){function a(){return this.ua?Yi(this.i.N,{u:this.nc,o:c,L:this,G:s}):Yi(this.i.N,{u:this,o:s})}var c=this.Vb(s);if(!c)return this.bb(s),null;var _=Hu(this.i,c);if(_!==void 0)return _.g.count.value===0?(_.g.o=c,_.g.G=s,_.clone()):(_=_.clone(),this.bb(s),_);if(_=this.i.Ub(c),_=ko[_],!_)return a.call(this);_=this.ta?_.Kb:_.pointerType;var I=bo(c,this.i,_.i);return I===null?a.call(this):this.ua?Yi(_.i.N,{u:_,o:I,L:this,G:s}):Yi(_.i.N,{u:_,o:I})},Ao=p.UnboundTypeError=go("UnboundTypeError");var Lo={__syscall_fcntl64:function(s,a,c){mi=c;try{var _=zn(s);switch(a){case 0:var I=Ln();return 0>I?-28:lo(_,I).X;case 1:case 2:return 0;case 3:return _.flags;case 4:return I=Ln(),_.flags|=I,0;case 5:return I=Ln(),me[I+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ge[Do()>>2]=28,-1;default:return-28}}catch(A){if(typeof fr>"u"||A.name!=="ErrnoError")throw A;return-A.aa}},__syscall_ioctl:function(s,a,c){mi=c;try{var _=zn(s);switch(a){case 21509:return _.s?0:-59;case 21505:if(!_.s)return-59;if(_.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var I=Ln();ge[I>>2]=25856,ge[I+4>>2]=5,ge[I+8>>2]=191,ge[I+12>>2]=35387;for(var A=0;32>A;A++)se[I+A+17>>0]=a[A]||0}return 0;case 21510:case 21511:case 21512:return _.s?0:-59;case 21506:case 21507:case 21508:if(!_.s)return-59;if(_.s.V.cc)for(I=Ln(),a=[],A=0;32>A;A++)a.push(se[I+A+17>>0]);return 0;case 21519:return _.s?(I=Ln(),ge[I>>2]=0):-59;case 21520:return _.s?-28:-59;case 21531:if(I=Ln(),!_.m.ac)throw new Fe(59);return _.m.ac(_,a,I);case 21523:return _.s?(_.s.V.dc&&(A=[24,80],I=Ln(),me[I>>1]=A[0],me[I+2>>1]=A[1]),0):-59;case 21524:return _.s?0:-59;case 21515:return _.s?0:-59;default:return-28}}catch(O){if(typeof fr>"u"||O.name!=="ErrnoError")throw O;return-O.aa}},__syscall_openat:function(s,a,c,_){mi=_;try{a=a?Ke(le,a):"";var I=a;if(I.charAt(0)==="/")a=I;else{var A=s===-100?"/":zn(s).path;if(I.length==0)throw new Fe(44);a=T(A+"/"+I)}var O=_?Ln():0;return qi(a,c,O).X}catch(H){if(typeof fr>"u"||H.name!=="ErrnoError")throw H;return-H.aa}},_embind_create_inheriting_constructor:function(s,a,c){s=Ut(s),a=bi(a,"wrapper"),c=gn(c);var _=[].slice,I=a.i,A=I.N,O=I.A.N,H=I.A.constructor;s=zi(s,function(){I.A.rb.forEach((function(N){if(this[N]===O[N])throw new _o(`Pure virtual function ${N} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:A}),this.__construct.apply(this,_.call(arguments))}),A.__construct=function(){this===A&&tt("Pass correct 'this' to __construct");var N=H.implement.apply(void 0,[this].concat(_.call(arguments)));Hi(N);var we=N.g;N.notifyOnDestruction(),we.ia=!0,Object.defineProperties(this,{g:{value:we}}),Dr(this),N=we.o,N=Vs(I,N),Dn.hasOwnProperty(N)?tt(`Tried to register registered instance: ${N}`):Dn[N]=this},A.__destruct=function(){this===A&&tt("Pass correct 'this' to __destruct"),Hi(this);var N=this.g.o;N=Vs(I,N),Dn.hasOwnProperty(N)?delete Dn[N]:tt(`Tried to unregister unregistered instance: ${N}`)},s.prototype=Object.create(A);for(var J in c)s.prototype[J]=c[J];return _n(s)},_embind_finalize_value_object:function(s){var a=Ji[s];delete Ji[s];var c=a.Pa,_=a.W,I=a.fb,A=I.map(O=>O.Yb).concat(I.map(O=>O.rc));on([s],A,O=>{var H={};return I.forEach((J,N)=>{var we=O[N],Se=J.Wb,De=J.Xb,D=O[N+I.length],ye=J.qc,ve=J.sc;H[J.Sb]={read:nt=>we.fromWireType(Se(De,nt)),write:(nt,at)=>{var xe=[];ye(ve,nt,D.toWireType(xe,at)),ki(xe)}}}),[{name:a.name,fromWireType:function(J){var N={},we;for(we in H)N[we]=H[we].read(J);return _(J),N},toWireType:function(J,N){for(var we in H)if(!(we in N))throw new TypeError(`Missing field: "${we}"`);var Se=c();for(we in H)H[we].write(Se,N[we]);return J!==null&&J.push(_,Se),Se},argPackAdvance:8,readValueFromPointer:Ii,K:_}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,a,c,_,I){var A=Qi(c);a=Ut(a),Sn(s,{name:a,fromWireType:function(O){return!!O},toWireType:function(O,H){return H?_:I},argPackAdvance:8,readValueFromPointer:function(O){if(c===1)var H=se;else if(c===2)H=me;else if(c===4)H=ge;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(H[O>>A])},K:null})},_embind_register_class:function(s,a,c,_,I,A,O,H,J,N,we,Se,De){we=Ut(we),A=Qt(I,A),H&&(H=Qt(O,H)),N&&(N=Qt(J,N)),De=Qt(Se,De);var D=vo(we);Hs(D,function(){$n(`Cannot construct ${we} due to unbound types`,[_])}),on([s,a,c],_?[_]:[],function(ye){if(ye=ye[0],_)var ve=ye.i,nt=ve.N;else nt=Hn.prototype;ye=zi(D,function(){if(Object.getPrototypeOf(this)!==at)throw new Lr("Use 'new' to construct "+we);if(xe.$===void 0)throw new Lr(we+" has no accessible constructor");var Xt=xe.$[arguments.length];if(Xt===void 0)throw new Lr(`Tried to invoke ctor of ${we} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(xe.$).toString()}) parameters instead!`);return Xt.apply(this,arguments)});var at=Object.create(nt,{constructor:{value:ye}});ye.prototype=at;var xe=new Yu(we,ye,at,De,ve,A,H,N);xe.A&&(xe.A.oa===void 0&&(xe.A.oa=[]),xe.A.oa.push(xe)),ve=new Fn(we,xe,!0,!1),nt=new Fn(we+"*",xe,!1,!1);var Mt=new Fn(we+" const*",xe,!1,!0);return ko[s]={pointerType:nt,Kb:Mt},So(D,ye),[ve,nt,Mt]})},_embind_register_class_class_function:function(s,a,c,_,I,A,O){var H=ns(c,_);a=Ut(a),A=Qt(I,A),on([],[s],function(J){function N(){$n(`Cannot call ${we} due to unbound types`,H)}J=J[0];var we=`${J.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var Se=J.i.constructor;return Se[a]===void 0?(N.ea=c-1,Se[a]=N):(zs(Se,a,we),Se[a].B[c-1]=N),on([],H,function(De){if(De=ts(we,[De[0],null].concat(De.slice(1)),null,A,O),Se[a].B===void 0?(De.ea=c-1,Se[a]=De):Se[a].B[c-1]=De,J.i.oa)for(const D of J.i.oa)D.constructor.hasOwnProperty(a)||(D.constructor[a]=De);return[]}),[]})},_embind_register_class_class_property:function(s,a,c,_,I,A,O,H){a=Ut(a),A=Qt(I,A),on([],[s],function(J){J=J[0];var N=`${J.name}.${a}`,we={get(){$n(`Cannot access ${N} due to unbound types`,[c])},enumerable:!0,configurable:!0};return we.set=H?()=>{$n(`Cannot access ${N} due to unbound types`,[c])}:()=>{tt(`${N} is a read-only property`)},Object.defineProperty(J.i.constructor,a,we),on([],[c],function(Se){Se=Se[0];var De={get(){return Se.fromWireType(A(_))},enumerable:!0};return H&&(H=Qt(O,H),De.set=D=>{var ye=[];H(_,Se.toWireType(ye,D)),ki(ye)}),Object.defineProperty(J.i.constructor,a,De),[]}),[]})},_embind_register_class_constructor:function(s,a,c,_,I,A){var O=ns(a,c);I=Qt(_,I),on([],[s],function(H){H=H[0];var J=`constructor ${H.name}`;if(H.i.$===void 0&&(H.i.$=[]),H.i.$[a-1]!==void 0)throw new Lr(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${H.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return H.i.$[a-1]=()=>{$n(`Cannot construct ${H.name} due to unbound types`,O)},on([],O,function(N){return N.splice(1,0,null),H.i.$[a-1]=ts(J,N,null,I,A),[]}),[]})},_embind_register_class_function:function(s,a,c,_,I,A,O,H){var J=ns(c,_);a=Ut(a),A=Qt(I,A),on([],[s],function(N){function we(){$n(`Cannot call ${Se} due to unbound types`,J)}N=N[0];var Se=`${N.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),H&&N.i.rb.push(a);var De=N.i.N,D=De[a];return D===void 0||D.B===void 0&&D.className!==N.name&&D.ea===c-2?(we.ea=c-2,we.className=N.name,De[a]=we):(zs(De,a,Se),De[a].B[c-2]=we),on([],J,function(ye){return ye=ts(Se,ye,N,A,O),De[a].B===void 0?(ye.ea=c-2,De[a]=ye):De[a].B[c-2]=ye,[]}),[]})},_embind_register_class_property:function(s,a,c,_,I,A,O,H,J,N){a=Ut(a),I=Qt(_,I),on([],[s],function(we){we=we[0];var Se=`${we.name}.${a}`,De={get(){$n(`Cannot access ${Se} due to unbound types`,[c,O])},enumerable:!0,configurable:!0};return De.set=J?()=>{$n(`Cannot access ${Se} due to unbound types`,[c,O])}:()=>{tt(Se+" is a read-only property")},Object.defineProperty(we.i.N,a,De),on([],J?[c,O]:[c],function(D){var ye=D[0],ve={get(){var at=Co(this,we,Se+" getter");return ye.fromWireType(I(A,at))},enumerable:!0};if(J){J=Qt(H,J);var nt=D[1];ve.set=function(at){var xe=Co(this,we,Se+" setter"),Mt=[];J(N,xe,nt.toWireType(Mt,at)),ki(Mt)}}return Object.defineProperty(we.i.N,a,ve),[]}),[]})},_embind_register_emval:function(s,a){a=Ut(a),Sn(s,{name:a,fromWireType:function(c){var _=gn(c);return Ks(c),_},toWireType:function(c,_){return _n(_)},argPackAdvance:8,readValueFromPointer:Ii,K:null})},_embind_register_enum:function(s,a,c,_){function I(){}c=Qi(c),a=Ut(a),I.values={},Sn(s,{name:a,constructor:I,fromWireType:function(A){return this.constructor.values[A]},toWireType:function(A,O){return O.value},argPackAdvance:8,readValueFromPointer:ec(a,c,_),K:null}),Hs(a,I)},_embind_register_enum_value:function(s,a,c){var _=bi(s,"enum");a=Ut(a),s=_.constructor,_=Object.create(_.constructor.prototype,{value:{value:c},constructor:{value:zi(`${_.name}_${a}`,function(){})}}),s.values[c]=_,s[a]=_},_embind_register_float:function(s,a,c){c=Qi(c),a=Ut(a),Sn(s,{name:a,fromWireType:function(_){return _},toWireType:function(_,I){return I},argPackAdvance:8,readValueFromPointer:tc(a,c),K:null})},_embind_register_function:function(s,a,c,_,I,A){var O=ns(a,c);s=Ut(s),I=Qt(_,I),Hs(s,function(){$n(`Cannot call ${s} due to unbound types`,O)},a-1),on([],O,function(H){return So(s,ts(s,[H[0],null].concat(H.slice(1)),null,I,A),a-1),[]})},_embind_register_integer:function(s,a,c,_,I){a=Ut(a),I===-1&&(I=4294967295),I=Qi(c);var A=H=>H;if(_===0){var O=32-8*c;A=H=>H<<O>>>O}c=a.includes("unsigned")?function(H,J){return J>>>0}:function(H,J){return J},Sn(s,{name:a,fromWireType:A,toWireType:c,argPackAdvance:8,readValueFromPointer:nc(a,I,_!==0),K:null})},_embind_register_memory_view:function(s,a,c){function _(A){A>>=2;var O=Me;return new I(O.buffer,O[A+1],O[A])}var I=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Ut(c),Sn(s,{name:c,fromWireType:_,argPackAdvance:8,readValueFromPointer:_},{$b:!0})},_embind_register_std_string:function(s,a){a=Ut(a);var c=a==="std::string";Sn(s,{name:a,fromWireType:function(_){var I=Me[_>>2],A=_+4;if(c)for(var O=A,H=0;H<=I;++H){var J=A+H;if(H==I||le[J]==0){if(O=O?Ke(le,O,J-O):"",N===void 0)var N=O;else N+="\0",N+=O;O=J+1}}else{for(N=Array(I),H=0;H<I;++H)N[H]=String.fromCharCode(le[A+H]);N=N.join("")}return Un(_),N},toWireType:function(_,I){I instanceof ArrayBuffer&&(I=new Uint8Array(I));var A=typeof I=="string";A||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int8Array||tt("Cannot pass non-string to std::string");var O=c&&A?ft(I):I.length,H=Zs(4+O+1),J=H+4;if(Me[H>>2]=O,c&&A)Wt(I,le,J,O+1);else if(A)for(A=0;A<O;++A){var N=I.charCodeAt(A);255<N&&(Un(J),tt("String has UTF-16 code units that do not fit in 8 bits")),le[J+A]=N}else for(A=0;A<O;++A)le[J+A]=I[A];return _!==null&&_.push(Un,H),H},argPackAdvance:8,readValueFromPointer:Ii,K:function(_){Un(_)}})},_embind_register_std_wstring:function(s,a,c){if(c=Ut(c),a===2)var _=rc,I=ic,A=sc,O=()=>Ee,H=1;else a===4&&(_=ac,I=oc,A=lc,O=()=>Me,H=2);Sn(s,{name:c,fromWireType:function(J){for(var N=Me[J>>2],we=O(),Se,De=J+4,D=0;D<=N;++D){var ye=J+4+D*a;(D==N||we[ye>>H]==0)&&(De=_(De,ye-De),Se===void 0?Se=De:(Se+="\0",Se+=De),De=ye+a)}return Un(J),Se},toWireType:function(J,N){typeof N!="string"&&tt(`Cannot pass non-string to C++ string type ${c}`);var we=A(N),Se=Zs(4+we+a);return Me[Se>>2]=we>>H,I(N,Se+4,we+a),J!==null&&J.push(Un,Se),Se},argPackAdvance:8,readValueFromPointer:Ii,K:function(J){Un(J)}})},_embind_register_value_object:function(s,a,c,_,I,A){Ji[s]={name:Ut(a),Pa:Qt(c,_),W:Qt(I,A),fb:[]}},_embind_register_value_object_field:function(s,a,c,_,I,A,O,H,J,N){Ji[s].fb.push({Sb:Ut(a),Yb:c,Wb:Qt(_,I),Xb:A,rc:O,qc:Qt(H,J),sc:N})},_embind_register_void:function(s,a){a=Ut(a),Sn(s,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,a,c){s=gn(s),a=bi(a,"emval::as");var _=[],I=_n(_);return Me[c>>2]=I,a.toWireType(_,s)},_emval_call_method:function(s,a,c,_,I){s=is[s],a=gn(a),c=rs(c);var A=[];return Me[_>>2]=_n(A),s(a,c,A,I)},_emval_call_void_method:function(s,a,c,_){s=is[s],a=gn(a),c=rs(c),s(a,c,null,_)},_emval_decref:Ks,_emval_get_method_caller:function(s,a){var c=dc(s,a),_=c[0];a=_.name+"_$"+c.slice(1).map(function(O){return O.name}).join("_")+"$";var I=To[a];if(I!==void 0)return I;var A=Array(s-1);return I=cc((O,H,J,N)=>{for(var we=0,Se=0;Se<s-1;++Se)A[Se]=c[Se+1].readValueFromPointer(N+we),we+=c[Se+1].argPackAdvance;for(O=O[H].apply(O,A),Se=0;Se<s-1;++Se)c[Se+1].Nb&&c[Se+1].Nb(A[Se]);if(!_.fc)return _.toWireType(J,O)}),To[a]=I},_emval_get_module_property:function(s){return s=rs(s),_n(p[s])},_emval_get_property:function(s,a){return s=gn(s),a=gn(a),_n(s[a])},_emval_incref:function(s){4<s&&(cn.get(s).ub+=1)},_emval_new_array:function(){return _n([])},_emval_new_cstring:function(s){return _n(rs(s))},_emval_new_object:function(){return _n({})},_emval_run_destructors:function(s){var a=gn(s);ki(a),Ks(s)},_emval_set_property:function(s,a,c){s=gn(s),a=gn(a),c=gn(c),s[a]=c},_emval_take_value:function(s,a){return s=bi(s,"_emval_take_value"),s=s.readValueFromPointer(a),_n(s)},abort:()=>{Ve("")},emscripten_asm_const_int:(s,a,c)=>{Js.length=0;var _;for(c>>=2;_=le[a++];)c+=_!=105&c,Js.push(_==105?ge[c]:te[c++>>1]),++c;return o[s].apply(null,Js)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,a,c)=>le.copyWithin(s,a,a+c),emscripten_resize_heap:s=>{var a=le.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var _=a*(1+.2/c);_=Math.min(_,s+100663296);var I=Math;_=Math.max(s,_);e:{I=I.min.call(I,2147483648,_+(65536-_%65536)%65536)-ee.buffer.byteLength+65535>>>16;try{ee.grow(I),Z();var A=1;break e}catch{}A=void 0}if(A)return!0}return!1},environ_get:(s,a)=>{var c=0;return xo().forEach(function(_,I){var A=a+c;for(I=Me[s+4*I>>2]=A,A=0;A<_.length;++A)se[I++>>0]=_.charCodeAt(A);se[I>>0]=0,c+=_.length+1}),0},environ_sizes_get:(s,a)=>{var c=xo();Me[s>>2]=c.length;var _=0;return c.forEach(function(I){_+=I.length+1}),Me[a>>2]=_,0},fd_close:function(s){try{var a=zn(s);if(a.X===null)throw new Fe(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Ni[a.X]=null}return a.X=null,0}catch(c){if(typeof fr>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(s,a,c,_){try{e:{var I=zn(s);s=a;for(var A,O=a=0;O<c;O++){var H=Me[s>>2],J=Me[s+4>>2];s+=8;var N=I,we=H,Se=J,De=A,D=se;if(0>Se||0>De)throw new Fe(28);if(N.X===null)throw new Fe(8);if((N.flags&2097155)===1)throw new Fe(8);if((N.node.mode&61440)===16384)throw new Fe(31);if(!N.m.read)throw new Fe(28);var ye=typeof De<"u";if(!ye)De=N.position;else if(!N.seekable)throw new Fe(70);var ve=N.m.read(N,D,we,Se,De);ye||(N.position+=ve);var nt=ve;if(0>nt){var at=-1;break e}if(a+=nt,nt<J)break;typeof A<"u"&&(A+=nt)}at=a}return Me[_>>2]=at,0}catch(xe){if(typeof fr>"u"||xe.name!=="ErrnoError")throw xe;return xe.aa}},fd_seek:function(s,a,c,_,I){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var A=zn(s);return co(A,a,_),y=[A.position>>>0,(St=A.position,1<=+Math.abs(St)?0<St?+Math.floor(St/4294967296)>>>0:~~+Math.ceil((St-+(~~St>>>0))/4294967296)>>>0:0)],ge[I>>2]=y[0],ge[I+4>>2]=y[1],A.Ma&&a===0&&_===0&&(A.Ma=null),0}catch(O){if(typeof fr>"u"||O.name!=="ErrnoError")throw O;return O.aa}},fd_write:function(s,a,c,_){try{e:{var I=zn(s);s=a;for(var A,O=a=0;O<c;O++){var H=Me[s>>2],J=Me[s+4>>2];s+=8;var N=I,we=H,Se=J,De=A,D=se;if(0>Se||0>De)throw new Fe(28);if(N.X===null)throw new Fe(8);if((N.flags&2097155)===0)throw new Fe(8);if((N.node.mode&61440)===16384)throw new Fe(31);if(!N.m.write)throw new Fe(28);N.seekable&&N.flags&1024&&co(N,0,2);var ye=typeof De<"u";if(!ye)De=N.position;else if(!N.seekable)throw new Fe(70);var ve=N.m.write(N,D,we,Se,De,void 0);ye||(N.position+=ve);var nt=ve;if(0>nt){var at=-1;break e}a+=nt,typeof A<"u"&&(A+=nt)}at=a}return Me[_>>2]=at,0}catch(xe){if(typeof fr>"u"||xe.name!=="ErrnoError")throw xe;return xe.aa}},strftime_l:(s,a,c,_)=>fc(s,a,c,_)};(function(){function s(c){if(L=c=c.exports,ee=L.memory,Z(),re=L.__indirect_function_table,Q.unshift(L.__wasm_call_ctors),je--,p.monitorRunDependencies&&p.monitorRunDependencies(je),je==0&&Ne){var _=Ne;Ne=null,_()}return c}var a={env:Lo,wasi_snapshot_preview1:Lo};if(je++,p.monitorRunDependencies&&p.monitorRunDependencies(je),p.instantiateWasm)try{return p.instantiateWasm(a,s)}catch(c){K("Module.instantiateWasm callback failed with error: "+c),R(c)}return xt(a,function(c){s(c.instance)}).catch(R),{}})();var Un=s=>(Un=L.free)(s),Zs=s=>(Zs=L.malloc)(s),Do=()=>(Do=L.__errno_location)(),Fo=p._ma_device__on_notification_unlocked=s=>(Fo=p._ma_device__on_notification_unlocked=L.ma_device__on_notification_unlocked)(s);p._ma_malloc_emscripten=(s,a)=>(p._ma_malloc_emscripten=L.ma_malloc_emscripten)(s,a),p._ma_free_emscripten=(s,a)=>(p._ma_free_emscripten=L.ma_free_emscripten)(s,a);var $o=p._ma_device_process_pcm_frames_capture__webaudio=(s,a,c)=>($o=p._ma_device_process_pcm_frames_capture__webaudio=L.ma_device_process_pcm_frames_capture__webaudio)(s,a,c),Uo=p._ma_device_process_pcm_frames_playback__webaudio=(s,a,c)=>(Uo=p._ma_device_process_pcm_frames_playback__webaudio=L.ma_device_process_pcm_frames_playback__webaudio)(s,a,c),No=s=>(No=L.__getTypeName)(s);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=L._embind_initialize_bindings)(),p.dynCall_iiji=(s,a,c,_,I)=>(p.dynCall_iiji=L.dynCall_iiji)(s,a,c,_,I),p.dynCall_jiji=(s,a,c,_,I)=>(p.dynCall_jiji=L.dynCall_jiji)(s,a,c,_,I),p.dynCall_iiiji=(s,a,c,_,I,A)=>(p.dynCall_iiiji=L.dynCall_iiiji)(s,a,c,_,I,A),p.dynCall_iij=(s,a,c,_)=>(p.dynCall_iij=L.dynCall_iij)(s,a,c,_),p.dynCall_jii=(s,a,c)=>(p.dynCall_jii=L.dynCall_jii)(s,a,c),p.dynCall_viijii=(s,a,c,_,I,A,O)=>(p.dynCall_viijii=L.dynCall_viijii)(s,a,c,_,I,A,O),p.dynCall_iiiiij=(s,a,c,_,I,A,O)=>(p.dynCall_iiiiij=L.dynCall_iiiiij)(s,a,c,_,I,A,O),p.dynCall_iiiiijj=(s,a,c,_,I,A,O,H,J)=>(p.dynCall_iiiiijj=L.dynCall_iiiiijj)(s,a,c,_,I,A,O,H,J),p.dynCall_iiiiiijj=(s,a,c,_,I,A,O,H,J,N)=>(p.dynCall_iiiiiijj=L.dynCall_iiiiiijj)(s,a,c,_,I,A,O,H,J,N);var os;Ne=function s(){os||Bo(),os||(Ne=s)};function Bo(){function s(){if(!os&&(os=!0,p.calledRun=!0,!V)){if(p.noFSInit||ho||(ho=!0,fo(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?gi("stdin",p.stdin):Ns("/dev/tty","/dev/stdin"),p.stdout?gi("stdout",null,p.stdout):Ns("/dev/tty","/dev/stdout"),p.stderr?gi("stderr",null,p.stderr):Ns("/dev/tty1","/dev/stderr"),qi("/dev/stdin",0),qi("/dev/stdout",1),qi("/dev/stderr",1)),no=!1,d(Q),k(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var a=p.postRun.shift();ue.unshift(a)}d(ue)}}if(!(0<je)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)be();d(Te),0<je||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),s()},1)):s())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return Bo(),S.ready})})();const m=g}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,f,v)=>{v.r(f),v.d(f,{Animation:()=>g.Animation});var g=v(4)}),((u,f,v)=>{v.r(f),v.d(f,{Animation:()=>g});var g=(function(){function m(w,S,p,k){this.animation=w,this.artboard=S,this.playing=k,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(w,S)}return Object.defineProperty(m.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"time",{get:function(){return this.instance.time},set:function(w){this.instance.time=w},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),m.prototype.advance=function(w){this.scrubTo===null?this.instance.advance(w):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},m.prototype.apply=function(w){this.instance.apply(w)},m.prototype.cleanup=function(){this.instance.delete()},m})()}),((u,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>w.AudioAssetWrapper,AudioWrapper:()=>w.AudioWrapper,BLANK_URL:()=>m.BLANK_URL,CustomFileAssetLoaderWrapper:()=>w.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>w.FileAssetWrapper,Finalizable:()=>w.Finalizable,FontAssetWrapper:()=>w.FontAssetWrapper,FontWrapper:()=>w.FontWrapper,ImageAssetWrapper:()=>w.ImageAssetWrapper,ImageWrapper:()=>w.ImageWrapper,finalizationRegistry:()=>w.finalizationRegistry,registerTouchInteractions:()=>g.registerTouchInteractions,sanitizeUrl:()=>m.sanitizeUrl});var g=v(6),m=v(7),w=v(8)}),((u,f,v)=>{v.r(f),v.d(f,{registerTouchInteractions:()=>w});var g=void 0,m=function(S,p){var k,R;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((k=S.touches)===null||k===void 0)&&k.length)?(p||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((R=S.changedTouches)===null||R===void 0)&&R.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},w=function(S){var p=S.canvas,k=S.artboard,R=S.stateMachines,x=R===void 0?[]:R,F=S.renderer,z=S.rive,M=S.fit,U=S.alignment,$=S.isTouchScrollEnabled,C=$===void 0?!1:$,P=S.layoutScaleFactor,ie=P===void 0?1:P;if(!p||!x.length||!F||!z||!k||typeof window>"u")return null;var oe=null,pe=!1,fe=function(Y){if(pe&&Y instanceof MouseEvent){Y.type=="mouseup"&&(pe=!1);return}pe=C&&Y.type==="touchend"&&oe==="touchstart",oe=Y.type;var K=Y.currentTarget.getBoundingClientRect(),G=m(Y,C),ee=G.clientX,L=G.clientY;if(!(!ee&&!L)){var V=ee-K.left,se=L-K.top,le=z.computeAlignment(M,U,{minX:0,minY:0,maxX:K.width,maxY:K.height},k.bounds,ie),me=new z.Mat2D;le.invert(me);var Ee=new z.Vec2D(V,se),ge=z.mapXY(me,Ee),Me=ge.x(),de=ge.y();switch(ge.delete(),me.delete(),Ee.delete(),le.delete(),Y.type){case"mouseout":for(var te=0,Z=x;te<Z.length;te++){var re=Z[te];re.pointerMove(Me,de)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Te=0,Q=x;Te<Q.length;Te++){var re=Q[Te];re.pointerMove(Me,de)}break}case"touchstart":case"mousedown":{for(var ue=0,be=x;ue<be.length;ue++){var re=be[ue];re.pointerDown(Me,de)}break}case"touchend":case"mouseup":{for(var je=0,Ne=x;je<Ne.length;je++){var re=Ne[je];re.pointerUp(Me,de)}break}}}},ce=fe.bind(g);return p.addEventListener("mouseover",ce),p.addEventListener("mouseout",ce),p.addEventListener("mousemove",ce),p.addEventListener("mousedown",ce),p.addEventListener("mouseup",ce),p.addEventListener("touchmove",ce,{passive:C}),p.addEventListener("touchstart",ce,{passive:C}),p.addEventListener("touchend",ce),function(){p.removeEventListener("mouseover",ce),p.removeEventListener("mouseout",ce),p.removeEventListener("mousemove",ce),p.removeEventListener("mousedown",ce),p.removeEventListener("mouseup",ce),p.removeEventListener("touchmove",ce),p.removeEventListener("touchstart",ce),p.removeEventListener("touchend",ce)}}}),((u,f,v)=>{v.r(f),v.d(f,{BLANK_URL:()=>R,sanitizeUrl:()=>z});var g=/^([^\w]*)(javascript|data|vbscript)/im,m=/&#(\w+)(^\w|;)?/g,w=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,k=[".","/"],R="about:blank";function x(M){return k.indexOf(M[0])>-1}function F(M){var U=M.replace(S,"");return U.replace(m,function($,C){return String.fromCharCode(C)})}function z(M){if(!M)return R;var U=F(M).replace(w,"").replace(S,"").trim();if(!U)return R;if(x(U))return U;var $=U.match(p);if(!$)return U;var C=$[0];return g.test(C)?R:U}}),((u,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>F,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>k,FileAssetWrapper:()=>R,Finalizable:()=>m,FontAssetWrapper:()=>z,FontWrapper:()=>p,ImageAssetWrapper:()=>x,ImageWrapper:()=>w,finalizationRegistry:()=>$});var g=(function(){var C=function(P,ie){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(oe,pe){oe.__proto__=pe}||function(oe,pe){for(var fe in pe)Object.prototype.hasOwnProperty.call(pe,fe)&&(oe[fe]=pe[fe])},C(P,ie)};return function(P,ie){if(typeof ie!="function"&&ie!==null)throw new TypeError("Class extends value "+String(ie)+" is not a constructor or null");C(P,ie);function oe(){this.constructor=P}P.prototype=ie===null?Object.create(ie):(oe.prototype=ie.prototype,new oe)}})(),m=(function(){function C(){this.selfUnref=!1}return C})(),w=(function(C){g(P,C);function P(ie){var oe=C.call(this)||this;return oe._nativeImage=ie,oe}return Object.defineProperty(P.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),P.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},P})(m),S=(function(C){g(P,C);function P(ie){var oe=C.call(this)||this;return oe._nativeAudio=ie,oe}return Object.defineProperty(P.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),P.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},P})(m),p=(function(C){g(P,C);function P(ie){var oe=C.call(this)||this;return oe._nativeFont=ie,oe}return Object.defineProperty(P.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),P.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},P})(m),k=(function(){function C(P,ie){this._assetLoaderCallback=ie,this.assetLoader=new P.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return C.prototype.loadContents=function(P,ie){var oe;return P.isImage?oe=new x(P):P.isAudio?oe=new F(P):P.isFont&&(oe=new z(P)),this._assetLoaderCallback(oe,ie)},C})(),R=(function(){function C(P){this._nativeFileAsset=P}return C.prototype.decode=function(P){this._nativeFileAsset.decode(P)},Object.defineProperty(C.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),C})(),x=(function(C){g(P,C);function P(){return C!==null&&C.apply(this,arguments)||this}return P.prototype.setRenderImage=function(ie){this._nativeFileAsset.setRenderImage(ie.nativeImage)},P})(R),F=(function(C){g(P,C);function P(){return C!==null&&C.apply(this,arguments)||this}return P.prototype.setAudioSource=function(ie){this._nativeFileAsset.setAudioSource(ie.nativeAudio)},P})(R),z=(function(C){g(P,C);function P(){return C!==null&&C.apply(this,arguments)||this}return P.prototype.setFont=function(ie){this._nativeFileAsset.setFont(ie.nativeFont)},P})(R),M=(function(){function C(P){}return C.prototype.register=function(P){P.selfUnref=!0},C.prototype.unregister=function(P){},C})(),U=typeof FinalizationRegistry<"u"?FinalizationRegistry:M,$=new U(function(C){C.unref()})})],r={};function i(u){var f=r[u];if(f!==void 0)return f.exports;var v=r[u]={exports:{}};return t[u](v,v.exports,i),v.exports}i.d=(u,f)=>{for(var v in f)i.o(f,v)&&!i.o(u,v)&&Object.defineProperty(u,v,{enumerable:!0,get:f[v]})},i.o=(u,f)=>Object.prototype.hasOwnProperty.call(u,f),i.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{i.r(l),i.d(l,{Alignment:()=>z,DataEnum:()=>de,EventType:()=>fe,Fit:()=>F,Layout:()=>M,LoopType:()=>ce,Rive:()=>ge,RiveEventType:()=>P,RiveFile:()=>Ee,RuntimeLoader:()=>U,StateMachineInput:()=>C,StateMachineInputType:()=>$,Testing:()=>_t,ViewModel:()=>Me,ViewModelInstance:()=>Z,ViewModelInstanceArtboard:()=>Le,ViewModelInstanceAssetImage:()=>Be,ViewModelInstanceBoolean:()=>ue,ViewModelInstanceColor:()=>Ve,ViewModelInstanceEnum:()=>je,ViewModelInstanceList:()=>Ne,ViewModelInstanceNumber:()=>Q,ViewModelInstanceString:()=>Te,ViewModelInstanceTrigger:()=>be,ViewModelInstanceValue:()=>re,decodeAudio:()=>lt,decodeFont:()=>St,decodeImage:()=>xt});var u=i(1),f=i(2),v=i(3),g=i(5),m=(function(){var y=function(o,d){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var q in T)Object.prototype.hasOwnProperty.call(T,q)&&(b[q]=T[q])},y(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");y(o,d);function b(){this.constructor=o}o.prototype=d===null?Object.create(d):(b.prototype=d.prototype,new b)}})(),w=function(){return w=Object.assign||function(y){for(var o,d=1,b=arguments.length;d<b;d++){o=arguments[d];for(var T in o)Object.prototype.hasOwnProperty.call(o,T)&&(y[T]=o[T])}return y},w.apply(this,arguments)},S=function(y,o,d,b){function T(q){return q instanceof d?q:new d(function(ae){ae(q)})}return new(d||(d=Promise))(function(q,ae){function Ae(Ue){try{Ce(b.next(Ue))}catch(Ke){ae(Ke)}}function $e(Ue){try{Ce(b.throw(Ue))}catch(Ke){ae(Ke)}}function Ce(Ue){Ue.done?q(Ue.value):T(Ue.value).then(Ae,$e)}Ce((b=b.apply(y,o||[])).next())})},p=function(y,o){var d={label:0,sent:function(){if(q[0]&1)throw q[1];return q[1]},trys:[],ops:[]},b,T,q,ae=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return ae.next=Ae(0),ae.throw=Ae(1),ae.return=Ae(2),typeof Symbol=="function"&&(ae[Symbol.iterator]=function(){return this}),ae;function Ae(Ce){return function(Ue){return $e([Ce,Ue])}}function $e(Ce){if(b)throw new TypeError("Generator is already executing.");for(;ae&&(ae=0,Ce[0]&&(d=0)),d;)try{if(b=1,T&&(q=Ce[0]&2?T.return:Ce[0]?T.throw||((q=T.return)&&q.call(T),0):T.next)&&!(q=q.call(T,Ce[1])).done)return q;switch(T=0,q&&(Ce=[Ce[0]&2,q.value]),Ce[0]){case 0:case 1:q=Ce;break;case 4:return d.label++,{value:Ce[1],done:!1};case 5:d.label++,T=Ce[1],Ce=[0];continue;case 7:Ce=d.ops.pop(),d.trys.pop();continue;default:if(q=d.trys,!(q=q.length>0&&q[q.length-1])&&(Ce[0]===6||Ce[0]===2)){d=0;continue}if(Ce[0]===3&&(!q||Ce[1]>q[0]&&Ce[1]<q[3])){d.label=Ce[1];break}if(Ce[0]===6&&d.label<q[1]){d.label=q[1],q=Ce;break}if(q&&d.label<q[2]){d.label=q[2],d.ops.push(Ce);break}q[2]&&d.ops.pop(),d.trys.pop();continue}Ce=o.call(y,d)}catch(Ue){Ce=[6,Ue],T=0}finally{b=q=0}if(Ce[0]&5)throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}},k=function(y,o,d){if(d||arguments.length===2)for(var b=0,T=o.length,q;b<T;b++)(q||!(b in o))&&(q||(q=Array.prototype.slice.call(o,0,b)),q[b]=o[b]);return y.concat(q||Array.prototype.slice.call(o))},R=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),x=function(y){return y&&y.isHandledError?y.message:"Problem loading file; may be corrupt!"},F;(function(y){y.Cover="cover",y.Contain="contain",y.Fill="fill",y.FitWidth="fitWidth",y.FitHeight="fitHeight",y.None="none",y.ScaleDown="scaleDown",y.Layout="layout"})(F||(F={}));var z;(function(y){y.Center="center",y.TopLeft="topLeft",y.TopCenter="topCenter",y.TopRight="topRight",y.CenterLeft="centerLeft",y.CenterRight="centerRight",y.BottomLeft="bottomLeft",y.BottomCenter="bottomCenter",y.BottomRight="bottomRight"})(z||(z={}));var M=(function(){function y(o){var d,b,T,q,ae,Ae,$e;this.fit=(d=o?.fit)!==null&&d!==void 0?d:F.Contain,this.alignment=(b=o?.alignment)!==null&&b!==void 0?b:z.Center,this.layoutScaleFactor=(T=o?.layoutScaleFactor)!==null&&T!==void 0?T:1,this.minX=(q=o?.minX)!==null&&q!==void 0?q:0,this.minY=(ae=o?.minY)!==null&&ae!==void 0?ae:0,this.maxX=(Ae=o?.maxX)!==null&&Ae!==void 0?Ae:0,this.maxY=($e=o?.maxY)!==null&&$e!==void 0?$e:0}return y.new=function(o){var d=o.fit,b=o.alignment,T=o.minX,q=o.minY,ae=o.maxX,Ae=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new y({fit:d,alignment:b,minX:T,minY:q,maxX:ae,maxY:Ae})},y.prototype.copyWith=function(o){var d=o.fit,b=o.alignment,T=o.layoutScaleFactor,q=o.minX,ae=o.minY,Ae=o.maxX,$e=o.maxY;return new y({fit:d??this.fit,alignment:b??this.alignment,layoutScaleFactor:T??this.layoutScaleFactor,minX:q??this.minX,minY:ae??this.minY,maxX:Ae??this.maxX,maxY:$e??this.maxY})},y.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===F.Cover?d=o.Fit.cover:this.fit===F.Contain?d=o.Fit.contain:this.fit===F.Fill?d=o.Fit.fill:this.fit===F.FitWidth?d=o.Fit.fitWidth:this.fit===F.FitHeight?d=o.Fit.fitHeight:this.fit===F.ScaleDown?d=o.Fit.scaleDown:this.fit===F.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},y.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===z.TopLeft?d=o.Alignment.topLeft:this.alignment===z.TopCenter?d=o.Alignment.topCenter:this.alignment===z.TopRight?d=o.Alignment.topRight:this.alignment===z.CenterLeft?d=o.Alignment.centerLeft:this.alignment===z.CenterRight?d=o.Alignment.centerRight:this.alignment===z.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===z.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===z.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},y})(),U=(function(){function y(){}return y.loadRuntime=function(){u.default({locateFile:function(){return y.wasmURL}}).then(function(o){var d;for(y.runtime=o;y.callBackQueue.length>0;)(d=y.callBackQueue.shift())===null||d===void 0||d(y.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var b="https://cdn.jsdelivr.net/npm/".concat(f.name,"@").concat(f.version,"/rive_fallback.wasm");if(y.wasmURL.toLowerCase()!==b)console.warn("Failed to load WASM from ".concat(y.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),y.setWasmUrl(b),y.loadRuntime();else{var T=["Could not load Rive WASM file from ".concat(y.wasmURL," or ").concat(b,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(T)}})},y.getInstance=function(o){y.isLoading||(y.isLoading=!0,y.loadRuntime()),y.runtime?o(y.runtime):y.callBackQueue.push(o)},y.awaitInstance=function(){return new Promise(function(o){return y.getInstance(function(d){return o(d)})})},y.setWasmUrl=function(o){y.wasmURL=o},y.getWasmUrl=function(){return y.wasmURL},y.isLoading=!1,y.callBackQueue=[],y.wasmURL="https://unpkg.com/".concat(f.name,"@").concat(f.version,"/rive.wasm"),y})(),$;(function(y){y[y.Number=56]="Number",y[y.Trigger=58]="Trigger",y[y.Boolean=59]="Boolean"})($||($={}));var C=(function(){function y(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(y.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),y.prototype.fire=function(){this.type===$.Trigger&&this.runtimeInput.fire()},y.prototype.delete=function(){this.runtimeInput=null},y})(),P;(function(y){y[y.General=128]="General",y[y.OpenUrl=131]="OpenUrl"})(P||(P={}));var ie=(function(){function y(o){this.nativeArtboard=o}return y})(),oe=(function(){function y(o,d,b,T){this.stateMachine=o,this.playing=b,this.artboard=T,this.inputs=[],this.instance=new d.StateMachineInstance(o,T),this.initInputs(d)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),y.prototype.advance=function(o){this.instance.advance(o)},y.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},y.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},y.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},y.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var b=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(b,o))}},y.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new C($.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new C($.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new C($.Trigger,o.asTrigger())},y.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},y.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},y})(),pe=(function(){function y(o,d,b,T,q){T===void 0&&(T=[]),q===void 0&&(q=[]),this.runtime=o,this.artboard=d,this.eventManager=b,this.animations=T,this.stateMachines=q}return y.prototype.add=function(o,d,b){if(b===void 0&&(b=!0),o=Ge(o),o.length===0)this.animations.forEach(function(ft){return ft.playing=d}),this.stateMachines.forEach(function(ft){return ft.playing=d});else for(var T=this.animations.map(function(ft){return ft.name}),q=this.stateMachines.map(function(ft){return ft.name}),ae=0;ae<o.length;ae++){var Ae=T.indexOf(o[ae]),$e=q.indexOf(o[ae]);if(Ae>=0||$e>=0)Ae>=0?this.animations[Ae].playing=d:this.stateMachines[$e].playing=d;else{var Ce=this.artboard.animationByName(o[ae]);if(Ce){var Ue=new v.Animation(Ce,this.artboard,this.runtime,d);Ue.advance(0),Ue.apply(1),this.animations.push(Ue)}else{var Ke=this.artboard.stateMachineByName(o[ae]);if(Ke){var bt=new oe(Ke,this.runtime,d,this.artboard);this.stateMachines.push(bt)}}}}return b&&(d?this.eventManager.fire({type:fe.Play,data:this.playing}):this.eventManager.fire({type:fe.Pause,data:this.paused})),d?this.playing:this.paused},y.prototype.initLinearAnimations=function(o,d){for(var b=this.animations.map(function($e){return $e.name}),T=0;T<o.length;T++){var q=b.indexOf(o[T]);if(q>=0)this.animations[q].playing=d;else{var ae=this.artboard.animationByName(o[T]);if(ae){var Ae=new v.Animation(ae,this.artboard,this.runtime,d);Ae.advance(0),Ae.apply(1),this.animations.push(Ae)}else console.error("Animation with name ".concat(o[T]," not found."))}}},y.prototype.initStateMachines=function(o,d){for(var b=this.stateMachines.map(function($e){return $e.name}),T=0;T<o.length;T++){var q=b.indexOf(o[T]);if(q>=0)this.stateMachines[q].playing=d;else{var ae=this.artboard.stateMachineByName(o[T]);if(ae){var Ae=new oe(ae,this.runtime,d,this.artboard);this.stateMachines.push(Ae),d||Ae.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[T]," not found.")),this.initLinearAnimations([o[T]],d)}}},y.prototype.play=function(o){return this.add(o,!0)},y.prototype.pause=function(o){return this.add(o,!1)},y.prototype.scrub=function(o,d){var b=this.animations.filter(function(T){return o.includes(T.name)});return b.forEach(function(T){return T.scrubTo=d}),b.map(function(T){return T.name})},Object.defineProperty(y.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),y.prototype.stop=function(o){var d=this;o=Ge(o);var b=[];if(o.length===0)b=this.animations.map(function(ae){return ae.name}).concat(this.stateMachines.map(function(ae){return ae.name})),this.animations.forEach(function(ae){return ae.cleanup()}),this.stateMachines.forEach(function(ae){return ae.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var T=this.animations.filter(function(ae){return o.includes(ae.name)});T.forEach(function(ae){ae.cleanup(),d.animations.splice(d.animations.indexOf(ae),1)});var q=this.stateMachines.filter(function(ae){return o.includes(ae.name)});q.forEach(function(ae){ae.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(ae),1)}),b=T.map(function(ae){return ae.name}).concat(q.map(function(ae){return ae.name}))}return this.eventManager.fire({type:fe.Stop,data:b}),b},Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),y.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var b;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([b=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([b=this.artboard.stateMachineByIndex(0).name],o,d)),b},y.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(T){return T.playing});o<d.length;o++){var b=d[o];b.loopValue===0&&b.loopCount?(b.loopCount=0,this.stop(b.name)):b.loopValue===1&&b.loopCount?(this.eventManager.fire({type:fe.Loop,data:{animation:b.name,type:ce.Loop}}),b.loopCount=0):b.loopValue===2&&b.loopCount>1&&(this.eventManager.fire({type:fe.Loop,data:{animation:b.name,type:ce.PingPong}}),b.loopCount=0)}},y.prototype.handleStateChanges=function(){for(var o=[],d=0,b=this.stateMachines.filter(function(q){return q.playing});d<b.length;d++){var T=b[d];o.push.apply(o,T.statesChanged)}o.length>0&&this.eventManager.fire({type:fe.StateChange,data:o})},y.prototype.handleAdvancing=function(o){this.eventManager.fire({type:fe.Advance,data:o})},y})(),fe;(function(y){y.Load="load",y.LoadError="loaderror",y.Play="play",y.Pause="pause",y.Stop="stop",y.Loop="loop",y.Draw="draw",y.Advance="advance",y.StateChange="statechange",y.RiveEvent="riveevent",y.AudioStatusChange="audiostatuschange"})(fe||(fe={}));var ce;(function(y){y.OneShot="oneshot",y.Loop="loop",y.PingPong="pingpong"})(ce||(ce={}));var Y=(function(){function y(o){o===void 0&&(o=[]),this.listeners=o}return y.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},y.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},y.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var b=this.listeners[d];if(b.type===o.type&&b.callback===o.callback){this.listeners.splice(d,1);break}}},y.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(b){return b.type===o}).forEach(function(b){return d.remove(b)}):this.listeners.splice(0,this.listeners.length)},y.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(b){return b.callback(o)})},y})(),K=(function(){function y(o){this.eventManager=o,this.queue=[]}return y.prototype.add=function(o){this.queue.push(o)},y.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},y})(),G;(function(y){y[y.AVAILABLE=0]="AVAILABLE",y[y.UNAVAILABLE=1]="UNAVAILABLE"})(G||(G={}));var ee=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=G.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return p(this,function(b){return[2,new Promise(function(T){return setTimeout(T,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(b,T){return setTimeout(T,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:fe.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=G.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===G.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==G.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,b=function(){return S(d,void 0,void 0,function(){return p(this,function(T){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",b,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===G.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(Y),L=new ee,V=(function(){function y(){}return y.prototype.observe=function(){},y.prototype.unobserve=function(){},y.prototype.disconnect=function(){},y})(),se=globalThis.ResizeObserver||V,le=(function(){function y(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var b=o._elementsMap.get(d.target);b!==null?b.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new se(this._onObserved)}return y.prototype.add=function(o,d){var b={onResize:d,element:o};return this._elementsMap.set(o,b),this._resizeObserver.observe(o),b},y.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},y})(),me=new le,Ee=(function(){function y(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new Y,o.onLoad&&this.on(fe.Load,o.onLoad),o.onLoadError&&this.on(fe.LoadError,o.onLoadError)}return y.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,b,T,q;return p(this,function(ae){switch(ae.label){case 0:return this.src?(o=this,[4,Je(this.src)]):[3,2];case 1:o.buffer=ae.sent(),ae.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(b=new g.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=b.assetLoader),T=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return T.file=ae.sent(),this.destroyed?((q=this.file)===null||q===void 0||q.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:fe.Load,data:this}):this.fireLoadError(y.fileLoadErrorMessage),[2])}})})},y.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return p(this,function(b){switch(b.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(y.missingErrorMessage),[2];b.label=1;case 1:return b.trys.push([1,4,,5]),o=this,[4,U.awaitInstance()];case 2:return o.runtime=b.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return b.sent(),[3,5];case 4:return d=b.sent(),this.fireLoadError(d instanceof Error?d.message:y.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},y.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:fe.LoadError,data:o}),new Error(o)},y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},y.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},y.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new ie(d):null},y.missingErrorMessage="Rive source file or data buffer required",y.fileLoadErrorMessage="The file failed to load",y})(),ge=(function(){function y(o){var d=this,b;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(T){var q=d._hasZeroSize!==T;d._hasZeroSize=T,T?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():q&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=me.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(b=o.layout)!==null&&b!==void 0?b:new M,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new Y,o.onLoad&&this.on(fe.Load,o.onLoad),o.onLoadError&&this.on(fe.LoadError,o.onLoadError),o.onPlay&&this.on(fe.Play,o.onPlay),o.onPause&&this.on(fe.Pause,o.onPause),o.onStop&&this.on(fe.Stop,o.onStop),o.onLoop&&this.on(fe.Loop,o.onLoop),o.onStateChange&&this.on(fe.StateChange,o.onStateChange),o.onAdvance&&this.on(fe.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(fe.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(fe.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(fe.Play,o.onplay),o.onpause&&!o.onPause&&this.on(fe.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(fe.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(fe.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(fe.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new K(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(y.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),y.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new y(o)},y.prototype.onSystemAudioChanged=function(){this.volume=this._volume},y.prototype.init=function(o){var d=this,b=o.src,T=o.buffer,q=o.riveFile,ae=o.animations,Ae=o.stateMachines,$e=o.artboard,Ce=o.autoplay,Ue=Ce===void 0?!1:Ce,Ke=o.useOffscreenRenderer,bt=Ke===void 0?!1:Ke,ft=o.autoBind,Wt=ft===void 0?!1:ft;if(!this.destroyed){if(this.src=b,this.buffer=T,this.riveFile=q,!this.src&&!this.buffer&&!this.riveFile)throw new R(y.missingErrorMessage);var $t=Ge(ae),Et=Ge(Ae);this.loaded=!1,this.readyForPlaying=!1,U.awaitInstance().then(function(et){d.destroyed||(d.runtime=et,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,bt),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData($e,$t,Et,Ue,Wt).then(function(qe){if(qe)return d.setupRiveListeners()}).catch(function(qe){console.error(qe)}))}).catch(function(et){console.error(et)})}},y.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var b=(this.animator.stateMachines||[]).filter(function(q){return q.playing&&d.runtime.hasListeners(q.instance)}).map(function(q){return q.instance}),T=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(T=o.isTouchScrollEnabled),this.eventCleanup=(0,g.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:b,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:T,layoutScaleFactor:this._layout.layoutScaleFactor})}},y.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},y.prototype.initializeAudio=function(){var o=this,d;L.status==G.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:fe.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},L.add(this._audioEventListener),L.establishAudio())},y.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},y.prototype.initData=function(o,d,b,T,q){return S(this,void 0,void 0,function(){var ae,Ae,$e,Ce;return p(this,function(Ue){switch(Ue.label){case 0:return Ue.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(ae=new Ee({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=ae,[4,ae.init()]);case 1:if(Ue.sent(),this.destroyed)return ae.destroyIfUnused(),[2,!1];Ue.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,b,T,q),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:fe.Load,data:(Ce=this.src)!==null&&Ce!==void 0?Ce:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Ae=Ue.sent(),$e=x(Ae),console.warn($e),this.eventManager.fire({type:fe.LoadError,data:$e}),[2,Promise.reject($e)];case 4:return[2]}})})},y.prototype.initArtboard=function(o,d,b,T,q){if(this.file){var ae=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!ae){var Ae="Invalid artboard name or no default artboard";console.warn(Ae),this.eventManager.fire({type:fe.LoadError,data:Ae});return}if(this.artboard=ae,ae.volume=this._volume*L.systemVolume,this.artboard.animationCount()<1){var Ae="Artboard has no animations";throw this.eventManager.fire({type:fe.LoadError,data:Ae}),Ae}this.animator=new pe(this.runtime,this.artboard,this.eventManager);var $e;if(d.length>0||b.length>0?($e=d.concat(b),this.animator.initLinearAnimations(d,T),this.animator.initStateMachines(b,T)):$e=[this.animator.atLeastOne(T,!1)],this.taskQueue.add({event:{type:T?fe.Play:fe.Pause,data:$e}}),q){var Ce=this.file.defaultArtboardViewModel(ae);if(Ce!==null){var Ue=Ce.defaultInstance();if(Ue!==null){var Ke=new Z(Ue,null);this.bindViewModelInstance(Ke)}}}}},y.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},y.prototype.draw=function(o,d){var b;this.frameRequestId=null;var T=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var q=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var ae=this.animator.animations.filter(function(Vt){return Vt.playing||Vt.needsScrub}).sort(function(Vt){return Vt.needsScrub?-1:1}),Ae=0,$e=ae;Ae<$e.length;Ae++){var Ce=$e[Ae];Ce.advance(q),Ce.instance.didLoop&&(Ce.loopCount+=1),Ce.apply(1)}for(var Ue=this.animator.stateMachines.filter(function(Vt){return Vt.playing}),Ke=0,bt=Ue;Ke<bt.length;Ke++){var ft=bt[Ke],Wt=ft.reportedEventCount();if(Wt)for(var $t=0;$t<Wt;$t++){var Et=ft.reportedEventAt($t);if(Et)if(Et.type===P.OpenUrl){if(this.eventManager.fire({type:fe.RiveEvent,data:Et}),this.automaticallyHandleEvents){var et=document.createElement("a"),qe=Et,kt=qe.url,st=qe.target,ut=(0,g.sanitizeUrl)(kt);kt&&et.setAttribute("href",ut),st&&et.setAttribute("target",st),ut&&ut!==g.BLANK_URL&&et.click()}}else this.eventManager.fire({type:fe.RiveEvent,data:Et})}ft.advanceAndApply(q)}this.animator.stateMachines.length==0&&this.artboard.advance(q);var Ie=this.renderer;Ie.clear(),Ie.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Ie),Ie.restore(),Ie.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(q),this.frameCount++;var ze=performance.now();for(this.frameTimes.push(ze),this.durations.push(ze-T);this.frameTimes[0]<=ze-1e3;)this.frameTimes.shift(),this.durations.shift();(b=this._viewModelInstance)===null||b===void 0||b.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},y.prototype.alignRenderer=function(){var o=this,d=o.renderer,b=o.runtime,T=o._layout,q=o.artboard;d.align(T.runtimeFit(b),T.runtimeAlignment(b),{minX:T.minX,minY:T.minY,maxX:T.maxX,maxY:T.maxY},q.bounds,this._devicePixelRatioUsed*T.layoutScaleFactor)},Object.defineProperty(y.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),y.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&me.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(L.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},y.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},y.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},y.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var b=this.artboard.textRun(o);if(!b){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return b},y.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},y.prototype.setTextRunValue=function(o,d){var b=this.retrieveTextRun(o);b&&(b.text=d)},y.prototype.play=function(o,d){var b=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},y.prototype.pause=function(o){var d=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},y.prototype.scrub=function(o,d){var b=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},y.prototype.stop=function(o){var d=this;if(o=Ge(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},y.prototype.reset=function(o){var d,b,T=o?.artboard,q=Ge(o?.animations),ae=Ge(o?.stateMachines),Ae=(d=o?.autoplay)!==null&&d!==void 0?d:!1,$e=(b=o?.autoBind)!==null&&b!==void 0?b:!1;this.cleanupInstances(),this.initArtboard(T,q,ae,Ae,$e),this.taskQueue.process()},y.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(y.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),y.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},y.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),b=d.width,T=d.height,q=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=q,this.canvas.width=q*b,this.canvas.height=q*T,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===F.Layout){var ae=this._layout.layoutScaleFactor;this.artboard.width=b/ae,this.artboard.height=T/ae}}},Object.defineProperty(y.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),y.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(b){return b.name===o});return d?.inputs}},y.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.inputByPath(o,d);if(!b){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b},y.prototype.setBooleanStateAtPath=function(o,d,b){var T=this.retrieveInputAtPath(o,b);T&&(T.type===$.Boolean?T.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(b,"' is not a boolean")))},y.prototype.setNumberStateAtPath=function(o,d,b){var T=this.retrieveInputAtPath(o,b);T&&(T.type===$.Number?T.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(b,"' is not a number")))},y.prototype.fireStateAtPath=function(o,d){var b=this.retrieveInputAtPath(o,d);b&&(b.type===$.Trigger?b.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},y.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.textByPath(o,d);if(!b){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b},y.prototype.getTextRunValueAtPath=function(o,d){var b=this.retrieveTextAtPath(o,d);if(!b){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b.text},y.prototype.setTextRunValueAtPath=function(o,d,b){var T=this.retrieveTextAtPath(o,b);if(!T){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(b,"'"));return}T.text=d},Object.defineProperty(y.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},y.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},y.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},y.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},y.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(y.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var b=this.file.artboardByIndex(d),T={name:b.name,animations:[],stateMachines:[]},q=0;q<b.animationCount();q++){var ae=b.animationByIndex(q);T.animations.push(ae.name)}for(var Ae=0;Ae<b.stateMachineCount();Ae++){for(var $e=b.stateMachineByIndex(Ae),Ce=$e.name,Ue=new this.runtime.StateMachineInstance($e,b),Ke=[],bt=0;bt<Ue.inputCount();bt++){var ft=Ue.input(bt);Ke.push({name:ft.name,type:ft.type})}T.stateMachines.push({name:Ce,inputs:Ke})}o.artboards.push(T)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*L.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),y.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(y.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),y.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(b){return b.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(y.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),y.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Me(d):null},y.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Me(d):null},y.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new de(d)})}return this._dataEnums},y.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Me(o)}return null},y.prototype.getArtboard=function(o){var d,b;return(b=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&b!==void 0?b:null},y.missingErrorMessage="Rive source file or data buffer required",y.cleanupErrorMessage="Attempt to use file after calling cleanup.",y})(),Me=(function(){function y(o){this._viewModel=o}return Object.defineProperty(y.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),y.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new Z(d,null):null},y.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new Z(d,null):null},y.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new Z(o,null):null},y.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new Z(o,null):null},Object.defineProperty(y.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),y})(),de=(function(){function y(o){this._dataEnum=o}return Object.defineProperty(y.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),y})(),te;(function(y){y.Number="number",y.String="string",y.Boolean="boolean",y.Color="color",y.Trigger="trigger",y.Enum="enum",y.List="list",y.Image="image",y.Artboard="artboard"})(te||(te={}));var Z=(function(){function y(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(y.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),y.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},y.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},y.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var b=this._parents[d];b.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},y.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},y.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(b){return b!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},y.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},y.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(b){return b!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},y.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},y.prototype.propertyFromPath=function(o,d){var b=o.split("/");return this.propertyFromPathSegments(b,0,d)},y.prototype.viewModelFromPathSegments=function(o,d){var b=this.internalViewModelInstance(o[d]);return b!==null?d==o.length-1?b:b.viewModelFromPathSegments(o,d++):null},y.prototype.propertyFromPathSegments=function(o,d,b){var T,q,ae,Ae,$e,Ce,Ue,Ke,bt,ft,Wt,$t,Et,et,qe,kt,st,ut;if(d<o.length-1){var Ie=this.internalViewModelInstance(o[d]);return Ie!==null?Ie.propertyFromPathSegments(o,d+1,b):null}var ze=null;switch(b){case te.Number:if(ze=(q=(T=this._runtimeInstance)===null||T===void 0?void 0:T.number(o[d]))!==null&&q!==void 0?q:null,ze!==null)return new Q(ze,this);break;case te.String:if(ze=(Ae=(ae=this._runtimeInstance)===null||ae===void 0?void 0:ae.string(o[d]))!==null&&Ae!==void 0?Ae:null,ze!==null)return new Te(ze,this);break;case te.Boolean:if(ze=(Ce=($e=this._runtimeInstance)===null||$e===void 0?void 0:$e.boolean(o[d]))!==null&&Ce!==void 0?Ce:null,ze!==null)return new ue(ze,this);break;case te.Color:if(ze=(Ke=(Ue=this._runtimeInstance)===null||Ue===void 0?void 0:Ue.color(o[d]))!==null&&Ke!==void 0?Ke:null,ze!==null)return new Ve(ze,this);break;case te.Trigger:if(ze=(ft=(bt=this._runtimeInstance)===null||bt===void 0?void 0:bt.trigger(o[d]))!==null&&ft!==void 0?ft:null,ze!==null)return new be(ze,this);break;case te.Enum:if(ze=($t=(Wt=this._runtimeInstance)===null||Wt===void 0?void 0:Wt.enum(o[d]))!==null&&$t!==void 0?$t:null,ze!==null)return new je(ze,this);break;case te.List:if(ze=(et=(Et=this._runtimeInstance)===null||Et===void 0?void 0:Et.list(o[d]))!==null&&et!==void 0?et:null,ze!==null)return new Ne(ze,this);break;case te.Image:if(ze=(kt=(qe=this._runtimeInstance)===null||qe===void 0?void 0:qe.image(o[d]))!==null&&kt!==void 0?kt:null,ze!==null)return new Be(ze,this);break;case te.Artboard:if(ze=(ut=(st=this._runtimeInstance)===null||st===void 0?void 0:st.artboard(o[d]))!==null&&ut!==void 0?ut:null,ze!==null)return new Le(ze,this);break}return null},y.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var b=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(b!==null){var T=new y(b,this);return T.internalIncrementReferenceCount(),this._viewModelInstances.set(o,T),T}return null},y.prototype.number=function(o){var d=this.propertyFromPath(o,te.Number);return d},y.prototype.string=function(o){var d=this.propertyFromPath(o,te.String);return d},y.prototype.boolean=function(o){var d=this.propertyFromPath(o,te.Boolean);return d},y.prototype.color=function(o){var d=this.propertyFromPath(o,te.Color);return d},y.prototype.trigger=function(o){var d=this.propertyFromPath(o,te.Trigger);return d},y.prototype.enum=function(o){var d=this.propertyFromPath(o,te.Enum);return d},y.prototype.list=function(o){var d=this.propertyFromPath(o,te.List);return d},y.prototype.image=function(o){var d=this.propertyFromPath(o,te.Image);return d},y.prototype.artboard=function(o){var d=this.propertyFromPath(o,te.Artboard);return d},y.prototype.viewModel=function(o){var d=o.split("/"),b=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return b!=null?b.internalViewModelInstance(d[d.length-1]):null},y.prototype.internalReplaceViewModel=function(o,d){var b;if(d.runtimeInstance!==null){var T=((b=this._runtimeInstance)===null||b===void 0?void 0:b.replaceViewModel(o,d.runtimeInstance))||!1;if(T){d.internalIncrementReferenceCount();var q=this.internalViewModelInstance(o);q!==null&&(q.removeParent(this),this._children.includes(q)&&(this._children=this._children.filter(function(ae){return ae!==q})),q.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return T}return!1},y.prototype.replaceViewModel=function(o,d){var b,T=o.split("/"),q=T.length>1?this.viewModelFromPathSegments(T.slice(0,T.length-1),0):this;return(b=q?.internalReplaceViewModel(T[T.length-1],d))!==null&&b!==void 0?b:!1},y.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},y.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(y.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return w({},d)}))||[]},enumerable:!1,configurable:!0}),y.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},y.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(T){T.cleanup()}),this._viewModelInstances.clear();var d=k([],this._children,!0);this._children.length=0;var b=k([],this._parents,!0);this._parents.length=0,d.forEach(function(T){T.removeParent(o)}),b.forEach(function(T){T.removeFromViewModelCallbacks(o)})}},y})(),re=(function(){function y(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return y.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},y.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},y.prototype.internalHandleCallback=function(o){},y.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},y.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},y.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),y})(),Te=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(re),Q=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(re),ue=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(re),be=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(re),je=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(re),Ne=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,b){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,b)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var b=this._viewModelInstanceValue.instanceAt(d);if(b!=null){var T=new Z(b,this._parentViewModel);return T}return null},o.prototype.swap=function(d,b){this._viewModelInstanceValue.swap(d,b)},o.prototype.internalHandleCallback=function(d){d()},o})(re),Ve=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,b,T){this._viewModelInstanceValue.rgb(d,b,T)},o.prototype.rgba=function(d,b,T,q){this._viewModelInstanceValue.argb(q,d,b,T)},o.prototype.argb=function(d,b,T,q){this._viewModelInstanceValue.argb(d,b,T,q)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(re),Be=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeImage)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(re),Le=(function(y){m(o,y);function o(d,b){return y.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeArtboard)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(re),Je=function(y){return S(void 0,void 0,void 0,function(){var o,d,b;return p(this,function(T){switch(T.label){case 0:return o=new Request(y),[4,fetch(o)];case 1:return d=T.sent(),[4,d.arrayBuffer()];case 2:return b=T.sent(),[2,b]}})})},Ge=function(y){return typeof y=="string"?[y]:y instanceof Array?y:[]},_t={EventManager:Y,TaskQueueManager:K},lt=function(y){return S(void 0,void 0,void 0,function(){var o,d,b;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(ae){ae.decodeAudio(y,q)})}),[4,o];case 1:return d=T.sent(),b=new g.AudioWrapper(d),g.finalizationRegistry.register(b,d),[2,b]}})})},xt=function(y){return S(void 0,void 0,void 0,function(){var o,d,b;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(ae){ae.decodeImage(y,q)})}),[4,o];case 1:return d=T.sent(),b=new g.ImageWrapper(d),g.finalizationRegistry.register(b,d),[2,b]}})})},St=function(y){return S(void 0,void 0,void 0,function(){var o,d,b;return p(this,function(T){switch(T.label){case 0:return o=new Promise(function(q){return U.getInstance(function(ae){ae.decodeFont(y,q)})}),[4,o];case 1:return d=T.sent(),b=new g.FontWrapper(d),g.finalizationRegistry.register(b,d),[2,b]}})})}})(),l})())})(_s)),_s.exports}var dp=cp();const Nu="dracula",Es="https://vycjpmuyscfygstjjied.supabase.co";var fp=X('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Ll(n,e){Rt(e,!0);let t=He(e,"bucketName",3,Nu),r=Re(null);In(()=>{if(!h(r))return;const u=new dp.Rive({src:`${Es}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:h(r),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var i=fp(),l=E(i);Sa(l,u=>ne(r,u),()=>h(r)),W(n,i),Ot()}var hp=X('<div class="body-wrapper svelte-njwbfg"><!></div>');function or(n,e){var t=hp(),r=E(t);bu(r,()=>e.children),W(n,t)}var vp=X('<button class="btn btn-secondary svelte-19gwkd1">🔄 Заново</button>'),pp=X('<button class="btn btn-danger svelte-19gwkd1">🏳️ Сдаться</button>'),gp=X('<div id="game-header" class="svelte-19gwkd1"><!> <!> <!></div>');function lr(n,e){let t=He(e,"showGiveUp",3,!1),r=He(e,"extraContent",3,null);var i=gp(),l=E(i);{var u=w=>{var S=vp();S.__click=function(...p){e.onRestart?.apply(this,p)},W(w,S)};Oe(l,w=>{e.onRestart&&w(u)})}var f=j(l,2);{var v=w=>{var S=At(),p=Ze(S);bu(p,r),W(w,S)};Oe(f,w=>{r()&&w(v)})}var g=j(f,2);{var m=w=>{var S=pp();S.__click=function(...p){e.onGiveUp?.apply(this,p)},W(w,S)};Oe(g,w=>{t()&&e.onGiveUp&&w(m)})}W(n,i)}Ft(["click"]);var _p=X('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),mp=X('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function yp(n,e){Rt(e,!0);let t=He(e,"rewardItem",3,null),r=He(e,"items",19,()=>[]),i=He(e,"bucketName",3,"dracula"),l=He(e,"label",3,"Награда");function u(){if(!t()||!r()||r().length===0)return null;const p=typeof t()=="string"?t():t().id;return r().find(k=>k.id===p)||null}let f=Dt(u),v=Dt(()=>typeof t()=="object"&&t().name?t().name:null);function g(p){const k=p.target;k.style.display="none"}var m=At(),w=Ze(m);{var S=p=>{var k=mp(),R=E(k);{var x=C=>{var P=_p(),ie=E(P);ke(()=>{We(ie,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${i()}/${h(f)?.icon||(typeof t()=="object"?t().icon:"")}`),We(ie,"alt",h(f)?.name||h(v)||"Награда")}),ka("error",ie,g),W(C,P)};Oe(R,C=>{(h(f)?.icon||typeof t()=="object"&&t().icon)&&C(x)})}var F=j(R,2),z=E(F),M=E(z),U=j(z,2),$=E(U);ke(()=>{_e(M,`${l()??""}:`),_e($,h(f)?.name||h(v)||"Неизвестный предмет")}),W(p,k)};Oe(w,p=>{(h(f)||h(v))&&p(S)})}W(n,m),Ot()}var wp=X('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function ur(n,e){let t=He(e,"rewardItem",3,null),r=He(e,"items",19,()=>[]),i=He(e,"bucketName",3,"dracula");var l=wp(),u=E(l);yp(u,{get rewardItem(){return t()},get items(){return r()},get bucketName(){return i()}});var f=j(u,2);Od(f,e,"default",{}),W(n,l)}var bp=X("<button> </button>"),kp=X('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function cr(n,e){Rt(e,!0);let t=He(e,"modal",7);var r=At(),i=Ze(r);{var l=u=>{var f=kp();let v;var g=E(f),m=E(g),w=E(m),S=j(m,2),p=E(S),k=j(S,2);Qe(k,21,()=>t().actions,R=>R.text,(R,x)=>{var F=bp();let z;F.__click=function(...U){h(x).action?.apply(this,U)};var M=E(F);ke(U=>{z=Nt(F,1,"btn",null,z,U),_e(M,h(x).text)},[()=>({"btn-secondary":h(x).class==="btn-secondary"})]),W(R,F)}),ke(R=>{v=Nt(f,1,"svelte-s62q14",null,v,R),_e(w,t().title),_e(p,t().text)},[()=>({active:t().show})]),W(u,f)};Oe(i,u=>{t().show&&u(l)})}W(n,r),Ot()}Ft(["click"]);var Ip=X('<div role="button" tabindex="0"> </div>'),Sp=Cd('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),Ep=X('<span class="cooldown-timer svelte-d67gs4"> </span>'),Ap=X('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),Cp=X('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function jp(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=8,f=6,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let m=Re(pt([])),w=Re(pt([])),S=Re(pt({})),p=Re(pt([])),k=Re(null),R=Re(!1),x=Re(!1),F=Re(""),z=Re(0),M=Re(0),U=Re(pt({show:!1,title:"",text:"",actions:[]})),$,C;In(()=>{pe()});function P(){if(!h(w)||h(w).length===0)return 0;let de=0;for(let te=0;te<u;te++)for(let Z=0;Z<f;Z++)h(w)[te]&&!h(w)[te][Z]&&de++;return de}let ie=Dt(P),oe=Dt(()=>h(M)<1);function pe(){ne(m,[],!0),ne(w,[],!0),ne(k,null),ne(R,!1),ne(x,!1),ne(S,{},!0),ne(p,[],!0),ne(F,""),ne(M,0),ge();let de=[...new Set(g)];for(;de.length<u*f/2;)de=[...de,...de];let te=de.sort(()=>.5-Math.random()).slice(0,u*f/2),Z=[];te.forEach(Te=>Z.push(Te,Te)),Z.sort(()=>Math.random()-.5);let re=0;for(let Te=0;Te<u;Te++){let Q=[],ue=[];for(let be=0;be<f;be++)Q.push(Z[re++]),ue.push(!1);h(m).push(Q),h(w).push(ue)}setTimeout(G,500)}async function fe(de,te){if(h(R)||h(w)[de][te]||h(x))return;if(h(p).length>0&&ne(p,[],!0),!h(k)){ne(k,{r:de,c:te},!0);return}if(h(k).r===de&&h(k).c===te){ne(k,null);return}const Z=h(m)[h(k).r][h(k).c],re=h(m)[de][te];if(Z===re){const Te=le(h(k).r,h(k).c,de,te);if(Te){ne(R,!0),await me(Te),h(w)[h(k).r][h(k).c]=!0,h(w)[de][te]=!0,ne(k,null),ne(R,!1),Y(),G();return}}ne(k,{r:de,c:te},!0)}async function ce(de,te,Z){(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),await fe(de,te))}function Y(){ne(M,v);const de=setInterval(()=>{er(M,-1),h(M)<=0&&clearInterval(de)},1e3)}function K(){if(h(R)||h(x)||!h(oe))return;let de=[];for(let Z=0;Z<u;Z++)for(let re=0;re<f;re++)h(w)[Z][re]||de.push({r:Z,c:re,icon:h(m)[Z][re]});let te={};de.forEach(Z=>{te[Z.icon]||(te[Z.icon]=[]),te[Z.icon].push(Z)});for(const Z in te){const re=te[Z];if(!(re.length<2))for(let Te=0;Te<re.length;Te++)for(let Q=Te+1;Q<re.length;Q++){const ue=re[Te],be=re[Q];if(le(ue.r,ue.c,be.r,be.c)){ne(p,[ue,be],!0),setTimeout(()=>ne(p,[],!0),1500);return}}}}function G(){if(h(ie)===0){ne(x,!0),t()?(Ee("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{ge(),e.onWin?.()},3e3)):Ee("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:pe}]);return}ee()||(t()?setTimeout(()=>L(),1e3):Ee("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ge(),L()}},{text:"Сдаться",action:()=>{Ee("Конец","Попытайте удачу снова!",[{text:"ОК",action:pe}])}}]))}function ee(){let de=[];for(let Z=0;Z<u;Z++)for(let re=0;re<f;re++)h(w)[Z][re]||de.push({r:Z,c:re,icon:h(m)[Z][re]});let te={};de.forEach(Z=>{te[Z.icon]||(te[Z.icon]=[]),te[Z.icon].push(Z)});for(const Z in te){const re=te[Z];if(!(re.length<2)){for(let Te=0;Te<re.length;Te++)for(let Q=Te+1;Q<re.length;Q++)if(le(re[Te].r,re[Te].c,re[Q].r,re[Q].c))return!0}}return!1}function L(){let de=[],te=[];for(let Z=0;Z<u;Z++)for(let re=0;re<f;re++)h(w)[Z][re]||(de.push(h(m)[Z][re]),te.push({r:Z,c:re}));de.length!==0&&(de.sort(()=>Math.random()-.5),te.forEach((Z,re)=>{h(m)[Z.r][Z.c]=de[re],h(S)[`${Z.r},${Z.c}`]=!0}),setTimeout(()=>{ne(S,{},!0),ee()?ne(x,!1):L()},500))}function V(de,te){return de<0||de>=u||te<0||te>=f?!0:h(w)[de][te]}function se(de,te,Z,re){if(de!==Z&&te!==re)return!1;if(de===Z){const Te=Math.min(te,re),Q=Math.max(te,re);for(let ue=Te+1;ue<Q;ue++)if(!V(de,ue))return!1}else{const Te=Math.min(de,Z),Q=Math.max(de,Z);for(let ue=Te+1;ue<Q;ue++)if(!V(ue,te))return!1}return!0}function le(de,te,Z,re){if(se(de,te,Z,re))return[{r:de,c:te},{r:Z,c:re}];const Te={r:de,c:re};if(V(Te.r,Te.c)&&se(de,te,Te.r,Te.c)&&se(Te.r,Te.c,Z,re))return[{r:de,c:te},Te,{r:Z,c:re}];const Q={r:Z,c:te};if(V(Q.r,Q.c)&&se(de,te,Q.r,Q.c)&&se(Q.r,Q.c,Z,re))return[{r:de,c:te},Q,{r:Z,c:re}];for(let ue=-1;ue<=u;ue++){if(ue===de||ue===Z)continue;const be={r:ue,c:te},je={r:ue,c:re};if(V(be.r,be.c)&&V(je.r,je.c)&&se(de,te,be.r,be.c)&&se(be.r,be.c,je.r,je.c)&&se(je.r,je.c,Z,re))return[{r:de,c:te},be,je,{r:Z,c:re}]}for(let ue=-1;ue<=f;ue++){if(ue===te||ue===re)continue;const be={r:de,c:ue},je={r:Z,c:ue};if(V(be.r,be.c)&&V(je.r,je.c)&&se(de,te,be.r,be.c)&&se(be.r,be.c,je.r,je.c)&&se(je.r,je.c,Z,re))return[{r:de,c:te},be,je,{r:Z,c:re}]}return null}async function me(de){if(await pu(),!$||!C)return;const te=$.getBoundingClientRect(),Z=C.getBoundingClientRect(),re=C.querySelector(".cell:not(.matched)");if(!re)return;const Te=re.offsetWidth,Q=re.offsetHeight,ue=window.getComputedStyle(C),be=parseFloat(ue.gap)||4,je=Z.left-te.left,Ne=Z.top-te.top,Ve=de.map(Be=>{let Le,Je;if(Be.r>=0&&Be.r<u&&Be.c>=0&&Be.c<f){const _t=C.children[Be.r*f+Be.c].getBoundingClientRect();Le=_t.left-te.left+_t.width/2,Je=_t.top-te.top+_t.height/2}else{const Ge=Be.c*(Te+be)+Te/2,_t=Be.r*(Q+be)+Q/2;Le=je+Ge,Je=Ne+_t}return`${Le.toFixed(1)},${Je.toFixed(1)}`}).join(" ");return ne(F,Ve,!0),er(z),new Promise(Be=>{setTimeout(()=>{ne(F,""),Be()},350)})}function Ee(de,te,Z){ne(U,{show:!0,title:de,text:te,actions:Z},!0)}function ge(){h(U).show=!1}function Me(){t()?(Ee("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ge(),e.onLose?.()},3e3)):Ee("Конец","Попытайте удачу снова!",[{text:"ОК",action:pe}])}or(n,{children:(de,te)=>{var Z=Cp(),re=Ze(Z);{let Ve=Dt(()=>t()?Me:void 0);lr(re,{onRestart:pe,get onGiveUp(){return h(Ve)},get showGiveUp(){return t()}})}var Te=j(re,2),Q=E(Te);sn(Q,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),Qe(Q,21,()=>h(m),Tt,(Ve,Be,Le)=>{var Je=At(),Ge=Ze(Je);Qe(Ge,17,()=>h(Be),Tt,(_t,lt,xt)=>{var St=Ip();let y;St.__click=()=>fe(Le,xt),St.__keydown=d=>ce(Le,xt,d);var o=E(St);ke(d=>{y=Nt(St,1,"cell svelte-d67gs4",null,y,d),_e(o,h(lt))},[()=>({selected:h(k)?.r===Le&&h(k)?.c===xt,matched:h(w)[Le][xt],shuffling:h(S)[`${Le},${xt}`],"hint-glow":h(p).some(d=>d.r===Le&&d.c===xt)})]),W(_t,St)}),W(Ve,Je)}),Sa(Q,Ve=>C=Ve,()=>C);var ue=j(Q,2),be=E(ue);Ia(be,()=>h(z),Ve=>{var Be=At(),Le=Ze(Be);{var Je=Ge=>{var _t=Sp();ke(()=>We(_t,"points",h(F))),W(Ge,_t)};Oe(Le,Ge=>{h(F)&&Ge(Je)})}W(Ve,Be)}),Sa(Te,Ve=>$=Ve,()=>$);var je=j(Te,2);ur(je,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Ve,Be)=>{var Le=Ap(),Je=E(Le),Ge=j(E(Je)),_t=E(Ge),lt=j(Je,2);let xt;lt.__click=K;var St=j(E(lt));{var y=o=>{var d=Ep(),b=E(d);ke(()=>_e(b,`(${h(M)??""})`)),W(o,d)};Oe(St,o=>{h(M)>0&&o(y)})}ke(o=>{_e(_t,h(ie)),xt=Nt(lt,1,"btn btn-secondary svelte-d67gs4",null,xt,o),lt.disabled=!h(oe)},[()=>({disabled:!h(oe),"cooldown-active":h(M)>0})]),W(Ve,Le)},$$slots:{default:!0}});var Ne=j(je,2);cr(Ne,{get modal(){return h(U)}}),W(de,Z)}}),Ot()}Ft(["click","keydown"]);function Tp(n,e,t,r,i,l,u,f,v,g){if(!(h(e)||h(t)||!h(r)))for(let m=0;m<i;m++)for(let w=0;w<l;w++){if(h(u)[m]?.[w]||h(f)[m]?.[w])continue;let S=h(v)[m][w];for(let p=0;p<i;p++)for(let k=0;k<l;k++)if(!(m===p&&w===k)&&!(h(u)[p]?.[k]||h(f)[p]?.[k])&&h(v)[p][k]===S){ne(g,[{r:m,c:w},{r:p,c:k}],!0),setTimeout(()=>ne(g,[],!0),1500);return}}}var xp=X('<div role="button" tabindex="0"><div class="card-inner svelte-9apm24"><div class="card-front svelte-9apm24"> </div> <div class="card-back svelte-9apm24">?</div></div></div>'),Pp=X('<span class="cooldown-timer svelte-9apm24"> </span>'),Rp=X('<div class="footer-stats svelte-9apm24"><span class="tiles-counter svelte-9apm24">Осталось: <strong class="svelte-9apm24"> </strong></span> <button>💡 <!></button></div>'),Op=X('<!> <div id="game-container" class="svelte-9apm24"><div id="grid" class="svelte-9apm24"></div></div> <!> <!>',1);function Mp(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=6,f=6,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let m=Re(pt([])),w=Re(pt([])),S=Re(pt([])),p=Re(pt([])),k=Re(null),R=Re(!1),x=Re(!1),F=Re(0),z=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>{C()});function M(){let Y=0;for(let K=0;K<u;K++)for(let G=0;G<f;G++)h(w)[K]?.[G]||Y++;return Y}let U=Dt(M),$=Dt(()=>h(F)<1);function C(){ne(m,[],!0),ne(w,[],!0),ne(S,[],!0),ne(k,null),ne(R,!1),ne(x,!1),ne(p,[],!0),ne(F,0),ce();let Y=[...new Set(g)];for(;Y.length<u*f/2;)Y=[...Y,...Y];let K=Y.sort(()=>.5-Math.random()).slice(0,u*f/2),G=[];K.forEach(L=>G.push(L,L)),G.sort(()=>Math.random()-.5);let ee=0;for(let L=0;L<u;L++){let V=[],se=[],le=[];for(let me=0;me<f;me++)V.push(G[ee++]),se.push(!1),le.push(!1);h(m).push(V),h(w).push(se),h(S).push(le)}}async function P(Y,K){if(!(h(R)||h(w)[Y]?.[K]||h(x))){if(h(k)&&h(k).r===Y&&h(k).c===K){h(S)[Y][K]=!1,ne(k,null);return}if(!h(S)[Y]?.[K])if(h(p).length>0&&ne(p,[],!0),h(S)[Y][K]=!0,!h(k))ne(k,{r:Y,c:K},!0);else{ne(R,!0);const G={r:Y,c:K},ee=h(m)[h(k).r][h(k).c],L=h(m)[G.r][G.c];ee===L?setTimeout(()=>{h(w)[h(k).r][h(k).c]=!0,h(w)[G.r][G.c]=!0,h(S)[h(k).r][h(k).c]=!1,h(S)[G.r][G.c]=!1,ne(k,null),ne(R,!1),ie(),oe()},600):setTimeout(()=>{h(S)[h(k).r][h(k).c]=!1,h(S)[G.r][G.c]=!1,ne(k,null),ne(R,!1)},1e3)}}}function ie(){ne(F,v);const Y=setInterval(()=>{er(F,-1),h(F)<=0&&clearInterval(Y)},1e3)}function oe(){h(U)===0&&(ne(x,!0),t()?(fe("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{ce(),e.onWin?.()},3e3)):fe("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:C}]))}function pe(){t()?(fe("💀 Сдаюсь","Вы сдаюсь...",[]),setTimeout(()=>{ce(),e.onLose?.()},3e3)):fe("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:C}])}function fe(Y,K,G){t()||ne(z,{show:!0,title:Y,text:K,actions:G},!0)}function ce(){h(z).show=!1}or(n,{children:(Y,K)=>{var G=Op(),ee=Ze(G);{let me=Dt(()=>t()?pe:void 0);lr(ee,{onRestart:C,get onGiveUp(){return h(me)},get showGiveUp(){return t()}})}var L=j(ee,2),V=E(L);sn(V,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(6, 1fr);"),Qe(V,21,()=>h(m),Tt,(me,Ee,ge)=>{var Me=At(),de=Ze(Me);Qe(de,17,()=>h(Ee),Tt,(te,Z,re)=>{var Te=xp();let Q;Te.__click=()=>P(ge,re);var ue=E(Te),be=E(ue),je=E(be);ke(Ne=>{Q=Nt(Te,1,"cell svelte-9apm24",null,Q,Ne),_e(je,h(Z))},[()=>({flipped:h(S)[ge]?.[re],matched:h(w)[ge]?.[re],selected:h(k)?.r===ge&&h(k)?.c===re,"hint-glow":h(p).some(Ne=>Ne.r===ge&&Ne.c===re)})]),W(te,Te)}),W(me,Me)});var se=j(L,2);ur(se,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(me,Ee)=>{var ge=Rp(),Me=E(ge),de=j(E(Me)),te=E(de),Z=j(Me,2);let re;Z.__click=[Tp,R,x,$,u,f,w,S,m,p];var Te=j(E(Z));{var Q=ue=>{var be=Pp(),je=E(be);ke(()=>_e(je,`(${h(F)??""})`)),W(ue,be)};Oe(Te,ue=>{h(F)>0&&ue(Q)})}ke(ue=>{_e(te,h(U)),re=Nt(Z,1,"btn btn-secondary svelte-9apm24",null,re,ue),Z.disabled=!h($)},[()=>({disabled:!h($),"cooldown-active":h(F)>0})]),W(me,ge)},$$slots:{default:!0}});var le=j(se,2);cr(le,{get modal(){return h(z)}}),W(Y,G)}}),Ot()}Ft(["click"]);var Lp=X('<div class="flame svelte-jtqql5"></div>'),Dp=X('<div role="button" tabindex="0"><div class="candle svelte-jtqql5"><!></div></div>'),Fp=X('<div class="footer-stats svelte-jtqql5"><span class="moves-counter svelte-jtqql5">Ходов: <strong class="svelte-jtqql5"> </strong></span></div>'),$p=X('<!> <div id="game-container" class="svelte-jtqql5"><div id="grid" class="svelte-jtqql5"></div></div> <!> <!>',1);function Up(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=5,f=5,v=15;let g=Re(pt([])),m=Re(0),w=Re(!1),S=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>k());let p=Dt(()=>h(g).flat().every($=>!$));function k(){ne(g,Array(u).fill(null).map(()=>Array(f).fill(!1)),!0),ne(m,0),ne(w,!1),U();for(let $=0;$<v;$++){const C=Math.floor(Math.random()*u),P=Math.floor(Math.random()*f);R(C,P,!0)}}function R($,C,P=!1){h(g)[$][C]=!h(g)[$][C],$>0&&(h(g)[$-1][C]=!h(g)[$-1][C]),$<u-1&&(h(g)[$+1][C]=!h(g)[$+1][C]),C>0&&(h(g)[$][C-1]=!h(g)[$][C-1]),C<f-1&&(h(g)[$][C+1]=!h(g)[$][C+1]),P||(er(m),F())}function x($,C){h(w)||R($,C)}function F(){h(p)&&(ne(w,!0),t()?(M("🕯️ Тьма наступила",`Вы погасили все свечи за ${h(m)} ходов!`,[]),setTimeout(()=>{U(),e.onWin?.()},3e3)):M("🕯️ Тьма наступила",`Вы погасили все свечи за ${h(m)} ходов!`,[{text:"Играть снова",action:k}]))}function z(){t()?(M("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):M("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function M($,C,P){t()||ne(S,{show:!0,title:$,text:C,actions:P},!0)}function U(){h(S).show=!1}or(n,{children:($,C)=>{var P=$p(),ie=Ze(P);{let Y=Dt(()=>t()?z:void 0);lr(ie,{onRestart:k,get onGiveUp(){return h(Y)},get showGiveUp(){return t()}})}var oe=j(ie,2),pe=E(oe);sn(pe,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),Qe(pe,21,()=>h(g),Tt,(Y,K,G)=>{var ee=At(),L=Ze(ee);Qe(L,17,()=>h(K),Tt,(V,se,le)=>{var me=Dp();let Ee;me.__click=()=>x(G,le);var ge=E(me),Me=E(ge);{var de=te=>{var Z=Lp();W(te,Z)};Oe(Me,te=>{h(se)&&te(de)})}ke(te=>Ee=Nt(me,1,"cell svelte-jtqql5",null,Ee,te),[()=>({lit:h(se)})]),W(V,me)}),W(Y,ee)});var fe=j(oe,2);ur(fe,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Y,K)=>{var G=Fp(),ee=E(G),L=j(E(ee)),V=E(L);ke(()=>_e(V,h(m))),W(Y,G)},$$slots:{default:!0}});var ce=j(fe,2);cr(ce,{get modal(){return h(S)}}),W($,P)}}),Ot()}Ft(["click"]);var Np=X('<div class="cell svelte-53kujm"> </div>'),Bp=X('<button class="color-btn svelte-53kujm"> </button>'),Wp=X('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),Vp=X('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function qp(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=12,f=25,v=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let g=Re(pt([])),m=Re(0),w=Re(!1),S=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>k());let p=Dt(()=>()=>{const $=h(g)[0][0];return h(g).every(C=>C.every(P=>P===$))});function k(){ne(g,[],!0),ne(m,0),ne(w,!1),U();for(let $=0;$<u;$++){let C=[];for(let P=0;P<u;P++)C.push(Math.floor(Math.random()*v.length));h(g).push(C)}}function R($,C,P,ie){$<0||$>=u||C<0||C>=u||h(g)[$][C]===P&&(h(g)[$][C]=ie,R($-1,C,P,ie),R($+1,C,P,ie),R($,C-1,P,ie),R($,C+1,P,ie))}function x($){if(h(w)||h(m)>=f)return;const C=h(g)[0][0];$!==C&&(R(0,0,C,$),er(m),F())}function F(){h(p)()?(ne(w,!0),t()?(M("🎉 Победа!",`Вы захватили мир за ${h(m)} ходов!`,[]),setTimeout(()=>{U(),e.onWin?.()},3e3)):M("🎉 Победа!",`Вы захватили мир за ${h(m)} ходов!`,[{text:"Играть снова",action:k}])):h(m)>=f&&(ne(w,!0),t()?(M("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):M("💀 Поражение","Ходы закончились!",[{text:"Заново",action:k}]))}function z(){t()?(M("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},3e3)):M("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function M($,C,P){ne(S,{show:!0,title:$,text:C,actions:P},!0)}function U(){h(S).show=!1}or(n,{children:($,C)=>{var P=Vp(),ie=Ze(P);{let K=Dt(()=>t()?z:void 0);lr(ie,{onRestart:k,get onGiveUp(){return h(K)},get showGiveUp(){return t()}})}var oe=j(ie,2),pe=E(oe);sn(pe,"grid-template-columns: repeat(12, 1fr);"),Qe(pe,21,()=>h(g),Tt,(K,G)=>{var ee=At(),L=Ze(ee);Qe(L,17,()=>h(G),Tt,(V,se)=>{var le=Np(),me=E(le);ke(()=>{sn(le,`background-color: ${v[h(se)].value??""};`),_e(me,v[h(se)].icon)}),W(V,le)}),W(K,ee)});var fe=j(oe,2);Qe(fe,21,()=>v,Tt,(K,G,ee)=>{var L=Bp();L.__click=()=>x(ee);var V=E(L);ke(()=>{sn(L,`background-color: ${h(G).value??""};`),L.disabled=h(w)||h(m)>=f,_e(V,h(G).icon)}),W(K,L)});var ce=j(fe,2);ur(ce,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(K,G)=>{var ee=Wp(),L=E(ee),V=j(E(L)),se=E(V),le=j(V);le.nodeValue=" / 25",ke(()=>_e(se,h(m))),W(K,ee)},$$slots:{default:!0}});var Y=j(ce,2);cr(Y,{get modal(){return h(S)}}),W($,P)}}),Ot()}Ft(["click"]);var Gp=X('<div role="button" tabindex="0"> </div>'),zp=X('<div class="footer-stats svelte-1f92ac8"><span class="moves-counter svelte-1f92ac8">Ходов: <strong class="svelte-1f92ac8"> </strong></span></div>'),Hp=X('<!> <div id="game-container" class="svelte-1f92ac8"><div id="grid" class="svelte-1f92ac8"></div></div> <!> <!>',1);function Kp(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=4;let f=Re(pt([])),v=Re(0),g=Re(!1),m=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>S());let w=Dt(()=>()=>{let U=1;for(let $=0;$<u;$++)for(let C=0;C<u;C++)if($===u-1&&C===u-1){if(h(f)[$][C]!==null)return!1}else{if(h(f)[$][C]!==U)return!1;U++}return!0});function S(){ne(f,[],!0),ne(v,0),ne(g,!1),M();let U=[];for(let C=1;C<u*u;C++)U.push(C);U.push(null);do U=U.sort(()=>Math.random()-.5);while(!p(U));let $=0;for(let C=0;C<u;C++){let P=[];for(let ie=0;ie<u;ie++)P.push(U[$++]);h(f).push(P)}}function p(U){let $=0;for(let P=0;P<U.length;P++)for(let ie=P+1;ie<U.length;ie++)U[P]&&U[ie]&&U[P]>U[ie]&&$++;let C=0;for(let P=0;P<U.length;P++)if(U[P]===null){C=Math.floor(P/u);break}return $%2===(u-C)%2}function k(){for(let U=0;U<u;U++)for(let $=0;$<u;$++)if(h(f)[U][$]===null)return{r:U,c:$};return null}function R(U,$){if(h(g))return;const C=k();if(!C)return;const P=Math.abs(U-C.r),ie=Math.abs($-C.c);(P===1&&ie===0||P===0&&ie===1)&&(h(f)[C.r][C.c]=h(f)[U][$],h(f)[U][$]=null,er(v),x())}function x(){h(w)()&&(ne(g,!0),t()?(z("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${h(v)} ходов!`,[]),setTimeout(()=>{M(),e.onWin?.()},3e3)):z("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${h(v)} ходов!`,[{text:"Играть снова",action:S}]))}function F(){t()?(z("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{M(),e.onLose?.()},3e3)):z("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:S}])}function z(U,$,C){t()||ne(m,{show:!0,title:U,text:$,actions:C},!0)}function M(){h(m).show=!1}or(n,{children:(U,$)=>{var C=Hp(),P=Ze(C);{let ce=Dt(()=>t()?F:void 0);lr(P,{onRestart:S,get onGiveUp(){return h(ce)},get showGiveUp(){return t()}})}var ie=j(P,2),oe=E(ie);sn(oe,"grid-template-columns: repeat(4, 1fr);"),Qe(oe,21,()=>h(f),Tt,(ce,Y,K)=>{var G=At(),ee=Ze(G);Qe(ee,17,()=>h(Y),Tt,(L,V,se)=>{var le=Gp();let me;le.__click=()=>R(K,se);var Ee=E(le);ke(ge=>{me=Nt(le,1,"cell svelte-1f92ac8",null,me,ge),_e(Ee,h(V))},[()=>({empty:h(V)===null})]),W(L,le)}),W(ce,G)});var pe=j(ie,2);ur(pe,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(ce,Y)=>{var K=zp(),G=E(K),ee=j(E(G)),L=E(ee);ke(()=>_e(L,h(v))),W(ce,K)},$$slots:{default:!0}});var fe=j(pe,2);cr(fe,{get modal(){return h(m)}}),W(U,C)}}),Ot()}Ft(["click"]);var Yp=X("<div> </div>"),Jp=X('<div class="footer-stats svelte-1w5hynb"><span class="score-counter svelte-1w5hynb">Очки: <strong class="svelte-1w5hynb"> </strong></span></div>'),Xp=X('<!> <div id="game-container" class="svelte-1w5hynb"><div id="grid" class="svelte-1w5hynb"></div></div> <!> <!>',1);function Qp(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=4,f=2048,v={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},g={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=Re(pt([])),w=Re(0),S=Re(!1),p=Re(!1),k=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>(R(),window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)));function R(){ne(m,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),ne(w,0),ne(S,!1),ne(p,!1),ee(),x(),x()}function x(){let L=[];for(let V=0;V<u;V++)for(let se=0;se<u;se++)h(m)[V][se]===0&&L.push({r:V,c:se});if(L.length>0){const{r:V,c:se}=L[Math.floor(Math.random()*L.length)];h(m)[V][se]=Math.random()<.9?2:4}}function F(L){if(h(S))return;let V=!1;switch(L.key){case"ArrowUp":V=$();break;case"ArrowDown":V=C();break;case"ArrowLeft":V=M();break;case"ArrowRight":V=U();break}V&&(L.preventDefault(),x(),fe())}function z(L){let V=L.filter(le=>le!==0),se=!1;for(let le=0;le<V.length-1;le++)V[le]===V[le+1]&&(V[le]*=2,ne(w,h(w)+V[le]),V.splice(le+1,1),se=!0);for(;V.length<u;)V.push(0);return{newRow:V,moved:se||L.join(",")!==V.join(",")}}function M(){let L=!1;for(let V=0;V<u;V++){const{newRow:se,moved:le}=z(h(m)[V]);h(m)[V]=se,le&&(L=!0)}return L}function U(){let L=!1;for(let V=0;V<u;V++){const{newRow:se,moved:le}=z([...h(m)[V]].reverse());h(m)[V]=se.reverse(),le&&(L=!0)}return L}function $(){let L=!1;for(let V=0;V<u;V++){let se=[];for(let Ee=0;Ee<u;Ee++)se.push(h(m)[Ee][V]);const{newRow:le,moved:me}=z(se);for(let Ee=0;Ee<u;Ee++)h(m)[Ee][V]=le[Ee];me&&(L=!0)}return L}function C(){let L=!1;for(let V=0;V<u;V++){let se=[];for(let Ee=0;Ee<u;Ee++)se.push(h(m)[Ee][V]);const{newRow:le,moved:me}=z(se.reverse());se=le.reverse();for(let Ee=0;Ee<u;Ee++)h(m)[Ee][V]=se[Ee];me&&(L=!0)}return L}let P=Re(0),ie=Re(0);function oe(L){ne(P,L.touches[0].clientX,!0),ne(ie,L.touches[0].clientY,!0)}function pe(L){if(h(S))return;const V=L.changedTouches[0].clientX,se=L.changedTouches[0].clientY,le=V-h(P),me=se-h(ie);if(Math.abs(le)<30&&Math.abs(me)<30)return;let Ee=!1;Math.abs(le)>Math.abs(me)?Ee=le>0?U():M():Ee=me>0?C():$(),Ee&&(L.preventDefault(),x(),fe())}function fe(){if(!h(p)){for(let L=0;L<u;L++)for(let V=0;V<u;V++)if(h(m)[L][V]>=f){ne(p,!0),t()?(G("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{ee(),e.onWin?.()},3e3)):G("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:ee},{text:"Новая игра",action:R,class:"btn-secondary"}]);return}}ce()&&!Y()&&(ne(S,!0),t()?(G("💀 Конец",`Игра окончена. Очки: ${h(w)}`,[]),setTimeout(()=>{ee(),e.onLose?.()},3e3)):G("💀 Конец",`Игра окончена. Очки: ${h(w)}`,[{text:"Новая игра",action:R}]))}function ce(){for(let L=0;L<u;L++)for(let V=0;V<u;V++)if(h(m)[L][V]===0)return!1;return!0}function Y(){for(let L=0;L<u;L++)for(let V=0;V<u;V++)if(V<u-1&&h(m)[L][V]===h(m)[L][V+1]||L<u-1&&h(m)[L][V]===h(m)[L+1][V])return!0;return!1}function K(){t()?(G("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ee(),e.onLose?.()},3e3)):G("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:R}])}function G(L,V,se){t()||ne(k,{show:!0,title:L,text:V,actions:se},!0)}function ee(){h(k).show=!1}or(n,{children:(L,V)=>{var se=Xp(),le=Ze(se);{let de=Dt(()=>t()?K:void 0);lr(le,{onRestart:R,get onGiveUp(){return h(de)},get showGiveUp(){return t()}})}var me=j(le,2),Ee=E(me);Qe(Ee,21,()=>h(m),Tt,(de,te)=>{var Z=At(),re=Ze(Z);Qe(re,17,()=>h(te),Tt,(Te,Q)=>{var ue=Yp();Nt(ue,1,"cell svelte-1w5hynb",null,{},{"cell-{cell}":Q-{}});var be=E(ue);ke(()=>{sn(ue,`background-color: ${g[h(Q)]||"#2a2a40"};`),_e(be,h(Q)>0?v[h(Q)]||h(Q):"")}),W(Te,ue)}),W(de,Z)});var ge=j(me,2);ur(ge,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(de,te)=>{var Z=Jp(),re=E(Z),Te=j(E(re)),Q=E(Te);ke(()=>_e(Q,h(w))),W(de,Z)},$$slots:{default:!0}});var Me=j(ge,2);cr(Me,{get modal(){return h(k)}}),ka("touchstart",me,oe),ka("touchend",me,pe),W(L,se)}}),Ot()}var Zp=X('<div role="button" tabindex="0"><span class="cell-content svelte-1ydctpx"> </span></div>'),eg=X('<div class="footer-stats svelte-1ydctpx"><span class="mines-counter svelte-1ydctpx"></span> <span class="flag-counter svelte-1ydctpx"> </span></div>'),tg=X('<!> <div id="game-container" class="svelte-1ydctpx"><div id="grid" class="svelte-1ydctpx"></div></div> <!> <!>',1);function ng(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=8,f=8,v=10;let g=Re(pt([])),m=Re(!1),w=Re(!1),S=Re(!0),p=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>F());let k=Dt(()=>h(g).filter(K=>K.revealed).length),R=u*f,x=Dt(()=>h(w)||h(k)===R-v);function F(){ne(g,Array(R).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),ne(m,!1),ne(w,!1),ne(S,!0),fe()}function z(K){let G=0;for(;G<v;){const ee=Math.floor(Math.random()*R);ee!==K&&!h(g)[ee].isMine&&(h(g)[ee].isMine=!0,G++)}for(let ee=0;ee<R;ee++)h(g)[ee].isMine||(h(g)[ee].adjacentMines=M(ee))}function M(K){const G=Math.floor(K/f),ee=K%f;let L=0;for(let V=-1;V<=1;V++)for(let se=-1;se<=1;se++){if(V===0&&se===0)continue;const le=G+V,me=ee+se;if(le>=0&&le<u&&me>=0&&me<f){const Ee=le*f+me;h(g)[Ee].isMine&&L++}}return L}function U(K){if(!(h(m)||h(g)[K].revealed||h(g)[K].flagged)){if(h(S)&&(z(K),ne(S,!1)),h(g)[K].isMine){P(),ne(m,!0),ne(w,!1),t()?(pe("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{fe(),e.onLose?.()},3e3)):pe("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:F}]);return}C(K),ie()}}function $(K,G){G.preventDefault(),!(h(m)||h(g)[K].revealed)&&(h(g)[K].flagged=!h(g)[K].flagged)}function C(K){if(!(K<0||K>=R)&&!(h(g)[K].revealed||h(g)[K].flagged)&&(h(g)[K].revealed=!0,h(g)[K].adjacentMines===0&&!h(g)[K].isMine)){const G=Math.floor(K/f),ee=K%f;for(let L=-1;L<=1;L++)for(let V=-1;V<=1;V++){if(L===0&&V===0)continue;const se=G+L,le=ee+V;se>=0&&se<u&&le>=0&&le<f&&C(se*f+le)}}}function P(){for(let K=0;K<R;K++)h(g)[K].isMine&&(h(g)[K].revealed=!0)}function ie(){h(x)()&&(ne(w,!0),ne(m,!0),t()?(pe("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{fe(),e.onWin?.()},3e3)):pe("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:F}]))}function oe(){t()?(pe("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{fe(),e.onLose?.()},3e3)):pe("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:F}])}function pe(K,G,ee){t()||ne(p,{show:!0,title:K,text:G,actions:ee},!0)}function fe(){h(p).show=!1}function ce(K){return K.revealed?K.isMine?"💀":K.adjacentMines===0?"":K.adjacentMines.toString():K.flagged?"🚩":""}function Y(K){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][K]||"#ececec"}or(n,{children:(K,G)=>{var ee=tg(),L=Ze(ee);{let Ee=Dt(()=>t()?oe:void 0);lr(L,{onRestart:F,get onGiveUp(){return h(Ee)},get showGiveUp(){return t()}})}var V=j(L,2),se=E(V);sn(se,"grid-template-columns: repeat(8, 1fr);"),Qe(se,21,()=>h(g),Tt,(Ee,ge,Me)=>{var de=Zp();let te;de.__click=()=>U(Me),de.__contextmenu=Te=>$(Me,Te);var Z=E(de),re=E(Z);ke((Te,Q,ue)=>{te=Nt(de,1,"cell svelte-1ydctpx",null,te,Te),sn(Z,`color: ${Q??""}`),_e(re,ue)},[()=>({revealed:h(ge).revealed,mine:h(ge).isMine&&h(ge).revealed,flagged:h(ge).flagged}),()=>h(ge).revealed&&!h(ge).isMine?Y(h(ge).adjacentMines):"",()=>ce(h(ge))]),W(Ee,de)});var le=j(V,2);ur(le,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Ee,ge)=>{var Me=eg(),de=E(Me);de.textContent="💀 10";var te=j(de,2),Z=E(te);ke(re=>_e(Z,`🚩 ${re??""}`),[()=>h(g).filter(re=>re.flagged).length]),W(Ee,Me)},$$slots:{default:!0}});var me=j(le,2);cr(me,{get modal(){return h(p)}}),W(K,ee)}}),Ot()}Ft(["click","contextmenu"]);function rg(n,e,t,r){if(h(e).length>0){const i=h(e).pop();i.faceUp=!0,h(t).push(i)}else h(t).length>0&&(ne(e,h(t).reverse().map(i=>({...i,faceUp:!1})),!0),ne(t,[],!0));er(r)}function ig(n,e,t){h(e).length!==0&&ne(t,{pile:-2,index:h(e).length-1},!0)}var sg=X('<div class="card back svelte-nzeewv"></div>'),ag=X('<div class="card empty svelte-nzeewv">🔄</div>'),og=X('<div><span class="rank svelte-nzeewv"> </span> <span class="suit svelte-nzeewv"> </span></div>'),lg=X('<div class="card front svelte-nzeewv"><span class="rank svelte-nzeewv"> </span> <span class="suit svelte-nzeewv"> </span></div>'),ug=X('<div class="card empty svelte-nzeewv">👻</div>'),cg=X('<div class="pile foundation svelte-nzeewv"><!></div>'),dg=X('<span class="rank svelte-nzeewv"> </span> <span class="suit svelte-nzeewv"> </span>',1),fg=X("<div><!></div>"),hg=X('<div class="tableau svelte-nzeewv"></div>'),vg=X('<div class="footer-stats svelte-nzeewv"><span class="moves-counter svelte-nzeewv">Ходов: <strong class="svelte-nzeewv"> </strong></span></div>'),pg=X('<!> <div id="game-container" class="svelte-nzeewv"><div class="top-row svelte-nzeewv"><div class="pile stock svelte-nzeewv"><!></div> <div class="pile waste svelte-nzeewv"><!></div> <div class="foundations svelte-nzeewv"></div></div> <div class="tableaus svelte-nzeewv"></div></div> <!> <!>',1);function gg(n,e){Rt(e,!0);let t=He(e,"integrated",3,!1),r=He(e,"rewardItem",3,null),i=He(e,"items",19,()=>[]),l=He(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],f={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},v=[1,2,3,4,5,6,7,8,9,10,11,12,13],g={1:"A",11:"J",12:"Q",13:"K"};let m=Re(pt([])),w=Re(pt([])),S=Re(pt([[],[],[],[]])),p=Re(pt([[],[],[],[],[],[],[]])),k=Re(null),R=Re(!1),x=Re(0),F=Re(pt({show:!1,title:"",text:"",actions:[]}));In(()=>M());let z=Dt(()=>h(S).every(Y=>Y.length===13));function M(){let Y=[];for(const G of u)for(const ee of v)Y.push({suit:G,rank:ee,faceUp:!1});Y=Y.sort(()=>Math.random()-.5),ne(m,[],!0),ne(w,[],!0),ne(S,[[],[],[],[]],!0),ne(p,[[],[],[],[],[],[],[]],!0);let K=0;for(let G=0;G<7;G++)for(let ee=G;ee<7;ee++){const L=Y[K++];L.faceUp=G===ee,h(p)[ee].push(L)}for(;K<Y.length;)h(m).push(Y[K++]);ne(k,null),ne(x,0),ne(R,!1),pe()}function U(Y,K){const G=h(p)[Y];if(h(k)){const{pile:ee,index:L}=h(k);let V;ee===-2?V=[h(w)[L]]:V=h(p)[ee].slice(L);const se=V[0];if(G.length===0){if(se.rank===13){C(ee,L,Y,-1),ne(k,null);return}}else{const le=G[G.length-1];if((se.suit==="hearts"||se.suit==="diamonds")!=(le.suit==="hearts"||le.suit==="diamonds")&&se.rank===le.rank-1){C(ee,L,Y,-1),ne(k,null);return}}if(V.length===1)for(let le=0;le<4;le++){const me=h(S)[le];if(me.length===0){if(se.rank===1){C(ee,L,-1,le),ne(k,null);return}}else{const Ee=me[me.length-1];if(se.suit===Ee.suit&&se.rank===Ee.rank+1){C(ee,L,-1,le),ne(k,null);return}}}ne(k,null)}else K>=0&&G[K]?.faceUp&&ne(k,{pile:Y,index:K},!0)}function $(Y){if(!h(k))return;const{pile:K,index:G}=h(k);let ee;K===-2?ee=h(w)[G]:ee=h(p)[K][G];const L=h(S)[Y];if(L.length===0)ee.rank===1&&K>=-1&&(K===-2?[h(w)[G]]:h(p)[K].slice(G)).length===1&&C(K,G,-1,Y);else{const V=L[L.length-1];ee.suit===V.suit&&ee.rank===V.rank+1&&(K===-2?[h(w)[G]]:h(p)[K].slice(G)).length===1&&C(K,G,-1,Y)}ne(k,null)}function C(Y,K,G,ee){let L;Y===-2?L=[h(w).pop()]:(L=h(p)[Y].splice(K),h(p)[Y].length>0&&(h(p)[Y][h(p)[Y].length-1].faceUp=!0)),G>=0?h(p)[G].push(...L):ee>=0&&h(S)[ee].push(...L),er(x),P()}function P(){h(z)&&(ne(R,!0),t()?(oe("🎉 Победа!",`Вы собрали все души за ${h(x)} ходов!`,[]),setTimeout(()=>{pe(),e.onWin?.()},3e3)):oe("🎉 Победа!",`Вы собрали все души за ${h(x)} ходов!`,[{text:"Играть снова",action:M}]))}function ie(){t()?(oe("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{pe(),e.onLose?.()},3e3)):oe("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:M}])}function oe(Y,K,G){t()||ne(F,{show:!0,title:Y,text:K,actions:G},!0)}function pe(){h(F).show=!1}function fe(Y){return g[Y]||Y.toString()}function ce(Y){return Y==="hearts"||Y==="diamonds"?"#e94560":"#ececec"}or(n,{children:(Y,K)=>{var G=pg(),ee=Ze(G);{let Q=Dt(()=>t()?ie:void 0);lr(ee,{onRestart:M,get onGiveUp(){return h(Q)},get showGiveUp(){return t()}})}var L=j(ee,2),V=E(L),se=E(V);se.__click=[rg,m,w,x];var le=E(se);{var me=Q=>{var ue=sg();W(Q,ue)},Ee=Q=>{var ue=ag();W(Q,ue)};Oe(le,Q=>{h(m).length>0?Q(me):Q(Ee,!1)})}var ge=j(se,2);ge.__click=[ig,w,k];var Me=E(ge);{var de=Q=>{var ue=og();let be;var je=E(ue),Ne=E(je),Ve=j(je,2),Be=E(Ve);ke((Le,Je,Ge)=>{be=Nt(ue,1,"card front svelte-nzeewv",null,be,Le),_e(Ne,Je),sn(Ve,`color: ${Ge??""}`),_e(Be,f[h(w)[h(w).length-1].suit])},[()=>({selected:h(k)?.pile===-2}),()=>fe(h(w)[h(w).length-1].rank),()=>ce(h(w)[h(w).length-1].suit)]),W(Q,ue)};Oe(Me,Q=>{h(w).length>0&&Q(de)})}var te=j(ge,2);Qe(te,21,()=>h(S),Tt,(Q,ue,be)=>{var je=cg();je.__click=()=>$(be);var Ne=E(je);{var Ve=Le=>{var Je=lg(),Ge=E(Je),_t=E(Ge),lt=j(Ge,2),xt=E(lt);ke((St,y)=>{_e(_t,St),sn(lt,`color: ${y??""}`),_e(xt,f[h(ue)[h(ue).length-1].suit])},[()=>fe(h(ue)[h(ue).length-1].rank),()=>ce(h(ue)[h(ue).length-1].suit)]),W(Le,Je)},Be=Le=>{var Je=ug();W(Le,Je)};Oe(Ne,Le=>{h(ue).length>0?Le(Ve):Le(Be,!1)})}W(Q,je)});var Z=j(V,2);Qe(Z,21,()=>h(p),Tt,(Q,ue,be)=>{var je=hg();je.__click=()=>U(be,-1),Qe(je,21,()=>h(ue),Tt,(Ne,Ve,Be)=>{var Le=fg();let Je;Le.__click=lt=>{lt.stopPropagation(),U(be,Be)},sn(Le,`margin-top: ${Be>0?"-80%":"0"}; z-index: ${Be};`);var Ge=E(Le);{var _t=lt=>{var xt=dg(),St=Ze(xt),y=E(St),o=j(St,2),d=E(o);ke((b,T)=>{_e(y,b),sn(o,`color: ${T??""}`),_e(d,f[h(Ve).suit])},[()=>fe(h(Ve).rank),()=>ce(h(Ve).suit)]),W(lt,xt)};Oe(Ge,lt=>{h(Ve).faceUp&&lt(_t)})}ke(lt=>Je=Nt(Le,1,"card svelte-nzeewv",null,Je,lt),[()=>({front:h(Ve).faceUp,back:!h(Ve).faceUp,selected:h(k)?.pile===be&&h(k)?.index===Be})]),W(Ne,Le)}),W(Q,je)});var re=j(L,2);ur(re,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Q,ue)=>{var be=vg(),je=E(be),Ne=j(E(je)),Ve=E(Ne);ke(()=>_e(Ve,h(x))),W(Q,be)},$$slots:{default:!0}});var Te=j(re,2);cr(Te,{get modal(){return h(F)}}),W(Y,G)}}),Ot()}Ft(["click"]);var _g=X('<div class="loading svelte-15dde84">Загрузка игры...</div>'),mg=X('<div class="minigame-container svelte-15dde84"><!></div>');function yg(n,e){Rt(e,!0);let t=He(e,"bucketName",3,"dracula");function r(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function i(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var l=mg(),u=E(l);{var f=g=>{jp(g,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},v=g=>{var m=At(),w=Ze(m);{var S=k=>{Mp(k,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=k=>{var R=At(),x=Ze(R);{var F=M=>{Up(M,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},z=M=>{var U=At(),$=Ze(U);{var C=ie=>{qp(ie,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},P=ie=>{var oe=At(),pe=Ze(oe);{var fe=Y=>{Kp(Y,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ce=Y=>{var K=At(),G=Ze(K);{var ee=V=>{Qp(V,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},L=V=>{var se=At(),le=Ze(se);{var me=ge=>{ng(ge,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},Ee=ge=>{var Me=At(),de=Ze(Me);{var te=re=>{gg(re,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},Z=re=>{var Te=_g();W(re,Te)};Oe(de,re=>{e.gameId==="tower_of_souls"?re(te):re(Z,!1)},!0)}W(ge,Me)};Oe(le,ge=>{e.gameId==="cursed_crypts"?ge(me):ge(Ee,!1)},!0)}W(V,se)};Oe(G,V=>{e.gameId==="evolution2048"?V(ee):V(L,!1)},!0)}W(Y,K)};Oe(pe,Y=>{e.gameId==="broken_mirror"?Y(fe):Y(ce,!1)},!0)}W(ie,oe)};Oe($,ie=>{e.gameId==="flood_it"?ie(C):ie(P,!1)},!0)}W(M,U)};Oe(x,M=>{e.gameId==="light_out"?M(F):M(z,!1)},!0)}W(k,R)};Oe(w,k=>{e.gameId==="memo_monsters"?k(S):k(p,!1)},!0)}W(g,m)};Oe(u,g=>{e.gameId==="onet_monsters"?g(f):g(v,!1)})}W(n,l),Ot()}function wg(n,e){h(e)?.nextDialogueId&&jt.goToDialogue(h(e).nextDialogueId)}var bg=X('<img alt="BG" class="background-image svelte-fl90wm"/>'),kg=X('<div class="background-media svelte-fl90wm"><!></div>'),Ig=X('<img alt="Char" class="character-image svelte-fl90wm"/>'),Sg=X('<div class="character-media svelte-fl90wm"><!></div>'),Eg=(n,e,t)=>e(h(t)),Ag=X("<button> </button>"),Cg=X('<div class="options-container svelte-fl90wm"></div>'),jg=X('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),Tg=X('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),xg=X("<p> </p>");function Bu(n,e){Rt(e,!0);let t=He(e,"bucketName",3,Nu);console.log(t());const r=Dt(()=>e.dialogue||jt.findDialogue(jt.currentDialogueId));let i=Re(null);li(()=>{h(r)?.onEnter&&jt.runActions(h(r).onEnter)});function l(k){if(k.actions&&jt.runActions(k.actions),k.miniGame){console.log("Запуск мини-игры:",k.miniGame.id),ne(i,{gameId:k.miniGame.id,onWinDialogueId:k.miniGame.onWinDialogueId,onLoseDialogueId:k.miniGame.onLoseDialogueId,rewardItem:k.miniGame.rewardItem},!0);return}k.nextDialogueId&&jt.goToDialogue(k.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),h(i)?.rewardItem&&jt.addItem(h(i).rewardItem),h(i)?.onWinDialogueId&&jt.goToDialogue(h(i).onWinDialogueId),ne(i,null)}function f(){console.log("[DialogueCard] Mini-game lost!"),h(i)?.onLoseDialogueId&&jt.goToDialogue(h(i).onLoseDialogueId),ne(i,null)}function v(k){return k.visible===!1?!1:jt.checkVisibilityCondition(k)}function g(k){return k.enabled!==!1}var m=At(),w=Ze(m);{var S=k=>{var R=Tg(),x=E(R);{var F=ce=>{{let Y=Dt(()=>jt.storyData?.items);yg(ce,{get gameId(){return h(i).gameId},onWin:u,onLose:f,get rewardItem(){return h(i).rewardItem},get items(){return h(Y)},get bucketName(){return t()}})}};Oe(x,ce=>{h(i)&&ce(F)})}var z=j(x,2);{var M=ce=>{var Y=kg(),K=E(Y);{var G=L=>{var V=At(),se=Ze(V);Ia(se,()=>h(r).backgroundImage,le=>{Ll(le,{get fileName(){return h(r).backgroundImage},get bucketName(){return t()}})}),W(L,V)},ee=L=>{var V=bg();ke(()=>We(V,"src",`${Es}/storage/v1/object/public/${t()}/${h(r).backgroundImage}`)),W(L,V)};Oe(K,L=>{h(r).backgroundImage.endsWith(".riv")?L(G):L(ee,!1)})}W(ce,Y)};Oe(z,ce=>{h(r).backgroundImage&&ce(M)})}var U=j(z,2);{var $=ce=>{var Y=Sg(),K=E(Y);{var G=L=>{var V=At(),se=Ze(V);Ia(se,()=>h(r).characterImage,le=>{Ll(le,{get fileName(){return h(r).characterImage},get bucketName(){return t()}})}),W(L,V)},ee=L=>{var V=Ig();ke(()=>We(V,"src",`${Es}/storage/v1/object/public/${t()}/${h(r).characterImage}`)),W(L,V)};Oe(K,L=>{h(r).characterImage.endsWith(".riv")?L(G):L(ee,!1)})}W(ce,Y)};Oe(U,ce=>{h(r).characterImage&&ce($)})}var C=j(U,2),P=E(C),ie=E(P),oe=j(P,2);{var pe=ce=>{var Y=Cg();Qe(Y,21,()=>h(r).options,K=>K.text,(K,G)=>{var ee=At(),L=Ze(ee);{var V=se=>{var le=Ag();let me;le.__click=[Eg,l,G];var Ee=E(le);ke((ge,Me)=>{me=Nt(le,1,"option-button svelte-fl90wm",null,me,ge),le.disabled=Me,_e(Ee,h(G).text)},[()=>({disabled:!g(h(G))}),()=>!g(h(G))]),W(se,le)};Oe(L,se=>{v(h(G))&&se(V)})}W(K,ee)}),W(ce,Y)},fe=ce=>{var Y=At(),K=Ze(Y);{var G=ee=>{var L=jg(),V=E(L);V.__click=[wg,r],W(ee,L)};Oe(K,ee=>{h(r).nextDialogueId&&ee(G)},!0)}W(ce,Y)};Oe(oe,ce=>{h(r).options&&h(r).options.length>0?ce(pe):ce(fe,!1)})}ke(()=>_e(ie,h(r).text)),W(k,R)},p=k=>{var R=xg(),x=E(R);ke(()=>_e(x,`Диалог не найден (ID: ${jt.currentDialogueId??""})`)),W(k,R)};Oe(w,k=>{h(r)?k(S):k(p,!1)})}W(n,m),Ot()}Ft(["click"]);var ha=sr(()=>B),Pg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Rg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Og=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Mg=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),Lg=X('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),Dg=X('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Fg=X('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function $g(n,e){Rt(e,!1);function t(){ha(ha().editingOptionIndex=null)}ir();var r=Fg(),i=E(r),l=j(E(i),2);l.__click=t;var u=j(i,2),f=E(u);{var v=m=>{var w=Lg(),S=E(w);Bu(S,{get dialogue(){return Jt.currentDialogue},index:0,get bucketName(){return ha().selectedBucket}});var p=j(S,2),k=E(p),R=j(E(k),2),x=E(R),F=j(k,2),z=j(E(F),2),M=E(z),U=j(F,2);{var $=ce=>{var Y=Pg(),K=j(E(Y),2),G=E(K);ke(()=>_e(G,Jt.currentDialogue.backgroundImage)),W(ce,Y)};Oe(U,ce=>{Jt.currentDialogue.backgroundImage&&ce($)})}var C=j(U,2);{var P=ce=>{var Y=Rg(),K=j(E(Y),2),G=E(K);ke(()=>_e(G,Jt.currentDialogue.characterImage)),W(ce,Y)};Oe(C,ce=>{Jt.currentDialogue.characterImage&&ce(P)})}var ie=j(p,2);{var oe=ce=>{var Y=Og();W(ce,Y)};Oe(ie,ce=>{(!Jt.currentDialogue.options||Jt.currentDialogue.options.length===0)&&ce(oe)})}var pe=j(ie,2);{var fe=ce=>{var Y=Mg();W(ce,Y)};Oe(pe,ce=>{Jt.currentDialogue.options?.some(Y=>!Y.nextDialogueId)&&ce(fe)})}ke(()=>{_e(x,Jt.currentDialogue.id),_e(M,Jt.currentChapter?.title||"Без главы")}),W(m,w)},g=m=>{var w=Dg();W(m,w)};Oe(f,m=>{Jt.currentDialogue?m(v):m(g,!1)})}W(n,r),Ot()}Ft(["click"]);const Ug=["dracula","zombie","fairy_tale","minigames"];function Wu(){const n=Ug.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return wt.updateBucketsList(n),n}var yr=sr(()=>B),Ng=X('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),Bg=(n,e,t)=>e(h(t).name),Wg=X('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),Vg=X('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),qg=X('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function Gg(n,e){Rt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};In(()=>{r()});function r(){Wu()}async function i(f){yr(yr().selectedBucket=f),yr(yr().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await nr.loadStoriesList(),await nr.loadStoredResources()}ir();var l=qg(),u=j(E(l),2);Qe(u,5,()=>yr().availableBuckets,f=>f,(f,v)=>{const g=hi(()=>t[h(v).id]||{title:h(v),description:"Интерактивная история",icon:"📖"});var m=Vg();let w;var S=E(m),p=E(S),k=E(p),R=j(p,2),x=E(R),F=E(x),z=j(x,2),M=E(z),U=j(S,2),$=E(U);{var C=ie=>{var oe=Ng();W(ie,oe)},P=ie=>{var oe=Wg();oe.__click=[Bg,i,v],W(ie,oe)};Oe($,ie=>{yr().selectedBucket===h(v).name?ie(C):ie(P,!1)})}ke(ie=>{w=Nt(m,1,"bucket-card svelte-1cmn6ru",null,w,ie),_e(k,h(g).icon),_e(F,h(g).title),_e(M,h(g).description)},[()=>({selected:yr().selectedBucket===h(v).name})]),W(f,m)}),W(n,l),Ot()}Ft(["click"]);var zg=X("<span> </span>"),Hg=X('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Kg=X('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Yg=X('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Jg=X('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Xg(n,e){Rt(e,!0),In(async()=>{Wu(),B.availableBuckets.length>0&&!B.selectedBucket&&(B.selectedBucket=B.availableBuckets[0].name)}),li(()=>{B.selectedBucket&&(console.log(`[Editor] Bucket выбран: ${B.selectedBucket}`),nr.loadStoredResources().then(()=>{const u=`${B.selectedBucket}_story.json`;return B.currentFileName=u,Pn.loadStory(u)}).catch(u=>{console.error("[Editor] Ошибка загрузки истории:",u)}))});var t=At(),r=Ze(t);{var i=u=>{Gg(u,{})},l=u=>{var f=Jg(),v=E(f),g=E(v),m=E(g);m.__click=()=>B.selectedBucket=null;var w=j(m,2),S=E(w),p=j(g,2),k=E(p),R=E(k),x=j(k,2);{var F=G=>{var ee=zg(),L=E(ee);ke(()=>{Nt(ee,1,`status-message ${B.statusMessage.type??""}`,"svelte-1k4krym"),_e(L,B.statusMessage.text)}),W(G,ee)};Oe(x,G=>{B.statusMessage.text&&G(F)})}var z=j(x,2);z.__click=function(...G){Pn.saveCurrentStory?.apply(this,G)};var M=j(z,2);M.__click=function(...G){Pn.saveStoryCopy?.apply(this,G)};var U=j(v,2),$=E(U);ov($,{});var C=j($,2),P=E(C);{var ie=G=>{var ee=Hg(),L=E(ee),V=E(L);ke(()=>_e(V,`Загружено: ${B.data.meta?.title??""} |
              Глав: ${(B.data.chapters?.length||0)??""} |
              Диалогов: ${(B.data.dialogues?.length||0)??""} |
              Предметов: ${(B.data.items?.length||0)??""}`)),W(G,ee)},oe=G=>{var ee=Kg();W(G,ee)};Oe(P,G=>{B.data?G(ie):G(oe,!1)})}var pe=j(P,2);op(pe,{});var fe=j(pe,2);{var ce=G=>{Yv(G,{get editor(){return B},get storyActions(){return Pn},get resourceActions(){return nr}})},Y=G=>{var ee=Yg();W(G,ee)};Oe(fe,G=>{Jt.currentDialogue?G(ce):G(Y,!1)})}var K=j(C,2);$g(K,{}),ke(()=>{_e(S,`Story Editor v3.1 - ${B.selectedBucket??""}`),_e(R,B.currentFileName||"Нет файла")}),W(u,f)};Oe(r,u=>{B.selectedBucket?u(l,!1):u(i)})}W(n,t),Ot()}Ft(["click"]);var va=sr(()=>jt),Qg=(n,e,t)=>e(h(t)),Zg=(n,e,t)=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e(h(t)))},e_=X('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),t_=X('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function n_(n,e){Rt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function r(u){va(va().selectedStory=u)}ir();var i=t_(),l=j(E(i),2);Qe(l,5,()=>va().availableStories,u=>u,(u,f)=>{const v=hi(()=>t[h(f)]||{title:h(f),description:"Интерактивная история",icon:"📖"});var g=e_();g.__click=[Qg,r,f],g.__keydown=[Zg,r,f];var m=E(g),w=E(m),S=j(m,2),p=E(S),k=E(p),R=j(p,2),x=E(R);ke(()=>{_e(w,h(v).icon),_e(k,h(v).title),_e(x,h(v).description)}),W(u,g)}),W(n,i),Ot()}Ft(["click","keydown"]);function pa(n,e){ne(e,!h(e))}var r_=X('<span class="inventory-badge svelte-1nth01l"> </span>'),i_=(n=>n.stopPropagation()),s_=(n,e,t)=>e(h(t)),a_=X('<div class="item-card svelte-1nth01l"><div class="item-icon svelte-1nth01l"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-1nth01l"><span class="item-name svelte-1nth01l"> </span> <span class="item-type svelte-1nth01l"> </span></div></div>'),o_=X('<div class="items-grid svelte-1nth01l"></div>'),l_=X('<div class="empty-inventory svelte-1nth01l"><span class="empty-icon svelte-1nth01l">🎒</span> <p class="svelte-1nth01l">Инвентарь пуст</p> <p class="empty-hint svelte-1nth01l">Получайте предметы в ходе игры</p></div>'),u_=X('<div class="inventory-overlay svelte-1nth01l"><div class="inventory-modal svelte-1nth01l"><div class="inventory-header svelte-1nth01l"><h2 class="svelte-1nth01l">Инвентарь</h2> <button class="close-button svelte-1nth01l">✕</button></div> <div class="stats-section svelte-1nth01l"><h3 class="svelte-1nth01l">Характеристики</h3> <div class="stats-grid svelte-1nth01l"><div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">📚</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Знания</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">💪</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Смелость</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">✨</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Харизма</span> <span class="stat-value svelte-1nth01l"> </span></div></div></div></div> <div class="items-section svelte-1nth01l"><h3 class="svelte-1nth01l"> </h3> <!></div></div></div>'),c_=X('<div class="inventory-wrapper svelte-1nth01l"><button class="inventory-button svelte-1nth01l">🎒 <!></button> <!></div>');function d_(n,e){Rt(e,!0);let t=Re(!1);const r=Dt(()=>jt.getInventoryItems()),i=Dt(()=>jt.player.stats);function l(S){console.log("Выбран предмет:",S.name)}var u=c_(),f=E(u);f.__click=[pa,t];var v=j(E(f));{var g=S=>{var p=r_(),k=E(p);ke(()=>_e(k,h(r).length)),W(S,p)};Oe(v,S=>{h(r).length>0&&S(g)})}var m=j(f,2);{var w=S=>{var p=u_();p.__click=[pa,t];var k=E(p);k.__click=[i_];var R=E(k),x=j(E(R),2);x.__click=[pa,t];var F=j(R,2),z=j(E(F),2),M=E(z),U=j(E(M),2),$=j(E(U),2),C=E($),P=j(M,2),ie=j(E(P),2),oe=j(E(ie),2),pe=E(oe),fe=j(P,2),ce=j(E(fe),2),Y=j(E(ce),2),K=E(Y),G=j(F,2),ee=E(G),L=E(ee),V=j(ee,2);{var se=me=>{var Ee=o_();Qe(Ee,21,()=>h(r),ge=>ge.id,(ge,Me)=>{var de=a_();de.__click=[s_,l,Me];var te=E(de),Z=E(te),re=j(te,2),Te=E(re),Q=E(Te),ue=j(Te,2),be=E(ue);ke(()=>{We(Z,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${jt.selectedStory}/${h(Me).icon}`),We(Z,"alt",h(Me).icon),_e(Q,h(Me).name),_e(be,h(Me).type)}),W(ge,de)}),W(me,Ee)},le=me=>{var Ee=l_();W(me,Ee)};Oe(V,me=>{h(r).length>0?me(se):me(le,!1)})}ke(()=>{_e(C,h(i).knowledge),_e(pe,h(i).courage),_e(K,h(i).charisma),_e(L,`Предметы (${h(r).length??""})`)}),W(S,p)};Oe(m,S=>{h(t)&&S(w)})}ke(()=>We(f,"title",`Инвентарь (${h(r).length??""})`)),W(n,u),Ot()}Ft(["click"]);var f_=X('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),h_=X('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),v_=X('<div class="game-container svelte-14svm27"><!> <button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),p_=X('<div class="app svelte-14svm27"><!></div>');function g_(n,e){Rt(e,!0),li(async()=>{if(jt.selectedStory){const u=`${jt.selectedStory}_story.json`,f=`${Es}/storage/v1/object/public/${jt.selectedStory}/${u}`;console.log("Загружаем историю из:",f),await jt.loadStory(f)}});var t=p_(),r=E(t);{var i=u=>{n_(u,{})},l=u=>{var f=At(),v=Ze(f);{var g=w=>{var S=f_();W(w,S)},m=w=>{var S=At(),p=Ze(S);{var k=x=>{var F=h_(),z=E(F),M=j(z);M.__click=()=>jt.selectedStory=null,ke(()=>_e(z,`⚠️ ${jt.error??""} `)),W(x,F)},R=x=>{var F=v_(),z=E(F);d_(z,{});var M=j(z,2);M.__click=()=>jt.selectedStory=null;var U=j(M,2),$=E(U);{var C=P=>{Bu(P,{get bucketName(){return jt.selectedStory}})};Oe($,P=>{jt.storyData&&P(C)})}W(x,F)};Oe(p,x=>{jt.error?x(k):x(R,!1)},!0)}W(w,S)};Oe(v,w=>{jt.isLoading?w(g):w(m,!1)},!0)}W(u,f)};Oe(r,u=>{jt.selectedStory?u(l,!1):u(i)})}W(n,t),Ot()}Ft(["click"]);var __=X('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),m_=X('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function y_(n,e){Rt(e,!1),ir();var t=At(),r=Ze(t);{var i=u=>{var f=__(),v=Ze(f);v.__click=function(...m){wt.toggleEditor?.apply(this,m)};var g=j(v,2);Xg(g,{}),W(u,f)},l=u=>{var f=m_(),v=Ze(f);v.__click=function(...m){wt.toggleEditor?.apply(this,m)};var g=j(v,2);g_(g,{}),W(u,f)};Oe(r,u=>{B.showEditor?u(i):u(l,!1)})}W(n,t),Ot()}Ft(["click"]);jd(y_,{target:document.getElementById("app")});
