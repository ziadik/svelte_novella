(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const Rl=!1;var Mi=Array.isArray,fc=Array.prototype.indexOf,Pa=Array.from,fa=Object.defineProperty,Yn=Object.getOwnPropertyDescriptor,Ol=Object.getOwnPropertyDescriptors,hc=Object.prototype,vc=Array.prototype,Ra=Object.getPrototypeOf,Vo=Object.isExtensible;function pc(r){return r()}function gs(r){for(var e=0;e<r.length;e++)r[e]()}function gc(){var r,e,t=new Promise((n,i)=>{r=n,e=i});return{promise:t,resolve:r,reject:e}}const or=2,Oa=4,Es=8,oi=16,qr=32,In=64,Ml=128,dr=256,_s=512,Zt=1024,fr=2048,en=4096,br=8192,Sn=16384,Ma=32768,La=65536,Ho=1<<17,_c=1<<18,Li=1<<19,Ll=1<<20,ha=1<<21,Da=1<<22,bn=1<<23,Ur=Symbol("$state"),mc=Symbol("legacy props"),yc=Symbol(""),Fa=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function bc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Dl(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function wc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function kc(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ic(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Sc(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Ec(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xc(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ac(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Cc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function jc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const xs=1,As=2,Fl=4,Tc=8,Pc=16,Rc=1,Oc=2,Mc=4,Lc=8,Dc=16,Fc=1,$c=2,Yt=Symbol(),Nc="http://www.w3.org/1999/xhtml";function Uc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Bc=!1;function $l(r){return r===this.v}function Nl(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Wc(r,e){return r!==e}function Ul(r){return!Nl(r,this.v)}let li=!1,qc=!1;function Vc(){li=!0}let Wt=null;function ms(r){Wt=r}function Ft(r,e=!1,t){Wt={p:Wt,c:null,e:null,s:r,x:null,l:li&&!e?{s:null,u:null,$:[]}:null}}function $t(r){var e=Wt,t=e.e;if(t!==null){e.e=null;for(var n of t)eu(n)}return Wt=e.p,{}}function ui(){return!li||Wt!==null&&Wt.l===null}const Hc=new WeakMap;function Gc(r){var e=bt;if(e===null)return kt.f|=bn,r;if((e.f&Ma)===0){if((e.f&Ml)===0)throw!e.parent&&r instanceof Error&&Bl(r),r;e.b.error(r)}else $a(r,e)}function $a(r,e){for(;e!==null;){if((e.f&Ml)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&Bl(r),r}function Bl(r){const e=Hc.get(r);e&&(fa(r,"message",{value:e.message}),fa(r,"stack",{value:e.stack}))}let Ti=[],va=[];function Wl(){var r=Ti;Ti=[],gs(r)}function zc(){var r=va;va=[],gs(r)}function Na(r){Ti.length===0&&queueMicrotask(Wl),Ti.push(r)}function Kc(){Ti.length>0&&Wl(),va.length>0&&zc()}function Yc(){for(var r=bt.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&bc(),r}function Di(r){var e=or|fr,t=kt!==null&&(kt.f&or)!==0?kt:null;return bt===null||t!==null&&(t.f&dr)!==0?e|=dr:bt.f|=Li,{ctx:Wt,deps:null,effects:null,equals:$l,f:e,fn:r,reactions:null,rv:0,v:Yt,wv:0,parent:t??bt,ac:null}}function Jc(r,e){let t=bt;t===null&&wc();var n=t.b,i=void 0,l=ei(Yt),u=null,h=!kt;return cd(()=>{try{var v=r();u&&Promise.resolve(v).catch(()=>{})}catch(m){v=Promise.reject(m)}var y=()=>v;i=u?.then(y,y)??Promise.resolve(v),u=i;var p=Lt,b=n.pending;h&&(n.update_pending_count(1),b||p.increment());const E=(m,S=void 0)=>{u=null,b||p.activate(),S?S!==Fa&&(l.f|=bn,ti(l,S)):((l.f&bn)!==0&&(l.f^=bn),ti(l,m)),h&&(n.update_pending_count(-1),b||p.decrement()),Hl()};if(i.then(E,m=>E(null,m||"unknown")),p)return()=>{queueMicrotask(()=>p.neuter())}}),new Promise(v=>{function y(p){function b(){p===i?v(l):y(i)}p.then(b,b)}y(i)})}function Dt(r){const e=Di(r);return ou(e),e}function ci(r){const e=Di(r);return e.equals=Ul,e}function ql(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Wr(e[t])}}function Xc(r){for(var e=r.parent;e!==null;){if((e.f&or)===0)return e;e=e.parent}return null}function Ua(r){var e,t=bt;Qr(Xc(r));try{ql(r),e=du(r)}finally{Qr(t)}return e}function Vl(r){var e=Ua(r);if(r.equals(e)||(r.v=e,r.wv=uu()),!xn){var t=(Jr||(r.f&dr)!==0)&&r.deps!==null?en:Zt;ir(r,t)}}function Qc(r,e,t){const n=ui()?Di:ci;if(e.length===0){t(r.map(n));return}var i=Lt,l=bt,u=Zc(),h=Yc();Promise.all(e.map(v=>Jc(v))).then(v=>{i?.activate(),u();try{t([...r.map(n),...v])}catch(y){(l.f&Sn)===0&&$a(y,l)}i?.deactivate(),Hl()}).catch(v=>{h.error(v)})}function Zc(){var r=bt,e=kt,t=Wt,n=Lt;return function(){Qr(r),Tr(e),ms(t),n?.activate()}}function Hl(){Qr(null),Tr(null),ms(null)}const Js=new Set;let Lt=null,hs=null,Go=new Set,ys=[];function Gl(){const r=ys.shift();ys.length>0&&queueMicrotask(Gl),r()}let kn=[],Cs=null,pa=!1,vs=!1;class Qn{current=new Map;#i=new Map;#r=new Set;#e=0;#s=null;#a=!1;#t=[];#n=[];#l=[];#o=[];#u=[];#d=[];#f=[];skipped_effects=new Set;process(e){kn=[],hs=null;for(const i of e)this.#v(i);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#l,n=this.#o;this.#l=[],this.#o=[],this.#u=[],hs=Lt,Lt=null,zo(t),zo(n),Lt===null?Lt=this:Js.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const i of this.#t)Xn(i);for(const i of this.#n)Xn(i);this.#t=[],this.#n=[]}#v(e){e.f^=Zt;for(var t=e.first;t!==null;){var n=t.f,i=(n&(qr|In))!==0,l=i&&(n&Zt)!==0,u=l||(n&br)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(i)t.f^=Zt;else if((n&Oa)!==0)this.#o.push(t);else if((n&Zt)===0)if((n&Da)!==0){var h=t.b?.pending?this.#n:this.#t;h.push(t)}else Rs(t)&&((t.f&oi)!==0&&this.#u.push(t),Xn(t));var v=t.first;if(v!==null){t=v;continue}}var y=t.parent;for(t=t.next;t===null&&y!==null;)t=y.next,y=y.parent}}#c(e){for(const t of e)((t.f&fr)!==0?this.#d:this.#f).push(t),ir(t,Zt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){Lt=this}deactivate(){Lt=null,hs=null;for(const e of Go)if(Go.delete(e),e(),Lt!==null)break}neuter(){this.#a=!0}flush(){kn.length>0?zl():this.#h(),Lt===this&&(this.#e===0&&Js.delete(this),this.deactivate())}#h(){if(!this.#a)for(const e of this.#r)e();this.#r.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)ir(e,fr),Zn(e);for(const e of this.#f)ir(e,en),Zn(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#r.add(e)}settled(){return(this.#s??=gc()).promise}static ensure(){if(Lt===null){const e=Lt=new Qn;Js.add(Lt),vs||Qn.enqueue(()=>{Lt===e&&e.flush()})}return Lt}static enqueue(e){ys.length===0&&queueMicrotask(Gl),ys.unshift(e)}}function ed(r){var e=vs;vs=!0;try{for(var t;;){if(Kc(),kn.length===0&&(Lt?.flush(),kn.length===0))return Cs=null,t;zl()}}finally{vs=e}}function zl(){var r=Jn;pa=!0;try{var e=0;for(Jo(!0);kn.length>0;){var t=Qn.ensure();if(e++>1e3){var n,i;td()}t.process(kn),Xr.clear()}}finally{pa=!1,Jo(r),Cs=null}}function td(){try{Ec()}catch(r){$a(r,Cs)}}let _n=null;function zo(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(Sn|br))===0&&Rs(n)&&(_n=[],Xn(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?iu(n):n.fn=null),_n?.length>0)){Xr.clear();for(const i of _n)Xn(i);_n=[]}}_n=null}}function Zn(r){for(var e=Cs=r;e.parent!==null;){e=e.parent;var t=e.f;if(pa&&e===bt&&(t&oi)!==0)return;if((t&(In|qr))!==0){if((t&Zt)===0)return;e.f^=Zt}}kn.push(e)}const Xr=new Map;function ei(r,e){var t={f:0,v:r,reactions:null,equals:$l,rv:0,wv:0};return t}function Ne(r,e){const t=ei(r);return ou(t),t}function rd(r,e=!1,t=!0){const n=ei(r);return e||(n.equals=Ul),li&&t&&Wt!==null&&Wt.l!==null&&(Wt.l.s??=[]).push(n),n}function ie(r,e,t=!1){kt!==null&&(!Cr||(kt.f&Ho)!==0)&&ui()&&(kt.f&(or|oi|Da|Ho))!==0&&!Br?.includes(r)&&jc();let n=t?yt(e):e;return ti(r,n)}function ti(r,e){if(!r.equals(e)){var t=r.v;xn?Xr.set(r,e):Xr.set(r,t),r.v=e;var n=Qn.ensure();n.capture(r,t),(r.f&or)!==0&&((r.f&fr)!==0&&Ua(r),ir(r,(r.f&dr)===0?Zt:en)),r.wv=uu(),Kl(r,fr),ui()&&bt!==null&&(bt.f&Zt)!==0&&(bt.f&(qr|In))===0&&(cr===null?vd([r]):cr.push(r))}return e}function ri(r,e=1){var t=d(r),n=e===1?t++:t--;return ie(r,t),n}function Xs(r){ie(r,r.v+1)}function Kl(r,e){var t=r.reactions;if(t!==null)for(var n=ui(),i=t.length,l=0;l<i;l++){var u=t[l],h=u.f;if(!(!n&&u===bt)){var v=(h&fr)===0;v&&ir(u,e),(h&or)!==0?Kl(u,en):v&&((h&oi)!==0&&_n!==null&&_n.push(u),Zn(u))}}}function yt(r){if(typeof r!="object"||r===null||Ur in r)return r;const e=Ra(r);if(e!==hc&&e!==vc)return r;var t=new Map,n=Mi(r),i=Ne(0),l=wn,u=h=>{if(wn===l)return h();var v=kt,y=wn;Tr(null),Qo(l);var p=h();return Tr(v),Qo(y),p};return n&&t.set("length",Ne(r.length)),new Proxy(r,{defineProperty(h,v,y){(!("value"in y)||y.configurable===!1||y.enumerable===!1||y.writable===!1)&&Ac();var p=t.get(v);return p===void 0?p=u(()=>{var b=Ne(y.value);return t.set(v,b),b}):ie(p,y.value,!0),!0},deleteProperty(h,v){var y=t.get(v);if(y===void 0){if(v in h){const p=u(()=>Ne(Yt));t.set(v,p),Xs(i)}}else ie(y,Yt),Xs(i);return!0},get(h,v,y){if(v===Ur)return r;var p=t.get(v),b=v in h;if(p===void 0&&(!b||Yn(h,v)?.writable)&&(p=u(()=>{var m=yt(b?h[v]:Yt),S=Ne(m);return S}),t.set(v,p)),p!==void 0){var E=d(p);return E===Yt?void 0:E}return Reflect.get(h,v,y)},getOwnPropertyDescriptor(h,v){var y=Reflect.getOwnPropertyDescriptor(h,v);if(y&&"value"in y){var p=t.get(v);p&&(y.value=d(p))}else if(y===void 0){var b=t.get(v),E=b?.v;if(b!==void 0&&E!==Yt)return{enumerable:!0,configurable:!0,value:E,writable:!0}}return y},has(h,v){if(v===Ur)return!0;var y=t.get(v),p=y!==void 0&&y.v!==Yt||Reflect.has(h,v);if(y!==void 0||bt!==null&&(!p||Yn(h,v)?.writable)){y===void 0&&(y=u(()=>{var E=p?yt(h[v]):Yt,m=Ne(E);return m}),t.set(v,y));var b=d(y);if(b===Yt)return!1}return p},set(h,v,y,p){var b=t.get(v),E=v in h;if(n&&v==="length")for(var m=y;m<b.v;m+=1){var S=t.get(m+"");S!==void 0?ie(S,Yt):m in h&&(S=u(()=>Ne(Yt)),t.set(m+"",S))}if(b===void 0)(!E||Yn(h,v)?.writable)&&(b=u(()=>Ne(void 0)),ie(b,yt(y)),t.set(v,b));else{E=b.v!==Yt;var N=u(()=>yt(y));ie(b,N)}var P=Reflect.getOwnPropertyDescriptor(h,v);if(P?.set&&P.set.call(p,y),!E){if(n&&typeof v=="string"){var U=t.get("length"),G=Number(v);Number.isInteger(G)&&G>=U.v&&ie(U,G+1)}Xs(i)}return!0},ownKeys(h){d(i);var v=Reflect.ownKeys(h).filter(b=>{var E=t.get(b);return E===void 0||E.v!==Yt});for(var[y,p]of t)p.v!==Yt&&!(y in h)&&v.push(y);return v},setPrototypeOf(){Cc()}})}function Ko(r){try{if(r!==null&&typeof r=="object"&&Ur in r)return r[Ur]}catch{}return r}function nd(r,e){return Object.is(Ko(r),Ko(e))}var bs,Yl,Jl,Xl;function id(){if(bs===void 0){bs=window,Yl=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Jl=Yn(e,"firstChild").get,Xl=Yn(e,"nextSibling").get,Vo(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Vo(t)&&(t.__t=void 0)}}function En(r=""){return document.createTextNode(r)}function ni(r){return Jl.call(r)}function js(r){return Xl.call(r)}function w(r,e){return ni(r)}function nt(r,e){{var t=ni(r);return t instanceof Comment&&t.data===""?js(t):t}}function A(r,e=1,t=!1){let n=r;for(;e--;)n=js(n);return n}function sd(r){r.textContent=""}function Ba(){return!1}let Yo=!1;function ad(){Yo||(Yo=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function Ts(r){var e=kt,t=bt;Tr(null),Qr(null);try{return r()}finally{Tr(e),Qr(t)}}function Wa(r,e,t,n=t){r.addEventListener(e,()=>Ts(t));const i=r.__on_r;i?r.__on_r=()=>{i(),n(!0)}:r.__on_r=()=>n(!0),ad()}function Ql(r){bt===null&&kt===null&&Sc(),kt!==null&&(kt.f&dr)!==0&&bt===null&&Ic(),xn&&kc()}function od(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Pr(r,e,t,n=!0){var i=bt;i!==null&&(i.f&br)!==0&&(r|=br);var l={ctx:Wt,deps:null,nodes_start:null,nodes_end:null,f:r|fr,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Xn(l),l.f|=Ma}catch(v){throw Wr(l),v}else e!==null&&Zn(l);if(n){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Li)===0&&(u=u.first),u!==null&&(u.parent=i,i!==null&&od(u,i),kt!==null&&(kt.f&or)!==0&&(r&In)===0)){var h=kt;(h.effects??=[]).push(u)}}return l}function Zl(r){const e=Pr(Es,null,!1);return ir(e,Zt),e.teardown=r,e}function ii(r){Ql();var e=bt.f,t=!kt&&(e&qr)!==0&&(e&Ma)===0;if(t){var n=Wt;(n.e??=[]).push(r)}else return eu(r)}function eu(r){return Pr(Oa|Ll,r,!1)}function ld(r){return Ql(),Pr(Es|Ll,r,!0)}function ud(r){Qn.ensure();const e=Pr(In|Li,r,!0);return(t={})=>new Promise(n=>{t.outro?Ps(e,()=>{Wr(e),n(void 0)}):(Wr(e),n(void 0))})}function tu(r){return Pr(Oa,r,!1)}function cd(r){return Pr(Da|Li,r,!0)}function qa(r,e=0){return Pr(Es|e,r,!0)}function de(r,e=[],t=[]){Qc(e,t,n=>{Pr(Es,()=>r(...n.map(d)),!0)})}function Va(r,e=0){var t=Pr(oi|e,r,!0);return t}function si(r,e=!0){return Pr(qr|Li,r,!0,e)}function ru(r){var e=r.teardown;if(e!==null){const t=xn,n=kt;Xo(!0),Tr(null);try{e.call(null)}finally{Xo(t),Tr(n)}}}function nu(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const i=t.ac;i!==null&&Ts(()=>{i.abort(Fa)});var n=t.next;(t.f&In)!==0?t.parent=null:Wr(t,e),t=n}}function dd(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&qr)===0&&Wr(e),e=t}}function Wr(r,e=!0){var t=!1;(e||(r.f&_c)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(fd(r.nodes_start,r.nodes_end),t=!0),nu(r,e&&!t),ws(r,0),ir(r,Sn);var n=r.transitions;if(n!==null)for(const l of n)l.stop();ru(r);var i=r.parent;i!==null&&i.first!==null&&iu(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function fd(r,e){for(;r!==null;){var t=r===e?null:js(r);r.remove(),r=t}}function iu(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Ps(r,e){var t=[];Ha(r,t,!0),su(t,()=>{Wr(r),e&&e()})}function su(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var i of r)i.out(n)}else e()}function Ha(r,e,t){if((r.f&br)===0){if(r.f^=br,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var n=r.first;n!==null;){var i=n.next,l=(n.f&La)!==0||(n.f&qr)!==0;Ha(n,e,l?t:!1),n=i}}}function Ga(r){au(r,!0)}function au(r,e){if((r.f&br)!==0){r.f^=br,(r.f&Zt)===0&&(ir(r,fr),Zn(r));for(var t=r.first;t!==null;){var n=t.next,i=(t.f&La)!==0||(t.f&qr)!==0;au(t,i?e:!1),t=n}if(r.transitions!==null)for(const l of r.transitions)(l.is_global||e)&&l.in()}}let Hn=null;function hd(r){var e=Hn;try{if(Hn=new Set,An(r),e!==null)for(var t of Hn)e.add(t);return Hn}finally{Hn=e}}function mr(r){for(var e of hd(r))ti(e,e.v)}let Jn=!1;function Jo(r){Jn=r}let xn=!1;function Xo(r){xn=r}let kt=null,Cr=!1;function Tr(r){kt=r}let bt=null;function Qr(r){bt=r}let Br=null;function ou(r){kt!==null&&(Br===null?Br=[r]:Br.push(r))}let tr=null,ar=0,cr=null;function vd(r){cr=r}let lu=1,Pi=0,wn=Pi;function Qo(r){wn=r}let Jr=!1;function uu(){return++lu}function Rs(r){var e=r.f;if((e&fr)!==0)return!0;if((e&en)!==0){var t=r.deps,n=(e&dr)!==0;if(t!==null){var i,l,u=(e&_s)!==0,h=n&&bt!==null&&!Jr,v=t.length;if((u||h)&&(bt===null||(bt.f&Sn)===0)){var y=r,p=y.parent;for(i=0;i<v;i++)l=t[i],(u||!l?.reactions?.includes(y))&&(l.reactions??=[]).push(y);u&&(y.f^=_s),h&&p!==null&&(p.f&dr)===0&&(y.f^=dr)}for(i=0;i<v;i++)if(l=t[i],Rs(l)&&Vl(l),l.wv>r.wv)return!0}(!n||bt!==null&&!Jr)&&ir(r,Zt)}return!1}function cu(r,e,t=!0){var n=r.reactions;if(n!==null&&!Br?.includes(r))for(var i=0;i<n.length;i++){var l=n[i];(l.f&or)!==0?cu(l,e,!1):e===l&&(t?ir(l,fr):(l.f&Zt)!==0&&ir(l,en),Zn(l))}}function du(r){var e=tr,t=ar,n=cr,i=kt,l=Jr,u=Br,h=Wt,v=Cr,y=wn,p=r.f;tr=null,ar=0,cr=null,Jr=(p&dr)!==0&&(Cr||!Jn||kt===null),kt=(p&(qr|In))===0?r:null,Br=null,ms(r.ctx),Cr=!1,wn=++Pi,r.ac!==null&&(Ts(()=>{r.ac.abort(Fa)}),r.ac=null);try{r.f|=ha;var b=r.fn,E=b(),m=r.deps;if(tr!==null){var S;if(ws(r,ar),m!==null&&ar>0)for(m.length=ar+tr.length,S=0;S<tr.length;S++)m[ar+S]=tr[S];else r.deps=m=tr;if(!Jr||(p&or)!==0&&r.reactions!==null)for(S=ar;S<m.length;S++)(m[S].reactions??=[]).push(r)}else m!==null&&ar<m.length&&(ws(r,ar),m.length=ar);if(ui()&&cr!==null&&!Cr&&m!==null&&(r.f&(or|en|fr))===0)for(S=0;S<cr.length;S++)cu(cr[S],r);return i!==null&&i!==r&&(Pi++,cr!==null&&(n===null?n=cr:n.push(...cr))),(r.f&bn)!==0&&(r.f^=bn),E}catch(N){return Gc(N)}finally{r.f^=ha,tr=e,ar=t,cr=n,kt=i,Jr=l,Br=u,ms(h),Cr=v,wn=y}}function pd(r,e){let t=e.reactions;if(t!==null){var n=fc.call(t,r);if(n!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[n]=t[i],t.pop())}}t===null&&(e.f&or)!==0&&(tr===null||!tr.includes(e))&&(ir(e,en),(e.f&(dr|_s))===0&&(e.f^=_s),ql(e),ws(e,0))}function ws(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)pd(r,t[n])}function Xn(r){var e=r.f;if((e&Sn)===0){ir(r,Zt);var t=bt,n=Jn;bt=r,Jn=!0;try{(e&oi)!==0?dd(r):nu(r),ru(r);var i=du(r);r.teardown=typeof i=="function"?i:null,r.wv=lu;var l;Rl&&qc&&(r.f&fr)!==0&&r.deps}finally{Jn=n,bt=t}}}async function fu(){await Promise.resolve(),ed()}function d(r){var e=r.f,t=(e&or)!==0;if(Hn?.add(r),kt!==null&&!Cr){var n=bt!==null&&(bt.f&Sn)!==0;if(!n&&!Br?.includes(r)){var i=kt.deps;if((kt.f&ha)!==0)r.rv<Pi&&(r.rv=Pi,tr===null&&i!==null&&i[ar]===r?ar++:tr===null?tr=[r]:(!Jr||!tr.includes(r))&&tr.push(r));else{(kt.deps??=[]).push(r);var l=r.reactions;l===null?r.reactions=[kt]:l.includes(kt)||l.push(kt)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&dr)===0&&(u.f^=dr)}if(xn){if(Xr.has(r))return Xr.get(r);if(t){u=r;var v=u.v;return((u.f&Zt)===0&&u.reactions!==null||hu(u))&&(v=Ua(u)),Xr.set(u,v),v}}else t&&(u=r,Rs(u)&&Vl(u));if((r.f&bn)!==0)throw r.v;return r.v}function hu(r){if(r.v===Yt)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(Xr.has(e)||(e.f&or)!==0&&hu(e))return!0;return!1}function An(r){var e=Cr;try{return Cr=!0,r()}finally{Cr=e}}const gd=-7169;function ir(r,e){r.f=r.f&gd|e}function _d(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Ur in r)ga(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Ur in t&&ga(t)}}}function ga(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{ga(r[n],e)}catch{}const t=Ra(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Ol(t);for(let i in n){const l=n[i].get;if(l)try{l.call(r)}catch{}}}}}const md=["touchstart","touchmove"];function yd(r){return md.includes(r)}const vu=new Set,_a=new Set;function bd(r,e,t,n={}){function i(l){if(n.capture||Ii.call(e,l),!l.cancelBubble)return Ts(()=>t?.call(this,l))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Na(()=>{e.addEventListener(r,i,n)}):e.addEventListener(r,i,n),i}function pu(r,e,t,n,i){var l={capture:n,passive:i},u=bd(r,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Zl(()=>{e.removeEventListener(r,u,l)})}function Bt(r){for(var e=0;e<r.length;e++)vu.add(r[e]);for(var t of _a)t(r)}let Zo=null;function Ii(r){var e=this,t=e.ownerDocument,n=r.type,i=r.composedPath?.()||[],l=i[0]||r.target;Zo=r;var u=0,h=Zo===r&&r.__root;if(h){var v=i.indexOf(h);if(v!==-1&&(e===document||e===window)){r.__root=e;return}var y=i.indexOf(e);if(y===-1)return;v<=y&&(u=v)}if(l=i[u]||r.target,l!==e){fa(r,"currentTarget",{configurable:!0,get(){return l||t}});var p=kt,b=bt;Tr(null),Qr(null);try{for(var E,m=[];l!==null;){var S=l.assignedSlot||l.parentNode||l.host||null;try{var N=l["__"+n];if(N!=null&&(!l.disabled||r.target===l))if(Mi(N)){var[P,...U]=N;P.apply(l,[r,...U])}else N.call(l,r)}catch(G){E?m.push(G):E=G}if(r.cancelBubble||S===e||S===null)break;l=S}if(E){for(let G of m)queueMicrotask(()=>{throw G});throw E}}finally{r.__root=e,delete r.currentTarget,Tr(p),Qr(b)}}}function gu(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function Ri(r,e){var t=bt;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function X(r,e){var t=(e&Fc)!==0,n=(e&$c)!==0,i,l=!r.startsWith("<!>");return()=>{i===void 0&&(i=gu(l?r:"<!>"+r),t||(i=ni(i)));var u=n||Yl?document.importNode(i,!0):i.cloneNode(!0);if(t){var h=ni(u),v=u.lastChild;Ri(h,v)}else Ri(u,u);return u}}function wd(r,e,t="svg"){var n=!r.startsWith("<!>"),i=`<${t}>${n?r:"<!>"+r}</${t}>`,l;return()=>{if(!l){var u=gu(i),h=ni(u);l=ni(h)}var v=l.cloneNode(!0);return Ri(v,v),v}}function kd(r,e){return wd(r,e,"svg")}function Si(r=""){{var e=En(r+"");return Ri(e,e),e}}function xt(){var r=document.createDocumentFragment(),e=document.createComment(""),t=En();return r.append(e,t),Ri(e,t),r}function L(r,e){r!==null&&r.before(e)}function fe(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function Id(r,e){return Sd(r,e)}const Mn=new Map;function Sd(r,{target:e,anchor:t,props:n={},events:i,context:l,intro:u=!0}){id();var h=new Set,v=b=>{for(var E=0;E<b.length;E++){var m=b[E];if(!h.has(m)){h.add(m);var S=yd(m);e.addEventListener(m,Ii,{passive:S});var N=Mn.get(m);N===void 0?(document.addEventListener(m,Ii,{passive:S}),Mn.set(m,1)):Mn.set(m,N+1)}}};v(Pa(vu)),_a.add(v);var y=void 0,p=ud(()=>{var b=t??e.appendChild(En());return si(()=>{if(l){Ft({});var E=Wt;E.c=l}i&&(n.$$events=i),y=r(b,n)||{},l&&$t()}),()=>{for(var E of h){e.removeEventListener(E,Ii);var m=Mn.get(E);--m===0?(document.removeEventListener(E,Ii),Mn.delete(E)):Mn.set(E,m)}_a.delete(v),b!==t&&b.parentNode?.removeChild(b)}});return Ed.set(y,p),y}let Ed=new WeakMap;function _e(r,e,t=!1){var n=r,i=null,l=null,u=Yt,h=t?La:0,v=!1;const y=(m,S=!0)=>{v=!0,E(S,m)};var p=null;function b(){p!==null&&(p.lastChild.remove(),n.before(p),p=null);var m=u?i:l,S=u?l:i;m&&Ga(m),S&&Ps(S,()=>{u?l=null:i=null})}const E=(m,S)=>{if(u!==(u=m)){var N=Ba(),P=n;if(N&&(p=document.createDocumentFragment(),p.append(P=En())),u?i??=S&&si(()=>S(P)):l??=S&&si(()=>S(P)),N){var U=Lt,G=u?i:l,D=u?l:i;G&&U.skipped_effects.delete(G),D&&U.skipped_effects.add(D),U.add_callback(b)}else b()}};Va(()=>{v=!1,e(y),v||E(null,null)},h)}function ma(r,e,t){var n=r,i=Yt,l,u,h=null,v=ui()?Wc:Nl;function y(){l&&Ps(l),h!==null&&(h.lastChild.remove(),n.before(h),h=null),l=u}Va(()=>{if(v(i,i=e())){var p=n,b=Ba();b&&(h=document.createDocumentFragment(),h.append(p=En())),u=si(()=>t(p)),b?Lt.add_callback(y):y()}})}function Nt(r,e){return e}function xd(r,e,t){for(var n=r.items,i=[],l=e.length,u=0;u<l;u++)Ha(e[u].e,i,!0);var h=l>0&&i.length===0&&t!==null;if(h){var v=t.parentNode;sd(v),v.append(t),n.clear(),Er(r,e[0].prev,e[l-1].next)}su(i,()=>{for(var y=0;y<l;y++){var p=e[y];h||(n.delete(p.k),Er(r,p.prev,p.next)),Wr(p.e,!h)}})}function et(r,e,t,n,i,l=null){var u=r,h={flags:e,items:new Map,first:null},v=(e&Fl)!==0;if(v){var y=r;u=y.appendChild(En())}var p=null,b=!1,E=new Map,m=ci(()=>{var U=t();return Mi(U)?U:U==null?[]:Pa(U)}),S,N;function P(){Ad(N,S,h,E,u,i,e,n,t),l!==null&&(S.length===0?p?Ga(p):p=si(()=>l(u)):p!==null&&Ps(p,()=>{p=null}))}Va(()=>{N??=bt,S=d(m);var U=S.length;if(!(b&&U===0)){b=U===0;var G,D,Z,ae;if(Ba()){var $=new Set,B=Lt;for(D=0;D<U;D+=1){Z=S[D],ae=n(Z,D);var he=h.items.get(ae)??E.get(ae);he?(e&(xs|As))!==0&&_u(he,Z,D,e):(G=mu(null,h,null,null,Z,ae,D,i,e,t,!0),E.set(ae,G)),$.add(ae)}for(const[le,Se]of h.items)$.has(le)||B.skipped_effects.add(Se.e);B.add_callback(P)}else P();d(m)}})}function Ad(r,e,t,n,i,l,u,h,v){var y=(u&Tc)!==0,p=(u&(xs|As))!==0,b=e.length,E=t.items,m=t.first,S=m,N,P=null,U,G=[],D=[],Z,ae,$,B;if(y)for(B=0;B<b;B+=1)Z=e[B],ae=h(Z,B),$=E.get(ae),$!==void 0&&($.a?.measure(),(U??=new Set).add($));for(B=0;B<b;B+=1){if(Z=e[B],ae=h(Z,B),$=E.get(ae),$===void 0){var he=n.get(ae);if(he!==void 0){n.delete(ae),E.set(ae,he);var le=P?P.next:S;Er(t,P,he),Er(t,he,le),Qs(he,le,i),P=he}else{var Se=S?S.e.nodes_start:i;P=mu(Se,t,P,P===null?t.first:P.next,Z,ae,B,l,u,v)}E.set(ae,P),G=[],D=[],S=P.next;continue}if(p&&_u($,Z,B,u),($.e.f&br)!==0&&(Ga($.e),y&&($.a?.unfix(),(U??=new Set).delete($))),$!==S){if(N!==void 0&&N.has($)){if(G.length<D.length){var be=D[0],oe;P=be.prev;var Ce=G[0],Ue=G[G.length-1];for(oe=0;oe<G.length;oe+=1)Qs(G[oe],be,i);for(oe=0;oe<D.length;oe+=1)N.delete(D[oe]);Er(t,Ce.prev,Ue.next),Er(t,P,Ce),Er(t,Ue,be),S=be,P=Ue,B-=1,G=[],D=[]}else N.delete($),Qs($,S,i),Er(t,$.prev,$.next),Er(t,$,P===null?t.first:P.next),Er(t,P,$),P=$;continue}for(G=[],D=[];S!==null&&S.k!==ae;)(S.e.f&br)===0&&(N??=new Set).add(S),D.push(S),S=S.next;if(S===null)continue;$=S}G.push($),P=$,S=$.next}if(S!==null||N!==void 0){for(var we=N===void 0?[]:Pa(N);S!==null;)(S.e.f&br)===0&&we.push(S),S=S.next;var $e=we.length;if($e>0){var me=(u&Fl)!==0&&b===0?i:null;if(y){for(B=0;B<$e;B+=1)we[B].a?.measure();for(B=0;B<$e;B+=1)we[B].a?.fix()}xd(t,we,me)}}y&&Na(()=>{if(U!==void 0)for($ of U)$.a?.apply()}),r.first=t.first&&t.first.e,r.last=P&&P.e;for(var Ye of n.values())Wr(Ye.e);n.clear()}function _u(r,e,t,n){(n&xs)!==0&&ti(r.v,e),(n&As)!==0?ti(r.i,t):r.i=t}function mu(r,e,t,n,i,l,u,h,v,y,p){var b=(v&xs)!==0,E=(v&Pc)===0,m=b?E?rd(i,!1,!1):ei(i):i,S=(v&As)===0?u:ei(u),N={i:S,v:m,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var P=document.createDocumentFragment();P.append(r=En())}return N.e=si(()=>h(r,m,S,y),Bc),N.e.prev=t&&t.e,N.e.next=n&&n.e,t===null?p||(e.first=N):(t.next=N,t.e.next=N.e),n!==null&&(n.prev=N,n.e.prev=N.e),N}finally{}}function Qs(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var u=js(l);i.before(l),l=u}}function Er(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const el=[...` 	
\r\f \v\uFEFF`];function Cd(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var i in t)if(t[i])n=n?n+" "+i:i;else if(n.length)for(var l=i.length,u=0;(u=n.indexOf(i,u))>=0;){var h=u+l;(u===0||el.includes(n[u-1]))&&(h===n.length||el.includes(n[h]))?n=(u===0?"":n.substring(0,u))+n.substring(h+1):u=h}}return n===""?null:n}function jd(r,e){return r==null?null:String(r)}function It(r,e,t,n,i,l){var u=r.__className;if(u!==t||u===void 0){var h=Cd(t,n,l);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(l&&i!==l)for(var v in l){var y=!!l[v];(i==null||y!==!!i[v])&&r.classList.toggle(v,y)}return l}function jr(r,e,t,n){var i=r.__style;if(i!==e){var l=jd(e);l==null?r.removeAttribute("style"):r.style.cssText=l,r.__style=e}return n}function Kr(r,e,t=!1){if(r.multiple){if(e==null)return;if(!Mi(e))return Uc();for(var n of r.options)n.selected=e.includes(xi(n));return}for(n of r.options){var i=xi(n);if(nd(i,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function pn(r){var e=new MutationObserver(()=>{Kr(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Zl(()=>{e.disconnect()})}function Kn(r,e,t=e){var n=!0;Wa(r,"change",i=>{var l=i?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(l),xi);else{var h=r.querySelector(l)??r.querySelector("option:not([disabled])");u=h&&xi(h)}t(u)}),tu(()=>{var i=e();if(Kr(r,i,n),n&&i===void 0){var l=r.querySelector(":checked");l!==null&&(i=xi(l),t(i))}r.__value=i,n=!1}),pn(r)}function xi(r){return"__value"in r?r.__value:r.value}const Td=Symbol("is custom element"),Pd=Symbol("is html");function Zs(r,e){var t=za(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Rd(r,e){var t=za(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Ve(r,e,t,n){var i=za(r);i[e]!==(i[e]=t)&&(e==="loading"&&(r[yc]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Od(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function za(r){return r.__attributes??={[Td]:r.nodeName.includes("-"),[Pd]:r.namespaceURI===Nc}}var tl=new Map;function Od(r){var e=r.getAttribute("is")||r.nodeName,t=tl.get(e);if(t)return t;tl.set(e,t=[]);for(var n,i=r,l=Element.prototype;l!==i;){n=Ol(i);for(var u in n)n[u].set&&t.push(u);i=Ra(i)}return t}function Nr(r,e,t=e){var n=new WeakSet;Wa(r,"input",async i=>{var l=i?r.defaultValue:r.value;if(l=ea(r)?ta(l):l,t(l),Lt!==null&&n.add(Lt),await fu(),l!==(l=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=l??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),An(e)==null&&r.value&&(t(ea(r)?ta(r.value):r.value),Lt!==null&&n.add(Lt)),qa(()=>{var i=e();if(r===document.activeElement){var l=hs??Lt;if(n.has(l))return}ea(r)&&i===ta(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function rl(r,e,t=e){Wa(r,"change",n=>{var i=n?r.defaultChecked:r.checked;t(i)}),An(e)==null&&t(r.checked),qa(()=>{var n=e();r.checked=!!n})}function ea(r){var e=r.type;return e==="number"||e==="range"}function ta(r){return r===""?null:+r}function nl(r,e){return r===e||r?.[Ur]===e}function ya(r={},e,t,n){return tu(()=>{var i,l;return qa(()=>{i=l,l=[],An(()=>{r!==t(...l)&&(e(r,...l),i&&nl(t(...i),r)&&e(null,...i))})}),()=>{Na(()=>{l&&nl(t(...l),r)&&e(null,...l)})}}),r}function tn(r=!1){const e=Wt,t=e.l.u;if(!t)return;let n=()=>_d(e.s);if(r){let i=0,l={};const u=Di(()=>{let h=!1;const v=e.s;for(const y in v)v[y]!==l[y]&&(l[y]=v[y],h=!0);return h&&i++,i});n=()=>d(u)}t.b.length&&ld(()=>{il(e,n),gs(t.b)}),ii(()=>{const i=An(()=>t.m.map(pc));return()=>{for(const l of i)typeof l=="function"&&l()}}),t.a.length&&ii(()=>{il(e,n),gs(t.a)})}function il(r,e){if(r.l.s)for(const t of r.l.s)d(t);e()}function rn(r){var e=ei(0);return function(){return arguments.length===1?(ie(e,d(e)+1),arguments[0]):(d(e),r())}}let os=!1;function Md(r){var e=os;try{return os=!1,[r(),os]}finally{os=e}}function pt(r,e,t,n){var i=!li||(t&Oc)!==0,l=(t&Lc)!==0,u=(t&Dc)!==0,h=n,v=!0,y=()=>(v&&(v=!1,h=u?An(n):n),h),p;if(l){var b=Ur in r||mc in r;p=Yn(r,e)?.set??(b&&e in r?D=>r[e]=D:void 0)}var E,m=!1;l?[E,m]=Md(()=>r[e]):E=r[e],E===void 0&&n!==void 0&&(E=y(),p&&(i&&xc(),p(E)));var S;if(i?S=()=>{var D=r[e];return D===void 0?y():(v=!0,D)}:S=()=>{var D=r[e];return D!==void 0&&(h=void 0),D===void 0?h:D},i&&(t&Mc)===0)return S;if(p){var N=r.$$legacy;return(function(D,Z){return arguments.length>0?((!i||!Z||N||m)&&p(Z?S():D),D):S()})}var P=!1,U=((t&Rc)!==0?Di:ci)(()=>(P=!1,S()));l&&d(U);var G=bt;return(function(D,Z){if(arguments.length>0){const ae=Z?d(U):i&&l?yt(D):D;return ie(U,ae),P=!0,h!==void 0&&(h=ae),D}return xn&&P||(G.f&Sn)!==0?U.v:d(U)})}function wr(r){Wt===null&&Dl(),li&&Wt.l!==null?Dd(Wt).m.push(r):ii(()=>{const e=An(r);if(typeof e=="function")return e})}function Ld(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}function nn(){const r=Wt;return r===null&&Dl(),(e,t,n)=>{const i=r.s.$$events?.[e];if(i){const l=Mi(i)?i.slice():[i],u=Ld(e,t,n);for(const h of l)h.call(r.x,u);return!u.defaultPrevented}return!0}}function Dd(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Fd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Fd);Vc();const V=yt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Jt={get currentDialogue(){return V.data?.dialogues.find(r=>r.id===V.selectedDialogueId)},get currentChapter(){return V.data?.chapters?.find(r=>r.id===V.selectedChapterId)},get currentEditingChapter(){return V.data?.chapters?.find(r=>r.id===V.editingChapterId)},get currentEditingOption(){return Jt.currentDialogue&&V.editingOptionIndex!==null?Jt.currentDialogue.options?.[V.editingOptionIndex]:void 0},get chapterDialogues(){return!V.data?.dialogues||!V.selectedChapterId?[]:V.data.dialogues.filter(r=>r.chapterId===V.selectedChapterId)},get imageResources(){return V.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return V.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return V.data?.items||[]},get backlinks(){return!V.data||!V.selectedDialogueId?[]:V.data.dialogues.filter(r=>r.nextDialogueId===V.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===V.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},Et={toggleEditor(){V.showEditor=!V.showEditor},toggleItemsPanel(){V.showItems=!V.showItems},setStatus(r,e){V.statusMessage={type:r,text:e}},clearStatus(){V.statusMessage={type:"",text:""}},selectBucket(r){V.selectedBucket=r,V.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},V.storedFiles=[],V.storiesList=[],V.selectedChapterId=null,V.selectedDialogueId=null},updateBucketsList(r){V.availableBuckets=r},selectChapter(r){V.selectedChapterId=r,V.selectedDialogueId=null},selectDialogue(r){V.selectedDialogueId=r},selectOption(r){V.editingOptionIndex=r},selectItem(r){V.editingItemIndex=r},updateStoryData(r){V.data=r},updateStoredFiles(r){V.storedFiles=r},updateStoriesList(r){V.storiesList=r},setCurrentFileName(r){V.currentFileName=r},addDialogue(r){V.data.dialogues=[...V.data.dialogues,r]},updateDialogue(r,e){V.data.dialogues=V.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){V.data.dialogues=V.data.dialogues.filter(e=>e.id!==r),V.selectedDialogueId===r&&(V.selectedDialogueId=null)},addChapter(r){V.data.chapters=[...V.data.chapters,r]},updateChapter(r,e){V.data.chapters=V.data.chapters.map(t=>t.id===r?{...t,...e}:t)},selectEditingChapter(r){V.editingChapterId=r},deleteChapter(r){V.data.chapters=V.data.chapters.filter(e=>e.id!==r),V.selectedChapterId===r&&(V.selectedChapterId=null,V.selectedDialogueId=null)},addItem(r){V.data.items=[...V.data.items||[],r]},updateItem(r,e){V.data.items&&(V.data.items=V.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){V.data.items&&(V.data.items=V.data.items.filter(e=>e.id!==r))},reset(){V.showEditor=!1,V.showItems=!1,V.editingOptionIndex=null,V.editingItemIndex=null,V.selectedChapterId=null,V.selectedDialogueId=null,V.statusMessage={type:"",text:""}}},$d="modulepreload",Nd=function(r,e){return new URL(r,e).href},sl={},Fi=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let y=function(p){return Promise.all(p.map(b=>Promise.resolve(b).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),v=h?.nonce||h?.getAttribute("nonce");i=y(t.map(p=>{if(p=Nd(p,n),p in sl)return;sl[p]=!0;const b=p.endsWith(".css"),E=b?'[rel="stylesheet"]':"";if(!!n)for(let N=u.length-1;N>=0;N--){const P=u[N];if(P.href===p&&(!b||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${E}`))return;const S=document.createElement("link");if(S.rel=b?"stylesheet":$d,b||(S.as="script"),S.crossOrigin="",S.href=p,v&&S.setAttribute("nonce",v),document.head.appendChild(S),b)return new Promise((N,P)=>{S.addEventListener("load",N),S.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${p}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Ud=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Fi(async()=>{const{default:n}=await Promise.resolve().then(()=>di);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Ka extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class Bd extends Ka{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class al extends Ka{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ol extends Ka{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ba;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(ba||(ba={}));var Wd=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};class qd{constructor(e,{headers:t={},customFetch:n,region:i=ba.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Ud(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Wd(this,void 0,void 0,function*(){try{const{headers:i,method:l,body:u}=t;let h={},{region:v}=t;v||(v=this.region);const y=new URL(`${this.url}/${e}`);v&&v!=="any"&&(h["x-region"]=v,y.searchParams.set("forceFunctionRegion",v));let p;u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",p=u):typeof u=="string"?(h["Content-Type"]="text/plain",p=u):typeof FormData<"u"&&u instanceof FormData?p=u:(h["Content-Type"]="application/json",p=JSON.stringify(u)));const b=yield this.fetch(y.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),i),body:p}).catch(N=>{throw new Bd(N)}),E=b.headers.get("x-relay-error");if(E&&E==="true")throw new al(b);if(!b.ok)throw new ol(b);let m=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),S;return m==="application/json"?S=yield b.json():m==="application/octet-stream"?S=yield b.blob():m==="text/event-stream"?S=b:m==="multipart/form-data"?S=yield b.formData():S=yield b.text(),{data:S,error:null,response:b}}catch(i){return{data:null,error:i,response:i instanceof ol||i instanceof al?i.context:void 0}}})}}function Vd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Hd(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Kt={},Ln={},Dn={},Fn={},$n={},Nn={},Gd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ai=Gd();const zd=ai.fetch,yu=ai.fetch.bind(ai),bu=ai.Headers,Kd=ai.Request,Yd=ai.Response,di=Object.freeze(Object.defineProperty({__proto__:null,Headers:bu,Request:Kd,Response:Yd,default:yu,fetch:zd},Symbol.toStringTag,{value:"Module"})),Jd=Hd(di);var ls={},ll;function wu(){if(ll)return ls;ll=1,Object.defineProperty(ls,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return ls.default=r,ls}var ul;function ku(){if(ul)return Nn;ul=1;var r=Nn&&Nn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Nn,"__esModule",{value:!0});const e=r(Jd),t=r(wu());class n{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let v=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async y=>{var p,b,E,m;let S=null,N=null,P=null,U=y.status,G=y.statusText;if(y.ok){if(this.method!=="HEAD"){const $=await y.text();$===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((p=this.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?N=$:N=JSON.parse($))}const Z=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),ae=(E=y.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");Z&&ae&&ae.length>1&&(P=parseInt(ae[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(N)&&(N.length>1?(S={code:"PGRST116",details:`Results contain ${N.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},N=null,P=null,U=406,G="Not Acceptable"):N.length===1?N=N[0]:N=null)}else{const Z=await y.text();try{S=JSON.parse(Z),Array.isArray(S)&&y.status===404&&(N=[],S=null,U=200,G="OK")}catch{y.status===404&&Z===""?(U=204,G="No Content"):S={message:Z}}if(S&&this.isMaybeSingle&&(!((m=S?.details)===null||m===void 0)&&m.includes("0 rows"))&&(S=null,U=200,G="OK"),S&&this.shouldThrowOnError)throw new t.default(S)}return{error:S,data:N,count:P,status:U,statusText:G}});return this.shouldThrowOnError||(v=v.catch(y=>{var p,b,E;return{error:{message:`${(p=y?.name)!==null&&p!==void 0?p:"FetchError"}: ${y?.message}`,details:`${(b=y?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(E=y?.code)!==null&&E!==void 0?E:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,u)}returns(){return this}overrideTypes(){return this}}return Nn.default=n,Nn}var cl;function Iu(){if(cl)return $n;cl=1;var r=$n&&$n.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($n,"__esModule",{value:!0});const e=r(ku());class t extends e.default{select(i){let l=!1;const u=(i??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:v=h}={}){const y=v?`${v}.order`:"order",p=this.url.searchParams.get(y);return this.url.searchParams.set(y,`${p?`${p},`:""}${i}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${i}`),this}range(i,l,{foreignTable:u,referencedTable:h=u}={}){const v=typeof h>"u"?"offset":`${h}.offset`,y=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(v,`${i}`),this.url.searchParams.set(y,`${l-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:v=!1,format:y="text"}={}){var p;const b=[i?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,v?"wal":null].filter(Boolean).join("|"),E=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${y}; for="${E}"; options=${b};`),y==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return $n.default=t,$n}var dl;function Ya(){if(dl)return Fn;dl=1;var r=Fn&&Fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=r(Iu());class t extends e.default{eq(i,l){return this.url.searchParams.append(i,`eq.${l}`),this}neq(i,l){return this.url.searchParams.append(i,`neq.${l}`),this}gt(i,l){return this.url.searchParams.append(i,`gt.${l}`),this}gte(i,l){return this.url.searchParams.append(i,`gte.${l}`),this}lt(i,l){return this.url.searchParams.append(i,`lt.${l}`),this}lte(i,l){return this.url.searchParams.append(i,`lte.${l}`),this}like(i,l){return this.url.searchParams.append(i,`like.${l}`),this}likeAllOf(i,l){return this.url.searchParams.append(i,`like(all).{${l.join(",")}}`),this}likeAnyOf(i,l){return this.url.searchParams.append(i,`like(any).{${l.join(",")}}`),this}ilike(i,l){return this.url.searchParams.append(i,`ilike.${l}`),this}ilikeAllOf(i,l){return this.url.searchParams.append(i,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(i,l){return this.url.searchParams.append(i,`ilike(any).{${l.join(",")}}`),this}is(i,l){return this.url.searchParams.append(i,`is.${l}`),this}in(i,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cs.{${l.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(l)}`),this}containedBy(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cd.{${l.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(l)}`),this}rangeGt(i,l){return this.url.searchParams.append(i,`sr.${l}`),this}rangeGte(i,l){return this.url.searchParams.append(i,`nxl.${l}`),this}rangeLt(i,l){return this.url.searchParams.append(i,`sl.${l}`),this}rangeLte(i,l){return this.url.searchParams.append(i,`nxr.${l}`),this}rangeAdjacent(i,l){return this.url.searchParams.append(i,`adj.${l}`),this}overlaps(i,l){return typeof l=="string"?this.url.searchParams.append(i,`ov.${l}`):this.url.searchParams.append(i,`ov.{${l.join(",")}}`),this}textSearch(i,l,{config:u,type:h}={}){let v="";h==="plain"?v="pl":h==="phrase"?v="ph":h==="websearch"&&(v="w");const y=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${v}fts${y}.${l}`),this}match(i){return Object.entries(i).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(i,l,u){return this.url.searchParams.append(i,`not.${l}.${u}`),this}or(i,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${i})`),this}filter(i,l,u){return this.url.searchParams.append(i,`${l}.${u}`),this}}return Fn.default=t,Fn}var fl;function Su(){if(fl)return Dn;fl=1;var r=Dn&&Dn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=r(Ya());class t{constructor(i,{headers:l={},schema:u,fetch:h}){this.url=i,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(i,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let v=!1;const y=(i??"*").split("").map(p=>/\s/.test(p)&&!v?"":(p==='"'&&(v=!v),p)).join("");return this.url.searchParams.set("select",y),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:l,defaultToNull:u=!0}={}){var h;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const y=i.reduce((p,b)=>p.concat(Object.keys(b)),[]);if(y.length>0){const p=[...new Set(y)].map(b=>`"${b}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(i,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:v=!0}={}){var y;const p="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const b=i.reduce((E,m)=>E.concat(Object.keys(m)),[]);if(b.length>0){const E=[...new Set(b)].map(m=>`"${m}"`);this.url.searchParams.set("columns",E.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}update(i,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:i}={}){var l;const u="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Dn.default=t,Dn}var hl;function Xd(){if(hl)return Ln;hl=1;var r=Ln&&Ln.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=r(Su()),t=r(Ya());class n{constructor(l,{headers:u={},schema:h,fetch:v}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=v}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:v=!1,count:y}={}){var p;let b;const E=new URL(`${this.url}/rpc/${l}`);let m;h||v?(b=h?"HEAD":"GET",Object.entries(u).filter(([N,P])=>P!==void 0).map(([N,P])=>[N,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([N,P])=>{E.searchParams.append(N,P)})):(b="POST",m=u);const S=new Headers(this.headers);return y&&S.set("Prefer",`count=${y}`),new t.default({method:b,url:E,headers:S,schema:this.schemaName,body:m,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}}return Ln.default=n,Ln}var vl;function Qd(){if(vl)return Kt;vl=1;var r=Kt&&Kt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PostgrestError=Kt.PostgrestBuilder=Kt.PostgrestTransformBuilder=Kt.PostgrestFilterBuilder=Kt.PostgrestQueryBuilder=Kt.PostgrestClient=void 0;const e=r(Xd());Kt.PostgrestClient=e.default;const t=r(Su());Kt.PostgrestQueryBuilder=t.default;const n=r(Ya());Kt.PostgrestFilterBuilder=n.default;const i=r(Iu());Kt.PostgrestTransformBuilder=i.default;const l=r(ku());Kt.PostgrestBuilder=l.default;const u=r(wu());return Kt.PostgrestError=u.default,Kt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:u.default},Kt}var Zd=Qd();const ef=Vd(Zd),{PostgrestClient:tf,PostgrestQueryBuilder:W_,PostgrestFilterBuilder:q_,PostgrestTransformBuilder:V_,PostgrestBuilder:H_,PostgrestError:G_}=ef;class rf{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const nf="2.15.1",sf=`realtime-js/${nf}`,af="1.0.0",wa=1e4,of=1e3,lf=100;var Ai;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Ai||(Ai={}));var Vt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Vt||(Vt={}));var yr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(yr||(yr={}));var ka;(function(r){r.websocket="websocket"})(ka||(ka={}));var mn;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(mn||(mn={}));class uf{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const i=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=n.decode(e.slice(u,u+i));u=u+i;const v=n.decode(e.slice(u,u+l));u=u+l;const y=JSON.parse(n.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:v,payload:y}}}class Eu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ot;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Ot||(Ot={}));const pl=(r,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((l,u)=>(l[u]=cf(u,r,e,i),l),{})},cf=(r,e,t,n)=>{const i=e.find(h=>h.name===r),l=i?.type,u=t[r];return l&&!n.includes(l)?xu(l,u):Ia(u)},xu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return vf(e,t)}switch(r){case Ot.bool:return df(e);case Ot.float4:case Ot.float8:case Ot.int2:case Ot.int4:case Ot.int8:case Ot.numeric:case Ot.oid:return ff(e);case Ot.json:case Ot.jsonb:return hf(e);case Ot.timestamp:return pf(e);case Ot.abstime:case Ot.date:case Ot.daterange:case Ot.int4range:case Ot.int8range:case Ot.money:case Ot.reltime:case Ot.text:case Ot.time:case Ot.timestamptz:case Ot.timetz:case Ot.tsrange:case Ot.tstzrange:return Ia(e);default:return Ia(e)}},Ia=r=>r,df=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},ff=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},hf=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},vf=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let l;const u=r.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>xu(e,h))}return r},pf=r=>typeof r=="string"?r.replace(" ","T"):r,Au=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class ra{constructor(e,t,n={},i=wa){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var gl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(gl||(gl={}));class Ci{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ci.syncState(this.state,i,l,u),this.pendingDiffs.forEach(v=>{this.state=Ci.syncDiff(this.state,v,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ci.syncDiff(this.state,i,l,u),h())}),this.onJoin((i,l,u)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:l,newPresences:u})}),this.onLeave((i,l,u)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const l=this.cloneDeep(e),u=this.transformState(t),h={},v={};return this.map(l,(y,p)=>{u[y]||(v[y]=p)}),this.map(u,(y,p)=>{const b=l[y];if(b){const E=p.map(P=>P.presence_ref),m=b.map(P=>P.presence_ref),S=p.filter(P=>m.indexOf(P.presence_ref)<0),N=b.filter(P=>E.indexOf(P.presence_ref)<0);S.length>0&&(h[y]=S),N.length>0&&(v[y]=N)}else h[y]=p}),this.syncDiff(l,{joins:h,leaves:v},n,i)}static syncDiff(e,t,n,i){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(l,(h,v)=>{var y;const p=(y=e[h])!==null&&y!==void 0?y:[];if(e[h]=this.cloneDeep(v),p.length>0){const b=e[h].map(m=>m.presence_ref),E=p.filter(m=>b.indexOf(m.presence_ref)<0);e[h].unshift(...E)}n(h,p,v)}),this.map(u,(h,v)=>{let y=e[h];if(!y)return;const p=v.map(b=>b.presence_ref);y=y.filter(b=>p.indexOf(b.presence_ref)<0),e[h]=y,i(h,y,v),y.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var _l;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(_l||(_l={}));var ji;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ji||(ji={}));var $r;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})($r||($r={}));class Ja{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ra(this,yr.join,this.params,this.timeout),this.rejoinTimer=new Eu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Vt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(yr.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new Ci(this),this.broadcastEndpointURL=Au(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Vt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,v=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(E=>E.filter))!==null&&i!==void 0?i:[],y=!!this.bindings[ji.PRESENCE]&&this.bindings[ji.PRESENCE].length>0,p={},b={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:y}),postgres_changes:v,private:h};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(E=>e?.($r.CHANNEL_ERROR,E)),this._onClose(()=>e?.($r.CLOSED)),this.updateJoinPayload(Object.assign({config:b},p)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:E})=>{var m;if(this.socket.setAuth(),E===void 0){e?.($r.SUBSCRIBED);return}else{const S=this.bindings.postgres_changes,N=(m=S?.length)!==null&&m!==void 0?m:0,P=[];for(let U=0;U<N;U++){const G=S[U],{filter:{event:D,schema:Z,table:ae,filter:$}}=G,B=E&&E[U];if(B&&B.event===D&&B.schema===Z&&B.table===ae&&B.filter===$)P.push(Object.assign(Object.assign({},G),{id:B.id}));else{this.unsubscribe(),this.state=Vt.errored,e?.($r.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e($r.SUBSCRIBED);return}}).receive("error",E=>{this.state=Vt.errored,e?.($r.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(E).join(", ")||"error")))}).receive("timeout",()=>{e?.($r.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Vt.joined&&e===ji.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=y.body)===null||i===void 0?void 0:i.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,v;const y=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),y.receive("ok",()=>l("ok")),y.receive("error",()=>l("error")),y.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Vt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(yr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new ra(this,yr.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Vt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,l=setTimeout(()=>i.abort(),n),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(l),u}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new ra(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>lf){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,l;const u=e.toLocaleLowerCase(),{close:h,error:v,leave:y,join:p}=yr;if(n&&[h,v,y,p].indexOf(u)>=0&&n!==this._joinRef())return;let E=this._onMessage(u,t,n);if(t&&!E)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(m=>{var S,N,P;return((S=m.filter)===null||S===void 0?void 0:S.event)==="*"||((P=(N=m.filter)===null||N===void 0?void 0:N.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===u}).map(m=>m.callback(E,n)):(l=this.bindings[u])===null||l===void 0||l.filter(m=>{var S,N,P,U,G,D;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in m){const Z=m.id,ae=(S=m.filter)===null||S===void 0?void 0:S.event;return Z&&((N=t.ids)===null||N===void 0?void 0:N.includes(Z))&&(ae==="*"||ae?.toLocaleLowerCase()===((P=t.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const Z=(G=(U=m?.filter)===null||U===void 0?void 0:U.event)===null||G===void 0?void 0:G.toLocaleLowerCase();return Z==="*"||Z===((D=t?.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===u}).map(m=>{if(typeof E=="object"&&"ids"in E){const S=E.data,{schema:N,table:P,commit_timestamp:U,type:G,errors:D}=S;E=Object.assign(Object.assign({},{schema:N,table:P,commit_timestamp:U,eventType:G,new:{},old:{},errors:D}),this._getPayloadRecords(S))}m.callback(E,n)})}_isClosed(){return this.state===Vt.closed}_isJoined(){return this.state===Vt.joined}_isJoining(){return this.state===Vt.joining}_isLeaving(){return this.state===Vt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),l={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(l):this.bindings[i]=[l],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var l;return!(((l=i.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&Ja.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(yr.close,{},e)}_onError(e){this._on(yr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Vt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=pl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=pl(e.columns,e.old_record)),t}}const ml=()=>{},us={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},gf=[1e3,2e3,5e3,1e4],_f=1e4,mf=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class yf{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=wa,this.transport=null,this.heartbeatIntervalMs=us.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ml,this.ref=0,this.reconnectTimer=null,this.logger=ml,this.conn=null,this.sendBuffer=[],this.serializer=new uf,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...u)=>Fi(async()=>{const{default:h}=await Promise.resolve().then(()=>di);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ka.websocket}`,this.httpEndpoint=Au(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=rf.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:af}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ai.connecting:return mn.Connecting;case Ai.open:return mn.Open;case Ai.closing:return mn.Closing;default:return mn.Closed}}isConnected(){return this.connectionState()===mn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(l=>l.topic===n);if(i)return i;{const l=new Ja(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:n,payload:i,ref:l}=e,u=()=>{this.encode(e,h=>{var v;(v=this.conn)===null||v===void 0||v.send(h)})};this.log("push",`${t} ${n} (${l})`,i),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(of,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},us.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:l,ref:u}=t,h=u?`(${u})`:"",v=l.status||"";this.log("receive",`${v} ${n} ${i} ${h}`.trim(),l),this.channels.filter(y=>y._isMember(n)).forEach(y=>y._trigger(i,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(yr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([mf],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:sf};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(yr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Eu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},us.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,l,u,h,v,y;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:wa,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:us.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(p=>gf[p-1]||_f),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((p,b)=>b(JSON.stringify(p))),this.decode=(y=e?.decode)!==null&&y!==void 0?y:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Xa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ht(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class bf extends Xa{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Sa extends Xa{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var wf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};const Cu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Fi(async()=>{const{default:n}=await Promise.resolve().then(()=>di);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},kf=()=>wf(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Fi(()=>Promise.resolve().then(()=>di),void 0,import.meta.url)).Response:Response}),Ea=r=>{if(Array.isArray(r))return r.map(t=>Ea(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[i]=Ea(n)}),e},If=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var Cn=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};const na=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Sf=(r,e,t)=>Cn(void 0,void 0,void 0,function*(){const n=yield kf();r instanceof n&&!t?.noResolveJson?r.json().then(i=>{const l=r.status||500,u=i?.statusCode||l+"";e(new bf(na(i),l,u))}).catch(i=>{e(new Sa(na(i),i))}):e(new Sa(na(r),r))}),Ef=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"||!n?i:(If(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function $i(r,e,t,n,i,l){return Cn(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,Ef(e,n,i,l)).then(v=>{if(!v.ok)throw v;return n?.noResolveJson?v:v.json()}).then(v=>u(v)).catch(v=>Sf(v,h,n))})})}function ks(r,e,t,n){return Cn(this,void 0,void 0,function*(){return $i(r,"GET",e,t,n)})}function xr(r,e,t,n,i){return Cn(this,void 0,void 0,function*(){return $i(r,"POST",e,n,i,t)})}function xa(r,e,t,n,i){return Cn(this,void 0,void 0,function*(){return $i(r,"PUT",e,n,i,t)})}function xf(r,e,t,n){return Cn(this,void 0,void 0,function*(){return $i(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function ju(r,e,t,n,i){return Cn(this,void 0,void 0,function*(){return $i(r,"DELETE",e,n,i,t)})}var er=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};const Af={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},yl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Cf{constructor(e,t={},n,i){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Cu(i)}uploadOrUpdate(e,t,n,i){return er(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},yl),i);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const v=u.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,v&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),i?.headers&&(h=Object.assign(Object.assign({},h),i.headers));const y=this._removeEmptyFolders(t),p=this._getFinalPath(y),b=yield(e=="PUT"?xa:xr)(this.fetch,`${this.url}/object/${p}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:y,id:b.Id,fullPath:b.Key},error:null}}catch(l){if(Ht(l))return{data:null,error:l};throw l}})}upload(e,t,n){return er(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return er(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let v;const y=Object.assign({upsert:yl.upsert},i),p=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&n instanceof Blob?(v=new FormData,v.append("cacheControl",y.cacheControl),v.append("",n)):typeof FormData<"u"&&n instanceof FormData?(v=n,v.append("cacheControl",y.cacheControl)):(v=n,p["cache-control"]=`max-age=${y.cacheControl}`,p["content-type"]=y.contentType);const b=yield xa(this.fetch,h.toString(),v,{headers:p});return{data:{path:l,fullPath:b.Key},error:null}}catch(v){if(Ht(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return er(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const l=yield xr(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new Xa("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(n){if(Ht(n))return{data:null,error:n};throw n}})}update(e,t,n){return er(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return er(this,void 0,void 0,function*(){try{return{data:yield xr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}copy(e,t,n){return er(this,void 0,void 0,function*(){try{return{data:{path:(yield xr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return er(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),l=yield xr(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const u=n?.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return er(this,void 0,void 0,function*(){try{const i=yield xr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}download(e,t){return er(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield ks(this.fetch,`${this.url}/${i}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Ht(h))return{data:null,error:h};throw h}})}info(e){return er(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield ks(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ea(n),error:null}}catch(n){if(Ht(n))return{data:null,error:n};throw n}})}exists(e){return er(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield xf(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Ht(n)&&n instanceof Sa){const i=n.originalError;if([400,404].includes(i?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),i=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&i.push(l);const h=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&i.push(v);let y=i.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${y}`)}}}remove(e){return er(this,void 0,void 0,function*(){try{return{data:yield ju(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ht(t))return{data:null,error:t};throw t}})}list(e,t,n){return er(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Af),t),{prefix:e||""});return{data:yield xr(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}listV2(e,t){return er(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield xr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(Ht(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const jf="2.11.0",Tf={"X-Client-Info":`storage-js/${jf}`};var Un=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};class Pf{constructor(e,t={},n,i){const l=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Tf),t),this.fetch=Cu(n)}listBuckets(){return Un(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ht(e))return{data:null,error:e};throw e}})}getBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ht(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Un(this,void 0,void 0,function*(){try{return{data:yield xr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Ht(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Un(this,void 0,void 0,function*(){try{return{data:yield xa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Ht(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield xr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ht(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield ju(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ht(t))return{data:null,error:t};throw t}})}}class Rf extends Pf{constructor(e,t={},n,i){super(e,t,n,i)}from(e){return new Cf(this.url,this.headers,e,this.fetch)}}const Of="2.56.0";let Ei="";typeof Deno<"u"?Ei="deno":typeof document<"u"?Ei="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ei="react-native":Ei="node";const Mf={"X-Client-Info":`supabase-js-${Ei}/${Of}`},Lf={headers:Mf},Df={schema:"public"},Ff={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},$f={};var Nf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};const Uf=r=>{let e;return r?e=r:typeof fetch>"u"?e=yu:e=fetch,(...t)=>e(...t)},Bf=()=>typeof Headers>"u"?bu:Headers,Wf=(r,e,t)=>{const n=Uf(t),i=Bf();return(l,u)=>Nf(void 0,void 0,void 0,function*(){var h;const v=(h=yield e())!==null&&h!==void 0?h:r;let y=new i(u?.headers);return y.has("apikey")||y.set("apikey",r),y.has("Authorization")||y.set("Authorization",`Bearer ${v}`),n(l,Object.assign(Object.assign({},u),{headers:y}))})};var qf=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};function Vf(r){return r.endsWith("/")?r:r+"/"}function Hf(r,e){var t,n;const{db:i,auth:l,realtime:u,global:h}=r,{db:v,auth:y,realtime:p,global:b}=e,E={db:Object.assign(Object.assign({},v),i),auth:Object.assign(Object.assign({},y),l),realtime:Object.assign(Object.assign({},p),u),storage:{},global:Object.assign(Object.assign(Object.assign({},b),h),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>qf(this,void 0,void 0,function*(){return""})};return r.accessToken?E.accessToken=r.accessToken:delete E.accessToken,E}const Tu="2.71.1",Gn=30*1e3,Aa=3,ia=Aa*Gn,Gf="http://localhost:9999",zf="supabase.auth.token",Kf={"X-Client-Info":`gotrue-js/${Tu}`},Ca="X-Supabase-Api-Version",Pu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Yf=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Jf=600*1e3;class Qa extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function at(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Xf extends Qa{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Qf(r){return at(r)&&r.name==="AuthApiError"}class Ru extends Qa{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class sn extends Qa{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class zr extends sn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Zf(r){return at(r)&&r.name==="AuthSessionMissingError"}class cs extends sn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ds extends sn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class fs extends sn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function eh(r){return at(r)&&r.name==="AuthImplicitGrantRedirectError"}class bl extends sn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ja extends sn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function sa(r){return at(r)&&r.name==="AuthRetryableFetchError"}class wl extends sn{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Ta extends sn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Is="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),kl=` 	
\r=`.split(""),th=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<kl.length;e+=1)r[kl[e].charCodeAt(0)]=-2;for(let e=0;e<Is.length;e+=1)r[Is[e].charCodeAt(0)]=e;return r})();function Il(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Is[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Is[n]),e.queuedBits-=6}}function Ou(r,e,t){const n=th[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Sl(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},l=u=>{ih(u,n,t)};for(let u=0;u<r.length;u+=1)Ou(r.charCodeAt(u),i,l);return e.join("")}function rh(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function nh(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}rh(n,e)}}function ih(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function sh(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Ou(r.charCodeAt(i),t,n);return new Uint8Array(e)}function ah(r){const e=[];return nh(r,t=>e.push(t)),new Uint8Array(e)}function oh(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return r.forEach(i=>Il(i,t,n)),Il(null,t,n),e.join("")}function lh(r){return Math.round(Date.now()/1e3)+r}function uh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const _r=()=>typeof window<"u"&&typeof document<"u",fn={tested:!1,writable:!1},Mu=()=>{if(!_r())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(fn.tested)return fn.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),fn.tested=!0,fn.writable=!0}catch{fn.tested=!0,fn.writable=!1}return fn.writable};function ch(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,l)=>{e[l]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const Lu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Fi(async()=>{const{default:n}=await Promise.resolve().then(()=>di);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},dh=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",zn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},hn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Gr=async(r,e)=>{await r.removeItem(e)};class Os{constructor(){this.promise=new Os.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Os.promiseConstructor=Promise;function aa(r){const e=r.split(".");if(e.length!==3)throw new Ta("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Yf.test(e[n]))throw new Ta("JWT not in base64url format");return{header:JSON.parse(Sl(e[0])),payload:JSON.parse(Sl(e[1])),signature:sh(e[2]),raw:{header:e[0],payload:e[1]}}}async function fh(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function hh(r,e){return new Promise((n,i)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await r(l);if(!e(l,null,u)){n(u);return}}catch(u){if(!e(l,u)){i(u);return}}})()})}function vh(r){return("0"+r.toString(16)).substr(-2)}function ph(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let l=0;l<56;l++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,vh).join("")}async function gh(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(l=>String.fromCharCode(l)).join("")}async function _h(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await gh(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Bn(r,e,t=!1){const n=ph();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await zn(r,`${e}-code-verifier`,i);const l=await _h(n);return[l,n===l?"plain":"s256"]}const mh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function yh(r){const e=r.headers.get(Ca);if(!e||!e.match(mh))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function bh(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function wh(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const kh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Wn(r){if(!kh.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function oa(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function El(r){return JSON.parse(JSON.stringify(r))}var Ih=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const gn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Sh=[502,503,504];async function xl(r){var e;if(!dh(r))throw new ja(gn(r),0);if(Sh.includes(r.status))throw new ja(gn(r),r.status);let t;try{t=await r.json()}catch(l){throw new Ru(gn(l),l)}let n;const i=yh(r);if(i&&i.getTime()>=Pu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new wl(gn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new zr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new wl(gn(t),r.status,t.weak_password.reasons);throw new Xf(gn(t),r.status||500,n)}const Eh=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function dt(r,e,t,n){var i;const l=Object.assign({},n?.headers);l[Ca]||(l[Ca]=Pu["2024-01-01"].name),n?.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const u=(i=n?.query)!==null&&i!==void 0?i:{};n?.redirectTo&&(u.redirect_to=n.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",v=await xh(r,e,t+h,{headers:l,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(v):{data:Object.assign({},v),error:null}}async function xh(r,e,t,n,i,l){const u=Eh(e,n,i,l);let h;try{h=await r(t,Object.assign({},u))}catch(v){throw console.error(v),new ja(gn(v),0)}if(h.ok||await xl(h),n?.noResolveJson)return h;try{return await h.json()}catch(v){await xl(v)}}function Fr(r){var e;let t=null;Th(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=lh(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function Al(r){const e=Fr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Yr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Ah(r){return{data:r,error:null}}function Ch(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:l}=r,u=Ih(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:l},v=Object.assign({},u);return{data:{properties:h,user:v},error:null}}function jh(r){return r}function Th(r){return r.access_token&&r.refresh_token&&r.expires_in}const la=["global","local","others"];var Ph=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Rh{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Lu(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=la[0]){if(la.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${la.join(", ")}`);try{return await dt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(at(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Yr})}catch(n){if(at(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Ph(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n?.newEmail,delete i.newEmail),await dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Ch,redirectTo:t?.redirectTo})}catch(t){if(at(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await dt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Yr})}catch(t){if(at(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,l,u,h,v;try{const y={nextPage:null,lastPage:0,total:0},p=await dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(l=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:jh});if(p.error)throw p.error;const b=await p.json(),E=(u=p.headers.get("x-total-count"))!==null&&u!==void 0?u:0,m=(v=(h=p.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&v!==void 0?v:[];return m.length>0&&(m.forEach(S=>{const N=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(S.split(";")[1].split("=")[1]);y[`${P}Page`]=N}),y.total=parseInt(E)),{data:Object.assign(Object.assign({},b),y),error:null}}catch(y){if(at(y))return{data:{users:[]},error:y};throw y}}async getUserById(e){Wn(e);try{return await dt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Yr})}catch(t){if(at(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Wn(e);try{return await dt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Yr})}catch(n){if(at(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Wn(e);try{return await dt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Yr})}catch(n){if(at(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Wn(e.userId);try{const{data:t,error:n}=await dt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(at(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Wn(e.userId),Wn(e.id);try{return{data:await dt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(at(t))return{data:null,error:t};throw t}}}function Cl(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Oh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const qn={debug:!!(globalThis&&Mu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Du extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Mh extends Du{}async function Lh(r,e,t){qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),qn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Mh(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(qn.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Oh();const Dh={url:Gf,storageKey:zf,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Kf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function jl(r,e,t){return await t()}const Vn={};class Oi{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oi.nextInstanceID,Oi.nextInstanceID+=1,this.instanceID>0&&_r()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Dh),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Rh({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Lu(i.fetch),this.lock=i.lock||jl,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:_r()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Lh:this.lock=jl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Mu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Cl(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Cl(this.memoryStorage)),_r()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Vn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Vn[this.storageKey]=Object.assign(Object.assign({},Vn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Vn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Vn[this.storageKey]=Object.assign(Object.assign({},Vn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Tu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ch(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),_r()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:l}=await this._getSessionFromURL(t,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),eh(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return at(t)?{error:t}:{error:new Ru("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const l=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Fr}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:y,session:v},error:null}}catch(l){if(at(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,n,i;try{let l;if("email"in e){const{email:p,password:b,options:E}=e;let m=null,S=null;this.flowType==="pkce"&&([m,S]=await Bn(this.storage,this.storageKey)),l=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:E?.emailRedirectTo,body:{email:p,password:b,data:(t=E?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:E?.captchaToken},code_challenge:m,code_challenge_method:S},xform:Fr})}else if("phone"in e){const{phone:p,password:b,options:E}=e;l=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:b,data:(n=E?.data)!==null&&n!==void 0?n:{},channel:(i=E?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:E?.captchaToken}},xform:Fr})}else throw new ds("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,y=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:y,session:v},error:null}}catch(l){if(at(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Al})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Al})}else throw new ds("You must provide either an email or phone number and a password");const{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new cs}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,i,l,u,h,v,y,p,b,E,m;let S,N;if("message"in e)S=e.message,N=e.signature;else{const{chain:P,wallet:U,statement:G,options:D}=e;let Z;if(_r())if(typeof U=="object")Z=U;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))Z=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Z=U}const ae=new URL((t=D?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in Z&&Z.signIn){const $=await Z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},D?.signInWithSolana),{version:"1",domain:ae.host,uri:ae.href}),G?{statement:G}:null));let B;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")B=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)B=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)S=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),N=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Z)||typeof Z.signMessage!="function"||!("publicKey"in Z)||typeof Z!="object"||!Z.publicKey||!("toBase58"in Z.publicKey)||typeof Z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${ae.host} wants you to sign in with your Solana account:`,Z.publicKey.toBase58(),...G?["",G,""]:[""],"Version: 1",`URI: ${ae.href}`,`Issued At: ${(i=(n=D?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((l=D?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${D.signInWithSolana.notBefore}`]:[],...!((u=D?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${D.signInWithSolana.expirationTime}`]:[],...!((h=D?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${D.signInWithSolana.chainId}`]:[],...!((v=D?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${D.signInWithSolana.nonce}`]:[],...!((y=D?.signInWithSolana)===null||y===void 0)&&y.requestId?[`Request ID: ${D.signInWithSolana.requestId}`]:[],...!((b=(p=D?.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||b===void 0)&&b.length?["Resources",...D.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const $=await Z.signMessage(new TextEncoder().encode(S),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=$}}try{const{data:P,error:U}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:oh(N)},!((E=e.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Fr});if(U)throw U;return!P||!P.session||!P.user?{data:{user:null,session:null},error:new cs}:(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),{data:Object.assign({},P),error:U})}catch(P){if(at(P))return{data:{user:null,session:null},error:P};throw P}}async _exchangeCodeForSession(e){const t=await hn(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{const{data:l,error:u}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Fr});if(await Gr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new cs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:i??null}),error:u})}catch(l){if(at(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:l,nonce:u}=e,h=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Fr}),{data:v,error:y}=h;return y?{data:{user:null,session:null},error:y}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new cs}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:y})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,l,u;try{if("email"in e){const{email:h,options:v}=e;let y=null,p=null;this.flowType==="pkce"&&([y,p]=await Bn(this.storage,this.storageKey));const{error:b}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(n=v?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:y,code_challenge_method:p},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:h,options:v}=e,{data:y,error:p}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(i=v?.data)!==null&&i!==void 0?i:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(u=v?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:y?.message_id},error:p}}throw new ds("You must provide either an email or phone number.")}catch(h){if(at(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let i,l;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:u,error:h}=await dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:i,xform:Fr});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const v=u.session,y=u.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:y,session:v},error:null}}catch(i){if(at(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Bn(this.storage,this.storageKey)),await dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Ah})}catch(l){if(at(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new zr;const{error:i}=await dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(at(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:l}=e,{error:u}=await dt(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:n,type:i,options:l}=e,{data:u,error:h}=await dt(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new ds("You must provide either an email or phone number and a type")}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await hn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<ia:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const u=await hn(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=oa()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,y,p)=>(!u&&y==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,y,p))})}return{data:{session:e},error:null}}const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Yr}):await this._useSession(async t=>{var n,i,l;const{data:u,error:h}=t;if(h)throw h;return!(!((n=u.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new zr}:await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&l!==void 0?l:void 0,xform:Yr})})}catch(t){if(at(t))return Zf(t)&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:l}=n;if(l)throw l;if(!i.session)throw new zr;const u=i.session;let h=null,v=null;this.flowType==="pkce"&&e.email!=null&&([h,v]=await Bn(this.storage,this.storageKey));const{data:y,error:p}=await dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:v}),jwt:u.access_token,xform:Yr});if(p)throw p;return u.user=y.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(n){if(at(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zr;const t=Date.now()/1e3;let n=t,i=!0,l=null;const{payload:u}=aa(e.access_token);if(u.exp&&(n=u.exp,i=n<=t),i){const{session:h,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(at(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(n=u.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new zr;const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!_r())throw new fs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new fs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new bl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new fs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new bl("No code detected.");const{data:G,error:D}=await this._exchangeCodeForSession(e.code);if(D)throw D;const Z=new URL(window.location.href);return Z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Z.toString()),{data:{session:G.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:l,refresh_token:u,expires_in:h,expires_at:v,token_type:y}=e;if(!l||!h||!u||!y)throw new fs("No session defined in URL");const p=Math.round(Date.now()/1e3),b=parseInt(h);let E=p+b;v&&(E=parseInt(v));const m=E-p;m*1e3<=Gn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${b}s`);const S=E-b;p-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,E,p):p-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,E,p);const{data:N,error:P}=await this._getUser(l);if(P)throw P;const U={provider_token:n,provider_refresh_token:i,access_token:l,expires_in:b,expires_at:E,refresh_token:u,token_type:y,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:e.type},error:null}}catch(n){if(at(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await hn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:l}=t;if(l)return{error:l};const u=(n=i.session)===null||n===void 0?void 0:n.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Qf(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Gr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=uh(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:l},error:u}=t;if(u)throw u;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Bn(this.storage,this.storageKey,!0));try{return await dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(at(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(at(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:i}=await this._useSession(async l=>{var u,h,v,y,p;const{data:b,error:E}=l;if(E)throw E;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await dt(this.fetch,"GET",m,{headers:this.headers,jwt:(p=(y=b.session)===null||y===void 0?void 0:y.access_token)!==null&&p!==void 0?p:void 0})});if(i)throw i;return _r()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(at(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:l,error:u}=t;if(u)throw u;return await dt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await hh(async i=>(i>0&&await fh(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Fr})),(i,l)=>{const u=200*Math.pow(2,i);return l&&sa(l)&&Date.now()+u-n<Gn})}catch(n){if(this._debug(t,"error",n),at(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),_r()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await hn(this.storage,this.storageKey);if(i&&this.userStorage){let u=await hn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},await zn(this.userStorage,this.storageKey+"-user",u)),i.user=(e=u?.user)!==null&&e!==void 0?e:oa()}else if(i&&!i.user&&!i.user){const u=await hn(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,await Gr(this.storage,this.storageKey+"-user"),await zn(this.storage,this.storageKey,i)):i.user=oa()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const l=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ia;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${ia}s`),l){if(this.autoRefreshToken&&i.refresh_token){const{error:u}=await this._callRefreshToken(i.refresh_token);u&&(console.error(u),sa(u)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(i.access_token);!h&&u?.user?(i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(n,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new zr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Os;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new zr;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(i,"error",l),at(l)){const u={session:null,error:l};return sa(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await zn(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const l=El(i);await zn(this.storage,this.storageKey,l)}else{const i=El(t);await zn(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Gr(this.storage,this.storageKey),await Gr(this.storage,this.storageKey+"-code-verifier"),await Gr(this.storage,this.storageKey+"-user"),this.userStorage&&await Gr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&_r()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Gn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/Gn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Gn}ms, refresh threshold is ${Aa} ticks`),i<=Aa&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Du)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!_r()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,u]=await Bn(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(h.toString())}if(n?.queryParams){const l=new URLSearchParams(n.queryParams);i.push(l.toString())}return n?.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;return l?{data:null,error:l}:await dt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:y}=await dt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return y?{data:null,error:y}:(e.factorType==="totp"&&(!((i=v?.totp)===null||i===void 0)&&i.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(at(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:l}=t;return l?{data:null,error:l}:await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(at(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],i=n.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=n.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:n,totp:i,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:i},error:l}=e;if(l)return{data:null,error:l};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=aa(i.access_token);let h=null;u.aal&&(h=u.aal);let v=h;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(v="aal2");const p=u.amr||[];return{data:{currentLevel:h,nextLevel:v,currentAuthenticationMethods:p},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+Jf>i)return n;const{data:l,error:u}=await dt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=i,n=l.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:m,error:S}=await this.getSession();if(S||!m.session)return{data:null,error:S};n=m.session.access_token}const{header:i,payload:l,signature:u,raw:{header:h,payload:v}}=aa(n);t?.allowExpired||bh(l.exp);const y=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!y){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:l,header:i,signature:u},error:null}}const p=wh(i.alg),b=await crypto.subtle.importKey("jwk",y,p,!0,["verify"]);if(!await crypto.subtle.verify(p,b,u,ah(`${h}.${v}`)))throw new Ta("Invalid JWT signature");return{data:{claims:l,header:i,signature:u},error:null}}catch(n){if(at(n))return{data:null,error:n};throw n}}}Oi.nextInstanceID=0;const Fh=Oi;class $h extends Fh{constructor(e){super(e)}}var Nh=function(r,e,t,n){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(p){try{y(n.next(p))}catch(b){u(b)}}function v(p){try{y(n.throw(p))}catch(b){u(b)}}function y(p){p.done?l(p.value):i(p.value).then(h,v)}y((n=n.apply(r,e||[])).next())})};class Uh{constructor(e,t,n){var i,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Vf(e),v=new URL(h);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const y=`sb-${v.hostname.split(".")[0]}-auth-token`,p={db:Df,realtime:$f,auth:Object.assign(Object.assign({},Ff),{storageKey:y}),global:Lf},b=Hf(n??{},p);this.storageKey=(i=b.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(l=b.global.headers)!==null&&l!==void 0?l:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(E,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=b.auth)!==null&&u!==void 0?u:{},this.headers,b.global.fetch),this.fetch=Wf(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new tf(new URL("rest/v1",v).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new Rf(this.storageUrl.href,this.headers,this.fetch,n?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new qd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Nh(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,storageKey:l,flowType:u,lock:h,debug:v},y,p){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $h({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),y),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,flowType:u,lock:h,debug:v,fetch:p,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new yf(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Bh=(r,e,t)=>new Uh(r,e,t);function Wh(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Wh()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const qh="https://vycjpmuyscfygstjjied.supabase.co",Vh="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Ar=Bh(qh,Vh,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Zr={async loadStoriesList(){if(!V.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${V.selectedBucket}`);const r=`${V.selectedBucket}_story.json`,{data:e,error:t}=await Ar.storage.from(V.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(V.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(V.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!V.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await Ar.storage.from(V.selectedBucket).list();r&&(V.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!V.selectedBucket){Et.setStatus("error","Не выбрана история");return}const t=e.files[0];Et.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),i=new Uint8Array(n),{error:l}=await Ar.storage.from(V.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});l?Et.setStatus("error","Ошибка загрузки"):(Et.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!V.selectedBucket){Et.setStatus("error","Не выбрана история");return}const{error:e}=await Ar.storage.from(V.selectedBucket).remove([r]);e?Et.setStatus("error","Ошибка удаления файла"):(Et.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Hh(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function Gh(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const yn={async createNewStory(){if(!V.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:l}=await Ar.storage.from(V.selectedBucket).upload(r,i,{contentType:"application/json"});l?Et.setStatus("error","Ошибка создания: "+l.message):(await Zr.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!V.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${V.selectedBucket}`),Et.setStatus("loading","Загрузка..."),V.currentFileName=r;try{const{data:e,error:t}=await Ar.storage.from(V.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Ar.storage.from(V.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);n=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let i=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=Hh(i),console.log("[StoryStore] Присваиваем данные в editor.data"),V.data=i,console.log("[StoryStore] editor.data обновлен:",{chapters:V.data.chapters?.length,dialogues:V.data.dialogues?.length}),V.data.chapters&&V.data.chapters.length>0&&(V.selectedChapterId=V.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${V.selectedChapterId}`)),V.data.dialogues&&V.data.dialogues.length>0&&(V.selectedDialogueId=V.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${V.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),Et.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),Et.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!V.data)return;if(!V.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}Et.setStatus("loading","Сохранение...");const r=JSON.stringify(V.data,null,2);console.log(`[StoryStore] Сохранение файла: ${V.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await Ar.storage.from(V.selectedBucket).update(V.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const i=await Ar.storage.from(V.selectedBucket).upload(V.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore] Ошибка сохранения (upload):",i.error),Et.setStatus("error","Ошибка сохранения: "+i.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),Et.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),Et.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!V.data)return;if(!V.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}const r=V.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),Et.setStatus("loading","Создание копии...");const i=JSON.stringify(V.data,null,2),u=new TextEncoder().encode(i),{error:h}=await Ar.storage.from(V.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?Et.setStatus("error",`Ошибка копии: ${h.message}`):(await Zr.loadStoriesList(),Et.setStatus("success","Копия сохранена!"))},addChapter(){if(!V.data||!V.data.chapters)return;const r="ch_"+Date.now();V.data.chapters.push({id:r,title:"Новая глава",description:""}),V.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!V.data||!V.selectedChapterId)return;const r="d_"+Date.now();V.data.dialogues.push({id:r,chapterId:V.selectedChapterId,text:"Новый текст...",options:[]}),V.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&V.data&&(V.data.dialogues=V.data.dialogues.filter(e=>e.id!==r),V.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),V.selectedDialogueId===r&&(V.selectedDialogueId=null))},jumpTo(r){const e=V.data?.dialogues.find(t=>t.id===r);e&&(V.selectedChapterId=e.chapterId,V.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var rr=rn(()=>Jt);function zh(){Et.selectEditingChapter(null)}var Kh=X('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function Yh(r,e){Ft(e,!1);function t(){rr().currentEditingChapter&&(Et.updateChapter(rr().currentEditingChapter.id,{title:rr().currentEditingChapter.title,description:rr().currentEditingChapter.description}),Et.selectEditingChapter(null))}function n(){rr().currentEditingChapter&&confirm(`Удалить главу "${rr().currentEditingChapter.title}"?`)&&(Et.deleteChapter(rr().currentEditingChapter.id),Et.selectEditingChapter(null))}tn();var i=xt(),l=nt(i);{var u=h=>{var v=Kh(),y=w(v),p=A(w(y),2),b=w(p);b.__click=n;var E=A(y,2),m=A(w(E),2),S=A(E,2),N=A(w(S),2),P=A(S,2),U=w(P);U.__click=[zh];var G=A(U,2);G.__click=t,Nr(m,()=>rr().currentEditingChapter.title,D=>rr(rr().currentEditingChapter.title=D)),Nr(N,()=>rr().currentEditingChapter.description,D=>rr(rr().currentEditingChapter.description=D)),L(h,v)};_e(l,h=>{rr().currentEditingChapter&&h(u)})}L(r,i),$t()}Bt(["click"]);var nr=rn(()=>V),Jh=(r,e,t)=>e(d(t).id),Xh=X('<div class="chapter-form-container svelte-xp6igx"><!></div>'),Qh=X('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),Zh=X('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),ev=X("<div> </div>"),tv=X('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function rv(r,e){Ft(e,!1);function t(U){Et.selectEditingChapter(U)}tn();var n=tv(),i=w(n),l=w(i),u=A(w(l),2);u.__click=function(...U){yn.addChapter?.apply(this,U)};var h=A(l,2);et(h,5,()=>nr().data?.chapters||[],U=>U.id,(U,G)=>{var D=Qh(),Z=nt(D),ae=w(Z);let $;ae.__click=()=>nr(nr().selectedChapterId=d(G).id);var B=w(ae),he=w(B),le=A(ae,2);le.__click=[Jh,t,G];var Se=A(Z,2);{var be=oe=>{var Ce=Xh(),Ue=w(Ce);Yh(Ue,{}),L(oe,Ce)};_e(Se,oe=>{nr().editingChapterId===d(G).id&&oe(be)})}de(oe=>{$=It(ae,1,"chapter-item svelte-xp6igx",null,$,oe),Ve(ae,"aria-pressed",nr().selectedChapterId===d(G).id),Ve(ae,"title",d(G).description||"Без описания"),fe(he,d(G).title)},[()=>({active:nr().selectedChapterId===d(G).id})]),L(U,D)});var v=A(i,2),y=w(v),p=w(y),b=w(p),E=A(p,2);E.__click=function(...U){yn.addDialogue?.apply(this,U)};var m=A(y,2);et(m,5,()=>Jt.chapterDialogues,U=>U.id,(U,G)=>{var D=Zh();let Z;D.__click=()=>nr(nr().selectedDialogueId=d(G).id);var ae=w(D),$=w(ae),B=A(ae,2),he=w(B);de((le,Se)=>{Z=It(D,1,"dialogue-item svelte-xp6igx",null,Z,le),Ve(D,"aria-pressed",nr().selectedDialogueId===d(G).id),fe($,d(G).id),fe(he,`${Se??""}...`)},[()=>({active:nr().selectedDialogueId===d(G).id}),()=>d(G).text.substring(0,25)]),L(U,D)});var S=A(v,2),N=w(S);{var P=U=>{var G=ev(),D=w(G);de(()=>{It(G,1,`alert ${nr().statusMessage.type??""}`,"svelte-xp6igx"),fe(D,nr().statusMessage.text)}),L(U,G)};_e(N,U=>{nr().statusMessage.text&&U(P)})}de(()=>{fe(b,`Сцены (${Jt.chapterDialogues.length??""})`),E.disabled=!nr().selectedChapterId}),L(r,n),$t()}Bt(["click"]);var nv=X("<option> </option>"),iv=(r,e)=>e(r.target.checked),sv=(r,e)=>e("id",r.target.value),av=(r,e)=>e("onWinDialogueId",r.target.value),ov=X("<option> </option>"),lv=(r,e)=>e("onLoseDialogueId",r.target.value),uv=X("<option> </option>"),cv=(r,e)=>e("rewardItem",r.target.value),dv=X("<option> </option>"),fv=X('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),hv=(r,e)=>e(r.target.value),vv=X("<option> </option>"),pv=(r,e)=>e({itemId:r.target.value}),gv=X("<option> </option>"),_v=X('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),mv=(r,e)=>e({statName:r.target.value}),yv=(r,e)=>{const t=parseInt(r.target.value);e({statValue:isNaN(t)?0:t})},bv=X('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),wv=(r,e)=>e({flagName:r.target.value}),kv=X('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),Iv=X('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function Sv(r,e){Ft(e,!0);const t=pt(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return n(),t().visibilityCondition}function l(ue){n();const ce=t().visibilityCondition;Object.assign(ce,ue),t().visibilityCondition={...ce}}function u(ue){n();const ce={type:ue};switch(ue){case"has_item":ce.itemId=i().itemId||"";break;case"stat_greater":ce.statName=i().statName||"",ce.statValue=i().statValue||0;break;case"flag_true":ce.flagName=i().flagName||"";break}t().visibilityCondition=ce}const h=Dt(()=>!!t().miniGame);function v(ue){ue?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function y(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function p(ue,ce){const J=y();J&&(J[ue]=ce)}var b=Iv(),E=w(b),m=w(E),S=A(m,2),N=A(E,2),P=w(N),U=A(P,2),G=w(U);G.value=G.__value="";var D=A(G);et(D,17,()=>e.dialogues,ue=>ue.id,(ue,ce)=>{var J=nv(),R=w(J),Y={};de(z=>{fe(R,`${d(ce).id??""}: ${z??""}...`),Y!==(Y=d(ce).id)&&(J.value=(J.__value=d(ce).id)??"")},[()=>d(ce).text.substring(0,30)]),L(ue,J)});var Z=A(N,2),ae=w(Z),$=w(ae),B=w($);B.__change=[iv,v];var he=A(ae,2);{var le=ue=>{var ce=fv(),J=w(ce),R=w(J),Y=A(R,2);Y.__change=[sv,p];var z=w(Y);z.value=z.__value="";var M=A(z);M.value=M.__value="onet_monsters";var H=A(M);H.value=H.__value="memo_monsters";var ee=A(H);ee.value=ee.__value="light_out";var Ie=A(ee);Ie.value=Ie.__value="flood_it";var je=A(Ie);je.value=je.__value="broken_mirror";var pe=A(je);pe.value=pe.__value="evolution2048";var Q=A(pe);Q.value=Q.__value="cursed_crypts";var se=A(Q);se.value=se.__value="tower_of_souls";var g;pn(Y);var o=A(J,2),f=w(o),I=w(f),j=A(I,2);j.__change=[av,p];var C=w(j);C.value=C.__value="";var T=A(C);et(T,17,()=>e.dialogues,rt=>rt.id,(rt,gt)=>{var Re=ov(),it=w(Re),qt={};de(jn=>{fe(it,`${d(gt).id??""}: ${jn??""}...`),qt!==(qt=d(gt).id)&&(Re.value=(Re.__value=d(gt).id)??"")},[()=>d(gt).text.substring(0,30)]),L(rt,Re)});var W;pn(j);var ne=A(f,2),te=w(ne),ye=A(te,2);ye.__change=[lv,p];var Te=w(ye);Te.value=Te.__value="";var ze=A(Te);et(ze,17,()=>e.dialogues,rt=>rt.id,(rt,gt)=>{var Re=uv(),it=w(Re),qt={};de(jn=>{fe(it,`${d(gt).id??""}: ${jn??""}...`),qt!==(qt=d(gt).id)&&(Re.value=(Re.__value=d(gt).id)??"")},[()=>d(gt).text.substring(0,30)]),L(rt,Re)});var Ke;pn(ye);var ht=A(o,2),Pt=w(ht),Ze=A(Pt,2);Ze.__change=[cv,p];var Ct=w(Ze);Ct.value=Ct.__value="";var tt=A(Ct);et(tt,17,()=>e.availableItems,rt=>rt.id,(rt,gt)=>{var Re=dv(),it=w(Re),qt={};de(()=>{fe(it,d(gt).name),qt!==(qt=d(gt).id)&&(Re.value=(Re.__value=d(gt).id)??"")}),L(rt,Re)});var jt;pn(Ze),de((rt,gt,Re,it)=>{Ve(R,"for",`option-mg-id-${e.index??""}`),Ve(Y,"id",`option-mg-id-${e.index??""}`),g!==(g=rt)&&(Y.value=(Y.__value=rt)??"",Kr(Y,rt)),Ve(I,"for",`option-mg-win-${e.index??""}`),Ve(j,"id",`option-mg-win-${e.index??""}`),W!==(W=gt)&&(j.value=(j.__value=gt)??"",Kr(j,gt)),Ve(te,"for",`option-mg-lose-${e.index??""}`),Ve(ye,"id",`option-mg-lose-${e.index??""}`),Ke!==(Ke=Re)&&(ye.value=(ye.__value=Re)??"",Kr(ye,Re)),Ve(Pt,"for",`option-mg-reward-${e.index??""}`),Ve(Ze,"id",`option-mg-reward-${e.index??""}`),jt!==(jt=it)&&(Ze.value=(Ze.__value=it)??"",Kr(Ze,it))},[()=>y().id,()=>y().onWinDialogueId,()=>y().onLoseDialogueId,()=>y().rewardItem||""]),L(ue,ce)};_e(he,ue=>{y()&&ue(le)})}var Se=A(Z,2),be=w(Se),oe=w(be),Ce=w(oe),Ue=A(be,2),we=w(Ue),$e=w(we),me=A(Se,2),Ye=A(w(me),2),Xe=w(Ye),We=w(Xe),He=A(We,2);He.__change=[hv,u],et(He,20,()=>e.conditionTypes,ue=>ue,(ue,ce)=>{var J=vv(),R=w(J),Y={};de(()=>{fe(R,ce),Y!==(Y=ce)&&(J.value=(J.__value=ce)??"")}),L(ue,J)});var Je;pn(He);var Me=A(Xe,2);{var De=ue=>{var ce=_v(),J=w(ce),R=A(J,2);R.__change=[pv,l];var Y=w(R);Y.value=Y.__value="";var z=A(Y);et(z,17,()=>e.availableItems,H=>H.id,(H,ee)=>{var Ie=gv(),je=w(Ie),pe={};de(()=>{fe(je,d(ee).name),pe!==(pe=d(ee).id)&&(Ie.value=(Ie.__value=d(ee).id)??"")}),L(H,Ie)});var M;pn(R),de(H=>{Ve(J,"for",`option-cond-item-${e.index??""}`),Ve(R,"id",`option-cond-item-${e.index??""}`),M!==(M=H)&&(R.value=(R.__value=H)??"",Kr(R,H))},[()=>i().itemId||""]),L(ue,ce)};_e(Me,ue=>{i().type==="has_item"&&ue(De)})}var xe=A(Me,2);{var ke=ue=>{var ce=bv(),J=nt(ce),R=w(J),Y=A(R,2);Y.__input=[mv,l];var z=A(J,2),M=w(z),H=A(M,2);H.__input=[yv,l],de((ee,Ie)=>{Ve(R,"for",`option-cond-stat-${e.index??""}`),Ve(Y,"id",`option-cond-stat-${e.index??""}`),Zs(Y,ee),Ve(M,"for",`option-cond-stat-val-${e.index??""}`),Ve(H,"id",`option-cond-stat-val-${e.index??""}`),Zs(H,Ie)},[()=>i().statName||"",()=>i().statValue||0]),L(ue,ce)};_e(xe,ue=>{i().type==="stat_greater"&&ue(ke)})}var Ge=A(xe,2);{var Qe=ue=>{var ce=kv(),J=w(ce),R=A(J,2);R.__input=[wv,l],de(Y=>{Ve(J,"for",`option-cond-flag-${e.index??""}`),Ve(R,"id",`option-cond-flag-${e.index??""}`),Zs(R,Y)},[()=>i().flagName||""]),L(ue,ce)};_e(Ge,ue=>{i().type==="flag_true"&&ue(Qe)})}var Fe=A(Ye,2);_e(Fe,ue=>{}),de(ue=>{Ve(m,"for",`option-text-${e.index??""}`),Ve(S,"id",`option-text-${e.index??""}`),Ve(P,"for",`option-next-${e.index??""}`),Ve(U,"id",`option-next-${e.index??""}`),Rd(B,d(h)),Ve(We,"for",`option-cond-type-${e.index??""}`),Ve(He,"id",`option-cond-type-${e.index??""}`),Je!==(Je=ue)&&(He.value=(He.__value=ue)??"",Kr(He,ue))},[()=>i().type]),Nr(S,()=>t().text,ue=>t().text=ue),Kn(U,()=>t().nextDialogueId,ue=>t().nextDialogueId=ue),rl(Ce,()=>t().enabled,ue=>t().enabled=ue),rl($e,()=>t().visible,ue=>t().visible=ue),L(r,b),$t()}Bt(["change","input"]);var Rt=rn(()=>V),wt=rn(()=>Jt),Ev=X("<option> <!></option>"),xv=X("<option> </option>"),Av=X("<option> </option>"),Cv=X("<option> </option>"),jv=X("<option> </option>"),Tv=X('<div class="option-content svelte-1de8com"><!></div>'),Pv=X('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Rv=X("<option> </option>"),Ov=X('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-chapter" class="svelte-1de8com">Глава</label> <select id="dialogue-chapter" class="input select svelte-1de8com"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),Mv=X('<div class="empty-state">Выберите сцену</div>');function Lv(r,e){Ft(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(p){p.options||(p.options=[]);const b=Gh();p.options.push(b),Rt(Rt().editingOptionIndex=p.options.length-1)}function i(p){if(Rt().editingOptionIndex===p)Rt(Rt().editingOptionIndex=null);else{Rt(Rt().editingOptionIndex=p);const b=wt().currentDialogue?.options?.[p];b&&!b.visibilityCondition&&(b.visibilityCondition={type:"always"})}}function l(p,b){confirm("Удалить вариант ответа?")&&(p.options?.splice(b,1),Rt().editingOptionIndex===b?Rt(Rt().editingOptionIndex=null):Rt().editingOptionIndex&&Rt().editingOptionIndex>b&&Rt(Rt().editingOptionIndex--))}tn();var u=xt(),h=nt(u);{var v=p=>{var b=Ov(),E=w(b),m=A(w(E),2);m.__change=Fe=>Rt(Rt().selectedDialogueId=Fe.target?.value);var S=A(E,2),N=A(w(S),2);de(()=>{wt(),mr(()=>{Rt()})}),N.__change=Fe=>Rt(Rt().selectedChapterId=Fe.target?.value);var P=w(N);P.value=P.__value="";var U=A(P);et(U,1,()=>Rt().data.chapters||[],Nt,(Fe,ue)=>{var ce=Ev(),J=w(ce),R=A(J);{var Y=M=>{var H=Si();de(ee=>fe(H,`- ${ee??""}...`),[()=>d(ue).description.substring(0,30)]),L(M,H)};_e(R,M=>{d(ue).description&&M(Y)})}var z={};de(()=>{fe(J,`${d(ue).title??""} `),z!==(z=d(ue).id)&&(ce.value=(ce.__value=d(ue).id)??"")}),L(Fe,ce)});var G=A(S,2),D=A(w(G),2),Z=A(G,2),ae=A(w(Z),2),$=A(w(ae),2),B=w($);de(()=>{wt(),mr(()=>{})});var he=w(B);he.value=he.__value="";var le=A(he);et(le,1,()=>wt().imageResources,Nt,(Fe,ue)=>{var ce=xv(),J=w(ce),R={};de(()=>{fe(J,d(ue).name),R!==(R=d(ue).name)&&(ce.value=(ce.__value=d(ue).name)??"")}),L(Fe,ce)});var Se=A(le);et(Se,1,()=>wt().riveResources,Nt,(Fe,ue)=>{var ce=Av(),J=w(ce),R={};de(()=>{fe(J,`${d(ue).name??""} (Rive)`),R!==(R=d(ue).name)&&(ce.value=(ce.__value=d(ue).name)??"")}),L(Fe,ce)});var be=A(B,2),oe=A(w(be));oe.__change=function(...Fe){Zr.uploadNewFile?.apply(this,Fe)};var Ce=A(ae,2),Ue=A(w(Ce),2),we=w(Ue);de(()=>{wt(),mr(()=>{})});var $e=w(we);$e.value=$e.__value="";var me=A($e);et(me,1,()=>wt().imageResources,Nt,(Fe,ue)=>{var ce=Cv(),J=w(ce),R={};de(()=>{fe(J,d(ue).name),R!==(R=d(ue).name)&&(ce.value=(ce.__value=d(ue).name)??"")}),L(Fe,ce)});var Ye=A(me);et(Ye,1,()=>wt().riveResources,Nt,(Fe,ue)=>{var ce=jv(),J=w(ce),R={};de(()=>{fe(J,`${d(ue).name??""} (Rive)`),R!==(R=d(ue).name)&&(ce.value=(ce.__value=d(ue).name)??"")}),L(Fe,ce)});var Xe=A(Z,2),We=w(Xe),He=A(w(We),2);He.__click=()=>n(wt().currentDialogue);var Je=A(We,2);et(Je,1,()=>wt().currentDialogue.options||[],Nt,(Fe,ue,ce)=>{var J=Pv();let R;var Y=w(J),z=w(Y);z.__click=()=>i(ce),z.__keydown=o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),i(ce))},Ve(z,"aria-controls",`option-content-${ce}`);var M=w(z),H=w(M);{var ee=o=>{var f=Si("👁️‍🗨️");L(o,f)},Ie=o=>{var f=xt(),I=nt(f);{var j=T=>{var W=Si("🔒");L(T,W)},C=T=>{var W=Si("✅");L(T,W)};_e(I,T=>{d(ue).enabled?T(C,!1):T(j)},!0)}L(o,f)};_e(H,o=>{d(ue).visible?o(Ie,!1):o(ee)})}var je=A(M,2),pe=w(je),Q=A(z,2);Q.__click=()=>l(wt().currentDialogue,ce);var se=A(Y,2);{var g=o=>{var f=Tv();Ve(f,"id",`option-content-${ce}`);var I=w(f);Sv(I,{get option(){return d(ue)},index:ce,get dialogues(){return Rt().data.dialogues},get availableItems(){return wt().availableItems},get conditionTypes(){return t}}),L(o,f)};_e(se,o=>{Rt().editingOptionIndex===ce&&o(g)})}de(o=>{R=It(J,1,"option-card svelte-1de8com",null,R,o),Ve(z,"aria-expanded",Rt().editingOptionIndex===ce),fe(pe,`#${ce+1} ${d(ue).text??""}`)},[()=>({editing:Rt().editingOptionIndex===ce})]),L(Fe,J)});var Me=A(Xe,2),De=A(w(Me),2);de(()=>{wt(),mr(()=>{Rt()})});var xe=w(De);xe.value=xe.__value="";var ke=A(xe);et(ke,1,()=>Rt().data.dialogues,Nt,(Fe,ue)=>{var ce=Rv(),J=w(ce),R={};de(Y=>{fe(J,`${d(ue).id??""}: ${Y??""}...`),R!==(R=d(ue).id)&&(ce.value=(ce.__value=d(ue).id)??"")},[()=>d(ue).text.substring(0,30)]),L(Fe,ce)});var Ge=A(Me,2),Qe=w(Ge);Qe.__click=()=>yn.deleteDialogue(wt().currentDialogue.id),Nr(m,()=>wt().currentDialogue.id,Fe=>wt(wt().currentDialogue.id=Fe)),Kn(N,()=>wt().currentDialogue.chapterId,Fe=>wt(wt().currentDialogue.chapterId=Fe)),Nr(D,()=>wt().currentDialogue.text,Fe=>wt(wt().currentDialogue.text=Fe)),Kn(B,()=>wt().currentDialogue.backgroundImage,Fe=>wt(wt().currentDialogue.backgroundImage=Fe)),Kn(we,()=>wt().currentDialogue.characterImage,Fe=>wt(wt().currentDialogue.characterImage=Fe)),Kn(De,()=>wt().currentDialogue.nextDialogueId,Fe=>wt(wt().currentDialogue.nextDialogueId=Fe)),L(p,b)},y=p=>{var b=Mv();L(p,b)};_e(h,p=>{wt().currentDialogue?p(v):p(y,!1)})}L(r,u),$t()}Bt(["change","click","keydown"]);var st=rn(()=>V),Dv=X('<img class="icon-preview svelte-asgatj"/>'),Fv=X('<div class="icon-placeholder svelte-asgatj">📦</div>'),$v=X("<option> </option>"),Nv=X('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Uv=X("<option> </option>"),Bv=X('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Wv=X('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),qv=X('<div class="items-list svelte-asgatj"></div>'),Vv=X('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),Hv=X('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),Gv=X('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function zv(r,e){Ft(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!st().data)return;st().data.items||st(st().data.items=[]);const P={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};st().data.items.push(P),st(st().editingItemIndex=st().data.items.length-1)}function i(P){st().editingItemIndex===P?st(st().editingItemIndex=null):st(st().editingItemIndex=P)}function l(P){confirm("Удалить предмет?")&&st().data?.items&&(st().data.items.splice(P,1),st(st().editingItemIndex=null))}function u(P){if(!st().data?.items)return;const U=st().data.items[P],G={...U,id:`${U.id}_copy_${Date.now()}`,name:`${U.name} (копия)`};st().data.items.splice(P+1,0,G),st(st().editingItemIndex=P+1)}function h(P){return t.find(U=>U.value===P)?.label||P}tn();var v=Gv(),y=w(v);y.__click=()=>st(st().showItems=!st().showItems);var p=w(y),b=A(w(p)),E=A(p,2),m=w(E),S=A(y,2);{var N=P=>{var U=Hv(),G=w(U);{var D=$=>{var B=qv();et(B,7,()=>st().data.items,he=>he.id,(he,le,Se)=>{var be=Wv();let oe;var Ce=w(be);Ce.__click=()=>i(d(Se));var Ue=w(Ce),we=w(Ue),$e=w(we);{var me=M=>{var H=Dv();de(()=>{Ve(H,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${st().selectedBucket}/${d(le).icon}`),Ve(H,"alt",d(le).name)}),L(M,H)},Ye=M=>{var H=Fv();L(M,H)};_e($e,M=>{d(le).icon?M(me):M(Ye,!1)})}var Xe=A(we,2),We=w(Xe),He=w(We),Je=A(We,2),Me=w(Je),De=w(Me),xe=A(Me,2);let ke;var Ge=w(xe),Qe=A(Ue,2),Fe=w(Qe),ue=A(Ce,2),ce=w(ue);ce.__click=()=>u(d(Se));var J=A(ce,2);J.__click=()=>i(d(Se));var R=A(J,2);R.__click=()=>l(d(Se));var Y=A(ue,2);{var z=M=>{var H=Bv(),ee=w(H),Ie=w(ee),je=w(Ie),pe=A(je,2),Q=A(Ie,2),se=w(Q),g=A(se,2),o=A(Q,2),f=w(o),I=A(f,2),j=A(o,2),C=w(j),T=A(C,2),W=w(T),ne=A(W,2);ne.__change=tt=>(d(le).icon=tt.target.value,mr(()=>st()));var te=w(ne);te.value=te.__value="";var ye=A(te);et(ye,1,()=>st().storedFiles.filter(tt=>tt.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Nt,(tt,jt)=>{var rt=$v(),gt=w(rt),Re={};de(()=>{fe(gt,d(jt).name),Re!==(Re=d(jt).name)&&(rt.value=(rt.__value=d(jt).name)??"")}),L(tt,rt)});var Te=A(ne,2),ze=A(w(Te));ze.__change=function(...tt){Zr.uploadNewFile?.apply(this,tt)};var Ke=A(T,2);{var ht=tt=>{var jt=Nv(),rt=w(jt),gt=A(rt,2),Re=w(gt);de(()=>{Ve(rt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${st().selectedBucket}/${d(le).icon}`),fe(Re,d(le).icon)}),L(tt,jt)};_e(Ke,tt=>{d(le).icon&&tt(ht)})}var Pt=A(j,2),Ze=w(Pt),Ct=A(Ze,2);de(()=>{d(le),mr(()=>{d(Se)})}),et(Ct,5,()=>t,Nt,(tt,jt)=>{var rt=Uv(),gt=w(rt),Re={};de(()=>{fe(gt,d(jt).label),Re!==(Re=d(jt).value)&&(rt.value=(rt.__value=d(jt).value)??"")}),L(tt,rt)}),de(()=>{Ve(je,"for",`item-id-${d(Se)??""}`),Ve(pe,"id",`item-id-${d(Se)??""}`),Ve(se,"for",`item-name-${d(Se)??""}`),Ve(g,"id",`item-name-${d(Se)??""}`),Ve(f,"for",`item-desc-${d(Se)??""}`),Ve(I,"id",`item-desc-${d(Se)??""}`),Ve(C,"for",`item-icon-${d(Se)??""}`),Ve(W,"id",`item-icon-${d(Se)??""}`),Ve(Ze,"for",`item-type-${d(Se)??""}`),Ve(Ct,"id",`item-type-${d(Se)??""}`)}),Nr(pe,()=>d(le).id,tt=>(d(le).id=tt,mr(()=>st()))),Nr(g,()=>d(le).name,tt=>(d(le).name=tt,mr(()=>st()))),Nr(I,()=>d(le).description,tt=>(d(le).description=tt,mr(()=>st()))),Nr(W,()=>d(le).icon,tt=>(d(le).icon=tt,mr(()=>st()))),Kn(Ct,()=>d(le).type,tt=>(d(le).type=tt,mr(()=>st()))),L(M,H)};_e(Y,M=>{st().editingItemIndex===d(Se)&&M(z)})}de((M,H,ee)=>{oe=It(be,1,"item-row svelte-asgatj",null,oe,M),Ve(Ce,"aria-label",`Редактировать предмет ${d(le).name??""}`),fe(He,d(le).name),fe(De,d(le).id),ke=It(xe,1,"item-type-badge svelte-asgatj",null,ke,H),fe(Ge,ee),fe(Fe,`${d(le).description??""} || `)},[()=>({editing:st().editingItemIndex===d(Se)}),()=>({tool:d(le).type==="tool",key:d(le).type==="key",consumable:d(le).type==="consumable",quest:d(le).type==="quest",misc:d(le).type==="misc"}),()=>h(d(le).type)]),L(he,be)}),L($,B)},Z=$=>{var B=Vv();L($,B)};_e(G,$=>{st().data?.items?.length?$(D):$(Z,!1)})}var ae=A(G,2);ae.__click=n,L(P,U)};_e(S,P=>{st().showItems&&P(N)})}de(()=>{Ve(y,"title",st().showItems?"Скрыть предметы":"Показать предметы"),Ve(y,"aria-expanded",st().showItems),fe(b,` Предметы (${(st().data?.items?.length||0)??""})`),fe(m,st().showItems?"▼":"▶")}),L(r,v),$t()}Bt(["click","change"]);Bt(["click"]);class Kv{#i=Ne(yt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return d(this.#i)}set player(e){ie(this.#i,e,!0)}#r=Ne(null);get storyData(){return d(this.#r)}set storyData(e){ie(this.#r,e,!0)}#e=Ne("0");get currentDialogueId(){return d(this.#e)}set currentDialogueId(e){ie(this.#e,e,!0)}#s=Ne(!0);get isLoading(){return d(this.#s)}set isLoading(e){ie(this.#s,e,!0)}#a=Ne("");get error(){return d(this.#a)}set error(e){ie(this.#a,e,!0)}#t=Ne(null);get selectedStory(){return d(this.#t)}set selectedStory(e){ie(this.#t,e,!0)}#n=Ne(yt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return d(this.#n)}set availableStories(e){ie(this.#n,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Tt=new Kv;var ps={exports:{}},Yv=ps.exports,Tl;function Jv(){return Tl||(Tl=1,(function(r,e){(function(n,i){r.exports=i()})(Yv,()=>(()=>{var t=[,((u,h,v)=>{v.r(h),v.d(h,{default:()=>p});var y=(()=>{var b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(E={}){var m=E,S,N;m.ready=new Promise((s,a)=>{S=s,N=a});function P(){function s(O){const K=_;c=a=0,_=new Map,K.forEach(re=>{try{re(O)}catch(q){console.error(q)}}),this.pb(),k&&k.Tb()}let a=0,c=0,_=new Map,k=null,x=null;this.requestAnimationFrame=function(O){a||(a=requestAnimationFrame(s.bind(this)));const K=++c;return _.set(K,O),K},this.cancelAnimationFrame=function(O){_.delete(O),a&&_.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(O){x&&(document.body.remove(x),x=null),O||(x=document.createElement("div"),x.style.backgroundColor="black",x.style.position="fixed",x.style.right=0,x.style.top=0,x.style.color="white",x.style.padding="4px",x.innerHTML="RIVE FPS",O=function(K){x.innerHTML="RIVE FPS "+K.toFixed(1)},document.body.appendChild(x)),k=new function(){let K=0,re=0;this.Tb=function(){var q=performance.now();re?(++K,q-=re,1e3<q&&(O(1e3*K/q),K=re=0)):(re=q,K=0)}}},this.Ob=function(){x&&(document.body.remove(x),x=null),k=null},this.pb=function(){}}function U(s){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(_){return _=_+((1<<s)-1)>>s,a.has(_)&&clearTimeout(a.get(_)),a.set(_,setTimeout(function(){a.delete(_),a.length==0?c=-1/0:_==c&&(c=Math.max(...a.keys()),console.assert(c<_))},1e3)),c=Math.max(_,c),c<<s}}const G=m.onRuntimeInitialized;m.onRuntimeInitialized=function(){G&&G();let s=m.decodeAudio;m.decodeAudio=function(k,x){k=s(k),x(k)};let a=m.decodeFont;m.decodeFont=function(k,x){k=a(k),x(k)};const c=m.FileAssetLoader;m.ptrToAsset=k=>{let x=m.ptrToFileAsset(k);return x.isImage?m.ptrToImageAsset(k):x.isFont?m.ptrToFontAsset(k):x.isAudio?m.ptrToAudioAsset(k):x},m.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:k}){this.__parent.__construct.call(this),this.Gb=k},loadContents:function(k,x){return k=m.ptrToAsset(k),this.Gb(k,x)}}),m.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(k){let x=m.ptrToAsset(k);return k=x.cdnUuid,k===""?!1:((function(O,K){var re=new XMLHttpRequest;re.responseType="arraybuffer",re.onreadystatechange=function(){re.readyState==4&&re.status==200&&K(re)},re.open("GET",O,!0),re.send(null)})(x.cdnBaseUrl+"/"+k,O=>{x.decode(new Uint8Array(O.response))}),!0)}}),m.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(k){this.lb.push(k)},loadContents:function(k,x){for(let O of this.lb)if(O.loadContents(k,x))return!0;return!1}});let _=m.computeAlignment;m.computeAlignment=function(k,x,O,K,re=1){return _.call(this,k,x,O,K,re)}};const D="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),Z=new function(){function s(){if(!a){let lt=function(ct,Oe,Mt){if(Oe=ge.createShader(Oe),ge.shaderSource(Oe,Mt),ge.compileShader(Oe),Mt=ge.getShaderInfoLog(Oe),0<(Mt||"").length)throw Mt;ge.attachShader(ct,Oe)};var F=document.createElement("canvas"),Ee={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let ge;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(ge=F.getContext("webgl",Ee),c=1,!ge)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(ge=F.getContext("webgl2",Ee))c=2;else if(ge=F.getContext("webgl",Ee))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(ge=new Proxy(ge,{get(ct,Oe){if(ct.isContextLost()){if(re||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Oe),re=!0),typeof ct[Oe]=="function")return function(){}}else return typeof ct[Oe]=="function"?function(...Mt){return ct[Oe].apply(ct,Mt)}:ct[Oe]},set(ct,Oe,Mt){if(ct.isContextLost())re||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Oe),re=!0);else return ct[Oe]=Mt,!0}}),_=Math.min(ge.getParameter(ge.MAX_RENDERBUFFER_SIZE),ge.getParameter(ge.MAX_TEXTURE_SIZE)),F=ge.createProgram(),lt(F,ge.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),lt(F,ge.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),ge.bindAttribLocation(F,0,"vertex"),ge.bindAttribLocation(F,1,"uv"),ge.linkProgram(F),Ee=ge.getProgramInfoLog(F),0<(Ee||"").trim().length)throw Ee;k=ge.getUniformLocation(F,"mat"),x=ge.getUniformLocation(F,"translate"),ge.useProgram(F),ge.bindBuffer(ge.ARRAY_BUFFER,ge.createBuffer()),ge.enableVertexAttribArray(0),ge.enableVertexAttribArray(1),ge.bindBuffer(ge.ELEMENT_ARRAY_BUFFER,ge.createBuffer()),ge.uniform1i(ge.getUniformLocation(F,"image"),0),ge.pixelStorei(ge.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=ge}return!0}let a=null,c=0,_=0,k=null,x=null,O=0,K=0,re=!1;s(),this.hc=function(){return s(),_},this.Mb=function(F){a.deleteTexture&&a.deleteTexture(F)},this.Lb=function(F){if(!s())return null;const Ee=a.createTexture();return Ee?(a.bindTexture(a.TEXTURE_2D,Ee),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,F),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),Ee):null};const q=new U(8),Ae=new U(8),Pe=new U(10),Be=new U(10);this.Qb=function(F,Ee,ge,lt,ct){if(s()){var Oe=q.push(F),Mt=Ae.push(Ee);if(a.canvas){(a.canvas.width!=Oe||a.canvas.height!=Mt)&&(a.canvas.width=Oe,a.canvas.height=Mt),a.viewport(0,Mt-Ee,F,Ee),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),ge.sort((_t,Sr)=>Sr.xb-_t.xb),Oe=Pe.push(lt),O!=Oe&&(a.bufferData(a.ARRAY_BUFFER,8*Oe,a.DYNAMIC_DRAW),O=Oe),Oe=0;for(var Xt of ge)a.bufferSubData(a.ARRAY_BUFFER,Oe,Xt.Ua),Oe+=4*Xt.Ua.length;console.assert(Oe==4*lt);for(var Ir of ge)a.bufferSubData(a.ARRAY_BUFFER,Oe,Ir.Db),Oe+=4*Ir.Db.length;console.assert(Oe==8*lt),Oe=Be.push(ct),K!=Oe&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*Oe,a.DYNAMIC_DRAW),K=Oe),Xt=0;for(var un of ge)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Xt,un.indices),Xt+=2*un.indices.length;console.assert(Xt==2*ct),un=0,Ir=!0,Oe=Xt=0;for(const _t of ge){_t.image.Ka!=un&&(a.bindTexture(a.TEXTURE_2D,_t.image.Ja||null),un=_t.image.Ka),_t.mc?(a.scissor(_t.Za,Mt-_t.$a-_t.kb,_t.Ac,_t.kb),Ir=!0):Ir&&(a.scissor(0,Mt-Ee,F,Ee),Ir=!1),ge=2/F;const Sr=-2/Ee;a.uniform4f(k,_t.ha[0]*ge*_t.Ba,_t.ha[1]*Sr*_t.Ca,_t.ha[2]*ge*_t.Ba,_t.ha[3]*Sr*_t.Ca),a.uniform2f(x,_t.ha[4]*ge*_t.Ba+ge*(_t.Za-_t.ic*_t.Ba)-1,_t.ha[5]*Sr*_t.Ca+Sr*(_t.$a-_t.jc*_t.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,Oe),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,Oe+4*lt),a.drawElements(a.TRIANGLES,_t.indices.length,a.UNSIGNED_SHORT,Xt),Oe+=4*_t.Ua.length,Xt+=2*_t.indices.length}console.assert(Oe==4*lt),console.assert(Xt==2*ct)}}},this.canvas=function(){return s()&&a.canvas}},ae=m.onRuntimeInitialized;m.onRuntimeInitialized=function(){function s(ve){switch(ve){case q.srcOver:return"source-over";case q.screen:return"screen";case q.overlay:return"overlay";case q.darken:return"darken";case q.lighten:return"lighten";case q.colorDodge:return"color-dodge";case q.colorBurn:return"color-burn";case q.hardLight:return"hard-light";case q.softLight:return"soft-light";case q.difference:return"difference";case q.exclusion:return"exclusion";case q.multiply:return"multiply";case q.hue:return"hue";case q.saturation:return"saturation";case q.color:return"color";case q.luminosity:return"luminosity"}}function a(ve){return"rgba("+((16711680&ve)>>>16)+","+((65280&ve)>>>8)+","+((255&ve)>>>0)+","+((4278190080&ve)>>>24)/255+")"}function c(){0<Mt.length&&(Z.Qb(Oe.drawWidth(),Oe.drawHeight(),Mt,Xt,Ir),Mt=[],Ir=Xt=0,Oe.reset(512,512));for(const ve of ct){for(const Le of ve.H)Le();ve.H=[]}ct.clear()}ae&&ae();var _=m.RenderPaintStyle;const k=m.RenderPath,x=m.RenderPaint,O=m.Renderer,K=m.StrokeCap,re=m.StrokeJoin,q=m.BlendMode,Ae=_.fill,Pe=_.stroke,Be=m.FillRule.evenOdd;let F=1;var Ee=m.RenderImage.extend("CanvasRenderImage",{__construct:function({la:ve,xa:Le}={}){this.__parent.__construct.call(this),this.Ka=F,F=F+1&2147483647||1,this.la=ve,this.xa=Le},__destruct:function(){this.Ja&&(Z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(ve){var Le=this;Le.xa&&Le.xa(Le);var ft=new Image;Le.Xa=URL.createObjectURL(new Blob([ve],{type:"image/png"})),ft.onload=function(){Le.Fb=ft,Le.Ja=Z.Lb(ft),Le.size(ft.width,ft.height),Le.la&&Le.la(Le)},ft.src=Le.Xa}}),ge=k.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(ve,Le,ft,mt,ut,vt,St){var At=this.T,gr=At.addPath;ve=ve.T;const Gt=new DOMMatrix;Gt.a=Le,Gt.b=ft,Gt.c=mt,Gt.d=ut,Gt.e=vt,Gt.f=St,gr.call(At,ve,Gt)},fillRule:function(ve){this.Wa=ve},moveTo:function(ve,Le){this.T.moveTo(ve,Le)},lineTo:function(ve,Le){this.T.lineTo(ve,Le)},cubicTo:function(ve,Le,ft,mt,ut,vt){this.T.bezierCurveTo(ve,Le,ft,mt,ut,vt)},close:function(){this.T.closePath()}}),lt=x.extend("CanvasRenderPaint",{color:function(ve){this.Ya=a(ve)},thickness:function(ve){this.Ib=ve},join:function(ve){switch(ve){case re.miter:this.Ia="miter";break;case re.round:this.Ia="round";break;case re.bevel:this.Ia="bevel"}},cap:function(ve){switch(ve){case K.butt:this.Ha="butt";break;case K.round:this.Ha="round";break;case K.square:this.Ha="square"}},style:function(ve){this.Hb=ve},blendMode:function(ve){this.Eb=s(ve)},clearGradient:function(){this.ja=null},linearGradient:function(ve,Le,ft,mt){this.ja={zb:ve,Ab:Le,cb:ft,eb:mt,Ra:[]}},radialGradient:function(ve,Le,ft,mt){this.ja={zb:ve,Ab:Le,cb:ft,eb:mt,Ra:[],ec:!0}},addStop:function(ve,Le){this.ja.Ra.push({color:ve,stop:Le})},completeGradient:function(){},draw:function(ve,Le,ft){let mt=this.Hb;var ut=this.Ya,vt=this.ja;if(ve.globalCompositeOperation=this.Eb,vt!=null){ut=vt.zb;var St=vt.Ab;const gr=vt.cb;var At=vt.eb;const Gt=vt.Ra;vt.ec?(vt=gr-ut,At-=St,ut=ve.createRadialGradient(ut,St,0,ut,St,Math.sqrt(vt*vt+At*At))):ut=ve.createLinearGradient(ut,St,gr,At);for(let ur=0,zt=Gt.length;ur<zt;ur++)St=Gt[ur],ut.addColorStop(St.stop,a(St.color));this.Ya=ut,this.ja=null}switch(mt){case Pe:ve.strokeStyle=ut,ve.lineWidth=this.Ib,ve.lineCap=this.Ha,ve.lineJoin=this.Ia,ve.stroke(Le);break;case Ae:ve.fillStyle=ut,ve.fill(Le,ft)}}});const ct=new Set;let Oe=null,Mt=[],Xt=0,Ir=0;var un=m.CanvasRenderer=O.extend("Renderer",{__construct:function(ve){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=ve.getContext("2d"),this.Va=ve,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const ve=this.S.length-6;if(6>ve)throw"restore() called without matching save().";this.S.splice(ve),this.H.push(this.C.restore.bind(this.C))},transform:function(ve,Le,ft,mt,ut,vt){const St=this.S,At=St.length-6;St.splice(At,6,St[At]*ve+St[At+2]*Le,St[At+1]*ve+St[At+3]*Le,St[At]*ft+St[At+2]*mt,St[At+1]*ft+St[At+3]*mt,St[At]*ut+St[At+2]*vt+St[At+4],St[At+1]*ut+St[At+3]*vt+St[At+5]),this.H.push(this.C.transform.bind(this.C,ve,Le,ft,mt,ut,vt))},rotate:function(ve){const Le=Math.sin(ve);ve=Math.cos(ve),this.transform(ve,Le,-Le,ve,0,0)},_drawPath:function(ve,Le){this.H.push(Le.draw.bind(Le,this.C,ve.T,ve.Wa===Be?"evenodd":"nonzero"))},_drawRiveImage:function(ve,Le,ft,mt){var ut=ve.Fb;if(ut){var vt=this.C,St=s(ft);this.H.push(function(){vt.globalCompositeOperation=St,vt.globalAlpha=mt,vt.drawImage(ut,0,0),vt.globalAlpha=1})}},_getMatrix:function(ve){const Le=this.S,ft=Le.length-6;for(let mt=0;6>mt;++mt)ve[mt]=Le[ft+mt]},_drawImageMesh:function(ve,Le,ft,mt,ut,vt,St,At,gr,Gt,ur){Le=this.C.canvas.width;var zt=this.C.canvas.height;const No=Gt-At,Uo=ur-gr;At=Math.max(At,0),gr=Math.max(gr,0),Gt=Math.min(Gt,Le),ur=Math.min(ur,zt);const wi=Gt-At,ki=ur-gr;if(console.assert(wi<=Math.min(No,Le)),console.assert(ki<=Math.min(Uo,zt)),!(0>=wi||0>=ki)){Gt=wi<No||ki<Uo,Le=ur=1;var cn=Math.ceil(wi*ur),dn=Math.ceil(ki*Le);zt=Z.hc(),cn>zt&&(ur*=zt/cn,cn=zt),dn>zt&&(Le*=zt/dn,dn=zt),Oe||(Oe=new m.DynamicRectanizer(zt),Oe.reset(512,512)),zt=Oe.addRect(cn,dn),0>zt&&(c(),ct.add(this),zt=Oe.addRect(cn,dn),console.assert(0<=zt));var Bo=zt&65535,Wo=zt>>16;Mt.push({ha:this.S.slice(this.S.length-6),image:ve,Za:Bo,$a:Wo,ic:At,jc:gr,Ac:cn,kb:dn,Ba:ur,Ca:Le,Ua:new Float32Array(ut),Db:new Float32Array(vt),indices:new Uint16Array(St),mc:Gt,xb:ve.Ka<<1|(Gt?1:0)}),Xt+=ut.length,Ir+=St.length;var On=this.C,dc=s(ft);this.H.push(function(){On.save(),On.resetTransform(),On.globalCompositeOperation=dc,On.globalAlpha=mt;const qo=Z.canvas();qo&&On.drawImage(qo,Bo,Wo,cn,dn,At,gr,wi,ki),On.restore()})}},_clipPath:function(ve){this.H.push(this.C.clip.bind(this.C,ve.T,ve.Wa===Be?"evenodd":"nonzero"))},clear:function(){ct.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(ve,Le){this.transform(1,0,0,1,ve,Le)}});m.makeRenderer=function(ve){const Le=new un(ve),ft=Le.C;return new Proxy(Le,{get(mt,ut){if(typeof mt[ut]=="function")return function(...vt){return mt[ut].apply(mt,vt)};if(typeof ft[ut]=="function"){if(-1<D.indexOf(ut))throw Error("RiveException: Method call to '"+ut+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...vt){Le.H.push(ft[ut].bind(ft,...vt))}}return mt[ut]},set(mt,ut,vt){if(ut in ft)return Le.H.push(()=>{ft[ut]=vt}),!0}})},m.decodeImage=function(ve,Le){new Ee({la:Le}).decode(ve)},m.renderFactory={makeRenderPaint:function(){return new lt},makeRenderPath:function(){return new ge},makeRenderImage:function(){let ve=Sr;return new Ee({xa:()=>{ve.total++},la:()=>{if(ve.loaded++,ve.loaded===ve.total){const Le=ve.ready;Le&&(Le(),ve.ready=null)}}})}};let _t=m.load,Sr=null;m.load=function(ve,Le,ft=!0){const mt=new m.FallbackFileAssetLoader;return Le!==void 0&&mt.addLoader(Le),ft&&(Le=new m.CDNFileAssetLoader,mt.addLoader(Le)),new Promise(function(ut){let vt=null;Sr={total:0,loaded:0,ready:function(){ut(vt)}},vt=_t(ve,mt),Sr.total==0&&ut(vt)})};let cc=m.RendererWrapper.prototype.align;m.RendererWrapper.prototype.align=function(ve,Le,ft,mt,ut=1){cc.call(this,ve,Le,ft,mt,ut)},_=new P,m.requestAnimationFrame=_.requestAnimationFrame.bind(_),m.cancelAnimationFrame=_.cancelAnimationFrame.bind(_),m.enableFPSCounter=_.Rb.bind(_),m.disableFPSCounter=_.Ob,_.pb=c,m.resolveAnimationFrame=c,m.cleanup=function(){Oe&&Oe.delete()}};var $=Object.assign({},m),B="./this.program",he=typeof window=="object",le=typeof importScripts=="function",Se="",be,oe;(he||le)&&(le?Se=self.location.href:typeof document<"u"&&document.currentScript&&(Se=document.currentScript.src),b&&(Se=b),Se.indexOf("blob:")!==0?Se=Se.substr(0,Se.replace(/[?#].*/,"").lastIndexOf("/")+1):Se="",le&&(oe=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),be=(s,a,c)=>{var _=new XMLHttpRequest;_.open("GET",s,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?a(_.response):c()},_.onerror=c,_.send(null)});var Ce=m.print||console.log.bind(console),Ue=m.printErr||console.error.bind(console);Object.assign(m,$),$=null,m.thisProgram&&(B=m.thisProgram);var we;m.wasmBinary&&(we=m.wasmBinary),m.noExitRuntime,typeof WebAssembly!="object"&&z("no native wasm support detected");var $e,me,Ye=!1,Xe,We,He,Je,Me,De,xe,ke;function Ge(){var s=$e.buffer;m.HEAP8=Xe=new Int8Array(s),m.HEAP16=He=new Int16Array(s),m.HEAP32=Me=new Int32Array(s),m.HEAPU8=We=new Uint8Array(s),m.HEAPU16=Je=new Uint16Array(s),m.HEAPU32=De=new Uint32Array(s),m.HEAPF32=xe=new Float32Array(s),m.HEAPF64=ke=new Float64Array(s)}var Qe,Fe=[],ue=[],ce=[];function J(){var s=m.preRun.shift();Fe.unshift(s)}var R=0,Y=null;function z(s){throw m.onAbort&&m.onAbort(s),s="Aborted("+s+")",Ue(s),Ye=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),N(s),s}function M(s){return s.startsWith("data:application/octet-stream;base64,")}var H;if(H="canvas_advanced.wasm",!M(H)){var ee=H;H=m.locateFile?m.locateFile(ee,Se):Se+ee}function Ie(s){if(s==H&&we)return new Uint8Array(we);if(oe)return oe(s);throw"both async and sync fetching of the wasm failed"}function je(s){if(!we&&(he||le)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>Ie(s));if(be)return new Promise((a,c)=>{be(s,_=>a(new Uint8Array(_)),c)})}return Promise.resolve().then(()=>Ie(s))}function pe(s,a,c){return je(s).then(_=>WebAssembly.instantiate(_,a)).then(_=>_).then(c,_=>{Ue("failed to asynchronously prepare wasm: "+_),z(_)})}function Q(s,a){var c=H;return we||typeof WebAssembly.instantiateStreaming!="function"||M(c)||c.startsWith("file://")||typeof fetch!="function"?pe(c,s,a):fetch(c,{credentials:"same-origin"}).then(_=>WebAssembly.instantiateStreaming(_,s).then(a,function(k){return Ue("wasm streaming compile failed: "+k),Ue("falling back to ArrayBuffer instantiation"),pe(c,s,a)}))}var se,g,o={460492:(s,a,c,_,k)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=_,window.h.ga.yb=k;let x=window.h;x.D=[],x.yc=function(O){for(var K=0;K<x.D.length;++K)if(x.D[K]==null)return x.D[K]=O,K;return x.D.push(O),x.D.length-1},x.Cb=function(O){for(x.D[O]=null;0<x.D.length&&x.D[x.D.length-1]==null;)x.D.pop()},x.Sc=function(O){for(var K=0;K<x.D.length;++K)if(x.D[K]==O)return x.Cb(K)},x.ra=function(O){return x.D[O]},x.Ta=["touchend","click"],x.unlock=function(){for(var O=0;O<x.D.length;++O){var K=x.D[O];K!=null&&K.J!=null&&K.state===x.ga.yb&&K.J.resume().then(()=>{Mo(K.qb)},re=>{console.error("Failed to resume audiocontext",re)})}x.Ta.map(function(re){document.removeEventListener(re,x.unlock,!0)})},x.Ta.map(function(O){document.addEventListener(O,x.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),a=s.sampleRate;return s.close(),a}catch{return 0}},463249:(s,a,c,_,k,x)=>{if(typeof window.h>"u")return-1;var O={},K={};return s==window.h.I.ya&&c!=0&&(K.sampleRate=c),O.J=new(window.AudioContext||window.webkitAudioContext)(K),O.J.suspend(),O.state=window.h.ga.stopped,c=0,s!=window.h.I.ya&&(c=a),O.Z=O.J.createScriptProcessor(_,c,a),O.Z.onaudioprocess=function(re){if((O.sa==null||O.sa.length==0)&&(O.sa=new Float32Array(xe.buffer,k,_*a)),s==window.h.I.capture||s==window.h.I.La){for(var q=0;q<a;q+=1)for(var Ae=re.inputBuffer.getChannelData(q),Pe=O.sa,Be=0;Be<_;Be+=1)Pe[Be*a+q]=Ae[Be];Lo(x,_,k)}if(s==window.h.I.ya||s==window.h.I.La)for(Do(x,_,k),q=0;q<re.outputBuffer.numberOfChannels;++q)for(Ae=re.outputBuffer.getChannelData(q),Pe=O.sa,Be=0;Be<_;Be+=1)Ae[Be]=Pe[Be*a+q];else for(q=0;q<re.outputBuffer.numberOfChannels;++q)re.outputBuffer.getChannelData(q).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(re){O.Da=O.J.createMediaStreamSource(re),O.Da.connect(O.Z),O.Z.connect(O.J.destination)}).catch(function(re){console.log("Failed to get user media: "+re)}),s==window.h.I.ya&&O.Z.connect(O.J.destination),O.qb=x,window.h.yc(O)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},f=s=>{for(;0<s.length;)s.shift()(m)},I=(s,a)=>{for(var c=0,_=s.length-1;0<=_;_--){var k=s[_];k==="."?s.splice(_,1):k===".."?(s.splice(_,1),c++):c&&(s.splice(_,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},j=s=>{var a=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=I(s.split("/").filter(_=>!!_),!a).join("/"))||a||(s="."),s&&c&&(s+="/"),(a?"/":"")+s},C=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},T=s=>{if(s==="/")return"/";s=j(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},W=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);z("initRandomDevice")},ne=s=>(ne=W())(s);function te(){for(var s="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=I(s.split("/").filter(_=>!!_),!a).join("/"),(a?"/":"")+s||"."}var ye=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Te=(s,a,c)=>{var _=a+c;for(c=a;s[c]&&!(c>=_);)++c;if(16<c-a&&s.buffer&&ye)return ye.decode(s.subarray(a,c));for(_="";a<c;){var k=s[a++];if(k&128){var x=s[a++]&63;if((k&224)==192)_+=String.fromCharCode((k&31)<<6|x);else{var O=s[a++]&63;k=(k&240)==224?(k&15)<<12|x<<6|O:(k&7)<<18|x<<12|O<<6|s[a++]&63,65536>k?_+=String.fromCharCode(k):(k-=65536,_+=String.fromCharCode(55296|k>>10,56320|k&1023))}}else _+=String.fromCharCode(k)}return _},ze=[],Ke=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);127>=_?a++:2047>=_?a+=2:55296<=_&&57343>=_?(a+=4,++c):a+=3}return a},ht=(s,a,c,_)=>{if(!(0<_))return 0;var k=c;_=c+_-1;for(var x=0;x<s.length;++x){var O=s.charCodeAt(x);if(55296<=O&&57343>=O){var K=s.charCodeAt(++x);O=65536+((O&1023)<<10)|K&1023}if(127>=O){if(c>=_)break;a[c++]=O}else{if(2047>=O){if(c+1>=_)break;a[c++]=192|O>>6}else{if(65535>=O){if(c+2>=_)break;a[c++]=224|O>>12}else{if(c+3>=_)break;a[c++]=240|O>>18,a[c++]=128|O>>12&63}a[c++]=128|O>>6&63}a[c++]=128|O&63}}return a[c]=0,c-k};function Pt(s,a){var c=Array(Ke(s)+1);return s=ht(s,c,0,c.length),a&&(c.length=s),c}var Ze=[];function Ct(s,a){Ze[s]={input:[],F:[],V:a},Ls(s,tt)}var tt={open:function(s){var a=Ze[s.node.za];if(!a)throw new qe(43);s.s=a,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,a,c,_){if(!s.s||!s.s.V.jb)throw new qe(60);for(var k=0,x=0;x<_;x++){try{var O=s.s.V.jb(s.s)}catch{throw new qe(29)}if(O===void 0&&k===0)throw new qe(6);if(O==null)break;k++,a[c+x]=O}return k&&(s.node.timestamp=Date.now()),k},write:function(s,a,c,_){if(!s.s||!s.s.V.Oa)throw new qe(60);try{for(var k=0;k<_;k++)s.s.V.Oa(s.s,a[c+k])}catch{throw new qe(29)}return _&&(s.node.timestamp=Date.now()),k}},jt={jb:function(){e:{if(!ze.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}ze=Pt(s,!0)}s=ze.shift()}return s},Oa:function(s,a){a===null||a===10?(Ce(Te(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(Ce(Te(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},rt={Oa:function(s,a){a===null||a===10?(Ue(Te(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(Ue(Te(s.F,0)),s.F=[])}};function gt(s,a){var c=s.j?s.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=s.j,s.j=new Uint8Array(a),0<s.v&&s.j.set(c.subarray(0,s.v),0))}var Re={O:null,U(){return Re.createNode(null,"/",16895,0)},createNode(s,a,c,_){if((c&61440)===24576||(c&61440)===4096)throw new qe(63);return Re.O||(Re.O={dir:{node:{Y:Re.l.Y,P:Re.l.P,ka:Re.l.ka,va:Re.l.va,vb:Re.l.vb,Bb:Re.l.Bb,wb:Re.l.wb,tb:Re.l.tb,Ea:Re.l.Ea},stream:{ba:Re.m.ba}},file:{node:{Y:Re.l.Y,P:Re.l.P},stream:{ba:Re.m.ba,read:Re.m.read,write:Re.m.write,pa:Re.m.pa,mb:Re.m.mb,ob:Re.m.ob}},link:{node:{Y:Re.l.Y,P:Re.l.P,ma:Re.l.ma},stream:{}},ab:{node:{Y:Re.l.Y,P:Re.l.P},stream:Wu}}),c=ro(s,a,c,_),(c.mode&61440)===16384?(c.l=Re.O.dir.node,c.m=Re.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Re.O.file.node,c.m=Re.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Re.O.link.node,c.m=Re.O.link.stream):(c.mode&61440)===8192&&(c.l=Re.O.ab.node,c.m=Re.O.ab.stream),c.timestamp=Date.now(),s&&(s.j[a]=c,s.timestamp=c.timestamp),c},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var a={};return a.Jc=(s.mode&61440)===8192?s.id:1,a.Mc=s.id,a.mode=s.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=s.za,(s.mode&61440)===16384?a.size=4096:(s.mode&61440)===32768?a.size=s.v:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Bc=new Date(s.timestamp),a.Nc=new Date(s.timestamp),a.Ic=new Date(s.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.v!=a))if(a==0)s.j=null,s.v=0;else{var c=s.j;s.j=new Uint8Array(a),c&&s.j.set(c.subarray(0,Math.min(a,s.v))),s.v=a}},ka(){throw Ms[44]},va(s,a,c,_){return Re.createNode(s,a,c,_)},vb(s,a,c){if((s.mode&61440)===16384){try{var _=Ui(a,c)}catch{}if(_)for(var k in _.j)throw new qe(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=c,a.j[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},Bb(s,a){delete s.j[a],s.timestamp=Date.now()},wb(s,a){var c=Ui(s,a),_;for(_ in c.j)throw new qe(55);delete s.j[a],s.timestamp=Date.now()},tb(s){var a=[".",".."],c;for(c in s.j)s.j.hasOwnProperty(c)&&a.push(c);return a},Ea(s,a,c){return s=Re.createNode(s,a,41471,0),s.link=c,s},ma(s){if((s.mode&61440)!==40960)throw new qe(28);return s.link}},m:{read(s,a,c,_,k){var x=s.node.j;if(k>=s.node.v)return 0;if(s=Math.min(s.node.v-k,_),8<s&&x.subarray)a.set(x.subarray(k,k+s),c);else for(_=0;_<s;_++)a[c+_]=x[k+_];return s},write(s,a,c,_,k,x){if(a.buffer===Xe.buffer&&(x=!1),!_)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.j||s.j.subarray)){if(x)return s.j=a.subarray(c,c+_),s.v=_;if(s.v===0&&k===0)return s.j=a.slice(c,c+_),s.v=_;if(k+_<=s.v)return s.j.set(a.subarray(c,c+_),k),_}if(gt(s,k+_),s.j.subarray&&a.subarray)s.j.set(a.subarray(c,c+_),k);else for(x=0;x<_;x++)s.j[k+x]=a[c+x];return s.v=Math.max(s.v,k+_),_},ba(s,a,c){if(c===1?a+=s.position:c===2&&(s.node.mode&61440)===32768&&(a+=s.node.v),0>a)throw new qe(28);return a},pa(s,a,c){gt(s.node,a+c),s.node.v=Math.max(s.node.v,a+c)},mb(s,a,c,_,k){if((s.node.mode&61440)!==32768)throw new qe(43);if(s=s.node.j,k&2||s.buffer!==Xe.buffer){if((0<c||c+a<s.length)&&(s.subarray?s=s.subarray(c,c+a):s=Array.prototype.slice.call(s,c,c+a)),c=!0,z(),a=void 0,!a)throw new qe(48);Xe.set(s,a)}else c=!1,a=s.byteOffset;return{o:a,M:c}},ob(s,a,c,_){return Re.m.write(s,a,0,_,c,!1),0}}};function it(s,a){var c=0;return s&&(c|=365),a&&(c|=146),c}var qt=null,jn={},Ni=[],Uu=1,fi=null,Za=!0,qe=null,Ms={},an=(s,a={})=>{if(s=te(s),!s)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new qe(32);s=s.split("/").filter(O=>!!O);for(var c=qt,_="/",k=0;k<s.length;k++){var x=k===s.length-1;if(x&&a.parent)break;if(c=Ui(c,s[k]),_=j(_+"/"+s[k]),c.wa&&(!x||x&&a.hb)&&(c=c.wa.root),!x||a.gb){for(x=0;(c.mode&61440)===40960;)if(c=qu(_),_=te(C(_),c),c=an(_,{Qa:a.Qa+1}).node,40<x++)throw new qe(32)}}return{path:_,node:c}},eo=s=>{for(var a;;){if(s===s.parent)return s=s.U.nb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}},to=(s,a)=>{for(var c=0,_=0;_<a.length;_++)c=(c<<5)-c+a.charCodeAt(_)|0;return(s+c>>>0)%fi.length},Ui=(s,a)=>{var c;if(c=(c=Bi(s,"x"))?c:s.l.ka?0:2)throw new qe(c,s);for(c=fi[to(s.id,a)];c;c=c.lc){var _=c.name;if(c.parent.id===s.id&&_===a)return c}return s.l.ka(s,a)},ro=(s,a,c,_)=>(s=new To(s,a,c,_),a=to(s.parent.id,s.name),s.lc=fi[a],fi[a]=s),no=s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},Bi=(s,a)=>{if(Za)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},io=(s,a)=>{try{return Ui(s,a),20}catch{}return Bi(s,"wx")},Bu=()=>{for(var s=0;4096>=s;s++)if(!Ni[s])return s;throw new qe(33)},Vr=s=>{if(s=Ni[s],!s)throw new qe(8);return s},so=(s,a=-1)=>(vi||(vi=function(){this.h={}},vi.prototype={},Object.defineProperties(vi.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),s=Object.assign(new vi,s),a==-1&&(a=Bu()),s.X=a,Ni[a]=s),Wu={open:s=>{s.m=jn[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new qe(70)}},Ls=(s,a)=>{jn[s]={m:a}},ao=(s,a)=>{var c=a==="/",_=!a;if(c&&qt)throw new qe(10);if(!c&&!_){var k=an(a,{hb:!1});if(a=k.path,k=k.node,k.wa)throw new qe(10);if((k.mode&61440)!==16384)throw new qe(54)}a={type:s,Qc:{},nb:a,kc:[]},s=s.U(a),s.U=a,a.root=s,c?qt=s:k&&(k.wa=a,k.U&&k.U.kc.push(a))},hr=(s,a,c)=>{var _=an(s,{parent:!0}).node;if(s=T(s),!s||s==="."||s==="..")throw new qe(28);var k=io(_,s);if(k)throw new qe(k);if(!_.l.va)throw new qe(63);return _.l.va(_,s,a,c)},Wi=(s,a,c)=>{typeof c>"u"&&(c=a,a=438),hr(s,a|8192,c)},Ds=(s,a)=>{if(!te(s))throw new qe(44);var c=an(a,{parent:!0}).node;if(!c)throw new qe(44);a=T(a);var _=io(c,a);if(_)throw new qe(_);if(!c.l.Ea)throw new qe(63);c.l.Ea(c,a,s)},qu=s=>{if(s=an(s).node,!s)throw new qe(44);if(!s.l.ma)throw new qe(28);return te(eo(s.parent),s.l.ma(s))},qi=(s,a,c)=>{if(s==="")throw new qe(44);if(typeof a=="string"){var _={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof _>"u")throw Error(`Unknown file open mode: ${a}`);a=_}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var k=s;else{s=j(s);try{k=an(s,{gb:!(a&131072)}).node}catch{}}if(_=!1,a&64)if(k){if(a&128)throw new qe(20)}else k=hr(s,c,0),_=!0;if(!k)throw new qe(44);if((k.mode&61440)===8192&&(a&=-513),a&65536&&(k.mode&61440)!==16384)throw new qe(54);if(!_&&(c=k?(k.mode&61440)===40960?32:(k.mode&61440)===16384&&(no(a)!=="r"||a&512)?31:Bi(k,no(a)):44))throw new qe(c);if(a&512&&!_){if(c=k,c=typeof c=="string"?an(c,{gb:!0}).node:c,!c.l.P)throw new qe(63);if((c.mode&61440)===16384)throw new qe(31);if((c.mode&61440)!==32768)throw new qe(28);if(_=Bi(c,"w"))throw new qe(_);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,k=so({node:k,path:eo(k),flags:a,seekable:!0,position:0,m:k.m,zc:[],error:!1}),k.m.open&&k.m.open(k),!m.logReadFiles||a&1||(Vi||(Vi={}),s in Vi||(Vi[s]=1)),k},oo=(s,a,c)=>{if(s.X===null)throw new qe(8);if(!s.seekable||!s.m.ba)throw new qe(70);if(c!=0&&c!=1&&c!=2)throw new qe(28);s.position=s.m.ba(s,a,c),s.zc=[]},lo=()=>{qe||(qe=function(s,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(s),this.message="FS error"},qe.prototype=Error(),qe.prototype.constructor=qe,[44].forEach(s=>{Ms[s]=new qe(s),Ms[s].stack="<generic error, no stack>"}))},uo,hi=(s,a,c)=>{s=j("/dev/"+s);var _=it(!!a,!!c);Fs||(Fs=64);var k=Fs++<<8|0;Ls(k,{open:x=>{x.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(x,O,K,re)=>{for(var q=0,Ae=0;Ae<re;Ae++){try{var Pe=a()}catch{throw new qe(29)}if(Pe===void 0&&q===0)throw new qe(6);if(Pe==null)break;q++,O[K+Ae]=Pe}return q&&(x.node.timestamp=Date.now()),q},write:(x,O,K,re)=>{for(var q=0;q<re;q++)try{c(O[K+q])}catch{throw new qe(29)}return re&&(x.node.timestamp=Date.now()),q}}),Wi(s,_,k)},Fs,on={},vi,Vi,pi=void 0;function Rr(){return pi+=4,Me[pi-4>>2]}function co(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?`_${s}`:s}function Hi(s,a){return s=co(s),{[s]:function(){return a.apply(this,arguments)}}[s]}function fo(){this.M=[void 0],this.ib=[]}var lr=new fo,Tn=void 0;function ot(s){throw new Tn(s)}var vr=s=>(s||ot("Cannot use deleted val. handle = "+s),lr.get(s).value),pr=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return lr.pa({ub:1,value:s})}};function ho(s){var a=Error,c=Hi(s,function(_){this.name=s,this.message=_,_=Error(_).stack,_!==void 0&&(this.stack=this.toString()+`
`+_.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var vo=void 0,po=void 0;function Ut(s){for(var a="";We[s];)a+=po[We[s++]];return a}var gi=[];function $s(){for(;gi.length;){var s=gi.pop();s.g.fa=!1,s.delete()}}var _i=void 0,Or={};function Ns(s,a){for(a===void 0&&ot("ptr should not be undefined");s.A;)a=s.na(a),s=s.A;return a}var ln={};function go(s){s=Fo(s);var a=Ut(s);return Dr(s),a}function mi(s,a){var c=ln[s];return c===void 0&&ot(a+" has unknown type "+go(s)),c}function Gi(){}var Us=!1;function _o(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function mo(s,a,c){return a===c?s:c.A===void 0?null:(s=mo(s,a,c.A),s===null?null:c.Pb(s))}var yo={};function Vu(s,a){return a=Ns(s,a),Or[a]}var bo=void 0;function zi(s){throw new bo(s)}function Ki(s,a){return a.u&&a.o||zi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&zi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Pn(Object.create(s,{g:{value:a}}))}function Pn(s){return typeof FinalizationRegistry>"u"?(Pn=a=>a,s):(Us=new FinalizationRegistry(a=>{_o(a.g)}),Pn=a=>{var c=a.g;return c.G&&Us.register(a,{g:c},a),a},Gi=a=>{Us.unregister(a)},Pn(s))}var Yi={};function yi(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function bi(s){return this.fromWireType(Me[s>>2])}var Rn={},Ji={};function sr(s,a,c){function _(K){K=c(K),K.length!==s.length&&zi("Mismatched type converter count");for(var re=0;re<s.length;++re)kr(s[re],K[re])}s.forEach(function(K){Ji[K]=a});var k=Array(a.length),x=[],O=0;a.forEach((K,re)=>{ln.hasOwnProperty(K)?k[re]=ln[K]:(x.push(K),Rn.hasOwnProperty(K)||(Rn[K]=[]),Rn[K].push(()=>{k[re]=ln[K],++O,O===x.length&&_(k)}))}),x.length===0&&_(k)}function Xi(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Hu(s,a,c={}){var _=a.name;if(s||ot(`type "${_}" must have a positive integer typeid pointer`),ln.hasOwnProperty(s)){if(c.$b)return;ot(`Cannot register type '${_}' twice`)}ln[s]=a,delete Ji[s],Rn.hasOwnProperty(s)&&(a=Rn[s],delete Rn[s],a.forEach(k=>k()))}function kr(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Hu(s,a,c)}function Bs(s){ot(s.g.u.i.name+" instance already deleted")}function Hr(){}function Ws(s,a,c){if(s[a].B===void 0){var _=s[a];s[a]=function(){return s[a].B.hasOwnProperty(arguments.length)||ot(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[a].B})!`),s[a].B[arguments.length].apply(this,arguments)},s[a].B=[],s[a].B[_.ea]=_}}function qs(s,a,c){m.hasOwnProperty(s)?((c===void 0||m[s].B!==void 0&&m[s].B[c]!==void 0)&&ot(`Cannot register public name '${s}' twice`),Ws(m,s,s),m.hasOwnProperty(c)&&ot(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),m[s].B[c]=a):(m[s]=a,c!==void 0&&(m[s].Pc=c))}function Gu(s,a,c,_,k,x,O,K){this.name=s,this.constructor=a,this.N=c,this.W=_,this.A=k,this.Ub=x,this.na=O,this.Pb=K,this.rb=[]}function Qi(s,a,c){for(;a!==c;)a.na||ot(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),s=a.na(s),a=a.A;return s}function zu(s,a){return a===null?(this.Na&&ot(`null is not a valid ${this.name}`),0):(a.g||ot(`Cannot pass "${Hs(a)}" as a ${this.name}`),a.g.o||ot(`Cannot pass deleted object as a pointer of type ${this.name}`),Qi(a.g.o,a.g.u.i,this.i))}function Ku(s,a){if(a===null){if(this.Na&&ot(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return s!==null&&s.push(this.W,c),c}return 0}if(a.g||ot(`Cannot pass "${Hs(a)}" as a ${this.name}`),a.g.o||ot(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&ot(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Qi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&ot("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:ot(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var _=a.clone();c=this.oc(c,pr(function(){_.delete()})),s!==null&&s.push(this.W,c)}break;default:ot("Unsupporting sharing policy")}return c}function Yu(s,a){return a===null?(this.Na&&ot(`null is not a valid ${this.name}`),0):(a.g||ot(`Cannot pass "${Hs(a)}" as a ${this.name}`),a.g.o||ot(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&ot(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Qi(a.g.o,a.g.u.i,this.i))}function Mr(s,a,c,_){this.name=s,this.i=a,this.Na=c,this.ta=_,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Ku:(this.toWireType=_?zu:Yu,this.K=null)}function wo(s,a,c){m.hasOwnProperty(s)||zi("Replacing nonexistant public symbol"),m[s].B!==void 0&&c!==void 0?m[s].B[c]=a:(m[s]=a,m[s].ea=c)}var Zi=[],ko=s=>{var a=Zi[s];return a||(s>=Zi.length&&(Zi.length=s+1),Zi[s]=a=Qe.get(s)),a},Ju=(s,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),s.includes("j")){var _=m["dynCall_"+s];_=c&&c.length?_.apply(null,[a].concat(c)):_.call(null,a)}else _=ko(a).apply(null,c);return _}};function Qt(s,a){s=Ut(s);var c=s.includes("j")?Ju(s,a):ko(a);return typeof c!="function"&&ot(`unknown function pointer with signature ${s}: ${a}`),c}var Io=void 0;function Lr(s,a){function c(x){k[x]||ln[x]||(Ji[x]?Ji[x].forEach(c):(_.push(x),k[x]=!0))}var _=[],k={};throw a.forEach(c),new Io(`${s}: `+_.map(go).join([", "]))}function es(s,a,c,_,k){var x=a.length;2>x&&ot("argTypes array size mismatch! Must at least get return value and 'this' types!");var O=a[1]!==null&&c!==null,K=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){K=!0;break}var re=a[0].name!=="void",q=x-2,Ae=Array(q),Pe=[],Be=[];return function(){if(arguments.length!==q&&ot(`function ${s} called with ${arguments.length} arguments, expected ${q} args!`),Be.length=0,Pe.length=O?2:1,Pe[0]=k,O){var F=a[1].toWireType(Be,this);Pe[1]=F}for(var Ee=0;Ee<q;++Ee)Ae[Ee]=a[Ee+2].toWireType(Be,arguments[Ee]),Pe.push(Ae[Ee]);if(Ee=_.apply(null,Pe),K)yi(Be);else for(var ge=O?1:2;ge<a.length;ge++){var lt=ge===1?F:Ae[ge-2];a[ge].K!==null&&a[ge].K(lt)}return F=re?a[0].fromWireType(Ee):void 0,F}}function ts(s,a){for(var c=[],_=0;_<s;_++)c.push(De[a+4*_>>2]);return c}function So(s,a,c){return s instanceof Object||ot(`${c} with invalid "this": ${s}`),s instanceof a.i.constructor||ot(`${c} incompatible with "this" of type ${s.constructor.name}`),s.g.o||ot(`cannot call emscripten binding method ${c} on deleted object`),Qi(s.g.o,s.g.u.i,a.i)}function Vs(s){s>=lr.h&&--lr.get(s).ub===0&&lr.Zb(s)}function Xu(s,a,c){switch(a){case 0:return function(_){return this.fromWireType((c?Xe:We)[_])};case 1:return function(_){return this.fromWireType((c?He:Je)[_>>1])};case 2:return function(_){return this.fromWireType((c?Me:De)[_>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Hs(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Qu(s,a){switch(a){case 2:return function(c){return this.fromWireType(xe[c>>2])};case 3:return function(c){return this.fromWireType(ke[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Zu(s,a,c){switch(a){case 0:return c?function(_){return Xe[_]}:function(_){return We[_]};case 1:return c?function(_){return He[_>>1]}:function(_){return Je[_>>1]};case 2:return c?function(_){return Me[_>>2]}:function(_){return De[_>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Eo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ec=(s,a)=>{for(var c=s>>1,_=c+a/2;!(c>=_)&&Je[c];)++c;if(c<<=1,32<c-s&&Eo)return Eo.decode(We.subarray(s,c));for(c="",_=0;!(_>=a/2);++_){var k=He[s+2*_>>1];if(k==0)break;c+=String.fromCharCode(k)}return c},tc=(s,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var _=a;c=c<2*s.length?c/2:s.length;for(var k=0;k<c;++k)He[a>>1]=s.charCodeAt(k),a+=2;return He[a>>1]=0,a-_},rc=s=>2*s.length,nc=(s,a)=>{for(var c=0,_="";!(c>=a/4);){var k=Me[s+4*c>>2];if(k==0)break;++c,65536<=k?(k-=65536,_+=String.fromCharCode(55296|k>>10,56320|k&1023)):_+=String.fromCharCode(k)}return _},ic=(s,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var _=a;c=_+c-4;for(var k=0;k<s.length;++k){var x=s.charCodeAt(k);if(55296<=x&&57343>=x){var O=s.charCodeAt(++k);x=65536+((x&1023)<<10)|O&1023}if(Me[a>>2]=x,a+=4,a+4>c)break}return Me[a>>2]=0,a-_},sc=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);55296<=_&&57343>=_&&++c,a+=4}return a},ac={};function rs(s){var a=ac[s];return a===void 0?Ut(s):a}var ns=[];function oc(s){var a=ns.length;return ns.push(s),a}function lc(s,a){for(var c=Array(s),_=0;_<s;++_)c[_]=mi(De[a+4*_>>2],"parameter "+_);return c}var xo=[],Gs=[],zs={},Ao=()=>{if(!Ks){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:B||"./this.program"},a;for(a in zs)zs[a]===void 0?delete s[a]:s[a]=zs[a];var c=[];for(a in s)c.push(`${a}=${s[a]}`);Ks=c}return Ks},Ks,is=s=>s%4===0&&(s%100!==0||s%400===0),Co=[31,29,31,30,31,30,31,31,30,31,30,31],jo=[31,28,31,30,31,30,31,31,30,31,30,31],uc=(s,a,c,_)=>{function k(F,Ee,ge){for(F=typeof F=="number"?F.toString():F||"";F.length<Ee;)F=ge[0]+F;return F}function x(F,Ee){return k(F,Ee,"0")}function O(F,Ee){function ge(ct){return 0>ct?-1:0<ct?1:0}var lt;return(lt=ge(F.getFullYear()-Ee.getFullYear()))===0&&(lt=ge(F.getMonth()-Ee.getMonth()))===0&&(lt=ge(F.getDate()-Ee.getDate())),lt}function K(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function re(F){var Ee=F.ca;for(F=new Date(new Date(F.da+1900,0,1).getTime());0<Ee;){var ge=F.getMonth(),lt=(is(F.getFullYear())?Co:jo)[ge];if(Ee>lt-F.getDate())Ee-=lt-F.getDate()+1,F.setDate(1),11>ge?F.setMonth(ge+1):(F.setMonth(0),F.setFullYear(F.getFullYear()+1));else{F.setDate(F.getDate()+Ee);break}}return ge=new Date(F.getFullYear()+1,0,4),Ee=K(new Date(F.getFullYear(),0,4)),ge=K(ge),0>=O(Ee,F)?0>=O(ge,F)?F.getFullYear()+1:F.getFullYear():F.getFullYear()-1}var q=Me[_+40>>2];_={wc:Me[_>>2],vc:Me[_+4>>2],Fa:Me[_+8>>2],Sa:Me[_+12>>2],Ga:Me[_+16>>2],da:Me[_+20>>2],R:Me[_+24>>2],ca:Me[_+28>>2],Rc:Me[_+32>>2],uc:Me[_+36>>2],xc:q&&q?Te(We,q):""},c=c?Te(We,c):"",q={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Ae in q)c=c.replace(new RegExp(Ae,"g"),q[Ae]);var Pe="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Be="January February March April May June July August September October November December".split(" ");q={"%a":F=>Pe[F.R].substring(0,3),"%A":F=>Pe[F.R],"%b":F=>Be[F.Ga].substring(0,3),"%B":F=>Be[F.Ga],"%C":F=>x((F.da+1900)/100|0,2),"%d":F=>x(F.Sa,2),"%e":F=>k(F.Sa,2," "),"%g":F=>re(F).toString().substring(2),"%G":F=>re(F),"%H":F=>x(F.Fa,2),"%I":F=>(F=F.Fa,F==0?F=12:12<F&&(F-=12),x(F,2)),"%j":F=>{for(var Ee=0,ge=0;ge<=F.Ga-1;Ee+=(is(F.da+1900)?Co:jo)[ge++]);return x(F.Sa+Ee,3)},"%m":F=>x(F.Ga+1,2),"%M":F=>x(F.vc,2),"%n":()=>`
`,"%p":F=>0<=F.Fa&&12>F.Fa?"AM":"PM","%S":F=>x(F.wc,2),"%t":()=>"	","%u":F=>F.R||7,"%U":F=>x(Math.floor((F.ca+7-F.R)/7),2),"%V":F=>{var Ee=Math.floor((F.ca+7-(F.R+6)%7)/7);if(2>=(F.R+371-F.ca-2)%7&&Ee++,Ee)Ee==53&&(ge=(F.R+371-F.ca)%7,ge==4||ge==3&&is(F.da)||(Ee=1));else{Ee=52;var ge=(F.R+7-F.ca-1)%7;(ge==4||ge==5&&is(F.da%400-1))&&Ee++}return x(Ee,2)},"%w":F=>F.R,"%W":F=>x(Math.floor((F.ca+7-(F.R+6)%7)/7),2),"%y":F=>(F.da+1900).toString().substring(2),"%Y":F=>F.da+1900,"%z":F=>{F=F.uc;var Ee=0<=F;return F=Math.abs(F)/60,(Ee?"+":"-")+("0000"+(F/60*100+F%60)).slice(-4)},"%Z":F=>F.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(Ae in q)c.includes(Ae)&&(c=c.replace(new RegExp(Ae,"g"),q[Ae](_)));return c=c.replace(/\0\0/g,"%"),Ae=Pt(c,!1),Ae.length>a?0:(Xe.set(Ae,s),Ae.length-1)};function To(s,a,c,_){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Uu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=_}Object.defineProperties(To.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),lo(),fi=Array(4096),ao(Re,"/"),hr("/tmp",16895,0),hr("/home",16895,0),hr("/home/web_user",16895,0),(()=>{hr("/dev",16895,0),Ls(259,{read:()=>0,write:(_,k,x,O)=>O}),Wi("/dev/null",259),Ct(1280,jt),Ct(1536,rt),Wi("/dev/tty",1280),Wi("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=ne(s).byteLength),s[--a]);hi("random",c),hi("urandom",c),hr("/dev/shm",16895,0),hr("/dev/shm/tmp",16895,0)})(),(()=>{hr("/proc",16895,0);var s=hr("/proc/self",16895,0);hr("/proc/self/fd",16895,0),ao({U:()=>{var a=ro(s,"fd",16895,73);return a.l={ka:(c,_)=>{var k=Vr(+_);return c={parent:null,U:{nb:"fake"},l:{ma:()=>k.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(fo.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var a=this.ib.pop()||this.M.length;return this.M[a]=s,a},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Tn=m.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},lr.M.push({value:void 0},{value:null},{value:!0},{value:!1}),lr.h=lr.M.length,m.count_emval_handles=function(){for(var s=0,a=lr.h;a<lr.M.length;++a)lr.M[a]!==void 0&&++s;return s},vo=m.PureVirtualError=ho("PureVirtualError");for(var Po=Array(256),ss=0;256>ss;++ss)Po[ss]=String.fromCharCode(ss);po=Po,m.getInheritedInstanceCount=function(){return Object.keys(Or).length},m.getLiveInheritedInstances=function(){var s=[],a;for(a in Or)Or.hasOwnProperty(a)&&s.push(Or[a]);return s},m.flushPendingDeletes=$s,m.setDelayFunction=function(s){_i=s,gi.length&&_i&&_i($s)},bo=m.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Hr.prototype.isAliasOf=function(s){if(!(this instanceof Hr&&s instanceof Hr))return!1;var a=this.g.u.i,c=this.g.o,_=s.g.u.i;for(s=s.g.o;a.A;)c=a.na(c),a=a.A;for(;_.A;)s=_.na(s),_=_.A;return a===_&&c===s},Hr.prototype.clone=function(){if(this.g.o||Bs(this),this.g.ia)return this.g.count.value+=1,this;var s=Pn,a=Object,c=a.create,_=Object.getPrototypeOf(this),k=this.g;return s=s(c.call(a,_,{g:{value:{count:k.count,fa:k.fa,ia:k.ia,o:k.o,u:k.u,G:k.G,L:k.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Hr.prototype.delete=function(){this.g.o||Bs(this),this.g.fa&&!this.g.ia&&ot("Object already scheduled for deletion"),Gi(this),_o(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Hr.prototype.isDeleted=function(){return!this.g.o},Hr.prototype.deleteLater=function(){return this.g.o||Bs(this),this.g.fa&&!this.g.ia&&ot("Object already scheduled for deletion"),gi.push(this),gi.length===1&&_i&&_i($s),this.g.fa=!0,this},Mr.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Mr.prototype.bb=function(s){this.W&&this.W(s)},Mr.prototype.argPackAdvance=8,Mr.prototype.readValueFromPointer=bi,Mr.prototype.deleteObject=function(s){s!==null&&s.delete()},Mr.prototype.fromWireType=function(s){function a(){return this.ua?Ki(this.i.N,{u:this.nc,o:c,L:this,G:s}):Ki(this.i.N,{u:this,o:s})}var c=this.Vb(s);if(!c)return this.bb(s),null;var _=Vu(this.i,c);if(_!==void 0)return _.g.count.value===0?(_.g.o=c,_.g.G=s,_.clone()):(_=_.clone(),this.bb(s),_);if(_=this.i.Ub(c),_=yo[_],!_)return a.call(this);_=this.ta?_.Kb:_.pointerType;var k=mo(c,this.i,_.i);return k===null?a.call(this):this.ua?Ki(_.i.N,{u:_,o:k,L:this,G:s}):Ki(_.i.N,{u:_,o:k})},Io=m.UnboundTypeError=ho("UnboundTypeError");var Ro={__syscall_fcntl64:function(s,a,c){pi=c;try{var _=Vr(s);switch(a){case 0:var k=Rr();return 0>k?-28:so(_,k).X;case 1:case 2:return 0;case 3:return _.flags;case 4:return k=Rr(),_.flags|=k,0;case 5:return k=Rr(),He[k+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Me[Oo()>>2]=28,-1;default:return-28}}catch(x){if(typeof on>"u"||x.name!=="ErrnoError")throw x;return-x.aa}},__syscall_ioctl:function(s,a,c){pi=c;try{var _=Vr(s);switch(a){case 21509:return _.s?0:-59;case 21505:if(!_.s)return-59;if(_.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var k=Rr();Me[k>>2]=25856,Me[k+4>>2]=5,Me[k+8>>2]=191,Me[k+12>>2]=35387;for(var x=0;32>x;x++)Xe[k+x+17>>0]=a[x]||0}return 0;case 21510:case 21511:case 21512:return _.s?0:-59;case 21506:case 21507:case 21508:if(!_.s)return-59;if(_.s.V.cc)for(k=Rr(),a=[],x=0;32>x;x++)a.push(Xe[k+x+17>>0]);return 0;case 21519:return _.s?(k=Rr(),Me[k>>2]=0):-59;case 21520:return _.s?-28:-59;case 21531:if(k=Rr(),!_.m.ac)throw new qe(59);return _.m.ac(_,a,k);case 21523:return _.s?(_.s.V.dc&&(x=[24,80],k=Rr(),He[k>>1]=x[0],He[k+2>>1]=x[1]),0):-59;case 21524:return _.s?0:-59;case 21515:return _.s?0:-59;default:return-28}}catch(O){if(typeof on>"u"||O.name!=="ErrnoError")throw O;return-O.aa}},__syscall_openat:function(s,a,c,_){pi=_;try{a=a?Te(We,a):"";var k=a;if(k.charAt(0)==="/")a=k;else{var x=s===-100?"/":Vr(s).path;if(k.length==0)throw new qe(44);a=j(x+"/"+k)}var O=_?Rr():0;return qi(a,c,O).X}catch(K){if(typeof on>"u"||K.name!=="ErrnoError")throw K;return-K.aa}},_embind_create_inheriting_constructor:function(s,a,c){s=Ut(s),a=mi(a,"wrapper"),c=vr(c);var _=[].slice,k=a.i,x=k.N,O=k.A.N,K=k.A.constructor;s=Hi(s,function(){k.A.rb.forEach((function(q){if(this[q]===O[q])throw new vo(`Pure virtual function ${q} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:x}),this.__construct.apply(this,_.call(arguments))}),x.__construct=function(){this===x&&ot("Pass correct 'this' to __construct");var q=K.implement.apply(void 0,[this].concat(_.call(arguments)));Gi(q);var Ae=q.g;q.notifyOnDestruction(),Ae.ia=!0,Object.defineProperties(this,{g:{value:Ae}}),Pn(this),q=Ae.o,q=Ns(k,q),Or.hasOwnProperty(q)?ot(`Tried to register registered instance: ${q}`):Or[q]=this},x.__destruct=function(){this===x&&ot("Pass correct 'this' to __destruct"),Gi(this);var q=this.g.o;q=Ns(k,q),Or.hasOwnProperty(q)?delete Or[q]:ot(`Tried to unregister unregistered instance: ${q}`)},s.prototype=Object.create(x);for(var re in c)s.prototype[re]=c[re];return pr(s)},_embind_finalize_value_object:function(s){var a=Yi[s];delete Yi[s];var c=a.Pa,_=a.W,k=a.fb,x=k.map(O=>O.Yb).concat(k.map(O=>O.rc));sr([s],x,O=>{var K={};return k.forEach((re,q)=>{var Ae=O[q],Pe=re.Wb,Be=re.Xb,F=O[q+k.length],Ee=re.qc,ge=re.sc;K[re.Sb]={read:lt=>Ae.fromWireType(Pe(Be,lt)),write:(lt,ct)=>{var Oe=[];Ee(ge,lt,F.toWireType(Oe,ct)),yi(Oe)}}}),[{name:a.name,fromWireType:function(re){var q={},Ae;for(Ae in K)q[Ae]=K[Ae].read(re);return _(re),q},toWireType:function(re,q){for(var Ae in K)if(!(Ae in q))throw new TypeError(`Missing field: "${Ae}"`);var Pe=c();for(Ae in K)K[Ae].write(Pe,q[Ae]);return re!==null&&re.push(_,Pe),Pe},argPackAdvance:8,readValueFromPointer:bi,K:_}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,a,c,_,k){var x=Xi(c);a=Ut(a),kr(s,{name:a,fromWireType:function(O){return!!O},toWireType:function(O,K){return K?_:k},argPackAdvance:8,readValueFromPointer:function(O){if(c===1)var K=Xe;else if(c===2)K=He;else if(c===4)K=Me;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(K[O>>x])},K:null})},_embind_register_class:function(s,a,c,_,k,x,O,K,re,q,Ae,Pe,Be){Ae=Ut(Ae),x=Qt(k,x),K&&(K=Qt(O,K)),q&&(q=Qt(re,q)),Be=Qt(Pe,Be);var F=co(Ae);qs(F,function(){Lr(`Cannot construct ${Ae} due to unbound types`,[_])}),sr([s,a,c],_?[_]:[],function(Ee){if(Ee=Ee[0],_)var ge=Ee.i,lt=ge.N;else lt=Hr.prototype;Ee=Hi(F,function(){if(Object.getPrototypeOf(this)!==ct)throw new Tn("Use 'new' to construct "+Ae);if(Oe.$===void 0)throw new Tn(Ae+" has no accessible constructor");var Xt=Oe.$[arguments.length];if(Xt===void 0)throw new Tn(`Tried to invoke ctor of ${Ae} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Oe.$).toString()}) parameters instead!`);return Xt.apply(this,arguments)});var ct=Object.create(lt,{constructor:{value:Ee}});Ee.prototype=ct;var Oe=new Gu(Ae,Ee,ct,Be,ge,x,K,q);Oe.A&&(Oe.A.oa===void 0&&(Oe.A.oa=[]),Oe.A.oa.push(Oe)),ge=new Mr(Ae,Oe,!0,!1),lt=new Mr(Ae+"*",Oe,!1,!1);var Mt=new Mr(Ae+" const*",Oe,!1,!0);return yo[s]={pointerType:lt,Kb:Mt},wo(F,Ee),[ge,lt,Mt]})},_embind_register_class_class_function:function(s,a,c,_,k,x,O){var K=ts(c,_);a=Ut(a),x=Qt(k,x),sr([],[s],function(re){function q(){Lr(`Cannot call ${Ae} due to unbound types`,K)}re=re[0];var Ae=`${re.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var Pe=re.i.constructor;return Pe[a]===void 0?(q.ea=c-1,Pe[a]=q):(Ws(Pe,a,Ae),Pe[a].B[c-1]=q),sr([],K,function(Be){if(Be=es(Ae,[Be[0],null].concat(Be.slice(1)),null,x,O),Pe[a].B===void 0?(Be.ea=c-1,Pe[a]=Be):Pe[a].B[c-1]=Be,re.i.oa)for(const F of re.i.oa)F.constructor.hasOwnProperty(a)||(F.constructor[a]=Be);return[]}),[]})},_embind_register_class_class_property:function(s,a,c,_,k,x,O,K){a=Ut(a),x=Qt(k,x),sr([],[s],function(re){re=re[0];var q=`${re.name}.${a}`,Ae={get(){Lr(`Cannot access ${q} due to unbound types`,[c])},enumerable:!0,configurable:!0};return Ae.set=K?()=>{Lr(`Cannot access ${q} due to unbound types`,[c])}:()=>{ot(`${q} is a read-only property`)},Object.defineProperty(re.i.constructor,a,Ae),sr([],[c],function(Pe){Pe=Pe[0];var Be={get(){return Pe.fromWireType(x(_))},enumerable:!0};return K&&(K=Qt(O,K),Be.set=F=>{var Ee=[];K(_,Pe.toWireType(Ee,F)),yi(Ee)}),Object.defineProperty(re.i.constructor,a,Be),[]}),[]})},_embind_register_class_constructor:function(s,a,c,_,k,x){var O=ts(a,c);k=Qt(_,k),sr([],[s],function(K){K=K[0];var re=`constructor ${K.name}`;if(K.i.$===void 0&&(K.i.$=[]),K.i.$[a-1]!==void 0)throw new Tn(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${K.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return K.i.$[a-1]=()=>{Lr(`Cannot construct ${K.name} due to unbound types`,O)},sr([],O,function(q){return q.splice(1,0,null),K.i.$[a-1]=es(re,q,null,k,x),[]}),[]})},_embind_register_class_function:function(s,a,c,_,k,x,O,K){var re=ts(c,_);a=Ut(a),x=Qt(k,x),sr([],[s],function(q){function Ae(){Lr(`Cannot call ${Pe} due to unbound types`,re)}q=q[0];var Pe=`${q.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),K&&q.i.rb.push(a);var Be=q.i.N,F=Be[a];return F===void 0||F.B===void 0&&F.className!==q.name&&F.ea===c-2?(Ae.ea=c-2,Ae.className=q.name,Be[a]=Ae):(Ws(Be,a,Pe),Be[a].B[c-2]=Ae),sr([],re,function(Ee){return Ee=es(Pe,Ee,q,x,O),Be[a].B===void 0?(Ee.ea=c-2,Be[a]=Ee):Be[a].B[c-2]=Ee,[]}),[]})},_embind_register_class_property:function(s,a,c,_,k,x,O,K,re,q){a=Ut(a),k=Qt(_,k),sr([],[s],function(Ae){Ae=Ae[0];var Pe=`${Ae.name}.${a}`,Be={get(){Lr(`Cannot access ${Pe} due to unbound types`,[c,O])},enumerable:!0,configurable:!0};return Be.set=re?()=>{Lr(`Cannot access ${Pe} due to unbound types`,[c,O])}:()=>{ot(Pe+" is a read-only property")},Object.defineProperty(Ae.i.N,a,Be),sr([],re?[c,O]:[c],function(F){var Ee=F[0],ge={get(){var ct=So(this,Ae,Pe+" getter");return Ee.fromWireType(k(x,ct))},enumerable:!0};if(re){re=Qt(K,re);var lt=F[1];ge.set=function(ct){var Oe=So(this,Ae,Pe+" setter"),Mt=[];re(q,Oe,lt.toWireType(Mt,ct)),yi(Mt)}}return Object.defineProperty(Ae.i.N,a,ge),[]}),[]})},_embind_register_emval:function(s,a){a=Ut(a),kr(s,{name:a,fromWireType:function(c){var _=vr(c);return Vs(c),_},toWireType:function(c,_){return pr(_)},argPackAdvance:8,readValueFromPointer:bi,K:null})},_embind_register_enum:function(s,a,c,_){function k(){}c=Xi(c),a=Ut(a),k.values={},kr(s,{name:a,constructor:k,fromWireType:function(x){return this.constructor.values[x]},toWireType:function(x,O){return O.value},argPackAdvance:8,readValueFromPointer:Xu(a,c,_),K:null}),qs(a,k)},_embind_register_enum_value:function(s,a,c){var _=mi(s,"enum");a=Ut(a),s=_.constructor,_=Object.create(_.constructor.prototype,{value:{value:c},constructor:{value:Hi(`${_.name}_${a}`,function(){})}}),s.values[c]=_,s[a]=_},_embind_register_float:function(s,a,c){c=Xi(c),a=Ut(a),kr(s,{name:a,fromWireType:function(_){return _},toWireType:function(_,k){return k},argPackAdvance:8,readValueFromPointer:Qu(a,c),K:null})},_embind_register_function:function(s,a,c,_,k,x){var O=ts(a,c);s=Ut(s),k=Qt(_,k),qs(s,function(){Lr(`Cannot call ${s} due to unbound types`,O)},a-1),sr([],O,function(K){return wo(s,es(s,[K[0],null].concat(K.slice(1)),null,k,x),a-1),[]})},_embind_register_integer:function(s,a,c,_,k){a=Ut(a),k===-1&&(k=4294967295),k=Xi(c);var x=K=>K;if(_===0){var O=32-8*c;x=K=>K<<O>>>O}c=a.includes("unsigned")?function(K,re){return re>>>0}:function(K,re){return re},kr(s,{name:a,fromWireType:x,toWireType:c,argPackAdvance:8,readValueFromPointer:Zu(a,k,_!==0),K:null})},_embind_register_memory_view:function(s,a,c){function _(x){x>>=2;var O=De;return new k(O.buffer,O[x+1],O[x])}var k=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Ut(c),kr(s,{name:c,fromWireType:_,argPackAdvance:8,readValueFromPointer:_},{$b:!0})},_embind_register_std_string:function(s,a){a=Ut(a);var c=a==="std::string";kr(s,{name:a,fromWireType:function(_){var k=De[_>>2],x=_+4;if(c)for(var O=x,K=0;K<=k;++K){var re=x+K;if(K==k||We[re]==0){if(O=O?Te(We,O,re-O):"",q===void 0)var q=O;else q+="\0",q+=O;O=re+1}}else{for(q=Array(k),K=0;K<k;++K)q[K]=String.fromCharCode(We[x+K]);q=q.join("")}return Dr(_),q},toWireType:function(_,k){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var x=typeof k=="string";x||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int8Array||ot("Cannot pass non-string to std::string");var O=c&&x?Ke(k):k.length,K=Ys(4+O+1),re=K+4;if(De[K>>2]=O,c&&x)ht(k,We,re,O+1);else if(x)for(x=0;x<O;++x){var q=k.charCodeAt(x);255<q&&(Dr(re),ot("String has UTF-16 code units that do not fit in 8 bits")),We[re+x]=q}else for(x=0;x<O;++x)We[re+x]=k[x];return _!==null&&_.push(Dr,K),K},argPackAdvance:8,readValueFromPointer:bi,K:function(_){Dr(_)}})},_embind_register_std_wstring:function(s,a,c){if(c=Ut(c),a===2)var _=ec,k=tc,x=rc,O=()=>Je,K=1;else a===4&&(_=nc,k=ic,x=sc,O=()=>De,K=2);kr(s,{name:c,fromWireType:function(re){for(var q=De[re>>2],Ae=O(),Pe,Be=re+4,F=0;F<=q;++F){var Ee=re+4+F*a;(F==q||Ae[Ee>>K]==0)&&(Be=_(Be,Ee-Be),Pe===void 0?Pe=Be:(Pe+="\0",Pe+=Be),Be=Ee+a)}return Dr(re),Pe},toWireType:function(re,q){typeof q!="string"&&ot(`Cannot pass non-string to C++ string type ${c}`);var Ae=x(q),Pe=Ys(4+Ae+a);return De[Pe>>2]=Ae>>K,k(q,Pe+4,Ae+a),re!==null&&re.push(Dr,Pe),Pe},argPackAdvance:8,readValueFromPointer:bi,K:function(re){Dr(re)}})},_embind_register_value_object:function(s,a,c,_,k,x){Yi[s]={name:Ut(a),Pa:Qt(c,_),W:Qt(k,x),fb:[]}},_embind_register_value_object_field:function(s,a,c,_,k,x,O,K,re,q){Yi[s].fb.push({Sb:Ut(a),Yb:c,Wb:Qt(_,k),Xb:x,rc:O,qc:Qt(K,re),sc:q})},_embind_register_void:function(s,a){a=Ut(a),kr(s,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,a,c){s=vr(s),a=mi(a,"emval::as");var _=[],k=pr(_);return De[c>>2]=k,a.toWireType(_,s)},_emval_call_method:function(s,a,c,_,k){s=ns[s],a=vr(a),c=rs(c);var x=[];return De[_>>2]=pr(x),s(a,c,x,k)},_emval_call_void_method:function(s,a,c,_){s=ns[s],a=vr(a),c=rs(c),s(a,c,null,_)},_emval_decref:Vs,_emval_get_method_caller:function(s,a){var c=lc(s,a),_=c[0];a=_.name+"_$"+c.slice(1).map(function(O){return O.name}).join("_")+"$";var k=xo[a];if(k!==void 0)return k;var x=Array(s-1);return k=oc((O,K,re,q)=>{for(var Ae=0,Pe=0;Pe<s-1;++Pe)x[Pe]=c[Pe+1].readValueFromPointer(q+Ae),Ae+=c[Pe+1].argPackAdvance;for(O=O[K].apply(O,x),Pe=0;Pe<s-1;++Pe)c[Pe+1].Nb&&c[Pe+1].Nb(x[Pe]);if(!_.fc)return _.toWireType(re,O)}),xo[a]=k},_emval_get_module_property:function(s){return s=rs(s),pr(m[s])},_emval_get_property:function(s,a){return s=vr(s),a=vr(a),pr(s[a])},_emval_incref:function(s){4<s&&(lr.get(s).ub+=1)},_emval_new_array:function(){return pr([])},_emval_new_cstring:function(s){return pr(rs(s))},_emval_new_object:function(){return pr({})},_emval_run_destructors:function(s){var a=vr(s);yi(a),Vs(s)},_emval_set_property:function(s,a,c){s=vr(s),a=vr(a),c=vr(c),s[a]=c},_emval_take_value:function(s,a){return s=mi(s,"_emval_take_value"),s=s.readValueFromPointer(a),pr(s)},abort:()=>{z("")},emscripten_asm_const_int:(s,a,c)=>{Gs.length=0;var _;for(c>>=2;_=We[a++];)c+=_!=105&c,Gs.push(_==105?Me[c]:ke[c++>>1]),++c;return o[s].apply(null,Gs)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,a,c)=>We.copyWithin(s,a,a+c),emscripten_resize_heap:s=>{var a=We.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var _=a*(1+.2/c);_=Math.min(_,s+100663296);var k=Math;_=Math.max(s,_);e:{k=k.min.call(k,2147483648,_+(65536-_%65536)%65536)-$e.buffer.byteLength+65535>>>16;try{$e.grow(k),Ge();var x=1;break e}catch{}x=void 0}if(x)return!0}return!1},environ_get:(s,a)=>{var c=0;return Ao().forEach(function(_,k){var x=a+c;for(k=De[s+4*k>>2]=x,x=0;x<_.length;++x)Xe[k++>>0]=_.charCodeAt(x);Xe[k>>0]=0,c+=_.length+1}),0},environ_sizes_get:(s,a)=>{var c=Ao();De[s>>2]=c.length;var _=0;return c.forEach(function(k){_+=k.length+1}),De[a>>2]=_,0},fd_close:function(s){try{var a=Vr(s);if(a.X===null)throw new qe(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Ni[a.X]=null}return a.X=null,0}catch(c){if(typeof on>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(s,a,c,_){try{e:{var k=Vr(s);s=a;for(var x,O=a=0;O<c;O++){var K=De[s>>2],re=De[s+4>>2];s+=8;var q=k,Ae=K,Pe=re,Be=x,F=Xe;if(0>Pe||0>Be)throw new qe(28);if(q.X===null)throw new qe(8);if((q.flags&2097155)===1)throw new qe(8);if((q.node.mode&61440)===16384)throw new qe(31);if(!q.m.read)throw new qe(28);var Ee=typeof Be<"u";if(!Ee)Be=q.position;else if(!q.seekable)throw new qe(70);var ge=q.m.read(q,F,Ae,Pe,Be);Ee||(q.position+=ge);var lt=ge;if(0>lt){var ct=-1;break e}if(a+=lt,lt<re)break;typeof x<"u"&&(x+=lt)}ct=a}return De[_>>2]=ct,0}catch(Oe){if(typeof on>"u"||Oe.name!=="ErrnoError")throw Oe;return Oe.aa}},fd_seek:function(s,a,c,_,k){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var x=Vr(s);return oo(x,a,_),g=[x.position>>>0,(se=x.position,1<=+Math.abs(se)?0<se?+Math.floor(se/4294967296)>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],Me[k>>2]=g[0],Me[k+4>>2]=g[1],x.Ma&&a===0&&_===0&&(x.Ma=null),0}catch(O){if(typeof on>"u"||O.name!=="ErrnoError")throw O;return O.aa}},fd_write:function(s,a,c,_){try{e:{var k=Vr(s);s=a;for(var x,O=a=0;O<c;O++){var K=De[s>>2],re=De[s+4>>2];s+=8;var q=k,Ae=K,Pe=re,Be=x,F=Xe;if(0>Pe||0>Be)throw new qe(28);if(q.X===null)throw new qe(8);if((q.flags&2097155)===0)throw new qe(8);if((q.node.mode&61440)===16384)throw new qe(31);if(!q.m.write)throw new qe(28);q.seekable&&q.flags&1024&&oo(q,0,2);var Ee=typeof Be<"u";if(!Ee)Be=q.position;else if(!q.seekable)throw new qe(70);var ge=q.m.write(q,F,Ae,Pe,Be,void 0);Ee||(q.position+=ge);var lt=ge;if(0>lt){var ct=-1;break e}a+=lt,typeof x<"u"&&(x+=lt)}ct=a}return De[_>>2]=ct,0}catch(Oe){if(typeof on>"u"||Oe.name!=="ErrnoError")throw Oe;return Oe.aa}},strftime_l:(s,a,c,_)=>uc(s,a,c,_)};(function(){function s(c){if(me=c=c.exports,$e=me.memory,Ge(),Qe=me.__indirect_function_table,ue.unshift(me.__wasm_call_ctors),R--,m.monitorRunDependencies&&m.monitorRunDependencies(R),R==0&&Y){var _=Y;Y=null,_()}return c}var a={env:Ro,wasi_snapshot_preview1:Ro};if(R++,m.monitorRunDependencies&&m.monitorRunDependencies(R),m.instantiateWasm)try{return m.instantiateWasm(a,s)}catch(c){Ue("Module.instantiateWasm callback failed with error: "+c),N(c)}return Q(a,function(c){s(c.instance)}).catch(N),{}})();var Dr=s=>(Dr=me.free)(s),Ys=s=>(Ys=me.malloc)(s),Oo=()=>(Oo=me.__errno_location)(),Mo=m._ma_device__on_notification_unlocked=s=>(Mo=m._ma_device__on_notification_unlocked=me.ma_device__on_notification_unlocked)(s);m._ma_malloc_emscripten=(s,a)=>(m._ma_malloc_emscripten=me.ma_malloc_emscripten)(s,a),m._ma_free_emscripten=(s,a)=>(m._ma_free_emscripten=me.ma_free_emscripten)(s,a);var Lo=m._ma_device_process_pcm_frames_capture__webaudio=(s,a,c)=>(Lo=m._ma_device_process_pcm_frames_capture__webaudio=me.ma_device_process_pcm_frames_capture__webaudio)(s,a,c),Do=m._ma_device_process_pcm_frames_playback__webaudio=(s,a,c)=>(Do=m._ma_device_process_pcm_frames_playback__webaudio=me.ma_device_process_pcm_frames_playback__webaudio)(s,a,c),Fo=s=>(Fo=me.__getTypeName)(s);m.__embind_initialize_bindings=()=>(m.__embind_initialize_bindings=me._embind_initialize_bindings)(),m.dynCall_iiji=(s,a,c,_,k)=>(m.dynCall_iiji=me.dynCall_iiji)(s,a,c,_,k),m.dynCall_jiji=(s,a,c,_,k)=>(m.dynCall_jiji=me.dynCall_jiji)(s,a,c,_,k),m.dynCall_iiiji=(s,a,c,_,k,x)=>(m.dynCall_iiiji=me.dynCall_iiiji)(s,a,c,_,k,x),m.dynCall_iij=(s,a,c,_)=>(m.dynCall_iij=me.dynCall_iij)(s,a,c,_),m.dynCall_jii=(s,a,c)=>(m.dynCall_jii=me.dynCall_jii)(s,a,c),m.dynCall_viijii=(s,a,c,_,k,x,O)=>(m.dynCall_viijii=me.dynCall_viijii)(s,a,c,_,k,x,O),m.dynCall_iiiiij=(s,a,c,_,k,x,O)=>(m.dynCall_iiiiij=me.dynCall_iiiiij)(s,a,c,_,k,x,O),m.dynCall_iiiiijj=(s,a,c,_,k,x,O,K,re)=>(m.dynCall_iiiiijj=me.dynCall_iiiiijj)(s,a,c,_,k,x,O,K,re),m.dynCall_iiiiiijj=(s,a,c,_,k,x,O,K,re,q)=>(m.dynCall_iiiiiijj=me.dynCall_iiiiiijj)(s,a,c,_,k,x,O,K,re,q);var as;Y=function s(){as||$o(),as||(Y=s)};function $o(){function s(){if(!as&&(as=!0,m.calledRun=!0,!Ye)){if(m.noFSInit||uo||(uo=!0,lo(),m.stdin=m.stdin,m.stdout=m.stdout,m.stderr=m.stderr,m.stdin?hi("stdin",m.stdin):Ds("/dev/tty","/dev/stdin"),m.stdout?hi("stdout",null,m.stdout):Ds("/dev/tty","/dev/stdout"),m.stderr?hi("stderr",null,m.stderr):Ds("/dev/tty1","/dev/stderr"),qi("/dev/stdin",0),qi("/dev/stdout",1),qi("/dev/stderr",1)),Za=!1,f(ue),S(m),m.onRuntimeInitialized&&m.onRuntimeInitialized(),m.postRun)for(typeof m.postRun=="function"&&(m.postRun=[m.postRun]);m.postRun.length;){var a=m.postRun.shift();ce.unshift(a)}f(ce)}}if(!(0<R)){if(m.preRun)for(typeof m.preRun=="function"&&(m.preRun=[m.preRun]);m.preRun.length;)J();f(Fe),0<R||(m.setStatus?(m.setStatus("Running..."),setTimeout(function(){setTimeout(function(){m.setStatus("")},1),s()},1)):s())}}if(m.preInit)for(typeof m.preInit=="function"&&(m.preInit=[m.preInit]);0<m.preInit.length;)m.preInit.pop()();return $o(),E.ready})})();const p=y}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>y.Animation});var y=v(4)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>y});var y=(function(){function p(b,E,m,S){this.animation=b,this.artboard=E,this.playing=S,this.loopCount=0,this.scrubTo=null,this.instance=new m.LinearAnimationInstance(b,E)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"time",{get:function(){return this.instance.time},set:function(b){this.instance.time=b},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),p.prototype.advance=function(b){this.scrubTo===null?this.instance.advance(b):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},p.prototype.apply=function(b){this.instance.apply(b)},p.prototype.cleanup=function(){this.instance.delete()},p})()}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>b.AudioAssetWrapper,AudioWrapper:()=>b.AudioWrapper,BLANK_URL:()=>p.BLANK_URL,CustomFileAssetLoaderWrapper:()=>b.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>b.FileAssetWrapper,Finalizable:()=>b.Finalizable,FontAssetWrapper:()=>b.FontAssetWrapper,FontWrapper:()=>b.FontWrapper,ImageAssetWrapper:()=>b.ImageAssetWrapper,ImageWrapper:()=>b.ImageWrapper,finalizationRegistry:()=>b.finalizationRegistry,registerTouchInteractions:()=>y.registerTouchInteractions,sanitizeUrl:()=>p.sanitizeUrl});var y=v(6),p=v(7),b=v(8)}),((u,h,v)=>{v.r(h),v.d(h,{registerTouchInteractions:()=>b});var y=void 0,p=function(E,m){var S,N;return["touchstart","touchmove"].indexOf(E.type)>-1&&(!((S=E.touches)===null||S===void 0)&&S.length)?(m||E.preventDefault(),{clientX:E.touches[0].clientX,clientY:E.touches[0].clientY}):E.type==="touchend"&&(!((N=E.changedTouches)===null||N===void 0)&&N.length)?{clientX:E.changedTouches[0].clientX,clientY:E.changedTouches[0].clientY}:{clientX:E.clientX,clientY:E.clientY}},b=function(E){var m=E.canvas,S=E.artboard,N=E.stateMachines,P=N===void 0?[]:N,U=E.renderer,G=E.rive,D=E.fit,Z=E.alignment,ae=E.isTouchScrollEnabled,$=ae===void 0?!1:ae,B=E.layoutScaleFactor,he=B===void 0?1:B;if(!m||!P.length||!U||!G||!S||typeof window>"u")return null;var le=null,Se=!1,be=function(Ce){if(Se&&Ce instanceof MouseEvent){Ce.type=="mouseup"&&(Se=!1);return}Se=$&&Ce.type==="touchend"&&le==="touchstart",le=Ce.type;var Ue=Ce.currentTarget.getBoundingClientRect(),we=p(Ce,$),$e=we.clientX,me=we.clientY;if(!(!$e&&!me)){var Ye=$e-Ue.left,Xe=me-Ue.top,We=G.computeAlignment(D,Z,{minX:0,minY:0,maxX:Ue.width,maxY:Ue.height},S.bounds,he),He=new G.Mat2D;We.invert(He);var Je=new G.Vec2D(Ye,Xe),Me=G.mapXY(He,Je),De=Me.x(),xe=Me.y();switch(Me.delete(),He.delete(),Je.delete(),We.delete(),Ce.type){case"mouseout":for(var ke=0,Ge=P;ke<Ge.length;ke++){var Qe=Ge[ke];Qe.pointerMove(De,xe)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Fe=0,ue=P;Fe<ue.length;Fe++){var Qe=ue[Fe];Qe.pointerMove(De,xe)}break}case"touchstart":case"mousedown":{for(var ce=0,J=P;ce<J.length;ce++){var Qe=J[ce];Qe.pointerDown(De,xe)}break}case"touchend":case"mouseup":{for(var R=0,Y=P;R<Y.length;R++){var Qe=Y[R];Qe.pointerUp(De,xe)}break}}}},oe=be.bind(y);return m.addEventListener("mouseover",oe),m.addEventListener("mouseout",oe),m.addEventListener("mousemove",oe),m.addEventListener("mousedown",oe),m.addEventListener("mouseup",oe),m.addEventListener("touchmove",oe,{passive:$}),m.addEventListener("touchstart",oe,{passive:$}),m.addEventListener("touchend",oe),function(){m.removeEventListener("mouseover",oe),m.removeEventListener("mouseout",oe),m.removeEventListener("mousemove",oe),m.removeEventListener("mousedown",oe),m.removeEventListener("mouseup",oe),m.removeEventListener("touchmove",oe),m.removeEventListener("touchstart",oe),m.removeEventListener("touchend",oe)}}}),((u,h,v)=>{v.r(h),v.d(h,{BLANK_URL:()=>N,sanitizeUrl:()=>G});var y=/^([^\w]*)(javascript|data|vbscript)/im,p=/&#(\w+)(^\w|;)?/g,b=/&(newline|tab);/gi,E=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,m=/^.+(:|&colon;)/gim,S=[".","/"],N="about:blank";function P(D){return S.indexOf(D[0])>-1}function U(D){var Z=D.replace(E,"");return Z.replace(p,function(ae,$){return String.fromCharCode($)})}function G(D){if(!D)return N;var Z=U(D).replace(b,"").replace(E,"").trim();if(!Z)return N;if(P(Z))return Z;var ae=Z.match(m);if(!ae)return Z;var $=ae[0];return y.test($)?N:Z}}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>U,AudioWrapper:()=>E,CustomFileAssetLoaderWrapper:()=>S,FileAssetWrapper:()=>N,Finalizable:()=>p,FontAssetWrapper:()=>G,FontWrapper:()=>m,ImageAssetWrapper:()=>P,ImageWrapper:()=>b,finalizationRegistry:()=>ae});var y=(function(){var $=function(B,he){return $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(le,Se){le.__proto__=Se}||function(le,Se){for(var be in Se)Object.prototype.hasOwnProperty.call(Se,be)&&(le[be]=Se[be])},$(B,he)};return function(B,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");$(B,he);function le(){this.constructor=B}B.prototype=he===null?Object.create(he):(le.prototype=he.prototype,new le)}})(),p=(function(){function $(){this.selfUnref=!1}return $})(),b=(function($){y(B,$);function B(he){var le=$.call(this)||this;return le._nativeImage=he,le}return Object.defineProperty(B.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},B})(p),E=(function($){y(B,$);function B(he){var le=$.call(this)||this;return le._nativeAudio=he,le}return Object.defineProperty(B.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},B})(p),m=(function($){y(B,$);function B(he){var le=$.call(this)||this;return le._nativeFont=he,le}return Object.defineProperty(B.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},B})(p),S=(function(){function $(B,he){this._assetLoaderCallback=he,this.assetLoader=new B.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return $.prototype.loadContents=function(B,he){var le;return B.isImage?le=new P(B):B.isAudio?le=new U(B):B.isFont&&(le=new G(B)),this._assetLoaderCallback(le,he)},$})(),N=(function(){function $(B){this._nativeFileAsset=B}return $.prototype.decode=function(B){this._nativeFileAsset.decode(B)},Object.defineProperty($.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),$})(),P=(function($){y(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setRenderImage=function(he){this._nativeFileAsset.setRenderImage(he.nativeImage)},B})(N),U=(function($){y(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setAudioSource=function(he){this._nativeFileAsset.setAudioSource(he.nativeAudio)},B})(N),G=(function($){y(B,$);function B(){return $!==null&&$.apply(this,arguments)||this}return B.prototype.setFont=function(he){this._nativeFileAsset.setFont(he.nativeFont)},B})(N),D=(function(){function $(B){}return $.prototype.register=function(B){B.selfUnref=!0},$.prototype.unregister=function(B){},$})(),Z=typeof FinalizationRegistry<"u"?FinalizationRegistry:D,ae=new Z(function($){$.unref()})})],n={};function i(u){var h=n[u];if(h!==void 0)return h.exports;var v=n[u]={exports:{}};return t[u](v,v.exports,i),v.exports}i.d=(u,h)=>{for(var v in h)i.o(h,v)&&!i.o(u,v)&&Object.defineProperty(u,v,{enumerable:!0,get:h[v]})},i.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),i.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{i.r(l),i.d(l,{Alignment:()=>G,DataEnum:()=>xe,EventType:()=>be,Fit:()=>U,Layout:()=>D,LoopType:()=>oe,Rive:()=>Me,RiveEventType:()=>B,RiveFile:()=>Je,RuntimeLoader:()=>Z,StateMachineInput:()=>$,StateMachineInputType:()=>ae,Testing:()=>je,ViewModel:()=>De,ViewModelInstance:()=>Ge,ViewModelInstanceArtboard:()=>H,ViewModelInstanceAssetImage:()=>M,ViewModelInstanceBoolean:()=>ce,ViewModelInstanceColor:()=>z,ViewModelInstanceEnum:()=>R,ViewModelInstanceList:()=>Y,ViewModelInstanceNumber:()=>ue,ViewModelInstanceString:()=>Fe,ViewModelInstanceTrigger:()=>J,ViewModelInstanceValue:()=>Qe,decodeAudio:()=>pe,decodeFont:()=>se,decodeImage:()=>Q});var u=i(1),h=i(2),v=i(3),y=i(5),p=(function(){var g=function(o,f){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var C in j)Object.prototype.hasOwnProperty.call(j,C)&&(I[C]=j[C])},g(o,f)};return function(o,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");g(o,f);function I(){this.constructor=o}o.prototype=f===null?Object.create(f):(I.prototype=f.prototype,new I)}})(),b=function(){return b=Object.assign||function(g){for(var o,f=1,I=arguments.length;f<I;f++){o=arguments[f];for(var j in o)Object.prototype.hasOwnProperty.call(o,j)&&(g[j]=o[j])}return g},b.apply(this,arguments)},E=function(g,o,f,I){function j(C){return C instanceof f?C:new f(function(T){T(C)})}return new(f||(f=Promise))(function(C,T){function W(ye){try{te(I.next(ye))}catch(Te){T(Te)}}function ne(ye){try{te(I.throw(ye))}catch(Te){T(Te)}}function te(ye){ye.done?C(ye.value):j(ye.value).then(W,ne)}te((I=I.apply(g,o||[])).next())})},m=function(g,o){var f={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},I,j,C,T=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return T.next=W(0),T.throw=W(1),T.return=W(2),typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function W(te){return function(ye){return ne([te,ye])}}function ne(te){if(I)throw new TypeError("Generator is already executing.");for(;T&&(T=0,te[0]&&(f=0)),f;)try{if(I=1,j&&(C=te[0]&2?j.return:te[0]?j.throw||((C=j.return)&&C.call(j),0):j.next)&&!(C=C.call(j,te[1])).done)return C;switch(j=0,C&&(te=[te[0]&2,C.value]),te[0]){case 0:case 1:C=te;break;case 4:return f.label++,{value:te[1],done:!1};case 5:f.label++,j=te[1],te=[0];continue;case 7:te=f.ops.pop(),f.trys.pop();continue;default:if(C=f.trys,!(C=C.length>0&&C[C.length-1])&&(te[0]===6||te[0]===2)){f=0;continue}if(te[0]===3&&(!C||te[1]>C[0]&&te[1]<C[3])){f.label=te[1];break}if(te[0]===6&&f.label<C[1]){f.label=C[1],C=te;break}if(C&&f.label<C[2]){f.label=C[2],f.ops.push(te);break}C[2]&&f.ops.pop(),f.trys.pop();continue}te=o.call(g,f)}catch(ye){te=[6,ye],j=0}finally{I=C=0}if(te[0]&5)throw te[1];return{value:te[0]?te[1]:void 0,done:!0}}},S=function(g,o,f){if(f||arguments.length===2)for(var I=0,j=o.length,C;I<j;I++)(C||!(I in o))&&(C||(C=Array.prototype.slice.call(o,0,I)),C[I]=o[I]);return g.concat(C||Array.prototype.slice.call(o))},N=(function(g){p(o,g);function o(){var f=g!==null&&g.apply(this,arguments)||this;return f.isHandledError=!0,f}return o})(Error),P=function(g){return g&&g.isHandledError?g.message:"Problem loading file; may be corrupt!"},U;(function(g){g.Cover="cover",g.Contain="contain",g.Fill="fill",g.FitWidth="fitWidth",g.FitHeight="fitHeight",g.None="none",g.ScaleDown="scaleDown",g.Layout="layout"})(U||(U={}));var G;(function(g){g.Center="center",g.TopLeft="topLeft",g.TopCenter="topCenter",g.TopRight="topRight",g.CenterLeft="centerLeft",g.CenterRight="centerRight",g.BottomLeft="bottomLeft",g.BottomCenter="bottomCenter",g.BottomRight="bottomRight"})(G||(G={}));var D=(function(){function g(o){var f,I,j,C,T,W,ne;this.fit=(f=o?.fit)!==null&&f!==void 0?f:U.Contain,this.alignment=(I=o?.alignment)!==null&&I!==void 0?I:G.Center,this.layoutScaleFactor=(j=o?.layoutScaleFactor)!==null&&j!==void 0?j:1,this.minX=(C=o?.minX)!==null&&C!==void 0?C:0,this.minY=(T=o?.minY)!==null&&T!==void 0?T:0,this.maxX=(W=o?.maxX)!==null&&W!==void 0?W:0,this.maxY=(ne=o?.maxY)!==null&&ne!==void 0?ne:0}return g.new=function(o){var f=o.fit,I=o.alignment,j=o.minX,C=o.minY,T=o.maxX,W=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new g({fit:f,alignment:I,minX:j,minY:C,maxX:T,maxY:W})},g.prototype.copyWith=function(o){var f=o.fit,I=o.alignment,j=o.layoutScaleFactor,C=o.minX,T=o.minY,W=o.maxX,ne=o.maxY;return new g({fit:f??this.fit,alignment:I??this.alignment,layoutScaleFactor:j??this.layoutScaleFactor,minX:C??this.minX,minY:T??this.minY,maxX:W??this.maxX,maxY:ne??this.maxY})},g.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var f;return this.fit===U.Cover?f=o.Fit.cover:this.fit===U.Contain?f=o.Fit.contain:this.fit===U.Fill?f=o.Fit.fill:this.fit===U.FitWidth?f=o.Fit.fitWidth:this.fit===U.FitHeight?f=o.Fit.fitHeight:this.fit===U.ScaleDown?f=o.Fit.scaleDown:this.fit===U.Layout?f=o.Fit.layout:f=o.Fit.none,this.cachedRuntimeFit=f,f},g.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var f;return this.alignment===G.TopLeft?f=o.Alignment.topLeft:this.alignment===G.TopCenter?f=o.Alignment.topCenter:this.alignment===G.TopRight?f=o.Alignment.topRight:this.alignment===G.CenterLeft?f=o.Alignment.centerLeft:this.alignment===G.CenterRight?f=o.Alignment.centerRight:this.alignment===G.BottomLeft?f=o.Alignment.bottomLeft:this.alignment===G.BottomCenter?f=o.Alignment.bottomCenter:this.alignment===G.BottomRight?f=o.Alignment.bottomRight:f=o.Alignment.center,this.cachedRuntimeAlignment=f,f},g})(),Z=(function(){function g(){}return g.loadRuntime=function(){u.default({locateFile:function(){return g.wasmURL}}).then(function(o){var f;for(g.runtime=o;g.callBackQueue.length>0;)(f=g.callBackQueue.shift())===null||f===void 0||f(g.runtime)}).catch(function(o){var f={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",f);var I="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(g.wasmURL.toLowerCase()!==I)console.warn("Failed to load WASM from ".concat(g.wasmURL," (").concat(f.message,"), trying jsdelivr as a backup")),g.setWasmUrl(I),g.loadRuntime();else{var j=["Could not load Rive WASM file from ".concat(g.wasmURL," or ").concat(I,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(f.type),"- Message: ".concat(f.message),"- WebAssembly-specific error: ".concat(f.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(j)}})},g.getInstance=function(o){g.isLoading||(g.isLoading=!0,g.loadRuntime()),g.runtime?o(g.runtime):g.callBackQueue.push(o)},g.awaitInstance=function(){return new Promise(function(o){return g.getInstance(function(f){return o(f)})})},g.setWasmUrl=function(o){g.wasmURL=o},g.getWasmUrl=function(){return g.wasmURL},g.isLoading=!1,g.callBackQueue=[],g.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),g})(),ae;(function(g){g[g.Number=56]="Number",g[g.Trigger=58]="Trigger",g[g.Boolean=59]="Boolean"})(ae||(ae={}));var $=(function(){function g(o,f){this.type=o,this.runtimeInput=f}return Object.defineProperty(g.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),g.prototype.fire=function(){this.type===ae.Trigger&&this.runtimeInput.fire()},g.prototype.delete=function(){this.runtimeInput=null},g})(),B;(function(g){g[g.General=128]="General",g[g.OpenUrl=131]="OpenUrl"})(B||(B={}));var he=(function(){function g(o){this.nativeArtboard=o}return g})(),le=(function(){function g(o,f,I,j){this.stateMachine=o,this.playing=I,this.artboard=j,this.inputs=[],this.instance=new f.StateMachineInstance(o,j),this.initInputs(f)}return Object.defineProperty(g.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"statesChanged",{get:function(){for(var o=[],f=0;f<this.instance.stateChangedCount();f++)o.push(this.instance.stateChangedNameByIndex(f));return o},enumerable:!1,configurable:!0}),g.prototype.advance=function(o){this.instance.advance(o)},g.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},g.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},g.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},g.prototype.initInputs=function(o){for(var f=0;f<this.instance.inputCount();f++){var I=this.instance.input(f);this.inputs.push(this.mapRuntimeInput(I,o))}},g.prototype.mapRuntimeInput=function(o,f){if(o.type===f.SMIInput.bool)return new $(ae.Boolean,o.asBool());if(o.type===f.SMIInput.number)return new $(ae.Number,o.asNumber());if(o.type===f.SMIInput.trigger)return new $(ae.Trigger,o.asTrigger())},g.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},g.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},g})(),Se=(function(){function g(o,f,I,j,C){j===void 0&&(j=[]),C===void 0&&(C=[]),this.runtime=o,this.artboard=f,this.eventManager=I,this.animations=j,this.stateMachines=C}return g.prototype.add=function(o,f,I){if(I===void 0&&(I=!0),o=Ie(o),o.length===0)this.animations.forEach(function(Ke){return Ke.playing=f}),this.stateMachines.forEach(function(Ke){return Ke.playing=f});else for(var j=this.animations.map(function(Ke){return Ke.name}),C=this.stateMachines.map(function(Ke){return Ke.name}),T=0;T<o.length;T++){var W=j.indexOf(o[T]),ne=C.indexOf(o[T]);if(W>=0||ne>=0)W>=0?this.animations[W].playing=f:this.stateMachines[ne].playing=f;else{var te=this.artboard.animationByName(o[T]);if(te){var ye=new v.Animation(te,this.artboard,this.runtime,f);ye.advance(0),ye.apply(1),this.animations.push(ye)}else{var Te=this.artboard.stateMachineByName(o[T]);if(Te){var ze=new le(Te,this.runtime,f,this.artboard);this.stateMachines.push(ze)}}}}return I&&(f?this.eventManager.fire({type:be.Play,data:this.playing}):this.eventManager.fire({type:be.Pause,data:this.paused})),f?this.playing:this.paused},g.prototype.initLinearAnimations=function(o,f){for(var I=this.animations.map(function(ne){return ne.name}),j=0;j<o.length;j++){var C=I.indexOf(o[j]);if(C>=0)this.animations[C].playing=f;else{var T=this.artboard.animationByName(o[j]);if(T){var W=new v.Animation(T,this.artboard,this.runtime,f);W.advance(0),W.apply(1),this.animations.push(W)}else console.error("Animation with name ".concat(o[j]," not found."))}}},g.prototype.initStateMachines=function(o,f){for(var I=this.stateMachines.map(function(ne){return ne.name}),j=0;j<o.length;j++){var C=I.indexOf(o[j]);if(C>=0)this.stateMachines[C].playing=f;else{var T=this.artboard.stateMachineByName(o[j]);if(T){var W=new le(T,this.runtime,f,this.artboard);this.stateMachines.push(W),f||W.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[j]," not found.")),this.initLinearAnimations([o[j]],f)}}},g.prototype.play=function(o){return this.add(o,!0)},g.prototype.pause=function(o){return this.add(o,!1)},g.prototype.scrub=function(o,f){var I=this.animations.filter(function(j){return o.includes(j.name)});return I.forEach(function(j){return j.scrubTo=f}),I.map(function(j){return j.name})},Object.defineProperty(g.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),g.prototype.stop=function(o){var f=this;o=Ie(o);var I=[];if(o.length===0)I=this.animations.map(function(T){return T.name}).concat(this.stateMachines.map(function(T){return T.name})),this.animations.forEach(function(T){return T.cleanup()}),this.stateMachines.forEach(function(T){return T.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var j=this.animations.filter(function(T){return o.includes(T.name)});j.forEach(function(T){T.cleanup(),f.animations.splice(f.animations.indexOf(T),1)});var C=this.stateMachines.filter(function(T){return o.includes(T.name)});C.forEach(function(T){T.cleanup(),f.stateMachines.splice(f.stateMachines.indexOf(T),1)}),I=j.map(function(T){return T.name}).concat(C.map(function(T){return T.name}))}return this.eventManager.fire({type:be.Stop,data:I}),I},Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,f){return o||f.playing},!1)||this.stateMachines.reduce(function(o,f){return o||f.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),g.prototype.atLeastOne=function(o,f){f===void 0&&(f=!0);var I;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([I=this.artboard.animationByIndex(0).name],o,f):this.artboard.stateMachineCount()>0&&this.add([I=this.artboard.stateMachineByIndex(0).name],o,f)),I},g.prototype.handleLooping=function(){for(var o=0,f=this.animations.filter(function(j){return j.playing});o<f.length;o++){var I=f[o];I.loopValue===0&&I.loopCount?(I.loopCount=0,this.stop(I.name)):I.loopValue===1&&I.loopCount?(this.eventManager.fire({type:be.Loop,data:{animation:I.name,type:oe.Loop}}),I.loopCount=0):I.loopValue===2&&I.loopCount>1&&(this.eventManager.fire({type:be.Loop,data:{animation:I.name,type:oe.PingPong}}),I.loopCount=0)}},g.prototype.handleStateChanges=function(){for(var o=[],f=0,I=this.stateMachines.filter(function(C){return C.playing});f<I.length;f++){var j=I[f];o.push.apply(o,j.statesChanged)}o.length>0&&this.eventManager.fire({type:be.StateChange,data:o})},g.prototype.handleAdvancing=function(o){this.eventManager.fire({type:be.Advance,data:o})},g})(),be;(function(g){g.Load="load",g.LoadError="loaderror",g.Play="play",g.Pause="pause",g.Stop="stop",g.Loop="loop",g.Draw="draw",g.Advance="advance",g.StateChange="statechange",g.RiveEvent="riveevent",g.AudioStatusChange="audiostatuschange"})(be||(be={}));var oe;(function(g){g.OneShot="oneshot",g.Loop="loop",g.PingPong="pingpong"})(oe||(oe={}));var Ce=(function(){function g(o){o===void 0&&(o=[]),this.listeners=o}return g.prototype.getListeners=function(o){return this.listeners.filter(function(f){return f.type===o})},g.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},g.prototype.remove=function(o){for(var f=0;f<this.listeners.length;f++){var I=this.listeners[f];if(I.type===o.type&&I.callback===o.callback){this.listeners.splice(f,1);break}}},g.prototype.removeAll=function(o){var f=this;o?this.listeners.filter(function(I){return I.type===o}).forEach(function(I){return f.remove(I)}):this.listeners.splice(0,this.listeners.length)},g.prototype.fire=function(o){var f=this.getListeners(o.type);f.forEach(function(I){return I.callback(o)})},g})(),Ue=(function(){function g(o){this.eventManager=o,this.queue=[]}return g.prototype.add=function(o){this.queue.push(o)},g.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},g})(),we;(function(g){g[g.AVAILABLE=0]="AVAILABLE",g[g.UNAVAILABLE=1]="UNAVAILABLE"})(we||(we={}));var $e=(function(g){p(o,g);function o(){var f=g!==null&&g.apply(this,arguments)||this;return f._started=!1,f._enabled=!1,f._status=we.UNAVAILABLE,f}return o.prototype.delay=function(f){return E(this,void 0,void 0,function(){return m(this,function(I){return[2,new Promise(function(j){return setTimeout(j,f)})]})})},o.prototype.timeout=function(){return E(this,void 0,void 0,function(){return m(this,function(f){return[2,new Promise(function(I,j){return setTimeout(j,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:be.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return E(this,void 0,void 0,function(){return m(this,function(f){return this._enabled||(this._enabled=!0,this._status=we.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return E(this,void 0,void 0,function(){return m(this,function(f){switch(f.label){case 0:if(!(this._status===we.UNAVAILABLE&&this._audioContext!==null))return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return f.sent(),this.enableAudio(),[3,4];case 3:return f.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return E(this,void 0,void 0,function(){return m(this,function(f){switch(f.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),f.label=2;case 2:return this._status!==we.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return f.sent(),[4,this.delay(1e3)];case 4:return f.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var f=this,I=function(){return E(f,void 0,void 0,function(){return m(this,function(j){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",I,{once:!0})},o.prototype.establishAudio=function(){return E(this,void 0,void 0,function(){return m(this,function(f){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===we.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(Ce),me=new $e,Ye=(function(){function g(){}return g.prototype.observe=function(){},g.prototype.unobserve=function(){},g.prototype.disconnect=function(){},g})(),Xe=globalThis.ResizeObserver||Ye,We=(function(){function g(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(f){var I=o._elementsMap.get(f.target);I!==null?I.onResize(f.target.clientWidth==0||f.target.clientHeight==0):o._resizeObserver.unobserve(f.target)},this._onObserved=function(f){f.forEach(o._onObservedEntry)},this._resizeObserver=new Xe(this._onObserved)}return g.prototype.add=function(o,f){var I={onResize:f,element:o};return this._elementsMap.set(o,I),this._resizeObserver.observe(o),I},g.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},g})(),He=new We,Je=(function(){function g(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new Ce,o.onLoad&&this.on(be.Load,o.onLoad),o.onLoadError&&this.on(be.LoadError,o.onLoadError)}return g.prototype.initData=function(){return E(this,void 0,void 0,function(){var o,f,I,j,C;return m(this,function(T){switch(T.label){case 0:return this.src?(o=this,[4,ee(this.src)]):[3,2];case 1:o.buffer=T.sent(),T.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(I=new y.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),f=I.assetLoader),j=this,[4,this.runtime.load(new Uint8Array(this.buffer),f,this.enableRiveAssetCDN)]);case 3:return j.file=T.sent(),this.destroyed?((C=this.file)===null||C===void 0||C.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:be.Load,data:this}):this.fireLoadError(g.fileLoadErrorMessage),[2])}})})},g.prototype.init=function(){return E(this,void 0,void 0,function(){var o,f;return m(this,function(I){switch(I.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(g.missingErrorMessage),[2];I.label=1;case 1:return I.trys.push([1,4,,5]),o=this,[4,Z.awaitInstance()];case 2:return o.runtime=I.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return I.sent(),[3,5];case 4:return f=I.sent(),this.fireLoadError(f instanceof Error?f.message:g.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},g.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:be.LoadError,data:o}),new Error(o)},g.prototype.on=function(o,f){this.eventManager.add({type:o,callback:f})},g.prototype.off=function(o,f){this.eventManager.remove({type:o,callback:f})},g.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},g.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},g.prototype.getArtboard=function(o){var f=this.file.artboardByName(o);return f!=null?new he(f):null},g.missingErrorMessage="Rive source file or data buffer required",g.fileLoadErrorMessage="The file failed to load",g})(),Me=(function(){function g(o){var f=this,I;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(j){var C=f._hasZeroSize!==j;f._hasZeroSize=j,j?(!f._layout.maxX||!f._layout.maxY)&&f.resizeToCanvas():C&&f.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=He.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(I=o.layout)!==null&&I!==void 0?I:new D,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new Ce,o.onLoad&&this.on(be.Load,o.onLoad),o.onLoadError&&this.on(be.LoadError,o.onLoadError),o.onPlay&&this.on(be.Play,o.onPlay),o.onPause&&this.on(be.Pause,o.onPause),o.onStop&&this.on(be.Stop,o.onStop),o.onLoop&&this.on(be.Loop,o.onLoop),o.onStateChange&&this.on(be.StateChange,o.onStateChange),o.onAdvance&&this.on(be.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(be.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(be.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(be.Play,o.onplay),o.onpause&&!o.onPause&&this.on(be.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(be.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(be.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(be.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Ue(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(g.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),g.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new g(o)},g.prototype.onSystemAudioChanged=function(){this.volume=this._volume},g.prototype.init=function(o){var f=this,I=o.src,j=o.buffer,C=o.riveFile,T=o.animations,W=o.stateMachines,ne=o.artboard,te=o.autoplay,ye=te===void 0?!1:te,Te=o.useOffscreenRenderer,ze=Te===void 0?!1:Te,Ke=o.autoBind,ht=Ke===void 0?!1:Ke;if(!this.destroyed){if(this.src=I,this.buffer=j,this.riveFile=C,!this.src&&!this.buffer&&!this.riveFile)throw new N(g.missingErrorMessage);var Pt=Ie(T),Ze=Ie(W);this.loaded=!1,this.readyForPlaying=!1,Z.awaitInstance().then(function(Ct){f.destroyed||(f.runtime=Ct,f.removeRiveListeners(),f.deleteRiveRenderer(),f.renderer=f.runtime.makeRenderer(f.canvas,ze),f.canvas.width||f.canvas.height||f.resizeDrawingSurfaceToCanvas(),f.initData(ne,Pt,Ze,ye,ht).then(function(tt){if(tt)return f.setupRiveListeners()}).catch(function(tt){console.error(tt)}))}).catch(function(Ct){console.error(Ct)})}},g.prototype.setupRiveListeners=function(o){var f=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var I=(this.animator.stateMachines||[]).filter(function(C){return C.playing&&f.runtime.hasListeners(C.instance)}).map(function(C){return C.instance}),j=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(j=o.isTouchScrollEnabled),this.eventCleanup=(0,y.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:I,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:j,layoutScaleFactor:this._layout.layoutScaleFactor})}},g.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},g.prototype.initializeAudio=function(){var o=this,f;me.status==we.UNAVAILABLE&&!((f=this.artboard)===null||f===void 0)&&f.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:be.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},me.add(this._audioEventListener),me.establishAudio())},g.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},g.prototype.initData=function(o,f,I,j,C){return E(this,void 0,void 0,function(){var T,W,ne,te;return m(this,function(ye){switch(ye.label){case 0:return ye.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(T=new Je({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=T,[4,T.init()]);case 1:if(ye.sent(),this.destroyed)return T.destroyIfUnused(),[2,!1];ye.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,f,I,j,C),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:be.Load,data:(te=this.src)!==null&&te!==void 0?te:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return W=ye.sent(),ne=P(W),console.warn(ne),this.eventManager.fire({type:be.LoadError,data:ne}),[2,Promise.reject(ne)];case 4:return[2]}})})},g.prototype.initArtboard=function(o,f,I,j,C){if(this.file){var T=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!T){var W="Invalid artboard name or no default artboard";console.warn(W),this.eventManager.fire({type:be.LoadError,data:W});return}if(this.artboard=T,T.volume=this._volume*me.systemVolume,this.artboard.animationCount()<1){var W="Artboard has no animations";throw this.eventManager.fire({type:be.LoadError,data:W}),W}this.animator=new Se(this.runtime,this.artboard,this.eventManager);var ne;if(f.length>0||I.length>0?(ne=f.concat(I),this.animator.initLinearAnimations(f,j),this.animator.initStateMachines(I,j)):ne=[this.animator.atLeastOne(j,!1)],this.taskQueue.add({event:{type:j?be.Play:be.Pause,data:ne}}),C){var te=this.file.defaultArtboardViewModel(T);if(te!==null){var ye=te.defaultInstance();if(ye!==null){var Te=new Ge(ye,null);this.bindViewModelInstance(Te)}}}}},g.prototype.drawFrame=function(){var o,f;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(f=this.runtime)===null||f===void 0||f.resolveAnimationFrame()):this.startRendering()},g.prototype.draw=function(o,f){var I;this.frameRequestId=null;var j=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,f?.());var C=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var T=this.animator.animations.filter(function(qt){return qt.playing||qt.needsScrub}).sort(function(qt){return qt.needsScrub?-1:1}),W=0,ne=T;W<ne.length;W++){var te=ne[W];te.advance(C),te.instance.didLoop&&(te.loopCount+=1),te.apply(1)}for(var ye=this.animator.stateMachines.filter(function(qt){return qt.playing}),Te=0,ze=ye;Te<ze.length;Te++){var Ke=ze[Te],ht=Ke.reportedEventCount();if(ht)for(var Pt=0;Pt<ht;Pt++){var Ze=Ke.reportedEventAt(Pt);if(Ze)if(Ze.type===B.OpenUrl){if(this.eventManager.fire({type:be.RiveEvent,data:Ze}),this.automaticallyHandleEvents){var Ct=document.createElement("a"),tt=Ze,jt=tt.url,rt=tt.target,gt=(0,y.sanitizeUrl)(jt);jt&&Ct.setAttribute("href",gt),rt&&Ct.setAttribute("target",rt),gt&&gt!==y.BLANK_URL&&Ct.click()}}else this.eventManager.fire({type:be.RiveEvent,data:Ze})}Ke.advanceAndApply(C)}this.animator.stateMachines.length==0&&this.artboard.advance(C);var Re=this.renderer;Re.clear(),Re.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Re),Re.restore(),Re.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(C),this.frameCount++;var it=performance.now();for(this.frameTimes.push(it),this.durations.push(it-j);this.frameTimes[0]<=it-1e3;)this.frameTimes.shift(),this.durations.shift();(I=this._viewModelInstance)===null||I===void 0||I.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},g.prototype.alignRenderer=function(){var o=this,f=o.renderer,I=o.runtime,j=o._layout,C=o.artboard;f.align(j.runtimeFit(I),j.runtimeAlignment(I),{minX:j.minX,minY:j.minY,maxX:j.maxX,maxY:j.maxY},C.bounds,this._devicePixelRatioUsed*j.layoutScaleFactor)},Object.defineProperty(g.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,f){return o+f},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),g.prototype.cleanup=function(){var o,f;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&He.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(me.remove(this._audioEventListener),this._audioEventListener=null),(f=this._viewModelInstance)===null||f===void 0||f.cleanup(),this._viewModelInstance=null,this._dataEnums=null},g.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},g.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},g.prototype.retrieveTextRun=function(o){var f;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var I=this.artboard.textRun(o);if(!I){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((f=this.artboard)===null||f===void 0?void 0:f.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return I},g.prototype.getTextRunValue=function(o){var f=this.retrieveTextRun(o);return f?f.text:void 0},g.prototype.setTextRunValue=function(o,f){var I=this.retrieveTextRun(o);I&&(I.text=f)},g.prototype.play=function(o,f){var I=this;if(o=Ie(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return I.play(o,f)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},g.prototype.pause=function(o){var f=this;if(o=Ie(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return f.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},g.prototype.scrub=function(o,f){var I=this;if(o=Ie(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return I.scrub(o,f)}});return}this.animator.scrub(o,f||0),this.drawFrame()},g.prototype.stop=function(o){var f=this;if(o=Ie(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return f.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},g.prototype.reset=function(o){var f,I,j=o?.artboard,C=Ie(o?.animations),T=Ie(o?.stateMachines),W=(f=o?.autoplay)!==null&&f!==void 0?f:!1,ne=(I=o?.autoBind)!==null&&I!==void 0?I:!1;this.cleanupInstances(),this.initArtboard(j,C,T,W,ne),this.taskQueue.process()},g.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),g.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},g.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var f=this.canvas.getBoundingClientRect(),I=f.width,j=f.height,C=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=C,this.canvas.width=C*I,this.canvas.height=C*j,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===U.Layout){var T=this._layout.layoutScaleFactor;this.artboard.width=I/T,this.artboard.height=j/T}}},Object.defineProperty(g.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],f=0;f<this.artboard.animationCount();f++)o.push(this.artboard.animationByIndex(f).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],f=0;f<this.artboard.stateMachineCount();f++)o.push(this.artboard.stateMachineByIndex(f).name);return o},enumerable:!1,configurable:!0}),g.prototype.stateMachineInputs=function(o){if(this.loaded){var f=this.animator.stateMachines.find(function(I){return I.name===o});return f?.inputs}},g.prototype.retrieveInputAtPath=function(o,f){if(!o){console.warn("No input name provided for path '".concat(f,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(f,"', but the Artboard is null"));return}var I=this.artboard.inputByPath(o,f);if(!I){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(f,"'"));return}return I},g.prototype.setBooleanStateAtPath=function(o,f,I){var j=this.retrieveInputAtPath(o,I);j&&(j.type===ae.Boolean?j.asBool().value=f:console.warn("Input with name: '".concat(o,"', at path:'").concat(I,"' is not a boolean")))},g.prototype.setNumberStateAtPath=function(o,f,I){var j=this.retrieveInputAtPath(o,I);j&&(j.type===ae.Number?j.asNumber().value=f:console.warn("Input with name: '".concat(o,"', at path:'").concat(I,"' is not a number")))},g.prototype.fireStateAtPath=function(o,f){var I=this.retrieveInputAtPath(o,f);I&&(I.type===ae.Trigger?I.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(f,"' is not a trigger")))},g.prototype.retrieveTextAtPath=function(o,f){if(!o){console.warn("No text name provided for path '".concat(f,"'"));return}if(!f){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(f,"', but the Artboard is null"));return}var I=this.artboard.textByPath(o,f);if(!I){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(f,"'"));return}return I},g.prototype.getTextRunValueAtPath=function(o,f){var I=this.retrieveTextAtPath(o,f);if(!I){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(f,"'"));return}return I.text},g.prototype.setTextRunValueAtPath=function(o,f,I){var j=this.retrieveTextAtPath(o,I);if(!j){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(I,"'"));return}j.text=f},Object.defineProperty(g.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),g.prototype.on=function(o,f){this.eventManager.add({type:o,callback:f})},g.prototype.off=function(o,f){this.eventManager.remove({type:o,callback:f})},g.prototype.unsubscribe=function(o,f){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,f)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},g.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},g.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},g.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},g.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(g.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},f=0;f<this.file.artboardCount();f++){for(var I=this.file.artboardByIndex(f),j={name:I.name,animations:[],stateMachines:[]},C=0;C<I.animationCount();C++){var T=I.animationByIndex(C);j.animations.push(T.name)}for(var W=0;W<I.stateMachineCount();W++){for(var ne=I.stateMachineByIndex(W),te=ne.name,ye=new this.runtime.StateMachineInstance(ne,I),Te=[],ze=0;ze<ye.inputCount();ze++){var Ke=ye.input(ze);Te.push({name:Ke.name,type:Ke.type})}j.stateMachines.push({name:te,inputs:Te})}o.artboards.push(j)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*me.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),g.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(g.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),g.prototype.bindViewModelInstance=function(o){var f;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(f=this._viewModelInstance)===null||f===void 0||f.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(I){return I.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(g.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),g.prototype.viewModelByIndex=function(o){var f=this.file.viewModelByIndex(o);return f!==null?new De(f):null},g.prototype.viewModelByName=function(o){var f=this.file.viewModelByName(o);return f!==null?new De(f):null},g.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(f){return new xe(f)})}return this._dataEnums},g.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new De(o)}return null},g.prototype.getArtboard=function(o){var f,I;return(I=(f=this.riveFile)===null||f===void 0?void 0:f.getArtboard(o))!==null&&I!==void 0?I:null},g.missingErrorMessage="Rive source file or data buffer required",g.cleanupErrorMessage="Attempt to use file after calling cleanup.",g})(),De=(function(){function g(o){this._viewModel=o}return Object.defineProperty(g.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),g.prototype.instanceByIndex=function(o){var f=this._viewModel.instanceByIndex(o);return f!==null?new Ge(f,null):null},g.prototype.instanceByName=function(o){var f=this._viewModel.instanceByName(o);return f!==null?new Ge(f,null):null},g.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new Ge(o,null):null},g.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new Ge(o,null):null},Object.defineProperty(g.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),g})(),xe=(function(){function g(o){this._dataEnum=o}return Object.defineProperty(g.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),g})(),ke;(function(g){g.Number="number",g.String="string",g.Boolean="boolean",g.Color="color",g.Trigger="trigger",g.Enum="enum",g.List="list",g.Image="image",g.Artboard="artboard"})(ke||(ke={}));var Ge=(function(){function g(o,f){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,f!==null&&this._parents.push(f)}return Object.defineProperty(g.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),g.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},g.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},g.prototype.removeParent=function(o){var f=this._parents.indexOf(o);if(f!==-1){var I=this._parents[f];I.removeFromViewModelCallbacks(this),this._parents.splice(f,1)}},g.prototype.addToPropertyCallbacks=function(o){var f=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(I){I.addToViewModelCallbacks(f)}))},g.prototype.removeFromPropertyCallbacks=function(o){var f=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(I){return I!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(I){I.removeFromViewModelCallbacks(f)}))},g.prototype.addToViewModelCallbacks=function(o){var f=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(I){I.addToViewModelCallbacks(f)}))},g.prototype.removeFromViewModelCallbacks=function(o){var f=this;this._children.includes(o)&&(this._children=this._children.filter(function(I){return I!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(I){I.removeFromViewModelCallbacks(f)}))},g.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},g.prototype.propertyFromPath=function(o,f){var I=o.split("/");return this.propertyFromPathSegments(I,0,f)},g.prototype.viewModelFromPathSegments=function(o,f){var I=this.internalViewModelInstance(o[f]);return I!==null?f==o.length-1?I:I.viewModelFromPathSegments(o,f++):null},g.prototype.propertyFromPathSegments=function(o,f,I){var j,C,T,W,ne,te,ye,Te,ze,Ke,ht,Pt,Ze,Ct,tt,jt,rt,gt;if(f<o.length-1){var Re=this.internalViewModelInstance(o[f]);return Re!==null?Re.propertyFromPathSegments(o,f+1,I):null}var it=null;switch(I){case ke.Number:if(it=(C=(j=this._runtimeInstance)===null||j===void 0?void 0:j.number(o[f]))!==null&&C!==void 0?C:null,it!==null)return new ue(it,this);break;case ke.String:if(it=(W=(T=this._runtimeInstance)===null||T===void 0?void 0:T.string(o[f]))!==null&&W!==void 0?W:null,it!==null)return new Fe(it,this);break;case ke.Boolean:if(it=(te=(ne=this._runtimeInstance)===null||ne===void 0?void 0:ne.boolean(o[f]))!==null&&te!==void 0?te:null,it!==null)return new ce(it,this);break;case ke.Color:if(it=(Te=(ye=this._runtimeInstance)===null||ye===void 0?void 0:ye.color(o[f]))!==null&&Te!==void 0?Te:null,it!==null)return new z(it,this);break;case ke.Trigger:if(it=(Ke=(ze=this._runtimeInstance)===null||ze===void 0?void 0:ze.trigger(o[f]))!==null&&Ke!==void 0?Ke:null,it!==null)return new J(it,this);break;case ke.Enum:if(it=(Pt=(ht=this._runtimeInstance)===null||ht===void 0?void 0:ht.enum(o[f]))!==null&&Pt!==void 0?Pt:null,it!==null)return new R(it,this);break;case ke.List:if(it=(Ct=(Ze=this._runtimeInstance)===null||Ze===void 0?void 0:Ze.list(o[f]))!==null&&Ct!==void 0?Ct:null,it!==null)return new Y(it,this);break;case ke.Image:if(it=(jt=(tt=this._runtimeInstance)===null||tt===void 0?void 0:tt.image(o[f]))!==null&&jt!==void 0?jt:null,it!==null)return new M(it,this);break;case ke.Artboard:if(it=(gt=(rt=this._runtimeInstance)===null||rt===void 0?void 0:rt.artboard(o[f]))!==null&&gt!==void 0?gt:null,it!==null)return new H(it,this);break}return null},g.prototype.internalViewModelInstance=function(o){var f;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var I=(f=this._runtimeInstance)===null||f===void 0?void 0:f.viewModel(o);if(I!==null){var j=new g(I,this);return j.internalIncrementReferenceCount(),this._viewModelInstances.set(o,j),j}return null},g.prototype.number=function(o){var f=this.propertyFromPath(o,ke.Number);return f},g.prototype.string=function(o){var f=this.propertyFromPath(o,ke.String);return f},g.prototype.boolean=function(o){var f=this.propertyFromPath(o,ke.Boolean);return f},g.prototype.color=function(o){var f=this.propertyFromPath(o,ke.Color);return f},g.prototype.trigger=function(o){var f=this.propertyFromPath(o,ke.Trigger);return f},g.prototype.enum=function(o){var f=this.propertyFromPath(o,ke.Enum);return f},g.prototype.list=function(o){var f=this.propertyFromPath(o,ke.List);return f},g.prototype.image=function(o){var f=this.propertyFromPath(o,ke.Image);return f},g.prototype.artboard=function(o){var f=this.propertyFromPath(o,ke.Artboard);return f},g.prototype.viewModel=function(o){var f=o.split("/"),I=f.length>1?this.viewModelFromPathSegments(f.slice(0,f.length-1),0):this;return I!=null?I.internalViewModelInstance(f[f.length-1]):null},g.prototype.internalReplaceViewModel=function(o,f){var I;if(f.runtimeInstance!==null){var j=((I=this._runtimeInstance)===null||I===void 0?void 0:I.replaceViewModel(o,f.runtimeInstance))||!1;if(j){f.internalIncrementReferenceCount();var C=this.internalViewModelInstance(o);C!==null&&(C.removeParent(this),this._children.includes(C)&&(this._children=this._children.filter(function(T){return T!==C})),C.cleanup()),this._viewModelInstances.set(o,f),f.addParent(this)}return j}return!1},g.prototype.replaceViewModel=function(o,f){var I,j=o.split("/"),C=j.length>1?this.viewModelFromPathSegments(j.slice(0,j.length-1),0):this;return(I=C?.internalReplaceViewModel(j[j.length-1],f))!==null&&I!==void 0?I:!1},g.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},g.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(g.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(f){return b({},f)}))||[]},enumerable:!1,configurable:!0}),g.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},g.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(j){j.cleanup()}),this._viewModelInstances.clear();var f=S([],this._children,!0);this._children.length=0;var I=S([],this._parents,!0);this._parents.length=0,f.forEach(function(j){j.removeParent(o)}),I.forEach(function(j){j.removeFromViewModelCallbacks(o)})}},g})(),Qe=(function(){function g(o,f){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=f}return g.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},g.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(f){return f!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},g.prototype.internalHandleCallback=function(o){},g.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(f){o.internalHandleCallback(f)})},g.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},g.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),g})(),Fe=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f(this.value)},o})(Qe),ue=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f(this.value)},o})(Qe),ce=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f(this.value)},o})(Qe),J=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(f){f()},o})(Qe),R=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(f){this._viewModelInstanceValue.valueIndex=f},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f(this.value)},o})(Qe),Y=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(f){f.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(f.runtimeInstance),f.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(f,I){return f.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(f.runtimeInstance,I)?(f.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(f){f.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(f.runtimeInstance),f.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(f){this._viewModelInstanceValue.removeInstanceAt(f)},o.prototype.instanceAt=function(f){var I=this._viewModelInstanceValue.instanceAt(f);if(I!=null){var j=new Ge(I,this._parentViewModel);return j}return null},o.prototype.swap=function(f,I){this._viewModelInstanceValue.swap(f,I)},o.prototype.internalHandleCallback=function(f){f()},o})(Qe),z=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),o.prototype.rgb=function(f,I,j){this._viewModelInstanceValue.rgb(f,I,j)},o.prototype.rgba=function(f,I,j,C){this._viewModelInstanceValue.argb(C,f,I,j)},o.prototype.argb=function(f,I,j,C){this._viewModelInstanceValue.argb(f,I,j,C)},o.prototype.alpha=function(f){this._viewModelInstanceValue.alpha(f)},o.prototype.opacity=function(f){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,f))*255))},o.prototype.internalHandleCallback=function(f){f(this.value)},o})(Qe),M=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{set:function(f){var I;this._viewModelInstanceValue.value((I=f?.nativeImage)!==null&&I!==void 0?I:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f()},o})(Qe),H=(function(g){p(o,g);function o(f,I){return g.call(this,f,I)||this}return Object.defineProperty(o.prototype,"value",{set:function(f){var I;this._viewModelInstanceValue.value((I=f?.nativeArtboard)!==null&&I!==void 0?I:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(f){f()},o})(Qe),ee=function(g){return E(void 0,void 0,void 0,function(){var o,f,I;return m(this,function(j){switch(j.label){case 0:return o=new Request(g),[4,fetch(o)];case 1:return f=j.sent(),[4,f.arrayBuffer()];case 2:return I=j.sent(),[2,I]}})})},Ie=function(g){return typeof g=="string"?[g]:g instanceof Array?g:[]},je={EventManager:Ce,TaskQueueManager:Ue},pe=function(g){return E(void 0,void 0,void 0,function(){var o,f,I;return m(this,function(j){switch(j.label){case 0:return o=new Promise(function(C){return Z.getInstance(function(T){T.decodeAudio(g,C)})}),[4,o];case 1:return f=j.sent(),I=new y.AudioWrapper(f),y.finalizationRegistry.register(I,f),[2,I]}})})},Q=function(g){return E(void 0,void 0,void 0,function(){var o,f,I;return m(this,function(j){switch(j.label){case 0:return o=new Promise(function(C){return Z.getInstance(function(T){T.decodeImage(g,C)})}),[4,o];case 1:return f=j.sent(),I=new y.ImageWrapper(f),y.finalizationRegistry.register(I,f),[2,I]}})})},se=function(g){return E(void 0,void 0,void 0,function(){var o,f,I;return m(this,function(j){switch(j.label){case 0:return o=new Promise(function(C){return Z.getInstance(function(T){T.decodeFont(g,C)})}),[4,o];case 1:return f=j.sent(),I=new y.FontWrapper(f),y.finalizationRegistry.register(I,f),[2,I]}})})}})(),l})())})(ps)),ps.exports}var Xv=Jv();const Fu="dracula",Ss="https://vycjpmuyscfygstjjied.supabase.co";var Qv=X('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Pl(r,e){Ft(e,!0);let t=pt(e,"bucketName",3,Fu),n=Ne(void 0);wr(()=>{if(!d(n))return;const u=new Xv.Rive({src:`${Ss}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:d(n),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var i=Qv(),l=w(i);ya(l,u=>ie(n,u),()=>d(n)),L(r,i),$t()}function Zv(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var ep=X('<button class="btn btn-danger svelte-545h2y">🏳️ Сдаться</button>'),tp=X('<div role="button" tabindex="0"> </div>'),rp=kd('<polyline class="connection-line svelte-545h2y" vector-effect="non-scaling-stroke"></polyline>'),np=X('<div class="item-icon reward-glow svelte-545h2y"><img class="icon-preview svelte-545h2y" height="64px"/></div>'),ip=X('<div id="reward-panel" class="svelte-545h2y"><!> <div class="reward-info svelte-545h2y"><div class="reward-label svelte-545h2y">Награда:</div> <div class="reward-name svelte-545h2y"> </div></div></div>'),sp=X('<span class="cooldown-timer svelte-545h2y"> </span>'),ap=X("<button> </button>"),op=X('<div id="modal-overlay"><div class="modal-content svelte-545h2y"><div class="modal-title svelte-545h2y"> </div> <div class="modal-text svelte-545h2y"> </div> <div class="modal-buttons svelte-545h2y"></div></div></div>'),lp=X('<div class="body-wrapper svelte-545h2y"><div id="game-header" class="svelte-545h2y"><button class="btn btn-secondary svelte-545h2y">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-545h2y"><div id="grid" class="svelte-545h2y"></div> <svg id="line-layer" class="svelte-545h2y"><!></svg></div> <div id="game-header" class="svelte-545h2y"><!> <span class="tiles-counter svelte-545h2y">Осталось: <strong class="svelte-545h2y"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function up(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=8,v=6,y=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let p=Ne(yt([])),b=Ne(yt([])),E=Ne(yt({})),m=Ne(yt([])),S=Ne(null),N=Ne(!1),P=Ne(!1),U=Ne(yt([])),G=Ne(0),D=Ne(0);const Z=5;let ae=Ne(yt({show:!1,title:"",text:"",actions:[]})),$,B;wr(()=>{Ce()});function he(){if(!d(b)||d(b).length===0)return 0;let C=0;for(let T=0;T<h;T++)for(let W=0;W<v;W++)d(b)[T]&&!d(b)[T][W]&&C++;return C}let le=Dt(he),Se=Dt(()=>d(D)<1);function be(){if(!n()||!i()||i().length===0)return null;const C=typeof n()=="string"?n():n().id;return i().find(T=>T.id===C)}let oe=Dt(be);function Ce(){ie(p,[],!0),ie(b,[],!0),ie(S,null),ie(N,!1),ie(P,!1),ie(E,{},!0),ie(m,[],!0),ie(U,[],!0),ie(D,0),ke();let C=[...new Set(y)];for(;C.length<h*v/2;)C=[...C,...C];let T=C.sort(()=>.5-Math.random()).slice(0,h*v/2),W=[];T.forEach(te=>W.push(te,te)),W.sort(()=>Math.random()-.5);let ne=0;for(let te=0;te<h;te++){let ye=[],Te=[];for(let ze=0;ze<v;ze++)ye.push(W[ne++]),Te.push(!1);d(p).push(ye),d(b).push(Te)}setTimeout(Ye,500)}async function Ue(C,T){if(d(N)||d(b)[C][T]||d(P))return;if(d(m).length>0&&ie(m,[],!0),!d(S)){ie(S,{r:C,c:T},!0);return}if(d(S).r===C&&d(S).c===T){ie(S,null);return}const W=d(p)[d(S).r][d(S).c],ne=d(p)[C][T];if(W===ne){const te=Me(d(S).r,d(S).c,C,T);if(te){ie(N,!0),await De(te),d(b)[d(S).r][d(S).c]=!0,d(b)[C][T]=!0,ie(S,null),ie(N,!1),$e(),Ye();return}}ie(S,{r:C,c:T},!0)}async function we(C,T,W){(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),await Ue(C,T))}function $e(){ie(D,Z);const C=setInterval(()=>{ri(D,-1),d(D)<=0&&clearInterval(C)},1e3)}function me(){if(d(N)||d(P)||!d(Se))return;let C=[];for(let W=0;W<h;W++)for(let ne=0;ne<v;ne++)d(b)[W][ne]||C.push({r:W,c:ne,icon:d(p)[W][ne]});let T={};C.forEach(W=>{T[W.icon]||(T[W.icon]=[]),T[W.icon].push(W)});for(let W in T){let ne=T[W];if(!(ne.length<2))for(let te=0;te<ne.length;te++)for(let ye=te+1;ye<ne.length;ye++){let Te=ne[te],ze=ne[ye];if(Me(Te.r,Te.c,ze.r,ze.c)){ie(m,[Te,ze],!0),setTimeout(()=>ie(m,[],!0),1500);return}}}xe("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:ke}])}function Ye(){if(d(le)===0){ie(P,!0),t()?e.onWin?e.onWin():u("win"):xe("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:Ce}]);return}Xe()||(t()?setTimeout(()=>We(),1e3):xe("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ke(),We()}},{text:"Сдаться",action:()=>{xe("Конец","Попытайте удачу снова!",[{text:"ОК",action:Ce}])}}]))}function Xe(){let C=[];for(let W=0;W<h;W++)for(let ne=0;ne<v;ne++)d(b)[W][ne]||C.push({r:W,c:ne,icon:d(p)[W][ne]});let T={};C.forEach(W=>{T[W.icon]||(T[W.icon]=[]),T[W.icon].push(W)});for(let W in T){let ne=T[W];if(!(ne.length<2)){for(let te=0;te<ne.length;te++)for(let ye=te+1;ye<ne.length;ye++)if(Me(ne[te].r,ne[te].c,ne[ye].r,ne[ye].c))return!0}}return!1}function We(){let C=[],T=[];for(let W=0;W<h;W++)for(let ne=0;ne<v;ne++)d(b)[W][ne]||(C.push(d(p)[W][ne]),T.push({r:W,c:ne}));C.length!==0&&(C.sort(()=>Math.random()-.5),T.forEach((W,ne)=>{d(p)[W.r][W.c]=C[ne],d(E)[`${W.r},${W.c}`]=!0}),setTimeout(()=>{ie(E,{},!0),Xe()?ie(P,!1):We()},500))}function He(C,T){return C<0||C>=h||T<0||T>=v?!0:d(b)[C][T]}function Je(C,T,W,ne){if(C!==W&&T!==ne)return!1;if(C===W){const te=Math.min(T,ne),ye=Math.max(T,ne);for(let Te=te+1;Te<ye;Te++)if(!He(C,Te))return!1}else{const te=Math.min(C,W),ye=Math.max(C,W);for(let Te=te+1;Te<ye;Te++)if(!He(Te,T))return!1}return!0}function Me(C,T,W,ne){if(Je(C,T,W,ne))return[{r:C,c:T},{r:W,c:ne}];let te={r:C,c:ne};if(He(te.r,te.c)&&Je(C,T,te.r,te.c)&&Je(te.r,te.c,W,ne))return[{r:C,c:T},te,{r:W,c:ne}];let ye={r:W,c:T};if(He(ye.r,ye.c)&&Je(C,T,ye.r,ye.c)&&Je(ye.r,ye.c,W,ne))return[{r:C,c:T},ye,{r:W,c:ne}];for(let Te=-1;Te<=h;Te++){if(Te===C||Te===W)continue;let ze={r:Te,c:T},Ke={r:Te,c:ne};if(He(ze.r,ze.c)&&He(Ke.r,Ke.c)&&Je(C,T,ze.r,ze.c)&&Je(ze.r,ze.c,Ke.r,Ke.c)&&Je(Ke.r,Ke.c,W,ne))return[{r:C,c:T},ze,Ke,{r:W,c:ne}]}for(let Te=-1;Te<=v;Te++){if(Te===T||Te===ne)continue;let ze={r:C,c:Te},Ke={r:W,c:Te};if(He(ze.r,ze.c)&&He(Ke.r,Ke.c)&&Je(C,T,ze.r,ze.c)&&Je(ze.r,ze.c,Ke.r,Ke.c)&&Je(Ke.r,Ke.c,W,ne))return[{r:C,c:T},ze,Ke,{r:W,c:ne}]}return null}async function De(C){if(await fu(),!$||!B)return;const T=$.getBoundingClientRect(),W=B.getBoundingClientRect(),ne=B.querySelector(".cell");if(!ne)return;const te=ne.offsetWidth,ye=ne.offsetHeight,Te=window.getComputedStyle(B),ze=parseFloat(Te.gap)||4,Ke=W.left-T.left,ht=W.top-T.top,Pt=C.map(Ze=>{let Ct,tt;if(Ze.r>=0&&Ze.r<h&&Ze.c>=0&&Ze.c<v){const rt=B.children[Ze.r*v+Ze.c].getBoundingClientRect();Ct=rt.left-T.left+rt.width/2,tt=rt.top-T.top+rt.height/2}else{const jt=Ze.c*(te+ze)+te/2,rt=Ze.r*(ye+ze)+ye/2;Ct=Ke+jt,tt=ht+rt}return`${Ct.toFixed(1)},${tt.toFixed(1)}`}).join(" ");return ie(U,Pt,!0),ri(G),new Promise(Ze=>{setTimeout(()=>{ie(U,[],!0),Ze()},350)})}function xe(C,T,W){t()||ie(ae,{show:!0,title:C,text:T,actions:W},!0)}function ke(){d(ae).show=!1}var Ge=lp(),Qe=nt(Ge),Fe=w(Qe),ue=w(Fe);ue.__click=Ce;var ce=A(ue,2);{var J=C=>{var T=ep();T.__click=[Zv,t,e,u,xe,Ce],L(C,T)};_e(ce,C=>{t()&&C(J)})}var R=A(Fe,2),Y=w(R);jr(Y,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),et(Y,21,()=>d(p),Nt,(C,T,W)=>{var ne=xt(),te=nt(ne);et(te,17,()=>d(T),Nt,(ye,Te,ze)=>{var Ke=tp();let ht;Ke.__click=()=>Ue(W,ze),Ke.__keydown=Ze=>we(W,ze,Ze);var Pt=w(Ke);de(Ze=>{ht=It(Ke,1,"cell svelte-545h2y",null,ht,Ze),fe(Pt,d(Te))},[()=>({selected:d(S)?.r===W&&d(S)?.c===ze,matched:d(b)[W][ze],shuffling:d(E)[`${W},${ze}`],"hint-glow":d(m).some(Ze=>Ze.r===W&&Ze.c===ze)})]),L(ye,Ke)}),L(C,ne)}),ya(Y,C=>B=C,()=>B);var z=A(Y,2),M=w(z);ma(M,()=>d(G),C=>{var T=xt(),W=nt(T);{var ne=te=>{var ye=rp();de(()=>Ve(ye,"points",d(U))),L(te,ye)};_e(W,te=>{d(U)&&te(ne)})}L(C,T)}),ya(R,C=>$=C,()=>$);var H=A(R,2),ee=w(H);{var Ie=C=>{var T=ip(),W=w(T);{var ne=ze=>{var Ke=np(),ht=w(Ke);de(()=>{Ve(ht,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(oe).icon}`),Ve(ht,"alt",d(oe).name)}),L(ze,Ke)};_e(W,ze=>{d(oe).icon&&ze(ne)})}var te=A(W,2),ye=A(w(te),2),Te=w(ye);de(()=>fe(Te,d(oe).name)),L(C,T)};_e(ee,C=>{d(oe)&&C(Ie)})}var je=A(ee,2),pe=A(w(je)),Q=w(pe),se=A(je,2);let g;se.__click=me;var o=A(w(se));{var f=C=>{var T=sp(),W=w(T);de(()=>fe(W,`(${d(D)??""})`)),L(C,T)};_e(o,C=>{d(D)>0&&C(f)})}var I=A(Qe,2);{var j=C=>{var T=op();let W;var ne=w(T),te=w(ne),ye=w(te),Te=A(te,2),ze=w(Te),Ke=A(Te,2);et(Ke,21,()=>d(ae).actions,ht=>ht.text,(ht,Pt)=>{var Ze=ap();let Ct;Ze.__click=function(...jt){d(Pt).action?.apply(this,jt)};var tt=w(Ze);de(jt=>{Ct=It(Ze,1,"btn svelte-545h2y",null,Ct,jt),fe(tt,d(Pt).text)},[()=>({"btn-secondary":d(Pt).class==="btn-secondary"})]),L(ht,Ze)}),de(ht=>{W=It(T,1,"svelte-545h2y",null,W,ht),fe(ye,d(ae).title),fe(ze,d(ae).text)},[()=>({active:d(ae).show})]),L(C,T)};_e(I,C=>{d(ae).show&&C(j)})}de(C=>{fe(Q,d(le)),g=It(se,1,"btn btn-secondary svelte-545h2y",null,g,C),se.disabled=!d(Se)},[()=>({disabled:!d(Se),"cooldown-active":d(D)>0})]),L(r,Ge),$t()}Bt(["click","keydown"]);function cp(r,e,t,n,i,l,u,h,v,y){if(!(d(e)||d(t)||!d(n)))for(let p=0;p<i;p++)for(let b=0;b<l;b++){if(d(u)[p][b]||d(h)[p][b])continue;let E=d(v)[p][b];for(let m=0;m<i;m++)for(let S=0;S<l;S++)if(!(p===m&&b===S)&&!(d(u)[m][S]||d(h)[m][S])&&d(v)[m][S]===E){ie(y,[{r:p,c:b},{r:m,c:S}],!0),setTimeout(()=>ie(y,[],!0),1500);return}}}function dp(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var fp=X('<button class="btn btn-danger svelte-q16t3v">🏳️ Сдаться</button>'),hp=X('<div role="button" tabindex="0"><div class="card-inner svelte-q16t3v"><div class="card-front svelte-q16t3v"> </div> <div class="card-back svelte-q16t3v">?</div></div></div>'),vp=X('<div class="item-icon reward-glow svelte-q16t3v"><img class="icon-preview svelte-q16t3v" height="64px"/></div>'),pp=X('<div id="reward-panel" class="svelte-q16t3v"><!> <div class="reward-info svelte-q16t3v"><div class="reward-label svelte-q16t3v">Награда:</div> <div class="reward-name svelte-q16t3v"> </div></div></div>'),gp=X('<span class="cooldown-timer svelte-q16t3v"> </span>'),_p=X("<button> </button>"),mp=X('<div id="modal-overlay"><div class="modal-content svelte-q16t3v"><div class="modal-title svelte-q16t3v"> </div> <div class="modal-text svelte-q16t3v"> </div> <div class="modal-buttons svelte-q16t3v"></div></div></div>'),yp=X('<div class="body-wrapper svelte-q16t3v"><div id="game-header" class="svelte-q16t3v"><button class="btn btn-secondary svelte-q16t3v">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-q16t3v"><div id="grid" class="svelte-q16t3v"></div></div> <div id="game-header" class="svelte-q16t3v"><!> <span class="tiles-counter svelte-q16t3v">Осталось: <strong class="svelte-q16t3v"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function bp(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=4,v=4,y=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let p=Ne(yt([])),b=Ne(yt([])),E=Ne(yt([])),m=Ne(yt([])),S=Ne(null),N=Ne(!1),P=Ne(!1),U=Ne(0);const G=5;let D=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{le()});function Z(){if(!d(b)||d(b).length===0)return 0;let M=0;for(let H=0;H<h;H++)for(let ee=0;ee<v;ee++)d(b)[H]&&!d(b)[H][ee]&&M++;return M}let ae=Dt(Z),$=Dt(()=>d(U)<1);function B(){if(!n()||!i()||i().length===0)return null;const M=typeof n()=="string"?n():n().id;return i().find(H=>H.id===M)}let he=Dt(B);function le(){ie(p,[],!0),ie(b,[],!0),ie(E,[],!0),ie(S,null),ie(N,!1),ie(P,!1),ie(m,[],!0),ie(U,0),we();let M=[...new Set(y)];for(;M.length<h*v/2;)M=[...M,...M];let H=M.sort(()=>.5-Math.random()).slice(0,h*v/2),ee=[];H.forEach(je=>ee.push(je,je)),ee.sort(()=>Math.random()-.5);let Ie=0;for(let je=0;je<h;je++){let pe=[],Q=[],se=[];for(let g=0;g<v;g++)pe.push(ee[Ie++]),Q.push(!1),se.push(!1);d(p).push(pe),d(b).push(Q),d(E).push(se)}}async function Se(M,H){if(!(d(N)||d(b)[M][H]||d(P))){if(d(S)&&d(S).r===M&&d(S).c===H){d(E)[M][H]=!1,ie(S,null);return}if(!d(E)[M][H])if(d(m).length>0&&ie(m,[],!0),d(E)[M][H]=!0,!d(S))ie(S,{r:M,c:H},!0);else{ie(N,!0);const ee={r:M,c:H},Ie=d(p)[d(S).r][d(S).c],je=d(p)[ee.r][ee.c];Ie===je?setTimeout(()=>{d(b)[d(S).r][d(S).c]=!0,d(b)[ee.r][ee.c]=!0,d(E)[d(S).r][d(S).c]=!1,d(E)[ee.r][ee.c]=!1,ie(S,null),ie(N,!1),oe(),Ce()},600):setTimeout(()=>{d(E)[d(S).r][d(S).c]=!1,d(E)[ee.r][ee.c]=!1,ie(S,null),ie(N,!1)},1e3)}}}async function be(M,H,ee){(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),await Se(M,H))}function oe(){ie(U,G);const M=setInterval(()=>{ri(U,-1),d(U)<=0&&clearInterval(M)},1e3)}function Ce(){if(d(ae)===0){ie(P,!0),t()?e.onWin?e.onWin():u("win"):Ue("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:le}]);return}}function Ue(M,H,ee){t()||ie(D,{show:!0,title:M,text:H,actions:ee},!0)}function we(){d(D).show=!1}var $e=yp(),me=nt($e),Ye=w(me),Xe=w(Ye);Xe.__click=le;var We=A(Xe,2);{var He=M=>{var H=fp();H.__click=[dp,t,e,u,Ue,le],L(M,H)};_e(We,M=>{t()&&M(He)})}var Je=A(Ye,2),Me=w(Je);jr(Me,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),et(Me,21,()=>d(p),Nt,(M,H,ee)=>{var Ie=xt(),je=nt(Ie);et(je,17,()=>d(H),Nt,(pe,Q,se)=>{var g=hp();let o;g.__click=()=>Se(ee,se),g.__keydown=C=>be(ee,se,C);var f=w(g),I=w(f),j=w(I);de(C=>{o=It(g,1,"cell svelte-q16t3v",null,o,C),fe(j,d(Q))},[()=>({flipped:d(E)[ee][se],matched:d(b)[ee][se],selected:d(S)?.r===ee&&d(S)?.c===se,"hint-glow":d(m).some(C=>C.r===ee&&C.c===se)})]),L(pe,g)}),L(M,Ie)});var De=A(Je,2),xe=w(De);{var ke=M=>{var H=pp(),ee=w(H);{var Ie=se=>{var g=vp(),o=w(g);de(()=>{Ve(o,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(he).icon}`),Ve(o,"alt",d(he).name)}),L(se,g)};_e(ee,se=>{d(he).icon&&se(Ie)})}var je=A(ee,2),pe=A(w(je),2),Q=w(pe);de(()=>fe(Q,d(he).name)),L(M,H)};_e(xe,M=>{d(he)&&M(ke)})}var Ge=A(xe,2),Qe=A(w(Ge)),Fe=w(Qe),ue=A(Ge,2);let ce;ue.__click=[cp,N,P,$,h,v,b,E,p,m];var J=A(w(ue));{var R=M=>{var H=gp(),ee=w(H);de(()=>fe(ee,`(${d(U)??""})`)),L(M,H)};_e(J,M=>{d(U)>0&&M(R)})}var Y=A(me,2);{var z=M=>{var H=mp();let ee;var Ie=w(H),je=w(Ie),pe=w(je),Q=A(je,2),se=w(Q),g=A(Q,2);et(g,21,()=>d(D).actions,o=>o.text,(o,f)=>{var I=_p();let j;I.__click=function(...T){d(f).action?.apply(this,T)};var C=w(I);de(T=>{j=It(I,1,"btn svelte-q16t3v",null,j,T),fe(C,d(f).text)},[()=>({"btn-secondary":d(f).class==="btn-secondary"})]),L(o,I)}),de(o=>{ee=It(H,1,"svelte-q16t3v",null,ee,o),fe(pe,d(D).title),fe(se,d(D).text)},[()=>({active:d(D).show})]),L(M,H)};_e(Y,M=>{d(D).show&&M(z)})}de(M=>{fe(Fe,d(ae)),ce=It(ue,1,"btn btn-secondary svelte-q16t3v",null,ce,M),ue.disabled=!d($)},[()=>({disabled:!d($),"cooldown-active":d(U)>0})]),L(r,$e),$t()}Bt(["click","keydown"]);function wp(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Сдаемся?","Тьма оказалась сильнее...",[{text:"Заново",action:l}])}var kp=X('<button class="btn btn-danger svelte-12s778k">🏳️ Сдаться</button>'),Ip=X('<button><span class="icon svelte-12s778k">🕯️</span> <div></div></button>'),Sp=X('<div class="item-icon reward-glow svelte-12s778k"><img class="icon-preview svelte-12s778k" height="64px"/></div>'),Ep=X('<div id="reward-panel" class="svelte-12s778k"><!> <div class="reward-info svelte-12s778k"><div class="reward-label svelte-12s778k">Награда:</div> <div class="reward-name svelte-12s778k"> </div></div></div>'),xp=X('<button class="btn svelte-12s778k"> </button>'),Ap=X('<div id="modal-overlay"><div class="modal-content svelte-12s778k"><div class="modal-title svelte-12s778k"> </div> <div class="modal-text svelte-12s778k"> </div> <div class="modal-buttons svelte-12s778k"></div></div></div>'),Cp=X('<div class="body-wrapper svelte-12s778k"><div id="game-header" class="svelte-12s778k"><button class="btn btn-secondary svelte-12s778k">🔄 Заново</button> <!></div> <div id="game-container" class="svelte-12s778k"><div id="grid" class="svelte-12s778k"></div></div> <div id="game-footer" class="svelte-12s778k"><!> <div class="stats-panel svelte-12s778k"><span class="moves-counter svelte-12s778k">Ходов: <strong class="svelte-12s778k"> </strong></span> <span class="goal-text svelte-12s778k">Цель: Погасить все</span></div></div></div> <!>',1);function jp(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=5,v=5,y=15;let p=Ne(yt([])),b=Ne(0),E=Ne(!1),m=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{U()});let S=Dt(()=>d(p).flat().every(xe=>!xe));function N(){if(!n()||!i()||i().length===0)return null;const xe=typeof n()=="string"?n():n().id;return i().find(ke=>ke.id===xe)}let P=Dt(N);function U(){ie(p,Array(h).fill(null).map(()=>Array(v).fill(!1)),!0),ie(b,0),ie(E,!1),B();for(let xe=0;xe<y;xe++){const ke=Math.floor(Math.random()*h),Ge=Math.floor(Math.random()*v);G(ke,Ge,!0)}}function G(xe,ke,Ge=!1){d(p)[xe][ke]=!d(p)[xe][ke],xe>0&&(d(p)[xe-1][ke]=!d(p)[xe-1][ke]),xe<h-1&&(d(p)[xe+1][ke]=!d(p)[xe+1][ke]),ke>0&&(d(p)[xe][ke-1]=!d(p)[xe][ke-1]),ke<v-1&&(d(p)[xe][ke+1]=!d(p)[xe][ke+1]),Ge||(ri(b),ae())}function D(xe,ke){d(E)||G(xe,ke)}function Z(xe,ke,Ge){(Ge.key==="Enter"||Ge.key===" ")&&(Ge.preventDefault(),D(xe,ke))}function ae(){d(S)&&(ie(E,!0),t()?e.onWin?e.onWin():u("win"):$("🕯️ Тьма наступила",`Вы погасили все свечи за ${d(b)} ходов!`,[{text:"Играть снова",action:U}]))}function $(xe,ke,Ge){t()||ie(m,{show:!0,title:xe,text:ke,actions:Ge},!0)}function B(){d(m).show=!1}var he=Cp(),le=nt(he),Se=w(le),be=w(Se);be.__click=U;var oe=A(be,2);{var Ce=xe=>{var ke=kp();ke.__click=[wp,t,e,u,$,U],L(xe,ke)};_e(oe,xe=>{t()&&xe(Ce)})}var Ue=A(Se,2),we=w(Ue);jr(we,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),et(we,21,()=>d(p),Nt,(xe,ke,Ge)=>{var Qe=xt(),Fe=nt(Qe);et(Fe,17,()=>d(ke),Nt,(ue,ce,J)=>{var R=Ip();let Y;R.__click=()=>D(Ge,J),R.__keydown=H=>Z(Ge,J,H);var z=A(w(R),2);let M;de((H,ee)=>{Y=It(R,1,"cell svelte-12s778k",null,Y,H),R.disabled=d(E),Ve(R,"aria-label",d(ce)?"Lit candle":"Unlit candle"),M=It(z,1,"glow-overlay svelte-12s778k",null,M,ee)},[()=>({lit:d(ce)}),()=>({active:d(ce)})]),L(ue,R)}),L(xe,Qe)});var $e=A(Ue,2),me=w($e);{var Ye=xe=>{var ke=Ep(),Ge=w(ke);{var Qe=J=>{var R=Sp(),Y=w(R);de(()=>{Ve(Y,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(P).icon}`),Ve(Y,"alt",d(P).name)}),L(J,R)};_e(Ge,J=>{d(P).icon&&J(Qe)})}var Fe=A(Ge,2),ue=A(w(Fe),2),ce=w(ue);de(()=>fe(ce,d(P).name)),L(xe,ke)};_e(me,xe=>{d(P)&&xe(Ye)})}var Xe=A(me,2),We=w(Xe),He=A(w(We)),Je=w(He),Me=A(le,2);{var De=xe=>{var ke=Ap();let Ge;var Qe=w(ke),Fe=w(Qe),ue=w(Fe),ce=A(Fe,2),J=w(ce),R=A(ce,2);et(R,21,()=>d(m).actions,Y=>Y.text,(Y,z)=>{var M=xp();M.__click=function(...ee){d(z).action?.apply(this,ee)};var H=w(M);de(()=>fe(H,d(z).text)),L(Y,M)}),de(Y=>{Ge=It(ke,1,"svelte-12s778k",null,Ge,Y),fe(ue,d(m).title),fe(J,d(m).text)},[()=>({active:d(m).show})]),L(xe,ke)};_e(Me,xe=>{d(m).show&&xe(De)})}de(()=>fe(Je,d(b))),L(r,he),$t()}Bt(["click","keydown"]);function Tp(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Сдаемся?","Тьма отступает...",[{text:"Заново",action:l}])}var Pp=X('<button class="btn btn-danger svelte-icqjcb">🏳️</button>'),Rp=X("<div> </div>"),Op=X('<div class="item-icon reward-glow svelte-icqjcb"><img class="icon-preview svelte-icqjcb" height="64px"/></div>'),Mp=X('<div id="reward-panel" class="svelte-icqjcb"><!> <div class="reward-info svelte-icqjcb"><div class="reward-label svelte-icqjcb">Награда:</div> <div class="reward-name svelte-icqjcb"> </div></div></div>'),Lp=X("<button> </button>"),Dp=X('<button class="btn svelte-icqjcb"> </button>'),Fp=X('<div id="modal-overlay"><div class="modal-content svelte-icqjcb"><div class="modal-title svelte-icqjcb"> </div> <div class="modal-text svelte-icqjcb"> </div> <div class="modal-buttons svelte-icqjcb"></div></div></div>'),$p=X('<div class="body-wrapper svelte-icqjcb"><div id="game-header" class="svelte-icqjcb"><button class="btn btn-secondary svelte-icqjcb">🔄 Заново</button> <div class="current-plague svelte-icqjcb"><span class="svelte-icqjcb">Ваша сущность:</span> <span class="plague-icon svelte-icqjcb"> </span></div> <!></div> <div id="game-container" class="svelte-icqjcb"><div id="grid" class="svelte-icqjcb"></div></div> <div id="game-footer" class="svelte-icqjcb"><!> <div class="stats-bar svelte-icqjcb"><div class="moves-display svelte-icqjcb">Ходов: <span class="moves-count svelte-icqjcb"> </span> <span class="moves-limit svelte-icqjcb"></span></div> <div class="progress-bar-container svelte-icqjcb"><div class="progress-bar svelte-icqjcb"></div></div></div> <div id="palette" class="svelte-icqjcb"></div></div></div> <!>',1);function Np(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=10,v=10,y=22,p=["💀","🧟","🧛","🦇","🐺","🕸️"];let b=Ne(yt([])),E=Ne(0),m=Ne(!1),S=Ne(yt(p[0])),N=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{D()});let P=Dt(()=>d(b).flat().every(J=>J===d(b)[0]?.[0]));function U(){if(!n()||!i()||i().length===0)return null;const J=typeof n()=="string"?n():n().id;return i().find(R=>R.id===J)}let G=Dt(U);function D(){ie(b,[],!0),ie(E,0),ie(m,!1),B();for(let J=0;J<h;J++){let R=[];for(let Y=0;Y<v;Y++)R.push(Math.floor(Math.random()*p.length));d(b).push(R)}ie(S,p[d(b)[0][0]],!0)}function Z(J){if(d(m)||d(E)>=y)return;const R=d(b)[0][0],Y=J;if(R===Y)return;ri(E);let z=[[0,0]],M=new Set;for(d(b)[0][0]=Y,M.add("0,0");z.length>0;){let[H,ee]=z.pop();const Ie=[[H-1,ee],[H+1,ee],[H,ee-1],[H,ee+1]];for(let[je,pe]of Ie)if(je>=0&&je<h&&pe>=0&&pe<v){let Q=`${je},${pe}`;!M.has(Q)&&d(b)[je][pe]===R&&(d(b)[je][pe]=Y,M.add(Q),z.push([je,pe]))}}ie(S,p[Y],!0),ae()}function ae(){if(d(P)){ie(m,!0),t()?e.onWin?e.onWin():u("win"):$("🦇 Мор Победил!",`Вы поглотили мир за ${d(E)} ходов.`,[{text:"Играть снова",action:D}]);return}d(E)>=y&&(ie(m,!0),t()?e.onLose?e.onLose():u("lose"):$("☠️ Сопротивление сломлено","Ходы закончились. Свет не погас.",[{text:"Попробовать снова",action:D}]))}function $(J,R,Y){t()||ie(N,{show:!0,title:J,text:R,actions:Y},!0)}function B(){d(N).show=!1}var he=$p(),le=nt(he),Se=w(le),be=w(Se);be.__click=D;var oe=A(be,2),Ce=A(w(oe),2),Ue=w(Ce),we=A(oe,2);{var $e=J=>{var R=Pp();R.__click=[Tp,t,e,u,$,D],L(J,R)};_e(we,J=>{t()&&J($e)})}var me=A(Se,2),Ye=w(me);jr(Ye,"grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr);"),et(Ye,21,()=>d(b),Nt,(J,R,Y)=>{var z=xt(),M=nt(z);et(M,17,()=>d(R),Nt,(H,ee,Ie)=>{var je=Rp();It(je,1,"cell svelte-icqjcb",null,{},{"player-origin":Y===0&&Ie===0});var pe=w(je);de(()=>fe(pe,p[d(ee)])),L(H,je)}),L(J,z)});var Xe=A(me,2),We=w(Xe);{var He=J=>{var R=Mp(),Y=w(R);{var z=Ie=>{var je=Op(),pe=w(je);de(()=>{Ve(pe,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(G).icon}`),Ve(pe,"alt",d(G).name)}),L(Ie,je)};_e(Y,Ie=>{d(G).icon&&Ie(z)})}var M=A(Y,2),H=A(w(M),2),ee=w(H);de(()=>fe(ee,d(G).name)),L(J,R)};_e(We,J=>{d(G)&&J(He)})}var Je=A(We,2),Me=w(Je),De=A(w(Me)),xe=w(De),ke=A(De,2);ke.textContent="/ 22";var Ge=A(Me,2),Qe=w(Ge),Fe=A(Je,2);et(Fe,21,()=>p,Nt,(J,R,Y)=>{var z=Lp();let M;z.__click=()=>Z(Y);var H=w(z);de(ee=>{M=It(z,1,"palette-btn svelte-icqjcb",null,M,ee),z.disabled=d(m),fe(H,d(R))},[()=>({disabled:d(m),selected:p[d(b)[0]?.[0]]===d(R)})]),L(J,z)});var ue=A(le,2);{var ce=J=>{var R=Fp();let Y;var z=w(R),M=w(z),H=w(M),ee=A(M,2),Ie=w(ee),je=A(ee,2);et(je,21,()=>d(N).actions,pe=>pe.text,(pe,Q)=>{var se=Dp();se.__click=function(...o){d(Q).action?.apply(this,o)};var g=w(se);de(()=>fe(g,d(Q).text)),L(pe,se)}),de(pe=>{Y=It(R,1,"svelte-icqjcb",null,Y,pe),fe(H,d(N).title),fe(Ie,d(N).text)},[()=>({active:d(N).show})]),L(J,R)};_e(ue,J=>{d(N).show&&J(ce)})}de(()=>{fe(Ue,d(S)),fe(xe,d(E)),jr(Qe,`width: ${d(E)/y*100}%`)}),L(r,he),$t()}Bt(["click"]);function Up(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Сдаемся?","Зеркало осталось разбитым...",[{text:"Заново",action:l}])}var Bp=X('<button class="btn btn-danger svelte-1x29x0f">🏳️</button>'),Wp=X('<div class="tile empty svelte-1x29x0f"></div>'),qp=X('<div class="tile-bg-img svelte-1x29x0f"></div>'),Vp=X('<span class="tile-number svelte-1x29x0f"> </span>'),Hp=X("<button><!></button>"),Gp=X('<div class="item-icon reward-glow svelte-1x29x0f"><img class="icon-preview svelte-1x29x0f" height="64px"/></div>'),zp=X('<div id="reward-panel" class="svelte-1x29x0f"><!> <div class="reward-info svelte-1x29x0f"><div class="reward-label svelte-1x29x0f">Восстановить:</div> <div class="reward-name svelte-1x29x0f"> </div></div></div>'),Kp=X('<div class="hint-text svelte-1x29x0f">💡 Передайте <code class="svelte-1x29x0f">rewardItem</code>, чтобы собрать картинку</div>'),Yp=X('<button class="btn svelte-1x29x0f"> </button>'),Jp=X('<div id="modal-overlay"><div class="modal-content svelte-1x29x0f"><div class="modal-title svelte-1x29x0f"> </div> <div class="modal-text svelte-1x29x0f"> </div> <div class="modal-buttons svelte-1x29x0f"></div></div></div>'),Xp=X('<div class="body-wrapper svelte-1x29x0f"><div id="game-header" class="svelte-1x29x0f"><button class="btn btn-secondary svelte-1x29x0f"> </button> <div class="moves-counter svelte-1x29x0f">Ходов: <strong class="svelte-1x29x0f"> </strong></div> <!></div> <div id="game-container" class="svelte-1x29x0f"><div id="grid" class="svelte-1x29x0f"></div> <div class="mirror-frame svelte-1x29x0f"></div></div> <div id="game-footer" class="svelte-1x29x0f"><!></div></div> <!>',1);function Qp(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=4,v=4,y=100;let p=Ne(yt([])),b=Ne(0),E=Ne(!1),m=Ne(!1),S=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{ae()});let N=Dt(()=>d(p).join(",")===G().join(",")),P=Dt(()=>d(p).indexOf(0)),U=Dt(()=>({r:Math.floor(d(P)/v),c:d(P)%v}));function G(){return Array.from({length:h*v},(R,Y)=>(Y+1)%(h*v))}function D(){if(!n()||!i()||i().length===0)return null;const R=typeof n()=="string"?n():n().id;return i().find(Y=>Y.id===R)}let Z=Dt(D);function ae(){ie(p,G(),!0),ie(b,0),ie(E,!1),Ue(),ie(m,!0),setTimeout(()=>{le(),ie(m,!1)},500)}function $(R){const Y=Math.floor(R/v),z=R%v,M=d(U).r,H=d(U).c;return Math.abs(Y-M)+Math.abs(z-H)===1}function B(R){d(m)||d(E)||$(R)&&(he(R),ri(b),be())}function he(R){const Y=d(P),z=[...d(p)];z[Y]=d(p)[R],z[R]=0,ie(p,z,!0)}function le(){let R=-1;for(let Y=0;Y<y;Y++){const z=Se(),M=z.filter(ee=>ee!==R),H=M.length>0?M[Math.floor(Math.random()*M.length)]:z[Math.floor(Math.random()*z.length)];H!==void 0&&(R=d(P),he(H))}ie(b,0)}function Se(){const R=[],{r:Y,c:z}=d(U);return Y>0&&R.push((Y-1)*v+z),Y<h-1&&R.push((Y+1)*v+z),z>0&&R.push(Y*v+(z-1)),z<v-1&&R.push(Y*v+(z+1)),R}function be(){d(N)&&(ie(E,!0),t()?e.onWin?e.onWin():u("win"):Ce("🪞 Зеркало Восстановлено!",`Вы собрали осколки за ${d(b)} ходов.`,[{text:"Играть снова",action:ae}]))}function oe(R){if(!d(Z)||R===0)return"";const Y=R-1,z=Math.floor(Y/v),H=Y%v/(v-1)*100,ee=z/(h-1)*100;return`background-position: ${H}% ${ee}%;`}function Ce(R,Y,z){t()||ie(S,{show:!0,title:R,text:Y,actions:z},!0)}function Ue(){d(S).show=!1}var we=Xp(),$e=nt(we),me=w($e),Ye=w(me);Ye.__click=ae;var Xe=w(Ye),We=A(Ye,2),He=A(w(We)),Je=w(He),Me=A(We,2);{var De=R=>{var Y=Bp();Y.__click=[Up,t,e,u,Ce,ae],L(R,Y)};_e(Me,R=>{t()&&R(De)})}var xe=A(me,2),ke=w(xe);jr(ke,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),et(ke,21,()=>d(p),Nt,(R,Y,z)=>{var M=xt(),H=nt(M);{var ee=je=>{var pe=Wp();L(je,pe)},Ie=je=>{var pe=Hp();let Q;pe.__click=()=>B(z);var se=w(pe);{var g=f=>{var I=qp();de(j=>jr(I,`background-image: url(${`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(Z).icon}`}); ${j??""}`),[()=>oe(d(Y))]),L(f,I)},o=f=>{var I=Vp(),j=w(I);de(()=>fe(j,d(Y))),L(f,I)};_e(se,f=>{d(Z)?f(g):f(o,!1)})}de((f,I,j)=>{Q=It(pe,1,"tile svelte-1x29x0f",null,Q,f),jr(pe,I),pe.disabled=j},[()=>({movable:$(z)}),()=>oe(d(Y)),()=>d(m)||d(E)||!$(z)]),L(je,pe)};_e(H,je=>{d(Y)===0?je(ee):je(Ie,!1)})}L(R,M)});var Ge=A(xe,2),Qe=w(Ge);{var Fe=R=>{var Y=zp(),z=w(Y);{var M=je=>{var pe=Gp(),Q=w(pe);de(()=>{Ve(Q,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(Z).icon}`),Ve(Q,"alt",d(Z).name)}),L(je,pe)};_e(z,je=>{d(Z).icon&&je(M)})}var H=A(z,2),ee=A(w(H),2),Ie=w(ee);de(()=>fe(Ie,d(Z).name)),L(R,Y)},ue=R=>{var Y=Kp();L(R,Y)};_e(Qe,R=>{d(Z)?R(Fe):R(ue,!1)})}var ce=A($e,2);{var J=R=>{var Y=Jp();let z;var M=w(Y),H=w(M),ee=w(H),Ie=A(H,2),je=w(Ie),pe=A(Ie,2);et(pe,21,()=>d(S).actions,Q=>Q.text,(Q,se)=>{var g=Yp();g.__click=function(...f){d(se).action?.apply(this,f)};var o=w(g);de(()=>fe(o,d(se).text)),L(Q,g)}),de(Q=>{z=It(Y,1,"svelte-1x29x0f",null,z,Q),fe(ee,d(S).title),fe(je,d(S).text)},[()=>({active:d(S).show})]),L(R,Y)};_e(ce,R=>{d(S).show&&R(J)})}de(()=>{Ye.disabled=d(m),fe(Xe,`${d(m)?"⏳":"🔄"} Заново`),fe(Je,d(b))}),L(r,we),$t()}Bt(["click"]);function Zp(r,e,t,n,i,l){e()?t.onLose?t.onLose():n("lose"):i("Отступление","Магический круг разорван.",[{text:"ОК",action:l}])}var eg=X('<button class="btn btn-danger svelte-kypwpk">🏳️</button>'),tg=X('<span class="monster svelte-kypwpk"> </span>'),rg=X("<div><!></div>"),ng=X('<div id="reward-panel" class="svelte-kypwpk"><div class="item-icon reward-glow svelte-kypwpk"><img class="icon-preview svelte-kypwpk"/></div> <div class="reward-info svelte-kypwpk"><div class="reward-label svelte-kypwpk">Цель эволюции:</div> <div class="reward-name svelte-kypwpk"> </div></div></div>'),ig=X('<div class="evolution-hint svelte-kypwpk"> </div>'),sg=X('<button class="btn svelte-kypwpk"> </button>'),ag=X('<div id="modal-overlay"><div class="modal-content svelte-kypwpk"><div class="modal-title svelte-kypwpk"> </div> <div class="modal-text svelte-kypwpk"> </div> <div class="modal-buttons svelte-kypwpk"></div></div></div>'),og=X('<div class="body-wrapper svelte-kypwpk"><div id="game-header" class="svelte-kypwpk"><div class="score-panel svelte-kypwpk"><span class="svelte-kypwpk">Очки:</span> <strong class="svelte-kypwpk"> </strong></div> <button class="btn btn-secondary svelte-kypwpk">🔄 Заново</button> <!></div> <div id="game-container" class="svelte-kypwpk"><div id="grid" class="svelte-kypwpk"></div></div> <div id="game-footer" class="svelte-kypwpk"><!></div></div> <!>',1);function lg(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=4,v=["","🦴","💀","👻","🧟","🧛","👹","😈","🐉"],y=8;let p=Ne(yt([])),b=Ne(0),E=Ne(!1),m=Ne(!1),S=0,N=0,P=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>(D(),window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)));function U(){if(!n()||!i()||i().length===0)return null;const J=typeof n()=="string"?n():n().id;return i().find(R=>R.id===J)}let G=Dt(U);function D(){ie(p,Array(h).fill(null).map(()=>Array(h).fill(0)),!0),ie(b,0),ie(E,!1),ie(m,!1),Ue(),Z(),Z()}function Z(){let J=[];for(let z=0;z<h;z++)for(let M=0;M<h;M++)d(p)[z][M]===0&&J.push({r:z,c:M});if(J.length===0)return!1;const{r:R,c:Y}=J[Math.floor(Math.random()*J.length)];return d(p)[R][Y]=Math.random()<.9?1:2,!0}function ae(J){if(d(E))return;const R={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"};R[J.key]&&(J.preventDefault(),he(R[J.key]))}function $(J){S=J.touches[0].clientX,N=J.touches[0].clientY}function B(J){if(d(E))return;const R=J.changedTouches[0].clientX,Y=J.changedTouches[0].clientY,z=R-S,M=Y-N,H=Math.abs(z),ee=Math.abs(M);Math.max(H,ee)<30||(H>ee?he(z>0?"right":"left"):he(M>0?"down":"up"))}function he(J){const R=d(p).map(Y=>[...Y]);J==="left"?ie(p,d(p).map(Y=>Se(Y)),!0):J==="right"?ie(p,d(p).map(Y=>Se(Y.reverse()).reverse()),!0):J==="up"?(ie(p,le(d(p)),!0),ie(p,d(p).map(Y=>Se(Y)),!0),ie(p,le(d(p)),!0)):J==="down"&&(ie(p,le(d(p)),!0),ie(p,d(p).map(Y=>Se(Y.reverse()).reverse()),!0),ie(p,le(d(p)),!0)),JSON.stringify(R)!==JSON.stringify(d(p))&&(Z(),be())}function le(J){return J[0].map((R,Y)=>J.map(z=>z[Y]))}function Se(J){let R=J.filter(M=>M),Y=h-R.length,z=Array(Y).fill(0);for(let M=0;M<R.length-1;M++)R[M]===R[M+1]&&(R[M]++,ie(b,d(b)+Math.pow(2,R[M])),R.splice(M+1,1),R.push(0));return z.concat(R)}function be(){if(d(p).flat().includes(y)){ie(E,!0),ie(m,!0),t()?e.onWin?e.onWin():u("win"):Ce("🐉 Абсолютная Эволюция!",`Вы создали Повелителя Нежити! Счет: ${d(b)}`,[{text:"Играть снова",action:D}]);return}!d(p).flat().includes(0)&&!oe()&&(ie(E,!0),t()?e.onLose?e.onLose():u("lose"):Ce("💀 Ритуал провалился","Некромантия истощила силы. Ходов нет.",[{text:"Заново",action:D}]))}function oe(){for(let J=0;J<h;J++)for(let R=0;R<h;R++)if(d(p)[J][R]===0||R<h-1&&d(p)[J][R]===d(p)[J][R+1]||J<h-1&&d(p)[J][R]===d(p)[J+1][R])return!0;return!1}function Ce(J,R,Y){t()||ie(P,{show:!0,title:J,text:R,actions:Y},!0)}function Ue(){d(P).show=!1}var we=og();pu("keydown",bs,ae);var $e=nt(we),me=w($e),Ye=w(me),Xe=A(w(Ye),2),We=w(Xe),He=A(Ye,2);He.__click=D;var Je=A(He,2);{var Me=J=>{var R=eg();R.__click=[Zp,t,e,u,Ce,D],L(J,R)};_e(Je,J=>{t()&&J(Me)})}var De=A(me,2);De.__touchstart=$,De.__touchend=B;var xe=w(De);et(xe,21,()=>d(p),Nt,(J,R)=>{var Y=xt(),z=nt(Y);et(z,17,()=>d(R),Nt,(M,H)=>{var ee=rg();It(ee,1,"cell svelte-kypwpk",null,{},{"tile-{val}":tile-{}});var Ie=w(ee);{var je=pe=>{var Q=tg(),se=w(Q);de(()=>fe(se,v[d(H)])),L(pe,Q)};_e(Ie,pe=>{d(H)>0&&pe(je)})}L(M,ee)}),L(J,Y)});var ke=A(De,2),Ge=w(ke);{var Qe=J=>{var R=ng(),Y=w(R),z=w(Y),M=A(Y,2),H=A(w(M),2),ee=w(H);de(()=>{Ve(z,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(G).icon}`),Ve(z,"alt",d(G).name),fe(ee,d(G).name)}),L(J,R)},Fe=J=>{var R=ig(),Y=w(R);de(()=>fe(Y,`Цель: Соберите ${v[y]} (Ур. 8)`)),L(J,R)};_e(Ge,J=>{d(G)?J(Qe):J(Fe,!1)})}var ue=A($e,2);{var ce=J=>{var R=ag();let Y;var z=w(R),M=w(z),H=w(M),ee=A(M,2),Ie=w(ee),je=A(ee,2);et(je,21,()=>d(P).actions,pe=>pe.text,(pe,Q)=>{var se=sg();se.__click=function(...o){d(Q).action?.apply(this,o)};var g=w(se);de(()=>fe(g,d(Q).text)),L(pe,se)}),de(pe=>{Y=It(R,1,"svelte-kypwpk",null,Y,pe),fe(H,d(P).title),fe(Ie,d(P).text)},[()=>({active:d(P).show})]),L(J,R)};_e(ue,J=>{d(P).show&&J(ce)})}de(()=>fe(We,d(b))),L(r,we),$t()}Bt(["click","touchstart","touchend"]);var ug=(r,e,t)=>e.onLose?.()||t("lose"),cg=X('<button class="btn btn-danger svelte-14ugobk">🏳️</button>'),dg=X('<span class="monster svelte-14ugobk">🧛</span>'),fg=X("<span> </span>"),hg=X('<span class="flag svelte-14ugobk">🕯️</span>'),vg=X("<button><!></button>"),pg=X('<div class="item-icon reward-glow svelte-14ugobk"><img class="icon-preview svelte-14ugobk"/></div>'),gg=X('<div id="reward-panel" class="svelte-14ugobk"><!> <div class="reward-info svelte-14ugobk"><div class="reward-label svelte-14ugobk">Цель:</div> <div class="reward-name svelte-14ugobk"> </div></div></div>'),_g=X('<div class="hint svelte-14ugobk">ПКМ или Удержание: Поставить свечу 🕯️</div>'),mg=X('<button class="btn svelte-14ugobk"> </button>'),yg=X('<div id="modal-overlay"><div class="modal-content svelte-14ugobk"><div class="modal-title svelte-14ugobk"> </div> <div class="modal-text svelte-14ugobk"> </div> <div class="modal-buttons svelte-14ugobk"></div></div></div>'),bg=X('<div class="body-wrapper svelte-14ugobk"><div id="game-header" class="svelte-14ugobk"><button class="btn btn-secondary svelte-14ugobk">🔄 Заново</button> <div class="status-panel svelte-14ugobk"><span class="flag-counter"> </span></div> <!></div> <div id="game-container" class="svelte-14ugobk"><div id="grid" class="svelte-14ugobk"></div></div> <div id="game-footer" class="svelte-14ugobk"><!></div></div> <!>',1);function wg(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=8,v=8,y=10;let p=Ne(yt([])),b=Ne(!1),E=Ne(!1),m=Ne(y),S=Ne(!0),N=null,P=!1,U=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{Z()});function G(){if(!n()||!i()||i().length===0)return null;const z=typeof n()=="string"?n():n().id;return i().find(M=>M.id===z)}let D=Dt(G);function Z(){ie(b,!1),ie(E,!1),ie(S,!0),ie(m,y),me(),ie(p,[],!0);for(let z=0;z<h;z++){let M=[];for(let H=0;H<v;H++)M.push({isMine:!1,isRevealed:!1,isFlagged:!1,count:0,r:z,c:H});d(p).push(M)}}function ae(z,M){let H=0;for(;H<y;){const ee=Math.floor(Math.random()*h),Ie=Math.floor(Math.random()*v),je=Math.abs(ee-z)<=1&&Math.abs(Ie-M)<=1;!d(p)[ee][Ie].isMine&&!je&&(d(p)[ee][Ie].isMine=!0,H++)}for(let ee=0;ee<h;ee++)for(let Ie=0;Ie<v;Ie++)d(p)[ee][Ie].isMine||(d(p)[ee][Ie].count=$(ee,Ie))}function $(z,M){let H=0;for(let ee=-1;ee<=1;ee++)for(let Ie=-1;Ie<=1;Ie++){if(ee===0&&Ie===0)continue;const je=z+ee,pe=M+Ie;je>=0&&je<h&&pe>=0&&pe<v&&d(p)[je][pe].isMine&&H++}return H}function B(z,M,H=!1){if(d(b))return;const ee=d(p)[z][M];if(!ee.isRevealed){if(H){ee.isRevealed||(ee.isFlagged=!ee.isFlagged,ie(m,d(m)+(ee.isFlagged?-1:1)));return}ee.isFlagged||(d(S)&&(ae(z,M),ie(S,!1)),he(z,M),Se())}}function he(z,M){const H=d(p)[z][M];if(!(H.isRevealed||H.isFlagged)){if(H.isRevealed=!0,H.isMine){ie(b,!0),le(),t()?e.onLose?e.onLose():u("lose"):$e("🧛 Вампир проснулся!","Вы потревожили древнее зло.",[{text:"Попробовать снова",action:Z}]);return}if(H.count===0)for(let ee=-1;ee<=1;ee++)for(let Ie=-1;Ie<=1;Ie++){if(ee===0&&Ie===0)continue;const je=z+ee,pe=M+Ie;je>=0&&je<h&&pe>=0&&pe<v&&he(je,pe)}}}function le(){for(let z=0;z<h;z++)for(let M=0;M<v;M++)d(p)[z][M].isMine&&(d(p)[z][M].isRevealed=!0)}function Se(){if(d(b))return;let z=!0;for(let M=0;M<h;M++){for(let H=0;H<v;H++)if(!d(p)[M][H].isMine&&!d(p)[M][H].isRevealed){z=!1;break}if(!z)break}z&&(ie(b,!0),ie(E,!0),t()?e.onWin?e.onWin():u("win"):$e("🕯️ Склеп очищен","Все вампиры остались в своих могилах!",[{text:"Играть снова",action:Z}]))}function be(z){z.preventDefault()}function oe(z,M){if(P){P=!1;return}B(z,M,!1)}function Ce(z,M,H){z.preventDefault(),B(M,H,!0)}function Ue(z,M,H){P=!1,N=setTimeout(()=>{P=!0,B(M,H,!0)},500)}function we(){clearTimeout(N)}function $e(z,M,H){t()||ie(U,{show:!0,title:z,text:M,actions:H},!0)}function me(){d(U).show=!1}var Ye=bg();pu("contextmenu",bs,be);var Xe=nt(Ye),We=w(Xe),He=w(We);He.__click=Z;var Je=A(He,2),Me=w(Je),De=w(Me),xe=A(Je,2);{var ke=z=>{var M=cg();M.__click=[ug,e,u],L(z,M)};_e(xe,z=>{t()&&z(ke)})}var Ge=A(We,2),Qe=w(Ge);jr(Qe,"grid-template-columns: repeat(8, 1fr);"),et(Qe,21,()=>d(p),Nt,(z,M,H)=>{var ee=xt(),Ie=nt(ee);et(Ie,17,()=>d(M),Nt,(je,pe,Q)=>{var se=vg();let g;se.__click=()=>oe(H,Q),se.__contextmenu=j=>Ce(j,H,Q),se.__touchstart=j=>Ue(j,H,Q),se.__touchend=we;var o=w(se);{var f=j=>{var C=xt(),T=nt(C);{var W=te=>{var ye=dg();L(te,ye)},ne=te=>{var ye=xt(),Te=nt(ye);{var ze=Ke=>{var ht=fg(),Pt=w(ht);de(()=>{It(ht,1,`number count-${d(pe).count??""}`,"svelte-14ugobk"),fe(Pt,d(pe).count)}),L(Ke,ht)};_e(Te,Ke=>{d(pe).count>0&&Ke(ze)},!0)}L(te,ye)};_e(T,te=>{d(pe).isMine?te(W):te(ne,!1)})}L(j,C)},I=j=>{var C=xt(),T=nt(C);{var W=ne=>{var te=hg();L(ne,te)};_e(T,ne=>{d(pe).isFlagged&&ne(W)},!0)}L(j,C)};_e(o,j=>{d(pe).isRevealed?j(f):j(I,!1)})}de(j=>{g=It(se,1,"cell svelte-14ugobk",null,g,j),se.disabled=d(b)&&!d(E)},[()=>({revealed:d(pe).isRevealed,mine:d(pe).isRevealed&&d(pe).isMine,flagged:d(pe).isFlagged,exploded:d(pe).isRevealed&&d(pe).isMine&&d(b)&&!d(E)})]),L(je,se)}),L(z,ee)});var Fe=A(Ge,2),ue=w(Fe);{var ce=z=>{var M=gg(),H=w(M);{var ee=Q=>{var se=pg(),g=w(se);de(()=>{Ve(g,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(D).icon}`),Ve(g,"alt",d(D).name)}),L(Q,se)};_e(H,Q=>{d(D).icon&&Q(ee)})}var Ie=A(H,2),je=A(w(Ie),2),pe=w(je);de(()=>fe(pe,d(D).name)),L(z,M)},J=z=>{var M=_g();L(z,M)};_e(ue,z=>{d(D)?z(ce):z(J,!1)})}var R=A(Xe,2);{var Y=z=>{var M=yg();let H;var ee=w(M),Ie=w(ee),je=w(Ie),pe=A(Ie,2),Q=w(pe),se=A(pe,2);et(se,21,()=>d(U).actions,g=>g.text,(g,o)=>{var f=mg();f.__click=function(...j){d(o).action?.apply(this,j)};var I=w(f);de(()=>fe(I,d(o).text)),L(g,f)}),de(g=>{H=It(M,1,"svelte-14ugobk",null,H,g),fe(je,d(U).title),fe(Q,d(U).text)},[()=>({active:d(U).show})]),L(z,M)};_e(R,z=>{d(U).show&&z(Y)})}de(()=>fe(De,`🕯️ ${d(m)??""}`)),L(r,Ye),$t()}Bt(["click","contextmenu","touchstart","touchend"]);function kg(r,e,t,n,i,l){d(e)||(d(t).length>0?n():i()||l(!1))}var Ig=((r,e)=>e(!1)),Sg=X('<button class="btn btn-danger svelte-1sju5te">🏳️</button>'),Eg=(r,e,t)=>e(d(t)),xg=X('<div class="card-back svelte-1sju5te">🪦</div>'),Ag=X('<div class="card-front svelte-1sju5te"><span class="rank svelte-1sju5te"> </span> <span class="suit svelte-1sju5te"> </span></div>'),Cg=X("<button><!></button>"),jg=X('🎴 <span class="deck-count svelte-1sju5te"> </span>',1),Tg=X('<div class="card card-front active svelte-1sju5te"><span class="rank svelte-1sju5te"> </span> <span class="suit svelte-1sju5te"> </span></div>'),Pg=X('<div class="card empty svelte-1sju5te"></div>'),Rg=X('<div id="reward-panel" class="svelte-1sju5te"><div class="item-icon reward-glow svelte-1sju5te"><img class="icon-preview svelte-1sju5te"/></div> <div class="reward-info svelte-1sju5te"><div class="reward-label svelte-1sju5te">Награда:</div> <div class="reward-name svelte-1sju5te"> </div></div></div>'),Og=X('<div class="rules svelte-1sju5te">Соберите пирамиду, выбирая карты на 1 старше или младше.</div>'),Mg=X('<button class="btn svelte-1sju5te"> </button>'),Lg=X('<div id="modal-overlay"><div class="modal-content svelte-1sju5te"><div class="modal-title svelte-1sju5te"> </div> <div class="modal-text svelte-1sju5te"> </div> <div class="modal-buttons svelte-1sju5te"></div></div></div>'),Dg=X('<div class="body-wrapper svelte-1sju5te"><div id="game-header" class="svelte-1sju5te"><button class="btn btn-secondary svelte-1sju5te">🔄 Заново</button> <div class="score-panel svelte-1sju5te"><span>Очки: <strong> </strong></span></div> <!></div> <div id="game-container" class="svelte-1sju5te"><div id="pyramid-area" class="svelte-1sju5te"></div> <div id="bottom-bar" class="svelte-1sju5te"><div id="stock-pile" class="svelte-1sju5te"><button class="card card-back svelte-1sju5te"><!></button> <span class="label svelte-1sju5te">Колода</span></div> <div id="active-pile" class="svelte-1sju5te"><!> <span class="label svelte-1sju5te">Жернов</span></div></div></div> <div id="game-footer" class="svelte-1sju5te"><!></div></div> <!>',1);function Fg(r,e){Ft(e,!0);let t=pt(e,"integrated",3,!1),n=pt(e,"rewardItem",3,null),i=pt(e,"items",19,()=>[]),l=pt(e,"bucketName",3,"dracula");const u=nn(),h=["🔥","💧","🌪️","🌿"],v=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];let y=Ne(yt([])),p=Ne(yt([])),b=Ne(null),E=Ne(0),m=Ne(!1),S=Ne(yt({show:!1,title:"",text:"",actions:[]}));wr(()=>{G()});let N=Dt(()=>d(p).every(Q=>Q.removed));function P(){if(!n()||!i()||i().length===0)return null;const Q=typeof n()=="string"?n():n().id;return i().find(se=>se.id===Q)}let U=Dt(P);function G(){ie(y,[],!0),ie(p,[],!0),ie(b,null),ie(E,0),ie(m,!1),Ce();let Q=[];for(let o=0;o<h.length;o++)for(let f=0;f<v.length;f++)Q.push({id:`card-${o}-${f}-${Math.random()}`,suit:h[o],rank:f,rankStr:v[f],removed:!1,row:0,col:0});Q.sort(()=>Math.random()-.5);let se=[{r:0,c:0},{r:0,c:1},{r:0,c:2},{r:1,c:0},{r:1,c:1},{r:1,c:2},{r:1,c:3},{r:1,c:4},{r:1,c:5},{r:2,c:0},{r:2,c:1},{r:2,c:2},{r:2,c:3},{r:2,c:4},{r:2,c:5},{r:2,c:6},{r:2,c:7},{r:2,c:8},{r:3,c:0},{r:3,c:1},{r:3,c:2},{r:3,c:3},{r:3,c:4},{r:3,c:5},{r:3,c:6},{r:3,c:7},{r:3,c:8},{r:3,c:9}];const g=Q.splice(0,28);g.forEach((o,f)=>{o.row=se[f].r,o.col=se[f].c}),ie(p,g,!0),ie(y,Q,!0),D()}function D(){if(d(y).length===0){le(!0);return}ie(b,d(y).pop(),!0)}function Z(Q){if(Q.row===0)return!1;for(let se of d(p))if(!se.removed&&se.row===Q.row-1){if(Q.row===3){if(se.col===Q.col||se.col===Q.col-1)return!0}else if(Q.row===2){if(se.col===Q.col||se.col===Q.col-1)return!0}else if(Q.row===1&&(se.col===0&&Q.col<=1||se.col===1&&Q.col>=2&&Q.col<=3||se.col===2&&Q.col>=4))return!0}return!1}function ae(Q){d(m)||Q.removed||Z(Q)||$(Q,d(b))&&B(Q)}function $(Q,se){if(!se)return!1;let g=Math.abs(Q.rank-se.rank);return g===1||g===12}function B(Q){Q.removed=!0,ie(E,d(E)+10),ie(b,Q,!0),le()}function he(){for(let Q of d(p))if(!Q.removed&&!Z(Q)&&$(Q,d(b)))return!0;return!1}function le(Q=!1){if(d(N)){Se(!0);return}d(y).length===0&&!he()&&Se(!1)}function Se(Q){d(m)||(ie(m,!0),Q?t()?e.onWin?e.onWin():u("win"):oe("🏆 Башня Пала!",`Вы освободили все души! Счет: ${d(E)}`,[{text:"Играть снова",action:G}]):t()?e.onLose?e.onLose():u("lose"):oe("💀 Запечатано","Души остались в ловушке.",[{text:"Заново",action:G}]))}function be(Q){let o=0,f=Q.row*30;return Q.row===0?o=110+Q.col*34:Q.row===1?o=60+Q.col*34:Q.row===2?o=15+Q.col*34:Q.row===3&&(o=Q.col*34),`left: ${o}px; top: ${f}px;`}function oe(Q,se,g){t()||ie(S,{show:!0,title:Q,text:se,actions:g},!0)}function Ce(){d(S).show=!1}var Ue=Dg(),we=nt(Ue),$e=w(we),me=w($e);me.__click=G;var Ye=A(me,2),Xe=w(Ye),We=A(w(Xe)),He=w(We),Je=A(Ye,2);{var Me=Q=>{var se=Sg();se.__click=[Ig,Se],L(Q,se)};_e(Je,Q=>{t()&&Q(Me)})}var De=A($e,2),xe=w(De);et(xe,21,()=>d(p),Q=>Q.id,(Q,se)=>{var g=Cg();let o;g.__click=[Eg,ae,se];var f=w(g);{var I=j=>{var C=xt(),T=nt(C);{var W=te=>{var ye=xg();L(te,ye)},ne=te=>{var ye=Ag(),Te=w(ye),ze=w(Te),Ke=A(Te,2),ht=w(Ke);de(()=>{fe(ze,d(se).rankStr),fe(ht,d(se).suit)}),L(te,ye)};_e(T,te=>{Z(d(se))?te(W):te(ne,!1)})}L(j,C)};_e(f,j=>{d(se).removed||j(I)})}de((j,C,T)=>{o=It(g,1,"card pyramid-card svelte-1sju5te",null,o,j),jr(g,C),g.disabled=T},[()=>({removed:d(se).removed,covered:Z(d(se)),playable:!Z(d(se))&&!d(se).removed&&d(b)&&$(d(se),d(b))}),()=>be(d(se)),()=>d(se).removed||Z(d(se))]),L(Q,g)});var ke=A(xe,2),Ge=w(ke),Qe=w(Ge);Qe.__click=[kg,m,y,D,he,Se];var Fe=w(Qe);{var ue=Q=>{var se=jg(),g=A(nt(se)),o=w(g);de(()=>fe(o,d(y).length)),L(Q,se)},ce=Q=>{var se=Si("🚫");L(Q,se)};_e(Fe,Q=>{d(y).length>0?Q(ue):Q(ce,!1)})}var J=A(Ge,2),R=w(J);{var Y=Q=>{var se=Tg(),g=w(se),o=w(g),f=A(g,2),I=w(f);de(()=>{fe(o,d(b).rankStr),fe(I,d(b).suit)}),L(Q,se)},z=Q=>{var se=Pg();L(Q,se)};_e(R,Q=>{d(b)?Q(Y):Q(z,!1)})}var M=A(De,2),H=w(M);{var ee=Q=>{var se=Rg(),g=w(se),o=w(g),f=A(g,2),I=A(w(f),2),j=w(I);de(()=>{Ve(o,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${d(U).icon}`),Ve(o,"alt",d(U).name),fe(j,d(U).name)}),L(Q,se)},Ie=Q=>{var se=Og();L(Q,se)};_e(H,Q=>{d(U)?Q(ee):Q(Ie,!1)})}var je=A(we,2);{var pe=Q=>{var se=Lg();let g;var o=w(se),f=w(o),I=w(f),j=A(f,2),C=w(j),T=A(j,2);et(T,21,()=>d(S).actions,W=>W.text,(W,ne)=>{var te=Mg();te.__click=function(...Te){d(ne).action?.apply(this,Te)};var ye=w(te);de(()=>fe(ye,d(ne).text)),L(W,te)}),de(W=>{g=It(se,1,"svelte-1sju5te",null,g,W),fe(I,d(S).title),fe(C,d(S).text)},[()=>({active:d(S).show})]),L(Q,se)};_e(je,Q=>{d(S).show&&Q(pe)})}de(()=>{fe(He,d(E)),Qe.disabled=d(y).length===0}),L(r,Ue),$t()}Bt(["click"]);var $g=X('<div class="loading svelte-15dde84">Загрузка игры...</div>'),Ng=X('<div class="minigame-container svelte-15dde84"><!></div>');function Ug(r,e){Ft(e,!0);function t(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function n(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var i=Ng(),l=w(i);{var u=v=>{up(v,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},h=v=>{var y=xt(),p=nt(y);{var b=m=>{bp(m,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},E=m=>{var S=xt(),N=nt(S);{var P=G=>{jp(G,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},U=G=>{var D=xt(),Z=nt(D);{var ae=B=>{Np(B,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},$=B=>{var he=xt(),le=nt(he);{var Se=oe=>{Qp(oe,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},be=oe=>{var Ce=xt(),Ue=nt(Ce);{var we=me=>{lg(me,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},$e=me=>{var Ye=xt(),Xe=nt(Ye);{var We=Je=>{wg(Je,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},He=Je=>{var Me=xt(),De=nt(Me);{var xe=Ge=>{Fg(Ge,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return e.bucketName}})},ke=Ge=>{var Qe=$g();L(Ge,Qe)};_e(De,Ge=>{e.gameId==="tower_of_souls"?Ge(xe):Ge(ke,!1)},!0)}L(Je,Me)};_e(Xe,Je=>{e.gameId==="cursed_crypts"?Je(We):Je(He,!1)},!0)}L(me,Ye)};_e(Ue,me=>{e.gameId==="evolution2048"?me(we):me($e,!1)},!0)}L(oe,Ce)};_e(le,oe=>{e.gameId==="broken_mirror"?oe(Se):oe(be,!1)},!0)}L(B,he)};_e(Z,B=>{e.gameId==="flood_it"?B(ae):B($,!1)},!0)}L(G,D)};_e(N,G=>{e.gameId==="light_out"?G(P):G(U,!1)},!0)}L(m,S)};_e(p,m=>{e.gameId==="memo_monsters"?m(b):m(E,!1)},!0)}L(v,y)};_e(l,v=>{e.gameId==="onet_monsters"?v(u):v(h,!1)})}L(r,i),$t()}function Bg(r,e){d(e)?.nextDialogueId&&Tt.goToDialogue(d(e).nextDialogueId)}var Wg=X('<img alt="BG" class="background-image svelte-fl90wm"/>'),qg=X('<div class="background-media svelte-fl90wm"><!></div>'),Vg=X('<img alt="Char" class="character-image svelte-fl90wm"/>'),Hg=X('<div class="character-media svelte-fl90wm"><!></div>'),Gg=(r,e,t)=>e(d(t)),zg=X("<button> </button>"),Kg=X('<div class="options-container svelte-fl90wm"></div>'),Yg=X('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),Jg=X('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),Xg=X("<p> </p>");function $u(r,e){Ft(e,!0);let t=pt(e,"bucketName",3,Fu);console.log(t());const n=Dt(()=>e.dialogue||Tt.findDialogue(Tt.currentDialogueId));let i=Ne(null);ii(()=>{d(n)?.onEnter&&Tt.runActions(d(n).onEnter)});function l(S){if(S.actions&&Tt.runActions(S.actions),S.miniGame){console.log("Запуск мини-игры:",S.miniGame.id),ie(i,{gameId:S.miniGame.id,onWinDialogueId:S.miniGame.onWinDialogueId,onLoseDialogueId:S.miniGame.onLoseDialogueId,rewardItem:S.miniGame.rewardItem},!0);return}S.nextDialogueId&&Tt.goToDialogue(S.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),d(i)?.rewardItem&&Tt.addItem(d(i).rewardItem),d(i)?.onWinDialogueId&&Tt.goToDialogue(d(i).onWinDialogueId),ie(i,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),d(i)?.onLoseDialogueId&&Tt.goToDialogue(d(i).onLoseDialogueId),ie(i,null)}function v(S){return S.visible===!1?!1:Tt.checkVisibilityCondition(S)}function y(S){return S.enabled!==!1}var p=xt(),b=nt(p);{var E=S=>{var N=Jg(),P=w(N);{var U=oe=>{{let Ce=Dt(()=>Tt.storyData?.items);Ug(oe,{get gameId(){return d(i).gameId},onWin:u,onLose:h,get rewardItem(){return d(i).rewardItem},get items(){return d(Ce)},get bucketName(){return t()}})}};_e(P,oe=>{d(i)&&oe(U)})}var G=A(P,2);{var D=oe=>{var Ce=qg(),Ue=w(Ce);{var we=me=>{var Ye=xt(),Xe=nt(Ye);ma(Xe,()=>d(n).backgroundImage,We=>{Pl(We,{get fileName(){return d(n).backgroundImage},get bucketName(){return t()}})}),L(me,Ye)},$e=me=>{var Ye=Wg();de(()=>Ve(Ye,"src",`${Ss}/storage/v1/object/public/${t()}/${d(n).backgroundImage}`)),L(me,Ye)};_e(Ue,me=>{d(n).backgroundImage.endsWith(".riv")?me(we):me($e,!1)})}L(oe,Ce)};_e(G,oe=>{d(n).backgroundImage&&oe(D)})}var Z=A(G,2);{var ae=oe=>{var Ce=Hg(),Ue=w(Ce);{var we=me=>{var Ye=xt(),Xe=nt(Ye);ma(Xe,()=>d(n).characterImage,We=>{Pl(We,{get fileName(){return d(n).characterImage},get bucketName(){return t()}})}),L(me,Ye)},$e=me=>{var Ye=Vg();de(()=>Ve(Ye,"src",`${Ss}/storage/v1/object/public/${t()}/${d(n).characterImage}`)),L(me,Ye)};_e(Ue,me=>{d(n).characterImage.endsWith(".riv")?me(we):me($e,!1)})}L(oe,Ce)};_e(Z,oe=>{d(n).characterImage&&oe(ae)})}var $=A(Z,2),B=w($),he=w(B),le=A(B,2);{var Se=oe=>{var Ce=Kg();et(Ce,21,()=>d(n).options,Ue=>Ue.text,(Ue,we)=>{var $e=xt(),me=nt($e);{var Ye=Xe=>{var We=zg();let He;We.__click=[Gg,l,we];var Je=w(We);de((Me,De)=>{He=It(We,1,"option-button svelte-fl90wm",null,He,Me),We.disabled=De,fe(Je,d(we).text)},[()=>({disabled:!y(d(we))}),()=>!y(d(we))]),L(Xe,We)};_e(me,Xe=>{v(d(we))&&Xe(Ye)})}L(Ue,$e)}),L(oe,Ce)},be=oe=>{var Ce=xt(),Ue=nt(Ce);{var we=$e=>{var me=Yg(),Ye=w(me);Ye.__click=[Bg,n],L($e,me)};_e(Ue,$e=>{d(n).nextDialogueId&&$e(we)},!0)}L(oe,Ce)};_e(le,oe=>{d(n).options&&d(n).options.length>0?oe(Se):oe(be,!1)})}de(()=>fe(he,d(n).text)),L(S,N)},m=S=>{var N=Xg(),P=w(N);de(()=>fe(P,`Диалог не найден (ID: ${Tt.currentDialogueId??""})`)),L(S,N)};_e(b,S=>{d(n)?S(E):S(m,!1)})}L(r,p),$t()}Bt(["click"]);var ua=rn(()=>V),Qg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Zg=X('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),e_=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),t_=X('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),r_=X('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),n_=X('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),i_=X('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function s_(r,e){Ft(e,!1);function t(){ua(ua().editingOptionIndex=null)}tn();var n=i_(),i=w(n),l=A(w(i),2);l.__click=t;var u=A(i,2),h=w(u);{var v=p=>{var b=r_(),E=w(b);{let oe=ci(()=>ua().selectedBucket||void 0);$u(E,{get dialogue(){return Jt.currentDialogue},index:0,get bucketName(){return d(oe)}})}var m=A(E,2),S=w(m),N=A(w(S),2),P=w(N),U=A(S,2),G=A(w(U),2),D=w(G),Z=A(U,2);{var ae=oe=>{var Ce=Qg(),Ue=A(w(Ce),2),we=w(Ue);de(()=>fe(we,Jt.currentDialogue.backgroundImage)),L(oe,Ce)};_e(Z,oe=>{Jt.currentDialogue.backgroundImage&&oe(ae)})}var $=A(Z,2);{var B=oe=>{var Ce=Zg(),Ue=A(w(Ce),2),we=w(Ue);de(()=>fe(we,Jt.currentDialogue.characterImage)),L(oe,Ce)};_e($,oe=>{Jt.currentDialogue.characterImage&&oe(B)})}var he=A(m,2);{var le=oe=>{var Ce=e_();L(oe,Ce)};_e(he,oe=>{(!Jt.currentDialogue.options||Jt.currentDialogue.options.length===0)&&oe(le)})}var Se=A(he,2);{var be=oe=>{var Ce=t_();L(oe,Ce)};_e(Se,oe=>{Jt.currentDialogue.options?.some(Ce=>!Ce.nextDialogueId)&&oe(be)})}de(()=>{fe(P,Jt.currentDialogue.id),fe(D,Jt.currentChapter?.title||"Без главы")}),L(p,b)},y=p=>{var b=n_();L(p,b)};_e(h,p=>{Jt.currentDialogue?p(v):p(y,!1)})}L(r,n),$t()}Bt(["click"]);const a_=["dracula","zombie","fairy_tale","minigames"];function Nu(){const r=a_.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return Et.updateBucketsList(r),r}var vn=rn(()=>V),o_=X('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),l_=(r,e,t)=>e(d(t).name),u_=X('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),c_=X('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),d_=X('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function f_(r,e){Ft(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};wr(()=>{n()});function n(){Nu()}async function i(h){vn(vn().selectedBucket=h),vn(vn().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Zr.loadStoriesList(),await Zr.loadStoredResources()}tn();var l=d_(),u=A(w(l),2);et(u,5,()=>vn().availableBuckets,h=>h,(h,v)=>{const y=ci(()=>t[d(v).id]||{title:d(v),description:"Интерактивная история",icon:"📖"});var p=c_();let b;var E=w(p),m=w(E),S=w(m),N=A(m,2),P=w(N),U=w(P),G=A(P,2),D=w(G),Z=A(E,2),ae=w(Z);{var $=he=>{var le=o_();L(he,le)},B=he=>{var le=u_();le.__click=[l_,i,v],L(he,le)};_e(ae,he=>{vn().selectedBucket===d(v).name?he($):he(B,!1)})}de(he=>{b=It(p,1,"bucket-card svelte-1cmn6ru",null,b,he),fe(S,d(y).icon),fe(U,d(y).title),fe(D,d(y).description)},[()=>({selected:vn().selectedBucket===d(v).name})]),L(h,p)}),L(r,l),$t()}Bt(["click"]);var h_=X("<span> </span>"),v_=X('<div class="debug-info svelte-1k4krym"><small> </small></div>'),p_=X('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),g_=X('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),__=X('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function m_(r,e){Ft(e,!0),wr(async()=>{Nu(),V.availableBuckets.length>0&&!V.selectedBucket&&(V.selectedBucket=V.availableBuckets[0].name)}),ii(async()=>{if(V.selectedBucket){console.log(`[Editor] Bucket выбран: ${V.selectedBucket}`),await Zr.loadStoredResources();const u=`${V.selectedBucket}_story.json`;V.currentFileName=u,await yn.loadStory(u)}});var t=xt(),n=nt(t);{var i=u=>{f_(u,{})},l=u=>{var h=__(),v=w(h),y=w(v),p=w(y);p.__click=()=>V.selectedBucket=null;var b=A(p,2),E=w(b),m=A(y,2),S=w(m),N=w(S),P=A(S,2);{var U=we=>{var $e=h_(),me=w($e);de(()=>{It($e,1,`status-message ${V.statusMessage.type??""}`,"svelte-1k4krym"),fe(me,V.statusMessage.text)}),L(we,$e)};_e(P,we=>{V.statusMessage.text&&we(U)})}var G=A(P,2);G.__click=function(...we){yn.saveCurrentStory?.apply(this,we)};var D=A(G,2);D.__click=function(...we){yn.saveStoryCopy?.apply(this,we)};var Z=A(v,2),ae=w(Z);rv(ae,{});var $=A(ae,2),B=w($);{var he=we=>{var $e=v_(),me=w($e),Ye=w(me);de(()=>fe(Ye,`Загружено: ${V.data.meta?.title??""} |
              Глав: ${(V.data.chapters?.length||0)??""} |
              Диалогов: ${(V.data.dialogues?.length||0)??""} |
              Предметов: ${(V.data.items?.length||0)??""}`)),L(we,$e)},le=we=>{var $e=p_();L(we,$e)};_e(B,we=>{V.data?we(he):we(le,!1)})}var Se=A(B,2);zv(Se,{});var be=A(Se,2);{var oe=we=>{Lv(we,{get editor(){return V},get storyActions(){return yn},get resourceActions(){return Zr}})},Ce=we=>{var $e=g_();L(we,$e)};_e(be,we=>{Jt.currentDialogue?we(oe):we(Ce,!1)})}var Ue=A($,2);s_(Ue,{}),de(()=>{fe(E,`Story Editor v3.1 - ${V.selectedBucket??""}`),fe(N,V.currentFileName||"Нет файла")}),L(u,h)};_e(n,u=>{V.selectedBucket?u(l,!1):u(i)})}L(r,t),$t()}Bt(["click"]);var ca=rn(()=>Tt),y_=(r,e,t)=>e(d(t)),b_=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(d(t)))},w_=X('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),k_=X('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function I_(r,e){Ft(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function n(u){ca(ca().selectedStory=u)}tn();var i=k_(),l=A(w(i),2);et(l,5,()=>ca().availableStories,u=>u,(u,h)=>{const v=ci(()=>t[d(h)]||{title:d(h),description:"Интерактивная история",icon:"📖"});var y=w_();y.__click=[y_,n,h],y.__keydown=[b_,n,h];var p=w(y),b=w(p),E=A(p,2),m=w(E),S=w(m),N=A(m,2),P=w(N);de(()=>{fe(b,d(v).icon),fe(S,d(v).title),fe(P,d(v).description)}),L(u,y)}),L(r,i),$t()}Bt(["click","keydown"]);function da(r,e){ie(e,!d(e))}var S_=X('<span class="inventory-badge svelte-1nth01l"> </span>'),E_=(r=>r.stopPropagation()),x_=(r,e,t)=>e(d(t)),A_=X('<div class="item-card svelte-1nth01l"><div class="item-icon svelte-1nth01l"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-1nth01l"><span class="item-name svelte-1nth01l"> </span> <span class="item-type svelte-1nth01l"> </span></div></div>'),C_=X('<div class="items-grid svelte-1nth01l"></div>'),j_=X('<div class="empty-inventory svelte-1nth01l"><span class="empty-icon svelte-1nth01l">🎒</span> <p class="svelte-1nth01l">Инвентарь пуст</p> <p class="empty-hint svelte-1nth01l">Получайте предметы в ходе игры</p></div>'),T_=X('<div class="inventory-overlay svelte-1nth01l"><div class="inventory-modal svelte-1nth01l"><div class="inventory-header svelte-1nth01l"><h2 class="svelte-1nth01l">Инвентарь</h2> <button class="close-button svelte-1nth01l">✕</button></div> <div class="stats-section svelte-1nth01l"><h3 class="svelte-1nth01l">Характеристики</h3> <div class="stats-grid svelte-1nth01l"><div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">📚</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Знания</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">💪</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Смелость</span> <span class="stat-value svelte-1nth01l"> </span></div></div> <div class="stat-item svelte-1nth01l"><span class="stat-icon svelte-1nth01l">✨</span> <div class="stat-info svelte-1nth01l"><span class="stat-name svelte-1nth01l">Харизма</span> <span class="stat-value svelte-1nth01l"> </span></div></div></div></div> <div class="items-section svelte-1nth01l"><h3 class="svelte-1nth01l"> </h3> <!></div></div></div>'),P_=X('<div class="inventory-wrapper svelte-1nth01l"><button class="inventory-button svelte-1nth01l">🎒 <!></button> <!></div>');function R_(r,e){Ft(e,!0);let t=Ne(!1);const n=Dt(()=>Tt.getInventoryItems()),i=Dt(()=>Tt.player.stats);function l(E){console.log("Выбран предмет:",E.name)}var u=P_(),h=w(u);h.__click=[da,t];var v=A(w(h));{var y=E=>{var m=S_(),S=w(m);de(()=>fe(S,d(n).length)),L(E,m)};_e(v,E=>{d(n).length>0&&E(y)})}var p=A(h,2);{var b=E=>{var m=T_();m.__click=[da,t];var S=w(m);S.__click=[E_];var N=w(S),P=A(w(N),2);P.__click=[da,t];var U=A(N,2),G=A(w(U),2),D=w(G),Z=A(w(D),2),ae=A(w(Z),2),$=w(ae),B=A(D,2),he=A(w(B),2),le=A(w(he),2),Se=w(le),be=A(B,2),oe=A(w(be),2),Ce=A(w(oe),2),Ue=w(Ce),we=A(U,2),$e=w(we),me=w($e),Ye=A($e,2);{var Xe=He=>{var Je=C_();et(Je,21,()=>d(n),Me=>Me.id,(Me,De)=>{var xe=A_();xe.__click=[x_,l,De];var ke=w(xe),Ge=w(ke),Qe=A(ke,2),Fe=w(Qe),ue=w(Fe),ce=A(Fe,2),J=w(ce);de(()=>{Ve(Ge,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Tt.selectedStory}/${d(De).icon}`),Ve(Ge,"alt",d(De).icon),fe(ue,d(De).name),fe(J,d(De).type)}),L(Me,xe)}),L(He,Je)},We=He=>{var Je=j_();L(He,Je)};_e(Ye,He=>{d(n).length>0?He(Xe):He(We,!1)})}de(()=>{fe($,d(i).knowledge),fe(Se,d(i).courage),fe(Ue,d(i).charisma),fe(me,`Предметы (${d(n).length??""})`)}),L(E,m)};_e(p,E=>{d(t)&&E(b)})}de(()=>Ve(h,"title",`Инвентарь (${d(n).length??""})`)),L(r,u),$t()}Bt(["click"]);var O_=X('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),M_=X('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),L_=X('<div class="game-container svelte-14svm27"><!> <button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),D_=X('<div class="app svelte-14svm27"><!></div>');function F_(r,e){Ft(e,!0),ii(async()=>{if(Tt.selectedStory){const u=`${Tt.selectedStory}_story.json`,h=`${Ss}/storage/v1/object/public/${Tt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await Tt.loadStory(h)}});var t=D_(),n=w(t);{var i=u=>{I_(u,{})},l=u=>{var h=xt(),v=nt(h);{var y=b=>{var E=O_();L(b,E)},p=b=>{var E=xt(),m=nt(E);{var S=P=>{var U=M_(),G=w(U),D=A(G);D.__click=()=>Tt.selectedStory=null,de(()=>fe(G,`⚠️ ${Tt.error??""} `)),L(P,U)},N=P=>{var U=L_(),G=w(U);R_(G,{});var D=A(G,2);D.__click=()=>Tt.selectedStory=null;var Z=A(D,2),ae=w(Z);{var $=B=>{{let he=Dt(()=>Tt.selectedStory||void 0);$u(B,{get bucketName(){return d(he)}})}};_e(ae,B=>{Tt.storyData&&B($)})}L(P,U)};_e(m,P=>{Tt.error?P(S):P(N,!1)},!0)}L(b,E)};_e(v,b=>{Tt.isLoading?b(y):b(p,!1)},!0)}L(u,h)};_e(n,u=>{Tt.selectedStory?u(l,!1):u(i)})}L(r,t),$t()}Bt(["click"]);var $_=X('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),N_=X('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function U_(r,e){Ft(e,!1),tn();var t=xt(),n=nt(t);{var i=u=>{var h=$_(),v=nt(h);v.__click=function(...p){Et.toggleEditor?.apply(this,p)};var y=A(v,2);m_(y,{}),L(u,h)},l=u=>{var h=N_(),v=nt(h);v.__click=function(...p){Et.toggleEditor?.apply(this,p)};var y=A(v,2);F_(y,{}),L(u,h)};_e(n,u=>{V.showEditor?u(i):u(l,!1)})}L(r,t),$t()}Bt(["click"]);Id(U_,{target:document.getElementById("app")});
