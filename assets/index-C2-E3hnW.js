(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const Tl=!1;var Ci=Array.isArray,uc=Array.prototype.indexOf,Sa=Array.from,sa=Object.defineProperty,Hn=Object.getOwnPropertyDescriptor,xl=Object.getOwnPropertyDescriptors,cc=Object.prototype,dc=Array.prototype,Aa=Object.getPrototypeOf,Uo=Object.isExtensible;function hc(r){return r()}function hs(r){for(var e=0;e<r.length;e++)r[e]()}function fc(){var r,e,t=new Promise((n,s)=>{r=n,e=s});return{promise:t,resolve:r,reject:e}}const ir=2,Ca=4,ws=8,ri=16,Br=32,wn=64,Pl=128,lr=256,fs=512,zt=1024,ur=2048,Qr=4096,mr=8192,bn=16384,Ta=32768,xa=65536,No=1<<17,vc=1<<18,Ti=1<<19,jl=1<<20,aa=1<<21,Pa=1<<22,_n=1<<23,Fr=Symbol("$state"),pc=Symbol("legacy props"),gc=Symbol(""),ja=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function _c(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Rl(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function mc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function yc(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function wc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function bc(r){throw new Error("https://svelte.dev/e/effect_orphan")}function kc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ec(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ic(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Sc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ac(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const bs=1,ks=2,Ol=4,Cc=8,Tc=16,xc=1,Pc=2,jc=4,Rc=8,Oc=16,Mc=1,Lc=2,Ut=Symbol(),Dc="http://www.w3.org/1999/xhtml";function $c(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Fc=!1;function Ml(r){return r===this.v}function Ll(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Uc(r,e){return r!==e}function Dl(r){return!Ll(r,this.v)}let ni=!1,Nc=!1;function Bc(){ni=!0}let Rt=null;function vs(r){Rt=r}function Wt(r,e=!1,t){Rt={p:Rt,c:null,e:null,s:r,x:null,l:ni&&!e?{s:null,u:null,$:[]}:null}}function Vt(r){var e=Rt,t=e.e;if(t!==null){e.e=null;for(var n of t)Jl(n)}return Rt=e.p,{}}function ii(){return!ni||Rt!==null&&Rt.l===null}const Wc=new WeakMap;function Vc(r){var e=ot;if(e===null)return dt.f|=_n,r;if((e.f&Ta)===0){if((e.f&Pl)===0)throw!e.parent&&r instanceof Error&&$l(r),r;e.b.error(r)}else Ra(r,e)}function Ra(r,e){for(;e!==null;){if((e.f&Pl)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&$l(r),r}function $l(r){const e=Wc.get(r);e&&(sa(r,"message",{value:e.message}),sa(r,"stack",{value:e.stack}))}let Ei=[],oa=[];function Fl(){var r=Ei;Ei=[],hs(r)}function qc(){var r=oa;oa=[],hs(r)}function Ul(r){Ei.length===0&&queueMicrotask(Fl),Ei.push(r)}function Hc(){Ei.length>0&&Fl(),oa.length>0&&qc()}function zc(){for(var r=ot.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&_c(),r}function xi(r){var e=ir|ur,t=dt!==null&&(dt.f&ir)!==0?dt:null;return ot===null||t!==null&&(t.f&lr)!==0?e|=lr:ot.f|=Ti,{ctx:Rt,deps:null,effects:null,equals:Ml,f:e,fn:r,reactions:null,rv:0,v:Ut,wv:0,parent:t??ot,ac:null}}function Gc(r,e){let t=ot;t===null&&mc();var n=t.b,s=void 0,l=Jn(Ut),u=null,h=!dt;return ld(()=>{try{var f=r();u&&Promise.resolve(f).catch(()=>{})}catch(p){f=Promise.reject(p)}var m=()=>f;s=u?.then(m,m)??Promise.resolve(f),u=s;var _=At,b=n.pending;h&&(n.update_pending_count(1),b||_.increment());const S=(p,I=void 0)=>{u=null,b||_.activate(),I?I!==ja&&(l.f|=_n,Xn(l,I)):((l.f&_n)!==0&&(l.f^=_n),Xn(l,p)),h&&(n.update_pending_count(-1),b||_.decrement()),Wl()};if(s.then(S,p=>S(null,p||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(f=>{function m(_){function b(){_===s?f(l):m(s)}_.then(b,b)}m(s)})}function Cr(r){const e=xi(r);return nu(e),e}function si(r){const e=xi(r);return e.equals=Dl,e}function Nl(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Nr(e[t])}}function Kc(r){for(var e=r.parent;e!==null;){if((e.f&ir)===0)return e;e=e.parent}return null}function Oa(r){var e,t=ot;Jr(Kc(r));try{Nl(r),e=ou(r)}finally{Jr(t)}return e}function Bl(r){var e=Oa(r);if(r.equals(e)||(r.v=e,r.wv=su()),!En){var t=(Kr||(r.f&lr)!==0)&&r.deps!==null?Qr:zt;er(r,t)}}function Yc(r,e,t){const n=ii()?xi:si;if(e.length===0){t(r.map(n));return}var s=At,l=ot,u=Jc(),h=zc();Promise.all(e.map(f=>Gc(f))).then(f=>{s?.activate(),u();try{t([...r.map(n),...f])}catch(m){(l.f&bn)===0&&Ra(m,l)}s?.deactivate(),Wl()}).catch(f=>{h.error(f)})}function Jc(){var r=ot,e=dt,t=Rt,n=At;return function(){Jr(r),Tr(e),vs(t),n?.activate()}}function Wl(){Jr(null),Tr(null),vs(null)}const qs=new Set;let At=null,us=null,Bo=new Set,ps=[];function Vl(){const r=ps.shift();ps.length>0&&queueMicrotask(Vl),r()}let yn=[],Es=null,la=!1,cs=!1;class Kn{current=new Map;#i=new Map;#r=new Set;#e=0;#s=null;#a=!1;#t=[];#n=[];#l=[];#o=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){yn=[],us=null;for(const s of e)this.#v(s);if(this.#t.length===0&&this.#e===0){this.#f();var t=this.#l,n=this.#o;this.#l=[],this.#o=[],this.#u=[],us=At,At=null,Wo(t),Wo(n),At===null?At=this:qs.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const s of this.#t)Gn(s);for(const s of this.#n)Gn(s);this.#t=[],this.#n=[]}#v(e){e.f^=zt;for(var t=e.first;t!==null;){var n=t.f,s=(n&(Br|wn))!==0,l=s&&(n&zt)!==0,u=l||(n&mr)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(s)t.f^=zt;else if((n&Ca)!==0)this.#o.push(t);else if((n&zt)===0)if((n&Pa)!==0){var h=t.b?.pending?this.#n:this.#t;h.push(t)}else As(t)&&((t.f&ri)!==0&&this.#u.push(t),Gn(t));var f=t.first;if(f!==null){t=f;continue}}var m=t.parent;for(t=t.next;t===null&&m!==null;)t=m.next,m=m.parent}}#c(e){for(const t of e)((t.f&ur)!==0?this.#d:this.#h).push(t),er(t,zt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){At=this}deactivate(){At=null,us=null;for(const e of Bo)if(Bo.delete(e),e(),At!==null)break}neuter(){this.#a=!0}flush(){yn.length>0?ql():this.#f(),At===this&&(this.#e===0&&qs.delete(this),this.deactivate())}#f(){if(!this.#a)for(const e of this.#r)e();this.#r.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)er(e,ur),Yn(e);for(const e of this.#h)er(e,Qr),Yn(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#r.add(e)}settled(){return(this.#s??=fc()).promise}static ensure(){if(At===null){const e=At=new Kn;qs.add(At),cs||Kn.enqueue(()=>{At===e&&e.flush()})}return At}static enqueue(e){ps.length===0&&queueMicrotask(Vl),ps.unshift(e)}}function Xc(r){var e=cs;cs=!0;try{for(var t;;){if(Hc(),yn.length===0&&(At?.flush(),yn.length===0))return Es=null,t;ql()}}finally{cs=e}}function ql(){var r=zn;la=!0;try{var e=0;for(zo(!0);yn.length>0;){var t=Kn.ensure();if(e++>1e3){var n,s;Qc()}t.process(yn),Yr.clear()}}finally{la=!1,zo(r),Es=null}}function Qc(){try{kc()}catch(r){Ra(r,Es)}}let vn=null;function Wo(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(bn|mr))===0&&As(n)&&(vn=[],Gn(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?eu(n):n.fn=null),vn?.length>0)){Yr.clear();for(const s of vn)Gn(s);vn=[]}}vn=null}}function Yn(r){for(var e=Es=r;e.parent!==null;){e=e.parent;var t=e.f;if(la&&e===ot&&(t&ri)!==0)return;if((t&(wn|Br))!==0){if((t&zt)===0)return;e.f^=zt}}yn.push(e)}const Yr=new Map;function Jn(r,e){var t={f:0,v:r,reactions:null,equals:Ml,rv:0,wv:0};return t}function et(r,e){const t=Jn(r);return nu(t),t}function Zc(r,e=!1,t=!0){const n=Jn(r);return e||(n.equals=Dl),ni&&t&&Rt!==null&&Rt.l!==null&&(Rt.l.s??=[]).push(n),n}function Ee(r,e,t=!1){dt!==null&&(!Ar||(dt.f&No)!==0)&&ii()&&(dt.f&(ir|ri|Pa|No))!==0&&!Ur?.includes(r)&&Ac();let n=t?Ot(e):e;return Xn(r,n)}function Xn(r,e){if(!r.equals(e)){var t=r.v;En?Yr.set(r,e):Yr.set(r,t),r.v=e;var n=Kn.ensure();n.capture(r,t),(r.f&ir)!==0&&((r.f&ur)!==0&&Oa(r),er(r,(r.f&lr)===0?zt:Qr)),r.wv=su(),Hl(r,ur),ii()&&ot!==null&&(ot.f&zt)!==0&&(ot.f&(Br|wn))===0&&(or===null?hd([r]):or.push(r))}return e}function ua(r,e=1){var t=w(r),n=e===1?t++:t--;return Ee(r,t),n}function Hs(r){Ee(r,r.v+1)}function Hl(r,e){var t=r.reactions;if(t!==null)for(var n=ii(),s=t.length,l=0;l<s;l++){var u=t[l],h=u.f;if(!(!n&&u===ot)){var f=(h&ur)===0;f&&er(u,e),(h&ir)!==0?Hl(u,Qr):f&&((h&ri)!==0&&vn!==null&&vn.push(u),Yn(u))}}}function Ot(r){if(typeof r!="object"||r===null||Fr in r)return r;const e=Aa(r);if(e!==cc&&e!==dc)return r;var t=new Map,n=Ci(r),s=et(0),l=mn,u=h=>{if(mn===l)return h();var f=dt,m=mn;Tr(null),Ko(l);var _=h();return Tr(f),Ko(m),_};return n&&t.set("length",et(r.length)),new Proxy(r,{defineProperty(h,f,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ic();var _=t.get(f);return _===void 0?_=u(()=>{var b=et(m.value);return t.set(f,b),b}):Ee(_,m.value,!0),!0},deleteProperty(h,f){var m=t.get(f);if(m===void 0){if(f in h){const _=u(()=>et(Ut));t.set(f,_),Hs(s)}}else Ee(m,Ut),Hs(s);return!0},get(h,f,m){if(f===Fr)return r;var _=t.get(f),b=f in h;if(_===void 0&&(!b||Hn(h,f)?.writable)&&(_=u(()=>{var p=Ot(b?h[f]:Ut),I=et(p);return I}),t.set(f,_)),_!==void 0){var S=w(_);return S===Ut?void 0:S}return Reflect.get(h,f,m)},getOwnPropertyDescriptor(h,f){var m=Reflect.getOwnPropertyDescriptor(h,f);if(m&&"value"in m){var _=t.get(f);_&&(m.value=w(_))}else if(m===void 0){var b=t.get(f),S=b?.v;if(b!==void 0&&S!==Ut)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return m},has(h,f){if(f===Fr)return!0;var m=t.get(f),_=m!==void 0&&m.v!==Ut||Reflect.has(h,f);if(m!==void 0||ot!==null&&(!_||Hn(h,f)?.writable)){m===void 0&&(m=u(()=>{var S=_?Ot(h[f]):Ut,p=et(S);return p}),t.set(f,m));var b=w(m);if(b===Ut)return!1}return _},set(h,f,m,_){var b=t.get(f),S=f in h;if(n&&f==="length")for(var p=m;p<b.v;p+=1){var I=t.get(p+"");I!==void 0?Ee(I,Ut):p in h&&(I=u(()=>et(Ut)),t.set(p+"",I))}if(b===void 0)(!S||Hn(h,f)?.writable)&&(b=u(()=>et(void 0)),Ee(b,Ot(m)),t.set(f,b));else{S=b.v!==Ut;var U=u(()=>Ot(m));Ee(b,U)}var R=Reflect.getOwnPropertyDescriptor(h,f);if(R?.set&&R.set.call(_,m),!S){if(n&&typeof f=="string"){var B=t.get("length"),q=Number(f);Number.isInteger(q)&&q>=B.v&&Ee(B,q+1)}Hs(s)}return!0},ownKeys(h){w(s);var f=Reflect.ownKeys(h).filter(b=>{var S=t.get(b);return S===void 0||S.v!==Ut});for(var[m,_]of t)_.v!==Ut&&!(m in h)&&f.push(m);return f},setPrototypeOf(){Sc()}})}function Vo(r){try{if(r!==null&&typeof r=="object"&&Fr in r)return r[Fr]}catch{}return r}function ed(r,e){return Object.is(Vo(r),Vo(e))}var qo,zl,Gl,Kl;function td(){if(qo===void 0){qo=window,zl=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;Gl=Hn(e,"firstChild").get,Kl=Hn(e,"nextSibling").get,Uo(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Uo(t)&&(t.__t=void 0)}}function kn(r=""){return document.createTextNode(r)}function Qn(r){return Gl.call(r)}function Is(r){return Kl.call(r)}function C(r,e){return Qn(r)}function jt(r,e){{var t=Qn(r);return t instanceof Comment&&t.data===""?Is(t):t}}function L(r,e=1,t=!1){let n=r;for(;e--;)n=Is(n);return n}function rd(r){r.textContent=""}function Ma(){return!1}let Ho=!1;function nd(){Ho||(Ho=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function La(r){var e=dt,t=ot;Tr(null),Jr(null);try{return r()}finally{Tr(e),Jr(t)}}function Da(r,e,t,n=t){r.addEventListener(e,()=>La(t));const s=r.__on_r;s?r.__on_r=()=>{s(),n(!0)}:r.__on_r=()=>n(!0),nd()}function Yl(r){ot===null&&dt===null&&bc(),dt!==null&&(dt.f&lr)!==0&&ot===null&&wc(),En&&yc()}function id(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function xr(r,e,t,n=!0){var s=ot;s!==null&&(s.f&mr)!==0&&(r|=mr);var l={ctx:Rt,deps:null,nodes_start:null,nodes_end:null,f:r|ur,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Gn(l),l.f|=Ta}catch(f){throw Nr(l),f}else e!==null&&Yn(l);if(n){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Ti)===0&&(u=u.first),u!==null&&(u.parent=s,s!==null&&id(u,s),dt!==null&&(dt.f&ir)!==0&&(r&wn)===0)){var h=dt;(h.effects??=[]).push(u)}}return l}function sd(r){const e=xr(ws,null,!1);return er(e,zt),e.teardown=r,e}function Zn(r){Yl();var e=ot.f,t=!dt&&(e&Br)!==0&&(e&Ta)===0;if(t){var n=Rt;(n.e??=[]).push(r)}else return Jl(r)}function Jl(r){return xr(Ca|jl,r,!1)}function ad(r){return Yl(),xr(ws|jl,r,!0)}function od(r){Kn.ensure();const e=xr(wn|Ti,r,!0);return(t={})=>new Promise(n=>{t.outro?Ss(e,()=>{Nr(e),n(void 0)}):(Nr(e),n(void 0))})}function Xl(r){return xr(Ca,r,!1)}function ld(r){return xr(Pa|Ti,r,!0)}function $a(r,e=0){return xr(ws|e,r,!0)}function Ie(r,e=[],t=[]){Yc(e,t,n=>{xr(ws,()=>r(...n.map(w)),!0)})}function Fa(r,e=0){var t=xr(ri|e,r,!0);return t}function ei(r,e=!0){return xr(Br|Ti,r,!0,e)}function Ql(r){var e=r.teardown;if(e!==null){const t=En,n=dt;Go(!0),Tr(null);try{e.call(null)}finally{Go(t),Tr(n)}}}function Zl(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const s=t.ac;s!==null&&La(()=>{s.abort(ja)});var n=t.next;(t.f&wn)!==0?t.parent=null:Nr(t,e),t=n}}function ud(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Br)===0&&Nr(e),e=t}}function Nr(r,e=!0){var t=!1;(e||(r.f&vc)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(cd(r.nodes_start,r.nodes_end),t=!0),Zl(r,e&&!t),gs(r,0),er(r,bn);var n=r.transitions;if(n!==null)for(const l of n)l.stop();Ql(r);var s=r.parent;s!==null&&s.first!==null&&eu(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function cd(r,e){for(;r!==null;){var t=r===e?null:Is(r);r.remove(),r=t}}function eu(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Ss(r,e){var t=[];Ua(r,t,!0),tu(t,()=>{Nr(r),e&&e()})}function tu(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var s of r)s.out(n)}else e()}function Ua(r,e,t){if((r.f&mr)===0){if(r.f^=mr,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var n=r.first;n!==null;){var s=n.next,l=(n.f&xa)!==0||(n.f&Br)!==0;Ua(n,e,l?t:!1),n=s}}}function Na(r){ru(r,!0)}function ru(r,e){if((r.f&mr)!==0){r.f^=mr,(r.f&zt)===0&&(er(r,ur),Yn(r));for(var t=r.first;t!==null;){var n=t.next,s=(t.f&xa)!==0||(t.f&Br)!==0;ru(t,s?e:!1),t=n}if(r.transitions!==null)for(const l of r.transitions)(l.is_global||e)&&l.in()}}let Bn=null;function dd(r){var e=Bn;try{if(Bn=new Set,In(r),e!==null)for(var t of Bn)e.add(t);return Bn}finally{Bn=e}}function pr(r){for(var e of dd(r))Xn(e,e.v)}let zn=!1;function zo(r){zn=r}let En=!1;function Go(r){En=r}let dt=null,Ar=!1;function Tr(r){dt=r}let ot=null;function Jr(r){ot=r}let Ur=null;function nu(r){dt!==null&&(Ur===null?Ur=[r]:Ur.push(r))}let Jt=null,rr=0,or=null;function hd(r){or=r}let iu=1,Ii=0,mn=Ii;function Ko(r){mn=r}let Kr=!1;function su(){return++iu}function As(r){var e=r.f;if((e&ur)!==0)return!0;if((e&Qr)!==0){var t=r.deps,n=(e&lr)!==0;if(t!==null){var s,l,u=(e&fs)!==0,h=n&&ot!==null&&!Kr,f=t.length;if((u||h)&&(ot===null||(ot.f&bn)===0)){var m=r,_=m.parent;for(s=0;s<f;s++)l=t[s],(u||!l?.reactions?.includes(m))&&(l.reactions??=[]).push(m);u&&(m.f^=fs),h&&_!==null&&(_.f&lr)===0&&(m.f^=lr)}for(s=0;s<f;s++)if(l=t[s],As(l)&&Bl(l),l.wv>r.wv)return!0}(!n||ot!==null&&!Kr)&&er(r,zt)}return!1}function au(r,e,t=!0){var n=r.reactions;if(n!==null&&!Ur?.includes(r))for(var s=0;s<n.length;s++){var l=n[s];(l.f&ir)!==0?au(l,e,!1):e===l&&(t?er(l,ur):(l.f&zt)!==0&&er(l,Qr),Yn(l))}}function ou(r){var e=Jt,t=rr,n=or,s=dt,l=Kr,u=Ur,h=Rt,f=Ar,m=mn,_=r.f;Jt=null,rr=0,or=null,Kr=(_&lr)!==0&&(Ar||!zn||dt===null),dt=(_&(Br|wn))===0?r:null,Ur=null,vs(r.ctx),Ar=!1,mn=++Ii,r.ac!==null&&(La(()=>{r.ac.abort(ja)}),r.ac=null);try{r.f|=aa;var b=r.fn,S=b(),p=r.deps;if(Jt!==null){var I;if(gs(r,rr),p!==null&&rr>0)for(p.length=rr+Jt.length,I=0;I<Jt.length;I++)p[rr+I]=Jt[I];else r.deps=p=Jt;if(!Kr||(_&ir)!==0&&r.reactions!==null)for(I=rr;I<p.length;I++)(p[I].reactions??=[]).push(r)}else p!==null&&rr<p.length&&(gs(r,rr),p.length=rr);if(ii()&&or!==null&&!Ar&&p!==null&&(r.f&(ir|Qr|ur))===0)for(I=0;I<or.length;I++)au(or[I],r);return s!==null&&s!==r&&(Ii++,or!==null&&(n===null?n=or:n.push(...or))),(r.f&_n)!==0&&(r.f^=_n),S}catch(U){return Vc(U)}finally{r.f^=aa,Jt=e,rr=t,or=n,dt=s,Kr=l,Ur=u,vs(h),Ar=f,mn=m}}function fd(r,e){let t=e.reactions;if(t!==null){var n=uc.call(t,r);if(n!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[n]=t[s],t.pop())}}t===null&&(e.f&ir)!==0&&(Jt===null||!Jt.includes(e))&&(er(e,Qr),(e.f&(lr|fs))===0&&(e.f^=fs),Nl(e),gs(e,0))}function gs(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)fd(r,t[n])}function Gn(r){var e=r.f;if((e&bn)===0){er(r,zt);var t=ot,n=zn;ot=r,zn=!0;try{(e&ri)!==0?ud(r):Zl(r),Ql(r);var s=ou(r);r.teardown=typeof s=="function"?s:null,r.wv=iu;var l;Tl&&Nc&&(r.f&ur)!==0&&r.deps}finally{zn=n,ot=t}}}async function lu(){await Promise.resolve(),Xc()}function w(r){var e=r.f,t=(e&ir)!==0;if(Bn?.add(r),dt!==null&&!Ar){var n=ot!==null&&(ot.f&bn)!==0;if(!n&&!Ur?.includes(r)){var s=dt.deps;if((dt.f&aa)!==0)r.rv<Ii&&(r.rv=Ii,Jt===null&&s!==null&&s[rr]===r?rr++:Jt===null?Jt=[r]:(!Kr||!Jt.includes(r))&&Jt.push(r));else{(dt.deps??=[]).push(r);var l=r.reactions;l===null?r.reactions=[dt]:l.includes(dt)||l.push(dt)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&lr)===0&&(u.f^=lr)}if(En){if(Yr.has(r))return Yr.get(r);if(t){u=r;var f=u.v;return((u.f&zt)===0&&u.reactions!==null||uu(u))&&(f=Oa(u)),Yr.set(u,f),f}}else t&&(u=r,As(u)&&Bl(u));if((r.f&_n)!==0)throw r.v;return r.v}function uu(r){if(r.v===Ut)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(Yr.has(e)||(e.f&ir)!==0&&uu(e))return!0;return!1}function In(r){var e=Ar;try{return Ar=!0,r()}finally{Ar=e}}const vd=-7169;function er(r,e){r.f=r.f&vd|e}function pd(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Fr in r)ca(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Fr in t&&ca(t)}}}function ca(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{ca(r[n],e)}catch{}const t=Aa(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=xl(t);for(let s in n){const l=n[s].get;if(l)try{l.call(r)}catch{}}}}}const gd=["touchstart","touchmove"];function _d(r){return gd.includes(r)}const cu=new Set,da=new Set;function Xt(r){for(var e=0;e<r.length;e++)cu.add(r[e]);for(var t of da)t(r)}let Yo=null;function ts(r){var e=this,t=e.ownerDocument,n=r.type,s=r.composedPath?.()||[],l=s[0]||r.target;Yo=r;var u=0,h=Yo===r&&r.__root;if(h){var f=s.indexOf(h);if(f!==-1&&(e===document||e===window)){r.__root=e;return}var m=s.indexOf(e);if(m===-1)return;f<=m&&(u=f)}if(l=s[u]||r.target,l!==e){sa(r,"currentTarget",{configurable:!0,get(){return l||t}});var _=dt,b=ot;Tr(null),Jr(null);try{for(var S,p=[];l!==null;){var I=l.assignedSlot||l.parentNode||l.host||null;try{var U=l["__"+n];if(U!=null&&(!l.disabled||r.target===l))if(Ci(U)){var[R,...B]=U;R.apply(l,[r,...B])}else U.call(l,r)}catch(q){S?p.push(q):S=q}if(r.cancelBubble||I===e||I===null)break;l=I}if(S){for(let q of p)queueMicrotask(()=>{throw q});throw S}}finally{r.__root=e,delete r.currentTarget,Tr(_),Jr(b)}}}function du(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function Si(r,e){var t=ot;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function te(r,e){var t=(e&Mc)!==0,n=(e&Lc)!==0,s,l=!r.startsWith("<!>");return()=>{s===void 0&&(s=du(l?r:"<!>"+r),t||(s=Qn(s)));var u=n||zl?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=Qn(u),f=u.lastChild;Si(h,f)}else Si(u,u);return u}}function md(r,e,t="svg"){var n=!r.startsWith("<!>"),s=`<${t}>${n?r:"<!>"+r}</${t}>`,l;return()=>{if(!l){var u=du(s),h=Qn(u);l=Qn(h)}var f=l.cloneNode(!0);return Si(f,f),f}}function yd(r,e){return md(r,e,"svg")}function rs(r=""){{var e=kn(r+"");return Si(e,e),e}}function Gt(){var r=document.createDocumentFragment(),e=document.createComment(""),t=kn();return r.append(e,t),Si(e,t),r}function G(r,e){r!==null&&r.before(e)}function Ae(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function wd(r,e){return bd(r,e)}const Pn=new Map;function bd(r,{target:e,anchor:t,props:n={},events:s,context:l,intro:u=!0}){td();var h=new Set,f=b=>{for(var S=0;S<b.length;S++){var p=b[S];if(!h.has(p)){h.add(p);var I=_d(p);e.addEventListener(p,ts,{passive:I});var U=Pn.get(p);U===void 0?(document.addEventListener(p,ts,{passive:I}),Pn.set(p,1)):Pn.set(p,U+1)}}};f(Sa(cu)),da.add(f);var m=void 0,_=od(()=>{var b=t??e.appendChild(kn());return ei(()=>{if(l){Wt({});var S=Rt;S.c=l}s&&(n.$$events=s),m=r(b,n)||{},l&&Vt()}),()=>{for(var S of h){e.removeEventListener(S,ts);var p=Pn.get(S);--p===0?(document.removeEventListener(S,ts),Pn.delete(S)):Pn.set(S,p)}da.delete(f),b!==t&&b.parentNode?.removeChild(b)}});return kd.set(m,_),m}let kd=new WeakMap;function je(r,e,t=!1){var n=r,s=null,l=null,u=Ut,h=t?xa:0,f=!1;const m=(p,I=!0)=>{f=!0,S(I,p)};var _=null;function b(){_!==null&&(_.lastChild.remove(),n.before(_),_=null);var p=u?s:l,I=u?l:s;p&&Na(p),I&&Ss(I,()=>{u?l=null:s=null})}const S=(p,I)=>{if(u!==(u=p)){var U=Ma(),R=n;if(U&&(_=document.createDocumentFragment(),_.append(R=kn())),u?s??=I&&ei(()=>I(R)):l??=I&&ei(()=>I(R)),U){var B=At,q=u?s:l,N=u?l:s;q&&B.skipped_effects.delete(q),N&&B.skipped_effects.add(N),B.add_callback(b)}else b()}};Fa(()=>{f=!1,e(m),f||S(null,null)},h)}function ha(r,e,t){var n=r,s=Ut,l,u,h=null,f=ii()?Uc:Ll;function m(){l&&Ss(l),h!==null&&(h.lastChild.remove(),n.before(h),h=null),l=u}Fa(()=>{if(f(s,s=e())){var _=n,b=Ma();b&&(h=document.createDocumentFragment(),h.append(_=kn())),u=ei(()=>t(_)),b?At.add_callback(m):m()}})}function nr(r,e){return e}function Ed(r,e,t){for(var n=r.items,s=[],l=e.length,u=0;u<l;u++)Ua(e[u].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var f=t.parentNode;rd(f),f.append(t),n.clear(),Er(r,e[0].prev,e[l-1].next)}tu(s,()=>{for(var m=0;m<l;m++){var _=e[m];h||(n.delete(_.k),Er(r,_.prev,_.next)),Nr(_.e,!h)}})}function wt(r,e,t,n,s,l=null){var u=r,h={flags:e,items:new Map,first:null},f=(e&Ol)!==0;if(f){var m=r;u=m.appendChild(kn())}var _=null,b=!1,S=new Map,p=si(()=>{var B=t();return Ci(B)?B:B==null?[]:Sa(B)}),I,U;function R(){Id(U,I,h,S,u,s,e,n,t),l!==null&&(I.length===0?_?Na(_):_=ei(()=>l(u)):_!==null&&Ss(_,()=>{_=null}))}Fa(()=>{U??=ot,I=w(p);var B=I.length;if(!(b&&B===0)){b=B===0;var q,N,K,J;if(Ma()){var D=new Set,W=At;for(N=0;N<B;N+=1){K=I[N],J=n(K,N);var ae=h.items.get(J)??S.get(J);ae?(e&(bs|ks))!==0&&hu(ae,K,N,e):(q=fu(null,h,null,null,K,J,N,s,e,t,!0),S.set(J,q)),D.add(J)}for(const[Q,we]of h.items)D.has(Q)||W.skipped_effects.add(we.e);W.add_callback(R)}else R();w(p)}})}function Id(r,e,t,n,s,l,u,h,f){var m=(u&Cc)!==0,_=(u&(bs|ks))!==0,b=e.length,S=t.items,p=t.first,I=p,U,R=null,B,q=[],N=[],K,J,D,W;if(m)for(W=0;W<b;W+=1)K=e[W],J=h(K,W),D=S.get(J),D!==void 0&&(D.a?.measure(),(B??=new Set).add(D));for(W=0;W<b;W+=1){if(K=e[W],J=h(K,W),D=S.get(J),D===void 0){var ae=n.get(J);if(ae!==void 0){n.delete(J),S.set(J,ae);var Q=R?R.next:I;Er(t,R,ae),Er(t,ae,Q),zs(ae,Q,s),R=ae}else{var we=I?I.e.nodes_start:s;R=fu(we,t,R,R===null?t.first:R.next,K,J,W,l,u,f)}S.set(J,R),q=[],N=[],I=R.next;continue}if(_&&hu(D,K,W,u),(D.e.f&mr)!==0&&(Na(D.e),m&&(D.a?.unfix(),(B??=new Set).delete(D))),D!==I){if(U!==void 0&&U.has(D)){if(q.length<N.length){var Z=N[0],ee;R=Z.prev;var Se=q[0],Me=q[q.length-1];for(ee=0;ee<q.length;ee+=1)zs(q[ee],Z,s);for(ee=0;ee<N.length;ee+=1)U.delete(N[ee]);Er(t,Se.prev,Me.next),Er(t,R,Se),Er(t,Me,Z),I=Z,R=Me,W-=1,q=[],N=[]}else U.delete(D),zs(D,I,s),Er(t,D.prev,D.next),Er(t,D,R===null?t.first:R.next),Er(t,R,D),R=D;continue}for(q=[],N=[];I!==null&&I.k!==J;)(I.e.f&mr)===0&&(U??=new Set).add(I),N.push(I),I=I.next;if(I===null)continue;D=I}q.push(D),R=D,I=D.next}if(I!==null||U!==void 0){for(var ge=U===void 0?[]:Sa(U);I!==null;)(I.e.f&mr)===0&&ge.push(I),I=I.next;var Te=ge.length;if(Te>0){var be=(u&Ol)!==0&&b===0?s:null;if(m){for(W=0;W<Te;W+=1)ge[W].a?.measure();for(W=0;W<Te;W+=1)ge[W].a?.fix()}Ed(t,ge,be)}}m&&Ul(()=>{if(B!==void 0)for(D of B)D.a?.apply()}),r.first=t.first&&t.first.e,r.last=R&&R.e;for(var ft of n.values())Nr(ft.e);n.clear()}function hu(r,e,t,n){(n&bs)!==0&&Xn(r.v,e),(n&ks)!==0?Xn(r.i,t):r.i=t}function fu(r,e,t,n,s,l,u,h,f,m,_){var b=(f&bs)!==0,S=(f&Tc)===0,p=b?S?Zc(s,!1,!1):Jn(s):s,I=(f&ks)===0?u:Jn(u),U={i:I,v:p,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var R=document.createDocumentFragment();R.append(r=kn())}return U.e=ei(()=>h(r,p,I,m),Fc),U.e.prev=t&&t.e,U.e.next=n&&n.e,t===null?_||(e.first=U):(t.next=U,t.e.next=U.e),n!==null&&(n.prev=U,n.e.prev=U.e),U}finally{}}function zs(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var u=Is(l);s.before(l),l=u}}function Er(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const Jo=[...` 	
\r\f \v\uFEFF`];function Sd(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var l=s.length,u=0;(u=n.indexOf(s,u))>=0;){var h=u+l;(u===0||Jo.includes(n[u-1]))&&(h===n.length||Jo.includes(n[h]))?n=(u===0?"":n.substring(0,u))+n.substring(h+1):u=h}}return n===""?null:n}function Ad(r,e){return String(r)}function Kt(r,e,t,n,s,l){var u=r.__className;if(u!==t||u===void 0){var h=Sd(t,n,l);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(l&&s!==l)for(var f in l){var m=!!l[f];(s==null||m!==!!s[f])&&r.classList.toggle(f,m)}return l}function vu(r,e,t,n){var s=r.__style;if(s!==e){var l=Ad(e);l==null?r.removeAttribute("style"):r.style.cssText=l,r.__style=e}return n}function zr(r,e,t=!1){if(r.multiple){if(e==null)return;if(!Ci(e))return $c();for(var n of r.options)n.selected=e.includes(yi(n));return}for(n of r.options){var s=yi(n);if(ed(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function hn(r){var e=new MutationObserver(()=>{zr(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),sd(()=>{e.disconnect()})}function qn(r,e,t=e){var n=!0;Da(r,"change",s=>{var l=s?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(l),yi);else{var h=r.querySelector(l)??r.querySelector("option:not([disabled])");u=h&&yi(h)}t(u)}),Xl(()=>{var s=e();if(zr(r,s,n),n&&s===void 0){var l=r.querySelector(":checked");l!==null&&(s=yi(l),t(s))}r.__value=s,n=!1}),hn(r)}function yi(r){return"__value"in r?r.__value:r.value}const Cd=Symbol("is custom element"),Td=Symbol("is html");function Gs(r,e){var t=Ba(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function xd(r,e){var t=Ba(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Oe(r,e,t,n){var s=Ba(r);s[e]!==(s[e]=t)&&(e==="loading"&&(r[gc]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Pd(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Ba(r){return r.__attributes??={[Cd]:r.nodeName.includes("-"),[Td]:r.namespaceURI===Dc}}var Xo=new Map;function Pd(r){var e=r.getAttribute("is")||r.nodeName,t=Xo.get(e);if(t)return t;Xo.set(e,t=[]);for(var n,s=r,l=Element.prototype;l!==s;){n=xl(s);for(var u in n)n[u].set&&t.push(u);s=Aa(s)}return t}function $r(r,e,t=e){var n=new WeakSet;Da(r,"input",async s=>{var l=s?r.defaultValue:r.value;if(l=Ks(r)?Ys(l):l,t(l),At!==null&&n.add(At),await lu(),l!==(l=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=l??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),In(e)==null&&r.value&&(t(Ks(r)?Ys(r.value):r.value),At!==null&&n.add(At)),$a(()=>{var s=e();if(r===document.activeElement){var l=us??At;if(n.has(l))return}Ks(r)&&s===Ys(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Qo(r,e,t=e){Da(r,"change",n=>{var s=n?r.defaultChecked:r.checked;t(s)}),In(e)==null&&t(r.checked),$a(()=>{var n=e();r.checked=!!n})}function Ks(r){var e=r.type;return e==="number"||e==="range"}function Ys(r){return r===""?null:+r}function Zo(r,e){return r===e||r?.[Fr]===e}function fa(r={},e,t,n){return Xl(()=>{var s,l;return $a(()=>{s=l,l=[],In(()=>{r!==t(...l)&&(e(r,...l),s&&Zo(t(...s),r)&&e(null,...s))})}),()=>{Ul(()=>{l&&Zo(t(...l),r)&&e(null,...l)})}}),r}function Zr(r=!1){const e=Rt,t=e.l.u;if(!t)return;let n=()=>pd(e.s);if(r){let s=0,l={};const u=xi(()=>{let h=!1;const f=e.s;for(const m in f)f[m]!==l[m]&&(l[m]=f[m],h=!0);return h&&s++,s});n=()=>w(u)}t.b.length&&ad(()=>{el(e,n),hs(t.b)}),Zn(()=>{const s=In(()=>t.m.map(hc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&Zn(()=>{el(e,n),hs(t.a)})}function el(r,e){if(r.l.s)for(const t of r.l.s)w(t);e()}function en(r){var e=Jn(0);return function(){return arguments.length===1?(Ee(e,w(e)+1),arguments[0]):(w(e),r())}}let ns=!1;function jd(r){var e=ns;try{return ns=!1,[r(),ns]}finally{ns=e}}function _r(r,e,t,n){var s=!ni||(t&Pc)!==0,l=(t&Rc)!==0,u=(t&Oc)!==0,h=n,f=!0,m=()=>(f&&(f=!1,h=u?In(n):n),h),_;if(l){var b=Fr in r||pc in r;_=Hn(r,e)?.set??(b&&e in r?N=>r[e]=N:void 0)}var S,p=!1;l?[S,p]=jd(()=>r[e]):S=r[e],S===void 0&&n!==void 0&&(S=m(),_&&(s&&Ec(),_(S)));var I;if(s?I=()=>{var N=r[e];return N===void 0?m():(f=!0,N)}:I=()=>{var N=r[e];return N!==void 0&&(h=void 0),N===void 0?h:N},s&&(t&jc)===0)return I;if(_){var U=r.$$legacy;return(function(N,K){return arguments.length>0?((!s||!K||U||p)&&_(K?I():N),N):I()})}var R=!1,B=((t&xc)!==0?xi:si)(()=>(R=!1,I()));l&&w(B);var q=ot;return(function(N,K){if(arguments.length>0){const J=K?w(B):s&&l?Ot(N):N;return Ee(B,J),R=!0,h!==void 0&&(h=J),N}return En&&R||(q.f&bn)!==0?B.v:w(B)})}function Pi(r){Rt===null&&Rl(),ni&&Rt.l!==null?Od(Rt).m.push(r):Zn(()=>{const e=In(r);if(typeof e=="function")return e})}function Rd(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}function pu(){const r=Rt;return r===null&&Rl(),(e,t,n)=>{const s=r.s.$$events?.[e];if(s){const l=Ci(s)?s.slice():[s],u=Rd(e,t,n);for(const h of l)h.call(r.x,u);return!u.defaultPrevented}return!0}}function Od(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Md="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Md);Bc();const M=Ot({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Nt={get currentDialogue(){return M.data?.dialogues.find(r=>r.id===M.selectedDialogueId)},get currentChapter(){return M.data?.chapters?.find(r=>r.id===M.selectedChapterId)},get currentEditingChapter(){return M.data?.chapters?.find(r=>r.id===M.editingChapterId)},get currentEditingOption(){return Nt.currentDialogue&&M.editingOptionIndex!==null?Nt.currentDialogue.options?.[M.editingOptionIndex]:void 0},get chapterDialogues(){return!M.data?.dialogues||!M.selectedChapterId?[]:M.data.dialogues.filter(r=>r.chapterId===M.selectedChapterId)},get imageResources(){return M.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return M.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return M.data?.items||[]},get backlinks(){return!M.data||!M.selectedDialogueId?[]:M.data.dialogues.filter(r=>r.nextDialogueId===M.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===M.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},pt={toggleEditor(){M.showEditor=!M.showEditor},toggleItemsPanel(){M.showItems=!M.showItems},setStatus(r,e){M.statusMessage={type:r,text:e}},clearStatus(){M.statusMessage={type:"",text:""}},selectBucket(r){M.selectedBucket=r,M.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},M.storedFiles=[],M.storiesList=[],M.selectedChapterId=null,M.selectedDialogueId=null},updateBucketsList(r){M.availableBuckets=r},selectChapter(r){M.selectedChapterId=r,M.selectedDialogueId=null},selectDialogue(r){M.selectedDialogueId=r},selectOption(r){M.editingOptionIndex=r},selectItem(r){M.editingItemIndex=r},updateStoryData(r){M.data=r},updateStoredFiles(r){M.storedFiles=r},updateStoriesList(r){M.storiesList=r},setCurrentFileName(r){M.currentFileName=r},addDialogue(r){M.data.dialogues=[...M.data.dialogues,r]},updateDialogue(r,e){M.data.dialogues=M.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){M.data.dialogues=M.data.dialogues.filter(e=>e.id!==r),M.selectedDialogueId===r&&(M.selectedDialogueId=null)},addChapter(r){M.data.chapters=[...M.data.chapters,r]},updateChapter(r,e){M.data.chapters=M.data.chapters.map(t=>t.id===r?{...t,...e}:t)},selectEditingChapter(r){M.editingChapterId=r},deleteChapter(r){M.data.chapters=M.data.chapters.filter(e=>e.id!==r),M.selectedChapterId===r&&(M.selectedChapterId=null,M.selectedDialogueId=null)},addItem(r){M.data.items=[...M.data.items||[],r]},updateItem(r,e){M.data.items&&(M.data.items=M.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){M.data.items&&(M.data.items=M.data.items.filter(e=>e.id!==r))},reset(){M.showEditor=!1,M.showItems=!1,M.editingOptionIndex=null,M.editingItemIndex=null,M.selectedChapterId=null,M.selectedDialogueId=null,M.statusMessage={type:"",text:""}}},Ld="modulepreload",Dd=function(r,e){return new URL(r,e).href},tl={},ji=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let m=function(_){return Promise.all(_.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");s=m(t.map(_=>{if(_=Dd(_,n),_ in tl)return;tl[_]=!0;const b=_.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(!!n)for(let U=u.length-1;U>=0;U--){const R=u[U];if(R.href===_&&(!b||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${S}`))return;const I=document.createElement("link");if(I.rel=b?"stylesheet":Ld,b||(I.as="script"),I.crossOrigin="",I.href=_,f&&I.setAttribute("nonce",f),document.head.appendChild(I),b)return new Promise((U,R)=>{I.addEventListener("load",U),I.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${_}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},$d=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:n}=await Promise.resolve().then(()=>ai);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class Wa extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class Fd extends Wa{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rl extends Wa{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class nl extends Wa{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var va;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(va||(va={}));var Ud=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class Nd{constructor(e,{headers:t={},customFetch:n,region:s=va.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=$d(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Ud(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:u}=t;let h={},{region:f}=t;f||(f=this.region);const m=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let _;u&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(h["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(h["Content-Type"]="application/json",_=JSON.stringify(u)));const b=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:_}).catch(U=>{throw new Fd(U)}),S=b.headers.get("x-relay-error");if(S&&S==="true")throw new rl(b);if(!b.ok)throw new nl(b);let p=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),I;return p==="application/json"?I=yield b.json():p==="application/octet-stream"?I=yield b.blob():p==="text/event-stream"?I=b:p==="multipart/form-data"?I=yield b.formData():I=yield b.text(),{data:I,error:null,response:b}}catch(s){return{data:null,error:s,response:s instanceof nl||s instanceof rl?s.context:void 0}}})}}function Bd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Wd(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Ft={},jn={},Rn={},On={},Mn={},Ln={},Vd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ti=Vd();const qd=ti.fetch,gu=ti.fetch.bind(ti),_u=ti.Headers,Hd=ti.Request,zd=ti.Response,ai=Object.freeze(Object.defineProperty({__proto__:null,Headers:_u,Request:Hd,Response:zd,default:gu,fetch:qd},Symbol.toStringTag,{value:"Module"})),Gd=Wd(ai);var is={},il;function mu(){if(il)return is;il=1,Object.defineProperty(is,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return is.default=r,is}var sl;function yu(){if(sl)return Ln;sl=1;var r=Ln&&Ln.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=r(Gd),t=r(mu());class n{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let f=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var _,b,S,p;let I=null,U=null,R=null,B=m.status,q=m.statusText;if(m.ok){if(this.method!=="HEAD"){const D=await m.text();D===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?U=D:U=JSON.parse(D))}const K=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),J=(S=m.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");K&&J&&J.length>1&&(R=parseInt(J[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(U)&&(U.length>1?(I={code:"PGRST116",details:`Results contain ${U.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},U=null,R=null,B=406,q="Not Acceptable"):U.length===1?U=U[0]:U=null)}else{const K=await m.text();try{I=JSON.parse(K),Array.isArray(I)&&m.status===404&&(U=[],I=null,B=200,q="OK")}catch{m.status===404&&K===""?(B=204,q="No Content"):I={message:K}}if(I&&this.isMaybeSingle&&(!((p=I?.details)===null||p===void 0)&&p.includes("0 rows"))&&(I=null,B=200,q="OK"),I&&this.shouldThrowOnError)throw new t.default(I)}return{error:I,data:U,count:R,status:B,statusText:q}});return this.shouldThrowOnError||(f=f.catch(m=>{var _,b,S;return{error:{message:`${(_=m?.name)!==null&&_!==void 0?_:"FetchError"}: ${m?.message}`,details:`${(b=m?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(S=m?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),f.then(l,u)}returns(){return this}overrideTypes(){return this}}return Ln.default=n,Ln}var al;function wu(){if(al)return Mn;al=1;var r=Mn&&Mn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Mn,"__esModule",{value:!0});const e=r(yu());class t extends e.default{select(s){let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:f=h}={}){const m=f?`${f}.order`:"order",_=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${_?`${_},`:""}${s}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:u,referencedTable:h=u}={}){const f=typeof h>"u"?"offset":`${h}.offset`,m=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(f,`${s}`),this.url.searchParams.set(m,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:f=!1,format:m="text"}={}){var _;const b=[s?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,f?"wal":null].filter(Boolean).join("|"),S=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${S}"; options=${b};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Mn.default=t,Mn}var ol;function Va(){if(ol)return On;ol=1;var r=On&&On.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(On,"__esModule",{value:!0});const e=r(wu());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const m=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${m}.${l}`),this}match(s){return Object.entries(s).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(s,l,u){return this.url.searchParams.append(s,`not.${l}.${u}`),this}or(s,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,u){return this.url.searchParams.append(s,`${l}.${u}`),this}}return On.default=t,On}var ll;function bu(){if(ll)return Rn;ll=1;var r=Rn&&Rn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rn,"__esModule",{value:!0});const e=r(Va());class t{constructor(s,{headers:l={},schema:u,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(s,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let f=!1;const m=(s??"*").split("").map(_=>/\s/.test(_)&&!f?"":(_==='"'&&(f=!f),_)).join("");return this.url.searchParams.set("select",m),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:u=!0}={}){var h;const f="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((_,b)=>_.concat(Object.keys(b)),[]);if(m.length>0){const _=[...new Set(m)].map(b=>`"${b}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:f=!0}={}){var m;const _="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const b=s.reduce((S,p)=>S.concat(Object.keys(p)),[]);if(b.length>0){const S=[...new Set(b)].map(p=>`"${p}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(s,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:s}={}){var l;const u="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Rn.default=t,Rn}var ul;function Kd(){if(ul)return jn;ul=1;var r=jn&&jn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(jn,"__esModule",{value:!0});const e=r(bu()),t=r(Va());class n{constructor(l,{headers:u={},schema:h,fetch:f}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=f}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:f=!1,count:m}={}){var _;let b;const S=new URL(`${this.url}/rpc/${l}`);let p;h||f?(b=h?"HEAD":"GET",Object.entries(u).filter(([U,R])=>R!==void 0).map(([U,R])=>[U,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([U,R])=>{S.searchParams.append(U,R)})):(b="POST",p=u);const I=new Headers(this.headers);return m&&I.set("Prefer",`count=${m}`),new t.default({method:b,url:S,headers:I,schema:this.schemaName,body:p,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return jn.default=n,jn}var cl;function Yd(){if(cl)return Ft;cl=1;var r=Ft&&Ft.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PostgrestError=Ft.PostgrestBuilder=Ft.PostgrestTransformBuilder=Ft.PostgrestFilterBuilder=Ft.PostgrestQueryBuilder=Ft.PostgrestClient=void 0;const e=r(Kd());Ft.PostgrestClient=e.default;const t=r(bu());Ft.PostgrestQueryBuilder=t.default;const n=r(Va());Ft.PostgrestFilterBuilder=n.default;const s=r(wu());Ft.PostgrestTransformBuilder=s.default;const l=r(yu());Ft.PostgrestBuilder=l.default;const u=r(mu());return Ft.PostgrestError=u.default,Ft.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:u.default},Ft}var Jd=Yd();const Xd=Bd(Jd),{PostgrestClient:Qd,PostgrestQueryBuilder:fg,PostgrestFilterBuilder:vg,PostgrestTransformBuilder:pg,PostgrestBuilder:gg,PostgrestError:_g}=Xd;class Zd{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const eh="2.15.1",th=`realtime-js/${eh}`,rh="1.0.0",pa=1e4,nh=1e3,ih=100;var wi;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(wi||(wi={}));var Mt;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Mt||(Mt={}));var gr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(gr||(gr={}));var ga;(function(r){r.websocket="websocket"})(ga||(ga={}));var pn;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(pn||(pn={}));class sh{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=n.decode(e.slice(u,u+s));u=u+s;const f=n.decode(e.slice(u,u+l));u=u+l;const m=JSON.parse(n.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:f,payload:m}}}class ku{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Et;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Et||(Et={}));const dl=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((l,u)=>(l[u]=ah(u,r,e,s),l),{})},ah=(r,e,t,n)=>{const s=e.find(h=>h.name===r),l=s?.type,u=t[r];return l&&!n.includes(l)?Eu(l,u):_a(u)},Eu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return ch(e,t)}switch(r){case Et.bool:return oh(e);case Et.float4:case Et.float8:case Et.int2:case Et.int4:case Et.int8:case Et.numeric:case Et.oid:return lh(e);case Et.json:case Et.jsonb:return uh(e);case Et.timestamp:return dh(e);case Et.abstime:case Et.date:case Et.daterange:case Et.int4range:case Et.int8range:case Et.money:case Et.reltime:case Et.text:case Et.time:case Et.timestamptz:case Et.timetz:case Et.tsrange:case Et.tstzrange:return _a(e);default:return _a(e)}},_a=r=>r,oh=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},lh=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},uh=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},ch=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let l;const u=r.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>Eu(e,h))}return r},dh=r=>typeof r=="string"?r.replace(" ","T"):r,Iu=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Js{constructor(e,t,n={},s=pa){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var hl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(hl||(hl={}));class bi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=bi.syncState(this.state,s,l,u),this.pendingDiffs.forEach(f=>{this.state=bi.syncDiff(this.state,f,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=bi.syncDiff(this.state,s,l,u),h())}),this.onJoin((s,l,u)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:u})}),this.onLeave((s,l,u)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const l=this.cloneDeep(e),u=this.transformState(t),h={},f={};return this.map(l,(m,_)=>{u[m]||(f[m]=_)}),this.map(u,(m,_)=>{const b=l[m];if(b){const S=_.map(R=>R.presence_ref),p=b.map(R=>R.presence_ref),I=_.filter(R=>p.indexOf(R.presence_ref)<0),U=b.filter(R=>S.indexOf(R.presence_ref)<0);I.length>0&&(h[m]=I),U.length>0&&(f[m]=U)}else h[m]=_}),this.syncDiff(l,{joins:h,leaves:f},n,s)}static syncDiff(e,t,n,s){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(l,(h,f)=>{var m;const _=(m=e[h])!==null&&m!==void 0?m:[];if(e[h]=this.cloneDeep(f),_.length>0){const b=e[h].map(p=>p.presence_ref),S=_.filter(p=>b.indexOf(p.presence_ref)<0);e[h].unshift(...S)}n(h,_,f)}),this.map(u,(h,f)=>{let m=e[h];if(!m)return;const _=f.map(b=>b.presence_ref);m=m.filter(b=>_.indexOf(b.presence_ref)<0),e[h]=m,s(h,m,f),m.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fl;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(fl||(fl={}));var ki;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ki||(ki={}));var Dr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Dr||(Dr={}));class qa{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Mt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Js(this,gr.join,this.params,this.timeout),this.rejoinTimer=new ku(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Mt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Mt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(gr.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new bi(this),this.broadcastEndpointURL=Iu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Mt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,f=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(S=>S.filter))!==null&&s!==void 0?s:[],m=!!this.bindings[ki.PRESENCE]&&this.bindings[ki.PRESENCE].length>0,_={},b={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(S=>e?.(Dr.CHANNEL_ERROR,S)),this._onClose(()=>e?.(Dr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var p;if(this.socket.setAuth(),S===void 0){e?.(Dr.SUBSCRIBED);return}else{const I=this.bindings.postgres_changes,U=(p=I?.length)!==null&&p!==void 0?p:0,R=[];for(let B=0;B<U;B++){const q=I[B],{filter:{event:N,schema:K,table:J,filter:D}}=q,W=S&&S[B];if(W&&W.event===N&&W.schema===K&&W.table===J&&W.filter===D)R.push(Object.assign(Object.assign({},q),{id:W.id}));else{this.unsubscribe(),this.state=Mt.errored,e?.(Dr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,e&&e(Dr.SUBSCRIBED);return}}).receive("error",S=>{this.state=Mt.errored,e?.(Dr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.(Dr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Mt.joined&&e===ki.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=m.body)===null||s===void 0?void 0:s.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,f;const m=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),m.receive("ok",()=>l("ok")),m.receive("error",()=>l("error")),m.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Mt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(gr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Js(this,gr.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Mt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,l=setTimeout(()=>s.abort(),n),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),u}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Js(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ih){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,l;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:m,join:_}=gr;if(n&&[h,f,m,_].indexOf(u)>=0&&n!==this._joinRef())return;let S=this._onMessage(u,t,n);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var I,U,R;return((I=p.filter)===null||I===void 0?void 0:I.event)==="*"||((R=(U=p.filter)===null||U===void 0?void 0:U.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===u}).map(p=>p.callback(S,n)):(l=this.bindings[u])===null||l===void 0||l.filter(p=>{var I,U,R,B,q,N;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const K=p.id,J=(I=p.filter)===null||I===void 0?void 0:I.event;return K&&((U=t.ids)===null||U===void 0?void 0:U.includes(K))&&(J==="*"||J?.toLocaleLowerCase()===((R=t.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const K=(q=(B=p?.filter)===null||B===void 0?void 0:B.event)===null||q===void 0?void 0:q.toLocaleLowerCase();return K==="*"||K===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof S=="object"&&"ids"in S){const I=S.data,{schema:U,table:R,commit_timestamp:B,type:q,errors:N}=I;S=Object.assign(Object.assign({},{schema:U,table:R,commit_timestamp:B,eventType:q,new:{},old:{},errors:N}),this._getPayloadRecords(I))}p.callback(S,n)})}_isClosed(){return this.state===Mt.closed}_isJoined(){return this.state===Mt.joined}_isJoining(){return this.state===Mt.joining}_isLeaving(){return this.state===Mt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&qa.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(gr.close,{},e)}_onError(e){this._on(gr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Mt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=dl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=dl(e.columns,e.old_record)),t}}const vl=()=>{},ss={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hh=[1e3,2e3,5e3,1e4],fh=1e4,vh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ph{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pa,this.transport=null,this.heartbeatIntervalMs=ss.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vl,this.ref=0,this.reconnectTimer=null,this.logger=vl,this.conn=null,this.sendBuffer=[],this.serializer=new sh,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...u)=>ji(async()=>{const{default:h}=await Promise.resolve().then(()=>ai);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ga.websocket}`,this.httpEndpoint=Iu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Zd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:rh}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case wi.connecting:return pn.Connecting;case wi.open:return pn.Open;case wi.closing:return pn.Closing;default:return pn.Closed}}isConnected(){return this.connectionState()===pn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===n);if(s)return s;{const l=new qa(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:n,payload:s,ref:l}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${t} ${n} (${l})`,s),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(nh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ss.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:l,ref:u}=t,h=u?`(${u})`:"",f=l.status||"";this.log("receive",`${f} ${n} ${s} ${h}`.trim(),l),this.channels.filter(m=>m._isMember(n)).forEach(m=>m._trigger(s,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(gr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([vh],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:th};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(gr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new ku(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ss.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,l,u,h,f,m;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:pa,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:ss.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>hh[_-1]||fh),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((_,b)=>b(JSON.stringify(_))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Ha extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Lt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class gh extends Ha{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ma extends Ha{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var _h=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Su=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:n}=await Promise.resolve().then(()=>ai);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},mh=()=>_h(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ji(()=>Promise.resolve().then(()=>ai),void 0,import.meta.url)).Response:Response}),ya=r=>{if(Array.isArray(r))return r.map(t=>ya(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=ya(n)}),e},yh=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var Sn=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Xs=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),wh=(r,e,t)=>Sn(void 0,void 0,void 0,function*(){const n=yield mh();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{const l=r.status||500,u=s?.statusCode||l+"";e(new gh(Xs(s),l,u))}).catch(s=>{e(new ma(Xs(s),s))}):e(new ma(Xs(r),r))}),bh=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"||!n?s:(yh(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Ri(r,e,t,n,s,l){return Sn(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,bh(e,n,s,l)).then(f=>{if(!f.ok)throw f;return n?.noResolveJson?f:f.json()}).then(f=>u(f)).catch(f=>wh(f,h,n))})})}function _s(r,e,t,n){return Sn(this,void 0,void 0,function*(){return Ri(r,"GET",e,t,n)})}function Ir(r,e,t,n,s){return Sn(this,void 0,void 0,function*(){return Ri(r,"POST",e,n,s,t)})}function wa(r,e,t,n,s){return Sn(this,void 0,void 0,function*(){return Ri(r,"PUT",e,n,s,t)})}function kh(r,e,t,n){return Sn(this,void 0,void 0,function*(){return Ri(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function Au(r,e,t,n,s){return Sn(this,void 0,void 0,function*(){return Ri(r,"DELETE",e,n,s,t)})}var Yt=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Eh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},pl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ih{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Su(s)}uploadOrUpdate(e,t,n,s){return Yt(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},pl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f))):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const m=this._removeEmptyFolders(t),_=this._getFinalPath(m),b=yield(e=="PUT"?wa:Ir)(this.fetch,`${this.url}/object/${_}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:m,id:b.Id,fullPath:b.Key},error:null}}catch(l){if(Lt(l))return{data:null,error:l};throw l}})}upload(e,t,n){return Yt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return Yt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let f;const m=Object.assign({upsert:pl.upsert},s),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&n instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",n)):typeof FormData<"u"&&n instanceof FormData?(f=n,f.append("cacheControl",m.cacheControl)):(f=n,_["cache-control"]=`max-age=${m.cacheControl}`,_["content-type"]=m.contentType);const b=yield wa(this.fetch,h.toString(),f,{headers:_});return{data:{path:l,fullPath:b.Key},error:null}}catch(f){if(Lt(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return Yt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield Ir(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new Ha("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}})}update(e,t,n){return Yt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return Yt(this,void 0,void 0,function*(){try{return{data:yield Ir(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}copy(e,t,n){return Yt(this,void 0,void 0,function*(){try{return{data:{path:(yield Ir(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return Yt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield Ir(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const u=n?.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return Yt(this,void 0,void 0,function*(){try{const s=yield Ir(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}download(e,t){return Yt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield _s(this.fetch,`${this.url}/${s}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Lt(h))return{data:null,error:h};throw h}})}info(e){return Yt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield _s(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ya(n),error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}})}exists(e){return Yt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield kh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Lt(n)&&n instanceof ma){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&s.push(f);let m=s.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${m}`)}}}remove(e){return Yt(this,void 0,void 0,function*(){try{return{data:yield Au(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}list(e,t,n){return Yt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Eh),t),{prefix:e||""});return{data:yield Ir(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(Lt(s))return{data:null,error:s};throw s}})}listV2(e,t){return Yt(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Ir(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Sh="2.11.0",Ah={"X-Client-Info":`storage-js/${Sh}`};var Dn=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class Ch{constructor(e,t={},n,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Ah),t),this.fetch=Su(n)}listBuckets(){return Dn(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Lt(e))return{data:null,error:e};throw e}})}getBucket(e){return Dn(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Dn(this,void 0,void 0,function*(){try{return{data:yield Ir(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Dn(this,void 0,void 0,function*(){try{return{data:yield wa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Dn(this,void 0,void 0,function*(){try{return{data:yield Ir(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Dn(this,void 0,void 0,function*(){try{return{data:yield Au(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}})}}class Th extends Ch{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new Ih(this.url,this.headers,e,this.fetch)}}const xh="2.56.0";let mi="";typeof Deno<"u"?mi="deno":typeof document<"u"?mi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?mi="react-native":mi="node";const Ph={"X-Client-Info":`supabase-js-${mi}/${xh}`},jh={headers:Ph},Rh={schema:"public"},Oh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mh={};var Lh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};const Dh=r=>{let e;return r?e=r:typeof fetch>"u"?e=gu:e=fetch,(...t)=>e(...t)},$h=()=>typeof Headers>"u"?_u:Headers,Fh=(r,e,t)=>{const n=Dh(t),s=$h();return(l,u)=>Lh(void 0,void 0,void 0,function*(){var h;const f=(h=yield e())!==null&&h!==void 0?h:r;let m=new s(u?.headers);return m.has("apikey")||m.set("apikey",r),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),n(l,Object.assign(Object.assign({},u),{headers:m}))})};var Uh=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};function Nh(r){return r.endsWith("/")?r:r+"/"}function Bh(r,e){var t,n;const{db:s,auth:l,realtime:u,global:h}=r,{db:f,auth:m,realtime:_,global:b}=e,S={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},m),l),realtime:Object.assign(Object.assign({},_),u),storage:{},global:Object.assign(Object.assign(Object.assign({},b),h),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Uh(this,void 0,void 0,function*(){return""})};return r.accessToken?S.accessToken=r.accessToken:delete S.accessToken,S}const Cu="2.71.1",Wn=30*1e3,ba=3,Qs=ba*Wn,Wh="http://localhost:9999",Vh="supabase.auth.token",qh={"X-Client-Info":`gotrue-js/${Cu}`},ka="X-Supabase-Api-Version",Tu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Hh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,zh=600*1e3;class za extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function We(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Gh extends za{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Kh(r){return We(r)&&r.name==="AuthApiError"}class xu extends za{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tn extends za{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Hr extends tn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Yh(r){return We(r)&&r.name==="AuthSessionMissingError"}class as extends tn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class os extends tn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ls extends tn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Jh(r){return We(r)&&r.name==="AuthImplicitGrantRedirectError"}class gl extends tn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ea extends tn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Zs(r){return We(r)&&r.name==="AuthRetryableFetchError"}class _l extends tn{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Ia extends tn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ml=` 	
\r=`.split(""),Xh=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<ml.length;e+=1)r[ml[e].charCodeAt(0)]=-2;for(let e=0;e<ms.length;e+=1)r[ms[e].charCodeAt(0)]=e;return r})();function yl(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(ms[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(ms[n]),e.queuedBits-=6}}function Pu(r,e,t){const n=Xh[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function wl(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=u=>{ef(u,n,t)};for(let u=0;u<r.length;u+=1)Pu(r.charCodeAt(u),s,l);return e.join("")}function Qh(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Zh(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Qh(n,e)}}function ef(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function tf(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)Pu(r.charCodeAt(s),t,n);return new Uint8Array(e)}function rf(r){const e=[];return Zh(r,t=>e.push(t)),new Uint8Array(e)}function nf(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>yl(s,t,n)),yl(null,t,n),e.join("")}function sf(r){return Math.round(Date.now()/1e3)+r}function af(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const vr=()=>typeof window<"u"&&typeof document<"u",un={tested:!1,writable:!1},ju=()=>{if(!vr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(un.tested)return un.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),un.tested=!0,un.writable=!0}catch{un.tested=!0,un.writable=!1}return un.writable};function of(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const Ru=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ji(async()=>{const{default:n}=await Promise.resolve().then(()=>ai);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},lf=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Vn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},cn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},qr=async(r,e)=>{await r.removeItem(e)};class Cs{constructor(){this.promise=new Cs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Cs.promiseConstructor=Promise;function ea(r){const e=r.split(".");if(e.length!==3)throw new Ia("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Hh.test(e[n]))throw new Ia("JWT not in base64url format");return{header:JSON.parse(wl(e[0])),payload:JSON.parse(wl(e[1])),signature:tf(e[2]),raw:{header:e[0],payload:e[1]}}}async function uf(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function cf(r,e){return new Promise((n,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await r(l);if(!e(l,null,u)){n(u);return}}catch(u){if(!e(l,u)){s(u);return}}})()})}function df(r){return("0"+r.toString(16)).substr(-2)}function hf(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,df).join("")}async function ff(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function vf(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await ff(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function $n(r,e,t=!1){const n=hf();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await Vn(r,`${e}-code-verifier`,s);const l=await vf(n);return[l,n===l?"plain":"s256"]}const pf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gf(r){const e=r.headers.get(ka);if(!e||!e.match(pf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function _f(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function mf(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const yf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Fn(r){if(!yf.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ta(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bl(r){return JSON.parse(JSON.stringify(r))}var wf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const fn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),bf=[502,503,504];async function kl(r){var e;if(!lf(r))throw new Ea(fn(r),0);if(bf.includes(r.status))throw new Ea(fn(r),r.status);let t;try{t=await r.json()}catch(l){throw new xu(fn(l),l)}let n;const s=gf(r);if(s&&s.getTime()>=Tu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new _l(fn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Hr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new _l(fn(t),r.status,t.weak_password.reasons);throw new Gh(fn(t),r.status||500,n)}const kf=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function Ze(r,e,t,n){var s;const l=Object.assign({},n?.headers);l[ka]||(l[ka]=Tu["2024-01-01"].name),n?.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const u=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(u.redirect_to=n.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await Ef(r,e,t+h,{headers:l,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(f):{data:Object.assign({},f),error:null}}async function Ef(r,e,t,n,s,l){const u=kf(e,n,s,l);let h;try{h=await r(t,Object.assign({},u))}catch(f){throw console.error(f),new Ea(fn(f),0)}if(h.ok||await kl(h),n?.noResolveJson)return h;try{return await h.json()}catch(f){await kl(f)}}function Lr(r){var e;let t=null;Cf(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=sf(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function El(r){const e=Lr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Gr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function If(r){return{data:r,error:null}}function Sf(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l}=r,u=wf(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:l},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function Af(r){return r}function Cf(r){return r.access_token&&r.refresh_token&&r.expires_in}const ra=["global","local","others"];var Tf=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class xf{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Ru(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ra[0]){if(ra.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ra.join(", ")}`);try{return await Ze(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(We(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Ze(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Gr})}catch(n){if(We(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Tf(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await Ze(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Sf,redirectTo:t?.redirectTo})}catch(t){if(We(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ze(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Gr})}catch(t){if(We(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,l,u,h,f;try{const m={nextPage:null,lastPage:0,total:0},_=await Ze(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:Af});if(_.error)throw _.error;const b=await _.json(),S=(u=_.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(f=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return p.length>0&&(p.forEach(I=>{const U=parseInt(I.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(I.split(";")[1].split("=")[1]);m[`${R}Page`]=U}),m.total=parseInt(S)),{data:Object.assign(Object.assign({},b),m),error:null}}catch(m){if(We(m))return{data:{users:[]},error:m};throw m}}async getUserById(e){Fn(e);try{return await Ze(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Gr})}catch(t){if(We(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Fn(e);try{return await Ze(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Gr})}catch(n){if(We(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Fn(e);try{return await Ze(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Gr})}catch(n){if(We(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Fn(e.userId);try{const{data:t,error:n}=await Ze(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(We(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Fn(e.userId),Fn(e.id);try{return{data:await Ze(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(We(t))return{data:null,error:t};throw t}}}function Il(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Pf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Un={debug:!!(globalThis&&ju()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ou extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class jf extends Ou{}async function Rf(r,e,t){Un.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Un.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Un.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Un.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Un.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new jf(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Un.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Pf();const Of={url:Wh,storageKey:Vh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Sl(r,e,t){return await t()}const Nn={};class Ai{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ai.nextInstanceID,Ai.nextInstanceID+=1,this.instanceID>0&&vr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Of),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new xf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ru(s.fetch),this.lock=s.lock||Sl,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:vr()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Rf:this.lock=Sl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:ju()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Il(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Il(this.memoryStorage)),vr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Nn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Nn[this.storageKey]=Object.assign(Object.assign({},Nn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Nn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Nn[this.storageKey]=Object.assign(Object.assign({},Nn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Cu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=of(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),vr()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Jh(l)){const f=(e=l.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return We(t)?{error:t}:{error:new xu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const l=await Ze(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Lr}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(We(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,n,s;try{let l;if("email"in e){const{email:_,password:b,options:S}=e;let p=null,I=null;this.flowType==="pkce"&&([p,I]=await $n(this.storage,this.storageKey)),l=await Ze(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:_,password:b,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:p,code_challenge_method:I},xform:Lr})}else if("phone"in e){const{phone:_,password:b,options:S}=e;l=await Ze(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:b,data:(n=S?.data)!==null&&n!==void 0?n:{},channel:(s=S?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Lr})}else throw new os("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,m=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(l){if(We(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await Ze(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:El})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await Ze(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:El})}else throw new os("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new as}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(We(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,l,u,h,f,m,_,b,S,p;let I,U;if("message"in e)I=e.message,U=e.signature;else{const{chain:R,wallet:B,statement:q,options:N}=e;let K;if(vr())if(typeof B=="object")K=B;else{const D=window;if("solana"in D&&typeof D.solana=="object"&&("signIn"in D.solana&&typeof D.solana.signIn=="function"||"signMessage"in D.solana&&typeof D.solana.signMessage=="function"))K=D.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof B!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=B}const J=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in K&&K.signIn){const D=await K.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:J.host,uri:J.href}),q?{statement:q}:null));let W;if(Array.isArray(D)&&D[0]&&typeof D[0]=="object")W=D[0];else if(D&&typeof D=="object"&&"signedMessage"in D&&"signature"in D)W=D;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in W&&"signature"in W&&(typeof W.signedMessage=="string"||W.signedMessage instanceof Uint8Array)&&W.signature instanceof Uint8Array)I=typeof W.signedMessage=="string"?W.signedMessage:new TextDecoder().decode(W.signedMessage),U=W.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in K)||typeof K.signMessage!="function"||!("publicKey"in K)||typeof K!="object"||!K.publicKey||!("toBase58"in K.publicKey)||typeof K.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");I=[`${J.host} wants you to sign in with your Solana account:`,K.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${J.href}`,`Issued At: ${(s=(n=N?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=N?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((u=N?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((f=N?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((m=N?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((b=(_=N?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||b===void 0)&&b.length?["Resources",...N.signInWithSolana.resources.map(W=>`- ${W}`)]:[]].join(`
`);const D=await K.signMessage(new TextEncoder().encode(I),"utf8");if(!D||!(D instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");U=D}}try{const{data:R,error:B}=await Ze(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:I,signature:nf(U)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Lr});if(B)throw B;return!R||!R.session||!R.user?{data:{user:null,session:null},error:new as}:(R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),{data:Object.assign({},R),error:B})}catch(R){if(We(R))return{data:{user:null,session:null},error:R};throw R}}async _exchangeCodeForSession(e){const t=await cn(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:l,error:u}=await Ze(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Lr});if(await qr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new as}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:u})}catch(l){if(We(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:l,nonce:u}=e,h=await Ze(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Lr}),{data:f,error:m}=h;return m?{data:{user:null,session:null},error:m}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new as}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:m})}catch(t){if(We(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,l,u;try{if("email"in e){const{email:h,options:f}=e;let m=null,_=null;this.flowType==="pkce"&&([m,_]=await $n(this.storage,this.storageKey));const{error:b}=await Ze(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(n=f?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:_},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:h,options:f}=e,{data:m,error:_}=await Ze(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:m?.message_id},error:_}}throw new os("You must provide either an email or phone number.")}catch(h){if(We(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:u,error:h}=await Ze(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Lr});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,m=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:m,session:f},error:null}}catch(s){if(We(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await $n(this.storage,this.storageKey)),await Ze(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:If})}catch(l){if(We(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Hr;const{error:s}=await Ze(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(We(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:l}=e,{error:u}=await Ze(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:n,type:s,options:l}=e,{data:u,error:h}=await Ze(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new os("You must provide either an email or phone number and a type")}catch(t){if(We(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await cn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Qs:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const u=await cn(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ta()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,m,_)=>(!u&&m==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,m,_))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ze(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Gr}):await this._useSession(async t=>{var n,s,l;const{data:u,error:h}=t;if(h)throw h;return!(!((n=u.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Hr}:await Ze(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:Gr})})}catch(t){if(We(t))return Yh(t)&&(await this._removeSession(),await qr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:l}=n;if(l)throw l;if(!s.session)throw new Hr;const u=s.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await $n(this.storage,this.storageKey));const{data:m,error:_}=await Ze(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:Gr});if(_)throw _;return u.user=m.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(n){if(We(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Hr;const t=Date.now()/1e3;let n=t,s=!0,l=null;const{payload:u}=ea(e.access_token);if(u.exp&&(n=u.exp,s=n<=t),s){const{session:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)throw f;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(We(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(n=u.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Hr;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(We(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!vr())throw new ls("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ls(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new gl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ls("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new gl("No code detected.");const{data:q,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:l,refresh_token:u,expires_in:h,expires_at:f,token_type:m}=e;if(!l||!h||!u||!m)throw new ls("No session defined in URL");const _=Math.round(Date.now()/1e3),b=parseInt(h);let S=_+b;f&&(S=parseInt(f));const p=S-_;p*1e3<=Wn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${b}s`);const I=S-b;_-I>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",I,S,_):_-I<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",I,S,_);const{data:U,error:R}=await this._getUser(l);if(R)throw R;const B={provider_token:n,provider_refresh_token:s,access_token:l,expires_in:b,expires_at:S,refresh_token:u,token_type:m,user:U.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:B,redirectType:e.type},error:null}}catch(n){if(We(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await cn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{error:l};const u=(n=s.session)===null||n===void 0?void 0:n.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Kh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await qr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=af(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:l},error:u}=t;if(u)throw u;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await $n(this.storage,this.storageKey,!0));try{return await Ze(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(We(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(We(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async l=>{var u,h,f,m,_;const{data:b,error:S}=l;if(S)throw S;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await Ze(this.fetch,"GET",p,{headers:this.headers,jwt:(_=(m=b.session)===null||m===void 0?void 0:m.access_token)!==null&&_!==void 0?_:void 0})});if(s)throw s;return vr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(We(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:u}=t;if(u)throw u;return await Ze(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(We(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await cf(async s=>(s>0&&await uf(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Ze(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Lr})),(s,l)=>{const u=200*Math.pow(2,s);return l&&Zs(l)&&Date.now()+u-n<Wn})}catch(n){if(this._debug(t,"error",n),We(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),vr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await cn(this.storage,this.storageKey);if(s&&this.userStorage){let u=await cn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:s.user},await Vn(this.userStorage,this.storageKey+"-user",u)),s.user=(e=u?.user)!==null&&e!==void 0?e:ta()}else if(s&&!s.user&&!s.user){const u=await cn(this.storage,this.storageKey+"-user");u&&u?.user?(s.user=u.user,await qr(this.storage,this.storageKey+"-user"),await Vn(this.storage,this.storageKey,s)):s.user=ta()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qs;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${Qs}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:u}=await this._callRefreshToken(s.refresh_token);u&&(console.error(u),Zs(u)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(s.access_token);!h&&u?.user?(s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(n,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Hr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Cs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new Hr;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),We(l)){const u={session:null,error:l};return Zs(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(f){l.push(f)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Vn(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=bl(s);await Vn(this.storage,this.storageKey,l)}else{const s=bl(t);await Vn(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await qr(this.storage,this.storageKey),await qr(this.storage,this.storageKey+"-code-verifier"),await qr(this.storage,this.storageKey+"-user"),this.userStorage&&await qr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Wn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Wn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Wn}ms, refresh threshold is ${ba} ticks`),s<=ba&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ou)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!vr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,u]=await $n(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});s.push(h.toString())}if(n?.queryParams){const l=new URLSearchParams(n.queryParams);s.push(l.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await Ze(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(We(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:m}=await Ze(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=l?.session)===null||n===void 0?void 0:n.access_token});return m?{data:null,error:m}:(e.factorType==="totp"&&(!((s=f?.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(We(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await Ze(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(We(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:l}=t;return l?{data:null,error:l}:await Ze(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(We(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],s=n.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=n.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:n,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ea(s.access_token);let h=null;u.aal&&(h=u.aal);let f=h;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(f="aal2");const _=u.amr||[];return{data:{currentLevel:h,nextLevel:f,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+zh>s)return n;const{data:l,error:u}=await Ze(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,n=l.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:I}=await this.getSession();if(I||!p.session)return{data:null,error:I};n=p.session.access_token}const{header:s,payload:l,signature:u,raw:{header:h,payload:f}}=ea(n);t?.allowExpired||_f(l.exp);const m=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!m){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:l,header:s,signature:u},error:null}}const _=mf(s.alg),b=await crypto.subtle.importKey("jwk",m,_,!0,["verify"]);if(!await crypto.subtle.verify(_,b,u,rf(`${h}.${f}`)))throw new Ia("Invalid JWT signature");return{data:{claims:l,header:s,signature:u},error:null}}catch(n){if(We(n))return{data:null,error:n};throw n}}}Ai.nextInstanceID=0;const Mf=Ai;class Lf extends Mf{constructor(e){super(e)}}var Df=function(r,e,t,n){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(_){try{m(n.next(_))}catch(b){u(b)}}function f(_){try{m(n.throw(_))}catch(b){u(b)}}function m(_){_.done?l(_.value):s(_.value).then(h,f)}m((n=n.apply(r,e||[])).next())})};class $f{constructor(e,t,n){var s,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Nh(e),f=new URL(h);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const m=`sb-${f.hostname.split(".")[0]}-auth-token`,_={db:Rh,realtime:Mh,auth:Object.assign(Object.assign({},Oh),{storageKey:m}),global:jh},b=Bh(n??{},_);this.storageKey=(s=b.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=b.global.headers)!==null&&l!==void 0?l:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(S,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=b.auth)!==null&&u!==void 0?u:{},this.headers,b.global.fetch),this.fetch=Fh(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new Qd(new URL("rest/v1",f).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new Th(this.storageUrl.href,this.headers,this.fetch,n?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Nd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Df(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:l,flowType:u,lock:h,debug:f},m,_){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Lf({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:u,lock:h,debug:f,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ph(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ff=(r,e,t)=>new $f(r,e,t);function Uf(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Uf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Nf="https://vycjpmuyscfygstjjied.supabase.co",Bf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Sr=Ff(Nf,Bf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Xr={async loadStoriesList(){if(!M.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${M.selectedBucket}`);const r=`${M.selectedBucket}_story.json`,{data:e,error:t}=await Sr.storage.from(M.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(M.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(M.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!M.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await Sr.storage.from(M.selectedBucket).list();r&&(M.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!M.selectedBucket){pt.setStatus("error","Не выбрана история");return}const t=e.files[0];pt.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),s=new Uint8Array(n),{error:l}=await Sr.storage.from(M.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?pt.setStatus("error","Ошибка загрузки"):(pt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!M.selectedBucket){pt.setStatus("error","Не выбрана история");return}const{error:e}=await Sr.storage.from(M.selectedBucket).remove([r]);e?pt.setStatus("error","Ошибка удаления файла"):(pt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Wf(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function Vf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const gn={async createNewStory(){if(!M.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await Sr.storage.from(M.selectedBucket).upload(r,s,{contentType:"application/json"});l?pt.setStatus("error","Ошибка создания: "+l.message):(await Xr.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!M.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${M.selectedBucket}`),pt.setStatus("loading","Загрузка..."),M.currentFileName=r;try{const{data:e,error:t}=await Sr.storage.from(M.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Sr.storage.from(M.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);n=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let s=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Wf(s),console.log("[StoryStore] Присваиваем данные в editor.data"),M.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:M.data.chapters?.length,dialogues:M.data.dialogues?.length}),M.data.chapters&&M.data.chapters.length>0&&(M.selectedChapterId=M.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${M.selectedChapterId}`)),M.data.dialogues&&M.data.dialogues.length>0&&(M.selectedDialogueId=M.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${M.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),pt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),pt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!M.data)return;if(!M.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}pt.setStatus("loading","Сохранение...");const r=JSON.stringify(M.data,null,2);console.log(`[StoryStore] Сохранение файла: ${M.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await Sr.storage.from(M.selectedBucket).update(M.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const s=await Sr.storage.from(M.selectedBucket).upload(M.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),pt.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),pt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),pt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!M.data)return;if(!M.selectedBucket){pt.setStatus("error","Не выбрана история (bucket)");return}const r=M.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),pt.setStatus("loading","Создание копии...");const s=JSON.stringify(M.data,null,2),u=new TextEncoder().encode(s),{error:h}=await Sr.storage.from(M.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?pt.setStatus("error",`Ошибка копии: ${h.message}`):(await Xr.loadStoriesList(),pt.setStatus("success","Копия сохранена!"))},addChapter(){if(!M.data||!M.data.chapters)return;const r="ch_"+Date.now();M.data.chapters.push({id:r,title:"Новая глава",description:""}),M.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!M.data||!M.selectedChapterId)return;const r="d_"+Date.now();M.data.dialogues.push({id:r,chapterId:M.selectedChapterId,text:"Новый текст...",options:[]}),M.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&M.data&&(M.data.dialogues=M.data.dialogues.filter(e=>e.id!==r),M.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),M.selectedDialogueId===r&&(M.selectedDialogueId=null))},jumpTo(r){const e=M.data?.dialogues.find(t=>t.id===r);e&&(M.selectedChapterId=e.chapterId,M.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var Qt=en(()=>Nt);function qf(){pt.selectEditingChapter(null)}var Hf=te('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function zf(r,e){Wt(e,!1);function t(){Qt().currentEditingChapter&&(pt.updateChapter(Qt().currentEditingChapter.id,{title:Qt().currentEditingChapter.title,description:Qt().currentEditingChapter.description}),pt.selectEditingChapter(null))}function n(){Qt().currentEditingChapter&&confirm(`Удалить главу "${Qt().currentEditingChapter.title}"?`)&&(pt.deleteChapter(Qt().currentEditingChapter.id),pt.selectEditingChapter(null))}Zr();var s=Gt(),l=jt(s);{var u=h=>{var f=Hf(),m=C(f),_=L(C(m),2),b=C(_);b.__click=n;var S=L(m,2),p=L(C(S),2),I=L(S,2),U=L(C(I),2),R=L(I,2),B=C(R);B.__click=[qf];var q=L(B,2);q.__click=t,$r(p,()=>Qt().currentEditingChapter.title,N=>Qt(Qt().currentEditingChapter.title=N)),$r(U,()=>Qt().currentEditingChapter.description,N=>Qt(Qt().currentEditingChapter.description=N)),G(h,f)};je(l,h=>{Qt().currentEditingChapter&&h(u)})}G(r,s),Vt()}Xt(["click"]);var Zt=en(()=>M),Gf=(r,e,t)=>e(w(t).id),Kf=te('<div class="chapter-form-container svelte-xp6igx"><!></div>'),Yf=te('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),Jf=te('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),Xf=te("<div> </div>"),Qf=te('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function Zf(r,e){Wt(e,!1);function t(B){pt.selectEditingChapter(B)}Zr();var n=Qf(),s=C(n),l=C(s),u=L(C(l),2);u.__click=function(...B){gn.addChapter?.apply(this,B)};var h=L(l,2);wt(h,5,()=>Zt().data?.chapters||[],B=>B.id,(B,q)=>{var N=Yf(),K=jt(N),J=C(K);let D;J.__click=()=>Zt(Zt().selectedChapterId=w(q).id);var W=C(J),ae=C(W),Q=L(J,2);Q.__click=[Gf,t,q];var we=L(K,2);{var Z=ee=>{var Se=Kf(),Me=C(Se);zf(Me,{}),G(ee,Se)};je(we,ee=>{Zt().editingChapterId===w(q).id&&ee(Z)})}Ie(ee=>{D=Kt(J,1,"chapter-item svelte-xp6igx",null,D,ee),Oe(J,"aria-pressed",Zt().selectedChapterId===w(q).id),Oe(J,"title",w(q).description||"Без описания"),Ae(ae,w(q).title)},[()=>({active:Zt().selectedChapterId===w(q).id})]),G(B,N)});var f=L(s,2),m=C(f),_=C(m),b=C(_),S=L(_,2);S.__click=function(...B){gn.addDialogue?.apply(this,B)};var p=L(m,2);wt(p,5,()=>Nt.chapterDialogues,B=>B.id,(B,q)=>{var N=Jf();let K;N.__click=()=>Zt(Zt().selectedDialogueId=w(q).id);var J=C(N),D=C(J),W=L(J,2),ae=C(W);Ie((Q,we)=>{K=Kt(N,1,"dialogue-item svelte-xp6igx",null,K,Q),Oe(N,"aria-pressed",Zt().selectedDialogueId===w(q).id),Ae(D,w(q).id),Ae(ae,`${we??""}...`)},[()=>({active:Zt().selectedDialogueId===w(q).id}),()=>w(q).text.substring(0,25)]),G(B,N)});var I=L(f,2),U=C(I);{var R=B=>{var q=Xf(),N=C(q);Ie(()=>{Kt(q,1,`alert ${Zt().statusMessage.type??""}`,"svelte-xp6igx"),Ae(N,Zt().statusMessage.text)}),G(B,q)};je(U,B=>{Zt().statusMessage.text&&B(R)})}Ie(()=>{Ae(b,`Сцены (${Nt.chapterDialogues.length??""})`),S.disabled=!Zt().selectedChapterId}),G(r,n),Vt()}Xt(["click"]);var ev=te("<option> </option>"),tv=(r,e)=>e(r.target.checked),rv=(r,e)=>e("id",r.target.value),nv=(r,e)=>e("onWinDialogueId",r.target.value),iv=te("<option> </option>"),sv=(r,e)=>e("onLoseDialogueId",r.target.value),av=te("<option> </option>"),ov=(r,e)=>e("rewardItem",r.target.value),lv=te("<option> </option>"),uv=te('<div class="minigame-details svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option></select></div> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-92kmf5"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-92kmf5"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),cv=(r,e)=>{const t=r.target.value;e({type:t})},dv=te("<option> </option>"),hv=(r,e)=>e({itemId:r.target.value}),fv=te("<option> </option>"),vv=te('<div class="form-group full-width svelte-92kmf5"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),pv=(r,e)=>e({statName:r.target.value}),gv=(r,e)=>e({statValue:parseInt(r.target.value)||0}),_v=te('<div class="form-group svelte-92kmf5"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-92kmf5"><label>Значение ></label> <input type="number" class="input"/></div>',1),mv=(r,e)=>e({flagName:r.target.value}),yv=te('<div class="form-group full-width svelte-92kmf5"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),wv=te('<div class="option-details svelte-92kmf5"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-92kmf5"><div class="section-header svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-92kmf5"><div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-92kmf5">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-92kmf5">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-92kmf5"><h5 class="svelte-92kmf5">Условие видимости</h5> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function bv(r,e){Wt(e,!0);const t=_r(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return n(),t().visibilityCondition}function l(_e){n(),t().visibilityCondition={...t().visibilityCondition,..._e}}const u=Cr(()=>!!t().miniGame);function h(_e){_e?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function f(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function m(_e,me){const ue=f();ue&&(ue[_e]=me)}var _=wv(),b=C(_),S=C(b),p=L(S,2),I=L(b,2),U=C(I),R=L(U,2),B=C(R);B.value=B.__value="";var q=L(B);wt(q,17,()=>e.dialogues,_e=>_e.id,(_e,me)=>{var ue=ev(),oe=C(ue),xe={};Ie(Re=>{Ae(oe,`${w(me).id??""}: ${Re??""}...`),xe!==(xe=w(me).id)&&(ue.value=(ue.__value=w(me).id)??"")},[()=>w(me).text.substring(0,30)]),G(_e,ue)});var N=L(I,2),K=C(N),J=C(K),D=C(J);D.__change=[tv,h];var W=L(K,2);{var ae=_e=>{var me=uv(),ue=C(me),oe=C(ue),xe=L(oe,2);xe.__change=[rv,m];var Re=C(xe);Re.value=Re.__value="";var Je=L(Re);Je.value=Je.__value="onet_monsters";var Ke=L(Je);Ke.value=Ke.__value="memo_monsters";var ie;hn(xe);var fe=L(ue,2),Ce=C(fe),Xe=C(Ce),it=L(Xe,2);it.__change=[nv,m];var Tt=C(it);Tt.value=Tt.__value="";var xt=L(Tt);wt(xt,17,()=>e.dialogues,ce=>ce.id,(ce,ve)=>{var $e=iv(),ht=C($e),De={};Ie(mt=>{Ae(ht,`${w(ve).id??""}: ${mt??""}...`),De!==(De=w(ve).id)&&($e.value=($e.__value=w(ve).id)??"")},[()=>w(ve).text.substring(0,30)]),G(ce,$e)});var Qe;hn(it);var g=L(Ce,2),o=C(g),d=L(o,2);d.__change=[sv,m];var k=C(d);k.value=k.__value="";var P=L(k);wt(P,17,()=>e.dialogues,ce=>ce.id,(ce,ve)=>{var $e=av(),ht=C($e),De={};Ie(mt=>{Ae(ht,`${w(ve).id??""}: ${mt??""}...`),De!==(De=w(ve).id)&&($e.value=($e.__value=w(ve).id)??"")},[()=>w(ve).text.substring(0,30)]),G(ce,$e)});var A;hn(d);var T=L(fe,2),F=C(T),H=L(F,2);H.__change=[ov,m];var z=C(H);z.value=z.__value="";var le=L(z);wt(le,17,()=>e.availableItems,ce=>ce.id,(ce,ve)=>{var $e=lv(),ht=C($e),De={};Ie(()=>{Ae(ht,w(ve).name),De!==(De=w(ve).id)&&($e.value=($e.__value=w(ve).id)??"")}),G(ce,$e)});var de;hn(H),Ie((ce,ve,$e,ht)=>{Oe(oe,"for",`option-mg-id-${e.index??""}`),Oe(xe,"id",`option-mg-id-${e.index??""}`),ie!==(ie=ce)&&(xe.value=(xe.__value=ce)??"",zr(xe,ce)),Oe(Xe,"for",`option-mg-win-${e.index??""}`),Oe(it,"id",`option-mg-win-${e.index??""}`),Qe!==(Qe=ve)&&(it.value=(it.__value=ve)??"",zr(it,ve)),Oe(o,"for",`option-mg-lose-${e.index??""}`),Oe(d,"id",`option-mg-lose-${e.index??""}`),A!==(A=$e)&&(d.value=(d.__value=$e)??"",zr(d,$e)),Oe(F,"for",`option-mg-reward-${e.index??""}`),Oe(H,"id",`option-mg-reward-${e.index??""}`),de!==(de=ht)&&(H.value=(H.__value=ht)??"",zr(H,ht))},[()=>f().id,()=>f().onWinDialogueId,()=>f().onLoseDialogueId,()=>f().rewardItem||""]),G(_e,me)};je(W,_e=>{f()&&_e(ae)})}var Q=L(N,2),we=C(Q),Z=C(we),ee=C(Z),Se=L(we,2),Me=C(Se),ge=C(Me),Te=L(Q,2),be=L(C(Te),2),ft=C(be),Ge=C(ft),Fe=L(Ge,2);Fe.__change=[cv,l],wt(Fe,20,()=>e.conditionTypes,_e=>_e,(_e,me)=>{var ue=dv(),oe=C(ue),xe={};Ie(()=>{Ae(oe,me),xe!==(xe=me)&&(ue.value=(ue.__value=me)??"")}),G(_e,ue)});var rt;hn(Fe);var lt=L(ft,2);{var Le=_e=>{var me=vv(),ue=C(me),oe=L(ue,2);oe.__change=[hv,l];var xe=C(oe);xe.value=xe.__value="";var Re=L(xe);wt(Re,17,()=>e.availableItems,Ke=>Ke.id,(Ke,ie)=>{var fe=fv(),Ce=C(fe),Xe={};Ie(()=>{Ae(Ce,w(ie).name),Xe!==(Xe=w(ie).id)&&(fe.value=(fe.__value=w(ie).id)??"")}),G(Ke,fe)});var Je;hn(oe),Ie(Ke=>{Oe(ue,"for",`option-cond-item-${e.index??""}`),Oe(oe,"id",`option-cond-item-${e.index??""}`),Je!==(Je=Ke)&&(oe.value=(oe.__value=Ke)??"",zr(oe,Ke))},[()=>s().itemId||""]),G(_e,me)};je(lt,_e=>{s().type==="has_item"&&_e(Le)})}var Ue=L(lt,2);{var _t=_e=>{var me=_v(),ue=jt(me),oe=C(ue),xe=L(oe,2);xe.__input=[pv,l];var Re=L(ue,2),Je=C(Re),Ke=L(Je,2);Ke.__input=[gv,l],Ie((ie,fe)=>{Oe(oe,"for",`option-cond-stat-${e.index??""}`),Oe(xe,"id",`option-cond-stat-${e.index??""}`),Gs(xe,ie),Oe(Je,"for",`option-cond-stat-val-${e.index??""}`),Oe(Ke,"id",`option-cond-stat-val-${e.index??""}`),Gs(Ke,fe)},[()=>s().statName||"",()=>s().statValue||""]),G(_e,me)};je(Ue,_e=>{s().type==="stat_greater"&&_e(_t)})}var Ve=L(Ue,2);{var It=_e=>{var me=yv(),ue=C(me),oe=L(ue,2);oe.__input=[mv,l],Ie(xe=>{Oe(ue,"for",`option-cond-flag-${e.index??""}`),Oe(oe,"id",`option-cond-flag-${e.index??""}`),Gs(oe,xe)},[()=>s().flagName||""]),G(_e,me)};je(Ve,_e=>{s().type==="flag_true"&&_e(It)})}Ie(_e=>{Oe(S,"for",`option-text-${e.index??""}`),Oe(p,"id",`option-text-${e.index??""}`),Oe(U,"for",`option-next-${e.index??""}`),Oe(R,"id",`option-next-${e.index??""}`),xd(D,w(u)),Oe(Ge,"for",`option-cond-type-${e.index??""}`),Oe(Fe,"id",`option-cond-type-${e.index??""}`),rt!==(rt=_e)&&(Fe.value=(Fe.__value=_e)??"",zr(Fe,_e))},[()=>s().type]),$r(p,()=>t().text,_e=>t().text=_e),qn(R,()=>t().nextDialogueId,_e=>t().nextDialogueId=_e),Qo(ee,()=>t().enabled,_e=>t().enabled=_e),Qo(ge,()=>t().visible,_e=>t().visible=_e),G(r,_),Vt()}Xt(["change","input"]);var kt=en(()=>M),ct=en(()=>Nt),kv=te("<option> <!></option>"),Ev=te("<option> </option>"),Iv=te("<option> </option>"),Sv=te("<option> </option>"),Av=te("<option> </option>"),Cv=te('<div class="option-content svelte-1de8com"><!></div>'),Tv=te('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),xv=te("<option> </option>"),Pv=te('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-chapter" class="svelte-1de8com">Глава</label> <select id="dialogue-chapter" class="input select svelte-1de8com"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),jv=te('<div class="empty-state">Выберите сцену</div>');function Rv(r,e){Wt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(_){_.options||(_.options=[]);const b=Vf();_.options.push(b),kt(kt().editingOptionIndex=_.options.length-1)}function s(_){if(kt().editingOptionIndex===_)kt(kt().editingOptionIndex=null);else{kt(kt().editingOptionIndex=_);const b=ct().currentDialogue?.options?.[_];b&&!b.visibilityCondition&&(b.visibilityCondition={type:"always"})}}function l(_,b){confirm("Удалить вариант ответа?")&&(_.options?.splice(b,1),kt().editingOptionIndex===b?kt(kt().editingOptionIndex=null):kt().editingOptionIndex&&kt().editingOptionIndex>b&&kt(kt().editingOptionIndex--))}Zr();var u=Gt(),h=jt(u);{var f=_=>{var b=Pv(),S=C(b),p=L(C(S),2);p.__change=me=>kt(kt().selectedDialogueId=me.target?.value);var I=L(S,2),U=L(C(I),2);Ie(()=>{ct(),pr(()=>{kt()})}),U.__change=me=>kt(kt().selectedChapterId=me.target?.value);var R=C(U);R.value=R.__value="";var B=L(R);wt(B,1,()=>kt().data.chapters||[],nr,(me,ue)=>{var oe=kv(),xe=C(oe),Re=L(xe);{var Je=ie=>{var fe=rs();Ie(Ce=>Ae(fe,`- ${Ce??""}...`),[()=>w(ue).description.substring(0,30)]),G(ie,fe)};je(Re,ie=>{w(ue).description&&ie(Je)})}var Ke={};Ie(()=>{Ae(xe,`${w(ue).title??""} `),Ke!==(Ke=w(ue).id)&&(oe.value=(oe.__value=w(ue).id)??"")}),G(me,oe)});var q=L(I,2),N=L(C(q),2),K=L(q,2),J=L(C(K),2),D=L(C(J),2),W=C(D);Ie(()=>{ct(),pr(()=>{})});var ae=C(W);ae.value=ae.__value="";var Q=L(ae);wt(Q,1,()=>ct().imageResources,nr,(me,ue)=>{var oe=Ev(),xe=C(oe),Re={};Ie(()=>{Ae(xe,w(ue).name),Re!==(Re=w(ue).name)&&(oe.value=(oe.__value=w(ue).name)??"")}),G(me,oe)});var we=L(Q);wt(we,1,()=>ct().riveResources,nr,(me,ue)=>{var oe=Iv(),xe=C(oe),Re={};Ie(()=>{Ae(xe,`${w(ue).name??""} (Rive)`),Re!==(Re=w(ue).name)&&(oe.value=(oe.__value=w(ue).name)??"")}),G(me,oe)});var Z=L(W,2),ee=L(C(Z));ee.__change=function(...me){Xr.uploadNewFile?.apply(this,me)};var Se=L(J,2),Me=L(C(Se),2),ge=C(Me);Ie(()=>{ct(),pr(()=>{})});var Te=C(ge);Te.value=Te.__value="";var be=L(Te);wt(be,1,()=>ct().imageResources,nr,(me,ue)=>{var oe=Sv(),xe=C(oe),Re={};Ie(()=>{Ae(xe,w(ue).name),Re!==(Re=w(ue).name)&&(oe.value=(oe.__value=w(ue).name)??"")}),G(me,oe)});var ft=L(be);wt(ft,1,()=>ct().riveResources,nr,(me,ue)=>{var oe=Av(),xe=C(oe),Re={};Ie(()=>{Ae(xe,`${w(ue).name??""} (Rive)`),Re!==(Re=w(ue).name)&&(oe.value=(oe.__value=w(ue).name)??"")}),G(me,oe)});var Ge=L(K,2),Fe=C(Ge),rt=L(C(Fe),2);rt.__click=()=>n(ct().currentDialogue);var lt=L(Fe,2);wt(lt,1,()=>ct().currentDialogue.options||[],nr,(me,ue,oe)=>{var xe=Tv();let Re;var Je=C(xe),Ke=C(Je);Ke.__click=()=>s(oe),Ke.__keydown=o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s(oe))},Oe(Ke,"aria-controls",`option-content-${oe}`);var ie=C(Ke),fe=C(ie);{var Ce=o=>{var d=rs("👁️‍🗨️");G(o,d)},Xe=o=>{var d=Gt(),k=jt(d);{var P=T=>{var F=rs("🔒");G(T,F)},A=T=>{var F=rs("✅");G(T,F)};je(k,T=>{w(ue).enabled?T(A,!1):T(P)},!0)}G(o,d)};je(fe,o=>{w(ue).visible?o(Xe,!1):o(Ce)})}var it=L(ie,2),Tt=C(it),xt=L(Ke,2);xt.__click=()=>l(ct().currentDialogue,oe);var Qe=L(Je,2);{var g=o=>{var d=Cv();Oe(d,"id",`option-content-${oe}`);var k=C(d);bv(k,{get option(){return w(ue)},index:oe,get dialogues(){return kt().data.dialogues},get availableItems(){return ct().availableItems},get conditionTypes(){return t}}),G(o,d)};je(Qe,o=>{kt().editingOptionIndex===oe&&o(g)})}Ie(o=>{Re=Kt(xe,1,"option-card svelte-1de8com",null,Re,o),Oe(Ke,"aria-expanded",kt().editingOptionIndex===oe),Ae(Tt,`#${oe+1} ${w(ue).text??""}`)},[()=>({editing:kt().editingOptionIndex===oe})]),G(me,xe)});var Le=L(Ge,2),Ue=L(C(Le),2);Ie(()=>{ct(),pr(()=>{kt()})});var _t=C(Ue);_t.value=_t.__value="";var Ve=L(_t);wt(Ve,1,()=>kt().data.dialogues,nr,(me,ue)=>{var oe=xv(),xe=C(oe),Re={};Ie(Je=>{Ae(xe,`${w(ue).id??""}: ${Je??""}...`),Re!==(Re=w(ue).id)&&(oe.value=(oe.__value=w(ue).id)??"")},[()=>w(ue).text.substring(0,30)]),G(me,oe)});var It=L(Le,2),_e=C(It);_e.__click=()=>gn.deleteDialogue(ct().currentDialogue.id),$r(p,()=>ct().currentDialogue.id,me=>ct(ct().currentDialogue.id=me)),qn(U,()=>ct().currentDialogue.chapterId,me=>ct(ct().currentDialogue.chapterId=me)),$r(N,()=>ct().currentDialogue.text,me=>ct(ct().currentDialogue.text=me)),qn(W,()=>ct().currentDialogue.backgroundImage,me=>ct(ct().currentDialogue.backgroundImage=me)),qn(ge,()=>ct().currentDialogue.characterImage,me=>ct(ct().currentDialogue.characterImage=me)),qn(Ue,()=>ct().currentDialogue.nextDialogueId,me=>ct(ct().currentDialogue.nextDialogueId=me)),G(_,b)},m=_=>{var b=jv();G(_,b)};je(h,_=>{ct().currentDialogue?_(f):_(m,!1)})}G(r,u),Vt()}Xt(["change","click","keydown"]);var Ne=en(()=>M),Ov=te('<img class="icon-preview svelte-asgatj"/>'),Mv=te('<div class="icon-placeholder svelte-asgatj">📦</div>'),Lv=te("<option> </option>"),Dv=te('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),$v=te("<option> </option>"),Fv=te('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Uv=te('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),Nv=te('<div class="items-list svelte-asgatj"></div>'),Bv=te('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),Wv=te('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),Vv=te('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function qv(r,e){Wt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!Ne().data)return;Ne().data.items||Ne(Ne().data.items=[]);const R={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Ne().data.items.push(R),Ne(Ne().editingItemIndex=Ne().data.items.length-1)}function s(R){Ne().editingItemIndex===R?Ne(Ne().editingItemIndex=null):Ne(Ne().editingItemIndex=R)}function l(R){confirm("Удалить предмет?")&&Ne().data?.items&&(Ne().data.items.splice(R,1),Ne(Ne().editingItemIndex=null))}function u(R){if(!Ne().data?.items)return;const B=Ne().data.items[R],q={...B,id:`${B.id}_copy_${Date.now()}`,name:`${B.name} (копия)`};Ne().data.items.splice(R+1,0,q),Ne(Ne().editingItemIndex=R+1)}function h(R){return t.find(B=>B.value===R)?.label||R}Zr();var f=Vv(),m=C(f);m.__click=()=>Ne(Ne().showItems=!Ne().showItems);var _=C(m),b=L(C(_)),S=L(_,2),p=C(S),I=L(m,2);{var U=R=>{var B=Wv(),q=C(B);{var N=D=>{var W=Nv();wt(W,7,()=>Ne().data.items,ae=>ae.id,(ae,Q,we)=>{var Z=Uv();let ee;var Se=C(Z);Se.__click=()=>s(w(we));var Me=C(Se),ge=C(Me),Te=C(ge);{var be=ie=>{var fe=Ov();Ie(()=>{Oe(fe,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ne().selectedBucket}/${w(Q).icon}`),Oe(fe,"alt",w(Q).name)}),G(ie,fe)},ft=ie=>{var fe=Mv();G(ie,fe)};je(Te,ie=>{w(Q).icon?ie(be):ie(ft,!1)})}var Ge=L(ge,2),Fe=C(Ge),rt=C(Fe),lt=L(Fe,2),Le=C(lt),Ue=C(Le),_t=L(Le,2);let Ve;var It=C(_t),_e=L(Me,2),me=C(_e),ue=L(Se,2),oe=C(ue);oe.__click=()=>u(w(we));var xe=L(oe,2);xe.__click=()=>s(w(we));var Re=L(xe,2);Re.__click=()=>l(w(we));var Je=L(ue,2);{var Ke=ie=>{var fe=Fv(),Ce=C(fe),Xe=C(Ce),it=C(Xe),Tt=L(it,2),xt=L(Xe,2),Qe=C(xt),g=L(Qe,2),o=L(xt,2),d=C(o),k=L(d,2),P=L(o,2),A=C(P),T=L(A,2),F=C(T),H=L(F,2);H.__change=Be=>(w(Q).icon=Be.target.value,pr(()=>Ne()));var z=C(H);z.value=z.__value="";var le=L(z);wt(le,1,()=>Ne().storedFiles.filter(Be=>Be.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),nr,(Be,bt)=>{var yt=Lv(),qt=C(yt),Pe={};Ie(()=>{Ae(qt,w(bt).name),Pe!==(Pe=w(bt).name)&&(yt.value=(yt.__value=w(bt).name)??"")}),G(Be,yt)});var de=L(H,2),ce=L(C(de));ce.__change=function(...Be){Xr.uploadNewFile?.apply(this,Be)};var ve=L(T,2);{var $e=Be=>{var bt=Dv(),yt=C(bt),qt=L(yt,2),Pe=C(qt);Ie(()=>{Oe(yt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ne().selectedBucket}/${w(Q).icon}`),Ae(Pe,w(Q).icon)}),G(Be,bt)};je(ve,Be=>{w(Q).icon&&Be($e)})}var ht=L(P,2),De=C(ht),mt=L(De,2);Ie(()=>{w(Q),pr(()=>{w(we)})}),wt(mt,5,()=>t,nr,(Be,bt)=>{var yt=$v(),qt=C(yt),Pe={};Ie(()=>{Ae(qt,w(bt).label),Pe!==(Pe=w(bt).value)&&(yt.value=(yt.__value=w(bt).value)??"")}),G(Be,yt)}),Ie(()=>{Oe(it,"for",`item-id-${w(we)??""}`),Oe(Tt,"id",`item-id-${w(we)??""}`),Oe(Qe,"for",`item-name-${w(we)??""}`),Oe(g,"id",`item-name-${w(we)??""}`),Oe(d,"for",`item-desc-${w(we)??""}`),Oe(k,"id",`item-desc-${w(we)??""}`),Oe(A,"for",`item-icon-${w(we)??""}`),Oe(F,"id",`item-icon-${w(we)??""}`),Oe(De,"for",`item-type-${w(we)??""}`),Oe(mt,"id",`item-type-${w(we)??""}`)}),$r(Tt,()=>w(Q).id,Be=>(w(Q).id=Be,pr(()=>Ne()))),$r(g,()=>w(Q).name,Be=>(w(Q).name=Be,pr(()=>Ne()))),$r(k,()=>w(Q).description,Be=>(w(Q).description=Be,pr(()=>Ne()))),$r(F,()=>w(Q).icon,Be=>(w(Q).icon=Be,pr(()=>Ne()))),qn(mt,()=>w(Q).type,Be=>(w(Q).type=Be,pr(()=>Ne()))),G(ie,fe)};je(Je,ie=>{Ne().editingItemIndex===w(we)&&ie(Ke)})}Ie((ie,fe,Ce)=>{ee=Kt(Z,1,"item-row svelte-asgatj",null,ee,ie),Oe(Se,"aria-label",`Редактировать предмет ${w(Q).name??""}`),Ae(rt,w(Q).name),Ae(Ue,w(Q).id),Ve=Kt(_t,1,"item-type-badge svelte-asgatj",null,Ve,fe),Ae(It,Ce),Ae(me,`${w(Q).description??""} || `)},[()=>({editing:Ne().editingItemIndex===w(we)}),()=>({tool:w(Q).type==="tool",key:w(Q).type==="key",consumable:w(Q).type==="consumable",quest:w(Q).type==="quest",misc:w(Q).type==="misc"}),()=>h(w(Q).type)]),G(ae,Z)}),G(D,W)},K=D=>{var W=Bv();G(D,W)};je(q,D=>{Ne().data?.items?.length?D(N):D(K,!1)})}var J=L(q,2);J.__click=n,G(R,B)};je(I,R=>{Ne().showItems&&R(U)})}Ie(()=>{Oe(m,"title",Ne().showItems?"Скрыть предметы":"Показать предметы"),Oe(m,"aria-expanded",Ne().showItems),Ae(b,` Предметы (${(Ne().data?.items?.length||0)??""})`),Ae(p,Ne().showItems?"▼":"▶")}),G(r,f),Vt()}Xt(["click","change"]);Xt(["click"]);class Hv{#i=et(Ot({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return w(this.#i)}set player(e){Ee(this.#i,e,!0)}#r=et(null);get storyData(){return w(this.#r)}set storyData(e){Ee(this.#r,e,!0)}#e=et("0");get currentDialogueId(){return w(this.#e)}set currentDialogueId(e){Ee(this.#e,e,!0)}#s=et(!0);get isLoading(){return w(this.#s)}set isLoading(e){Ee(this.#s,e,!0)}#a=et("");get error(){return w(this.#a)}set error(e){Ee(this.#a,e,!0)}#t=et(null);get selectedStory(){return w(this.#t)}set selectedStory(e){Ee(this.#t,e,!0)}#n=et(Ot(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return w(this.#n)}set availableStories(e){Ee(this.#n,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){return e.visibleIf&&e.visibleIf.hasItem?this.hasItem(e.visibleIf.hasItem):!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Ct=new Hv;var ds={exports:{}},zv=ds.exports,Al;function Gv(){return Al||(Al=1,(function(r,e){(function(n,s){r.exports=s()})(zv,()=>(()=>{var t=[,((u,h,f)=>{f.r(h),f.d(h,{default:()=>_});var m=(()=>{var b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var p=S,I,U;p.ready=new Promise((i,a)=>{I=i,U=a});function R(){function i(x){const $=v;c=a=0,v=new Map,$.forEach(V=>{try{V(x)}catch(O){console.error(O)}}),this.pb(),y&&y.Tb()}let a=0,c=0,v=new Map,y=null,E=null;this.requestAnimationFrame=function(x){a||(a=requestAnimationFrame(i.bind(this)));const $=++c;return v.set($,x),$},this.cancelAnimationFrame=function(x){v.delete(x),a&&v.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(x){E&&(document.body.remove(E),E=null),x||(E=document.createElement("div"),E.style.backgroundColor="black",E.style.position="fixed",E.style.right=0,E.style.top=0,E.style.color="white",E.style.padding="4px",E.innerHTML="RIVE FPS",x=function($){E.innerHTML="RIVE FPS "+$.toFixed(1)},document.body.appendChild(E)),y=new function(){let $=0,V=0;this.Tb=function(){var O=performance.now();V?(++$,O-=V,1e3<O&&(x(1e3*$/O),$=V=0)):(V=O,$=0)}}},this.Ob=function(){E&&(document.body.remove(E),E=null),y=null},this.pb=function(){}}function B(i){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(v){return v=v+((1<<i)-1)>>i,a.has(v)&&clearTimeout(a.get(v)),a.set(v,setTimeout(function(){a.delete(v),a.length==0?c=-1/0:v==c&&(c=Math.max(...a.keys()),console.assert(c<v))},1e3)),c=Math.max(v,c),c<<i}}const q=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){q&&q();let i=p.decodeAudio;p.decodeAudio=function(y,E){y=i(y),E(y)};let a=p.decodeFont;p.decodeFont=function(y,E){y=a(y),E(y)};const c=p.FileAssetLoader;p.ptrToAsset=y=>{let E=p.ptrToFileAsset(y);return E.isImage?p.ptrToImageAsset(y):E.isFont?p.ptrToFontAsset(y):E.isAudio?p.ptrToAudioAsset(y):E},p.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:y}){this.__parent.__construct.call(this),this.Gb=y},loadContents:function(y,E){return y=p.ptrToAsset(y),this.Gb(y,E)}}),p.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(y){let E=p.ptrToAsset(y);return y=E.cdnUuid,y===""?!1:((function(x,$){var V=new XMLHttpRequest;V.responseType="arraybuffer",V.onreadystatechange=function(){V.readyState==4&&V.status==200&&$(V)},V.open("GET",x,!0),V.send(null)})(E.cdnBaseUrl+"/"+y,x=>{E.decode(new Uint8Array(x.response))}),!0)}}),p.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(y){this.lb.push(y)},loadContents:function(y,E){for(let x of this.lb)if(x.loadContents(y,E))return!0;return!1}});let v=p.computeAlignment;p.computeAlignment=function(y,E,x,$,V=1){return v.call(this,y,E,x,$,V)}};const N="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),K=new function(){function i(){if(!a){let He=function(Ye,he,St){if(he=X.createShader(he),X.shaderSource(he,St),X.compileShader(he),St=X.getShaderInfoLog(he),0<(St||"").length)throw St;X.attachShader(Ye,he)};var j=document.createElement("canvas"),re={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let X;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(X=j.getContext("webgl",re),c=1,!X)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(X=j.getContext("webgl2",re))c=2;else if(X=j.getContext("webgl",re))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(X=new Proxy(X,{get(Ye,he){if(Ye.isContextLost()){if(V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",he),V=!0),typeof Ye[he]=="function")return function(){}}else return typeof Ye[he]=="function"?function(...St){return Ye[he].apply(Ye,St)}:Ye[he]},set(Ye,he,St){if(Ye.isContextLost())V||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+he),V=!0);else return Ye[he]=St,!0}}),v=Math.min(X.getParameter(X.MAX_RENDERBUFFER_SIZE),X.getParameter(X.MAX_TEXTURE_SIZE)),j=X.createProgram(),He(j,X.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),He(j,X.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),X.bindAttribLocation(j,0,"vertex"),X.bindAttribLocation(j,1,"uv"),X.linkProgram(j),re=X.getProgramInfoLog(j),0<(re||"").trim().length)throw re;y=X.getUniformLocation(j,"mat"),E=X.getUniformLocation(j,"translate"),X.useProgram(j),X.bindBuffer(X.ARRAY_BUFFER,X.createBuffer()),X.enableVertexAttribArray(0),X.enableVertexAttribArray(1),X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,X.createBuffer()),X.uniform1i(X.getUniformLocation(j,"image"),0),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=X}return!0}let a=null,c=0,v=0,y=null,E=null,x=0,$=0,V=!1;i(),this.hc=function(){return i(),v},this.Mb=function(j){a.deleteTexture&&a.deleteTexture(j)},this.Lb=function(j){if(!i())return null;const re=a.createTexture();return re?(a.bindTexture(a.TEXTURE_2D,re),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,j),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),re):null};const O=new B(8),ne=new B(8),se=new B(10),ye=new B(10);this.Qb=function(j,re,X,He,Ye){if(i()){var he=O.push(j),St=ne.push(re);if(a.canvas){(a.canvas.width!=he||a.canvas.height!=St)&&(a.canvas.width=he,a.canvas.height=St),a.viewport(0,St-re,j,re),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),X.sort((st,kr)=>kr.xb-st.xb),he=se.push(He),x!=he&&(a.bufferData(a.ARRAY_BUFFER,8*he,a.DYNAMIC_DRAW),x=he),he=0;for(var Bt of X)a.bufferSubData(a.ARRAY_BUFFER,he,Bt.Ua),he+=4*Bt.Ua.length;console.assert(he==4*He);for(var br of X)a.bufferSubData(a.ARRAY_BUFFER,he,br.Db),he+=4*br.Db.length;console.assert(he==8*He),he=ye.push(Ye),$!=he&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*he,a.DYNAMIC_DRAW),$=he),Bt=0;for(var an of X)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Bt,an.indices),Bt+=2*an.indices.length;console.assert(Bt==2*Ye),an=0,br=!0,he=Bt=0;for(const st of X){st.image.Ka!=an&&(a.bindTexture(a.TEXTURE_2D,st.image.Ja||null),an=st.image.Ka),st.mc?(a.scissor(st.Za,St-st.$a-st.kb,st.Ac,st.kb),br=!0):br&&(a.scissor(0,St-re,j,re),br=!1),X=2/j;const kr=-2/re;a.uniform4f(y,st.ha[0]*X*st.Ba,st.ha[1]*kr*st.Ca,st.ha[2]*X*st.Ba,st.ha[3]*kr*st.Ca),a.uniform2f(E,st.ha[4]*X*st.Ba+X*(st.Za-st.ic*st.Ba)-1,st.ha[5]*kr*st.Ca+kr*(st.$a-st.jc*st.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,he),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,he+4*He),a.drawElements(a.TRIANGLES,st.indices.length,a.UNSIGNED_SHORT,Bt),he+=4*st.Ua.length,Bt+=2*st.indices.length}console.assert(he==4*He),console.assert(Bt==2*Ye)}}},this.canvas=function(){return i()&&a.canvas}},J=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function i(Y){switch(Y){case O.srcOver:return"source-over";case O.screen:return"screen";case O.overlay:return"overlay";case O.darken:return"darken";case O.lighten:return"lighten";case O.colorDodge:return"color-dodge";case O.colorBurn:return"color-burn";case O.hardLight:return"hard-light";case O.softLight:return"soft-light";case O.difference:return"difference";case O.exclusion:return"exclusion";case O.multiply:return"multiply";case O.hue:return"hue";case O.saturation:return"saturation";case O.color:return"color";case O.luminosity:return"luminosity"}}function a(Y){return"rgba("+((16711680&Y)>>>16)+","+((65280&Y)>>>8)+","+((255&Y)>>>0)+","+((4278190080&Y)>>>24)/255+")"}function c(){0<St.length&&(K.Qb(he.drawWidth(),he.drawHeight(),St,Bt,br),St=[],br=Bt=0,he.reset(512,512));for(const Y of Ye){for(const pe of Y.H)pe();Y.H=[]}Ye.clear()}J&&J();var v=p.RenderPaintStyle;const y=p.RenderPath,E=p.RenderPaint,x=p.Renderer,$=p.StrokeCap,V=p.StrokeJoin,O=p.BlendMode,ne=v.fill,se=v.stroke,ye=p.FillRule.evenOdd;let j=1;var re=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:Y,xa:pe}={}){this.__parent.__construct.call(this),this.Ka=j,j=j+1&2147483647||1,this.la=Y,this.xa=pe},__destruct:function(){this.Ja&&(K.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(Y){var pe=this;pe.xa&&pe.xa(pe);var tt=new Image;pe.Xa=URL.createObjectURL(new Blob([Y],{type:"image/png"})),tt.onload=function(){pe.Fb=tt,pe.Ja=K.Lb(tt),pe.size(tt.width,tt.height),pe.la&&pe.la(pe)},tt.src=pe.Xa}}),X=y.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(Y,pe,tt,at,ze,nt,vt){var gt=this.T,fr=gt.addPath;Y=Y.T;const Dt=new DOMMatrix;Dt.a=pe,Dt.b=tt,Dt.c=at,Dt.d=ze,Dt.e=nt,Dt.f=vt,fr.call(gt,Y,Dt)},fillRule:function(Y){this.Wa=Y},moveTo:function(Y,pe){this.T.moveTo(Y,pe)},lineTo:function(Y,pe){this.T.lineTo(Y,pe)},cubicTo:function(Y,pe,tt,at,ze,nt){this.T.bezierCurveTo(Y,pe,tt,at,ze,nt)},close:function(){this.T.closePath()}}),He=E.extend("CanvasRenderPaint",{color:function(Y){this.Ya=a(Y)},thickness:function(Y){this.Ib=Y},join:function(Y){switch(Y){case V.miter:this.Ia="miter";break;case V.round:this.Ia="round";break;case V.bevel:this.Ia="bevel"}},cap:function(Y){switch(Y){case $.butt:this.Ha="butt";break;case $.round:this.Ha="round";break;case $.square:this.Ha="square"}},style:function(Y){this.Hb=Y},blendMode:function(Y){this.Eb=i(Y)},clearGradient:function(){this.ja=null},linearGradient:function(Y,pe,tt,at){this.ja={zb:Y,Ab:pe,cb:tt,eb:at,Ra:[]}},radialGradient:function(Y,pe,tt,at){this.ja={zb:Y,Ab:pe,cb:tt,eb:at,Ra:[],ec:!0}},addStop:function(Y,pe){this.ja.Ra.push({color:Y,stop:pe})},completeGradient:function(){},draw:function(Y,pe,tt){let at=this.Hb;var ze=this.Ya,nt=this.ja;if(Y.globalCompositeOperation=this.Eb,nt!=null){ze=nt.zb;var vt=nt.Ab;const fr=nt.cb;var gt=nt.eb;const Dt=nt.Ra;nt.ec?(nt=fr-ze,gt-=vt,ze=Y.createRadialGradient(ze,vt,0,ze,vt,Math.sqrt(nt*nt+gt*gt))):ze=Y.createLinearGradient(ze,vt,fr,gt);for(let ar=0,$t=Dt.length;ar<$t;ar++)vt=Dt[ar],ze.addColorStop(vt.stop,a(vt.color));this.Ya=ze,this.ja=null}switch(at){case se:Y.strokeStyle=ze,Y.lineWidth=this.Ib,Y.lineCap=this.Ha,Y.lineJoin=this.Ia,Y.stroke(pe);break;case ne:Y.fillStyle=ze,Y.fill(pe,tt)}}});const Ye=new Set;let he=null,St=[],Bt=0,br=0;var an=p.CanvasRenderer=x.extend("Renderer",{__construct:function(Y){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=Y.getContext("2d"),this.Va=Y,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const Y=this.S.length-6;if(6>Y)throw"restore() called without matching save().";this.S.splice(Y),this.H.push(this.C.restore.bind(this.C))},transform:function(Y,pe,tt,at,ze,nt){const vt=this.S,gt=vt.length-6;vt.splice(gt,6,vt[gt]*Y+vt[gt+2]*pe,vt[gt+1]*Y+vt[gt+3]*pe,vt[gt]*tt+vt[gt+2]*at,vt[gt+1]*tt+vt[gt+3]*at,vt[gt]*ze+vt[gt+2]*nt+vt[gt+4],vt[gt+1]*ze+vt[gt+3]*nt+vt[gt+5]),this.H.push(this.C.transform.bind(this.C,Y,pe,tt,at,ze,nt))},rotate:function(Y){const pe=Math.sin(Y);Y=Math.cos(Y),this.transform(Y,pe,-pe,Y,0,0)},_drawPath:function(Y,pe){this.H.push(pe.draw.bind(pe,this.C,Y.T,Y.Wa===ye?"evenodd":"nonzero"))},_drawRiveImage:function(Y,pe,tt,at){var ze=Y.Fb;if(ze){var nt=this.C,vt=i(tt);this.H.push(function(){nt.globalCompositeOperation=vt,nt.globalAlpha=at,nt.drawImage(ze,0,0),nt.globalAlpha=1})}},_getMatrix:function(Y){const pe=this.S,tt=pe.length-6;for(let at=0;6>at;++at)Y[at]=pe[tt+at]},_drawImageMesh:function(Y,pe,tt,at,ze,nt,vt,gt,fr,Dt,ar){pe=this.C.canvas.width;var $t=this.C.canvas.height;const Mo=Dt-gt,Lo=ar-fr;gt=Math.max(gt,0),fr=Math.max(fr,0),Dt=Math.min(Dt,pe),ar=Math.min(ar,$t);const gi=Dt-gt,_i=ar-fr;if(console.assert(gi<=Math.min(Mo,pe)),console.assert(_i<=Math.min(Lo,$t)),!(0>=gi||0>=_i)){Dt=gi<Mo||_i<Lo,pe=ar=1;var on=Math.ceil(gi*ar),ln=Math.ceil(_i*pe);$t=K.hc(),on>$t&&(ar*=$t/on,on=$t),ln>$t&&(pe*=$t/ln,ln=$t),he||(he=new p.DynamicRectanizer($t),he.reset(512,512)),$t=he.addRect(on,ln),0>$t&&(c(),Ye.add(this),$t=he.addRect(on,ln),console.assert(0<=$t));var Do=$t&65535,$o=$t>>16;St.push({ha:this.S.slice(this.S.length-6),image:Y,Za:Do,$a:$o,ic:gt,jc:fr,Ac:on,kb:ln,Ba:ar,Ca:pe,Ua:new Float32Array(ze),Db:new Float32Array(nt),indices:new Uint16Array(vt),mc:Dt,xb:Y.Ka<<1|(Dt?1:0)}),Bt+=ze.length,br+=vt.length;var xn=this.C,lc=i(tt);this.H.push(function(){xn.save(),xn.resetTransform(),xn.globalCompositeOperation=lc,xn.globalAlpha=at;const Fo=K.canvas();Fo&&xn.drawImage(Fo,Do,$o,on,ln,gt,fr,gi,_i),xn.restore()})}},_clipPath:function(Y){this.H.push(this.C.clip.bind(this.C,Y.T,Y.Wa===ye?"evenodd":"nonzero"))},clear:function(){Ye.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(Y,pe){this.transform(1,0,0,1,Y,pe)}});p.makeRenderer=function(Y){const pe=new an(Y),tt=pe.C;return new Proxy(pe,{get(at,ze){if(typeof at[ze]=="function")return function(...nt){return at[ze].apply(at,nt)};if(typeof tt[ze]=="function"){if(-1<N.indexOf(ze))throw Error("RiveException: Method call to '"+ze+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...nt){pe.H.push(tt[ze].bind(tt,...nt))}}return at[ze]},set(at,ze,nt){if(ze in tt)return pe.H.push(()=>{tt[ze]=nt}),!0}})},p.decodeImage=function(Y,pe){new re({la:pe}).decode(Y)},p.renderFactory={makeRenderPaint:function(){return new He},makeRenderPath:function(){return new X},makeRenderImage:function(){let Y=kr;return new re({xa:()=>{Y.total++},la:()=>{if(Y.loaded++,Y.loaded===Y.total){const pe=Y.ready;pe&&(pe(),Y.ready=null)}}})}};let st=p.load,kr=null;p.load=function(Y,pe,tt=!0){const at=new p.FallbackFileAssetLoader;return pe!==void 0&&at.addLoader(pe),tt&&(pe=new p.CDNFileAssetLoader,at.addLoader(pe)),new Promise(function(ze){let nt=null;kr={total:0,loaded:0,ready:function(){ze(nt)}},nt=st(Y,at),kr.total==0&&ze(nt)})};let oc=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(Y,pe,tt,at,ze=1){oc.call(this,Y,pe,tt,at,ze)},v=new R,p.requestAnimationFrame=v.requestAnimationFrame.bind(v),p.cancelAnimationFrame=v.cancelAnimationFrame.bind(v),p.enableFPSCounter=v.Rb.bind(v),p.disableFPSCounter=v.Ob,v.pb=c,p.resolveAnimationFrame=c,p.cleanup=function(){he&&he.delete()}};var D=Object.assign({},p),W="./this.program",ae=typeof window=="object",Q=typeof importScripts=="function",we="",Z,ee;(ae||Q)&&(Q?we=self.location.href:typeof document<"u"&&document.currentScript&&(we=document.currentScript.src),b&&(we=b),we.indexOf("blob:")!==0?we=we.substr(0,we.replace(/[?#].*/,"").lastIndexOf("/")+1):we="",Q&&(ee=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),Z=(i,a,c)=>{var v=new XMLHttpRequest;v.open("GET",i,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var Se=p.print||console.log.bind(console),Me=p.printErr||console.error.bind(console);Object.assign(p,D),D=null,p.thisProgram&&(W=p.thisProgram);var ge;p.wasmBinary&&(ge=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&Ke("no native wasm support detected");var Te,be,ft=!1,Ge,Fe,rt,lt,Le,Ue,_t,Ve;function It(){var i=Te.buffer;p.HEAP8=Ge=new Int8Array(i),p.HEAP16=rt=new Int16Array(i),p.HEAP32=Le=new Int32Array(i),p.HEAPU8=Fe=new Uint8Array(i),p.HEAPU16=lt=new Uint16Array(i),p.HEAPU32=Ue=new Uint32Array(i),p.HEAPF32=_t=new Float32Array(i),p.HEAPF64=Ve=new Float64Array(i)}var _e,me=[],ue=[],oe=[];function xe(){var i=p.preRun.shift();me.unshift(i)}var Re=0,Je=null;function Ke(i){throw p.onAbort&&p.onAbort(i),i="Aborted("+i+")",Me(i),ft=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),U(i),i}function ie(i){return i.startsWith("data:application/octet-stream;base64,")}var fe;if(fe="canvas_advanced.wasm",!ie(fe)){var Ce=fe;fe=p.locateFile?p.locateFile(Ce,we):we+Ce}function Xe(i){if(i==fe&&ge)return new Uint8Array(ge);if(ee)return ee(i);throw"both async and sync fetching of the wasm failed"}function it(i){if(!ge&&(ae||Q)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>Xe(i));if(Z)return new Promise((a,c)=>{Z(i,v=>a(new Uint8Array(v)),c)})}return Promise.resolve().then(()=>Xe(i))}function Tt(i,a,c){return it(i).then(v=>WebAssembly.instantiate(v,a)).then(v=>v).then(c,v=>{Me("failed to asynchronously prepare wasm: "+v),Ke(v)})}function xt(i,a){var c=fe;return ge||typeof WebAssembly.instantiateStreaming!="function"||ie(c)||c.startsWith("file://")||typeof fetch!="function"?Tt(c,i,a):fetch(c,{credentials:"same-origin"}).then(v=>WebAssembly.instantiateStreaming(v,i).then(a,function(y){return Me("wasm streaming compile failed: "+y),Me("falling back to ArrayBuffer instantiation"),Tt(c,i,a)}))}var Qe,g,o={460492:(i,a,c,v,y)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=v,window.h.ga.yb=y;let E=window.h;E.D=[],E.yc=function(x){for(var $=0;$<E.D.length;++$)if(E.D[$]==null)return E.D[$]=x,$;return E.D.push(x),E.D.length-1},E.Cb=function(x){for(E.D[x]=null;0<E.D.length&&E.D[E.D.length-1]==null;)E.D.pop()},E.Sc=function(x){for(var $=0;$<E.D.length;++$)if(E.D[$]==x)return E.Cb($)},E.ra=function(x){return E.D[x]},E.Ta=["touchend","click"],E.unlock=function(){for(var x=0;x<E.D.length;++x){var $=E.D[x];$!=null&&$.J!=null&&$.state===E.ga.yb&&$.J.resume().then(()=>{xo($.qb)},V=>{console.error("Failed to resume audiocontext",V)})}E.Ta.map(function(V){document.removeEventListener(V,E.unlock,!0)})},E.Ta.map(function(x){document.addEventListener(x,E.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,c,v,y,E)=>{if(typeof window.h>"u")return-1;var x={},$={};return i==window.h.I.ya&&c!=0&&($.sampleRate=c),x.J=new(window.AudioContext||window.webkitAudioContext)($),x.J.suspend(),x.state=window.h.ga.stopped,c=0,i!=window.h.I.ya&&(c=a),x.Z=x.J.createScriptProcessor(v,c,a),x.Z.onaudioprocess=function(V){if((x.sa==null||x.sa.length==0)&&(x.sa=new Float32Array(_t.buffer,y,v*a)),i==window.h.I.capture||i==window.h.I.La){for(var O=0;O<a;O+=1)for(var ne=V.inputBuffer.getChannelData(O),se=x.sa,ye=0;ye<v;ye+=1)se[ye*a+O]=ne[ye];Po(E,v,y)}if(i==window.h.I.ya||i==window.h.I.La)for(jo(E,v,y),O=0;O<V.outputBuffer.numberOfChannels;++O)for(ne=V.outputBuffer.getChannelData(O),se=x.sa,ye=0;ye<v;ye+=1)ne[ye]=se[ye*a+O];else for(O=0;O<V.outputBuffer.numberOfChannels;++O)V.outputBuffer.getChannelData(O).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(V){x.Da=x.J.createMediaStreamSource(V),x.Da.connect(x.Z),x.Z.connect(x.J.destination)}).catch(function(V){console.log("Failed to get user media: "+V)}),i==window.h.I.ya&&x.Z.connect(x.J.destination),x.qb=E,window.h.yc(x)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(p)},k=(i,a)=>{for(var c=0,v=i.length-1;0<=v;v--){var y=i[v];y==="."?i.splice(v,1):y===".."?(i.splice(v,1),c++):c&&(i.splice(v,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},P=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=k(i.split("/").filter(v=>!!v),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},A=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},T=i=>{if(i==="/")return"/";i=P(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},F=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Ke("initRandomDevice")},H=i=>(H=F())(i);function z(){for(var i="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=k(i.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+i||"."}var le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,de=(i,a,c)=>{var v=a+c;for(c=a;i[c]&&!(c>=v);)++c;if(16<c-a&&i.buffer&&le)return le.decode(i.subarray(a,c));for(v="";a<c;){var y=i[a++];if(y&128){var E=i[a++]&63;if((y&224)==192)v+=String.fromCharCode((y&31)<<6|E);else{var x=i[a++]&63;y=(y&240)==224?(y&15)<<12|E<<6|x:(y&7)<<18|E<<12|x<<6|i[a++]&63,65536>y?v+=String.fromCharCode(y):(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else v+=String.fromCharCode(y)}return v},ce=[],ve=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);127>=v?a++:2047>=v?a+=2:55296<=v&&57343>=v?(a+=4,++c):a+=3}return a},$e=(i,a,c,v)=>{if(!(0<v))return 0;var y=c;v=c+v-1;for(var E=0;E<i.length;++E){var x=i.charCodeAt(E);if(55296<=x&&57343>=x){var $=i.charCodeAt(++E);x=65536+((x&1023)<<10)|$&1023}if(127>=x){if(c>=v)break;a[c++]=x}else{if(2047>=x){if(c+1>=v)break;a[c++]=192|x>>6}else{if(65535>=x){if(c+2>=v)break;a[c++]=224|x>>12}else{if(c+3>=v)break;a[c++]=240|x>>18,a[c++]=128|x>>12&63}a[c++]=128|x>>6&63}a[c++]=128|x&63}}return a[c]=0,c-y};function ht(i,a){var c=Array(ve(i)+1);return i=$e(i,c,0,c.length),a&&(c.length=i),c}var De=[];function mt(i,a){De[i]={input:[],F:[],V:a},xs(i,Be)}var Be={open:function(i){var a=De[i.node.za];if(!a)throw new ke(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,c,v){if(!i.s||!i.s.V.jb)throw new ke(60);for(var y=0,E=0;E<v;E++){try{var x=i.s.V.jb(i.s)}catch{throw new ke(29)}if(x===void 0&&y===0)throw new ke(6);if(x==null)break;y++,a[c+E]=x}return y&&(i.node.timestamp=Date.now()),y},write:function(i,a,c,v){if(!i.s||!i.s.V.Oa)throw new ke(60);try{for(var y=0;y<v;y++)i.s.V.Oa(i.s,a[c+y])}catch{throw new ke(29)}return v&&(i.node.timestamp=Date.now()),y}},bt={jb:function(){e:{if(!ce.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}ce=ht(i,!0)}i=ce.shift()}return i},Oa:function(i,a){a===null||a===10?(Se(de(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Se(de(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},yt={Oa:function(i,a){a===null||a===10?(Me(de(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Me(de(i.F,0)),i.F=[])}};function qt(i,a){var c=i.j?i.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(c.subarray(0,i.v),0))}var Pe={O:null,U(){return Pe.createNode(null,"/",16895,0)},createNode(i,a,c,v){if((c&61440)===24576||(c&61440)===4096)throw new ke(63);return Pe.O||(Pe.O={dir:{node:{Y:Pe.l.Y,P:Pe.l.P,ka:Pe.l.ka,va:Pe.l.va,vb:Pe.l.vb,Bb:Pe.l.Bb,wb:Pe.l.wb,tb:Pe.l.tb,Ea:Pe.l.Ea},stream:{ba:Pe.m.ba}},file:{node:{Y:Pe.l.Y,P:Pe.l.P},stream:{ba:Pe.m.ba,read:Pe.m.read,write:Pe.m.write,pa:Pe.m.pa,mb:Pe.m.mb,ob:Pe.m.ob}},link:{node:{Y:Pe.l.Y,P:Pe.l.P,ma:Pe.l.ma},stream:{}},ab:{node:{Y:Pe.l.Y,P:Pe.l.P},stream:Uu}}),c=Xa(i,a,c,v),(c.mode&61440)===16384?(c.l=Pe.O.dir.node,c.m=Pe.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Pe.O.file.node,c.m=Pe.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Pe.O.link.node,c.m=Pe.O.link.stream):(c.mode&61440)===8192&&(c.l=Pe.O.ab.node,c.m=Pe.O.ab.stream),c.timestamp=Date.now(),i&&(i.j[a]=c,i.timestamp=c.timestamp),c},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var c=i.j;i.j=new Uint8Array(a),c&&i.j.set(c.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw Ts[44]},va(i,a,c,v){return Pe.createNode(i,a,c,v)},vb(i,a,c){if((i.mode&61440)===16384){try{var v=Mi(a,c)}catch{}if(v)for(var y in v.j)throw new ke(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=c,a.j[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var c=Mi(i,a),v;for(v in c.j)throw new ke(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],c;for(c in i.j)i.j.hasOwnProperty(c)&&a.push(c);return a},Ea(i,a,c){return i=Pe.createNode(i,a,41471,0),i.link=c,i},ma(i){if((i.mode&61440)!==40960)throw new ke(28);return i.link}},m:{read(i,a,c,v,y){var E=i.node.j;if(y>=i.node.v)return 0;if(i=Math.min(i.node.v-y,v),8<i&&E.subarray)a.set(E.subarray(y,y+i),c);else for(v=0;v<i;v++)a[c+v]=E[y+v];return i},write(i,a,c,v,y,E){if(a.buffer===Ge.buffer&&(E=!1),!v)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(E)return i.j=a.subarray(c,c+v),i.v=v;if(i.v===0&&y===0)return i.j=a.slice(c,c+v),i.v=v;if(y+v<=i.v)return i.j.set(a.subarray(c,c+v),y),v}if(qt(i,y+v),i.j.subarray&&a.subarray)i.j.set(a.subarray(c,c+v),y);else for(E=0;E<v;E++)i.j[y+E]=a[c+E];return i.v=Math.max(i.v,y+v),v},ba(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new ke(28);return a},pa(i,a,c){qt(i.node,a+c),i.node.v=Math.max(i.node.v,a+c)},mb(i,a,c,v,y){if((i.node.mode&61440)!==32768)throw new ke(43);if(i=i.node.j,y&2||i.buffer!==Ge.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,Ke(),a=void 0,!a)throw new ke(48);Ge.set(i,a)}else c=!1,a=i.byteOffset;return{o:a,M:c}},ob(i,a,c,v){return Pe.m.write(i,a,0,v,c,!1),0}}};function ut(i,a){var c=0;return i&&(c|=365),a&&(c|=146),c}var yr=null,Ga={},Oi=[],$u=1,oi=null,Ka=!0,ke=null,Ts={},rn=(i,a={})=>{if(i=z(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new ke(32);i=i.split("/").filter(x=>!!x);for(var c=yr,v="/",y=0;y<i.length;y++){var E=y===i.length-1;if(E&&a.parent)break;if(c=Mi(c,i[y]),v=P(v+"/"+i[y]),c.wa&&(!E||E&&a.hb)&&(c=c.wa.root),!E||a.gb){for(E=0;(c.mode&61440)===40960;)if(c=Nu(v),v=z(A(v),c),c=rn(v,{Qa:a.Qa+1}).node,40<E++)throw new ke(32)}}return{path:v,node:c}},Ya=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},Ja=(i,a)=>{for(var c=0,v=0;v<a.length;v++)c=(c<<5)-c+a.charCodeAt(v)|0;return(i+c>>>0)%oi.length},Mi=(i,a)=>{var c;if(c=(c=Li(i,"x"))?c:i.l.ka?0:2)throw new ke(c,i);for(c=oi[Ja(i.id,a)];c;c=c.lc){var v=c.name;if(c.parent.id===i.id&&v===a)return c}return i.l.ka(i,a)},Xa=(i,a,c,v)=>(i=new So(i,a,c,v),a=Ja(i.parent.id,i.name),i.lc=oi[a],oi[a]=i),Qa=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},Li=(i,a)=>{if(Ka)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Za=(i,a)=>{try{return Mi(i,a),20}catch{}return Li(i,"wx")},Fu=()=>{for(var i=0;4096>=i;i++)if(!Oi[i])return i;throw new ke(33)},Wr=i=>{if(i=Oi[i],!i)throw new ke(8);return i},eo=(i,a=-1)=>(ui||(ui=function(){this.h={}},ui.prototype={},Object.defineProperties(ui.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),i=Object.assign(new ui,i),a==-1&&(a=Fu()),i.X=a,Oi[a]=i),Uu={open:i=>{i.m=Ga[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new ke(70)}},xs=(i,a)=>{Ga[i]={m:a}},to=(i,a)=>{var c=a==="/",v=!a;if(c&&yr)throw new ke(10);if(!c&&!v){var y=rn(a,{hb:!1});if(a=y.path,y=y.node,y.wa)throw new ke(10);if((y.mode&61440)!==16384)throw new ke(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,c?yr=i:y&&(y.wa=a,y.U&&y.U.kc.push(a))},cr=(i,a,c)=>{var v=rn(i,{parent:!0}).node;if(i=T(i),!i||i==="."||i==="..")throw new ke(28);var y=Za(v,i);if(y)throw new ke(y);if(!v.l.va)throw new ke(63);return v.l.va(v,i,a,c)},Di=(i,a,c)=>{typeof c>"u"&&(c=a,a=438),cr(i,a|8192,c)},Ps=(i,a)=>{if(!z(i))throw new ke(44);var c=rn(a,{parent:!0}).node;if(!c)throw new ke(44);a=T(a);var v=Za(c,a);if(v)throw new ke(v);if(!c.l.Ea)throw new ke(63);c.l.Ea(c,a,i)},Nu=i=>{if(i=rn(i).node,!i)throw new ke(44);if(!i.l.ma)throw new ke(28);return z(Ya(i.parent),i.l.ma(i))},$i=(i,a,c)=>{if(i==="")throw new ke(44);if(typeof a=="string"){var v={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof v>"u")throw Error(`Unknown file open mode: ${a}`);a=v}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var y=i;else{i=P(i);try{y=rn(i,{gb:!(a&131072)}).node}catch{}}if(v=!1,a&64)if(y){if(a&128)throw new ke(20)}else y=cr(i,c,0),v=!0;if(!y)throw new ke(44);if((y.mode&61440)===8192&&(a&=-513),a&65536&&(y.mode&61440)!==16384)throw new ke(54);if(!v&&(c=y?(y.mode&61440)===40960?32:(y.mode&61440)===16384&&(Qa(a)!=="r"||a&512)?31:Li(y,Qa(a)):44))throw new ke(c);if(a&512&&!v){if(c=y,c=typeof c=="string"?rn(c,{gb:!0}).node:c,!c.l.P)throw new ke(63);if((c.mode&61440)===16384)throw new ke(31);if((c.mode&61440)!==32768)throw new ke(28);if(v=Li(c,"w"))throw new ke(v);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,y=eo({node:y,path:Ya(y),flags:a,seekable:!0,position:0,m:y.m,zc:[],error:!1}),y.m.open&&y.m.open(y),!p.logReadFiles||a&1||(Fi||(Fi={}),i in Fi||(Fi[i]=1)),y},ro=(i,a,c)=>{if(i.X===null)throw new ke(8);if(!i.seekable||!i.m.ba)throw new ke(70);if(c!=0&&c!=1&&c!=2)throw new ke(28);i.position=i.m.ba(i,a,c),i.zc=[]},no=()=>{ke||(ke=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(i),this.message="FS error"},ke.prototype=Error(),ke.prototype.constructor=ke,[44].forEach(i=>{Ts[i]=new ke(i),Ts[i].stack="<generic error, no stack>"}))},io,li=(i,a,c)=>{i=P("/dev/"+i);var v=ut(!!a,!!c);js||(js=64);var y=js++<<8|0;xs(y,{open:E=>{E.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(E,x,$,V)=>{for(var O=0,ne=0;ne<V;ne++){try{var se=a()}catch{throw new ke(29)}if(se===void 0&&O===0)throw new ke(6);if(se==null)break;O++,x[$+ne]=se}return O&&(E.node.timestamp=Date.now()),O},write:(E,x,$,V)=>{for(var O=0;O<V;O++)try{c(x[$+O])}catch{throw new ke(29)}return V&&(E.node.timestamp=Date.now()),O}}),Di(i,v,y)},js,nn={},ui,Fi,ci=void 0;function Pr(){return ci+=4,Le[ci-4>>2]}function so(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Ui(i,a){return i=so(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function ao(){this.M=[void 0],this.ib=[]}var sr=new ao,An=void 0;function qe(i){throw new An(i)}var dr=i=>(i||qe("Cannot use deleted val. handle = "+i),sr.get(i).value),hr=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return sr.pa({ub:1,value:i})}};function oo(i){var a=Error,c=Ui(i,function(v){this.name=i,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var lo=void 0,uo=void 0;function Pt(i){for(var a="";Fe[i];)a+=uo[Fe[i++]];return a}var di=[];function Rs(){for(;di.length;){var i=di.pop();i.g.fa=!1,i.delete()}}var hi=void 0,jr={};function Os(i,a){for(a===void 0&&qe("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var sn={};function co(i){i=Ro(i);var a=Pt(i);return Mr(i),a}function fi(i,a){var c=sn[i];return c===void 0&&qe(a+" has unknown type "+co(i)),c}function Ni(){}var Ms=!1;function ho(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function fo(i,a,c){return a===c?i:c.A===void 0?null:(i=fo(i,a,c.A),i===null?null:c.Pb(i))}var vo={};function Bu(i,a){return a=Os(i,a),jr[a]}var po=void 0;function Bi(i){throw new po(i)}function Wi(i,a){return a.u&&a.o||Bi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Bi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Cn(Object.create(i,{g:{value:a}}))}function Cn(i){return typeof FinalizationRegistry>"u"?(Cn=a=>a,i):(Ms=new FinalizationRegistry(a=>{ho(a.g)}),Cn=a=>{var c=a.g;return c.G&&Ms.register(a,{g:c},a),a},Ni=a=>{Ms.unregister(a)},Cn(i))}var Vi={};function vi(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function pi(i){return this.fromWireType(Le[i>>2])}var Tn={},qi={};function tr(i,a,c){function v($){$=c($),$.length!==i.length&&Bi("Mismatched type converter count");for(var V=0;V<i.length;++V)wr(i[V],$[V])}i.forEach(function($){qi[$]=a});var y=Array(a.length),E=[],x=0;a.forEach(($,V)=>{sn.hasOwnProperty($)?y[V]=sn[$]:(E.push($),Tn.hasOwnProperty($)||(Tn[$]=[]),Tn[$].push(()=>{y[V]=sn[$],++x,x===E.length&&v(y)}))}),E.length===0&&v(y)}function Hi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Wu(i,a,c={}){var v=a.name;if(i||qe(`type "${v}" must have a positive integer typeid pointer`),sn.hasOwnProperty(i)){if(c.$b)return;qe(`Cannot register type '${v}' twice`)}sn[i]=a,delete qi[i],Tn.hasOwnProperty(i)&&(a=Tn[i],delete Tn[i],a.forEach(y=>y()))}function wr(i,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Wu(i,a,c)}function Ls(i){qe(i.g.u.i.name+" instance already deleted")}function Vr(){}function Ds(i,a,c){if(i[a].B===void 0){var v=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||qe(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[v.ea]=v}}function $s(i,a,c){p.hasOwnProperty(i)?((c===void 0||p[i].B!==void 0&&p[i].B[c]!==void 0)&&qe(`Cannot register public name '${i}' twice`),Ds(p,i,i),p.hasOwnProperty(c)&&qe(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),p[i].B[c]=a):(p[i]=a,c!==void 0&&(p[i].Pc=c))}function Vu(i,a,c,v,y,E,x,$){this.name=i,this.constructor=a,this.N=c,this.W=v,this.A=y,this.Ub=E,this.na=x,this.Pb=$,this.rb=[]}function zi(i,a,c){for(;a!==c;)a.na||qe(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function qu(i,a){return a===null?(this.Na&&qe(`null is not a valid ${this.name}`),0):(a.g||qe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||qe(`Cannot pass deleted object as a pointer of type ${this.name}`),zi(a.g.o,a.g.u.i,this.i))}function Hu(i,a){if(a===null){if(this.Na&&qe(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return i!==null&&i.push(this.W,c),c}return 0}if(a.g||qe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||qe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&qe(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=zi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&qe("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:qe(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var v=a.clone();c=this.oc(c,hr(function(){v.delete()})),i!==null&&i.push(this.W,c)}break;default:qe("Unsupporting sharing policy")}return c}function zu(i,a){return a===null?(this.Na&&qe(`null is not a valid ${this.name}`),0):(a.g||qe(`Cannot pass "${Us(a)}" as a ${this.name}`),a.g.o||qe(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&qe(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),zi(a.g.o,a.g.u.i,this.i))}function Rr(i,a,c,v){this.name=i,this.i=a,this.Na=c,this.ta=v,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Hu:(this.toWireType=v?qu:zu,this.K=null)}function go(i,a,c){p.hasOwnProperty(i)||Bi("Replacing nonexistant public symbol"),p[i].B!==void 0&&c!==void 0?p[i].B[c]=a:(p[i]=a,p[i].ea=c)}var Gi=[],_o=i=>{var a=Gi[i];return a||(i>=Gi.length&&(Gi.length=i+1),Gi[i]=a=_e.get(i)),a},Gu=(i,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),i.includes("j")){var v=p["dynCall_"+i];v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)}else v=_o(a).apply(null,c);return v}};function Ht(i,a){i=Pt(i);var c=i.includes("j")?Gu(i,a):_o(a);return typeof c!="function"&&qe(`unknown function pointer with signature ${i}: ${a}`),c}var mo=void 0;function Or(i,a){function c(E){y[E]||sn[E]||(qi[E]?qi[E].forEach(c):(v.push(E),y[E]=!0))}var v=[],y={};throw a.forEach(c),new mo(`${i}: `+v.map(co).join([", "]))}function Ki(i,a,c,v,y){var E=a.length;2>E&&qe("argTypes array size mismatch! Must at least get return value and 'this' types!");var x=a[1]!==null&&c!==null,$=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){$=!0;break}var V=a[0].name!=="void",O=E-2,ne=Array(O),se=[],ye=[];return function(){if(arguments.length!==O&&qe(`function ${i} called with ${arguments.length} arguments, expected ${O} args!`),ye.length=0,se.length=x?2:1,se[0]=y,x){var j=a[1].toWireType(ye,this);se[1]=j}for(var re=0;re<O;++re)ne[re]=a[re+2].toWireType(ye,arguments[re]),se.push(ne[re]);if(re=v.apply(null,se),$)vi(ye);else for(var X=x?1:2;X<a.length;X++){var He=X===1?j:ne[X-2];a[X].K!==null&&a[X].K(He)}return j=V?a[0].fromWireType(re):void 0,j}}function Yi(i,a){for(var c=[],v=0;v<i;v++)c.push(Ue[a+4*v>>2]);return c}function yo(i,a,c){return i instanceof Object||qe(`${c} with invalid "this": ${i}`),i instanceof a.i.constructor||qe(`${c} incompatible with "this" of type ${i.constructor.name}`),i.g.o||qe(`cannot call emscripten binding method ${c} on deleted object`),zi(i.g.o,i.g.u.i,a.i)}function Fs(i){i>=sr.h&&--sr.get(i).ub===0&&sr.Zb(i)}function Ku(i,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?Ge:Fe)[v])};case 1:return function(v){return this.fromWireType((c?rt:lt)[v>>1])};case 2:return function(v){return this.fromWireType((c?Le:Ue)[v>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Us(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Yu(i,a){switch(a){case 2:return function(c){return this.fromWireType(_t[c>>2])};case 3:return function(c){return this.fromWireType(Ve[c>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Ju(i,a,c){switch(a){case 0:return c?function(v){return Ge[v]}:function(v){return Fe[v]};case 1:return c?function(v){return rt[v>>1]}:function(v){return lt[v>>1]};case 2:return c?function(v){return Le[v>>2]}:function(v){return Ue[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var wo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Xu=(i,a)=>{for(var c=i>>1,v=c+a/2;!(c>=v)&&lt[c];)++c;if(c<<=1,32<c-i&&wo)return wo.decode(Fe.subarray(i,c));for(c="",v=0;!(v>=a/2);++v){var y=rt[i+2*v>>1];if(y==0)break;c+=String.fromCharCode(y)}return c},Qu=(i,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*i.length?c/2:i.length;for(var y=0;y<c;++y)rt[a>>1]=i.charCodeAt(y),a+=2;return rt[a>>1]=0,a-v},Zu=i=>2*i.length,ec=(i,a)=>{for(var c=0,v="";!(c>=a/4);){var y=Le[i+4*c>>2];if(y==0)break;++c,65536<=y?(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023)):v+=String.fromCharCode(y)}return v},tc=(i,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var y=0;y<i.length;++y){var E=i.charCodeAt(y);if(55296<=E&&57343>=E){var x=i.charCodeAt(++y);E=65536+((E&1023)<<10)|x&1023}if(Le[a>>2]=E,a+=4,a+4>c)break}return Le[a>>2]=0,a-v},rc=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a},nc={};function Ji(i){var a=nc[i];return a===void 0?Pt(i):a}var Xi=[];function ic(i){var a=Xi.length;return Xi.push(i),a}function sc(i,a){for(var c=Array(i),v=0;v<i;++v)c[v]=fi(Ue[a+4*v>>2],"parameter "+v);return c}var bo=[],Ns=[],Bs={},ko=()=>{if(!Ws){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:W||"./this.program"},a;for(a in Bs)Bs[a]===void 0?delete i[a]:i[a]=Bs[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);Ws=c}return Ws},Ws,Qi=i=>i%4===0&&(i%100!==0||i%400===0),Eo=[31,29,31,30,31,30,31,31,30,31,30,31],Io=[31,28,31,30,31,30,31,31,30,31,30,31],ac=(i,a,c,v)=>{function y(j,re,X){for(j=typeof j=="number"?j.toString():j||"";j.length<re;)j=X[0]+j;return j}function E(j,re){return y(j,re,"0")}function x(j,re){function X(Ye){return 0>Ye?-1:0<Ye?1:0}var He;return(He=X(j.getFullYear()-re.getFullYear()))===0&&(He=X(j.getMonth()-re.getMonth()))===0&&(He=X(j.getDate()-re.getDate())),He}function $(j){switch(j.getDay()){case 0:return new Date(j.getFullYear()-1,11,29);case 1:return j;case 2:return new Date(j.getFullYear(),0,3);case 3:return new Date(j.getFullYear(),0,2);case 4:return new Date(j.getFullYear(),0,1);case 5:return new Date(j.getFullYear()-1,11,31);case 6:return new Date(j.getFullYear()-1,11,30)}}function V(j){var re=j.ca;for(j=new Date(new Date(j.da+1900,0,1).getTime());0<re;){var X=j.getMonth(),He=(Qi(j.getFullYear())?Eo:Io)[X];if(re>He-j.getDate())re-=He-j.getDate()+1,j.setDate(1),11>X?j.setMonth(X+1):(j.setMonth(0),j.setFullYear(j.getFullYear()+1));else{j.setDate(j.getDate()+re);break}}return X=new Date(j.getFullYear()+1,0,4),re=$(new Date(j.getFullYear(),0,4)),X=$(X),0>=x(re,j)?0>=x(X,j)?j.getFullYear()+1:j.getFullYear():j.getFullYear()-1}var O=Le[v+40>>2];v={wc:Le[v>>2],vc:Le[v+4>>2],Fa:Le[v+8>>2],Sa:Le[v+12>>2],Ga:Le[v+16>>2],da:Le[v+20>>2],R:Le[v+24>>2],ca:Le[v+28>>2],Rc:Le[v+32>>2],uc:Le[v+36>>2],xc:O&&O?de(Fe,O):""},c=c?de(Fe,c):"",O={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ne in O)c=c.replace(new RegExp(ne,"g"),O[ne]);var se="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ye="January February March April May June July August September October November December".split(" ");O={"%a":j=>se[j.R].substring(0,3),"%A":j=>se[j.R],"%b":j=>ye[j.Ga].substring(0,3),"%B":j=>ye[j.Ga],"%C":j=>E((j.da+1900)/100|0,2),"%d":j=>E(j.Sa,2),"%e":j=>y(j.Sa,2," "),"%g":j=>V(j).toString().substring(2),"%G":j=>V(j),"%H":j=>E(j.Fa,2),"%I":j=>(j=j.Fa,j==0?j=12:12<j&&(j-=12),E(j,2)),"%j":j=>{for(var re=0,X=0;X<=j.Ga-1;re+=(Qi(j.da+1900)?Eo:Io)[X++]);return E(j.Sa+re,3)},"%m":j=>E(j.Ga+1,2),"%M":j=>E(j.vc,2),"%n":()=>`
`,"%p":j=>0<=j.Fa&&12>j.Fa?"AM":"PM","%S":j=>E(j.wc,2),"%t":()=>"	","%u":j=>j.R||7,"%U":j=>E(Math.floor((j.ca+7-j.R)/7),2),"%V":j=>{var re=Math.floor((j.ca+7-(j.R+6)%7)/7);if(2>=(j.R+371-j.ca-2)%7&&re++,re)re==53&&(X=(j.R+371-j.ca)%7,X==4||X==3&&Qi(j.da)||(re=1));else{re=52;var X=(j.R+7-j.ca-1)%7;(X==4||X==5&&Qi(j.da%400-1))&&re++}return E(re,2)},"%w":j=>j.R,"%W":j=>E(Math.floor((j.ca+7-(j.R+6)%7)/7),2),"%y":j=>(j.da+1900).toString().substring(2),"%Y":j=>j.da+1900,"%z":j=>{j=j.uc;var re=0<=j;return j=Math.abs(j)/60,(re?"+":"-")+("0000"+(j/60*100+j%60)).slice(-4)},"%Z":j=>j.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(ne in O)c.includes(ne)&&(c=c.replace(new RegExp(ne,"g"),O[ne](v)));return c=c.replace(/\0\0/g,"%"),ne=ht(c,!1),ne.length>a?0:(Ge.set(ne,i),ne.length-1)};function So(i,a,c,v){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=$u++,this.name=a,this.mode=c,this.l={},this.m={},this.za=v}Object.defineProperties(So.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),no(),oi=Array(4096),to(Pe,"/"),cr("/tmp",16895,0),cr("/home",16895,0),cr("/home/web_user",16895,0),(()=>{cr("/dev",16895,0),xs(259,{read:()=>0,write:(v,y,E,x)=>x}),Di("/dev/null",259),mt(1280,bt),mt(1536,yt),Di("/dev/tty",1280),Di("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=H(i).byteLength),i[--a]);li("random",c),li("urandom",c),cr("/dev/shm",16895,0),cr("/dev/shm/tmp",16895,0)})(),(()=>{cr("/proc",16895,0);var i=cr("/proc/self",16895,0);cr("/proc/self/fd",16895,0),to({U:()=>{var a=Xa(i,"fd",16895,73);return a.l={ka:(c,v)=>{var y=Wr(+v);return c={parent:null,U:{nb:"fake"},l:{ma:()=>y.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(ao.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),An=p.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},sr.M.push({value:void 0},{value:null},{value:!0},{value:!1}),sr.h=sr.M.length,p.count_emval_handles=function(){for(var i=0,a=sr.h;a<sr.M.length;++a)sr.M[a]!==void 0&&++i;return i},lo=p.PureVirtualError=oo("PureVirtualError");for(var Ao=Array(256),Zi=0;256>Zi;++Zi)Ao[Zi]=String.fromCharCode(Zi);uo=Ao,p.getInheritedInstanceCount=function(){return Object.keys(jr).length},p.getLiveInheritedInstances=function(){var i=[],a;for(a in jr)jr.hasOwnProperty(a)&&i.push(jr[a]);return i},p.flushPendingDeletes=Rs,p.setDelayFunction=function(i){hi=i,di.length&&hi&&hi(Rs)},po=p.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},Vr.prototype.isAliasOf=function(i){if(!(this instanceof Vr&&i instanceof Vr))return!1;var a=this.g.u.i,c=this.g.o,v=i.g.u.i;for(i=i.g.o;a.A;)c=a.na(c),a=a.A;for(;v.A;)i=v.na(i),v=v.A;return a===v&&c===i},Vr.prototype.clone=function(){if(this.g.o||Ls(this),this.g.ia)return this.g.count.value+=1,this;var i=Cn,a=Object,c=a.create,v=Object.getPrototypeOf(this),y=this.g;return i=i(c.call(a,v,{g:{value:{count:y.count,fa:y.fa,ia:y.ia,o:y.o,u:y.u,G:y.G,L:y.L}}})),i.g.count.value+=1,i.g.fa=!1,i},Vr.prototype.delete=function(){this.g.o||Ls(this),this.g.fa&&!this.g.ia&&qe("Object already scheduled for deletion"),Ni(this),ho(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Vr.prototype.isDeleted=function(){return!this.g.o},Vr.prototype.deleteLater=function(){return this.g.o||Ls(this),this.g.fa&&!this.g.ia&&qe("Object already scheduled for deletion"),di.push(this),di.length===1&&hi&&hi(Rs),this.g.fa=!0,this},Rr.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},Rr.prototype.bb=function(i){this.W&&this.W(i)},Rr.prototype.argPackAdvance=8,Rr.prototype.readValueFromPointer=pi,Rr.prototype.deleteObject=function(i){i!==null&&i.delete()},Rr.prototype.fromWireType=function(i){function a(){return this.ua?Wi(this.i.N,{u:this.nc,o:c,L:this,G:i}):Wi(this.i.N,{u:this,o:i})}var c=this.Vb(i);if(!c)return this.bb(i),null;var v=Bu(this.i,c);if(v!==void 0)return v.g.count.value===0?(v.g.o=c,v.g.G=i,v.clone()):(v=v.clone(),this.bb(i),v);if(v=this.i.Ub(c),v=vo[v],!v)return a.call(this);v=this.ta?v.Kb:v.pointerType;var y=fo(c,this.i,v.i);return y===null?a.call(this):this.ua?Wi(v.i.N,{u:v,o:y,L:this,G:i}):Wi(v.i.N,{u:v,o:y})},mo=p.UnboundTypeError=oo("UnboundTypeError");var Co={__syscall_fcntl64:function(i,a,c){ci=c;try{var v=Wr(i);switch(a){case 0:var y=Pr();return 0>y?-28:eo(v,y).X;case 1:case 2:return 0;case 3:return v.flags;case 4:return y=Pr(),v.flags|=y,0;case 5:return y=Pr(),rt[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Le[To()>>2]=28,-1;default:return-28}}catch(E){if(typeof nn>"u"||E.name!=="ErrnoError")throw E;return-E.aa}},__syscall_ioctl:function(i,a,c){ci=c;try{var v=Wr(i);switch(a){case 21509:return v.s?0:-59;case 21505:if(!v.s)return-59;if(v.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var y=Pr();Le[y>>2]=25856,Le[y+4>>2]=5,Le[y+8>>2]=191,Le[y+12>>2]=35387;for(var E=0;32>E;E++)Ge[y+E+17>>0]=a[E]||0}return 0;case 21510:case 21511:case 21512:return v.s?0:-59;case 21506:case 21507:case 21508:if(!v.s)return-59;if(v.s.V.cc)for(y=Pr(),a=[],E=0;32>E;E++)a.push(Ge[y+E+17>>0]);return 0;case 21519:return v.s?(y=Pr(),Le[y>>2]=0):-59;case 21520:return v.s?-28:-59;case 21531:if(y=Pr(),!v.m.ac)throw new ke(59);return v.m.ac(v,a,y);case 21523:return v.s?(v.s.V.dc&&(E=[24,80],y=Pr(),rt[y>>1]=E[0],rt[y+2>>1]=E[1]),0):-59;case 21524:return v.s?0:-59;case 21515:return v.s?0:-59;default:return-28}}catch(x){if(typeof nn>"u"||x.name!=="ErrnoError")throw x;return-x.aa}},__syscall_openat:function(i,a,c,v){ci=v;try{a=a?de(Fe,a):"";var y=a;if(y.charAt(0)==="/")a=y;else{var E=i===-100?"/":Wr(i).path;if(y.length==0)throw new ke(44);a=P(E+"/"+y)}var x=v?Pr():0;return $i(a,c,x).X}catch($){if(typeof nn>"u"||$.name!=="ErrnoError")throw $;return-$.aa}},_embind_create_inheriting_constructor:function(i,a,c){i=Pt(i),a=fi(a,"wrapper"),c=dr(c);var v=[].slice,y=a.i,E=y.N,x=y.A.N,$=y.A.constructor;i=Ui(i,function(){y.A.rb.forEach((function(O){if(this[O]===x[O])throw new lo(`Pure virtual function ${O} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:E}),this.__construct.apply(this,v.call(arguments))}),E.__construct=function(){this===E&&qe("Pass correct 'this' to __construct");var O=$.implement.apply(void 0,[this].concat(v.call(arguments)));Ni(O);var ne=O.g;O.notifyOnDestruction(),ne.ia=!0,Object.defineProperties(this,{g:{value:ne}}),Cn(this),O=ne.o,O=Os(y,O),jr.hasOwnProperty(O)?qe(`Tried to register registered instance: ${O}`):jr[O]=this},E.__destruct=function(){this===E&&qe("Pass correct 'this' to __destruct"),Ni(this);var O=this.g.o;O=Os(y,O),jr.hasOwnProperty(O)?delete jr[O]:qe(`Tried to unregister unregistered instance: ${O}`)},i.prototype=Object.create(E);for(var V in c)i.prototype[V]=c[V];return hr(i)},_embind_finalize_value_object:function(i){var a=Vi[i];delete Vi[i];var c=a.Pa,v=a.W,y=a.fb,E=y.map(x=>x.Yb).concat(y.map(x=>x.rc));tr([i],E,x=>{var $={};return y.forEach((V,O)=>{var ne=x[O],se=V.Wb,ye=V.Xb,j=x[O+y.length],re=V.qc,X=V.sc;$[V.Sb]={read:He=>ne.fromWireType(se(ye,He)),write:(He,Ye)=>{var he=[];re(X,He,j.toWireType(he,Ye)),vi(he)}}}),[{name:a.name,fromWireType:function(V){var O={},ne;for(ne in $)O[ne]=$[ne].read(V);return v(V),O},toWireType:function(V,O){for(var ne in $)if(!(ne in O))throw new TypeError(`Missing field: "${ne}"`);var se=c();for(ne in $)$[ne].write(se,O[ne]);return V!==null&&V.push(v,se),se},argPackAdvance:8,readValueFromPointer:pi,K:v}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,c,v,y){var E=Hi(c);a=Pt(a),wr(i,{name:a,fromWireType:function(x){return!!x},toWireType:function(x,$){return $?v:y},argPackAdvance:8,readValueFromPointer:function(x){if(c===1)var $=Ge;else if(c===2)$=rt;else if(c===4)$=Le;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType($[x>>E])},K:null})},_embind_register_class:function(i,a,c,v,y,E,x,$,V,O,ne,se,ye){ne=Pt(ne),E=Ht(y,E),$&&($=Ht(x,$)),O&&(O=Ht(V,O)),ye=Ht(se,ye);var j=so(ne);$s(j,function(){Or(`Cannot construct ${ne} due to unbound types`,[v])}),tr([i,a,c],v?[v]:[],function(re){if(re=re[0],v)var X=re.i,He=X.N;else He=Vr.prototype;re=Ui(j,function(){if(Object.getPrototypeOf(this)!==Ye)throw new An("Use 'new' to construct "+ne);if(he.$===void 0)throw new An(ne+" has no accessible constructor");var Bt=he.$[arguments.length];if(Bt===void 0)throw new An(`Tried to invoke ctor of ${ne} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(he.$).toString()}) parameters instead!`);return Bt.apply(this,arguments)});var Ye=Object.create(He,{constructor:{value:re}});re.prototype=Ye;var he=new Vu(ne,re,Ye,ye,X,E,$,O);he.A&&(he.A.oa===void 0&&(he.A.oa=[]),he.A.oa.push(he)),X=new Rr(ne,he,!0,!1),He=new Rr(ne+"*",he,!1,!1);var St=new Rr(ne+" const*",he,!1,!0);return vo[i]={pointerType:He,Kb:St},go(j,re),[X,He,St]})},_embind_register_class_class_function:function(i,a,c,v,y,E,x){var $=Yi(c,v);a=Pt(a),E=Ht(y,E),tr([],[i],function(V){function O(){Or(`Cannot call ${ne} due to unbound types`,$)}V=V[0];var ne=`${V.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var se=V.i.constructor;return se[a]===void 0?(O.ea=c-1,se[a]=O):(Ds(se,a,ne),se[a].B[c-1]=O),tr([],$,function(ye){if(ye=Ki(ne,[ye[0],null].concat(ye.slice(1)),null,E,x),se[a].B===void 0?(ye.ea=c-1,se[a]=ye):se[a].B[c-1]=ye,V.i.oa)for(const j of V.i.oa)j.constructor.hasOwnProperty(a)||(j.constructor[a]=ye);return[]}),[]})},_embind_register_class_class_property:function(i,a,c,v,y,E,x,$){a=Pt(a),E=Ht(y,E),tr([],[i],function(V){V=V[0];var O=`${V.name}.${a}`,ne={get(){Or(`Cannot access ${O} due to unbound types`,[c])},enumerable:!0,configurable:!0};return ne.set=$?()=>{Or(`Cannot access ${O} due to unbound types`,[c])}:()=>{qe(`${O} is a read-only property`)},Object.defineProperty(V.i.constructor,a,ne),tr([],[c],function(se){se=se[0];var ye={get(){return se.fromWireType(E(v))},enumerable:!0};return $&&($=Ht(x,$),ye.set=j=>{var re=[];$(v,se.toWireType(re,j)),vi(re)}),Object.defineProperty(V.i.constructor,a,ye),[]}),[]})},_embind_register_class_constructor:function(i,a,c,v,y,E){var x=Yi(a,c);y=Ht(v,y),tr([],[i],function($){$=$[0];var V=`constructor ${$.name}`;if($.i.$===void 0&&($.i.$=[]),$.i.$[a-1]!==void 0)throw new An(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${$.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return $.i.$[a-1]=()=>{Or(`Cannot construct ${$.name} due to unbound types`,x)},tr([],x,function(O){return O.splice(1,0,null),$.i.$[a-1]=Ki(V,O,null,y,E),[]}),[]})},_embind_register_class_function:function(i,a,c,v,y,E,x,$){var V=Yi(c,v);a=Pt(a),E=Ht(y,E),tr([],[i],function(O){function ne(){Or(`Cannot call ${se} due to unbound types`,V)}O=O[0];var se=`${O.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),$&&O.i.rb.push(a);var ye=O.i.N,j=ye[a];return j===void 0||j.B===void 0&&j.className!==O.name&&j.ea===c-2?(ne.ea=c-2,ne.className=O.name,ye[a]=ne):(Ds(ye,a,se),ye[a].B[c-2]=ne),tr([],V,function(re){return re=Ki(se,re,O,E,x),ye[a].B===void 0?(re.ea=c-2,ye[a]=re):ye[a].B[c-2]=re,[]}),[]})},_embind_register_class_property:function(i,a,c,v,y,E,x,$,V,O){a=Pt(a),y=Ht(v,y),tr([],[i],function(ne){ne=ne[0];var se=`${ne.name}.${a}`,ye={get(){Or(`Cannot access ${se} due to unbound types`,[c,x])},enumerable:!0,configurable:!0};return ye.set=V?()=>{Or(`Cannot access ${se} due to unbound types`,[c,x])}:()=>{qe(se+" is a read-only property")},Object.defineProperty(ne.i.N,a,ye),tr([],V?[c,x]:[c],function(j){var re=j[0],X={get(){var Ye=yo(this,ne,se+" getter");return re.fromWireType(y(E,Ye))},enumerable:!0};if(V){V=Ht($,V);var He=j[1];X.set=function(Ye){var he=yo(this,ne,se+" setter"),St=[];V(O,he,He.toWireType(St,Ye)),vi(St)}}return Object.defineProperty(ne.i.N,a,X),[]}),[]})},_embind_register_emval:function(i,a){a=Pt(a),wr(i,{name:a,fromWireType:function(c){var v=dr(c);return Fs(c),v},toWireType:function(c,v){return hr(v)},argPackAdvance:8,readValueFromPointer:pi,K:null})},_embind_register_enum:function(i,a,c,v){function y(){}c=Hi(c),a=Pt(a),y.values={},wr(i,{name:a,constructor:y,fromWireType:function(E){return this.constructor.values[E]},toWireType:function(E,x){return x.value},argPackAdvance:8,readValueFromPointer:Ku(a,c,v),K:null}),$s(a,y)},_embind_register_enum_value:function(i,a,c){var v=fi(i,"enum");a=Pt(a),i=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:Ui(`${v.name}_${a}`,function(){})}}),i.values[c]=v,i[a]=v},_embind_register_float:function(i,a,c){c=Hi(c),a=Pt(a),wr(i,{name:a,fromWireType:function(v){return v},toWireType:function(v,y){return y},argPackAdvance:8,readValueFromPointer:Yu(a,c),K:null})},_embind_register_function:function(i,a,c,v,y,E){var x=Yi(a,c);i=Pt(i),y=Ht(v,y),$s(i,function(){Or(`Cannot call ${i} due to unbound types`,x)},a-1),tr([],x,function($){return go(i,Ki(i,[$[0],null].concat($.slice(1)),null,y,E),a-1),[]})},_embind_register_integer:function(i,a,c,v,y){a=Pt(a),y===-1&&(y=4294967295),y=Hi(c);var E=$=>$;if(v===0){var x=32-8*c;E=$=>$<<x>>>x}c=a.includes("unsigned")?function($,V){return V>>>0}:function($,V){return V},wr(i,{name:a,fromWireType:E,toWireType:c,argPackAdvance:8,readValueFromPointer:Ju(a,y,v!==0),K:null})},_embind_register_memory_view:function(i,a,c){function v(E){E>>=2;var x=Ue;return new y(x.buffer,x[E+1],x[E])}var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Pt(c),wr(i,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{$b:!0})},_embind_register_std_string:function(i,a){a=Pt(a);var c=a==="std::string";wr(i,{name:a,fromWireType:function(v){var y=Ue[v>>2],E=v+4;if(c)for(var x=E,$=0;$<=y;++$){var V=E+$;if($==y||Fe[V]==0){if(x=x?de(Fe,x,V-x):"",O===void 0)var O=x;else O+="\0",O+=x;x=V+1}}else{for(O=Array(y),$=0;$<y;++$)O[$]=String.fromCharCode(Fe[E+$]);O=O.join("")}return Mr(v),O},toWireType:function(v,y){y instanceof ArrayBuffer&&(y=new Uint8Array(y));var E=typeof y=="string";E||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Int8Array||qe("Cannot pass non-string to std::string");var x=c&&E?ve(y):y.length,$=Vs(4+x+1),V=$+4;if(Ue[$>>2]=x,c&&E)$e(y,Fe,V,x+1);else if(E)for(E=0;E<x;++E){var O=y.charCodeAt(E);255<O&&(Mr(V),qe("String has UTF-16 code units that do not fit in 8 bits")),Fe[V+E]=O}else for(E=0;E<x;++E)Fe[V+E]=y[E];return v!==null&&v.push(Mr,$),$},argPackAdvance:8,readValueFromPointer:pi,K:function(v){Mr(v)}})},_embind_register_std_wstring:function(i,a,c){if(c=Pt(c),a===2)var v=Xu,y=Qu,E=Zu,x=()=>lt,$=1;else a===4&&(v=ec,y=tc,E=rc,x=()=>Ue,$=2);wr(i,{name:c,fromWireType:function(V){for(var O=Ue[V>>2],ne=x(),se,ye=V+4,j=0;j<=O;++j){var re=V+4+j*a;(j==O||ne[re>>$]==0)&&(ye=v(ye,re-ye),se===void 0?se=ye:(se+="\0",se+=ye),ye=re+a)}return Mr(V),se},toWireType:function(V,O){typeof O!="string"&&qe(`Cannot pass non-string to C++ string type ${c}`);var ne=E(O),se=Vs(4+ne+a);return Ue[se>>2]=ne>>$,y(O,se+4,ne+a),V!==null&&V.push(Mr,se),se},argPackAdvance:8,readValueFromPointer:pi,K:function(V){Mr(V)}})},_embind_register_value_object:function(i,a,c,v,y,E){Vi[i]={name:Pt(a),Pa:Ht(c,v),W:Ht(y,E),fb:[]}},_embind_register_value_object_field:function(i,a,c,v,y,E,x,$,V,O){Vi[i].fb.push({Sb:Pt(a),Yb:c,Wb:Ht(v,y),Xb:E,rc:x,qc:Ht($,V),sc:O})},_embind_register_void:function(i,a){a=Pt(a),wr(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,c){i=dr(i),a=fi(a,"emval::as");var v=[],y=hr(v);return Ue[c>>2]=y,a.toWireType(v,i)},_emval_call_method:function(i,a,c,v,y){i=Xi[i],a=dr(a),c=Ji(c);var E=[];return Ue[v>>2]=hr(E),i(a,c,E,y)},_emval_call_void_method:function(i,a,c,v){i=Xi[i],a=dr(a),c=Ji(c),i(a,c,null,v)},_emval_decref:Fs,_emval_get_method_caller:function(i,a){var c=sc(i,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(x){return x.name}).join("_")+"$";var y=bo[a];if(y!==void 0)return y;var E=Array(i-1);return y=ic((x,$,V,O)=>{for(var ne=0,se=0;se<i-1;++se)E[se]=c[se+1].readValueFromPointer(O+ne),ne+=c[se+1].argPackAdvance;for(x=x[$].apply(x,E),se=0;se<i-1;++se)c[se+1].Nb&&c[se+1].Nb(E[se]);if(!v.fc)return v.toWireType(V,x)}),bo[a]=y},_emval_get_module_property:function(i){return i=Ji(i),hr(p[i])},_emval_get_property:function(i,a){return i=dr(i),a=dr(a),hr(i[a])},_emval_incref:function(i){4<i&&(sr.get(i).ub+=1)},_emval_new_array:function(){return hr([])},_emval_new_cstring:function(i){return hr(Ji(i))},_emval_new_object:function(){return hr({})},_emval_run_destructors:function(i){var a=dr(i);vi(a),Fs(i)},_emval_set_property:function(i,a,c){i=dr(i),a=dr(a),c=dr(c),i[a]=c},_emval_take_value:function(i,a){return i=fi(i,"_emval_take_value"),i=i.readValueFromPointer(a),hr(i)},abort:()=>{Ke("")},emscripten_asm_const_int:(i,a,c)=>{Ns.length=0;var v;for(c>>=2;v=Fe[a++];)c+=v!=105&c,Ns.push(v==105?Le[c]:Ve[c++>>1]),++c;return o[i].apply(null,Ns)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,c)=>Fe.copyWithin(i,a,a+c),emscripten_resize_heap:i=>{var a=Fe.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,i+100663296);var y=Math;v=Math.max(i,v);e:{y=y.min.call(y,2147483648,v+(65536-v%65536)%65536)-Te.buffer.byteLength+65535>>>16;try{Te.grow(y),It();var E=1;break e}catch{}E=void 0}if(E)return!0}return!1},environ_get:(i,a)=>{var c=0;return ko().forEach(function(v,y){var E=a+c;for(y=Ue[i+4*y>>2]=E,E=0;E<v.length;++E)Ge[y++>>0]=v.charCodeAt(E);Ge[y>>0]=0,c+=v.length+1}),0},environ_sizes_get:(i,a)=>{var c=ko();Ue[i>>2]=c.length;var v=0;return c.forEach(function(y){v+=y.length+1}),Ue[a>>2]=v,0},fd_close:function(i){try{var a=Wr(i);if(a.X===null)throw new ke(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Oi[a.X]=null}return a.X=null,0}catch(c){if(typeof nn>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(i,a,c,v){try{e:{var y=Wr(i);i=a;for(var E,x=a=0;x<c;x++){var $=Ue[i>>2],V=Ue[i+4>>2];i+=8;var O=y,ne=$,se=V,ye=E,j=Ge;if(0>se||0>ye)throw new ke(28);if(O.X===null)throw new ke(8);if((O.flags&2097155)===1)throw new ke(8);if((O.node.mode&61440)===16384)throw new ke(31);if(!O.m.read)throw new ke(28);var re=typeof ye<"u";if(!re)ye=O.position;else if(!O.seekable)throw new ke(70);var X=O.m.read(O,j,ne,se,ye);re||(O.position+=X);var He=X;if(0>He){var Ye=-1;break e}if(a+=He,He<V)break;typeof E<"u"&&(E+=He)}Ye=a}return Ue[v>>2]=Ye,0}catch(he){if(typeof nn>"u"||he.name!=="ErrnoError")throw he;return he.aa}},fd_seek:function(i,a,c,v,y){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var E=Wr(i);return ro(E,a,v),g=[E.position>>>0,(Qe=E.position,1<=+Math.abs(Qe)?0<Qe?+Math.floor(Qe/4294967296)>>>0:~~+Math.ceil((Qe-+(~~Qe>>>0))/4294967296)>>>0:0)],Le[y>>2]=g[0],Le[y+4>>2]=g[1],E.Ma&&a===0&&v===0&&(E.Ma=null),0}catch(x){if(typeof nn>"u"||x.name!=="ErrnoError")throw x;return x.aa}},fd_write:function(i,a,c,v){try{e:{var y=Wr(i);i=a;for(var E,x=a=0;x<c;x++){var $=Ue[i>>2],V=Ue[i+4>>2];i+=8;var O=y,ne=$,se=V,ye=E,j=Ge;if(0>se||0>ye)throw new ke(28);if(O.X===null)throw new ke(8);if((O.flags&2097155)===0)throw new ke(8);if((O.node.mode&61440)===16384)throw new ke(31);if(!O.m.write)throw new ke(28);O.seekable&&O.flags&1024&&ro(O,0,2);var re=typeof ye<"u";if(!re)ye=O.position;else if(!O.seekable)throw new ke(70);var X=O.m.write(O,j,ne,se,ye,void 0);re||(O.position+=X);var He=X;if(0>He){var Ye=-1;break e}a+=He,typeof E<"u"&&(E+=He)}Ye=a}return Ue[v>>2]=Ye,0}catch(he){if(typeof nn>"u"||he.name!=="ErrnoError")throw he;return he.aa}},strftime_l:(i,a,c,v)=>ac(i,a,c,v)};(function(){function i(c){if(be=c=c.exports,Te=be.memory,It(),_e=be.__indirect_function_table,ue.unshift(be.__wasm_call_ctors),Re--,p.monitorRunDependencies&&p.monitorRunDependencies(Re),Re==0&&Je){var v=Je;Je=null,v()}return c}var a={env:Co,wasi_snapshot_preview1:Co};if(Re++,p.monitorRunDependencies&&p.monitorRunDependencies(Re),p.instantiateWasm)try{return p.instantiateWasm(a,i)}catch(c){Me("Module.instantiateWasm callback failed with error: "+c),U(c)}return xt(a,function(c){i(c.instance)}).catch(U),{}})();var Mr=i=>(Mr=be.free)(i),Vs=i=>(Vs=be.malloc)(i),To=()=>(To=be.__errno_location)(),xo=p._ma_device__on_notification_unlocked=i=>(xo=p._ma_device__on_notification_unlocked=be.ma_device__on_notification_unlocked)(i);p._ma_malloc_emscripten=(i,a)=>(p._ma_malloc_emscripten=be.ma_malloc_emscripten)(i,a),p._ma_free_emscripten=(i,a)=>(p._ma_free_emscripten=be.ma_free_emscripten)(i,a);var Po=p._ma_device_process_pcm_frames_capture__webaudio=(i,a,c)=>(Po=p._ma_device_process_pcm_frames_capture__webaudio=be.ma_device_process_pcm_frames_capture__webaudio)(i,a,c),jo=p._ma_device_process_pcm_frames_playback__webaudio=(i,a,c)=>(jo=p._ma_device_process_pcm_frames_playback__webaudio=be.ma_device_process_pcm_frames_playback__webaudio)(i,a,c),Ro=i=>(Ro=be.__getTypeName)(i);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=be._embind_initialize_bindings)(),p.dynCall_iiji=(i,a,c,v,y)=>(p.dynCall_iiji=be.dynCall_iiji)(i,a,c,v,y),p.dynCall_jiji=(i,a,c,v,y)=>(p.dynCall_jiji=be.dynCall_jiji)(i,a,c,v,y),p.dynCall_iiiji=(i,a,c,v,y,E)=>(p.dynCall_iiiji=be.dynCall_iiiji)(i,a,c,v,y,E),p.dynCall_iij=(i,a,c,v)=>(p.dynCall_iij=be.dynCall_iij)(i,a,c,v),p.dynCall_jii=(i,a,c)=>(p.dynCall_jii=be.dynCall_jii)(i,a,c),p.dynCall_viijii=(i,a,c,v,y,E,x)=>(p.dynCall_viijii=be.dynCall_viijii)(i,a,c,v,y,E,x),p.dynCall_iiiiij=(i,a,c,v,y,E,x)=>(p.dynCall_iiiiij=be.dynCall_iiiiij)(i,a,c,v,y,E,x),p.dynCall_iiiiijj=(i,a,c,v,y,E,x,$,V)=>(p.dynCall_iiiiijj=be.dynCall_iiiiijj)(i,a,c,v,y,E,x,$,V),p.dynCall_iiiiiijj=(i,a,c,v,y,E,x,$,V,O)=>(p.dynCall_iiiiiijj=be.dynCall_iiiiiijj)(i,a,c,v,y,E,x,$,V,O);var es;Je=function i(){es||Oo(),es||(Je=i)};function Oo(){function i(){if(!es&&(es=!0,p.calledRun=!0,!ft)){if(p.noFSInit||io||(io=!0,no(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?li("stdin",p.stdin):Ps("/dev/tty","/dev/stdin"),p.stdout?li("stdout",null,p.stdout):Ps("/dev/tty","/dev/stdout"),p.stderr?li("stderr",null,p.stderr):Ps("/dev/tty1","/dev/stderr"),$i("/dev/stdin",0),$i("/dev/stdout",1),$i("/dev/stderr",1)),Ka=!1,d(ue),I(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var a=p.postRun.shift();oe.unshift(a)}d(oe)}}if(!(0<Re)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)xe();d(me),0<Re||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),i()},1)):i())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return Oo(),S.ready})})();const _=m}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m.Animation});var m=f(4)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>m});var m=(function(){function _(b,S,p,I){this.animation=b,this.artboard=S,this.playing=I,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(b,S)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(b){this.instance.time=b},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(b){this.scrubTo===null?this.instance.advance(b):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(b){this.instance.apply(b)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>b.AudioAssetWrapper,AudioWrapper:()=>b.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>b.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>b.FileAssetWrapper,Finalizable:()=>b.Finalizable,FontAssetWrapper:()=>b.FontAssetWrapper,FontWrapper:()=>b.FontWrapper,ImageAssetWrapper:()=>b.ImageAssetWrapper,ImageWrapper:()=>b.ImageWrapper,finalizationRegistry:()=>b.finalizationRegistry,registerTouchInteractions:()=>m.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var m=f(6),_=f(7),b=f(8)}),((u,h,f)=>{f.r(h),f.d(h,{registerTouchInteractions:()=>b});var m=void 0,_=function(S,p){var I,U;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((I=S.touches)===null||I===void 0)&&I.length)?(p||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((U=S.changedTouches)===null||U===void 0)&&U.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},b=function(S){var p=S.canvas,I=S.artboard,U=S.stateMachines,R=U===void 0?[]:U,B=S.renderer,q=S.rive,N=S.fit,K=S.alignment,J=S.isTouchScrollEnabled,D=J===void 0?!1:J,W=S.layoutScaleFactor,ae=W===void 0?1:W;if(!p||!R.length||!B||!q||!I||typeof window>"u")return null;var Q=null,we=!1,Z=function(Se){if(we&&Se instanceof MouseEvent){Se.type=="mouseup"&&(we=!1);return}we=D&&Se.type==="touchend"&&Q==="touchstart",Q=Se.type;var Me=Se.currentTarget.getBoundingClientRect(),ge=_(Se,D),Te=ge.clientX,be=ge.clientY;if(!(!Te&&!be)){var ft=Te-Me.left,Ge=be-Me.top,Fe=q.computeAlignment(N,K,{minX:0,minY:0,maxX:Me.width,maxY:Me.height},I.bounds,ae),rt=new q.Mat2D;Fe.invert(rt);var lt=new q.Vec2D(ft,Ge),Le=q.mapXY(rt,lt),Ue=Le.x(),_t=Le.y();switch(Le.delete(),rt.delete(),lt.delete(),Fe.delete(),Se.type){case"mouseout":for(var Ve=0,It=R;Ve<It.length;Ve++){var _e=It[Ve];_e.pointerMove(Ue,_t)}break;case"touchmove":case"mouseover":case"mousemove":{for(var me=0,ue=R;me<ue.length;me++){var _e=ue[me];_e.pointerMove(Ue,_t)}break}case"touchstart":case"mousedown":{for(var oe=0,xe=R;oe<xe.length;oe++){var _e=xe[oe];_e.pointerDown(Ue,_t)}break}case"touchend":case"mouseup":{for(var Re=0,Je=R;Re<Je.length;Re++){var _e=Je[Re];_e.pointerUp(Ue,_t)}break}}}},ee=Z.bind(m);return p.addEventListener("mouseover",ee),p.addEventListener("mouseout",ee),p.addEventListener("mousemove",ee),p.addEventListener("mousedown",ee),p.addEventListener("mouseup",ee),p.addEventListener("touchmove",ee,{passive:D}),p.addEventListener("touchstart",ee,{passive:D}),p.addEventListener("touchend",ee),function(){p.removeEventListener("mouseover",ee),p.removeEventListener("mouseout",ee),p.removeEventListener("mousemove",ee),p.removeEventListener("mousedown",ee),p.removeEventListener("mouseup",ee),p.removeEventListener("touchmove",ee),p.removeEventListener("touchstart",ee),p.removeEventListener("touchend",ee)}}}),((u,h,f)=>{f.r(h),f.d(h,{BLANK_URL:()=>U,sanitizeUrl:()=>q});var m=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,b=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,I=[".","/"],U="about:blank";function R(N){return I.indexOf(N[0])>-1}function B(N){var K=N.replace(S,"");return K.replace(_,function(J,D){return String.fromCharCode(D)})}function q(N){if(!N)return U;var K=B(N).replace(b,"").replace(S,"").trim();if(!K)return U;if(R(K))return K;var J=K.match(p);if(!J)return K;var D=J[0];return m.test(D)?U:K}}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>B,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>I,FileAssetWrapper:()=>U,Finalizable:()=>_,FontAssetWrapper:()=>q,FontWrapper:()=>p,ImageAssetWrapper:()=>R,ImageWrapper:()=>b,finalizationRegistry:()=>J});var m=(function(){var D=function(W,ae){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Q,we){Q.__proto__=we}||function(Q,we){for(var Z in we)Object.prototype.hasOwnProperty.call(we,Z)&&(Q[Z]=we[Z])},D(W,ae)};return function(W,ae){if(typeof ae!="function"&&ae!==null)throw new TypeError("Class extends value "+String(ae)+" is not a constructor or null");D(W,ae);function Q(){this.constructor=W}W.prototype=ae===null?Object.create(ae):(Q.prototype=ae.prototype,new Q)}})(),_=(function(){function D(){this.selfUnref=!1}return D})(),b=(function(D){m(W,D);function W(ae){var Q=D.call(this)||this;return Q._nativeImage=ae,Q}return Object.defineProperty(W.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},W})(_),S=(function(D){m(W,D);function W(ae){var Q=D.call(this)||this;return Q._nativeAudio=ae,Q}return Object.defineProperty(W.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},W})(_),p=(function(D){m(W,D);function W(ae){var Q=D.call(this)||this;return Q._nativeFont=ae,Q}return Object.defineProperty(W.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),W.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},W})(_),I=(function(){function D(W,ae){this._assetLoaderCallback=ae,this.assetLoader=new W.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return D.prototype.loadContents=function(W,ae){var Q;return W.isImage?Q=new R(W):W.isAudio?Q=new B(W):W.isFont&&(Q=new q(W)),this._assetLoaderCallback(Q,ae)},D})(),U=(function(){function D(W){this._nativeFileAsset=W}return D.prototype.decode=function(W){this._nativeFileAsset.decode(W)},Object.defineProperty(D.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),D})(),R=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setRenderImage=function(ae){this._nativeFileAsset.setRenderImage(ae.nativeImage)},W})(U),B=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setAudioSource=function(ae){this._nativeFileAsset.setAudioSource(ae.nativeAudio)},W})(U),q=(function(D){m(W,D);function W(){return D!==null&&D.apply(this,arguments)||this}return W.prototype.setFont=function(ae){this._nativeFileAsset.setFont(ae.nativeFont)},W})(U),N=(function(){function D(W){}return D.prototype.register=function(W){W.selfUnref=!0},D.prototype.unregister=function(W){},D})(),K=typeof FinalizationRegistry<"u"?FinalizationRegistry:N,J=new K(function(D){D.unref()})})],n={};function s(u){var h=n[u];if(h!==void 0)return h.exports;var f=n[u]={exports:{}};return t[u](f,f.exports,s),f.exports}s.d=(u,h)=>{for(var f in h)s.o(h,f)&&!s.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},s.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>q,DataEnum:()=>_t,EventType:()=>Z,Fit:()=>B,Layout:()=>N,LoopType:()=>ee,Rive:()=>Le,RiveEventType:()=>W,RiveFile:()=>lt,RuntimeLoader:()=>K,StateMachineInput:()=>D,StateMachineInputType:()=>J,Testing:()=>it,ViewModel:()=>Ue,ViewModelInstance:()=>It,ViewModelInstanceArtboard:()=>fe,ViewModelInstanceAssetImage:()=>ie,ViewModelInstanceBoolean:()=>oe,ViewModelInstanceColor:()=>Ke,ViewModelInstanceEnum:()=>Re,ViewModelInstanceList:()=>Je,ViewModelInstanceNumber:()=>ue,ViewModelInstanceString:()=>me,ViewModelInstanceTrigger:()=>xe,ViewModelInstanceValue:()=>_e,decodeAudio:()=>Tt,decodeFont:()=>Qe,decodeImage:()=>xt});var u=s(1),h=s(2),f=s(3),m=s(5),_=(function(){var g=function(o,d){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,P){k.__proto__=P}||function(k,P){for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(k[A]=P[A])},g(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");g(o,d);function k(){this.constructor=o}o.prototype=d===null?Object.create(d):(k.prototype=d.prototype,new k)}})(),b=function(){return b=Object.assign||function(g){for(var o,d=1,k=arguments.length;d<k;d++){o=arguments[d];for(var P in o)Object.prototype.hasOwnProperty.call(o,P)&&(g[P]=o[P])}return g},b.apply(this,arguments)},S=function(g,o,d,k){function P(A){return A instanceof d?A:new d(function(T){T(A)})}return new(d||(d=Promise))(function(A,T){function F(le){try{z(k.next(le))}catch(de){T(de)}}function H(le){try{z(k.throw(le))}catch(de){T(de)}}function z(le){le.done?A(le.value):P(le.value).then(F,H)}z((k=k.apply(g,o||[])).next())})},p=function(g,o){var d={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},k,P,A,T=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return T.next=F(0),T.throw=F(1),T.return=F(2),typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function F(z){return function(le){return H([z,le])}}function H(z){if(k)throw new TypeError("Generator is already executing.");for(;T&&(T=0,z[0]&&(d=0)),d;)try{if(k=1,P&&(A=z[0]&2?P.return:z[0]?P.throw||((A=P.return)&&A.call(P),0):P.next)&&!(A=A.call(P,z[1])).done)return A;switch(P=0,A&&(z=[z[0]&2,A.value]),z[0]){case 0:case 1:A=z;break;case 4:return d.label++,{value:z[1],done:!1};case 5:d.label++,P=z[1],z=[0];continue;case 7:z=d.ops.pop(),d.trys.pop();continue;default:if(A=d.trys,!(A=A.length>0&&A[A.length-1])&&(z[0]===6||z[0]===2)){d=0;continue}if(z[0]===3&&(!A||z[1]>A[0]&&z[1]<A[3])){d.label=z[1];break}if(z[0]===6&&d.label<A[1]){d.label=A[1],A=z;break}if(A&&d.label<A[2]){d.label=A[2],d.ops.push(z);break}A[2]&&d.ops.pop(),d.trys.pop();continue}z=o.call(g,d)}catch(le){z=[6,le],P=0}finally{k=A=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}},I=function(g,o,d){if(d||arguments.length===2)for(var k=0,P=o.length,A;k<P;k++)(A||!(k in o))&&(A||(A=Array.prototype.slice.call(o,0,k)),A[k]=o[k]);return g.concat(A||Array.prototype.slice.call(o))},U=(function(g){_(o,g);function o(){var d=g!==null&&g.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),R=function(g){return g&&g.isHandledError?g.message:"Problem loading file; may be corrupt!"},B;(function(g){g.Cover="cover",g.Contain="contain",g.Fill="fill",g.FitWidth="fitWidth",g.FitHeight="fitHeight",g.None="none",g.ScaleDown="scaleDown",g.Layout="layout"})(B||(B={}));var q;(function(g){g.Center="center",g.TopLeft="topLeft",g.TopCenter="topCenter",g.TopRight="topRight",g.CenterLeft="centerLeft",g.CenterRight="centerRight",g.BottomLeft="bottomLeft",g.BottomCenter="bottomCenter",g.BottomRight="bottomRight"})(q||(q={}));var N=(function(){function g(o){var d,k,P,A,T,F,H;this.fit=(d=o?.fit)!==null&&d!==void 0?d:B.Contain,this.alignment=(k=o?.alignment)!==null&&k!==void 0?k:q.Center,this.layoutScaleFactor=(P=o?.layoutScaleFactor)!==null&&P!==void 0?P:1,this.minX=(A=o?.minX)!==null&&A!==void 0?A:0,this.minY=(T=o?.minY)!==null&&T!==void 0?T:0,this.maxX=(F=o?.maxX)!==null&&F!==void 0?F:0,this.maxY=(H=o?.maxY)!==null&&H!==void 0?H:0}return g.new=function(o){var d=o.fit,k=o.alignment,P=o.minX,A=o.minY,T=o.maxX,F=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new g({fit:d,alignment:k,minX:P,minY:A,maxX:T,maxY:F})},g.prototype.copyWith=function(o){var d=o.fit,k=o.alignment,P=o.layoutScaleFactor,A=o.minX,T=o.minY,F=o.maxX,H=o.maxY;return new g({fit:d??this.fit,alignment:k??this.alignment,layoutScaleFactor:P??this.layoutScaleFactor,minX:A??this.minX,minY:T??this.minY,maxX:F??this.maxX,maxY:H??this.maxY})},g.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===B.Cover?d=o.Fit.cover:this.fit===B.Contain?d=o.Fit.contain:this.fit===B.Fill?d=o.Fit.fill:this.fit===B.FitWidth?d=o.Fit.fitWidth:this.fit===B.FitHeight?d=o.Fit.fitHeight:this.fit===B.ScaleDown?d=o.Fit.scaleDown:this.fit===B.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},g.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===q.TopLeft?d=o.Alignment.topLeft:this.alignment===q.TopCenter?d=o.Alignment.topCenter:this.alignment===q.TopRight?d=o.Alignment.topRight:this.alignment===q.CenterLeft?d=o.Alignment.centerLeft:this.alignment===q.CenterRight?d=o.Alignment.centerRight:this.alignment===q.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===q.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===q.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},g})(),K=(function(){function g(){}return g.loadRuntime=function(){u.default({locateFile:function(){return g.wasmURL}}).then(function(o){var d;for(g.runtime=o;g.callBackQueue.length>0;)(d=g.callBackQueue.shift())===null||d===void 0||d(g.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var k="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(g.wasmURL.toLowerCase()!==k)console.warn("Failed to load WASM from ".concat(g.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),g.setWasmUrl(k),g.loadRuntime();else{var P=["Could not load Rive WASM file from ".concat(g.wasmURL," or ").concat(k,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(P)}})},g.getInstance=function(o){g.isLoading||(g.isLoading=!0,g.loadRuntime()),g.runtime?o(g.runtime):g.callBackQueue.push(o)},g.awaitInstance=function(){return new Promise(function(o){return g.getInstance(function(d){return o(d)})})},g.setWasmUrl=function(o){g.wasmURL=o},g.getWasmUrl=function(){return g.wasmURL},g.isLoading=!1,g.callBackQueue=[],g.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),g})(),J;(function(g){g[g.Number=56]="Number",g[g.Trigger=58]="Trigger",g[g.Boolean=59]="Boolean"})(J||(J={}));var D=(function(){function g(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(g.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),g.prototype.fire=function(){this.type===J.Trigger&&this.runtimeInput.fire()},g.prototype.delete=function(){this.runtimeInput=null},g})(),W;(function(g){g[g.General=128]="General",g[g.OpenUrl=131]="OpenUrl"})(W||(W={}));var ae=(function(){function g(o){this.nativeArtboard=o}return g})(),Q=(function(){function g(o,d,k,P){this.stateMachine=o,this.playing=k,this.artboard=P,this.inputs=[],this.instance=new d.StateMachineInstance(o,P),this.initInputs(d)}return Object.defineProperty(g.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),g.prototype.advance=function(o){this.instance.advance(o)},g.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},g.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},g.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},g.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var k=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(k,o))}},g.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new D(J.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new D(J.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new D(J.Trigger,o.asTrigger())},g.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},g.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},g})(),we=(function(){function g(o,d,k,P,A){P===void 0&&(P=[]),A===void 0&&(A=[]),this.runtime=o,this.artboard=d,this.eventManager=k,this.animations=P,this.stateMachines=A}return g.prototype.add=function(o,d,k){if(k===void 0&&(k=!0),o=Xe(o),o.length===0)this.animations.forEach(function(ve){return ve.playing=d}),this.stateMachines.forEach(function(ve){return ve.playing=d});else for(var P=this.animations.map(function(ve){return ve.name}),A=this.stateMachines.map(function(ve){return ve.name}),T=0;T<o.length;T++){var F=P.indexOf(o[T]),H=A.indexOf(o[T]);if(F>=0||H>=0)F>=0?this.animations[F].playing=d:this.stateMachines[H].playing=d;else{var z=this.artboard.animationByName(o[T]);if(z){var le=new f.Animation(z,this.artboard,this.runtime,d);le.advance(0),le.apply(1),this.animations.push(le)}else{var de=this.artboard.stateMachineByName(o[T]);if(de){var ce=new Q(de,this.runtime,d,this.artboard);this.stateMachines.push(ce)}}}}return k&&(d?this.eventManager.fire({type:Z.Play,data:this.playing}):this.eventManager.fire({type:Z.Pause,data:this.paused})),d?this.playing:this.paused},g.prototype.initLinearAnimations=function(o,d){for(var k=this.animations.map(function(H){return H.name}),P=0;P<o.length;P++){var A=k.indexOf(o[P]);if(A>=0)this.animations[A].playing=d;else{var T=this.artboard.animationByName(o[P]);if(T){var F=new f.Animation(T,this.artboard,this.runtime,d);F.advance(0),F.apply(1),this.animations.push(F)}else console.error("Animation with name ".concat(o[P]," not found."))}}},g.prototype.initStateMachines=function(o,d){for(var k=this.stateMachines.map(function(H){return H.name}),P=0;P<o.length;P++){var A=k.indexOf(o[P]);if(A>=0)this.stateMachines[A].playing=d;else{var T=this.artboard.stateMachineByName(o[P]);if(T){var F=new Q(T,this.runtime,d,this.artboard);this.stateMachines.push(F),d||F.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[P]," not found.")),this.initLinearAnimations([o[P]],d)}}},g.prototype.play=function(o){return this.add(o,!0)},g.prototype.pause=function(o){return this.add(o,!1)},g.prototype.scrub=function(o,d){var k=this.animations.filter(function(P){return o.includes(P.name)});return k.forEach(function(P){return P.scrubTo=d}),k.map(function(P){return P.name})},Object.defineProperty(g.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),g.prototype.stop=function(o){var d=this;o=Xe(o);var k=[];if(o.length===0)k=this.animations.map(function(T){return T.name}).concat(this.stateMachines.map(function(T){return T.name})),this.animations.forEach(function(T){return T.cleanup()}),this.stateMachines.forEach(function(T){return T.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var P=this.animations.filter(function(T){return o.includes(T.name)});P.forEach(function(T){T.cleanup(),d.animations.splice(d.animations.indexOf(T),1)});var A=this.stateMachines.filter(function(T){return o.includes(T.name)});A.forEach(function(T){T.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(T),1)}),k=P.map(function(T){return T.name}).concat(A.map(function(T){return T.name}))}return this.eventManager.fire({type:Z.Stop,data:k}),k},Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),g.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var k;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([k=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([k=this.artboard.stateMachineByIndex(0).name],o,d)),k},g.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(P){return P.playing});o<d.length;o++){var k=d[o];k.loopValue===0&&k.loopCount?(k.loopCount=0,this.stop(k.name)):k.loopValue===1&&k.loopCount?(this.eventManager.fire({type:Z.Loop,data:{animation:k.name,type:ee.Loop}}),k.loopCount=0):k.loopValue===2&&k.loopCount>1&&(this.eventManager.fire({type:Z.Loop,data:{animation:k.name,type:ee.PingPong}}),k.loopCount=0)}},g.prototype.handleStateChanges=function(){for(var o=[],d=0,k=this.stateMachines.filter(function(A){return A.playing});d<k.length;d++){var P=k[d];o.push.apply(o,P.statesChanged)}o.length>0&&this.eventManager.fire({type:Z.StateChange,data:o})},g.prototype.handleAdvancing=function(o){this.eventManager.fire({type:Z.Advance,data:o})},g})(),Z;(function(g){g.Load="load",g.LoadError="loaderror",g.Play="play",g.Pause="pause",g.Stop="stop",g.Loop="loop",g.Draw="draw",g.Advance="advance",g.StateChange="statechange",g.RiveEvent="riveevent",g.AudioStatusChange="audiostatuschange"})(Z||(Z={}));var ee;(function(g){g.OneShot="oneshot",g.Loop="loop",g.PingPong="pingpong"})(ee||(ee={}));var Se=(function(){function g(o){o===void 0&&(o=[]),this.listeners=o}return g.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},g.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},g.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var k=this.listeners[d];if(k.type===o.type&&k.callback===o.callback){this.listeners.splice(d,1);break}}},g.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(k){return k.type===o}).forEach(function(k){return d.remove(k)}):this.listeners.splice(0,this.listeners.length)},g.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(k){return k.callback(o)})},g})(),Me=(function(){function g(o){this.eventManager=o,this.queue=[]}return g.prototype.add=function(o){this.queue.push(o)},g.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},g})(),ge;(function(g){g[g.AVAILABLE=0]="AVAILABLE",g[g.UNAVAILABLE=1]="UNAVAILABLE"})(ge||(ge={}));var Te=(function(g){_(o,g);function o(){var d=g!==null&&g.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=ge.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return p(this,function(k){return[2,new Promise(function(P){return setTimeout(P,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(k,P){return setTimeout(P,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:Z.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=ge.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===ge.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==ge.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,k=function(){return S(d,void 0,void 0,function(){return p(this,function(P){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",k,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===ge.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(Se),be=new Te,ft=(function(){function g(){}return g.prototype.observe=function(){},g.prototype.unobserve=function(){},g.prototype.disconnect=function(){},g})(),Ge=globalThis.ResizeObserver||ft,Fe=(function(){function g(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var k=o._elementsMap.get(d.target);k!==null?k.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new Ge(this._onObserved)}return g.prototype.add=function(o,d){var k={onResize:d,element:o};return this._elementsMap.set(o,k),this._resizeObserver.observe(o),k},g.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},g})(),rt=new Fe,lt=(function(){function g(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new Se,o.onLoad&&this.on(Z.Load,o.onLoad),o.onLoadError&&this.on(Z.LoadError,o.onLoadError)}return g.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,k,P,A;return p(this,function(T){switch(T.label){case 0:return this.src?(o=this,[4,Ce(this.src)]):[3,2];case 1:o.buffer=T.sent(),T.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(k=new m.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=k.assetLoader),P=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return P.file=T.sent(),this.destroyed?((A=this.file)===null||A===void 0||A.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Z.Load,data:this}):this.fireLoadError(g.fileLoadErrorMessage),[2])}})})},g.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return p(this,function(k){switch(k.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(g.missingErrorMessage),[2];k.label=1;case 1:return k.trys.push([1,4,,5]),o=this,[4,K.awaitInstance()];case 2:return o.runtime=k.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return k.sent(),[3,5];case 4:return d=k.sent(),this.fireLoadError(d instanceof Error?d.message:g.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},g.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:Z.LoadError,data:o}),new Error(o)},g.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},g.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},g.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},g.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},g.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new ae(d):null},g.missingErrorMessage="Rive source file or data buffer required",g.fileLoadErrorMessage="The file failed to load",g})(),Le=(function(){function g(o){var d=this,k;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(P){var A=d._hasZeroSize!==P;d._hasZeroSize=P,P?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():A&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=rt.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(k=o.layout)!==null&&k!==void 0?k:new N,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new Se,o.onLoad&&this.on(Z.Load,o.onLoad),o.onLoadError&&this.on(Z.LoadError,o.onLoadError),o.onPlay&&this.on(Z.Play,o.onPlay),o.onPause&&this.on(Z.Pause,o.onPause),o.onStop&&this.on(Z.Stop,o.onStop),o.onLoop&&this.on(Z.Loop,o.onLoop),o.onStateChange&&this.on(Z.StateChange,o.onStateChange),o.onAdvance&&this.on(Z.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(Z.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(Z.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(Z.Play,o.onplay),o.onpause&&!o.onPause&&this.on(Z.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(Z.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(Z.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(Z.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Me(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(g.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),g.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new g(o)},g.prototype.onSystemAudioChanged=function(){this.volume=this._volume},g.prototype.init=function(o){var d=this,k=o.src,P=o.buffer,A=o.riveFile,T=o.animations,F=o.stateMachines,H=o.artboard,z=o.autoplay,le=z===void 0?!1:z,de=o.useOffscreenRenderer,ce=de===void 0?!1:de,ve=o.autoBind,$e=ve===void 0?!1:ve;if(!this.destroyed){if(this.src=k,this.buffer=P,this.riveFile=A,!this.src&&!this.buffer&&!this.riveFile)throw new U(g.missingErrorMessage);var ht=Xe(T),De=Xe(F);this.loaded=!1,this.readyForPlaying=!1,K.awaitInstance().then(function(mt){d.destroyed||(d.runtime=mt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,ce),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(H,ht,De,le,$e).then(function(Be){if(Be)return d.setupRiveListeners()}).catch(function(Be){console.error(Be)}))}).catch(function(mt){console.error(mt)})}},g.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var k=(this.animator.stateMachines||[]).filter(function(A){return A.playing&&d.runtime.hasListeners(A.instance)}).map(function(A){return A.instance}),P=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(P=o.isTouchScrollEnabled),this.eventCleanup=(0,m.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:k,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:P,layoutScaleFactor:this._layout.layoutScaleFactor})}},g.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},g.prototype.initializeAudio=function(){var o=this,d;be.status==ge.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Z.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},be.add(this._audioEventListener),be.establishAudio())},g.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},g.prototype.initData=function(o,d,k,P,A){return S(this,void 0,void 0,function(){var T,F,H,z;return p(this,function(le){switch(le.label){case 0:return le.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(T=new lt({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=T,[4,T.init()]);case 1:if(le.sent(),this.destroyed)return T.destroyIfUnused(),[2,!1];le.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,k,P,A),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Z.Load,data:(z=this.src)!==null&&z!==void 0?z:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return F=le.sent(),H=R(F),console.warn(H),this.eventManager.fire({type:Z.LoadError,data:H}),[2,Promise.reject(H)];case 4:return[2]}})})},g.prototype.initArtboard=function(o,d,k,P,A){if(this.file){var T=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!T){var F="Invalid artboard name or no default artboard";console.warn(F),this.eventManager.fire({type:Z.LoadError,data:F});return}if(this.artboard=T,T.volume=this._volume*be.systemVolume,this.artboard.animationCount()<1){var F="Artboard has no animations";throw this.eventManager.fire({type:Z.LoadError,data:F}),F}this.animator=new we(this.runtime,this.artboard,this.eventManager);var H;if(d.length>0||k.length>0?(H=d.concat(k),this.animator.initLinearAnimations(d,P),this.animator.initStateMachines(k,P)):H=[this.animator.atLeastOne(P,!1)],this.taskQueue.add({event:{type:P?Z.Play:Z.Pause,data:H}}),A){var z=this.file.defaultArtboardViewModel(T);if(z!==null){var le=z.defaultInstance();if(le!==null){var de=new It(le,null);this.bindViewModelInstance(de)}}}}},g.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},g.prototype.draw=function(o,d){var k;this.frameRequestId=null;var P=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var A=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var T=this.animator.animations.filter(function(yr){return yr.playing||yr.needsScrub}).sort(function(yr){return yr.needsScrub?-1:1}),F=0,H=T;F<H.length;F++){var z=H[F];z.advance(A),z.instance.didLoop&&(z.loopCount+=1),z.apply(1)}for(var le=this.animator.stateMachines.filter(function(yr){return yr.playing}),de=0,ce=le;de<ce.length;de++){var ve=ce[de],$e=ve.reportedEventCount();if($e)for(var ht=0;ht<$e;ht++){var De=ve.reportedEventAt(ht);if(De)if(De.type===W.OpenUrl){if(this.eventManager.fire({type:Z.RiveEvent,data:De}),this.automaticallyHandleEvents){var mt=document.createElement("a"),Be=De,bt=Be.url,yt=Be.target,qt=(0,m.sanitizeUrl)(bt);bt&&mt.setAttribute("href",qt),yt&&mt.setAttribute("target",yt),qt&&qt!==m.BLANK_URL&&mt.click()}}else this.eventManager.fire({type:Z.RiveEvent,data:De})}ve.advanceAndApply(A)}this.animator.stateMachines.length==0&&this.artboard.advance(A);var Pe=this.renderer;Pe.clear(),Pe.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Pe),Pe.restore(),Pe.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(A),this.frameCount++;var ut=performance.now();for(this.frameTimes.push(ut),this.durations.push(ut-P);this.frameTimes[0]<=ut-1e3;)this.frameTimes.shift(),this.durations.shift();(k=this._viewModelInstance)===null||k===void 0||k.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},g.prototype.alignRenderer=function(){var o=this,d=o.renderer,k=o.runtime,P=o._layout,A=o.artboard;d.align(P.runtimeFit(k),P.runtimeAlignment(k),{minX:P.minX,minY:P.minY,maxX:P.maxX,maxY:P.maxY},A.bounds,this._devicePixelRatioUsed*P.layoutScaleFactor)},Object.defineProperty(g.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),g.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&rt.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(be.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},g.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},g.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},g.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var k=this.artboard.textRun(o);if(!k){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return k},g.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},g.prototype.setTextRunValue=function(o,d){var k=this.retrieveTextRun(o);k&&(k.text=d)},g.prototype.play=function(o,d){var k=this;if(o=Xe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},g.prototype.pause=function(o){var d=this;if(o=Xe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},g.prototype.scrub=function(o,d){var k=this;if(o=Xe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},g.prototype.stop=function(o){var d=this;if(o=Xe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},g.prototype.reset=function(o){var d,k,P=o?.artboard,A=Xe(o?.animations),T=Xe(o?.stateMachines),F=(d=o?.autoplay)!==null&&d!==void 0?d:!1,H=(k=o?.autoBind)!==null&&k!==void 0?k:!1;this.cleanupInstances(),this.initArtboard(P,A,T,F,H),this.taskQueue.process()},g.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),g.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},g.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),k=d.width,P=d.height,A=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=A,this.canvas.width=A*k,this.canvas.height=A*P,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===B.Layout){var T=this._layout.layoutScaleFactor;this.artboard.width=k/T,this.artboard.height=P/T}}},Object.defineProperty(g.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),g.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(k){return k.name===o});return d?.inputs}},g.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var k=this.artboard.inputByPath(o,d);if(!k){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k},g.prototype.setBooleanStateAtPath=function(o,d,k){var P=this.retrieveInputAtPath(o,k);P&&(P.type===J.Boolean?P.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(k,"' is not a boolean")))},g.prototype.setNumberStateAtPath=function(o,d,k){var P=this.retrieveInputAtPath(o,k);P&&(P.type===J.Number?P.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(k,"' is not a number")))},g.prototype.fireStateAtPath=function(o,d){var k=this.retrieveInputAtPath(o,d);k&&(k.type===J.Trigger?k.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},g.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var k=this.artboard.textByPath(o,d);if(!k){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k},g.prototype.getTextRunValueAtPath=function(o,d){var k=this.retrieveTextAtPath(o,d);if(!k){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return k.text},g.prototype.setTextRunValueAtPath=function(o,d,k){var P=this.retrieveTextAtPath(o,k);if(!P){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(k,"'"));return}P.text=d},Object.defineProperty(g.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),g.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},g.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},g.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},g.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},g.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},g.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},g.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},g.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},g.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(g.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var k=this.file.artboardByIndex(d),P={name:k.name,animations:[],stateMachines:[]},A=0;A<k.animationCount();A++){var T=k.animationByIndex(A);P.animations.push(T.name)}for(var F=0;F<k.stateMachineCount();F++){for(var H=k.stateMachineByIndex(F),z=H.name,le=new this.runtime.StateMachineInstance(H,k),de=[],ce=0;ce<le.inputCount();ce++){var ve=le.input(ce);de.push({name:ve.name,type:ve.type})}P.stateMachines.push({name:z,inputs:de})}o.artboards.push(P)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*be.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),g.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(g.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),g.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(k){return k.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(g.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),g.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Ue(d):null},g.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Ue(d):null},g.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new _t(d)})}return this._dataEnums},g.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Ue(o)}return null},g.prototype.getArtboard=function(o){var d,k;return(k=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&k!==void 0?k:null},g.missingErrorMessage="Rive source file or data buffer required",g.cleanupErrorMessage="Attempt to use file after calling cleanup.",g})(),Ue=(function(){function g(o){this._viewModel=o}return Object.defineProperty(g.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),g.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new It(d,null):null},g.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new It(d,null):null},g.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new It(o,null):null},g.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new It(o,null):null},Object.defineProperty(g.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),g})(),_t=(function(){function g(o){this._dataEnum=o}return Object.defineProperty(g.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),g})(),Ve;(function(g){g.Number="number",g.String="string",g.Boolean="boolean",g.Color="color",g.Trigger="trigger",g.Enum="enum",g.List="list",g.Image="image",g.Artboard="artboard"})(Ve||(Ve={}));var It=(function(){function g(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(g.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),g.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},g.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},g.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var k=this._parents[d];k.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},g.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(k){k.addToViewModelCallbacks(d)}))},g.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(k){return k!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(d)}))},g.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(k){k.addToViewModelCallbacks(d)}))},g.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(k){return k!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(d)}))},g.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},g.prototype.propertyFromPath=function(o,d){var k=o.split("/");return this.propertyFromPathSegments(k,0,d)},g.prototype.viewModelFromPathSegments=function(o,d){var k=this.internalViewModelInstance(o[d]);return k!==null?d==o.length-1?k:k.viewModelFromPathSegments(o,d++):null},g.prototype.propertyFromPathSegments=function(o,d,k){var P,A,T,F,H,z,le,de,ce,ve,$e,ht,De,mt,Be,bt,yt,qt;if(d<o.length-1){var Pe=this.internalViewModelInstance(o[d]);return Pe!==null?Pe.propertyFromPathSegments(o,d+1,k):null}var ut=null;switch(k){case Ve.Number:if(ut=(A=(P=this._runtimeInstance)===null||P===void 0?void 0:P.number(o[d]))!==null&&A!==void 0?A:null,ut!==null)return new ue(ut,this);break;case Ve.String:if(ut=(F=(T=this._runtimeInstance)===null||T===void 0?void 0:T.string(o[d]))!==null&&F!==void 0?F:null,ut!==null)return new me(ut,this);break;case Ve.Boolean:if(ut=(z=(H=this._runtimeInstance)===null||H===void 0?void 0:H.boolean(o[d]))!==null&&z!==void 0?z:null,ut!==null)return new oe(ut,this);break;case Ve.Color:if(ut=(de=(le=this._runtimeInstance)===null||le===void 0?void 0:le.color(o[d]))!==null&&de!==void 0?de:null,ut!==null)return new Ke(ut,this);break;case Ve.Trigger:if(ut=(ve=(ce=this._runtimeInstance)===null||ce===void 0?void 0:ce.trigger(o[d]))!==null&&ve!==void 0?ve:null,ut!==null)return new xe(ut,this);break;case Ve.Enum:if(ut=(ht=($e=this._runtimeInstance)===null||$e===void 0?void 0:$e.enum(o[d]))!==null&&ht!==void 0?ht:null,ut!==null)return new Re(ut,this);break;case Ve.List:if(ut=(mt=(De=this._runtimeInstance)===null||De===void 0?void 0:De.list(o[d]))!==null&&mt!==void 0?mt:null,ut!==null)return new Je(ut,this);break;case Ve.Image:if(ut=(bt=(Be=this._runtimeInstance)===null||Be===void 0?void 0:Be.image(o[d]))!==null&&bt!==void 0?bt:null,ut!==null)return new ie(ut,this);break;case Ve.Artboard:if(ut=(qt=(yt=this._runtimeInstance)===null||yt===void 0?void 0:yt.artboard(o[d]))!==null&&qt!==void 0?qt:null,ut!==null)return new fe(ut,this);break}return null},g.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var k=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(k!==null){var P=new g(k,this);return P.internalIncrementReferenceCount(),this._viewModelInstances.set(o,P),P}return null},g.prototype.number=function(o){var d=this.propertyFromPath(o,Ve.Number);return d},g.prototype.string=function(o){var d=this.propertyFromPath(o,Ve.String);return d},g.prototype.boolean=function(o){var d=this.propertyFromPath(o,Ve.Boolean);return d},g.prototype.color=function(o){var d=this.propertyFromPath(o,Ve.Color);return d},g.prototype.trigger=function(o){var d=this.propertyFromPath(o,Ve.Trigger);return d},g.prototype.enum=function(o){var d=this.propertyFromPath(o,Ve.Enum);return d},g.prototype.list=function(o){var d=this.propertyFromPath(o,Ve.List);return d},g.prototype.image=function(o){var d=this.propertyFromPath(o,Ve.Image);return d},g.prototype.artboard=function(o){var d=this.propertyFromPath(o,Ve.Artboard);return d},g.prototype.viewModel=function(o){var d=o.split("/"),k=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return k!=null?k.internalViewModelInstance(d[d.length-1]):null},g.prototype.internalReplaceViewModel=function(o,d){var k;if(d.runtimeInstance!==null){var P=((k=this._runtimeInstance)===null||k===void 0?void 0:k.replaceViewModel(o,d.runtimeInstance))||!1;if(P){d.internalIncrementReferenceCount();var A=this.internalViewModelInstance(o);A!==null&&(A.removeParent(this),this._children.includes(A)&&(this._children=this._children.filter(function(T){return T!==A})),A.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return P}return!1},g.prototype.replaceViewModel=function(o,d){var k,P=o.split("/"),A=P.length>1?this.viewModelFromPathSegments(P.slice(0,P.length-1),0):this;return(k=A?.internalReplaceViewModel(P[P.length-1],d))!==null&&k!==void 0?k:!1},g.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},g.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(g.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return b({},d)}))||[]},enumerable:!1,configurable:!0}),g.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},g.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(P){P.cleanup()}),this._viewModelInstances.clear();var d=I([],this._children,!0);this._children.length=0;var k=I([],this._parents,!0);this._parents.length=0,d.forEach(function(P){P.removeParent(o)}),k.forEach(function(P){P.removeFromViewModelCallbacks(o)})}},g})(),_e=(function(){function g(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return g.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},g.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},g.prototype.internalHandleCallback=function(o){},g.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},g.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},g.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(g.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),g})(),me=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(_e),ue=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(_e),oe=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(_e),xe=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(_e),Re=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(_e),Je=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,k){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,k)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var k=this._viewModelInstanceValue.instanceAt(d);if(k!=null){var P=new It(k,this._parentViewModel);return P}return null},o.prototype.swap=function(d,k){this._viewModelInstanceValue.swap(d,k)},o.prototype.internalHandleCallback=function(d){d()},o})(_e),Ke=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,k,P){this._viewModelInstanceValue.rgb(d,k,P)},o.prototype.rgba=function(d,k,P,A){this._viewModelInstanceValue.argb(A,d,k,P)},o.prototype.argb=function(d,k,P,A){this._viewModelInstanceValue.argb(d,k,P,A)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(_e),ie=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var k;this._viewModelInstanceValue.value((k=d?.nativeImage)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(_e),fe=(function(g){_(o,g);function o(d,k){return g.call(this,d,k)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var k;this._viewModelInstanceValue.value((k=d?.nativeArtboard)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(_e),Ce=function(g){return S(void 0,void 0,void 0,function(){var o,d,k;return p(this,function(P){switch(P.label){case 0:return o=new Request(g),[4,fetch(o)];case 1:return d=P.sent(),[4,d.arrayBuffer()];case 2:return k=P.sent(),[2,k]}})})},Xe=function(g){return typeof g=="string"?[g]:g instanceof Array?g:[]},it={EventManager:Se,TaskQueueManager:Me},Tt=function(g){return S(void 0,void 0,void 0,function(){var o,d,k;return p(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeAudio(g,A)})}),[4,o];case 1:return d=P.sent(),k=new m.AudioWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})},xt=function(g){return S(void 0,void 0,void 0,function(){var o,d,k;return p(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeImage(g,A)})}),[4,o];case 1:return d=P.sent(),k=new m.ImageWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})},Qe=function(g){return S(void 0,void 0,void 0,function(){var o,d,k;return p(this,function(P){switch(P.label){case 0:return o=new Promise(function(A){return K.getInstance(function(T){T.decodeFont(g,A)})}),[4,o];case 1:return d=P.sent(),k=new m.FontWrapper(d),m.finalizationRegistry.register(k,d),[2,k]}})})}})(),l})())})(ds)),ds.exports}var Kv=Gv();const Mu="dracula",ys="https://vycjpmuyscfygstjjied.supabase.co";var Yv=te('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Cl(r,e){Wt(e,!0);let t=_r(e,"bucketName",3,Mu),n=et(void 0);Pi(()=>{if(!w(n))return;const u=new Kv.Rive({src:`${ys}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:w(n),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var s=Yv(),l=C(s);fa(l,u=>Ee(n,u),()=>w(n)),G(r,s),Vt()}function Jv(r,e,t,n,s,l){e()?t.onLose?t.onLose():n("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var Xv=te('<button class="btn btn-danger svelte-545h2y">🏳️ Сдаться</button>'),Qv=te('<div role="button" tabindex="0"> </div>'),Zv=yd('<polyline class="connection-line svelte-545h2y" vector-effect="non-scaling-stroke"></polyline>'),ep=te('<div class="item-icon reward-glow svelte-545h2y"><img class="icon-preview svelte-545h2y" height="64px"/></div>'),tp=te('<div id="reward-panel" class="svelte-545h2y"><!> <div class="reward-info svelte-545h2y"><div class="reward-label svelte-545h2y">Награда:</div> <div class="reward-name svelte-545h2y"> </div></div></div>'),rp=te('<span class="cooldown-timer svelte-545h2y"> </span>'),np=te("<button> </button>"),ip=te('<div id="modal-overlay"><div class="modal-content svelte-545h2y"><div class="modal-title svelte-545h2y"> </div> <div class="modal-text svelte-545h2y"> </div> <div class="modal-buttons svelte-545h2y"></div></div></div>'),sp=te('<div class="body-wrapper svelte-545h2y"><div id="game-header" class="svelte-545h2y"><button class="btn btn-secondary svelte-545h2y">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-545h2y"><div id="grid" class="svelte-545h2y"></div> <svg id="line-layer" class="svelte-545h2y"><!></svg></div> <div id="game-header" class="svelte-545h2y"><!> <span class="tiles-counter svelte-545h2y">Осталось: <strong class="svelte-545h2y"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function ap(r,e){Wt(e,!0);let t=_r(e,"integrated",3,!1),n=_r(e,"rewardItem",3,null),s=_r(e,"items",19,()=>[]),l=_r(e,"bucketName",3,"dracula");const u=pu(),h=8,f=6,m=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=et(Ot([])),b=et(Ot([])),S=et(Ot({})),p=et(Ot([])),I=et(null),U=et(!1),R=et(!1),B=et(Ot([])),q=et(0),N=et(0);const K=5;let J=et(Ot({show:!1,title:"",text:"",actions:[]})),D,W;Pi(()=>{Se()});function ae(){if(!w(b)||w(b).length===0)return 0;let A=0;for(let T=0;T<h;T++)for(let F=0;F<f;F++)w(b)[T]&&!w(b)[T][F]&&A++;return A}let Q=Cr(ae),we=Cr(()=>w(N)<1);function Z(){if(!n()||!s()||s().length===0)return null;const A=typeof n()=="string"?n():n().id;return s().find(T=>T.id===A)}let ee=Cr(Z);function Se(){Ee(_,[],!0),Ee(b,[],!0),Ee(I,null),Ee(U,!1),Ee(R,!1),Ee(S,{},!0),Ee(p,[],!0),Ee(B,[],!0),Ee(N,0),Ve();let A=[...new Set(m)];for(;A.length<h*f/2;)A=[...A,...A];let T=A.sort(()=>.5-Math.random()).slice(0,h*f/2),F=[];T.forEach(z=>F.push(z,z)),F.sort(()=>Math.random()-.5);let H=0;for(let z=0;z<h;z++){let le=[],de=[];for(let ce=0;ce<f;ce++)le.push(F[H++]),de.push(!1);w(_).push(le),w(b).push(de)}setTimeout(ft,500)}async function Me(A,T){if(w(U)||w(b)[A][T]||w(R))return;if(w(p).length>0&&Ee(p,[],!0),!w(I)){Ee(I,{r:A,c:T},!0);return}if(w(I).r===A&&w(I).c===T){Ee(I,null);return}const F=w(_)[w(I).r][w(I).c],H=w(_)[A][T];if(F===H){const z=Le(w(I).r,w(I).c,A,T);if(z){Ee(U,!0),await Ue(z),w(b)[w(I).r][w(I).c]=!0,w(b)[A][T]=!0,Ee(I,null),Ee(U,!1),Te(),ft();return}}Ee(I,{r:A,c:T},!0)}async function ge(A,T,F){(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),await Me(A,T))}function Te(){Ee(N,K);const A=setInterval(()=>{ua(N,-1),w(N)<=0&&clearInterval(A)},1e3)}function be(){if(w(U)||w(R)||!w(we))return;let A=[];for(let F=0;F<h;F++)for(let H=0;H<f;H++)w(b)[F][H]||A.push({r:F,c:H,icon:w(_)[F][H]});let T={};A.forEach(F=>{T[F.icon]||(T[F.icon]=[]),T[F.icon].push(F)});for(let F in T){let H=T[F];if(!(H.length<2))for(let z=0;z<H.length;z++)for(let le=z+1;le<H.length;le++){let de=H[z],ce=H[le];if(Le(de.r,de.c,ce.r,ce.c)){Ee(p,[de,ce],!0),setTimeout(()=>Ee(p,[],!0),1500);return}}}_t("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:Ve}])}function ft(){if(w(Q)===0){Ee(R,!0),t()?e.onWin?e.onWin():u("win"):_t("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:Se}]);return}Ge()||(t()?setTimeout(()=>Fe(),1e3):_t("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{Ve(),Fe()}},{text:"Сдаться",action:()=>{_t("Конец","Попытайте удачу снова!",[{text:"ОК",action:Se}])}}]))}function Ge(){let A=[];for(let F=0;F<h;F++)for(let H=0;H<f;H++)w(b)[F][H]||A.push({r:F,c:H,icon:w(_)[F][H]});let T={};A.forEach(F=>{T[F.icon]||(T[F.icon]=[]),T[F.icon].push(F)});for(let F in T){let H=T[F];if(!(H.length<2)){for(let z=0;z<H.length;z++)for(let le=z+1;le<H.length;le++)if(Le(H[z].r,H[z].c,H[le].r,H[le].c))return!0}}return!1}function Fe(){let A=[],T=[];for(let F=0;F<h;F++)for(let H=0;H<f;H++)w(b)[F][H]||(A.push(w(_)[F][H]),T.push({r:F,c:H}));A.length!==0&&(A.sort(()=>Math.random()-.5),T.forEach((F,H)=>{w(_)[F.r][F.c]=A[H],w(S)[`${F.r},${F.c}`]=!0}),setTimeout(()=>{Ee(S,{},!0),Ge()?Ee(R,!1):Fe()},500))}function rt(A,T){return A<0||A>=h||T<0||T>=f?!0:w(b)[A][T]}function lt(A,T,F,H){if(A!==F&&T!==H)return!1;if(A===F){const z=Math.min(T,H),le=Math.max(T,H);for(let de=z+1;de<le;de++)if(!rt(A,de))return!1}else{const z=Math.min(A,F),le=Math.max(A,F);for(let de=z+1;de<le;de++)if(!rt(de,T))return!1}return!0}function Le(A,T,F,H){if(lt(A,T,F,H))return[{r:A,c:T},{r:F,c:H}];let z={r:A,c:H};if(rt(z.r,z.c)&&lt(A,T,z.r,z.c)&&lt(z.r,z.c,F,H))return[{r:A,c:T},z,{r:F,c:H}];let le={r:F,c:T};if(rt(le.r,le.c)&&lt(A,T,le.r,le.c)&&lt(le.r,le.c,F,H))return[{r:A,c:T},le,{r:F,c:H}];for(let de=-1;de<=h;de++){if(de===A||de===F)continue;let ce={r:de,c:T},ve={r:de,c:H};if(rt(ce.r,ce.c)&&rt(ve.r,ve.c)&&lt(A,T,ce.r,ce.c)&&lt(ce.r,ce.c,ve.r,ve.c)&&lt(ve.r,ve.c,F,H))return[{r:A,c:T},ce,ve,{r:F,c:H}]}for(let de=-1;de<=f;de++){if(de===T||de===H)continue;let ce={r:A,c:de},ve={r:F,c:de};if(rt(ce.r,ce.c)&&rt(ve.r,ve.c)&&lt(A,T,ce.r,ce.c)&&lt(ce.r,ce.c,ve.r,ve.c)&&lt(ve.r,ve.c,F,H))return[{r:A,c:T},ce,ve,{r:F,c:H}]}return null}async function Ue(A){if(await lu(),!D||!W)return;const T=D.getBoundingClientRect(),F=W.getBoundingClientRect(),H=W.querySelector(".cell");if(!H)return;const z=H.offsetWidth,le=H.offsetHeight,de=window.getComputedStyle(W),ce=parseFloat(de.gap)||4,ve=F.left-T.left,$e=F.top-T.top,ht=A.map(De=>{let mt,Be;if(De.r>=0&&De.r<h&&De.c>=0&&De.c<f){const yt=W.children[De.r*f+De.c].getBoundingClientRect();mt=yt.left-T.left+yt.width/2,Be=yt.top-T.top+yt.height/2}else{const bt=De.c*(z+ce)+z/2,yt=De.r*(le+ce)+le/2;mt=ve+bt,Be=$e+yt}return`${mt.toFixed(1)},${Be.toFixed(1)}`}).join(" ");return Ee(B,ht,!0),ua(q),new Promise(De=>{setTimeout(()=>{Ee(B,[],!0),De()},350)})}function _t(A,T,F){t()||Ee(J,{show:!0,title:A,text:T,actions:F},!0)}function Ve(){w(J).show=!1}var It=sp(),_e=jt(It),me=C(_e),ue=C(me);ue.__click=Se;var oe=L(ue,2);{var xe=A=>{var T=Xv();T.__click=[Jv,t,e,u,_t,Se],G(A,T)};je(oe,A=>{t()&&A(xe)})}var Re=L(me,2),Je=C(Re);vu(Je,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),wt(Je,21,()=>w(_),nr,(A,T,F)=>{var H=Gt(),z=jt(H);wt(z,17,()=>w(T),nr,(le,de,ce)=>{var ve=Qv();let $e;ve.__click=()=>Me(F,ce),ve.__keydown=De=>ge(F,ce,De);var ht=C(ve);Ie(De=>{$e=Kt(ve,1,"cell svelte-545h2y",null,$e,De),Ae(ht,w(de))},[()=>({selected:w(I)?.r===F&&w(I)?.c===ce,matched:w(b)[F][ce],shuffling:w(S)[`${F},${ce}`],"hint-glow":w(p).some(De=>De.r===F&&De.c===ce)})]),G(le,ve)}),G(A,H)}),fa(Je,A=>W=A,()=>W);var Ke=L(Je,2),ie=C(Ke);ha(ie,()=>w(q),A=>{var T=Gt(),F=jt(T);{var H=z=>{var le=Zv();Ie(()=>Oe(le,"points",w(B))),G(z,le)};je(F,z=>{w(B)&&z(H)})}G(A,T)}),fa(Re,A=>D=A,()=>D);var fe=L(Re,2),Ce=C(fe);{var Xe=A=>{var T=tp(),F=C(T);{var H=ce=>{var ve=ep(),$e=C(ve);Ie(()=>{Oe($e,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${w(ee).icon}`),Oe($e,"alt",w(ee).name)}),G(ce,ve)};je(F,ce=>{w(ee).icon&&ce(H)})}var z=L(F,2),le=L(C(z),2),de=C(le);Ie(()=>Ae(de,w(ee).name)),G(A,T)};je(Ce,A=>{w(ee)&&A(Xe)})}var it=L(Ce,2),Tt=L(C(it)),xt=C(Tt),Qe=L(it,2);let g;Qe.__click=be;var o=L(C(Qe));{var d=A=>{var T=rp(),F=C(T);Ie(()=>Ae(F,`(${w(N)??""})`)),G(A,T)};je(o,A=>{w(N)>0&&A(d)})}var k=L(_e,2);{var P=A=>{var T=ip();let F;var H=C(T),z=C(H),le=C(z),de=L(z,2),ce=C(de),ve=L(de,2);wt(ve,21,()=>w(J).actions,$e=>$e.text,($e,ht)=>{var De=np();let mt;De.__click=function(...bt){w(ht).action?.apply(this,bt)};var Be=C(De);Ie(bt=>{mt=Kt(De,1,"btn svelte-545h2y",null,mt,bt),Ae(Be,w(ht).text)},[()=>({"btn-secondary":w(ht).class==="btn-secondary"})]),G($e,De)}),Ie($e=>{F=Kt(T,1,"svelte-545h2y",null,F,$e),Ae(le,w(J).title),Ae(ce,w(J).text)},[()=>({active:w(J).show})]),G(A,T)};je(k,A=>{w(J).show&&A(P)})}Ie(A=>{Ae(xt,w(Q)),g=Kt(Qe,1,"btn btn-secondary svelte-545h2y",null,g,A),Qe.disabled=!w(we)},[()=>({disabled:!w(we),"cooldown-active":w(N)>0})]),G(r,It),Vt()}Xt(["click","keydown"]);function op(r,e,t,n,s,l,u,h,f,m){if(!(w(e)||w(t)||!w(n)))for(let _=0;_<s;_++)for(let b=0;b<l;b++){if(w(u)[_][b]||w(h)[_][b])continue;let S=w(f)[_][b];for(let p=0;p<s;p++)for(let I=0;I<l;I++)if(!(_===p&&b===I)&&!(w(u)[p][I]||w(h)[p][I])&&w(f)[p][I]===S){Ee(m,[{r:_,c:b},{r:p,c:I}],!0),setTimeout(()=>Ee(m,[],!0),1500);return}}}function lp(r,e,t,n,s,l){e()?t.onLose?t.onLose():n("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var up=te('<button class="btn btn-danger svelte-q16t3v">🏳️ Сдаться</button>'),cp=te('<div role="button" tabindex="0"><div class="card-inner svelte-q16t3v"><div class="card-front svelte-q16t3v"> </div> <div class="card-back svelte-q16t3v">?</div></div></div>'),dp=te('<div class="item-icon reward-glow svelte-q16t3v"><img class="icon-preview svelte-q16t3v" height="64px"/></div>'),hp=te('<div id="reward-panel" class="svelte-q16t3v"><!> <div class="reward-info svelte-q16t3v"><div class="reward-label svelte-q16t3v">Награда:</div> <div class="reward-name svelte-q16t3v"> </div></div></div>'),fp=te('<span class="cooldown-timer svelte-q16t3v"> </span>'),vp=te("<button> </button>"),pp=te('<div id="modal-overlay"><div class="modal-content svelte-q16t3v"><div class="modal-title svelte-q16t3v"> </div> <div class="modal-text svelte-q16t3v"> </div> <div class="modal-buttons svelte-q16t3v"></div></div></div>'),gp=te('<div class="body-wrapper svelte-q16t3v"><div id="game-header" class="svelte-q16t3v"><button class="btn btn-secondary svelte-q16t3v">🔄 Новая игра</button> <!></div> <div id="game-container" class="svelte-q16t3v"><div id="grid" class="svelte-q16t3v"></div></div> <div id="game-header" class="svelte-q16t3v"><!> <span class="tiles-counter svelte-q16t3v">Осталось: <strong class="svelte-q16t3v"> </strong></span> <button>💡 <!></button></div></div> <!>',1);function _p(r,e){Wt(e,!0);let t=_r(e,"integrated",3,!1),n=_r(e,"rewardItem",3,null),s=_r(e,"items",19,()=>[]),l=_r(e,"bucketName",3,"dracula");const u=pu(),h=8,f=6,m=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=et(Ot([])),b=et(Ot([])),S=et(Ot([])),p=et(Ot([])),I=et(null),U=et(!1),R=et(!1),B=et(0);const q=5;let N=et(Ot({show:!1,title:"",text:"",actions:[]}));Pi(()=>{Q()});function K(){if(!w(b)||w(b).length===0)return 0;let ie=0;for(let fe=0;fe<h;fe++)for(let Ce=0;Ce<f;Ce++)w(b)[fe]&&!w(b)[fe][Ce]&&ie++;return ie}let J=Cr(K),D=Cr(()=>w(B)<1);function W(){if(!n()||!s()||s().length===0)return null;const ie=typeof n()=="string"?n():n().id;return s().find(fe=>fe.id===ie)}let ae=Cr(W);function Q(){Ee(_,[],!0),Ee(b,[],!0),Ee(S,[],!0),Ee(I,null),Ee(U,!1),Ee(R,!1),Ee(p,[],!0),Ee(B,0),ge();let ie=[...new Set(m)];for(;ie.length<h*f/2;)ie=[...ie,...ie];let fe=ie.sort(()=>.5-Math.random()).slice(0,h*f/2),Ce=[];fe.forEach(it=>Ce.push(it,it)),Ce.sort(()=>Math.random()-.5);let Xe=0;for(let it=0;it<h;it++){let Tt=[],xt=[],Qe=[];for(let g=0;g<f;g++)Tt.push(Ce[Xe++]),xt.push(!1),Qe.push(!1);w(_).push(Tt),w(b).push(xt),w(S).push(Qe)}}async function we(ie,fe){if(!(w(U)||w(b)[ie][fe]||w(R))){if(w(I)&&w(I).r===ie&&w(I).c===fe){w(S)[ie][fe]=!1,Ee(I,null);return}if(!w(S)[ie][fe])if(w(p).length>0&&Ee(p,[],!0),w(S)[ie][fe]=!0,!w(I))Ee(I,{r:ie,c:fe},!0);else{Ee(U,!0);const Ce={r:ie,c:fe},Xe=w(_)[w(I).r][w(I).c],it=w(_)[Ce.r][Ce.c];Xe===it?setTimeout(()=>{w(b)[w(I).r][w(I).c]=!0,w(b)[Ce.r][Ce.c]=!0,w(S)[w(I).r][w(I).c]=!1,w(S)[Ce.r][Ce.c]=!1,Ee(I,null),Ee(U,!1),ee(),Se()},600):setTimeout(()=>{w(S)[w(I).r][w(I).c]=!1,w(S)[Ce.r][Ce.c]=!1,Ee(I,null),Ee(U,!1)},1e3)}}}async function Z(ie,fe,Ce){(Ce.key==="Enter"||Ce.key===" ")&&(Ce.preventDefault(),await we(ie,fe))}function ee(){Ee(B,q);const ie=setInterval(()=>{ua(B,-1),w(B)<=0&&clearInterval(ie)},1e3)}function Se(){if(w(J)===0){Ee(R,!0),t()?e.onWin?e.onWin():u("win"):Me("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:Q}]);return}}function Me(ie,fe,Ce){t()||Ee(N,{show:!0,title:ie,text:fe,actions:Ce},!0)}function ge(){w(N).show=!1}var Te=gp(),be=jt(Te),ft=C(be),Ge=C(ft);Ge.__click=Q;var Fe=L(Ge,2);{var rt=ie=>{var fe=up();fe.__click=[lp,t,e,u,Me,Q],G(ie,fe)};je(Fe,ie=>{t()&&ie(rt)})}var lt=L(ft,2),Le=C(lt);vu(Le,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),wt(Le,21,()=>w(_),nr,(ie,fe,Ce)=>{var Xe=Gt(),it=jt(Xe);wt(it,17,()=>w(fe),nr,(Tt,xt,Qe)=>{var g=cp();let o;g.__click=()=>we(Ce,Qe),g.__keydown=A=>Z(Ce,Qe,A);var d=C(g),k=C(d),P=C(k);Ie(A=>{o=Kt(g,1,"cell svelte-q16t3v",null,o,A),Ae(P,w(xt))},[()=>({flipped:w(S)[Ce][Qe],matched:w(b)[Ce][Qe],selected:w(I)?.r===Ce&&w(I)?.c===Qe,"hint-glow":w(p).some(A=>A.r===Ce&&A.c===Qe)})]),G(Tt,g)}),G(ie,Xe)});var Ue=L(lt,2),_t=C(Ue);{var Ve=ie=>{var fe=hp(),Ce=C(fe);{var Xe=Qe=>{var g=dp(),o=C(g);Ie(()=>{Oe(o,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${l()}/${w(ae).icon}`),Oe(o,"alt",w(ae).name)}),G(Qe,g)};je(Ce,Qe=>{w(ae).icon&&Qe(Xe)})}var it=L(Ce,2),Tt=L(C(it),2),xt=C(Tt);Ie(()=>Ae(xt,w(ae).name)),G(ie,fe)};je(_t,ie=>{w(ae)&&ie(Ve)})}var It=L(_t,2),_e=L(C(It)),me=C(_e),ue=L(It,2);let oe;ue.__click=[op,U,R,D,h,f,b,S,_,p];var xe=L(C(ue));{var Re=ie=>{var fe=fp(),Ce=C(fe);Ie(()=>Ae(Ce,`(${w(B)??""})`)),G(ie,fe)};je(xe,ie=>{w(B)>0&&ie(Re)})}var Je=L(be,2);{var Ke=ie=>{var fe=pp();let Ce;var Xe=C(fe),it=C(Xe),Tt=C(it),xt=L(it,2),Qe=C(xt),g=L(xt,2);wt(g,21,()=>w(N).actions,o=>o.text,(o,d)=>{var k=vp();let P;k.__click=function(...T){w(d).action?.apply(this,T)};var A=C(k);Ie(T=>{P=Kt(k,1,"btn svelte-q16t3v",null,P,T),Ae(A,w(d).text)},[()=>({"btn-secondary":w(d).class==="btn-secondary"})]),G(o,k)}),Ie(o=>{Ce=Kt(fe,1,"svelte-q16t3v",null,Ce,o),Ae(Tt,w(N).title),Ae(Qe,w(N).text)},[()=>({active:w(N).show})]),G(ie,fe)};je(Je,ie=>{w(N).show&&ie(Ke)})}Ie(ie=>{Ae(me,w(J)),oe=Kt(ue,1,"btn btn-secondary svelte-q16t3v",null,oe,ie),ue.disabled=!w(D)},[()=>({disabled:!w(D),"cooldown-active":w(B)>0})]),G(r,Te),Vt()}Xt(["click","keydown"]);var mp=te('<div class="loading svelte-15dde84">Загрузка игры...</div>'),yp=te('<div class="minigame-container svelte-15dde84"><!></div>');function wp(r,e){Wt(e,!0);function t(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function n(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var s=yp(),l=C(s);{var u=f=>{ap(f,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},bucketName:"minigames"})},h=f=>{var m=Gt(),_=jt(m);{var b=p=>{_p(p,{onWin:t,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},bucketName:"minigames"})},S=p=>{var I=mp();G(p,I)};je(_,p=>{e.gameId==="memo_monsters"?p(b):p(S,!1)},!0)}G(f,m)};je(l,f=>{e.gameId==="onet_monsters"?f(u):f(h,!1)})}G(r,s),Vt()}function bp(r,e){w(e)?.nextDialogueId&&Ct.goToDialogue(w(e).nextDialogueId)}var kp=te('<img alt="BG" class="background-image svelte-dd9wj5"/>'),Ep=te('<div class="background-media svelte-dd9wj5"><!></div>'),Ip=te('<img alt="Char" class="character-image svelte-dd9wj5"/>'),Sp=te('<div class="character-media svelte-dd9wj5"><!></div>'),Ap=(r,e,t)=>e(w(t)),Cp=te('<button class="option-button svelte-dd9wj5"> </button>'),Tp=te('<div class="options-container svelte-dd9wj5"></div>'),xp=te('<div class="next-container svelte-dd9wj5"><button class="next-button svelte-dd9wj5">Далее...</button></div>'),Pp=te('<div class="dialogue-container svelte-dd9wj5"><!> <!> <!> <div class="dialogue-content svelte-dd9wj5"><div class="dialogue-text svelte-dd9wj5"> </div> <!></div></div>'),jp=te("<p> </p>");function Lu(r,e){Wt(e,!0);let t=_r(e,"bucketName",3,Mu);console.log(t());const n=Cr(()=>e.dialogue||Ct.findDialogue(Ct.currentDialogueId));let s=et(null);Zn(()=>{w(n)?.onEnter&&Ct.runActions(w(n).onEnter)});function l(p){if(p.actions&&Ct.runActions(p.actions),p.miniGame){console.log("Запуск мини-игры:",p.miniGame.id),Ee(s,{gameId:p.miniGame.id,onWinDialogueId:p.miniGame.onWinDialogueId,onLoseDialogueId:p.miniGame.onLoseDialogueId,rewardItem:p.miniGame.rewardItem},!0);return}p.nextDialogueId&&Ct.goToDialogue(p.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),w(s)?.rewardItem&&Ct.addItem(w(s).rewardItem),w(s)?.onWinDialogueId&&Ct.goToDialogue(w(s).onWinDialogueId),Ee(s,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),w(s)?.onLoseDialogueId&&Ct.goToDialogue(w(s).onLoseDialogueId),Ee(s,null)}function f(p){return p.visibleIf&&p.visibleIf.hasItem?Ct.hasItem(p.visibleIf.hasItem):!0}var m=Gt(),_=jt(m);{var b=p=>{var I=Pp(),U=C(I);{var R=Z=>{{let ee=Cr(()=>Ct.storyData?.items);wp(Z,{get gameId(){return w(s).gameId},onWin:u,onLose:h,get rewardItem(){return w(s).rewardItem},get items(){return w(ee)}})}};je(U,Z=>{w(s)&&Z(R)})}var B=L(U,2);{var q=Z=>{var ee=Ep(),Se=C(ee);{var Me=Te=>{var be=Gt(),ft=jt(be);ha(ft,()=>w(n).backgroundImage,Ge=>{Cl(Ge,{get fileName(){return w(n).backgroundImage},get bucketName(){return t()}})}),G(Te,be)},ge=Te=>{var be=kp();Ie(()=>Oe(be,"src",`${ys}/storage/v1/object/public/${t()}/${w(n).backgroundImage}`)),G(Te,be)};je(Se,Te=>{w(n).backgroundImage.endsWith(".riv")?Te(Me):Te(ge,!1)})}G(Z,ee)};je(B,Z=>{w(n).backgroundImage&&Z(q)})}var N=L(B,2);{var K=Z=>{var ee=Sp(),Se=C(ee);{var Me=Te=>{var be=Gt(),ft=jt(be);ha(ft,()=>w(n).characterImage,Ge=>{Cl(Ge,{get fileName(){return w(n).characterImage},get bucketName(){return t()}})}),G(Te,be)},ge=Te=>{var be=Ip();Ie(()=>Oe(be,"src",`${ys}/storage/v1/object/public/${t()}/${w(n).characterImage}`)),G(Te,be)};je(Se,Te=>{w(n).characterImage.endsWith(".riv")?Te(Me):Te(ge,!1)})}G(Z,ee)};je(N,Z=>{w(n).characterImage&&Z(K)})}var J=L(N,2),D=C(J),W=C(D),ae=L(D,2);{var Q=Z=>{var ee=Tp();wt(ee,21,()=>w(n).options,Se=>Se.text,(Se,Me)=>{var ge=Gt(),Te=jt(ge);{var be=ft=>{var Ge=Cp();Ge.__click=[Ap,l,Me];var Fe=C(Ge);Ie(()=>Ae(Fe,w(Me).text)),G(ft,Ge)};je(Te,ft=>{f(w(Me))&&ft(be)})}G(Se,ge)}),G(Z,ee)},we=Z=>{var ee=Gt(),Se=jt(ee);{var Me=ge=>{var Te=xp(),be=C(Te);be.__click=[bp,n],G(ge,Te)};je(Se,ge=>{w(n).nextDialogueId&&ge(Me)},!0)}G(Z,ee)};je(ae,Z=>{w(n).options&&w(n).options.length>0?Z(Q):Z(we,!1)})}Ie(()=>Ae(W,w(n).text)),G(p,I)},S=p=>{var I=jp(),U=C(I);Ie(()=>Ae(U,`Диалог не найден (ID: ${Ct.currentDialogueId??""})`)),G(p,I)};je(_,p=>{w(n)?p(b):p(S,!1)})}G(r,m),Vt()}Xt(["click"]);var na=en(()=>M),Rp=te('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Op=te('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Mp=te('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Lp=te('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),Dp=te('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),$p=te('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Fp=te('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function Up(r,e){Wt(e,!1);function t(){na(na().editingOptionIndex=null)}Zr();var n=Fp(),s=C(n),l=L(C(s),2);l.__click=t;var u=L(s,2),h=C(u);{var f=_=>{var b=Dp(),S=C(b);{let ee=si(()=>na().selectedBucket||void 0);Lu(S,{get dialogue(){return Nt.currentDialogue},index:0,get bucketName(){return w(ee)}})}var p=L(S,2),I=C(p),U=L(C(I),2),R=C(U),B=L(I,2),q=L(C(B),2),N=C(q),K=L(B,2);{var J=ee=>{var Se=Rp(),Me=L(C(Se),2),ge=C(Me);Ie(()=>Ae(ge,Nt.currentDialogue.backgroundImage)),G(ee,Se)};je(K,ee=>{Nt.currentDialogue.backgroundImage&&ee(J)})}var D=L(K,2);{var W=ee=>{var Se=Op(),Me=L(C(Se),2),ge=C(Me);Ie(()=>Ae(ge,Nt.currentDialogue.characterImage)),G(ee,Se)};je(D,ee=>{Nt.currentDialogue.characterImage&&ee(W)})}var ae=L(p,2);{var Q=ee=>{var Se=Mp();G(ee,Se)};je(ae,ee=>{(!Nt.currentDialogue.options||Nt.currentDialogue.options.length===0)&&ee(Q)})}var we=L(ae,2);{var Z=ee=>{var Se=Lp();G(ee,Se)};je(we,ee=>{Nt.currentDialogue.options?.some(Se=>!Se.nextDialogueId)&&ee(Z)})}Ie(()=>{Ae(R,Nt.currentDialogue.id),Ae(N,Nt.currentChapter?.title||"Без главы")}),G(_,b)},m=_=>{var b=$p();G(_,b)};je(h,_=>{Nt.currentDialogue?_(f):_(m,!1)})}G(r,n),Vt()}Xt(["click"]);const Np=["dracula","zombie","fairy_tale","minigames"];function Du(){const r=Np.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return pt.updateBucketsList(r),r}var dn=en(()=>M),Bp=te('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),Wp=(r,e,t)=>e(w(t).name),Vp=te('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),qp=te('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),Hp=te('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function zp(r,e){Wt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};Pi(()=>{n()});function n(){Du()}async function s(h){dn(dn().selectedBucket=h),dn(dn().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Xr.loadStoriesList(),await Xr.loadStoredResources()}Zr();var l=Hp(),u=L(C(l),2);wt(u,5,()=>dn().availableBuckets,h=>h,(h,f)=>{const m=si(()=>t[w(f).id]||{title:w(f),description:"Интерактивная история",icon:"📖"});var _=qp();let b;var S=C(_),p=C(S),I=C(p),U=L(p,2),R=C(U),B=C(R),q=L(R,2),N=C(q),K=L(S,2),J=C(K);{var D=ae=>{var Q=Bp();G(ae,Q)},W=ae=>{var Q=Vp();Q.__click=[Wp,s,f],G(ae,Q)};je(J,ae=>{dn().selectedBucket===w(f).name?ae(D):ae(W,!1)})}Ie(ae=>{b=Kt(_,1,"bucket-card svelte-1cmn6ru",null,b,ae),Ae(I,w(m).icon),Ae(B,w(m).title),Ae(N,w(m).description)},[()=>({selected:dn().selectedBucket===w(f).name})]),G(h,_)}),G(r,l),Vt()}Xt(["click"]);var Gp=te("<span> </span>"),Kp=te('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Yp=te('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Jp=te('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Xp=te('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Qp(r,e){Wt(e,!0),Pi(async()=>{Du(),M.availableBuckets.length>0&&!M.selectedBucket&&(M.selectedBucket=M.availableBuckets[0].name)}),Zn(async()=>{if(M.selectedBucket){console.log(`[Editor] Bucket выбран: ${M.selectedBucket}`),await Xr.loadStoredResources();const u=`${M.selectedBucket}_story.json`;M.currentFileName=u,await gn.loadStory(u)}});var t=Gt(),n=jt(t);{var s=u=>{zp(u,{})},l=u=>{var h=Xp(),f=C(h),m=C(f),_=C(m);_.__click=()=>M.selectedBucket=null;var b=L(_,2),S=C(b),p=L(m,2),I=C(p),U=C(I),R=L(I,2);{var B=ge=>{var Te=Gp(),be=C(Te);Ie(()=>{Kt(Te,1,`status-message ${M.statusMessage.type??""}`,"svelte-1k4krym"),Ae(be,M.statusMessage.text)}),G(ge,Te)};je(R,ge=>{M.statusMessage.text&&ge(B)})}var q=L(R,2);q.__click=function(...ge){gn.saveCurrentStory?.apply(this,ge)};var N=L(q,2);N.__click=function(...ge){gn.saveStoryCopy?.apply(this,ge)};var K=L(f,2),J=C(K);Zf(J,{});var D=L(J,2),W=C(D);{var ae=ge=>{var Te=Kp(),be=C(Te),ft=C(be);Ie(()=>Ae(ft,`Загружено: ${M.data.meta?.title??""} |
              Глав: ${(M.data.chapters?.length||0)??""} |
              Диалогов: ${(M.data.dialogues?.length||0)??""} |
              Предметов: ${(M.data.items?.length||0)??""}`)),G(ge,Te)},Q=ge=>{var Te=Yp();G(ge,Te)};je(W,ge=>{M.data?ge(ae):ge(Q,!1)})}var we=L(W,2);qv(we,{});var Z=L(we,2);{var ee=ge=>{Rv(ge,{get editor(){return M},get storyActions(){return gn},get resourceActions(){return Xr}})},Se=ge=>{var Te=Jp();G(ge,Te)};je(Z,ge=>{Nt.currentDialogue?ge(ee):ge(Se,!1)})}var Me=L(D,2);Up(Me,{}),Ie(()=>{Ae(S,`Story Editor v3.1 - ${M.selectedBucket??""}`),Ae(U,M.currentFileName||"Нет файла")}),G(u,h)};je(n,u=>{M.selectedBucket?u(l,!1):u(s)})}G(r,t),Vt()}Xt(["click"]);var ia=en(()=>Ct),Zp=(r,e,t)=>e(w(t)),eg=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(w(t)))},tg=te('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),rg=te('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function ng(r,e){Wt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function n(u){ia(ia().selectedStory=u)}Zr();var s=rg(),l=L(C(s),2);wt(l,5,()=>ia().availableStories,u=>u,(u,h)=>{const f=si(()=>t[w(h)]||{title:w(h),description:"Интерактивная история",icon:"📖"});var m=tg();m.__click=[Zp,n,h],m.__keydown=[eg,n,h];var _=C(m),b=C(_),S=L(_,2),p=C(S),I=C(p),U=L(p,2),R=C(U);Ie(()=>{Ae(b,w(f).icon),Ae(I,w(f).title),Ae(R,w(f).description)}),G(u,m)}),G(r,s),Vt()}Xt(["click","keydown"]);var ig=te('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),sg=te('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),ag=te('<div class="game-container svelte-14svm27"><button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),og=te('<div class="app svelte-14svm27"><!></div>');function lg(r,e){Wt(e,!0),Zn(async()=>{if(Ct.selectedStory){const u=`${Ct.selectedStory}_story.json`,h=`${ys}/storage/v1/object/public/${Ct.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await Ct.loadStory(h)}});var t=og(),n=C(t);{var s=u=>{ng(u,{})},l=u=>{var h=Gt(),f=jt(h);{var m=b=>{var S=ig();G(b,S)},_=b=>{var S=Gt(),p=jt(S);{var I=R=>{var B=sg(),q=C(B),N=L(q);N.__click=()=>Ct.selectedStory=null,Ie(()=>Ae(q,`⚠️ ${Ct.error??""} `)),G(R,B)},U=R=>{var B=ag(),q=C(B);q.__click=()=>Ct.selectedStory=null;var N=L(q,2),K=C(N);{var J=D=>{{let W=Cr(()=>Ct.selectedStory||void 0);Lu(D,{get bucketName(){return w(W)}})}};je(K,D=>{Ct.storyData&&D(J)})}G(R,B)};je(p,R=>{Ct.error?R(I):R(U,!1)},!0)}G(b,S)};je(f,b=>{Ct.isLoading?b(m):b(_,!1)},!0)}G(u,h)};je(n,u=>{Ct.selectedStory?u(l,!1):u(s)})}G(r,t),Vt()}Xt(["click"]);var ug=te('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),cg=te('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function dg(r,e){Wt(e,!1),Zr();var t=Gt(),n=jt(t);{var s=u=>{var h=ug(),f=jt(h);f.__click=function(..._){pt.toggleEditor?.apply(this,_)};var m=L(f,2);Qp(m,{}),G(u,h)},l=u=>{var h=cg(),f=jt(h);f.__click=function(..._){pt.toggleEditor?.apply(this,_)};var m=L(f,2);lg(m,{}),G(u,h)};je(n,u=>{M.showEditor?u(s):u(l,!1)})}G(r,t),Vt()}Xt(["click"]);wd(dg,{target:document.getElementById("app")});
