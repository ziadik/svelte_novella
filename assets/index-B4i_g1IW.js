(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const DEV=!1;var is_array=Array.isArray,index_of=Array.prototype.indexOf,array_from=Array.from,define_property=Object.defineProperty,get_descriptor=Object.getOwnPropertyDescriptor,get_descriptors=Object.getOwnPropertyDescriptors,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf,is_extensible=Object.isExtensible;const noop$2=()=>{};function run(r){return r()}function run_all(r){for(var e=0;e<r.length;e++)r[e]()}function deferred(){var r,e,t=new Promise((i,n)=>{r=i,e=n});return{promise:t,resolve:r,reject:e}}const DERIVED=2,EFFECT=4,RENDER_EFFECT=8,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,UNOWNED=256,DISCONNECTED=512,CLEAN=1024,DIRTY=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EFFECT_TRANSPARENT=65536,INSPECT_EFFECT=1<<17,HEAD_EFFECT=1<<18,EFFECT_PRESERVED=1<<19,USER_EFFECT=1<<20,REACTION_IS_UPDATING=1<<21,ASYNC=1<<22,ERROR_VALUE=1<<23,STATE_SYMBOL=Symbol("$state"),LEGACY_PROPS=Symbol("legacy props"),LOADING_ATTR_SYMBOL=Symbol(""),STALE_REACTION=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function await_outside_boundary(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function lifecycle_outside_component(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function async_derived_orphan(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function effect_in_teardown(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function effect_in_unowned_derived(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function effect_orphan(r){throw new Error("https://svelte.dev/e/effect_orphan")}function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function props_invalid_value(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const EACH_ITEM_REACTIVE=1,EACH_INDEX_REACTIVE=2,EACH_IS_CONTROLLED=4,EACH_IS_ANIMATED=8,EACH_ITEM_IMMUTABLE=16,PROPS_IS_IMMUTABLE=1,PROPS_IS_RUNES=2,PROPS_IS_UPDATED=4,PROPS_IS_BINDABLE=8,PROPS_IS_LAZY_INITIAL=16,TEMPLATE_FRAGMENT=1,TEMPLATE_USE_IMPORT_NODE=2,UNINITIALIZED=Symbol(),NAMESPACE_HTML="http://www.w3.org/1999/xhtml";function select_multiple_invalid_value(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let hydrating=!1;function equals(r){return r===this.v}function safe_not_equal(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function not_equal(r,e){return r!==e}function safe_equals(r){return!safe_not_equal(r,this.v)}let legacy_mode_flag=!1,tracing_mode_flag=!1;function enable_legacy_mode_flag(){legacy_mode_flag=!0}let component_context=null;function set_component_context(r){component_context=r}function push(r,e=!1,t){component_context={p:component_context,c:null,e:null,s:r,x:null,l:legacy_mode_flag&&!e?{s:null,u:null,$:[]}:null}}function pop(r){var e=component_context,t=e.e;if(t!==null){e.e=null;for(var i of t)create_user_effect(i)}return component_context=e.p,{}}function is_runes(){return!legacy_mode_flag||component_context!==null&&component_context.l===null}const adjustments=new WeakMap;function handle_error(r){var e=active_effect;if(e===null)return active_reaction.f|=ERROR_VALUE,r;if((e.f&EFFECT_RAN)===0){if((e.f&BOUNDARY_EFFECT)===0)throw!e.parent&&r instanceof Error&&apply_adjustments(r),r;e.b.error(r)}else invoke_error_boundary(r,e)}function invoke_error_boundary(r,e){for(;e!==null;){if((e.f&BOUNDARY_EFFECT)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&apply_adjustments(r),r}function apply_adjustments(r){const e=adjustments.get(r);e&&(define_property(r,"message",{value:e.message}),define_property(r,"stack",{value:e.stack}))}let micro_tasks=[],idle_tasks=[];function run_micro_tasks(){var r=micro_tasks;micro_tasks=[],run_all(r)}function run_idle_tasks(){var r=idle_tasks;idle_tasks=[],run_all(r)}function queue_micro_task(r){micro_tasks.length===0&&queueMicrotask(run_micro_tasks),micro_tasks.push(r)}function flush_tasks(){micro_tasks.length>0&&run_micro_tasks(),idle_tasks.length>0&&run_idle_tasks()}function get_pending_boundary(){for(var r=active_effect.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&await_outside_boundary(),r}function derived(r){var e=DERIVED|DIRTY,t=active_reaction!==null&&(active_reaction.f&DERIVED)!==0?active_reaction:null;return active_effect===null||t!==null&&(t.f&UNOWNED)!==0?e|=UNOWNED:active_effect.f|=EFFECT_PRESERVED,{ctx:component_context,deps:null,effects:null,equals,f:e,fn:r,reactions:null,rv:0,v:UNINITIALIZED,wv:0,parent:t??active_effect,ac:null}}function async_derived(r,e){let t=active_effect;t===null&&async_derived_orphan();var i=t.b,n=void 0,o=source(UNINITIALIZED),u=null,f=!active_reaction;return async_effect(()=>{try{var p=r();u&&Promise.resolve(p).catch(()=>{})}catch(_){p=Promise.reject(_)}var v=()=>p;n=u?.then(v,v)??Promise.resolve(p),u=n;var g=current_batch,m=i.pending;f&&(i.update_pending_count(1),m||g.increment());const $=(_,E=void 0)=>{u=null,m||g.activate(),E?E!==STALE_REACTION&&(o.f|=ERROR_VALUE,internal_set(o,E)):((o.f&ERROR_VALUE)!==0&&(o.f^=ERROR_VALUE),internal_set(o,_)),f&&(i.update_pending_count(-1),m||g.decrement()),unset_context()};if(n.then($,_=>$(null,_||"unknown")),g)return()=>{queueMicrotask(()=>g.neuter())}}),new Promise(p=>{function v(g){function m(){g===n?p(o):v(n)}g.then(m,m)}v(n)})}function user_derived(r){const e=derived(r);return push_reaction_value(e),e}function derived_safe_equal(r){const e=derived(r);return e.equals=safe_equals,e}function destroy_derived_effects(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)destroy_effect(e[t])}}function get_derived_parent_effect(r){for(var e=r.parent;e!==null;){if((e.f&DERIVED)===0)return e;e=e.parent}return null}function execute_derived(r){var e,t=active_effect;set_active_effect(get_derived_parent_effect(r));try{destroy_derived_effects(r),e=update_reaction(r)}finally{set_active_effect(t)}return e}function update_derived(r){var e=execute_derived(r);if(r.equals(e)||(r.v=e,r.wv=increment_write_version()),!is_destroying_effect){var t=(skip_reaction||(r.f&UNOWNED)!==0)&&r.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(r,t)}}function flatten(r,e,t){const i=is_runes()?derived:derived_safe_equal;if(e.length===0){t(r.map(i));return}var n=current_batch,o=active_effect,u=capture(),f=get_pending_boundary();Promise.all(e.map(p=>async_derived(p))).then(p=>{n?.activate(),u();try{t([...r.map(i),...p])}catch(v){(o.f&DESTROYED)===0&&invoke_error_boundary(v,o)}n?.deactivate(),unset_context()}).catch(p=>{f.error(p)})}function capture(){var r=active_effect,e=active_reaction,t=component_context,i=current_batch;return function(){set_active_effect(r),set_active_reaction(e),set_component_context(t),i?.activate()}}function unset_context(){set_active_effect(null),set_active_reaction(null),set_component_context(null)}const batches=new Set;let current_batch=null,previous_batch=null,effect_pending_updates=new Set,tasks=[];function dequeue(){const r=tasks.shift();tasks.length>0&&queueMicrotask(dequeue),r()}let queued_root_effects=[],last_scheduled_effect=null,is_flushing=!1,is_flushing_sync=!1;class Batch{current=new Map;#s=new Map;#i=new Set;#e=0;#a=null;#o=!1;#t=[];#n=[];#r=[];#l=[];#c=[];#d=[];#f=[];skipped_effects=new Set;process(e){queued_root_effects=[],previous_batch=null;for(const n of e)this.#v(n);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#r,i=this.#l;this.#r=[],this.#l=[],this.#c=[],previous_batch=current_batch,current_batch=null,flush_queued_effects(t),flush_queued_effects(i),current_batch===null?current_batch=this:batches.delete(this),this.#a?.resolve()}else this.#u(this.#r),this.#u(this.#l),this.#u(this.#c);for(const n of this.#t)update_effect(n);for(const n of this.#n)update_effect(n);this.#t=[],this.#n=[]}#v(e){e.f^=CLEAN;for(var t=e.first;t!==null;){var i=t.f,n=(i&(BRANCH_EFFECT|ROOT_EFFECT))!==0,o=n&&(i&CLEAN)!==0,u=o||(i&INERT)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(n)t.f^=CLEAN;else if((i&EFFECT)!==0)this.#l.push(t);else if((i&CLEAN)===0)if((i&ASYNC)!==0){var f=t.b?.pending?this.#n:this.#t;f.push(t)}else is_dirty(t)&&((t.f&BLOCK_EFFECT)!==0&&this.#c.push(t),update_effect(t));var p=t.first;if(p!==null){t=p;continue}}var v=t.parent;for(t=t.next;t===null&&v!==null;)t=v.next,v=v.parent}}#u(e){for(const t of e)((t.f&DIRTY)!==0?this.#d:this.#f).push(t),set_signal_status(t,CLEAN);e.length=0}capture(e,t){this.#s.has(e)||this.#s.set(e,t),this.current.set(e,e.v)}activate(){current_batch=this}deactivate(){current_batch=null,previous_batch=null;for(const e of effect_pending_updates)if(effect_pending_updates.delete(e),e(),current_batch!==null)break}neuter(){this.#o=!0}flush(){queued_root_effects.length>0?flush_effects():this.#h(),current_batch===this&&(this.#e===0&&batches.delete(this),this.deactivate())}#h(){if(!this.#o)for(const e of this.#i)e();this.#i.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)set_signal_status(e,DIRTY),schedule_effect(e);for(const e of this.#f)set_signal_status(e,MAYBE_DIRTY),schedule_effect(e);this.#r=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#i.add(e)}settled(){return(this.#a??=deferred()).promise}static ensure(){if(current_batch===null){const e=current_batch=new Batch;batches.add(current_batch),is_flushing_sync||Batch.enqueue(()=>{current_batch===e&&e.flush()})}return current_batch}static enqueue(e){tasks.length===0&&queueMicrotask(dequeue),tasks.unshift(e)}}function flushSync(r){var e=is_flushing_sync;is_flushing_sync=!0;try{for(var t;;){if(flush_tasks(),queued_root_effects.length===0&&(current_batch?.flush(),queued_root_effects.length===0))return last_scheduled_effect=null,t;flush_effects()}}finally{is_flushing_sync=e}}function flush_effects(){var r=is_updating_effect;is_flushing=!0;try{var e=0;for(set_is_updating_effect(!0);queued_root_effects.length>0;){var t=Batch.ensure();if(e++>1e3){var i,n;infinite_loop_guard()}t.process(queued_root_effects),old_values.clear()}}finally{is_flushing=!1,set_is_updating_effect(r),last_scheduled_effect=null}}function infinite_loop_guard(){try{effect_update_depth_exceeded()}catch(r){invoke_error_boundary(r,last_scheduled_effect)}}let eager_block_effects=null;function flush_queued_effects(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var i=r[t++];if((i.f&(DESTROYED|INERT))===0&&is_dirty(i)&&(eager_block_effects=[],update_effect(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?unlink_effect(i):i.fn=null),eager_block_effects?.length>0)){old_values.clear();for(const n of eager_block_effects)update_effect(n);eager_block_effects=[]}}eager_block_effects=null}}function schedule_effect(r){for(var e=last_scheduled_effect=r;e.parent!==null;){e=e.parent;var t=e.f;if(is_flushing&&e===active_effect&&(t&BLOCK_EFFECT)!==0)return;if((t&(ROOT_EFFECT|BRANCH_EFFECT))!==0){if((t&CLEAN)===0)return;e.f^=CLEAN}}queued_root_effects.push(e)}const old_values=new Map;function source(r,e){var t={f:0,v:r,reactions:null,equals,rv:0,wv:0};return t}function state(r,e){const t=source(r);return push_reaction_value(t),t}function mutable_source(r,e=!1,t=!0){const i=source(r);return e||(i.equals=safe_equals),legacy_mode_flag&&t&&component_context!==null&&component_context.l!==null&&(component_context.l.s??=[]).push(i),i}function set(r,e,t=!1){active_reaction!==null&&(!untracking||(active_reaction.f&INSPECT_EFFECT)!==0)&&is_runes()&&(active_reaction.f&(DERIVED|BLOCK_EFFECT|ASYNC|INSPECT_EFFECT))!==0&&!current_sources?.includes(r)&&state_unsafe_mutation();let i=t?proxy(e):e;return internal_set(r,i)}function internal_set(r,e){if(!r.equals(e)){var t=r.v;is_destroying_effect?old_values.set(r,e):old_values.set(r,t),r.v=e;var i=Batch.ensure();i.capture(r,t),(r.f&DERIVED)!==0&&((r.f&DIRTY)!==0&&execute_derived(r),set_signal_status(r,(r.f&UNOWNED)===0?CLEAN:MAYBE_DIRTY)),r.wv=increment_write_version(),mark_reactions(r,DIRTY),is_runes()&&active_effect!==null&&(active_effect.f&CLEAN)!==0&&(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))===0&&(untracked_writes===null?set_untracked_writes([r]):untracked_writes.push(r))}return e}function update(r,e=1){var t=get$2(r),i=e===1?t++:t--;return set(r,t),i}function increment(r){set(r,r.v+1)}function mark_reactions(r,e){var t=r.reactions;if(t!==null)for(var i=is_runes(),n=t.length,o=0;o<n;o++){var u=t[o],f=u.f;if(!(!i&&u===active_effect)){var p=(f&DIRTY)===0;p&&set_signal_status(u,e),(f&DERIVED)!==0?mark_reactions(u,MAYBE_DIRTY):p&&((f&BLOCK_EFFECT)!==0&&eager_block_effects!==null&&eager_block_effects.push(u),schedule_effect(u))}}}function proxy(r){if(typeof r!="object"||r===null||STATE_SYMBOL in r)return r;const e=get_prototype_of(r);if(e!==object_prototype&&e!==array_prototype)return r;var t=new Map,i=is_array(r),n=state(0),o=update_version,u=f=>{if(update_version===o)return f();var p=active_reaction,v=update_version;set_active_reaction(null),set_update_version(o);var g=f();return set_active_reaction(p),set_update_version(v),g};return i&&t.set("length",state(r.length)),new Proxy(r,{defineProperty(f,p,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&state_descriptors_fixed();var g=t.get(p);return g===void 0?g=u(()=>{var m=state(v.value);return t.set(p,m),m}):set(g,v.value,!0),!0},deleteProperty(f,p){var v=t.get(p);if(v===void 0){if(p in f){const g=u(()=>state(UNINITIALIZED));t.set(p,g),increment(n)}}else set(v,UNINITIALIZED),increment(n);return!0},get(f,p,v){if(p===STATE_SYMBOL)return r;var g=t.get(p),m=p in f;if(g===void 0&&(!m||get_descriptor(f,p)?.writable)&&(g=u(()=>{var _=proxy(m?f[p]:UNINITIALIZED),E=state(_);return E}),t.set(p,g)),g!==void 0){var $=get$2(g);return $===UNINITIALIZED?void 0:$}return Reflect.get(f,p,v)},getOwnPropertyDescriptor(f,p){var v=Reflect.getOwnPropertyDescriptor(f,p);if(v&&"value"in v){var g=t.get(p);g&&(v.value=get$2(g))}else if(v===void 0){var m=t.get(p),$=m?.v;if(m!==void 0&&$!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:$,writable:!0}}return v},has(f,p){if(p===STATE_SYMBOL)return!0;var v=t.get(p),g=v!==void 0&&v.v!==UNINITIALIZED||Reflect.has(f,p);if(v!==void 0||active_effect!==null&&(!g||get_descriptor(f,p)?.writable)){v===void 0&&(v=u(()=>{var $=g?proxy(f[p]):UNINITIALIZED,_=state($);return _}),t.set(p,v));var m=get$2(v);if(m===UNINITIALIZED)return!1}return g},set(f,p,v,g){var m=t.get(p),$=p in f;if(i&&p==="length")for(var _=v;_<m.v;_+=1){var E=t.get(_+"");E!==void 0?set(E,UNINITIALIZED):_ in f&&(E=u(()=>state(UNINITIALIZED)),t.set(_+"",E))}if(m===void 0)(!$||get_descriptor(f,p)?.writable)&&(m=u(()=>state(void 0)),set(m,proxy(v)),t.set(p,m));else{$=m.v!==UNINITIALIZED;var T=u(()=>proxy(v));set(m,T)}var x=Reflect.getOwnPropertyDescriptor(f,p);if(x?.set&&x.set.call(g,v),!$){if(i&&typeof p=="string"){var D=t.get("length"),P=Number(p);Number.isInteger(P)&&P>=D.v&&set(D,P+1)}increment(n)}return!0},ownKeys(f){get$2(n);var p=Reflect.ownKeys(f).filter(m=>{var $=t.get(m);return $===void 0||$.v!==UNINITIALIZED});for(var[v,g]of t)g.v!==UNINITIALIZED&&!(v in f)&&p.push(v);return p},setPrototypeOf(){state_prototype_fixed()}})}function get_proxied_value(r){try{if(r!==null&&typeof r=="object"&&STATE_SYMBOL in r)return r[STATE_SYMBOL]}catch{}return r}function is(r,e){return Object.is(get_proxied_value(r),get_proxied_value(e))}var $window,is_firefox,first_child_getter,next_sibling_getter;function init_operations(){if($window===void 0){$window=window,is_firefox=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;first_child_getter=get_descriptor(e,"firstChild").get,next_sibling_getter=get_descriptor(e,"nextSibling").get,is_extensible(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),is_extensible(t)&&(t.__t=void 0)}}function create_text(r=""){return document.createTextNode(r)}function get_first_child(r){return first_child_getter.call(r)}function get_next_sibling(r){return next_sibling_getter.call(r)}function child(r,e){return get_first_child(r)}function first_child(r,e){{var t=get_first_child(r);return t instanceof Comment&&t.data===""?get_next_sibling(t):t}}function sibling(r,e=1,t=!1){let i=r;for(;e--;)i=get_next_sibling(i);return i}function clear_text_content(r){r.textContent=""}function should_defer_append(){return!1}let listening_to_form_reset=!1;function add_form_reset_listener(){listening_to_form_reset||(listening_to_form_reset=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function without_reactive_context(r){var e=active_reaction,t=active_effect;set_active_reaction(null),set_active_effect(null);try{return r()}finally{set_active_reaction(e),set_active_effect(t)}}function listen_to_event_and_reset_event(r,e,t,i=t){r.addEventListener(e,()=>without_reactive_context(t));const n=r.__on_r;n?r.__on_r=()=>{n(),i(!0)}:r.__on_r=()=>i(!0),add_form_reset_listener()}function validate_effect(r){active_effect===null&&active_reaction===null&&effect_orphan(),active_reaction!==null&&(active_reaction.f&UNOWNED)!==0&&active_effect===null&&effect_in_unowned_derived(),is_destroying_effect&&effect_in_teardown()}function push_effect(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function create_effect(r,e,t,i=!0){var n=active_effect;n!==null&&(n.f&INERT)!==0&&(r|=INERT);var o={ctx:component_context,deps:null,nodes_start:null,nodes_end:null,f:r|DIRTY,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{update_effect(o),o.f|=EFFECT_RAN}catch(p){throw destroy_effect(o),p}else e!==null&&schedule_effect(o);if(i){var u=o;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&EFFECT_PRESERVED)===0&&(u=u.first),u!==null&&(u.parent=n,n!==null&&push_effect(u,n),active_reaction!==null&&(active_reaction.f&DERIVED)!==0&&(r&ROOT_EFFECT)===0)){var f=active_reaction;(f.effects??=[]).push(u)}}return o}function teardown(r){const e=create_effect(RENDER_EFFECT,null,!1);return set_signal_status(e,CLEAN),e.teardown=r,e}function user_effect(r){validate_effect();var e=active_effect.f,t=!active_reaction&&(e&BRANCH_EFFECT)!==0&&(e&EFFECT_RAN)===0;if(t){var i=component_context;(i.e??=[]).push(r)}else return create_user_effect(r)}function create_user_effect(r){return create_effect(EFFECT|USER_EFFECT,r,!1)}function user_pre_effect(r){return validate_effect(),create_effect(RENDER_EFFECT|USER_EFFECT,r,!0)}function component_root(r){Batch.ensure();const e=create_effect(ROOT_EFFECT|EFFECT_PRESERVED,r,!0);return(t={})=>new Promise(i=>{t.outro?pause_effect(e,()=>{destroy_effect(e),i(void 0)}):(destroy_effect(e),i(void 0))})}function effect(r){return create_effect(EFFECT,r,!1)}function async_effect(r){return create_effect(ASYNC|EFFECT_PRESERVED,r,!0)}function render_effect(r,e=0){return create_effect(RENDER_EFFECT|e,r,!0)}function template_effect(r,e=[],t=[]){flatten(e,t,i=>{create_effect(RENDER_EFFECT,()=>r(...i.map(get$2)),!0)})}function block(r,e=0){var t=create_effect(BLOCK_EFFECT|e,r,!0);return t}function branch(r,e=!0){return create_effect(BRANCH_EFFECT|EFFECT_PRESERVED,r,!0,e)}function execute_effect_teardown(r){var e=r.teardown;if(e!==null){const t=is_destroying_effect,i=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{e.call(null)}finally{set_is_destroying_effect(t),set_active_reaction(i)}}}function destroy_effect_children(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const n=t.ac;n!==null&&without_reactive_context(()=>{n.abort(STALE_REACTION)});var i=t.next;(t.f&ROOT_EFFECT)!==0?t.parent=null:destroy_effect(t,e),t=i}}function destroy_block_effect_children(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&BRANCH_EFFECT)===0&&destroy_effect(e),e=t}}function destroy_effect(r,e=!0){var t=!1;(e||(r.f&HEAD_EFFECT)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(remove_effect_dom(r.nodes_start,r.nodes_end),t=!0),destroy_effect_children(r,e&&!t),remove_reactions(r,0),set_signal_status(r,DESTROYED);var i=r.transitions;if(i!==null)for(const o of i)o.stop();execute_effect_teardown(r);var n=r.parent;n!==null&&n.first!==null&&unlink_effect(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function remove_effect_dom(r,e){for(;r!==null;){var t=r===e?null:get_next_sibling(r);r.remove(),r=t}}function unlink_effect(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function pause_effect(r,e){var t=[];pause_children(r,t,!0),run_out_transitions(t,()=>{destroy_effect(r),e&&e()})}function run_out_transitions(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var n of r)n.out(i)}else e()}function pause_children(r,e,t){if((r.f&INERT)===0){if(r.f^=INERT,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var i=r.first;i!==null;){var n=i.next,o=(i.f&EFFECT_TRANSPARENT)!==0||(i.f&BRANCH_EFFECT)!==0;pause_children(i,e,o?t:!1),i=n}}}function resume_effect(r){resume_children(r,!0)}function resume_children(r,e){if((r.f&INERT)!==0){r.f^=INERT,(r.f&CLEAN)===0&&(set_signal_status(r,DIRTY),schedule_effect(r));for(var t=r.first;t!==null;){var i=t.next,n=(t.f&EFFECT_TRANSPARENT)!==0||(t.f&BRANCH_EFFECT)!==0;resume_children(t,n?e:!1),t=i}if(r.transitions!==null)for(const o of r.transitions)(o.is_global||e)&&o.in()}}let captured_signals=null;function capture_signals(r){var e=captured_signals;try{if(captured_signals=new Set,untrack(r),e!==null)for(var t of captured_signals)e.add(t);return captured_signals}finally{captured_signals=e}}function invalidate_inner_signals(r){for(var e of capture_signals(r))internal_set(e,e.v)}let is_updating_effect=!1;function set_is_updating_effect(r){is_updating_effect=r}let is_destroying_effect=!1;function set_is_destroying_effect(r){is_destroying_effect=r}let active_reaction=null,untracking=!1;function set_active_reaction(r){active_reaction=r}let active_effect=null;function set_active_effect(r){active_effect=r}let current_sources=null;function push_reaction_value(r){active_reaction!==null&&(current_sources===null?current_sources=[r]:current_sources.push(r))}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(r){untracked_writes=r}let write_version=1,read_version=0,update_version=read_version;function set_update_version(r){update_version=r}let skip_reaction=!1;function increment_write_version(){return++write_version}function is_dirty(r){var e=r.f;if((e&DIRTY)!==0)return!0;if((e&MAYBE_DIRTY)!==0){var t=r.deps,i=(e&UNOWNED)!==0;if(t!==null){var n,o,u=(e&DISCONNECTED)!==0,f=i&&active_effect!==null&&!skip_reaction,p=t.length;if((u||f)&&(active_effect===null||(active_effect.f&DESTROYED)===0)){var v=r,g=v.parent;for(n=0;n<p;n++)o=t[n],(u||!o?.reactions?.includes(v))&&(o.reactions??=[]).push(v);u&&(v.f^=DISCONNECTED),f&&g!==null&&(g.f&UNOWNED)===0&&(v.f^=UNOWNED)}for(n=0;n<p;n++)if(o=t[n],is_dirty(o)&&update_derived(o),o.wv>r.wv)return!0}(!i||active_effect!==null&&!skip_reaction)&&set_signal_status(r,CLEAN)}return!1}function schedule_possible_effect_self_invalidation(r,e,t=!0){var i=r.reactions;if(i!==null&&!current_sources?.includes(r))for(var n=0;n<i.length;n++){var o=i[n];(o.f&DERIVED)!==0?schedule_possible_effect_self_invalidation(o,e,!1):e===o&&(t?set_signal_status(o,DIRTY):(o.f&CLEAN)!==0&&set_signal_status(o,MAYBE_DIRTY),schedule_effect(o))}}function update_reaction(r){var e=new_deps,t=skipped_deps,i=untracked_writes,n=active_reaction,o=skip_reaction,u=current_sources,f=component_context,p=untracking,v=update_version,g=r.f;new_deps=null,skipped_deps=0,untracked_writes=null,skip_reaction=(g&UNOWNED)!==0&&(untracking||!is_updating_effect||active_reaction===null),active_reaction=(g&(BRANCH_EFFECT|ROOT_EFFECT))===0?r:null,current_sources=null,set_component_context(r.ctx),untracking=!1,update_version=++read_version,r.ac!==null&&(without_reactive_context(()=>{r.ac.abort(STALE_REACTION)}),r.ac=null);try{r.f|=REACTION_IS_UPDATING;var m=r.fn,$=m(),_=r.deps;if(new_deps!==null){var E;if(remove_reactions(r,skipped_deps),_!==null&&skipped_deps>0)for(_.length=skipped_deps+new_deps.length,E=0;E<new_deps.length;E++)_[skipped_deps+E]=new_deps[E];else r.deps=_=new_deps;if(!skip_reaction||(g&DERIVED)!==0&&r.reactions!==null)for(E=skipped_deps;E<_.length;E++)(_[E].reactions??=[]).push(r)}else _!==null&&skipped_deps<_.length&&(remove_reactions(r,skipped_deps),_.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!untracking&&_!==null&&(r.f&(DERIVED|MAYBE_DIRTY|DIRTY))===0)for(E=0;E<untracked_writes.length;E++)schedule_possible_effect_self_invalidation(untracked_writes[E],r);return n!==null&&n!==r&&(read_version++,untracked_writes!==null&&(i===null?i=untracked_writes:i.push(...untracked_writes))),(r.f&ERROR_VALUE)!==0&&(r.f^=ERROR_VALUE),$}catch(T){return handle_error(T)}finally{r.f^=REACTION_IS_UPDATING,new_deps=e,skipped_deps=t,untracked_writes=i,active_reaction=n,skip_reaction=o,current_sources=u,set_component_context(f),untracking=p,update_version=v}}function remove_reaction(r,e){let t=e.reactions;if(t!==null){var i=index_of.call(t,r);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&(e.f&DERIVED)!==0&&(new_deps===null||!new_deps.includes(e))&&(set_signal_status(e,MAYBE_DIRTY),(e.f&(UNOWNED|DISCONNECTED))===0&&(e.f^=DISCONNECTED),destroy_derived_effects(e),remove_reactions(e,0))}function remove_reactions(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)remove_reaction(r,t[i])}function update_effect(r){var e=r.f;if((e&DESTROYED)===0){set_signal_status(r,CLEAN);var t=active_effect,i=is_updating_effect;active_effect=r,is_updating_effect=!0;try{(e&BLOCK_EFFECT)!==0?destroy_block_effect_children(r):destroy_effect_children(r),execute_effect_teardown(r);var n=update_reaction(r);r.teardown=typeof n=="function"?n:null,r.wv=write_version;var o;DEV&&tracing_mode_flag&&(r.f&DIRTY)!==0&&r.deps}finally{is_updating_effect=i,active_effect=t}}}async function tick(){await Promise.resolve(),flushSync()}function get$2(r){var e=r.f,t=(e&DERIVED)!==0;if(captured_signals?.add(r),active_reaction!==null&&!untracking){var i=active_effect!==null&&(active_effect.f&DESTROYED)!==0;if(!i&&!current_sources?.includes(r)){var n=active_reaction.deps;if((active_reaction.f&REACTION_IS_UPDATING)!==0)r.rv<read_version&&(r.rv=read_version,new_deps===null&&n!==null&&n[skipped_deps]===r?skipped_deps++:new_deps===null?new_deps=[r]:(!skip_reaction||!new_deps.includes(r))&&new_deps.push(r));else{(active_reaction.deps??=[]).push(r);var o=r.reactions;o===null?r.reactions=[active_reaction]:o.includes(active_reaction)||o.push(active_reaction)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,f=u.parent;f!==null&&(f.f&UNOWNED)===0&&(u.f^=UNOWNED)}if(is_destroying_effect){if(old_values.has(r))return old_values.get(r);if(t){u=r;var p=u.v;return((u.f&CLEAN)===0&&u.reactions!==null||depends_on_old_values(u))&&(p=execute_derived(u)),old_values.set(u,p),p}}else t&&(u=r,is_dirty(u)&&update_derived(u));if((r.f&ERROR_VALUE)!==0)throw r.v;return r.v}function depends_on_old_values(r){if(r.v===UNINITIALIZED)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(old_values.has(e)||(e.f&DERIVED)!==0&&depends_on_old_values(e))return!0;return!1}function untrack(r){var e=untracking;try{return untracking=!0,r()}finally{untracking=e}}const STATUS_MASK=-7169;function set_signal_status(r,e){r.f=r.f&STATUS_MASK|e}function deep_read_state(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(STATE_SYMBOL in r)deep_read(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&STATE_SYMBOL in t&&deep_read(t)}}}function deep_read(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{deep_read(r[i],e)}catch{}const t=get_prototype_of(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=get_descriptors(t);for(let n in i){const o=i[n].get;if(o)try{o.call(r)}catch{}}}}}const PASSIVE_EVENTS=["touchstart","touchmove"];function is_passive_event(r){return PASSIVE_EVENTS.includes(r)}const all_registered_events=new Set,root_event_handles=new Set;function create_event(r,e,t,i={}){function n(o){if(i.capture||handle_event_propagation.call(e,o),!o.cancelBubble)return without_reactive_context(()=>t?.call(this,o))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?queue_micro_task(()=>{e.addEventListener(r,n,i)}):e.addEventListener(r,n,i),n}function event(r,e,t,i,n){var o={capture:i,passive:n},u=create_event(r,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&teardown(()=>{e.removeEventListener(r,u,o)})}function delegate(r){for(var e=0;e<r.length;e++)all_registered_events.add(r[e]);for(var t of root_event_handles)t(r)}let last_propagated_event=null;function handle_event_propagation(r){var e=this,t=e.ownerDocument,i=r.type,n=r.composedPath?.()||[],o=n[0]||r.target;last_propagated_event=r;var u=0,f=last_propagated_event===r&&r.__root;if(f){var p=n.indexOf(f);if(p!==-1&&(e===document||e===window)){r.__root=e;return}var v=n.indexOf(e);if(v===-1)return;p<=v&&(u=p)}if(o=n[u]||r.target,o!==e){define_property(r,"currentTarget",{configurable:!0,get(){return o||t}});var g=active_reaction,m=active_effect;set_active_reaction(null),set_active_effect(null);try{for(var $,_=[];o!==null;){var E=o.assignedSlot||o.parentNode||o.host||null;try{var T=o["__"+i];if(T!=null&&(!o.disabled||r.target===o))if(is_array(T)){var[x,...D]=T;x.apply(o,[r,...D])}else T.call(o,r)}catch(P){$?_.push(P):$=P}if(r.cancelBubble||E===e||E===null)break;o=E}if($){for(let P of _)queueMicrotask(()=>{throw P});throw $}}finally{r.__root=e,delete r.currentTarget,set_active_reaction(g),set_active_effect(m)}}}function create_fragment_from_html(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function assign_nodes(r,e){var t=active_effect;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function from_html(r,e){var t=(e&TEMPLATE_FRAGMENT)!==0,i=(e&TEMPLATE_USE_IMPORT_NODE)!==0,n,o=!r.startsWith("<!>");return()=>{n===void 0&&(n=create_fragment_from_html(o?r:"<!>"+r),t||(n=get_first_child(n)));var u=i||is_firefox?document.importNode(n,!0):n.cloneNode(!0);if(t){var f=get_first_child(u),p=u.lastChild;assign_nodes(f,p)}else assign_nodes(u,u);return u}}function from_namespace(r,e,t="svg"){var i=!r.startsWith("<!>"),n=`<${t}>${i?r:"<!>"+r}</${t}>`,o;return()=>{if(!o){var u=create_fragment_from_html(n),f=get_first_child(u);o=get_first_child(f)}var p=o.cloneNode(!0);return assign_nodes(p,p),p}}function from_svg(r,e){return from_namespace(r,e,"svg")}function text(r=""){{var e=create_text(r+"");return assign_nodes(e,e),e}}function comment(){var r=document.createDocumentFragment(),e=document.createComment(""),t=create_text();return r.append(e,t),assign_nodes(e,t),r}function append(r,e){r!==null&&r.before(e)}function set_text(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function mount(r,e){return _mount(r,e)}const document_listeners=new Map;function _mount(r,{target:e,anchor:t,props:i={},events:n,context:o,intro:u=!0}){init_operations();var f=new Set,p=m=>{for(var $=0;$<m.length;$++){var _=m[$];if(!f.has(_)){f.add(_);var E=is_passive_event(_);e.addEventListener(_,handle_event_propagation,{passive:E});var T=document_listeners.get(_);T===void 0?(document.addEventListener(_,handle_event_propagation,{passive:E}),document_listeners.set(_,1)):document_listeners.set(_,T+1)}}};p(array_from(all_registered_events)),root_event_handles.add(p);var v=void 0,g=component_root(()=>{var m=t??e.appendChild(create_text());return branch(()=>{if(o){push({});var $=component_context;$.c=o}n&&(i.$$events=n),v=r(m,i)||{},o&&pop()}),()=>{for(var $ of f){e.removeEventListener($,handle_event_propagation);var _=document_listeners.get($);--_===0?(document.removeEventListener($,handle_event_propagation),document_listeners.delete($)):document_listeners.set($,_)}root_event_handles.delete(p),m!==t&&m.parentNode?.removeChild(m)}});return mounted_components.set(v,g),v}let mounted_components=new WeakMap;function if_block(r,e,t=!1){var i=r,n=null,o=null,u=UNINITIALIZED,f=t?EFFECT_TRANSPARENT:0,p=!1;const v=(_,E=!0)=>{p=!0,$(E,_)};var g=null;function m(){g!==null&&(g.lastChild.remove(),i.before(g),g=null);var _=u?n:o,E=u?o:n;_&&resume_effect(_),E&&pause_effect(E,()=>{u?o=null:n=null})}const $=(_,E)=>{if(u!==(u=_)){var T=should_defer_append(),x=i;if(T&&(g=document.createDocumentFragment(),g.append(x=create_text())),u?n??=E&&branch(()=>E(x)):o??=E&&branch(()=>E(x)),T){var D=current_batch,P=u?n:o,R=u?o:n;P&&D.skipped_effects.delete(P),R&&D.skipped_effects.add(R),D.add_callback(m)}else m()}};block(()=>{p=!1,e(v),p||$(null,null)},f)}function key(r,e,t){var i=r,n=UNINITIALIZED,o,u,f=null,p=is_runes()?not_equal:safe_not_equal;function v(){o&&pause_effect(o),f!==null&&(f.lastChild.remove(),i.before(f),f=null),o=u}block(()=>{if(p(n,n=e())){var g=i,m=should_defer_append();m&&(f=document.createDocumentFragment(),f.append(g=create_text())),u=branch(()=>t(g)),m?current_batch.add_callback(v):v()}})}function index$1(r,e){return e}function pause_effects(r,e,t){for(var i=r.items,n=[],o=e.length,u=0;u<o;u++)pause_children(e[u].e,n,!0);var f=o>0&&n.length===0&&t!==null;if(f){var p=t.parentNode;clear_text_content(p),p.append(t),i.clear(),link(r,e[0].prev,e[o-1].next)}run_out_transitions(n,()=>{for(var v=0;v<o;v++){var g=e[v];f||(i.delete(g.k),link(r,g.prev,g.next)),destroy_effect(g.e,!f)}})}function each(r,e,t,i,n,o=null){var u=r,f={flags:e,items:new Map,first:null},p=(e&EACH_IS_CONTROLLED)!==0;if(p){var v=r;u=v.appendChild(create_text())}var g=null,m=!1,$=new Map,_=derived_safe_equal(()=>{var D=t();return is_array(D)?D:D==null?[]:array_from(D)}),E,T;function x(){reconcile(T,E,f,$,u,n,e,i,t),o!==null&&(E.length===0?g?resume_effect(g):g=branch(()=>o(u)):g!==null&&pause_effect(g,()=>{g=null}))}block(()=>{T??=active_effect,E=get$2(_);var D=E.length;if(!(m&&D===0)){m=D===0;var P,R,F,V;if(should_defer_append()){var I=new Set,k=current_batch;for(R=0;R<D;R+=1){F=E[R],V=i(F,R);var U=f.items.get(V)??$.get(V);U?(e&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0&&update_item(U,F,R,e):(P=create_item(null,f,null,null,F,V,R,n,e,t,!0),$.set(V,P)),I.add(V)}for(const[W,B]of f.items)I.has(W)||k.skipped_effects.add(B.e);k.add_callback(x)}else x();get$2(_)}})}function reconcile(r,e,t,i,n,o,u,f,p){var v=(u&EACH_IS_ANIMATED)!==0,g=(u&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0,m=e.length,$=t.items,_=t.first,E=_,T,x=null,D,P=[],R=[],F,V,I,k;if(v)for(k=0;k<m;k+=1)F=e[k],V=f(F,k),I=$.get(V),I!==void 0&&(I.a?.measure(),(D??=new Set).add(I));for(k=0;k<m;k+=1){if(F=e[k],V=f(F,k),I=$.get(V),I===void 0){var U=i.get(V);if(U!==void 0){i.delete(V),$.set(V,U);var W=x?x.next:E;link(t,x,U),link(t,U,W),move(U,W,n),x=U}else{var B=E?E.e.nodes_start:n;x=create_item(B,t,x,x===null?t.first:x.next,F,V,k,o,u,p)}$.set(V,x),P=[],R=[],E=x.next;continue}if(g&&update_item(I,F,k,u),(I.e.f&INERT)!==0&&(resume_effect(I.e),v&&(I.a?.unfix(),(D??=new Set).delete(I))),I!==E){if(T!==void 0&&T.has(I)){if(P.length<R.length){var L=R[0],G;x=L.prev;var re=P[0],ue=P[P.length-1];for(G=0;G<P.length;G+=1)move(P[G],L,n);for(G=0;G<R.length;G+=1)T.delete(R[G]);link(t,re.prev,ue.next),link(t,x,re),link(t,ue,L),E=L,x=ue,k-=1,P=[],R=[]}else T.delete(I),move(I,E,n),link(t,I.prev,I.next),link(t,I,x===null?t.first:x.next),link(t,x,I),x=I;continue}for(P=[],R=[];E!==null&&E.k!==V;)(E.e.f&INERT)===0&&(T??=new Set).add(E),R.push(E),E=E.next;if(E===null)continue;I=E}P.push(I),x=I,E=I.next}if(E!==null||T!==void 0){for(var z=T===void 0?[]:array_from(T);E!==null;)(E.e.f&INERT)===0&&z.push(E),E=E.next;var q=z.length;if(q>0){var N=(u&EACH_IS_CONTROLLED)!==0&&m===0?n:null;if(v){for(k=0;k<q;k+=1)z[k].a?.measure();for(k=0;k<q;k+=1)z[k].a?.fix()}pause_effects(t,z,N)}}v&&queue_micro_task(()=>{if(D!==void 0)for(I of D)I.a?.apply()}),r.first=t.first&&t.first.e,r.last=x&&x.e;for(var M of i.values())destroy_effect(M.e);i.clear()}function update_item(r,e,t,i){(i&EACH_ITEM_REACTIVE)!==0&&internal_set(r.v,e),(i&EACH_INDEX_REACTIVE)!==0?internal_set(r.i,t):r.i=t}function create_item(r,e,t,i,n,o,u,f,p,v,g){var m=(p&EACH_ITEM_REACTIVE)!==0,$=(p&EACH_ITEM_IMMUTABLE)===0,_=m?$?mutable_source(n,!1,!1):source(n):n,E=(p&EACH_INDEX_REACTIVE)===0?u:source(u),T={i:E,v:_,k:o,a:null,e:null,prev:t,next:i};try{if(r===null){var x=document.createDocumentFragment();x.append(r=create_text())}return T.e=branch(()=>f(r,_,E,v),hydrating),T.e.prev=t&&t.e,T.e.next=i&&i.e,t===null?g||(e.first=T):(t.next=T,t.e.next=T.e),i!==null&&(i.prev=T,i.e.prev=T.e),T}finally{}}function move(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,o=r.e.nodes_start;o!==null&&o!==i;){var u=get_next_sibling(o);n.before(o),o=u}}function link(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function snippet(r,e,...t){var i=r,n=noop$2,o;block(()=>{n!==(n=e())&&(o&&(destroy_effect(o),o=null),o=branch(()=>n(i,...t)))},EFFECT_TRANSPARENT)}function component(r,e,t){var i=r,n,o,u=null,f=null;function p(){o&&(pause_effect(o),o=null),u&&(u.lastChild.remove(),i.before(u),u=null),o=f,f=null}block(()=>{if(n!==(n=e())){var v=should_defer_append();if(n){var g=i;v&&(u=document.createDocumentFragment(),u.append(g=create_text()),o&&current_batch.skipped_effects.add(o)),f=branch(()=>t(g,n))}v?current_batch.add_callback(p):p()}},EFFECT_TRANSPARENT)}const whitespace=[...` 	
\r\f \v\uFEFF`];function to_class(r,e,t){var i=r==null?"":""+r;if(e&&(i=i?i+" "+e:e),t){for(var n in t)if(t[n])i=i?i+" "+n:n;else if(i.length)for(var o=n.length,u=0;(u=i.indexOf(n,u))>=0;){var f=u+o;(u===0||whitespace.includes(i[u-1]))&&(f===i.length||whitespace.includes(i[f]))?i=(u===0?"":i.substring(0,u))+i.substring(f+1):u=f}}return i===""?null:i}function to_style(r,e){return r==null?null:String(r)}function set_class(r,e,t,i,n,o){var u=r.__className;if(u!==t||u===void 0){var f=to_class(t,i,o);f==null?r.removeAttribute("class"):r.className=f,r.__className=t}else if(o&&n!==o)for(var p in o){var v=!!o[p];(n==null||v!==!!n[p])&&r.classList.toggle(p,v)}return o}function set_style(r,e,t,i){var n=r.__style;if(n!==e){var o=to_style(e);o==null?r.removeAttribute("style"):r.style.cssText=o,r.__style=e}return i}function select_option(r,e,t=!1){if(r.multiple){if(e==null)return;if(!is_array(e))return select_multiple_invalid_value();for(var i of r.options)i.selected=e.includes(get_option_value(i));return}for(i of r.options){var n=get_option_value(i);if(is(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function init_select(r){var e=new MutationObserver(()=>{select_option(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),teardown(()=>{e.disconnect()})}function bind_select_value(r,e,t=e){var i=!0;listen_to_event_and_reset_event(r,"change",n=>{var o=n?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(o),get_option_value);else{var f=r.querySelector(o)??r.querySelector("option:not([disabled])");u=f&&get_option_value(f)}t(u)}),effect(()=>{var n=e();if(select_option(r,n,i),i&&n===void 0){var o=r.querySelector(":checked");o!==null&&(n=get_option_value(o),t(n))}r.__value=n,i=!1}),init_select(r)}function get_option_value(r){return"__value"in r?r.__value:r.value}const IS_CUSTOM_ELEMENT=Symbol("is custom element"),IS_HTML=Symbol("is html");function set_value(r,e){var t=get_attributes(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function set_checked(r,e){var t=get_attributes(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function set_attribute(r,e,t,i){var n=get_attributes(r);n[e]!==(n[e]=t)&&(e==="loading"&&(r[LOADING_ATTR_SYMBOL]=t),t==null?r.removeAttribute(e):typeof t!="string"&&get_setters(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function get_attributes(r){return r.__attributes??={[IS_CUSTOM_ELEMENT]:r.nodeName.includes("-"),[IS_HTML]:r.namespaceURI===NAMESPACE_HTML}}var setters_cache=new Map;function get_setters(r){var e=r.getAttribute("is")||r.nodeName,t=setters_cache.get(e);if(t)return t;setters_cache.set(e,t=[]);for(var i,n=r,o=Element.prototype;o!==n;){i=get_descriptors(n);for(var u in i)i[u].set&&t.push(u);n=get_prototype_of(n)}return t}function bind_value(r,e,t=e){var i=new WeakSet;listen_to_event_and_reset_event(r,"input",async n=>{var o=n?r.defaultValue:r.value;if(o=is_numberlike_input(r)?to_number(o):o,t(o),current_batch!==null&&i.add(current_batch),await tick(),o!==(o=e())){var u=r.selectionStart,f=r.selectionEnd;r.value=o??"",f!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(f,r.value.length))}}),untrack(e)==null&&r.value&&(t(is_numberlike_input(r)?to_number(r.value):r.value),current_batch!==null&&i.add(current_batch)),render_effect(()=>{var n=e();if(r===document.activeElement){var o=previous_batch??current_batch;if(i.has(o))return}is_numberlike_input(r)&&n===to_number(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function bind_checked(r,e,t=e){listen_to_event_and_reset_event(r,"change",i=>{var n=i?r.defaultChecked:r.checked;t(n)}),untrack(e)==null&&t(r.checked),render_effect(()=>{var i=e();r.checked=!!i})}function is_numberlike_input(r){var e=r.type;return e==="number"||e==="range"}function to_number(r){return r===""?null:+r}function is_bound_this(r,e){return r===e||r?.[STATE_SYMBOL]===e}function bind_this(r={},e,t,i){return effect(()=>{var n,o;return render_effect(()=>{n=o,o=[],untrack(()=>{r!==t(...o)&&(e(r,...o),n&&is_bound_this(t(...n),r)&&e(null,...n))})}),()=>{queue_micro_task(()=>{o&&is_bound_this(t(...o),r)&&e(null,...o)})}}),r}function init(r=!1){const e=component_context,t=e.l.u;if(!t)return;let i=()=>deep_read_state(e.s);if(r){let n=0,o={};const u=derived(()=>{let f=!1;const p=e.s;for(const v in p)p[v]!==o[v]&&(o[v]=p[v],f=!0);return f&&n++,n});i=()=>get$2(u)}t.b.length&&user_pre_effect(()=>{observe_all(e,i),run_all(t.b)}),user_effect(()=>{const n=untrack(()=>t.m.map(run));return()=>{for(const o of n)typeof o=="function"&&o()}}),t.a.length&&user_effect(()=>{observe_all(e,i),run_all(t.a)})}function observe_all(r,e){if(r.l.s)for(const t of r.l.s)get$2(t);e()}function reactive_import(r){var e=source(0);return function(){return arguments.length===1?(set(e,get$2(e)+1),arguments[0]):(get$2(e),r())}}function subscribe_to_store(r,e,t){if(r==null)return e(void 0),noop$2;const i=untrack(()=>r.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const subscriber_queue=[];function writable(r,e=noop$2){let t=null;const i=new Set;function n(f){if(safe_not_equal(r,f)&&(r=f,t)){const p=!subscriber_queue.length;for(const v of i)v[1](),subscriber_queue.push(v,r);if(p){for(let v=0;v<subscriber_queue.length;v+=2)subscriber_queue[v][0](subscriber_queue[v+1]);subscriber_queue.length=0}}}function o(f){n(f(r))}function u(f,p=noop$2){const v=[f,p];return i.add(v),i.size===1&&(t=e(n,o)||noop$2),f(r),()=>{i.delete(v),i.size===0&&t&&(t(),t=null)}}return{set:n,update:o,subscribe:u}}function get$1(r){let e;return subscribe_to_store(r,t=>e=t)(),e}let is_store_binding=!1;function capture_store_binding(r){var e=is_store_binding;try{return is_store_binding=!1,[r(),is_store_binding]}finally{is_store_binding=e}}function prop(r,e,t,i){var n=!legacy_mode_flag||(t&PROPS_IS_RUNES)!==0,o=(t&PROPS_IS_BINDABLE)!==0,u=(t&PROPS_IS_LAZY_INITIAL)!==0,f=i,p=!0,v=()=>(p&&(p=!1,f=u?untrack(i):i),f),g;if(o){var m=STATE_SYMBOL in r||LEGACY_PROPS in r;g=get_descriptor(r,e)?.set??(m&&e in r?R=>r[e]=R:void 0)}var $,_=!1;o?[$,_]=capture_store_binding(()=>r[e]):$=r[e],$===void 0&&i!==void 0&&($=v(),g&&(n&&props_invalid_value(),g($)));var E;if(n?E=()=>{var R=r[e];return R===void 0?v():(p=!0,R)}:E=()=>{var R=r[e];return R!==void 0&&(f=void 0),R===void 0?f:R},n&&(t&PROPS_IS_UPDATED)===0)return E;if(g){var T=r.$$legacy;return(function(R,F){return arguments.length>0?((!n||!F||T||_)&&g(F?E():R),R):E()})}var x=!1,D=((t&PROPS_IS_IMMUTABLE)!==0?derived:derived_safe_equal)(()=>(x=!1,E()));o&&get$2(D);var P=active_effect;return(function(R,F){if(arguments.length>0){const V=F?get$2(D):n&&o?proxy(R):R;return set(D,V),x=!0,f!==void 0&&(f=V),R}return is_destroying_effect&&x||(P.f&DESTROYED)!==0?D.v:get$2(D)})}function onMount(r){component_context===null&&lifecycle_outside_component(),legacy_mode_flag&&component_context.l!==null?init_update_callbacks(component_context).m.push(r):user_effect(()=>{const e=untrack(r);if(typeof e=="function")return e})}function onDestroy(r){component_context===null&&lifecycle_outside_component(),onMount(()=>()=>untrack(r))}function init_update_callbacks(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const PUBLIC_VERSION="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(PUBLIC_VERSION);enable_legacy_mode_flag();const editor=proxy({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,manualStorySelected:!1,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),editorDerived={get currentDialogue(){return editor.data?.dialogues.find(r=>r.id===editor.selectedDialogueId)},get currentChapter(){return editor.data?.chapters?.find(r=>r.id===editor.selectedChapterId)},get currentEditingChapter(){return editor.data?.chapters?.find(r=>r.id===editor.editingChapterId)},get currentEditingOption(){return editorDerived.currentDialogue&&editor.editingOptionIndex!==null?editorDerived.currentDialogue.options?.[editor.editingOptionIndex]:void 0},get chapterDialogues(){return!editor.data?.dialogues||!editor.selectedChapterId?[]:editor.data.dialogues.filter(r=>r.chapterId===editor.selectedChapterId)},get imageResources(){return editor.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return editor.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return editor.data?.items||[]},get backlinks(){return!editor.data||!editor.selectedDialogueId?[]:editor.data.dialogues.filter(r=>r.nextDialogueId===editor.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===editor.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},editorActions={toggleEditor(){editor.showEditor=!editor.showEditor},toggleItemsPanel(){editor.showItems=!editor.showItems},setStatus(r,e){editor.statusMessage={type:r,text:e}},clearStatus(){editor.statusMessage={type:"",text:""}},selectBucket(r){editor.selectedBucket=r,editor.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},editor.storedFiles=[],editor.storiesList=[],editor.selectedChapterId=null,editor.selectedDialogueId=null},updateBucketsList(r){editor.availableBuckets=r},selectChapter(r){editor.selectedChapterId=r,editor.selectedDialogueId=null},selectDialogue(r){editor.selectedDialogueId=r},selectOption(r){editor.editingOptionIndex=r},selectItem(r){editor.editingItemIndex=r},updateStoryData(r){editor.data=r},updateStoredFiles(r){editor.storedFiles=r},updateStoriesList(r){editor.storiesList=r},setCurrentFileName(r){editor.currentFileName=r},addDialogue(r){editor.data.dialogues=[...editor.data.dialogues,r]},updateDialogue(r,e){editor.data.dialogues=editor.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null)},addChapter(r){editor.data.chapters=[...editor.data.chapters||[],r]},updateChapter(r,e){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.map(t=>t.id===r?{...t,...e}:t))},selectEditingChapter(r){editor.editingChapterId=r},deleteChapter(r){editor.data.chapters&&(editor.data.chapters=editor.data.chapters.filter(e=>e.id!==r),editor.selectedChapterId===r&&(editor.selectedChapterId=null,editor.selectedDialogueId=null))},addItem(r){editor.data.items=[...editor.data.items||[],r]},updateItem(r,e){editor.data.items&&(editor.data.items=editor.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){editor.data.items&&(editor.data.items=editor.data.items.filter(e=>e.id!==r))},reset(){editor.showEditor=!1,editor.showItems=!1,editor.editingOptionIndex=null,editor.editingItemIndex=null,editor.selectedChapterId=null,editor.selectedDialogueId=null,editor.statusMessage={type:"",text:""}}},scriptRel="modulepreload",assetsURL=function(r,e){return new URL(r,e).href},seen={},__vitePreload=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let v=function(g){return Promise.all(g.map(m=>Promise.resolve(m).then($=>({status:"fulfilled",value:$}),$=>({status:"rejected",reason:$}))))};const u=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),p=f?.nonce||f?.getAttribute("nonce");n=v(t.map(g=>{if(g=assetsURL(g,i),g in seen)return;seen[g]=!0;const m=g.endsWith(".css"),$=m?'[rel="stylesheet"]':"";if(!!i)for(let T=u.length-1;T>=0;T--){const x=u[T];if(x.href===g&&(!m||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${g}"]${$}`))return;const E=document.createElement("link");if(E.rel=m?"stylesheet":scriptRel,m||(E.as="script"),E.crossOrigin="",E.href=g,p&&E.setAttribute("nonce",p),document.head.appendChild(E),m)return new Promise((T,x)=>{E.addEventListener("load",T),E.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${g}`)))})}))}function o(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return n.then(u=>{for(const f of u||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},resolveFetch$3=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)};class FunctionsError extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class FunctionsFetchError extends FunctionsError{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class FunctionsRelayError extends FunctionsError{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class FunctionsHttpError extends FunctionsError{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var FunctionRegion;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));var __awaiter$7=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};class FunctionsClient{constructor(e,{headers:t={},customFetch:i,region:n=FunctionRegion.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=resolveFetch$3(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var i;return __awaiter$7(this,void 0,void 0,function*(){try{const{headers:n,method:o,body:u}=t;let f={},{region:p}=t;p||(p=this.region);const v=new URL(`${this.url}/${e}`);p&&p!=="any"&&(f["x-region"]=p,v.searchParams.set("forceFunctionRegion",p));let g;u&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",g=u):typeof u=="string"?(f["Content-Type"]="text/plain",g=u):typeof FormData<"u"&&u instanceof FormData?g=u:(f["Content-Type"]="application/json",g=JSON.stringify(u)));const m=yield this.fetch(v.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),n),body:g}).catch(T=>{throw new FunctionsFetchError(T)}),$=m.headers.get("x-relay-error");if($&&$==="true")throw new FunctionsRelayError(m);if(!m.ok)throw new FunctionsHttpError(m);let _=((i=m.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),E;return _==="application/json"?E=yield m.json():_==="application/octet-stream"?E=yield m.blob():_==="text/event-stream"?E=m:_==="multipart/form-data"?E=yield m.formData():E=yield m.text(),{data:E,error:null,response:m}}catch(n){return{data:null,error:n,response:n instanceof FunctionsHttpError||n instanceof FunctionsRelayError?n.context:void 0}}})}}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){var n=!1;try{n=this instanceof i}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var cjs={},PostgrestClient$1={},PostgrestQueryBuilder$1={},PostgrestFilterBuilder$1={},PostgrestTransformBuilder$1={},PostgrestBuilder$1={},getGlobal=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},globalObject=getGlobal();const fetch$1=globalObject.fetch,nodeFetch=globalObject.fetch.bind(globalObject),Headers$1=globalObject.Headers,Request$1=globalObject.Request,Response$1=globalObject.Response,browser=Object.freeze(Object.defineProperty({__proto__:null,Headers:Headers$1,Request:Request$1,Response:Response$1,default:nodeFetch,fetch:fetch$1},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(browser);var PostgrestError$1={},hasRequiredPostgrestError;function requirePostgrestError(){if(hasRequiredPostgrestError)return PostgrestError$1;hasRequiredPostgrestError=1,Object.defineProperty(PostgrestError$1,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return PostgrestError$1.default=r,PostgrestError$1}var hasRequiredPostgrestBuilder;function requirePostgrestBuilder(){if(hasRequiredPostgrestBuilder)return PostgrestBuilder$1;hasRequiredPostgrestBuilder=1;var r=PostgrestBuilder$1&&PostgrestBuilder$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestBuilder$1,"__esModule",{value:!0});const e=r(require$$0),t=r(requirePostgrestError());class i{constructor(o){var u,f;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(u=o.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=o.signal,this.isMaybeSingle=(f=o.isMaybeSingle)!==null&&f!==void 0?f:!1,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,u){return this.headers=new Headers(this.headers),this.headers.set(o,u),this}then(o,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let p=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var g,m,$,_;let E=null,T=null,x=null,D=v.status,P=v.statusText;if(v.ok){if(this.method!=="HEAD"){const I=await v.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((g=this.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?T=I:T=JSON.parse(I))}const F=(m=this.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),V=($=v.headers.get("content-range"))===null||$===void 0?void 0:$.split("/");F&&V&&V.length>1&&(x=parseInt(V[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(E={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,x=null,D=406,P="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const F=await v.text();try{E=JSON.parse(F),Array.isArray(E)&&v.status===404&&(T=[],E=null,D=200,P="OK")}catch{v.status===404&&F===""?(D=204,P="No Content"):E={message:F}}if(E&&this.isMaybeSingle&&(!((_=E?.details)===null||_===void 0)&&_.includes("0 rows"))&&(E=null,D=200,P="OK"),E&&this.shouldThrowOnError)throw new t.default(E)}return{error:E,data:T,count:x,status:D,statusText:P}});return this.shouldThrowOnError||(p=p.catch(v=>{var g,m,$;return{error:{message:`${(g=v?.name)!==null&&g!==void 0?g:"FetchError"}: ${v?.message}`,details:`${(m=v?.stack)!==null&&m!==void 0?m:""}`,hint:"",code:`${($=v?.code)!==null&&$!==void 0?$:""}`},data:null,count:null,status:0,statusText:""}})),p.then(o,u)}returns(){return this}overrideTypes(){return this}}return PostgrestBuilder$1.default=i,PostgrestBuilder$1}var hasRequiredPostgrestTransformBuilder;function requirePostgrestTransformBuilder(){if(hasRequiredPostgrestTransformBuilder)return PostgrestTransformBuilder$1;hasRequiredPostgrestTransformBuilder=1;var r=PostgrestTransformBuilder$1&&PostgrestTransformBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestTransformBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestBuilder());class t extends e.default{select(n){let o=!1;const u=(n??"*").split("").map(f=>/\s/.test(f)&&!o?"":(f==='"'&&(o=!o),f)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:o=!0,nullsFirst:u,foreignTable:f,referencedTable:p=f}={}){const v=p?`${p}.order`:"order",g=this.url.searchParams.get(v);return this.url.searchParams.set(v,`${g?`${g},`:""}${n}.${o?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:u=o}={}){const f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(f,`${n}`),this}range(n,o,{foreignTable:u,referencedTable:f=u}={}){const p=typeof f>"u"?"offset":`${f}.offset`,v=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(p,`${n}`),this.url.searchParams.set(v,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:o=!1,settings:u=!1,buffers:f=!1,wal:p=!1,format:v="text"}={}){var g;const m=[n?"analyze":null,o?"verbose":null,u?"settings":null,f?"buffers":null,p?"wal":null].filter(Boolean).join("|"),$=(g=this.headers.get("Accept"))!==null&&g!==void 0?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${v}; for="${$}"; options=${m};`),v==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return PostgrestTransformBuilder$1.default=t,PostgrestTransformBuilder$1}var hasRequiredPostgrestFilterBuilder;function requirePostgrestFilterBuilder(){if(hasRequiredPostgrestFilterBuilder)return PostgrestFilterBuilder$1;hasRequiredPostgrestFilterBuilder=1;var r=PostgrestFilterBuilder$1&&PostgrestFilterBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestFilterBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestTransformBuilder());class t extends e.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const u=Array.from(new Set(o)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(n,`in.(${u})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:u,type:f}={}){let p="";f==="plain"?p="pl":f==="phrase"?p="ph":f==="websearch"&&(p="w");const v=u===void 0?"":`(${u})`;return this.url.searchParams.append(n,`${p}fts${v}.${o}`),this}match(n){return Object.entries(n).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(n,o,u){return this.url.searchParams.append(n,`not.${o}.${u}`),this}or(n,{foreignTable:o,referencedTable:u=o}={}){const f=u?`${u}.or`:"or";return this.url.searchParams.append(f,`(${n})`),this}filter(n,o,u){return this.url.searchParams.append(n,`${o}.${u}`),this}}return PostgrestFilterBuilder$1.default=t,PostgrestFilterBuilder$1}var hasRequiredPostgrestQueryBuilder;function requirePostgrestQueryBuilder(){if(hasRequiredPostgrestQueryBuilder)return PostgrestQueryBuilder$1;hasRequiredPostgrestQueryBuilder=1;var r=PostgrestQueryBuilder$1&&PostgrestQueryBuilder$1.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(PostgrestQueryBuilder$1,"__esModule",{value:!0});const e=r(requirePostgrestFilterBuilder());class t{constructor(n,{headers:o={},schema:u,fetch:f}){this.url=n,this.headers=new Headers(o),this.schema=u,this.fetch=f}select(n,{head:o=!1,count:u}={}){const f=o?"HEAD":"GET";let p=!1;const v=(n??"*").split("").map(g=>/\s/.test(g)&&!p?"":(g==='"'&&(p=!p),g)).join("");return this.url.searchParams.set("select",v),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:o,defaultToNull:u=!0}={}){var f;const p="POST";if(o&&this.headers.append("Prefer",`count=${o}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const v=n.reduce((g,m)=>g.concat(Object.keys(m)),[]);if(v.length>0){const g=[...new Set(v)].map(m=>`"${m}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(n,{onConflict:o,ignoreDuplicates:u=!1,count:f,defaultToNull:p=!0}={}){var v;const g="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),f&&this.headers.append("Prefer",`count=${f}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const m=n.reduce(($,_)=>$.concat(Object.keys(_)),[]);if(m.length>0){const $=[...new Set(m)].map(_=>`"${_}"`);this.url.searchParams.set("columns",$.join(","))}}return new e.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}update(n,{count:o}={}){var u;const f="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:n}={}){var o;const u="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return PostgrestQueryBuilder$1.default=t,PostgrestQueryBuilder$1}var hasRequiredPostgrestClient;function requirePostgrestClient(){if(hasRequiredPostgrestClient)return PostgrestClient$1;hasRequiredPostgrestClient=1;var r=PostgrestClient$1&&PostgrestClient$1.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(PostgrestClient$1,"__esModule",{value:!0});const e=r(requirePostgrestQueryBuilder()),t=r(requirePostgrestFilterBuilder());class i{constructor(o,{headers:u={},schema:f,fetch:p}={}){this.url=o,this.headers=new Headers(u),this.schemaName=f,this.fetch=p}from(o){const u=new URL(`${this.url}/${o}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new i(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,u={},{head:f=!1,get:p=!1,count:v}={}){var g;let m;const $=new URL(`${this.url}/rpc/${o}`);let _;f||p?(m=f?"HEAD":"GET",Object.entries(u).filter(([T,x])=>x!==void 0).map(([T,x])=>[T,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([T,x])=>{$.searchParams.append(T,x)})):(m="POST",_=u);const E=new Headers(this.headers);return v&&E.set("Prefer",`count=${v}`),new t.default({method:m,url:$,headers:E,schema:this.schemaName,body:_,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}}return PostgrestClient$1.default=i,PostgrestClient$1}var hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var r=cjs&&cjs.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(cjs,"__esModule",{value:!0}),cjs.PostgrestError=cjs.PostgrestBuilder=cjs.PostgrestTransformBuilder=cjs.PostgrestFilterBuilder=cjs.PostgrestQueryBuilder=cjs.PostgrestClient=void 0;const e=r(requirePostgrestClient());cjs.PostgrestClient=e.default;const t=r(requirePostgrestQueryBuilder());cjs.PostgrestQueryBuilder=t.default;const i=r(requirePostgrestFilterBuilder());cjs.PostgrestFilterBuilder=i.default;const n=r(requirePostgrestTransformBuilder());cjs.PostgrestTransformBuilder=n.default;const o=r(requirePostgrestBuilder());cjs.PostgrestBuilder=o.default;const u=r(requirePostgrestError());return cjs.PostgrestError=u.default,cjs.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:o.default,PostgrestError:u.default},cjs}var cjsExports=requireCjs();const index=getDefaultExportFromCjs(cjsExports),{PostgrestClient,PostgrestQueryBuilder,PostgrestFilterBuilder,PostgrestTransformBuilder,PostgrestBuilder,PostgrestError}=index;class WebSocketFactory{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const i=this.getWebSocketConstructor();return new i(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const version$3="2.15.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN="1.0.0",DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(r){r.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),i=new TextDecoder;return this._decodeBroadcast(e,t,i)}_decodeBroadcast(e,t,i){const n=t.getUint8(1),o=t.getUint8(2);let u=this.HEADER_LENGTH+2;const f=i.decode(e.slice(u,u+n));u=u+n;const p=i.decode(e.slice(u,u+o));u=u+o;const v=JSON.parse(i.decode(e.slice(u,e.byteLength)));return{ref:null,topic:f,event:p,payload:v}}}class Timer{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(r,e,t={})=>{var i;const n=(i=t.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(e).reduce((o,u)=>(o[u]=convertColumn(u,r,e,n),o),{})},convertColumn=(r,e,t,i)=>{const n=e.find(f=>f.name===r),o=n?.type,u=t[r];return o&&!i.includes(o)?convertCell(o,u):noop$1(u)},convertCell=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return toArray(e,t)}switch(r){case PostgresTypes.bool:return toBoolean(e);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(e);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(e);case PostgresTypes.timestamp:return toTimestampString(e);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(e);default:return noop$1(e)}},noop$1=r=>r,toBoolean=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},toNumber=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},toJson=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},toArray=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,i=r[t];if(r[0]==="{"&&i==="}"){let o;const u=r.slice(1,t);try{o=JSON.parse("["+u+"]")}catch{o=u?u.split(","):[]}return o.map(f=>convertCell(e,f))}return r},toTimestampString=r=>typeof r=="string"?r.replace(" ","T"):r,httpEndpointURL=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Push{constructor(e,t,i={},n=DEFAULT_TIMEOUT){this.channel=e,this.event=t,this.payload=i,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},n=>{const{onJoin:o,onLeave:u,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,n,o,u),this.pendingDiffs.forEach(p=>{this.state=RealtimePresence.syncDiff(this.state,p,o,u)}),this.pendingDiffs=[],f()}),this.channel._on(i.diff,{},n=>{const{onJoin:o,onLeave:u,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=RealtimePresence.syncDiff(this.state,n,o,u),f())}),this.onJoin((n,o,u)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:o,newPresences:u})}),this.onLeave((n,o,u)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:o,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,n){const o=this.cloneDeep(e),u=this.transformState(t),f={},p={};return this.map(o,(v,g)=>{u[v]||(p[v]=g)}),this.map(u,(v,g)=>{const m=o[v];if(m){const $=g.map(x=>x.presence_ref),_=m.map(x=>x.presence_ref),E=g.filter(x=>_.indexOf(x.presence_ref)<0),T=m.filter(x=>$.indexOf(x.presence_ref)<0);E.length>0&&(f[v]=E),T.length>0&&(p[v]=T)}else f[v]=g}),this.syncDiff(o,{joins:f,leaves:p},i,n)}static syncDiff(e,t,i,n){const{joins:o,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),n||(n=()=>{}),this.map(o,(f,p)=>{var v;const g=(v=e[f])!==null&&v!==void 0?v:[];if(e[f]=this.cloneDeep(p),g.length>0){const m=e[f].map(_=>_.presence_ref),$=g.filter(_=>m.indexOf(_.presence_ref)<0);e[f].unshift(...$)}i(f,g,p)}),this.map(u,(f,p)=>{let v=e[f];if(!v)return;const g=p.map(m=>m.presence_ref);v=v.filter(m=>g.indexOf(m.presence_ref)<0),e[f]=v,n(f,v,p),v.length===0&&delete e[f]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const n=e[i];return"metas"in n?t[i]=n.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[i]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(e,t={config:{}},i){this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(n,o)=>{this._trigger(this._replyEventName(o),n)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:o,presence:u,private:f}}=this.params,p=(n=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map($=>$.filter))!==null&&n!==void 0?n:[],v=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0,g={},m={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:v}),postgres_changes:p,private:f};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError($=>e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,$)),this._onClose(()=>e?.(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:m},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:$})=>{var _;if(this.socket.setAuth(),$===void 0){e?.(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,T=(_=E?.length)!==null&&_!==void 0?_:0,x=[];for(let D=0;D<T;D++){const P=E[D],{filter:{event:R,schema:F,table:V,filter:I}}=P,k=$&&$[D];if(k&&k.event===R&&k.schema===F&&k.table===V&&k.filter===I)x.push(Object.assign(Object.assign({},P),{id:k.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",$=>{this.state=CHANNEL_STATES.errored,e?.(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values($).join(", ")||"error")))}).receive("timeout",()=>{e?.(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this.state===CHANNEL_STATES.joined&&e===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,i)}async send(e,t={}){var i,n;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:u}=e,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:u,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((n=v.body)===null||n===void 0?void 0:n.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var u,f,p;const v=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(f=(u=this.params)===null||u===void 0?void 0:u.config)===null||f===void 0?void 0:f.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),v.receive("ok",()=>o("ok")),v.receive("error",()=>o("error")),v.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=CHANNEL_STATES.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(n=>{i=new Push(this,CHANNEL_EVENTS.leave,{},e),i.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(e,t,i){const n=new AbortController,o=setTimeout(()=>n.abort(),i),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),u}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Push(this,e,t,i);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var n,o;const u=e.toLocaleLowerCase(),{close:f,error:p,leave:v,join:g}=CHANNEL_EVENTS;if(i&&[f,p,v,g].indexOf(u)>=0&&i!==this._joinRef())return;let $=this._onMessage(u,t,i);if(t&&!$)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(_=>{var E,T,x;return((E=_.filter)===null||E===void 0?void 0:E.event)==="*"||((x=(T=_.filter)===null||T===void 0?void 0:T.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===u}).map(_=>_.callback($,i)):(o=this.bindings[u])===null||o===void 0||o.filter(_=>{var E,T,x,D,P,R;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in _){const F=_.id,V=(E=_.filter)===null||E===void 0?void 0:E.event;return F&&((T=t.ids)===null||T===void 0?void 0:T.includes(F))&&(V==="*"||V?.toLocaleLowerCase()===((x=t.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const F=(P=(D=_?.filter)===null||D===void 0?void 0:D.event)===null||P===void 0?void 0:P.toLocaleLowerCase();return F==="*"||F===((R=t?.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===u}).map(_=>{if(typeof $=="object"&&"ids"in $){const E=$.data,{schema:T,table:x,commit_timestamp:D,type:P,errors:R}=E;$=Object.assign(Object.assign({},{schema:T,table:x,commit_timestamp:D,eventType:P,new:{},old:{},errors:R}),this._getPayloadRecords(E))}_.callback($,i)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const n=e.toLocaleLowerCase(),o={type:n,filter:t,callback:i};return this.bindings[n]?this.bindings[n].push(o):this.bindings[n]=[o],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(n=>{var o;return!(((o=n.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&RealtimeChannel.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(CHANNEL_EVENTS.close,{},e)}_onError(e){this._on(CHANNEL_EVENTS.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=convertChangeData(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=convertChangeData(e.columns,e.old_record)),t}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(e,t){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...u)=>__vitePreload(async()=>{const{default:f}=await Promise.resolve().then(()=>browser);return{default:f}},void 0,import.meta.url).then(({default:f})=>f(...u)).catch(f=>{throw new Error(`Failed to load @supabase/node-fetch: ${f.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...u)=>o(...u)},!(!((i=t?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:VSN}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const i=`realtime:${e}`,n=this.getChannels().find(o=>o.topic===i);if(n)return n;{const o=new RealtimeChannel(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:i,payload:n,ref:o}=e,u=()=>{this.encode(e,f=>{var p;(p=this.conn)===null||p===void 0||p.send(f)})};this.log("push",`${t} ${i} (${o})`,n),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:n,payload:o,ref:u}=t,f=u?`(${u})`:"",p=o.status||"";this.log("receive",`${p} ${i} ${n} ${f}`.trim(),o),this.channels.filter(v=>v._isMember(i)).forEach(v=>v._trigger(n,o,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(CHANNEL_EVENTS.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${i}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([WORKER_SCRIPT],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const n={access_token:t,version:DEFAULT_VERSION};t&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(CHANNEL_EVENTS.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,i,n,o,u,f,p,v;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(g=>RECONNECT_INTERVALS[g-1]||DEFAULT_RECONNECT_FALLBACK),this.encode=(p=e?.encode)!==null&&p!==void 0?p:((g,m)=>m(JSON.stringify(g))),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class StorageError extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function isStorageError(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class StorageApiError extends StorageError{constructor(e,t,i){super(e),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class StorageUnknownError extends StorageError{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var __awaiter$6=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};const resolveFetch$2=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},resolveResponse=()=>__awaiter$6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield __vitePreload(()=>Promise.resolve().then(()=>browser),void 0,import.meta.url)).Response:Response}),recursiveToCamel=r=>{if(Array.isArray(r))return r.map(t=>recursiveToCamel(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,i])=>{const n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[n]=recursiveToCamel(i)}),e},isPlainObject=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var __awaiter$5=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};const _getErrorMessage$1=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),handleError$1=(r,e,t)=>__awaiter$5(void 0,void 0,void 0,function*(){const i=yield resolveResponse();r instanceof i&&!t?.noResolveJson?r.json().then(n=>{const o=r.status||500,u=n?.statusCode||o+"";e(new StorageApiError(_getErrorMessage$1(n),o,u))}).catch(n=>{e(new StorageUnknownError(_getErrorMessage$1(n),n))}):e(new StorageUnknownError(_getErrorMessage$1(r),r))}),_getRequestParams$1=(r,e,t,i)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"||!i?n:(isPlainObject(i)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(i)):n.body=i,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function _handleRequest$1(r,e,t,i,n,o){return __awaiter$5(this,void 0,void 0,function*(){return new Promise((u,f)=>{r(t,_getRequestParams$1(e,i,n,o)).then(p=>{if(!p.ok)throw p;return i?.noResolveJson?p:p.json()}).then(p=>u(p)).catch(p=>handleError$1(p,f,i))})})}function get(r,e,t,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"GET",e,t,i)})}function post(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"POST",e,i,n,t)})}function put(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"PUT",e,i,n,t)})}function head(r,e,t,i){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),i)})}function remove(r,e,t,i,n){return __awaiter$5(this,void 0,void 0,function*(){return _handleRequest$1(r,"DELETE",e,i,n,t)})}var __awaiter$4=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class StorageFileApi{constructor(e,t={},i,n){this.url=e,this.headers=t,this.bucketId=i,this.fetch=resolveFetch$2(n)}uploadOrUpdate(e,t,i,n){return __awaiter$4(this,void 0,void 0,function*(){try{let o;const u=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),n);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const p=u.metadata;typeof Blob<"u"&&i instanceof Blob?(o=new FormData,o.append("cacheControl",u.cacheControl),p&&o.append("metadata",this.encodeMetadata(p)),o.append("",i)):typeof FormData<"u"&&i instanceof FormData?(o=i,o.append("cacheControl",u.cacheControl),p&&o.append("metadata",this.encodeMetadata(p))):(o=i,f["cache-control"]=`max-age=${u.cacheControl}`,f["content-type"]=u.contentType,p&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(p)))),n?.headers&&(f=Object.assign(Object.assign({},f),n.headers));const v=this._removeEmptyFolders(t),g=this._getFinalPath(v),m=yield(e=="PUT"?put:post)(this.fetch,`${this.url}/object/${g}`,o,Object.assign({headers:f},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:v,id:m.Id,fullPath:m.Key},error:null}}catch(o){if(isStorageError(o))return{data:null,error:o};throw o}})}upload(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,i)})}uploadToSignedUrl(e,t,i,n){return __awaiter$4(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),u=this._getFinalPath(o),f=new URL(this.url+`/object/upload/sign/${u}`);f.searchParams.set("token",t);try{let p;const v=Object.assign({upsert:DEFAULT_FILE_OPTIONS.upsert},n),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(v.upsert)});typeof Blob<"u"&&i instanceof Blob?(p=new FormData,p.append("cacheControl",v.cacheControl),p.append("",i)):typeof FormData<"u"&&i instanceof FormData?(p=i,p.append("cacheControl",v.cacheControl)):(p=i,g["cache-control"]=`max-age=${v.cacheControl}`,g["content-type"]=v.contentType);const m=yield put(this.fetch,f.toString(),p,{headers:g});return{data:{path:o,fullPath:m.Key},error:null}}catch(p){if(isStorageError(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const o=yield post(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:n}),u=new URL(this.url+o.url),f=u.searchParams.get("token");if(!f)throw new StorageError("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:f},error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}update(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,i)})}move(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}copy(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:{path:(yield post(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=yield post(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:this.headers});const u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${u}`)},{data:o,error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{const n=yield post(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:n.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${o}`):null})),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}download(e,t){return __awaiter$4(this,void 0,void 0,function*(){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"";try{const f=this._getFinalPath(e);return{data:yield(yield get(this.fetch,`${this.url}/${n}/${f}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(f){if(isStorageError(f))return{data:null,error:f};throw f}})}info(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const i=yield get(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:recursiveToCamel(i),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}exists(e){return __awaiter$4(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield head(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(isStorageError(i)&&i instanceof StorageUnknownError){const n=i.originalError;if([400,404].includes(n?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,t){const i=this._getFinalPath(e),n=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);const f=typeof t?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(t?.transform||{});p!==""&&n.push(p);let v=n.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${i}${v}`)}}}remove(e){return __awaiter$4(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}list(e,t,i){return __awaiter$4(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),t),{prefix:e||""});return{data:yield post(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},i),error:null}}catch(n){if(isStorageError(n))return{data:null,error:n};throw n}})}listV2(e,t){return __awaiter$4(this,void 0,void 0,function*(){try{const i=Object.assign({},e);return{data:yield post(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},t),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const version$2="2.11.0",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var __awaiter$3=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};class StorageBucketApi{constructor(e,t={},i,n){const o=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},DEFAULT_HEADERS$2),t),this.fetch=resolveFetch$2(i)}listBuckets(){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(isStorageError(e))return{data:null,error:e};throw e}})}getBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield get(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield put(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(isStorageError(i))return{data:null,error:i};throw i}})}emptyBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield post(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}deleteBucket(e){return __awaiter$3(this,void 0,void 0,function*(){try{return{data:yield remove(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(isStorageError(t))return{data:null,error:t};throw t}})}}class StorageClient extends StorageBucketApi{constructor(e,t={},i,n){super(e,t,i,n)}from(e){return new StorageFileApi(this.url,this.headers,e,this.fetch)}}const version$1="2.56.0";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";const DEFAULT_HEADERS$1={"X-Client-Info":`supabase-js-${JS_ENV}/${version$1}`},DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS$1},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};var __awaiter$2=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};const resolveFetch$1=r=>{let e;return r?e=r:typeof fetch>"u"?e=nodeFetch:e=fetch,(...t)=>e(...t)},resolveHeadersConstructor=()=>typeof Headers>"u"?Headers$1:Headers,fetchWithAuth=(r,e,t)=>{const i=resolveFetch$1(t),n=resolveHeadersConstructor();return(o,u)=>__awaiter$2(void 0,void 0,void 0,function*(){var f;const p=(f=yield e())!==null&&f!==void 0?f:r;let v=new n(u?.headers);return v.has("apikey")||v.set("apikey",r),v.has("Authorization")||v.set("Authorization",`Bearer ${p}`),i(o,Object.assign(Object.assign({},u),{headers:v}))})};var __awaiter$1=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};function ensureTrailingSlash(r){return r.endsWith("/")?r:r+"/"}function applySettingDefaults(r,e){var t,i;const{db:n,auth:o,realtime:u,global:f}=r,{db:p,auth:v,realtime:g,global:m}=e,$={db:Object.assign(Object.assign({},p),n),auth:Object.assign(Object.assign({},v),o),realtime:Object.assign(Object.assign({},g),u),storage:{},global:Object.assign(Object.assign(Object.assign({},m),f),{headers:Object.assign(Object.assign({},(t=m?.headers)!==null&&t!==void 0?t:{}),(i=f?.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>__awaiter$1(this,void 0,void 0,function*(){return""})};return r.accessToken?$.accessToken=r.accessToken:delete $.accessToken,$}const version="2.71.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=600*1e3;class AuthError extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function isAuthError(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class AuthApiError extends AuthError{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function isAuthApiError(r){return isAuthError(r)&&r.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class CustomAuthError extends AuthError{constructor(e,t,i,n){super(e,i,n),this.name=t,this.status=i}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(r){return isAuthError(r)&&r.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(r){return isAuthError(r)&&r.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthRetryableFetchError extends CustomAuthError{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function isAuthRetryableFetchError(r){return isAuthError(r)&&r.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class AuthInvalidJwtError extends CustomAuthError{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<IGNORE_BASE64URL.length;e+=1)r[IGNORE_BASE64URL[e].charCodeAt(0)]=-2;for(let e=0;e<TO_BASE64URL.length;e+=1)r[TO_BASE64URL[e].charCodeAt(0)]=e;return r})();function byteToBase64URL(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(TO_BASE64URL[i]),e.queuedBits-=6}}function byteFromBase64URL(r,e,t){const i=FROM_BASE64URL[r];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function stringFromBase64URL(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},i={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=u=>{stringFromUTF8(u,i,t)};for(let u=0;u<r.length;u+=1)byteFromBase64URL(r.charCodeAt(u),n,o);return e.join("")}function codepointToUTF8(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function stringToUTF8(r,e){for(let t=0;t<r.length;t+=1){let i=r.charCodeAt(t);if(i>55295&&i<=56319){const n=(i-55296)*1024&65535;i=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}codepointToUTF8(i,e)}}function stringFromUTF8(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let i=1;i<6;i+=1)if((r>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function base64UrlToUint8Array(r){const e=[],t={queue:0,queuedBits:0},i=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)byteFromBase64URL(r.charCodeAt(n),t,i);return new Uint8Array(e)}function stringToUint8Array(r){const e=[];return stringToUTF8(r,t=>e.push(t)),new Uint8Array(e)}function bytesToBase64URL(r){const e=[],t={queue:0,queuedBits:0},i=n=>{e.push(n)};return r.forEach(n=>byteToBase64URL(n,t,i)),byteToBase64URL(null,t,i),e.join("")}function expiresAt(r){return Math.round(Date.now()/1e3)+r}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,o)=>{e[o]=n})}catch{}return t.searchParams.forEach((i,n)=>{e[n]=i}),e}const resolveFetch=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>__vitePreload(async()=>{const{default:i}=await Promise.resolve().then(()=>browser);return{default:i}},void 0,import.meta.url).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},looksLikeFetchResponse=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",setItemAsync=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},getItemAsync=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},removeItemAsync=async(r,e)=>{await r.removeItem(e)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Deferred.promiseConstructor=Promise;function decodeJWT(r){const e=r.split(".");if(e.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!BASE64URL_REGEX.test(e[i]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(e[0])),payload:JSON.parse(stringFromBase64URL(e[1])),signature:base64UrlToUint8Array(e[2]),raw:{header:e[0],payload:e[1]}}}async function sleep(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function retryable(r,e){return new Promise((i,n)=>{(async()=>{for(let o=0;o<1/0;o++)try{const u=await r(o);if(!e(o,null,u)){i(u);return}}catch(u){if(!e(o,u)){n(u);return}}})()})}function dec2hex(r){return("0"+r.toString(16)).substr(-2)}function generatePKCEVerifier(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let n="";for(let o=0;o<56;o++)n+=t.charAt(Math.floor(Math.random()*i));return n}return crypto.getRandomValues(e),Array.from(e,dec2hex).join("")}async function sha256(r){const t=new TextEncoder().encode(r),i=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(i);return Array.from(n).map(o=>String.fromCharCode(o)).join("")}async function generatePKCEChallenge(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await sha256(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(r,e,t=!1){const i=generatePKCEVerifier();let n=i;t&&(n+="/PASSWORD_RECOVERY"),await setItemAsync(r,`${e}-code-verifier`,n);const o=await generatePKCEChallenge(i);return[o,i===o?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(r){const e=r.headers.get(API_VERSION_HEADER_NAME);if(!e||!e.match(API_VERSION_REGEX))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function validateExp(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function getAlgorithm(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(r){if(!UUID_REGEX.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const i=t.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function deepClone(r){return JSON.parse(JSON.stringify(r))}var __rest$1=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t};const _getErrorMessage=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),NETWORK_ERROR_CODES=[502,503,504];async function handleError(r){var e;if(!looksLikeFetchResponse(r))throw new AuthRetryableFetchError(_getErrorMessage(r),0);if(NETWORK_ERROR_CODES.includes(r.status))throw new AuthRetryableFetchError(_getErrorMessage(r),r.status);let t;try{t=await r.json()}catch(o){throw new AuthUnknownError(_getErrorMessage(o),o)}let i;const n=parseResponseAPIVersion(r);if(n&&n.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new AuthSessionMissingError}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(t),r.status,t.weak_password.reasons);throw new AuthApiError(_getErrorMessage(t),r.status||500,i)}const _getRequestParams=(r,e,t,i)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(i),Object.assign(Object.assign({},n),t))};async function _request(r,e,t,i){var n;const o=Object.assign({},i?.headers);o[API_VERSION_HEADER_NAME]||(o[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);const u=(n=i?.query)!==null&&n!==void 0?n:{};i?.redirectTo&&(u.redirect_to=i.redirectTo);const f=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",p=await _handleRequest(r,e,t+f,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(p):{data:Object.assign({},p),error:null}}async function _handleRequest(r,e,t,i,n,o){const u=_getRequestParams(e,i,n,o);let f;try{f=await r(t,Object.assign({},u))}catch(p){throw console.error(p),new AuthRetryableFetchError(_getErrorMessage(p),0)}if(f.ok||await handleError(f),i?.noResolveJson)return f;try{return await f.json()}catch(p){await handleError(p)}}function _sessionResponse(r){var e;let t=null;hasSession(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=expiresAt(r.expires_in)));const i=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:i},error:null}}function _sessionResponsePassword(r){const e=_sessionResponse(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=r.weak_password),e}function _userResponse(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function _ssoResponse(r){return{data:r,error:null}}function _generateLinkResponse(r){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:n,verification_type:o}=r,u=__rest$1(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:t,hashed_token:i,redirect_to:n,verification_type:o},p=Object.assign({},u);return{data:{properties:f,user:p},error:null}}function _noResolveJsonResponse(r){return r}function hasSession(r){return r.access_token&&r.refresh_token&&r.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];var __rest=function(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t};class GoTrueAdminApi{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=resolveFetch(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=__rest(e,["options"]),n=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(n.new_email=i?.newEmail,delete n.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:_generateLinkResponse,redirectTo:t?.redirectTo})}catch(t){if(isAuthError(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,n,o,u,f,p;try{const v={nextPage:null,lastPage:0,total:0},g=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(o=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""},xform:_noResolveJsonResponse});if(g.error)throw g.error;const m=await g.json(),$=(u=g.headers.get("x-total-count"))!==null&&u!==void 0?u:0,_=(p=(f=g.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const T=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(E.split(";")[1].split("=")[1]);v[`${x}Page`]=T}),v.total=parseInt($)),{data:Object.assign(Object.assign({},m),v),error:null}}catch(v){if(isAuthError(v))return{data:{users:[]},error:v};throw v}}async getUserById(e){validateUUID(e);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_userResponse})}catch(t){if(isAuthError(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){validateUUID(e);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){validateUUID(e);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_userResponse})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){validateUUID(e.userId);try{const{data:t,error:i}=await _request(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:i}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _deleteFactor(e){validateUUID(e.userId),validateUUID(e.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}}function memoryLocalStorageAdapter(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(r,e,t){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async n=>{if(n){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(internals.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lockNoOp(r,e,t){return await t()}const GLOBAL_JWKS={};class GoTrueClient{constructor(e){var t,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=GoTrueClient.nextInstanceID,GoTrueClient.nextInstanceID+=1,this.instanceID>0&&isBrowser()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},DEFAULT_OPTIONS),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new GoTrueAdminApi({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=resolveFetch(n.fetch),this.lock=n.lock||lockNoOp,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:isBrowser()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=GLOBAL_JWKS[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${version}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=parseParametersFromURL(window.location.href);let i="none";if(this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce"),isBrowser()&&this.detectSessionInUrl&&i!=="none"){const{data:n,error:o}=await this._getSessionFromURL(t,i);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),isAuthImplicitGrantRedirectError(o)){const p=(e=o.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:u,redirectType:f}=n;return this._debug("#_initialize()","detected session in URL",u,"redirect type",f),await this._saveSession(u),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return isAuthError(t)?{error:t}:{error:new AuthUnknownError("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,n;try{const o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:_sessionResponse}),{data:u,error:f}=o;if(f||!u)return{data:{user:null,session:null},error:f};const p=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(o){if(isAuthError(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,i,n;try{let o;if("email"in e){const{email:g,password:m,options:$}=e;let _=null,E=null;this.flowType==="pkce"&&([_,E]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:$?.emailRedirectTo,body:{email:g,password:m,data:(t=$?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:$?.captchaToken},code_challenge:_,code_challenge_method:E},xform:_sessionResponse})}else if("phone"in e){const{phone:g,password:m,options:$}=e;o=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:m,data:(i=$?.data)!==null&&i!==void 0?i:{},channel:(n=$?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:$?.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:u,error:f}=o;if(f||!u)return{data:{user:null,session:null},error:f};const p=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(o){if(isAuthError(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:u,options:f}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:u,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in e){const{phone:o,password:u,options:f}=e;t=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:u,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:i,error:n}=t;return n?{data:{user:null,session:null},error:n}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:n})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,i,n,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,i,n,o,u,f,p,v,g,m,$,_;let E,T;if("message"in e)E=e.message,T=e.signature;else{const{chain:x,wallet:D,statement:P,options:R}=e;let F;if(isBrowser())if(typeof D=="object")F=D;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))F=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof D!="object"||!R?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=D}const V=new URL((t=R?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in F&&F.signIn){const I=await F.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},R?.signInWithSolana),{version:"1",domain:V.host,uri:V.href}),P?{statement:P}:null));let k;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")k=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)k=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)E=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),T=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in F)||typeof F.signMessage!="function"||!("publicKey"in F)||typeof F!="object"||!F.publicKey||!("toBase58"in F.publicKey)||typeof F.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${V.host} wants you to sign in with your Solana account:`,F.publicKey.toBase58(),...P?["",P,""]:[""],"Version: 1",`URI: ${V.href}`,`Issued At: ${(n=(i=R?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((o=R?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${R.signInWithSolana.notBefore}`]:[],...!((u=R?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${R.signInWithSolana.expirationTime}`]:[],...!((f=R?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${R.signInWithSolana.chainId}`]:[],...!((p=R?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${R.signInWithSolana.nonce}`]:[],...!((v=R?.signInWithSolana)===null||v===void 0)&&v.requestId?[`Request ID: ${R.signInWithSolana.requestId}`]:[],...!((m=(g=R?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||m===void 0)&&m.length?["Resources",...R.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const I=await F.signMessage(new TextEncoder().encode(E),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=I}}try{const{data:x,error:D}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:bytesToBase64URL(T)},!(($=e.options)===null||$===void 0)&&$.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:_sessionResponse});if(D)throw D;return!x||!x.session||!x.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign({},x),error:D})}catch(x){if(isAuthError(x))return{data:{user:null,session:null},error:x};throw x}}async _exchangeCodeForSession(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[i,n]=(t??"").split("/");try{const{data:o,error:u}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new AuthInvalidTokenResponseError}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:u})}catch(o){if(isAuthError(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:i,token:n,access_token:o,nonce:u}=e,f=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:n,access_token:o,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:_sessionResponse}),{data:p,error:v}=f;return v?{data:{user:null,session:null},error:v}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new AuthInvalidTokenResponseError}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:v})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,i,n,o,u;try{if("email"in e){const{email:f,options:p}=e;let v=null,g=null;this.flowType==="pkce"&&([v,g]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:m}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(t=p?.data)!==null&&t!==void 0?t:{},create_user:(i=p?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:v,code_challenge_method:g},redirectTo:p?.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){const{phone:f,options:p}=e,{data:v,error:g}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(n=p?.data)!==null&&n!==void 0?n:{},create_user:(o=p?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(u=p?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:v?.message_id},error:g}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(f){if(isAuthError(f))return{data:{user:null,session:null},error:f};throw f}}async verifyOtp(e){var t,i;try{let n,o;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:u,error:f}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:_sessionResponse});if(f)throw f;if(!u)throw new Error("An error occurred on token verification.");const p=u.session,v=u.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(n){if(isAuthError(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,i,n;try{let o=null,u=null;return this.flowType==="pkce"&&([o,u]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:u}),headers:this.headers,xform:_ssoResponse})}catch(o){if(isAuthError(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new AuthSessionMissingError;const{error:n}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(isAuthError(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:n,options:o}=e,{error:u}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:i,type:n,options:o}=e,{data:u,error:f}=await _request(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:f}}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const u=await getItemAsync(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=userNotAvailableProxy()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(p,v,g)=>(!u&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(p,v,g))})}return{data:{session:e},error:null}}const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_userResponse}):await this._useSession(async t=>{var i,n,o;const{data:u,error:f}=t;if(f)throw f;return!(!((i=u.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=u.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:_userResponse})})}catch(t){if(isAuthError(t))return isAuthSessionMissingError(t)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:n,error:o}=i;if(o)throw o;if(!n.session)throw new AuthSessionMissingError;const u=n.session;let f=null,p=null;this.flowType==="pkce"&&e.email!=null&&([f,p]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:v,error:g}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:p}),jwt:u.access_token,xform:_userResponse});if(g)throw g;return u.user=v.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(i){if(isAuthError(i))return{data:{user:null},error:i};throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new AuthSessionMissingError;const t=Date.now()/1e3;let i=t,n=!0,o=null;const{payload:u}=decodeJWT(e.access_token);if(u.exp&&(i=u.exp,n=i<=t),n){const{session:f,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!f)return{data:{user:null,session:null},error:null};o=f}else{const{data:f,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(isAuthError(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:u,error:f}=t;if(f)throw f;e=(i=u.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new AuthSessionMissingError;const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(isAuthError(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(e.error||e.error_description||e.error_code)throw new AuthImplicitGrantRedirectError(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:P,error:R}=await this._exchangeCodeForSession(e.code);if(R)throw R;const F=new URL(window.location.href);return F.searchParams.delete("code"),window.history.replaceState(window.history.state,"",F.toString()),{data:{session:P.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:n,access_token:o,refresh_token:u,expires_in:f,expires_at:p,token_type:v}=e;if(!o||!f||!u||!v)throw new AuthImplicitGrantRedirectError("No session defined in URL");const g=Math.round(Date.now()/1e3),m=parseInt(f);let $=g+m;p&&($=parseInt(p));const _=$-g;_*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${m}s`);const E=$-m;g-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,$,g):g-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,$,g);const{data:T,error:x}=await this._getUser(o);if(x)throw x;const D={provider_token:i,provider_refresh_token:n,access_token:o,expires_in:m,expires_at:$,refresh_token:u,token_type:v,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:D,redirectType:e.type},error:null}}catch(i){if(isAuthError(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:n,error:o}=t;if(o)return{error:o};const u=(i=n.session)===null||i===void 0?void 0:i.access_token;if(u){const{error:f}=await this.admin.signOut(u,e);if(f&&!(isAuthApiError(f)&&(f.status===404||f.status===401||f.status===403)))return{error:f}}return e!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=uuid(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,n;try{const{data:{session:o},error:u}=t;if(u)throw u;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let i=null,n=null;this.flowType==="pkce"&&([i,n]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(isAuthError(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:i,error:n}=await this._useSession(async o=>{var u,f,p,v,g;const{data:m,error:$}=o;if($)throw $;const _=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",_,{headers:this.headers,jwt:(g=(v=m.session)===null||v===void 0?void 0:v.access_token)!==null&&g!==void 0?g:void 0})});if(n)throw n;return isBrowser()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i?.url),{data:{provider:e.provider,url:i?.url},error:null}}catch(i){if(isAuthError(i))return{data:{provider:e.provider,url:null},error:i};throw i}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,n;const{data:o,error:u}=t;if(u)throw u;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await retryable(async n=>(n>0&&await sleep(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_sessionResponse})),(n,o)=>{const u=200*Math.pow(2,n);return o&&isAuthRetryableFetchError(o)&&Date.now()+u-i<AUTO_REFRESH_TICK_DURATION_MS})}catch(i){if(this._debug(t,"error",i),isAuthError(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),isBrowser()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const n=await getItemAsync(this.storage,this.storageKey);if(n&&this.userStorage){let u=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:n.user},await setItemAsync(this.userStorage,this.storageKey+"-user",u)),n.user=(e=u?.user)!==null&&e!==void 0?e:userNotAvailableProxy()}else if(n&&!n.user&&!n.user){const u=await getItemAsync(this.storage,this.storageKey+"-user");u&&u?.user?(n.user=u.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,n)):n.user=userNotAvailableProxy()}if(this._debug(i,"session from storage",n),!this._isValidSession(n)){this._debug(i,"session is not valid"),n!==null&&await this._removeSession();return}const o=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(i,`session has${o?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),o){if(this.autoRefreshToken&&n.refresh_token){const{error:u}=await this._callRefreshToken(n.refresh_token);u&&(console.error(u),isAuthRetryableFetchError(u)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:f}=await this._getUser(n.access_token);!f&&u?.user?(n.user=u.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(i,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(i,"error",n),console.error(n);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Deferred;const{data:o,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!o.session)throw new AuthSessionMissingError;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const f={session:o.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(o){if(this._debug(n,"error",o),isAuthError(o)){const u={session:null,error:o};return isAuthRetryableFetchError(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,i=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],u=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,t)}catch(p){o.push(p)}});if(await Promise.all(u),o.length>0){for(let f=0;f<o.length;f+=1)console.error(o[f]);throw o[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const o=deepClone(n);await setItemAsync(this.storage,this.storageKey,o)}else{const n=deepClone(t);await setItemAsync(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&isBrowser()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((i.expires_at*1e3-e)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),n<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const n=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&n.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[o,u]=await getCodeChallengeAndMethod(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(u)}`});n.push(f.toString())}if(i?.queryParams){const o=new URLSearchParams(i.queryParams);n.push(o.toString())}return i?.skipBrowserRedirect&&n.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;return o?{data:null,error:o}:await _request(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,n;const{data:o,error:u}=t;if(u)return{data:null,error:u};const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:p,error:v}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(i=o?.session)===null||i===void 0?void 0:i.access_token});return v?{data:null,error:v}:(e.factorType==="totp"&&(!((n=p?.totp)===null||n===void 0)&&n.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),{data:p,error:null})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:u,error:f}=await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token});return f?{data:null,error:f}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:f})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:n,error:o}=t;return o?{data:null,error:o}:await _request(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(i=n?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(isAuthError(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?{data:null,error:i}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const i=e?.factors||[],n=i.filter(u=>u.factor_type==="totp"&&u.status==="verified"),o=i.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:i,totp:n,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,i;const{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=decodeJWT(n.access_token);let f=null;u.aal&&(f=u.aal);let p=f;((i=(t=n.user.factors)===null||t===void 0?void 0:t.filter(m=>m.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(p="aal2");const g=u.amr||[];return{data:{currentLevel:f,nextLevel:p,currentAuthenticationMethods:g},error:null}}))}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(f=>f.kid===e);if(i)return i;const n=Date.now();if(i=this.jwks.keys.find(f=>f.kid===e),i&&this.jwks_cached_at+JWKS_TTL>n)return i;const{data:o,error:u}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=n,i=o.keys.find(f=>f.kid===e),!i)?null:i}async getClaims(e,t={}){try{let i=e;if(!i){const{data:_,error:E}=await this.getSession();if(E||!_.session)return{data:null,error:E};i=_.session.access_token}const{header:n,payload:o,signature:u,raw:{header:f,payload:p}}=decodeJWT(i);t?.allowExpired||validateExp(o.exp);const v=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!v){const{error:_}=await this.getUser(i);if(_)throw _;return{data:{claims:o,header:n,signature:u},error:null}}const g=getAlgorithm(n.alg),m=await crypto.subtle.importKey("jwk",v,g,!0,["verify"]);if(!await crypto.subtle.verify(g,m,u,stringToUint8Array(`${f}.${p}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:o,header:n,signature:u},error:null}}catch(i){if(isAuthError(i))return{data:null,error:i};throw i}}}GoTrueClient.nextInstanceID=0;const AuthClient=GoTrueClient;class SupabaseAuthClient extends AuthClient{constructor(e){super(e)}}var __awaiter=function(r,e,t,i){function n(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function f(g){try{v(i.next(g))}catch(m){u(m)}}function p(g){try{v(i.throw(g))}catch(m){u(m)}}function v(g){g.done?o(g.value):n(g.value).then(f,p)}v((i=i.apply(r,e||[])).next())})};class SupabaseClient{constructor(e,t,i){var n,o,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=ensureTrailingSlash(e),p=new URL(f);this.realtimeUrl=new URL("realtime/v1",p),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",p),this.storageUrl=new URL("storage/v1",p),this.functionsUrl=new URL("functions/v1",p);const v=`sb-${p.hostname.split(".")[0]}-auth-token`,g={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},DEFAULT_AUTH_OPTIONS),{storageKey:v}),global:DEFAULT_GLOBAL_OPTIONS},m=applySettingDefaults(i??{},g);this.storageKey=(n=m.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=m.global.headers)!==null&&o!==void 0?o:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:($,_)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(_)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=m.auth)!==null&&u!==void 0?u:{},this.headers,m.global.fetch),this.fetch=fetchWithAuth(t,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new PostgrestClient(new URL("rest/v1",p).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,i?.storage),m.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return __awaiter(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:n,storageKey:o,flowType:u,lock:f,debug:p},v,g){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),v),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:n,flowType:u,lock:f,debug:p,fetch:g,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i?.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?this.changedAccessToken=i:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const createClient=(r,e,t)=>new SupabaseClient(r,e,t);function shouldShowDeprecationWarning(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl="https://vycjpmuyscfygstjjied.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",customFetch=async(r,e)=>{const t=typeof r=="string"?r:r instanceof URL?r.href:r.url,i=e?.method||"GET";console.log(`[Supabase] ${i} ${t}`);const n=performance.now();try{const o=await fetch(r,e),u=(performance.now()-n).toFixed(2);return console.log(`[Supabase] ${i} ${t} - ${o.status} (${u}ms)`),o}catch(o){const u=(performance.now()-n).toFixed(2);throw console.error(`[Supabase] ${i} ${t} - ERROR (${u}ms)`,o),o}},supabase=createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:customFetch,headers:{"Content-Type":"application/json"}}}),resourceActions={async loadStoriesList(){if(!editor.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${editor.selectedBucket}`);const r=`${editor.selectedBucket}_story.json`,{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(i=>i.name===r)?(editor.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(editor.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!editor.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await supabase.storage.from(editor.selectedBucket).list();r&&(editor.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история");return}const t=e.files[0];editorActions.setStatus("loading","Загрузка файла...");const i=await t.arrayBuffer(),n=new Uint8Array(i),{error:o}=await supabase.storage.from(editor.selectedBucket).upload(t.name,n,{upsert:!0,contentType:t.type});o?editorActions.setStatus("error","Ошибка загрузки"):(editorActions.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история");return}const{error:e}=await supabase.storage.from(editor.selectedBucket).remove([r]);e?editorActions.setStatus("error","Ошибка удаления файла"):(editorActions.setStatus("success","Файл удален"),await this.loadStoredResources())}};function migrateStoryData(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function createNewOption(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const storyActions={async createNewStory(){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),n=new TextEncoder().encode(t),{error:o}=await supabase.storage.from(editor.selectedBucket).upload(r,n,{contentType:"application/json"});o?editorActions.setStatus("error","Ошибка создания: "+o.message):(await resourceActions.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${editor.selectedBucket}`),editorActions.setStatus("loading","Загрузка..."),editor.currentFileName=r;try{const{data:e,error:t}=await supabase.storage.from(editor.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let i;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const o=supabase.storage.from(editor.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${o}`);const u=await fetch(o);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);i=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${i.length}`)}else i=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${i.length}`);let n=JSON.parse(i);console.log("[StoryStore] Данные распарсены:",{meta:n.meta,chaptersCount:n.chapters?.length,dialoguesCount:n.dialogues?.length,itemsCount:n.items?.length}),n=migrateStoryData(n),console.log("[StoryStore] Присваиваем данные в editor.data"),editor.data=n,console.log("[StoryStore] editor.data обновлен:",{chapters:editor.data.chapters?.length,dialogues:editor.data.dialogues?.length}),editor.data.chapters&&editor.data.chapters.length>0&&(editor.selectedChapterId=editor.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${editor.selectedChapterId}`)),editor.data.dialogues&&editor.data.dialogues.length>0&&(editor.selectedDialogueId=editor.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${editor.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),editorActions.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),editorActions.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}editorActions.setStatus("loading","Сохранение...");const r=JSON.stringify(editor.data,null,2);console.log(`[StoryStore] Сохранение файла: ${editor.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:i}=await supabase.storage.from(editor.selectedBucket).update(editor.currentFileName,t,{contentType:"application/json"});if(i){console.error("[StoryStore] Ошибка сохранения (update):",i),console.log("[StoryStore] Пробуем upload вместо update");const n=await supabase.storage.from(editor.selectedBucket).upload(editor.currentFileName,t,{contentType:"application/json"});n.error?(console.error("[StoryStore] Ошибка сохранения (upload):",n.error),editorActions.setStatus("error","Ошибка сохранения: "+n.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),editorActions.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),editorActions.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!editor.data)return;if(!editor.selectedBucket){editorActions.setStatus("error","Не выбрана история (bucket)");return}const r=editor.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const i=prompt("Введите имя для копии:",t);if(!i)return;t=i.trim(),t.endsWith(".json")||(t+=".json"),editorActions.setStatus("loading","Создание копии...");const n=JSON.stringify(editor.data,null,2),u=new TextEncoder().encode(n),{error:f}=await supabase.storage.from(editor.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});f?editorActions.setStatus("error",`Ошибка копии: ${f.message}`):(await resourceActions.loadStoriesList(),editorActions.setStatus("success","Копия сохранена!"))},addChapter(){if(!editor.data||!editor.data.chapters)return;const r="ch_"+Date.now();editor.data.chapters.push({id:r,title:"Новая глава",description:""}),editor.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!editor.data||!editor.selectedChapterId)return;const r="d_"+Date.now();editor.data.dialogues.push({id:r,chapterId:editor.selectedChapterId,text:"Новый текст...",options:[]}),editor.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&editor.data&&(editor.data.dialogues=editor.data.dialogues.filter(e=>e.id!==r),editor.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),editor.selectedDialogueId===r&&(editor.selectedDialogueId=null))},jumpTo(r){const e=editor.data?.dialogues.find(t=>t.id===r);e&&(editor.selectedChapterId=e.chapterId,editor.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var $$_import_editorDerived$1=reactive_import(()=>editorDerived);function handleCancel(){editorActions.selectEditingChapter(null)}var root_1$x=from_html('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function ChapterForm(r,e){push(e,!1);function t(){$$_import_editorDerived$1().currentEditingChapter&&(editorActions.updateChapter($$_import_editorDerived$1().currentEditingChapter.id,{title:$$_import_editorDerived$1().currentEditingChapter.title,description:$$_import_editorDerived$1().currentEditingChapter.description}),editorActions.selectEditingChapter(null))}function i(){$$_import_editorDerived$1().currentEditingChapter&&confirm(`Удалить главу "${$$_import_editorDerived$1().currentEditingChapter.title}"?`)&&(editorActions.deleteChapter($$_import_editorDerived$1().currentEditingChapter.id),editorActions.selectEditingChapter(null))}init();var n=comment(),o=first_child(n);{var u=f=>{var p=root_1$x(),v=child(p),g=sibling(child(v),2),m=child(g);m.__click=i;var $=sibling(v,2),_=sibling(child($),2),E=sibling($,2),T=sibling(child(E),2),x=sibling(E,2),D=child(x);D.__click=[handleCancel];var P=sibling(D,2);P.__click=t,bind_value(_,()=>$$_import_editorDerived$1().currentEditingChapter.title,R=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.title=R)),bind_value(T,()=>$$_import_editorDerived$1().currentEditingChapter.description,R=>$$_import_editorDerived$1($$_import_editorDerived$1().currentEditingChapter.description=R)),append(f,p)};if_block(o,f=>{$$_import_editorDerived$1().currentEditingChapter&&f(u)})}append(r,n),pop()}delegate(["click"]);var $$_import_editor$3=reactive_import(()=>editor),on_click$d=(r,e,t)=>e(get$2(t).id),root_2$n=from_html('<div class="chapter-form-container svelte-xp6igx"><!></div>'),root_1$w=from_html('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),root_3$q=from_html('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),root_4$l=from_html("<div> </div>"),root$g=from_html('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function EditorSidebar(r,e){push(e,!1);function t(D){editorActions.selectEditingChapter(D)}init();var i=root$g(),n=child(i),o=child(n),u=sibling(child(o),2);u.__click=function(...D){storyActions.addChapter?.apply(this,D)};var f=sibling(o,2);each(f,5,()=>$$_import_editor$3().data?.chapters||[],D=>D.id,(D,P)=>{var R=root_1$w(),F=first_child(R),V=child(F);let I;V.__click=()=>$$_import_editor$3($$_import_editor$3().selectedChapterId=get$2(P).id);var k=child(V),U=child(k),W=sibling(V,2);W.__click=[on_click$d,t,P];var B=sibling(F,2);{var L=G=>{var re=root_2$n(),ue=child(re);ChapterForm(ue,{}),append(G,re)};if_block(B,G=>{$$_import_editor$3().editingChapterId===get$2(P).id&&G(L)})}template_effect(G=>{I=set_class(V,1,"chapter-item svelte-xp6igx",null,I,G),set_attribute(V,"aria-pressed",$$_import_editor$3().selectedChapterId===get$2(P).id),set_attribute(V,"title",get$2(P).description||"Без описания"),set_text(U,get$2(P).title)},[()=>({active:$$_import_editor$3().selectedChapterId===get$2(P).id})]),append(D,R)});var p=sibling(n,2),v=child(p),g=child(v),m=child(g),$=sibling(g,2);$.__click=function(...D){storyActions.addDialogue?.apply(this,D)};var _=sibling(v,2);each(_,5,()=>editorDerived.chapterDialogues,D=>D.id,(D,P)=>{var R=root_3$q();let F;R.__click=()=>$$_import_editor$3($$_import_editor$3().selectedDialogueId=get$2(P).id);var V=child(R),I=child(V),k=sibling(V,2),U=child(k);template_effect((W,B)=>{F=set_class(R,1,"dialogue-item svelte-xp6igx",null,F,W),set_attribute(R,"aria-pressed",$$_import_editor$3().selectedDialogueId===get$2(P).id),set_text(I,get$2(P).id),set_text(U,`${B??""}...`)},[()=>({active:$$_import_editor$3().selectedDialogueId===get$2(P).id}),()=>get$2(P).text.substring(0,25)]),append(D,R)});var E=sibling(p,2),T=child(E);{var x=D=>{var P=root_4$l(),R=child(P);template_effect(()=>{set_class(P,1,`alert ${$$_import_editor$3().statusMessage.type??""}`,"svelte-xp6igx"),set_text(R,$$_import_editor$3().statusMessage.text)}),append(D,P)};if_block(T,D=>{$$_import_editor$3().statusMessage.text&&D(x)})}template_effect(()=>{set_text(m,`Сцены (${editorDerived.chapterDialogues.length??""})`),$.disabled=!$$_import_editor$3().selectedChapterId}),append(r,i),pop()}delegate(["click"]);var root_1$v=from_html("<option> </option>"),on_change=(r,e)=>{const t=r.target;e(t.checked)},on_change_1=(r,e)=>{const t=r.target;e("id",t.value)},on_change_2=(r,e)=>{const t=r.target;e("onWinDialogueId",t.value)},root_3$p=from_html("<option> </option>"),on_change_3=(r,e)=>{const t=r.target;e("onLoseDialogueId",t.value)},root_4$k=from_html("<option> </option>"),on_change_4=(r,e)=>{const t=r.target;e("rewardItem",t.value)},root_5$m=from_html("<option> </option>"),root_2$m=from_html('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option><option>Алхимический Крест</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),on_change_5=(r,e)=>{const t=r.target;e(t.value)},root_6$e=from_html("<option> </option>"),on_change_6=(r,e)=>{const t=r.target;e({itemId:t.value})},root_8$b=from_html("<option> </option>"),root_7$d=from_html('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),on_input$1=(r,e)=>{const t=r.target;e({statName:t.value})},on_input_1$1=(r,e)=>{const t=r.target,i=parseInt(t.value);e({statValue:isNaN(i)?0:i})},root_9$5=from_html('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),on_input_2=(r,e)=>{const t=r.target;e({flagName:t.value})},root_10$5=from_html('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),root$f=from_html('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function OptionEditor(r,e){push(e,!0);const t=prop(e,"option",7);function i(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function n(){return i(),t().visibilityCondition}function o(Y){i();const Z=t().visibilityCondition;Object.assign(Z,Y),t().visibilityCondition={...Z}}function u(Y){i();const Z={type:Y};switch(Y){case"has_item":Z.itemId=n().itemId||"";break;case"stat_greater":Z.statName=n().statName||"",Z.statValue=n().statValue||0;break;case"flag_true":Z.flagName=n().flagName||"";break}t().visibilityCondition=Z}const f=user_derived(()=>!!t().miniGame);function p(Y){Y?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function v(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function g(Y,Z){const ce=v();ce&&(ce[Y]=Z)}var m=root$f(),$=child(m),_=child($),E=sibling(_,2),T=sibling($,2),x=child(T),D=sibling(x,2),P=child(D);P.value=P.__value="";var R=sibling(P);each(R,17,()=>e.dialogues,Y=>Y.id,(Y,Z)=>{var ce=root_1$v(),te=child(ce),he={};template_effect(ie=>{set_text(te,`${get$2(Z).id??""}: ${ie??""}...`),he!==(he=get$2(Z).id)&&(ce.value=(ce.__value=get$2(Z).id)??"")},[()=>get$2(Z).text.substring(0,30)]),append(Y,ce)});var F=sibling(T,2),V=child(F),I=child(V),k=child(I);k.__change=[on_change,p];var U=sibling(V,2);{var W=Y=>{var Z=root_2$m(),ce=child(Z),te=child(ce),he=sibling(te,2);he.__change=[on_change_1,g];var ie=child(he);ie.value=ie.__value="";var pe=sibling(ie);pe.value=pe.__value="onet_monsters";var ge=sibling(pe);ge.value=ge.__value="memo_monsters";var Ie=sibling(ge);Ie.value=Ie.__value="light_out";var ke=sibling(Ie);ke.value=ke.__value="flood_it";var Re=sibling(ke);Re.value=Re.__value="broken_mirror";var Ce=sibling(Re);Ce.value=Ce.__value="evolution2048";var Be=sibling(Ce);Be.value=Be.__value="cursed_crypts";var De=sibling(Be);De.value=De.__value="tower_of_souls";var w=sibling(De);w.value=w.__value="alchemists_cross";var c;init_select(he);var h=sibling(ce,2),S=child(h),j=child(S),X=sibling(j,2);X.__change=[on_change_2,g];var ve=child(X);ve.value=ve.__value="";var Ae=sibling(ve);each(Ae,17,()=>e.dialogues,Je=>Je.id,(Je,xe)=>{var Ne=root_3$p(),ut=child(Ne),mt={};template_effect(Rt=>{set_text(ut,`${get$2(xe).id??""}: ${Rt??""}...`),mt!==(mt=get$2(xe).id)&&(Ne.value=(Ne.__value=get$2(xe).id)??"")},[()=>get$2(xe).text.substring(0,30)]),append(Je,Ne)});var je;init_select(X);var Se=sibling(S,2),Fe=child(Se),We=sibling(Fe,2);We.__change=[on_change_3,g];var et=child(We);et.value=et.__value="";var Ze=sibling(et);each(Ze,17,()=>e.dialogues,Je=>Je.id,(Je,xe)=>{var Ne=root_4$k(),ut=child(Ne),mt={};template_effect(Rt=>{set_text(ut,`${get$2(xe).id??""}: ${Rt??""}...`),mt!==(mt=get$2(xe).id)&&(Ne.value=(Ne.__value=get$2(xe).id)??"")},[()=>get$2(xe).text.substring(0,30)]),append(Je,Ne)});var ct;init_select(We);var lt=sibling(h,2),at=child(lt),qe=sibling(at,2);qe.__change=[on_change_4,g];var Ue=child(qe);Ue.value=Ue.__value="";var it=sibling(Ue);each(it,17,()=>e.availableItems,Je=>Je.id,(Je,xe)=>{var Ne=root_5$m(),ut=child(Ne),mt={};template_effect(()=>{set_text(ut,get$2(xe).name),mt!==(mt=get$2(xe).id)&&(Ne.value=(Ne.__value=get$2(xe).id)??"")}),append(Je,Ne)});var nt;init_select(qe),template_effect((Je,xe,Ne,ut)=>{set_attribute(te,"for",`option-mg-id-${e.index??""}`),set_attribute(he,"id",`option-mg-id-${e.index??""}`),c!==(c=Je)&&(he.value=(he.__value=Je)??"",select_option(he,Je)),set_attribute(j,"for",`option-mg-win-${e.index??""}`),set_attribute(X,"id",`option-mg-win-${e.index??""}`),je!==(je=xe)&&(X.value=(X.__value=xe)??"",select_option(X,xe)),set_attribute(Fe,"for",`option-mg-lose-${e.index??""}`),set_attribute(We,"id",`option-mg-lose-${e.index??""}`),ct!==(ct=Ne)&&(We.value=(We.__value=Ne)??"",select_option(We,Ne)),set_attribute(at,"for",`option-mg-reward-${e.index??""}`),set_attribute(qe,"id",`option-mg-reward-${e.index??""}`),nt!==(nt=ut)&&(qe.value=(qe.__value=ut)??"",select_option(qe,ut))},[()=>v().id,()=>v().onWinDialogueId,()=>v().onLoseDialogueId,()=>v().rewardItem||""]),append(Y,Z)};if_block(U,Y=>{v()&&Y(W)})}var B=sibling(F,2),L=child(B),G=child(L),re=child(G),ue=sibling(L,2),z=child(ue),q=child(z),N=sibling(B,2),M=sibling(child(N),2),O=child(M),K=child(O),oe=sibling(K,2);oe.__change=[on_change_5,u],each(oe,20,()=>e.conditionTypes,Y=>Y,(Y,Z)=>{var ce=root_6$e(),te=child(ce),he={};template_effect(()=>{set_text(te,Z),he!==(he=Z)&&(ce.value=(ce.__value=Z)??"")}),append(Y,ce)});var de;init_select(oe);var ae=sibling(O,2);{var _e=Y=>{var Z=root_7$d(),ce=child(Z),te=sibling(ce,2);te.__change=[on_change_6,o];var he=child(te);he.value=he.__value="";var ie=sibling(he);each(ie,17,()=>e.availableItems,ge=>ge.id,(ge,Ie)=>{var ke=root_8$b(),Re=child(ke),Ce={};template_effect(()=>{set_text(Re,get$2(Ie).name),Ce!==(Ce=get$2(Ie).id)&&(ke.value=(ke.__value=get$2(Ie).id)??"")}),append(ge,ke)});var pe;init_select(te),template_effect(ge=>{set_attribute(ce,"for",`option-cond-item-${e.index??""}`),set_attribute(te,"id",`option-cond-item-${e.index??""}`),pe!==(pe=ge)&&(te.value=(te.__value=ge)??"",select_option(te,ge))},[()=>n().itemId||""]),append(Y,Z)};if_block(ae,Y=>{n().type==="has_item"&&Y(_e)})}var me=sibling(ae,2);{var be=Y=>{var Z=root_9$5(),ce=first_child(Z),te=child(ce),he=sibling(te,2);he.__input=[on_input$1,o];var ie=sibling(ce,2),pe=child(ie),ge=sibling(pe,2);ge.__input=[on_input_1$1,o],template_effect((Ie,ke)=>{set_attribute(te,"for",`option-cond-stat-${e.index??""}`),set_attribute(he,"id",`option-cond-stat-${e.index??""}`),set_value(he,Ie),set_attribute(pe,"for",`option-cond-stat-val-${e.index??""}`),set_attribute(ge,"id",`option-cond-stat-val-${e.index??""}`),set_value(ge,ke)},[()=>n().statName||"",()=>n().statValue||0]),append(Y,Z)};if_block(me,Y=>{n().type==="stat_greater"&&Y(be)})}var le=sibling(me,2);{var Q=Y=>{var Z=root_10$5(),ce=child(Z),te=sibling(ce,2);te.__input=[on_input_2,o],template_effect(he=>{set_attribute(ce,"for",`option-cond-flag-${e.index??""}`),set_attribute(te,"id",`option-cond-flag-${e.index??""}`),set_value(te,he)},[()=>n().flagName||""]),append(Y,Z)};if_block(le,Y=>{n().type==="flag_true"&&Y(Q)})}var ne=sibling(M,2);if_block(ne,Y=>{}),template_effect(Y=>{set_attribute(_,"for",`option-text-${e.index??""}`),set_attribute(E,"id",`option-text-${e.index??""}`),set_attribute(x,"for",`option-next-${e.index??""}`),set_attribute(D,"id",`option-next-${e.index??""}`),set_checked(k,get$2(f)),set_attribute(K,"for",`option-cond-type-${e.index??""}`),set_attribute(oe,"id",`option-cond-type-${e.index??""}`),de!==(de=Y)&&(oe.value=(oe.__value=Y)??"",select_option(oe,Y))},[()=>n().type]),bind_value(E,()=>t().text,Y=>t().text=Y),bind_select_value(D,()=>t().nextDialogueId,Y=>t().nextDialogueId=Y),bind_checked(re,()=>t().enabled,Y=>t().enabled=Y),bind_checked(q,()=>t().visible,Y=>t().visible=Y),append(r,m),pop()}delegate(["change","input"]);var $$_import_editor$2=reactive_import(()=>editor),$$_import_editorDerived=reactive_import(()=>editorDerived),root_2$l=from_html("<option> <!></option>"),root_4$j=from_html("<option> </option>"),root_5$l=from_html("<option> </option>"),root_6$d=from_html("<option> </option>"),root_7$c=from_html("<option> </option>"),root_13$1=from_html('<div class="option-content svelte-1e6637j"><!></div>'),root_8$a=from_html('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),root_14=from_html('<div class="empty-links svelte-1e6637j">Нет связей</div>'),on_click$c=(r,e)=>storyActions.jumpTo(get$2(e).id),root_16$1=from_html('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),root_15$1=from_html('<div class="links-list svelte-1e6637j"></div>'),root_17=from_html('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),on_click_1$6=(r,e)=>storyActions.jumpTo(get$2(e).id),root_19=from_html('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),root_20$1=from_html('<div class="more-links svelte-1e6637j"> </div>'),root_18$1=from_html('<div class="links-list svelte-1e6637j"><!> <!></div>'),root_21$1=from_html("<option> </option>"),root_1$u=from_html('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),root_22$1=from_html('<div class="empty-state">Выберите сцену</div>');function DialogueForm(r,e){push(e,!1);const t=["always","has_item","stat_greater","flag_true"];function i($){$.options||($.options=[]);const _=createNewOption();$.options.push(_),$$_import_editor$2($$_import_editor$2().editingOptionIndex=$.options.length-1)}function n($){if($$_import_editor$2().editingOptionIndex===$)$$_import_editor$2($$_import_editor$2().editingOptionIndex=null);else{$$_import_editor$2($$_import_editor$2().editingOptionIndex=$);const _=$$_import_editorDerived().currentDialogue?.options?.[$];_&&!_.visibilityCondition&&(_.visibilityCondition={type:"always"})}}function o($,_){confirm("Удалить вариант ответа?")&&($.options?.splice(_,1),$$_import_editor$2().editingOptionIndex===_?$$_import_editor$2($$_import_editor$2().editingOptionIndex=null):$$_import_editor$2().editingOptionIndex&&$$_import_editor$2().editingOptionIndex>_&&$$_import_editor$2($$_import_editor$2().editingOptionIndex--))}function u($){if(!$||!$$_import_editor$2().data)return"Нет";const _=$$_import_editor$2().data.dialogues.find(E=>E.id===$);return _?_.text.substring(0,25)+"...":`❌ ${$}`}function f(){const $=[],_=$$_import_editorDerived().currentDialogue;return _&&(_.nextDialogueId&&$.push({type:"Auto",id:_.nextDialogueId,text:u(_.nextDialogueId)}),_.options?.forEach((E,T)=>{E.nextDialogueId&&$.push({type:`Опция #${T+1}`,id:E.nextDialogueId,text:u(E.nextDialogueId)})})),$}init();var p=comment(),v=first_child(p);{var g=$=>{var _=root_1$u(),E=child(_),T=sibling(child(E),2);T.__change=c=>{const h=c.target;$$_import_editor$2($$_import_editor$2().selectedDialogueId=h.value)};var x=sibling(E,2),D=sibling(child(x),2);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{$$_import_editor$2()})}),D.__change=c=>{const h=c.target;$$_import_editor$2($$_import_editor$2().selectedChapterId=h.value)};var P=child(D);P.value=P.__value="";var R=sibling(P);each(R,1,()=>$$_import_editor$2().data.chapters||[],index$1,(c,h)=>{var S=root_2$l(),j=child(S),X=sibling(j);{var ve=je=>{var Se=text();template_effect(Fe=>set_text(Se,`- ${Fe??""}...`),[()=>get$2(h).description.substring(0,30)]),append(je,Se)};if_block(X,je=>{get$2(h).description&&je(ve)})}var Ae={};template_effect(()=>{set_text(j,`${get$2(h).title??""} `),Ae!==(Ae=get$2(h).id)&&(S.value=(S.__value=get$2(h).id)??"")}),append(c,S)});var F=sibling(x,2),V=sibling(child(F),2),I=sibling(F,2),k=sibling(child(I),2),U=sibling(child(k),2),W=child(U);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{})});var B=child(W);B.value=B.__value="";var L=sibling(B);each(L,1,()=>$$_import_editorDerived().imageResources,index$1,(c,h)=>{var S=root_4$j(),j=child(S),X={};template_effect(()=>{set_text(j,get$2(h).name),X!==(X=get$2(h).name)&&(S.value=(S.__value=get$2(h).name)??"")}),append(c,S)});var G=sibling(L);each(G,1,()=>$$_import_editorDerived().riveResources,index$1,(c,h)=>{var S=root_5$l(),j=child(S),X={};template_effect(()=>{set_text(j,`${get$2(h).name??""} (Rive)`),X!==(X=get$2(h).name)&&(S.value=(S.__value=get$2(h).name)??"")}),append(c,S)});var re=sibling(W,2),ue=sibling(child(re));ue.__change=function(...c){resourceActions.uploadNewFile?.apply(this,c)};var z=sibling(k,2),q=sibling(child(z),2),N=child(q);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{})});var M=child(N);M.value=M.__value="";var O=sibling(M);each(O,1,()=>$$_import_editorDerived().imageResources,index$1,(c,h)=>{var S=root_6$d(),j=child(S),X={};template_effect(()=>{set_text(j,get$2(h).name),X!==(X=get$2(h).name)&&(S.value=(S.__value=get$2(h).name)??"")}),append(c,S)});var K=sibling(O);each(K,1,()=>$$_import_editorDerived().riveResources,index$1,(c,h)=>{var S=root_7$c(),j=child(S),X={};template_effect(()=>{set_text(j,`${get$2(h).name??""} (Rive)`),X!==(X=get$2(h).name)&&(S.value=(S.__value=get$2(h).name)??"")}),append(c,S)});var oe=sibling(I,2),de=child(oe),ae=sibling(child(de),2);ae.__click=()=>i($$_import_editorDerived().currentDialogue);var _e=sibling(de,2);each(_e,1,()=>$$_import_editorDerived().currentDialogue.options||[],index$1,(c,h,S)=>{var j=root_8$a();let X;var ve=child(j),Ae=child(ve);Ae.__click=()=>n(S),Ae.__keydown=qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),n(S))},set_attribute(Ae,"aria-controls",`option-content-${S}`);var je=child(Ae),Se=child(je);{var Fe=qe=>{var Ue=text("👁️‍🗨️");append(qe,Ue)},We=qe=>{var Ue=comment(),it=first_child(Ue);{var nt=xe=>{var Ne=text("🔒");append(xe,Ne)},Je=xe=>{var Ne=text("✅");append(xe,Ne)};if_block(it,xe=>{get$2(h).enabled?xe(Je,!1):xe(nt)},!0)}append(qe,Ue)};if_block(Se,qe=>{get$2(h).visible?qe(We,!1):qe(Fe)})}var et=sibling(je,2),Ze=child(et),ct=sibling(Ae,2);ct.__click=()=>o($$_import_editorDerived().currentDialogue,S);var lt=sibling(ve,2);{var at=qe=>{var Ue=root_13$1();set_attribute(Ue,"id",`option-content-${S}`);var it=child(Ue);OptionEditor(it,{get option(){return get$2(h)},index:S,get dialogues(){return $$_import_editor$2().data.dialogues},get availableItems(){return $$_import_editorDerived().availableItems},get conditionTypes(){return t}}),append(qe,Ue)};if_block(lt,qe=>{$$_import_editor$2().editingOptionIndex===S&&qe(at)})}template_effect(qe=>{X=set_class(j,1,"option-card svelte-1e6637j",null,X,qe),set_attribute(Ae,"aria-expanded",$$_import_editor$2().editingOptionIndex===S),set_text(Ze,`#${S+1} ${get$2(h).text??""}`)},[()=>({editing:$$_import_editor$2().editingOptionIndex===S})]),append(c,j)});var me=sibling(oe,2),be=child(me),le=child(be),Q=child(le),ne=child(Q),Y=sibling(Q,2);{var Z=c=>{var h=root_14();append(c,h)},ce=c=>{var h=root_15$1();each(h,5,f,index$1,(S,j)=>{var X=root_16$1(),ve=child(X),Ae=child(ve),je=sibling(ve,2),Se=child(je),Fe=sibling(je,2);Fe.__click=[on_click$c,j];var We=sibling(Fe,2),et=child(We);template_effect(()=>{set_text(Ae,`${get$2(j).type??""}:`),set_text(Se,get$2(j).id),set_text(et,get$2(j).text)}),append(S,X)}),append(c,h)};if_block(Y,c=>{f().length===0?c(Z):c(ce,!1)})}var te=sibling(le,2),he=child(te),ie=child(he),pe=sibling(he,2);{var ge=c=>{var h=root_17();append(c,h)},Ie=c=>{var h=root_18$1(),S=child(h);each(S,1,()=>$$_import_editorDerived().backlinks.slice(0,5),index$1,(ve,Ae)=>{const je=derived_safe_equal(()=>storyActions.getLinkType(get$2(Ae),$$_import_editorDerived().currentDialogue.id));var Se=root_19(),Fe=child(Se),We=child(Fe),et=sibling(Fe,2);let Ze;var ct=child(et),lt=sibling(et,2);lt.__click=[on_click_1$6,Ae];var at=sibling(lt,2),qe=child(at);template_effect((Ue,it)=>{set_text(We,get$2(Ae).id),Ze=set_class(et,1,"link-type-badge svelte-1e6637j",null,Ze,Ue),set_text(ct,get$2(je)),set_text(qe,`${it??""}...`)},[()=>({"link-auto":get$2(je)==="Auto","link-option":get$2(je)==="Option"}),()=>get$2(Ae).text.substring(0,20)]),append(ve,Se)});var j=sibling(S,2);{var X=ve=>{var Ae=root_20$1(),je=child(Ae);template_effect(()=>set_text(je,`...ещё ${$$_import_editorDerived().backlinks.length-5}`)),append(ve,Ae)};if_block(j,ve=>{$$_import_editorDerived().backlinks.length>5&&ve(X)})}append(c,h)};if_block(pe,c=>{$$_import_editorDerived().backlinks.length===0?c(ge):c(Ie,!1)})}var ke=sibling(me,2),Re=sibling(child(ke),2);template_effect(()=>{$$_import_editorDerived(),invalidate_inner_signals(()=>{$$_import_editor$2()})});var Ce=child(Re);Ce.value=Ce.__value="";var Be=sibling(Ce);each(Be,1,()=>$$_import_editor$2().data.dialogues,index$1,(c,h)=>{var S=root_21$1(),j=child(S),X={};template_effect(ve=>{set_text(j,`${get$2(h).id??""}: ${ve??""}...`),X!==(X=get$2(h).id)&&(S.value=(S.__value=get$2(h).id)??"")},[()=>get$2(h).text.substring(0,30)]),append(c,S)});var De=sibling(ke,2),w=child(De);w.__click=()=>storyActions.deleteDialogue($$_import_editorDerived().currentDialogue.id),template_effect(c=>{set_text(ne,`👉 Куда ведет (${c??""})`),set_text(ie,`👈 Откуда ведут (${$$_import_editorDerived().backlinks.length??""})`)},[()=>f().length]),bind_value(T,()=>$$_import_editorDerived().currentDialogue.id,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.id=c)),bind_select_value(D,()=>$$_import_editorDerived().currentDialogue.chapterId,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.chapterId=c)),bind_value(V,()=>$$_import_editorDerived().currentDialogue.text,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.text=c)),bind_select_value(W,()=>$$_import_editorDerived().currentDialogue.backgroundImage,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.backgroundImage=c)),bind_select_value(N,()=>$$_import_editorDerived().currentDialogue.characterImage,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.characterImage=c)),bind_select_value(Re,()=>$$_import_editorDerived().currentDialogue.nextDialogueId,c=>$$_import_editorDerived($$_import_editorDerived().currentDialogue.nextDialogueId=c)),append($,_)},m=$=>{var _=root_22$1();append($,_)};if_block(v,$=>{$$_import_editorDerived().currentDialogue?$(g):$(m,!1)})}append(r,p),pop()}delegate(["change","click","keydown"]);var $$_import_editor$1=reactive_import(()=>editor),root_4$i=from_html('<img class="icon-preview svelte-asgatj"/>'),root_5$k=from_html('<div class="icon-placeholder svelte-asgatj">📦</div>'),root_7$b=from_html("<option> </option>"),root_8$9=from_html('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),root_9$4=from_html("<option> </option>"),root_6$c=from_html('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),root_3$o=from_html('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),root_2$k=from_html('<div class="items-list svelte-asgatj"></div>'),root_10$4=from_html('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),root_1$t=from_html('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),root$e=from_html('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function ItemsManager(r,e){push(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function i(){if(!$$_import_editor$1().data)return;$$_import_editor$1().data.items||$$_import_editor$1($$_import_editor$1().data.items=[]);const x={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};$$_import_editor$1().data.items.push(x),$$_import_editor$1($$_import_editor$1().editingItemIndex=$$_import_editor$1().data.items.length-1)}function n(x){$$_import_editor$1().editingItemIndex===x?$$_import_editor$1($$_import_editor$1().editingItemIndex=null):$$_import_editor$1($$_import_editor$1().editingItemIndex=x)}function o(x){confirm("Удалить предмет?")&&$$_import_editor$1().data?.items&&($$_import_editor$1().data.items.splice(x,1),$$_import_editor$1($$_import_editor$1().editingItemIndex=null))}function u(x){if(!$$_import_editor$1().data?.items)return;const D=$$_import_editor$1().data.items[x],P={...D,id:`${D.id}_copy_${Date.now()}`,name:`${D.name} (копия)`};$$_import_editor$1().data.items.splice(x+1,0,P),$$_import_editor$1($$_import_editor$1().editingItemIndex=x+1)}function f(x){return t.find(D=>D.value===x)?.label||x}init();var p=root$e(),v=child(p);v.__click=()=>$$_import_editor$1($$_import_editor$1().showItems=!$$_import_editor$1().showItems);var g=child(v),m=sibling(child(g)),$=sibling(g,2),_=child($),E=sibling(v,2);{var T=x=>{var D=root_1$t(),P=child(D);{var R=I=>{var k=root_2$k();each(k,7,()=>$$_import_editor$1().data.items,U=>U.id,(U,W,B)=>{var L=root_3$o();let G;var re=child(L);re.__click=()=>n(get$2(B));var ue=child(re),z=child(ue),q=child(z);{var N=pe=>{var ge=root_4$i();template_effect(()=>{set_attribute(ge,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(W).icon}`),set_attribute(ge,"alt",get$2(W).name)}),append(pe,ge)},M=pe=>{var ge=root_5$k();append(pe,ge)};if_block(q,pe=>{get$2(W).icon?pe(N):pe(M,!1)})}var O=sibling(z,2),K=child(O),oe=child(K),de=sibling(K,2),ae=child(de),_e=child(ae),me=sibling(ae,2);let be;var le=child(me),Q=sibling(ue,2),ne=child(Q),Y=sibling(re,2),Z=child(Y);Z.__click=()=>u(get$2(B));var ce=sibling(Z,2);ce.__click=()=>n(get$2(B));var te=sibling(ce,2);te.__click=()=>o(get$2(B));var he=sibling(Y,2);{var ie=pe=>{var ge=root_6$c(),Ie=child(ge),ke=child(Ie),Re=child(ke),Ce=sibling(Re,2),Be=sibling(ke,2),De=child(Be),w=sibling(De,2),c=sibling(Be,2),h=child(c),S=sibling(h,2),j=sibling(c,2),X=child(j),ve=sibling(X,2),Ae=child(ve),je=sibling(Ae,2);je.__change=Ue=>{const it=Ue.target;get$2(W).icon=it.value,invalidate_inner_signals(()=>$$_import_editor$1())};var Se=child(je);Se.value=Se.__value="";var Fe=sibling(Se);each(Fe,1,()=>$$_import_editor$1().storedFiles.filter(Ue=>Ue.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),index$1,(Ue,it)=>{var nt=root_7$b(),Je=child(nt),xe={};template_effect(()=>{set_text(Je,get$2(it).name),xe!==(xe=get$2(it).name)&&(nt.value=(nt.__value=get$2(it).name)??"")}),append(Ue,nt)});var We=sibling(je,2),et=sibling(child(We));et.__change=function(...Ue){resourceActions.uploadNewFile?.apply(this,Ue)};var Ze=sibling(ve,2);{var ct=Ue=>{var it=root_8$9(),nt=child(it),Je=sibling(nt,2),xe=child(Je);template_effect(()=>{set_attribute(nt,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${$$_import_editor$1().selectedBucket}/${get$2(W).icon}`),set_text(xe,get$2(W).icon)}),append(Ue,it)};if_block(Ze,Ue=>{get$2(W).icon&&Ue(ct)})}var lt=sibling(j,2),at=child(lt),qe=sibling(at,2);template_effect(()=>{get$2(W),invalidate_inner_signals(()=>{get$2(B)})}),each(qe,5,()=>t,index$1,(Ue,it)=>{var nt=root_9$4(),Je=child(nt),xe={};template_effect(()=>{set_text(Je,get$2(it).label),xe!==(xe=get$2(it).value)&&(nt.value=(nt.__value=get$2(it).value)??"")}),append(Ue,nt)}),template_effect(()=>{set_attribute(Re,"for",`item-id-${get$2(B)??""}`),set_attribute(Ce,"id",`item-id-${get$2(B)??""}`),set_attribute(De,"for",`item-name-${get$2(B)??""}`),set_attribute(w,"id",`item-name-${get$2(B)??""}`),set_attribute(h,"for",`item-desc-${get$2(B)??""}`),set_attribute(S,"id",`item-desc-${get$2(B)??""}`),set_attribute(X,"for",`item-icon-${get$2(B)??""}`),set_attribute(Ae,"id",`item-icon-${get$2(B)??""}`),set_attribute(at,"for",`item-type-${get$2(B)??""}`),set_attribute(qe,"id",`item-type-${get$2(B)??""}`)}),bind_value(Ce,()=>get$2(W).id,Ue=>(get$2(W).id=Ue,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(w,()=>get$2(W).name,Ue=>(get$2(W).name=Ue,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(S,()=>get$2(W).description,Ue=>(get$2(W).description=Ue,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_value(Ae,()=>get$2(W).icon,Ue=>(get$2(W).icon=Ue,invalidate_inner_signals(()=>$$_import_editor$1()))),bind_select_value(qe,()=>get$2(W).type,Ue=>(get$2(W).type=Ue,invalidate_inner_signals(()=>$$_import_editor$1()))),append(pe,ge)};if_block(he,pe=>{$$_import_editor$1().editingItemIndex===get$2(B)&&pe(ie)})}template_effect((pe,ge,Ie)=>{G=set_class(L,1,"item-row svelte-asgatj",null,G,pe),set_attribute(re,"aria-label",`Редактировать предмет ${get$2(W).name??""}`),set_text(oe,get$2(W).name),set_text(_e,get$2(W).id),be=set_class(me,1,"item-type-badge svelte-asgatj",null,be,ge),set_text(le,Ie),set_text(ne,`${get$2(W).description??""} || `)},[()=>({editing:$$_import_editor$1().editingItemIndex===get$2(B)}),()=>({tool:get$2(W).type==="tool",key:get$2(W).type==="key",consumable:get$2(W).type==="consumable",quest:get$2(W).type==="quest",misc:get$2(W).type==="misc"}),()=>f(get$2(W).type)]),append(U,L)}),append(I,k)},F=I=>{var k=root_10$4();append(I,k)};if_block(P,I=>{$$_import_editor$1().data?.items?.length?I(R):I(F,!1)})}var V=sibling(P,2);V.__click=i,append(x,D)};if_block(E,x=>{$$_import_editor$1().showItems&&x(T)})}template_effect(()=>{set_attribute(v,"title",$$_import_editor$1().showItems?"Скрыть предметы":"Показать предметы"),set_attribute(v,"aria-expanded",$$_import_editor$1().showItems),set_text(m,` Предметы (${($$_import_editor$1().data?.items?.length||0)??""})`),set_text(_,$$_import_editor$1().showItems?"▼":"▶")}),append(r,p),pop()}delegate(["click","change"]);delegate(["click"]);const authStateObj=proxy({user:null,session:null,profile:null,loading:!0,initialized:!1}),user=user_derived(()=>authStateObj.user),session=user_derived(()=>authStateObj.session),profile=user_derived(()=>authStateObj.profile),isAuthenticated=user_derived(()=>get$2(session)!==null&&get$2(user)!==null),isAuthor=user_derived(()=>get$2(profile)?.is_author??!1),isAdmin=user_derived(()=>get$2(profile)?.is_admin??!1);async function initAuth(){try{authStateObj.loading=!0;const{data:{session:r}}=await supabase.auth.getSession();authStateObj.session=r,authStateObj.user=r?.user??null,r?.user&&await loadProfile(r.user.id),supabase.auth.onAuthStateChange(async(e,t)=>{console.log("[Auth] State change:",e,t?.user?.email),authStateObj.session=t,authStateObj.user=t?.user??null,t?.user?await loadProfile(t.user.id):authStateObj.profile=null})}catch(r){console.error("[Auth] Init error:",r)}finally{authStateObj.loading=!1,authStateObj.initialized=!0}}async function loadProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").select("*").eq("user_id",r).single();if(t){t.code==="PGRST116"?(console.log("[Auth] Profile not found, creating..."),await createProfile(r)):console.error("[Auth] Error loading profile:",t);return}authStateObj.profile=e,console.log("[Auth] Profile loaded:",e)}catch(e){console.error("[Auth] Error in loadProfile:",e)}}async function createProfile(r){try{const{data:e,error:t}=await supabase.from("profiles").insert([{user_id:r,is_author:!1,is_admin:!1}]).select().single();if(t){console.error("[Auth] Error creating profile:",t);return}authStateObj.profile=e}catch(e){console.error("[Auth] Error in createProfile:",e)}}async function signIn(r,e){if(!r||!r.trim())return{success:!1,error:"Email не может быть пустым"};if(!e||!e.trim())return{success:!1,error:"Пароль не может быть пустым"};authStateObj.loading=!0;try{console.log("[Auth] Attempting sign in for:",r);const{data:t,error:i}=await supabase.auth.signInWithPassword({email:r.trim().toLowerCase(),password:e.trim()});return i?(console.error("[Auth] Sign in error:",i),i.status===400||i.status===422?{success:!1,error:"Неверный email или пароль"}:i.message?.includes("Email not confirmed")?{success:!1,error:"Email не подтвержден. Проверьте почту."}:{success:!1,error:i.message}):(console.log("[Auth] Sign in successful:",t.user?.email),authStateObj.session=t.session,authStateObj.user=t.user,t.user&&await loadProfile(t.user.id),{success:!0})}catch(t){return console.error("[Auth] Sign in exception:",t),{success:!1,error:"Произошла ошибка при входе"}}finally{authStateObj.loading=!1}}async function signOut(){authStateObj.loading=!0;try{const{error:r}=await supabase.auth.signOut();r&&console.error("[Auth] Error signing out:",r),authStateObj.user=null,authStateObj.session=null,authStateObj.profile=null,console.log("[Auth] Signed out successfully")}finally{authStateObj.loading=!1}}async function signUp(r,e,t){authStateObj.loading=!0;try{const{data:i,error:n}=await supabase.auth.signUp({email:r,password:e,options:{data:{username:t||r.split("@")[0]},emailRedirectTo:`${window.location.origin}/auth/callback`}});return n?n.status===429||n.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:n.message}:{success:!0,needsEmailConfirmation:i.user?.identities?.length===0||i.user?.email_confirmed_at===null}}catch(i){return{success:!1,error:i.message}}finally{authStateObj.loading=!1}}async function resetPassword(r){try{const e=`${window.location.origin}/reset-password`;console.log("[Auth] Sending reset email to:",r);const{data:t,error:i}=await supabase.auth.resetPasswordForEmail(r,{redirectTo:e});return i?(console.error("[Auth] Reset password error:",i),i.status===429||i.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:i.message}):(console.log("[Auth] Reset email sent:",t),{success:!0})}catch(e){return console.error("[Auth] Reset password exception:",e),{success:!1,error:e.message}}}const authState={get user(){return authStateObj.user},get session(){return authStateObj.session},get profile(){return authStateObj.profile},get loading(){return authStateObj.loading},get initialized(){return authStateObj.initialized}},authDerivedState={get isAuthenticated(){return get$2(isAuthenticated)},get isAuthor(){return get$2(isAuthor)},get isAdmin(){return get$2(isAdmin)}},stories=proxy({stories:[],loading:!1,initialized:!1}),FALLBACK_STORIES=[{id:"dracula",created_at:new Date().toISOString(),title:"Дракула",author_id:null,json_url:"dracula_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"dracula"},{id:"zombie",created_at:new Date().toISOString(),title:"Выживание",author_id:null,json_url:"zombie_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"zombie"},{id:"fairy_tale",created_at:new Date().toISOString(),title:"Сказка",author_id:null,json_url:"fairy_tale_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"fairy_tale"},{id:"minigames",created_at:new Date().toISOString(),title:"Мини-игры",author_id:null,json_url:"minigames_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"minigames"}];function getPublicStories(){if(console.log("[getPublicStories] initialized:",stories.initialized,"stories.length:",stories.stories.length),!stories.initialized||stories.stories.length===0)return console.log("[getPublicStories] Возвращаем fallback, count:",FALLBACK_STORIES.length),FALLBACK_STORIES;const r=stories.stories.filter(e=>e.is_public);return console.log("[getPublicStories] Публичных историй:",r.length),r}function getPlayerStories(){const r=authState.user?.id;if(!r){const t=getPublicStories(),i=t.length>0?t:FALLBACK_STORIES;return console.log("[getPlayerStories] Гость, результат:",i.length),i}const e=stories.stories.filter(t=>t.is_public||t.allowed_players&&t.allowed_players.includes(r));return console.log("[getPlayerStories] Авторизован, результат:",e.length),e}function getStoryById(r){const e=stories.stories.find(t=>t.id===r);return e||FALLBACK_STORIES.find(t=>t.id===r)}function getStoryByBucket(r){const e=stories.stories.find(t=>t.bucket===r);return e||FALLBACK_STORIES.find(t=>t.bucket===r)}function getAuthorStories(){const r=authState.user?.id;return r&&authState.profile?.is_admin?stories.stories:stories.stories.filter(e=>e.author_id===r)}async function loadStories(){console.log("[storiesStore] loadStories начало"),stories.loading=!0;try{if(console.log("[storiesStore] Загрузка историй из таблицы..."),!navigator.onLine){console.log("[storiesStore] Нет сети - используем fallback"),stories.stories=[],stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories завершено (офлайн)");return}const{data:r,error:e}=await supabase.from("stories").select("*").order("created_at",{ascending:!1});e?(console.error("[storiesStore] Error loading stories:",e),console.log("[storiesStore] Используем fallback истории"),stories.stories=[]):(console.log("[storiesStore] Загружено историй из БД:",r?.length||0),stories.stories=r||[])}catch(r){console.error("[storiesStore] Exception loading stories:",r),console.log("[storiesStore] Используем fallback истории"),stories.stories=[]}stories.loading=!1,stories.initialized=!0,console.log("[storiesStore] loadStories завершено. Историй в сторе:",stories.stories.length)}async function createStory(r,e="stories"){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const t=`${r.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}.json`,n=JSON.stringify({meta:{version:"3.1",title:r},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало истории...",options:[]}],items:[],miniGames:[]},null,2),u=new TextEncoder().encode(n),{error:f}=await supabase.storage.from(e).upload(t,u,{contentType:"application/json"});if(f)return{success:!1,error:f.message};const p=t,{data:v,error:g}=await supabase.from("stories").insert({title:r,author_id:authState.user.id,json_url:p,bucket:e,is_public:!1,allowed_players:[]}).select().single();return g?{success:!1,error:g.message}:(await loadStories(),{success:!0,story:v})}catch(t){return{success:!1,error:t.message}}}async function updateStory(r,e){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const{error:t}=await supabase.from("stories").update(e).eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(t){return{success:!1,error:t.message}}}async function deleteStory(r){if(!authState.user)return{success:!1,error:"Необходимо войти"};try{const e=stories.stories.find(i=>i.id===r);if(!e)return{success:!1,error:"История не найдена"};if(e.json_url){const[i,...n]=e.json_url.split("/"),o=n.join("/");await supabase.storage.from(i).remove([o])}const{error:t}=await supabase.from("stories").delete().eq("id",r).eq("author_id",authState.user.id);return t?{success:!1,error:t.message}:(await loadStories(),{success:!0})}catch(e){return{success:!1,error:e.message}}}async function loadStoryJson(r){try{const e=r.bucket||"stories",i=r.json_url.split("/").pop()||"story.json";console.log(`[storiesStore] Загрузка истории "${r.title}" из bucket: ${e}, файл: ${i}`);const{data:n,error:o}=await supabase.storage.from(e).download(i);if(o){console.error("[storiesStore] Error downloading story:",o.message);const p=`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${e}/${i}`;console.log("[storiesStore] Пробуем fallback URL:",p);try{const v=await fetch(p);if(!v.ok)throw new Error(`HTTP ${v.status}`);const g=await v.json();return console.log("[storiesStore] Загружено через fallback URL"),g}catch(v){console.error("[storiesStore] Fallback also failed:",v);const g=`/stories/${i}`;console.log("[storiesStore] Пробуем локальный URL:",g);try{const m=await fetch(g);if(m.ok)return await m.json()}catch{console.error("[storiesStore] Локальный fallback тоже не работает")}return null}}const u=await n.text(),f=JSON.parse(u);return console.log("[storiesStore] История загружена успешно"),f}catch(e){return console.error("[storiesStore] Error loading story JSON:",e),null}}const storiesState=stories;class GameState{#s=state(proxy({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return get$2(this.#s)}set player(e){set(this.#s,e,!0)}#i=state(null);get storyData(){return get$2(this.#i)}set storyData(e){set(this.#i,e,!0)}#e=state("0");get currentDialogueId(){return get$2(this.#e)}set currentDialogueId(e){set(this.#e,e,!0)}#a=state(!0);get isLoading(){return get$2(this.#a)}set isLoading(e){set(this.#a,e,!0)}#o=state("");get error(){return get$2(this.#o)}set error(e){set(this.#o,e,!0)}#t=state(null);get selectedStory(){return get$2(this.#t)}set selectedStory(e){set(this.#t,e,!0)}#n=state(null);get selectedStoryData(){return get$2(this.#n)}set selectedStoryData(e){set(this.#n,e,!0)}#r=state(null);get urlStoryId(){return get$2(this.#r)}set urlStoryId(e){set(this.#r,e,!0)}get availableStories(){return getPlayerStories()}async initStories(){console.log("[GameState] initStories начало");try{const t=new URLSearchParams(window.location.search).get("story");t&&(this.urlStoryId=t,console.log("[GameState] URL параметр story:",t))}catch{console.log("[GameState] Нет window.location (SSR?)")}storiesState.initialized?console.log("[GameState] Истории уже загружены"):(console.log("[GameState] Загружаем истории..."),await loadStories(),console.log("[GameState] Истории загружены, initialized:",storiesState.initialized)),this.urlStoryId&&(console.log("[GameState] Выбираем историю:",this.urlStoryId),this.selectStoryById(this.urlStoryId)),console.log("[GameState] initStories завершено")}selectStoryById(e){console.log("[GameState] selectStoryById:",e),console.log("[GameState] storiesState.stories:",storiesState.stories?.length||0),console.log("[GameState] storiesState.initialized:",storiesState.initialized);let t=storiesState.stories?.find(i=>i?.id===e);if(console.log("[GameState] Найдена в БД:",t?.title),!t){const n=[{id:"dracula",title:"Дракула",bucket:"dracula",json_url:"dracula_story.json"},{id:"zombie",title:"Выживание",bucket:"zombie",json_url:"zombie_story.json"},{id:"fairy_tale",title:"Сказка",bucket:"fairy_tale",json_url:"fairy_tale_story.json"},{id:"minigames",title:"Мини-игры",bucket:"minigames",json_url:"minigames_story.json"}].find(o=>o.id===e);n&&(t={id:n.id,title:n.title,bucket:n.bucket,json_url:n.json_url,created_at:new Date().toISOString(),author_id:null,preview_image_url:null,is_public:!0,allowed_players:[]}),console.log("[GameState] Найдена в fallback:",t?.title)}return t&&t.id?(this.selectedStory=t.id,this.selectedStoryData=t,console.log("[GameState] Выбрана история:",t.title),!0):(console.warn("[GameState] История не найдена:",e),!1)}getStoryById(e){return storiesState.stories.find(t=>t.id===e)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();this.storyData=i,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const i=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${i}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const gameState=new GameState;var rive$1={exports:{}},rive=rive$1.exports,hasRequiredRive;function requireRive(){return hasRequiredRive||(hasRequiredRive=1,(function(r,e){(function(i,n){r.exports=n()})(rive,()=>(()=>{var t=[,((u,f,p)=>{p.r(f),p.d(f,{default:()=>g});var v=(()=>{var m=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function($={}){var _=$,E,T;_.ready=new Promise((s,l)=>{E=s,T=l});function x(){function s(H){const se=y;d=l=0,y=new Map,se.forEach(fe=>{try{fe(H)}catch(ee){console.error(ee)}}),this.pb(),A&&A.Tb()}let l=0,d=0,y=new Map,A=null,C=null;this.requestAnimationFrame=function(H){l||(l=requestAnimationFrame(s.bind(this)));const se=++d;return y.set(se,H),se},this.cancelAnimationFrame=function(H){y.delete(H),l&&y.size==0&&(cancelAnimationFrame(l),l=0)},this.Rb=function(H){C&&(document.body.remove(C),C=null),H||(C=document.createElement("div"),C.style.backgroundColor="black",C.style.position="fixed",C.style.right=0,C.style.top=0,C.style.color="white",C.style.padding="4px",C.innerHTML="RIVE FPS",H=function(se){C.innerHTML="RIVE FPS "+se.toFixed(1)},document.body.appendChild(C)),A=new function(){let se=0,fe=0;this.Tb=function(){var ee=performance.now();fe?(++se,ee-=fe,1e3<ee&&(H(1e3*se/ee),se=fe=0)):(fe=ee,se=0)}}},this.Ob=function(){C&&(document.body.remove(C),C=null),A=null},this.pb=function(){}}function D(s){console.assert(!0);const l=new Map;let d=-1/0;this.push=function(y){return y=y+((1<<s)-1)>>s,l.has(y)&&clearTimeout(l.get(y)),l.set(y,setTimeout(function(){l.delete(y),l.length==0?d=-1/0:y==d&&(d=Math.max(...l.keys()),console.assert(d<y))},1e3)),d=Math.max(y,d),d<<s}}const P=_.onRuntimeInitialized;_.onRuntimeInitialized=function(){P&&P();let s=_.decodeAudio;_.decodeAudio=function(A,C){A=s(A),C(A)};let l=_.decodeFont;_.decodeFont=function(A,C){A=l(A),C(A)};const d=_.FileAssetLoader;_.ptrToAsset=A=>{let C=_.ptrToFileAsset(A);return C.isImage?_.ptrToImageAsset(A):C.isFont?_.ptrToFontAsset(A):C.isAudio?_.ptrToAudioAsset(A):C},_.CustomFileAssetLoader=d.extend("CustomFileAssetLoader",{__construct:function({loadContents:A}){this.__parent.__construct.call(this),this.Gb=A},loadContents:function(A,C){return A=_.ptrToAsset(A),this.Gb(A,C)}}),_.CDNFileAssetLoader=d.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(A){let C=_.ptrToAsset(A);return A=C.cdnUuid,A===""?!1:((function(H,se){var fe=new XMLHttpRequest;fe.responseType="arraybuffer",fe.onreadystatechange=function(){fe.readyState==4&&fe.status==200&&se(fe)},fe.open("GET",H,!0),fe.send(null)})(C.cdnBaseUrl+"/"+A,H=>{C.decode(new Uint8Array(H.response))}),!0)}}),_.FallbackFileAssetLoader=d.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(A){this.lb.push(A)},loadContents:function(A,C){for(let H of this.lb)if(H.loadContents(A,C))return!0;return!1}});let y=_.computeAlignment;_.computeAlignment=function(A,C,H,se,fe=1){return y.call(this,A,C,H,se,fe)}};const R="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),F=new function(){function s(){if(!l){let Ve=function(ze,Pe,st){if(Pe=we.createShader(Pe),we.shaderSource(Pe,st),we.compileShader(Pe),st=we.getShaderInfoLog(Pe),0<(st||"").length)throw st;we.attachShader(ze,Pe)};var J=document.createElement("canvas"),$e={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let we;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(we=J.getContext("webgl",$e),d=1,!we)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(we=J.getContext("webgl2",$e))d=2;else if(we=J.getContext("webgl",$e))d=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(we=new Proxy(we,{get(ze,Pe){if(ze.isContextLost()){if(fe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Pe),fe=!0),typeof ze[Pe]=="function")return function(){}}else return typeof ze[Pe]=="function"?function(...st){return ze[Pe].apply(ze,st)}:ze[Pe]},set(ze,Pe,st){if(ze.isContextLost())fe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Pe),fe=!0);else return ze[Pe]=st,!0}}),y=Math.min(we.getParameter(we.MAX_RENDERBUFFER_SIZE),we.getParameter(we.MAX_TEXTURE_SIZE)),J=we.createProgram(),Ve(J,we.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ve(J,we.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),we.bindAttribLocation(J,0,"vertex"),we.bindAttribLocation(J,1,"uv"),we.linkProgram(J),$e=we.getProgramInfoLog(J),0<($e||"").trim().length)throw $e;A=we.getUniformLocation(J,"mat"),C=we.getUniformLocation(J,"translate"),we.useProgram(J),we.bindBuffer(we.ARRAY_BUFFER,we.createBuffer()),we.enableVertexAttribArray(0),we.enableVertexAttribArray(1),we.bindBuffer(we.ELEMENT_ARRAY_BUFFER,we.createBuffer()),we.uniform1i(we.getUniformLocation(J,"image"),0),we.pixelStorei(we.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),l=we}return!0}let l=null,d=0,y=0,A=null,C=null,H=0,se=0,fe=!1;s(),this.hc=function(){return s(),y},this.Mb=function(J){l.deleteTexture&&l.deleteTexture(J)},this.Lb=function(J){if(!s())return null;const $e=l.createTexture();return $e?(l.bindTexture(l.TEXTURE_2D,$e),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,J),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),d==2?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.generateMipmap(l.TEXTURE_2D)):l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),$e):null};const ee=new D(8),Ee=new D(8),Te=new D(10),Me=new D(10);this.Qb=function(J,$e,we,Ve,ze){if(s()){var Pe=ee.push(J),st=Ee.push($e);if(l.canvas){(l.canvas.width!=Pe||l.canvas.height!=st)&&(l.canvas.width=Pe,l.canvas.height=st),l.viewport(0,st-$e,J,$e),l.disable(l.SCISSOR_TEST),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.enable(l.SCISSOR_TEST),we.sort((Xe,kt)=>kt.xb-Xe.xb),Pe=Te.push(Ve),H!=Pe&&(l.bufferData(l.ARRAY_BUFFER,8*Pe,l.DYNAMIC_DRAW),H=Pe),Pe=0;for(var ht of we)l.bufferSubData(l.ARRAY_BUFFER,Pe,ht.Ua),Pe+=4*ht.Ua.length;console.assert(Pe==4*Ve);for(var St of we)l.bufferSubData(l.ARRAY_BUFFER,Pe,St.Db),Pe+=4*St.Db.length;console.assert(Pe==8*Ve),Pe=Me.push(ze),se!=Pe&&(l.bufferData(l.ELEMENT_ARRAY_BUFFER,2*Pe,l.DYNAMIC_DRAW),se=Pe),ht=0;for(var Dt of we)l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,ht,Dt.indices),ht+=2*Dt.indices.length;console.assert(ht==2*ze),Dt=0,St=!0,Pe=ht=0;for(const Xe of we){Xe.image.Ka!=Dt&&(l.bindTexture(l.TEXTURE_2D,Xe.image.Ja||null),Dt=Xe.image.Ka),Xe.mc?(l.scissor(Xe.Za,st-Xe.$a-Xe.kb,Xe.Ac,Xe.kb),St=!0):St&&(l.scissor(0,st-$e,J,$e),St=!1),we=2/J;const kt=-2/$e;l.uniform4f(A,Xe.ha[0]*we*Xe.Ba,Xe.ha[1]*kt*Xe.Ca,Xe.ha[2]*we*Xe.Ba,Xe.ha[3]*kt*Xe.Ca),l.uniform2f(C,Xe.ha[4]*we*Xe.Ba+we*(Xe.Za-Xe.ic*Xe.Ba)-1,Xe.ha[5]*kt*Xe.Ca+kt*(Xe.$a-Xe.jc*Xe.Ca)+1),l.vertexAttribPointer(0,2,l.FLOAT,!1,0,Pe),l.vertexAttribPointer(1,2,l.FLOAT,!1,0,Pe+4*Ve),l.drawElements(l.TRIANGLES,Xe.indices.length,l.UNSIGNED_SHORT,ht),Pe+=4*Xe.Ua.length,ht+=2*Xe.indices.length}console.assert(Pe==4*Ve),console.assert(ht==2*ze)}}},this.canvas=function(){return s()&&l.canvas}},V=_.onRuntimeInitialized;_.onRuntimeInitialized=function(){function s(ye){switch(ye){case ee.srcOver:return"source-over";case ee.screen:return"screen";case ee.overlay:return"overlay";case ee.darken:return"darken";case ee.lighten:return"lighten";case ee.colorDodge:return"color-dodge";case ee.colorBurn:return"color-burn";case ee.hardLight:return"hard-light";case ee.softLight:return"soft-light";case ee.difference:return"difference";case ee.exclusion:return"exclusion";case ee.multiply:return"multiply";case ee.hue:return"hue";case ee.saturation:return"saturation";case ee.color:return"color";case ee.luminosity:return"luminosity"}}function l(ye){return"rgba("+((16711680&ye)>>>16)+","+((65280&ye)>>>8)+","+((255&ye)>>>0)+","+((4278190080&ye)>>>24)/255+")"}function d(){0<st.length&&(F.Qb(Pe.drawWidth(),Pe.drawHeight(),st,ht,St),st=[],St=ht=0,Pe.reset(512,512));for(const ye of ze){for(const Oe of ye.H)Oe();ye.H=[]}ze.clear()}V&&V();var y=_.RenderPaintStyle;const A=_.RenderPath,C=_.RenderPaint,H=_.Renderer,se=_.StrokeCap,fe=_.StrokeJoin,ee=_.BlendMode,Ee=y.fill,Te=y.stroke,Me=_.FillRule.evenOdd;let J=1;var $e=_.RenderImage.extend("CanvasRenderImage",{__construct:function({la:ye,xa:Oe}={}){this.__parent.__construct.call(this),this.Ka=J,J=J+1&2147483647||1,this.la=ye,this.xa=Oe},__destruct:function(){this.Ja&&(F.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(ye){var Oe=this;Oe.xa&&Oe.xa(Oe);var Ke=new Image;Oe.Xa=URL.createObjectURL(new Blob([ye],{type:"image/png"})),Ke.onload=function(){Oe.Fb=Ke,Oe.Ja=F.Lb(Ke),Oe.size(Ke.width,Ke.height),Oe.la&&Oe.la(Oe)},Ke.src=Oe.Xa}}),we=A.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(ye,Oe,Ke,Qe,He,Ye,tt){var rt=this.T,$t=rt.addPath;ye=ye.T;const dt=new DOMMatrix;dt.a=Oe,dt.b=Ke,dt.c=Qe,dt.d=He,dt.e=Ye,dt.f=tt,$t.call(rt,ye,dt)},fillRule:function(ye){this.Wa=ye},moveTo:function(ye,Oe){this.T.moveTo(ye,Oe)},lineTo:function(ye,Oe){this.T.lineTo(ye,Oe)},cubicTo:function(ye,Oe,Ke,Qe,He,Ye){this.T.bezierCurveTo(ye,Oe,Ke,Qe,He,Ye)},close:function(){this.T.closePath()}}),Ve=C.extend("CanvasRenderPaint",{color:function(ye){this.Ya=l(ye)},thickness:function(ye){this.Ib=ye},join:function(ye){switch(ye){case fe.miter:this.Ia="miter";break;case fe.round:this.Ia="round";break;case fe.bevel:this.Ia="bevel"}},cap:function(ye){switch(ye){case se.butt:this.Ha="butt";break;case se.round:this.Ha="round";break;case se.square:this.Ha="square"}},style:function(ye){this.Hb=ye},blendMode:function(ye){this.Eb=s(ye)},clearGradient:function(){this.ja=null},linearGradient:function(ye,Oe,Ke,Qe){this.ja={zb:ye,Ab:Oe,cb:Ke,eb:Qe,Ra:[]}},radialGradient:function(ye,Oe,Ke,Qe){this.ja={zb:ye,Ab:Oe,cb:Ke,eb:Qe,Ra:[],ec:!0}},addStop:function(ye,Oe){this.ja.Ra.push({color:ye,stop:Oe})},completeGradient:function(){},draw:function(ye,Oe,Ke){let Qe=this.Hb;var He=this.Ya,Ye=this.ja;if(ye.globalCompositeOperation=this.Eb,Ye!=null){He=Ye.zb;var tt=Ye.Ab;const $t=Ye.cb;var rt=Ye.eb;const dt=Ye.Ra;Ye.ec?(Ye=$t-He,rt-=tt,He=ye.createRadialGradient(He,tt,0,He,tt,Math.sqrt(Ye*Ye+rt*rt))):He=ye.createLinearGradient(He,tt,$t,rt);for(let pt=0,ft=dt.length;pt<ft;pt++)tt=dt[pt],He.addColorStop(tt.stop,l(tt.color));this.Ya=He,this.ja=null}switch(Qe){case Te:ye.strokeStyle=He,ye.lineWidth=this.Ib,ye.lineCap=this.Ha,ye.lineJoin=this.Ia,ye.stroke(Oe);break;case Ee:ye.fillStyle=He,ye.fill(Oe,Ke)}}});const ze=new Set;let Pe=null,st=[],ht=0,St=0;var Dt=_.CanvasRenderer=H.extend("Renderer",{__construct:function(ye){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=ye.getContext("2d"),this.Va=ye,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const ye=this.S.length-6;if(6>ye)throw"restore() called without matching save().";this.S.splice(ye),this.H.push(this.C.restore.bind(this.C))},transform:function(ye,Oe,Ke,Qe,He,Ye){const tt=this.S,rt=tt.length-6;tt.splice(rt,6,tt[rt]*ye+tt[rt+2]*Oe,tt[rt+1]*ye+tt[rt+3]*Oe,tt[rt]*Ke+tt[rt+2]*Qe,tt[rt+1]*Ke+tt[rt+3]*Qe,tt[rt]*He+tt[rt+2]*Ye+tt[rt+4],tt[rt+1]*He+tt[rt+3]*Ye+tt[rt+5]),this.H.push(this.C.transform.bind(this.C,ye,Oe,Ke,Qe,He,Ye))},rotate:function(ye){const Oe=Math.sin(ye);ye=Math.cos(ye),this.transform(ye,Oe,-Oe,ye,0,0)},_drawPath:function(ye,Oe){this.H.push(Oe.draw.bind(Oe,this.C,ye.T,ye.Wa===Me?"evenodd":"nonzero"))},_drawRiveImage:function(ye,Oe,Ke,Qe){var He=ye.Fb;if(He){var Ye=this.C,tt=s(Ke);this.H.push(function(){Ye.globalCompositeOperation=tt,Ye.globalAlpha=Qe,Ye.drawImage(He,0,0),Ye.globalAlpha=1})}},_getMatrix:function(ye){const Oe=this.S,Ke=Oe.length-6;for(let Qe=0;6>Qe;++Qe)ye[Qe]=Oe[Ke+Qe]},_drawImageMesh:function(ye,Oe,Ke,Qe,He,Ye,tt,rt,$t,dt,pt){Oe=this.C.canvas.width;var ft=this.C.canvas.height;const Ei=dt-rt,Si=pt-$t;rt=Math.max(rt,0),$t=Math.max($t,0),dt=Math.min(dt,Oe),pt=Math.min(pt,ft);const Zt=dt-rt,er=pt-$t;if(console.assert(Zt<=Math.min(Ei,Oe)),console.assert(er<=Math.min(Si,ft)),!(0>=Zt||0>=er)){dt=Zt<Ei||er<Si,Oe=pt=1;var Nt=Math.ceil(Zt*pt),Ft=Math.ceil(er*Oe);ft=F.hc(),Nt>ft&&(pt*=ft/Nt,Nt=ft),Ft>ft&&(Oe*=ft/Ft,Ft=ft),Pe||(Pe=new _.DynamicRectanizer(ft),Pe.reset(512,512)),ft=Pe.addRect(Nt,Ft),0>ft&&(d(),ze.add(this),ft=Pe.addRect(Nt,Ft),console.assert(0<=ft));var ki=ft&65535,Ai=ft>>16;st.push({ha:this.S.slice(this.S.length-6),image:ye,Za:ki,$a:Ai,ic:rt,jc:$t,Ac:Nt,kb:Ft,Ba:pt,Ca:Oe,Ua:new Float32Array(He),Db:new Float32Array(Ye),indices:new Uint16Array(tt),mc:dt,xb:ye.Ka<<1|(dt?1:0)}),ht+=He.length,St+=tt.length;var qt=this.C,Zi=s(Ke);this.H.push(function(){qt.save(),qt.resetTransform(),qt.globalCompositeOperation=Zi,qt.globalAlpha=Qe;const Ii=F.canvas();Ii&&qt.drawImage(Ii,ki,Ai,Nt,Ft,rt,$t,Zt,er),qt.restore()})}},_clipPath:function(ye){this.H.push(this.C.clip.bind(this.C,ye.T,ye.Wa===Me?"evenodd":"nonzero"))},clear:function(){ze.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(ye,Oe){this.transform(1,0,0,1,ye,Oe)}});_.makeRenderer=function(ye){const Oe=new Dt(ye),Ke=Oe.C;return new Proxy(Oe,{get(Qe,He){if(typeof Qe[He]=="function")return function(...Ye){return Qe[He].apply(Qe,Ye)};if(typeof Ke[He]=="function"){if(-1<R.indexOf(He))throw Error("RiveException: Method call to '"+He+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ye){Oe.H.push(Ke[He].bind(Ke,...Ye))}}return Qe[He]},set(Qe,He,Ye){if(He in Ke)return Oe.H.push(()=>{Ke[He]=Ye}),!0}})},_.decodeImage=function(ye,Oe){new $e({la:Oe}).decode(ye)},_.renderFactory={makeRenderPaint:function(){return new Ve},makeRenderPath:function(){return new we},makeRenderImage:function(){let ye=kt;return new $e({xa:()=>{ye.total++},la:()=>{if(ye.loaded++,ye.loaded===ye.total){const Oe=ye.ready;Oe&&(Oe(),ye.ready=null)}}})}};let Xe=_.load,kt=null;_.load=function(ye,Oe,Ke=!0){const Qe=new _.FallbackFileAssetLoader;return Oe!==void 0&&Qe.addLoader(Oe),Ke&&(Oe=new _.CDNFileAssetLoader,Qe.addLoader(Oe)),new Promise(function(He){let Ye=null;kt={total:0,loaded:0,ready:function(){He(Ye)}},Ye=Xe(ye,Qe),kt.total==0&&He(Ye)})};let Qi=_.RendererWrapper.prototype.align;_.RendererWrapper.prototype.align=function(ye,Oe,Ke,Qe,He=1){Qi.call(this,ye,Oe,Ke,Qe,He)},y=new x,_.requestAnimationFrame=y.requestAnimationFrame.bind(y),_.cancelAnimationFrame=y.cancelAnimationFrame.bind(y),_.enableFPSCounter=y.Rb.bind(y),_.disableFPSCounter=y.Ob,y.pb=d,_.resolveAnimationFrame=d,_.cleanup=function(){Pe&&Pe.delete()}};var I=Object.assign({},_),k="./this.program",U=typeof window=="object",W=typeof importScripts=="function",B="",L,G;(U||W)&&(W?B=self.location.href:typeof document<"u"&&document.currentScript&&(B=document.currentScript.src),m&&(B=m),B.indexOf("blob:")!==0?B=B.substr(0,B.replace(/[?#].*/,"").lastIndexOf("/")+1):B="",W&&(G=s=>{var l=new XMLHttpRequest;return l.open("GET",s,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),L=(s,l,d)=>{var y=new XMLHttpRequest;y.open("GET",s,!0),y.responseType="arraybuffer",y.onload=()=>{y.status==200||y.status==0&&y.response?l(y.response):d()},y.onerror=d,y.send(null)});var re=_.print||console.log.bind(console),ue=_.printErr||console.error.bind(console);Object.assign(_,I),I=null,_.thisProgram&&(k=_.thisProgram);var z;_.wasmBinary&&(z=_.wasmBinary),_.noExitRuntime,typeof WebAssembly!="object"&&ie("no native wasm support detected");var q,N,M=!1,O,K,oe,de,ae,_e,me,be;function le(){var s=q.buffer;_.HEAP8=O=new Int8Array(s),_.HEAP16=oe=new Int16Array(s),_.HEAP32=ae=new Int32Array(s),_.HEAPU8=K=new Uint8Array(s),_.HEAPU16=de=new Uint16Array(s),_.HEAPU32=_e=new Uint32Array(s),_.HEAPF32=me=new Float32Array(s),_.HEAPF64=be=new Float64Array(s)}var Q,ne=[],Y=[],Z=[];function ce(){var s=_.preRun.shift();ne.unshift(s)}var te=0,he=null;function ie(s){throw _.onAbort&&_.onAbort(s),s="Aborted("+s+")",ue(s),M=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),T(s),s}function pe(s){return s.startsWith("data:application/octet-stream;base64,")}var ge;if(ge="canvas_advanced.wasm",!pe(ge)){var Ie=ge;ge=_.locateFile?_.locateFile(Ie,B):B+Ie}function ke(s){if(s==ge&&z)return new Uint8Array(z);if(G)return G(s);throw"both async and sync fetching of the wasm failed"}function Re(s){if(!z&&(U||W)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(l=>{if(!l.ok)throw"failed to load wasm binary file at '"+s+"'";return l.arrayBuffer()}).catch(()=>ke(s));if(L)return new Promise((l,d)=>{L(s,y=>l(new Uint8Array(y)),d)})}return Promise.resolve().then(()=>ke(s))}function Ce(s,l,d){return Re(s).then(y=>WebAssembly.instantiate(y,l)).then(y=>y).then(d,y=>{ue("failed to asynchronously prepare wasm: "+y),ie(y)})}function Be(s,l){var d=ge;return z||typeof WebAssembly.instantiateStreaming!="function"||pe(d)||d.startsWith("file://")||typeof fetch!="function"?Ce(d,s,l):fetch(d,{credentials:"same-origin"}).then(y=>WebAssembly.instantiateStreaming(y,s).then(l,function(A){return ue("wasm streaming compile failed: "+A),ue("falling back to ArrayBuffer instantiation"),Ce(d,s,l)}))}var De,w,c={460492:(s,l,d,y,A)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=l,window.h.I.La=d,window.h.ga={},window.h.ga.stopped=y,window.h.ga.yb=A;let C=window.h;C.D=[],C.yc=function(H){for(var se=0;se<C.D.length;++se)if(C.D[se]==null)return C.D[se]=H,se;return C.D.push(H),C.D.length-1},C.Cb=function(H){for(C.D[H]=null;0<C.D.length&&C.D[C.D.length-1]==null;)C.D.pop()},C.Sc=function(H){for(var se=0;se<C.D.length;++se)if(C.D[se]==H)return C.Cb(se)},C.ra=function(H){return C.D[H]},C.Ta=["touchend","click"],C.unlock=function(){for(var H=0;H<C.D.length;++H){var se=C.D[H];se!=null&&se.J!=null&&se.state===C.ga.yb&&se.J.resume().then(()=>{mi(se.qb)},fe=>{console.error("Failed to resume audiocontext",fe)})}C.Ta.map(function(fe){document.removeEventListener(fe,C.unlock,!0)})},C.Ta.map(function(H){document.addEventListener(H,C.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),l=s.sampleRate;return s.close(),l}catch{return 0}},463249:(s,l,d,y,A,C)=>{if(typeof window.h>"u")return-1;var H={},se={};return s==window.h.I.ya&&d!=0&&(se.sampleRate=d),H.J=new(window.AudioContext||window.webkitAudioContext)(se),H.J.suspend(),H.state=window.h.ga.stopped,d=0,s!=window.h.I.ya&&(d=l),H.Z=H.J.createScriptProcessor(y,d,l),H.Z.onaudioprocess=function(fe){if((H.sa==null||H.sa.length==0)&&(H.sa=new Float32Array(me.buffer,A,y*l)),s==window.h.I.capture||s==window.h.I.La){for(var ee=0;ee<l;ee+=1)for(var Ee=fe.inputBuffer.getChannelData(ee),Te=H.sa,Me=0;Me<y;Me+=1)Te[Me*l+ee]=Ee[Me];bi(C,y,A)}if(s==window.h.I.ya||s==window.h.I.La)for(yi(C,y,A),ee=0;ee<fe.outputBuffer.numberOfChannels;++ee)for(Ee=fe.outputBuffer.getChannelData(ee),Te=H.sa,Me=0;Me<y;Me+=1)Ee[Me]=Te[Me*l+ee];else for(ee=0;ee<fe.outputBuffer.numberOfChannels;++ee)fe.outputBuffer.getChannelData(ee).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(fe){H.Da=H.J.createMediaStreamSource(fe),H.Da.connect(H.Z),H.Z.connect(H.J.destination)}).catch(function(fe){console.log("Failed to get user media: "+fe)}),s==window.h.I.ya&&H.Z.connect(H.J.destination),H.qb=C,window.h.yc(H)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},h=s=>{for(;0<s.length;)s.shift()(_)},S=(s,l)=>{for(var d=0,y=s.length-1;0<=y;y--){var A=s[y];A==="."?s.splice(y,1):A===".."?(s.splice(y,1),d++):d&&(s.splice(y,1),d--)}if(l)for(;d;d--)s.unshift("..");return s},j=s=>{var l=s.charAt(0)==="/",d=s.substr(-1)==="/";return(s=S(s.split("/").filter(y=>!!y),!l).join("/"))||l||(s="."),s&&d&&(s+="/"),(l?"/":"")+s},X=s=>{var l=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=l[0],l=l[1],!s&&!l?".":(l&&(l=l.substr(0,l.length-1)),s+l)},ve=s=>{if(s==="/")return"/";s=j(s),s=s.replace(/\/$/,"");var l=s.lastIndexOf("/");return l===-1?s:s.substr(l+1)},Ae=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);ie("initRandomDevice")},je=s=>(je=Ae())(s);function Se(){for(var s="",l=!1,d=arguments.length-1;-1<=d&&!l;d--){if(l=0<=d?arguments[d]:"/",typeof l!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!l)return"";s=l+"/"+s,l=l.charAt(0)==="/"}return s=S(s.split("/").filter(y=>!!y),!l).join("/"),(l?"/":"")+s||"."}var Fe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,We=(s,l,d)=>{var y=l+d;for(d=l;s[d]&&!(d>=y);)++d;if(16<d-l&&s.buffer&&Fe)return Fe.decode(s.subarray(l,d));for(y="";l<d;){var A=s[l++];if(A&128){var C=s[l++]&63;if((A&224)==192)y+=String.fromCharCode((A&31)<<6|C);else{var H=s[l++]&63;A=(A&240)==224?(A&15)<<12|C<<6|H:(A&7)<<18|C<<12|H<<6|s[l++]&63,65536>A?y+=String.fromCharCode(A):(A-=65536,y+=String.fromCharCode(55296|A>>10,56320|A&1023))}}else y+=String.fromCharCode(A)}return y},et=[],Ze=s=>{for(var l=0,d=0;d<s.length;++d){var y=s.charCodeAt(d);127>=y?l++:2047>=y?l+=2:55296<=y&&57343>=y?(l+=4,++d):l+=3}return l},ct=(s,l,d,y)=>{if(!(0<y))return 0;var A=d;y=d+y-1;for(var C=0;C<s.length;++C){var H=s.charCodeAt(C);if(55296<=H&&57343>=H){var se=s.charCodeAt(++C);H=65536+((H&1023)<<10)|se&1023}if(127>=H){if(d>=y)break;l[d++]=H}else{if(2047>=H){if(d+1>=y)break;l[d++]=192|H>>6}else{if(65535>=H){if(d+2>=y)break;l[d++]=224|H>>12}else{if(d+3>=y)break;l[d++]=240|H>>18,l[d++]=128|H>>12&63}l[d++]=128|H>>6&63}l[d++]=128|H&63}}return l[d]=0,d-A};function lt(s,l){var d=Array(Ze(s)+1);return s=ct(s,d,0,d.length),l&&(d.length=s),d}var at=[];function qe(s,l){at[s]={input:[],F:[],V:l},Er(s,Ue)}var Ue={open:function(s){var l=at[s.node.za];if(!l)throw new Le(43);s.s=l,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,l,d,y){if(!s.s||!s.s.V.jb)throw new Le(60);for(var A=0,C=0;C<y;C++){try{var H=s.s.V.jb(s.s)}catch{throw new Le(29)}if(H===void 0&&A===0)throw new Le(6);if(H==null)break;A++,l[d+C]=H}return A&&(s.node.timestamp=Date.now()),A},write:function(s,l,d,y){if(!s.s||!s.s.V.Oa)throw new Le(60);try{for(var A=0;A<y;A++)s.s.V.Oa(s.s,l[d+A])}catch{throw new Le(29)}return y&&(s.node.timestamp=Date.now()),A}},it={jb:function(){e:{if(!et.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}et=lt(s,!0)}s=et.shift()}return s},Oa:function(s,l){l===null||l===10?(re(We(s.F,0)),s.F=[]):l!=0&&s.F.push(l)},qa:function(s){s.F&&0<s.F.length&&(re(We(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},nt={Oa:function(s,l){l===null||l===10?(ue(We(s.F,0)),s.F=[]):l!=0&&s.F.push(l)},qa:function(s){s.F&&0<s.F.length&&(ue(We(s.F,0)),s.F=[])}};function Je(s,l){var d=s.j?s.j.length:0;d>=l||(l=Math.max(l,d*(1048576>d?2:1.125)>>>0),d!=0&&(l=Math.max(l,256)),d=s.j,s.j=new Uint8Array(l),0<s.v&&s.j.set(d.subarray(0,s.v),0))}var xe={O:null,U(){return xe.createNode(null,"/",16895,0)},createNode(s,l,d,y){if((d&61440)===24576||(d&61440)===4096)throw new Le(63);return xe.O||(xe.O={dir:{node:{Y:xe.l.Y,P:xe.l.P,ka:xe.l.ka,va:xe.l.va,vb:xe.l.vb,Bb:xe.l.Bb,wb:xe.l.wb,tb:xe.l.tb,Ea:xe.l.Ea},stream:{ba:xe.m.ba}},file:{node:{Y:xe.l.Y,P:xe.l.P},stream:{ba:xe.m.ba,read:xe.m.read,write:xe.m.write,pa:xe.m.pa,mb:xe.m.mb,ob:xe.m.ob}},link:{node:{Y:xe.l.Y,P:xe.l.P,ma:xe.l.ma},stream:{}},ab:{node:{Y:xe.l.Y,P:xe.l.P},stream:Ci}}),d=Br(s,l,d,y),(d.mode&61440)===16384?(d.l=xe.O.dir.node,d.m=xe.O.dir.stream,d.j={}):(d.mode&61440)===32768?(d.l=xe.O.file.node,d.m=xe.O.file.stream,d.v=0,d.j=null):(d.mode&61440)===40960?(d.l=xe.O.link.node,d.m=xe.O.link.stream):(d.mode&61440)===8192&&(d.l=xe.O.ab.node,d.m=xe.O.ab.stream),d.timestamp=Date.now(),s&&(s.j[l]=d,s.timestamp=d.timestamp),d},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var l={};return l.Jc=(s.mode&61440)===8192?s.id:1,l.Mc=s.id,l.mode=s.mode,l.Oc=1,l.uid=0,l.Lc=0,l.za=s.za,(s.mode&61440)===16384?l.size=4096:(s.mode&61440)===32768?l.size=s.v:(s.mode&61440)===40960?l.size=s.link.length:l.size=0,l.Bc=new Date(s.timestamp),l.Nc=new Date(s.timestamp),l.Ic=new Date(s.timestamp),l.Jb=4096,l.Cc=Math.ceil(l.size/l.Jb),l},P(s,l){if(l.mode!==void 0&&(s.mode=l.mode),l.timestamp!==void 0&&(s.timestamp=l.timestamp),l.size!==void 0&&(l=l.size,s.v!=l))if(l==0)s.j=null,s.v=0;else{var d=s.j;s.j=new Uint8Array(l),d&&s.j.set(d.subarray(0,Math.min(l,s.v))),s.v=l}},ka(){throw $r[44]},va(s,l,d,y){return xe.createNode(s,l,d,y)},vb(s,l,d){if((s.mode&61440)===16384){try{var y=tr(l,d)}catch{}if(y)for(var A in y.j)throw new Le(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=d,l.j[d]=s,l.timestamp=s.parent.timestamp,s.parent=l},Bb(s,l){delete s.j[l],s.timestamp=Date.now()},wb(s,l){var d=tr(s,l),y;for(y in d.j)throw new Le(55);delete s.j[l],s.timestamp=Date.now()},tb(s){var l=[".",".."],d;for(d in s.j)s.j.hasOwnProperty(d)&&l.push(d);return l},Ea(s,l,d){return s=xe.createNode(s,l,41471,0),s.link=d,s},ma(s){if((s.mode&61440)!==40960)throw new Le(28);return s.link}},m:{read(s,l,d,y,A){var C=s.node.j;if(A>=s.node.v)return 0;if(s=Math.min(s.node.v-A,y),8<s&&C.subarray)l.set(C.subarray(A,A+s),d);else for(y=0;y<s;y++)l[d+y]=C[A+y];return s},write(s,l,d,y,A,C){if(l.buffer===O.buffer&&(C=!1),!y)return 0;if(s=s.node,s.timestamp=Date.now(),l.subarray&&(!s.j||s.j.subarray)){if(C)return s.j=l.subarray(d,d+y),s.v=y;if(s.v===0&&A===0)return s.j=l.slice(d,d+y),s.v=y;if(A+y<=s.v)return s.j.set(l.subarray(d,d+y),A),y}if(Je(s,A+y),s.j.subarray&&l.subarray)s.j.set(l.subarray(d,d+y),A);else for(C=0;C<y;C++)s.j[A+C]=l[d+C];return s.v=Math.max(s.v,A+y),y},ba(s,l,d){if(d===1?l+=s.position:d===2&&(s.node.mode&61440)===32768&&(l+=s.node.v),0>l)throw new Le(28);return l},pa(s,l,d){Je(s.node,l+d),s.node.v=Math.max(s.node.v,l+d)},mb(s,l,d,y,A){if((s.node.mode&61440)!==32768)throw new Le(43);if(s=s.node.j,A&2||s.buffer!==O.buffer){if((0<d||d+l<s.length)&&(s.subarray?s=s.subarray(d,d+l):s=Array.prototype.slice.call(s,d,d+l)),d=!0,ie(),l=void 0,!l)throw new Le(48);O.set(s,l)}else d=!1,l=s.byteOffset;return{o:l,M:d}},ob(s,l,d,y){return xe.m.write(s,l,0,y,d,!1),0}}};function Ne(s,l){var d=0;return s&&(d|=365),l&&(d|=146),d}var ut=null,mt={},Rt=[],Ti=1,Gt=null,Nr=!0,Le=null,$r={},jt=(s,l={})=>{if(s=Se(s),!s)return{path:"",node:null};if(l=Object.assign({hb:!0,Qa:0},l),8<l.Qa)throw new Le(32);s=s.split("/").filter(H=>!!H);for(var d=ut,y="/",A=0;A<s.length;A++){var C=A===s.length-1;if(C&&l.parent)break;if(d=tr(d,s[A]),y=j(y+"/"+s[A]),d.wa&&(!C||C&&l.hb)&&(d=d.wa.root),!C||l.gb){for(C=0;(d.mode&61440)===40960;)if(d=Ri(y),y=Se(X(y),d),d=jt(y,{Qa:l.Qa+1}).node,40<C++)throw new Le(32)}}return{path:y,node:d}},Fr=s=>{for(var l;;){if(s===s.parent)return s=s.U.nb,l?s[s.length-1]!=="/"?`${s}/${l}`:s+l:s;l=l?`${s.name}/${l}`:s.name,s=s.parent}},Ur=(s,l)=>{for(var d=0,y=0;y<l.length;y++)d=(d<<5)-d+l.charCodeAt(y)|0;return(s+d>>>0)%Gt.length},tr=(s,l)=>{var d;if(d=(d=rr(s,"x"))?d:s.l.ka?0:2)throw new Le(d,s);for(d=Gt[Ur(s.id,l)];d;d=d.lc){var y=d.name;if(d.parent.id===s.id&&y===l)return d}return s.l.ka(s,l)},Br=(s,l,d,y)=>(s=new vi(s,l,d,y),l=Ur(s.parent.id,s.name),s.lc=Gt[l],Gt[l]=s),Wr=s=>{var l=["r","w","rw"][s&3];return s&512&&(l+="w"),l},rr=(s,l)=>{if(Nr)return 0;if(!l.includes("r")||s.mode&292){if(l.includes("w")&&!(s.mode&146)||l.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},qr=(s,l)=>{try{return tr(s,l),20}catch{}return rr(s,"wx")},xi=()=>{for(var s=0;4096>=s;s++)if(!Rt[s])return s;throw new Le(33)},Pt=s=>{if(s=Rt[s],!s)throw new Le(8);return s},Gr=(s,l=-1)=>(Ht||(Ht=function(){this.h={}},Ht.prototype={},Object.defineProperties(Ht.prototype,{object:{get(){return this.node},set(d){this.node=d}},flags:{get(){return this.h.flags},set(d){this.h.flags=d}},position:{get(){return this.h.position},set(d){this.h.position=d}}})),s=Object.assign(new Ht,s),l==-1&&(l=xi()),s.X=l,Rt[l]=s),Ci={open:s=>{s.m=mt[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new Le(70)}},Er=(s,l)=>{mt[s]={m:l}},Vr=(s,l)=>{var d=l==="/",y=!l;if(d&&ut)throw new Le(10);if(!d&&!y){var A=jt(l,{hb:!1});if(l=A.path,A=A.node,A.wa)throw new Le(10);if((A.mode&61440)!==16384)throw new Le(54)}l={type:s,Qc:{},nb:l,kc:[]},s=s.U(l),s.U=l,l.root=s,d?ut=s:A&&(A.wa=l,A.U&&A.U.kc.push(l))},bt=(s,l,d)=>{var y=jt(s,{parent:!0}).node;if(s=ve(s),!s||s==="."||s==="..")throw new Le(28);var A=qr(y,s);if(A)throw new Le(A);if(!y.l.va)throw new Le(63);return y.l.va(y,s,l,d)},ir=(s,l,d)=>{typeof d>"u"&&(d=l,l=438),bt(s,l|8192,d)},Sr=(s,l)=>{if(!Se(s))throw new Le(44);var d=jt(l,{parent:!0}).node;if(!d)throw new Le(44);l=ve(l);var y=qr(d,l);if(y)throw new Le(y);if(!d.l.Ea)throw new Le(63);d.l.Ea(d,l,s)},Ri=s=>{if(s=jt(s).node,!s)throw new Le(44);if(!s.l.ma)throw new Le(28);return Se(Fr(s.parent),s.l.ma(s))},nr=(s,l,d)=>{if(s==="")throw new Le(44);if(typeof l=="string"){var y={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[l];if(typeof y>"u")throw Error(`Unknown file open mode: ${l}`);l=y}if(d=l&64?(typeof d>"u"?438:d)&4095|32768:0,typeof s=="object")var A=s;else{s=j(s);try{A=jt(s,{gb:!(l&131072)}).node}catch{}}if(y=!1,l&64)if(A){if(l&128)throw new Le(20)}else A=bt(s,d,0),y=!0;if(!A)throw new Le(44);if((A.mode&61440)===8192&&(l&=-513),l&65536&&(A.mode&61440)!==16384)throw new Le(54);if(!y&&(d=A?(A.mode&61440)===40960?32:(A.mode&61440)===16384&&(Wr(l)!=="r"||l&512)?31:rr(A,Wr(l)):44))throw new Le(d);if(l&512&&!y){if(d=A,d=typeof d=="string"?jt(d,{gb:!0}).node:d,!d.l.P)throw new Le(63);if((d.mode&61440)===16384)throw new Le(31);if((d.mode&61440)!==32768)throw new Le(28);if(y=rr(d,"w"))throw new Le(y);d.l.P(d,{size:0,timestamp:Date.now()})}return l&=-131713,A=Gr({node:A,path:Fr(A),flags:l,seekable:!0,position:0,m:A.m,zc:[],error:!1}),A.m.open&&A.m.open(A),!_.logReadFiles||l&1||(sr||(sr={}),s in sr||(sr[s]=1)),A},Hr=(s,l,d)=>{if(s.X===null)throw new Le(8);if(!s.seekable||!s.m.ba)throw new Le(70);if(d!=0&&d!=1&&d!=2)throw new Le(28);s.position=s.m.ba(s,l,d),s.zc=[]},zr=()=>{Le||(Le=function(s,l){this.name="ErrnoError",this.node=l,this.pc=function(d){this.aa=d},this.pc(s),this.message="FS error"},Le.prototype=Error(),Le.prototype.constructor=Le,[44].forEach(s=>{$r[s]=new Le(s),$r[s].stack="<generic error, no stack>"}))},Kr,Vt=(s,l,d)=>{s=j("/dev/"+s);var y=Ne(!!l,!!d);kr||(kr=64);var A=kr++<<8|0;Er(A,{open:C=>{C.seekable=!1},close:()=>{d&&d.buffer&&d.buffer.length&&d(10)},read:(C,H,se,fe)=>{for(var ee=0,Ee=0;Ee<fe;Ee++){try{var Te=l()}catch{throw new Le(29)}if(Te===void 0&&ee===0)throw new Le(6);if(Te==null)break;ee++,H[se+Ee]=Te}return ee&&(C.node.timestamp=Date.now()),ee},write:(C,H,se,fe)=>{for(var ee=0;ee<fe;ee++)try{d(H[se+ee])}catch{throw new Le(29)}return fe&&(C.node.timestamp=Date.now()),ee}}),ir(s,y,A)},kr,Mt={},Ht,sr,zt=void 0;function At(){return zt+=4,ae[zt-4>>2]}function Yr(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var l=s.charCodeAt(0);return 48<=l&&57>=l?`_${s}`:s}function ar(s,l){return s=Yr(s),{[s]:function(){return l.apply(this,arguments)}}[s]}function Jr(){this.M=[void 0],this.ib=[]}var gt=new Jr,Ut=void 0;function Ge(s){throw new Ut(s)}var yt=s=>(s||Ge("Cannot use deleted val. handle = "+s),gt.get(s).value),wt=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return gt.pa({ub:1,value:s})}};function Xr(s){var l=Error,d=ar(s,function(y){this.name=s,this.message=y,y=Error(y).stack,y!==void 0&&(this.stack=this.toString()+`
`+y.replace(/^Error(:[^\n]*)?\n/,""))});return d.prototype=Object.create(l.prototype),d.prototype.constructor=d,d.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},d}var Qr=void 0,Zr=void 0;function ot(s){for(var l="";K[s];)l+=Zr[K[s++]];return l}var Kt=[];function Ar(){for(;Kt.length;){var s=Kt.pop();s.g.fa=!1,s.delete()}}var Yt=void 0,It={};function Ir(s,l){for(l===void 0&&Ge("ptr should not be undefined");s.A;)l=s.na(l),s=s.A;return l}var Lt={};function ei(s){s=wi(s);var l=ot(s);return Ct(s),l}function Jt(s,l){var d=Lt[s];return d===void 0&&Ge(l+" has unknown type "+ei(s)),d}function or(){}var Tr=!1;function ti(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function ri(s,l,d){return l===d?s:d.A===void 0?null:(s=ri(s,l,d.A),s===null?null:d.Pb(s))}var ii={};function Pi(s,l){return l=Ir(s,l),It[l]}var ni=void 0;function lr(s){throw new ni(s)}function cr(s,l){return l.u&&l.o||lr("makeClassHandle requires ptr and ptrType"),!!l.L!=!!l.G&&lr("Both smartPtrType and smartPtr must be specified"),l.count={value:1},Bt(Object.create(s,{g:{value:l}}))}function Bt(s){return typeof FinalizationRegistry>"u"?(Bt=l=>l,s):(Tr=new FinalizationRegistry(l=>{ti(l.g)}),Bt=l=>{var d=l.g;return d.G&&Tr.register(l,{g:d},l),l},or=l=>{Tr.unregister(l)},Bt(s))}var ur={};function Xt(s){for(;s.length;){var l=s.pop();s.pop()(l)}}function Qt(s){return this.fromWireType(ae[s>>2])}var Wt={},dr={};function _t(s,l,d){function y(se){se=d(se),se.length!==s.length&&lr("Mismatched type converter count");for(var fe=0;fe<s.length;++fe)Et(s[fe],se[fe])}s.forEach(function(se){dr[se]=l});var A=Array(l.length),C=[],H=0;l.forEach((se,fe)=>{Lt.hasOwnProperty(se)?A[fe]=Lt[se]:(C.push(se),Wt.hasOwnProperty(se)||(Wt[se]=[]),Wt[se].push(()=>{A[fe]=Lt[se],++H,H===C.length&&y(A)}))}),C.length===0&&y(A)}function fr(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Oi(s,l,d={}){var y=l.name;if(s||Ge(`type "${y}" must have a positive integer typeid pointer`),Lt.hasOwnProperty(s)){if(d.$b)return;Ge(`Cannot register type '${y}' twice`)}Lt[s]=l,delete dr[s],Wt.hasOwnProperty(s)&&(l=Wt[s],delete Wt[s],l.forEach(A=>A()))}function Et(s,l,d={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");Oi(s,l,d)}function xr(s){Ge(s.g.u.i.name+" instance already deleted")}function Ot(){}function Cr(s,l,d){if(s[l].B===void 0){var y=s[l];s[l]=function(){return s[l].B.hasOwnProperty(arguments.length)||Ge(`Function '${d}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[l].B})!`),s[l].B[arguments.length].apply(this,arguments)},s[l].B=[],s[l].B[y.ea]=y}}function Rr(s,l,d){_.hasOwnProperty(s)?((d===void 0||_[s].B!==void 0&&_[s].B[d]!==void 0)&&Ge(`Cannot register public name '${s}' twice`),Cr(_,s,s),_.hasOwnProperty(d)&&Ge(`Cannot register multiple overloads of a function with the same number of arguments (${d})!`),_[s].B[d]=l):(_[s]=l,d!==void 0&&(_[s].Pc=d))}function ji(s,l,d,y,A,C,H,se){this.name=s,this.constructor=l,this.N=d,this.W=y,this.A=A,this.Ub=C,this.na=H,this.Pb=se,this.rb=[]}function hr(s,l,d){for(;l!==d;)l.na||Ge(`Expected null or instance of ${d.name}, got an instance of ${l.name}`),s=l.na(s),l=l.A;return s}function Mi(s,l){return l===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),hr(l.g.o,l.g.u.i,this.i))}function Li(s,l){if(l===null){if(this.Na&&Ge(`null is not a valid ${this.name}`),this.ua){var d=this.Pa();return s!==null&&s.push(this.W,d),d}return 0}if(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&l.g.u.ta&&Ge(`Cannot convert argument of type ${l.g.L?l.g.L.name:l.g.u.name} to parameter type ${this.name}`),d=hr(l.g.o,l.g.u.i,this.i),this.ua)switch(l.g.G===void 0&&Ge("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:l.g.L===this?d=l.g.G:Ge(`Cannot convert argument of type ${l.g.L?l.g.L.name:l.g.u.name} to parameter type ${this.name}`);break;case 1:d=l.g.G;break;case 2:if(l.g.L===this)d=l.g.G;else{var y=l.clone();d=this.oc(d,wt(function(){y.delete()})),s!==null&&s.push(this.W,d)}break;default:Ge("Unsupporting sharing policy")}return d}function Di(s,l){return l===null?(this.Na&&Ge(`null is not a valid ${this.name}`),0):(l.g||Ge(`Cannot pass "${Or(l)}" as a ${this.name}`),l.g.o||Ge(`Cannot pass deleted object as a pointer of type ${this.name}`),l.g.u.ta&&Ge(`Cannot convert argument of type ${l.g.u.name} to parameter type ${this.name}`),hr(l.g.o,l.g.u.i,this.i))}function Tt(s,l,d,y){this.name=s,this.i=l,this.Na=d,this.ta=y,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,l.A!==void 0?this.toWireType=Li:(this.toWireType=y?Mi:Di,this.K=null)}function si(s,l,d){_.hasOwnProperty(s)||lr("Replacing nonexistant public symbol"),_[s].B!==void 0&&d!==void 0?_[s].B[d]=l:(_[s]=l,_[s].ea=d)}var vr=[],ai=s=>{var l=vr[s];return l||(s>=vr.length&&(vr.length=s+1),vr[s]=l=Q.get(s)),l},Ni=(s,l)=>{var d=[];return function(){if(d.length=0,Object.assign(d,arguments),s.includes("j")){var y=_["dynCall_"+s];y=d&&d.length?y.apply(null,[l].concat(d)):y.call(null,l)}else y=ai(l).apply(null,d);return y}};function vt(s,l){s=ot(s);var d=s.includes("j")?Ni(s,l):ai(l);return typeof d!="function"&&Ge(`unknown function pointer with signature ${s}: ${l}`),d}var oi=void 0;function xt(s,l){function d(C){A[C]||Lt[C]||(dr[C]?dr[C].forEach(d):(y.push(C),A[C]=!0))}var y=[],A={};throw l.forEach(d),new oi(`${s}: `+y.map(ei).join([", "]))}function _r(s,l,d,y,A){var C=l.length;2>C&&Ge("argTypes array size mismatch! Must at least get return value and 'this' types!");var H=l[1]!==null&&d!==null,se=!1;for(d=1;d<l.length;++d)if(l[d]!==null&&l[d].K===void 0){se=!0;break}var fe=l[0].name!=="void",ee=C-2,Ee=Array(ee),Te=[],Me=[];return function(){if(arguments.length!==ee&&Ge(`function ${s} called with ${arguments.length} arguments, expected ${ee} args!`),Me.length=0,Te.length=H?2:1,Te[0]=A,H){var J=l[1].toWireType(Me,this);Te[1]=J}for(var $e=0;$e<ee;++$e)Ee[$e]=l[$e+2].toWireType(Me,arguments[$e]),Te.push(Ee[$e]);if($e=y.apply(null,Te),se)Xt(Me);else for(var we=H?1:2;we<l.length;we++){var Ve=we===1?J:Ee[we-2];l[we].K!==null&&l[we].K(Ve)}return J=fe?l[0].fromWireType($e):void 0,J}}function gr(s,l){for(var d=[],y=0;y<s;y++)d.push(_e[l+4*y>>2]);return d}function li(s,l,d){return s instanceof Object||Ge(`${d} with invalid "this": ${s}`),s instanceof l.i.constructor||Ge(`${d} incompatible with "this" of type ${s.constructor.name}`),s.g.o||Ge(`cannot call emscripten binding method ${d} on deleted object`),hr(s.g.o,s.g.u.i,l.i)}function Pr(s){s>=gt.h&&--gt.get(s).ub===0&&gt.Zb(s)}function Fi(s,l,d){switch(l){case 0:return function(y){return this.fromWireType((d?O:K)[y])};case 1:return function(y){return this.fromWireType((d?oe:de)[y>>1])};case 2:return function(y){return this.fromWireType((d?ae:_e)[y>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Or(s){if(s===null)return"null";var l=typeof s;return l==="object"||l==="array"||l==="function"?s.toString():""+s}function Ui(s,l){switch(l){case 2:return function(d){return this.fromWireType(me[d>>2])};case 3:return function(d){return this.fromWireType(be[d>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Bi(s,l,d){switch(l){case 0:return d?function(y){return O[y]}:function(y){return K[y]};case 1:return d?function(y){return oe[y>>1]}:function(y){return de[y>>1]};case 2:return d?function(y){return ae[y>>2]}:function(y){return _e[y>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var ci=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Wi=(s,l)=>{for(var d=s>>1,y=d+l/2;!(d>=y)&&de[d];)++d;if(d<<=1,32<d-s&&ci)return ci.decode(K.subarray(s,d));for(d="",y=0;!(y>=l/2);++y){var A=oe[s+2*y>>1];if(A==0)break;d+=String.fromCharCode(A)}return d},qi=(s,l,d)=>{if(d===void 0&&(d=2147483647),2>d)return 0;d-=2;var y=l;d=d<2*s.length?d/2:s.length;for(var A=0;A<d;++A)oe[l>>1]=s.charCodeAt(A),l+=2;return oe[l>>1]=0,l-y},Gi=s=>2*s.length,Vi=(s,l)=>{for(var d=0,y="";!(d>=l/4);){var A=ae[s+4*d>>2];if(A==0)break;++d,65536<=A?(A-=65536,y+=String.fromCharCode(55296|A>>10,56320|A&1023)):y+=String.fromCharCode(A)}return y},Hi=(s,l,d)=>{if(d===void 0&&(d=2147483647),4>d)return 0;var y=l;d=y+d-4;for(var A=0;A<s.length;++A){var C=s.charCodeAt(A);if(55296<=C&&57343>=C){var H=s.charCodeAt(++A);C=65536+((C&1023)<<10)|H&1023}if(ae[l>>2]=C,l+=4,l+4>d)break}return ae[l>>2]=0,l-y},zi=s=>{for(var l=0,d=0;d<s.length;++d){var y=s.charCodeAt(d);55296<=y&&57343>=y&&++d,l+=4}return l},Ki={};function pr(s){var l=Ki[s];return l===void 0?ot(s):l}var mr=[];function Yi(s){var l=mr.length;return mr.push(s),l}function Ji(s,l){for(var d=Array(s),y=0;y<s;++y)d[y]=Jt(_e[l+4*y>>2],"parameter "+y);return d}var ui=[],jr=[],Mr={},di=()=>{if(!Lr){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:k||"./this.program"},l;for(l in Mr)Mr[l]===void 0?delete s[l]:s[l]=Mr[l];var d=[];for(l in s)d.push(`${l}=${s[l]}`);Lr=d}return Lr},Lr,br=s=>s%4===0&&(s%100!==0||s%400===0),fi=[31,29,31,30,31,30,31,31,30,31,30,31],hi=[31,28,31,30,31,30,31,31,30,31,30,31],Xi=(s,l,d,y)=>{function A(J,$e,we){for(J=typeof J=="number"?J.toString():J||"";J.length<$e;)J=we[0]+J;return J}function C(J,$e){return A(J,$e,"0")}function H(J,$e){function we(ze){return 0>ze?-1:0<ze?1:0}var Ve;return(Ve=we(J.getFullYear()-$e.getFullYear()))===0&&(Ve=we(J.getMonth()-$e.getMonth()))===0&&(Ve=we(J.getDate()-$e.getDate())),Ve}function se(J){switch(J.getDay()){case 0:return new Date(J.getFullYear()-1,11,29);case 1:return J;case 2:return new Date(J.getFullYear(),0,3);case 3:return new Date(J.getFullYear(),0,2);case 4:return new Date(J.getFullYear(),0,1);case 5:return new Date(J.getFullYear()-1,11,31);case 6:return new Date(J.getFullYear()-1,11,30)}}function fe(J){var $e=J.ca;for(J=new Date(new Date(J.da+1900,0,1).getTime());0<$e;){var we=J.getMonth(),Ve=(br(J.getFullYear())?fi:hi)[we];if($e>Ve-J.getDate())$e-=Ve-J.getDate()+1,J.setDate(1),11>we?J.setMonth(we+1):(J.setMonth(0),J.setFullYear(J.getFullYear()+1));else{J.setDate(J.getDate()+$e);break}}return we=new Date(J.getFullYear()+1,0,4),$e=se(new Date(J.getFullYear(),0,4)),we=se(we),0>=H($e,J)?0>=H(we,J)?J.getFullYear()+1:J.getFullYear():J.getFullYear()-1}var ee=ae[y+40>>2];y={wc:ae[y>>2],vc:ae[y+4>>2],Fa:ae[y+8>>2],Sa:ae[y+12>>2],Ga:ae[y+16>>2],da:ae[y+20>>2],R:ae[y+24>>2],ca:ae[y+28>>2],Rc:ae[y+32>>2],uc:ae[y+36>>2],xc:ee&&ee?We(K,ee):""},d=d?We(K,d):"",ee={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Ee in ee)d=d.replace(new RegExp(Ee,"g"),ee[Ee]);var Te="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Me="January February March April May June July August September October November December".split(" ");ee={"%a":J=>Te[J.R].substring(0,3),"%A":J=>Te[J.R],"%b":J=>Me[J.Ga].substring(0,3),"%B":J=>Me[J.Ga],"%C":J=>C((J.da+1900)/100|0,2),"%d":J=>C(J.Sa,2),"%e":J=>A(J.Sa,2," "),"%g":J=>fe(J).toString().substring(2),"%G":J=>fe(J),"%H":J=>C(J.Fa,2),"%I":J=>(J=J.Fa,J==0?J=12:12<J&&(J-=12),C(J,2)),"%j":J=>{for(var $e=0,we=0;we<=J.Ga-1;$e+=(br(J.da+1900)?fi:hi)[we++]);return C(J.Sa+$e,3)},"%m":J=>C(J.Ga+1,2),"%M":J=>C(J.vc,2),"%n":()=>`
`,"%p":J=>0<=J.Fa&&12>J.Fa?"AM":"PM","%S":J=>C(J.wc,2),"%t":()=>"	","%u":J=>J.R||7,"%U":J=>C(Math.floor((J.ca+7-J.R)/7),2),"%V":J=>{var $e=Math.floor((J.ca+7-(J.R+6)%7)/7);if(2>=(J.R+371-J.ca-2)%7&&$e++,$e)$e==53&&(we=(J.R+371-J.ca)%7,we==4||we==3&&br(J.da)||($e=1));else{$e=52;var we=(J.R+7-J.ca-1)%7;(we==4||we==5&&br(J.da%400-1))&&$e++}return C($e,2)},"%w":J=>J.R,"%W":J=>C(Math.floor((J.ca+7-(J.R+6)%7)/7),2),"%y":J=>(J.da+1900).toString().substring(2),"%Y":J=>J.da+1900,"%z":J=>{J=J.uc;var $e=0<=J;return J=Math.abs(J)/60,($e?"+":"-")+("0000"+(J/60*100+J%60)).slice(-4)},"%Z":J=>J.xc,"%%":()=>"%"},d=d.replace(/%%/g,"\0\0");for(Ee in ee)d.includes(Ee)&&(d=d.replace(new RegExp(Ee,"g"),ee[Ee](y)));return d=d.replace(/\0\0/g,"%"),Ee=lt(d,!1),Ee.length>l?0:(O.set(Ee,s),Ee.length-1)};function vi(s,l,d,y){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Ti++,this.name=l,this.mode=d,this.l={},this.m={},this.za=y}Object.defineProperties(vi.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),zr(),Gt=Array(4096),Vr(xe,"/"),bt("/tmp",16895,0),bt("/home",16895,0),bt("/home/web_user",16895,0),(()=>{bt("/dev",16895,0),Er(259,{read:()=>0,write:(y,A,C,H)=>H}),ir("/dev/null",259),qe(1280,it),qe(1536,nt),ir("/dev/tty",1280),ir("/dev/tty1",1536);var s=new Uint8Array(1024),l=0,d=()=>(l===0&&(l=je(s).byteLength),s[--l]);Vt("random",d),Vt("urandom",d),bt("/dev/shm",16895,0),bt("/dev/shm/tmp",16895,0)})(),(()=>{bt("/proc",16895,0);var s=bt("/proc/self",16895,0);bt("/proc/self/fd",16895,0),Vr({U:()=>{var l=Br(s,"fd",16895,73);return l.l={ka:(d,y)=>{var A=Pt(+y);return d={parent:null,U:{nb:"fake"},l:{ma:()=>A.path}},d.parent=d}},l}},"/proc/self/fd")})(),Object.assign(Jr.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var l=this.ib.pop()||this.M.length;return this.M[l]=s,l},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Ut=_.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},gt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),gt.h=gt.M.length,_.count_emval_handles=function(){for(var s=0,l=gt.h;l<gt.M.length;++l)gt.M[l]!==void 0&&++s;return s},Qr=_.PureVirtualError=Xr("PureVirtualError");for(var _i=Array(256),yr=0;256>yr;++yr)_i[yr]=String.fromCharCode(yr);Zr=_i,_.getInheritedInstanceCount=function(){return Object.keys(It).length},_.getLiveInheritedInstances=function(){var s=[],l;for(l in It)It.hasOwnProperty(l)&&s.push(It[l]);return s},_.flushPendingDeletes=Ar,_.setDelayFunction=function(s){Yt=s,Kt.length&&Yt&&Yt(Ar)},ni=_.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Ot.prototype.isAliasOf=function(s){if(!(this instanceof Ot&&s instanceof Ot))return!1;var l=this.g.u.i,d=this.g.o,y=s.g.u.i;for(s=s.g.o;l.A;)d=l.na(d),l=l.A;for(;y.A;)s=y.na(s),y=y.A;return l===y&&d===s},Ot.prototype.clone=function(){if(this.g.o||xr(this),this.g.ia)return this.g.count.value+=1,this;var s=Bt,l=Object,d=l.create,y=Object.getPrototypeOf(this),A=this.g;return s=s(d.call(l,y,{g:{value:{count:A.count,fa:A.fa,ia:A.ia,o:A.o,u:A.u,G:A.G,L:A.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Ot.prototype.delete=function(){this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),or(this),ti(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Ot.prototype.isDeleted=function(){return!this.g.o},Ot.prototype.deleteLater=function(){return this.g.o||xr(this),this.g.fa&&!this.g.ia&&Ge("Object already scheduled for deletion"),Kt.push(this),Kt.length===1&&Yt&&Yt(Ar),this.g.fa=!0,this},Tt.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Tt.prototype.bb=function(s){this.W&&this.W(s)},Tt.prototype.argPackAdvance=8,Tt.prototype.readValueFromPointer=Qt,Tt.prototype.deleteObject=function(s){s!==null&&s.delete()},Tt.prototype.fromWireType=function(s){function l(){return this.ua?cr(this.i.N,{u:this.nc,o:d,L:this,G:s}):cr(this.i.N,{u:this,o:s})}var d=this.Vb(s);if(!d)return this.bb(s),null;var y=Pi(this.i,d);if(y!==void 0)return y.g.count.value===0?(y.g.o=d,y.g.G=s,y.clone()):(y=y.clone(),this.bb(s),y);if(y=this.i.Ub(d),y=ii[y],!y)return l.call(this);y=this.ta?y.Kb:y.pointerType;var A=ri(d,this.i,y.i);return A===null?l.call(this):this.ua?cr(y.i.N,{u:y,o:A,L:this,G:s}):cr(y.i.N,{u:y,o:A})},oi=_.UnboundTypeError=Xr("UnboundTypeError");var gi={__syscall_fcntl64:function(s,l,d){zt=d;try{var y=Pt(s);switch(l){case 0:var A=At();return 0>A?-28:Gr(y,A).X;case 1:case 2:return 0;case 3:return y.flags;case 4:return A=At(),y.flags|=A,0;case 5:return A=At(),oe[A+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ae[pi()>>2]=28,-1;default:return-28}}catch(C){if(typeof Mt>"u"||C.name!=="ErrnoError")throw C;return-C.aa}},__syscall_ioctl:function(s,l,d){zt=d;try{var y=Pt(s);switch(l){case 21509:return y.s?0:-59;case 21505:if(!y.s)return-59;if(y.s.V.bc){l=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var A=At();ae[A>>2]=25856,ae[A+4>>2]=5,ae[A+8>>2]=191,ae[A+12>>2]=35387;for(var C=0;32>C;C++)O[A+C+17>>0]=l[C]||0}return 0;case 21510:case 21511:case 21512:return y.s?0:-59;case 21506:case 21507:case 21508:if(!y.s)return-59;if(y.s.V.cc)for(A=At(),l=[],C=0;32>C;C++)l.push(O[A+C+17>>0]);return 0;case 21519:return y.s?(A=At(),ae[A>>2]=0):-59;case 21520:return y.s?-28:-59;case 21531:if(A=At(),!y.m.ac)throw new Le(59);return y.m.ac(y,l,A);case 21523:return y.s?(y.s.V.dc&&(C=[24,80],A=At(),oe[A>>1]=C[0],oe[A+2>>1]=C[1]),0):-59;case 21524:return y.s?0:-59;case 21515:return y.s?0:-59;default:return-28}}catch(H){if(typeof Mt>"u"||H.name!=="ErrnoError")throw H;return-H.aa}},__syscall_openat:function(s,l,d,y){zt=y;try{l=l?We(K,l):"";var A=l;if(A.charAt(0)==="/")l=A;else{var C=s===-100?"/":Pt(s).path;if(A.length==0)throw new Le(44);l=j(C+"/"+A)}var H=y?At():0;return nr(l,d,H).X}catch(se){if(typeof Mt>"u"||se.name!=="ErrnoError")throw se;return-se.aa}},_embind_create_inheriting_constructor:function(s,l,d){s=ot(s),l=Jt(l,"wrapper"),d=yt(d);var y=[].slice,A=l.i,C=A.N,H=A.A.N,se=A.A.constructor;s=ar(s,function(){A.A.rb.forEach((function(ee){if(this[ee]===H[ee])throw new Qr(`Pure virtual function ${ee} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:C}),this.__construct.apply(this,y.call(arguments))}),C.__construct=function(){this===C&&Ge("Pass correct 'this' to __construct");var ee=se.implement.apply(void 0,[this].concat(y.call(arguments)));or(ee);var Ee=ee.g;ee.notifyOnDestruction(),Ee.ia=!0,Object.defineProperties(this,{g:{value:Ee}}),Bt(this),ee=Ee.o,ee=Ir(A,ee),It.hasOwnProperty(ee)?Ge(`Tried to register registered instance: ${ee}`):It[ee]=this},C.__destruct=function(){this===C&&Ge("Pass correct 'this' to __destruct"),or(this);var ee=this.g.o;ee=Ir(A,ee),It.hasOwnProperty(ee)?delete It[ee]:Ge(`Tried to unregister unregistered instance: ${ee}`)},s.prototype=Object.create(C);for(var fe in d)s.prototype[fe]=d[fe];return wt(s)},_embind_finalize_value_object:function(s){var l=ur[s];delete ur[s];var d=l.Pa,y=l.W,A=l.fb,C=A.map(H=>H.Yb).concat(A.map(H=>H.rc));_t([s],C,H=>{var se={};return A.forEach((fe,ee)=>{var Ee=H[ee],Te=fe.Wb,Me=fe.Xb,J=H[ee+A.length],$e=fe.qc,we=fe.sc;se[fe.Sb]={read:Ve=>Ee.fromWireType(Te(Me,Ve)),write:(Ve,ze)=>{var Pe=[];$e(we,Ve,J.toWireType(Pe,ze)),Xt(Pe)}}}),[{name:l.name,fromWireType:function(fe){var ee={},Ee;for(Ee in se)ee[Ee]=se[Ee].read(fe);return y(fe),ee},toWireType:function(fe,ee){for(var Ee in se)if(!(Ee in ee))throw new TypeError(`Missing field: "${Ee}"`);var Te=d();for(Ee in se)se[Ee].write(Te,ee[Ee]);return fe!==null&&fe.push(y,Te),Te},argPackAdvance:8,readValueFromPointer:Qt,K:y}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,l,d,y,A){var C=fr(d);l=ot(l),Et(s,{name:l,fromWireType:function(H){return!!H},toWireType:function(H,se){return se?y:A},argPackAdvance:8,readValueFromPointer:function(H){if(d===1)var se=O;else if(d===2)se=oe;else if(d===4)se=ae;else throw new TypeError("Unknown boolean type size: "+l);return this.fromWireType(se[H>>C])},K:null})},_embind_register_class:function(s,l,d,y,A,C,H,se,fe,ee,Ee,Te,Me){Ee=ot(Ee),C=vt(A,C),se&&(se=vt(H,se)),ee&&(ee=vt(fe,ee)),Me=vt(Te,Me);var J=Yr(Ee);Rr(J,function(){xt(`Cannot construct ${Ee} due to unbound types`,[y])}),_t([s,l,d],y?[y]:[],function($e){if($e=$e[0],y)var we=$e.i,Ve=we.N;else Ve=Ot.prototype;$e=ar(J,function(){if(Object.getPrototypeOf(this)!==ze)throw new Ut("Use 'new' to construct "+Ee);if(Pe.$===void 0)throw new Ut(Ee+" has no accessible constructor");var ht=Pe.$[arguments.length];if(ht===void 0)throw new Ut(`Tried to invoke ctor of ${Ee} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Pe.$).toString()}) parameters instead!`);return ht.apply(this,arguments)});var ze=Object.create(Ve,{constructor:{value:$e}});$e.prototype=ze;var Pe=new ji(Ee,$e,ze,Me,we,C,se,ee);Pe.A&&(Pe.A.oa===void 0&&(Pe.A.oa=[]),Pe.A.oa.push(Pe)),we=new Tt(Ee,Pe,!0,!1),Ve=new Tt(Ee+"*",Pe,!1,!1);var st=new Tt(Ee+" const*",Pe,!1,!0);return ii[s]={pointerType:Ve,Kb:st},si(J,$e),[we,Ve,st]})},_embind_register_class_class_function:function(s,l,d,y,A,C,H){var se=gr(d,y);l=ot(l),C=vt(A,C),_t([],[s],function(fe){function ee(){xt(`Cannot call ${Ee} due to unbound types`,se)}fe=fe[0];var Ee=`${fe.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]);var Te=fe.i.constructor;return Te[l]===void 0?(ee.ea=d-1,Te[l]=ee):(Cr(Te,l,Ee),Te[l].B[d-1]=ee),_t([],se,function(Me){if(Me=_r(Ee,[Me[0],null].concat(Me.slice(1)),null,C,H),Te[l].B===void 0?(Me.ea=d-1,Te[l]=Me):Te[l].B[d-1]=Me,fe.i.oa)for(const J of fe.i.oa)J.constructor.hasOwnProperty(l)||(J.constructor[l]=Me);return[]}),[]})},_embind_register_class_class_property:function(s,l,d,y,A,C,H,se){l=ot(l),C=vt(A,C),_t([],[s],function(fe){fe=fe[0];var ee=`${fe.name}.${l}`,Ee={get(){xt(`Cannot access ${ee} due to unbound types`,[d])},enumerable:!0,configurable:!0};return Ee.set=se?()=>{xt(`Cannot access ${ee} due to unbound types`,[d])}:()=>{Ge(`${ee} is a read-only property`)},Object.defineProperty(fe.i.constructor,l,Ee),_t([],[d],function(Te){Te=Te[0];var Me={get(){return Te.fromWireType(C(y))},enumerable:!0};return se&&(se=vt(H,se),Me.set=J=>{var $e=[];se(y,Te.toWireType($e,J)),Xt($e)}),Object.defineProperty(fe.i.constructor,l,Me),[]}),[]})},_embind_register_class_constructor:function(s,l,d,y,A,C){var H=gr(l,d);A=vt(y,A),_t([],[s],function(se){se=se[0];var fe=`constructor ${se.name}`;if(se.i.$===void 0&&(se.i.$=[]),se.i.$[l-1]!==void 0)throw new Ut(`Cannot register multiple constructors with identical number of parameters (${l-1}) for class '${se.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return se.i.$[l-1]=()=>{xt(`Cannot construct ${se.name} due to unbound types`,H)},_t([],H,function(ee){return ee.splice(1,0,null),se.i.$[l-1]=_r(fe,ee,null,A,C),[]}),[]})},_embind_register_class_function:function(s,l,d,y,A,C,H,se){var fe=gr(d,y);l=ot(l),C=vt(A,C),_t([],[s],function(ee){function Ee(){xt(`Cannot call ${Te} due to unbound types`,fe)}ee=ee[0];var Te=`${ee.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),se&&ee.i.rb.push(l);var Me=ee.i.N,J=Me[l];return J===void 0||J.B===void 0&&J.className!==ee.name&&J.ea===d-2?(Ee.ea=d-2,Ee.className=ee.name,Me[l]=Ee):(Cr(Me,l,Te),Me[l].B[d-2]=Ee),_t([],fe,function($e){return $e=_r(Te,$e,ee,C,H),Me[l].B===void 0?($e.ea=d-2,Me[l]=$e):Me[l].B[d-2]=$e,[]}),[]})},_embind_register_class_property:function(s,l,d,y,A,C,H,se,fe,ee){l=ot(l),A=vt(y,A),_t([],[s],function(Ee){Ee=Ee[0];var Te=`${Ee.name}.${l}`,Me={get(){xt(`Cannot access ${Te} due to unbound types`,[d,H])},enumerable:!0,configurable:!0};return Me.set=fe?()=>{xt(`Cannot access ${Te} due to unbound types`,[d,H])}:()=>{Ge(Te+" is a read-only property")},Object.defineProperty(Ee.i.N,l,Me),_t([],fe?[d,H]:[d],function(J){var $e=J[0],we={get(){var ze=li(this,Ee,Te+" getter");return $e.fromWireType(A(C,ze))},enumerable:!0};if(fe){fe=vt(se,fe);var Ve=J[1];we.set=function(ze){var Pe=li(this,Ee,Te+" setter"),st=[];fe(ee,Pe,Ve.toWireType(st,ze)),Xt(st)}}return Object.defineProperty(Ee.i.N,l,we),[]}),[]})},_embind_register_emval:function(s,l){l=ot(l),Et(s,{name:l,fromWireType:function(d){var y=yt(d);return Pr(d),y},toWireType:function(d,y){return wt(y)},argPackAdvance:8,readValueFromPointer:Qt,K:null})},_embind_register_enum:function(s,l,d,y){function A(){}d=fr(d),l=ot(l),A.values={},Et(s,{name:l,constructor:A,fromWireType:function(C){return this.constructor.values[C]},toWireType:function(C,H){return H.value},argPackAdvance:8,readValueFromPointer:Fi(l,d,y),K:null}),Rr(l,A)},_embind_register_enum_value:function(s,l,d){var y=Jt(s,"enum");l=ot(l),s=y.constructor,y=Object.create(y.constructor.prototype,{value:{value:d},constructor:{value:ar(`${y.name}_${l}`,function(){})}}),s.values[d]=y,s[l]=y},_embind_register_float:function(s,l,d){d=fr(d),l=ot(l),Et(s,{name:l,fromWireType:function(y){return y},toWireType:function(y,A){return A},argPackAdvance:8,readValueFromPointer:Ui(l,d),K:null})},_embind_register_function:function(s,l,d,y,A,C){var H=gr(l,d);s=ot(s),A=vt(y,A),Rr(s,function(){xt(`Cannot call ${s} due to unbound types`,H)},l-1),_t([],H,function(se){return si(s,_r(s,[se[0],null].concat(se.slice(1)),null,A,C),l-1),[]})},_embind_register_integer:function(s,l,d,y,A){l=ot(l),A===-1&&(A=4294967295),A=fr(d);var C=se=>se;if(y===0){var H=32-8*d;C=se=>se<<H>>>H}d=l.includes("unsigned")?function(se,fe){return fe>>>0}:function(se,fe){return fe},Et(s,{name:l,fromWireType:C,toWireType:d,argPackAdvance:8,readValueFromPointer:Bi(l,A,y!==0),K:null})},_embind_register_memory_view:function(s,l,d){function y(C){C>>=2;var H=_e;return new A(H.buffer,H[C+1],H[C])}var A=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][l];d=ot(d),Et(s,{name:d,fromWireType:y,argPackAdvance:8,readValueFromPointer:y},{$b:!0})},_embind_register_std_string:function(s,l){l=ot(l);var d=l==="std::string";Et(s,{name:l,fromWireType:function(y){var A=_e[y>>2],C=y+4;if(d)for(var H=C,se=0;se<=A;++se){var fe=C+se;if(se==A||K[fe]==0){if(H=H?We(K,H,fe-H):"",ee===void 0)var ee=H;else ee+="\0",ee+=H;H=fe+1}}else{for(ee=Array(A),se=0;se<A;++se)ee[se]=String.fromCharCode(K[C+se]);ee=ee.join("")}return Ct(y),ee},toWireType:function(y,A){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var C=typeof A=="string";C||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int8Array||Ge("Cannot pass non-string to std::string");var H=d&&C?Ze(A):A.length,se=Dr(4+H+1),fe=se+4;if(_e[se>>2]=H,d&&C)ct(A,K,fe,H+1);else if(C)for(C=0;C<H;++C){var ee=A.charCodeAt(C);255<ee&&(Ct(fe),Ge("String has UTF-16 code units that do not fit in 8 bits")),K[fe+C]=ee}else for(C=0;C<H;++C)K[fe+C]=A[C];return y!==null&&y.push(Ct,se),se},argPackAdvance:8,readValueFromPointer:Qt,K:function(y){Ct(y)}})},_embind_register_std_wstring:function(s,l,d){if(d=ot(d),l===2)var y=Wi,A=qi,C=Gi,H=()=>de,se=1;else l===4&&(y=Vi,A=Hi,C=zi,H=()=>_e,se=2);Et(s,{name:d,fromWireType:function(fe){for(var ee=_e[fe>>2],Ee=H(),Te,Me=fe+4,J=0;J<=ee;++J){var $e=fe+4+J*l;(J==ee||Ee[$e>>se]==0)&&(Me=y(Me,$e-Me),Te===void 0?Te=Me:(Te+="\0",Te+=Me),Me=$e+l)}return Ct(fe),Te},toWireType:function(fe,ee){typeof ee!="string"&&Ge(`Cannot pass non-string to C++ string type ${d}`);var Ee=C(ee),Te=Dr(4+Ee+l);return _e[Te>>2]=Ee>>se,A(ee,Te+4,Ee+l),fe!==null&&fe.push(Ct,Te),Te},argPackAdvance:8,readValueFromPointer:Qt,K:function(fe){Ct(fe)}})},_embind_register_value_object:function(s,l,d,y,A,C){ur[s]={name:ot(l),Pa:vt(d,y),W:vt(A,C),fb:[]}},_embind_register_value_object_field:function(s,l,d,y,A,C,H,se,fe,ee){ur[s].fb.push({Sb:ot(l),Yb:d,Wb:vt(y,A),Xb:C,rc:H,qc:vt(se,fe),sc:ee})},_embind_register_void:function(s,l){l=ot(l),Et(s,{fc:!0,name:l,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,l,d){s=yt(s),l=Jt(l,"emval::as");var y=[],A=wt(y);return _e[d>>2]=A,l.toWireType(y,s)},_emval_call_method:function(s,l,d,y,A){s=mr[s],l=yt(l),d=pr(d);var C=[];return _e[y>>2]=wt(C),s(l,d,C,A)},_emval_call_void_method:function(s,l,d,y){s=mr[s],l=yt(l),d=pr(d),s(l,d,null,y)},_emval_decref:Pr,_emval_get_method_caller:function(s,l){var d=Ji(s,l),y=d[0];l=y.name+"_$"+d.slice(1).map(function(H){return H.name}).join("_")+"$";var A=ui[l];if(A!==void 0)return A;var C=Array(s-1);return A=Yi((H,se,fe,ee)=>{for(var Ee=0,Te=0;Te<s-1;++Te)C[Te]=d[Te+1].readValueFromPointer(ee+Ee),Ee+=d[Te+1].argPackAdvance;for(H=H[se].apply(H,C),Te=0;Te<s-1;++Te)d[Te+1].Nb&&d[Te+1].Nb(C[Te]);if(!y.fc)return y.toWireType(fe,H)}),ui[l]=A},_emval_get_module_property:function(s){return s=pr(s),wt(_[s])},_emval_get_property:function(s,l){return s=yt(s),l=yt(l),wt(s[l])},_emval_incref:function(s){4<s&&(gt.get(s).ub+=1)},_emval_new_array:function(){return wt([])},_emval_new_cstring:function(s){return wt(pr(s))},_emval_new_object:function(){return wt({})},_emval_run_destructors:function(s){var l=yt(s);Xt(l),Pr(s)},_emval_set_property:function(s,l,d){s=yt(s),l=yt(l),d=yt(d),s[l]=d},_emval_take_value:function(s,l){return s=Jt(s,"_emval_take_value"),s=s.readValueFromPointer(l),wt(s)},abort:()=>{ie("")},emscripten_asm_const_int:(s,l,d)=>{jr.length=0;var y;for(d>>=2;y=K[l++];)d+=y!=105&d,jr.push(y==105?ae[d]:be[d++>>1]),++d;return c[s].apply(null,jr)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,l,d)=>K.copyWithin(s,l,l+d),emscripten_resize_heap:s=>{var l=K.length;if(s>>>=0,2147483648<s)return!1;for(var d=1;4>=d;d*=2){var y=l*(1+.2/d);y=Math.min(y,s+100663296);var A=Math;y=Math.max(s,y);e:{A=A.min.call(A,2147483648,y+(65536-y%65536)%65536)-q.buffer.byteLength+65535>>>16;try{q.grow(A),le();var C=1;break e}catch{}C=void 0}if(C)return!0}return!1},environ_get:(s,l)=>{var d=0;return di().forEach(function(y,A){var C=l+d;for(A=_e[s+4*A>>2]=C,C=0;C<y.length;++C)O[A++>>0]=y.charCodeAt(C);O[A>>0]=0,d+=y.length+1}),0},environ_sizes_get:(s,l)=>{var d=di();_e[s>>2]=d.length;var y=0;return d.forEach(function(A){y+=A.length+1}),_e[l>>2]=y,0},fd_close:function(s){try{var l=Pt(s);if(l.X===null)throw new Le(8);l.Ma&&(l.Ma=null);try{l.m.close&&l.m.close(l)}catch(d){throw d}finally{Rt[l.X]=null}return l.X=null,0}catch(d){if(typeof Mt>"u"||d.name!=="ErrnoError")throw d;return d.aa}},fd_read:function(s,l,d,y){try{e:{var A=Pt(s);s=l;for(var C,H=l=0;H<d;H++){var se=_e[s>>2],fe=_e[s+4>>2];s+=8;var ee=A,Ee=se,Te=fe,Me=C,J=O;if(0>Te||0>Me)throw new Le(28);if(ee.X===null)throw new Le(8);if((ee.flags&2097155)===1)throw new Le(8);if((ee.node.mode&61440)===16384)throw new Le(31);if(!ee.m.read)throw new Le(28);var $e=typeof Me<"u";if(!$e)Me=ee.position;else if(!ee.seekable)throw new Le(70);var we=ee.m.read(ee,J,Ee,Te,Me);$e||(ee.position+=we);var Ve=we;if(0>Ve){var ze=-1;break e}if(l+=Ve,Ve<fe)break;typeof C<"u"&&(C+=Ve)}ze=l}return _e[y>>2]=ze,0}catch(Pe){if(typeof Mt>"u"||Pe.name!=="ErrnoError")throw Pe;return Pe.aa}},fd_seek:function(s,l,d,y,A){l=d+2097152>>>0<4194305-!!l?(l>>>0)+4294967296*d:NaN;try{if(isNaN(l))return 61;var C=Pt(s);return Hr(C,l,y),w=[C.position>>>0,(De=C.position,1<=+Math.abs(De)?0<De?+Math.floor(De/4294967296)>>>0:~~+Math.ceil((De-+(~~De>>>0))/4294967296)>>>0:0)],ae[A>>2]=w[0],ae[A+4>>2]=w[1],C.Ma&&l===0&&y===0&&(C.Ma=null),0}catch(H){if(typeof Mt>"u"||H.name!=="ErrnoError")throw H;return H.aa}},fd_write:function(s,l,d,y){try{e:{var A=Pt(s);s=l;for(var C,H=l=0;H<d;H++){var se=_e[s>>2],fe=_e[s+4>>2];s+=8;var ee=A,Ee=se,Te=fe,Me=C,J=O;if(0>Te||0>Me)throw new Le(28);if(ee.X===null)throw new Le(8);if((ee.flags&2097155)===0)throw new Le(8);if((ee.node.mode&61440)===16384)throw new Le(31);if(!ee.m.write)throw new Le(28);ee.seekable&&ee.flags&1024&&Hr(ee,0,2);var $e=typeof Me<"u";if(!$e)Me=ee.position;else if(!ee.seekable)throw new Le(70);var we=ee.m.write(ee,J,Ee,Te,Me,void 0);$e||(ee.position+=we);var Ve=we;if(0>Ve){var ze=-1;break e}l+=Ve,typeof C<"u"&&(C+=Ve)}ze=l}return _e[y>>2]=ze,0}catch(Pe){if(typeof Mt>"u"||Pe.name!=="ErrnoError")throw Pe;return Pe.aa}},strftime_l:(s,l,d,y)=>Xi(s,l,d,y)};(function(){function s(d){if(N=d=d.exports,q=N.memory,le(),Q=N.__indirect_function_table,Y.unshift(N.__wasm_call_ctors),te--,_.monitorRunDependencies&&_.monitorRunDependencies(te),te==0&&he){var y=he;he=null,y()}return d}var l={env:gi,wasi_snapshot_preview1:gi};if(te++,_.monitorRunDependencies&&_.monitorRunDependencies(te),_.instantiateWasm)try{return _.instantiateWasm(l,s)}catch(d){ue("Module.instantiateWasm callback failed with error: "+d),T(d)}return Be(l,function(d){s(d.instance)}).catch(T),{}})();var Ct=s=>(Ct=N.free)(s),Dr=s=>(Dr=N.malloc)(s),pi=()=>(pi=N.__errno_location)(),mi=_._ma_device__on_notification_unlocked=s=>(mi=_._ma_device__on_notification_unlocked=N.ma_device__on_notification_unlocked)(s);_._ma_malloc_emscripten=(s,l)=>(_._ma_malloc_emscripten=N.ma_malloc_emscripten)(s,l),_._ma_free_emscripten=(s,l)=>(_._ma_free_emscripten=N.ma_free_emscripten)(s,l);var bi=_._ma_device_process_pcm_frames_capture__webaudio=(s,l,d)=>(bi=_._ma_device_process_pcm_frames_capture__webaudio=N.ma_device_process_pcm_frames_capture__webaudio)(s,l,d),yi=_._ma_device_process_pcm_frames_playback__webaudio=(s,l,d)=>(yi=_._ma_device_process_pcm_frames_playback__webaudio=N.ma_device_process_pcm_frames_playback__webaudio)(s,l,d),wi=s=>(wi=N.__getTypeName)(s);_.__embind_initialize_bindings=()=>(_.__embind_initialize_bindings=N._embind_initialize_bindings)(),_.dynCall_iiji=(s,l,d,y,A)=>(_.dynCall_iiji=N.dynCall_iiji)(s,l,d,y,A),_.dynCall_jiji=(s,l,d,y,A)=>(_.dynCall_jiji=N.dynCall_jiji)(s,l,d,y,A),_.dynCall_iiiji=(s,l,d,y,A,C)=>(_.dynCall_iiiji=N.dynCall_iiiji)(s,l,d,y,A,C),_.dynCall_iij=(s,l,d,y)=>(_.dynCall_iij=N.dynCall_iij)(s,l,d,y),_.dynCall_jii=(s,l,d)=>(_.dynCall_jii=N.dynCall_jii)(s,l,d),_.dynCall_viijii=(s,l,d,y,A,C,H)=>(_.dynCall_viijii=N.dynCall_viijii)(s,l,d,y,A,C,H),_.dynCall_iiiiij=(s,l,d,y,A,C,H)=>(_.dynCall_iiiiij=N.dynCall_iiiiij)(s,l,d,y,A,C,H),_.dynCall_iiiiijj=(s,l,d,y,A,C,H,se,fe)=>(_.dynCall_iiiiijj=N.dynCall_iiiiijj)(s,l,d,y,A,C,H,se,fe),_.dynCall_iiiiiijj=(s,l,d,y,A,C,H,se,fe,ee)=>(_.dynCall_iiiiiijj=N.dynCall_iiiiiijj)(s,l,d,y,A,C,H,se,fe,ee);var wr;he=function s(){wr||$i(),wr||(he=s)};function $i(){function s(){if(!wr&&(wr=!0,_.calledRun=!0,!M)){if(_.noFSInit||Kr||(Kr=!0,zr(),_.stdin=_.stdin,_.stdout=_.stdout,_.stderr=_.stderr,_.stdin?Vt("stdin",_.stdin):Sr("/dev/tty","/dev/stdin"),_.stdout?Vt("stdout",null,_.stdout):Sr("/dev/tty","/dev/stdout"),_.stderr?Vt("stderr",null,_.stderr):Sr("/dev/tty1","/dev/stderr"),nr("/dev/stdin",0),nr("/dev/stdout",1),nr("/dev/stderr",1)),Nr=!1,h(Y),E(_),_.onRuntimeInitialized&&_.onRuntimeInitialized(),_.postRun)for(typeof _.postRun=="function"&&(_.postRun=[_.postRun]);_.postRun.length;){var l=_.postRun.shift();Z.unshift(l)}h(Z)}}if(!(0<te)){if(_.preRun)for(typeof _.preRun=="function"&&(_.preRun=[_.preRun]);_.preRun.length;)ce();h(ne),0<te||(_.setStatus?(_.setStatus("Running..."),setTimeout(function(){setTimeout(function(){_.setStatus("")},1),s()},1)):s())}}if(_.preInit)for(typeof _.preInit=="function"&&(_.preInit=[_.preInit]);0<_.preInit.length;)_.preInit.pop()();return $i(),$.ready})})();const g=v}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,f,p)=>{p.r(f),p.d(f,{Animation:()=>v.Animation});var v=p(4)}),((u,f,p)=>{p.r(f),p.d(f,{Animation:()=>v});var v=(function(){function g(m,$,_,E){this.animation=m,this.artboard=$,this.playing=E,this.loopCount=0,this.scrubTo=null,this.instance=new _.LinearAnimationInstance(m,$)}return Object.defineProperty(g.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"time",{get:function(){return this.instance.time},set:function(m){this.instance.time=m},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),g.prototype.advance=function(m){this.scrubTo===null?this.instance.advance(m):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},g.prototype.apply=function(m){this.instance.apply(m)},g.prototype.cleanup=function(){this.instance.delete()},g})()}),((u,f,p)=>{p.r(f),p.d(f,{AudioAssetWrapper:()=>m.AudioAssetWrapper,AudioWrapper:()=>m.AudioWrapper,BLANK_URL:()=>g.BLANK_URL,CustomFileAssetLoaderWrapper:()=>m.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>m.FileAssetWrapper,Finalizable:()=>m.Finalizable,FontAssetWrapper:()=>m.FontAssetWrapper,FontWrapper:()=>m.FontWrapper,ImageAssetWrapper:()=>m.ImageAssetWrapper,ImageWrapper:()=>m.ImageWrapper,finalizationRegistry:()=>m.finalizationRegistry,registerTouchInteractions:()=>v.registerTouchInteractions,sanitizeUrl:()=>g.sanitizeUrl});var v=p(6),g=p(7),m=p(8)}),((u,f,p)=>{p.r(f),p.d(f,{registerTouchInteractions:()=>m});var v=void 0,g=function($,_){var E,T;return["touchstart","touchmove"].indexOf($.type)>-1&&(!((E=$.touches)===null||E===void 0)&&E.length)?(_||$.preventDefault(),{clientX:$.touches[0].clientX,clientY:$.touches[0].clientY}):$.type==="touchend"&&(!((T=$.changedTouches)===null||T===void 0)&&T.length)?{clientX:$.changedTouches[0].clientX,clientY:$.changedTouches[0].clientY}:{clientX:$.clientX,clientY:$.clientY}},m=function($){var _=$.canvas,E=$.artboard,T=$.stateMachines,x=T===void 0?[]:T,D=$.renderer,P=$.rive,R=$.fit,F=$.alignment,V=$.isTouchScrollEnabled,I=V===void 0?!1:V,k=$.layoutScaleFactor,U=k===void 0?1:k;if(!_||!x.length||!D||!P||!E||typeof window>"u")return null;var W=null,B=!1,L=function(re){if(B&&re instanceof MouseEvent){re.type=="mouseup"&&(B=!1);return}B=I&&re.type==="touchend"&&W==="touchstart",W=re.type;var ue=re.currentTarget.getBoundingClientRect(),z=g(re,I),q=z.clientX,N=z.clientY;if(!(!q&&!N)){var M=q-ue.left,O=N-ue.top,K=P.computeAlignment(R,F,{minX:0,minY:0,maxX:ue.width,maxY:ue.height},E.bounds,U),oe=new P.Mat2D;K.invert(oe);var de=new P.Vec2D(M,O),ae=P.mapXY(oe,de),_e=ae.x(),me=ae.y();switch(ae.delete(),oe.delete(),de.delete(),K.delete(),re.type){case"mouseout":for(var be=0,le=x;be<le.length;be++){var Q=le[be];Q.pointerMove(_e,me)}break;case"touchmove":case"mouseover":case"mousemove":{for(var ne=0,Y=x;ne<Y.length;ne++){var Q=Y[ne];Q.pointerMove(_e,me)}break}case"touchstart":case"mousedown":{for(var Z=0,ce=x;Z<ce.length;Z++){var Q=ce[Z];Q.pointerDown(_e,me)}break}case"touchend":case"mouseup":{for(var te=0,he=x;te<he.length;te++){var Q=he[te];Q.pointerUp(_e,me)}break}}}},G=L.bind(v);return _.addEventListener("mouseover",G),_.addEventListener("mouseout",G),_.addEventListener("mousemove",G),_.addEventListener("mousedown",G),_.addEventListener("mouseup",G),_.addEventListener("touchmove",G,{passive:I}),_.addEventListener("touchstart",G,{passive:I}),_.addEventListener("touchend",G),function(){_.removeEventListener("mouseover",G),_.removeEventListener("mouseout",G),_.removeEventListener("mousemove",G),_.removeEventListener("mousedown",G),_.removeEventListener("mouseup",G),_.removeEventListener("touchmove",G),_.removeEventListener("touchstart",G),_.removeEventListener("touchend",G)}}}),((u,f,p)=>{p.r(f),p.d(f,{BLANK_URL:()=>T,sanitizeUrl:()=>P});var v=/^([^\w]*)(javascript|data|vbscript)/im,g=/&#(\w+)(^\w|;)?/g,m=/&(newline|tab);/gi,$=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,_=/^.+(:|&colon;)/gim,E=[".","/"],T="about:blank";function x(R){return E.indexOf(R[0])>-1}function D(R){var F=R.replace($,"");return F.replace(g,function(V,I){return String.fromCharCode(I)})}function P(R){if(!R)return T;var F=D(R).replace(m,"").replace($,"").trim();if(!F)return T;if(x(F))return F;var V=F.match(_);if(!V)return F;var I=V[0];return v.test(I)?T:F}}),((u,f,p)=>{p.r(f),p.d(f,{AudioAssetWrapper:()=>D,AudioWrapper:()=>$,CustomFileAssetLoaderWrapper:()=>E,FileAssetWrapper:()=>T,Finalizable:()=>g,FontAssetWrapper:()=>P,FontWrapper:()=>_,ImageAssetWrapper:()=>x,ImageWrapper:()=>m,finalizationRegistry:()=>V});var v=(function(){var I=function(k,U){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,B){W.__proto__=B}||function(W,B){for(var L in B)Object.prototype.hasOwnProperty.call(B,L)&&(W[L]=B[L])},I(k,U)};return function(k,U){if(typeof U!="function"&&U!==null)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");I(k,U);function W(){this.constructor=k}k.prototype=U===null?Object.create(U):(W.prototype=U.prototype,new W)}})(),g=(function(){function I(){this.selfUnref=!1}return I})(),m=(function(I){v(k,I);function k(U){var W=I.call(this)||this;return W._nativeImage=U,W}return Object.defineProperty(k.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},k})(g),$=(function(I){v(k,I);function k(U){var W=I.call(this)||this;return W._nativeAudio=U,W}return Object.defineProperty(k.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},k})(g),_=(function(I){v(k,I);function k(U){var W=I.call(this)||this;return W._nativeFont=U,W}return Object.defineProperty(k.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),k.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},k})(g),E=(function(){function I(k,U){this._assetLoaderCallback=U,this.assetLoader=new k.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return I.prototype.loadContents=function(k,U){var W;return k.isImage?W=new x(k):k.isAudio?W=new D(k):k.isFont&&(W=new P(k)),this._assetLoaderCallback(W,U)},I})(),T=(function(){function I(k){this._nativeFileAsset=k}return I.prototype.decode=function(k){this._nativeFileAsset.decode(k)},Object.defineProperty(I.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),I})(),x=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setRenderImage=function(U){this._nativeFileAsset.setRenderImage(U.nativeImage)},k})(T),D=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setAudioSource=function(U){this._nativeFileAsset.setAudioSource(U.nativeAudio)},k})(T),P=(function(I){v(k,I);function k(){return I!==null&&I.apply(this,arguments)||this}return k.prototype.setFont=function(U){this._nativeFileAsset.setFont(U.nativeFont)},k})(T),R=(function(){function I(k){}return I.prototype.register=function(k){k.selfUnref=!0},I.prototype.unregister=function(k){},I})(),F=typeof FinalizationRegistry<"u"?FinalizationRegistry:R,V=new F(function(I){I.unref()})})],i={};function n(u){var f=i[u];if(f!==void 0)return f.exports;var p=i[u]={exports:{}};return t[u](p,p.exports,n),p.exports}n.d=(u,f)=>{for(var p in f)n.o(f,p)&&!n.o(u,p)&&Object.defineProperty(u,p,{enumerable:!0,get:f[p]})},n.o=(u,f)=>Object.prototype.hasOwnProperty.call(u,f),n.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{Alignment:()=>P,DataEnum:()=>me,EventType:()=>L,Fit:()=>D,Layout:()=>R,LoopType:()=>G,Rive:()=>ae,RiveEventType:()=>k,RiveFile:()=>de,RuntimeLoader:()=>F,StateMachineInput:()=>I,StateMachineInputType:()=>V,Testing:()=>Re,ViewModel:()=>_e,ViewModelInstance:()=>le,ViewModelInstanceArtboard:()=>ge,ViewModelInstanceAssetImage:()=>pe,ViewModelInstanceBoolean:()=>Z,ViewModelInstanceColor:()=>ie,ViewModelInstanceEnum:()=>te,ViewModelInstanceList:()=>he,ViewModelInstanceNumber:()=>Y,ViewModelInstanceString:()=>ne,ViewModelInstanceTrigger:()=>ce,ViewModelInstanceValue:()=>Q,decodeAudio:()=>Ce,decodeFont:()=>De,decodeImage:()=>Be});var u=n(1),f=n(2),p=n(3),v=n(5),g=(function(){var w=function(c,h){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,j){S.__proto__=j}||function(S,j){for(var X in j)Object.prototype.hasOwnProperty.call(j,X)&&(S[X]=j[X])},w(c,h)};return function(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");w(c,h);function S(){this.constructor=c}c.prototype=h===null?Object.create(h):(S.prototype=h.prototype,new S)}})(),m=function(){return m=Object.assign||function(w){for(var c,h=1,S=arguments.length;h<S;h++){c=arguments[h];for(var j in c)Object.prototype.hasOwnProperty.call(c,j)&&(w[j]=c[j])}return w},m.apply(this,arguments)},$=function(w,c,h,S){function j(X){return X instanceof h?X:new h(function(ve){ve(X)})}return new(h||(h=Promise))(function(X,ve){function Ae(Fe){try{Se(S.next(Fe))}catch(We){ve(We)}}function je(Fe){try{Se(S.throw(Fe))}catch(We){ve(We)}}function Se(Fe){Fe.done?X(Fe.value):j(Fe.value).then(Ae,je)}Se((S=S.apply(w,c||[])).next())})},_=function(w,c){var h={label:0,sent:function(){if(X[0]&1)throw X[1];return X[1]},trys:[],ops:[]},S,j,X,ve=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return ve.next=Ae(0),ve.throw=Ae(1),ve.return=Ae(2),typeof Symbol=="function"&&(ve[Symbol.iterator]=function(){return this}),ve;function Ae(Se){return function(Fe){return je([Se,Fe])}}function je(Se){if(S)throw new TypeError("Generator is already executing.");for(;ve&&(ve=0,Se[0]&&(h=0)),h;)try{if(S=1,j&&(X=Se[0]&2?j.return:Se[0]?j.throw||((X=j.return)&&X.call(j),0):j.next)&&!(X=X.call(j,Se[1])).done)return X;switch(j=0,X&&(Se=[Se[0]&2,X.value]),Se[0]){case 0:case 1:X=Se;break;case 4:return h.label++,{value:Se[1],done:!1};case 5:h.label++,j=Se[1],Se=[0];continue;case 7:Se=h.ops.pop(),h.trys.pop();continue;default:if(X=h.trys,!(X=X.length>0&&X[X.length-1])&&(Se[0]===6||Se[0]===2)){h=0;continue}if(Se[0]===3&&(!X||Se[1]>X[0]&&Se[1]<X[3])){h.label=Se[1];break}if(Se[0]===6&&h.label<X[1]){h.label=X[1],X=Se;break}if(X&&h.label<X[2]){h.label=X[2],h.ops.push(Se);break}X[2]&&h.ops.pop(),h.trys.pop();continue}Se=c.call(w,h)}catch(Fe){Se=[6,Fe],j=0}finally{S=X=0}if(Se[0]&5)throw Se[1];return{value:Se[0]?Se[1]:void 0,done:!0}}},E=function(w,c,h){if(h||arguments.length===2)for(var S=0,j=c.length,X;S<j;S++)(X||!(S in c))&&(X||(X=Array.prototype.slice.call(c,0,S)),X[S]=c[S]);return w.concat(X||Array.prototype.slice.call(c))},T=(function(w){g(c,w);function c(){var h=w!==null&&w.apply(this,arguments)||this;return h.isHandledError=!0,h}return c})(Error),x=function(w){return w&&w.isHandledError?w.message:"Problem loading file; may be corrupt!"},D;(function(w){w.Cover="cover",w.Contain="contain",w.Fill="fill",w.FitWidth="fitWidth",w.FitHeight="fitHeight",w.None="none",w.ScaleDown="scaleDown",w.Layout="layout"})(D||(D={}));var P;(function(w){w.Center="center",w.TopLeft="topLeft",w.TopCenter="topCenter",w.TopRight="topRight",w.CenterLeft="centerLeft",w.CenterRight="centerRight",w.BottomLeft="bottomLeft",w.BottomCenter="bottomCenter",w.BottomRight="bottomRight"})(P||(P={}));var R=(function(){function w(c){var h,S,j,X,ve,Ae,je;this.fit=(h=c?.fit)!==null&&h!==void 0?h:D.Contain,this.alignment=(S=c?.alignment)!==null&&S!==void 0?S:P.Center,this.layoutScaleFactor=(j=c?.layoutScaleFactor)!==null&&j!==void 0?j:1,this.minX=(X=c?.minX)!==null&&X!==void 0?X:0,this.minY=(ve=c?.minY)!==null&&ve!==void 0?ve:0,this.maxX=(Ae=c?.maxX)!==null&&Ae!==void 0?Ae:0,this.maxY=(je=c?.maxY)!==null&&je!==void 0?je:0}return w.new=function(c){var h=c.fit,S=c.alignment,j=c.minX,X=c.minY,ve=c.maxX,Ae=c.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new w({fit:h,alignment:S,minX:j,minY:X,maxX:ve,maxY:Ae})},w.prototype.copyWith=function(c){var h=c.fit,S=c.alignment,j=c.layoutScaleFactor,X=c.minX,ve=c.minY,Ae=c.maxX,je=c.maxY;return new w({fit:h??this.fit,alignment:S??this.alignment,layoutScaleFactor:j??this.layoutScaleFactor,minX:X??this.minX,minY:ve??this.minY,maxX:Ae??this.maxX,maxY:je??this.maxY})},w.prototype.runtimeFit=function(c){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var h;return this.fit===D.Cover?h=c.Fit.cover:this.fit===D.Contain?h=c.Fit.contain:this.fit===D.Fill?h=c.Fit.fill:this.fit===D.FitWidth?h=c.Fit.fitWidth:this.fit===D.FitHeight?h=c.Fit.fitHeight:this.fit===D.ScaleDown?h=c.Fit.scaleDown:this.fit===D.Layout?h=c.Fit.layout:h=c.Fit.none,this.cachedRuntimeFit=h,h},w.prototype.runtimeAlignment=function(c){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var h;return this.alignment===P.TopLeft?h=c.Alignment.topLeft:this.alignment===P.TopCenter?h=c.Alignment.topCenter:this.alignment===P.TopRight?h=c.Alignment.topRight:this.alignment===P.CenterLeft?h=c.Alignment.centerLeft:this.alignment===P.CenterRight?h=c.Alignment.centerRight:this.alignment===P.BottomLeft?h=c.Alignment.bottomLeft:this.alignment===P.BottomCenter?h=c.Alignment.bottomCenter:this.alignment===P.BottomRight?h=c.Alignment.bottomRight:h=c.Alignment.center,this.cachedRuntimeAlignment=h,h},w})(),F=(function(){function w(){}return w.loadRuntime=function(){u.default({locateFile:function(){return w.wasmURL}}).then(function(c){var h;for(w.runtime=c;w.callBackQueue.length>0;)(h=w.callBackQueue.shift())===null||h===void 0||h(w.runtime)}).catch(function(c){var h={message:c?.message||"Unknown error",type:c?.name||"Error",wasmError:c instanceof WebAssembly.CompileError||c instanceof WebAssembly.RuntimeError,originalError:c};console.debug("Rive WASM load error details:",h);var S="https://cdn.jsdelivr.net/npm/".concat(f.name,"@").concat(f.version,"/rive_fallback.wasm");if(w.wasmURL.toLowerCase()!==S)console.warn("Failed to load WASM from ".concat(w.wasmURL," (").concat(h.message,"), trying jsdelivr as a backup")),w.setWasmUrl(S),w.loadRuntime();else{var j=["Could not load Rive WASM file from ".concat(w.wasmURL," or ").concat(S,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(h.type),"- Message: ".concat(h.message),"- WebAssembly-specific error: ".concat(h.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(j)}})},w.getInstance=function(c){w.isLoading||(w.isLoading=!0,w.loadRuntime()),w.runtime?c(w.runtime):w.callBackQueue.push(c)},w.awaitInstance=function(){return new Promise(function(c){return w.getInstance(function(h){return c(h)})})},w.setWasmUrl=function(c){w.wasmURL=c},w.getWasmUrl=function(){return w.wasmURL},w.isLoading=!1,w.callBackQueue=[],w.wasmURL="https://unpkg.com/".concat(f.name,"@").concat(f.version,"/rive.wasm"),w})(),V;(function(w){w[w.Number=56]="Number",w[w.Trigger=58]="Trigger",w[w.Boolean=59]="Boolean"})(V||(V={}));var I=(function(){function w(c,h){this.type=c,this.runtimeInput=h}return Object.defineProperty(w.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(c){this.runtimeInput.value=c},enumerable:!1,configurable:!0}),w.prototype.fire=function(){this.type===V.Trigger&&this.runtimeInput.fire()},w.prototype.delete=function(){this.runtimeInput=null},w})(),k;(function(w){w[w.General=128]="General",w[w.OpenUrl=131]="OpenUrl"})(k||(k={}));var U=(function(){function w(c){this.nativeArtboard=c}return w})(),W=(function(){function w(c,h,S,j){this.stateMachine=c,this.playing=S,this.artboard=j,this.inputs=[],this.instance=new h.StateMachineInstance(c,j),this.initInputs(h)}return Object.defineProperty(w.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"statesChanged",{get:function(){for(var c=[],h=0;h<this.instance.stateChangedCount();h++)c.push(this.instance.stateChangedNameByIndex(h));return c},enumerable:!1,configurable:!0}),w.prototype.advance=function(c){this.instance.advance(c)},w.prototype.advanceAndApply=function(c){this.instance.advanceAndApply(c)},w.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},w.prototype.reportedEventAt=function(c){return this.instance.reportedEventAt(c)},w.prototype.initInputs=function(c){for(var h=0;h<this.instance.inputCount();h++){var S=this.instance.input(h);this.inputs.push(this.mapRuntimeInput(S,c))}},w.prototype.mapRuntimeInput=function(c,h){if(c.type===h.SMIInput.bool)return new I(V.Boolean,c.asBool());if(c.type===h.SMIInput.number)return new I(V.Number,c.asNumber());if(c.type===h.SMIInput.trigger)return new I(V.Trigger,c.asTrigger())},w.prototype.cleanup=function(){this.inputs.forEach(function(c){c.delete()}),this.inputs.length=0,this.instance.delete()},w.prototype.bindViewModelInstance=function(c){c.runtimeInstance!=null&&this.instance.bindViewModelInstance(c.runtimeInstance)},w})(),B=(function(){function w(c,h,S,j,X){j===void 0&&(j=[]),X===void 0&&(X=[]),this.runtime=c,this.artboard=h,this.eventManager=S,this.animations=j,this.stateMachines=X}return w.prototype.add=function(c,h,S){if(S===void 0&&(S=!0),c=ke(c),c.length===0)this.animations.forEach(function(Ze){return Ze.playing=h}),this.stateMachines.forEach(function(Ze){return Ze.playing=h});else for(var j=this.animations.map(function(Ze){return Ze.name}),X=this.stateMachines.map(function(Ze){return Ze.name}),ve=0;ve<c.length;ve++){var Ae=j.indexOf(c[ve]),je=X.indexOf(c[ve]);if(Ae>=0||je>=0)Ae>=0?this.animations[Ae].playing=h:this.stateMachines[je].playing=h;else{var Se=this.artboard.animationByName(c[ve]);if(Se){var Fe=new p.Animation(Se,this.artboard,this.runtime,h);Fe.advance(0),Fe.apply(1),this.animations.push(Fe)}else{var We=this.artboard.stateMachineByName(c[ve]);if(We){var et=new W(We,this.runtime,h,this.artboard);this.stateMachines.push(et)}}}}return S&&(h?this.eventManager.fire({type:L.Play,data:this.playing}):this.eventManager.fire({type:L.Pause,data:this.paused})),h?this.playing:this.paused},w.prototype.initLinearAnimations=function(c,h){for(var S=this.animations.map(function(je){return je.name}),j=0;j<c.length;j++){var X=S.indexOf(c[j]);if(X>=0)this.animations[X].playing=h;else{var ve=this.artboard.animationByName(c[j]);if(ve){var Ae=new p.Animation(ve,this.artboard,this.runtime,h);Ae.advance(0),Ae.apply(1),this.animations.push(Ae)}else console.error("Animation with name ".concat(c[j]," not found."))}}},w.prototype.initStateMachines=function(c,h){for(var S=this.stateMachines.map(function(je){return je.name}),j=0;j<c.length;j++){var X=S.indexOf(c[j]);if(X>=0)this.stateMachines[X].playing=h;else{var ve=this.artboard.stateMachineByName(c[j]);if(ve){var Ae=new W(ve,this.runtime,h,this.artboard);this.stateMachines.push(Ae),h||Ae.advanceAndApply(0)}else console.warn("State Machine with name ".concat(c[j]," not found.")),this.initLinearAnimations([c[j]],h)}}},w.prototype.play=function(c){return this.add(c,!0)},w.prototype.pause=function(c){return this.add(c,!1)},w.prototype.scrub=function(c,h){var S=this.animations.filter(function(j){return c.includes(j.name)});return S.forEach(function(j){return j.scrubTo=h}),S.map(function(j){return j.name})},Object.defineProperty(w.prototype,"playing",{get:function(){return this.animations.filter(function(c){return c.playing}).map(function(c){return c.name}).concat(this.stateMachines.filter(function(c){return c.playing}).map(function(c){return c.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"paused",{get:function(){return this.animations.filter(function(c){return!c.playing}).map(function(c){return c.name}).concat(this.stateMachines.filter(function(c){return!c.playing}).map(function(c){return c.name}))},enumerable:!1,configurable:!0}),w.prototype.stop=function(c){var h=this;c=ke(c);var S=[];if(c.length===0)S=this.animations.map(function(ve){return ve.name}).concat(this.stateMachines.map(function(ve){return ve.name})),this.animations.forEach(function(ve){return ve.cleanup()}),this.stateMachines.forEach(function(ve){return ve.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var j=this.animations.filter(function(ve){return c.includes(ve.name)});j.forEach(function(ve){ve.cleanup(),h.animations.splice(h.animations.indexOf(ve),1)});var X=this.stateMachines.filter(function(ve){return c.includes(ve.name)});X.forEach(function(ve){ve.cleanup(),h.stateMachines.splice(h.stateMachines.indexOf(ve),1)}),S=j.map(function(ve){return ve.name}).concat(X.map(function(ve){return ve.name}))}return this.eventManager.fire({type:L.Stop,data:S}),S},Object.defineProperty(w.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(c,h){return c||h.playing},!1)||this.stateMachines.reduce(function(c,h){return c||h.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),w.prototype.atLeastOne=function(c,h){h===void 0&&(h=!0);var S;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([S=this.artboard.animationByIndex(0).name],c,h):this.artboard.stateMachineCount()>0&&this.add([S=this.artboard.stateMachineByIndex(0).name],c,h)),S},w.prototype.handleLooping=function(){for(var c=0,h=this.animations.filter(function(j){return j.playing});c<h.length;c++){var S=h[c];S.loopValue===0&&S.loopCount?(S.loopCount=0,this.stop(S.name)):S.loopValue===1&&S.loopCount?(this.eventManager.fire({type:L.Loop,data:{animation:S.name,type:G.Loop}}),S.loopCount=0):S.loopValue===2&&S.loopCount>1&&(this.eventManager.fire({type:L.Loop,data:{animation:S.name,type:G.PingPong}}),S.loopCount=0)}},w.prototype.handleStateChanges=function(){for(var c=[],h=0,S=this.stateMachines.filter(function(X){return X.playing});h<S.length;h++){var j=S[h];c.push.apply(c,j.statesChanged)}c.length>0&&this.eventManager.fire({type:L.StateChange,data:c})},w.prototype.handleAdvancing=function(c){this.eventManager.fire({type:L.Advance,data:c})},w})(),L;(function(w){w.Load="load",w.LoadError="loaderror",w.Play="play",w.Pause="pause",w.Stop="stop",w.Loop="loop",w.Draw="draw",w.Advance="advance",w.StateChange="statechange",w.RiveEvent="riveevent",w.AudioStatusChange="audiostatuschange"})(L||(L={}));var G;(function(w){w.OneShot="oneshot",w.Loop="loop",w.PingPong="pingpong"})(G||(G={}));var re=(function(){function w(c){c===void 0&&(c=[]),this.listeners=c}return w.prototype.getListeners=function(c){return this.listeners.filter(function(h){return h.type===c})},w.prototype.add=function(c){this.listeners.includes(c)||this.listeners.push(c)},w.prototype.remove=function(c){for(var h=0;h<this.listeners.length;h++){var S=this.listeners[h];if(S.type===c.type&&S.callback===c.callback){this.listeners.splice(h,1);break}}},w.prototype.removeAll=function(c){var h=this;c?this.listeners.filter(function(S){return S.type===c}).forEach(function(S){return h.remove(S)}):this.listeners.splice(0,this.listeners.length)},w.prototype.fire=function(c){var h=this.getListeners(c.type);h.forEach(function(S){return S.callback(c)})},w})(),ue=(function(){function w(c){this.eventManager=c,this.queue=[]}return w.prototype.add=function(c){this.queue.push(c)},w.prototype.process=function(){for(;this.queue.length>0;){var c=this.queue.shift();c?.action&&c.action(),c?.event&&this.eventManager.fire(c.event)}},w})(),z;(function(w){w[w.AVAILABLE=0]="AVAILABLE",w[w.UNAVAILABLE=1]="UNAVAILABLE"})(z||(z={}));var q=(function(w){g(c,w);function c(){var h=w!==null&&w.apply(this,arguments)||this;return h._started=!1,h._enabled=!1,h._status=z.UNAVAILABLE,h}return c.prototype.delay=function(h){return $(this,void 0,void 0,function(){return _(this,function(S){return[2,new Promise(function(j){return setTimeout(j,h)})]})})},c.prototype.timeout=function(){return $(this,void 0,void 0,function(){return _(this,function(h){return[2,new Promise(function(S,j){return setTimeout(j,50)})]})})},c.prototype.reportToListeners=function(){this.fire({type:L.AudioStatusChange}),this.removeAll()},c.prototype.enableAudio=function(){return $(this,void 0,void 0,function(){return _(this,function(h){return this._enabled||(this._enabled=!0,this._status=z.AVAILABLE,this.reportToListeners()),[2]})})},c.prototype.testAudio=function(){return $(this,void 0,void 0,function(){return _(this,function(h){switch(h.label){case 0:if(!(this._status===z.UNAVAILABLE&&this._audioContext!==null))return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return h.sent(),this.enableAudio(),[3,4];case 3:return h.sent(),[3,4];case 4:return[2]}})})},c.prototype._establishAudio=function(){return $(this,void 0,void 0,function(){return _(this,function(h){switch(h.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),h.label=2;case 2:return this._status!==z.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return h.sent(),[4,this.delay(1e3)];case 4:return h.sent(),[3,2];case 5:return[2]}})})},c.prototype.listenForUserAction=function(){var h=this,S=function(){return $(h,void 0,void 0,function(){return _(this,function(j){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",S,{once:!0})},c.prototype.establishAudio=function(){return $(this,void 0,void 0,function(){return _(this,function(h){return this._establishAudio(),[2]})})},Object.defineProperty(c.prototype,"systemVolume",{get:function(){return this._status===z.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),c})(re),N=new q,M=(function(){function w(){}return w.prototype.observe=function(){},w.prototype.unobserve=function(){},w.prototype.disconnect=function(){},w})(),O=globalThis.ResizeObserver||M,K=(function(){function w(){var c=this;this._elementsMap=new Map,this._onObservedEntry=function(h){var S=c._elementsMap.get(h.target);S!==null?S.onResize(h.target.clientWidth==0||h.target.clientHeight==0):c._resizeObserver.unobserve(h.target)},this._onObserved=function(h){h.forEach(c._onObservedEntry)},this._resizeObserver=new O(this._onObserved)}return w.prototype.add=function(c,h){var S={onResize:h,element:c};return this._elementsMap.set(c,S),this._resizeObserver.observe(c),S},w.prototype.remove=function(c){this._resizeObserver.unobserve(c.element),this._elementsMap.delete(c.element)},w})(),oe=new K,de=(function(){function w(c){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=c.src,this.buffer=c.buffer,c.assetLoader&&(this.assetLoader=c.assetLoader),this.enableRiveAssetCDN=typeof c.enableRiveAssetCDN=="boolean"?c.enableRiveAssetCDN:!0,this.eventManager=new re,c.onLoad&&this.on(L.Load,c.onLoad),c.onLoadError&&this.on(L.LoadError,c.onLoadError)}return w.prototype.initData=function(){return $(this,void 0,void 0,function(){var c,h,S,j,X;return _(this,function(ve){switch(ve.label){case 0:return this.src?(c=this,[4,Ie(this.src)]):[3,2];case 1:c.buffer=ve.sent(),ve.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(S=new v.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),h=S.assetLoader),j=this,[4,this.runtime.load(new Uint8Array(this.buffer),h,this.enableRiveAssetCDN)]);case 3:return j.file=ve.sent(),this.destroyed?((X=this.file)===null||X===void 0||X.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:L.Load,data:this}):this.fireLoadError(w.fileLoadErrorMessage),[2])}})})},w.prototype.init=function(){return $(this,void 0,void 0,function(){var c,h;return _(this,function(S){switch(S.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(w.missingErrorMessage),[2];S.label=1;case 1:return S.trys.push([1,4,,5]),c=this,[4,F.awaitInstance()];case 2:return c.runtime=S.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return S.sent(),[3,5];case 4:return h=S.sent(),this.fireLoadError(h instanceof Error?h.message:w.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},w.prototype.fireLoadError=function(c){throw this.eventManager.fire({type:L.LoadError,data:c}),new Error(c)},w.prototype.on=function(c,h){this.eventManager.add({type:c,callback:h})},w.prototype.off=function(c,h){this.eventManager.remove({type:c,callback:h})},w.prototype.cleanup=function(){var c;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(c=this.file)===null||c===void 0||c.delete(),this.file=null,this.destroyed=!0)},w.prototype.removeAllRiveEventListeners=function(c){this.eventManager.removeAll(c)},w.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},w.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},w.prototype.getArtboard=function(c){var h=this.file.artboardByName(c);return h!=null?new U(h):null},w.missingErrorMessage="Rive source file or data buffer required",w.fileLoadErrorMessage="The file failed to load",w})(),ae=(function(){function w(c){var h=this,S;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(j){var X=h._hasZeroSize!==j;h._hasZeroSize=j,j?(!h._layout.maxX||!h._layout.maxY)&&h.resizeToCanvas():X&&h.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=c.canvas,c.canvas.constructor===HTMLCanvasElement&&(this._observed=oe.add(this.canvas,this.onCanvasResize)),this.src=c.src,this.buffer=c.buffer,this.riveFile=c.riveFile,this.layout=(S=c.layout)!==null&&S!==void 0?S:new R,this.shouldDisableRiveListeners=!!c.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!c.isTouchScrollEnabled,this.automaticallyHandleEvents=!!c.automaticallyHandleEvents,this.enableRiveAssetCDN=c.enableRiveAssetCDN===void 0?!0:c.enableRiveAssetCDN,this.eventManager=new re,c.onLoad&&this.on(L.Load,c.onLoad),c.onLoadError&&this.on(L.LoadError,c.onLoadError),c.onPlay&&this.on(L.Play,c.onPlay),c.onPause&&this.on(L.Pause,c.onPause),c.onStop&&this.on(L.Stop,c.onStop),c.onLoop&&this.on(L.Loop,c.onLoop),c.onStateChange&&this.on(L.StateChange,c.onStateChange),c.onAdvance&&this.on(L.Advance,c.onAdvance),c.onload&&!c.onLoad&&this.on(L.Load,c.onload),c.onloaderror&&!c.onLoadError&&this.on(L.LoadError,c.onloaderror),c.onplay&&!c.onPlay&&this.on(L.Play,c.onplay),c.onpause&&!c.onPause&&this.on(L.Pause,c.onpause),c.onstop&&!c.onStop&&this.on(L.Stop,c.onstop),c.onloop&&!c.onLoop&&this.on(L.Loop,c.onloop),c.onstatechange&&!c.onStateChange&&this.on(L.StateChange,c.onstatechange),c.assetLoader&&(this.assetLoader=c.assetLoader),this.taskQueue=new ue(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:c.autoplay,autoBind:c.autoBind,animations:c.animations,stateMachines:c.stateMachines,artboard:c.artboard,useOffscreenRenderer:c.useOffscreenRenderer})}return Object.defineProperty(w.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),w.new=function(c){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new w(c)},w.prototype.onSystemAudioChanged=function(){this.volume=this._volume},w.prototype.init=function(c){var h=this,S=c.src,j=c.buffer,X=c.riveFile,ve=c.animations,Ae=c.stateMachines,je=c.artboard,Se=c.autoplay,Fe=Se===void 0?!1:Se,We=c.useOffscreenRenderer,et=We===void 0?!1:We,Ze=c.autoBind,ct=Ze===void 0?!1:Ze;if(!this.destroyed){if(this.src=S,this.buffer=j,this.riveFile=X,!this.src&&!this.buffer&&!this.riveFile)throw new T(w.missingErrorMessage);var lt=ke(ve),at=ke(Ae);this.loaded=!1,this.readyForPlaying=!1,F.awaitInstance().then(function(qe){h.destroyed||(h.runtime=qe,h.removeRiveListeners(),h.deleteRiveRenderer(),h.renderer=h.runtime.makeRenderer(h.canvas,et),h.canvas.width||h.canvas.height||h.resizeDrawingSurfaceToCanvas(),h.initData(je,lt,at,Fe,ct).then(function(Ue){if(Ue)return h.setupRiveListeners()}).catch(function(Ue){console.error(Ue)}))}).catch(function(qe){console.error(qe)})}},w.prototype.setupRiveListeners=function(c){var h=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var S=(this.animator.stateMachines||[]).filter(function(X){return X.playing&&h.runtime.hasListeners(X.instance)}).map(function(X){return X.instance}),j=this.isTouchScrollEnabled;c&&"isTouchScrollEnabled"in c&&(j=c.isTouchScrollEnabled),this.eventCleanup=(0,v.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:S,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:j,layoutScaleFactor:this._layout.layoutScaleFactor})}},w.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},w.prototype.initializeAudio=function(){var c=this,h;N.status==z.UNAVAILABLE&&!((h=this.artboard)===null||h===void 0)&&h.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:L.AudioStatusChange,callback:function(){return c.onSystemAudioChanged()}},N.add(this._audioEventListener),N.establishAudio())},w.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},w.prototype.initData=function(c,h,S,j,X){return $(this,void 0,void 0,function(){var ve,Ae,je,Se;return _(this,function(Fe){switch(Fe.label){case 0:return Fe.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(ve=new de({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=ve,[4,ve.init()]);case 1:if(Fe.sent(),this.destroyed)return ve.destroyIfUnused(),[2,!1];Fe.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(c,h,S,j,X),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:L.Load,data:(Se=this.src)!==null&&Se!==void 0?Se:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Ae=Fe.sent(),je=x(Ae),console.warn(je),this.eventManager.fire({type:L.LoadError,data:je}),[2,Promise.reject(je)];case 4:return[2]}})})},w.prototype.initArtboard=function(c,h,S,j,X){if(this.file){var ve=c?this.file.artboardByName(c):this.file.defaultArtboard();if(!ve){var Ae="Invalid artboard name or no default artboard";console.warn(Ae),this.eventManager.fire({type:L.LoadError,data:Ae});return}if(this.artboard=ve,ve.volume=this._volume*N.systemVolume,this.artboard.animationCount()<1){var Ae="Artboard has no animations";throw this.eventManager.fire({type:L.LoadError,data:Ae}),Ae}this.animator=new B(this.runtime,this.artboard,this.eventManager);var je;if(h.length>0||S.length>0?(je=h.concat(S),this.animator.initLinearAnimations(h,j),this.animator.initStateMachines(S,j)):je=[this.animator.atLeastOne(j,!1)],this.taskQueue.add({event:{type:j?L.Play:L.Pause,data:je}}),X){var Se=this.file.defaultArtboardViewModel(ve);if(Se!==null){var Fe=Se.defaultInstance();if(Fe!==null){var We=new le(Fe,null);this.bindViewModelInstance(We)}}}}},w.prototype.drawFrame=function(){var c,h;!((c=document?.timeline)===null||c===void 0)&&c.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(h=this.runtime)===null||h===void 0||h.resolveAnimationFrame()):this.startRendering()},w.prototype.draw=function(c,h){var S;this.frameRequestId=null;var j=performance.now();this.lastRenderTime||(this.lastRenderTime=c),this.renderSecondTimer+=c-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,h?.());var X=(c-this.lastRenderTime)/1e3;this.lastRenderTime=c;for(var ve=this.animator.animations.filter(function(ut){return ut.playing||ut.needsScrub}).sort(function(ut){return ut.needsScrub?-1:1}),Ae=0,je=ve;Ae<je.length;Ae++){var Se=je[Ae];Se.advance(X),Se.instance.didLoop&&(Se.loopCount+=1),Se.apply(1)}for(var Fe=this.animator.stateMachines.filter(function(ut){return ut.playing}),We=0,et=Fe;We<et.length;We++){var Ze=et[We],ct=Ze.reportedEventCount();if(ct)for(var lt=0;lt<ct;lt++){var at=Ze.reportedEventAt(lt);if(at)if(at.type===k.OpenUrl){if(this.eventManager.fire({type:L.RiveEvent,data:at}),this.automaticallyHandleEvents){var qe=document.createElement("a"),Ue=at,it=Ue.url,nt=Ue.target,Je=(0,v.sanitizeUrl)(it);it&&qe.setAttribute("href",Je),nt&&qe.setAttribute("target",nt),Je&&Je!==v.BLANK_URL&&qe.click()}}else this.eventManager.fire({type:L.RiveEvent,data:at})}Ze.advanceAndApply(X)}this.animator.stateMachines.length==0&&this.artboard.advance(X);var xe=this.renderer;xe.clear(),xe.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(xe),xe.restore(),xe.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(X),this.frameCount++;var Ne=performance.now();for(this.frameTimes.push(Ne),this.durations.push(Ne-j);this.frameTimes[0]<=Ne-1e3;)this.frameTimes.shift(),this.durations.shift();(S=this._viewModelInstance)===null||S===void 0||S.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},w.prototype.alignRenderer=function(){var c=this,h=c.renderer,S=c.runtime,j=c._layout,X=c.artboard;h.align(j.runtimeFit(S),j.runtimeAlignment(S),{minX:j.minX,minY:j.minY,maxX:j.maxX,maxY:j.maxY},X.bounds,this._devicePixelRatioUsed*j.layoutScaleFactor)},Object.defineProperty(w.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(c,h){return c+h},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),w.prototype.cleanup=function(){var c,h;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&oe.remove(this._observed),this.removeRiveListeners(),this.file&&((c=this.riveFile)===null||c===void 0||c.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(N.remove(this._audioEventListener),this._audioEventListener=null),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=null,this._dataEnums=null},w.prototype.deleteRiveRenderer=function(){var c;(c=this.renderer)===null||c===void 0||c.delete(),this.renderer=null},w.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},w.prototype.retrieveTextRun=function(c){var h;if(!c){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var S=this.artboard.textRun(c);if(!S){console.warn("Could not access a text run with name '".concat(c,"' in the '").concat((h=this.artboard)===null||h===void 0?void 0:h.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return S},w.prototype.getTextRunValue=function(c){var h=this.retrieveTextRun(c);return h?h.text:void 0},w.prototype.setTextRunValue=function(c,h){var S=this.retrieveTextRun(c);S&&(S.text=h)},w.prototype.play=function(c,h){var S=this;if(c=ke(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return S.play(c,h)}});return}this.animator.play(c),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},w.prototype.pause=function(c){var h=this;if(c=ke(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.pause(c)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(c)},w.prototype.scrub=function(c,h){var S=this;if(c=ke(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return S.scrub(c,h)}});return}this.animator.scrub(c,h||0),this.drawFrame()},w.prototype.stop=function(c){var h=this;if(c=ke(c),!this.readyForPlaying){this.taskQueue.add({action:function(){return h.stop(c)}});return}this.animator&&this.animator.stop(c),this.eventCleanup&&this.eventCleanup()},w.prototype.reset=function(c){var h,S,j=c?.artboard,X=ke(c?.animations),ve=ke(c?.stateMachines),Ae=(h=c?.autoplay)!==null&&h!==void 0?h:!1,je=(S=c?.autoBind)!==null&&S!==void 0?S:!1;this.cleanupInstances(),this.initArtboard(j,X,ve,Ae,je),this.taskQueue.process()},w.prototype.load=function(c){this.file=null,this.stop(),this.init(c)},Object.defineProperty(w.prototype,"layout",{get:function(){return this._layout},set:function(c){this._layout=c,(!c.maxX||!c.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),w.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},w.prototype.resizeDrawingSurfaceToCanvas=function(c){if(this.canvas instanceof HTMLCanvasElement&&window){var h=this.canvas.getBoundingClientRect(),S=h.width,j=h.height,X=c||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=X,this.canvas.width=X*S,this.canvas.height=X*j,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===D.Layout){var ve=this._layout.layoutScaleFactor;this.artboard.width=S/ve,this.artboard.height=j/ve}}},Object.defineProperty(w.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var c=[],h=0;h<this.artboard.animationCount();h++)c.push(this.artboard.animationByIndex(h).name);return c},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var c=[],h=0;h<this.artboard.stateMachineCount();h++)c.push(this.artboard.stateMachineByIndex(h).name);return c},enumerable:!1,configurable:!0}),w.prototype.stateMachineInputs=function(c){if(this.loaded){var h=this.animator.stateMachines.find(function(S){return S.name===c});return h?.inputs}},w.prototype.retrieveInputAtPath=function(c,h){if(!c){console.warn("No input name provided for path '".concat(h,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(c,"', at path: '").concat(h,"', but the Artboard is null"));return}var S=this.artboard.inputByPath(c,h);if(!S){console.warn("Could not access an input with name: '".concat(c,"', at path:'").concat(h,"'"));return}return S},w.prototype.setBooleanStateAtPath=function(c,h,S){var j=this.retrieveInputAtPath(c,S);j&&(j.type===V.Boolean?j.asBool().value=h:console.warn("Input with name: '".concat(c,"', at path:'").concat(S,"' is not a boolean")))},w.prototype.setNumberStateAtPath=function(c,h,S){var j=this.retrieveInputAtPath(c,S);j&&(j.type===V.Number?j.asNumber().value=h:console.warn("Input with name: '".concat(c,"', at path:'").concat(S,"' is not a number")))},w.prototype.fireStateAtPath=function(c,h){var S=this.retrieveInputAtPath(c,h);S&&(S.type===V.Trigger?S.asTrigger().fire():console.warn("Input with name: '".concat(c,"', at path:'").concat(h,"' is not a trigger")))},w.prototype.retrieveTextAtPath=function(c,h){if(!c){console.warn("No text name provided for path '".concat(h,"'"));return}if(!h){console.warn("No path provided for text '".concat(c,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(c,"', at path: '").concat(h,"', but the Artboard is null"));return}var S=this.artboard.textByPath(c,h);if(!S){console.warn("Could not access text with name: '".concat(c,"', at path:'").concat(h,"'"));return}return S},w.prototype.getTextRunValueAtPath=function(c,h){var S=this.retrieveTextAtPath(c,h);if(!S){console.warn("Could not get text with name: '".concat(c,"', at path:'").concat(h,"'"));return}return S.text},w.prototype.setTextRunValueAtPath=function(c,h,S){var j=this.retrieveTextAtPath(c,S);if(!j){console.warn("Could not set text with name: '".concat(c,"', at path:'").concat(S,"'"));return}j.text=h},Object.defineProperty(w.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(c){return c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(c){return c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(c){return!c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(c){return!c.playing}).map(function(c){return c.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),w.prototype.on=function(c,h){this.eventManager.add({type:c,callback:h})},w.prototype.off=function(c,h){this.eventManager.remove({type:c,callback:h})},w.prototype.unsubscribe=function(c,h){console.warn("This function is deprecated: please use `off()` instead."),this.off(c,h)},w.prototype.removeAllRiveEventListeners=function(c){this.eventManager.removeAll(c)},w.prototype.unsubscribeAll=function(c){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(c)},w.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},w.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},w.prototype.enableFPSCounter=function(c){this.runtime.enableFPSCounter(c)},w.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(w.prototype,"contents",{get:function(){if(this.loaded){for(var c={artboards:[]},h=0;h<this.file.artboardCount();h++){for(var S=this.file.artboardByIndex(h),j={name:S.name,animations:[],stateMachines:[]},X=0;X<S.animationCount();X++){var ve=S.animationByIndex(X);j.animations.push(ve.name)}for(var Ae=0;Ae<S.stateMachineCount();Ae++){for(var je=S.stateMachineByIndex(Ae),Se=je.name,Fe=new this.runtime.StateMachineInstance(je,S),We=[],et=0;et<Fe.inputCount();et++){var Ze=Fe.input(et);We.push({name:Ze.name,type:Ze.type})}j.stateMachines.push({name:Se,inputs:We})}c.artboards.push(j)}return c}},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(c){this._volume=c,this.artboard&&(this.artboard.volume=c*N.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"artboardWidth",{get:function(){var c;return this.artboard?this.artboard.width:(c=this._artboardWidth)!==null&&c!==void 0?c:0},set:function(c){this._artboardWidth=c,this.artboard&&(this.artboard.width=c)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"artboardHeight",{get:function(){var c;return this.artboard?this.artboard.height:(c=this._artboardHeight)!==null&&c!==void 0?c:0},set:function(c){this._artboardHeight=c,this.artboard&&(this.artboard.height=c)},enumerable:!1,configurable:!0}),w.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(w.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(c){this._devicePixelRatioUsed=c},enumerable:!1,configurable:!0}),w.prototype.bindViewModelInstance=function(c){var h;this.artboard&&!this.destroyed&&c&&c.runtimeInstance&&(c.internalIncrementReferenceCount(),(h=this._viewModelInstance)===null||h===void 0||h.cleanup(),this._viewModelInstance=c,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(S){return S.bindViewModelInstance(c)}):this.artboard.bindViewModelInstance(c.runtimeInstance))},Object.defineProperty(w.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),w.prototype.viewModelByIndex=function(c){var h=this.file.viewModelByIndex(c);return h!==null?new _e(h):null},w.prototype.viewModelByName=function(c){var h=this.file.viewModelByName(c);return h!==null?new _e(h):null},w.prototype.enums=function(){if(this._dataEnums===null){var c=this.file.enums();this._dataEnums=c.map(function(h){return new me(h)})}return this._dataEnums},w.prototype.defaultViewModel=function(){if(this.artboard){var c=this.file.defaultArtboardViewModel(this.artboard);if(c)return new _e(c)}return null},w.prototype.getArtboard=function(c){var h,S;return(S=(h=this.riveFile)===null||h===void 0?void 0:h.getArtboard(c))!==null&&S!==void 0?S:null},w.missingErrorMessage="Rive source file or data buffer required",w.cleanupErrorMessage="Attempt to use file after calling cleanup.",w})(),_e=(function(){function w(c){this._viewModel=c}return Object.defineProperty(w.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),w.prototype.instanceByIndex=function(c){var h=this._viewModel.instanceByIndex(c);return h!==null?new le(h,null):null},w.prototype.instanceByName=function(c){var h=this._viewModel.instanceByName(c);return h!==null?new le(h,null):null},w.prototype.defaultInstance=function(){var c=this._viewModel.defaultInstance();return c!==null?new le(c,null):null},w.prototype.instance=function(){var c=this._viewModel.instance();return c!==null?new le(c,null):null},Object.defineProperty(w.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),w})(),me=(function(){function w(c){this._dataEnum=c}return Object.defineProperty(w.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),w})(),be;(function(w){w.Number="number",w.String="string",w.Boolean="boolean",w.Color="color",w.Trigger="trigger",w.Enum="enum",w.List="list",w.Image="image",w.Artboard="artboard"})(be||(be={}));var le=(function(){function w(c,h){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=c,h!==null&&this._parents.push(h)}return Object.defineProperty(w.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),w.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(c){c.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(c){c.clearChanges()})),this._children.forEach(function(c){return c.handleCallbacks()})},w.prototype.addParent=function(c){this._parents.includes(c)||(this._parents.push(c),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&c.addToViewModelCallbacks(this))},w.prototype.removeParent=function(c){var h=this._parents.indexOf(c);if(h!==-1){var S=this._parents[h];S.removeFromViewModelCallbacks(this),this._parents.splice(h,1)}},w.prototype.addToPropertyCallbacks=function(c){var h=this;this._propertiesWithCallbacks.includes(c)||(this._propertiesWithCallbacks.push(c),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(S){S.addToViewModelCallbacks(h)}))},w.prototype.removeFromPropertyCallbacks=function(c){var h=this;this._propertiesWithCallbacks.includes(c)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(S){return S!==c}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(S){S.removeFromViewModelCallbacks(h)}))},w.prototype.addToViewModelCallbacks=function(c){var h=this;this._children.includes(c)||(this._children.push(c),this._parents.forEach(function(S){S.addToViewModelCallbacks(h)}))},w.prototype.removeFromViewModelCallbacks=function(c){var h=this;this._children.includes(c)&&(this._children=this._children.filter(function(S){return S!==c}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(S){S.removeFromViewModelCallbacks(h)}))},w.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(c){c.clearCallbacks()})},w.prototype.propertyFromPath=function(c,h){var S=c.split("/");return this.propertyFromPathSegments(S,0,h)},w.prototype.viewModelFromPathSegments=function(c,h){var S=this.internalViewModelInstance(c[h]);return S!==null?h==c.length-1?S:S.viewModelFromPathSegments(c,h++):null},w.prototype.propertyFromPathSegments=function(c,h,S){var j,X,ve,Ae,je,Se,Fe,We,et,Ze,ct,lt,at,qe,Ue,it,nt,Je;if(h<c.length-1){var xe=this.internalViewModelInstance(c[h]);return xe!==null?xe.propertyFromPathSegments(c,h+1,S):null}var Ne=null;switch(S){case be.Number:if(Ne=(X=(j=this._runtimeInstance)===null||j===void 0?void 0:j.number(c[h]))!==null&&X!==void 0?X:null,Ne!==null)return new Y(Ne,this);break;case be.String:if(Ne=(Ae=(ve=this._runtimeInstance)===null||ve===void 0?void 0:ve.string(c[h]))!==null&&Ae!==void 0?Ae:null,Ne!==null)return new ne(Ne,this);break;case be.Boolean:if(Ne=(Se=(je=this._runtimeInstance)===null||je===void 0?void 0:je.boolean(c[h]))!==null&&Se!==void 0?Se:null,Ne!==null)return new Z(Ne,this);break;case be.Color:if(Ne=(We=(Fe=this._runtimeInstance)===null||Fe===void 0?void 0:Fe.color(c[h]))!==null&&We!==void 0?We:null,Ne!==null)return new ie(Ne,this);break;case be.Trigger:if(Ne=(Ze=(et=this._runtimeInstance)===null||et===void 0?void 0:et.trigger(c[h]))!==null&&Ze!==void 0?Ze:null,Ne!==null)return new ce(Ne,this);break;case be.Enum:if(Ne=(lt=(ct=this._runtimeInstance)===null||ct===void 0?void 0:ct.enum(c[h]))!==null&&lt!==void 0?lt:null,Ne!==null)return new te(Ne,this);break;case be.List:if(Ne=(qe=(at=this._runtimeInstance)===null||at===void 0?void 0:at.list(c[h]))!==null&&qe!==void 0?qe:null,Ne!==null)return new he(Ne,this);break;case be.Image:if(Ne=(it=(Ue=this._runtimeInstance)===null||Ue===void 0?void 0:Ue.image(c[h]))!==null&&it!==void 0?it:null,Ne!==null)return new pe(Ne,this);break;case be.Artboard:if(Ne=(Je=(nt=this._runtimeInstance)===null||nt===void 0?void 0:nt.artboard(c[h]))!==null&&Je!==void 0?Je:null,Ne!==null)return new ge(Ne,this);break}return null},w.prototype.internalViewModelInstance=function(c){var h;if(this._viewModelInstances.has(c))return this._viewModelInstances.get(c);var S=(h=this._runtimeInstance)===null||h===void 0?void 0:h.viewModel(c);if(S!==null){var j=new w(S,this);return j.internalIncrementReferenceCount(),this._viewModelInstances.set(c,j),j}return null},w.prototype.number=function(c){var h=this.propertyFromPath(c,be.Number);return h},w.prototype.string=function(c){var h=this.propertyFromPath(c,be.String);return h},w.prototype.boolean=function(c){var h=this.propertyFromPath(c,be.Boolean);return h},w.prototype.color=function(c){var h=this.propertyFromPath(c,be.Color);return h},w.prototype.trigger=function(c){var h=this.propertyFromPath(c,be.Trigger);return h},w.prototype.enum=function(c){var h=this.propertyFromPath(c,be.Enum);return h},w.prototype.list=function(c){var h=this.propertyFromPath(c,be.List);return h},w.prototype.image=function(c){var h=this.propertyFromPath(c,be.Image);return h},w.prototype.artboard=function(c){var h=this.propertyFromPath(c,be.Artboard);return h},w.prototype.viewModel=function(c){var h=c.split("/"),S=h.length>1?this.viewModelFromPathSegments(h.slice(0,h.length-1),0):this;return S!=null?S.internalViewModelInstance(h[h.length-1]):null},w.prototype.internalReplaceViewModel=function(c,h){var S;if(h.runtimeInstance!==null){var j=((S=this._runtimeInstance)===null||S===void 0?void 0:S.replaceViewModel(c,h.runtimeInstance))||!1;if(j){h.internalIncrementReferenceCount();var X=this.internalViewModelInstance(c);X!==null&&(X.removeParent(this),this._children.includes(X)&&(this._children=this._children.filter(function(ve){return ve!==X})),X.cleanup()),this._viewModelInstances.set(c,h),h.addParent(this)}return j}return!1},w.prototype.replaceViewModel=function(c,h){var S,j=c.split("/"),X=j.length>1?this.viewModelFromPathSegments(j.slice(0,j.length-1),0):this;return(S=X?.internalReplaceViewModel(j[j.length-1],h))!==null&&S!==void 0?S:!1},w.prototype.incrementReferenceCount=function(){var c;this._referenceCount++,(c=this._runtimeInstance)===null||c===void 0||c.incrementReferenceCount()},w.prototype.decrementReferenceCount=function(){var c;this._referenceCount--,(c=this._runtimeInstance)===null||c===void 0||c.decrementReferenceCount()},Object.defineProperty(w.prototype,"properties",{get:function(){var c;return((c=this._runtimeInstance)===null||c===void 0?void 0:c.getProperties().map(function(h){return m({},h)}))||[]},enumerable:!1,configurable:!0}),w.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},w.prototype.cleanup=function(){var c=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(j){j.cleanup()}),this._viewModelInstances.clear();var h=E([],this._children,!0);this._children.length=0;var S=E([],this._parents,!0);this._parents.length=0,h.forEach(function(j){j.removeParent(c)}),S.forEach(function(j){j.removeFromViewModelCallbacks(c)})}},w})(),Q=(function(){function w(c,h){this.callbacks=[],this._viewModelInstanceValue=c,this._parentViewModel=h}return w.prototype.on=function(c){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(c)||(this.callbacks.push(c),this._parentViewModel.addToPropertyCallbacks(this))},w.prototype.off=function(c){c?this.callbacks=this.callbacks.filter(function(h){return h!==c}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},w.prototype.internalHandleCallback=function(c){},w.prototype.handleCallbacks=function(){var c=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(h){c.internalHandleCallback(h)})},w.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},w.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(w.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),w})(),ne=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h(this.value)},c})(Q),Y=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h(this.value)},c})(Q),Z=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h(this.value)},c})(Q),ce=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return c.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},c.prototype.internalHandleCallback=function(h){h()},c})(Q),te=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(h){this._viewModelInstanceValue.valueIndex=h},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h(this.value)},c})(Q),he=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),c.prototype.addInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(h.runtimeInstance),h.addParent(this._parentViewModel))},c.prototype.addInstanceAt=function(h,S){return h.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(h.runtimeInstance,S)?(h.addParent(this._parentViewModel),!0):!1},c.prototype.removeInstance=function(h){h.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(h.runtimeInstance),h.removeParent(this._parentViewModel))},c.prototype.removeInstanceAt=function(h){this._viewModelInstanceValue.removeInstanceAt(h)},c.prototype.instanceAt=function(h){var S=this._viewModelInstanceValue.instanceAt(h);if(S!=null){var j=new le(S,this._parentViewModel);return j}return null},c.prototype.swap=function(h,S){this._viewModelInstanceValue.swap(h,S)},c.prototype.internalHandleCallback=function(h){h()},c})(Q),ie=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(h){this._viewModelInstanceValue.value=h},enumerable:!1,configurable:!0}),c.prototype.rgb=function(h,S,j){this._viewModelInstanceValue.rgb(h,S,j)},c.prototype.rgba=function(h,S,j,X){this._viewModelInstanceValue.argb(X,h,S,j)},c.prototype.argb=function(h,S,j,X){this._viewModelInstanceValue.argb(h,S,j,X)},c.prototype.alpha=function(h){this._viewModelInstanceValue.alpha(h)},c.prototype.opacity=function(h){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,h))*255))},c.prototype.internalHandleCallback=function(h){h(this.value)},c})(Q),pe=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{set:function(h){var S;this._viewModelInstanceValue.value((S=h?.nativeImage)!==null&&S!==void 0?S:null)},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h()},c})(Q),ge=(function(w){g(c,w);function c(h,S){return w.call(this,h,S)||this}return Object.defineProperty(c.prototype,"value",{set:function(h){var S;this._viewModelInstanceValue.value((S=h?.nativeArtboard)!==null&&S!==void 0?S:null)},enumerable:!1,configurable:!0}),c.prototype.internalHandleCallback=function(h){h()},c})(Q),Ie=function(w){return $(void 0,void 0,void 0,function(){var c,h,S;return _(this,function(j){switch(j.label){case 0:return c=new Request(w),[4,fetch(c)];case 1:return h=j.sent(),[4,h.arrayBuffer()];case 2:return S=j.sent(),[2,S]}})})},ke=function(w){return typeof w=="string"?[w]:w instanceof Array?w:[]},Re={EventManager:re,TaskQueueManager:ue},Ce=function(w){return $(void 0,void 0,void 0,function(){var c,h,S;return _(this,function(j){switch(j.label){case 0:return c=new Promise(function(X){return F.getInstance(function(ve){ve.decodeAudio(w,X)})}),[4,c];case 1:return h=j.sent(),S=new v.AudioWrapper(h),v.finalizationRegistry.register(S,h),[2,S]}})})},Be=function(w){return $(void 0,void 0,void 0,function(){var c,h,S;return _(this,function(j){switch(j.label){case 0:return c=new Promise(function(X){return F.getInstance(function(ve){ve.decodeImage(w,X)})}),[4,c];case 1:return h=j.sent(),S=new v.ImageWrapper(h),v.finalizationRegistry.register(S,h),[2,S]}})})},De=function(w){return $(void 0,void 0,void 0,function(){var c,h,S;return _(this,function(j){switch(j.label){case 0:return c=new Promise(function(X){return F.getInstance(function(ve){ve.decodeFont(w,X)})}),[4,c];case 1:return h=j.sent(),S=new v.FontWrapper(h),v.finalizationRegistry.register(S,h),[2,S]}})})}})(),o})())})(rive$1)),rive$1.exports}var riveExports=requireRive();const bucketName="dracula",supabaseUrlFile="https://vycjpmuyscfygstjjied.supabase.co";var root$d=from_html('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Rive(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName),i=state(null);onMount(()=>{if(!get$2(i))return;const u=new riveExports.Rive({src:`${supabaseUrlFile}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:get$2(i),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var n=root$d(),o=child(n);bind_this(o,u=>set(i,u),()=>get$2(i)),append(r,n),pop()}var root$c=from_html('<div class="body-wrapper svelte-njwbfg"><!></div>');function BodyWrapper(r,e){var t=root$c(),i=child(t);snippet(i,()=>e.children),append(r,t)}var root_1$s=from_html('<button class="btn btn-info svelte-aplqg7">❓ Правила</button>'),root_2$j=from_html('<button class="btn btn-secondary svelte-aplqg7">🔄 Заново</button>'),root_4$h=from_html('<button class="btn btn-danger svelte-aplqg7">🏳️ Сдаться</button>'),root$b=from_html('<div id="game-header" class="svelte-aplqg7"><!> <!> <!> <!></div>');function GameHeader(r,e){let t=prop(e,"showGiveUp",3,!1),i=prop(e,"extraContent",3,null),n=prop(e,"onShowRules",3,null);var o=root$b(),u=child(o);{var f=E=>{var T=root_1$s();T.__click=function(...x){n()?.apply(this,x)},append(E,T)};if_block(u,E=>{n()&&E(f)})}var p=sibling(u,2);{var v=E=>{var T=root_2$j();T.__click=function(...x){e.onRestart?.apply(this,x)},append(E,T)};if_block(p,E=>{e.onRestart&&E(v)})}var g=sibling(p,2);{var m=E=>{var T=comment(),x=first_child(T);snippet(x,i),append(E,T)};if_block(g,E=>{i()&&E(m)})}var $=sibling(g,2);{var _=E=>{var T=root_4$h();T.__click=function(...x){e.onGiveUp?.apply(this,x)},append(E,T)};if_block($,E=>{t()&&e.onGiveUp&&E(_)})}append(r,o)}delegate(["click"]);var root_2$i=from_html('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),root_1$r=from_html('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function RewardPanel(r,e){push(e,!0);let t=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),n=prop(e,"bucketName",3,"dracula"),o=prop(e,"label",3,"Награда");function u(){if(!t()||!i()||i().length===0)return null;const _=typeof t()=="string"?t():t()?.id;return _&&i().find(E=>E.id===_)||null}let f=user_derived(u),p=user_derived(()=>typeof t()=="object"&&t()?.name?t().name:null);function v(_){const E=_.target;E.style.display="none"}var g=comment(),m=first_child(g);{var $=_=>{var E=root_1$r(),T=child(E);{var x=I=>{var k=root_2$i(),U=child(k);template_effect(()=>{set_attribute(U,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${n()}/${get$2(f)?.icon||(typeof t()=="object"?t().icon:"")}`),set_attribute(U,"alt",get$2(f)?.name||get$2(p)||"Награда")}),event("error",U,v),append(I,k)};if_block(T,I=>{(get$2(f)?.icon||typeof t()=="object"&&t().icon)&&I(x)})}var D=sibling(T,2),P=child(D),R=child(P),F=sibling(P,2),V=child(F);template_effect(()=>{set_text(R,`${o()??""}:`),set_text(V,get$2(f)?.name||get$2(p)||"Неизвестный предмет")}),append(_,E)};if_block(m,_=>{(get$2(f)||get$2(p))&&_($)})}append(r,g),pop()}var root$a=from_html('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function GameFooter(r,e){let t=prop(e,"rewardItem",3,null),i=prop(e,"items",19,()=>[]),n=prop(e,"bucketName",3,"dracula");var o=root$a(),u=child(o);RewardPanel(u,{get rewardItem(){return t()},get items(){return i()},get bucketName(){return n()}});var f=sibling(u,2);{var p=v=>{var g=comment(),m=first_child(g);snippet(m,()=>e.children),append(v,g)};if_block(f,v=>{e.children&&v(p)})}append(r,o)}var root_2$h=from_html("<button> </button>"),root_1$q=from_html('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function MinigameModal(r,e){push(e,!0);let t=prop(e,"modal",7);var i=comment(),n=first_child(i);{var o=u=>{var f=root_1$q();let p;var v=child(f),g=child(v),m=child(g),$=sibling(g,2),_=child($),E=sibling($,2);each(E,21,()=>t().actions,T=>T.text,(T,x)=>{var D=root_2$h();let P;D.__click=function(...F){get$2(x).action?.apply(this,F)};var R=child(D);template_effect(F=>{P=set_class(D,1,"btn",null,P,F),set_text(R,get$2(x).text)},[()=>({"btn-secondary":get$2(x).class==="btn-secondary"})]),append(T,D)}),template_effect(T=>{p=set_class(f,1,"svelte-s62q14",null,p,T),set_text(m,t().title),set_text(_,t().text)},[()=>({active:t().show})]),append(u,f)};if_block(n,u=>{t().show&&u(o)})}append(r,i),pop()}delegate(["click"]);var root_3$n=from_html('<div role="button" tabindex="0"> </div>'),root_5$j=from_svg('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),root_7$a=from_html('<span class="cooldown-timer svelte-d67gs4"> </span>'),root_6$b=from_html('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),root_1$p=from_html('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function OnetMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=8,f=6,p=5,v=1e3,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let m=state(proxy([])),$=state(proxy([])),_=state(proxy({})),E=state(proxy([])),T=state(null),x=state(!1),D=state(!1),P=state(""),R=state(0),F=state(0),V=state(proxy({show:!1,title:"",text:"",actions:[]})),I,k;onMount(()=>{L()});function U(){if(!get$2($)||get$2($).length===0)return 0;let le=0;for(let Q=0;Q<u;Q++)for(let ne=0;ne<f;ne++)get$2($)[Q]&&!get$2($)[Q][ne]&&le++;return le}let W=user_derived(U),B=user_derived(()=>get$2(F)<1);function L(){set(m,[],!0),set($,[],!0),set(T,null),set(x,!1),set(D,!1),set(_,{},!0),set(E,[],!0),set(P,""),set(F,0),_e();let le=[...new Set(g)];for(;le.length<u*f/2;)le=[...le,...le];let Q=le.sort(()=>.5-Math.random()).slice(0,u*f/2),ne=[];Q.forEach(Z=>ne.push(Z,Z)),ne.sort(()=>Math.random()-.5);let Y=0;for(let Z=0;Z<u;Z++){let ce=[],te=[];for(let he=0;he<f;he++)ce.push(ne[Y++]),te.push(!1);get$2(m).push(ce),get$2($).push(te)}setTimeout(q,500)}async function G(le,Q){if(get$2(x)||get$2($)[le][Q]||get$2(D))return;if(get$2(E).length>0&&set(E,[],!0),!get$2(T)){set(T,{r:le,c:Q},!0);return}if(get$2(T).r===le&&get$2(T).c===Q){set(T,null);return}const ne=get$2(m)[get$2(T).r][get$2(T).c],Y=get$2(m)[le][Q];if(ne===Y){const Z=oe(get$2(T).r,get$2(T).c,le,Q);if(Z){set(x,!0),await de(Z),get$2($)[get$2(T).r][get$2(T).c]=!0,get$2($)[le][Q]=!0,set(T,null),set(x,!1),ue(),q();return}}set(T,{r:le,c:Q},!0)}async function re(le,Q,ne){(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),await G(le,Q))}function ue(){set(F,p);const le=setInterval(()=>{update(F,-1),get$2(F)<=0&&clearInterval(le)},1e3)}function z(){if(get$2(x)||get$2(D)||!get$2(B))return;let le=[];for(let ne=0;ne<u;ne++)for(let Y=0;Y<f;Y++)get$2($)[ne][Y]||le.push({r:ne,c:Y,icon:get$2(m)[ne][Y]});let Q={};le.forEach(ne=>{Q[ne.icon]||(Q[ne.icon]=[]),Q[ne.icon].push(ne)});for(const ne in Q){const Y=Q[ne];if(!(Y.length<2))for(let Z=0;Z<Y.length;Z++)for(let ce=Z+1;ce<Y.length;ce++){const te=Y[Z],he=Y[ce];if(oe(te.r,te.c,he.r,he.c)){set(E,[te,he],!0),setTimeout(()=>set(E,[],!0),1500);return}}}}function q(){if(get$2(W)===0){set(D,!0),t()?(ae("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{_e(),e.onWin?.()},v)):ae("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:L}]);return}N()||(t()?setTimeout(()=>M(),1e3):ae("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{_e(),M()}},{text:"Сдаться",action:()=>{ae("Конец","Попытайте удачу снова!",[{text:"ОК",action:L}])}}]))}function N(){let le=[];for(let ne=0;ne<u;ne++)for(let Y=0;Y<f;Y++)get$2($)[ne][Y]||le.push({r:ne,c:Y,icon:get$2(m)[ne][Y]});let Q={};le.forEach(ne=>{Q[ne.icon]||(Q[ne.icon]=[]),Q[ne.icon].push(ne)});for(const ne in Q){const Y=Q[ne];if(!(Y.length<2)){for(let Z=0;Z<Y.length;Z++)for(let ce=Z+1;ce<Y.length;ce++)if(oe(Y[Z].r,Y[Z].c,Y[ce].r,Y[ce].c))return!0}}return!1}function M(){let le=[],Q=[];for(let ne=0;ne<u;ne++)for(let Y=0;Y<f;Y++)get$2($)[ne][Y]||(le.push(get$2(m)[ne][Y]),Q.push({r:ne,c:Y}));le.length!==0&&(le.sort(()=>Math.random()-.5),Q.forEach((ne,Y)=>{get$2(m)[ne.r][ne.c]=le[Y],get$2(_)[`${ne.r},${ne.c}`]=!0}),setTimeout(()=>{set(_,{},!0),N()?set(D,!1):M()},500))}function O(le,Q){return le<0||le>=u||Q<0||Q>=f?!0:get$2($)[le][Q]}function K(le,Q,ne,Y){if(le!==ne&&Q!==Y)return!1;if(le===ne){const Z=Math.min(Q,Y),ce=Math.max(Q,Y);for(let te=Z+1;te<ce;te++)if(!O(le,te))return!1}else{const Z=Math.min(le,ne),ce=Math.max(le,ne);for(let te=Z+1;te<ce;te++)if(!O(te,Q))return!1}return!0}function oe(le,Q,ne,Y){if(K(le,Q,ne,Y))return[{r:le,c:Q},{r:ne,c:Y}];const Z={r:le,c:Y};if(O(Z.r,Z.c)&&K(le,Q,Z.r,Z.c)&&K(Z.r,Z.c,ne,Y))return[{r:le,c:Q},Z,{r:ne,c:Y}];const ce={r:ne,c:Q};if(O(ce.r,ce.c)&&K(le,Q,ce.r,ce.c)&&K(ce.r,ce.c,ne,Y))return[{r:le,c:Q},ce,{r:ne,c:Y}];for(let te=-1;te<=u;te++){if(te===le||te===ne)continue;const he={r:te,c:Q},ie={r:te,c:Y};if(O(he.r,he.c)&&O(ie.r,ie.c)&&K(le,Q,he.r,he.c)&&K(he.r,he.c,ie.r,ie.c)&&K(ie.r,ie.c,ne,Y))return[{r:le,c:Q},he,ie,{r:ne,c:Y}]}for(let te=-1;te<=f;te++){if(te===Q||te===Y)continue;const he={r:le,c:te},ie={r:ne,c:te};if(O(he.r,he.c)&&O(ie.r,ie.c)&&K(le,Q,he.r,he.c)&&K(he.r,he.c,ie.r,ie.c)&&K(ie.r,ie.c,ne,Y))return[{r:le,c:Q},he,ie,{r:ne,c:Y}]}return null}async function de(le){if(await tick(),!I||!k)return;const Q=I.getBoundingClientRect(),ne=k.getBoundingClientRect(),Y=k.querySelector(".cell:not(.matched)");if(!Y)return;const Z=Y.offsetWidth,ce=Y.offsetHeight,te=window.getComputedStyle(k),he=parseFloat(te.gap)||4,ie=ne.left-Q.left,pe=ne.top-Q.top,ge=le.map(Ie=>{let ke,Re;if(Ie.r>=0&&Ie.r<u&&Ie.c>=0&&Ie.c<f){const Be=k.children[Ie.r*f+Ie.c].getBoundingClientRect();ke=Be.left-Q.left+Be.width/2,Re=Be.top-Q.top+Be.height/2}else{const Ce=Ie.c*(Z+he)+Z/2,Be=Ie.r*(ce+he)+ce/2;ke=ie+Ce,Re=pe+Be}return`${ke.toFixed(1)},${Re.toFixed(1)}`}).join(" ");return set(P,ge,!0),update(R),new Promise(Ie=>{setTimeout(()=>{set(P,""),Ie()},350)})}function ae(le,Q,ne){set(V,{show:!0,title:le,text:Q,actions:ne},!0)}function _e(){get$2(V).show=!1}function me(){ae("📖 Правила",`Соеди монстров:

🎯 Цель: Удалить все пары одинаковых монстров.

🔗 Соедини две одинаковые фигуры линией.

📐 Линия может иметь не более 2 поворотов (изгибов).

🚫 Линия не должна проходить через другие фигуры.

💡 Если ходов нет — игра сама перемешает доску.

💡 Кнопка 💡 покажет доступную пару (с перезарядкой).`,[{text:"Понятно",action:_e}])}function be(){t()?(ae("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{_e(),e.onLose?.()},v)):ae("Конец","Попытайте удачу снова!",[{text:"ОК",action:L}])}BodyWrapper(r,{children:(le,Q)=>{var ne=root_1$p(),Y=first_child(ne);{let ge=user_derived(()=>t()?be:void 0);GameHeader(Y,{onRestart:L,get onGiveUp(){return get$2(ge)},get showGiveUp(){return t()},onShowRules:me})}var Z=sibling(Y,2),ce=child(Z);set_style(ce,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),each(ce,21,()=>get$2(m),index$1,(ge,Ie,ke)=>{var Re=comment(),Ce=first_child(Re);each(Ce,17,()=>get$2(Ie),index$1,(Be,De,w)=>{var c=root_3$n();let h;c.__click=()=>G(ke,w),c.__keydown=j=>re(ke,w,j);var S=child(c);template_effect(j=>{h=set_class(c,1,"cell svelte-d67gs4",null,h,j),set_text(S,get$2(De))},[()=>({selected:get$2(T)?.r===ke&&get$2(T)?.c===w,matched:get$2($)[ke][w],shuffling:get$2(_)[`${ke},${w}`],"hint-glow":get$2(E).some(j=>j.r===ke&&j.c===w)})]),append(Be,c)}),append(ge,Re)}),bind_this(ce,ge=>k=ge,()=>k);var te=sibling(ce,2),he=child(te);key(he,()=>get$2(R),ge=>{var Ie=comment(),ke=first_child(Ie);{var Re=Ce=>{var Be=root_5$j();template_effect(()=>set_attribute(Be,"points",get$2(P))),append(Ce,Be)};if_block(ke,Ce=>{get$2(P)&&Ce(Re)})}append(ge,Ie)}),bind_this(Z,ge=>I=ge,()=>I);var ie=sibling(Z,2);GameFooter(ie,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ge,Ie)=>{var ke=root_6$b(),Re=child(ke),Ce=sibling(child(Re)),Be=child(Ce),De=sibling(Re,2);let w;De.__click=z;var c=sibling(child(De));{var h=S=>{var j=root_7$a(),X=child(j);template_effect(()=>set_text(X,`(${get$2(F)??""})`)),append(S,j)};if_block(c,S=>{get$2(F)>0&&S(h)})}template_effect(S=>{set_text(Be,get$2(W)),w=set_class(De,1,"btn btn-secondary svelte-d67gs4",null,w,S),De.disabled=!get$2(B)},[()=>({disabled:!get$2(B),"cooldown-active":get$2(F)>0})]),append(ge,ke)},$$slots:{default:!0}});var pe=sibling(ie,2);MinigameModal(pe,{get modal(){return get$2(V)}}),append(le,ne)}}),pop()}delegate(["click","keydown"]);function showHint(r,e,t,i,n,o,u,f,p,v){if(!(get$2(e)||get$2(t)||!get$2(i)))for(let g=0;g<n;g++)for(let m=0;m<o;m++){if(get$2(u)[g]?.[m]||get$2(f)[g]?.[m])continue;let $=get$2(p)[g][m];for(let _=0;_<n;_++)for(let E=0;E<o;E++)if(!(g===_&&m===E)&&!(get$2(u)[_]?.[E]||get$2(f)[_]?.[E])&&get$2(p)[_][E]===$){set(v,[{r:g,c:m},{r:_,c:E}],!0),setTimeout(()=>set(v,[],!0),1500);return}}}var root_3$m=from_html('<button type="button"><div class="card-inner svelte-k8c0r2"><div class="card-front svelte-k8c0r2"> </div> <div class="card-back svelte-k8c0r2">?</div></div></button>'),root_5$i=from_html('<span class="cooldown-timer svelte-k8c0r2"> </span>'),root_4$g=from_html('<div class="footer-stats svelte-k8c0r2"><span class="tiles-counter svelte-k8c0r2">Осталось: <strong class="svelte-k8c0r2"> </strong></span> <button>💡 <!></button></div>'),root_1$o=from_html('<!> <div id="game-container" class="svelte-k8c0r2"><div id="grid" class="svelte-k8c0r2"></div></div> <!> <!>',1);function MemoMonsters(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,f=4,p=5,v=1e3,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let m=state(proxy([])),$=state(proxy([])),_=state(proxy([])),E=state(proxy([])),T=state(null),x=state(!1),D=state(!1),P=state(0),R=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>{k()});function F(){let z=0;for(let q=0;q<u;q++)for(let N=0;N<f;N++)get$2($)[q]?.[N]||z++;return z}let V=user_derived(F),I=user_derived(()=>get$2(P)<1);function k(){set(m,[],!0),set($,[],!0),set(_,[],!0),set(T,null),set(x,!1),set(D,!1),set(E,[],!0),set(P,0),re();let z=[...new Set(g)];for(;z.length<u*f/2;)z=[...z,...z];let q=z.sort(()=>.5-Math.random()).slice(0,u*f/2),N=[];q.forEach(O=>N.push(O,O)),N.sort(()=>Math.random()-.5);let M=0;for(let O=0;O<u;O++){let K=[],oe=[],de=[];for(let ae=0;ae<f;ae++)K.push(N[M++]),oe.push(!1),de.push(!1);get$2(m).push(K),get$2($).push(oe),get$2(_).push(de)}}async function U(z,q){if(!(get$2(x)||get$2($)[z]?.[q]||get$2(D))){if(get$2(T)&&get$2(T).r===z&&get$2(T).c===q){get$2(_)[z][q]=!1,set(T,null);return}if(!get$2(_)[z]?.[q])if(get$2(E).length>0&&set(E,[],!0),get$2(_)[z][q]=!0,!get$2(T))set(T,{r:z,c:q},!0);else{set(x,!0);const N={r:z,c:q},M=get$2(m)[get$2(T).r][get$2(T).c],O=get$2(m)[N.r][N.c];M===O?setTimeout(()=>{get$2($)[get$2(T).r][get$2(T).c]=!0,get$2($)[N.r][N.c]=!0,get$2(_)[get$2(T).r][get$2(T).c]=!1,get$2(_)[N.r][N.c]=!1,set(T,null),set(x,!1),W(),B()},600):setTimeout(()=>{get$2(_)[get$2(T).r][get$2(T).c]=!1,get$2(_)[N.r][N.c]=!1,set(T,null),set(x,!1)},1e3)}}}function W(){set(P,p);const z=setInterval(()=>{update(P,-1),get$2(P)<=0&&clearInterval(z)},1e3)}function B(){get$2(V)===0&&(set(D,!0),t()?(G("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{re(),e.onWin?.()},v)):G("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:k}]))}function L(){t()?(G("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{re(),e.onLose?.()},v)):G("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:k}])}function G(z,q,N){set(R,{show:!0,title:z,text:q,actions:N},!0)}function re(){get$2(R).show=!1}function ue(){G("📖 Правила",`Память с монстрами:

🎯 Цель: Найти все пары одинаковых карт.

🔍 Кликни на карту, чтобы открыть её.

🔗 Найди вторую карту с таким же изображением.

💡 Если карты совпали — они исчезают.

❌ Если не совпали — обе закроются.

💡 Подсказка (кнопка 💡) покажет одну пару, но имеет перезарядку.`,[{text:"Понятно",action:re}])}BodyWrapper(r,{children:(z,q)=>{var N=root_1$o(),M=first_child(N);{let ae=user_derived(()=>t()?L:void 0);GameHeader(M,{onRestart:k,get onGiveUp(){return get$2(ae)},get showGiveUp(){return t()},onShowRules:ue})}var O=sibling(M,2),K=child(O);set_style(K,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),each(K,21,()=>get$2(m),index$1,(ae,_e,me)=>{var be=comment(),le=first_child(be);each(le,17,()=>get$2(_e),index$1,(Q,ne,Y)=>{var Z=root_3$m();let ce;Z.__click=()=>U(me,Y),set_attribute(Z,"aria-label",`Ячейка ${me}, ${Y}`);var te=child(Z),he=child(te),ie=child(he);template_effect(pe=>{ce=set_class(Z,1,"cell svelte-k8c0r2",null,ce,pe),set_text(ie,get$2(ne))},[()=>({flipped:get$2(_)[me]?.[Y],matched:get$2($)[me]?.[Y],selected:get$2(T)?.r===me&&get$2(T)?.c===Y,"hint-glow":get$2(E).some(pe=>pe.r===me&&pe.c===Y)})]),append(Q,Z)}),append(ae,be)});var oe=sibling(O,2);GameFooter(oe,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ae,_e)=>{var me=root_4$g(),be=child(me),le=sibling(child(be)),Q=child(le),ne=sibling(be,2);let Y;ne.__click=[showHint,x,D,I,u,f,$,_,m,E];var Z=sibling(child(ne));{var ce=te=>{var he=root_5$i(),ie=child(he);template_effect(()=>set_text(ie,`(${get$2(P)??""})`)),append(te,he)};if_block(Z,te=>{get$2(P)>0&&te(ce)})}template_effect(te=>{set_text(Q,get$2(V)),Y=set_class(ne,1,"btn btn-secondary svelte-k8c0r2",null,Y,te),ne.disabled=!get$2(I)},[()=>({disabled:!get$2(I),"cooldown-active":get$2(P)>0})]),append(ae,me)},$$slots:{default:!0}});var de=sibling(oe,2);MinigameModal(de,{get modal(){return get$2(R)}}),append(z,N)}}),pop()}delegate(["click"]);var root_4$f=from_html('<div class="flame svelte-1v5x2m5"></div>'),root_3$l=from_html('<button type="button"><div class="candle svelte-1v5x2m5"><!></div></button>'),root_5$h=from_html('<div class="footer-stats svelte-1v5x2m5"><span class="moves-counter svelte-1v5x2m5">Ходов: <strong class="svelte-1v5x2m5"> </strong></span></div>'),root_1$n=from_html('<!> <div id="game-container" class="svelte-1v5x2m5"><div id="grid" class="svelte-1v5x2m5"></div></div> <!> <!>',1);function LightOut(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=5,f=5,p=15,v=1e3;let g=state(proxy([])),m=state(0),$=state(!1),_=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>T());let E=user_derived(()=>get$2(g).flat().every(k=>!k));function T(){set(g,Array(u).fill(null).map(()=>Array(f).fill(!1)),!0),set(m,0),set($,!1),V();for(let k=0;k<p;k++){const U=Math.floor(Math.random()*u),W=Math.floor(Math.random()*f);x(U,W,!0)}}function x(k,U,W=!1){get$2(g)[k][U]=!get$2(g)[k][U],k>0&&(get$2(g)[k-1][U]=!get$2(g)[k-1][U]),k<u-1&&(get$2(g)[k+1][U]=!get$2(g)[k+1][U]),U>0&&(get$2(g)[k][U-1]=!get$2(g)[k][U-1]),U<f-1&&(get$2(g)[k][U+1]=!get$2(g)[k][U+1]),W||(update(m),P())}function D(k,U){get$2($)||x(k,U)}function P(){get$2(E)&&(set($,!0),t()?(F("🕯️ Тьма наступила",`Вы погасили все свечи за ${get$2(m)} ходов!`,[]),setTimeout(()=>{V(),e.onWin?.()},v)):F("🕯️ Тьма наступила",`Вы погасили все свечи за ${get$2(m)} ходов!`,[{text:"Играть снова",action:T}]))}function R(){t()?(F("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{V(),e.onLose?.()},v)):F("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:T}])}function F(k,U,W){set(_,{show:!0,title:k,text:U,actions:W},!0)}function V(){get$2(_).show=!1}function I(){F("📖 Правила",`Погаси свечи:

🎯 Цель: Погасить все свечи на поле.

💡 Клик на свечу переключает её и соседние свечи (вверх, вниз, влево, вправо).

🔢 Зажжённая свеча гаснет, а потухшая — зажигается.

🧠 Подумай хорошенько — каждый ход влияет на соседние свечи!

🏆 Чем меньше ходов — тем лучше.`,[{text:"Понятно",action:V}])}BodyWrapper(r,{children:(k,U)=>{var W=root_1$n(),B=first_child(W);{let z=user_derived(()=>t()?R:void 0);GameHeader(B,{onRestart:T,get onGiveUp(){return get$2(z)},get showGiveUp(){return t()},onShowRules:I})}var L=sibling(B,2),G=child(L);set_style(G,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),each(G,21,()=>get$2(g),index$1,(z,q,N)=>{var M=comment(),O=first_child(M);each(O,17,()=>get$2(q),index$1,(K,oe,de)=>{var ae=root_3$l();let _e;ae.__click=()=>D(N,de),set_attribute(ae,"aria-label",`Свеча ${N}, ${de}`);var me=child(ae),be=child(me);{var le=Q=>{var ne=root_4$f();append(Q,ne)};if_block(be,Q=>{get$2(oe)&&Q(le)})}template_effect(Q=>_e=set_class(ae,1,"cell svelte-1v5x2m5",null,_e,Q),[()=>({lit:get$2(oe)})]),append(K,ae)}),append(z,M)});var re=sibling(L,2);GameFooter(re,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(z,q)=>{var N=root_5$h(),M=child(N),O=sibling(child(M)),K=child(O);template_effect(()=>set_text(K,get$2(m))),append(z,N)},$$slots:{default:!0}});var ue=sibling(re,2);MinigameModal(ue,{get modal(){return get$2(_)}}),append(k,W)}}),pop()}delegate(["click"]);var root_3$k=from_html('<div class="cell svelte-53kujm"> </div>'),root_4$e=from_html('<button class="color-btn svelte-53kujm"> </button>'),root_5$g=from_html('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),root_1$m=from_html('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function FloodIt(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=12,f=25,p=1e3,v=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let g=state(proxy([])),m=state(0),$=state(!1),_=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>T());let E=user_derived(()=>()=>{const k=get$2(g)[0][0];return get$2(g).every(U=>U.every(W=>W===k))});function T(){set(g,[],!0),set(m,0),set($,!1),V();for(let k=0;k<u;k++){let U=[];for(let W=0;W<u;W++)U.push(Math.floor(Math.random()*v.length));get$2(g).push(U)}}function x(k,U,W,B){k<0||k>=u||U<0||U>=u||get$2(g)[k][U]===W&&(get$2(g)[k][U]=B,x(k-1,U,W,B),x(k+1,U,W,B),x(k,U-1,W,B),x(k,U+1,W,B))}function D(k){if(get$2($)||get$2(m)>=f)return;const U=get$2(g)[0][0];k!==U&&(x(0,0,U,k),update(m),P())}function P(){get$2(E)()?(set($,!0),t()?(F("🎉 Победа!",`Вы захватили мир за ${get$2(m)} ходов!`,[]),setTimeout(()=>{V(),e.onWin?.()},p)):F("🎉 Победа!",`Вы захватили мир за ${get$2(m)} ходов!`,[{text:"Играть снова",action:T}])):get$2(m)>=f&&(set($,!0),t()?(F("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{V(),e.onLose?.()},p)):F("💀 Поражение","Ходы закончились!",[{text:"Заново",action:T}]))}function R(){t()?(F("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{V(),e.onLose?.()},p)):F("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:T}])}function F(k,U,W){set(_,{show:!0,title:k,text:U,actions:W},!0)}function V(){get$2(_).show=!1}function I(){F("📖 Правила",`Заливка мира:

🎯 Цель: Залить всё поле одним цветом.

🔴 Нажми на цвет внизу — он начнёт заливать поле с левого верхнего угла.

🔗 Цвет распространяется по соседним клеткам того же цвета.

⏰ У тебя есть всего 25 ходов!

💡 Планируй заранее — выбирай цтобы захватить как можно больше клеток.`,[{text:"Понятно",action:V}])}BodyWrapper(r,{children:(k,U)=>{var W=root_1$m(),B=first_child(W);{let q=user_derived(()=>t()?R:void 0);GameHeader(B,{onRestart:T,get onGiveUp(){return get$2(q)},get showGiveUp(){return t()},onShowRules:I})}var L=sibling(B,2),G=child(L);set_style(G,"grid-template-columns: repeat(12, 1fr);"),each(G,21,()=>get$2(g),index$1,(q,N)=>{var M=comment(),O=first_child(M);each(O,17,()=>get$2(N),index$1,(K,oe)=>{var de=root_3$k(),ae=child(de);template_effect(()=>{set_style(de,`background-color: ${v[get$2(oe)].value??""};`),set_text(ae,v[get$2(oe)].icon)}),append(K,de)}),append(q,M)});var re=sibling(L,2);each(re,21,()=>v,index$1,(q,N,M)=>{var O=root_4$e();O.__click=()=>D(M);var K=child(O);template_effect(()=>{set_style(O,`background-color: ${get$2(N).value??""};`),O.disabled=get$2($)||get$2(m)>=f,set_text(K,get$2(N).icon)}),append(q,O)});var ue=sibling(re,2);GameFooter(ue,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(q,N)=>{var M=root_5$g(),O=child(M),K=sibling(child(O)),oe=child(K),de=sibling(K);de.nodeValue=" / 25",template_effect(()=>set_text(oe,get$2(m))),append(q,M)},$$slots:{default:!0}});var z=sibling(ue,2);MinigameModal(z,{get modal(){return get$2(_)}}),append(k,W)}}),pop()}delegate(["click"]);var root_3$j=from_html('<button type="button"> </button>'),root_4$d=from_html('<div class="footer-stats svelte-fn2aic"><span class="moves-counter svelte-fn2aic">Ходов: <strong class="svelte-fn2aic"> </strong></span></div>'),root_1$l=from_html('<!> <div id="game-container" class="svelte-fn2aic"><div id="grid" class="svelte-fn2aic"></div></div> <!> <!>',1);function BrokenMirror(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,f=1e3;let p=state(proxy([])),v=state(0),g=state(!1),m=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>_());let $=user_derived(()=>()=>{let I=1;for(let k=0;k<u;k++)for(let U=0;U<u;U++)if(k===u-1&&U===u-1){if(get$2(p)[k][U]!==null)return!1}else{if(get$2(p)[k][U]!==I)return!1;I++}return!0});function _(){set(p,[],!0),set(v,0),set(g,!1),F();let I=[];for(let U=1;U<u*u;U++)I.push(U);I.push(null);do I=I.sort(()=>Math.random()-.5);while(!E(I));let k=0;for(let U=0;U<u;U++){let W=[];for(let B=0;B<u;B++)W.push(I[k++]);get$2(p).push(W)}}function E(I){let k=0;for(let W=0;W<I.length;W++)for(let B=W+1;B<I.length;B++)I[W]&&I[B]&&I[W]>I[B]&&k++;let U=0;for(let W=0;W<I.length;W++)if(I[W]===null){U=Math.floor(W/u);break}return k%2===(u-U)%2}function T(){for(let I=0;I<u;I++)for(let k=0;k<u;k++)if(get$2(p)[I][k]===null)return{r:I,c:k};return null}function x(I,k){if(get$2(g))return;const U=T();if(!U)return;const W=Math.abs(I-U.r),B=Math.abs(k-U.c);(W===1&&B===0||W===0&&B===1)&&(get$2(p)[U.r][U.c]=get$2(p)[I][k],get$2(p)[I][k]=null,update(v),D())}function D(){get$2($)()&&(set(g,!0),t()?(R("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${get$2(v)} ходов!`,[]),setTimeout(()=>{F(),e.onWin?.()},f)):R("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${get$2(v)} ходов!`,[{text:"Играть снова",action:_}]))}function P(){t()?(R("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{F(),e.onLose?.()},f)):R("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:_}])}function R(I,k,U){set(m,{show:!0,title:I,text:k,actions:U},!0)}function F(){get$2(m).show=!1}function V(){R("📖 Правила",`Пятнашки (Осколки зеркала):

🎯 Цель: Собрать числа по порядку от 1 до 15.

🔄 Клик на плитку перемещает её на пустое место (рядом).

🧠 Подумай над ходами — плитки можно двигать только по одной!

🏆 Собери головоломку за меньшее количество ходов.`,[{text:"Понятно",action:F}])}BodyWrapper(r,{children:(I,k)=>{var U=root_1$l(),W=first_child(U);{let ue=user_derived(()=>t()?P:void 0);GameHeader(W,{onRestart:_,get onGiveUp(){return get$2(ue)},get showGiveUp(){return t()},onShowRules:V})}var B=sibling(W,2),L=child(B);set_style(L,"grid-template-columns: repeat(4, 1fr);"),each(L,21,()=>get$2(p),index$1,(ue,z,q)=>{var N=comment(),M=first_child(N);each(M,17,()=>get$2(z),index$1,(O,K,oe)=>{var de=root_3$j();let ae;de.__click=()=>x(q,oe);var _e=child(de);template_effect(me=>{ae=set_class(de,1,"cell svelte-fn2aic",null,ae,me),de.disabled=get$2(K)===null,set_attribute(de,"aria-label",get$2(K)===null?"Пустая ячейка":`Ячейка ${get$2(K)}`),set_text(_e,get$2(K))},[()=>({empty:get$2(K)===null})]),append(O,de)}),append(ue,N)});var G=sibling(B,2);GameFooter(G,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ue,z)=>{var q=root_4$d(),N=child(q),M=sibling(child(N)),O=child(M);template_effect(()=>set_text(O,get$2(v))),append(ue,q)},$$slots:{default:!0}});var re=sibling(G,2);MinigameModal(re,{get modal(){return get$2(m)}}),append(I,U)}}),pop()}delegate(["click"]);function handleTouchStart(r,e,t){set(e,r.touches[0].clientX,!0),set(t,r.touches[0].clientY,!0)}var root_3$i=from_html("<div> </div>"),root_4$c=from_html('<div class="footer-stats svelte-1o3nb6j"><span class="score-counter svelte-1o3nb6j">Очки: <strong class="svelte-1o3nb6j"> </strong></span></div>'),root_1$k=from_html('<!> <div id="game-container" class="svelte-1o3nb6j"><div id="grid" class="svelte-1o3nb6j"></div></div> <!> <!>',1);function Evolution2048(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=4,f=2048,p=1e3,v={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},g={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=state(proxy([])),$=state(0),_=state(!1),E=state(!1),T=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>(x(),window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)));function x(){set(m,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),set($,0),set(_,!1),set(E,!1),q(),D(),D()}function D(){let M=[];for(let O=0;O<u;O++)for(let K=0;K<u;K++)get$2(m)[O][K]===0&&M.push({r:O,c:K});if(M.length>0){const{r:O,c:K}=M[Math.floor(Math.random()*M.length)];get$2(m)[O][K]=Math.random()<.9?2:4}}function P(M){if(get$2(_))return;let O=!1;switch(M.key){case"ArrowUp":O=I();break;case"ArrowDown":O=k();break;case"ArrowLeft":O=F();break;case"ArrowRight":O=V();break}O&&(M.preventDefault(),D(),L())}function R(M){let O=M.filter(oe=>oe!==0),K=!1;for(let oe=0;oe<O.length-1;oe++)O[oe]===O[oe+1]&&(O[oe]*=2,set($,get$2($)+O[oe]),O.splice(oe+1,1),K=!0);for(;O.length<u;)O.push(0);return{newRow:O,moved:K||M.join(",")!==O.join(",")}}function F(){let M=!1;for(let O=0;O<u;O++){const{newRow:K,moved:oe}=R(get$2(m)[O]);get$2(m)[O]=K,oe&&(M=!0)}return M}function V(){let M=!1;for(let O=0;O<u;O++){const{newRow:K,moved:oe}=R([...get$2(m)[O]].reverse());get$2(m)[O]=K.reverse(),oe&&(M=!0)}return M}function I(){let M=!1;for(let O=0;O<u;O++){let K=[];for(let ae=0;ae<u;ae++)K.push(get$2(m)[ae][O]);const{newRow:oe,moved:de}=R(K);for(let ae=0;ae<u;ae++)get$2(m)[ae][O]=oe[ae];de&&(M=!0)}return M}function k(){let M=!1;for(let O=0;O<u;O++){let K=[];for(let ae=0;ae<u;ae++)K.push(get$2(m)[ae][O]);const{newRow:oe,moved:de}=R(K.reverse());K=oe.reverse();for(let ae=0;ae<u;ae++)get$2(m)[ae][O]=K[ae];de&&(M=!0)}return M}let U=state(0),W=state(0);function B(M){if(get$2(_))return;const O=M.changedTouches[0].clientX,K=M.changedTouches[0].clientY,oe=O-get$2(U),de=K-get$2(W);if(Math.abs(oe)<30&&Math.abs(de)<30)return;let ae=!1;Math.abs(oe)>Math.abs(de)?ae=oe>0?V():F():ae=de>0?k():I(),ae&&(M.preventDefault(),D(),L())}function L(){if(!get$2(E)){for(let M=0;M<u;M++)for(let O=0;O<u;O++)if(get$2(m)[M][O]>=f){set(E,!0),t()?(z("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{q(),e.onWin?.()},p)):z("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:q},{text:"Новая игра",action:x,class:"btn-secondary"}]);return}}G()&&!re()&&(set(_,!0),t()?(z("💀 Конец",`Игра окончена. Очки: ${get$2($)}`,[]),setTimeout(()=>{q(),e.onLose?.()},p)):z("💀 Конец",`Игра окончена. Очки: ${get$2($)}`,[{text:"Новая игра",action:x}]))}function G(){for(let M=0;M<u;M++)for(let O=0;O<u;O++)if(get$2(m)[M][O]===0)return!1;return!0}function re(){for(let M=0;M<u;M++)for(let O=0;O<u;O++)if(O<u-1&&get$2(m)[M][O]===get$2(m)[M][O+1]||M<u-1&&get$2(m)[M][O]===get$2(m)[M+1][O])return!0;return!1}function ue(){t()?(z("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{q(),e.onLose?.()},p)):z("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:x}])}function z(M,O,K){set(T,{show:!0,title:M,text:O,actions:K},!0)}function q(){get$2(T).show=!1}function N(){z("📖 Правила",`Эволюция 2048:

🎯 Цель: Создать существо уровня 2048 (Король).

⬅️➡️⬆️⬇️ Свайп или стрелки перемещают всех существ в одну сторону.

🔗 Одинаковые существа эволюционируют при столкновении:
🦇→👻→💀→🧟→🧛→🧙→👹→🐉→🔥→⚡→👑

💥 Новое существо появляется после каждого хода.

🏆 Победишь, когда получишь короля!`,[{text:"Понятно",action:q}])}BodyWrapper(r,{children:(M,O)=>{var K=root_1$k(),oe=first_child(K);{let be=user_derived(()=>t()?ue:void 0);GameHeader(oe,{onRestart:x,get onGiveUp(){return get$2(be)},get showGiveUp(){return t()},onShowRules:N})}var de=sibling(oe,2);de.__touchstart=[handleTouchStart,U,W],de.__touchend=B;var ae=child(de);each(ae,21,()=>get$2(m),index$1,(be,le)=>{var Q=comment(),ne=first_child(Q);each(ne,17,()=>get$2(le),index$1,(Y,Z)=>{var ce=root_3$i();set_class(ce,1,"cell svelte-1o3nb6j",null,{},{"cell-{cell}":Z-{}});var te=child(ce);template_effect(()=>{set_style(ce,`background-color: ${g[get$2(Z)]||"#2a2a40"};`),set_text(te,get$2(Z)>0?v[get$2(Z)]||get$2(Z):"")}),append(Y,ce)}),append(be,Q)});var _e=sibling(de,2);GameFooter(_e,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(be,le)=>{var Q=root_4$c(),ne=child(Q),Y=sibling(child(ne)),Z=child(Y);template_effect(()=>set_text(Z,get$2($))),append(be,Q)},$$slots:{default:!0}});var me=sibling(_e,2);MinigameModal(me,{get modal(){return get$2(T)}}),append(M,K)}}),pop()}delegate(["touchstart","touchend"]);var root_2$g=from_html('<button type="button"><span class="cell-content svelte-1p9db1h"> </span></button>'),root_3$h=from_html('<div class="footer-stats svelte-1p9db1h"><span class="mines-counter svelte-1p9db1h"></span> <span class="flag-counter svelte-1p9db1h"> </span></div>'),root_1$j=from_html('<!> <div id="game-container" class="svelte-1p9db1h"><div id="grid" class="svelte-1p9db1h"></div></div> <!> <!>',1);function CursedCrypts(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=8,f=8,p=10,v=1e3;let g=state(proxy([])),m=state(!1),$=state(!1),_=state(!0),E=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>P());let T=user_derived(()=>get$2(g).filter(q=>q.revealed).length),x=u*f,D=user_derived(()=>get$2($)||get$2(T)===x-p);function P(){set(g,Array(x).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),set(m,!1),set($,!1),set(_,!0),G()}function R(q){let N=0;for(;N<p;){const M=Math.floor(Math.random()*x);M!==q&&!get$2(g)[M].isMine&&(get$2(g)[M].isMine=!0,N++)}for(let M=0;M<x;M++)get$2(g)[M].isMine||(get$2(g)[M].adjacentMines=F(M))}function F(q){const N=Math.floor(q/f),M=q%f;let O=0;for(let K=-1;K<=1;K++)for(let oe=-1;oe<=1;oe++){if(K===0&&oe===0)continue;const de=N+K,ae=M+oe;if(de>=0&&de<u&&ae>=0&&ae<f){const _e=de*f+ae;get$2(g)[_e].isMine&&O++}}return O}function V(q){if(!(get$2(m)||get$2(g)[q].revealed||get$2(g)[q].flagged)){if(get$2(_)&&(R(q),set(_,!1)),get$2(g)[q].isMine){U(),set(m,!0),set($,!1),t()?(L("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{G(),e.onLose?.()},v)):L("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:P}]);return}k(q),W()}}function I(q,N){N.preventDefault(),!(get$2(m)||get$2(g)[q].revealed)&&(get$2(g)[q].flagged=!get$2(g)[q].flagged)}function k(q){if(!(q<0||q>=x)&&!(get$2(g)[q].revealed||get$2(g)[q].flagged)&&(get$2(g)[q].revealed=!0,get$2(g)[q].adjacentMines===0&&!get$2(g)[q].isMine)){const N=Math.floor(q/f),M=q%f;for(let O=-1;O<=1;O++)for(let K=-1;K<=1;K++){if(O===0&&K===0)continue;const oe=N+O,de=M+K;oe>=0&&oe<u&&de>=0&&de<f&&k(oe*f+de)}}}function U(){for(let q=0;q<x;q++)get$2(g)[q].isMine&&(get$2(g)[q].revealed=!0)}function W(){get$2(D)&&(set($,!0),set(m,!0),t()?(L("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{G(),e.onWin?.()},v)):L("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:P}]))}function B(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{G(),e.onLose?.()},v)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:P}])}function L(q,N,M){set(E,{show:!0,title:q,text:N,actions:M},!0)}function G(){get$2(E).show=!1}function re(q){return q.revealed?q.isMine?"💀":q.adjacentMines===0?"":q.adjacentMines.toString():q.flagged?"🕯":""}function ue(q){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][q]||"#ececec"}function z(){L("📖 Правила",`Сапёр (Проклятые склепы):

🎯 Цель: Открыть все ячейки, где нет мин.

🔢 Цифры показывают, сколько мин рядом с ячейкой (от 1 до 8).

🕯 Правый клик ставит флаг (пометить мину).

💡 Первое нажатие всегда безопасно — мины расставляются после первого клика.

💀 Если наткнёшься на мину — проигрыш.`,[{text:"Понятно",action:G}])}BodyWrapper(r,{children:(q,N)=>{var M=root_1$j(),O=first_child(M);{let _e=user_derived(()=>t()?B:void 0);GameHeader(O,{onRestart:P,get onGiveUp(){return get$2(_e)},get showGiveUp(){return t()},onShowRules:z})}var K=sibling(O,2),oe=child(K);set_style(oe,"grid-template-columns: repeat(8, 1fr);"),each(oe,21,()=>get$2(g),index$1,(_e,me,be)=>{var le=root_2$g();let Q;le.__click=()=>V(be),le.__contextmenu=Z=>I(be,Z);var ne=child(le),Y=child(ne);template_effect((Z,ce,te)=>{Q=set_class(le,1,"cell svelte-1p9db1h",null,Q,Z),set_attribute(le,"aria-label",get$2(me).revealed?get$2(me).isMine?"Мина":`Ячейка с ${get$2(me).adjacentMines} минами`:get$2(me).flagged?"Флаг":"Неизвестно"),set_style(ne,`color: ${ce??""}`),set_text(Y,te)},[()=>({revealed:get$2(me).revealed,mine:get$2(me).isMine&&get$2(me).revealed,flagged:get$2(me).flagged}),()=>get$2(me).revealed&&!get$2(me).isMine?ue(get$2(me).adjacentMines):"",()=>re(get$2(me))]),append(_e,le)});var de=sibling(K,2);GameFooter(de,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(_e,me)=>{var be=root_3$h(),le=child(be);le.textContent="💀 10";var Q=sibling(le,2),ne=child(Q);template_effect(Y=>set_text(ne,`🕯 ${Y??""}`),[()=>get$2(g).filter(Y=>Y.flagged).length]),append(_e,be)},$$slots:{default:!0}});var ae=sibling(de,2);MinigameModal(ae,{get modal(){return get$2(E)}}),append(q,M)}}),pop()}delegate(["click","contextmenu"]);function handleStockClick(r,e,t,i){if(get$2(e).length>0){const n=get$2(e).pop();n.faceUp=!0,get$2(t).push(n)}else get$2(t).length>0&&(set(e,get$2(t).reverse().map(n=>({...n,faceUp:!1})),!0),set(t,[],!0));update(i)}function handleWasteClick(r,e,t){get$2(e).length!==0&&set(t,{pile:-2,index:get$2(e).length-1},!0)}var root_2$f=from_html('<div class="card back svelte-fcha4g"></div>'),root_3$g=from_html('<div class="card empty svelte-fcha4g">🔄</div>'),root_4$b=from_html('<div><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),root_6$a=from_html('<div class="card front svelte-fcha4g"><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),root_7$9=from_html('<div class="card empty svelte-fcha4g">👻</div>'),root_5$f=from_html('<button type="button" class="pile foundation svelte-fcha4g"><!></button>'),root_10$3=from_html('<span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span>',1),root_9$3=from_html('<button type="button"><!></button>'),root_8$8=from_html('<div class="tableau svelte-fcha4g" role="button" tabindex="0"></div>'),root_11$3=from_html('<div class="footer-stats svelte-fcha4g"><span class="moves-counter svelte-fcha4g">Ходов: <strong class="svelte-fcha4g"> </strong></span></div>'),root_1$i=from_html('<!> <div id="game-container" class="svelte-fcha4g"><div class="top-row svelte-fcha4g"><button type="button" class="pile stock svelte-fcha4g" aria-label="Колода"><!></button> <button type="button" class="pile waste svelte-fcha4g" aria-label="Сброс"><!></button> <div class="foundations svelte-fcha4g"></div></div> <div class="tableaus svelte-fcha4g"></div></div> <!> <!>',1);function TowerOfSouls(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],f={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},p=[1,2,3,4,5,6,7,8,9,10,11,12,13],v={1:"A",11:"J",12:"Q",13:"K"};let g=state(proxy([])),m=state(proxy([])),$=state(proxy([[],[],[],[]])),_=state(proxy([[],[],[],[],[],[],[]])),E=state(null),T=state(!1),x=state(0),D=state(proxy({show:!1,title:"",text:"",actions:[]}));const P=1e3;onMount(()=>F());let R=user_derived(()=>get$2($).every(z=>z.length===13));function F(){let z=[];for(const N of u)for(const M of p)z.push({suit:N,rank:M,faceUp:!1});z=z.sort(()=>Math.random()-.5),set(g,[],!0),set(m,[],!0),set($,[[],[],[],[]],!0),set(_,[[],[],[],[],[],[],[]],!0);let q=0;for(let N=0;N<7;N++)for(let M=N;M<7;M++){const O=z[q++];O.faceUp=N===M,get$2(_)[M].push(O)}for(;q<z.length;)get$2(g).push(z[q++]);set(E,null),set(x,0),set(T,!1),L()}function V(z,q){const N=get$2(_)[z];if(get$2(E)){const{pile:M,index:O}=get$2(E);let K;M===-2?K=[get$2(m)[O]]:K=get$2(_)[M].slice(O);const oe=K[0];if(N.length===0){if(oe.rank===13){k(M,O,z,-1),set(E,null);return}}else{const de=N[N.length-1];if((oe.suit==="hearts"||oe.suit==="diamonds")!=(de.suit==="hearts"||de.suit==="diamonds")&&oe.rank===de.rank-1){k(M,O,z,-1),set(E,null);return}}if(K.length===1)for(let de=0;de<4;de++){const ae=get$2($)[de];if(ae.length===0){if(oe.rank===1){k(M,O,-1,de),set(E,null);return}}else{const _e=ae[ae.length-1];if(oe.suit===_e.suit&&oe.rank===_e.rank+1){k(M,O,-1,de),set(E,null);return}}}set(E,null)}else q>=0&&N[q]?.faceUp&&set(E,{pile:z,index:q},!0)}function I(z){if(!get$2(E))return;const{pile:q,index:N}=get$2(E);let M;q===-2?M=get$2(m)[N]:M=get$2(_)[q][N];const O=get$2($)[z];if(O.length===0)M.rank===1&&q>=-1&&(q===-2?[get$2(m)[N]]:get$2(_)[q].slice(N)).length===1&&k(q,N,-1,z);else{const K=O[O.length-1];M.suit===K.suit&&M.rank===K.rank+1&&(q===-2?[get$2(m)[N]]:get$2(_)[q].slice(N)).length===1&&k(q,N,-1,z)}set(E,null)}function k(z,q,N,M){let O;z===-2?O=[get$2(m).pop()]:(O=get$2(_)[z].splice(q),get$2(_)[z].length>0&&(get$2(_)[z][get$2(_)[z].length-1].faceUp=!0)),N>=0?get$2(_)[N].push(...O):M>=0&&get$2($)[M].push(...O),update(x),U()}function U(){get$2(R)&&(set(T,!0),t()?(B("🎉 Победа!",`Вы собрали все души за ${get$2(x)} ходов!`,[]),setTimeout(()=>{L(),e.onWin?.()},P)):B("🎉 Победа!",`Вы собрали все души за ${get$2(x)} ходов!`,[{text:"Играть снова",action:F}]))}function W(){t()?(B("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},P)):B("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:F}])}function B(z,q,N){set(D,{show:!0,title:z,text:q,actions:N},!0)}function L(){get$2(D).show=!1}function G(){B("📖 Правила",`Пасьянс (Башня душ):

🎯 Цель: Собрать все карты в фундаменты (справа) по мастям от туза до короля.

🃏 Кликни на колоду (слева) чтобы взять карту.

📋 Возьми карту из сброса и положи в столбец по убыванию (красная на чёрную).

🔄 Карты в столбце можно перемещать друг на друга по убыванию и чередованию цветов.

💡 Короля можно положить на пустой столбец.

🏆 Собери все 4 масти от туза до короля!`,[{text:"Понятно",action:L}])}function re(z){return v[z]||z.toString()}function ue(z){return z==="hearts"||z==="diamonds"?"#e94560":"#ececec"}BodyWrapper(r,{children:(z,q)=>{var N=root_1$i(),M=first_child(N);{let ce=user_derived(()=>t()?W:void 0);GameHeader(M,{onRestart:F,get onGiveUp(){return get$2(ce)},get showGiveUp(){return t()},onShowRules:G})}var O=sibling(M,2),K=child(O),oe=child(K);oe.__click=[handleStockClick,g,m,x];var de=child(oe);{var ae=ce=>{var te=root_2$f();append(ce,te)},_e=ce=>{var te=root_3$g();append(ce,te)};if_block(de,ce=>{get$2(g).length>0?ce(ae):ce(_e,!1)})}var me=sibling(oe,2);me.__click=[handleWasteClick,m,E];var be=child(me);{var le=ce=>{var te=root_4$b();let he;var ie=child(te),pe=child(ie),ge=sibling(ie,2),Ie=child(ge);template_effect((ke,Re,Ce)=>{he=set_class(te,1,"card front svelte-fcha4g",null,he,ke),set_text(pe,Re),set_style(ge,`color: ${Ce??""}`),set_text(Ie,f[get$2(m)[get$2(m).length-1].suit])},[()=>({selected:get$2(E)?.pile===-2}),()=>re(get$2(m)[get$2(m).length-1].rank),()=>ue(get$2(m)[get$2(m).length-1].suit)]),append(ce,te)};if_block(be,ce=>{get$2(m).length>0&&ce(le)})}var Q=sibling(me,2);each(Q,21,()=>get$2($),index$1,(ce,te,he)=>{var ie=root_5$f();ie.__click=()=>I(he),set_attribute(ie,"aria-label",`Фундамент ${he+1}`);var pe=child(ie);{var ge=ke=>{var Re=root_6$a(),Ce=child(Re),Be=child(Ce),De=sibling(Ce,2),w=child(De);template_effect((c,h)=>{set_text(Be,c),set_style(De,`color: ${h??""}`),set_text(w,f[get$2(te)[get$2(te).length-1].suit])},[()=>re(get$2(te)[get$2(te).length-1].rank),()=>ue(get$2(te)[get$2(te).length-1].suit)]),append(ke,Re)},Ie=ke=>{var Re=root_7$9();append(ke,Re)};if_block(pe,ke=>{get$2(te).length>0?ke(ge):ke(Ie,!1)})}append(ce,ie)});var ne=sibling(K,2);each(ne,21,()=>get$2(_),index$1,(ce,te,he)=>{var ie=root_8$8();ie.__click=()=>V(he,-1),ie.__keydown=pe=>{(pe.key==="Enter"||pe.key===" ")&&(pe.preventDefault(),V(he,-1))},set_attribute(ie,"aria-label",`Столбец ${he+1}`),each(ie,21,()=>get$2(te),index$1,(pe,ge,Ie)=>{var ke=root_9$3();let Re;ke.__click=De=>{De.stopPropagation(),V(he,Ie)},set_style(ke,`margin-top: ${Ie>0?"-80%":"0"}; z-index: ${Ie};`);var Ce=child(ke);{var Be=De=>{var w=root_10$3(),c=first_child(w),h=child(c),S=sibling(c,2),j=child(S);template_effect((X,ve)=>{set_text(h,X),set_style(S,`color: ${ve??""}`),set_text(j,f[get$2(ge).suit])},[()=>re(get$2(ge).rank),()=>ue(get$2(ge).suit)]),append(De,w)};if_block(Ce,De=>{get$2(ge).faceUp&&De(Be)})}template_effect((De,w)=>{Re=set_class(ke,1,"card svelte-fcha4g",null,Re,De),set_attribute(ke,"aria-label",w)},[()=>({front:get$2(ge).faceUp,back:!get$2(ge).faceUp,selected:get$2(E)?.pile===he&&get$2(E)?.index===Ie}),()=>get$2(ge).faceUp?`${re(get$2(ge).rank)} ${f[get$2(ge).suit]}`:"Лицевая сторона карты"]),append(pe,ke)}),append(ce,ie)});var Y=sibling(O,2);GameFooter(Y,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(ce,te)=>{var he=root_11$3(),ie=child(he),pe=sibling(child(ie)),ge=child(pe);template_effect(()=>set_text(ge,get$2(x))),append(ce,he)},$$slots:{default:!0}});var Z=sibling(Y,2);MinigameModal(Z,{get modal(){return get$2(D)}}),append(z,N)}}),pop()}delegate(["click","keydown"]);var root_2$e=from_html('<button type="button" class="cell svelte-v9v15s"> </button>'),root_3$f=from_html('<div class="footer-stats svelte-v9v15s"><span class="player-info svelte-v9v15s">Ход: <strong class="svelte-v9v15s"> </strong></span></div>'),root_1$h=from_html('<!> <div id="game-container" class="svelte-v9v15s"><div class="status svelte-v9v15s">Ход: <span class="current-player svelte-v9v15s"> </span></div> <div class="board svelte-v9v15s"></div></div> <!> <!>',1);function AlchemistsCross(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=3,f=1e3,p=["🧪","🗡️"];let v=state(proxy(Array(u*u).fill(null))),g=state(proxy(p[0])),m=state(!1),$=state(null),_=state(proxy({show:!1,title:"",text:"",actions:[]}));function E(I){if(!(get$2(m)||get$2(v)[I])){if(get$2(v)[I]=get$2(g),T(get$2(g))){x(get$2(g));return}if(get$2(v).every(k=>k)){x(null);return}set(g,get$2(g)===p[0]?p[1]:p[0],!0)}}function T(I){return[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(U=>U.every(W=>get$2(v)[W]===I))}function x(I){set(m,!0),set($,I,!0),I?t()?(R("🎉 Победа!",`Победил ${I}!`,[]),setTimeout(()=>{F(),e.onWin?.()},f)):R("🎉 Победа!",`Победил ${I}!`,[{text:"Играть снова",action:D}]):t()?(R("🤝 Ничья!","Ничья!",[]),setTimeout(()=>{F(),e.onLose?.()},f)):R("🤝 Ничья!","Ничья!",[{text:"Играть снова",action:D}])}function D(){set(v,Array(u*u).fill(null),!0),set(g,p[0],!0),set(m,!1),set($,null),F()}function P(){set(m,!0);const I=get$2(g);t()?(R("💀 Сдаюсь",`${I} сдался!`,[]),setTimeout(()=>{F(),e.onLose?.()},f)):R("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:D}])}function R(I,k,U){set(_,{show:!0,title:I,text:k,actions:U},!0)}function F(){get$2(_).show=!1}function V(){R("📖 Правила",`Алхимический крестик:

🎯 Цель: Первым выстроить 3 своих символа в ряд (по горизонтали, вертикали или диагонали).

🧪 Игрок 1: 🧪
🗡️ Игрок 2: 🗡️

⚠️ Игроки ходят по очереди.`,[{text:"Понятно",action:F}])}onMount(()=>{D()}),BodyWrapper(r,{children:(I,k)=>{var U=root_1$h(),W=first_child(U);{let N=user_derived(()=>t()?P:void 0);GameHeader(W,{onRestart:D,get onGiveUp(){return get$2(N)},get showGiveUp(){return t()},onShowRules:V})}var B=sibling(W,2),L=child(B),G=sibling(child(L)),re=child(G),ue=sibling(L,2);each(ue,21,()=>get$2(v),index$1,(N,M,O)=>{var K=root_2$e();K.__click=()=>E(O);var oe=child(K);template_effect(()=>{K.disabled=!!get$2(M)||get$2(m),set_text(oe,get$2(M)??"")}),append(N,K)});var z=sibling(B,2);GameFooter(z,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(N,M)=>{var O=root_3$f(),K=child(O),oe=sibling(child(K)),de=child(oe);template_effect(()=>set_text(de,get$2(g))),append(N,O)},$$slots:{default:!0}});var q=sibling(z,2);MinigameModal(q,{get modal(){return get$2(_)}}),template_effect(()=>set_text(re,get$2(g))),append(I,U)}}),pop()}delegate(["click"]);var on_click$b=(r,e,t)=>e(get$2(t)),root_3$e=from_html('<button type="button" class="option-btn svelte-18w6na5"> </button>'),root_2$d=from_html('<div> </div> <div class="score svelte-18w6na5">Очки: <strong class="svelte-18w6na5"> </strong></div> <div class="question svelte-18w6na5"> </div> <div class="options svelte-18w6na5"></div>',1),root_4$a=from_html('<div class="start-screen svelte-18w6na5"><div class="title svelte-18w6na5">🕷️ Шёпот пауков</div> <div class="description svelte-18w6na5"></div> <button type="button" class="start-btn svelte-18w6na5">Начать испытание</button></div>'),root_5$e=from_html('<div class="footer-stats svelte-18w6na5"><span class="score-display svelte-18w6na5">Очки: <strong class="svelte-18w6na5"> </strong></span> <span class="time-display svelte-18w6na5">Время: <strong class="svelte-18w6na5"> </strong></span></div>'),root_1$g=from_html('<!> <div id="game-container" class="svelte-18w6na5"><!></div> <!> <!>',1);function WhisperOfSpiders($$anchor,$$props){push($$props,!0);let integrated=prop($$props,"integrated",3,!1),rewardItem=prop($$props,"rewardItem",3,null),items=prop($$props,"items",19,()=>[]),bucketName=prop($$props,"bucketName",3,"dracula"),question=state(""),correctAnswer=state(0),options=state(proxy([])),score=state(0),timeLeft=state(30),gameActive=state(!1),timerInterval=null;const TIMEOUT=1e3,WIN_SCORE=10;let modal=state(proxy({show:!1,title:"",text:"",actions:[]}));onMount(()=>()=>{timerInterval&&clearInterval(timerInterval)});function generateQuestion(){const a=Math.floor(Math.random()*10)+1,b=Math.floor(Math.random()*10)+1,operations=["+","-","*"],op=operations[Math.floor(Math.random()*operations.length)];set(question,`${a} ${op} ${b}`),set(correctAnswer,eval(get$2(question)),!0);let newOptions=[get$2(correctAnswer)];for(;newOptions.length<4;){let r=get$2(correctAnswer)+(Math.floor(Math.random()*7)-3);!newOptions.includes(r)&&r>0&&newOptions.push(r)}set(options,newOptions.sort(()=>Math.random()-.5),!0)}function initGame(){timerInterval&&clearInterval(timerInterval),set(gameActive,!1),set(score,0),set(timeLeft,30),hideModal()}function startGame(){set(gameActive,!0),set(score,0),set(timeLeft,30),generateQuestion(),timerInterval=setInterval(()=>{update(timeLeft,-1),get$2(timeLeft)<=0&&endGame()},1e3)}function endGame(){set(gameActive,!1),timerInterval&&(clearInterval(timerInterval),timerInterval=null),get$2(score)>=WIN_SCORE?integrated()?(showModal("🎉 Победа!",`Вы набрали ${get$2(score)} очков!`,[]),setTimeout(()=>{hideModal(),$$props.onWin?.()},TIMEOUT)):showModal("🎉 Победа!",`Вы набрали ${get$2(score)} очков!`,[{text:"Играть снова",action:initGame}]):integrated()?(showModal("💥 Время вышло!",`Вы набрали ${get$2(score)} очков. Нужно ${WIN_SCORE}.`,[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("💥 Время вышло!",`Вы набрали ${get$2(score)} очков. Нужно ${WIN_SCORE}.`,[{text:"Попробовать снова",action:initGame}])}function handleAnswer(r){get$2(gameActive)&&(r===get$2(correctAnswer)?(update(score),get$2(score)>=WIN_SCORE?endGame():generateQuestion()):set(timeLeft,Math.max(0,get$2(timeLeft)-2),!0))}function handleGiveUp(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),set(gameActive,!1),integrated()?(showModal("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{hideModal(),$$props.onLose?.()},TIMEOUT)):showModal("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:initGame}])}function showModal(r,e,t){set(modal,{show:!0,title:r,text:e,actions:t},!0)}function hideModal(){get$2(modal).show=!1}function showRules(){showModal("📖 Правила",`Шёпот пауков:

🎯 Цель: Набери ${WIN_SCORE} очков за 30 секунд.

🔢 Реши математический пример, выбрав правильный ответ из 4 вариантов.

⏱️ За неправильный ответ штраф -2 секунды.`,[{text:"Понятно",action:hideModal}])}BodyWrapper($$anchor,{children:(r,e)=>{var t=root_1$g(),i=first_child(t);{let g=user_derived(()=>integrated()?handleGiveUp:void 0);GameHeader(i,{onRestart:initGame,get onGiveUp(){return get$2(g)},get showGiveUp(){return integrated()},onShowRules:showRules})}var n=sibling(i,2),o=child(n);{var u=g=>{var m=root_2$d(),$=first_child(m);let _;var E=child($),T=sibling($,2),x=sibling(child(T)),D=child(x),P=sibling(T,2),R=child(P),F=sibling(P,2);each(F,21,()=>get$2(options),index$1,(V,I)=>{var k=root_3$e();k.__click=[on_click$b,handleAnswer,I];var U=child(k);template_effect(()=>set_text(U,get$2(I))),append(V,k)}),template_effect(V=>{_=set_class($,1,"timer svelte-18w6na5",null,_,V),set_text(E,`⏱️ ${get$2(timeLeft)??""}s`),set_text(D,`${get$2(score)??""}/10`),set_text(R,`${get$2(question)??""} = ?`)},[()=>({warning:get$2(timeLeft)<=10})]),append(g,m)},f=g=>{var m=root_4$a(),$=sibling(child(m),2);$.textContent="Реши 10 примеров за 30 секунд";var _=sibling($,2);_.__click=startGame,append(g,m)};if_block(o,g=>{get$2(gameActive)?g(u):g(f,!1)})}var p=sibling(n,2);GameFooter(p,{get rewardItem(){return rewardItem()},get items(){return items()},get bucketName(){return bucketName()},children:(g,m)=>{var $=root_5$e(),_=child($),E=sibling(child(_)),T=child(E),x=sibling(_,2),D=sibling(child(x)),P=child(D);template_effect(()=>{set_text(T,get$2(score)),set_text(P,`${get$2(timeLeft)??""}s`)}),append(g,$)},$$slots:{default:!0}});var v=sibling(p,2);MinigameModal(v,{get modal(){return get$2(modal)}}),append(r,t)}}),pop()}delegate(["click"]);var root_2$c=from_html('<span class="watching svelte-14s4ld8">👀 Смотри...</span>'),root_4$9=from_html('<span class="playing svelte-14s4ld8">🎮 Повторяй!</span>'),root_6$9=from_html("<span> </span>"),root_7$8=from_html('<button type="button" class="symbol svelte-14s4ld8"> </button>'),root_8$7=from_html('<div class="footer-stats svelte-14s4ld8"><span class="round-display svelte-14s4ld8">Раунд: <strong class="svelte-14s4ld8"> </strong></span></div>'),root_1$f=from_html('<!> <div id="game-container" class="svelte-14s4ld8"><div class="status svelte-14s4ld8"><!></div> <div class="round-info svelte-14s4ld8">Раунд: <strong class="svelte-14s4ld8"> </strong></div> <div class="symbols svelte-14s4ld8"></div></div> <!> <!>',1);function SoulCycle(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["🔥","💧","🌪️","🌑"],f=["#e94560","#0984e3","#fdcb6e","#6c5ce7"],p=1e3,v=5;let g=state(proxy([])),m=state(proxy([])),$=state(0),_=state(!1),E=state(-1),T=state(!1),x=state(!1),D=state(!1),P=state(proxy({show:!1,title:"",text:"",actions:[]}));function R(){set(_,!0),set(D,!1),set(m,[],!0);const re=u[Math.floor(Math.random()*u.length)];set(g,[...get$2(g),re],!0),F()}async function F(){await new Promise(re=>setTimeout(re,500));for(let re=0;re<get$2(g).length;re++)set(E,u.indexOf(get$2(g)[re]),!0),await new Promise(ue=>setTimeout(ue,500)),set(E,-1),await new Promise(ue=>setTimeout(ue,200));set(_,!1),set(D,!0)}function V(re){if(get$2(_)||!get$2(D)||get$2(T))return;const ue=u[re],z=get$2(g)[get$2(m).length];if(ue!==z){k();return}set(m,[...get$2(m),ue],!0),get$2(m).length===get$2(g).length&&(update($),get$2($)>=v?I():(set(D,!1),setTimeout(R,1e3)))}function I(){set(T,!0),set(x,!0),t()?(B("🎉 Победа!",`Вы прошли ${v} раундов!`,[]),setTimeout(()=>{L(),e.onWin?.()},p)):B("🎉 Победа!",`Вы прошли ${v} раундов!`,[{text:"Играть снова",action:U}])}function k(){set(T,!0),set(x,!1),t()?(B("💥 Ошибка!","Вы нажали неправильный символ!",[]),setTimeout(()=>{L(),e.onLose?.()},p)):B("💥 Ошибка!","Вы нажали неправильный символ!",[{text:"Попробовать снова",action:U}])}function U(){set(g,[],!0),set(m,[],!0),set($,0),set(T,!1),set(x,!1),set(_,!1),set(D,!1),set(E,-1),L(),R()}function W(){set(T,!0),t()?(B("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},p)):B("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:U}])}function B(re,ue,z){set(P,{show:!0,title:re,text:ue,actions:z},!0)}function L(){get$2(P).show=!1}function G(){B("📖 Правила",`Цикл душ:

🎯 Цель: Пройди ${v} раундов.

🔴 Компьютер показывает последовательность символов.

🟢 Повтори последовательность в том же порядке.

⚠️ Одна ошибка — и игра окончена!`,[{text:"Понятно",action:L}])}onMount(()=>{U()}),BodyWrapper(r,{children:(re,ue)=>{var z=root_1$f(),q=first_child(z);{let Q=user_derived(()=>t()?W:void 0);GameHeader(q,{onRestart:U,get onGiveUp(){return get$2(Q)},get showGiveUp(){return t()},onShowRules:G})}var N=sibling(q,2),M=child(N),O=child(M);{var K=Q=>{var ne=root_2$c();append(Q,ne)},oe=Q=>{var ne=comment(),Y=first_child(ne);{var Z=te=>{var he=root_4$9();append(te,he)},ce=te=>{var he=comment(),ie=first_child(he);{var pe=ge=>{var Ie=root_6$9();let ke;var Re=child(Ie);template_effect(Ce=>{ke=set_class(Ie,1,"svelte-14s4ld8",null,ke,Ce),set_text(Re,get$2(x)?"🎉 Победа!":"💥 Проигрыш")},[()=>({won:get$2(x),lost:!get$2(x)})]),append(ge,Ie)};if_block(ie,ge=>{get$2(T)&&ge(pe)},!0)}append(te,he)};if_block(Y,te=>{get$2(D)?te(Z):te(ce,!1)},!0)}append(Q,ne)};if_block(O,Q=>{get$2(_)?Q(K):Q(oe,!1)})}var de=sibling(M,2),ae=sibling(child(de)),_e=child(ae),me=sibling(de,2);each(me,21,()=>u,index$1,(Q,ne,Y)=>{var Z=root_7$8();Z.__click=()=>V(Y);var ce=child(Z);template_effect(()=>{set_style(Z,`background-color: ${f[Y]??""}; filter: ${get$2(E)===Y?"brightness(1.5)":"none"}; transform: ${get$2(E)===Y?"scale(1.1)":"scale(1)"};`),Z.disabled=get$2(_)||!get$2(D)||get$2(T),set_text(ce,get$2(ne))}),append(Q,Z)});var be=sibling(N,2);GameFooter(be,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(Q,ne)=>{var Y=root_8$7(),Z=child(Y),ce=sibling(child(Z)),te=child(ce);template_effect(()=>set_text(te,get$2($))),append(Q,Y)},$$slots:{default:!0}});var le=sibling(be,2);MinigameModal(le,{get modal(){return get$2(P)}}),template_effect(()=>set_text(_e,`${get$2($)??""}/5`)),append(re,z)}}),pop()}delegate(["click"]);function startGame(r,e,t){set(e,!0),t()}var root_2$b=from_html('<div class="start-screen svelte-1g2wfw4"><div class="title svelte-1g2wfw4">🌀 Лабиринт Минотавра</div> <div class="description svelte-1g2wfw4">Найди выход из лабиринта</div> <button type="button" class="start-btn svelte-1g2wfw4">Начать испытание</button></div>'),root_5$d=from_html("<span><!></span>"),root_4$8=from_html('<div class="row svelte-1g2wfw4"></div>'),on_click$a=(r,e)=>e(0,-1),on_click_1$5=(r,e)=>e(-1,0),on_click_2$2=(r,e)=>e(1,0),on_click_3$2=(r,e)=>e(0,1),root_3$d=from_html('<div class="maze-container svelte-1g2wfw4"><div class="maze svelte-1g2wfw4"></div> <div class="controls svelte-1g2wfw4"><button type="button" class="control-btn svelte-1g2wfw4">⬆️</button> <div class="controls-row svelte-1g2wfw4"><button type="button" class="control-btn svelte-1g2wfw4">⬅️</button> <button type="button" class="control-btn svelte-1g2wfw4">➡️</button></div> <button type="button" class="control-btn svelte-1g2wfw4">⬇️</button></div></div>'),root_8$6=from_html('<div class="footer-stats svelte-1g2wfw4"><span class="status-text svelte-1g2wfw4"> </span></div>'),root_1$e=from_html('<!> <div id="game-container" class="svelte-1g2wfw4"><!></div> <!> <!>',1);function LabyrinthOfMinotaur(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u="🧱",f="🚪",p="·",v=1e3,g=7;let m=state(proxy([])),$=state(proxy({x:1,y:1})),_=state(proxy({x:5,y:5})),E=state(!1),T=state(!1),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(B=g){const L=Array(B).fill(null).map(()=>Array(B).fill(u)),G=(re,ue)=>{const z=[[0,1],[1,0],[0,-1],[-1,0]].sort(()=>Math.random()-.5);for(let[q,N]of z){const M=re+q*2,O=ue+N*2;M>0&&M<B-1&&O>0&&O<B-1&&L[O][M]===u&&(L[ue+N][re+q]=p,L[O][M]=p,G(M,O))}};return L[1][1]=p,G(1,1),L[get$2(_).y][get$2(_).x]=f,L}function P(){set($,{x:1,y:1},!0),set(_,{x:g-2,y:g-2},!0),set(m,D(g),!0),set(E,!1),set(T,!1),k()}function R(B,L){if(get$2(E)||!get$2(T))return;const G=get$2($).x+B,re=get$2($).y+L;(get$2(m)[re]?.[G]===p||get$2(m)[re]?.[G]===f)&&set($,{x:G,y:re},!0),get$2($).x===get$2(_).x&&get$2($).y===get$2(_).y&&F()}function F(){set(E,!0),t()?(I("🎉 Победа!","Вы нашли выход из лабиринта!",[]),setTimeout(()=>{k(),e.onWin?.()},v)):I("🎉 Победа!","Вы нашли выход из лабиринта!",[{text:"Играть снова",action:P}])}function V(){get$2(T)&&(set(E,!0),t()?(I("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{k(),e.onLose?.()},v)):I("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:P}]))}function I(B,L,G){set(x,{show:!0,title:B,text:L,actions:G},!0)}function k(){get$2(x).show=!1}function U(){I("📖 Правила",`Лабиринт Минотавра:

🎯 Цель: Найди выход из лабиринта.

🧙‍♂️ Управляй магом с помощью кнопок.

🚪 Дойди до двери, чтобы выиграть.

⚠️ Избегай стен!`,[{text:"Понятно",action:k}])}function W(B){if(!(!get$2(T)||get$2(E)))switch(B.key){case"ArrowUp":case"w":R(0,-1);break;case"ArrowDown":case"s":R(0,1);break;case"ArrowLeft":case"a":R(-1,0);break;case"ArrowRight":case"d":R(1,0);break}}onMount(()=>(P(),window.addEventListener("keydown",W),()=>window.removeEventListener("keydown",W))),BodyWrapper(r,{children:(B,L)=>{var G=root_1$e(),re=first_child(G);{let K=user_derived(()=>t()?V:void 0),oe=user_derived(()=>t()&&get$2(T));GameHeader(re,{onRestart:P,get onGiveUp(){return get$2(K)},get showGiveUp(){return get$2(oe)},onShowRules:U})}var ue=sibling(re,2),z=child(ue);{var q=K=>{var oe=root_2$b(),de=sibling(child(oe),4);de.__click=[startGame,T,P],append(K,oe)},N=K=>{var oe=root_3$d(),de=child(oe);each(de,21,()=>get$2(m),index$1,(ne,Y,Z)=>{var ce=root_4$8();each(ce,21,()=>get$2(Y),index$1,(te,he,ie)=>{var pe=root_5$d();let ge;var Ie=child(pe);{var ke=Ce=>{var Be=text();Be.nodeValue="🧙",append(Ce,Be)},Re=Ce=>{var Be=text();template_effect(()=>set_text(Be,get$2(he))),append(Ce,Be)};if_block(Ie,Ce=>{get$2($).x===ie&&get$2($).y===Z?Ce(ke):Ce(Re,!1)})}template_effect(Ce=>ge=set_class(pe,1,"cell svelte-1g2wfw4",null,ge,Ce),[()=>({wall:get$2(he)===u,exit:get$2(he)===f})]),append(te,pe)}),append(ne,ce)});var ae=sibling(de,2),_e=child(ae);_e.__click=[on_click$a,R];var me=sibling(_e,2),be=child(me);be.__click=[on_click_1$5,R];var le=sibling(be,2);le.__click=[on_click_2$2,R];var Q=sibling(me,2);Q.__click=[on_click_3$2,R],append(K,oe)};if_block(z,K=>{get$2(T)?K(N,!1):K(q)})}var M=sibling(ue,2);GameFooter(M,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(K,oe)=>{var de=root_8$6(),ae=child(de),_e=child(ae);template_effect(()=>set_text(_e,get$2(E)?"🎉 Победа!":get$2(T)?"Играет...":"Готов")),append(K,de)},$$slots:{default:!0}});var O=sibling(M,2);MinigameModal(O,{get modal(){return get$2(x)}}),append(B,G)}}),pop()}delegate(["click"]);function rollDice(r,e,t,i,n,o){if(!(get$2(e)<=0||get$2(t))){for(let u=0;u<get$2(i).length;u++)get$2(n)[u]||(get$2(i)[u]=Math.floor(Math.random()*6)+1);update(e,-1),o()}}var root_2$a=from_html('<button type="button"><span class="die-face svelte-1y509l9"> </span> <span class="die-number svelte-1y509l9"> </span></button>'),root_3$c=from_html('<div class="footer-stats svelte-1y509l9"><span class="rolls-info svelte-1y509l9">Бросков: <strong class="svelte-1y509l9"> </strong></span></div>'),root_1$d=from_html('<!> <div id="game-container" class="svelte-1y509l9"><div class="message svelte-1y509l9"> </div> <div class="dice-area svelte-1y509l9"></div> <button type="button" class="roll-btn svelte-1y509l9"> </button> <div class="target svelte-1y509l9">Цель: <span class="target-combo svelte-1y509l9">4-2-1</span></div></div> <!> <!>',1);function Bones421(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["⚀","⚁","⚂","⚃","⚄","⚅"],f=1e3,p="124";let v=state(proxy([1,1,1])),g=state(3),m=state(proxy([!1,!1,!1])),$=state(!1),_=state(!1),E=state("Брось кости!"),T=state(proxy({show:!1,title:"",text:"",actions:[]}));function x(){[...get$2(v)].sort().join("")===p?(set(E,"Победа! Снято проклятие!"),set($,!0),set(_,!0),D()):get$2(g)===0?(set(E,"Попытки кончились..."),set($,!0),set(_,!1),P()):set(E,`Осталось бросков: ${get$2(g)}`)}function D(){t()?(I("🎉 Победа!","Выпало 4-2-1! Проклятие снято!",[]),setTimeout(()=>{k(),e.onWin?.()},f)):I("🎉 Победа!","Выпало 4-2-1! Проклятие снято!",[{text:"Играть снова",action:F}])}function P(){t()?(I("💥 Поражение","Не удалось выбросить 4-2-1...",[]),setTimeout(()=>{k(),e.onLose?.()},f)):I("💥 Поражение","Не удалось выбросить 4-2-1...",[{text:"Попробовать снова",action:F}])}function R(W){get$2($)||get$2(g)===3||(get$2(m)[W]=!get$2(m)[W])}function F(){set(v,[1,1,1],!0),set(g,3),set(m,[!1,!1,!1],!0),set($,!1),set(_,!1),set(E,"Брось кости!"),k()}function V(){get$2($)||(set($,!0),set(_,!1),t()?(I("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{k(),e.onLose?.()},f)):I("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:F}]))}function I(W,B,L){set(T,{show:!0,title:W,text:B,actions:L},!0)}function k(){get$2(T).show=!1}function U(){I("📖 Правила",`Кости 4-2-1:

🎯 Цель: Выбрось комбинацию 4-2-1.

🎲 У тебя есть 3 броска.

🔒 После первого броска можно зафиксировать кубики.

💡 Комбинация 4-2-1 (в любом порядке) — победа!`,[{text:"Понятно",action:k}])}onMount(()=>{F()}),BodyWrapper(r,{children:(W,B)=>{var L=root_1$d(),G=first_child(L);{let oe=user_derived(()=>t()?V:void 0),de=user_derived(()=>t()&&!get$2($));GameHeader(G,{onRestart:F,get onGiveUp(){return get$2(oe)},get showGiveUp(){return get$2(de)},onShowRules:U})}var re=sibling(G,2),ue=child(re),z=child(ue),q=sibling(ue,2);each(q,21,()=>get$2(v),index$1,(oe,de,ae)=>{var _e=root_2$a();let me;_e.__click=()=>R(ae);var be=child(_e),le=child(be),Q=sibling(be,2),ne=child(Q);template_effect(Y=>{me=set_class(_e,1,"die svelte-1y509l9",null,me,Y),_e.disabled=get$2($)||get$2(g)===3,set_text(le,u[get$2(de)-1]),set_text(ne,get$2(de))},[()=>({locked:get$2(m)[ae]})]),append(oe,_e)});var N=sibling(q,2);N.__click=[rollDice,g,$,v,m,x];var M=child(N),O=sibling(re,2);GameFooter(O,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(oe,de)=>{var ae=root_3$c(),_e=child(ae),me=sibling(child(_e)),be=child(me);template_effect(()=>set_text(be,get$2(g))),append(oe,ae)},$$slots:{default:!0}});var K=sibling(O,2);MinigameModal(K,{get modal(){return get$2(T)}}),template_effect(()=>{set_text(z,get$2(E)),N.disabled=get$2(g)===0||get$2($),set_text(M,`🎲 Бросить (${get$2(g)??""})`)}),append(W,L)}}),pop()}delegate(["click"]);var root_26=from_html('<div class="loading svelte-15dde84">Загрузка игры...</div>'),root$9=from_html('<div class="minigame-container svelte-15dde84"><!></div>');function MinigameLauncher(r,e){push(e,!0);let t=prop(e,"bucketName",3,"dracula");function i(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function n(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var o=root$9(),u=child(o);{var f=v=>{OnetMonsters(v,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=v=>{var g=comment(),m=first_child(g);{var $=E=>{MemoMonsters(E,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},_=E=>{var T=comment(),x=first_child(T);{var D=R=>{LightOut(R,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},P=R=>{var F=comment(),V=first_child(F);{var I=U=>{FloodIt(U,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},k=U=>{var W=comment(),B=first_child(W);{var L=re=>{BrokenMirror(re,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},G=re=>{var ue=comment(),z=first_child(ue);{var q=M=>{Evolution2048(M,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},N=M=>{var O=comment(),K=first_child(O);{var oe=ae=>{CursedCrypts(ae,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},de=ae=>{var _e=comment(),me=first_child(_e);{var be=Q=>{TowerOfSouls(Q,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},le=Q=>{var ne=comment(),Y=first_child(ne);{var Z=te=>{AlchemistsCross(te,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ce=te=>{var he=comment(),ie=first_child(he);{var pe=Ie=>{WhisperOfSpiders(Ie,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ge=Ie=>{var ke=comment(),Re=first_child(ke);{var Ce=De=>{SoulCycle(De,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},Be=De=>{var w=comment(),c=first_child(w);{var h=j=>{LabyrinthOfMinotaur(j,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},S=j=>{var X=comment(),ve=first_child(X);{var Ae=Se=>{Bones421(Se,{onWin:i,onLose:n,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},je=Se=>{var Fe=root_26();append(Se,Fe)};if_block(ve,Se=>{e.gameId==="bones421"?Se(Ae):Se(je,!1)},!0)}append(j,X)};if_block(c,j=>{e.gameId==="labyrinth_of_minotaur"?j(h):j(S,!1)},!0)}append(De,w)};if_block(Re,De=>{e.gameId==="soul_cycle"?De(Ce):De(Be,!1)},!0)}append(Ie,ke)};if_block(ie,Ie=>{e.gameId==="whisper_of_spiders"?Ie(pe):Ie(ge,!1)},!0)}append(te,he)};if_block(Y,te=>{e.gameId==="alchemists_cross"?te(Z):te(ce,!1)},!0)}append(Q,ne)};if_block(me,Q=>{e.gameId==="tower_of_souls"?Q(be):Q(le,!1)},!0)}append(ae,_e)};if_block(K,ae=>{e.gameId==="cursed_crypts"?ae(oe):ae(de,!1)},!0)}append(M,O)};if_block(z,M=>{e.gameId==="evolution2048"?M(q):M(N,!1)},!0)}append(re,ue)};if_block(B,re=>{e.gameId==="broken_mirror"?re(L):re(G,!1)},!0)}append(U,W)};if_block(V,U=>{e.gameId==="flood_it"?U(I):U(k,!1)},!0)}append(R,F)};if_block(x,R=>{e.gameId==="light_out"?R(D):R(P,!1)},!0)}append(E,T)};if_block(m,E=>{e.gameId==="memo_monsters"?E($):E(_,!1)},!0)}append(v,g)};if_block(u,v=>{e.gameId==="onet_monsters"?v(f):v(p,!1)})}append(r,o),pop()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let r=0;r<256;++r)byteToHex.push((r+256).toString(16).slice(1));function unsafeStringify(r,e=0){return(byteToHex[r[e+0]]+byteToHex[r[e+1]]+byteToHex[r[e+2]]+byteToHex[r[e+3]]+"-"+byteToHex[r[e+4]]+byteToHex[r[e+5]]+"-"+byteToHex[r[e+6]]+byteToHex[r[e+7]]+"-"+byteToHex[r[e+8]]+byteToHex[r[e+9]]+"-"+byteToHex[r[e+10]]+byteToHex[r[e+11]]+byteToHex[r[e+12]]+byteToHex[r[e+13]]+byteToHex[r[e+14]]+byteToHex[r[e+15]]).toLowerCase()}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(r,e,t){if(native.randomUUID&&!r)return native.randomUUID();r=r||{};const i=r.random||(r.rng||rng)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,unsafeStringify(i)}async function updateUserStats(r,e){try{const{data:t,error:i}=await supabase.from("user_keys").select("visit_count").eq("user_key",r).single();if(i){console.error("Error fetching user stats:",i);return}const{error:n}=await supabase.from("user_keys").update({visit_count:(t?.visit_count||0)+1,last_visit:new Date().toISOString(),user_agent:e}).eq("user_key",r);n?console.error("Error updating user stats:",n):console.log("User stats updated for:",r)}catch(t){console.error("Error in updateUserStats:",t)}}let sessionStartTime=null;async function trackAnalyticsEvent(r,e){const t=get$1(userKeyStore);if(!t){console.warn("[Analytics] No user key, skipping event:",r);return}try{const{error:i}=await supabase.from("user_events").insert([{user_key:t,event_type:r,page_url:typeof window<"u"?window.location.href:null,event_data:e||{}}]);i?console.error("[Analytics] Error tracking event:",i):console.log("[Analytics] Event tracked:",r,e)}catch(i){console.error("[Analytics] Exception:",i)}}function createUserKeyStore(){const{subscribe:r,set:e}=writable(null);return{subscribe:r,init:async()=>{try{if(typeof localStorage>"u")return console.error("localStorage is not available"),null;if(typeof navigator>"u")return console.error("navigator is not available"),null;let t=localStorage.getItem("userKey");const i=navigator.userAgent,n=typeof document<"u"&&document.referrer||"direct";if(t)await updateUserStats(t,i);else{t=v4();const{error:o}=await supabase.from("user_keys").insert([{user_key:t,user_agent:i,referrer:n}]);if(o)return console.error("Error saving to Supabase:",o),null;console.log("New user created with key:",t),localStorage.setItem("userKey",t)}return e(t),t}catch(t){return console.error("Error in init:",t),null}},getUserStats:async t=>{try{const{data:i,error:n}=await supabase.from("user_keys").select("*").eq("user_key",t).single();return n?(console.error("Error getting user stats:",n),null):i}catch(i){return console.error("Error in getUserStats:",i),null}},regenerateKey:async()=>{try{if(typeof localStorage>"u"||typeof navigator>"u")return null;const t=v4(),i=navigator.userAgent,n=typeof document<"u"&&document.referrer||"direct",{error:o}=await supabase.from("user_keys").insert([{user_key:t,user_agent:i,referrer:n}]);return o?(console.error("Error saving new key to Supabase:",o),null):(localStorage.setItem("userKey",t),e(t),console.log("Key regenerated:",t),t)}catch(t){return console.error("Error in regenerateKey:",t),null}},clearKey:()=>{typeof localStorage<"u"&&localStorage.removeItem("userKey"),e(null),console.log("User key cleared")},trackEvent:async(t,i)=>{await trackAnalyticsEvent(t,i)},trackStoryStart:async(t,i)=>{await trackAnalyticsEvent("story_start",{story_id:t,story_title:i})},trackStoryComplete:async(t,i,n)=>{await trackAnalyticsEvent("story_complete",{story_id:t,story_title:i,dialogue_count:n})},trackGameStart:async(t,i,n)=>{await trackAnalyticsEvent("game_start",{game_id:t,game_title:i,story_id:n})},trackGameResult:async(t,i,n,o)=>{await trackAnalyticsEvent(n?"game_win":"game_lose",{game_id:t,game_title:i,story_id:o})},startSessionTimer:()=>{sessionStartTime=Date.now(),console.log("[Analytics] Session timer started")},stopSessionTimer:async()=>{if(!sessionStartTime){console.warn("[Analytics] No session start time");return}const t=Math.floor((Date.now()-sessionStartTime)/1e3);await trackAnalyticsEvent("session_time",{duration_seconds:t}),console.log("[Analytics] Session time recorded:",t,"seconds"),sessionStartTime=null},getCurrentKey:()=>get$1(userKeyStore)}}const userKeyStore=createUserKeyStore();function handleNext(r,e){get$2(e)?.nextDialogueId&&gameState.goToDialogue(get$2(e).nextDialogueId)}var root_6$8=from_html('<img alt="BG" class="background-image svelte-fl90wm"/>'),root_3$b=from_html('<div class="background-media svelte-fl90wm"><!></div>'),root_10$2=from_html('<img alt="Char" class="character-image svelte-fl90wm"/>'),root_7$7=from_html('<div class="character-media svelte-fl90wm"><!></div>'),on_click$9=(r,e,t)=>e(get$2(t)),root_13=from_html("<button> </button>"),root_11$2=from_html('<div class="options-container svelte-fl90wm"></div>'),root_15=from_html('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),root_1$c=from_html('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),root_16=from_html("<p> </p>");function DialogueCard(r,e){push(e,!0);let t=prop(e,"bucketName",3,bucketName);console.log(t());const i=user_derived(()=>e.dialogue||gameState.findDialogue(gameState.currentDialogueId));let n=state(null);user_effect(()=>{get$2(i)?.onEnter&&gameState.runActions(get$2(i).onEnter)});function o(E){if(E.actions&&gameState.runActions(E.actions),E.miniGame){console.log("Запуск мини-игры:",E.miniGame.id),userKeyStore.trackGameStart(E.miniGame.id,E.miniGame.id,gameState.selectedStory||void 0),set(n,{gameId:E.miniGame.id,onWinDialogueId:E.miniGame.onWinDialogueId,onLoseDialogueId:E.miniGame.onLoseDialogueId,rewardItem:E.miniGame.rewardItem},!0);return}E.nextDialogueId&&gameState.goToDialogue(E.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),get$2(n)&&userKeyStore.trackGameResult(get$2(n).gameId,get$2(n).gameId,!0,gameState.selectedStory||void 0),get$2(n)?.rewardItem&&gameState.addItem(get$2(n).rewardItem),get$2(n)?.onWinDialogueId&&gameState.goToDialogue(get$2(n).onWinDialogueId),set(n,null)}function f(){console.log("[DialogueCard] Mini-game lost!"),get$2(n)&&userKeyStore.trackGameResult(get$2(n).gameId,get$2(n).gameId,!1,gameState.selectedStory||void 0),get$2(n)?.onLoseDialogueId&&gameState.goToDialogue(get$2(n).onLoseDialogueId),set(n,null)}function p(E){return E.visible===!1?!1:gameState.checkVisibilityCondition(E)}function v(E){return E.enabled!==!1}var g=comment(),m=first_child(g);{var $=E=>{var T=root_1$c(),x=child(T);{var D=G=>{{let re=user_derived(()=>gameState.storyData?.items);MinigameLauncher(G,{get gameId(){return get$2(n).gameId},onWin:u,onLose:f,get rewardItem(){return get$2(n).rewardItem},get items(){return get$2(re)},get bucketName(){return t()}})}};if_block(x,G=>{get$2(n)&&G(D)})}var P=sibling(x,2);{var R=G=>{var re=root_3$b(),ue=child(re);{var z=N=>{var M=comment(),O=first_child(M);key(O,()=>get$2(i).backgroundImage,K=>{Rive(K,{get fileName(){return get$2(i).backgroundImage},get bucketName(){return t()}})}),append(N,M)},q=N=>{var M=root_6$8();template_effect(()=>set_attribute(M,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(i).backgroundImage}`)),append(N,M)};if_block(ue,N=>{get$2(i).backgroundImage.endsWith(".riv")?N(z):N(q,!1)})}append(G,re)};if_block(P,G=>{get$2(i).backgroundImage&&G(R)})}var F=sibling(P,2);{var V=G=>{var re=root_7$7(),ue=child(re);{var z=N=>{var M=comment(),O=first_child(M);key(O,()=>get$2(i).characterImage,K=>{Rive(K,{get fileName(){return get$2(i).characterImage},get bucketName(){return t()}})}),append(N,M)},q=N=>{var M=root_10$2();template_effect(()=>set_attribute(M,"src",`${supabaseUrlFile}/storage/v1/object/public/${t()}/${get$2(i).characterImage}`)),append(N,M)};if_block(ue,N=>{get$2(i).characterImage.endsWith(".riv")?N(z):N(q,!1)})}append(G,re)};if_block(F,G=>{get$2(i).characterImage&&G(V)})}var I=sibling(F,2),k=child(I),U=child(k),W=sibling(k,2);{var B=G=>{var re=root_11$2();each(re,21,()=>get$2(i).options,ue=>ue.text,(ue,z)=>{var q=comment(),N=first_child(q);{var M=O=>{var K=root_13();let oe;K.__click=[on_click$9,o,z];var de=child(K);template_effect((ae,_e)=>{oe=set_class(K,1,"option-button svelte-fl90wm",null,oe,ae),K.disabled=_e,set_text(de,get$2(z).text)},[()=>({disabled:!v(get$2(z))}),()=>!v(get$2(z))]),append(O,K)};if_block(N,O=>{p(get$2(z))&&O(M)})}append(ue,q)}),append(G,re)},L=G=>{var re=comment(),ue=first_child(re);{var z=q=>{var N=root_15(),M=child(N);M.__click=[handleNext,i],append(q,N)};if_block(ue,q=>{get$2(i).nextDialogueId&&q(z)},!0)}append(G,re)};if_block(W,G=>{get$2(i).options&&get$2(i).options.length>0?G(B):G(L,!1)})}template_effect(()=>set_text(U,get$2(i).text)),append(E,T)},_=E=>{var T=root_16(),x=child(T);template_effect(()=>set_text(x,`Диалог не найден (ID: ${gameState.currentDialogueId??""})`)),append(E,T)};if_block(m,E=>{get$2(i)?E($):E(_,!1)})}append(r,g),pop()}delegate(["click"]);var $$_import_editor=reactive_import(()=>editor),root_2$9=from_html('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),root_3$a=from_html('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),root_4$7=from_html('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),root_5$c=from_html('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),root_1$b=from_html('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),root_6$7=from_html('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),root$8=from_html('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function PreviewPanel(r,e){push(e,!1);function t(){$$_import_editor($$_import_editor().editingOptionIndex=null)}init();var i=root$8(),n=child(i),o=sibling(child(n),2);o.__click=t;var u=sibling(n,2),f=child(u);{var p=g=>{var m=root_1$b(),$=child(m);DialogueCard($,{get dialogue(){return editorDerived.currentDialogue},index:0,get bucketName(){return $$_import_editor().selectedBucket}});var _=sibling($,2),E=child(_),T=sibling(child(E),2),x=child(T),D=sibling(E,2),P=sibling(child(D),2),R=child(P),F=sibling(D,2);{var V=G=>{var re=root_2$9(),ue=sibling(child(re),2),z=child(ue);template_effect(()=>set_text(z,editorDerived.currentDialogue.backgroundImage)),append(G,re)};if_block(F,G=>{editorDerived.currentDialogue.backgroundImage&&G(V)})}var I=sibling(F,2);{var k=G=>{var re=root_3$a(),ue=sibling(child(re),2),z=child(ue);template_effect(()=>set_text(z,editorDerived.currentDialogue.characterImage)),append(G,re)};if_block(I,G=>{editorDerived.currentDialogue.characterImage&&G(k)})}var U=sibling(_,2);{var W=G=>{var re=root_4$7();append(G,re)};if_block(U,G=>{(!editorDerived.currentDialogue.options||editorDerived.currentDialogue.options.length===0)&&G(W)})}var B=sibling(U,2);{var L=G=>{var re=root_5$c();append(G,re)};if_block(B,G=>{editorDerived.currentDialogue.options?.some(re=>!re.nextDialogueId)&&G(L)})}template_effect(()=>{set_text(x,editorDerived.currentDialogue.id),set_text(R,editorDerived.currentChapter?.title||"Без главы")}),append(g,m)},v=g=>{var m=root_6$7();append(g,m)};if_block(f,g=>{editorDerived.currentDialogue?g(p):g(v,!1)})}append(r,i),pop()}delegate(["click"]);const AVAILABLE_STORIES=["dracula","zombie","fairy_tale","minigames"];function getStoriesList(){const r=AVAILABLE_STORIES.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return editorActions.updateBucketsList(r),r}async function handleCreateStory(r,e,t,i,n,o){if(!get$2(e).trim())return;set(t,!0);const u=await createStory(get$2(e).trim(),get$2(i));u.success&&u.story?(set(n,!1),set(e,""),set(i,"stories"),await o(u.story)):alert(u.error||"Ошибка создания истории"),set(t,!1)}var on_click$8=(r,e)=>set(e,!0),on_click_1$4=(r,e,t)=>e(get$2(t)),on_click_2$1=(r,e,t)=>e(get$2(t)),on_click_3$1=(r,e,t)=>e(get$2(t)),root_4$6=from_html('<div class="story-card author-card svelte-1tegylr"><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <span> </span></div> <div class="story-actions svelte-1tegylr"><button class="btn small svelte-1tegylr">Открыть</button> <button class="btn small svelte-1tegylr"> </button> <button class="btn small danger svelte-1tegylr">✕</button></div></div>'),root_3$9=from_html('<div class="stories-section svelte-1tegylr"><div class="stories-grid svelte-1tegylr"></div></div>'),root_5$b=from_html('<p class="empty-text svelte-1tegylr">У вас пока нет историй. Создайте первую!</p>'),root_6$6=from_html("<p>Загрузка историй...</p>"),root_8$5=from_html('<span class="selected-badge svelte-1tegylr">Выбрано</span>'),on_click_4$1=(r,e,t)=>e(get$2(t).name),root_9$2=from_html('<button class="btn small svelte-1tegylr">Выбрать</button>'),root_7$6=from_html('<div><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <p class="svelte-1tegylr"> </p></div> <div class="story-actions svelte-1tegylr"><!></div></div>'),root_1$a=from_html('<div class="selector-header svelte-1tegylr"><h2 class="svelte-1tegylr">📝 Мои истории</h2> <button class="btn btn-primary svelte-1tegylr">+ Создать историю</button></div> <!> <div class="stories-section svelte-1tegylr"><h3 class="svelte-1tegylr">📚 Архивные истории</h3> <div class="stories-grid svelte-1tegylr"></div></div>',1),root_10$1=from_html('<div class="access-denied svelte-1tegylr"><h2 class="svelte-1tegylr">🔒 Доступ запрещён</h2> <p class="svelte-1tegylr">Редактирование историй доступно только авторам и администраторам.</p> <p class="svelte-1tegylr">Станьте автором, чтобы создавать и редактировать истории.</p></div>'),on_click_5=(r,e)=>set(e,!1),on_click_6=r=>r.stopPropagation(),on_click_7=(r,e)=>set(e,!1),root_11$1=from_html('<div class="modal-overlay svelte-1tegylr" role="dialog"><div class="modal svelte-1tegylr"><h3 class="svelte-1tegylr">Создать новую историю</h3> <div class="form-group svelte-1tegylr"><label for="story-title" class="svelte-1tegylr">Название истории</label> <input type="text" id="story-title" placeholder="Например: Приключения в замке" class="input svelte-1tegylr"/></div> <div class="form-group svelte-1tegylr"><label for="story-bucket" class="svelte-1tegylr">Bucket для ресурсов</label> <select id="story-bucket" class="input svelte-1tegylr"><option>stories (по умолчанию)</option><option>dracula</option><option>zombie</option><option>fairy_tale</option><option>minigames</option></select> <small class="hint svelte-1tegylr">Выберите bucket в котором будут храниться ресурсы истории</small></div> <div class="modal-actions svelte-1tegylr"><button class="btn svelte-1tegylr">Отмена</button> <button class="btn primary svelte-1tegylr"> </button></div></div></div>'),root$7=from_html('<div class="story-selector svelte-1tegylr"><!></div> <!>',1);function StorySelector$1(r,e){push(e,!0);let t=state(!1),i=state(""),n=state("stories"),o=state(!1);const u={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр",icon:"🎮"}};onMount(async()=>{await loadStories(),getStoriesList()});async function f(P){editor.selectedBucket=P,editor.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},await resourceActions.loadStoriesList(),await resourceActions.loadStoredResources()}async function p(P){editor.manualStorySelected=!0;const R=P.bucket||"stories";editor.selectedBucket=R,editor.currentFileName=P.json_url,await resourceActions.loadStoredResources(),await storyActions.loadStory(editor.currentFileName)}async function v(P){await updateStory(P.id,{is_public:!P.is_public})}async function g(P){confirm(`Удалить историю "${P.title}"?`)&&await deleteStory(P.id)}var m=root$7(),$=first_child(m),_=child($);{var E=P=>{var R=root_1$a(),F=first_child(R),V=sibling(child(F),2);V.__click=[on_click$8,t];var I=sibling(F,2);{var k=L=>{var G=comment(),re=first_child(G);{var ue=q=>{var N=root_3$9(),M=child(N);each(M,21,getAuthorStories,O=>O.id,(O,K)=>{var oe=root_4$6(),de=child(oe),ae=child(de),_e=sibling(de,2),me=child(_e),be=child(me),le=sibling(me,2);let Q;var ne=child(le),Y=sibling(_e,2),Z=child(Y);Z.__click=[on_click_1$4,p,K];var ce=sibling(Z,2);ce.__click=[on_click_2$1,v,K];var te=child(ce),he=sibling(ce,2);he.__click=[on_click_3$1,g,K],template_effect(ie=>{set_text(ae,get$2(K).preview_image_url?"🖼️":"📖"),set_text(be,get$2(K).title),Q=set_class(le,1,"story-status svelte-1tegylr",null,Q,ie),set_text(ne,get$2(K).is_public?"🌍 Публичная":"🔒 Приватная"),set_text(te,get$2(K).is_public?"Скрыть":"Опубликовать")},[()=>({public:get$2(K).is_public})]),append(O,oe)}),append(q,N)},z=q=>{var N=root_5$b();append(q,N)};if_block(re,q=>{getAuthorStories().length>0?q(ue):q(z,!1)})}append(L,G)},U=L=>{var G=root_6$6();append(L,G)};if_block(I,L=>{storiesState.initialized?L(k):L(U,!1)})}var W=sibling(I,2),B=sibling(child(W),2);each(B,21,()=>editor.availableBuckets,L=>L.name,(L,G)=>{const re=user_derived(()=>u[get$2(G).id]||{title:get$2(G).name,description:"История",icon:"📖"});var ue=root_7$6();let z;var q=child(ue),N=child(q),M=sibling(q,2),O=child(M),K=child(O),oe=sibling(O,2),de=child(oe),ae=sibling(M,2),_e=child(ae);{var me=le=>{var Q=root_8$5();append(le,Q)},be=le=>{var Q=root_9$2();Q.__click=[on_click_4$1,f,G],append(le,Q)};if_block(_e,le=>{editor.selectedBucket===get$2(G).name?le(me):le(be,!1)})}template_effect(le=>{z=set_class(ue,1,"story-card svelte-1tegylr",null,z,le),set_text(N,get$2(re).icon),set_text(K,get$2(re).title),set_text(de,get$2(re).description)},[()=>({selected:editor.selectedBucket===get$2(G).name})]),append(L,ue)}),append(P,R)},T=P=>{var R=root_10$1();append(P,R)};if_block(_,P=>{authDerivedState.isAuthor||authDerivedState.isAdmin?P(E):P(T,!1)})}var x=sibling($,2);{var D=P=>{var R=root_11$1();R.__click=[on_click_5,t];var F=child(R);F.__click=[on_click_6];var V=sibling(child(F),2),I=sibling(child(V),2),k=sibling(V,2),U=sibling(child(k),2),W=child(U);W.value=W.__value="stories";var B=sibling(W);B.value=B.__value="dracula";var L=sibling(B);L.value=L.__value="zombie";var G=sibling(L);G.value=G.__value="fairy_tale";var re=sibling(G);re.value=re.__value="minigames";var ue=sibling(k,2),z=child(ue);z.__click=[on_click_7,t];var q=sibling(z,2);q.__click=[handleCreateStory,i,o,n,t,p];var N=child(q);template_effect(M=>{q.disabled=M,set_text(N,get$2(o)?"Создание...":"Создать")},[()=>get$2(o)||!get$2(i).trim()]),bind_value(I,()=>get$2(i),M=>set(i,M)),bind_select_value(U,()=>get$2(n),M=>set(n,M)),append(P,R)};if_block(x,P=>{get$2(t)&&P(D)})}append(r,m),pop()}delegate(["click"]);var root_3$8=from_html("<span> </span>"),root_4$5=from_html('<div class="debug-info svelte-1o87bfp"><small> </small></div>'),root_5$a=from_html('<div class="debug-info warning svelte-1o87bfp"><small>⚠️ Данные не загружены</small></div>'),root_7$5=from_html('<div class="empty-state svelte-1o87bfp">Выберите сцену</div>'),root_2$8=from_html('<div class="editor-container svelte-1o87bfp"><header class="toolbar svelte-1o87bfp"><div class="logo svelte-1o87bfp"><h2 class="svelte-1o87bfp"> </h2></div> <div class="stories-control svelte-1o87bfp"><span class="story-file-name svelte-1o87bfp"> </span> <!> <button class="btn success small svelte-1o87bfp">💾 Сохранить</button> <button class="btn small svelte-1o87bfp">📋 Копия</button></div></header> <div class="main-workspace svelte-1o87bfp"><!> <main class="editor-area svelte-1o87bfp"><!> <!> <!></main> <!></div> <button class="btn-back-to-game svelte-1o87bfp" title="Выбрать другую историю">📚 Выбрать историю</button></div>');function Editor(r,e){push(e,!0);async function t(p){console.log(`[Editor] Загрузка для bucket: ${p}`);try{const v=resourceActions.loadStoredResources(),g=new Promise((E,T)=>setTimeout(()=>T(new Error("Timeout loading resources")),15e3));await Promise.race([v,g]);const m=`${p}_story.json`;editor.currentFileName=m;const $=storyActions.loadStory(m),_=new Promise((E,T)=>setTimeout(()=>T(new Error("Timeout loading story")),15e3));await Promise.race([$,_]),console.log(`[Editor] История загружена: ${m}`)}catch(v){console.error("[Editor] Ошибка загрузки истории:",v)}}onMount(async()=>{getStoriesList(),editor.availableBuckets.length>0&&!editor.selectedBucket&&(editor.selectedBucket=editor.availableBuckets[0].name,await t(editor.selectedBucket))}),user_effect(()=>{editor.selectedBucket&&!editor.manualStorySelected&&t(editor.selectedBucket)});function i(){editor.manualStorySelected=!1,editor.selectedBucket=null,editor.currentFileName="",editor.data=null}var n=comment(),o=first_child(n);{var u=p=>{StorySelector$1(p,{})},f=p=>{var v=root_2$8(),g=child(v),m=child(g),$=child(m),_=child($),E=sibling(m,2),T=child(E),x=child(T),D=sibling(T,2);{var P=N=>{var M=root_3$8(),O=child(M);template_effect(()=>{set_class(M,1,`status-message ${editor.statusMessage.type??""}`,"svelte-1o87bfp"),set_text(O,editor.statusMessage.text)}),append(N,M)};if_block(D,N=>{editor.statusMessage.text&&N(P)})}var R=sibling(D,2);R.__click=function(...N){storyActions.saveCurrentStory?.apply(this,N)};var F=sibling(R,2);F.__click=function(...N){storyActions.saveStoryCopy?.apply(this,N)};var V=sibling(g,2),I=child(V);EditorSidebar(I,{});var k=sibling(I,2),U=child(k);{var W=N=>{var M=root_4$5(),O=child(M),K=child(O);template_effect(()=>set_text(K,`Загружено: ${editor.data.meta?.title??""} |
              Глав: ${(editor.data.chapters?.length||0)??""} |
              Диалогов: ${(editor.data.dialogues?.length||0)??""} |
              Предметов: ${(editor.data.items?.length||0)??""}`)),append(N,M)},B=N=>{var M=root_5$a();append(N,M)};if_block(U,N=>{editor.data?N(W):N(B,!1)})}var L=sibling(U,2);ItemsManager(L,{});var G=sibling(L,2);{var re=N=>{DialogueForm(N,{get editor(){return editor},get storyActions(){return storyActions},get resourceActions(){return resourceActions}})},ue=N=>{var M=root_7$5();append(N,M)};if_block(G,N=>{editorDerived.currentDialogue?N(re):N(ue,!1)})}var z=sibling(k,2);PreviewPanel(z,{});var q=sibling(V,2);q.__click=i,template_effect(()=>{set_text(_,`Story Editor v3.1 - ${editor.selectedBucket??""}`),set_text(x,editor.currentFileName||"Нет файла")}),append(p,v)};if_block(o,p=>{editor.selectedBucket?p(f,!1):p(u)})}append(r,n),pop()}delegate(["click"]);function openAllGames(){window.dispatchEvent(new CustomEvent("open-all-games"))}var root_1$9=from_html('<div class="loading svelte-2tmiof">Загрузка историй...</div>'),root_3$7=from_html('<div class="empty-state svelte-2tmiof"><p class="svelte-2tmiof">Историй пока нет</p> <p class="hint svelte-2tmiof">Создайте свою историю в редакторе!</p></div>'),on_click$7=(r,e,t)=>e(get$2(t)),on_keydown$2=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(get$2(t)))},root_5$9=from_html('<div class="story-card svelte-2tmiof" role="button" tabindex="0"><div class="story-icon svelte-2tmiof"> </div> <div class="story-content svelte-2tmiof"><h3 class="story-title svelte-2tmiof"> </h3> <p class="story-description svelte-2tmiof"> </p></div> <div class="story-arrow svelte-2tmiof">→</div></div>'),root_4$4=from_html('<div class="stories-grid svelte-2tmiof"></div>'),root_2$7=from_html('<div class="selector-header svelte-2tmiof"><h1 class="svelte-2tmiof">🎭 Визуальные новеллы</h1> <p class="svelte-2tmiof">Выберите историю для прохождения</p></div> <button type="button" class="btn-all-games svelte-2tmiof"><span class="games-icon svelte-2tmiof">🎮</span> <span class="games-text svelte-2tmiof">Все мини-игры</span> <span class="games-arrow svelte-2tmiof">→</span></button> <!> <div class="selector-footer svelte-2tmiof"><p class="hint svelte-2tmiof">💡 Совет: Вы можете создать свою историю в редакторе</p></div>',1),root$6=from_html('<div class="story-selector svelte-2tmiof"><!></div>');function StorySelector(r,e){push(e,!0);let t=state(!0),i=state(!1);onMount(async()=>{if(console.log("[StorySelector] Инициализация..."),await gameState.initStories(),console.log("[StorySelector] Истории загружены:",{initialized:storiesState.initialized,count:storiesState.stories.length,available:getPlayerStories().length,urlStoryId:gameState.urlStoryId}),gameState.urlStoryId&&gameState.selectedStoryData&&!get$2(i)){set(i,!0);const g=await loadStoryJson(gameState.selectedStoryData);g&&(gameState.storyData=g,gameState.currentDialogueId=g.dialogues?.[0]?.id||"0",gameState.isLoading=!1)}set(t,!1)});const n={dracula:"🧛",zombie:"🧟",fairy_tale:"🧚",minigames:"🎮"};function o(g){gameState.selectedStory=g.id,gameState.selectedStoryData=g}var u=root$6(),f=child(u);{var p=g=>{var m=root_1$9();append(g,m)},v=g=>{var m=root_2$7(),$=sibling(first_child(m),2);$.__click=[openAllGames];var _=sibling($,2);{var E=x=>{var D=root_3$7();append(x,D)},T=x=>{var D=root_4$4();each(D,21,()=>gameState.availableStories,P=>P.id,(P,R)=>{const F=user_derived(()=>n[get$2(R).title.toLowerCase()]||"📖");var V=root_5$9();V.__click=[on_click$7,o,R],V.__keydown=[on_keydown$2,o,R];var I=child(V),k=child(I),U=sibling(I,2),W=child(U),B=child(W),L=sibling(W,2),G=child(L);template_effect(()=>{set_text(k,get$2(F)),set_text(B,get$2(R).title),set_text(G,get$2(R).preview_image_url?"Нажмите для начала":"Интерактивная история")}),append(P,V)}),append(x,D)};if_block(_,x=>{gameState.availableStories.length===0?x(E):x(T,!1)})}append(g,m)};if_block(f,g=>{get$2(t)?g(p):g(v,!1)})}append(r,u),pop()}delegate(["click","keydown"]);var root_1$8=from_html('<span class="inventory-badge svelte-166jaas"> </span>'),on_keydown$1=(r,e)=>r.key==="Escape"&&e(),on_click$6=r=>r.stopPropagation(),on_keydown_1$1=r=>r.stopPropagation(),on_click_1$3=(r,e,t)=>e(get$2(t)),root_4$3=from_html('<button type="button" class="item-card svelte-166jaas"><div class="item-icon svelte-166jaas"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-166jaas"><span class="item-name svelte-166jaas"> </span> <span class="item-type svelte-166jaas"> </span></div></button>'),root_3$6=from_html('<div class="items-grid svelte-166jaas"></div>'),root_5$8=from_html('<div class="empty-inventory svelte-166jaas"><span class="empty-icon svelte-166jaas">🎒</span> <p class="svelte-166jaas">Инвентарь пуст</p> <p class="empty-hint svelte-166jaas">Получайте предметы в ходе игры</p></div>'),root_2$6=from_html('<div class="inventory-overlay svelte-166jaas" role="dialog" tabindex="-1"><div class="inventory-modal svelte-166jaas" role="dialog" aria-label="Окно инвентаря" tabindex="-1"><div class="inventory-header svelte-166jaas"><h2 class="svelte-166jaas">Инвентарь</h2> <button class="close-button svelte-166jaas">✕</button></div> <div class="stats-section svelte-166jaas"><h3 class="svelte-166jaas">Характеристики</h3> <div class="stats-grid svelte-166jaas"><div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">📚</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Знания</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">💪</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Смелость</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">✨</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Харизма</span> <span class="stat-value svelte-166jaas"> </span></div></div></div></div> <div class="items-section svelte-166jaas"><h3 class="svelte-166jaas"> </h3> <!></div></div></div>'),root$5=from_html('<div class="inventory-wrapper svelte-166jaas"><button class="inventory-button svelte-166jaas">🎒 <!></button> <!></div>');function Inventory(r,e){push(e,!0);let t=state(!1);const i=user_derived(()=>gameState.getInventoryItems()),n=user_derived(()=>gameState.player.stats);function o(){set(t,!get$2(t))}function u(_){console.log("Выбран предмет:",_.name)}var f=root$5(),p=child(f);p.__click=o;var v=sibling(child(p));{var g=_=>{var E=root_1$8(),T=child(E);template_effect(()=>set_text(T,get$2(i).length)),append(_,E)};if_block(v,_=>{get$2(i).length>0&&_(g)})}var m=sibling(p,2);{var $=_=>{var E=root_2$6();E.__click=o,E.__keydown=[on_keydown$1,o];var T=child(E);T.__click=[on_click$6],T.__keydown=[on_keydown_1$1];var x=child(T),D=sibling(child(x),2);D.__click=o;var P=sibling(x,2),R=sibling(child(P),2),F=child(R),V=sibling(child(F),2),I=sibling(child(V),2),k=child(I),U=sibling(F,2),W=sibling(child(U),2),B=sibling(child(W),2),L=child(B),G=sibling(U,2),re=sibling(child(G),2),ue=sibling(child(re),2),z=child(ue),q=sibling(P,2),N=child(q),M=child(N),O=sibling(N,2);{var K=de=>{var ae=root_3$6();each(ae,21,()=>get$2(i),_e=>_e.id,(_e,me)=>{var be=root_4$3();be.__click=[on_click_1$3,u,me];var le=child(be),Q=child(le),ne=sibling(le,2),Y=child(ne),Z=child(Y),ce=sibling(Y,2),te=child(ce);template_effect(()=>{set_attribute(be,"aria-label",`Предмет: ${get$2(me).name}`),set_attribute(Q,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${gameState.selectedStory}/${get$2(me).icon}`),set_attribute(Q,"alt",get$2(me).icon),set_text(Z,get$2(me).name),set_text(te,get$2(me).type)}),append(_e,be)}),append(de,ae)},oe=de=>{var ae=root_5$8();append(de,ae)};if_block(O,de=>{get$2(i).length>0?de(K):de(oe,!1)})}template_effect(()=>{set_text(k,get$2(n).knowledge),set_text(L,get$2(n).courage),set_text(z,get$2(n).charisma),set_text(M,`Предметы (${get$2(i).length??""})`)}),append(_,E)};if_block(m,_=>{get$2(t)&&_($)})}template_effect(()=>set_attribute(p,"title",`Инвентарь (${get$2(i).length??""})`)),append(r,f),pop()}delegate(["click","keydown"]);function openEditor(r,e){if(!get$2(e)){alert("Редактирование недоступно без интернета");return}editorActions.toggleEditor()}var root_3$5=from_html('<div class="loading svelte-wkbazt"><p>🔄 Загрузка истории...</p></div>'),root_5$7=from_html('<div class="error svelte-wkbazt"> <button class="btn-back svelte-wkbazt">← Вернуться к выбору</button></div>'),root_7$4=from_html('<button class="btn-edit desktop-only svelte-wkbazt" title="Редактор историй">✏️ Редактор</button>'),root_6$5=from_html('<div class="game-container svelte-wkbazt"><!> <button class="btn-change-story svelte-wkbazt" title="Сменить историю">📚</button> <!> <div class="dialogues-container svelte-wkbazt"><!></div></div>'),root$4=from_html('<div class="app svelte-wkbazt"><!></div>');function Main(r,e){push(e,!0);let t=state(!0),i=state(!1);onMount(async()=>{set(t,navigator.onLine,!0);const v=()=>{set(t,!0)},g=()=>{set(t,!1)};return window.addEventListener("online",v),window.addEventListener("offline",g),await gameState.initStories(),set(i,!0),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",g)}}),user_effect(async()=>{if(get$2(i)&&gameState.selectedStory&&gameState.selectedStoryData){const v=gameState.selectedStoryData;if(!v||!v.id){console.warn("[Main] История не выбрана или некорректна");return}console.log("[Main] Загрузка истории:",v?.title||v.id),await userKeyStore.trackStoryStart(v.id,v.title||v.id);const g=await loadStoryJson(v);g?(gameState.storyData=g,gameState.currentDialogueId=g.dialogues?.[0]?.id||"0",gameState.isLoading=!1,console.log("[Main] История загружена, диалогов:",g.dialogues?.length)):(gameState.error="Не удалось загрузить историю",gameState.isLoading=!1)}});let n=null;user_effect(()=>{if(n&&!gameState.selectedStory&&gameState.storyData){const v=gameState.storyData.dialogues?.length||0;userKeyStore.trackStoryComplete(n,gameState.selectedStoryData?.title||n,v),n=null}else gameState.selectedStory&&(n=gameState.selectedStory)});var o=root$4(),u=child(o);{var f=v=>{StorySelector(v,{})},p=v=>{var g=comment(),m=first_child(g);{var $=E=>{var T=root_3$5();append(E,T)},_=E=>{var T=comment(),x=first_child(T);{var D=R=>{var F=root_5$7(),V=child(F),I=sibling(V);I.__click=()=>gameState.selectedStory=null,template_effect(()=>set_text(V,`⚠️ ${gameState.error??""} `)),append(R,F)},P=R=>{var F=root_6$5(),V=child(F);Inventory(V,{});var I=sibling(V,2);I.__click=()=>{gameState.selectedStory=null,gameState.selectedStoryData=null,gameState.storyData=null};var k=sibling(I,2);{var U=G=>{var re=root_7$4();re.__click=[openEditor,t],append(G,re)};if_block(k,G=>{authState.user&&get$2(t)&&G(U)})}var W=sibling(k,2),B=child(W);{var L=G=>{{let re=user_derived(()=>gameState.selectedStoryData?.bucket||"stories");DialogueCard(G,{get bucketName(){return get$2(re)}})}};if_block(B,G=>{gameState.storyData&&G(L)})}append(R,F)};if_block(x,R=>{gameState.error?R(D):R(P,!1)},!0)}append(E,T)};if_block(m,E=>{gameState.isLoading?E($):E(_,!1)},!0)}append(v,g)};if_block(u,v=>{gameState.selectedStory?v(p,!1):v(f)})}append(r,o),pop()}delegate(["click"]);var on_keydown=(r,e)=>r.key==="Escape"&&e.onClose?.(),on_click$5=r=>r.stopPropagation(),on_keydown_1=r=>r.stopPropagation(),root_5$6=from_html('<div class="alert error svelte-961h07"><strong>⚠️</strong> </div>'),root_6$4=from_html('<div class="alert success svelte-961h07"><strong>✅</strong> </div>'),root_7$3=from_html('<div class="form-group svelte-961h07"><label for="username" class="svelte-961h07">Имя пользователя</label> <input type="text" id="username" placeholder="Придумайте имя" required class="svelte-961h07"/></div>'),on_input=(r,e,t)=>e(get$2(t)),root_8$4=from_html('<span class="field-error svelte-961h07"> </span>'),on_input_1=(r,e,t)=>e(get$2(t)),root_10=from_html('<span class="field-error svelte-961h07"> </span>'),root_11=from_html('<small class="hint svelte-961h07">Минимум 6 символов</small>'),root_9$1=from_html('<div class="form-group svelte-961h07"><label for="password" class="svelte-961h07">Пароль</label> <input type="password" id="password" placeholder="Введите пароль" required minlength="6"/> <!> <!></div>'),on_click_1$2=(r,e)=>e("reset"),on_click_2=(r,e)=>e("register"),root_18=from_html('<button type="button" class="link-btn svelte-961h07">Забыли пароль?</button> <button type="button" class="link-btn svelte-961h07">Нет аккаунта? Регистрация</button>',1),on_click_3=(r,e)=>e("login"),root_20=from_html('<button type="button" class="link-btn svelte-961h07">Уже есть аккаунт? Войти</button>'),on_click_4=(r,e)=>e("login"),root_21=from_html('<button type="button" class="link-btn svelte-961h07">Вспомнили пароль? Войти</button>'),root_22=from_html('<div class="debug-info svelte-961h07"><details><summary class="svelte-961h07">🔧 Отладка</summary> <p> </p> <p> </p> <p>Статус: Попробуйте:</p> <ul class="svelte-961h07"><li>Проверить подтвержден ли email в Supabase Dashboard</li> <li>Сбросить пароль через "Забыли пароль?"</li> <li>Проверить консоль браузера (F12)</li></ul></details></div>'),root$3=from_html('<div class="auth-modal-overlay svelte-961h07" role="dialog" aria-modal="true" tabindex="-1"><div class="auth-modal svelte-961h07" role="document"><button class="close-btn svelte-961h07" aria-label="Закрыть">×</button> <h2 class="svelte-961h07"><!></h2> <!> <!> <form><!> <div class="form-group svelte-961h07"><label for="email" class="svelte-961h07">Email</label> <input type="email" id="email" placeholder="your@email.com" required/> <!></div> <!> <button type="submit" class="btn-primary svelte-961h07"><!></button></form> <div class="auth-links svelte-961h07"><!></div> <!></div></div>');function AuthModal(r,e){push(e,!0);let t=prop(e,"initialMode",3,"login"),i=state(proxy(t())),n=state(""),o=state(""),u=state(""),f=state(""),p=state(""),v=state(!1),g=state(""),m=state("");function $(ie){set(i,ie,!0),set(f,""),set(p,""),set(g,""),set(m,"")}function _(ie){const ge=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ie);return set(g,ge?"":"Введите корректный email",!0),ge}function E(ie){const pe=ie.length>=6;return set(m,pe?"":"Пароль должен быть не менее 6 символов",!0),pe}async function T(){if(!(!_(get$2(n))||!E(get$2(o)))){set(f,""),set(p,""),set(v,!0);try{const ie=await signIn(get$2(n),get$2(o));ie.success?e.onClose?.():(set(f,ie.error||"Ошибка входа",!0),get$2(f).includes("подтвержден")&&setTimeout(()=>{confirm("Отправить письмо с подтверждением повторно?")&&x()},100))}finally{set(v,!1)}}}async function x(){set(v,!0);try{const{error:ie}=await supabase.auth.resend({type:"signup",email:get$2(n)});ie?set(f,"Ошибка при отправке: "+ie.message):set(p,"Письмо с подтверждением отправлено повторно!")}catch(ie){set(f,ie.message,!0)}finally{set(v,!1)}}async function D(){if(!(!_(get$2(n))||!E(get$2(o)))){if(!get$2(u).trim()){set(f,"Введите имя пользователя");return}set(f,""),set(p,""),set(v,!0);try{const ie=await signUp(get$2(n),get$2(o),get$2(u));ie.success?ie.needsEmailConfirmation?set(p,"✅ Регистрация почти завершена! Проверьте почту и подтвердите email."):(set(p,"Регистрация успешна!"),setTimeout(()=>e.onClose?.(),2e3)):set(f,ie.error||"Ошибка регистрации",!0)}finally{set(v,!1)}}}async function P(){if(_(get$2(n))){set(f,""),set(p,""),set(v,!0);try{const ie=await resetPassword(get$2(n));ie.success?set(p,"📧 Инструкции по сбросу пароля отправлены на почту!"):set(f,ie.error||"Ошибка сброса пароля",!0)}finally{set(v,!1)}}}async function R(){get$2(i)==="login"?await T():get$2(i)==="register"?await D():get$2(i)==="reset"&&await P()}var F=root$3();F.__click=function(...ie){e.onClose?.apply(this,ie)},F.__keydown=[on_keydown,e];var V=child(F);V.__click=[on_click$5],V.__keydown=[on_keydown_1];var I=child(V);I.__click=function(...ie){e.onClose?.apply(this,ie)};var k=sibling(I,2),U=child(k);{var W=ie=>{var pe=text("Вход");append(ie,pe)},B=ie=>{var pe=comment(),ge=first_child(pe);{var Ie=Re=>{var Ce=text("Регистрация");append(Re,Ce)},ke=Re=>{var Ce=text("Сброс пароля");append(Re,Ce)};if_block(ge,Re=>{get$2(i)==="register"?Re(Ie):Re(ke,!1)},!0)}append(ie,pe)};if_block(U,ie=>{get$2(i)==="login"?ie(W):ie(B,!1)})}var L=sibling(k,2);{var G=ie=>{var pe=root_5$6(),ge=sibling(child(pe));template_effect(()=>set_text(ge,` ${get$2(f)??""}`)),append(ie,pe)};if_block(L,ie=>{get$2(f)&&ie(G)})}var re=sibling(L,2);{var ue=ie=>{var pe=root_6$4(),ge=sibling(child(pe));template_effect(()=>set_text(ge,` ${get$2(p)??""}`)),append(ie,pe)};if_block(re,ie=>{get$2(p)&&ie(ue)})}var z=sibling(re,2),q=child(z);{var N=ie=>{var pe=root_7$3(),ge=sibling(child(pe),2);template_effect(()=>ge.disabled=get$2(v)),bind_value(ge,()=>get$2(u),Ie=>set(u,Ie)),append(ie,pe)};if_block(q,ie=>{get$2(i)==="register"&&ie(N)})}var M=sibling(q,2),O=sibling(child(M),2);O.__input=[on_input,_,n];let K;var oe=sibling(O,2);{var de=ie=>{var pe=root_8$4(),ge=child(pe);template_effect(()=>set_text(ge,get$2(g))),append(ie,pe)};if_block(oe,ie=>{get$2(g)&&ie(de)})}var ae=sibling(M,2);{var _e=ie=>{var pe=root_9$1(),ge=sibling(child(pe),2);ge.__input=[on_input_1,E,o];let Ie;var ke=sibling(ge,2);{var Re=De=>{var w=root_10(),c=child(w);template_effect(()=>set_text(c,get$2(m))),append(De,w)};if_block(ke,De=>{get$2(m)&&De(Re)})}var Ce=sibling(ke,2);{var Be=De=>{var w=root_11();append(De,w)};if_block(Ce,De=>{get$2(i)==="register"&&De(Be)})}template_effect(De=>{ge.disabled=get$2(v),Ie=set_class(ge,1,"svelte-961h07",null,Ie,De)},[()=>({error:get$2(m)})]),bind_value(ge,()=>get$2(o),De=>set(o,De)),append(ie,pe)};if_block(ae,ie=>{get$2(i)!=="reset"&&ie(_e)})}var me=sibling(ae,2),be=child(me);{var le=ie=>{var pe=text("Загрузка...");append(ie,pe)},Q=ie=>{var pe=comment(),ge=first_child(pe);{var Ie=Re=>{var Ce=text("Войти");append(Re,Ce)},ke=Re=>{var Ce=comment(),Be=first_child(Ce);{var De=c=>{var h=text("Зарегистрироваться");append(c,h)},w=c=>{var h=text("Отправить");append(c,h)};if_block(Be,c=>{get$2(i)==="register"?c(De):c(w,!1)},!0)}append(Re,Ce)};if_block(ge,Re=>{get$2(i)==="login"?Re(Ie):Re(ke,!1)},!0)}append(ie,pe)};if_block(be,ie=>{get$2(v)?ie(le):ie(Q,!1)})}var ne=sibling(z,2),Y=child(ne);{var Z=ie=>{var pe=root_18(),ge=first_child(pe);ge.__click=[on_click_1$2,$];var Ie=sibling(ge,2);Ie.__click=[on_click_2,$],template_effect(()=>{ge.disabled=get$2(v),Ie.disabled=get$2(v)}),append(ie,pe)},ce=ie=>{var pe=comment(),ge=first_child(pe);{var Ie=Re=>{var Ce=root_20();Ce.__click=[on_click_3,$],template_effect(()=>Ce.disabled=get$2(v)),append(Re,Ce)},ke=Re=>{var Ce=root_21();Ce.__click=[on_click_4,$],template_effect(()=>Ce.disabled=get$2(v)),append(Re,Ce)};if_block(ge,Re=>{get$2(i)==="register"?Re(Ie):Re(ke,!1)},!0)}append(ie,pe)};if_block(Y,ie=>{get$2(i)==="login"?ie(Z):ie(ce,!1)})}var te=sibling(ne,2);{var he=ie=>{var pe=root_22(),ge=child(pe),Ie=sibling(child(ge),2),ke=child(Ie),Re=sibling(Ie,2),Ce=child(Re);template_effect(()=>{set_text(ke,`Email: ${get$2(n)??""}`),set_text(Ce,`Длина пароля: ${get$2(o).length??""}`)}),append(ie,pe)};if_block(te,ie=>{get$2(i)==="login"&&get$2(f)&&ie(he)})}template_effect(ie=>{O.disabled=get$2(v),K=set_class(O,1,"svelte-961h07",null,K,ie),me.disabled=get$2(v)||get$2(i)==="login"&&(!get$2(n)||!get$2(o))||get$2(i)==="register"&&(!get$2(n)||!get$2(o)||!get$2(u))||get$2(i)==="reset"&&!get$2(n)},[()=>({error:get$2(g)})]),event("submit",z,ie=>{ie.preventDefault(),R()}),bind_value(O,()=>get$2(n),ie=>set(n,ie)),append(r,F),pop()}delegate(["click","keydown","input"]);var root_2$5=from_html('<span class="author-badge svelte-18xh1i2">Автор</span>'),root_1$7=from_html('<div class="user-info svelte-18xh1i2"><span class="user-email svelte-18xh1i2"> </span> <!> <button>Выйти</button></div>'),on_click$4=(r,e)=>set(e,!0),root_3$4=from_html("<button>Войти</button>"),root$2=from_html('<div class="user-menu svelte-18xh1i2"><!> <!></div>');function UserMenu(r,e){push(e,!0);let t=state(!1);var i=root$2(),n=child(i);{var o=v=>{var g=root_1$7(),m=child(g),$=child(m),_=sibling(m,2);{var E=x=>{var D=root_2$5();append(x,D)};if_block(_,x=>{authDerivedState.isAuthor&&x(E)})}var T=sibling(_,2);T.__click=function(...x){signOut?.apply(this,x)},template_effect(()=>set_text($,authState.user?.email)),append(v,g)},u=v=>{var g=root_3$4();g.__click=[on_click$4,t],append(v,g)};if_block(n,v=>{authDerivedState.isAuthenticated?v(o):v(u,!1)})}var f=sibling(n,2);{var p=v=>{AuthModal(v,{onClose:()=>set(t,!1)})};if_block(f,v=>{get$2(t)&&v(p)})}append(r,i),pop()}delegate(["click"]);var root_1$6=from_html('<div class="success-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">✅</span> <p class="svelte-1kxwu1f"> </p> <p class="redirect svelte-1kxwu1f">Перенаправление...</p></div>'),root_3$3=from_html('<div class="error-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">⚠️</span> <p> </p> <p class="hint svelte-1kxwu1f">Срок действия ссылки истёк. Запросите новую ссылку для сброса пароля.</p> <button class="btn secondary svelte-1kxwu1f">Вернуться</button></div>'),root_6$3=from_html('<div class="error-message svelte-1kxwu1f"> </div>'),root_7$2=from_html('<div class="success-message-small svelte-1kxwu1f"> </div>'),root_5$5=from_html('<p class="description svelte-1kxwu1f">Для сброса пароля введите ваш email. Мы отправим вам ссылку для создания нового пароля.</p> <!> <!> <form><div class="form-group svelte-1kxwu1f"><label for="reset-email" class="svelte-1kxwu1f">Ваш email</label> <input type="email" id="reset-email" placeholder="your@email.com" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form> <div class="links"><button class="btn-link svelte-1kxwu1f">← На главную</button></div>',1),root_9=from_html('<div class="error-message svelte-1kxwu1f"> </div>'),root_8$3=from_html('<p class="description svelte-1kxwu1f">Введите новый пароль для вашего аккаунта.</p> <!> <form><div class="form-group svelte-1kxwu1f"><label for="new-password" class="svelte-1kxwu1f">Новый пароль</label> <input type="password" id="new-password" placeholder="Минимум 6 символов" minlength="6" required class="svelte-1kxwu1f"/></div> <div class="form-group svelte-1kxwu1f"><label for="confirm-password" class="svelte-1kxwu1f">Подтвердите пароль</label> <input type="password" id="confirm-password" placeholder="Повторите пароль" minlength="6" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form>',1),root$1=from_html('<div class="reset-password-overlay svelte-1kxwu1f"><div class="reset-card svelte-1kxwu1f"><button class="close-btn svelte-1kxwu1f" aria-label="Закрыть">×</button> <h1 class="svelte-1kxwu1f">🔐 Сброс пароля</h1> <!></div></div>');function ResetPasswordPage(r,e){push(e,!0);let t=prop(e,"initialError",3,""),i=prop(e,"initialToken",3,""),n=state(""),o=state(""),u=state(""),f=state(!1),p=state(""),v=state(proxy(t())),g=state(!1),m=state(!1),$=state(!1);async function _(){if(get$2($))return!0;try{console.log("[ResetPassword] Setting session from token");const{data:{session:I},error:k}=await supabase.auth.getSession();if(k)return console.error("[ResetPassword] Session error:",k),!1;if(I)return console.log("[ResetPassword] Session already exists"),set($,!0),!0;if(i()){console.log("[ResetPassword] Token provided, waiting for session..."),await new Promise(W=>setTimeout(W,1e3));const{data:{session:U}}=await supabase.auth.getSession();if(U)return set($,!0),!0}return!1}catch(I){return console.error("[ResetPassword] Error setting session:",I),!1}}onMount(async()=>{if(console.log("[ResetPassword] Mounted with:",{hasToken:!!i(),hasError:!!t(),path:window.location.pathname,hash:window.location.hash,search:window.location.search}),i()||window.location.pathname==="/reset-password"){const I=await _();set(m,I,!0),!I&&!t()&&set(v,"Ссылка для сброса пароля недействительна или истекла. Запросите новую.")}else t()&&(set(m,!1),set(v,t()))});async function E(){if(get$2(u)){set(f,!0),set(v,""),set(p,""),console.log("[ResetPassword] Sending reset to:",get$2(u));try{const{data:I,error:k}=await supabase.auth.resetPasswordForEmail(get$2(u),{redirectTo:`${window.location.origin}/reset-password`});console.log("[ResetPassword] Response:",{data:I,error:k}),k?k.message?.toLowerCase().includes("rate limit")||k.message?.toLowerCase().includes("too many")?set(v,"Лимит отправки писем исчерпан. Пожалуйста, подождите час."):k.message?.includes("User not found")?set(v,"Пользователь с таким email не найден"):set(v,k.message,!0):set(p,"Ссылка для сброса пароля отправлена! Проверьте почту (и папку спам).")}catch(I){console.error("[ResetPassword] Exception:",I),set(v,I.message||"Ошибка отправки",!0)}set(f,!1)}}async function T(){if(set(v,""),set(p,""),get$2(n).length<6){set(v,"Пароль должен быть не менее 6 символов");return}if(get$2(n)!==get$2(o)){set(v,"Пароли не совпадают");return}set(f,!0);try{if(!await _()){set(v,"Сессия не найдена. Пожалуйста, запросите новую ссылку для сброса пароля.");return}const{error:k}=await supabase.auth.updateUser({password:get$2(n)});k?(console.error("[ResetPassword] Update error:",k),set(v,k.message,!0)):(set(g,!0),set(p,"Пароль успешно изменён!"),setTimeout(()=>{window.location.hash="",e.onClose?.()},3e3))}catch(I){console.error("[ResetPassword] Exception:",I),set(v,I.message||"Ошибка при сбросе пароля",!0)}finally{set(f,!1)}}var x=root$1(),D=child(x),P=child(D);P.__click=function(...I){e.onClose?.apply(this,I)};var R=sibling(P,4);{var F=I=>{var k=root_1$6(),U=sibling(child(k),2),W=child(U);template_effect(()=>set_text(W,get$2(p))),append(I,k)},V=I=>{var k=comment(),U=first_child(k);{var W=L=>{var G=root_3$3(),re=sibling(child(G),2),ue=child(re),z=sibling(re,4);z.__click=function(...q){e.onClose?.apply(this,q)},template_effect(()=>set_text(ue,get$2(v))),append(L,G)},B=L=>{var G=comment(),re=first_child(G);{var ue=q=>{var N=root_5$5(),M=sibling(first_child(N),2);{var O=ne=>{var Y=root_6$3(),Z=child(Y);template_effect(()=>set_text(Z,get$2(v))),append(ne,Y)};if_block(M,ne=>{get$2(v)&&ne(O)})}var K=sibling(M,2);{var oe=ne=>{var Y=root_7$2(),Z=child(Y);template_effect(()=>set_text(Z,get$2(p))),append(ne,Y)};if_block(K,ne=>{get$2(p)&&ne(oe)})}var de=sibling(K,2),ae=child(de),_e=sibling(child(ae),2),me=sibling(ae,2),be=child(me),le=sibling(de,2),Q=child(le);Q.__click=function(...ne){e.onClose?.apply(this,ne)},template_effect(()=>{me.disabled=get$2(f)||!get$2(u),set_text(be,get$2(f)?"Отправка...":"Отправить ссылку")}),event("submit",de,ne=>{ne.preventDefault(),E()}),bind_value(_e,()=>get$2(u),ne=>set(u,ne)),append(q,N)},z=q=>{var N=root_8$3(),M=sibling(first_child(N),2);{var O=le=>{var Q=root_9(),ne=child(Q);template_effect(()=>set_text(ne,get$2(v))),append(le,Q)};if_block(M,le=>{get$2(v)&&le(O)})}var K=sibling(M,2),oe=child(K),de=sibling(child(oe),2),ae=sibling(oe,2),_e=sibling(child(ae),2),me=sibling(ae,2),be=child(me);template_effect(()=>{me.disabled=get$2(f)||!get$2(m),set_text(be,get$2(f)?"Сохранение...":"Сохранить новый пароль")}),event("submit",K,le=>{le.preventDefault(),T()}),bind_value(de,()=>get$2(n),le=>set(n,le)),bind_value(_e,()=>get$2(o),le=>set(o,le)),append(q,N)};if_block(re,q=>{get$2(m)?q(z,!1):q(ue)},!0)}append(L,G)};if_block(U,L=>{!get$2(m)&&get$2(v)?L(W):L(B,!1)},!0)}append(I,k)};if_block(R,I=>{get$2(g)?I(F):I(V,!1)})}append(r,x),pop()}delegate(["click"]);const gamesList=[{id:"memo-monsters",name:"Память монстров",description:"Найди все пары одинаковых монстров",icon:"👾",filename:"MemoMonsters.svelte",category:"memory"},{id:"onet-monsters",name:"Связь монстров",description:"Соедини одинаковых монстров линией",icon:"🔗",filename:"OnetMonsters.svelte",category:"puzzle"},{id:"evolution-2048",name:"Эволюция 2048",description:"Объединяй плитки и достигни 2048",icon:"🎲",filename:"Evolution2048.svelte",category:"puzzle"},{id:"whisper-of-spiders",name:"Шёпот пауков",description:"Реши математические примеры за 30 секунд",icon:"🕷️",filename:"WhisperOfSpiders.svelte",category:"arcade"},{id:"tower-of-souls",name:"Башня душ",description:"Классический пасьянс - собери карты по мастям",icon:"🃏",filename:"TowerOfSouls.svelte",category:"board"},{id:"soul-cycle",name:"Цикл душ",description:"Повторяй последовательность символов",icon:"🔥",filename:"SoulCycle.svelte",category:"memory"},{id:"labyrinth-of-minotaur",name:"Лабиринт Минотавра",description:"Найди выход из лабиринта",icon:"🌀",filename:"LabyrinthOfMinotaur.svelte",category:"puzzle"},{id:"cursed-crypts",name:"Проклятые склепы",description:"Сапёр - найди все безопасные ячейки",icon:"💀",filename:"CursedCrypts.svelte",category:"puzzle"},{id:"broken-mirror",name:"Разбитое зеркало",description:"Собери числа от 1 до 15",icon:"🪞",filename:"BrokenMirror.svelte",category:"puzzle"},{id:"alchemists-cross",name:"Алхимический крестик",description:"Крестики-нолики - первым выстрой 3 в ряд",icon:"🧪",filename:"AlchemistsCross.svelte",category:"board"},{id:"light-out",name:"Погаси свет",description:"Погаси все клетки на поле",icon:"💡",filename:"LightOut.svelte",category:"logic"},{id:"flood-it",name:"Затопи поле",description:"Заливай поле одним цветом за минимальное количество ходов",icon:"🌊",filename:"FloodIt.svelte",category:"logic"},{id:"bones-421",name:"Кости 4-2-1",description:"Брось кости и набери комбинацию 4-2-1",icon:"🎴",filename:"Bones421.svelte",category:"board"},{id:"crystals-of-time",name:"Кристаллы времени",description:"Повтори последовательность кристаллов",icon:"💎",filename:"CrystalsOfTime.svelte",category:"memory"},{id:"runes-of-fate",name:"Руны судьбы",description:"Победи духа в поединке рун",icon:"🔮",filename:"RunesOfFate.svelte",category:"board"},{id:"witches-cauldrons",name:"Котёл ведьмы",description:"Собери ингредиенты для зелья",icon:"🧙",filename:"WitchesCauldrons.svelte",category:"arcade"},{id:"alchemical-calculator",name:"Алхимический калькулятор",description:"Получи целевое число используя все числа",icon:"⚗️",filename:"AlchemicalCalculator.svelte",category:"logic"}],categoryNames={puzzle:"Головоломки",memory:"Память",logic:"Логика",arcade:"Аркады",board:"Настольные",other:"Другие"};var root_2$4=from_html('<button type="button" class="crystal-btn svelte-1gbuyw4"><span class="crystal-icon svelte-1gbuyw4"> </span> <span class="crystal-name svelte-1gbuyw4"> </span></button>'),root_3$2=from_html('<div class="game-over-message svelte-1gbuyw4"><span> </span></div>'),root_5$4=from_html('<div class="status-message svelte-1gbuyw4">✨ Кристаллы показывают путь... ✨</div>'),root_6$2=from_html('<div class="status-message svelte-1gbuyw4">👆 Повтори последовательность</div>'),root_7$1=from_html('<div class="progress svelte-1gbuyw4"> </div>'),root_8$2=from_html('<div class="footer-stats svelte-1gbuyw4"><span class="target-info svelte-1gbuyw4">Раунд: <strong class="svelte-1gbuyw4"> </strong></span></div>'),root_1$5=from_html('<!> <div id="game-container" class="svelte-1gbuyw4"><div class="stats-panel svelte-1gbuyw4"><div class="round svelte-1gbuyw4">Раунд: <strong class="svelte-1gbuyw4"> </strong></div> <div class="high-score svelte-1gbuyw4">Рекорд: <strong class="svelte-1gbuyw4"> </strong></div></div> <div class="crystals-grid svelte-1gbuyw4"></div> <div class="status-area svelte-1gbuyw4"><!></div> <!></div> <!> <!>',1);function CrystalsOfTime(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{color:"#e94560",name:"Рубин",icon:"🔴"},{color:"#0984e3",name:"Сапфир",icon:"🔵"},{color:"#00b894",name:"Изумруд",icon:"🟢"},{color:"#fdcb6e",name:"Топаз",icon:"🟡"}],f=1e3,p=10;let v=state(proxy([])),g=state(proxy([])),m=state(1),$=state(!1),_=state(null),E=state(!1),T=state(0),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(){set(v,[],!0),set(g,[],!0),set(m,1),set(E,!1),P()}function P(){const B=Math.floor(Math.random()*u.length);set(v,[...get$2(v),B],!0),R()}async function R(){set($,!0),set(g,[],!0);for(let B=0;B<get$2(v).length;B++)await new Promise(L=>setTimeout(L,300)),set(_,get$2(v)[B],!0),V(get$2(v)[B]),await new Promise(L=>setTimeout(L,500)),set(_,null),await new Promise(L=>setTimeout(L,200));set($,!1)}function F(B){if(get$2($)||get$2(E))return;set(_,B,!0),V(B),setTimeout(()=>{set(_,null)},300);const L=get$2(g).length;if(B!==get$2(v)[L]){set(E,!0),get$2(m)-1>get$2(T)&&set(T,get$2(m)-1),t()?(k("💀 Поражение","Время распалось...",[]),setTimeout(()=>{U(),e.onLose?.()},f)):k("💀 Время распалось",`Раунд ${get$2(m)-1}`,[{text:"Начать заново",action:D}]);return}if(set(g,[...get$2(g),B],!0),get$2(g).length===get$2(v).length){if(update(m),get$2(m)>get$2(T)&&set(T,get$2(m),!0),get$2(m)>p){set(E,!0),t()?(k("🎉 Победа!","Время под контролем!",[]),setTimeout(()=>{U(),e.onWin?.()},f)):k("🎉 Победа!","Ты покорил время!",[{text:"Играть снова",action:D}]);return}setTimeout(()=>{P()},1e3)}}function V(B){console.log(`Play sound for crystal ${B}`)}function I(B){const L=u[B],G=get$2(_)===B,re=G?`0 0 50px ${L.color}, 0 0 100px ${L.color}`:`0 8px 0 ${L.color}`;return`background-color: ${L.color}; box-shadow: ${re}; transform: ${G?"translateY(2px)":"none"};`}function k(B,L,G){set(x,{show:!0,title:B,text:L,actions:G},!0)}function U(){get$2(x).show=!1}function W(){k("📖 Правила",`Кристаллы времени:

🎯 Цель: Повтори последовательность кристаллов.

🔮 Смотри внимательно на последовательность.

👆 Кликай кристаллы в том же порядке.

💀 Если ошибся - игра окончена.

✨ Пройди 10 раундов для победы!`,[{text:"Понятно",action:U}])}onMount(()=>{D()}),BodyWrapper(r,{children:(B,L)=>{var G=root_1$5(),re=first_child(G);{let Z=user_derived(()=>t()?()=>{set(E,!0),k("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},f)}:void 0);GameHeader(re,{onRestart:D,get onGiveUp(){return get$2(Z)},get showGiveUp(){return t()},onShowRules:W})}var ue=sibling(re,2),z=child(ue),q=child(z),N=sibling(child(q)),M=child(N),O=sibling(q,2),K=sibling(child(O)),oe=child(K),de=sibling(z,2);each(de,21,()=>u,index$1,(Z,ce,te)=>{var he=root_2$4();he.__click=()=>F(te);var ie=child(he),pe=child(ie),ge=sibling(ie,2),Ie=child(ge);template_effect(ke=>{set_style(he,ke),he.disabled=get$2($)||get$2(E),set_text(pe,get$2(ce).icon),set_text(Ie,get$2(ce).name)},[()=>I(te)]),append(Z,he)});var ae=sibling(de,2),_e=child(ae);{var me=Z=>{var ce=root_3$2(),te=child(ce),he=child(te);template_effect(()=>set_text(he,`💀 Время распалось... Раунд ${get$2(m)-1}`)),append(Z,ce)},be=Z=>{var ce=comment(),te=first_child(ce);{var he=pe=>{var ge=root_5$4();append(pe,ge)},ie=pe=>{var ge=root_6$2();append(pe,ge)};if_block(te,pe=>{get$2($)?pe(he):pe(ie,!1)},!0)}append(Z,ce)};if_block(_e,Z=>{get$2(E)?Z(me):Z(be,!1)})}var le=sibling(ae,2);{var Q=Z=>{var ce=root_7$1(),te=child(ce);template_effect(()=>set_text(te,`Прогресс: ${get$2(g).length??""} / ${get$2(v).length??""}`)),append(Z,ce)};if_block(le,Z=>{get$2(v).length>0&&!get$2(E)&&!get$2($)&&Z(Q)})}var ne=sibling(ue,2);GameFooter(ne,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(Z,ce)=>{var te=root_8$2(),he=child(te),ie=sibling(child(he)),pe=child(ie);template_effect(()=>set_text(pe,`${get$2(m)??""}/10`)),append(Z,te)},$$slots:{default:!0}});var Y=sibling(ne,2);MinigameModal(Y,{get modal(){return get$2(x)}}),template_effect(()=>{set_text(M,get$2(m)),set_text(oe,get$2(T))}),append(B,G)}}),pop()}delegate(["click"]);var on_click$3=(r,e,t)=>e(get$2(t)),root_2$3=from_html('<button class="rune-btn svelte-1bt21l4"> </button>'),root_1$4=from_html('<!> <div id="game-container" class="svelte-1bt21l4"><div class="score-board svelte-1bt21l4"><div class="score player svelte-1bt21l4"><span class="label svelte-1bt21l4">Ты</span> <span class="value svelte-1bt21l4"> </span></div> <div class="vs svelte-1bt21l4">VS</div> <div class="score computer svelte-1bt21l4"><span class="label svelte-1bt21l4">Дух</span> <span class="value svelte-1bt21l4"> </span></div></div> <div class="battle-area svelte-1bt21l4"><div class="choice-display player-choice svelte-1bt21l4"><div class="rune-icon svelte-1bt21l4"> </div> <div class="choice-label svelte-1bt21l4">Твой выбор</div></div> <div class="versus-symbol svelte-1bt21l4">⚡</div> <div class="choice-display computer-choice svelte-1bt21l4"><div class="rune-icon svelte-1bt21l4"> </div> <div class="choice-label svelte-1bt21l4">Выбор духа</div></div></div> <div class="result-message svelte-1bt21l4"> </div> <div class="rune-panel svelte-1bt21l4"></div> <div class="round-indicator svelte-1bt21l4"> </div></div> <!> <!>',1);function RunesOfFate(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=["🛡️","⚔️","🔮"],f={"🛡️⚔️":"🛡️","⚔️🔮":"⚔️","🔮🛡️":"🔮"};let p=state(null),v=state(null),g=state(0),m=state(0),$=state(0),_=5,E=state(!1),T=state(""),x=state(!1),D=state(proxy({show:!1,title:"",text:"",actions:[]}));function P(){const W=Math.floor(Math.random()*u.length);return u[W]}function R(W,B){if(W===B)return"tie";const L=`${W}${B}`;return f[L]===W?"player":"computer"}async function F(W){if(get$2(E)||get$2(x)||get$2($)>=_)return;set(E,!0),set(p,W,!0),set(v,null),set(T,"Дух выбирает..."),await new Promise(L=>setTimeout(L,800)),set(v,P(),!0);const B=R(get$2(p),get$2(v));B==="player"?(update(g),set(T,"Победа! Силы света с тобой!")):B==="computer"?(update(m),set(T,"Поражение... Тьма наступает")):set(T,"Ничья. Силы уравновешены"),update($),get$2($)>=_&&(set(x,!0),get$2(g)>get$2(m)?t()?setTimeout(()=>e.onWin?.(),1e3):I("🎉 Победа!",`Ты победил духа ${get$2(g)}:${get$2(m)}!`,[{text:"Играть снова",action:V}]):t()?setTimeout(()=>e.onLose?.(),1e3):I("💀 Поражение",`Дух оказался сильнее ${get$2(m)}:${get$2(g)}`,[{text:"Новая битва",action:V}])),set(E,!1)}function V(){set(p,null),set(v,null),set(g,0),set(m,0),set($,0),set(x,!1),set(T,""),k()}function I(W,B,L){set(D,{show:!0,title:W,text:B,actions:L},!0)}function k(){get$2(D).show=!1}function U(){I("📖 Правила",`Руны Судьбы:

🛡️ Щит побеждает ⚔️ Меч
⚔️ Меч побеждает 🔮 Магию
🔮 Магия побеждает 🛡️ Щит

Первый, кто наберет 3 победы из 5 раундов, станет властелином судьбы!`,[{text:"Понятно",action:k}])}BodyWrapper(r,{children:(W,B)=>{var L=root_1$4(),G=first_child(L);{let ie=user_derived(()=>t()?()=>e.onLose?.():void 0);GameHeader(G,{onRestart:V,get onGiveUp(){return get$2(ie)},get showGiveUp(){return t()},onShowRules:U})}var re=sibling(G,2),ue=child(re),z=child(ue),q=sibling(child(z),2),N=child(q),M=sibling(z,4),O=sibling(child(M),2),K=child(O),oe=sibling(ue,2),de=child(oe),ae=child(de),_e=child(ae),me=sibling(de,4),be=child(me),le=child(be),Q=sibling(oe,2),ne=child(Q),Y=sibling(Q,2);each(Y,21,()=>u,index$1,(ie,pe)=>{var ge=root_2$3();ge.__click=[on_click$3,F,pe];var Ie=child(ge);template_effect(()=>{ge.disabled=get$2(E)||get$2(x)||get$2($)>=_,set_text(Ie,get$2(pe))}),append(ie,ge)});var Z=sibling(Y,2),ce=child(Z),te=sibling(re,2);GameFooter(te,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()}});var he=sibling(te,2);MinigameModal(he,{get modal(){return get$2(D)}}),template_effect(()=>{set_text(N,get$2(g)),set_text(K,get$2(m)),set_text(_e,get$2(p)||"❓"),set_text(le,get$2(v)||"❓"),set_text(ne,get$2(T)),set_text(ce,`Раунд: ${get$2($)??""} / 5`)}),append(W,L)}}),pop()}delegate(["click"]);var root_2$2=from_html('<div class="start-screen svelte-y67o6y"><h2 class="svelte-y67o6y">🧙 Котлы Ведьмы 🧙</h2> <p class="svelte-y67o6y">Помоги ведьме собрать нужные ингредиенты!</p> <button type="button" class="start-btn svelte-y67o6y">Начать варить</button></div>'),root_6$1=from_html("<span> </span>"),root_5$3=from_html('<div class="current-recipe svelte-y67o6y"><div class="recipe-name svelte-y67o6y"> </div> <div class="recipe-ingredients svelte-y67o6y"></div> <div class="recipe-progress svelte-y67o6y"> </div></div>'),on_click$2=(r,e,t)=>e(get$2(t).icon,get$2(t).id),root_7=from_html('<button type="button" class="floating-item svelte-y67o6y"> </button>'),root_4$2=from_html('<div class="game-header svelte-y67o6y"><div class="score svelte-y67o6y"> </div> <div> </div></div> <!> <div class="game-area svelte-y67o6y"><div class="cauldron svelte-y67o6y">🧙‍♀️ <div class="cauldron-fire svelte-y67o6y">🔥</div></div> <div class="floating-items svelte-y67o6y"></div></div> <div class="instructions svelte-y67o6y"><p class="svelte-y67o6y">Кликай на нужные ингредиенты!</p> <p class="svelte-y67o6y">Лишние уменьшают счёт 👎</p></div>',1),root_8$1=from_html('<div class="footer-stats svelte-y67o6y"><span class="target-info svelte-y67o6y">Цель: <strong class="svelte-y67o6y"></strong> очков</span></div>'),root_1$3=from_html('<!> <div id="game-container" class="svelte-y67o6y"><!></div> <!> <!>',1);function WitchesCauldrons(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{id:"frog",icon:"🐸",name:"Лягушачья лапка"},{id:"spider",icon:"🕷️",name:"Паучий глаз"},{id:"bat",icon:"🦇",name:"Крыло летучей мыши"},{id:"skull",icon:"💀",name:"Прах скелета"},{id:"mushroom",icon:"🍄",name:"Ядовитый гриб"},{id:"potion",icon:"🧪",name:"База зелья"},{id:"bone",icon:"🦴",name:"Кость"},{id:"web",icon:"🕸️",name:"Паутина"}],f=[{name:"Любовное зелье",ingredients:["🐸","🕷️","🧪"]},{name:"Зелье невидимости",ingredients:["🦇","🍄","🧪"]},{name:"Яд",ingredients:["💀","🕷️","🍄"]},{name:"Эликсир жизни",ingredients:["🦇","🦴","🧪"]}],p=1e3,v=20,g=60;let m=state(null),$=state(proxy([])),_=state(0),E=state(g),T=state(!1),x=state(proxy([])),D,P,R=state(!1),F=state(proxy({show:!1,title:"",text:"",actions:[]}));function V(){set(T,!0),set(R,!0),set(_,0),set(E,g),set($,[],!0),k(),D=setInterval(()=>{update(E,-1),get$2(E)<=0&&I()},1e3),P=setInterval(()=>{get$2(T)&&U()},800)}function I(){set(T,!1),clearInterval(D),clearInterval(P),get$2(_)>=v?t()?(L("🧪 Зелье сварено!",`Счёт: ${get$2(_)}`,[]),setTimeout(()=>{G(),e.onWin?.()},p)):L("🧪 Зелье сварено!",`Счёт: ${get$2(_)}`,[{text:"Играть снова",action:V}]):t()?(L("💀 Котёл взорвался",`Счёт: ${get$2(_)}`,[]),setTimeout(()=>{G(),e.onLose?.()},p)):L("💀 Котёл взорвался",`Счёт: ${get$2(_)}`,[{text:"Испытать снова",action:V}])}function k(){const ue=Math.floor(Math.random()*f.length);set(m,f[ue],!0),set($,[],!0)}function U(){const ue=u[Math.floor(Math.random()*u.length)],z=Math.random()*80+10,N={id:`${ue.id}-${Date.now()}-${Math.random()}`,icon:ue.icon,x:z,y:-10};set(x,[...get$2(x),N],!0),setTimeout(()=>{set(x,get$2(x).filter(M=>M.id!==N.id),!0)},5e3)}function W(ue,z){!get$2(T)||!get$2(m)||(set(x,get$2(x).filter(q=>q.id!==z),!0),get$2(m).ingredients.includes(ue)&&!get$2($).includes(ue)?(set($,[...get$2($),ue],!0),set(_,get$2(_)+10),get$2($).length===get$2(m).ingredients.length&&(set(_,get$2(_)+50),k())):set(_,Math.max(0,get$2(_)-5),!0))}function B(){return get$2(m)?get$2(m).ingredients.map(ue=>get$2($).includes(ue)?ue:"❓").join(" + "):""}function L(ue,z,q){set(F,{show:!0,title:ue,text:z,actions:q},!0)}function G(){get$2(F).show=!1}function re(){L("📖 Правила",`Котёл ведьмы:

🎯 Цель: Набери {WIN_SCORE} очков за {GAME_TIME} секунд.

🧪 Собирай нужные ингредиенты для рецепта.

👆 Кликай на падающие ингредиенты.

✅ Правильный ингредиент: +10 очков.

✨ Полный рецепт: +50 очков.

❌ Неправильный ингредиент: -5 очков.`,[{text:"Понятно",action:G}])}onDestroy(()=>{clearInterval(D),clearInterval(P)}),BodyWrapper(r,{children:(ue,z)=>{var q=root_1$3(),N=first_child(q);{let _e=user_derived(()=>t()?()=>{set(T,!1),clearInterval(D),clearInterval(P),L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{G(),e.onLose?.()},p)}:void 0);GameHeader(N,{onRestart:V,get onGiveUp(){return get$2(_e)},get showGiveUp(){return t()},onShowRules:re})}var M=sibling(N,2),O=child(M);{var K=_e=>{var me=root_2$2(),be=sibling(child(me),4);be.__click=V,append(_e,me)},oe=_e=>{var me=comment(),be=first_child(me);{var le=Q=>{var ne=root_4$2(),Y=first_child(ne),Z=child(Y),ce=child(Z),te=sibling(Z,2);let he;var ie=child(te),pe=sibling(Y,2);{var ge=Re=>{var Ce=root_5$3(),Be=child(Ce),De=child(Be),w=sibling(Be,2);each(w,21,()=>get$2(m).ingredients,index$1,(S,j)=>{var X=root_6$1();let ve;var Ae=child(X);template_effect((je,Se)=>{ve=set_class(X,1,"ingredient-icon svelte-y67o6y",null,ve,je),set_text(Ae,Se)},[()=>({collected:get$2($).includes(get$2(j))}),()=>get$2($).includes(get$2(j))?get$2(j):"❓"]),append(S,X)});var c=sibling(w,2),h=child(c);template_effect(S=>{set_text(De,get$2(m).name),set_text(h,S)},[B]),append(Re,Ce)};if_block(pe,Re=>{get$2(m)&&Re(ge)})}var Ie=sibling(pe,2),ke=sibling(child(Ie),2);each(ke,21,()=>get$2(x),index$1,(Re,Ce)=>{var Be=root_7();Be.__click=[on_click$2,W,Ce];var De=child(Be);template_effect(()=>{set_style(Be,`left: ${get$2(Ce).x??""}%; top: ${get$2(Ce).y??""}%;`),set_text(De,get$2(Ce).icon)}),append(Re,Be)}),template_effect(Re=>{set_text(ce,`✨ ${get$2(_)??""}`),he=set_class(te,1,"timer svelte-y67o6y",null,he,Re),set_text(ie,`⏳ ${get$2(E)??""}с`)},[()=>({danger:get$2(E)<=10})]),append(Q,ne)};if_block(be,Q=>{get$2(T)&&Q(le)},!0)}append(_e,me)};if_block(O,_e=>{get$2(R)?_e(oe,!1):_e(K)})}var de=sibling(M,2);GameFooter(de,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(_e,me)=>{var be=root_8$1(),le=child(be),Q=sibling(child(le));Q.textContent="20",append(_e,be)},$$slots:{default:!0}});var ae=sibling(de,2);MinigameModal(ae,{get modal(){return get$2(F)}}),append(ue,q)}}),pop()}delegate(["click"]);function checkSolution(r,e,t,i,n,o,u,f,p,v,g,m,$){if(get$2(e).length>0){set(t,"Используй все числа!");return}const _=i();if(_===null){set(t,"Неполное выражение");return}Math.abs(_-get$2(n))<.01?(set(t,"✨ Великолепно! Алхимия удалась! ✨"),set(o,!0),set(u,!0),f()?(p("🎉 Победа!","Алхимия удалась!",[]),setTimeout(()=>{v(),g.onWin?.()},m)):p("🎉 Победа!","Алхимия удалась!",[{text:"Играть снова",action:$}])):set(t,`❌ Получилось ${_.toFixed(1)}, нужно ${get$2(n)}`)}function clearExpression(r,e,t,i,n){set(e,[...get$2(t)],!0),set(i,[],!0),set(n,"")}function removeLast(r,e,t){const i=[...get$2(e)],n=i.pop();n&&n.type==="number"&&set(t,[...get$2(t),n.value].sort((o,u)=>o-u),!0),set(e,i,!0)}var root_2$1=from_html("<span> </span>"),on_click$1=(r,e,t)=>e(get$2(t)),root_3$1=from_html('<button type="button" class="num-btn svelte-x83gym"> </button>'),on_click_1$1=(r,e,t)=>e(get$2(t)),root_4$1=from_html('<button type="button" class="op-btn svelte-x83gym"> </button>'),root_5$2=from_html("<div> </div>"),root_6=from_html('<div class="footer-stats svelte-x83gym"><span class="target-info svelte-x83gym">Цель: <strong class="svelte-x83gym"> </strong></span></div>'),root_1$2=from_html('<!> <div id="game-container" class="svelte-x83gym"><div class="target-number svelte-x83gym"><div class="target-label svelte-x83gym">Цель:</div> <div class="target-value svelte-x83gym"> </div></div> <div class="expression-area svelte-x83gym"><!> <span class="expr-cursor svelte-x83gym">_</span></div> <div class="numbers-panel svelte-x83gym"><div class="numbers-grid svelte-x83gym"></div></div> <div class="operations-grid svelte-x83gym"></div> <div class="action-buttons svelte-x83gym"><button type="button" class="action-btn svelte-x83gym">↩</button> <button type="button" class="action-btn svelte-x83gym">🧹</button> <button type="button" class="action-btn primary svelte-x83gym">⚗️</button></div> <!></div> <!> <!>',1);function AlchemicalCalculator(r,e){push(e,!0);let t=prop(e,"integrated",3,!1),i=prop(e,"rewardItem",3,null),n=prop(e,"items",19,()=>[]),o=prop(e,"bucketName",3,"dracula");const u=[{symbol:"+",func:(B,L)=>B+L},{symbol:"−",func:(B,L)=>B-L},{symbol:"×",func:(B,L)=>B*L},{symbol:"÷",func:(B,L)=>B/L}],f=1e3;let p=state(proxy([])),v=state(0),g=state(proxy([])),m=state(proxy([])),$=state(proxy([])),_=state(!1),E=state(!1),T=state(""),x=state(proxy({show:!1,title:"",text:"",actions:[]}));function D(){const B=Array(4).fill(0).map(()=>Math.floor(Math.random()*12)+1);set(p,[...B],!0),set(m,[...B],!0),set(v,Math.floor(B.reduce((L,G)=>L+G,0)/2)+2),set($,[...u],!0),set(g,[],!0),set(T,""),set(_,!1),set(E,!1)}function P(B){get$2(_)||get$2(m).includes(B)&&(set(g,[...get$2(g),{type:"number",value:B,id:`${B}-${Date.now()}-${Math.random()}`}],!0),set(m,get$2(m).filter(L=>L!==B),!0))}function R(B){if(get$2(_))return;const L=get$2(g)[get$2(g).length-1];L&&L.type==="number"&&get$2(g).length<7&&set(g,[...get$2(g),{type:"operation",value:B.symbol,id:`${B.symbol}-${Date.now()}-${Math.random()}`}],!0)}function F(){if(get$2(g).length<3)return null;let B=get$2(g)[0].value;for(let L=1;L<get$2(g).length;L+=2){const G=get$2(g)[L],re=get$2(g)[L+1];if(G.type!=="operation"||!re||re.type!=="number")return null;const ue=u.find(z=>z.symbol===G.value)?.func;if(!ue)return null;B=ue(B,re.value)}return B}function V(){D(),U()}function I(){set(_,!0),t()?(k("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{U(),e.onLose?.()},f)):k("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:V}])}function k(B,L,G){set(x,{show:!0,title:B,text:L,actions:G},!0)}function U(){get$2(x).show=!1}function W(){k("📖 Правила",`Алхимический калькулятор:

🎯 Цель: Используя все числа и операции, получи целевое число.

🔢 Доступны 4 числа от 1 до 12.

➕➖✖️➗ Можно использовать любые операции.

⚠️ Порядок выполнения: слева направо.`,[{text:"Понятно",action:U}])}onMount(()=>{V()}),BodyWrapper(r,{children:(B,L)=>{var G=root_1$2(),re=first_child(G);{let Z=user_derived(()=>t()?I:void 0);GameHeader(re,{onRestart:V,get onGiveUp(){return get$2(Z)},get showGiveUp(){return t()},onShowRules:W})}var ue=sibling(re,2),z=child(ue),q=sibling(child(z),2),N=child(q),M=sibling(z,2),O=child(M);each(O,17,()=>get$2(g),index$1,(Z,ce)=>{var te=root_2$1(),he=child(te);template_effect(()=>{set_class(te,1,`expr-item expr-${get$2(ce).type??""}`,"svelte-x83gym"),set_text(he,get$2(ce).value)}),append(Z,te)});var K=sibling(M,2),oe=child(K);each(oe,21,()=>get$2(m),index$1,(Z,ce)=>{var te=root_3$1();te.__click=[on_click$1,P,ce];var he=child(te);template_effect(()=>{te.disabled=get$2(_),set_text(he,get$2(ce))}),append(Z,te)});var de=sibling(K,2);each(de,21,()=>u,index$1,(Z,ce)=>{var te=root_4$1();te.__click=[on_click_1$1,R,ce];var he=child(te);template_effect(()=>{te.disabled=get$2(_),set_text(he,get$2(ce).symbol)}),append(Z,te)});var ae=sibling(de,2),_e=child(ae);_e.__click=[removeLast,g,m];var me=sibling(_e,2);me.__click=[clearExpression,m,p,g,T];var be=sibling(me,2);be.__click=[checkSolution,m,T,F,v,_,E,t,k,U,e,f,V];var le=sibling(ae,2);{var Q=Z=>{var ce=root_5$2();let te;var he=child(ce);template_effect(ie=>{te=set_class(ce,1,"message svelte-x83gym",null,te,ie),set_text(he,get$2(T))},[()=>({success:get$2(T).includes("✨")})]),append(Z,ce)};if_block(le,Z=>{get$2(T)&&Z(Q)})}var ne=sibling(ue,2);GameFooter(ne,{get rewardItem(){return i()},get items(){return n()},get bucketName(){return o()},children:(Z,ce)=>{var te=root_6(),he=child(te),ie=sibling(child(he)),pe=child(ie);template_effect(()=>set_text(pe,get$2(v))),append(Z,te)},$$slots:{default:!0}});var Y=sibling(ne,2);MinigameModal(Y,{get modal(){return get$2(x)}}),template_effect(()=>{set_text(N,get$2(v)),_e.disabled=get$2(g).length===0||get$2(_),me.disabled=get$2(g).length===0||get$2(_),be.disabled=get$2(_)}),append(B,G)}}),pop()}delegate(["click"]);function handleGameBack(r,e){set(e,null)}var root_1$1=from_html('<div class="game-container svelte-1t3borq"><button type="button" class="back-btn svelte-1t3borq">← К списку игр</button> <!></div>'),on_click=(r,e,t)=>set(e,get$2(t),!0),root_3=from_html('<button type="button"> </button>'),on_click_1=(r,e,t)=>e(get$2(t)),root_4=from_html('<button type="button" class="game-card svelte-1t3borq"><div class="game-icon svelte-1t3borq"> </div> <div class="game-info svelte-1t3borq"><h3 class="game-name svelte-1t3borq"> </h3> <p class="game-description svelte-1t3borq"> </p></div> <div class="game-arrow svelte-1t3borq">→</div></button>'),root_5$1=from_html('<div class="empty svelte-1t3borq"><p>Игр в этой категории пока нет</p></div>'),root_2=from_html('<div class="all-games svelte-1t3borq"><div class="header svelte-1t3borq"><button type="button" class="back-btn svelte-1t3borq">← Назад</button> <h1 class="svelte-1t3borq">🎮 Мини-игры</h1> <p class="svelte-1t3borq">Выберите игру для прохождения</p></div> <div class="categories svelte-1t3borq"></div> <div class="games-scroll svelte-1t3borq"><div class="games-grid svelte-1t3borq"></div></div> <!></div>');function AllGames(r,e){push(e,!0);const t={"memo-monsters":MemoMonsters,"onet-monsters":OnetMonsters,"evolution-2048":Evolution2048,"whisper-of-spiders":WhisperOfSpiders,"tower-of-souls":TowerOfSouls,"soul-cycle":SoulCycle,"labyrinth-of-minotaur":LabyrinthOfMinotaur,"cursed-crypts":CursedCrypts,"broken-mirror":BrokenMirror,"alchemists-cross":AlchemistsCross,"light-out":LightOut,"flood-it":FloodIt,"bones-421":Bones421,"crystals-of-time":CrystalsOfTime,"runes-of-fate":RunesOfFate,"witches-cauldrons":WitchesCauldrons,"alchemical-calculator":AlchemicalCalculator};let i=state("all"),n=state(null);const o=user_derived(()=>get$2(i)==="all"?gamesList:gamesList.filter(E=>E.category===get$2(i))),u=["all","puzzle","memory","logic","arcade","board"];function f(E){set(n,E,!0)}function p(){set(n,null)}const v=user_derived(()=>get$2(n)?t[get$2(n).id]:null);var g=comment(),m=first_child(g);{var $=E=>{var T=root_1$1(),x=child(T);x.__click=[handleGameBack,n];var D=sibling(x,2);component(D,()=>get$2(v),(P,R)=>{R(P,{integrated:!1,onWin:()=>p(),onLose:()=>p(),rewardItem:null,items:[],bucketName:"dracula"})}),append(E,T)},_=E=>{var T=root_2(),x=child(T),D=child(x);D.__click=function(...k){e.onBack?.apply(this,k)};var P=sibling(x,2);each(P,21,()=>u,index$1,(k,U)=>{var W=root_3();let B;W.__click=[on_click,i,U];var L=child(W);template_effect(G=>{B=set_class(W,1,"category-btn svelte-1t3borq",null,B,G),set_text(L,get$2(U)==="all"?"Все":categoryNames[get$2(U)])},[()=>({active:get$2(i)===get$2(U)})]),append(k,W)});var R=sibling(P,2),F=child(R);each(F,21,()=>get$2(o),k=>k.id,(k,U)=>{var W=root_4();W.__click=[on_click_1,f,U];var B=child(W),L=child(B),G=sibling(B,2),re=child(G),ue=child(re),z=sibling(re,2),q=child(z);template_effect(()=>{set_text(L,get$2(U).icon),set_text(ue,get$2(U).name),set_text(q,get$2(U).description)}),append(k,W)});var V=sibling(R,2);{var I=k=>{var U=root_5$1();append(k,U)};if_block(V,k=>{get$2(o).length===0&&k(I)})}append(E,T)};if_block(m,E=>{get$2(n)&&get$2(v)?E($):E(_,!1)})}append(r,g),pop()}delegate(["click"]);var root_1=from_html('<div class="loading-screen svelte-1wixmhx"><div class="loader svelte-1wixmhx"></div> <p>Загрузка...</p></div>'),root_5=from_html('<button class="btn-back-to-game svelte-1wixmhx" title="Назад к игре">← Назад к игре</button> <!>',1),root_8=from_html("<!> <!>",1),root=from_html("<!> <!>",1);function App(r,e){push(e,!0);let t=null,i=null,n=null,o=state(!1),u=state(!1),f=state(!1),p=state(""),v=state("");async function g(){const F=new URLSearchParams(window.location.search),V=F.get("story"),I=F.get("bucket");if(!V&&!I)return null;console.log("[App] Внешняя ссылка на историю:",{storyId:V,bucket:I}),await loadStories();let k=null;return V?k=getStoryById(V):I&&(k=getStoryByBucket(I)),k?(console.log("[App] Найдена история:",k.title),gameState.selectedStory=k.id,gameState.selectedStoryData=k,window.history.replaceState({},"","/"),k):(console.log("[App] История не найдена"),null)}user_effect(()=>{authState.initialized&&console.log("[App] Auth state changed:",{user:authState.user?.email,isAuthenticated:authDerivedState.isAuthenticated,session:!!authState.session,loading:authState.loading})});async function m(){const F=window.location.hash,V=window.location.search;if(console.log("[App] Checking auth callback:",{hash:F,search:V}),F.includes("type=recovery")||V.includes("type=recovery")){console.log("[App] Recovery flow detected");let I="";F.includes("access_token=")?I=new URLSearchParams(F.substring(1)).get("access_token")||"":V.includes("token=")&&(I=new URLSearchParams(V).get("token")||""),I&&(set(v,I,!0),set(u,!0),window.history.replaceState({},"","/reset-password"))}else if(V.includes("error=")){const I=new URLSearchParams(V);set(p,I.get("error_description")||I.get("error")||"Unknown error",!0),set(u,!0),window.history.replaceState({},"","/reset-password")}else window.location.pathname==="/reset-password"&&set(u,!0)}const $=async()=>{await userKeyStore.stopSessionTimer()};onMount(async()=>{console.log("[App] Mounted"),userKeyStore.startSessionTimer(),typeof window<"u"&&window.addEventListener("beforeunload",$);try{const V=await userKeyStore.init();V?(t=V,i=await userKeyStore.getUserStats(V)):n="Не удалось создать ключ пользователя"}catch(V){n=V instanceof Error?V.message:"Произошла ошибка"}finally{}const F=()=>{set(f,!0)};window.addEventListener("open-all-games",F);try{await m();const V=initAuth(),I=new Promise((k,U)=>setTimeout(()=>U(new Error("Timeout auth")),1e4));await Promise.race([V,I]),console.log("[App] Auth initialized successfully"),await g()}catch(V){console.error("[App] Auth init error:",V)}finally{set(o,!0),console.log("[App] App ready")}return()=>{window.removeEventListener("open-all-games",F),window.removeEventListener("beforeunload",$)}});function _(){set(u,!1),set(p,""),set(v,""),window.history.replaceState({},"","/")}function E(){set(f,!1)}var T=root(),x=first_child(T);{var D=F=>{var V=root_1();append(F,V)},P=F=>{var V=comment(),I=first_child(V);{var k=W=>{ResetPasswordPage(W,{onClose:_,get initialError(){return get$2(p)},get initialToken(){return get$2(v)}})},U=W=>{var B=comment(),L=first_child(B);{var G=ue=>{var z=root_5(),q=first_child(z);q.__click=function(...M){editorActions.toggleEditor?.apply(this,M)};var N=sibling(q,2);Editor(N,{}),append(ue,z)},re=ue=>{var z=comment(),q=first_child(z);{var N=O=>{AllGames(O,{onBack:E})},M=O=>{var K=root_8(),oe=first_child(K);UserMenu(oe,{});var de=sibling(oe,2);Main(de,{}),append(O,K)};if_block(q,O=>{get$2(f)?O(N):O(M,!1)},!0)}append(ue,z)};if_block(L,ue=>{editor.showEditor?ue(G):ue(re,!1)},!0)}append(W,B)};if_block(I,W=>{get$2(u)?W(k):W(U,!1)},!0)}append(F,V)};if_block(x,F=>{get$2(o)?F(P,!1):F(D)})}var R=sibling(x,2);if_block(R,F=>{}),append(r,T),pop()}delegate(["click"]);mount(App,{target:document.getElementById("app")});
