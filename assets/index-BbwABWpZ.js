(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();const cl=!1;var Os=Array.isArray,Lu=Array.prototype.indexOf,To=Array.from,co=Object.defineProperty,$i=Object.getOwnPropertyDescriptor,dl=Object.getOwnPropertyDescriptors,$u=Object.prototype,Fu=Array.prototype,Io=Object.getPrototypeOf,ya=Object.isExtensible;function Du(n){return n()}function bs(n){for(var e=0;e<n.length;e++)n[e]()}function Uu(){var n,e,t=new Promise((r,o)=>{n=r,e=o});return{promise:t,resolve:n,reject:e}}const Qt=2,Po=4,xs=8,yi=16,Kn=32,Nr=64,hl=128,an=256,ws=512,xt=1024,ln=2048,hr=4096,yn=8192,bi=16384,Ro=32768,Oo=65536,ba=1<<17,Nu=1<<18,zi=1<<19,fl=1<<20,ho=1<<21,xo=1<<22,Fr=1<<23,ur=Symbol("$state"),Mo=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Bu(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Wu(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Vu(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function qu(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Hu(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function zu(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Gu(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ku(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Yu(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ju(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Ms=1,Ls=2,vl=4,Xu=8,Qu=16,Zu=1,ec=2,Et=Symbol(),tc="http://www.w3.org/1999/xhtml";function nc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let rc=!1;function pl(n){return n===this.v}function gl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function ic(n,e){return n!==e}function _l(n){return!gl(n,this.v)}let Gi=!1,sc=!1;function oc(){Gi=!0}let ht=null;function Es(n){ht=n}function Ki(n,e=!1,t){ht={p:ht,c:null,e:null,s:n,x:null,l:Gi&&!e?{s:null,u:null,$:[]}:null}}function Yi(n){var e=ht,t=e.e;if(t!==null){e.e=null;for(var r of t)Ol(r)}return ht=e.p,{}}function wi(){return!Gi||ht!==null&&ht.l===null}const ac=new WeakMap;function lc(n){var e=Fe;if(e===null)return $e.f|=Fr,n;if((e.f&Ro)===0){if((e.f&hl)===0)throw!e.parent&&n instanceof Error&&ml(n),n;e.b.error(n)}else Lo(n,e)}function Lo(n,e){for(;e!==null;){if((e.f&hl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&ml(n),n}function ml(n){const e=ac.get(n);e&&(co(n,"message",{value:e.message}),co(n,"stack",{value:e.stack}))}let Bi=[],fo=[];function yl(){var n=Bi;Bi=[],bs(n)}function uc(){var n=fo;fo=[],bs(n)}function $o(n){Bi.length===0&&queueMicrotask(yl),Bi.push(n)}function cc(){Bi.length>0&&yl(),fo.length>0&&uc()}function dc(){for(var n=Fe.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&Bu(),n}function $s(n){var e=Qt|ln,t=$e!==null&&($e.f&Qt)!==0?$e:null;return Fe===null||t!==null&&(t.f&an)!==0?e|=an:Fe.f|=zi,{ctx:ht,deps:null,effects:null,equals:pl,f:e,fn:n,reactions:null,rv:0,v:Et,wv:0,parent:t??Fe,ac:null}}function hc(n,e){let t=Fe;t===null&&Vu();var r=t.b,o=void 0,l=Wi(Et),c=null,f=!$e;return Sc(()=>{try{var v=n();c&&Promise.resolve(v).catch(()=>{})}catch(g){v=Promise.reject(g)}var _=()=>v;o=c?.then(_,_)??Promise.resolve(v),c=o;var y=tt,A=r.pending;f&&(r.update_pending_count(1),A||y.increment());const k=(g,T=void 0)=>{c=null,A||y.activate(),T?T!==Mo&&(l.f|=Fr,Vi(l,T)):((l.f&Fr)!==0&&(l.f^=Fr),Vi(l,g)),f&&(r.update_pending_count(-1),A||y.decrement()),Al()};if(o.then(k,g=>k(null,g||"unknown")),y)return()=>{queueMicrotask(()=>y.neuter())}}),new Promise(v=>{function _(y){function A(){y===o?v(l):_(o)}y.then(A,A)}_(o)})}function Or(n){const e=$s(n);return Ul(e),e}function bl(n){const e=$s(n);return e.equals=_l,e}function wl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Gn(e[t])}}function fc(n){for(var e=n.parent;e!==null;){if((e.f&Qt)===0)return e;e=e.parent}return null}function Fo(n){var e,t=Fe;dr(fc(n));try{wl(n),e=Vl(n)}finally{dr(t)}return e}function El(n){var e=Fo(n);if(n.equals(e)||(n.v=e,n.wv=Bl()),!Ei){var t=(lr||(n.f&an)!==0)&&n.deps!==null?hr:xt;Ht(n,t)}}function vc(n,e,t){const r=wi()?$s:bl;if(e.length===0){t(n.map(r));return}var o=tt,l=Fe,c=pc(),f=dc();Promise.all(e.map(v=>hc(v))).then(v=>{o?.activate(),c();try{t([...n.map(r),...v])}catch(_){(l.f&bi)===0&&Lo(_,l)}o?.deactivate(),Al()}).catch(v=>{f.error(v)})}function pc(){var n=Fe,e=$e,t=ht,r=tt;return function(){dr(n),Rn(e),Es(t),r?.activate()}}function Al(){dr(null),Rn(null),Es(null)}const Xs=new Set;let tt=null,_s=null,wa=new Set,As=[];function kl(){const n=As.shift();As.length>0&&queueMicrotask(kl),n()}let Ur=[],Fs=null,vo=!1,ms=!1;class pi{current=new Map;#n=new Map;#t=new Set;#e=0;#r=null;#i=!1;#o=[];#l=[];#a=[];#s=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){Ur=[],_s=null;for(const o of e)this.#v(o);if(this.#o.length===0&&this.#e===0){this.#f();var t=this.#a,r=this.#s;this.#a=[],this.#s=[],this.#u=[],_s=tt,tt=null,Ea(t),Ea(r),tt===null?tt=this:Xs.delete(this),this.#r?.resolve()}else this.#c(this.#a),this.#c(this.#s),this.#c(this.#u);for(const o of this.#o)vi(o);for(const o of this.#l)vi(o);this.#o=[],this.#l=[]}#v(e){e.f^=xt;for(var t=e.first;t!==null;){var r=t.f,o=(r&(Kn|Nr))!==0,l=o&&(r&xt)!==0,c=l||(r&yn)!==0||this.skipped_effects.has(t);if(!c&&t.fn!==null){if(o)t.f^=xt;else if((r&Po)!==0)this.#s.push(t);else if((r&xt)===0)if((r&xo)!==0){var f=t.b?.pending?this.#l:this.#o;f.push(t)}else Bs(t)&&((t.f&yi)!==0&&this.#u.push(t),vi(t));var v=t.first;if(v!==null){t=v;continue}}var _=t.parent;for(t=t.next;t===null&&_!==null;)t=_.next,_=_.parent}}#c(e){for(const t of e)((t.f&ln)!==0?this.#d:this.#h).push(t),Ht(t,xt);e.length=0}capture(e,t){this.#n.has(e)||this.#n.set(e,t),this.current.set(e,e.v)}activate(){tt=this}deactivate(){tt=null,_s=null;for(const e of wa)if(wa.delete(e),e(),tt!==null)break}neuter(){this.#i=!0}flush(){Ur.length>0?jl():this.#f(),tt===this&&(this.#e===0&&Xs.delete(this),this.deactivate())}#f(){if(!this.#i)for(const e of this.#t)e();this.#t.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)Ht(e,ln),gi(e);for(const e of this.#h)Ht(e,hr),gi(e);this.#a=[],this.#s=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#r??=Uu()).promise}static ensure(){if(tt===null){const e=tt=new pi;Xs.add(tt),ms||pi.enqueue(()=>{tt===e&&e.flush()})}return tt}static enqueue(e){As.length===0&&queueMicrotask(kl),As.unshift(e)}}function gc(n){var e=ms;ms=!0;try{for(var t;;){if(cc(),Ur.length===0&&(tt?.flush(),Ur.length===0))return Fs=null,t;jl()}}finally{ms=e}}function jl(){var n=fi;vo=!0;try{var e=0;for(Sa(!0);Ur.length>0;){var t=pi.ensure();if(e++>1e3){var r,o;_c()}t.process(Ur),cr.clear()}}finally{vo=!1,Sa(n),Fs=null}}function _c(){try{Gu()}catch(n){Lo(n,Fs)}}let Mr=null;function Ea(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(bi|yn))===0&&Bs(r)&&(Mr=[],vi(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?$l(r):r.fn=null),Mr?.length>0)){cr.clear();for(const o of Mr)vi(o);Mr=[]}}Mr=null}}function gi(n){for(var e=Fs=n;e.parent!==null;){e=e.parent;var t=e.f;if(vo&&e===Fe&&(t&yi)!==0)return;if((t&(Nr|Kn))!==0){if((t&xt)===0)return;e.f^=xt}}Ur.push(e)}const cr=new Map;function Wi(n,e){var t={f:0,v:n,reactions:null,equals:pl,rv:0,wv:0};return t}function nt(n,e){const t=Wi(n);return Ul(t),t}function mc(n,e=!1,t=!0){const r=Wi(n);return e||(r.equals=_l),Gi&&t&&ht!==null&&ht.l!==null&&(ht.l.s??=[]).push(r),r}function he(n,e,t=!1){$e!==null&&(!In||($e.f&ba)!==0)&&wi()&&($e.f&(Qt|yi|xo|ba))!==0&&!zn?.includes(n)&&Ju();let r=t?Pn(e):e;return Vi(n,r)}function Vi(n,e){if(!n.equals(e)){var t=n.v;Ei?cr.set(n,e):cr.set(n,t),n.v=e;var r=pi.ensure();r.capture(n,t),(n.f&Qt)!==0&&((n.f&ln)!==0&&Fo(n),Ht(n,(n.f&an)===0?xt:hr)),n.wv=Bl(),Sl(n,ln),wi()&&Fe!==null&&(Fe.f&xt)!==0&&(Fe.f&(Kn|Nr))===0&&(on===null?Ic([n]):on.push(n))}return e}function Qs(n){he(n,n.v+1)}function Sl(n,e){var t=n.reactions;if(t!==null)for(var r=wi(),o=t.length,l=0;l<o;l++){var c=t[l],f=c.f;if(!(!r&&c===Fe)){var v=(f&ln)===0;v&&Ht(c,e),(f&Qt)!==0?Sl(c,hr):v&&((f&yi)!==0&&Mr!==null&&Mr.push(c),gi(c))}}}function Pn(n){if(typeof n!="object"||n===null||ur in n)return n;const e=Io(n);if(e!==$u&&e!==Fu)return n;var t=new Map,r=Os(n),o=nt(0),l=Dr,c=f=>{if(Dr===l)return f();var v=$e,_=Dr;Rn(null),Ta(l);var y=f();return Rn(v),Ta(_),y};return r&&t.set("length",nt(n.length)),new Proxy(n,{defineProperty(f,v,_){(!("value"in _)||_.configurable===!1||_.enumerable===!1||_.writable===!1)&&Ku();var y=t.get(v);return y===void 0?y=c(()=>{var A=nt(_.value);return t.set(v,A),A}):he(y,_.value,!0),!0},deleteProperty(f,v){var _=t.get(v);if(_===void 0){if(v in f){const y=c(()=>nt(Et));t.set(v,y),Qs(o)}}else he(_,Et),Qs(o);return!0},get(f,v,_){if(v===ur)return n;var y=t.get(v),A=v in f;if(y===void 0&&(!A||$i(f,v)?.writable)&&(y=c(()=>{var g=Pn(A?f[v]:Et),T=nt(g);return T}),t.set(v,y)),y!==void 0){var k=E(y);return k===Et?void 0:k}return Reflect.get(f,v,_)},getOwnPropertyDescriptor(f,v){var _=Reflect.getOwnPropertyDescriptor(f,v);if(_&&"value"in _){var y=t.get(v);y&&(_.value=E(y))}else if(_===void 0){var A=t.get(v),k=A?.v;if(A!==void 0&&k!==Et)return{enumerable:!0,configurable:!0,value:k,writable:!0}}return _},has(f,v){if(v===ur)return!0;var _=t.get(v),y=_!==void 0&&_.v!==Et||Reflect.has(f,v);if(_!==void 0||Fe!==null&&(!y||$i(f,v)?.writable)){_===void 0&&(_=c(()=>{var k=y?Pn(f[v]):Et,g=nt(k);return g}),t.set(v,_));var A=E(_);if(A===Et)return!1}return y},set(f,v,_,y){var A=t.get(v),k=v in f;if(r&&v==="length")for(var g=_;g<A.v;g+=1){var T=t.get(g+"");T!==void 0?he(T,Et):g in f&&(T=c(()=>nt(Et)),t.set(g+"",T))}if(A===void 0)(!k||$i(f,v)?.writable)&&(A=c(()=>nt(void 0)),he(A,Pn(_)),t.set(v,A));else{k=A.v!==Et;var L=c(()=>Pn(_));he(A,L)}var $=Reflect.getOwnPropertyDescriptor(f,v);if($?.set&&$.set.call(y,_),!k){if(r&&typeof v=="string"){var K=t.get("length"),Y=Number(v);Number.isInteger(Y)&&Y>=K.v&&he(K,Y+1)}Qs(o)}return!0},ownKeys(f){E(o);var v=Reflect.ownKeys(f).filter(A=>{var k=t.get(A);return k===void 0||k.v!==Et});for(var[_,y]of t)y.v!==Et&&!(_ in f)&&v.push(_);return v},setPrototypeOf(){Yu()}})}function Aa(n){try{if(n!==null&&typeof n=="object"&&ur in n)return n[ur]}catch{}return n}function yc(n,e){return Object.is(Aa(n),Aa(e))}var ka,Cl,Tl,Il;function bc(){if(ka===void 0){ka=window,Cl=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Tl=$i(e,"firstChild").get,Il=$i(e,"nextSibling").get,ya(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),ya(t)&&(t.__t=void 0)}}function Br(n=""){return document.createTextNode(n)}function ks(n){return Tl.call(n)}function Ds(n){return Il.call(n)}function F(n,e){return ks(n)}function qt(n,e){{var t=ks(n);return t instanceof Comment&&t.data===""?Ds(t):t}}function B(n,e=1,t=!1){let r=n;for(;e--;)r=Ds(r);return r}function wc(n){n.textContent=""}function Do(){return!1}let ja=!1;function Ec(){ja||(ja=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Us(n){var e=$e,t=Fe;Rn(null),dr(null);try{return n()}finally{Rn(e),dr(t)}}function Uo(n,e,t,r=t){n.addEventListener(e,()=>Us(t));const o=n.__on_r;o?n.__on_r=()=>{o(),r(!0)}:n.__on_r=()=>r(!0),Ec()}function Pl(n){Fe===null&&$e===null&&zu(),$e!==null&&($e.f&an)!==0&&Fe===null&&Hu(),Ei&&qu()}function Ac(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function On(n,e,t,r=!0){var o=Fe;o!==null&&(o.f&yn)!==0&&(n|=yn);var l={ctx:ht,deps:null,nodes_start:null,nodes_end:null,f:n|ln,first:null,fn:e,last:null,next:null,parent:o,b:o&&o.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{vi(l),l.f|=Ro}catch(v){throw Gn(l),v}else e!==null&&gi(l);if(r){var c=l;if(t&&c.deps===null&&c.teardown===null&&c.nodes_start===null&&c.first===c.last&&(c.f&zi)===0&&(c=c.first),c!==null&&(c.parent=o,o!==null&&Ac(c,o),$e!==null&&($e.f&Qt)!==0&&(n&Nr)===0)){var f=$e;(f.effects??=[]).push(c)}}return l}function Rl(n){const e=On(xs,null,!1);return Ht(e,xt),e.teardown=n,e}function js(n){Pl();var e=Fe.f,t=!$e&&(e&Kn)!==0&&(e&Ro)===0;if(t){var r=ht;(r.e??=[]).push(n)}else return Ol(n)}function Ol(n){return On(Po|fl,n,!1)}function kc(n){return Pl(),On(xs|fl,n,!0)}function jc(n){pi.ensure();const e=On(Nr|zi,n,!0);return(t={})=>new Promise(r=>{t.outro?Ns(e,()=>{Gn(e),r(void 0)}):(Gn(e),r(void 0))})}function xl(n){return On(Po,n,!1)}function Sc(n){return On(xo|zi,n,!0)}function No(n,e=0){return On(xs|e,n,!0)}function et(n,e=[],t=[]){vc(e,t,r=>{On(xs,()=>n(...r.map(E)),!0)})}function Bo(n,e=0){var t=On(yi|e,n,!0);return t}function _i(n,e=!0){return On(Kn|zi,n,!0,e)}function Ml(n){var e=n.teardown;if(e!==null){const t=Ei,r=$e;Ca(!0),Rn(null);try{e.call(null)}finally{Ca(t),Rn(r)}}}function Ll(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const o=t.ac;o!==null&&Us(()=>{o.abort(Mo)});var r=t.next;(t.f&Nr)!==0?t.parent=null:Gn(t,e),t=r}}function Cc(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Kn)===0&&Gn(e),e=t}}function Gn(n,e=!0){var t=!1;(e||(n.f&Nu)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(Tc(n.nodes_start,n.nodes_end),t=!0),Ll(n,e&&!t),Ss(n,0),Ht(n,bi);var r=n.transitions;if(r!==null)for(const l of r)l.stop();Ml(n);var o=n.parent;o!==null&&o.first!==null&&$l(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function Tc(n,e){for(;n!==null;){var t=n===e?null:Ds(n);n.remove(),n=t}}function $l(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ns(n,e){var t=[];Wo(n,t,!0),Fl(t,()=>{Gn(n),e&&e()})}function Fl(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var o of n)o.out(r)}else e()}function Wo(n,e,t){if((n.f&yn)===0){if(n.f^=yn,n.transitions!==null)for(const c of n.transitions)(c.is_global||t)&&e.push(c);for(var r=n.first;r!==null;){var o=r.next,l=(r.f&Oo)!==0||(r.f&Kn)!==0;Wo(r,e,l?t:!1),r=o}}}function Vo(n){Dl(n,!0)}function Dl(n,e){if((n.f&yn)!==0){n.f^=yn,(n.f&xt)===0&&(Ht(n,ln),gi(n));for(var t=n.first;t!==null;){var r=t.next,o=(t.f&Oo)!==0||(t.f&Kn)!==0;Dl(t,o?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let fi=!1;function Sa(n){fi=n}let Ei=!1;function Ca(n){Ei=n}let $e=null,In=!1;function Rn(n){$e=n}let Fe=null;function dr(n){Fe=n}let zn=null;function Ul(n){$e!==null&&(zn===null?zn=[n]:zn.push(n))}let Ut=null,Xt=0,on=null;function Ic(n){on=n}let Nl=1,qi=0,Dr=qi;function Ta(n){Dr=n}let lr=!1;function Bl(){return++Nl}function Bs(n){var e=n.f;if((e&ln)!==0)return!0;if((e&hr)!==0){var t=n.deps,r=(e&an)!==0;if(t!==null){var o,l,c=(e&ws)!==0,f=r&&Fe!==null&&!lr,v=t.length;if((c||f)&&(Fe===null||(Fe.f&bi)===0)){var _=n,y=_.parent;for(o=0;o<v;o++)l=t[o],(c||!l?.reactions?.includes(_))&&(l.reactions??=[]).push(_);c&&(_.f^=ws),f&&y!==null&&(y.f&an)===0&&(_.f^=an)}for(o=0;o<v;o++)if(l=t[o],Bs(l)&&El(l),l.wv>n.wv)return!0}(!r||Fe!==null&&!lr)&&Ht(n,xt)}return!1}function Wl(n,e,t=!0){var r=n.reactions;if(r!==null&&!zn?.includes(n))for(var o=0;o<r.length;o++){var l=r[o];(l.f&Qt)!==0?Wl(l,e,!1):e===l&&(t?Ht(l,ln):(l.f&xt)!==0&&Ht(l,hr),gi(l))}}function Vl(n){var e=Ut,t=Xt,r=on,o=$e,l=lr,c=zn,f=ht,v=In,_=Dr,y=n.f;Ut=null,Xt=0,on=null,lr=(y&an)!==0&&(In||!fi||$e===null),$e=(y&(Kn|Nr))===0?n:null,zn=null,Es(n.ctx),In=!1,Dr=++qi,n.ac!==null&&(Us(()=>{n.ac.abort(Mo)}),n.ac=null);try{n.f|=ho;var A=n.fn,k=A(),g=n.deps;if(Ut!==null){var T;if(Ss(n,Xt),g!==null&&Xt>0)for(g.length=Xt+Ut.length,T=0;T<Ut.length;T++)g[Xt+T]=Ut[T];else n.deps=g=Ut;if(!lr||(y&Qt)!==0&&n.reactions!==null)for(T=Xt;T<g.length;T++)(g[T].reactions??=[]).push(n)}else g!==null&&Xt<g.length&&(Ss(n,Xt),g.length=Xt);if(wi()&&on!==null&&!In&&g!==null&&(n.f&(Qt|hr|ln))===0)for(T=0;T<on.length;T++)Wl(on[T],n);return o!==null&&o!==n&&(qi++,on!==null&&(r===null?r=on:r.push(...on))),(n.f&Fr)!==0&&(n.f^=Fr),k}catch(L){return lc(L)}finally{n.f^=ho,Ut=e,Xt=t,on=r,$e=o,lr=l,zn=c,Es(f),In=v,Dr=_}}function Pc(n,e){let t=e.reactions;if(t!==null){var r=Lu.call(t,n);if(r!==-1){var o=t.length-1;o===0?t=e.reactions=null:(t[r]=t[o],t.pop())}}t===null&&(e.f&Qt)!==0&&(Ut===null||!Ut.includes(e))&&(Ht(e,hr),(e.f&(an|ws))===0&&(e.f^=ws),wl(e),Ss(e,0))}function Ss(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Pc(n,t[r])}function vi(n){var e=n.f;if((e&bi)===0){Ht(n,xt);var t=Fe,r=fi;Fe=n,fi=!0;try{(e&yi)!==0?Cc(n):Ll(n),Ml(n);var o=Vl(n);n.teardown=typeof o=="function"?o:null,n.wv=Nl;var l;cl&&sc&&(n.f&ln)!==0&&n.deps}finally{fi=r,Fe=t}}}async function Rc(){await Promise.resolve(),gc()}function E(n){var e=n.f,t=(e&Qt)!==0;if($e!==null&&!In){var r=Fe!==null&&(Fe.f&bi)!==0;if(!r&&!zn?.includes(n)){var o=$e.deps;if(($e.f&ho)!==0)n.rv<qi&&(n.rv=qi,Ut===null&&o!==null&&o[Xt]===n?Xt++:Ut===null?Ut=[n]:(!lr||!Ut.includes(n))&&Ut.push(n));else{($e.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[$e]:l.includes($e)||l.push($e)}}}else if(t&&n.deps===null&&n.effects===null){var c=n,f=c.parent;f!==null&&(f.f&an)===0&&(c.f^=an)}if(Ei){if(cr.has(n))return cr.get(n);if(t){c=n;var v=c.v;return((c.f&xt)===0&&c.reactions!==null||ql(c))&&(v=Fo(c)),cr.set(c,v),v}}else t&&(c=n,Bs(c)&&El(c));if((n.f&Fr)!==0)throw n.v;return n.v}function ql(n){if(n.v===Et)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(cr.has(e)||(e.f&Qt)!==0&&ql(e))return!0;return!1}function Ji(n){var e=In;try{return In=!0,n()}finally{In=e}}const Oc=-7169;function Ht(n,e){n.f=n.f&Oc|e}function xc(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(ur in n)po(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&ur in t&&po(t)}}}function po(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{po(n[r],e)}catch{}const t=Io(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=dl(t);for(let o in r){const l=r[o].get;if(l)try{l.call(n)}catch{}}}}}const Mc=["touchstart","touchmove"];function Lc(n){return Mc.includes(n)}const Hl=new Set,go=new Set;function $c(n,e,t,r={}){function o(l){if(r.capture||Mi.call(e,l),!l.cancelBubble)return Us(()=>t?.call(this,l))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?$o(()=>{e.addEventListener(n,o,r)}):e.addEventListener(n,o,r),o}function Ia(n,e,t,r,o){var l={capture:r,passive:o},c=$c(n,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Rl(()=>{e.removeEventListener(n,c,l)})}function zl(n){for(var e=0;e<n.length;e++)Hl.add(n[e]);for(var t of go)t(n)}let Pa=null;function Mi(n){var e=this,t=e.ownerDocument,r=n.type,o=n.composedPath?.()||[],l=o[0]||n.target;Pa=n;var c=0,f=Pa===n&&n.__root;if(f){var v=o.indexOf(f);if(v!==-1&&(e===document||e===window)){n.__root=e;return}var _=o.indexOf(e);if(_===-1)return;v<=_&&(c=v)}if(l=o[c]||n.target,l!==e){co(n,"currentTarget",{configurable:!0,get(){return l||t}});var y=$e,A=Fe;Rn(null),dr(null);try{for(var k,g=[];l!==null;){var T=l.assignedSlot||l.parentNode||l.host||null;try{var L=l["__"+r];if(L!=null&&(!l.disabled||n.target===l))if(Os(L)){var[$,...K]=L;$.apply(l,[n,...K])}else L.call(l,n)}catch(Y){k?g.push(Y):k=Y}if(n.cancelBubble||T===e||T===null)break;l=T}if(k){for(let Y of g)queueMicrotask(()=>{throw Y});throw k}}finally{n.__root=e,delete n.currentTarget,Rn(y),dr(A)}}}function Fc(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Cs(n,e){var t=Fe;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function _e(n,e){var t=(e&Zu)!==0,r=(e&ec)!==0,o,l=!n.startsWith("<!>");return()=>{o===void 0&&(o=Fc(l?n:"<!>"+n),t||(o=ks(o)));var c=r||Cl?document.importNode(o,!0):o.cloneNode(!0);if(t){var f=ks(c),v=c.lastChild;Cs(f,v)}else Cs(c,c);return c}}function Zs(n=""){{var e=Br(n+"");return Cs(e,e),e}}function mn(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Br();return n.append(e,t),Cs(e,t),n}function oe(n,e){n!==null&&n.before(e)}function ze(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Dc(n,e){return Uc(n,e)}const Zr=new Map;function Uc(n,{target:e,anchor:t,props:r={},events:o,context:l,intro:c=!0}){bc();var f=new Set,v=A=>{for(var k=0;k<A.length;k++){var g=A[k];if(!f.has(g)){f.add(g);var T=Lc(g);e.addEventListener(g,Mi,{passive:T});var L=Zr.get(g);L===void 0?(document.addEventListener(g,Mi,{passive:T}),Zr.set(g,1)):Zr.set(g,L+1)}}};v(To(Hl)),go.add(v);var _=void 0,y=jc(()=>{var A=t??e.appendChild(Br());return _i(()=>{if(l){Ki({});var k=ht;k.c=l}o&&(r.$$events=o),_=n(A,r)||{},l&&Yi()}),()=>{for(var k of f){e.removeEventListener(k,Mi);var g=Zr.get(k);--g===0?(document.removeEventListener(k,Mi),Zr.delete(k)):Zr.set(k,g)}go.delete(v),A!==t&&A.parentNode?.removeChild(A)}});return Nc.set(_,y),_}let Nc=new WeakMap;function Ye(n,e,t=!1){var r=n,o=null,l=null,c=Et,f=t?Oo:0,v=!1;const _=(g,T=!0)=>{v=!0,k(T,g)};var y=null;function A(){y!==null&&(y.lastChild.remove(),r.before(y),y=null);var g=c?o:l,T=c?l:o;g&&Vo(g),T&&Ns(T,()=>{c?l=null:o=null})}const k=(g,T)=>{if(c!==(c=g)){var L=Do(),$=r;if(L&&(y=document.createDocumentFragment(),y.append($=Br())),c?o??=T&&_i(()=>T($)):l??=T&&_i(()=>T($)),L){var K=tt,Y=c?o:l,q=c?l:o;Y&&K.skipped_effects.delete(Y),q&&K.skipped_effects.add(q),K.add_callback(A)}else A()}};Bo(()=>{v=!1,e(_),v||k(null,null)},f)}function Ra(n,e,t){var r=n,o=Et,l,c,f=null,v=wi()?ic:gl;function _(){l&&Ns(l),f!==null&&(f.lastChild.remove(),r.before(f),f=null),l=c}Bo(()=>{if(v(o,o=e())){var y=r,A=Do();A&&(f=document.createDocumentFragment(),f.append(y=Br())),c=_i(()=>t(y)),A?tt.add_callback(_):_()}})}function Jt(n,e){return e}function Bc(n,e,t){for(var r=n.items,o=[],l=e.length,c=0;c<l;c++)Wo(e[c].e,o,!0);var f=l>0&&o.length===0&&t!==null;if(f){var v=t.parentNode;wc(v),v.append(t),r.clear(),Cn(n,e[0].prev,e[l-1].next)}Fl(o,()=>{for(var _=0;_<l;_++){var y=e[_];f||(r.delete(y.k),Cn(n,y.prev,y.next)),Gn(y.e,!f)}})}function jt(n,e,t,r,o,l=null){var c=n,f={flags:e,items:new Map,first:null},v=(e&vl)!==0;if(v){var _=n;c=_.appendChild(Br())}var y=null,A=!1,k=new Map,g=bl(()=>{var K=t();return Os(K)?K:K==null?[]:To(K)}),T,L;function $(){Wc(L,T,f,k,c,o,e,r,t),l!==null&&(T.length===0?y?Vo(y):y=_i(()=>l(c)):y!==null&&Ns(y,()=>{y=null}))}Bo(()=>{L??=Fe,T=E(g);var K=T.length;if(!(A&&K===0)){A=K===0;var Y,q,J,X;if(Do()){var R=new Set,M=tt;for(q=0;q<K;q+=1){J=T[q],X=r(J,q);var ae=f.items.get(X)??k.get(X);ae?(e&(Ms|Ls))!==0&&Gl(ae,J,q,e):(Y=Kl(null,f,null,null,J,X,q,o,e,t,!0),k.set(X,Y)),R.add(X)}for(const[de,fe]of f.items)R.has(de)||M.skipped_effects.add(fe.e);M.add_callback($)}else $();E(g)}})}function Wc(n,e,t,r,o,l,c,f,v){var _=(c&Xu)!==0,y=(c&(Ms|Ls))!==0,A=e.length,k=t.items,g=t.first,T=g,L,$=null,K,Y=[],q=[],J,X,R,M;if(_)for(M=0;M<A;M+=1)J=e[M],X=f(J,M),R=k.get(X),R!==void 0&&(R.a?.measure(),(K??=new Set).add(R));for(M=0;M<A;M+=1){if(J=e[M],X=f(J,M),R=k.get(X),R===void 0){var ae=r.get(X);if(ae!==void 0){r.delete(X),k.set(X,ae);var de=$?$.next:T;Cn(t,$,ae),Cn(t,ae,de),eo(ae,de,o),$=ae}else{var fe=T?T.e.nodes_start:o;$=Kl(fe,t,$,$===null?t.first:$.next,J,X,M,l,c,v)}k.set(X,$),Y=[],q=[],T=$.next;continue}if(y&&Gl(R,J,M,c),(R.e.f&yn)!==0&&(Vo(R.e),_&&(R.a?.unfix(),(K??=new Set).delete(R))),R!==T){if(L!==void 0&&L.has(R)){if(Y.length<q.length){var Z=q[0],pe;$=Z.prev;var Ve=Y[0],ot=Y[Y.length-1];for(pe=0;pe<Y.length;pe+=1)eo(Y[pe],Z,o);for(pe=0;pe<q.length;pe+=1)L.delete(q[pe]);Cn(t,Ve.prev,ot.next),Cn(t,$,Ve),Cn(t,ot,Z),T=Z,$=ot,M-=1,Y=[],q=[]}else L.delete(R),eo(R,T,o),Cn(t,R.prev,R.next),Cn(t,R,$===null?t.first:$.next),Cn(t,$,R),$=R;continue}for(Y=[],q=[];T!==null&&T.k!==X;)(T.e.f&yn)===0&&(L??=new Set).add(T),q.push(T),T=T.next;if(T===null)continue;R=T}Y.push(R),$=R,T=R.next}if(T!==null||L!==void 0){for(var Je=L===void 0?[]:To(L);T!==null;)(T.e.f&yn)===0&&Je.push(T),T=T.next;var St=Je.length;if(St>0){var Ce=(c&vl)!==0&&A===0?o:null;if(_){for(M=0;M<St;M+=1)Je[M].a?.measure();for(M=0;M<St;M+=1)Je[M].a?.fix()}Bc(t,Je,Ce)}}_&&$o(()=>{if(K!==void 0)for(R of K)R.a?.apply()}),n.first=t.first&&t.first.e,n.last=$&&$.e;for(var zt of r.values())Gn(zt.e);r.clear()}function Gl(n,e,t,r){(r&Ms)!==0&&Vi(n.v,e),(r&Ls)!==0?Vi(n.i,t):n.i=t}function Kl(n,e,t,r,o,l,c,f,v,_,y){var A=(v&Ms)!==0,k=(v&Qu)===0,g=A?k?mc(o,!1,!1):Wi(o):o,T=(v&Ls)===0?c:Wi(c),L={i:T,v:g,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var $=document.createDocumentFragment();$.append(n=Br())}return L.e=_i(()=>f(n,g,T,_),rc),L.e.prev=t&&t.e,L.e.next=r&&r.e,t===null?y||(e.first=L):(t.next=L,t.e.next=L.e),r!==null&&(r.prev=L,r.e.prev=L.e),L}finally{}}function eo(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,o=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var c=Ds(l);o.before(l),l=c}}function Cn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Vc(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function ei(n,e,t,r,o,l){var c=n.__className;if(c!==t||c===void 0){var f=Vc(t,r);f==null?n.removeAttribute("class"):n.className=f,n.__className=t}return l}function Yl(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Os(e))return nc();for(var r of n.options)r.selected=e.includes(Fi(r));return}for(r of n.options){var o=Fi(r);if(yc(o,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function qc(n){var e=new MutationObserver(()=>{Yl(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Rl(()=>{e.disconnect()})}function rr(n,e,t=e){var r=!0;Uo(n,"change",o=>{var l=o?"[selected]":":checked",c;if(n.multiple)c=[].map.call(n.querySelectorAll(l),Fi);else{var f=n.querySelector(l)??n.querySelector("option:not([disabled])");c=f&&Fi(f)}t(c)}),xl(()=>{var o=e();if(Yl(n,o,r),r&&o===void 0){var l=n.querySelector(":checked");l!==null&&(o=Fi(l),t(o))}n.__value=o,r=!1}),qc(n)}function Fi(n){return"__value"in n?n.__value:n.value}const Hc=Symbol("is custom element"),zc=Symbol("is html");function Oa(n,e,t,r){var o=Gc(n);o[e]!==(o[e]=t)&&(t==null?n.removeAttribute(e):typeof t!="string"&&Kc(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Gc(n){return n.__attributes??={[Hc]:n.nodeName.includes("-"),[zc]:n.namespaceURI===tc}}var xa=new Map;function Kc(n){var e=n.getAttribute("is")||n.nodeName,t=xa.get(e);if(t)return t;xa.set(e,t=[]);for(var r,o=n,l=Element.prototype;l!==o;){r=dl(o);for(var c in r)r[c].set&&t.push(c);o=Io(o)}return t}function Sn(n,e,t=e){var r=new WeakSet;Uo(n,"input",async o=>{var l=o?n.defaultValue:n.value;if(l=to(n)?no(l):l,t(l),tt!==null&&r.add(tt),await Rc(),l!==(l=e())){var c=n.selectionStart,f=n.selectionEnd;n.value=l??"",f!==null&&(n.selectionStart=c,n.selectionEnd=Math.min(f,n.value.length))}}),Ji(e)==null&&n.value&&(t(to(n)?no(n.value):n.value),tt!==null&&r.add(tt)),No(()=>{var o=e();if(n===document.activeElement){var l=_s??tt;if(r.has(l))return}to(n)&&o===no(n.value)||n.type==="date"&&!o&&!n.value||o!==n.value&&(n.value=o??"")})}function Ma(n,e,t=e){Uo(n,"change",r=>{var o=r?n.defaultChecked:n.checked;t(o)}),Ji(e)==null&&t(n.checked),No(()=>{var r=e();n.checked=!!r})}function to(n){var e=n.type;return e==="number"||e==="range"}function no(n){return n===""?null:+n}function La(n,e){return n===e||n?.[ur]===e}function Yc(n={},e,t,r){return xl(()=>{var o,l;return No(()=>{o=l,l=[],Ji(()=>{n!==t(...l)&&(e(n,...l),o&&La(t(...o),n)&&e(null,...o))})}),()=>{$o(()=>{l&&La(t(...l),n)&&e(null,...l)})}}),n}function Jc(n=!1){const e=ht,t=e.l.u;if(!t)return;let r=()=>xc(e.s);if(n){let o=0,l={};const c=$s(()=>{let f=!1;const v=e.s;for(const _ in v)v[_]!==l[_]&&(l[_]=v[_],f=!0);return f&&o++,o});r=()=>E(c)}t.b.length&&kc(()=>{$a(e,r),bs(t.b)}),js(()=>{const o=Ji(()=>t.m.map(Du));return()=>{for(const l of o)typeof l=="function"&&l()}}),t.a.length&&js(()=>{$a(e,r),bs(t.a)})}function $a(n,e){if(n.l.s)for(const t of n.l.s)E(t);e()}function qo(n){ht===null&&Wu(),Gi&&ht.l!==null?Xc(ht).m.push(n):js(()=>{const e=Ji(n);if(typeof e=="function")return e})}function Xc(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Qc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Qc);oc();class Zc{#n=nt(Pn({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return E(this.#n)}set player(e){he(this.#n,e,!0)}#t=nt(null);get storyData(){return E(this.#t)}set storyData(e){he(this.#t,e,!0)}#e=nt("0");get currentDialogueId(){return E(this.#e)}set currentDialogueId(e){he(this.#e,e,!0)}#r=nt(!0);get isLoading(){return E(this.#r)}set isLoading(e){he(this.#r,e,!0)}#i=nt("");get error(){return E(this.#i)}set error(e){he(this.#i,e,!0)}async loadStory(e){this.isLoading=!0;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.storyData=await t.json(),this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){this.error="Ошибка загрузки: "+t.message,console.error(t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}runActions(e){e&&e.forEach(t=>{t.type==="add_item"&&t.id&&this.addItem(t.id),t.type==="stat_change"&&t.stat&&t.value!==void 0&&(this.player.stats[t.stat]+=t.value)})}goToDialogue(e){this.currentDialogueId=e}}const Vt=new Zc;function ed(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function td(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),t}var ys={exports:{}},nd=ys.exports,Fa;function rd(){return Fa||(Fa=1,(function(n,e){(function(r,o){n.exports=o()})(nd,()=>(()=>{var t=[,((c,f,v)=>{v.r(f),v.d(f,{default:()=>y});var _=(()=>{var A=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(k={}){var g=k,T,L;g.ready=new Promise((i,s)=>{T=i,L=s});function $(){function i(j){const P=h;u=s=0,h=new Map,P.forEach(O=>{try{O(j)}catch(I){console.error(I)}}),this.pb(),m&&m.Tb()}let s=0,u=0,h=new Map,m=null,w=null;this.requestAnimationFrame=function(j){s||(s=requestAnimationFrame(i.bind(this)));const P=++u;return h.set(P,j),P},this.cancelAnimationFrame=function(j){h.delete(j),s&&h.size==0&&(cancelAnimationFrame(s),s=0)},this.Rb=function(j){w&&(document.body.remove(w),w=null),j||(w=document.createElement("div"),w.style.backgroundColor="black",w.style.position="fixed",w.style.right=0,w.style.top=0,w.style.color="white",w.style.padding="4px",w.innerHTML="RIVE FPS",j=function(P){w.innerHTML="RIVE FPS "+P.toFixed(1)},document.body.appendChild(w)),m=new function(){let P=0,O=0;this.Tb=function(){var I=performance.now();O?(++P,I-=O,1e3<I&&(j(1e3*P/I),P=O=0)):(O=I,P=0)}}},this.Ob=function(){w&&(document.body.remove(w),w=null),m=null},this.pb=function(){}}function K(i){console.assert(!0);const s=new Map;let u=-1/0;this.push=function(h){return h=h+((1<<i)-1)>>i,s.has(h)&&clearTimeout(s.get(h)),s.set(h,setTimeout(function(){s.delete(h),s.length==0?u=-1/0:h==u&&(u=Math.max(...s.keys()),console.assert(u<h))},1e3)),u=Math.max(h,u),u<<i}}const Y=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){Y&&Y();let i=g.decodeAudio;g.decodeAudio=function(m,w){m=i(m),w(m)};let s=g.decodeFont;g.decodeFont=function(m,w){m=s(m),w(m)};const u=g.FileAssetLoader;g.ptrToAsset=m=>{let w=g.ptrToFileAsset(m);return w.isImage?g.ptrToImageAsset(m):w.isFont?g.ptrToFontAsset(m):w.isAudio?g.ptrToAudioAsset(m):w},g.CustomFileAssetLoader=u.extend("CustomFileAssetLoader",{__construct:function({loadContents:m}){this.__parent.__construct.call(this),this.Gb=m},loadContents:function(m,w){return m=g.ptrToAsset(m),this.Gb(m,w)}}),g.CDNFileAssetLoader=u.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(m){let w=g.ptrToAsset(m);return m=w.cdnUuid,m===""?!1:((function(j,P){var O=new XMLHttpRequest;O.responseType="arraybuffer",O.onreadystatechange=function(){O.readyState==4&&O.status==200&&P(O)},O.open("GET",j,!0),O.send(null)})(w.cdnBaseUrl+"/"+m,j=>{w.decode(new Uint8Array(j.response))}),!0)}}),g.FallbackFileAssetLoader=u.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(m){this.lb.push(m)},loadContents:function(m,w){for(let j of this.lb)if(j.loadContents(m,w))return!0;return!1}});let h=g.computeAlignment;g.computeAlignment=function(m,w,j,P,O=1){return h.call(this,m,w,j,P,O)}};const q="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),J=new function(){function i(){if(!s){let be=function(je,Q,Ze){if(Q=W.createShader(Q),W.shaderSource(Q,Ze),W.compileShader(Q),Ze=W.getShaderInfoLog(Q),0<(Ze||"").length)throw Ze;W.attachShader(je,Q)};var S=document.createElement("canvas"),V={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let W;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(W=S.getContext("webgl",V),u=1,!W)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(W=S.getContext("webgl2",V))u=2;else if(W=S.getContext("webgl",V))u=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(W=new Proxy(W,{get(je,Q){if(je.isContextLost()){if(O||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Q),O=!0),typeof je[Q]=="function")return function(){}}else return typeof je[Q]=="function"?function(...Ze){return je[Q].apply(je,Ze)}:je[Q]},set(je,Q,Ze){if(je.isContextLost())O||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Q),O=!0);else return je[Q]=Ze,!0}}),h=Math.min(W.getParameter(W.MAX_RENDERBUFFER_SIZE),W.getParameter(W.MAX_TEXTURE_SIZE)),S=W.createProgram(),be(S,W.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),be(S,W.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),W.bindAttribLocation(S,0,"vertex"),W.bindAttribLocation(S,1,"uv"),W.linkProgram(S),V=W.getProgramInfoLog(S),0<(V||"").trim().length)throw V;m=W.getUniformLocation(S,"mat"),w=W.getUniformLocation(S,"translate"),W.useProgram(S),W.bindBuffer(W.ARRAY_BUFFER,W.createBuffer()),W.enableVertexAttribArray(0),W.enableVertexAttribArray(1),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,W.createBuffer()),W.uniform1i(W.getUniformLocation(S,"image"),0),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s=W}return!0}let s=null,u=0,h=0,m=null,w=null,j=0,P=0,O=!1;i(),this.hc=function(){return i(),h},this.Mb=function(S){s.deleteTexture&&s.deleteTexture(S)},this.Lb=function(S){if(!i())return null;const V=s.createTexture();return V?(s.bindTexture(s.TEXTURE_2D,V),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,S),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),u==2?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),V):null};const I=new K(8),H=new K(8),G=new K(10),ne=new K(10);this.Qb=function(S,V,W,be,je){if(i()){var Q=I.push(S),Ze=H.push(V);if(s.canvas){(s.canvas.width!=Q||s.canvas.height!=Ze)&&(s.canvas.width=Q,s.canvas.height=Ze),s.viewport(0,Ze-V,S,V),s.disable(s.SCISSOR_TEST),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.enable(s.SCISSOR_TEST),W.sort((xe,jn)=>jn.xb-xe.xb),Q=G.push(be),j!=Q&&(s.bufferData(s.ARRAY_BUFFER,8*Q,s.DYNAMIC_DRAW),j=Q),Q=0;for(var kt of W)s.bufferSubData(s.ARRAY_BUFFER,Q,kt.Ua),Q+=4*kt.Ua.length;console.assert(Q==4*be);for(var kn of W)s.bufferSubData(s.ARRAY_BUFFER,Q,kn.Db),Q+=4*kn.Db.length;console.assert(Q==8*be),Q=ne.push(je),P!=Q&&(s.bufferData(s.ELEMENT_ARRAY_BUFFER,2*Q,s.DYNAMIC_DRAW),P=Q),kt=0;for(var Cr of W)s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,kt,Cr.indices),kt+=2*Cr.indices.length;console.assert(kt==2*je),Cr=0,kn=!0,Q=kt=0;for(const xe of W){xe.image.Ka!=Cr&&(s.bindTexture(s.TEXTURE_2D,xe.image.Ja||null),Cr=xe.image.Ka),xe.mc?(s.scissor(xe.Za,Ze-xe.$a-xe.kb,xe.Ac,xe.kb),kn=!0):kn&&(s.scissor(0,Ze-V,S,V),kn=!1),W=2/S;const jn=-2/V;s.uniform4f(m,xe.ha[0]*W*xe.Ba,xe.ha[1]*jn*xe.Ca,xe.ha[2]*W*xe.Ba,xe.ha[3]*jn*xe.Ca),s.uniform2f(w,xe.ha[4]*W*xe.Ba+W*(xe.Za-xe.ic*xe.Ba)-1,xe.ha[5]*jn*xe.Ca+jn*(xe.$a-xe.jc*xe.Ca)+1),s.vertexAttribPointer(0,2,s.FLOAT,!1,0,Q),s.vertexAttribPointer(1,2,s.FLOAT,!1,0,Q+4*be),s.drawElements(s.TRIANGLES,xe.indices.length,s.UNSIGNED_SHORT,kt),Q+=4*xe.Ua.length,kt+=2*xe.indices.length}console.assert(Q==4*be),console.assert(kt==2*je)}}},this.canvas=function(){return i()&&s.canvas}},X=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(N){switch(N){case I.srcOver:return"source-over";case I.screen:return"screen";case I.overlay:return"overlay";case I.darken:return"darken";case I.lighten:return"lighten";case I.colorDodge:return"color-dodge";case I.colorBurn:return"color-burn";case I.hardLight:return"hard-light";case I.softLight:return"soft-light";case I.difference:return"difference";case I.exclusion:return"exclusion";case I.multiply:return"multiply";case I.hue:return"hue";case I.saturation:return"saturation";case I.color:return"color";case I.luminosity:return"luminosity"}}function s(N){return"rgba("+((16711680&N)>>>16)+","+((65280&N)>>>8)+","+((255&N)>>>0)+","+((4278190080&N)>>>24)/255+")"}function u(){0<Ze.length&&(J.Qb(Q.drawWidth(),Q.drawHeight(),Ze,kt,kn),Ze=[],kn=kt=0,Q.reset(512,512));for(const N of je){for(const te of N.H)te();N.H=[]}je.clear()}X&&X();var h=g.RenderPaintStyle;const m=g.RenderPath,w=g.RenderPaint,j=g.Renderer,P=g.StrokeCap,O=g.StrokeJoin,I=g.BlendMode,H=h.fill,G=h.stroke,ne=g.FillRule.evenOdd;let S=1;var V=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:N,xa:te}={}){this.__parent.__construct.call(this),this.Ka=S,S=S+1&2147483647||1,this.la=N,this.xa=te},__destruct:function(){this.Ja&&(J.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(N){var te=this;te.xa&&te.xa(te);var Ie=new Image;te.Xa=URL.createObjectURL(new Blob([N],{type:"image/png"})),Ie.onload=function(){te.Fb=Ie,te.Ja=J.Lb(Ie),te.size(Ie.width,Ie.height),te.la&&te.la(te)},Ie.src=te.Xa}}),W=m.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(N,te,Ie,Me,we,Oe,We){var He=this.T,pn=He.addPath;N=N.T;const yt=new DOMMatrix;yt.a=te,yt.b=Ie,yt.c=Me,yt.d=we,yt.e=Oe,yt.f=We,pn.call(He,N,yt)},fillRule:function(N){this.Wa=N},moveTo:function(N,te){this.T.moveTo(N,te)},lineTo:function(N,te){this.T.lineTo(N,te)},cubicTo:function(N,te,Ie,Me,we,Oe){this.T.bezierCurveTo(N,te,Ie,Me,we,Oe)},close:function(){this.T.closePath()}}),be=w.extend("CanvasRenderPaint",{color:function(N){this.Ya=s(N)},thickness:function(N){this.Ib=N},join:function(N){switch(N){case O.miter:this.Ia="miter";break;case O.round:this.Ia="round";break;case O.bevel:this.Ia="bevel"}},cap:function(N){switch(N){case P.butt:this.Ha="butt";break;case P.round:this.Ha="round";break;case P.square:this.Ha="square"}},style:function(N){this.Hb=N},blendMode:function(N){this.Eb=i(N)},clearGradient:function(){this.ja=null},linearGradient:function(N,te,Ie,Me){this.ja={zb:N,Ab:te,cb:Ie,eb:Me,Ra:[]}},radialGradient:function(N,te,Ie,Me){this.ja={zb:N,Ab:te,cb:Ie,eb:Me,Ra:[],ec:!0}},addStop:function(N,te){this.ja.Ra.push({color:N,stop:te})},completeGradient:function(){},draw:function(N,te,Ie){let Me=this.Hb;var we=this.Ya,Oe=this.ja;if(N.globalCompositeOperation=this.Eb,Oe!=null){we=Oe.zb;var We=Oe.Ab;const pn=Oe.cb;var He=Oe.eb;const yt=Oe.Ra;Oe.ec?(Oe=pn-we,He-=We,we=N.createRadialGradient(we,We,0,we,We,Math.sqrt(Oe*Oe+He*He))):we=N.createLinearGradient(we,We,pn,He);for(let sn=0,bt=yt.length;sn<bt;sn++)We=yt[sn],we.addColorStop(We.stop,s(We.color));this.Ya=we,this.ja=null}switch(Me){case G:N.strokeStyle=we,N.lineWidth=this.Ib,N.lineCap=this.Ha,N.lineJoin=this.Ia,N.stroke(te);break;case H:N.fillStyle=we,N.fill(te,Ie)}}});const je=new Set;let Q=null,Ze=[],kt=0,kn=0;var Cr=g.CanvasRenderer=j.extend("Renderer",{__construct:function(N){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=N.getContext("2d"),this.Va=N,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const N=this.S.length-6;if(6>N)throw"restore() called without matching save().";this.S.splice(N),this.H.push(this.C.restore.bind(this.C))},transform:function(N,te,Ie,Me,we,Oe){const We=this.S,He=We.length-6;We.splice(He,6,We[He]*N+We[He+2]*te,We[He+1]*N+We[He+3]*te,We[He]*Ie+We[He+2]*Me,We[He+1]*Ie+We[He+3]*Me,We[He]*we+We[He+2]*Oe+We[He+4],We[He+1]*we+We[He+3]*Oe+We[He+5]),this.H.push(this.C.transform.bind(this.C,N,te,Ie,Me,we,Oe))},rotate:function(N){const te=Math.sin(N);N=Math.cos(N),this.transform(N,te,-te,N,0,0)},_drawPath:function(N,te){this.H.push(te.draw.bind(te,this.C,N.T,N.Wa===ne?"evenodd":"nonzero"))},_drawRiveImage:function(N,te,Ie,Me){var we=N.Fb;if(we){var Oe=this.C,We=i(Ie);this.H.push(function(){Oe.globalCompositeOperation=We,Oe.globalAlpha=Me,Oe.drawImage(we,0,0),Oe.globalAlpha=1})}},_getMatrix:function(N){const te=this.S,Ie=te.length-6;for(let Me=0;6>Me;++Me)N[Me]=te[Ie+Me]},_drawImageMesh:function(N,te,Ie,Me,we,Oe,We,He,pn,yt,sn){te=this.C.canvas.width;var bt=this.C.canvas.height;const va=yt-He,pa=sn-pn;He=Math.max(He,0),pn=Math.max(pn,0),yt=Math.min(yt,te),sn=Math.min(sn,bt);const Oi=yt-He,xi=sn-pn;if(console.assert(Oi<=Math.min(va,te)),console.assert(xi<=Math.min(pa,bt)),!(0>=Oi||0>=xi)){yt=Oi<va||xi<pa,te=sn=1;var Tr=Math.ceil(Oi*sn),Ir=Math.ceil(xi*te);bt=J.hc(),Tr>bt&&(sn*=bt/Tr,Tr=bt),Ir>bt&&(te*=bt/Ir,Ir=bt),Q||(Q=new g.DynamicRectanizer(bt),Q.reset(512,512)),bt=Q.addRect(Tr,Ir),0>bt&&(u(),je.add(this),bt=Q.addRect(Tr,Ir),console.assert(0<=bt));var ga=bt&65535,_a=bt>>16;Ze.push({ha:this.S.slice(this.S.length-6),image:N,Za:ga,$a:_a,ic:He,jc:pn,Ac:Tr,kb:Ir,Ba:sn,Ca:te,Ua:new Float32Array(we),Db:new Float32Array(Oe),indices:new Uint16Array(We),mc:yt,xb:N.Ka<<1|(yt?1:0)}),kt+=we.length,kn+=We.length;var Qr=this.C,Mu=i(Ie);this.H.push(function(){Qr.save(),Qr.resetTransform(),Qr.globalCompositeOperation=Mu,Qr.globalAlpha=Me;const ma=J.canvas();ma&&Qr.drawImage(ma,ga,_a,Tr,Ir,He,pn,Oi,xi),Qr.restore()})}},_clipPath:function(N){this.H.push(this.C.clip.bind(this.C,N.T,N.Wa===ne?"evenodd":"nonzero"))},clear:function(){je.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(N,te){this.transform(1,0,0,1,N,te)}});g.makeRenderer=function(N){const te=new Cr(N),Ie=te.C;return new Proxy(te,{get(Me,we){if(typeof Me[we]=="function")return function(...Oe){return Me[we].apply(Me,Oe)};if(typeof Ie[we]=="function"){if(-1<q.indexOf(we))throw Error("RiveException: Method call to '"+we+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Oe){te.H.push(Ie[we].bind(Ie,...Oe))}}return Me[we]},set(Me,we,Oe){if(we in Ie)return te.H.push(()=>{Ie[we]=Oe}),!0}})},g.decodeImage=function(N,te){new V({la:te}).decode(N)},g.renderFactory={makeRenderPaint:function(){return new be},makeRenderPath:function(){return new W},makeRenderImage:function(){let N=jn;return new V({xa:()=>{N.total++},la:()=>{if(N.loaded++,N.loaded===N.total){const te=N.ready;te&&(te(),N.ready=null)}}})}};let xe=g.load,jn=null;g.load=function(N,te,Ie=!0){const Me=new g.FallbackFileAssetLoader;return te!==void 0&&Me.addLoader(te),Ie&&(te=new g.CDNFileAssetLoader,Me.addLoader(te)),new Promise(function(we){let Oe=null;jn={total:0,loaded:0,ready:function(){we(Oe)}},Oe=xe(N,Me),jn.total==0&&we(Oe)})};let xu=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(N,te,Ie,Me,we=1){xu.call(this,N,te,Ie,Me,we)},h=new $,g.requestAnimationFrame=h.requestAnimationFrame.bind(h),g.cancelAnimationFrame=h.cancelAnimationFrame.bind(h),g.enableFPSCounter=h.Rb.bind(h),g.disableFPSCounter=h.Ob,h.pb=u,g.resolveAnimationFrame=u,g.cleanup=function(){Q&&Q.delete()}};var R=Object.assign({},g),M="./this.program",ae=typeof window=="object",de=typeof importScripts=="function",fe="",Z,pe;(ae||de)&&(de?fe=self.location.href:typeof document<"u"&&document.currentScript&&(fe=document.currentScript.src),A&&(fe=A),fe.indexOf("blob:")!==0?fe=fe.substr(0,fe.replace(/[?#].*/,"").lastIndexOf("/")+1):fe="",de&&(pe=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Z=(i,s,u)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?s(h.response):u()},h.onerror=u,h.send(null)});var Ve=g.print||console.log.bind(console),ot=g.printErr||console.error.bind(console);Object.assign(g,R),R=null,g.thisProgram&&(M=g.thisProgram);var Je;g.wasmBinary&&(Je=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&wn("no native wasm support detected");var St,Ce,zt=!1,ut,Xe,ft,Gt,Se,Pe,Nt,qe;function Mt(){var i=St.buffer;g.HEAP8=ut=new Int8Array(i),g.HEAP16=ft=new Int16Array(i),g.HEAP32=Se=new Int32Array(i),g.HEAPU8=Xe=new Uint8Array(i),g.HEAPU16=Gt=new Uint16Array(i),g.HEAPU32=Pe=new Uint32Array(i),g.HEAPF32=Nt=new Float32Array(i),g.HEAPF64=qe=new Float64Array(i)}var rt,Zt=[],un=[],cn=[];function bn(){var i=g.preRun.shift();Zt.unshift(i)}var Ct=0,Kt=null;function wn(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",ot(i),zt=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),L(i),i}function vr(i){return i.startsWith("data:application/octet-stream;base64,")}var en;if(en="canvas_advanced.wasm",!vr(en)){var pr=en;en=g.locateFile?g.locateFile(pr,fe):fe+pr}function At(i){if(i==en&&Je)return new Uint8Array(Je);if(pe)return pe(i);throw"both async and sync fetching of the wasm failed"}function Vr(i){if(!Je&&(ae||de)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw"failed to load wasm binary file at '"+i+"'";return s.arrayBuffer()}).catch(()=>At(i));if(Z)return new Promise((s,u)=>{Z(i,h=>s(new Uint8Array(h)),u)})}return Promise.resolve().then(()=>At(i))}function qr(i,s,u){return Vr(i).then(h=>WebAssembly.instantiate(h,s)).then(h=>h).then(u,h=>{ot("failed to asynchronously prepare wasm: "+h),wn(h)})}function ki(i,s){var u=en;return Je||typeof WebAssembly.instantiateStreaming!="function"||vr(u)||u.startsWith("file://")||typeof fetch!="function"?qr(u,i,s):fetch(u,{credentials:"same-origin"}).then(h=>WebAssembly.instantiateStreaming(h,i).then(s,function(m){return ot("wasm streaming compile failed: "+m),ot("falling back to ArrayBuffer instantiation"),qr(u,i,s)}))}var En,p,a={460492:(i,s,u,h,m)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=s,window.h.I.La=u,window.h.ga={},window.h.ga.stopped=h,window.h.ga.yb=m;let w=window.h;w.D=[],w.yc=function(j){for(var P=0;P<w.D.length;++P)if(w.D[P]==null)return w.D[P]=j,P;return w.D.push(j),w.D.length-1},w.Cb=function(j){for(w.D[j]=null;0<w.D.length&&w.D[w.D.length-1]==null;)w.D.pop()},w.Sc=function(j){for(var P=0;P<w.D.length;++P)if(w.D[P]==j)return w.Cb(P)},w.ra=function(j){return w.D[j]},w.Ta=["touchend","click"],w.unlock=function(){for(var j=0;j<w.D.length;++j){var P=w.D[j];P!=null&&P.J!=null&&P.state===w.ga.yb&&P.J.resume().then(()=>{ua(P.qb)},O=>{console.error("Failed to resume audiocontext",O)})}w.Ta.map(function(O){document.removeEventListener(O,w.unlock,!0)})},w.Ta.map(function(j){document.addEventListener(j,w.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),s=i.sampleRate;return i.close(),s}catch{return 0}},463249:(i,s,u,h,m,w)=>{if(typeof window.h>"u")return-1;var j={},P={};return i==window.h.I.ya&&u!=0&&(P.sampleRate=u),j.J=new(window.AudioContext||window.webkitAudioContext)(P),j.J.suspend(),j.state=window.h.ga.stopped,u=0,i!=window.h.I.ya&&(u=s),j.Z=j.J.createScriptProcessor(h,u,s),j.Z.onaudioprocess=function(O){if((j.sa==null||j.sa.length==0)&&(j.sa=new Float32Array(Nt.buffer,m,h*s)),i==window.h.I.capture||i==window.h.I.La){for(var I=0;I<s;I+=1)for(var H=O.inputBuffer.getChannelData(I),G=j.sa,ne=0;ne<h;ne+=1)G[ne*s+I]=H[ne];ca(w,h,m)}if(i==window.h.I.ya||i==window.h.I.La)for(da(w,h,m),I=0;I<O.outputBuffer.numberOfChannels;++I)for(H=O.outputBuffer.getChannelData(I),G=j.sa,ne=0;ne<h;ne+=1)H[ne]=G[ne*s+I];else for(I=0;I<O.outputBuffer.numberOfChannels;++I)O.outputBuffer.getChannelData(I).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(O){j.Da=j.J.createMediaStreamSource(O),j.Da.connect(j.Z),j.Z.connect(j.J.destination)}).catch(function(O){console.log("Failed to get user media: "+O)}),i==window.h.I.ya&&j.Z.connect(j.J.destination),j.qb=w,window.h.yc(j)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(g)},b=(i,s)=>{for(var u=0,h=i.length-1;0<=h;h--){var m=i[h];m==="."?i.splice(h,1):m===".."?(i.splice(h,1),u++):u&&(i.splice(h,1),u--)}if(s)for(;u;u--)i.unshift("..");return i},C=i=>{var s=i.charAt(0)==="/",u=i.substr(-1)==="/";return(i=b(i.split("/").filter(h=>!!h),!s).join("/"))||s||(i="."),i&&u&&(i+="/"),(s?"/":"")+i},x=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},U=i=>{if(i==="/")return"/";i=C(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},le=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);wn("initRandomDevice")},ge=i=>(ge=le())(i);function ie(){for(var i="",s=!1,u=arguments.length-1;-1<=u&&!s;u--){if(s=0<=u?arguments[u]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=b(i.split("/").filter(h=>!!h),!s).join("/"),(s?"/":"")+i||"."}var Ee=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Le=(i,s,u)=>{var h=s+u;for(u=s;i[u]&&!(u>=h);)++u;if(16<u-s&&i.buffer&&Ee)return Ee.decode(i.subarray(s,u));for(h="";s<u;){var m=i[s++];if(m&128){var w=i[s++]&63;if((m&224)==192)h+=String.fromCharCode((m&31)<<6|w);else{var j=i[s++]&63;m=(m&240)==224?(m&15)<<12|w<<6|j:(m&7)<<18|w<<12|j<<6|i[s++]&63,65536>m?h+=String.fromCharCode(m):(m-=65536,h+=String.fromCharCode(55296|m>>10,56320|m&1023))}}else h+=String.fromCharCode(m)}return h},D=[],z=i=>{for(var s=0,u=0;u<i.length;++u){var h=i.charCodeAt(u);127>=h?s++:2047>=h?s+=2:55296<=h&&57343>=h?(s+=4,++u):s+=3}return s},ue=(i,s,u,h)=>{if(!(0<h))return 0;var m=u;h=u+h-1;for(var w=0;w<i.length;++w){var j=i.charCodeAt(w);if(55296<=j&&57343>=j){var P=i.charCodeAt(++w);j=65536+((j&1023)<<10)|P&1023}if(127>=j){if(u>=h)break;s[u++]=j}else{if(2047>=j){if(u+1>=h)break;s[u++]=192|j>>6}else{if(65535>=j){if(u+2>=h)break;s[u++]=224|j>>12}else{if(u+3>=h)break;s[u++]=240|j>>18,s[u++]=128|j>>12&63}s[u++]=128|j>>6&63}s[u++]=128|j&63}}return s[u]=0,u-m};function Re(i,s){var u=Array(z(i)+1);return i=ue(i,u,0,u.length),s&&(u.length=i),u}var De=[];function Ue(i,s){De[i]={input:[],F:[],V:s},wr(i,it)}var it={open:function(i){var s=De[i.node.za];if(!s)throw new ee(43);i.s=s,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,s,u,h){if(!i.s||!i.s.V.jb)throw new ee(60);for(var m=0,w=0;w<h;w++){try{var j=i.s.V.jb(i.s)}catch{throw new ee(29)}if(j===void 0&&m===0)throw new ee(6);if(j==null)break;m++,s[u+w]=j}return m&&(i.node.timestamp=Date.now()),m},write:function(i,s,u,h){if(!i.s||!i.s.V.Oa)throw new ee(60);try{for(var m=0;m<h;m++)i.s.V.Oa(i.s,s[u+m])}catch{throw new ee(29)}return h&&(i.node.timestamp=Date.now()),m}},_t={jb:function(){e:{if(!D.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}D=Re(i,!0)}i=D.shift()}return i},Oa:function(i,s){s===null||s===10?(Ve(Le(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(Ve(Le(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},tn={Oa:function(i,s){s===null||s===10?(ot(Le(i.F,0)),i.F=[]):s!=0&&i.F.push(s)},qa:function(i){i.F&&0<i.F.length&&(ot(Le(i.F,0)),i.F=[])}};function mt(i,s){var u=i.j?i.j.length:0;u>=s||(s=Math.max(s,u*(1048576>u?2:1.125)>>>0),u!=0&&(s=Math.max(s,256)),u=i.j,i.j=new Uint8Array(s),0<i.v&&i.j.set(u.subarray(0,i.v),0))}var re={O:null,U(){return re.createNode(null,"/",16895,0)},createNode(i,s,u,h){if((u&61440)===24576||(u&61440)===4096)throw new ee(63);return re.O||(re.O={dir:{node:{Y:re.l.Y,P:re.l.P,ka:re.l.ka,va:re.l.va,vb:re.l.vb,Bb:re.l.Bb,wb:re.l.wb,tb:re.l.tb,Ea:re.l.Ea},stream:{ba:re.m.ba}},file:{node:{Y:re.l.Y,P:re.l.P},stream:{ba:re.m.ba,read:re.m.read,write:re.m.write,pa:re.m.pa,mb:re.m.mb,ob:re.m.ob}},link:{node:{Y:re.l.Y,P:re.l.P,ma:re.l.ma},stream:{}},ab:{node:{Y:re.l.Y,P:re.l.P},stream:br}}),u=zr(i,s,u,h),(u.mode&61440)===16384?(u.l=re.O.dir.node,u.m=re.O.dir.stream,u.j={}):(u.mode&61440)===32768?(u.l=re.O.file.node,u.m=re.O.file.stream,u.v=0,u.j=null):(u.mode&61440)===40960?(u.l=re.O.link.node,u.m=re.O.link.stream):(u.mode&61440)===8192&&(u.l=re.O.ab.node,u.m=re.O.ab.stream),u.timestamp=Date.now(),i&&(i.j[s]=u,i.timestamp=u.timestamp),u},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var s={};return s.Jc=(i.mode&61440)===8192?i.id:1,s.Mc=i.id,s.mode=i.mode,s.Oc=1,s.uid=0,s.Lc=0,s.za=i.za,(i.mode&61440)===16384?s.size=4096:(i.mode&61440)===32768?s.size=i.v:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.Bc=new Date(i.timestamp),s.Nc=new Date(i.timestamp),s.Ic=new Date(i.timestamp),s.Jb=4096,s.Cc=Math.ceil(s.size/s.Jb),s},P(i,s){if(s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&(s=s.size,i.v!=s))if(s==0)i.j=null,i.v=0;else{var u=i.j;i.j=new Uint8Array(s),u&&i.j.set(u.subarray(0,Math.min(s,i.v))),i.v=s}},ka(){throw Yn[44]},va(i,s,u,h){return re.createNode(i,s,u,h)},vb(i,s,u){if((i.mode&61440)===16384){try{var h=Qn(s,u)}catch{}if(h)for(var m in h.j)throw new ee(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=u,s.j[u]=i,s.timestamp=i.parent.timestamp,i.parent=s},Bb(i,s){delete i.j[s],i.timestamp=Date.now()},wb(i,s){var u=Qn(i,s),h;for(h in u.j)throw new ee(55);delete i.j[s],i.timestamp=Date.now()},tb(i){var s=[".",".."],u;for(u in i.j)i.j.hasOwnProperty(u)&&s.push(u);return s},Ea(i,s,u){return i=re.createNode(i,s,41471,0),i.link=u,i},ma(i){if((i.mode&61440)!==40960)throw new ee(28);return i.link}},m:{read(i,s,u,h,m){var w=i.node.j;if(m>=i.node.v)return 0;if(i=Math.min(i.node.v-m,h),8<i&&w.subarray)s.set(w.subarray(m,m+i),u);else for(h=0;h<i;h++)s[u+h]=w[m+h];return i},write(i,s,u,h,m,w){if(s.buffer===ut.buffer&&(w=!1),!h)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.j||i.j.subarray)){if(w)return i.j=s.subarray(u,u+h),i.v=h;if(i.v===0&&m===0)return i.j=s.slice(u,u+h),i.v=h;if(m+h<=i.v)return i.j.set(s.subarray(u,u+h),m),h}if(mt(i,m+h),i.j.subarray&&s.subarray)i.j.set(s.subarray(u,u+h),m);else for(w=0;w<h;w++)i.j[m+w]=s[u+w];return i.v=Math.max(i.v,m+h),h},ba(i,s,u){if(u===1?s+=i.position:u===2&&(i.node.mode&61440)===32768&&(s+=i.node.v),0>s)throw new ee(28);return s},pa(i,s,u){mt(i.node,s+u),i.node.v=Math.max(i.node.v,s+u)},mb(i,s,u,h,m){if((i.node.mode&61440)!==32768)throw new ee(43);if(i=i.node.j,m&2||i.buffer!==ut.buffer){if((0<u||u+s<i.length)&&(i.subarray?i=i.subarray(u,u+s):i=Array.prototype.slice.call(i,u,u+s)),u=!0,wn(),s=void 0,!s)throw new ee(48);ut.set(i,s)}else u=!1,s=i.byteOffset;return{o:s,M:u}},ob(i,s,u,h){return re.m.write(i,s,0,h,u,!1),0}}};function ye(i,s){var u=0;return i&&(u|=365),s&&(u|=146),u}var Tt=null,gr={},xn=[],Hr=1,Mn=null,_r=!0,ee=null,Yn={},dn=(i,s={})=>{if(i=ie(i),!i)return{path:"",node:null};if(s=Object.assign({hb:!0,Qa:0},s),8<s.Qa)throw new ee(32);i=i.split("/").filter(j=>!!j);for(var u=Tt,h="/",m=0;m<i.length;m++){var w=m===i.length-1;if(w&&s.parent)break;if(u=Qn(u,i[m]),h=C(h+"/"+i[m]),u.wa&&(!w||w&&s.hb)&&(u=u.wa.root),!w||s.gb){for(w=0;(u.mode&61440)===40960;)if(u=Gr(h),h=ie(x(h),u),u=dn(h,{Qa:s.Qa+1}).node,40<w++)throw new ee(32)}}return{path:h,node:u}},Jn=i=>{for(var s;;){if(i===i.parent)return i=i.U.nb,s?i[i.length-1]!=="/"?`${i}/${s}`:i+s:i;s=s?`${i.name}/${s}`:i.name,i=i.parent}},Xn=(i,s)=>{for(var u=0,h=0;h<s.length;h++)u=(u<<5)-u+s.charCodeAt(h)|0;return(i+u>>>0)%Mn.length},Qn=(i,s)=>{var u;if(u=(u=hn(i,"x"))?u:i.l.ka?0:2)throw new ee(u,i);for(u=Mn[Xn(i.id,s)];u;u=u.lc){var h=u.name;if(u.parent.id===i.id&&h===s)return u}return i.l.ka(i,s)},zr=(i,s,u,h)=>(i=new sa(i,s,u,h),s=Xn(i.parent.id,i.name),i.lc=Mn[s],Mn[s]=i),mr=i=>{var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},hn=(i,s)=>{if(_r)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Ln=(i,s)=>{try{return Qn(i,s),20}catch{}return hn(i,"wx")},ji=()=>{for(var i=0;4096>=i;i++)if(!xn[i])return i;throw new ee(33)},Bt=i=>{if(i=xn[i],!i)throw new ee(8);return i},yr=(i,s=-1)=>(ct||(ct=function(){this.h={}},ct.prototype={},Object.defineProperties(ct.prototype,{object:{get(){return this.node},set(u){this.node=u}},flags:{get(){return this.h.flags},set(u){this.h.flags=u}},position:{get(){return this.h.position},set(u){this.h.position=u}}})),i=Object.assign(new ct,i),s==-1&&(s=ji()),i.X=s,xn[s]=i),br={open:i=>{i.m=gr[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new ee(70)}},wr=(i,s)=>{gr[i]={m:s}},Er=(i,s)=>{var u=s==="/",h=!s;if(u&&Tt)throw new ee(10);if(!u&&!h){var m=dn(s,{hb:!1});if(s=m.path,m=m.node,m.wa)throw new ee(10);if((m.mode&61440)!==16384)throw new ee(54)}s={type:i,Qc:{},nb:s,kc:[]},i=i.U(s),i.U=s,s.root=i,u?Tt=i:m&&(m.wa=s,m.U&&m.U.kc.push(s))},Lt=(i,s,u)=>{var h=dn(i,{parent:!0}).node;if(i=U(i),!i||i==="."||i==="..")throw new ee(28);var m=Ln(h,i);if(m)throw new ee(m);if(!h.l.va)throw new ee(63);return h.l.va(h,i,s,u)},$n=(i,s,u)=>{typeof u>"u"&&(u=s,s=438),Lt(i,s|8192,u)},Ar=(i,s)=>{if(!ie(i))throw new ee(44);var u=dn(s,{parent:!0}).node;if(!u)throw new ee(44);s=U(s);var h=Ln(u,s);if(h)throw new ee(h);if(!u.l.Ea)throw new ee(63);u.l.Ea(u,s,i)},Gr=i=>{if(i=dn(i).node,!i)throw new ee(44);if(!i.l.ma)throw new ee(28);return ie(Jn(i.parent),i.l.ma(i))},Fn=(i,s,u)=>{if(i==="")throw new ee(44);if(typeof s=="string"){var h={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[s];if(typeof h>"u")throw Error(`Unknown file open mode: ${s}`);s=h}if(u=s&64?(typeof u>"u"?438:u)&4095|32768:0,typeof i=="object")var m=i;else{i=C(i);try{m=dn(i,{gb:!(s&131072)}).node}catch{}}if(h=!1,s&64)if(m){if(s&128)throw new ee(20)}else m=Lt(i,u,0),h=!0;if(!m)throw new ee(44);if((m.mode&61440)===8192&&(s&=-513),s&65536&&(m.mode&61440)!==16384)throw new ee(54);if(!h&&(u=m?(m.mode&61440)===40960?32:(m.mode&61440)===16384&&(mr(s)!=="r"||s&512)?31:hn(m,mr(s)):44))throw new ee(u);if(s&512&&!h){if(u=m,u=typeof u=="string"?dn(u,{gb:!0}).node:u,!u.l.P)throw new ee(63);if((u.mode&61440)===16384)throw new ee(31);if((u.mode&61440)!==32768)throw new ee(28);if(h=hn(u,"w"))throw new ee(h);u.l.P(u,{size:0,timestamp:Date.now()})}return s&=-131713,m=yr({node:m,path:Jn(m),flags:s,seekable:!0,position:0,m:m.m,zc:[],error:!1}),m.m.open&&m.m.open(m),!g.logReadFiles||s&1||(It||(It={}),i in It||(It[i]=1)),m},Zn=(i,s,u)=>{if(i.X===null)throw new ee(8);if(!i.seekable||!i.m.ba)throw new ee(70);if(u!=0&&u!=1&&u!=2)throw new ee(28);i.position=i.m.ba(i,s,u),i.zc=[]},ke=()=>{ee||(ee=function(i,s){this.name="ErrnoError",this.node=s,this.pc=function(u){this.aa=u},this.pc(i),this.message="FS error"},ee.prototype=Error(),ee.prototype.constructor=ee,[44].forEach(i=>{Yn[i]=new ee(i),Yn[i].stack="<generic error, no stack>"}))},se,ve=(i,s,u)=>{i=C("/dev/"+i);var h=ye(!!s,!!u);Ke||(Ke=64);var m=Ke++<<8|0;wr(m,{open:w=>{w.seekable=!1},close:()=>{u&&u.buffer&&u.buffer.length&&u(10)},read:(w,j,P,O)=>{for(var I=0,H=0;H<O;H++){try{var G=s()}catch{throw new ee(29)}if(G===void 0&&I===0)throw new ee(6);if(G==null)break;I++,j[P+H]=G}return I&&(w.node.timestamp=Date.now()),I},write:(w,j,P,O)=>{for(var I=0;I<O;I++)try{u(j[P+I])}catch{throw new ee(29)}return O&&(w.node.timestamp=Date.now()),I}}),$n(i,h,m)},Ke,Ae={},ct,It,$t=void 0;function Ne(){return $t+=4,Se[$t-4>>2]}function Yt(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var s=i.charCodeAt(0);return 48<=s&&57>=s?`_${i}`:i}function Wt(i,s){return i=Yt(i),{[i]:function(){return s.apply(this,arguments)}}[i]}function er(){this.M=[void 0],this.ib=[]}var vt=new er,An=void 0;function ce(i){throw new An(i)}var dt=i=>(i||ce("Cannot use deleted val. handle = "+i),vt.get(i).value),Pt=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return vt.pa({ub:1,value:i})}};function Kr(i){var s=Error,u=Wt(i,function(h){this.name=i,this.message=h,h=Error(h).stack,h!==void 0&&(this.stack=this.toString()+`
`+h.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},u}var kr=void 0,fn=void 0;function Ge(i){for(var s="";Xe[i];)s+=fn[Xe[i++]];return s}var Dn=[];function Si(){for(;Dn.length;){var i=Dn.pop();i.g.fa=!1,i.delete()}}var tr=void 0,nn={};function Ci(i,s){for(s===void 0&&ce("ptr should not be undefined");i.A;)s=i.na(s),i=i.A;return s}var Un={};function Zi(i){i=ha(i);var s=Ge(i);return Vn(i),s}function jr(i,s){var u=Un[i];return u===void 0&&ce(s+" has unknown type "+Zi(i)),u}function Yr(){}var Ti=!1;function es(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function Ii(i,s,u){return s===u?i:u.A===void 0?null:(i=Ii(i,s,u.A),i===null?null:u.Pb(i))}var Pi={};function ts(i,s){return s=Ci(i,s),nn[s]}var ns=void 0;function Sr(i){throw new ns(i)}function Jr(i,s){return s.u&&s.o||Sr("makeClassHandle requires ptr and ptrType"),!!s.L!=!!s.G&&Sr("Both smartPtrType and smartPtr must be specified"),s.count={value:1},nr(Object.create(i,{g:{value:s}}))}function nr(i){return typeof FinalizationRegistry>"u"?(nr=s=>s,i):(Ti=new FinalizationRegistry(s=>{es(s.g)}),nr=s=>{var u=s.g;return u.G&&Ti.register(s,{g:u},s),s},Yr=s=>{Ti.unregister(s)},nr(i))}var Xr={};function Be(i){for(;i.length;){var s=i.pop();i.pop()(s)}}function at(i){return this.fromWireType(Se[i>>2])}var st={},Rt={};function lt(i,s,u){function h(P){P=u(P),P.length!==i.length&&Sr("Mismatched type converter count");for(var O=0;O<i.length;++O)Ft(i[O],P[O])}i.forEach(function(P){Rt[P]=s});var m=Array(s.length),w=[],j=0;s.forEach((P,O)=>{Un.hasOwnProperty(P)?m[O]=Un[P]:(w.push(P),st.hasOwnProperty(P)||(st[P]=[]),st[P].push(()=>{m[O]=Un[P],++j,j===w.length&&h(m)}))}),w.length===0&&h(m)}function rn(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Nn(i,s,u={}){var h=s.name;if(i||ce(`type "${h}" must have a positive integer typeid pointer`),Un.hasOwnProperty(i)){if(u.$b)return;ce(`Cannot register type '${h}' twice`)}Un[i]=s,delete Rt[i],st.hasOwnProperty(i)&&(s=st[i],delete st[i],s.forEach(m=>m()))}function Ft(i,s,u={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");Nn(i,s,u)}function Ri(i){ce(i.g.u.i.name+" instance already deleted")}function vn(){}function Vs(i,s,u){if(i[s].B===void 0){var h=i[s];i[s]=function(){return i[s].B.hasOwnProperty(arguments.length)||ce(`Function '${u}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[s].B})!`),i[s].B[arguments.length].apply(this,arguments)},i[s].B=[],i[s].B[h.ea]=h}}function qs(i,s,u){g.hasOwnProperty(i)?((u===void 0||g[i].B!==void 0&&g[i].B[u]!==void 0)&&ce(`Cannot register public name '${i}' twice`),Vs(g,i,i),g.hasOwnProperty(u)&&ce(`Cannot register multiple overloads of a function with the same number of arguments (${u})!`),g[i].B[u]=s):(g[i]=s,u!==void 0&&(g[i].Pc=u))}function pu(i,s,u,h,m,w,j,P){this.name=i,this.constructor=s,this.N=u,this.W=h,this.A=m,this.Ub=w,this.na=j,this.Pb=P,this.rb=[]}function rs(i,s,u){for(;s!==u;)s.na||ce(`Expected null or instance of ${u.name}, got an instance of ${s.name}`),i=s.na(i),s=s.A;return i}function gu(i,s){return s===null?(this.Na&&ce(`null is not a valid ${this.name}`),0):(s.g||ce(`Cannot pass "${zs(s)}" as a ${this.name}`),s.g.o||ce(`Cannot pass deleted object as a pointer of type ${this.name}`),rs(s.g.o,s.g.u.i,this.i))}function _u(i,s){if(s===null){if(this.Na&&ce(`null is not a valid ${this.name}`),this.ua){var u=this.Pa();return i!==null&&i.push(this.W,u),u}return 0}if(s.g||ce(`Cannot pass "${zs(s)}" as a ${this.name}`),s.g.o||ce(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&s.g.u.ta&&ce(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`),u=rs(s.g.o,s.g.u.i,this.i),this.ua)switch(s.g.G===void 0&&ce("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:s.g.L===this?u=s.g.G:ce(`Cannot convert argument of type ${s.g.L?s.g.L.name:s.g.u.name} to parameter type ${this.name}`);break;case 1:u=s.g.G;break;case 2:if(s.g.L===this)u=s.g.G;else{var h=s.clone();u=this.oc(u,Pt(function(){h.delete()})),i!==null&&i.push(this.W,u)}break;default:ce("Unsupporting sharing policy")}return u}function mu(i,s){return s===null?(this.Na&&ce(`null is not a valid ${this.name}`),0):(s.g||ce(`Cannot pass "${zs(s)}" as a ${this.name}`),s.g.o||ce(`Cannot pass deleted object as a pointer of type ${this.name}`),s.g.u.ta&&ce(`Cannot convert argument of type ${s.g.u.name} to parameter type ${this.name}`),rs(s.g.o,s.g.u.i,this.i))}function Bn(i,s,u,h){this.name=i,this.i=s,this.Na=u,this.ta=h,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,s.A!==void 0?this.toWireType=_u:(this.toWireType=h?gu:mu,this.K=null)}function Jo(i,s,u){g.hasOwnProperty(i)||Sr("Replacing nonexistant public symbol"),g[i].B!==void 0&&u!==void 0?g[i].B[u]=s:(g[i]=s,g[i].ea=u)}var is=[],Xo=i=>{var s=is[i];return s||(i>=is.length&&(is.length=i+1),is[i]=s=rt.get(i)),s},yu=(i,s)=>{var u=[];return function(){if(u.length=0,Object.assign(u,arguments),i.includes("j")){var h=g["dynCall_"+i];h=u&&u.length?h.apply(null,[s].concat(u)):h.call(null,s)}else h=Xo(s).apply(null,u);return h}};function Ot(i,s){i=Ge(i);var u=i.includes("j")?yu(i,s):Xo(s);return typeof u!="function"&&ce(`unknown function pointer with signature ${i}: ${s}`),u}var Qo=void 0;function Wn(i,s){function u(w){m[w]||Un[w]||(Rt[w]?Rt[w].forEach(u):(h.push(w),m[w]=!0))}var h=[],m={};throw s.forEach(u),new Qo(`${i}: `+h.map(Zi).join([", "]))}function ss(i,s,u,h,m){var w=s.length;2>w&&ce("argTypes array size mismatch! Must at least get return value and 'this' types!");var j=s[1]!==null&&u!==null,P=!1;for(u=1;u<s.length;++u)if(s[u]!==null&&s[u].K===void 0){P=!0;break}var O=s[0].name!=="void",I=w-2,H=Array(I),G=[],ne=[];return function(){if(arguments.length!==I&&ce(`function ${i} called with ${arguments.length} arguments, expected ${I} args!`),ne.length=0,G.length=j?2:1,G[0]=m,j){var S=s[1].toWireType(ne,this);G[1]=S}for(var V=0;V<I;++V)H[V]=s[V+2].toWireType(ne,arguments[V]),G.push(H[V]);if(V=h.apply(null,G),P)Be(ne);else for(var W=j?1:2;W<s.length;W++){var be=W===1?S:H[W-2];s[W].K!==null&&s[W].K(be)}return S=O?s[0].fromWireType(V):void 0,S}}function os(i,s){for(var u=[],h=0;h<i;h++)u.push(Pe[s+4*h>>2]);return u}function Zo(i,s,u){return i instanceof Object||ce(`${u} with invalid "this": ${i}`),i instanceof s.i.constructor||ce(`${u} incompatible with "this" of type ${i.constructor.name}`),i.g.o||ce(`cannot call emscripten binding method ${u} on deleted object`),rs(i.g.o,i.g.u.i,s.i)}function Hs(i){i>=vt.h&&--vt.get(i).ub===0&&vt.Zb(i)}function bu(i,s,u){switch(s){case 0:return function(h){return this.fromWireType((u?ut:Xe)[h])};case 1:return function(h){return this.fromWireType((u?ft:Gt)[h>>1])};case 2:return function(h){return this.fromWireType((u?Se:Pe)[h>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function zs(i){if(i===null)return"null";var s=typeof i;return s==="object"||s==="array"||s==="function"?i.toString():""+i}function wu(i,s){switch(s){case 2:return function(u){return this.fromWireType(Nt[u>>2])};case 3:return function(u){return this.fromWireType(qe[u>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Eu(i,s,u){switch(s){case 0:return u?function(h){return ut[h]}:function(h){return Xe[h]};case 1:return u?function(h){return ft[h>>1]}:function(h){return Gt[h>>1]};case 2:return u?function(h){return Se[h>>2]}:function(h){return Pe[h>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var ea=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Au=(i,s)=>{for(var u=i>>1,h=u+s/2;!(u>=h)&&Gt[u];)++u;if(u<<=1,32<u-i&&ea)return ea.decode(Xe.subarray(i,u));for(u="",h=0;!(h>=s/2);++h){var m=ft[i+2*h>>1];if(m==0)break;u+=String.fromCharCode(m)}return u},ku=(i,s,u)=>{if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var h=s;u=u<2*i.length?u/2:i.length;for(var m=0;m<u;++m)ft[s>>1]=i.charCodeAt(m),s+=2;return ft[s>>1]=0,s-h},ju=i=>2*i.length,Su=(i,s)=>{for(var u=0,h="";!(u>=s/4);){var m=Se[i+4*u>>2];if(m==0)break;++u,65536<=m?(m-=65536,h+=String.fromCharCode(55296|m>>10,56320|m&1023)):h+=String.fromCharCode(m)}return h},Cu=(i,s,u)=>{if(u===void 0&&(u=2147483647),4>u)return 0;var h=s;u=h+u-4;for(var m=0;m<i.length;++m){var w=i.charCodeAt(m);if(55296<=w&&57343>=w){var j=i.charCodeAt(++m);w=65536+((w&1023)<<10)|j&1023}if(Se[s>>2]=w,s+=4,s+4>u)break}return Se[s>>2]=0,s-h},Tu=i=>{for(var s=0,u=0;u<i.length;++u){var h=i.charCodeAt(u);55296<=h&&57343>=h&&++u,s+=4}return s},Iu={};function as(i){var s=Iu[i];return s===void 0?Ge(i):s}var ls=[];function Pu(i){var s=ls.length;return ls.push(i),s}function Ru(i,s){for(var u=Array(i),h=0;h<i;++h)u[h]=jr(Pe[s+4*h>>2],"parameter "+h);return u}var ta=[],Gs=[],Ks={},na=()=>{if(!Ys){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:M||"./this.program"},s;for(s in Ks)Ks[s]===void 0?delete i[s]:i[s]=Ks[s];var u=[];for(s in i)u.push(`${s}=${i[s]}`);Ys=u}return Ys},Ys,us=i=>i%4===0&&(i%100!==0||i%400===0),ra=[31,29,31,30,31,30,31,31,30,31,30,31],ia=[31,28,31,30,31,30,31,31,30,31,30,31],Ou=(i,s,u,h)=>{function m(S,V,W){for(S=typeof S=="number"?S.toString():S||"";S.length<V;)S=W[0]+S;return S}function w(S,V){return m(S,V,"0")}function j(S,V){function W(je){return 0>je?-1:0<je?1:0}var be;return(be=W(S.getFullYear()-V.getFullYear()))===0&&(be=W(S.getMonth()-V.getMonth()))===0&&(be=W(S.getDate()-V.getDate())),be}function P(S){switch(S.getDay()){case 0:return new Date(S.getFullYear()-1,11,29);case 1:return S;case 2:return new Date(S.getFullYear(),0,3);case 3:return new Date(S.getFullYear(),0,2);case 4:return new Date(S.getFullYear(),0,1);case 5:return new Date(S.getFullYear()-1,11,31);case 6:return new Date(S.getFullYear()-1,11,30)}}function O(S){var V=S.ca;for(S=new Date(new Date(S.da+1900,0,1).getTime());0<V;){var W=S.getMonth(),be=(us(S.getFullYear())?ra:ia)[W];if(V>be-S.getDate())V-=be-S.getDate()+1,S.setDate(1),11>W?S.setMonth(W+1):(S.setMonth(0),S.setFullYear(S.getFullYear()+1));else{S.setDate(S.getDate()+V);break}}return W=new Date(S.getFullYear()+1,0,4),V=P(new Date(S.getFullYear(),0,4)),W=P(W),0>=j(V,S)?0>=j(W,S)?S.getFullYear()+1:S.getFullYear():S.getFullYear()-1}var I=Se[h+40>>2];h={wc:Se[h>>2],vc:Se[h+4>>2],Fa:Se[h+8>>2],Sa:Se[h+12>>2],Ga:Se[h+16>>2],da:Se[h+20>>2],R:Se[h+24>>2],ca:Se[h+28>>2],Rc:Se[h+32>>2],uc:Se[h+36>>2],xc:I&&I?Le(Xe,I):""},u=u?Le(Xe,u):"",I={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var H in I)u=u.replace(new RegExp(H,"g"),I[H]);var G="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ne="January February March April May June July August September October November December".split(" ");I={"%a":S=>G[S.R].substring(0,3),"%A":S=>G[S.R],"%b":S=>ne[S.Ga].substring(0,3),"%B":S=>ne[S.Ga],"%C":S=>w((S.da+1900)/100|0,2),"%d":S=>w(S.Sa,2),"%e":S=>m(S.Sa,2," "),"%g":S=>O(S).toString().substring(2),"%G":S=>O(S),"%H":S=>w(S.Fa,2),"%I":S=>(S=S.Fa,S==0?S=12:12<S&&(S-=12),w(S,2)),"%j":S=>{for(var V=0,W=0;W<=S.Ga-1;V+=(us(S.da+1900)?ra:ia)[W++]);return w(S.Sa+V,3)},"%m":S=>w(S.Ga+1,2),"%M":S=>w(S.vc,2),"%n":()=>`
`,"%p":S=>0<=S.Fa&&12>S.Fa?"AM":"PM","%S":S=>w(S.wc,2),"%t":()=>"	","%u":S=>S.R||7,"%U":S=>w(Math.floor((S.ca+7-S.R)/7),2),"%V":S=>{var V=Math.floor((S.ca+7-(S.R+6)%7)/7);if(2>=(S.R+371-S.ca-2)%7&&V++,V)V==53&&(W=(S.R+371-S.ca)%7,W==4||W==3&&us(S.da)||(V=1));else{V=52;var W=(S.R+7-S.ca-1)%7;(W==4||W==5&&us(S.da%400-1))&&V++}return w(V,2)},"%w":S=>S.R,"%W":S=>w(Math.floor((S.ca+7-(S.R+6)%7)/7),2),"%y":S=>(S.da+1900).toString().substring(2),"%Y":S=>S.da+1900,"%z":S=>{S=S.uc;var V=0<=S;return S=Math.abs(S)/60,(V?"+":"-")+("0000"+(S/60*100+S%60)).slice(-4)},"%Z":S=>S.xc,"%%":()=>"%"},u=u.replace(/%%/g,"\0\0");for(H in I)u.includes(H)&&(u=u.replace(new RegExp(H,"g"),I[H](h)));return u=u.replace(/\0\0/g,"%"),H=Re(u,!1),H.length>s?0:(ut.set(H,i),H.length-1)};function sa(i,s,u,h){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Hr++,this.name=s,this.mode=u,this.l={},this.m={},this.za=h}Object.defineProperties(sa.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),ke(),Mn=Array(4096),Er(re,"/"),Lt("/tmp",16895,0),Lt("/home",16895,0),Lt("/home/web_user",16895,0),(()=>{Lt("/dev",16895,0),wr(259,{read:()=>0,write:(h,m,w,j)=>j}),$n("/dev/null",259),Ue(1280,_t),Ue(1536,tn),$n("/dev/tty",1280),$n("/dev/tty1",1536);var i=new Uint8Array(1024),s=0,u=()=>(s===0&&(s=ge(i).byteLength),i[--s]);ve("random",u),ve("urandom",u),Lt("/dev/shm",16895,0),Lt("/dev/shm/tmp",16895,0)})(),(()=>{Lt("/proc",16895,0);var i=Lt("/proc/self",16895,0);Lt("/proc/self/fd",16895,0),Er({U:()=>{var s=zr(i,"fd",16895,73);return s.l={ka:(u,h)=>{var m=Bt(+h);return u={parent:null,U:{nb:"fake"},l:{ma:()=>m.path}},u.parent=u}},s}},"/proc/self/fd")})(),Object.assign(er.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var s=this.ib.pop()||this.M.length;return this.M[s]=i,s},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),An=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},vt.M.push({value:void 0},{value:null},{value:!0},{value:!1}),vt.h=vt.M.length,g.count_emval_handles=function(){for(var i=0,s=vt.h;s<vt.M.length;++s)vt.M[s]!==void 0&&++i;return i},kr=g.PureVirtualError=Kr("PureVirtualError");for(var oa=Array(256),cs=0;256>cs;++cs)oa[cs]=String.fromCharCode(cs);fn=oa,g.getInheritedInstanceCount=function(){return Object.keys(nn).length},g.getLiveInheritedInstances=function(){var i=[],s;for(s in nn)nn.hasOwnProperty(s)&&i.push(nn[s]);return i},g.flushPendingDeletes=Si,g.setDelayFunction=function(i){tr=i,Dn.length&&tr&&tr(Si)},ns=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},vn.prototype.isAliasOf=function(i){if(!(this instanceof vn&&i instanceof vn))return!1;var s=this.g.u.i,u=this.g.o,h=i.g.u.i;for(i=i.g.o;s.A;)u=s.na(u),s=s.A;for(;h.A;)i=h.na(i),h=h.A;return s===h&&u===i},vn.prototype.clone=function(){if(this.g.o||Ri(this),this.g.ia)return this.g.count.value+=1,this;var i=nr,s=Object,u=s.create,h=Object.getPrototypeOf(this),m=this.g;return i=i(u.call(s,h,{g:{value:{count:m.count,fa:m.fa,ia:m.ia,o:m.o,u:m.u,G:m.G,L:m.L}}})),i.g.count.value+=1,i.g.fa=!1,i},vn.prototype.delete=function(){this.g.o||Ri(this),this.g.fa&&!this.g.ia&&ce("Object already scheduled for deletion"),Yr(this),es(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},vn.prototype.isDeleted=function(){return!this.g.o},vn.prototype.deleteLater=function(){return this.g.o||Ri(this),this.g.fa&&!this.g.ia&&ce("Object already scheduled for deletion"),Dn.push(this),Dn.length===1&&tr&&tr(Si),this.g.fa=!0,this},Bn.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},Bn.prototype.bb=function(i){this.W&&this.W(i)},Bn.prototype.argPackAdvance=8,Bn.prototype.readValueFromPointer=at,Bn.prototype.deleteObject=function(i){i!==null&&i.delete()},Bn.prototype.fromWireType=function(i){function s(){return this.ua?Jr(this.i.N,{u:this.nc,o:u,L:this,G:i}):Jr(this.i.N,{u:this,o:i})}var u=this.Vb(i);if(!u)return this.bb(i),null;var h=ts(this.i,u);if(h!==void 0)return h.g.count.value===0?(h.g.o=u,h.g.G=i,h.clone()):(h=h.clone(),this.bb(i),h);if(h=this.i.Ub(u),h=Pi[h],!h)return s.call(this);h=this.ta?h.Kb:h.pointerType;var m=Ii(u,this.i,h.i);return m===null?s.call(this):this.ua?Jr(h.i.N,{u:h,o:m,L:this,G:i}):Jr(h.i.N,{u:h,o:m})},Qo=g.UnboundTypeError=Kr("UnboundTypeError");var aa={__syscall_fcntl64:function(i,s,u){$t=u;try{var h=Bt(i);switch(s){case 0:var m=Ne();return 0>m?-28:yr(h,m).X;case 1:case 2:return 0;case 3:return h.flags;case 4:return m=Ne(),h.flags|=m,0;case 5:return m=Ne(),ft[m+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Se[la()>>2]=28,-1;default:return-28}}catch(w){if(typeof Ae>"u"||w.name!=="ErrnoError")throw w;return-w.aa}},__syscall_ioctl:function(i,s,u){$t=u;try{var h=Bt(i);switch(s){case 21509:return h.s?0:-59;case 21505:if(!h.s)return-59;if(h.s.V.bc){s=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var m=Ne();Se[m>>2]=25856,Se[m+4>>2]=5,Se[m+8>>2]=191,Se[m+12>>2]=35387;for(var w=0;32>w;w++)ut[m+w+17>>0]=s[w]||0}return 0;case 21510:case 21511:case 21512:return h.s?0:-59;case 21506:case 21507:case 21508:if(!h.s)return-59;if(h.s.V.cc)for(m=Ne(),s=[],w=0;32>w;w++)s.push(ut[m+w+17>>0]);return 0;case 21519:return h.s?(m=Ne(),Se[m>>2]=0):-59;case 21520:return h.s?-28:-59;case 21531:if(m=Ne(),!h.m.ac)throw new ee(59);return h.m.ac(h,s,m);case 21523:return h.s?(h.s.V.dc&&(w=[24,80],m=Ne(),ft[m>>1]=w[0],ft[m+2>>1]=w[1]),0):-59;case 21524:return h.s?0:-59;case 21515:return h.s?0:-59;default:return-28}}catch(j){if(typeof Ae>"u"||j.name!=="ErrnoError")throw j;return-j.aa}},__syscall_openat:function(i,s,u,h){$t=h;try{s=s?Le(Xe,s):"";var m=s;if(m.charAt(0)==="/")s=m;else{var w=i===-100?"/":Bt(i).path;if(m.length==0)throw new ee(44);s=C(w+"/"+m)}var j=h?Ne():0;return Fn(s,u,j).X}catch(P){if(typeof Ae>"u"||P.name!=="ErrnoError")throw P;return-P.aa}},_embind_create_inheriting_constructor:function(i,s,u){i=Ge(i),s=jr(s,"wrapper"),u=dt(u);var h=[].slice,m=s.i,w=m.N,j=m.A.N,P=m.A.constructor;i=Wt(i,function(){m.A.rb.forEach((function(I){if(this[I]===j[I])throw new kr(`Pure virtual function ${I} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:w}),this.__construct.apply(this,h.call(arguments))}),w.__construct=function(){this===w&&ce("Pass correct 'this' to __construct");var I=P.implement.apply(void 0,[this].concat(h.call(arguments)));Yr(I);var H=I.g;I.notifyOnDestruction(),H.ia=!0,Object.defineProperties(this,{g:{value:H}}),nr(this),I=H.o,I=Ci(m,I),nn.hasOwnProperty(I)?ce(`Tried to register registered instance: ${I}`):nn[I]=this},w.__destruct=function(){this===w&&ce("Pass correct 'this' to __destruct"),Yr(this);var I=this.g.o;I=Ci(m,I),nn.hasOwnProperty(I)?delete nn[I]:ce(`Tried to unregister unregistered instance: ${I}`)},i.prototype=Object.create(w);for(var O in u)i.prototype[O]=u[O];return Pt(i)},_embind_finalize_value_object:function(i){var s=Xr[i];delete Xr[i];var u=s.Pa,h=s.W,m=s.fb,w=m.map(j=>j.Yb).concat(m.map(j=>j.rc));lt([i],w,j=>{var P={};return m.forEach((O,I)=>{var H=j[I],G=O.Wb,ne=O.Xb,S=j[I+m.length],V=O.qc,W=O.sc;P[O.Sb]={read:be=>H.fromWireType(G(ne,be)),write:(be,je)=>{var Q=[];V(W,be,S.toWireType(Q,je)),Be(Q)}}}),[{name:s.name,fromWireType:function(O){var I={},H;for(H in P)I[H]=P[H].read(O);return h(O),I},toWireType:function(O,I){for(var H in P)if(!(H in I))throw new TypeError(`Missing field: "${H}"`);var G=u();for(H in P)P[H].write(G,I[H]);return O!==null&&O.push(h,G),G},argPackAdvance:8,readValueFromPointer:at,K:h}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,s,u,h,m){var w=rn(u);s=Ge(s),Ft(i,{name:s,fromWireType:function(j){return!!j},toWireType:function(j,P){return P?h:m},argPackAdvance:8,readValueFromPointer:function(j){if(u===1)var P=ut;else if(u===2)P=ft;else if(u===4)P=Se;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(P[j>>w])},K:null})},_embind_register_class:function(i,s,u,h,m,w,j,P,O,I,H,G,ne){H=Ge(H),w=Ot(m,w),P&&(P=Ot(j,P)),I&&(I=Ot(O,I)),ne=Ot(G,ne);var S=Yt(H);qs(S,function(){Wn(`Cannot construct ${H} due to unbound types`,[h])}),lt([i,s,u],h?[h]:[],function(V){if(V=V[0],h)var W=V.i,be=W.N;else be=vn.prototype;V=Wt(S,function(){if(Object.getPrototypeOf(this)!==je)throw new An("Use 'new' to construct "+H);if(Q.$===void 0)throw new An(H+" has no accessible constructor");var kt=Q.$[arguments.length];if(kt===void 0)throw new An(`Tried to invoke ctor of ${H} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Q.$).toString()}) parameters instead!`);return kt.apply(this,arguments)});var je=Object.create(be,{constructor:{value:V}});V.prototype=je;var Q=new pu(H,V,je,ne,W,w,P,I);Q.A&&(Q.A.oa===void 0&&(Q.A.oa=[]),Q.A.oa.push(Q)),W=new Bn(H,Q,!0,!1),be=new Bn(H+"*",Q,!1,!1);var Ze=new Bn(H+" const*",Q,!1,!0);return Pi[i]={pointerType:be,Kb:Ze},Jo(S,V),[W,be,Ze]})},_embind_register_class_class_function:function(i,s,u,h,m,w,j){var P=os(u,h);s=Ge(s),w=Ot(m,w),lt([],[i],function(O){function I(){Wn(`Cannot call ${H} due to unbound types`,P)}O=O[0];var H=`${O.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]);var G=O.i.constructor;return G[s]===void 0?(I.ea=u-1,G[s]=I):(Vs(G,s,H),G[s].B[u-1]=I),lt([],P,function(ne){if(ne=ss(H,[ne[0],null].concat(ne.slice(1)),null,w,j),G[s].B===void 0?(ne.ea=u-1,G[s]=ne):G[s].B[u-1]=ne,O.i.oa)for(const S of O.i.oa)S.constructor.hasOwnProperty(s)||(S.constructor[s]=ne);return[]}),[]})},_embind_register_class_class_property:function(i,s,u,h,m,w,j,P){s=Ge(s),w=Ot(m,w),lt([],[i],function(O){O=O[0];var I=`${O.name}.${s}`,H={get(){Wn(`Cannot access ${I} due to unbound types`,[u])},enumerable:!0,configurable:!0};return H.set=P?()=>{Wn(`Cannot access ${I} due to unbound types`,[u])}:()=>{ce(`${I} is a read-only property`)},Object.defineProperty(O.i.constructor,s,H),lt([],[u],function(G){G=G[0];var ne={get(){return G.fromWireType(w(h))},enumerable:!0};return P&&(P=Ot(j,P),ne.set=S=>{var V=[];P(h,G.toWireType(V,S)),Be(V)}),Object.defineProperty(O.i.constructor,s,ne),[]}),[]})},_embind_register_class_constructor:function(i,s,u,h,m,w){var j=os(s,u);m=Ot(h,m),lt([],[i],function(P){P=P[0];var O=`constructor ${P.name}`;if(P.i.$===void 0&&(P.i.$=[]),P.i.$[s-1]!==void 0)throw new An(`Cannot register multiple constructors with identical number of parameters (${s-1}) for class '${P.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return P.i.$[s-1]=()=>{Wn(`Cannot construct ${P.name} due to unbound types`,j)},lt([],j,function(I){return I.splice(1,0,null),P.i.$[s-1]=ss(O,I,null,m,w),[]}),[]})},_embind_register_class_function:function(i,s,u,h,m,w,j,P){var O=os(u,h);s=Ge(s),w=Ot(m,w),lt([],[i],function(I){function H(){Wn(`Cannot call ${G} due to unbound types`,O)}I=I[0];var G=`${I.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),P&&I.i.rb.push(s);var ne=I.i.N,S=ne[s];return S===void 0||S.B===void 0&&S.className!==I.name&&S.ea===u-2?(H.ea=u-2,H.className=I.name,ne[s]=H):(Vs(ne,s,G),ne[s].B[u-2]=H),lt([],O,function(V){return V=ss(G,V,I,w,j),ne[s].B===void 0?(V.ea=u-2,ne[s]=V):ne[s].B[u-2]=V,[]}),[]})},_embind_register_class_property:function(i,s,u,h,m,w,j,P,O,I){s=Ge(s),m=Ot(h,m),lt([],[i],function(H){H=H[0];var G=`${H.name}.${s}`,ne={get(){Wn(`Cannot access ${G} due to unbound types`,[u,j])},enumerable:!0,configurable:!0};return ne.set=O?()=>{Wn(`Cannot access ${G} due to unbound types`,[u,j])}:()=>{ce(G+" is a read-only property")},Object.defineProperty(H.i.N,s,ne),lt([],O?[u,j]:[u],function(S){var V=S[0],W={get(){var je=Zo(this,H,G+" getter");return V.fromWireType(m(w,je))},enumerable:!0};if(O){O=Ot(P,O);var be=S[1];W.set=function(je){var Q=Zo(this,H,G+" setter"),Ze=[];O(I,Q,be.toWireType(Ze,je)),Be(Ze)}}return Object.defineProperty(H.i.N,s,W),[]}),[]})},_embind_register_emval:function(i,s){s=Ge(s),Ft(i,{name:s,fromWireType:function(u){var h=dt(u);return Hs(u),h},toWireType:function(u,h){return Pt(h)},argPackAdvance:8,readValueFromPointer:at,K:null})},_embind_register_enum:function(i,s,u,h){function m(){}u=rn(u),s=Ge(s),m.values={},Ft(i,{name:s,constructor:m,fromWireType:function(w){return this.constructor.values[w]},toWireType:function(w,j){return j.value},argPackAdvance:8,readValueFromPointer:bu(s,u,h),K:null}),qs(s,m)},_embind_register_enum_value:function(i,s,u){var h=jr(i,"enum");s=Ge(s),i=h.constructor,h=Object.create(h.constructor.prototype,{value:{value:u},constructor:{value:Wt(`${h.name}_${s}`,function(){})}}),i.values[u]=h,i[s]=h},_embind_register_float:function(i,s,u){u=rn(u),s=Ge(s),Ft(i,{name:s,fromWireType:function(h){return h},toWireType:function(h,m){return m},argPackAdvance:8,readValueFromPointer:wu(s,u),K:null})},_embind_register_function:function(i,s,u,h,m,w){var j=os(s,u);i=Ge(i),m=Ot(h,m),qs(i,function(){Wn(`Cannot call ${i} due to unbound types`,j)},s-1),lt([],j,function(P){return Jo(i,ss(i,[P[0],null].concat(P.slice(1)),null,m,w),s-1),[]})},_embind_register_integer:function(i,s,u,h,m){s=Ge(s),m===-1&&(m=4294967295),m=rn(u);var w=P=>P;if(h===0){var j=32-8*u;w=P=>P<<j>>>j}u=s.includes("unsigned")?function(P,O){return O>>>0}:function(P,O){return O},Ft(i,{name:s,fromWireType:w,toWireType:u,argPackAdvance:8,readValueFromPointer:Eu(s,m,h!==0),K:null})},_embind_register_memory_view:function(i,s,u){function h(w){w>>=2;var j=Pe;return new m(j.buffer,j[w+1],j[w])}var m=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];u=Ge(u),Ft(i,{name:u,fromWireType:h,argPackAdvance:8,readValueFromPointer:h},{$b:!0})},_embind_register_std_string:function(i,s){s=Ge(s);var u=s==="std::string";Ft(i,{name:s,fromWireType:function(h){var m=Pe[h>>2],w=h+4;if(u)for(var j=w,P=0;P<=m;++P){var O=w+P;if(P==m||Xe[O]==0){if(j=j?Le(Xe,j,O-j):"",I===void 0)var I=j;else I+="\0",I+=j;j=O+1}}else{for(I=Array(m),P=0;P<m;++P)I[P]=String.fromCharCode(Xe[w+P]);I=I.join("")}return Vn(h),I},toWireType:function(h,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var w=typeof m=="string";w||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||ce("Cannot pass non-string to std::string");var j=u&&w?z(m):m.length,P=Js(4+j+1),O=P+4;if(Pe[P>>2]=j,u&&w)ue(m,Xe,O,j+1);else if(w)for(w=0;w<j;++w){var I=m.charCodeAt(w);255<I&&(Vn(O),ce("String has UTF-16 code units that do not fit in 8 bits")),Xe[O+w]=I}else for(w=0;w<j;++w)Xe[O+w]=m[w];return h!==null&&h.push(Vn,P),P},argPackAdvance:8,readValueFromPointer:at,K:function(h){Vn(h)}})},_embind_register_std_wstring:function(i,s,u){if(u=Ge(u),s===2)var h=Au,m=ku,w=ju,j=()=>Gt,P=1;else s===4&&(h=Su,m=Cu,w=Tu,j=()=>Pe,P=2);Ft(i,{name:u,fromWireType:function(O){for(var I=Pe[O>>2],H=j(),G,ne=O+4,S=0;S<=I;++S){var V=O+4+S*s;(S==I||H[V>>P]==0)&&(ne=h(ne,V-ne),G===void 0?G=ne:(G+="\0",G+=ne),ne=V+s)}return Vn(O),G},toWireType:function(O,I){typeof I!="string"&&ce(`Cannot pass non-string to C++ string type ${u}`);var H=w(I),G=Js(4+H+s);return Pe[G>>2]=H>>P,m(I,G+4,H+s),O!==null&&O.push(Vn,G),G},argPackAdvance:8,readValueFromPointer:at,K:function(O){Vn(O)}})},_embind_register_value_object:function(i,s,u,h,m,w){Xr[i]={name:Ge(s),Pa:Ot(u,h),W:Ot(m,w),fb:[]}},_embind_register_value_object_field:function(i,s,u,h,m,w,j,P,O,I){Xr[i].fb.push({Sb:Ge(s),Yb:u,Wb:Ot(h,m),Xb:w,rc:j,qc:Ot(P,O),sc:I})},_embind_register_void:function(i,s){s=Ge(s),Ft(i,{fc:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,s,u){i=dt(i),s=jr(s,"emval::as");var h=[],m=Pt(h);return Pe[u>>2]=m,s.toWireType(h,i)},_emval_call_method:function(i,s,u,h,m){i=ls[i],s=dt(s),u=as(u);var w=[];return Pe[h>>2]=Pt(w),i(s,u,w,m)},_emval_call_void_method:function(i,s,u,h){i=ls[i],s=dt(s),u=as(u),i(s,u,null,h)},_emval_decref:Hs,_emval_get_method_caller:function(i,s){var u=Ru(i,s),h=u[0];s=h.name+"_$"+u.slice(1).map(function(j){return j.name}).join("_")+"$";var m=ta[s];if(m!==void 0)return m;var w=Array(i-1);return m=Pu((j,P,O,I)=>{for(var H=0,G=0;G<i-1;++G)w[G]=u[G+1].readValueFromPointer(I+H),H+=u[G+1].argPackAdvance;for(j=j[P].apply(j,w),G=0;G<i-1;++G)u[G+1].Nb&&u[G+1].Nb(w[G]);if(!h.fc)return h.toWireType(O,j)}),ta[s]=m},_emval_get_module_property:function(i){return i=as(i),Pt(g[i])},_emval_get_property:function(i,s){return i=dt(i),s=dt(s),Pt(i[s])},_emval_incref:function(i){4<i&&(vt.get(i).ub+=1)},_emval_new_array:function(){return Pt([])},_emval_new_cstring:function(i){return Pt(as(i))},_emval_new_object:function(){return Pt({})},_emval_run_destructors:function(i){var s=dt(i);Be(s),Hs(i)},_emval_set_property:function(i,s,u){i=dt(i),s=dt(s),u=dt(u),i[s]=u},_emval_take_value:function(i,s){return i=jr(i,"_emval_take_value"),i=i.readValueFromPointer(s),Pt(i)},abort:()=>{wn("")},emscripten_asm_const_int:(i,s,u)=>{Gs.length=0;var h;for(u>>=2;h=Xe[s++];)u+=h!=105&u,Gs.push(h==105?Se[u]:qe[u++>>1]),++u;return a[i].apply(null,Gs)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,s,u)=>Xe.copyWithin(i,s,s+u),emscripten_resize_heap:i=>{var s=Xe.length;if(i>>>=0,2147483648<i)return!1;for(var u=1;4>=u;u*=2){var h=s*(1+.2/u);h=Math.min(h,i+100663296);var m=Math;h=Math.max(i,h);e:{m=m.min.call(m,2147483648,h+(65536-h%65536)%65536)-St.buffer.byteLength+65535>>>16;try{St.grow(m),Mt();var w=1;break e}catch{}w=void 0}if(w)return!0}return!1},environ_get:(i,s)=>{var u=0;return na().forEach(function(h,m){var w=s+u;for(m=Pe[i+4*m>>2]=w,w=0;w<h.length;++w)ut[m++>>0]=h.charCodeAt(w);ut[m>>0]=0,u+=h.length+1}),0},environ_sizes_get:(i,s)=>{var u=na();Pe[i>>2]=u.length;var h=0;return u.forEach(function(m){h+=m.length+1}),Pe[s>>2]=h,0},fd_close:function(i){try{var s=Bt(i);if(s.X===null)throw new ee(8);s.Ma&&(s.Ma=null);try{s.m.close&&s.m.close(s)}catch(u){throw u}finally{xn[s.X]=null}return s.X=null,0}catch(u){if(typeof Ae>"u"||u.name!=="ErrnoError")throw u;return u.aa}},fd_read:function(i,s,u,h){try{e:{var m=Bt(i);i=s;for(var w,j=s=0;j<u;j++){var P=Pe[i>>2],O=Pe[i+4>>2];i+=8;var I=m,H=P,G=O,ne=w,S=ut;if(0>G||0>ne)throw new ee(28);if(I.X===null)throw new ee(8);if((I.flags&2097155)===1)throw new ee(8);if((I.node.mode&61440)===16384)throw new ee(31);if(!I.m.read)throw new ee(28);var V=typeof ne<"u";if(!V)ne=I.position;else if(!I.seekable)throw new ee(70);var W=I.m.read(I,S,H,G,ne);V||(I.position+=W);var be=W;if(0>be){var je=-1;break e}if(s+=be,be<O)break;typeof w<"u"&&(w+=be)}je=s}return Pe[h>>2]=je,0}catch(Q){if(typeof Ae>"u"||Q.name!=="ErrnoError")throw Q;return Q.aa}},fd_seek:function(i,s,u,h,m){s=u+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*u:NaN;try{if(isNaN(s))return 61;var w=Bt(i);return Zn(w,s,h),p=[w.position>>>0,(En=w.position,1<=+Math.abs(En)?0<En?+Math.floor(En/4294967296)>>>0:~~+Math.ceil((En-+(~~En>>>0))/4294967296)>>>0:0)],Se[m>>2]=p[0],Se[m+4>>2]=p[1],w.Ma&&s===0&&h===0&&(w.Ma=null),0}catch(j){if(typeof Ae>"u"||j.name!=="ErrnoError")throw j;return j.aa}},fd_write:function(i,s,u,h){try{e:{var m=Bt(i);i=s;for(var w,j=s=0;j<u;j++){var P=Pe[i>>2],O=Pe[i+4>>2];i+=8;var I=m,H=P,G=O,ne=w,S=ut;if(0>G||0>ne)throw new ee(28);if(I.X===null)throw new ee(8);if((I.flags&2097155)===0)throw new ee(8);if((I.node.mode&61440)===16384)throw new ee(31);if(!I.m.write)throw new ee(28);I.seekable&&I.flags&1024&&Zn(I,0,2);var V=typeof ne<"u";if(!V)ne=I.position;else if(!I.seekable)throw new ee(70);var W=I.m.write(I,S,H,G,ne,void 0);V||(I.position+=W);var be=W;if(0>be){var je=-1;break e}s+=be,typeof w<"u"&&(w+=be)}je=s}return Pe[h>>2]=je,0}catch(Q){if(typeof Ae>"u"||Q.name!=="ErrnoError")throw Q;return Q.aa}},strftime_l:(i,s,u,h)=>Ou(i,s,u,h)};(function(){function i(u){if(Ce=u=u.exports,St=Ce.memory,Mt(),rt=Ce.__indirect_function_table,un.unshift(Ce.__wasm_call_ctors),Ct--,g.monitorRunDependencies&&g.monitorRunDependencies(Ct),Ct==0&&Kt){var h=Kt;Kt=null,h()}return u}var s={env:aa,wasi_snapshot_preview1:aa};if(Ct++,g.monitorRunDependencies&&g.monitorRunDependencies(Ct),g.instantiateWasm)try{return g.instantiateWasm(s,i)}catch(u){ot("Module.instantiateWasm callback failed with error: "+u),L(u)}return ki(s,function(u){i(u.instance)}).catch(L),{}})();var Vn=i=>(Vn=Ce.free)(i),Js=i=>(Js=Ce.malloc)(i),la=()=>(la=Ce.__errno_location)(),ua=g._ma_device__on_notification_unlocked=i=>(ua=g._ma_device__on_notification_unlocked=Ce.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,s)=>(g._ma_malloc_emscripten=Ce.ma_malloc_emscripten)(i,s),g._ma_free_emscripten=(i,s)=>(g._ma_free_emscripten=Ce.ma_free_emscripten)(i,s);var ca=g._ma_device_process_pcm_frames_capture__webaudio=(i,s,u)=>(ca=g._ma_device_process_pcm_frames_capture__webaudio=Ce.ma_device_process_pcm_frames_capture__webaudio)(i,s,u),da=g._ma_device_process_pcm_frames_playback__webaudio=(i,s,u)=>(da=g._ma_device_process_pcm_frames_playback__webaudio=Ce.ma_device_process_pcm_frames_playback__webaudio)(i,s,u),ha=i=>(ha=Ce.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=Ce._embind_initialize_bindings)(),g.dynCall_iiji=(i,s,u,h,m)=>(g.dynCall_iiji=Ce.dynCall_iiji)(i,s,u,h,m),g.dynCall_jiji=(i,s,u,h,m)=>(g.dynCall_jiji=Ce.dynCall_jiji)(i,s,u,h,m),g.dynCall_iiiji=(i,s,u,h,m,w)=>(g.dynCall_iiiji=Ce.dynCall_iiiji)(i,s,u,h,m,w),g.dynCall_iij=(i,s,u,h)=>(g.dynCall_iij=Ce.dynCall_iij)(i,s,u,h),g.dynCall_jii=(i,s,u)=>(g.dynCall_jii=Ce.dynCall_jii)(i,s,u),g.dynCall_viijii=(i,s,u,h,m,w,j)=>(g.dynCall_viijii=Ce.dynCall_viijii)(i,s,u,h,m,w,j),g.dynCall_iiiiij=(i,s,u,h,m,w,j)=>(g.dynCall_iiiiij=Ce.dynCall_iiiiij)(i,s,u,h,m,w,j),g.dynCall_iiiiijj=(i,s,u,h,m,w,j,P,O)=>(g.dynCall_iiiiijj=Ce.dynCall_iiiiijj)(i,s,u,h,m,w,j,P,O),g.dynCall_iiiiiijj=(i,s,u,h,m,w,j,P,O,I)=>(g.dynCall_iiiiiijj=Ce.dynCall_iiiiiijj)(i,s,u,h,m,w,j,P,O,I);var ds;Kt=function i(){ds||fa(),ds||(Kt=i)};function fa(){function i(){if(!ds&&(ds=!0,g.calledRun=!0,!zt)){if(g.noFSInit||se||(se=!0,ke(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?ve("stdin",g.stdin):Ar("/dev/tty","/dev/stdin"),g.stdout?ve("stdout",null,g.stdout):Ar("/dev/tty","/dev/stdout"),g.stderr?ve("stderr",null,g.stderr):Ar("/dev/tty1","/dev/stderr"),Fn("/dev/stdin",0),Fn("/dev/stdout",1),Fn("/dev/stderr",1)),_r=!1,d(un),T(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var s=g.postRun.shift();cn.unshift(s)}d(cn)}}if(!(0<Ct)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)bn();d(Zt),0<Ct||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return fa(),k.ready})})();const y=_}),(c=>{c.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>_.Animation});var _=v(4)}),((c,f,v)=>{v.r(f),v.d(f,{Animation:()=>_});var _=(function(){function y(A,k,g,T){this.animation=A,this.artboard=k,this.playing=T,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(A,k)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"time",{get:function(){return this.instance.time},set:function(A){this.instance.time=A},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),y.prototype.advance=function(A){this.scrubTo===null?this.instance.advance(A):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},y.prototype.apply=function(A){this.instance.apply(A)},y.prototype.cleanup=function(){this.instance.delete()},y})()}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>A.AudioAssetWrapper,AudioWrapper:()=>A.AudioWrapper,BLANK_URL:()=>y.BLANK_URL,CustomFileAssetLoaderWrapper:()=>A.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>A.FileAssetWrapper,Finalizable:()=>A.Finalizable,FontAssetWrapper:()=>A.FontAssetWrapper,FontWrapper:()=>A.FontWrapper,ImageAssetWrapper:()=>A.ImageAssetWrapper,ImageWrapper:()=>A.ImageWrapper,finalizationRegistry:()=>A.finalizationRegistry,registerTouchInteractions:()=>_.registerTouchInteractions,sanitizeUrl:()=>y.sanitizeUrl});var _=v(6),y=v(7),A=v(8)}),((c,f,v)=>{v.r(f),v.d(f,{registerTouchInteractions:()=>A});var _=void 0,y=function(k,g){var T,L;return["touchstart","touchmove"].indexOf(k.type)>-1&&(!((T=k.touches)===null||T===void 0)&&T.length)?(g||k.preventDefault(),{clientX:k.touches[0].clientX,clientY:k.touches[0].clientY}):k.type==="touchend"&&(!((L=k.changedTouches)===null||L===void 0)&&L.length)?{clientX:k.changedTouches[0].clientX,clientY:k.changedTouches[0].clientY}:{clientX:k.clientX,clientY:k.clientY}},A=function(k){var g=k.canvas,T=k.artboard,L=k.stateMachines,$=L===void 0?[]:L,K=k.renderer,Y=k.rive,q=k.fit,J=k.alignment,X=k.isTouchScrollEnabled,R=X===void 0?!1:X,M=k.layoutScaleFactor,ae=M===void 0?1:M;if(!g||!$.length||!K||!Y||!T||typeof window>"u")return null;var de=null,fe=!1,Z=function(Ve){if(fe&&Ve instanceof MouseEvent){Ve.type=="mouseup"&&(fe=!1);return}fe=R&&Ve.type==="touchend"&&de==="touchstart",de=Ve.type;var ot=Ve.currentTarget.getBoundingClientRect(),Je=y(Ve,R),St=Je.clientX,Ce=Je.clientY;if(!(!St&&!Ce)){var zt=St-ot.left,ut=Ce-ot.top,Xe=Y.computeAlignment(q,J,{minX:0,minY:0,maxX:ot.width,maxY:ot.height},T.bounds,ae),ft=new Y.Mat2D;Xe.invert(ft);var Gt=new Y.Vec2D(zt,ut),Se=Y.mapXY(ft,Gt),Pe=Se.x(),Nt=Se.y();switch(Se.delete(),ft.delete(),Gt.delete(),Xe.delete(),Ve.type){case"mouseout":for(var qe=0,Mt=$;qe<Mt.length;qe++){var rt=Mt[qe];rt.pointerMove(Pe,Nt)}break;case"touchmove":case"mouseover":case"mousemove":{for(var Zt=0,un=$;Zt<un.length;Zt++){var rt=un[Zt];rt.pointerMove(Pe,Nt)}break}case"touchstart":case"mousedown":{for(var cn=0,bn=$;cn<bn.length;cn++){var rt=bn[cn];rt.pointerDown(Pe,Nt)}break}case"touchend":case"mouseup":{for(var Ct=0,Kt=$;Ct<Kt.length;Ct++){var rt=Kt[Ct];rt.pointerUp(Pe,Nt)}break}}}},pe=Z.bind(_);return g.addEventListener("mouseover",pe),g.addEventListener("mouseout",pe),g.addEventListener("mousemove",pe),g.addEventListener("mousedown",pe),g.addEventListener("mouseup",pe),g.addEventListener("touchmove",pe,{passive:R}),g.addEventListener("touchstart",pe,{passive:R}),g.addEventListener("touchend",pe),function(){g.removeEventListener("mouseover",pe),g.removeEventListener("mouseout",pe),g.removeEventListener("mousemove",pe),g.removeEventListener("mousedown",pe),g.removeEventListener("mouseup",pe),g.removeEventListener("touchmove",pe),g.removeEventListener("touchstart",pe),g.removeEventListener("touchend",pe)}}}),((c,f,v)=>{v.r(f),v.d(f,{BLANK_URL:()=>L,sanitizeUrl:()=>Y});var _=/^([^\w]*)(javascript|data|vbscript)/im,y=/&#(\w+)(^\w|;)?/g,A=/&(newline|tab);/gi,k=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,T=[".","/"],L="about:blank";function $(q){return T.indexOf(q[0])>-1}function K(q){var J=q.replace(k,"");return J.replace(y,function(X,R){return String.fromCharCode(R)})}function Y(q){if(!q)return L;var J=K(q).replace(A,"").replace(k,"").trim();if(!J)return L;if($(J))return J;var X=J.match(g);if(!X)return J;var R=X[0];return _.test(R)?L:J}}),((c,f,v)=>{v.r(f),v.d(f,{AudioAssetWrapper:()=>K,AudioWrapper:()=>k,CustomFileAssetLoaderWrapper:()=>T,FileAssetWrapper:()=>L,Finalizable:()=>y,FontAssetWrapper:()=>Y,FontWrapper:()=>g,ImageAssetWrapper:()=>$,ImageWrapper:()=>A,finalizationRegistry:()=>X});var _=(function(){var R=function(M,ae){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(de,fe){de.__proto__=fe}||function(de,fe){for(var Z in fe)Object.prototype.hasOwnProperty.call(fe,Z)&&(de[Z]=fe[Z])},R(M,ae)};return function(M,ae){if(typeof ae!="function"&&ae!==null)throw new TypeError("Class extends value "+String(ae)+" is not a constructor or null");R(M,ae);function de(){this.constructor=M}M.prototype=ae===null?Object.create(ae):(de.prototype=ae.prototype,new de)}})(),y=(function(){function R(){this.selfUnref=!1}return R})(),A=(function(R){_(M,R);function M(ae){var de=R.call(this)||this;return de._nativeImage=ae,de}return Object.defineProperty(M.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},M})(y),k=(function(R){_(M,R);function M(ae){var de=R.call(this)||this;return de._nativeAudio=ae,de}return Object.defineProperty(M.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},M})(y),g=(function(R){_(M,R);function M(ae){var de=R.call(this)||this;return de._nativeFont=ae,de}return Object.defineProperty(M.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),M.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},M})(y),T=(function(){function R(M,ae){this._assetLoaderCallback=ae,this.assetLoader=new M.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return R.prototype.loadContents=function(M,ae){var de;return M.isImage?de=new $(M):M.isAudio?de=new K(M):M.isFont&&(de=new Y(M)),this._assetLoaderCallback(de,ae)},R})(),L=(function(){function R(M){this._nativeFileAsset=M}return R.prototype.decode=function(M){this._nativeFileAsset.decode(M)},Object.defineProperty(R.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),R})(),$=(function(R){_(M,R);function M(){return R!==null&&R.apply(this,arguments)||this}return M.prototype.setRenderImage=function(ae){this._nativeFileAsset.setRenderImage(ae.nativeImage)},M})(L),K=(function(R){_(M,R);function M(){return R!==null&&R.apply(this,arguments)||this}return M.prototype.setAudioSource=function(ae){this._nativeFileAsset.setAudioSource(ae.nativeAudio)},M})(L),Y=(function(R){_(M,R);function M(){return R!==null&&R.apply(this,arguments)||this}return M.prototype.setFont=function(ae){this._nativeFileAsset.setFont(ae.nativeFont)},M})(L),q=(function(){function R(M){}return R.prototype.register=function(M){M.selfUnref=!0},R.prototype.unregister=function(M){},R})(),J=typeof FinalizationRegistry<"u"?FinalizationRegistry:q,X=new J(function(R){R.unref()})})],r={};function o(c){var f=r[c];if(f!==void 0)return f.exports;var v=r[c]={exports:{}};return t[c](v,v.exports,o),v.exports}o.d=(c,f)=>{for(var v in f)o.o(f,v)&&!o.o(c,v)&&Object.defineProperty(c,v,{enumerable:!0,get:f[v]})},o.o=(c,f)=>Object.prototype.hasOwnProperty.call(c,f),o.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})};var l={};return(()=>{o.r(l),o.d(l,{Alignment:()=>Y,DataEnum:()=>Nt,EventType:()=>Z,Fit:()=>K,Layout:()=>q,LoopType:()=>pe,Rive:()=>Se,RiveEventType:()=>M,RiveFile:()=>Gt,RuntimeLoader:()=>J,StateMachineInput:()=>R,StateMachineInputType:()=>X,Testing:()=>Vr,ViewModel:()=>Pe,ViewModelInstance:()=>Mt,ViewModelInstanceArtboard:()=>en,ViewModelInstanceAssetImage:()=>vr,ViewModelInstanceBoolean:()=>cn,ViewModelInstanceColor:()=>wn,ViewModelInstanceEnum:()=>Ct,ViewModelInstanceList:()=>Kt,ViewModelInstanceNumber:()=>un,ViewModelInstanceString:()=>Zt,ViewModelInstanceTrigger:()=>bn,ViewModelInstanceValue:()=>rt,decodeAudio:()=>qr,decodeFont:()=>En,decodeImage:()=>ki});var c=o(1),f=o(2),v=o(3),_=o(5),y=(function(){var p=function(a,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,C){b.__proto__=C}||function(b,C){for(var x in C)Object.prototype.hasOwnProperty.call(C,x)&&(b[x]=C[x])},p(a,d)};return function(a,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(a,d);function b(){this.constructor=a}a.prototype=d===null?Object.create(d):(b.prototype=d.prototype,new b)}})(),A=function(){return A=Object.assign||function(p){for(var a,d=1,b=arguments.length;d<b;d++){a=arguments[d];for(var C in a)Object.prototype.hasOwnProperty.call(a,C)&&(p[C]=a[C])}return p},A.apply(this,arguments)},k=function(p,a,d,b){function C(x){return x instanceof d?x:new d(function(U){U(x)})}return new(d||(d=Promise))(function(x,U){function le(Ee){try{ie(b.next(Ee))}catch(Le){U(Le)}}function ge(Ee){try{ie(b.throw(Ee))}catch(Le){U(Le)}}function ie(Ee){Ee.done?x(Ee.value):C(Ee.value).then(le,ge)}ie((b=b.apply(p,a||[])).next())})},g=function(p,a){var d={label:0,sent:function(){if(x[0]&1)throw x[1];return x[1]},trys:[],ops:[]},b,C,x,U=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return U.next=le(0),U.throw=le(1),U.return=le(2),typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function le(ie){return function(Ee){return ge([ie,Ee])}}function ge(ie){if(b)throw new TypeError("Generator is already executing.");for(;U&&(U=0,ie[0]&&(d=0)),d;)try{if(b=1,C&&(x=ie[0]&2?C.return:ie[0]?C.throw||((x=C.return)&&x.call(C),0):C.next)&&!(x=x.call(C,ie[1])).done)return x;switch(C=0,x&&(ie=[ie[0]&2,x.value]),ie[0]){case 0:case 1:x=ie;break;case 4:return d.label++,{value:ie[1],done:!1};case 5:d.label++,C=ie[1],ie=[0];continue;case 7:ie=d.ops.pop(),d.trys.pop();continue;default:if(x=d.trys,!(x=x.length>0&&x[x.length-1])&&(ie[0]===6||ie[0]===2)){d=0;continue}if(ie[0]===3&&(!x||ie[1]>x[0]&&ie[1]<x[3])){d.label=ie[1];break}if(ie[0]===6&&d.label<x[1]){d.label=x[1],x=ie;break}if(x&&d.label<x[2]){d.label=x[2],d.ops.push(ie);break}x[2]&&d.ops.pop(),d.trys.pop();continue}ie=a.call(p,d)}catch(Ee){ie=[6,Ee],C=0}finally{b=x=0}if(ie[0]&5)throw ie[1];return{value:ie[0]?ie[1]:void 0,done:!0}}},T=function(p,a,d){if(d||arguments.length===2)for(var b=0,C=a.length,x;b<C;b++)(x||!(b in a))&&(x||(x=Array.prototype.slice.call(a,0,b)),x[b]=a[b]);return p.concat(x||Array.prototype.slice.call(a))},L=(function(p){y(a,p);function a(){var d=p!==null&&p.apply(this,arguments)||this;return d.isHandledError=!0,d}return a})(Error),$=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},K;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(K||(K={}));var Y;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(Y||(Y={}));var q=(function(){function p(a){var d,b,C,x,U,le,ge;this.fit=(d=a?.fit)!==null&&d!==void 0?d:K.Contain,this.alignment=(b=a?.alignment)!==null&&b!==void 0?b:Y.Center,this.layoutScaleFactor=(C=a?.layoutScaleFactor)!==null&&C!==void 0?C:1,this.minX=(x=a?.minX)!==null&&x!==void 0?x:0,this.minY=(U=a?.minY)!==null&&U!==void 0?U:0,this.maxX=(le=a?.maxX)!==null&&le!==void 0?le:0,this.maxY=(ge=a?.maxY)!==null&&ge!==void 0?ge:0}return p.new=function(a){var d=a.fit,b=a.alignment,C=a.minX,x=a.minY,U=a.maxX,le=a.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:d,alignment:b,minX:C,minY:x,maxX:U,maxY:le})},p.prototype.copyWith=function(a){var d=a.fit,b=a.alignment,C=a.layoutScaleFactor,x=a.minX,U=a.minY,le=a.maxX,ge=a.maxY;return new p({fit:d??this.fit,alignment:b??this.alignment,layoutScaleFactor:C??this.layoutScaleFactor,minX:x??this.minX,minY:U??this.minY,maxX:le??this.maxX,maxY:ge??this.maxY})},p.prototype.runtimeFit=function(a){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===K.Cover?d=a.Fit.cover:this.fit===K.Contain?d=a.Fit.contain:this.fit===K.Fill?d=a.Fit.fill:this.fit===K.FitWidth?d=a.Fit.fitWidth:this.fit===K.FitHeight?d=a.Fit.fitHeight:this.fit===K.ScaleDown?d=a.Fit.scaleDown:this.fit===K.Layout?d=a.Fit.layout:d=a.Fit.none,this.cachedRuntimeFit=d,d},p.prototype.runtimeAlignment=function(a){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===Y.TopLeft?d=a.Alignment.topLeft:this.alignment===Y.TopCenter?d=a.Alignment.topCenter:this.alignment===Y.TopRight?d=a.Alignment.topRight:this.alignment===Y.CenterLeft?d=a.Alignment.centerLeft:this.alignment===Y.CenterRight?d=a.Alignment.centerRight:this.alignment===Y.BottomLeft?d=a.Alignment.bottomLeft:this.alignment===Y.BottomCenter?d=a.Alignment.bottomCenter:this.alignment===Y.BottomRight?d=a.Alignment.bottomRight:d=a.Alignment.center,this.cachedRuntimeAlignment=d,d},p})(),J=(function(){function p(){}return p.loadRuntime=function(){c.default({locateFile:function(){return p.wasmURL}}).then(function(a){var d;for(p.runtime=a;p.callBackQueue.length>0;)(d=p.callBackQueue.shift())===null||d===void 0||d(p.runtime)}).catch(function(a){var d={message:a?.message||"Unknown error",type:a?.name||"Error",wasmError:a instanceof WebAssembly.CompileError||a instanceof WebAssembly.RuntimeError,originalError:a};console.debug("Rive WASM load error details:",d);var b="https://cdn.jsdelivr.net/npm/".concat(f.name,"@").concat(f.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==b)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),p.setWasmUrl(b),p.loadRuntime();else{var C=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(b,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(C)}})},p.getInstance=function(a){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?a(p.runtime):p.callBackQueue.push(a)},p.awaitInstance=function(){return new Promise(function(a){return p.getInstance(function(d){return a(d)})})},p.setWasmUrl=function(a){p.wasmURL=a},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(f.name,"@").concat(f.version,"/rive.wasm"),p})(),X;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(X||(X={}));var R=(function(){function p(a,d){this.type=a,this.runtimeInput=d}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(a){this.runtimeInput.value=a},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===X.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),M;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(M||(M={}));var ae=(function(){function p(a){this.nativeArtboard=a}return p})(),de=(function(){function p(a,d,b,C){this.stateMachine=a,this.playing=b,this.artboard=C,this.inputs=[],this.instance=new d.StateMachineInstance(a,C),this.initInputs(d)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var a=[],d=0;d<this.instance.stateChangedCount();d++)a.push(this.instance.stateChangedNameByIndex(d));return a},enumerable:!1,configurable:!0}),p.prototype.advance=function(a){this.instance.advance(a)},p.prototype.advanceAndApply=function(a){this.instance.advanceAndApply(a)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(a){return this.instance.reportedEventAt(a)},p.prototype.initInputs=function(a){for(var d=0;d<this.instance.inputCount();d++){var b=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(b,a))}},p.prototype.mapRuntimeInput=function(a,d){if(a.type===d.SMIInput.bool)return new R(X.Boolean,a.asBool());if(a.type===d.SMIInput.number)return new R(X.Number,a.asNumber());if(a.type===d.SMIInput.trigger)return new R(X.Trigger,a.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(a){a.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(a){a.runtimeInstance!=null&&this.instance.bindViewModelInstance(a.runtimeInstance)},p})(),fe=(function(){function p(a,d,b,C,x){C===void 0&&(C=[]),x===void 0&&(x=[]),this.runtime=a,this.artboard=d,this.eventManager=b,this.animations=C,this.stateMachines=x}return p.prototype.add=function(a,d,b){if(b===void 0&&(b=!0),a=At(a),a.length===0)this.animations.forEach(function(z){return z.playing=d}),this.stateMachines.forEach(function(z){return z.playing=d});else for(var C=this.animations.map(function(z){return z.name}),x=this.stateMachines.map(function(z){return z.name}),U=0;U<a.length;U++){var le=C.indexOf(a[U]),ge=x.indexOf(a[U]);if(le>=0||ge>=0)le>=0?this.animations[le].playing=d:this.stateMachines[ge].playing=d;else{var ie=this.artboard.animationByName(a[U]);if(ie){var Ee=new v.Animation(ie,this.artboard,this.runtime,d);Ee.advance(0),Ee.apply(1),this.animations.push(Ee)}else{var Le=this.artboard.stateMachineByName(a[U]);if(Le){var D=new de(Le,this.runtime,d,this.artboard);this.stateMachines.push(D)}}}}return b&&(d?this.eventManager.fire({type:Z.Play,data:this.playing}):this.eventManager.fire({type:Z.Pause,data:this.paused})),d?this.playing:this.paused},p.prototype.initLinearAnimations=function(a,d){for(var b=this.animations.map(function(ge){return ge.name}),C=0;C<a.length;C++){var x=b.indexOf(a[C]);if(x>=0)this.animations[x].playing=d;else{var U=this.artboard.animationByName(a[C]);if(U){var le=new v.Animation(U,this.artboard,this.runtime,d);le.advance(0),le.apply(1),this.animations.push(le)}else console.error("Animation with name ".concat(a[C]," not found."))}}},p.prototype.initStateMachines=function(a,d){for(var b=this.stateMachines.map(function(ge){return ge.name}),C=0;C<a.length;C++){var x=b.indexOf(a[C]);if(x>=0)this.stateMachines[x].playing=d;else{var U=this.artboard.stateMachineByName(a[C]);if(U){var le=new de(U,this.runtime,d,this.artboard);this.stateMachines.push(le),d||le.advanceAndApply(0)}else console.warn("State Machine with name ".concat(a[C]," not found.")),this.initLinearAnimations([a[C]],d)}}},p.prototype.play=function(a){return this.add(a,!0)},p.prototype.pause=function(a){return this.add(a,!1)},p.prototype.scrub=function(a,d){var b=this.animations.filter(function(C){return a.includes(C.name)});return b.forEach(function(C){return C.scrubTo=d}),b.map(function(C){return C.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(a){return a.playing}).map(function(a){return a.name}).concat(this.stateMachines.filter(function(a){return a.playing}).map(function(a){return a.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(a){return!a.playing}).map(function(a){return a.name}).concat(this.stateMachines.filter(function(a){return!a.playing}).map(function(a){return a.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(a){var d=this;a=At(a);var b=[];if(a.length===0)b=this.animations.map(function(U){return U.name}).concat(this.stateMachines.map(function(U){return U.name})),this.animations.forEach(function(U){return U.cleanup()}),this.stateMachines.forEach(function(U){return U.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var C=this.animations.filter(function(U){return a.includes(U.name)});C.forEach(function(U){U.cleanup(),d.animations.splice(d.animations.indexOf(U),1)});var x=this.stateMachines.filter(function(U){return a.includes(U.name)});x.forEach(function(U){U.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(U),1)}),b=C.map(function(U){return U.name}).concat(x.map(function(U){return U.name}))}return this.eventManager.fire({type:Z.Stop,data:b}),b},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(a,d){return a||d.playing},!1)||this.stateMachines.reduce(function(a,d){return a||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(a,d){d===void 0&&(d=!0);var b;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([b=this.artboard.animationByIndex(0).name],a,d):this.artboard.stateMachineCount()>0&&this.add([b=this.artboard.stateMachineByIndex(0).name],a,d)),b},p.prototype.handleLooping=function(){for(var a=0,d=this.animations.filter(function(C){return C.playing});a<d.length;a++){var b=d[a];b.loopValue===0&&b.loopCount?(b.loopCount=0,this.stop(b.name)):b.loopValue===1&&b.loopCount?(this.eventManager.fire({type:Z.Loop,data:{animation:b.name,type:pe.Loop}}),b.loopCount=0):b.loopValue===2&&b.loopCount>1&&(this.eventManager.fire({type:Z.Loop,data:{animation:b.name,type:pe.PingPong}}),b.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var a=[],d=0,b=this.stateMachines.filter(function(x){return x.playing});d<b.length;d++){var C=b[d];a.push.apply(a,C.statesChanged)}a.length>0&&this.eventManager.fire({type:Z.StateChange,data:a})},p.prototype.handleAdvancing=function(a){this.eventManager.fire({type:Z.Advance,data:a})},p})(),Z;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(Z||(Z={}));var pe;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(pe||(pe={}));var Ve=(function(){function p(a){a===void 0&&(a=[]),this.listeners=a}return p.prototype.getListeners=function(a){return this.listeners.filter(function(d){return d.type===a})},p.prototype.add=function(a){this.listeners.includes(a)||this.listeners.push(a)},p.prototype.remove=function(a){for(var d=0;d<this.listeners.length;d++){var b=this.listeners[d];if(b.type===a.type&&b.callback===a.callback){this.listeners.splice(d,1);break}}},p.prototype.removeAll=function(a){var d=this;a?this.listeners.filter(function(b){return b.type===a}).forEach(function(b){return d.remove(b)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(a){var d=this.getListeners(a.type);d.forEach(function(b){return b.callback(a)})},p})(),ot=(function(){function p(a){this.eventManager=a,this.queue=[]}return p.prototype.add=function(a){this.queue.push(a)},p.prototype.process=function(){for(;this.queue.length>0;){var a=this.queue.shift();a?.action&&a.action(),a?.event&&this.eventManager.fire(a.event)}},p})(),Je;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(Je||(Je={}));var St=(function(p){y(a,p);function a(){var d=p!==null&&p.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=Je.UNAVAILABLE,d}return a.prototype.delay=function(d){return k(this,void 0,void 0,function(){return g(this,function(b){return[2,new Promise(function(C){return setTimeout(C,d)})]})})},a.prototype.timeout=function(){return k(this,void 0,void 0,function(){return g(this,function(d){return[2,new Promise(function(b,C){return setTimeout(C,50)})]})})},a.prototype.reportToListeners=function(){this.fire({type:Z.AudioStatusChange}),this.removeAll()},a.prototype.enableAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(d){return this._enabled||(this._enabled=!0,this._status=Je.AVAILABLE,this.reportToListeners()),[2]})})},a.prototype.testAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!(this._status===Je.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},a.prototype._establishAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==Je.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},a.prototype.listenForUserAction=function(){var d=this,b=function(){return k(d,void 0,void 0,function(){return g(this,function(C){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",b,{once:!0})},a.prototype.establishAudio=function(){return k(this,void 0,void 0,function(){return g(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(a.prototype,"systemVolume",{get:function(){return this._status===Je.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),a})(Ve),Ce=new St,zt=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),ut=globalThis.ResizeObserver||zt,Xe=(function(){function p(){var a=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var b=a._elementsMap.get(d.target);b!==null?b.onResize(d.target.clientWidth==0||d.target.clientHeight==0):a._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(a._onObservedEntry)},this._resizeObserver=new ut(this._onObserved)}return p.prototype.add=function(a,d){var b={onResize:d,element:a};return this._elementsMap.set(a,b),this._resizeObserver.observe(a),b},p.prototype.remove=function(a){this._resizeObserver.unobserve(a.element),this._elementsMap.delete(a.element)},p})(),ft=new Xe,Gt=(function(){function p(a){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=a.src,this.buffer=a.buffer,a.assetLoader&&(this.assetLoader=a.assetLoader),this.enableRiveAssetCDN=typeof a.enableRiveAssetCDN=="boolean"?a.enableRiveAssetCDN:!0,this.eventManager=new Ve,a.onLoad&&this.on(Z.Load,a.onLoad),a.onLoadError&&this.on(Z.LoadError,a.onLoadError)}return p.prototype.initData=function(){return k(this,void 0,void 0,function(){var a,d,b,C,x;return g(this,function(U){switch(U.label){case 0:return this.src?(a=this,[4,pr(this.src)]):[3,2];case 1:a.buffer=U.sent(),U.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(b=new _.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=b.assetLoader),C=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return C.file=U.sent(),this.destroyed?((x=this.file)===null||x===void 0||x.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:Z.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return k(this,void 0,void 0,function(){var a,d;return g(this,function(b){switch(b.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];b.label=1;case 1:return b.trys.push([1,4,,5]),a=this,[4,J.awaitInstance()];case 2:return a.runtime=b.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return b.sent(),[3,5];case 4:return d=b.sent(),this.fireLoadError(d instanceof Error?d.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(a){throw this.eventManager.fire({type:Z.LoadError,data:a}),new Error(a)},p.prototype.on=function(a,d){this.eventManager.add({type:a,callback:d})},p.prototype.off=function(a,d){this.eventManager.remove({type:a,callback:d})},p.prototype.cleanup=function(){var a;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(a=this.file)===null||a===void 0||a.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(a){this.eventManager.removeAll(a)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(a){var d=this.file.artboardByName(a);return d!=null?new ae(d):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),Se=(function(){function p(a){var d=this,b;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(C){var x=d._hasZeroSize!==C;d._hasZeroSize=C,C?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():x&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=a.canvas,a.canvas.constructor===HTMLCanvasElement&&(this._observed=ft.add(this.canvas,this.onCanvasResize)),this.src=a.src,this.buffer=a.buffer,this.riveFile=a.riveFile,this.layout=(b=a.layout)!==null&&b!==void 0?b:new q,this.shouldDisableRiveListeners=!!a.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!a.isTouchScrollEnabled,this.automaticallyHandleEvents=!!a.automaticallyHandleEvents,this.enableRiveAssetCDN=a.enableRiveAssetCDN===void 0?!0:a.enableRiveAssetCDN,this.eventManager=new Ve,a.onLoad&&this.on(Z.Load,a.onLoad),a.onLoadError&&this.on(Z.LoadError,a.onLoadError),a.onPlay&&this.on(Z.Play,a.onPlay),a.onPause&&this.on(Z.Pause,a.onPause),a.onStop&&this.on(Z.Stop,a.onStop),a.onLoop&&this.on(Z.Loop,a.onLoop),a.onStateChange&&this.on(Z.StateChange,a.onStateChange),a.onAdvance&&this.on(Z.Advance,a.onAdvance),a.onload&&!a.onLoad&&this.on(Z.Load,a.onload),a.onloaderror&&!a.onLoadError&&this.on(Z.LoadError,a.onloaderror),a.onplay&&!a.onPlay&&this.on(Z.Play,a.onplay),a.onpause&&!a.onPause&&this.on(Z.Pause,a.onpause),a.onstop&&!a.onStop&&this.on(Z.Stop,a.onstop),a.onloop&&!a.onLoop&&this.on(Z.Loop,a.onloop),a.onstatechange&&!a.onStateChange&&this.on(Z.StateChange,a.onstatechange),a.assetLoader&&(this.assetLoader=a.assetLoader),this.taskQueue=new ot(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:a.autoplay,autoBind:a.autoBind,animations:a.animations,stateMachines:a.stateMachines,artboard:a.artboard,useOffscreenRenderer:a.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(a){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(a)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(a){var d=this,b=a.src,C=a.buffer,x=a.riveFile,U=a.animations,le=a.stateMachines,ge=a.artboard,ie=a.autoplay,Ee=ie===void 0?!1:ie,Le=a.useOffscreenRenderer,D=Le===void 0?!1:Le,z=a.autoBind,ue=z===void 0?!1:z;if(!this.destroyed){if(this.src=b,this.buffer=C,this.riveFile=x,!this.src&&!this.buffer&&!this.riveFile)throw new L(p.missingErrorMessage);var Re=At(U),De=At(le);this.loaded=!1,this.readyForPlaying=!1,J.awaitInstance().then(function(Ue){d.destroyed||(d.runtime=Ue,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,D),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(ge,Re,De,Ee,ue).then(function(it){if(it)return d.setupRiveListeners()}).catch(function(it){console.error(it)}))}).catch(function(Ue){console.error(Ue)})}},p.prototype.setupRiveListeners=function(a){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var b=(this.animator.stateMachines||[]).filter(function(x){return x.playing&&d.runtime.hasListeners(x.instance)}).map(function(x){return x.instance}),C=this.isTouchScrollEnabled;a&&"isTouchScrollEnabled"in a&&(C=a.isTouchScrollEnabled),this.eventCleanup=(0,_.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:b,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:C,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var a=this,d;Ce.status==Je.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:Z.AudioStatusChange,callback:function(){return a.onSystemAudioChanged()}},Ce.add(this._audioEventListener),Ce.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(a,d,b,C,x){return k(this,void 0,void 0,function(){var U,le,ge,ie;return g(this,function(Ee){switch(Ee.label){case 0:return Ee.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(U=new Gt({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=U,[4,U.init()]);case 1:if(Ee.sent(),this.destroyed)return U.destroyIfUnused(),[2,!1];Ee.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(a,d,b,C,x),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:Z.Load,data:(ie=this.src)!==null&&ie!==void 0?ie:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return le=Ee.sent(),ge=$(le),console.warn(ge),this.eventManager.fire({type:Z.LoadError,data:ge}),[2,Promise.reject(ge)];case 4:return[2]}})})},p.prototype.initArtboard=function(a,d,b,C,x){if(this.file){var U=a?this.file.artboardByName(a):this.file.defaultArtboard();if(!U){var le="Invalid artboard name or no default artboard";console.warn(le),this.eventManager.fire({type:Z.LoadError,data:le});return}if(this.artboard=U,U.volume=this._volume*Ce.systemVolume,this.artboard.animationCount()<1){var le="Artboard has no animations";throw this.eventManager.fire({type:Z.LoadError,data:le}),le}this.animator=new fe(this.runtime,this.artboard,this.eventManager);var ge;if(d.length>0||b.length>0?(ge=d.concat(b),this.animator.initLinearAnimations(d,C),this.animator.initStateMachines(b,C)):ge=[this.animator.atLeastOne(C,!1)],this.taskQueue.add({event:{type:C?Z.Play:Z.Pause,data:ge}}),x){var ie=this.file.defaultArtboardViewModel(U);if(ie!==null){var Ee=ie.defaultInstance();if(Ee!==null){var Le=new Mt(Ee,null);this.bindViewModelInstance(Le)}}}}},p.prototype.drawFrame=function(){var a,d;!((a=document?.timeline)===null||a===void 0)&&a.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(a,d){var b;this.frameRequestId=null;var C=performance.now();this.lastRenderTime||(this.lastRenderTime=a),this.renderSecondTimer+=a-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var x=(a-this.lastRenderTime)/1e3;this.lastRenderTime=a;for(var U=this.animator.animations.filter(function(Tt){return Tt.playing||Tt.needsScrub}).sort(function(Tt){return Tt.needsScrub?-1:1}),le=0,ge=U;le<ge.length;le++){var ie=ge[le];ie.advance(x),ie.instance.didLoop&&(ie.loopCount+=1),ie.apply(1)}for(var Ee=this.animator.stateMachines.filter(function(Tt){return Tt.playing}),Le=0,D=Ee;Le<D.length;Le++){var z=D[Le],ue=z.reportedEventCount();if(ue)for(var Re=0;Re<ue;Re++){var De=z.reportedEventAt(Re);if(De)if(De.type===M.OpenUrl){if(this.eventManager.fire({type:Z.RiveEvent,data:De}),this.automaticallyHandleEvents){var Ue=document.createElement("a"),it=De,_t=it.url,tn=it.target,mt=(0,_.sanitizeUrl)(_t);_t&&Ue.setAttribute("href",mt),tn&&Ue.setAttribute("target",tn),mt&&mt!==_.BLANK_URL&&Ue.click()}}else this.eventManager.fire({type:Z.RiveEvent,data:De})}z.advanceAndApply(x)}this.animator.stateMachines.length==0&&this.artboard.advance(x);var re=this.renderer;re.clear(),re.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(re),re.restore(),re.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(x),this.frameCount++;var ye=performance.now();for(this.frameTimes.push(ye),this.durations.push(ye-C);this.frameTimes[0]<=ye-1e3;)this.frameTimes.shift(),this.durations.shift();(b=this._viewModelInstance)===null||b===void 0||b.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var a=this,d=a.renderer,b=a.runtime,C=a._layout,x=a.artboard;d.align(C.runtimeFit(b),C.runtimeAlignment(b),{minX:C.minX,minY:C.minY,maxX:C.maxX,maxY:C.maxY},x.bounds,this._devicePixelRatioUsed*C.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(a,d){return a+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var a,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ft.remove(this._observed),this.removeRiveListeners(),this.file&&((a=this.riveFile)===null||a===void 0||a.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(Ce.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var a;(a=this.renderer)===null||a===void 0||a.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(a){var d;if(!a){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var b=this.artboard.textRun(a);if(!b){console.warn("Could not access a text run with name '".concat(a,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return b},p.prototype.getTextRunValue=function(a){var d=this.retrieveTextRun(a);return d?d.text:void 0},p.prototype.setTextRunValue=function(a,d){var b=this.retrieveTextRun(a);b&&(b.text=d)},p.prototype.play=function(a,d){var b=this;if(a=At(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.play(a,d)}});return}this.animator.play(a),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(a){var d=this;if(a=At(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(a)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(a)},p.prototype.scrub=function(a,d){var b=this;if(a=At(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.scrub(a,d)}});return}this.animator.scrub(a,d||0),this.drawFrame()},p.prototype.stop=function(a){var d=this;if(a=At(a),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(a)}});return}this.animator&&this.animator.stop(a),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(a){var d,b,C=a?.artboard,x=At(a?.animations),U=At(a?.stateMachines),le=(d=a?.autoplay)!==null&&d!==void 0?d:!1,ge=(b=a?.autoBind)!==null&&b!==void 0?b:!1;this.cleanupInstances(),this.initArtboard(C,x,U,le,ge),this.taskQueue.process()},p.prototype.load=function(a){this.file=null,this.stop(),this.init(a)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(a){this._layout=a,(!a.maxX||!a.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(a){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),b=d.width,C=d.height,x=a||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=x,this.canvas.width=x*b,this.canvas.height=x*C,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===K.Layout){var U=this._layout.layoutScaleFactor;this.artboard.width=b/U,this.artboard.height=C/U}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var a=[],d=0;d<this.artboard.animationCount();d++)a.push(this.artboard.animationByIndex(d).name);return a},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var a=[],d=0;d<this.artboard.stateMachineCount();d++)a.push(this.artboard.stateMachineByIndex(d).name);return a},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(a){if(this.loaded){var d=this.animator.stateMachines.find(function(b){return b.name===a});return d?.inputs}},p.prototype.retrieveInputAtPath=function(a,d){if(!a){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(a,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.inputByPath(a,d);if(!b){console.warn("Could not access an input with name: '".concat(a,"', at path:'").concat(d,"'"));return}return b},p.prototype.setBooleanStateAtPath=function(a,d,b){var C=this.retrieveInputAtPath(a,b);C&&(C.type===X.Boolean?C.asBool().value=d:console.warn("Input with name: '".concat(a,"', at path:'").concat(b,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(a,d,b){var C=this.retrieveInputAtPath(a,b);C&&(C.type===X.Number?C.asNumber().value=d:console.warn("Input with name: '".concat(a,"', at path:'").concat(b,"' is not a number")))},p.prototype.fireStateAtPath=function(a,d){var b=this.retrieveInputAtPath(a,d);b&&(b.type===X.Trigger?b.asTrigger().fire():console.warn("Input with name: '".concat(a,"', at path:'").concat(d,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(a,d){if(!a){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(a,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(a,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.textByPath(a,d);if(!b){console.warn("Could not access text with name: '".concat(a,"', at path:'").concat(d,"'"));return}return b},p.prototype.getTextRunValueAtPath=function(a,d){var b=this.retrieveTextAtPath(a,d);if(!b){console.warn("Could not get text with name: '".concat(a,"', at path:'").concat(d,"'"));return}return b.text},p.prototype.setTextRunValueAtPath=function(a,d,b){var C=this.retrieveTextAtPath(a,b);if(!C){console.warn("Could not set text with name: '".concat(a,"', at path:'").concat(b,"'"));return}C.text=d},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(a){return a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(a){return a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(a){return!a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(a){return!a.playing}).map(function(a){return a.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(a,d){this.eventManager.add({type:a,callback:d})},p.prototype.off=function(a,d){this.eventManager.remove({type:a,callback:d})},p.prototype.unsubscribe=function(a,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(a,d)},p.prototype.removeAllRiveEventListeners=function(a){this.eventManager.removeAll(a)},p.prototype.unsubscribeAll=function(a){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(a)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(a){this.runtime.enableFPSCounter(a)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var a={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var b=this.file.artboardByIndex(d),C={name:b.name,animations:[],stateMachines:[]},x=0;x<b.animationCount();x++){var U=b.animationByIndex(x);C.animations.push(U.name)}for(var le=0;le<b.stateMachineCount();le++){for(var ge=b.stateMachineByIndex(le),ie=ge.name,Ee=new this.runtime.StateMachineInstance(ge,b),Le=[],D=0;D<Ee.inputCount();D++){var z=Ee.input(D);Le.push({name:z.name,type:z.type})}C.stateMachines.push({name:ie,inputs:Le})}a.artboards.push(C)}return a}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(a){this._volume=a,this.artboard&&(this.artboard.volume=a*Ce.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var a;return this.artboard?this.artboard.width:(a=this._artboardWidth)!==null&&a!==void 0?a:0},set:function(a){this._artboardWidth=a,this.artboard&&(this.artboard.width=a)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var a;return this.artboard?this.artboard.height:(a=this._artboardHeight)!==null&&a!==void 0?a:0},set:function(a){this._artboardHeight=a,this.artboard&&(this.artboard.height=a)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(a){this._devicePixelRatioUsed=a},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(a){var d;this.artboard&&!this.destroyed&&a&&a.runtimeInstance&&(a.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=a,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(b){return b.bindViewModelInstance(a)}):this.artboard.bindViewModelInstance(a.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(a){var d=this.file.viewModelByIndex(a);return d!==null?new Pe(d):null},p.prototype.viewModelByName=function(a){var d=this.file.viewModelByName(a);return d!==null?new Pe(d):null},p.prototype.enums=function(){if(this._dataEnums===null){var a=this.file.enums();this._dataEnums=a.map(function(d){return new Nt(d)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var a=this.file.defaultArtboardViewModel(this.artboard);if(a)return new Pe(a)}return null},p.prototype.getArtboard=function(a){var d,b;return(b=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(a))!==null&&b!==void 0?b:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),Pe=(function(){function p(a){this._viewModel=a}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(a){var d=this._viewModel.instanceByIndex(a);return d!==null?new Mt(d,null):null},p.prototype.instanceByName=function(a){var d=this._viewModel.instanceByName(a);return d!==null?new Mt(d,null):null},p.prototype.defaultInstance=function(){var a=this._viewModel.defaultInstance();return a!==null?new Mt(a,null):null},p.prototype.instance=function(){var a=this._viewModel.instance();return a!==null?new Mt(a,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),Nt=(function(){function p(a){this._dataEnum=a}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),qe;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(qe||(qe={}));var Mt=(function(){function p(a,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=a,d!==null&&this._parents.push(d)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(a){a.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(a){a.clearChanges()})),this._children.forEach(function(a){return a.handleCallbacks()})},p.prototype.addParent=function(a){this._parents.includes(a)||(this._parents.push(a),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&a.addToViewModelCallbacks(this))},p.prototype.removeParent=function(a){var d=this._parents.indexOf(a);if(d!==-1){var b=this._parents[d];b.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},p.prototype.addToPropertyCallbacks=function(a){var d=this;this._propertiesWithCallbacks.includes(a)||(this._propertiesWithCallbacks.push(a),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},p.prototype.removeFromPropertyCallbacks=function(a){var d=this;this._propertiesWithCallbacks.includes(a)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(b){return b!==a}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},p.prototype.addToViewModelCallbacks=function(a){var d=this;this._children.includes(a)||(this._children.push(a),this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},p.prototype.removeFromViewModelCallbacks=function(a){var d=this;this._children.includes(a)&&(this._children=this._children.filter(function(b){return b!==a}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(a){a.clearCallbacks()})},p.prototype.propertyFromPath=function(a,d){var b=a.split("/");return this.propertyFromPathSegments(b,0,d)},p.prototype.viewModelFromPathSegments=function(a,d){var b=this.internalViewModelInstance(a[d]);return b!==null?d==a.length-1?b:b.viewModelFromPathSegments(a,d++):null},p.prototype.propertyFromPathSegments=function(a,d,b){var C,x,U,le,ge,ie,Ee,Le,D,z,ue,Re,De,Ue,it,_t,tn,mt;if(d<a.length-1){var re=this.internalViewModelInstance(a[d]);return re!==null?re.propertyFromPathSegments(a,d+1,b):null}var ye=null;switch(b){case qe.Number:if(ye=(x=(C=this._runtimeInstance)===null||C===void 0?void 0:C.number(a[d]))!==null&&x!==void 0?x:null,ye!==null)return new un(ye,this);break;case qe.String:if(ye=(le=(U=this._runtimeInstance)===null||U===void 0?void 0:U.string(a[d]))!==null&&le!==void 0?le:null,ye!==null)return new Zt(ye,this);break;case qe.Boolean:if(ye=(ie=(ge=this._runtimeInstance)===null||ge===void 0?void 0:ge.boolean(a[d]))!==null&&ie!==void 0?ie:null,ye!==null)return new cn(ye,this);break;case qe.Color:if(ye=(Le=(Ee=this._runtimeInstance)===null||Ee===void 0?void 0:Ee.color(a[d]))!==null&&Le!==void 0?Le:null,ye!==null)return new wn(ye,this);break;case qe.Trigger:if(ye=(z=(D=this._runtimeInstance)===null||D===void 0?void 0:D.trigger(a[d]))!==null&&z!==void 0?z:null,ye!==null)return new bn(ye,this);break;case qe.Enum:if(ye=(Re=(ue=this._runtimeInstance)===null||ue===void 0?void 0:ue.enum(a[d]))!==null&&Re!==void 0?Re:null,ye!==null)return new Ct(ye,this);break;case qe.List:if(ye=(Ue=(De=this._runtimeInstance)===null||De===void 0?void 0:De.list(a[d]))!==null&&Ue!==void 0?Ue:null,ye!==null)return new Kt(ye,this);break;case qe.Image:if(ye=(_t=(it=this._runtimeInstance)===null||it===void 0?void 0:it.image(a[d]))!==null&&_t!==void 0?_t:null,ye!==null)return new vr(ye,this);break;case qe.Artboard:if(ye=(mt=(tn=this._runtimeInstance)===null||tn===void 0?void 0:tn.artboard(a[d]))!==null&&mt!==void 0?mt:null,ye!==null)return new en(ye,this);break}return null},p.prototype.internalViewModelInstance=function(a){var d;if(this._viewModelInstances.has(a))return this._viewModelInstances.get(a);var b=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(a);if(b!==null){var C=new p(b,this);return C.internalIncrementReferenceCount(),this._viewModelInstances.set(a,C),C}return null},p.prototype.number=function(a){var d=this.propertyFromPath(a,qe.Number);return d},p.prototype.string=function(a){var d=this.propertyFromPath(a,qe.String);return d},p.prototype.boolean=function(a){var d=this.propertyFromPath(a,qe.Boolean);return d},p.prototype.color=function(a){var d=this.propertyFromPath(a,qe.Color);return d},p.prototype.trigger=function(a){var d=this.propertyFromPath(a,qe.Trigger);return d},p.prototype.enum=function(a){var d=this.propertyFromPath(a,qe.Enum);return d},p.prototype.list=function(a){var d=this.propertyFromPath(a,qe.List);return d},p.prototype.image=function(a){var d=this.propertyFromPath(a,qe.Image);return d},p.prototype.artboard=function(a){var d=this.propertyFromPath(a,qe.Artboard);return d},p.prototype.viewModel=function(a){var d=a.split("/"),b=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return b!=null?b.internalViewModelInstance(d[d.length-1]):null},p.prototype.internalReplaceViewModel=function(a,d){var b;if(d.runtimeInstance!==null){var C=((b=this._runtimeInstance)===null||b===void 0?void 0:b.replaceViewModel(a,d.runtimeInstance))||!1;if(C){d.internalIncrementReferenceCount();var x=this.internalViewModelInstance(a);x!==null&&(x.removeParent(this),this._children.includes(x)&&(this._children=this._children.filter(function(U){return U!==x})),x.cleanup()),this._viewModelInstances.set(a,d),d.addParent(this)}return C}return!1},p.prototype.replaceViewModel=function(a,d){var b,C=a.split("/"),x=C.length>1?this.viewModelFromPathSegments(C.slice(0,C.length-1),0):this;return(b=x?.internalReplaceViewModel(C[C.length-1],d))!==null&&b!==void 0?b:!1},p.prototype.incrementReferenceCount=function(){var a;this._referenceCount++,(a=this._runtimeInstance)===null||a===void 0||a.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var a;this._referenceCount--,(a=this._runtimeInstance)===null||a===void 0||a.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var a;return((a=this._runtimeInstance)===null||a===void 0?void 0:a.getProperties().map(function(d){return A({},d)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var a=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(C){C.cleanup()}),this._viewModelInstances.clear();var d=T([],this._children,!0);this._children.length=0;var b=T([],this._parents,!0);this._parents.length=0,d.forEach(function(C){C.removeParent(a)}),b.forEach(function(C){C.removeFromViewModelCallbacks(a)})}},p})(),rt=(function(){function p(a,d){this.callbacks=[],this._viewModelInstanceValue=a,this._parentViewModel=d}return p.prototype.on=function(a){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(a)||(this.callbacks.push(a),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(a){a?this.callbacks=this.callbacks.filter(function(d){return d!==a}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(a){},p.prototype.handleCallbacks=function(){var a=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){a.internalHandleCallback(d)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),Zt=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d(this.value)},a})(rt),un=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d(this.value)},a})(rt),cn=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d(this.value)},a})(rt),bn=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return a.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},a.prototype.internalHandleCallback=function(d){d()},a})(rt),Ct=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d(this.value)},a})(rt),Kt=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),a.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},a.prototype.addInstanceAt=function(d,b){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,b)?(d.addParent(this._parentViewModel),!0):!1},a.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},a.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},a.prototype.instanceAt=function(d){var b=this._viewModelInstanceValue.instanceAt(d);if(b!=null){var C=new Mt(b,this._parentViewModel);return C}return null},a.prototype.swap=function(d,b){this._viewModelInstanceValue.swap(d,b)},a.prototype.internalHandleCallback=function(d){d()},a})(rt),wn=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),a.prototype.rgb=function(d,b,C){this._viewModelInstanceValue.rgb(d,b,C)},a.prototype.rgba=function(d,b,C,x){this._viewModelInstanceValue.argb(x,d,b,C)},a.prototype.argb=function(d,b,C,x){this._viewModelInstanceValue.argb(d,b,C,x)},a.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},a.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},a.prototype.internalHandleCallback=function(d){d(this.value)},a})(rt),vr=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeImage)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d()},a})(rt),en=(function(p){y(a,p);function a(d,b){return p.call(this,d,b)||this}return Object.defineProperty(a.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeArtboard)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),a.prototype.internalHandleCallback=function(d){d()},a})(rt),pr=function(p){return k(void 0,void 0,void 0,function(){var a,d,b;return g(this,function(C){switch(C.label){case 0:return a=new Request(p),[4,fetch(a)];case 1:return d=C.sent(),[4,d.arrayBuffer()];case 2:return b=C.sent(),[2,b]}})})},At=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},Vr={EventManager:Ve,TaskQueueManager:ot},qr=function(p){return k(void 0,void 0,void 0,function(){var a,d,b;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(x){return J.getInstance(function(U){U.decodeAudio(p,x)})}),[4,a];case 1:return d=C.sent(),b=new _.AudioWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})},ki=function(p){return k(void 0,void 0,void 0,function(){var a,d,b;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(x){return J.getInstance(function(U){U.decodeImage(p,x)})}),[4,a];case 1:return d=C.sent(),b=new _.ImageWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})},En=function(p){return k(void 0,void 0,void 0,function(){var a,d,b;return g(this,function(C){switch(C.label){case 0:return a=new Promise(function(x){return J.getInstance(function(U){U.decodeFont(p,x)})}),[4,a];case 1:return d=C.sent(),b=new _.FontWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})}})(),l})())})(ys)),ys.exports}var id=rd();const Ts="dracula",sd="dracula_story_v3.json",Is="https://vycjpmuyscfygstjjied.supabase.co";var od=_e('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Da(n,e){Ki(e,!0);let t=nt(void 0);qo(()=>{if(!E(t))return;const l=new id.Rive({src:`${Is}/storage/v1/object/public/${Ts}/${e.fileName}`,canvas:E(t),autoplay:!0,stateMachines:"SM1"});return()=>{l.cleanup()}});var r=od(),o=F(r);Yc(o,l=>he(t,l),()=>E(t)),oe(n,r),Yi()}function ad(n,e){E(e)?.nextDialogueId&&Vt.goToDialogue(E(e).nextDialogueId)}var ld=_e('<img alt="BG" class="background-image svelte-ik8jti"/>'),ud=_e('<div class="background-media svelte-ik8jti"><!></div>'),cd=_e('<img alt="Char" class="character-image svelte-ik8jti"/>'),dd=_e('<div class="character-media svelte-ik8jti"><!></div>'),hd=(n,e,t)=>e(E(t)),fd=_e('<button class="option-button svelte-ik8jti"> </button>'),vd=_e('<div class="options-container svelte-ik8jti"></div>'),pd=_e('<div class="next-container svelte-ik8jti"><button class="next-button svelte-ik8jti">Далее...</button></div>'),gd=_e('<div class="dialogue-container svelte-ik8jti"><!> <!> <div class="dialogue-content svelte-ik8jti"><div class="dialogue-text svelte-ik8jti"> </div> <!></div></div>'),_d=_e("<p> </p>");function Jl(n,e){Ki(e,!0);const t=Or(()=>e.dialogue||Vt.findDialogue(Vt.currentDialogueId));js(()=>{E(t)?.onEnter&&Vt.runActions(E(t).onEnter)});function r(_){if(_.actions&&Vt.runActions(_.actions),_.miniGame){console.log("Запуск мини-игры:",_.miniGame.id),Vt.goToDialogue(_.miniGame.onWinDialogueId);return}_.nextDialogueId&&Vt.goToDialogue(_.nextDialogueId)}function o(_){return _.visibleIf&&_.visibleIf.hasItem?Vt.hasItem(_.visibleIf.hasItem):!0}var l=mn(),c=qt(l);{var f=_=>{var y=gd(),A=F(y);{var k=X=>{var R=ud(),M=F(R);{var ae=fe=>{var Z=mn(),pe=qt(Z);Ra(pe,()=>E(t).backgroundImage,Ve=>{Da(Ve,{get fileName(){return E(t).backgroundImage}})}),oe(fe,Z)},de=fe=>{var Z=ld();et(()=>Oa(Z,"src",`${Is}/storage/v1/object/public/${Ts}/${E(t).backgroundImage}`)),oe(fe,Z)};Ye(M,fe=>{E(t).backgroundImage.endsWith(".riv")?fe(ae):fe(de,!1)})}oe(X,R)};Ye(A,X=>{E(t).backgroundImage&&X(k)})}var g=B(A,2);{var T=X=>{var R=dd(),M=F(R);{var ae=fe=>{var Z=mn(),pe=qt(Z);Ra(pe,()=>E(t).characterImage,Ve=>{Da(Ve,{get fileName(){return E(t).characterImage}})}),oe(fe,Z)},de=fe=>{var Z=cd();et(()=>Oa(Z,"src",`${Is}/storage/v1/object/public/${Ts}/${E(t).characterImage}`)),oe(fe,Z)};Ye(M,fe=>{E(t).characterImage.endsWith(".riv")?fe(ae):fe(de,!1)})}oe(X,R)};Ye(g,X=>{E(t).characterImage&&X(T)})}var L=B(g,2),$=F(L),K=F($),Y=B($,2);{var q=X=>{var R=vd();jt(R,21,()=>E(t).options,M=>M.text,(M,ae)=>{var de=mn(),fe=qt(de);{var Z=pe=>{var Ve=fd();Ve.__click=[hd,r,ae];var ot=F(Ve);et(()=>ze(ot,E(ae).text)),oe(pe,Ve)};Ye(fe,pe=>{o(E(ae))&&pe(Z)})}oe(M,de)}),oe(X,R)},J=X=>{var R=mn(),M=qt(R);{var ae=de=>{var fe=pd(),Z=F(fe);Z.__click=[ad,t],oe(de,fe)};Ye(M,de=>{E(t).nextDialogueId&&de(ae)},!0)}oe(X,R)};Ye(Y,X=>{E(t).options&&E(t).options.length>0?X(q):X(J,!1)})}et(()=>ze(K,E(t).text)),oe(_,y)},v=_=>{var y=_d(),A=F(y);et(()=>ze(A,`Диалог не найден (ID: ${Vt.currentDialogueId??""})`)),oe(_,y)};Ye(c,_=>{E(t)?_(f):_(v,!1)})}oe(n,l),Yi()}zl(["click"]);var md=_e('<div class="loading svelte-fgmugb"><p>🔄 Загрузка истории...</p></div>'),yd=_e('<div class="error svelte-fgmugb"> </div>'),bd=_e('<div class="dialogues-container svelte-fgmugb"><!></div>'),wd=_e('<div class="app svelte-fgmugb"><!></div>');function Ed(n,e){Ki(e,!1);let t=`${Is}/storage/v1/object/public/${Ts}/${sd}`;qo(async()=>{console.log("Загружаем историю из:",t),await Vt.loadStory(t)}),Jc();var r=wd(),o=F(r);{var l=f=>{var v=md();oe(f,v)},c=f=>{var v=mn(),_=qt(v);{var y=k=>{var g=yd(),T=F(g);et(()=>ze(T,`⚠️ ${Vt.error??""}`)),oe(k,g)},A=k=>{var g=bd(),T=F(g);{var L=$=>{Jl($,{})};Ye(T,$=>{Vt.storyData&&$(L)})}oe(k,g)};Ye(_,k=>{Vt.error?k(y):k(A,!1)},!0)}oe(f,v)};Ye(o,f=>{Vt.isLoading?f(l):f(c,!1)})}oe(n,r),Yi()}const Ad="modulepreload",kd=function(n,e){return new URL(n,e).href},Ua={},Xi=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){let _=function(y){return Promise.all(y.map(A=>Promise.resolve(A).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const c=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),v=f?.nonce||f?.getAttribute("nonce");o=_(t.map(y=>{if(y=kd(y,r),y in Ua)return;Ua[y]=!0;const A=y.endsWith(".css"),k=A?'[rel="stylesheet"]':"";if(!!r)for(let L=c.length-1;L>=0;L--){const $=c[L];if($.href===y&&(!A||$.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${k}`))return;const T=document.createElement("link");if(T.rel=A?"stylesheet":Ad,A||(T.as="script"),T.crossOrigin="",T.href=y,v&&T.setAttribute("nonce",v),document.head.appendChild(T),A)return new Promise((L,$)=>{T.addEventListener("load",L),T.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${y}`)))})}))}function l(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return o.then(c=>{for(const f of c||[])f.status==="rejected"&&l(f.reason);return e().catch(l)})},jd=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xi(async()=>{const{default:r}=await Promise.resolve().then(()=>Ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ho extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Sd extends Ho{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Na extends Ho{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ba extends Ho{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var _o;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(_o||(_o={}));var Cd=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class Td{constructor(e,{headers:t={},customFetch:r,region:o=_o.Any}={}){this.url=e,this.headers=t,this.region=o,this.fetch=jd(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Cd(this,void 0,void 0,function*(){try{const{headers:o,method:l,body:c}=t;let f={},{region:v}=t;v||(v=this.region);const _=new URL(`${this.url}/${e}`);v&&v!=="any"&&(f["x-region"]=v,_.searchParams.set("forceFunctionRegion",v));let y;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(f["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(f["Content-Type"]="application/json",y=JSON.stringify(c)));const A=yield this.fetch(_.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),o),body:y}).catch(L=>{throw new Sd(L)}),k=A.headers.get("x-relay-error");if(k&&k==="true")throw new Na(A);if(!A.ok)throw new Ba(A);let g=((r=A.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),T;return g==="application/json"?T=yield A.json():g==="application/octet-stream"?T=yield A.blob():g==="text/event-stream"?T=A:g==="multipart/form-data"?T=yield A.formData():T=yield A.text(),{data:T,error:null,response:A}}catch(o){return{data:null,error:o,response:o instanceof Ba||o instanceof Na?o.context:void 0}}})}}var wt={},ti={},ni={},ri={},ii={},si={},Id=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mi=Id();const Pd=mi.fetch,Xl=mi.fetch.bind(mi),Ql=mi.Headers,Rd=mi.Request,Od=mi.Response,Ai=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ql,Request:Rd,Response:Od,default:Xl,fetch:Pd},Symbol.toStringTag,{value:"Module"})),xd=td(Ai);var hs={},Wa;function Zl(){if(Wa)return hs;Wa=1,Object.defineProperty(hs,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return hs.default=n,hs}var Va;function eu(){if(Va)return si;Va=1;var n=si&&si.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(si,"__esModule",{value:!0});const e=n(xd),t=n(Zl());class r{constructor(l){var c,f;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(c=l.shouldThrowOnError)!==null&&c!==void 0?c:!1,this.signal=l.signal,this.isMaybeSingle=(f=l.isMaybeSingle)!==null&&f!==void 0?f:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,c){return this.headers=new Headers(this.headers),this.headers.set(l,c),this}then(l,c){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let v=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async _=>{var y,A,k,g;let T=null,L=null,$=null,K=_.status,Y=_.statusText;if(_.ok){if(this.method!=="HEAD"){const R=await _.text();R===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((y=this.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?L=R:L=JSON.parse(R))}const J=(A=this.headers.get("Prefer"))===null||A===void 0?void 0:A.match(/count=(exact|planned|estimated)/),X=(k=_.headers.get("content-range"))===null||k===void 0?void 0:k.split("/");J&&X&&X.length>1&&($=parseInt(X[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(L)&&(L.length>1?(T={code:"PGRST116",details:`Results contain ${L.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},L=null,$=null,K=406,Y="Not Acceptable"):L.length===1?L=L[0]:L=null)}else{const J=await _.text();try{T=JSON.parse(J),Array.isArray(T)&&_.status===404&&(L=[],T=null,K=200,Y="OK")}catch{_.status===404&&J===""?(K=204,Y="No Content"):T={message:J}}if(T&&this.isMaybeSingle&&(!((g=T?.details)===null||g===void 0)&&g.includes("0 rows"))&&(T=null,K=200,Y="OK"),T&&this.shouldThrowOnError)throw new t.default(T)}return{error:T,data:L,count:$,status:K,statusText:Y}});return this.shouldThrowOnError||(v=v.catch(_=>{var y,A,k;return{error:{message:`${(y=_?.name)!==null&&y!==void 0?y:"FetchError"}: ${_?.message}`,details:`${(A=_?.stack)!==null&&A!==void 0?A:""}`,hint:"",code:`${(k=_?.code)!==null&&k!==void 0?k:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,c)}returns(){return this}overrideTypes(){return this}}return si.default=r,si}var qa;function tu(){if(qa)return ii;qa=1;var n=ii&&ii.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ii,"__esModule",{value:!0});const e=n(eu());class t extends e.default{select(o){let l=!1;const c=(o??"*").split("").map(f=>/\s/.test(f)&&!l?"":(f==='"'&&(l=!l),f)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:l=!0,nullsFirst:c,foreignTable:f,referencedTable:v=f}={}){const _=v?`${v}.order`:"order",y=this.url.searchParams.get(_);return this.url.searchParams.set(_,`${y?`${y},`:""}${o}.${l?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:l,referencedTable:c=l}={}){const f=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(f,`${o}`),this}range(o,l,{foreignTable:c,referencedTable:f=c}={}){const v=typeof f>"u"?"offset":`${f}.offset`,_=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(v,`${o}`),this.url.searchParams.set(_,`${l-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:l=!1,settings:c=!1,buffers:f=!1,wal:v=!1,format:_="text"}={}){var y;const A=[o?"analyze":null,l?"verbose":null,c?"settings":null,f?"buffers":null,v?"wal":null].filter(Boolean).join("|"),k=(y=this.headers.get("Accept"))!==null&&y!==void 0?y:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${_}; for="${k}"; options=${A};`),_==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}}return ii.default=t,ii}var Ha;function zo(){if(Ha)return ri;Ha=1;var n=ri&&ri.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ri,"__esModule",{value:!0});const e=n(tu());class t extends e.default{eq(o,l){return this.url.searchParams.append(o,`eq.${l}`),this}neq(o,l){return this.url.searchParams.append(o,`neq.${l}`),this}gt(o,l){return this.url.searchParams.append(o,`gt.${l}`),this}gte(o,l){return this.url.searchParams.append(o,`gte.${l}`),this}lt(o,l){return this.url.searchParams.append(o,`lt.${l}`),this}lte(o,l){return this.url.searchParams.append(o,`lte.${l}`),this}like(o,l){return this.url.searchParams.append(o,`like.${l}`),this}likeAllOf(o,l){return this.url.searchParams.append(o,`like(all).{${l.join(",")}}`),this}likeAnyOf(o,l){return this.url.searchParams.append(o,`like(any).{${l.join(",")}}`),this}ilike(o,l){return this.url.searchParams.append(o,`ilike.${l}`),this}ilikeAllOf(o,l){return this.url.searchParams.append(o,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(o,l){return this.url.searchParams.append(o,`ilike(any).{${l.join(",")}}`),this}is(o,l){return this.url.searchParams.append(o,`is.${l}`),this}in(o,l){const c=Array.from(new Set(l)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(o,`in.(${c})`),this}contains(o,l){return typeof l=="string"?this.url.searchParams.append(o,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(o,`cs.{${l.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(l)}`),this}containedBy(o,l){return typeof l=="string"?this.url.searchParams.append(o,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(o,`cd.{${l.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(l)}`),this}rangeGt(o,l){return this.url.searchParams.append(o,`sr.${l}`),this}rangeGte(o,l){return this.url.searchParams.append(o,`nxl.${l}`),this}rangeLt(o,l){return this.url.searchParams.append(o,`sl.${l}`),this}rangeLte(o,l){return this.url.searchParams.append(o,`nxr.${l}`),this}rangeAdjacent(o,l){return this.url.searchParams.append(o,`adj.${l}`),this}overlaps(o,l){return typeof l=="string"?this.url.searchParams.append(o,`ov.${l}`):this.url.searchParams.append(o,`ov.{${l.join(",")}}`),this}textSearch(o,l,{config:c,type:f}={}){let v="";f==="plain"?v="pl":f==="phrase"?v="ph":f==="websearch"&&(v="w");const _=c===void 0?"":`(${c})`;return this.url.searchParams.append(o,`${v}fts${_}.${l}`),this}match(o){return Object.entries(o).forEach(([l,c])=>{this.url.searchParams.append(l,`eq.${c}`)}),this}not(o,l,c){return this.url.searchParams.append(o,`not.${l}.${c}`),this}or(o,{foreignTable:l,referencedTable:c=l}={}){const f=c?`${c}.or`:"or";return this.url.searchParams.append(f,`(${o})`),this}filter(o,l,c){return this.url.searchParams.append(o,`${l}.${c}`),this}}return ri.default=t,ri}var za;function nu(){if(za)return ni;za=1;var n=ni&&ni.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ni,"__esModule",{value:!0});const e=n(zo());class t{constructor(o,{headers:l={},schema:c,fetch:f}){this.url=o,this.headers=new Headers(l),this.schema=c,this.fetch=f}select(o,{head:l=!1,count:c}={}){const f=l?"HEAD":"GET";let v=!1;const _=(o??"*").split("").map(y=>/\s/.test(y)&&!v?"":(y==='"'&&(v=!v),y)).join("");return this.url.searchParams.set("select",_),c&&this.headers.append("Prefer",`count=${c}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:l,defaultToNull:c=!0}={}){var f;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const _=o.reduce((y,A)=>y.concat(Object.keys(A)),[]);if(_.length>0){const y=[...new Set(_)].map(A=>`"${A}"`);this.url.searchParams.set("columns",y.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(o,{onConflict:l,ignoreDuplicates:c=!1,count:f,defaultToNull:v=!0}={}){var _;const y="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),f&&this.headers.append("Prefer",`count=${f}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const A=o.reduce((k,g)=>k.concat(Object.keys(g)),[]);if(A.length>0){const k=[...new Set(A)].map(g=>`"${g}"`);this.url.searchParams.set("columns",k.join(","))}}return new e.default({method:y,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}update(o,{count:l}={}){var c;const f="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:o}={}){var l;const c="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return ni.default=t,ni}var Ga;function Md(){if(Ga)return ti;Ga=1;var n=ti&&ti.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(ti,"__esModule",{value:!0});const e=n(nu()),t=n(zo());class r{constructor(l,{headers:c={},schema:f,fetch:v}={}){this.url=l,this.headers=new Headers(c),this.schemaName=f,this.fetch=v}from(l){const c=new URL(`${this.url}/${l}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,c={},{head:f=!1,get:v=!1,count:_}={}){var y;let A;const k=new URL(`${this.url}/rpc/${l}`);let g;f||v?(A=f?"HEAD":"GET",Object.entries(c).filter(([L,$])=>$!==void 0).map(([L,$])=>[L,Array.isArray($)?`{${$.join(",")}}`:`${$}`]).forEach(([L,$])=>{k.searchParams.append(L,$)})):(A="POST",g=c);const T=new Headers(this.headers);return _&&T.set("Prefer",`count=${_}`),new t.default({method:A,url:k,headers:T,schema:this.schemaName,body:g,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}}return ti.default=r,ti}var Ka;function Ld(){if(Ka)return wt;Ka=1;var n=wt&&wt.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(wt,"__esModule",{value:!0}),wt.PostgrestError=wt.PostgrestBuilder=wt.PostgrestTransformBuilder=wt.PostgrestFilterBuilder=wt.PostgrestQueryBuilder=wt.PostgrestClient=void 0;const e=n(Md());wt.PostgrestClient=e.default;const t=n(nu());wt.PostgrestQueryBuilder=t.default;const r=n(zo());wt.PostgrestFilterBuilder=r.default;const o=n(tu());wt.PostgrestTransformBuilder=o.default;const l=n(eu());wt.PostgrestBuilder=l.default;const c=n(Zl());return wt.PostgrestError=c.default,wt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:c.default},wt}var $d=Ld();const Fd=ed($d),{PostgrestClient:Dd,PostgrestQueryBuilder:Sv,PostgrestFilterBuilder:Cv,PostgrestTransformBuilder:Tv,PostgrestBuilder:Iv,PostgrestError:Pv}=Fd;class Ud{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Nd="2.15.1",Bd=`realtime-js/${Nd}`,Wd="1.0.0",mo=1e4,Vd=1e3,qd=100;var Di;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Di||(Di={}));var pt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(pt||(pt={}));var _n;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(_n||(_n={}));var yo;(function(n){n.websocket="websocket"})(yo||(yo={}));var Lr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Lr||(Lr={}));class Hd{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const o=t.getUint8(1),l=t.getUint8(2);let c=this.HEADER_LENGTH+2;const f=r.decode(e.slice(c,c+o));c=c+o;const v=r.decode(e.slice(c,c+l));c=c+l;const _=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{ref:null,topic:f,event:v,payload:_}}}class ru{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qe;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Qe||(Qe={}));const Ya=(n,e,t={})=>{var r;const o=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,c)=>(l[c]=zd(c,n,e,o),l),{})},zd=(n,e,t,r)=>{const o=e.find(f=>f.name===n),l=o?.type,c=t[n];return l&&!r.includes(l)?iu(l,c):bo(c)},iu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return Jd(e,t)}switch(n){case Qe.bool:return Gd(e);case Qe.float4:case Qe.float8:case Qe.int2:case Qe.int4:case Qe.int8:case Qe.numeric:case Qe.oid:return Kd(e);case Qe.json:case Qe.jsonb:return Yd(e);case Qe.timestamp:return Xd(e);case Qe.abstime:case Qe.date:case Qe.daterange:case Qe.int4range:case Qe.int8range:case Qe.money:case Qe.reltime:case Qe.text:case Qe.time:case Qe.timestamptz:case Qe.timetz:case Qe.tsrange:case Qe.tstzrange:return bo(e);default:return bo(e)}},bo=n=>n,Gd=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Kd=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Yd=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Jd=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const c=n.slice(1,t);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(f=>iu(e,f))}return n},Xd=n=>typeof n=="string"?n.replace(" ","T"):n,su=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class ro{constructor(e,t,r={},o=mo){this.channel=e,this.event=t,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ja;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Ja||(Ja={}));class Ui{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:l,onLeave:c,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ui.syncState(this.state,o,l,c),this.pendingDiffs.forEach(v=>{this.state=Ui.syncDiff(this.state,v,l,c)}),this.pendingDiffs=[],f()}),this.channel._on(r.diff,{},o=>{const{onJoin:l,onLeave:c,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Ui.syncDiff(this.state,o,l,c),f())}),this.onJoin((o,l,c)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:l,newPresences:c})}),this.onLeave((o,l,c)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,o){const l=this.cloneDeep(e),c=this.transformState(t),f={},v={};return this.map(l,(_,y)=>{c[_]||(v[_]=y)}),this.map(c,(_,y)=>{const A=l[_];if(A){const k=y.map($=>$.presence_ref),g=A.map($=>$.presence_ref),T=y.filter($=>g.indexOf($.presence_ref)<0),L=A.filter($=>k.indexOf($.presence_ref)<0);T.length>0&&(f[_]=T),L.length>0&&(v[_]=L)}else f[_]=y}),this.syncDiff(l,{joins:f,leaves:v},r,o)}static syncDiff(e,t,r,o){const{joins:l,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(l,(f,v)=>{var _;const y=(_=e[f])!==null&&_!==void 0?_:[];if(e[f]=this.cloneDeep(v),y.length>0){const A=e[f].map(g=>g.presence_ref),k=y.filter(g=>A.indexOf(g.presence_ref)<0);e[f].unshift(...k)}r(f,y,v)}),this.map(c,(f,v)=>{let _=e[f];if(!_)return;const y=v.map(A=>A.presence_ref);_=_.filter(A=>y.indexOf(A.presence_ref)<0),e[f]=_,o(f,_,v),_.length===0&&delete e[f]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const o=e[r];return"metas"in o?t[r]=o.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=o,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Xa;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Xa||(Xa={}));var Ni;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ni||(Ni={}));var Hn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Hn||(Hn={}));class Go{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=pt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ro(this,_n.join,this.params,this.timeout),this.rejoinTimer=new ru(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=pt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=pt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_n.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new Ui(this),this.broadcastEndpointURL=su(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==pt.closed){const{config:{broadcast:l,presence:c,private:f}}=this.params,v=(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(k=>k.filter))!==null&&o!==void 0?o:[],_=!!this.bindings[Ni.PRESENCE]&&this.bindings[Ni.PRESENCE].length>0,y={},A={broadcast:l,presence:Object.assign(Object.assign({},c),{enabled:_}),postgres_changes:v,private:f};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(k=>e?.(Hn.CHANNEL_ERROR,k)),this._onClose(()=>e?.(Hn.CLOSED)),this.updateJoinPayload(Object.assign({config:A},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:k})=>{var g;if(this.socket.setAuth(),k===void 0){e?.(Hn.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,L=(g=T?.length)!==null&&g!==void 0?g:0,$=[];for(let K=0;K<L;K++){const Y=T[K],{filter:{event:q,schema:J,table:X,filter:R}}=Y,M=k&&k[K];if(M&&M.event===q&&M.schema===J&&M.table===X&&M.filter===R)$.push(Object.assign(Object.assign({},Y),{id:M.id}));else{this.unsubscribe(),this.state=pt.errored,e?.(Hn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=$,e&&e(Hn.SUBSCRIBED);return}}).receive("error",k=>{this.state=pt.errored,e?.(Hn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(k).join(", ")||"error")))}).receive("timeout",()=>{e?.(Hn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===pt.joined&&e===Ni.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:c}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const _=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=_.body)===null||o===void 0?void 0:o.cancel()),_.ok?"ok":"error"}catch(_){return _.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,f,v;const _=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(f=(c=this.params)===null||c===void 0?void 0:c.config)===null||f===void 0?void 0:f.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),_.receive("ok",()=>l("ok")),_.receive("error",()=>l("error")),_.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=pt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_n.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new ro(this,_n.leave,{},e),r.receive("ok",()=>{t(),o("ok")}).receive("timeout",()=>{t(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=pt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const o=new AbortController,l=setTimeout(()=>o.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:o.signal}));return clearTimeout(l),c}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new ro(this,e,t,r);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>qd){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var o,l;const c=e.toLocaleLowerCase(),{close:f,error:v,leave:_,join:y}=_n;if(r&&[f,v,_,y].indexOf(c)>=0&&r!==this._joinRef())return;let k=this._onMessage(c,t,r);if(t&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(g=>{var T,L,$;return((T=g.filter)===null||T===void 0?void 0:T.event)==="*"||(($=(L=g.filter)===null||L===void 0?void 0:L.event)===null||$===void 0?void 0:$.toLocaleLowerCase())===c}).map(g=>g.callback(k,r)):(l=this.bindings[c])===null||l===void 0||l.filter(g=>{var T,L,$,K,Y,q;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in g){const J=g.id,X=(T=g.filter)===null||T===void 0?void 0:T.event;return J&&((L=t.ids)===null||L===void 0?void 0:L.includes(J))&&(X==="*"||X?.toLocaleLowerCase()===(($=t.data)===null||$===void 0?void 0:$.type.toLocaleLowerCase()))}else{const J=(Y=(K=g?.filter)===null||K===void 0?void 0:K.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase();return J==="*"||J===((q=t?.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===c}).map(g=>{if(typeof k=="object"&&"ids"in k){const T=k.data,{schema:L,table:$,commit_timestamp:K,type:Y,errors:q}=T;k=Object.assign(Object.assign({},{schema:L,table:$,commit_timestamp:K,eventType:Y,new:{},old:{},errors:q}),this._getPayloadRecords(T))}g.callback(k,r)})}_isClosed(){return this.state===pt.closed}_isJoined(){return this.state===pt.joined}_isJoining(){return this.state===pt.joining}_isLeaving(){return this.state===pt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const o=e.toLocaleLowerCase(),l={type:o,filter:t,callback:r};return this.bindings[o]?this.bindings[o].push(l):this.bindings[o]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(o=>{var l;return!(((l=o.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Go.isEqual(o.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(_n.close,{},e)}_onError(e){this._on(_n.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ya(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ya(e.columns,e.old_record)),t}}const Qa=()=>{},fs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Qd=[1e3,2e3,5e3,1e4],Zd=1e4,eh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class th{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=mo,this.transport=null,this.heartbeatIntervalMs=fs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Qa,this.ref=0,this.reconnectTimer=null,this.logger=Qa,this.conn=null,this.sendBuffer=[],this.serializer=new Hd,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>{let l;return o?l=o:typeof fetch>"u"?l=(...c)=>Xi(async()=>{const{default:f}=await Promise.resolve().then(()=>Ai);return{default:f}},void 0,import.meta.url).then(({default:f})=>f(...c)).catch(f=>{throw new Error(`Failed to load @supabase/node-fetch: ${f.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...c)=>l(...c)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${yo.websocket}`,this.httpEndpoint=su(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ud.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Wd}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Di.connecting:return Lr.Connecting;case Di.open:return Lr.Open;case Di.closing:return Lr.Closing;default:return Lr.Closed}}isConnected(){return this.connectionState()===Lr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(l=>l.topic===r);if(o)return o;{const l=new Go(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:o,ref:l}=e,c=()=>{this.encode(e,f=>{var v;(v=this.conn)===null||v===void 0||v.send(f)})};this.log("push",`${t} ${r} (${l})`,o),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Vd,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},fs.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:o,payload:l,ref:c}=t,f=c?`(${c})`:"",v=l.status||"";this.log("receive",`${v} ${r} ${o} ${f}`.trim(),l),this.channels.filter(_=>_._isMember(r)).forEach(_=>_._trigger(o,l,c)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(_n.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(t);return`${e}${r}${o}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([eh],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const o={access_token:t,version:Bd};t&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(_n.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(o){this.log("error",`error in ${e} callback`,o)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ru(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},fs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,o,l,c,f,v,_;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:mo,this.heartbeatIntervalMs=(o=e?.heartbeatIntervalMs)!==null&&o!==void 0?o:fs.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(y=>Qd[y-1]||Zd),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((y,A)=>A(JSON.stringify(y))),this.decode=(_=e?.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Ko extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function gt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class nh extends Ko{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class wo extends Ko{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var rh=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const ou=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xi(async()=>{const{default:r}=await Promise.resolve().then(()=>Ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ih=()=>rh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Xi(()=>Promise.resolve().then(()=>Ai),void 0,import.meta.url)).Response:Response}),Eo=n=>{if(Array.isArray(n))return n.map(t=>Eo(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const o=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[o]=Eo(r)}),e},sh=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Wr=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const io=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),oh=(n,e,t)=>Wr(void 0,void 0,void 0,function*(){const r=yield ih();n instanceof r&&!t?.noResolveJson?n.json().then(o=>{const l=n.status||500,c=o?.statusCode||l+"";e(new nh(io(o),l,c))}).catch(o=>{e(new wo(io(o),o))}):e(new wo(io(n),n))}),ah=(n,e,t,r)=>{const o={method:n,headers:e?.headers||{}};return n==="GET"||!r?o:(sh(r)?(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),o.body=JSON.stringify(r)):o.body=r,e?.duplex&&(o.duplex=e.duplex),Object.assign(Object.assign({},o),t))};function Qi(n,e,t,r,o,l){return Wr(this,void 0,void 0,function*(){return new Promise((c,f)=>{n(t,ah(e,r,o,l)).then(v=>{if(!v.ok)throw v;return r?.noResolveJson?v:v.json()}).then(v=>c(v)).catch(v=>oh(v,f,r))})})}function Ps(n,e,t,r){return Wr(this,void 0,void 0,function*(){return Qi(n,"GET",e,t,r)})}function Tn(n,e,t,r,o){return Wr(this,void 0,void 0,function*(){return Qi(n,"POST",e,r,o,t)})}function Ao(n,e,t,r,o){return Wr(this,void 0,void 0,function*(){return Qi(n,"PUT",e,r,o,t)})}function lh(n,e,t,r){return Wr(this,void 0,void 0,function*(){return Qi(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function au(n,e,t,r,o){return Wr(this,void 0,void 0,function*(){return Qi(n,"DELETE",e,r,o,t)})}var Dt=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const uh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Za={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ch{constructor(e,t={},r,o){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ou(o)}uploadOrUpdate(e,t,r,o){return Dt(this,void 0,void 0,function*(){try{let l;const c=Object.assign(Object.assign({},Za),o);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const v=c.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=r,f["cache-control"]=`max-age=${c.cacheControl}`,f["content-type"]=c.contentType,v&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),o?.headers&&(f=Object.assign(Object.assign({},f),o.headers));const _=this._removeEmptyFolders(t),y=this._getFinalPath(_),A=yield(e=="PUT"?Ao:Tn)(this.fetch,`${this.url}/object/${y}`,l,Object.assign({headers:f},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:_,id:A.Id,fullPath:A.Key},error:null}}catch(l){if(gt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return Dt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,o){return Dt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),f=new URL(this.url+`/object/upload/sign/${c}`);f.searchParams.set("token",t);try{let v;const _=Object.assign({upsert:Za.upsert},o),y=Object.assign(Object.assign({},this.headers),{"x-upsert":String(_.upsert)});typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",_.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",_.cacheControl)):(v=r,y["cache-control"]=`max-age=${_.cacheControl}`,y["content-type"]=_.contentType);const A=yield Ao(this.fetch,f.toString(),v,{headers:y});return{data:{path:l,fullPath:A.Key},error:null}}catch(v){if(gt(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return Dt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);t?.upsert&&(o["x-upsert"]="true");const l=yield Tn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),c=new URL(this.url+l.url),f=c.searchParams.get("token");if(!f)throw new Ko("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:f},error:null}}catch(r){if(gt(r))return{data:null,error:r};throw r}})}update(e,t,r){return Dt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Dt(this,void 0,void 0,function*(){try{return{data:yield Tn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(gt(o))return{data:null,error:o};throw o}})}copy(e,t,r){return Dt(this,void 0,void 0,function*(){try{return{data:{path:(yield Tn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(gt(o))return{data:null,error:o};throw o}})}createSignedUrl(e,t,r){return Dt(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),l=yield Tn(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${c}`)},{data:l,error:null}}catch(o){if(gt(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,r){return Dt(this,void 0,void 0,function*(){try{const o=yield Tn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${l}`):null})),error:null}}catch(o){if(gt(o))return{data:null,error:o};throw o}})}download(e,t){return Dt(this,void 0,void 0,function*(){const o=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),c=l?`?${l}`:"";try{const f=this._getFinalPath(e);return{data:yield(yield Ps(this.fetch,`${this.url}/${o}/${f}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(f){if(gt(f))return{data:null,error:f};throw f}})}info(e){return Dt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Ps(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Eo(r),error:null}}catch(r){if(gt(r))return{data:null,error:r};throw r}})}exists(e){return Dt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield lh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(gt(r)&&r instanceof wo){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),o=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&o.push(l);const f=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&o.push(v);let _=o.join("&");return _!==""&&(_=`?${_}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${_}`)}}}remove(e){return Dt(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(gt(t))return{data:null,error:t};throw t}})}list(e,t,r){return Dt(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},uh),t),{prefix:e||""});return{data:yield Tn(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(gt(o))return{data:null,error:o};throw o}})}listV2(e,t){return Dt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Tn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(gt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const dh="2.11.0",hh={"X-Client-Info":`storage-js/${dh}`};var oi=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class fh{constructor(e,t={},r,o){const l=new URL(e);o?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},hh),t),this.fetch=ou(r)}listBuckets(){return oi(this,void 0,void 0,function*(){try{return{data:yield Ps(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(gt(e))return{data:null,error:e};throw e}})}getBucket(e){return oi(this,void 0,void 0,function*(){try{return{data:yield Ps(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(gt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return oi(this,void 0,void 0,function*(){try{return{data:yield Tn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(gt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return oi(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(gt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return oi(this,void 0,void 0,function*(){try{return{data:yield Tn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(gt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return oi(this,void 0,void 0,function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(gt(t))return{data:null,error:t};throw t}})}}class vh extends fh{constructor(e,t={},r,o){super(e,t,r,o)}from(e){return new ch(this.url,this.headers,e,this.fetch)}}const ph="2.56.0";let Li="";typeof Deno<"u"?Li="deno":typeof document<"u"?Li="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Li="react-native":Li="node";const gh={"X-Client-Info":`supabase-js-${Li}/${ph}`},_h={headers:gh},mh={schema:"public"},yh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bh={};var wh=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};const Eh=n=>{let e;return n?e=n:typeof fetch>"u"?e=Xl:e=fetch,(...t)=>e(...t)},Ah=()=>typeof Headers>"u"?Ql:Headers,kh=(n,e,t)=>{const r=Eh(t),o=Ah();return(l,c)=>wh(void 0,void 0,void 0,function*(){var f;const v=(f=yield e())!==null&&f!==void 0?f:n;let _=new o(c?.headers);return _.has("apikey")||_.set("apikey",n),_.has("Authorization")||_.set("Authorization",`Bearer ${v}`),r(l,Object.assign(Object.assign({},c),{headers:_}))})};var jh=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};function Sh(n){return n.endsWith("/")?n:n+"/"}function Ch(n,e){var t,r;const{db:o,auth:l,realtime:c,global:f}=n,{db:v,auth:_,realtime:y,global:A}=e,k={db:Object.assign(Object.assign({},v),o),auth:Object.assign(Object.assign({},_),l),realtime:Object.assign(Object.assign({},y),c),storage:{},global:Object.assign(Object.assign(Object.assign({},A),f),{headers:Object.assign(Object.assign({},(t=A?.headers)!==null&&t!==void 0?t:{}),(r=f?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>jh(this,void 0,void 0,function*(){return""})};return n.accessToken?k.accessToken=n.accessToken:delete k.accessToken,k}const lu="2.71.1",di=30*1e3,ko=3,so=ko*di,Th="http://localhost:9999",Ih="supabase.auth.token",Ph={"X-Client-Info":`gotrue-js/${lu}`},jo="X-Supabase-Api-Version",uu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Rh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Oh=600*1e3;class Yo extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function me(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class xh extends Yo{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Mh(n){return me(n)&&n.name==="AuthApiError"}class cu extends Yo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class fr extends Yo{constructor(e,t,r,o){super(e,r,o),this.name=t,this.status=r}}class sr extends fr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Lh(n){return me(n)&&n.name==="AuthSessionMissingError"}class vs extends fr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ps extends fr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class gs extends fr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function $h(n){return me(n)&&n.name==="AuthImplicitGrantRedirectError"}class el extends fr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class So extends fr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function oo(n){return me(n)&&n.name==="AuthRetryableFetchError"}class tl extends fr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Co extends fr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nl=` 	
\r=`.split(""),Fh=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<nl.length;e+=1)n[nl[e].charCodeAt(0)]=-2;for(let e=0;e<Rs.length;e+=1)n[Rs[e].charCodeAt(0)]=e;return n})();function rl(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Rs[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Rs[r]),e.queuedBits-=6}}function du(n,e,t){const r=Fh[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function il(n){const e=[],t=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},l=c=>{Nh(c,r,t)};for(let c=0;c<n.length;c+=1)du(n.charCodeAt(c),o,l);return e.join("")}function Dh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Uh(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|o)+65536,t+=1}Dh(r,e)}}function Nh(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Bh(n){const e=[],t={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<n.length;o+=1)du(n.charCodeAt(o),t,r);return new Uint8Array(e)}function Wh(n){const e=[];return Uh(n,t=>e.push(t)),new Uint8Array(e)}function Vh(n){const e=[],t={queue:0,queuedBits:0},r=o=>{e.push(o)};return n.forEach(o=>rl(o,t,r)),rl(null,t,r),e.join("")}function qh(n){return Math.round(Date.now()/1e3)+n}function Hh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const gn=()=>typeof window<"u"&&typeof document<"u",Pr={tested:!1,writable:!1},hu=()=>{if(!gn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Pr.tested)return Pr.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Pr.tested=!0,Pr.writable=!0}catch{Pr.tested=!0,Pr.writable=!1}return Pr.writable};function zh(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((o,l)=>{e[l]=o})}catch{}return t.searchParams.forEach((r,o)=>{e[o]=r}),e}const fu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Xi(async()=>{const{default:r}=await Promise.resolve().then(()=>Ai);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Gh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",hi=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Rr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ir=async(n,e)=>{await n.removeItem(e)};class Ws{constructor(){this.promise=new Ws.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ws.promiseConstructor=Promise;function ao(n){const e=n.split(".");if(e.length!==3)throw new Co("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Rh.test(e[r]))throw new Co("JWT not in base64url format");return{header:JSON.parse(il(e[0])),payload:JSON.parse(il(e[1])),signature:Bh(e[2]),raw:{header:e[0],payload:e[1]}}}async function Kh(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Yh(n,e){return new Promise((r,o)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await n(l);if(!e(l,null,c)){r(c);return}}catch(c){if(!e(l,c)){o(c);return}}})()})}function Jh(n){return("0"+n.toString(16)).substr(-2)}function Xh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let o="";for(let l=0;l<56;l++)o+=t.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,Jh).join("")}async function Qh(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),o=new Uint8Array(r);return Array.from(o).map(l=>String.fromCharCode(l)).join("")}async function Zh(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Qh(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ai(n,e,t=!1){const r=Xh();let o=r;t&&(o+="/PASSWORD_RECOVERY"),await hi(n,`${e}-code-verifier`,o);const l=await Zh(r);return[l,r===l?"plain":"s256"]}const ef=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function tf(n){const e=n.headers.get(jo);if(!e||!e.match(ef))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function nf(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function rf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const sf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function li(n){if(!sf.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function lo(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function sl(n){return JSON.parse(JSON.stringify(n))}var of=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};const xr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),af=[502,503,504];async function ol(n){var e;if(!Gh(n))throw new So(xr(n),0);if(af.includes(n.status))throw new So(xr(n),n.status);let t;try{t=await n.json()}catch(l){throw new cu(xr(l),l)}let r;const o=tf(n);if(o&&o.getTime()>=uu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new tl(xr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new sr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new tl(xr(t),n.status,t.weak_password.reasons);throw new xh(xr(t),n.status||500,r)}const lf=(n,e,t,r)=>{const o={method:n,headers:e?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),t))};async function Te(n,e,t,r){var o;const l=Object.assign({},r?.headers);l[jo]||(l[jo]=uu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const c=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(c.redirect_to=r.redirectTo);const f=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",v=await uf(n,e,t+f,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(v):{data:Object.assign({},v),error:null}}async function uf(n,e,t,r,o,l){const c=lf(e,r,o,l);let f;try{f=await n(t,Object.assign({},c))}catch(v){throw console.error(v),new So(xr(v),0)}if(f.ok||await ol(f),r?.noResolveJson)return f;try{return await f.json()}catch(v){await ol(v)}}function qn(n){var e;let t=null;ff(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=qh(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function al(n){const e=qn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function or(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function cf(n){return{data:n,error:null}}function df(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:l}=n,c=of(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:l},v=Object.assign({},c);return{data:{properties:f,user:v},error:null}}function hf(n){return n}function ff(n){return n.access_token&&n.refresh_token&&n.expires_in}const uo=["global","local","others"];var vf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};class pf{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=fu(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=uo[0]){if(uo.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${uo.join(", ")}`);try{return await Te(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(me(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:or})}catch(r){if(me(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=vf(e,["options"]),o=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await Te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:df,redirectTo:t?.redirectTo})}catch(t){if(me(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:or})}catch(t){if(me(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,o,l,c,f,v;try{const _={nextPage:null,lastPage:0,total:0},y=await Te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:hf});if(y.error)throw y.error;const A=await y.json(),k=(c=y.headers.get("x-total-count"))!==null&&c!==void 0?c:0,g=(v=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&v!==void 0?v:[];return g.length>0&&(g.forEach(T=>{const L=parseInt(T.split(";")[0].split("=")[1].substring(0,1)),$=JSON.parse(T.split(";")[1].split("=")[1]);_[`${$}Page`]=L}),_.total=parseInt(k)),{data:Object.assign(Object.assign({},A),_),error:null}}catch(_){if(me(_))return{data:{users:[]},error:_};throw _}}async getUserById(e){li(e);try{return await Te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:or})}catch(t){if(me(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){li(e);try{return await Te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:or})}catch(r){if(me(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){li(e);try{return await Te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:or})}catch(r){if(me(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){li(e.userId);try{const{data:t,error:r}=await Te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:t,error:r}}catch(t){if(me(t))return{data:null,error:t};throw t}}async _deleteFactor(e){li(e.userId),li(e.id);try{return{data:await Te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}}}function ll(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function gf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ui={debug:!!(globalThis&&hu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _f extends vu{}async function mf(n,e,t){ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ui.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await t()}finally{ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(e===0)throw ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new _f(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ui.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}gf();const yf={url:Th,storageKey:Ih,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ph,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ul(n,e,t){return await t()}const ci={};class Hi{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Hi.nextInstanceID,Hi.nextInstanceID+=1,this.instanceID>0&&gn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},yf),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new pf({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=fu(o.fetch),this.lock=o.lock||ul,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:gn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=mf:this.lock=ul,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:hu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ll(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=ll(this.memoryStorage)),gn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=ci[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){ci[this.storageKey]=Object.assign(Object.assign({},ci[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=ci[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ci[this.storageKey]=Object.assign(Object.assign({},ci[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${lu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=zh(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),gn()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),$h(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:c,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",c,"redirect type",f),await this._saveSession(c),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return me(t)?{error:t}:{error:new cu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,o;try{const l=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:qn}),{data:c,error:f}=l;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,_=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(l){if(me(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,o;try{let l;if("email"in e){const{email:y,password:A,options:k}=e;let g=null,T=null;this.flowType==="pkce"&&([g,T]=await ai(this.storage,this.storageKey)),l=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:k?.emailRedirectTo,body:{email:y,password:A,data:(t=k?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:k?.captchaToken},code_challenge:g,code_challenge_method:T},xform:qn})}else if("phone"in e){const{phone:y,password:A,options:k}=e;l=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:A,data:(r=k?.data)!==null&&r!==void 0?r:{},channel:(o=k?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:k?.captchaToken}},xform:qn})}else throw new ps("You must provide either an email or phone number and a password");const{data:c,error:f}=l;if(f||!c)return{data:{user:null,session:null},error:f};const v=c.session,_=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(l){if(me(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:c,options:f}=e;t=await Te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:al})}else if("phone"in e){const{phone:l,password:c,options:f}=e;t=await Te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:al})}else throw new ps("You must provide either an email or phone number and a password");const{data:r,error:o}=t;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new vs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(t){if(me(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,o,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,o,l,c,f,v,_,y,A,k,g;let T,L;if("message"in e)T=e.message,L=e.signature;else{const{chain:$,wallet:K,statement:Y,options:q}=e;let J;if(gn())if(typeof K=="object")J=K;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))J=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof K!="object"||!q?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");J=K}const X=new URL((t=q?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in J&&J.signIn){const R=await J.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},q?.signInWithSolana),{version:"1",domain:X.host,uri:X.href}),Y?{statement:Y}:null));let M;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")M=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)M=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)T=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),L=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in J)||typeof J.signMessage!="function"||!("publicKey"in J)||typeof J!="object"||!J.publicKey||!("toBase58"in J.publicKey)||typeof J.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");T=[`${X.host} wants you to sign in with your Solana account:`,J.publicKey.toBase58(),...Y?["",Y,""]:[""],"Version: 1",`URI: ${X.href}`,`Issued At: ${(o=(r=q?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((l=q?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...!((c=q?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...!((f=q?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...!((v=q?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...!((_=q?.signInWithSolana)===null||_===void 0)&&_.requestId?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...!((A=(y=q?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||A===void 0)&&A.length?["Resources",...q.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const R=await J.signMessage(new TextEncoder().encode(T),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");L=R}}try{const{data:$,error:K}=await Te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:T,signature:Vh(L)},!((k=e.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:qn});if(K)throw K;return!$||!$.session||!$.user?{data:{user:null,session:null},error:new vs}:($.session&&(await this._saveSession($.session),await this._notifyAllSubscribers("SIGNED_IN",$.session)),{data:Object.assign({},$),error:K})}catch($){if(me($))return{data:{user:null,session:null},error:$};throw $}}async _exchangeCodeForSession(e){const t=await Rr(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(t??"").split("/");try{const{data:l,error:c}=await Te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:qn});if(await ir(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new vs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:o??null}),error:c})}catch(l){if(me(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:o,access_token:l,nonce:c}=e,f=await Te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:qn}),{data:v,error:_}=f;return _?{data:{user:null,session:null},error:_}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new vs}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:_})}catch(t){if(me(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,o,l,c;try{if("email"in e){const{email:f,options:v}=e;let _=null,y=null;this.flowType==="pkce"&&([_,y]=await ai(this.storage,this.storageKey));const{error:A}=await Te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(r=v?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:_,code_challenge_method:y},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:A}}if("phone"in e){const{phone:f,options:v}=e,{data:_,error:y}=await Te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=v?.data)!==null&&o!==void 0?o:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(c=v?.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:_?.message_id},error:y}}throw new ps("You must provide either an email or phone number.")}catch(f){if(me(f))return{data:{user:null,session:null},error:f};throw f}}async verifyOtp(e){var t,r;try{let o,l;"options"in e&&(o=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:f}=await Te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:o,xform:qn});if(f)throw f;if(!c)throw new Error("An error occurred on token verification.");const v=c.session,_=c.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:_,session:v},error:null}}catch(o){if(me(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var t,r,o;try{let l=null,c=null;return this.flowType==="pkce"&&([l,c]=await ai(this.storage,this.storageKey)),await Te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:cf})}catch(l){if(me(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new sr;const{error:o}=await Te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(me(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:l}=e,{error:c}=await Te(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:r,type:o,options:l}=e,{data:c,error:f}=await Te(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:c?.message_id},error:f}}throw new ps("You must provide either an email or phone number and a type")}catch(t){if(me(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Rr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<so:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await Rr(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=lo()}if(this.storage.isServer&&e.user){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,_,y)=>(!c&&_==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,_,y))})}return{data:{session:e},error:null}}const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:or}):await this._useSession(async t=>{var r,o,l;const{data:c,error:f}=t;if(f)throw f;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new sr}:await Te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(o=c.session)===null||o===void 0?void 0:o.access_token)!==null&&l!==void 0?l:void 0,xform:or})})}catch(t){if(me(t))return Lh(t)&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:o,error:l}=r;if(l)throw l;if(!o.session)throw new sr;const c=o.session;let f=null,v=null;this.flowType==="pkce"&&e.email!=null&&([f,v]=await ai(this.storage,this.storageKey));const{data:_,error:y}=await Te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:v}),jwt:c.access_token,xform:or});if(y)throw y;return c.user=_.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(r){if(me(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new sr;const t=Date.now()/1e3;let r=t,o=!0,l=null;const{payload:c}=ao(e.access_token);if(c.exp&&(r=c.exp,o=r<=t),o){const{session:f,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!f)return{data:{user:null,session:null},error:null};l=f}else{const{data:f,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(me(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:c,error:f}=t;if(f)throw f;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new sr;const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(me(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!gn())throw new gs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new gs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new el("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new el("No code detected.");const{data:Y,error:q}=await this._exchangeCodeForSession(e.code);if(q)throw q;const J=new URL(window.location.href);return J.searchParams.delete("code"),window.history.replaceState(window.history.state,"",J.toString()),{data:{session:Y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:l,refresh_token:c,expires_in:f,expires_at:v,token_type:_}=e;if(!l||!f||!c||!_)throw new gs("No session defined in URL");const y=Math.round(Date.now()/1e3),A=parseInt(f);let k=y+A;v&&(k=parseInt(v));const g=k-y;g*1e3<=di&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${A}s`);const T=k-A;y-T>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",T,k,y):y-T<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",T,k,y);const{data:L,error:$}=await this._getUser(l);if($)throw $;const K={provider_token:r,provider_refresh_token:o,access_token:l,expires_in:A,expires_at:k,refresh_token:c,token_type:_,user:L.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:K,redirectType:e.type},error:null}}catch(r){if(me(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Rr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:o,error:l}=t;if(l)return{error:l};const c=(r=o.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:f}=await this.admin.signOut(c,e);if(f&&!(Mh(f)&&(f.status===404||f.status===401||f.status===403)))return{error:f}}return e!=="others"&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Hh(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,o;try{const{data:{session:l},error:c}=t;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await ai(this.storage,this.storageKey,!0));try{return await Te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(me(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(me(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:o}=await this._useSession(async l=>{var c,f,v,_,y;const{data:A,error:k}=l;if(k)throw k;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await Te(this.fetch,"GET",g,{headers:this.headers,jwt:(y=(_=A.session)===null||_===void 0?void 0:_.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return gn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(me(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,o;const{data:l,error:c}=t;if(c)throw c;return await Te(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(t){if(me(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Yh(async o=>(o>0&&await Kh(200*Math.pow(2,o-1)),this._debug(t,"refreshing attempt",o),await Te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qn})),(o,l)=>{const c=200*Math.pow(2,o);return l&&oo(l)&&Date.now()+c-r<di})}catch(r){if(this._debug(t,"error",r),me(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),gn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await Rr(this.storage,this.storageKey);if(o&&this.userStorage){let c=await Rr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:o.user},await hi(this.userStorage,this.storageKey+"-user",c)),o.user=(e=c?.user)!==null&&e!==void 0?e:lo()}else if(o&&!o.user&&!o.user){const c=await Rr(this.storage,this.storageKey+"-user");c&&c?.user?(o.user=c.user,await ir(this.storage,this.storageKey+"-user"),await hi(this.storage,this.storageKey,o)):o.user=lo()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const l=((t=o.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<so;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${so}s`),l){if(this.autoRefreshToken&&o.refresh_token){const{error:c}=await this._callRefreshToken(o.refresh_token);c&&(console.error(c),oo(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:f}=await this._getUser(o.access_token);!f&&c?.user?(o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new sr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ws;const{data:l,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!l.session)throw new sr;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const f={session:l.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(l){if(this._debug(o,"error",l),me(l)){const c={session:null,error:l};return oo(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,t,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(c),l.length>0){for(let f=0;f<l.length;f+=1)console.error(l[f]);throw l[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await hi(this.userStorage,this.storageKey+"-user",{user:t.user});const o=Object.assign({},t);delete o.user;const l=sl(o);await hi(this.storage,this.storageKey,l)}else{const o=sl(t);await hi(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await ir(this.storage,this.storageKey),await ir(this.storage,this.storageKey+"-code-verifier"),await ir(this.storage,this.storageKey+"-user"),this.userStorage&&await ir(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&gn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),di);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/di);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${di}ms, refresh threshold is ${ko} ticks`),o<=ko&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!gn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const o=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,c]=await ai(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});o.push(f.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);o.push(l.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:o,error:l}=t;return l?{data:null,error:l}:await Te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(me(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,o;const{data:l,error:c}=t;if(c)return{data:null,error:c};const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:_}=await Te(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return _?{data:null,error:_}:(e.factorType==="totp"&&(!((o=v?.totp)===null||o===void 0)&&o.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(me(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:l}=t;if(l)return{data:null,error:l};const{data:c,error:f}=await Te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return f?{data:null,error:f}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:f})})}catch(t){if(me(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:l}=t;return l?{data:null,error:l}:await Te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(me(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],o=r.filter(c=>c.factor_type==="totp"&&c.status==="verified"),l=r.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:r,totp:o,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:o},error:l}=e;if(l)return{data:null,error:l};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=ao(o.access_token);let f=null;c.aal&&(f=c.aal);let v=f;((r=(t=o.user.factors)===null||t===void 0?void 0:t.filter(A=>A.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(v="aal2");const y=c.amr||[];return{data:{currentLevel:f,nextLevel:v,currentAuthenticationMethods:y},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(f=>f.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(f=>f.kid===e),r&&this.jwks_cached_at+Oh>o)return r;const{data:l,error:c}=await Te(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=o,r=l.keys.find(f=>f.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:T}=await this.getSession();if(T||!g.session)return{data:null,error:T};r=g.session.access_token}const{header:o,payload:l,signature:c,raw:{header:f,payload:v}}=ao(r);t?.allowExpired||nf(l.exp);const _=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!_){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:l,header:o,signature:c},error:null}}const y=rf(o.alg),A=await crypto.subtle.importKey("jwk",_,y,!0,["verify"]);if(!await crypto.subtle.verify(y,A,c,Wh(`${f}.${v}`)))throw new Co("Invalid JWT signature");return{data:{claims:l,header:o,signature:c},error:null}}catch(r){if(me(r))return{data:null,error:r};throw r}}}Hi.nextInstanceID=0;const bf=Hi;class wf extends bf{constructor(e){super(e)}}var Ef=function(n,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(y){try{_(r.next(y))}catch(A){c(A)}}function v(y){try{_(r.throw(y))}catch(A){c(A)}}function _(y){y.done?l(y.value):o(y.value).then(f,v)}_((r=r.apply(n,e||[])).next())})};class Af{constructor(e,t,r){var o,l,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=Sh(e),v=new URL(f);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const _=`sb-${v.hostname.split(".")[0]}-auth-token`,y={db:mh,realtime:bh,auth:Object.assign(Object.assign({},yh),{storageKey:_}),global:_h},A=Ch(r??{},y);this.storageKey=(o=A.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(l=A.global.headers)!==null&&l!==void 0?l:{},A.accessToken?(this.accessToken=A.accessToken,this.auth=new Proxy({},{get:(k,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=A.auth)!==null&&c!==void 0?c:{},this.headers,A.global.fetch),this.fetch=kh(t,this._getAccessToken.bind(this),A.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},A.realtime)),this.rest=new Dd(new URL("rest/v1",v).href,{headers:this.headers,schema:A.db.schema,fetch:this.fetch}),this.storage=new vh(this.storageUrl.href,this.headers,this.fetch,r?.storage),A.accessToken||this._listenForAuthEvents()}get functions(){return new Td(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ef(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,storageKey:l,flowType:c,lock:f,debug:v},_,y){const A={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wf({url:this.authUrl.href,headers:Object.assign(Object.assign({},A),_),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,flowType:c,lock:f,debug:v,fetch:y,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new th(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const kf=(n,e,t)=>new Af(n,e,t);function jf(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}jf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Sf="https://vycjpmuyscfygstjjied.supabase.co",Cf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",ar="dracula",$r=kf(Sf,Cf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}});async function Tf(n,e,t,r){const o=prompt("Введите имя файла истории:","new_story.json");if(!o)return;const l={meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1"}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},c=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),{error:f}=await $r.storage.from(ar).upload(o,c);f?he(e,{type:"error",text:"Ошибка создания: "+f.message},!0):(await t(),await r(o))}async function If(n,e,t,r){if(!E(e))return;he(t,{type:"loading",text:"Сохранение..."},!0);const o=new Blob([JSON.stringify(E(e),null,2)],{type:"application/json"}),{error:l}=await $r.storage.from(ar).upload(E(r),o,{upsert:!0});he(t,{type:l?"error":"success",text:l?"Ошибка сохранения":"Сохранено!"},!0)}async function Pf(n,e,t){const r=n.target;if(!r.files||r.files.length===0)return;const o=r.files[0];he(e,{type:"loading",text:"Загрузка файла..."},!0);const{error:l}=await $r.storage.from(ar).upload(o.name,o,{upsert:!0});l?he(e,{type:"error",text:"Ошибка загрузки"},!0):(he(e,{type:"success",text:"Файл загружен"},!0),await t())}function Rf(n,e,t){if(!E(e)||!E(e).chapters)return;const r="ch_"+Date.now();E(e).chapters.push({id:r,title:"Новая глава"}),he(t,r)}function Of(n,e,t){if(!E(e))return;E(e).items||(E(e).items=[]);const r={id:"item_"+Date.now(),name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};E(e).items.push(r),he(t,E(e).items.length-1)}function xf(n,e,t,r){if(!E(e)||!E(t))return;const o="d_"+Date.now();E(e).dialogues.push({id:o,chapterId:E(t),text:"Новый текст...",options:[]}),he(r,o)}var Mf=(n,e)=>e(n.target.value),Lf=_e("<option> </option>"),$f=(n,e,t)=>he(e,E(t).id,!0),Ff=_e("<div> </div>"),Df=(n,e,t)=>he(e,E(t).id,!0),Uf=_e('<div><span class="id-badge svelte-1rjnbo7"> </span> <span class="preview-text svelte-1rjnbo7"> </span></div>'),Nf=_e("<div> </div>"),Bf=(n,e)=>he(e,!E(e)),Wf=(n,e)=>E(e).icon=n.target.value,Vf=_e("<option> </option>"),qf=_e('<div class="item-edit-form svelte-1rjnbo7"><div class="edit-grid svelte-1rjnbo7"><div class="form-group full-width-edit svelte-1rjnbo7"><label class="svelte-1rjnbo7">ID предмета</label> <input type="text" class="input svelte-1rjnbo7"/></div> <div class="form-group full-width-edit svelte-1rjnbo7"><label class="svelte-1rjnbo7">Название</label> <input type="text" class="input svelte-1rjnbo7"/></div> <div class="form-group full-width-edit svelte-1rjnbo7"><label class="svelte-1rjnbo7">Описание</label> <textarea class="textarea svelte-1rjnbo7" rows="2"></textarea></div> <div class="form-group full-width-edit svelte-1rjnbo7"><label class="svelte-1rjnbo7">Иконка (Файл)</label> <div class="input-group svelte-1rjnbo7"><input type="text" class="input svelte-1rjnbo7" placeholder="icon.png"/> <select class="input select svelte-1rjnbo7" style="max-width: 150px;"><option>-- Выбрать --</option><!></select></div></div> <div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Тип</label> <select class="item-type-select svelte-1rjnbo7"><option>Инструмент</option><option>Ключ</option><option>Расходуемый</option><option>Квестовый</option><option>Разное</option></select></div></div></div>'),Hf=_e('<div><div class="item-info svelte-1rjnbo7"><div class="item-main svelte-1rjnbo7"><span class="item-id-badge svelte-1rjnbo7"> </span> <span class="item-name-preview svelte-1rjnbo7"> </span></div> <div class="item-desc-preview svelte-1rjnbo7"> </div></div> <div class="item-actions"><button class="btn-icon svelte-1rjnbo7" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-1rjnbo7" title="Удалить">×</button></div> <!></div>'),zf=_e('<p class="empty-hint svelte-1rjnbo7">Нет предметов. Нажмите "+" чтобы добавить.</p>'),Gf=_e('<div class="items-list svelte-1rjnbo7"><!> <button class="btn primary small svelte-1rjnbo7" style="margin-top:10px; width:100%">+ Добавить предмет</button></div>'),Kf=_e("<option> </option>"),Yf=_e("<option> </option>"),Jf=_e("<option> </option>"),Xf=_e("<option> </option>"),Qf=(n,e,t)=>e(E(t)),Zf=_e("<option> </option>"),ev=_e("<option> </option>"),tv=_e("<option> </option>"),nv=_e('<div class="form-group full-width svelte-1rjnbo7"><label class="svelte-1rjnbo7">Предмет</label> <select class="input select svelte-1rjnbo7"><option>-- Выберите предмет --</option><!></select></div>'),rv=_e('<div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Стата</label> <input type="text" class="input svelte-1rjnbo7" placeholder="knowledge"/></div> <div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Значение ></label> <input type="number" class="input svelte-1rjnbo7"/></div>',1),iv=_e('<div class="form-group full-width svelte-1rjnbo7"><label class="svelte-1rjnbo7">Имя флага</label> <input type="text" class="input svelte-1rjnbo7" placeholder="metDracula"/></div>'),sv=_e('<div class="option-details svelte-1rjnbo7"><div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Текст кнопки</label><input type="text" class="input svelte-1rjnbo7"/></div> <div class="form-row svelte-1rjnbo7"><div class="form-group full-width svelte-1rjnbo7"><label class="svelte-1rjnbo7">Переход</label> <select class="input select svelte-1rjnbo7"><option>-- Конец ветки --</option><!></select></div></div> <div class="options-settings-grid svelte-1rjnbo7"><div class="setting-col svelte-1rjnbo7"><label class="checkbox-row svelte-1rjnbo7"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-1rjnbo7">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-1rjnbo7"><label class="checkbox-row svelte-1rjnbo7"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-1rjnbo7">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-1rjnbo7"><div class="form-row svelte-1rjnbo7"><div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Условие видимости</label> <select class="input select svelte-1rjnbo7"></select></div> <!> <!> <!></div></div></div>'),ov=_e('<div><div class="option-header svelte-1rjnbo7"><span class="status-icons svelte-1rjnbo7"><!></span> <span> </span> <button class="btn-icon danger svelte-1rjnbo7">×</button></div> <!></div>'),av=_e("<option> </option>"),lv=(n,e,t)=>e(E(t).nextDialogueId),uv=_e('<div class="link-row svelte-1rjnbo7"><span class="link-type svelte-1rjnbo7">Auto:</span> <span class="link-id svelte-1rjnbo7"> </span> <button class="btn-link svelte-1rjnbo7">Перейти →</button></div>'),cv=(n,e,t)=>e(E(t).nextDialogueId),dv=_e('<div class="link-row svelte-1rjnbo7"><span class="link-type svelte-1rjnbo7">Opt:</span> <span class="link-id svelte-1rjnbo7"> </span> <button class="btn-link svelte-1rjnbo7">Перейти →</button></div>'),hv=_e('<div class="link-row empty svelte-1rjnbo7">Никто не ссылается на этот диалог (это начало или тупик)</div>'),fv=(n,e,t)=>e(E(t).id),vv=_e('<div class="link-row svelte-1rjnbo7"><span class="link-id svelte-1rjnbo7"> </span> <span> </span> <button class="btn-link svelte-1rjnbo7">← Перейти</button> <span class="link-target"> </span></div>'),pv=(n,e,t)=>e(E(t).id),gv=_e('<div class="dialogue-form svelte-1rjnbo7"><div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">ID диалога</label><input type="text" class="input svelte-1rjnbo7"/></div> <div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Текст</label><textarea class="textarea svelte-1rjnbo7" rows="3"></textarea></div> <div class="media-section svelte-1rjnbo7"><h4 class="svelte-1rjnbo7">Медиа ресурсы</h4> <div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Фон</label> <div class="input-group svelte-1rjnbo7"><select class="input select svelte-1rjnbo7"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1rjnbo7">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1rjnbo7"><label class="svelte-1rjnbo7">Персонаж</label> <div class="input-group svelte-1rjnbo7"><select class="input select svelte-1rjnbo7"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1rjnbo7"><div class="section-header svelte-1rjnbo7"><h4 class="svelte-1rjnbo7">Варианты ответов</h4><button class="btn small svelte-1rjnbo7">+ Добавить</button></div> <!></div> <div class="links-section svelte-1rjnbo7"><h4 class="svelte-1rjnbo7">Авто-переход</h4> <select class="input select svelte-1rjnbo7"><option>-- Нет --</option><!></select></div> <div class="infographic-section svelte-1rjnbo7"><h4 class="svelte-1rjnbo7">Связи и переходы</h4> <div class="info-block svelte-1rjnbo7"><div class="info-title svelte-1rjnbo7">👉 Куда ведет:</div> <!> <!></div> <div class="info-block secondary svelte-1rjnbo7"><div class="info-title svelte-1rjnbo7">👈 Откуда ведут сюда:</div> <!></div></div> <div class="form-actions svelte-1rjnbo7"><button class="btn danger svelte-1rjnbo7">Удалить сцену</button></div></div>'),_v=_e('<div class="empty-state svelte-1rjnbo7">Выберите сцену</div>'),mv=(n,e)=>he(e,null),yv=_e('<div class="empty-preview svelte-1rjnbo7">Выберите сцену</div>'),bv=_e('<div class="editor-container svelte-1rjnbo7"><header class="toolbar svelte-1rjnbo7"><div class="logo svelte-1rjnbo7"><h2 class="svelte-1rjnbo7">Story Editor v3.1</h2></div> <div class="stories-control svelte-1rjnbo7"><select class="story-select svelte-1rjnbo7"></select> <button class="btn primary small svelte-1rjnbo7">+ Новая</button> <button class="btn success small svelte-1rjnbo7">💾 Сохранить</button> <button class="btn small svelte-1rjnbo7">📋 Копия</button></div></header> <div class="main-workspace svelte-1rjnbo7"><aside class="sidebar svelte-1rjnbo7"><div class="sidebar-section svelte-1rjnbo7"><div class="section-header svelte-1rjnbo7"><h3>Главы</h3><button class="btn-icon svelte-1rjnbo7">+</button></div> <div class="chapter-list svelte-1rjnbo7"></div></div> <div class="sidebar-section flex-1 svelte-1rjnbo7"><div class="section-header svelte-1rjnbo7"><h3> </h3><button class="btn-icon svelte-1rjnbo7">+</button></div> <div class="dialogue-list svelte-1rjnbo7"></div></div> <div class="status-box svelte-1rjnbo7"><!></div></aside> <main class="editor-area svelte-1rjnbo7"><div class="items-manager svelte-1rjnbo7"><div class="section-header svelte-1rjnbo7"><h4 class="svelte-1rjnbo7"> </h4> <span class="toggle-icon svelte-1rjnbo7"> </span></div> <!></div> <!></main> <aside class="preview-panel svelte-1rjnbo7"><div class="preview-header svelte-1rjnbo7"><h3 class="svelte-1rjnbo7">Предпросмотр</h3> <button class="btn-link small svelte-1rjnbo7">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1rjnbo7"><!></div></aside></div></div>');function wv(n,e){Ki(e,!0);let t=nt(Pn({meta:{version:"3.1",title:"Untitled"},chapters:[],dialogues:[]})),r=nt(null),o=nt(null),l=nt(null),c=nt(null),f=nt(Pn([])),v=nt(Pn({type:"",text:""})),_=nt(Pn([])),y=nt("dracula_story_v3.json"),A=nt(!1);qo(async()=>{await k(),await T(E(y)),await L()});async function k(){const{data:D,error:z}=await $r.storage.from(ar).list("",{search:".json"});!z&&D&&he(_,D.map(ue=>ue.name).filter(ue=>ue!==".emptyFolderPlaceholder"),!0)}async function g(){if(!E(t))return;const D=E(y).replace(".json",""),z=new Date().getTime();let ue=`${D}_copy_${z}.json`.trim();const Re=prompt("Введите имя для копии:",ue);if(!Re)return;ue=Re.trim(),ue.endsWith(".json")||(ue+=".json"),he(v,{type:"loading",text:"Создание копии..."},!0);const De=new Blob([JSON.stringify(E(t),null,2)],{type:"application/json"}),{error:Ue}=await $r.storage.from(ar).upload(ue,De,{upsert:!0});Ue?he(v,{type:"error",text:`Ошибка копии: ${Ue.message}`},!0):(await k(),he(v,{type:"success",text:"Копия сохранена!"},!0))}async function T(D){he(v,{type:"loading",text:"Загрузка..."},!0),he(y,D,!0);try{const{data:z,error:ue}=await $r.storage.from(ar).download(D);if(ue)throw ue;let Re=JSON.parse(await z.text());console.log(ar),console.log(D),console.log(JSON.stringify(Re.chapters,2)),Re.dialogues&&Re.dialogues.forEach(De=>{De.options&&De.options.forEach(Ue=>{typeof Ue.enabled>"u"&&(Ue.enabled=!0),typeof Ue.visible>"u"&&(Ue.visible=!0),Ue.visibleIf&&!Ue.visibilityCondition&&(Ue.visibilityCondition={type:"has_item",itemId:Ue.visibleIf.hasItem})})}),Re.chapters||(Re.chapters=[{id:"main",title:"Основная история"}],Re.dialogues&&Re.dialogues.forEach(De=>{De.chapterId||(De.chapterId="main")})),he(t,Re,!0),E(t).chapters&&E(t).chapters.length>0&&he(r,E(t).chapters[0].id,!0),E(t).dialogues&&E(t).dialogues.length>0&&he(o,E(t).dialogues[0].id,!0),he(v,{type:"success",text:"Загружено!"},!0)}catch(z){console.error(z),he(v,{type:"error",text:"Ошибка загрузки: "+z.message},!0)}}async function L(){const{data:D}=await $r.storage.from(ar).list();D&&he(f,D.filter(z=>z.name!==".emptyFolderPlaceholder"&&!z.name.endsWith(".json")),!0)}function $(D){E(c)===D?he(c,null):he(c,D,!0)}function K(D){confirm("Удалить предмет?")&&(!E(t)||!E(t).items||(E(t).items.splice(D,1),he(c,null)))}function Y(D){D.visibilityCondition||(D.visibilityCondition={type:"always"})}function q(D){D.options||(D.options=[]);const z={text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}};D.options.push(z),he(l,D.options.length-1),Y(z)}function J(D,z){if(E(l)===D)he(l,null);else{he(l,D,!0);const ue=z.options[D];Y(ue)}}function X(D){confirm("Удалить диалог "+D+"?")&&E(t)&&(E(t).dialogues=E(t).dialogues.filter(z=>z.id!==D),E(t).dialogues.forEach(z=>{z.nextDialogueId===D&&(z.nextDialogueId=""),z.options&&z.options.forEach(ue=>{ue.nextDialogueId===D&&(ue.nextDialogueId="")})}),E(o)===D&&he(o,null))}let R=Or(()=>E(t)?.dialogues.find(D=>D.id===E(o))),M=Or(()=>E(t)?E(t).dialogues.filter(D=>D.chapterId===E(r)):[]),ae=Or(()=>E(f).filter(D=>D.name.match(/\.(png|jpg|jpeg|webp|gif)$/i))),de=Or(()=>E(f).filter(D=>D.name.endsWith(".riv"))),fe=Or(()=>E(t)?.items||[]),Z=Or(()=>()=>!E(t)||!E(o)?[]:E(t).dialogues.filter(D=>D.nextDialogueId===E(o)?!0:D.options?D.options.some(z=>z.nextDialogueId===E(o)):!1));function pe(D,z){return D.nextDialogueId===z?"Auto":"Option"}function Ve(D){const z=E(t)?.dialogues.find(ue=>ue.id===D);z&&(he(r,z.chapterId,!0),he(o,D,!0))}const ot=["always","has_item","stat_greater","flag_true"];var Je=bv(),St=F(Je),Ce=B(F(St),2),zt=F(Ce);zt.__change=[Mf,T],jt(zt,21,()=>E(_),Jt,(D,z)=>{var ue=Lf(),Re=F(ue),De={};et(()=>{ze(Re,E(z)),De!==(De=E(z))&&(ue.value=(ue.__value=E(z))??"")}),oe(D,ue)});var ut=B(zt,2);ut.__click=[Tf,v,k,T];var Xe=B(ut,2);Xe.__click=[If,t,v,y];var ft=B(Xe,2);ft.__click=g;var Gt=B(St,2),Se=F(Gt),Pe=F(Se),Nt=F(Pe),qe=B(F(Nt));qe.__click=[Rf,t,r];var Mt=B(Nt,2);jt(Mt,21,()=>E(t)?.chapters||[],D=>D.id,(D,z)=>{var ue=Ff();ue.__click=[$f,r,z];var Re=F(ue);et(()=>{ei(ue,1,`chapter-item ${E(r)===E(z).id?"active":""}`,"svelte-1rjnbo7"),ze(Re,E(z).title)}),oe(D,ue)});var rt=B(Pe,2),Zt=F(rt),un=F(Zt),cn=F(un),bn=B(un);bn.__click=[xf,t,r,o];var Ct=B(Zt,2);jt(Ct,21,()=>E(M),D=>D.id,(D,z)=>{var ue=Uf();ue.__click=[Df,o,z];var Re=F(ue),De=F(Re),Ue=B(Re,2),it=F(Ue);et(_t=>{ei(ue,1,`dialogue-item ${E(o)===E(z).id?"active":""}`,"svelte-1rjnbo7"),ze(De,E(z).id),ze(it,`${_t??""}...`)},[()=>E(z).text.substring(0,25)]),oe(D,ue)});var Kt=B(rt,2),wn=F(Kt);{var vr=D=>{var z=Nf(),ue=F(z);et(()=>{ei(z,1,`alert ${E(v).type??""}`,"svelte-1rjnbo7"),ze(ue,E(v).text)}),oe(D,z)};Ye(wn,D=>{E(v).text&&D(vr)})}var en=B(Se,2),pr=F(en),At=F(pr);At.__click=[Bf,A];var Vr=F(At),qr=F(Vr),ki=B(Vr,2),En=F(ki),p=B(At,2);{var a=D=>{var z=Gf(),ue=F(z);{var Re=it=>{var _t=mn(),tn=qt(_t);jt(tn,19,()=>E(t).items,mt=>mt.id,(mt,re,ye)=>{var Tt=Hf(),gr=F(Tt),xn=F(gr),Hr=F(xn),Mn=F(Hr),_r=B(Hr,2),ee=F(_r),Yn=B(xn,2),dn=F(Yn),Jn=B(gr,2),Xn=F(Jn);Xn.__click=()=>$(E(ye));var Qn=B(Xn,2);Qn.__click=()=>K(E(ye));var zr=B(Jn,2);{var mr=hn=>{var Ln=qf(),ji=F(Ln),Bt=F(ji),yr=B(F(Bt),2),br=B(Bt,2),wr=B(F(br),2),Er=B(br,2),Lt=B(F(Er),2),$n=B(Er,2),Ar=B(F($n),2),Gr=F(Ar),Fn=B(Gr,2);Fn.__change=[Wf,re];var Zn=F(Fn);Zn.value=Zn.__value="";var ke=B(Zn);jt(ke,17,()=>E(f).filter(Ne=>Ne.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Jt,(Ne,Yt)=>{var Wt=Vf(),er=F(Wt),vt={};et(()=>{ze(er,E(Yt).name),vt!==(vt=E(Yt).name)&&(Wt.value=(Wt.__value=E(Yt).name)??"")}),oe(Ne,Wt)});var se=B($n,2),ve=B(F(se),2),Ke=F(ve);Ke.value=Ke.__value="tool";var Ae=B(Ke);Ae.value=Ae.__value="key";var ct=B(Ae);ct.value=ct.__value="consumable";var It=B(ct);It.value=It.__value="quest";var $t=B(It);$t.value=$t.__value="misc",Sn(yr,()=>E(re).id,Ne=>E(re).id=Ne),Sn(wr,()=>E(re).name,Ne=>E(re).name=Ne),Sn(Lt,()=>E(re).description,Ne=>E(re).description=Ne),Sn(Gr,()=>E(re).icon,Ne=>E(re).icon=Ne),rr(ve,()=>E(re).type,Ne=>E(re).type=Ne),oe(hn,Ln)};Ye(zr,hn=>{E(c)===E(ye)&&hn(mr)})}et(()=>{ei(Tt,1,`item-row ${E(c)===E(ye)?"editing":""}`,"svelte-1rjnbo7"),ze(Mn,E(re).id),ze(ee,E(re).name),ze(dn,E(re).description)}),oe(mt,Tt)}),oe(it,_t)},De=it=>{var _t=zf();oe(it,_t)};Ye(ue,it=>{E(t)?.items?it(Re):it(De,!1)})}var Ue=B(ue,2);Ue.__click=[Of,t,c],oe(D,z)};Ye(p,D=>{E(A)&&D(a)})}var d=B(pr,2);{var b=D=>{var z=gv(),ue=F(z),Re=B(F(ue)),De=B(ue,2),Ue=B(F(De)),it=B(De,2),_t=B(F(it),2),tn=B(F(_t),2),mt=F(tn),re=F(mt);re.value=re.__value="";var ye=B(re);jt(ye,17,()=>E(ae),Jt,(ke,se)=>{var ve=Kf(),Ke=F(ve),Ae={};et(()=>{ze(Ke,E(se).name),Ae!==(Ae=E(se).name)&&(ve.value=(ve.__value=E(se).name)??"")}),oe(ke,ve)});var Tt=B(ye);jt(Tt,17,()=>E(de),Jt,(ke,se)=>{var ve=Yf(),Ke=F(ve),Ae={};et(()=>{ze(Ke,`${E(se).name??""} (Rive)`),Ae!==(Ae=E(se).name)&&(ve.value=(ve.__value=E(se).name)??"")}),oe(ke,ve)});var gr=B(mt,2),xn=B(F(gr));xn.__change=[Pf,v,L];var Hr=B(_t,2),Mn=B(F(Hr),2),_r=F(Mn),ee=F(_r);ee.value=ee.__value="";var Yn=B(ee);jt(Yn,17,()=>E(ae),Jt,(ke,se)=>{var ve=Jf(),Ke=F(ve),Ae={};et(()=>{ze(Ke,E(se).name),Ae!==(Ae=E(se).name)&&(ve.value=(ve.__value=E(se).name)??"")}),oe(ke,ve)});var dn=B(Yn);jt(dn,17,()=>E(de),Jt,(ke,se)=>{var ve=Xf(),Ke=F(ve),Ae={};et(()=>{ze(Ke,`${E(se).name??""} (Rive)`),Ae!==(Ae=E(se).name)&&(ve.value=(ve.__value=E(se).name)??"")}),oe(ke,ve)});var Jn=B(it,2),Xn=F(Jn),Qn=B(F(Xn));Qn.__click=[Qf,q,R];var zr=B(Xn,2);jt(zr,17,()=>E(R).options||[],Jt,(ke,se,ve)=>{var Ke=ov(),Ae=F(Ke);Ae.__click=()=>J(ve,E(R));var ct=F(Ae),It=F(ct);{var $t=ce=>{var dt=Zs("👁️‍🗨️");oe(ce,dt)},Ne=ce=>{var dt=mn(),Pt=qt(dt);{var Kr=fn=>{var Ge=Zs("🔒");oe(fn,Ge)},kr=fn=>{var Ge=Zs("✅");oe(fn,Ge)};Ye(Pt,fn=>{E(se).enabled?fn(kr,!1):fn(Kr)},!0)}oe(ce,dt)};Ye(It,ce=>{E(se).visible?ce(Ne,!1):ce($t)})}var Yt=B(ct,2),Wt=F(Yt),er=B(Yt,2);er.__click=()=>E(R).options.splice(ve,1);var vt=B(Ae,2);{var An=ce=>{var dt=sv(),Pt=F(dt),Kr=B(F(Pt)),kr=B(Pt,2),fn=F(kr),Ge=B(F(fn),2),Dn=F(Ge);Dn.value=Dn.__value="";var Si=B(Dn);jt(Si,17,()=>E(t).dialogues,Jt,(Be,at)=>{var st=Zf(),Rt=F(st),lt={};et(rn=>{ze(Rt,`${E(at).id??""}: ${rn??""}...`),lt!==(lt=E(at).id)&&(st.value=(st.__value=E(at).id)??"")},[()=>E(at).text.substring(0,30)]),oe(Be,st)});var tr=B(kr,2),nn=F(tr),Ci=F(nn),Un=F(Ci),Zi=B(nn,2),jr=F(Zi),Yr=F(jr),Ti=B(tr,2),es=F(Ti),Ii=F(es),Pi=B(F(Ii),2);jt(Pi,21,()=>ot,Jt,(Be,at)=>{var st=ev(),Rt=F(st),lt={};et(()=>{ze(Rt,E(at)),lt!==(lt=E(at))&&(st.value=(st.__value=E(at))??"")}),oe(Be,st)});var ts=B(Ii,2);{var ns=Be=>{var at=nv(),st=B(F(at),2),Rt=F(st);Rt.value=Rt.__value="";var lt=B(Rt);jt(lt,17,()=>E(fe),Jt,(rn,Nn)=>{var Ft=tv(),Ri=F(Ft),vn={};et(()=>{ze(Ri,E(Nn).name),vn!==(vn=E(Nn).id)&&(Ft.value=(Ft.__value=E(Nn).id)??"")}),oe(rn,Ft)}),rr(st,()=>E(se).visibilityCondition.itemId,rn=>E(se).visibilityCondition.itemId=rn),oe(Be,at)};Ye(ts,Be=>{E(se).visibilityCondition.type==="has_item"&&Be(ns)})}var Sr=B(ts,2);{var Jr=Be=>{var at=rv(),st=qt(at),Rt=B(F(st),2),lt=B(st,2),rn=B(F(lt),2);Sn(Rt,()=>E(se).visibilityCondition.statName,Nn=>E(se).visibilityCondition.statName=Nn),Sn(rn,()=>E(se).visibilityCondition.statValue,Nn=>E(se).visibilityCondition.statValue=Nn),oe(Be,at)};Ye(Sr,Be=>{E(se).visibilityCondition.type==="stat_greater"&&Be(Jr)})}var nr=B(Sr,2);{var Xr=Be=>{var at=iv(),st=B(F(at),2);Sn(st,()=>E(se).visibilityCondition.flagName,Rt=>E(se).visibilityCondition.flagName=Rt),oe(Be,at)};Ye(nr,Be=>{E(se).visibilityCondition.type==="flag_true"&&Be(Xr)})}Sn(Kr,()=>E(se).text,Be=>E(se).text=Be),rr(Ge,()=>E(se).nextDialogueId,Be=>E(se).nextDialogueId=Be),Ma(Un,()=>E(se).enabled,Be=>E(se).enabled=Be),Ma(Yr,()=>E(se).visible,Be=>E(se).visible=Be),rr(Pi,()=>E(se).visibilityCondition.type,Be=>E(se).visibilityCondition.type=Be),oe(ce,dt)};Ye(vt,ce=>{E(l)===ve&&ce(An)})}et(()=>{ei(Ke,1,`option-card ${E(l)===ve?"editing":""}`,"svelte-1rjnbo7"),ze(Wt,`#${ve+1} ${E(se).text??""}`)}),oe(ke,Ke)});var mr=B(Jn,2),hn=B(F(mr),2),Ln=F(hn);Ln.value=Ln.__value="";var ji=B(Ln);jt(ji,17,()=>E(t).dialogues,Jt,(ke,se)=>{var ve=av(),Ke=F(ve),Ae={};et(ct=>{ze(Ke,`${E(se).id??""}: ${ct??""}...`),Ae!==(Ae=E(se).id)&&(ve.value=(ve.__value=E(se).id)??"")},[()=>E(se).text.substring(0,30)]),oe(ke,ve)});var Bt=B(mr,2),yr=B(F(Bt),2),br=B(F(yr),2);{var wr=ke=>{var se=uv(),ve=B(F(se),2),Ke=F(ve),Ae=B(ve,2);Ae.__click=[lv,Ve,R],et(()=>ze(Ke,E(R).nextDialogueId)),oe(ke,se)};Ye(br,ke=>{E(R).nextDialogueId&&ke(wr)})}var Er=B(br,2);jt(Er,17,()=>E(R).options||[],Jt,(ke,se)=>{var ve=mn(),Ke=qt(ve);{var Ae=ct=>{var It=dv(),$t=B(F(It),2),Ne=F($t),Yt=B($t,2);Yt.__click=[cv,Ve,se],et(()=>ze(Ne,E(se).nextDialogueId)),oe(ct,It)};Ye(Ke,ct=>{E(se).nextDialogueId&&ct(Ae)})}oe(ke,ve)});var Lt=B(yr,2),$n=B(F(Lt),2);{var Ar=ke=>{var se=hv();oe(ke,se)},Gr=ke=>{var se=mn(),ve=qt(se);jt(ve,17,()=>E(Z)(),Jt,(Ke,Ae)=>{var ct=vv(),It=F(ct),$t=F(It),Ne=B(It,2),Yt=F(Ne),Wt=B(Ne,2);Wt.__click=[fv,Ve,Ae];var er=B(Wt,2),vt=F(er);et((An,ce,dt)=>{ze($t,E(Ae).id),ei(Ne,1,`link-type-badge ${An??""}`,"svelte-1rjnbo7"),ze(Yt,ce),ze(vt,`"${dt??""}..."`)},[()=>pe(E(Ae),E(R).id)==="Auto"?"auto":"option",()=>pe(E(Ae),E(R).id),()=>E(Ae).text.substring(0,30)]),oe(Ke,ct)}),oe(ke,se)};Ye($n,ke=>{E(Z)().length===0?ke(Ar):ke(Gr,!1)})}var Fn=B(Bt,2),Zn=F(Fn);Zn.__click=[pv,X,R],Sn(Re,()=>E(R).id,ke=>E(R).id=ke),Sn(Ue,()=>E(R).text,ke=>E(R).text=ke),rr(mt,()=>E(R).backgroundImage,ke=>E(R).backgroundImage=ke),rr(_r,()=>E(R).characterImage,ke=>E(R).characterImage=ke),rr(hn,()=>E(R).nextDialogueId,ke=>E(R).nextDialogueId=ke),oe(D,z)},C=D=>{var z=_v();oe(D,z)};Ye(d,D=>{E(R)?D(b):D(C,!1)})}var x=B(en,2),U=F(x),le=B(F(U),2);le.__click=[mv,l];var ge=B(U,2),ie=F(ge);{var Ee=D=>{Jl(D,{get dialogue(){return E(R)},index:0})},Le=D=>{var z=yv();oe(D,z)};Ye(ie,D=>{E(R)?D(Ee):D(Le,!1)})}et(()=>{ze(cn,`Сцены (${E(M).length??""})`),bn.disabled=!E(r),ze(qr,`📦 Предметы (${(E(t)?.items?.length||0)??""})`),ze(En,E(A)?"▼":"▶")}),rr(zt,()=>E(y),D=>he(y,D)),oe(n,Je),Yi()}zl(["change","click"]);var Ev=_e('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),Av=_e('<button style="position:fixed; bottom:10px; right:10px; z-index:9999;">Редактор</button> <!>',1);function kv(n){let e=nt(!1);var t=mn(),r=qt(t);{var o=c=>{var f=Ev(),v=qt(f),_=B(v,2);wv(_,{}),Ia("click",v,()=>he(e,!1)),oe(c,f)},l=c=>{var f=Av(),v=qt(f),_=B(v,2);Ed(_,{}),Ia("click",v,()=>he(e,!0)),oe(c,f)};Ye(r,c=>{E(e)?c(o):c(l,!1)})}oe(n,t)}Dc(kv,{target:document.getElementById("app")});
