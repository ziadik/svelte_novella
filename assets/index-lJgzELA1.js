(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const Al=!1;var Ei=Array.isArray,ac=Array.prototype.indexOf,Ca=Array.from,la=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,Cl=Object.getOwnPropertyDescriptors,oc=Object.prototype,lc=Array.prototype,Ta=Object.getPrototypeOf,Fo=Object.isExtensible;function uc(n){return n()}function us(n){for(var e=0;e<n.length;e++)n[e]()}function cc(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const rn=2,Pa=4,ys=8,Qr=16,Bn=32,yr=64,Tl=128,ln=256,cs=512,Wt=1024,un=2048,Xn=4096,_n=8192,br=16384,xa=32768,bs=65536,Uo=1<<17,dc=1<<18,Si=1<<19,Pl=1<<20,ua=1<<21,ja=1<<22,pr=1<<23,Fn=Symbol("$state"),hc=Symbol("legacy props"),fc=Symbol(""),Ra=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function vc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function xl(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function pc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function gc(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function _c(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mc(n){throw new Error("https://svelte.dev/e/effect_orphan")}function yc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function bc(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function wc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function kc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ec(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const ws=1,ks=2,jl=4,Sc=8,Ic=16,Ac=1,Cc=2,Tc=4,Pc=8,xc=16,jc=1,Rc=2,Lt=Symbol(),Oc="http://www.w3.org/1999/xhtml";function Mc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Lc=!1;function Rl(n){return n===this.v}function Ol(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Dc(n,e){return n!==e}function Ml(n){return!Ol(n,this.v)}let Zr=!1,$c=!1;function Fc(){Zr=!0}let St=null;function ds(n){St=n}function Vt(n,e=!1,t){St={p:St,c:null,e:null,s:n,x:null,l:Zr&&!e?{s:null,u:null,$:[]}:null}}function qt(n){var e=St,t=e.e;if(t!==null){e.e=null;for(var r of t)Kl(r)}return St=e.p,{}}function ei(){return!Zr||St!==null&&St.l===null}const Uc=new WeakMap;function Nc(n){var e=tt;if(e===null)return st.f|=pr,n;if((e.f&xa)===0){if((e.f&Tl)===0)throw!e.parent&&n instanceof Error&&Ll(n),n;e.b.error(n)}else Oa(n,e)}function Oa(n,e){for(;e!==null;){if((e.f&Tl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Ll(n),n}function Ll(n){const e=Uc.get(n);e&&(la(n,"message",{value:e.message}),la(n,"stack",{value:e.stack}))}let yi=[],ca=[];function Dl(){var n=yi;yi=[],us(n)}function Bc(){var n=ca;ca=[],us(n)}function $l(n){yi.length===0&&queueMicrotask(Dl),yi.push(n)}function Wc(){yi.length>0&&Dl(),ca.length>0&&Bc()}function Vc(){for(var n=tt.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&vc(),n}function Ii(n){var e=rn|un,t=st!==null&&(st.f&rn)!==0?st:null;return tt===null||t!==null&&(t.f&ln)!==0?e|=ln:tt.f|=Si,{ctx:St,deps:null,effects:null,equals:Rl,f:e,fn:n,reactions:null,rv:0,v:Lt,wv:0,parent:t??tt,ac:null}}function qc(n,e){let t=tt;t===null&&pc();var r=t.b,s=void 0,l=Gr(Lt),u=null,h=!st;return ad(()=>{try{var f=n();u&&Promise.resolve(f).catch(()=>{})}catch(g){f=Promise.reject(g)}var _=()=>f;s=u?.then(_,_)??Promise.resolve(f),u=s;var m=vt,w=r.pending;h&&(r.update_pending_count(1),w||m.increment());const E=(g,A=void 0)=>{u=null,w||m.activate(),A?A!==Ra&&(l.f|=pr,Kr(l,A)):((l.f&pr)!==0&&(l.f^=pr),Kr(l,g)),h&&(r.update_pending_count(-1),w||m.decrement()),Nl()};if(s.then(E,g=>E(null,g||"unknown")),m)return()=>{queueMicrotask(()=>m.neuter())}}),new Promise(f=>{function _(m){function w(){m===s?f(l):_(s)}m.then(w,w)}_(s)})}function Ma(n){const e=Ii(n);return tu(e),e}function ti(n){const e=Ii(n);return e.equals=Ml,e}function Fl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Nn(e[t])}}function zc(n){for(var e=n.parent;e!==null;){if((e.f&rn)===0)return e;e=e.parent}return null}function La(n){var e,t=tt;Yn(zc(n));try{Fl(n),e=su(n)}finally{Yn(t)}return e}function Ul(n){var e=La(n);if(n.equals(e)||(n.v=e,n.wv=ru()),!wr){var t=(Gn||(n.f&ln)!==0)&&n.deps!==null?Xn:Wt;Zt(n,t)}}function Hc(n,e,t){const r=ei()?Ii:ti;if(e.length===0){t(n.map(r));return}var s=vt,l=tt,u=Gc(),h=Vc();Promise.all(e.map(f=>qc(f))).then(f=>{s?.activate(),u();try{t([...n.map(r),...f])}catch(_){(l.f&br)===0&&Oa(_,l)}s?.deactivate(),Nl()}).catch(f=>{h.error(f)})}function Gc(){var n=tt,e=st,t=St,r=vt;return function(){Yn(n),Tn(e),ds(t),r?.activate()}}function Nl(){Yn(null),Tn(null),ds(null)}const Hs=new Set;let vt=null,as=null,No=new Set,hs=[];function Bl(){const n=hs.shift();hs.length>0&&queueMicrotask(Bl),n()}let _r=[],Es=null,da=!1,os=!1;class zr{current=new Map;#i=new Map;#n=new Set;#e=0;#s=null;#a=!1;#t=[];#r=[];#l=[];#o=[];#u=[];#d=[];#h=[];skipped_effects=new Set;process(e){_r=[],as=null;for(const s of e)this.#v(s);if(this.#t.length===0&&this.#e===0){this.#f();var t=this.#l,r=this.#o;this.#l=[],this.#o=[],this.#u=[],as=vt,vt=null,Bo(t),Bo(r),vt===null?vt=this:Hs.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const s of this.#t)qr(s);for(const s of this.#r)qr(s);this.#t=[],this.#r=[]}#v(e){e.f^=Wt;for(var t=e.first;t!==null;){var r=t.f,s=(r&(Bn|yr))!==0,l=s&&(r&Wt)!==0,u=l||(r&_n)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(s)t.f^=Wt;else if((r&Pa)!==0)this.#o.push(t);else if((r&Wt)===0)if((r&ja)!==0){var h=t.b?.pending?this.#r:this.#t;h.push(t)}else Cs(t)&&((t.f&Qr)!==0&&this.#u.push(t),qr(t));var f=t.first;if(f!==null){t=f;continue}}var _=t.parent;for(t=t.next;t===null&&_!==null;)t=_.next,_=_.parent}}#c(e){for(const t of e)((t.f&un)!==0?this.#d:this.#h).push(t),Zt(t,Wt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){vt=this}deactivate(){vt=null,as=null;for(const e of No)if(No.delete(e),e(),vt!==null)break}neuter(){this.#a=!0}flush(){_r.length>0?Wl():this.#f(),vt===this&&(this.#e===0&&Hs.delete(this),this.deactivate())}#f(){if(!this.#a)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)Zt(e,un),Hr(e);for(const e of this.#h)Zt(e,Xn),Hr(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#s??=cc()).promise}static ensure(){if(vt===null){const e=vt=new zr;Hs.add(vt),os||zr.enqueue(()=>{vt===e&&e.flush()})}return vt}static enqueue(e){hs.length===0&&queueMicrotask(Bl),hs.unshift(e)}}function Kc(n){var e=os;os=!0;try{for(var t;;){if(Wc(),_r.length===0&&(vt?.flush(),_r.length===0))return Es=null,t;Wl()}}finally{os=e}}function Wl(){var n=Vr;da=!0;try{var e=0;for(zo(!0);_r.length>0;){var t=zr.ensure();if(e++>1e3){var r,s;Yc()}t.process(_r),Kn.clear()}}finally{da=!1,zo(n),Es=null}}function Yc(){try{yc()}catch(n){Oa(n,Es)}}let hr=null;function Bo(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(br|_n))===0&&Cs(r)&&(hr=[],qr(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Ql(r):r.fn=null),hr?.length>0)){Kn.clear();for(const s of hr)qr(s);hr=[]}}hr=null}}function Hr(n){for(var e=Es=n;e.parent!==null;){e=e.parent;var t=e.f;if(da&&e===tt&&(t&Qr)!==0)return;if((t&(yr|Bn))!==0){if((t&Wt)===0)return;e.f^=Wt}}_r.push(e)}const Kn=new Map;function Gr(n,e){var t={f:0,v:n,reactions:null,equals:Rl,rv:0,wv:0};return t}function ft(n,e){const t=Gr(n);return tu(t),t}function Jc(n,e=!1,t=!0){const r=Gr(n);return e||(r.equals=Ml),Zr&&t&&St!==null&&St.l!==null&&(St.l.s??=[]).push(r),r}function Me(n,e,t=!1){st!==null&&(!An||(st.f&Uo)!==0)&&ei()&&(st.f&(rn|Qr|ja|Uo))!==0&&!Un?.includes(n)&&Ec();let r=t?Gt(e):e;return Kr(n,r)}function Kr(n,e){if(!n.equals(e)){var t=n.v;wr?Kn.set(n,e):Kn.set(n,t),n.v=e;var r=zr.ensure();r.capture(n,t),(n.f&rn)!==0&&((n.f&un)!==0&&La(n),Zt(n,(n.f&ln)===0?Wt:Xn)),n.wv=ru(),Vl(n,un),ei()&&tt!==null&&(tt.f&Wt)!==0&&(tt.f&(Bn|yr))===0&&(on===null?cd([n]):on.push(n))}return e}function Xc(n,e=1){var t=S(n),r=e===1?t++:t--;return Me(n,t),r}function Gs(n){Me(n,n.v+1)}function Vl(n,e){var t=n.reactions;if(t!==null)for(var r=ei(),s=t.length,l=0;l<s;l++){var u=t[l],h=u.f;if(!(!r&&u===tt)){var f=(h&un)===0;f&&Zt(u,e),(h&rn)!==0?Vl(u,Xn):f&&((h&Qr)!==0&&hr!==null&&hr.push(u),Hr(u))}}}function Gt(n){if(typeof n!="object"||n===null||Fn in n)return n;const e=Ta(n);if(e!==oc&&e!==lc)return n;var t=new Map,r=Ei(n),s=ft(0),l=gr,u=h=>{if(gr===l)return h();var f=st,_=gr;Tn(null),Go(l);var m=h();return Tn(f),Go(_),m};return r&&t.set("length",ft(n.length)),new Proxy(n,{defineProperty(h,f,_){(!("value"in _)||_.configurable===!1||_.enumerable===!1||_.writable===!1)&&wc();var m=t.get(f);return m===void 0?m=u(()=>{var w=ft(_.value);return t.set(f,w),w}):Me(m,_.value,!0),!0},deleteProperty(h,f){var _=t.get(f);if(_===void 0){if(f in h){const m=u(()=>ft(Lt));t.set(f,m),Gs(s)}}else Me(_,Lt),Gs(s);return!0},get(h,f,_){if(f===Fn)return n;var m=t.get(f),w=f in h;if(m===void 0&&(!w||Wr(h,f)?.writable)&&(m=u(()=>{var g=Gt(w?h[f]:Lt),A=ft(g);return A}),t.set(f,m)),m!==void 0){var E=S(m);return E===Lt?void 0:E}return Reflect.get(h,f,_)},getOwnPropertyDescriptor(h,f){var _=Reflect.getOwnPropertyDescriptor(h,f);if(_&&"value"in _){var m=t.get(f);m&&(_.value=S(m))}else if(_===void 0){var w=t.get(f),E=w?.v;if(w!==void 0&&E!==Lt)return{enumerable:!0,configurable:!0,value:E,writable:!0}}return _},has(h,f){if(f===Fn)return!0;var _=t.get(f),m=_!==void 0&&_.v!==Lt||Reflect.has(h,f);if(_!==void 0||tt!==null&&(!m||Wr(h,f)?.writable)){_===void 0&&(_=u(()=>{var E=m?Gt(h[f]):Lt,g=ft(E);return g}),t.set(f,_));var w=S(_);if(w===Lt)return!1}return m},set(h,f,_,m){var w=t.get(f),E=f in h;if(r&&f==="length")for(var g=_;g<w.v;g+=1){var A=t.get(g+"");A!==void 0?Me(A,Lt):g in h&&(A=u(()=>ft(Lt)),t.set(g+"",A))}if(w===void 0)(!E||Wr(h,f)?.writable)&&(w=u(()=>ft(void 0)),Me(w,Gt(_)),t.set(f,w));else{E=w.v!==Lt;var $=u(()=>Gt(_));Me(w,$)}var j=Reflect.getOwnPropertyDescriptor(h,f);if(j?.set&&j.set.call(m,_),!E){if(r&&typeof f=="string"){var F=t.get("length"),W=Number(f);Number.isInteger(W)&&W>=F.v&&Me(F,W+1)}Gs(s)}return!0},ownKeys(h){S(s);var f=Reflect.ownKeys(h).filter(w=>{var E=t.get(w);return E===void 0||E.v!==Lt});for(var[_,m]of t)m.v!==Lt&&!(_ in h)&&f.push(_);return f},setPrototypeOf(){kc()}})}function Wo(n){try{if(n!==null&&typeof n=="object"&&Fn in n)return n[Fn]}catch{}return n}function Qc(n,e){return Object.is(Wo(n),Wo(e))}var Vo,ql,zl,Hl;function Zc(){if(Vo===void 0){Vo=window,ql=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;zl=Wr(e,"firstChild").get,Hl=Wr(e,"nextSibling").get,Fo(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Fo(t)&&(t.__t=void 0)}}function Qn(n=""){return document.createTextNode(n)}function Yr(n){return zl.call(n)}function Ss(n){return Hl.call(n)}function T(n,e){return Yr(n)}function At(n,e){{var t=Yr(n);return t instanceof Comment&&t.data===""?Ss(t):t}}function D(n,e=1,t=!1){let r=n;for(;e--;)r=Ss(r);return r}function ed(n){n.textContent=""}function Is(){return!1}let qo=!1;function td(){qo||(qo=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Da(n){var e=st,t=tt;Tn(null),Yn(null);try{return n()}finally{Tn(e),Yn(t)}}function $a(n,e,t,r=t){n.addEventListener(e,()=>Da(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),td()}function Gl(n){tt===null&&st===null&&mc(),st!==null&&(st.f&ln)!==0&&tt===null&&_c(),wr&&gc()}function nd(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Pn(n,e,t,r=!0){var s=tt;s!==null&&(s.f&_n)!==0&&(n|=_n);var l={ctx:St,deps:null,nodes_start:null,nodes_end:null,f:n|un,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{qr(l),l.f|=xa}catch(f){throw Nn(l),f}else e!==null&&Hr(l);if(r){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Si)===0&&(u=u.first),u!==null&&(u.parent=s,s!==null&&nd(u,s),st!==null&&(st.f&rn)!==0&&(n&yr)===0)){var h=st;(h.effects??=[]).push(u)}}return l}function rd(n){const e=Pn(ys,null,!1);return Zt(e,Wt),e.teardown=n,e}function Jr(n){Gl();var e=tt.f,t=!st&&(e&Bn)!==0&&(e&xa)===0;if(t){var r=St;(r.e??=[]).push(n)}else return Kl(n)}function Kl(n){return Pn(Pa|Pl,n,!1)}function id(n){return Gl(),Pn(ys|Pl,n,!0)}function sd(n){zr.ensure();const e=Pn(yr|Si,n,!0);return(t={})=>new Promise(r=>{t.outro?Ai(e,()=>{Nn(e),r(void 0)}):(Nn(e),r(void 0))})}function Yl(n){return Pn(Pa,n,!1)}function ad(n){return Pn(ja|Si,n,!0)}function Fa(n,e=0){return Pn(ys|e,n,!0)}function Ae(n,e=[],t=[]){Hc(e,t,r=>{Pn(ys,()=>n(...r.map(S)),!0)})}function As(n,e=0){var t=Pn(Qr|e,n,!0);return t}function mr(n,e=!0){return Pn(Bn|Si,n,!0,e)}function Jl(n){var e=n.teardown;if(e!==null){const t=wr,r=st;Ho(!0),Tn(null);try{e.call(null)}finally{Ho(t),Tn(r)}}}function Xl(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&Da(()=>{s.abort(Ra)});var r=t.next;(t.f&yr)!==0?t.parent=null:Nn(t,e),t=r}}function od(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Bn)===0&&Nn(e),e=t}}function Nn(n,e=!0){var t=!1;(e||(n.f&dc)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(ld(n.nodes_start,n.nodes_end),t=!0),Xl(n,e&&!t),fs(n,0),Zt(n,br);var r=n.transitions;if(r!==null)for(const l of r)l.stop();Jl(n);var s=n.parent;s!==null&&s.first!==null&&Ql(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function ld(n,e){for(;n!==null;){var t=n===e?null:Ss(n);n.remove(),n=t}}function Ql(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ai(n,e){var t=[];Ua(n,t,!0),Zl(t,()=>{Nn(n),e&&e()})}function Zl(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function Ua(n,e,t){if((n.f&_n)===0){if(n.f^=_n,n.transitions!==null)for(const u of n.transitions)(u.is_global||t)&&e.push(u);for(var r=n.first;r!==null;){var s=r.next,l=(r.f&bs)!==0||(r.f&Bn)!==0;Ua(r,e,l?t:!1),r=s}}}function Na(n){eu(n,!0)}function eu(n,e){if((n.f&_n)!==0){n.f^=_n,(n.f&Wt)===0&&(Zt(n,un),Hr(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&bs)!==0||(t.f&Bn)!==0;eu(t,s?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let Ur=null;function ud(n){var e=Ur;try{if(Ur=new Set,kr(n),e!==null)for(var t of Ur)e.add(t);return Ur}finally{Ur=e}}function pn(n){for(var e of ud(n))Kr(e,e.v)}let Vr=!1;function zo(n){Vr=n}let wr=!1;function Ho(n){wr=n}let st=null,An=!1;function Tn(n){st=n}let tt=null;function Yn(n){tt=n}let Un=null;function tu(n){st!==null&&(Un===null?Un=[n]:Un.push(n))}let Ht=null,nn=0,on=null;function cd(n){on=n}let nu=1,bi=0,gr=bi;function Go(n){gr=n}let Gn=!1;function ru(){return++nu}function Cs(n){var e=n.f;if((e&un)!==0)return!0;if((e&Xn)!==0){var t=n.deps,r=(e&ln)!==0;if(t!==null){var s,l,u=(e&cs)!==0,h=r&&tt!==null&&!Gn,f=t.length;if((u||h)&&(tt===null||(tt.f&br)===0)){var _=n,m=_.parent;for(s=0;s<f;s++)l=t[s],(u||!l?.reactions?.includes(_))&&(l.reactions??=[]).push(_);u&&(_.f^=cs),h&&m!==null&&(m.f&ln)===0&&(_.f^=ln)}for(s=0;s<f;s++)if(l=t[s],Cs(l)&&Ul(l),l.wv>n.wv)return!0}(!r||tt!==null&&!Gn)&&Zt(n,Wt)}return!1}function iu(n,e,t=!0){var r=n.reactions;if(r!==null&&!Un?.includes(n))for(var s=0;s<r.length;s++){var l=r[s];(l.f&rn)!==0?iu(l,e,!1):e===l&&(t?Zt(l,un):(l.f&Wt)!==0&&Zt(l,Xn),Hr(l))}}function su(n){var e=Ht,t=nn,r=on,s=st,l=Gn,u=Un,h=St,f=An,_=gr,m=n.f;Ht=null,nn=0,on=null,Gn=(m&ln)!==0&&(An||!Vr||st===null),st=(m&(Bn|yr))===0?n:null,Un=null,ds(n.ctx),An=!1,gr=++bi,n.ac!==null&&(Da(()=>{n.ac.abort(Ra)}),n.ac=null);try{n.f|=ua;var w=n.fn,E=w(),g=n.deps;if(Ht!==null){var A;if(fs(n,nn),g!==null&&nn>0)for(g.length=nn+Ht.length,A=0;A<Ht.length;A++)g[nn+A]=Ht[A];else n.deps=g=Ht;if(!Gn||(m&rn)!==0&&n.reactions!==null)for(A=nn;A<g.length;A++)(g[A].reactions??=[]).push(n)}else g!==null&&nn<g.length&&(fs(n,nn),g.length=nn);if(ei()&&on!==null&&!An&&g!==null&&(n.f&(rn|Xn|un))===0)for(A=0;A<on.length;A++)iu(on[A],n);return s!==null&&s!==n&&(bi++,on!==null&&(r===null?r=on:r.push(...on))),(n.f&pr)!==0&&(n.f^=pr),E}catch($){return Nc($)}finally{n.f^=ua,Ht=e,nn=t,on=r,st=s,Gn=l,Un=u,ds(h),An=f,gr=_}}function dd(n,e){let t=e.reactions;if(t!==null){var r=ac.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&rn)!==0&&(Ht===null||!Ht.includes(e))&&(Zt(e,Xn),(e.f&(ln|cs))===0&&(e.f^=cs),Fl(e),fs(e,0))}function fs(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)dd(n,t[r])}function qr(n){var e=n.f;if((e&br)===0){Zt(n,Wt);var t=tt,r=Vr;tt=n,Vr=!0;try{(e&Qr)!==0?od(n):Xl(n),Jl(n);var s=su(n);n.teardown=typeof s=="function"?s:null,n.wv=nu;var l;Al&&$c&&(n.f&un)!==0&&n.deps}finally{Vr=r,tt=t}}}async function au(){await Promise.resolve(),Kc()}function S(n){var e=n.f,t=(e&rn)!==0;if(Ur?.add(n),st!==null&&!An){var r=tt!==null&&(tt.f&br)!==0;if(!r&&!Un?.includes(n)){var s=st.deps;if((st.f&ua)!==0)n.rv<bi&&(n.rv=bi,Ht===null&&s!==null&&s[nn]===n?nn++:Ht===null?Ht=[n]:(!Gn||!Ht.includes(n))&&Ht.push(n));else{(st.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[st]:l.includes(st)||l.push(st)}}}else if(t&&n.deps===null&&n.effects===null){var u=n,h=u.parent;h!==null&&(h.f&ln)===0&&(u.f^=ln)}if(wr){if(Kn.has(n))return Kn.get(n);if(t){u=n;var f=u.v;return((u.f&Wt)===0&&u.reactions!==null||ou(u))&&(f=La(u)),Kn.set(u,f),f}}else t&&(u=n,Cs(u)&&Ul(u));if((n.f&pr)!==0)throw n.v;return n.v}function ou(n){if(n.v===Lt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Kn.has(e)||(e.f&rn)!==0&&ou(e))return!0;return!1}function kr(n){var e=An;try{return An=!0,n()}finally{An=e}}const hd=-7169;function Zt(n,e){n.f=n.f&hd|e}function fd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Fn in n)ha(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Fn in t&&ha(t)}}}function ha(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{ha(n[r],e)}catch{}const t=Ta(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Cl(t);for(let s in r){const l=r[s].get;if(l)try{l.call(n)}catch{}}}}}const vd=["touchstart","touchmove"];function pd(n){return vd.includes(n)}const lu=new Set,fa=new Set;function Yt(n){for(var e=0;e<n.length;e++)lu.add(n[e]);for(var t of fa)t(n)}let Ko=null;function Qi(n){var e=this,t=e.ownerDocument,r=n.type,s=n.composedPath?.()||[],l=s[0]||n.target;Ko=n;var u=0,h=Ko===n&&n.__root;if(h){var f=s.indexOf(h);if(f!==-1&&(e===document||e===window)){n.__root=e;return}var _=s.indexOf(e);if(_===-1)return;f<=_&&(u=f)}if(l=s[u]||n.target,l!==e){la(n,"currentTarget",{configurable:!0,get(){return l||t}});var m=st,w=tt;Tn(null),Yn(null);try{for(var E,g=[];l!==null;){var A=l.assignedSlot||l.parentNode||l.host||null;try{var $=l["__"+r];if($!=null&&(!l.disabled||n.target===l))if(Ei($)){var[j,...F]=$;j.apply(l,[n,...F])}else $.call(l,n)}catch(W){E?g.push(W):E=W}if(n.cancelBubble||A===e||A===null)break;l=A}if(E){for(let W of g)queueMicrotask(()=>{throw W});throw E}}finally{n.__root=e,delete n.currentTarget,Tn(m),Yn(w)}}}function uu(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function wi(n,e){var t=tt;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function se(n,e){var t=(e&jc)!==0,r=(e&Rc)!==0,s,l=!n.startsWith("<!>");return()=>{s===void 0&&(s=uu(l?n:"<!>"+n),t||(s=Yr(s)));var u=r||ql?document.importNode(s,!0):s.cloneNode(!0);if(t){var h=Yr(u),f=u.lastChild;wi(h,f)}else wi(u,u);return u}}function gd(n,e,t="svg"){var r=!n.startsWith("<!>"),s=`<${t}>${r?n:"<!>"+n}</${t}>`,l;return()=>{if(!l){var u=uu(s),h=Yr(u);l=Yr(h)}var f=l.cloneNode(!0);return wi(f,f),f}}function _d(n,e){return gd(n,e,"svg")}function Zi(n=""){{var e=Qn(n+"");return wi(e,e),e}}function Kt(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Qn();return n.append(e,t),wi(e,t),n}function K(n,e){n!==null&&n.before(e)}function Te(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function md(n,e){return yd(n,e)}const Tr=new Map;function yd(n,{target:e,anchor:t,props:r={},events:s,context:l,intro:u=!0}){Zc();var h=new Set,f=w=>{for(var E=0;E<w.length;E++){var g=w[E];if(!h.has(g)){h.add(g);var A=pd(g);e.addEventListener(g,Qi,{passive:A});var $=Tr.get(g);$===void 0?(document.addEventListener(g,Qi,{passive:A}),Tr.set(g,1)):Tr.set(g,$+1)}}};f(Ca(lu)),fa.add(f);var _=void 0,m=sd(()=>{var w=t??e.appendChild(Qn());return mr(()=>{if(l){Vt({});var E=St;E.c=l}s&&(r.$$events=s),_=n(w,r)||{},l&&qt()}),()=>{for(var E of h){e.removeEventListener(E,Qi);var g=Tr.get(E);--g===0?(document.removeEventListener(E,Qi),Tr.delete(E)):Tr.set(E,g)}fa.delete(f),w!==t&&w.parentNode?.removeChild(w)}});return bd.set(_,m),_}let bd=new WeakMap;function Le(n,e,t=!1){var r=n,s=null,l=null,u=Lt,h=t?bs:0,f=!1;const _=(g,A=!0)=>{f=!0,E(A,g)};var m=null;function w(){m!==null&&(m.lastChild.remove(),r.before(m),m=null);var g=u?s:l,A=u?l:s;g&&Na(g),A&&Ai(A,()=>{u?l=null:s=null})}const E=(g,A)=>{if(u!==(u=g)){var $=Is(),j=r;if($&&(m=document.createDocumentFragment(),m.append(j=Qn())),u?s??=A&&mr(()=>A(j)):l??=A&&mr(()=>A(j)),$){var F=vt,W=u?s:l,U=u?l:s;W&&F.skipped_effects.delete(W),U&&F.skipped_effects.add(U),F.add_callback(w)}else w()}};As(()=>{f=!1,e(_),f||E(null,null)},h)}function va(n,e,t){var r=n,s=Lt,l,u,h=null,f=ei()?Dc:Ol;function _(){l&&Ai(l),h!==null&&(h.lastChild.remove(),r.before(h),h=null),l=u}As(()=>{if(f(s,s=e())){var m=r,w=Is();w&&(h=document.createDocumentFragment(),h.append(m=Qn())),u=mr(()=>t(m)),w?vt.add_callback(_):_()}})}function Ut(n,e){return e}function wd(n,e,t){for(var r=n.items,s=[],l=e.length,u=0;u<l;u++)Ua(e[u].e,s,!0);var h=l>0&&s.length===0&&t!==null;if(h){var f=t.parentNode;ed(f),f.append(t),r.clear(),En(n,e[0].prev,e[l-1].next)}Zl(s,()=>{for(var _=0;_<l;_++){var m=e[_];h||(r.delete(m.k),En(n,m.prev,m.next)),Nn(m.e,!h)}})}function wt(n,e,t,r,s,l=null){var u=n,h={flags:e,items:new Map,first:null},f=(e&jl)!==0;if(f){var _=n;u=_.appendChild(Qn())}var m=null,w=!1,E=new Map,g=ti(()=>{var F=t();return Ei(F)?F:F==null?[]:Ca(F)}),A,$;function j(){kd($,A,h,E,u,s,e,r,t),l!==null&&(A.length===0?m?Na(m):m=mr(()=>l(u)):m!==null&&Ai(m,()=>{m=null}))}As(()=>{$??=tt,A=S(g);var F=A.length;if(!(w&&F===0)){w=F===0;var W,U,z,J;if(Is()){var L=new Set,B=vt;for(U=0;U<F;U+=1){z=A[U],J=r(z,U);var le=h.items.get(J)??E.get(J);le?(e&(ws|ks))!==0&&cu(le,z,U,e):(W=du(null,h,null,null,z,J,U,s,e,t,!0),E.set(J,W)),L.add(J)}for(const[te,ye]of h.items)L.has(te)||B.skipped_effects.add(ye.e);B.add_callback(j)}else j();S(g)}})}function kd(n,e,t,r,s,l,u,h,f){var _=(u&Sc)!==0,m=(u&(ws|ks))!==0,w=e.length,E=t.items,g=t.first,A=g,$,j=null,F,W=[],U=[],z,J,L,B;if(_)for(B=0;B<w;B+=1)z=e[B],J=h(z,B),L=E.get(J),L!==void 0&&(L.a?.measure(),(F??=new Set).add(L));for(B=0;B<w;B+=1){if(z=e[B],J=h(z,B),L=E.get(J),L===void 0){var le=r.get(J);if(le!==void 0){r.delete(J),E.set(J,le);var te=j?j.next:A;En(t,j,le),En(t,le,te),Ks(le,te,s),j=le}else{var ye=A?A.e.nodes_start:s;j=du(ye,t,j,j===null?t.first:j.next,z,J,B,l,u,f)}E.set(J,j),W=[],U=[],A=j.next;continue}if(m&&cu(L,z,B,u),(L.e.f&_n)!==0&&(Na(L.e),_&&(L.a?.unfix(),(F??=new Set).delete(L))),L!==A){if($!==void 0&&$.has(L)){if(W.length<U.length){var X=U[0],Q;j=X.prev;var ge=W[0],Pe=W[W.length-1];for(Q=0;Q<W.length;Q+=1)Ks(W[Q],X,s);for(Q=0;Q<U.length;Q+=1)$.delete(U[Q]);En(t,ge.prev,Pe.next),En(t,j,ge),En(t,Pe,X),A=X,j=Pe,B-=1,W=[],U=[]}else $.delete(L),Ks(L,A,s),En(t,L.prev,L.next),En(t,L,j===null?t.first:j.next),En(t,j,L),j=L;continue}for(W=[],U=[];A!==null&&A.k!==J;)(A.e.f&_n)===0&&($??=new Set).add(A),U.push(A),A=A.next;if(A===null)continue;L=A}W.push(L),j=L,A=L.next}if(A!==null||$!==void 0){for(var de=$===void 0?[]:Ca($);A!==null;)(A.e.f&_n)===0&&de.push(A),A=A.next;var me=de.length;if(me>0){var ve=(u&jl)!==0&&w===0?s:null;if(_){for(B=0;B<me;B+=1)de[B].a?.measure();for(B=0;B<me;B+=1)de[B].a?.fix()}wd(t,de,ve)}}_&&$l(()=>{if(F!==void 0)for(L of F)L.a?.apply()}),n.first=t.first&&t.first.e,n.last=j&&j.e;for(var dt of r.values())Nn(dt.e);r.clear()}function cu(n,e,t,r){(r&ws)!==0&&Kr(n.v,e),(r&ks)!==0?Kr(n.i,t):n.i=t}function du(n,e,t,r,s,l,u,h,f,_,m){var w=(f&ws)!==0,E=(f&Ic)===0,g=w?E?Jc(s,!1,!1):Gr(s):s,A=(f&ks)===0?u:Gr(u),$={i:A,v:g,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var j=document.createDocumentFragment();j.append(n=Qn())}return $.e=mr(()=>h(n,g,A,_),Lc),$.e.prev=t&&t.e,$.e.next=r&&r.e,t===null?m||(e.first=$):(t.next=$,t.e.next=$.e),r!==null&&(r.prev=$,r.e.prev=$.e),$}finally{}}function Ks(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var u=Ss(l);s.before(l),l=u}}function En(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ed(n,e,t){var r=n,s,l,u=null,h=null;function f(){l&&(Ai(l),l=null),u&&(u.lastChild.remove(),r.before(u),u=null),l=h,h=null}As(()=>{if(s!==(s=e())){var _=Is();if(s){var m=r;_&&(u=document.createDocumentFragment(),u.append(m=Qn()),l&&vt.skipped_effects.add(l)),h=mr(()=>t(m,s))}_?vt.add_callback(f):f()}},bs)}const Yo=[...` 	
\r\f \v\uFEFF`];function Sd(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var l=s.length,u=0;(u=r.indexOf(s,u))>=0;){var h=u+l;(u===0||Yo.includes(r[u-1]))&&(h===r.length||Yo.includes(r[h]))?r=(u===0?"":r.substring(0,u))+r.substring(h+1):u=h}}return r===""?null:r}function Id(n,e){return String(n)}function mn(n,e,t,r,s,l){var u=n.__className;if(u!==t||u===void 0){var h=Sd(t,r,l);h==null?n.removeAttribute("class"):n.className=h,n.__className=t}else if(l&&s!==l)for(var f in l){var _=!!l[f];(s==null||_!==!!s[f])&&n.classList.toggle(f,_)}return l}function Ad(n,e,t,r){var s=n.__style;if(s!==e){var l=Id(e);l==null?n.removeAttribute("style"):n.style.cssText=l,n.__style=e}return r}function vs(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Ei(e))return Mc();for(var r of n.options)r.selected=e.includes(pi(r));return}for(r of n.options){var s=pi(r);if(Qc(s,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function pa(n){var e=new MutationObserver(()=>{vs(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),rd(()=>{e.disconnect()})}function Cn(n,e,t=e){var r=!0;$a(n,"change",s=>{var l=s?"[selected]":":checked",u;if(n.multiple)u=[].map.call(n.querySelectorAll(l),pi);else{var h=n.querySelector(l)??n.querySelector("option:not([disabled])");u=h&&pi(h)}t(u)}),Yl(()=>{var s=e();if(vs(n,s,r),r&&s===void 0){var l=n.querySelector(":checked");l!==null&&(s=pi(l),t(s))}n.__value=s,r=!1}),pa(n)}function pi(n){return"__value"in n?n.__value:n.value}const Cd=Symbol("is custom element"),Td=Symbol("is html");function Ys(n,e){var t=hu(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Re(n,e,t,r){var s=hu(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[fc]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Pd(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function hu(n){return n.__attributes??={[Cd]:n.nodeName.includes("-"),[Td]:n.namespaceURI===Oc}}var Jo=new Map;function Pd(n){var e=n.getAttribute("is")||n.nodeName,t=Jo.get(e);if(t)return t;Jo.set(e,t=[]);for(var r,s=n,l=Element.prototype;l!==s;){r=Cl(s);for(var u in r)r[u].set&&t.push(u);s=Ta(s)}return t}function $n(n,e,t=e){var r=new WeakSet;$a(n,"input",async s=>{var l=s?n.defaultValue:n.value;if(l=Xs(n)?Qs(l):l,t(l),vt!==null&&r.add(vt),await au(),l!==(l=e())){var u=n.selectionStart,h=n.selectionEnd;n.value=l??"",h!==null&&(n.selectionStart=u,n.selectionEnd=Math.min(h,n.value.length))}}),kr(e)==null&&n.value&&(t(Xs(n)?Qs(n.value):n.value),vt!==null&&r.add(vt)),Fa(()=>{var s=e();if(n===document.activeElement){var l=as??vt;if(r.has(l))return}Xs(n)&&s===Qs(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Js(n,e,t=e){$a(n,"change",r=>{var s=r?n.defaultChecked:n.checked;t(s)}),kr(e)==null&&t(n.checked),Fa(()=>{var r=e();n.checked=!!r})}function Xs(n){var e=n.type;return e==="number"||e==="range"}function Qs(n){return n===""?null:+n}function Xo(n,e){return n===e||n?.[Fn]===e}function ps(n={},e,t,r){return Yl(()=>{var s,l;return Fa(()=>{s=l,l=[],kr(()=>{n!==t(...l)&&(e(n,...l),s&&Xo(t(...s),n)&&e(null,...s))})}),()=>{$l(()=>{l&&Xo(t(...l),n)&&e(null,...l)})}}),n}function Zn(n=!1){const e=St,t=e.l.u;if(!t)return;let r=()=>fd(e.s);if(n){let s=0,l={};const u=Ii(()=>{let h=!1;const f=e.s;for(const _ in f)f[_]!==l[_]&&(l[_]=f[_],h=!0);return h&&s++,s});r=()=>S(u)}t.b.length&&id(()=>{Qo(e,r),us(t.b)}),Jr(()=>{const s=kr(()=>t.m.map(uc));return()=>{for(const l of s)typeof l=="function"&&l()}}),t.a.length&&Jr(()=>{Qo(e,r),us(t.a)})}function Qo(n,e){if(n.l.s)for(const t of n.l.s)S(t);e()}function er(n){var e=Gr(0);return function(){return arguments.length===1?(Me(e,S(e)+1),arguments[0]):(S(e),n())}}let es=!1;function xd(n){var e=es;try{return es=!1,[n(),es]}finally{es=e}}function Ts(n,e,t,r){var s=!Zr||(t&Cc)!==0,l=(t&Pc)!==0,u=(t&xc)!==0,h=r,f=!0,_=()=>(f&&(f=!1,h=u?kr(r):r),h),m;if(l){var w=Fn in n||hc in n;m=Wr(n,e)?.set??(w&&e in n?U=>n[e]=U:void 0)}var E,g=!1;l?[E,g]=xd(()=>n[e]):E=n[e],E===void 0&&r!==void 0&&(E=_(),m&&(s&&bc(),m(E)));var A;if(s?A=()=>{var U=n[e];return U===void 0?_():(f=!0,U)}:A=()=>{var U=n[e];return U!==void 0&&(h=void 0),U===void 0?h:U},s&&(t&Tc)===0)return A;if(m){var $=n.$$legacy;return(function(U,z){return arguments.length>0?((!s||!z||$||g)&&m(z?A():U),U):A()})}var j=!1,F=((t&Ac)!==0?Ii:ti)(()=>(j=!1,A()));l&&S(F);var W=tt;return(function(U,z){if(arguments.length>0){const J=z?S(F):s&&l?Gt(U):U;return Me(F,J),j=!0,h!==void 0&&(h=J),U}return wr&&j||(W.f&br)!==0?F.v:S(F)})}function Ci(n){St===null&&xl(),Zr&&St.l!==null?Od(St).m.push(n):Jr(()=>{const e=kr(n);if(typeof e=="function")return e})}function jd(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function Rd(){const n=St;return n===null&&xl(),(e,t,r)=>{const s=n.s.$$events?.[e];if(s){const l=Ei(s)?s.slice():[s],u=jd(e,t,r);for(const h of l)h.call(n.x,u);return!u.defaultPrevented}return!0}}function Od(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Md="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Md);Fc();const R=Gt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Dt={get currentDialogue(){return R.data?.dialogues.find(n=>n.id===R.selectedDialogueId)},get currentChapter(){return R.data?.chapters?.find(n=>n.id===R.selectedChapterId)},get currentEditingChapter(){return R.data?.chapters?.find(n=>n.id===R.editingChapterId)},get currentEditingOption(){return Dt.currentDialogue&&R.editingOptionIndex!==null?Dt.currentDialogue.options?.[R.editingOptionIndex]:void 0},get chapterDialogues(){return!R.data?.dialogues||!R.selectedChapterId?[]:R.data.dialogues.filter(n=>n.chapterId===R.selectedChapterId)},get imageResources(){return R.storedFiles.filter(n=>n.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return R.storedFiles.filter(n=>n.name.endsWith(".riv"))},get availableItems(){return R.data?.items||[]},get backlinks(){return!R.data||!R.selectedDialogueId?[]:R.data.dialogues.filter(n=>n.nextDialogueId===R.selectedDialogueId?!0:n.options?n.options.some(e=>e.nextDialogueId===R.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},ot={toggleEditor(){R.showEditor=!R.showEditor},toggleItemsPanel(){R.showItems=!R.showItems},setStatus(n,e){R.statusMessage={type:n,text:e}},clearStatus(){R.statusMessage={type:"",text:""}},selectBucket(n){R.selectedBucket=n,R.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},R.storedFiles=[],R.storiesList=[],R.selectedChapterId=null,R.selectedDialogueId=null},updateBucketsList(n){R.availableBuckets=n},selectChapter(n){R.selectedChapterId=n,R.selectedDialogueId=null},selectDialogue(n){R.selectedDialogueId=n},selectOption(n){R.editingOptionIndex=n},selectItem(n){R.editingItemIndex=n},updateStoryData(n){R.data=n},updateStoredFiles(n){R.storedFiles=n},updateStoriesList(n){R.storiesList=n},setCurrentFileName(n){R.currentFileName=n},addDialogue(n){R.data.dialogues=[...R.data.dialogues,n]},updateDialogue(n,e){R.data.dialogues=R.data.dialogues.map(t=>t.id===n?{...t,...e}:t)},deleteDialogue(n){R.data.dialogues=R.data.dialogues.filter(e=>e.id!==n),R.selectedDialogueId===n&&(R.selectedDialogueId=null)},addChapter(n){R.data.chapters=[...R.data.chapters,n]},updateChapter(n,e){R.data.chapters=R.data.chapters.map(t=>t.id===n?{...t,...e}:t)},selectEditingChapter(n){R.editingChapterId=n},deleteChapter(n){R.data.chapters=R.data.chapters.filter(e=>e.id!==n),R.selectedChapterId===n&&(R.selectedChapterId=null,R.selectedDialogueId=null)},addItem(n){R.data.items=[...R.data.items||[],n]},updateItem(n,e){R.data.items&&(R.data.items=R.data.items.map(t=>t.id===n?{...t,...e}:t))},deleteItem(n){R.data.items&&(R.data.items=R.data.items.filter(e=>e.id!==n))},reset(){R.showEditor=!1,R.showItems=!1,R.editingOptionIndex=null,R.editingItemIndex=null,R.selectedChapterId=null,R.selectedDialogueId=null,R.statusMessage={type:"",text:""}}},Ld="modulepreload",Dd=function(n,e){return new URL(n,e).href},Zo={},Ti=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let _=function(m){return Promise.all(m.map(w=>Promise.resolve(w).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");s=_(t.map(m=>{if(m=Dd(m,r),m in Zo)return;Zo[m]=!0;const w=m.endsWith(".css"),E=w?'[rel="stylesheet"]':"";if(!!r)for(let $=u.length-1;$>=0;$--){const j=u[$];if(j.href===m&&(!w||j.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${E}`))return;const A=document.createElement("link");if(A.rel=w?"stylesheet":Ld,w||(A.as="script"),A.crossOrigin="",A.href=m,f&&A.setAttribute("nonce",f),document.head.appendChild(A),w)return new Promise(($,j)=>{A.addEventListener("load",$),A.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},$d=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:r}=await Promise.resolve().then(()=>ni);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ba extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Fd extends Ba{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class el extends Ba{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class tl extends Ba{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ga;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(ga||(ga={}));var Ud=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};class Nd{constructor(e,{headers:t={},customFetch:r,region:s=ga.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=$d(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ud(this,void 0,void 0,function*(){try{const{headers:s,method:l,body:u}=t;let h={},{region:f}=t;f||(f=this.region);const _=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,_.searchParams.set("forceFunctionRegion",f));let m;u&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",m=u):typeof u=="string"?(h["Content-Type"]="text/plain",m=u):typeof FormData<"u"&&u instanceof FormData?m=u:(h["Content-Type"]="application/json",m=JSON.stringify(u)));const w=yield this.fetch(_.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:m}).catch($=>{throw new Fd($)}),E=w.headers.get("x-relay-error");if(E&&E==="true")throw new el(w);if(!w.ok)throw new tl(w);let g=((r=w.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),A;return g==="application/json"?A=yield w.json():g==="application/octet-stream"?A=yield w.blob():g==="text/event-stream"?A=w:g==="multipart/form-data"?A=yield w.formData():A=yield w.text(),{data:A,error:null,response:w}}catch(s){return{data:null,error:s,response:s instanceof tl||s instanceof el?s.context:void 0}}})}}function Bd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Wd(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Mt={},Pr={},xr={},jr={},Rr={},Or={},Vd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Xr=Vd();const qd=Xr.fetch,fu=Xr.fetch.bind(Xr),vu=Xr.Headers,zd=Xr.Request,Hd=Xr.Response,ni=Object.freeze(Object.defineProperty({__proto__:null,Headers:vu,Request:zd,Response:Hd,default:fu,fetch:qd},Symbol.toStringTag,{value:"Module"})),Gd=Wd(ni);var ts={},nl;function pu(){if(nl)return ts;nl=1,Object.defineProperty(ts,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return ts.default=n,ts}var rl;function gu(){if(rl)return Or;rl=1;var n=Or&&Or.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Or,"__esModule",{value:!0});const e=n(Gd),t=n(pu());class r{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let f=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async _=>{var m,w,E,g;let A=null,$=null,j=null,F=_.status,W=_.statusText;if(_.ok){if(this.method!=="HEAD"){const L=await _.text();L===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?$=L:$=JSON.parse(L))}const z=(w=this.headers.get("Prefer"))===null||w===void 0?void 0:w.match(/count=(exact|planned|estimated)/),J=(E=_.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");z&&J&&J.length>1&&(j=parseInt(J[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray($)&&($.length>1?(A={code:"PGRST116",details:`Results contain ${$.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},$=null,j=null,F=406,W="Not Acceptable"):$.length===1?$=$[0]:$=null)}else{const z=await _.text();try{A=JSON.parse(z),Array.isArray(A)&&_.status===404&&($=[],A=null,F=200,W="OK")}catch{_.status===404&&z===""?(F=204,W="No Content"):A={message:z}}if(A&&this.isMaybeSingle&&(!((g=A?.details)===null||g===void 0)&&g.includes("0 rows"))&&(A=null,F=200,W="OK"),A&&this.shouldThrowOnError)throw new t.default(A)}return{error:A,data:$,count:j,status:F,statusText:W}});return this.shouldThrowOnError||(f=f.catch(_=>{var m,w,E;return{error:{message:`${(m=_?.name)!==null&&m!==void 0?m:"FetchError"}: ${_?.message}`,details:`${(w=_?.stack)!==null&&w!==void 0?w:""}`,hint:"",code:`${(E=_?.code)!==null&&E!==void 0?E:""}`},data:null,count:null,status:0,statusText:""}})),f.then(l,u)}returns(){return this}overrideTypes(){return this}}return Or.default=r,Or}var il;function _u(){if(il)return Rr;il=1;var n=Rr&&Rr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=n(gu());class t extends e.default{select(s){let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:f=h}={}){const _=f?`${f}.order`:"order",m=this.url.searchParams.get(_);return this.url.searchParams.set(_,`${m?`${m},`:""}${s}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${s}`),this}range(s,l,{foreignTable:u,referencedTable:h=u}={}){const f=typeof h>"u"?"offset":`${h}.offset`,_=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(f,`${s}`),this.url.searchParams.set(_,`${l-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:f=!1,format:_="text"}={}){var m;const w=[s?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,f?"wal":null].filter(Boolean).join("|"),E=(m=this.headers.get("Accept"))!==null&&m!==void 0?m:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${_}; for="${E}"; options=${w};`),_==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Rr.default=t,Rr}var sl;function Wa(){if(sl)return jr;sl=1;var n=jr&&jr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(jr,"__esModule",{value:!0});const e=n(_u());class t extends e.default{eq(s,l){return this.url.searchParams.append(s,`eq.${l}`),this}neq(s,l){return this.url.searchParams.append(s,`neq.${l}`),this}gt(s,l){return this.url.searchParams.append(s,`gt.${l}`),this}gte(s,l){return this.url.searchParams.append(s,`gte.${l}`),this}lt(s,l){return this.url.searchParams.append(s,`lt.${l}`),this}lte(s,l){return this.url.searchParams.append(s,`lte.${l}`),this}like(s,l){return this.url.searchParams.append(s,`like.${l}`),this}likeAllOf(s,l){return this.url.searchParams.append(s,`like(all).{${l.join(",")}}`),this}likeAnyOf(s,l){return this.url.searchParams.append(s,`like(any).{${l.join(",")}}`),this}ilike(s,l){return this.url.searchParams.append(s,`ilike.${l}`),this}ilikeAllOf(s,l){return this.url.searchParams.append(s,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(s,l){return this.url.searchParams.append(s,`ilike(any).{${l.join(",")}}`),this}is(s,l){return this.url.searchParams.append(s,`is.${l}`),this}in(s,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(s,`in.(${u})`),this}contains(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cs.{${l.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(l)}`),this}containedBy(s,l){return typeof l=="string"?this.url.searchParams.append(s,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(s,`cd.{${l.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(l)}`),this}rangeGt(s,l){return this.url.searchParams.append(s,`sr.${l}`),this}rangeGte(s,l){return this.url.searchParams.append(s,`nxl.${l}`),this}rangeLt(s,l){return this.url.searchParams.append(s,`sl.${l}`),this}rangeLte(s,l){return this.url.searchParams.append(s,`nxr.${l}`),this}rangeAdjacent(s,l){return this.url.searchParams.append(s,`adj.${l}`),this}overlaps(s,l){return typeof l=="string"?this.url.searchParams.append(s,`ov.${l}`):this.url.searchParams.append(s,`ov.{${l.join(",")}}`),this}textSearch(s,l,{config:u,type:h}={}){let f="";h==="plain"?f="pl":h==="phrase"?f="ph":h==="websearch"&&(f="w");const _=u===void 0?"":`(${u})`;return this.url.searchParams.append(s,`${f}fts${_}.${l}`),this}match(s){return Object.entries(s).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(s,l,u){return this.url.searchParams.append(s,`not.${l}.${u}`),this}or(s,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${s})`),this}filter(s,l,u){return this.url.searchParams.append(s,`${l}.${u}`),this}}return jr.default=t,jr}var al;function mu(){if(al)return xr;al=1;var n=xr&&xr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(xr,"__esModule",{value:!0});const e=n(Wa());class t{constructor(s,{headers:l={},schema:u,fetch:h}){this.url=s,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(s,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let f=!1;const _=(s??"*").split("").map(m=>/\s/.test(m)&&!f?"":(m==='"'&&(f=!f),m)).join("");return this.url.searchParams.set("select",_),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:l,defaultToNull:u=!0}={}){var h;const f="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const _=s.reduce((m,w)=>m.concat(Object.keys(w)),[]);if(_.length>0){const m=[...new Set(_)].map(w=>`"${w}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(s,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:f=!0}={}){var _;const m="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const w=s.reduce((E,g)=>E.concat(Object.keys(g)),[]);if(w.length>0){const E=[...new Set(w)].map(g=>`"${g}"`);this.url.searchParams.set("columns",E.join(","))}}return new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}update(s,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:s}={}){var l;const u="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return xr.default=t,xr}var ol;function Kd(){if(ol)return Pr;ol=1;var n=Pr&&Pr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pr,"__esModule",{value:!0});const e=n(mu()),t=n(Wa());class r{constructor(l,{headers:u={},schema:h,fetch:f}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=f}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:f=!1,count:_}={}){var m;let w;const E=new URL(`${this.url}/rpc/${l}`);let g;h||f?(w=h?"HEAD":"GET",Object.entries(u).filter(([$,j])=>j!==void 0).map(([$,j])=>[$,Array.isArray(j)?`{${j.join(",")}}`:`${j}`]).forEach(([$,j])=>{E.searchParams.append($,j)})):(w="POST",g=u);const A=new Headers(this.headers);return _&&A.set("Prefer",`count=${_}`),new t.default({method:w,url:E,headers:A,schema:this.schemaName,body:g,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}}return Pr.default=r,Pr}var ll;function Yd(){if(ll)return Mt;ll=1;var n=Mt&&Mt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.PostgrestError=Mt.PostgrestBuilder=Mt.PostgrestTransformBuilder=Mt.PostgrestFilterBuilder=Mt.PostgrestQueryBuilder=Mt.PostgrestClient=void 0;const e=n(Kd());Mt.PostgrestClient=e.default;const t=n(mu());Mt.PostgrestQueryBuilder=t.default;const r=n(Wa());Mt.PostgrestFilterBuilder=r.default;const s=n(_u());Mt.PostgrestTransformBuilder=s.default;const l=n(gu());Mt.PostgrestBuilder=l.default;const u=n(pu());return Mt.PostgrestError=u.default,Mt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:l.default,PostgrestError:u.default},Mt}var Jd=Yd();const Xd=Bd(Jd),{PostgrestClient:Qd,PostgrestQueryBuilder:Jp,PostgrestFilterBuilder:Xp,PostgrestTransformBuilder:Qp,PostgrestBuilder:Zp,PostgrestError:eg}=Xd;class Zd{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const eh="2.15.1",th=`realtime-js/${eh}`,nh="1.0.0",_a=1e4,rh=1e3,ih=100;var gi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(gi||(gi={}));var Pt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Pt||(Pt={}));var gn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(gn||(gn={}));var ma;(function(n){n.websocket="websocket"})(ma||(ma={}));var fr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(fr||(fr={}));class sh{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=r.decode(e.slice(u,u+s));u=u+s;const f=r.decode(e.slice(u,u+l));u=u+l;const _=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:f,payload:_}}}class yu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var mt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(mt||(mt={}));const ul=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,u)=>(l[u]=ah(u,n,e,s),l),{})},ah=(n,e,t,r)=>{const s=e.find(h=>h.name===n),l=s?.type,u=t[n];return l&&!r.includes(l)?bu(l,u):ya(u)},bu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return ch(e,t)}switch(n){case mt.bool:return oh(e);case mt.float4:case mt.float8:case mt.int2:case mt.int4:case mt.int8:case mt.numeric:case mt.oid:return lh(e);case mt.json:case mt.jsonb:return uh(e);case mt.timestamp:return dh(e);case mt.abstime:case mt.date:case mt.daterange:case mt.int4range:case mt.int8range:case mt.money:case mt.reltime:case mt.text:case mt.time:case mt.timestamptz:case mt.timetz:case mt.tsrange:case mt.tstzrange:return ya(e);default:return ya(e)}},ya=n=>n,oh=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},lh=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},uh=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},ch=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const u=n.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>bu(e,h))}return n},dh=n=>typeof n=="string"?n.replace(" ","T"):n,wu=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Zs{constructor(e,t,r={},s=_a){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var cl;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(cl||(cl={}));class _i{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_i.syncState(this.state,s,l,u),this.pendingDiffs.forEach(f=>{this.state=_i.syncDiff(this.state,f,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(r.diff,{},s=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=_i.syncDiff(this.state,s,l,u),h())}),this.onJoin((s,l,u)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:u})}),this.onLeave((s,l,u)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const l=this.cloneDeep(e),u=this.transformState(t),h={},f={};return this.map(l,(_,m)=>{u[_]||(f[_]=m)}),this.map(u,(_,m)=>{const w=l[_];if(w){const E=m.map(j=>j.presence_ref),g=w.map(j=>j.presence_ref),A=m.filter(j=>g.indexOf(j.presence_ref)<0),$=w.filter(j=>E.indexOf(j.presence_ref)<0);A.length>0&&(h[_]=A),$.length>0&&(f[_]=$)}else h[_]=m}),this.syncDiff(l,{joins:h,leaves:f},r,s)}static syncDiff(e,t,r,s){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(l,(h,f)=>{var _;const m=(_=e[h])!==null&&_!==void 0?_:[];if(e[h]=this.cloneDeep(f),m.length>0){const w=e[h].map(g=>g.presence_ref),E=m.filter(g=>w.indexOf(g.presence_ref)<0);e[h].unshift(...E)}r(h,m,f)}),this.map(u,(h,f)=>{let _=e[h];if(!_)return;const m=f.map(w=>w.presence_ref);_=_.filter(w=>m.indexOf(w.presence_ref)<0),e[h]=_,s(h,_,f),_.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var dl;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(dl||(dl={}));var mi;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(mi||(mi={}));var Dn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Dn||(Dn={}));class Va{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Pt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Zs(this,gn.join,this.params,this.timeout),this.rejoinTimer=new yu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Pt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Pt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Pt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Pt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Pt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(gn.reply,{},(s,l)=>{this._trigger(this._replyEventName(l),s)}),this.presence=new _i(this),this.broadcastEndpointURL=wu(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Pt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,f=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(E=>E.filter))!==null&&s!==void 0?s:[],_=!!this.bindings[mi.PRESENCE]&&this.bindings[mi.PRESENCE].length>0,m={},w={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:_}),postgres_changes:f,private:h};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(E=>e?.(Dn.CHANNEL_ERROR,E)),this._onClose(()=>e?.(Dn.CLOSED)),this.updateJoinPayload(Object.assign({config:w},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:E})=>{var g;if(this.socket.setAuth(),E===void 0){e?.(Dn.SUBSCRIBED);return}else{const A=this.bindings.postgres_changes,$=(g=A?.length)!==null&&g!==void 0?g:0,j=[];for(let F=0;F<$;F++){const W=A[F],{filter:{event:U,schema:z,table:J,filter:L}}=W,B=E&&E[F];if(B&&B.event===U&&B.schema===z&&B.table===J&&B.filter===L)j.push(Object.assign(Object.assign({},W),{id:B.id}));else{this.unsubscribe(),this.state=Pt.errored,e?.(Dn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=j,e&&e(Dn.SUBSCRIBED);return}}).receive("error",E=>{this.state=Pt.errored,e?.(Dn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(E).join(", ")||"error")))}).receive("timeout",()=>{e?.(Dn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===Pt.joined&&e===mi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const _=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=_.body)===null||s===void 0?void 0:s.cancel()),_.ok?"ok":"error"}catch(_){return _.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,f;const _=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),_.receive("ok",()=>l("ok")),_.receive("error",()=>l("error")),_.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Pt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(gn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Zs(this,gn.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Pt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,l=setTimeout(()=>s.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(l),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Zs(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ih){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,l;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:_,join:m}=gn;if(r&&[h,f,_,m].indexOf(u)>=0&&r!==this._joinRef())return;let E=this._onMessage(u,t,r);if(t&&!E)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var A,$,j;return((A=g.filter)===null||A===void 0?void 0:A.event)==="*"||((j=($=g.filter)===null||$===void 0?void 0:$.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===u}).map(g=>g.callback(E,r)):(l=this.bindings[u])===null||l===void 0||l.filter(g=>{var A,$,j,F,W,U;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in g){const z=g.id,J=(A=g.filter)===null||A===void 0?void 0:A.event;return z&&(($=t.ids)===null||$===void 0?void 0:$.includes(z))&&(J==="*"||J?.toLocaleLowerCase()===((j=t.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const z=(W=(F=g?.filter)===null||F===void 0?void 0:F.event)===null||W===void 0?void 0:W.toLocaleLowerCase();return z==="*"||z===((U=t?.event)===null||U===void 0?void 0:U.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===u}).map(g=>{if(typeof E=="object"&&"ids"in E){const A=E.data,{schema:$,table:j,commit_timestamp:F,type:W,errors:U}=A;E=Object.assign(Object.assign({},{schema:$,table:j,commit_timestamp:F,eventType:W,new:{},old:{},errors:U}),this._getPayloadRecords(A))}g.callback(E,r)})}_isClosed(){return this.state===Pt.closed}_isJoined(){return this.state===Pt.joined}_isJoining(){return this.state===Pt.joining}_isLeaving(){return this.state===Pt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),l={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Va.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(gn.close,{},e)}_onError(e){this._on(gn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Pt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ul(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ul(e.columns,e.old_record)),t}}const hl=()=>{},ns={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hh=[1e3,2e3,5e3,1e4],fh=1e4,vh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ph{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_a,this.transport=null,this.heartbeatIntervalMs=ns.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=hl,this.ref=0,this.reconnectTimer=null,this.logger=hl,this.conn=null,this.sendBuffer=[],this.serializer=new sh,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let l;return s?l=s:typeof fetch>"u"?l=(...u)=>Ti(async()=>{const{default:h}=await Promise.resolve().then(()=>ni);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ma.websocket}`,this.httpEndpoint=wu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Zd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:nh}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case gi.connecting:return fr.Connecting;case gi.open:return fr.Open;case gi.closing:return fr.Closing;default:return fr.Closed}}isConnected(){return this.connectionState()===fr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(l=>l.topic===r);if(s)return s;{const l=new Va(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:s,ref:l}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${t} ${r} (${l})`,s),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(rh,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ns.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:l,ref:u}=t,h=u?`(${u})`:"",f=l.status||"";this.log("receive",`${f} ${r} ${s} ${h}`.trim(),l),this.channels.filter(_=>_._isMember(r)).forEach(_=>_._trigger(s,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(gn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([vh],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:th};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(gn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new yu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ns.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,l,u,h,f,_;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:_a,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:ns.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(m=>hh[m-1]||fh),this.encode=(f=e?.encode)!==null&&f!==void 0?f:((m,w)=>w(JSON.stringify(m))),this.decode=(_=e?.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class qa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function xt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class gh extends qa{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ba extends qa{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var _h=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};const ku=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:r}=await Promise.resolve().then(()=>ni);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},mh=()=>_h(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ti(()=>Promise.resolve().then(()=>ni),void 0,import.meta.url)).Response:Response}),wa=n=>{if(Array.isArray(n))return n.map(t=>wa(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[s]=wa(r)}),e},yh=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Er=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};const ea=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),bh=(n,e,t)=>Er(void 0,void 0,void 0,function*(){const r=yield mh();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{const l=n.status||500,u=s?.statusCode||l+"";e(new gh(ea(s),l,u))}).catch(s=>{e(new ba(ea(s),s))}):e(new ba(ea(n),n))}),wh=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"||!r?s:(yh(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r)):s.body=r,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Pi(n,e,t,r,s,l){return Er(this,void 0,void 0,function*(){return new Promise((u,h)=>{n(t,wh(e,r,s,l)).then(f=>{if(!f.ok)throw f;return r?.noResolveJson?f:f.json()}).then(f=>u(f)).catch(f=>bh(f,h,r))})})}function gs(n,e,t,r){return Er(this,void 0,void 0,function*(){return Pi(n,"GET",e,t,r)})}function Sn(n,e,t,r,s){return Er(this,void 0,void 0,function*(){return Pi(n,"POST",e,r,s,t)})}function ka(n,e,t,r,s){return Er(this,void 0,void 0,function*(){return Pi(n,"PUT",e,r,s,t)})}function kh(n,e,t,r){return Er(this,void 0,void 0,function*(){return Pi(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Eu(n,e,t,r,s){return Er(this,void 0,void 0,function*(){return Pi(n,"DELETE",e,r,s,t)})}var zt=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};const Eh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Sh{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ku(s)}uploadOrUpdate(e,t,r,s){return zt(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},fl),s);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl),f&&l.append("metadata",this.encodeMetadata(f))):(l=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s?.headers&&(h=Object.assign(Object.assign({},h),s.headers));const _=this._removeEmptyFolders(t),m=this._getFinalPath(_),w=yield(e=="PUT"?ka:Sn)(this.fetch,`${this.url}/object/${m}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:_,id:w.Id,fullPath:w.Key},error:null}}catch(l){if(xt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return zt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return zt(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let f;const _=Object.assign({upsert:fl.upsert},s),m=Object.assign(Object.assign({},this.headers),{"x-upsert":String(_.upsert)});typeof Blob<"u"&&r instanceof Blob?(f=new FormData,f.append("cacheControl",_.cacheControl),f.append("",r)):typeof FormData<"u"&&r instanceof FormData?(f=r,f.append("cacheControl",_.cacheControl)):(f=r,m["cache-control"]=`max-age=${_.cacheControl}`,m["content-type"]=_.contentType);const w=yield ka(this.fetch,h.toString(),f,{headers:m});return{data:{path:l,fullPath:w.Key},error:null}}catch(f){if(xt(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,t){return zt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const l=yield Sn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new qa("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(r){if(xt(r))return{data:null,error:r};throw r}})}update(e,t,r){return zt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return zt(this,void 0,void 0,function*(){try{return{data:yield Sn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}})}copy(e,t,r){return zt(this,void 0,void 0,function*(){try{return{data:{path:(yield Sn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return zt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),l=yield Sn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return zt(this,void 0,void 0,function*(){try{const s=yield Sn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}})}download(e,t){return zt(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield gs(this.fetch,`${this.url}/${s}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(xt(h))return{data:null,error:h};throw h}})}info(e){return zt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield gs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:wa(r),error:null}}catch(r){if(xt(r))return{data:null,error:r};throw r}})}exists(e){return zt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield kh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(xt(r)&&r instanceof ba){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&s.push(l);const h=typeof t?.transform<"u"?"render/image":"object",f=this.transformOptsToQueryString(t?.transform||{});f!==""&&s.push(f);let _=s.join("&");return _!==""&&(_=`?${_}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${r}${_}`)}}}remove(e){return zt(this,void 0,void 0,function*(){try{return{data:yield Eu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(xt(t))return{data:null,error:t};throw t}})}list(e,t,r){return zt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Eh),t),{prefix:e||""});return{data:yield Sn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}})}listV2(e,t){return zt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Sn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(xt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ih="2.11.0",Ah={"X-Client-Info":`storage-js/${Ih}`};var Mr=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};class Ch{constructor(e,t={},r,s){const l=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Ah),t),this.fetch=ku(r)}listBuckets(){return Mr(this,void 0,void 0,function*(){try{return{data:yield gs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(xt(e))return{data:null,error:e};throw e}})}getBucket(e){return Mr(this,void 0,void 0,function*(){try{return{data:yield gs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(xt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Mr(this,void 0,void 0,function*(){try{return{data:yield Sn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(xt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Mr(this,void 0,void 0,function*(){try{return{data:yield ka(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(xt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Mr(this,void 0,void 0,function*(){try{return{data:yield Sn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(xt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Mr(this,void 0,void 0,function*(){try{return{data:yield Eu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(xt(t))return{data:null,error:t};throw t}})}}class Th extends Ch{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Sh(this.url,this.headers,e,this.fetch)}}const Ph="2.56.0";let vi="";typeof Deno<"u"?vi="deno":typeof document<"u"?vi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vi="react-native":vi="node";const xh={"X-Client-Info":`supabase-js-${vi}/${Ph}`},jh={headers:xh},Rh={schema:"public"},Oh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mh={};var Lh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};const Dh=n=>{let e;return n?e=n:typeof fetch>"u"?e=fu:e=fetch,(...t)=>e(...t)},$h=()=>typeof Headers>"u"?vu:Headers,Fh=(n,e,t)=>{const r=Dh(t),s=$h();return(l,u)=>Lh(void 0,void 0,void 0,function*(){var h;const f=(h=yield e())!==null&&h!==void 0?h:n;let _=new s(u?.headers);return _.has("apikey")||_.set("apikey",n),_.has("Authorization")||_.set("Authorization",`Bearer ${f}`),r(l,Object.assign(Object.assign({},u),{headers:_}))})};var Uh=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};function Nh(n){return n.endsWith("/")?n:n+"/"}function Bh(n,e){var t,r;const{db:s,auth:l,realtime:u,global:h}=n,{db:f,auth:_,realtime:m,global:w}=e,E={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},_),l),realtime:Object.assign(Object.assign({},m),u),storage:{},global:Object.assign(Object.assign(Object.assign({},w),h),{headers:Object.assign(Object.assign({},(t=w?.headers)!==null&&t!==void 0?t:{}),(r=h?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Uh(this,void 0,void 0,function*(){return""})};return n.accessToken?E.accessToken=n.accessToken:delete E.accessToken,E}const Su="2.71.1",Nr=30*1e3,Ea=3,ta=Ea*Nr,Wh="http://localhost:9999",Vh="supabase.auth.token",qh={"X-Client-Info":`gotrue-js/${Su}`},Sa="X-Supabase-Api-Version",Iu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},zh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Hh=600*1e3;class za extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Ne(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Gh extends za{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Kh(n){return Ne(n)&&n.name==="AuthApiError"}class Au extends za{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tr extends za{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class zn extends tr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Yh(n){return Ne(n)&&n.name==="AuthSessionMissingError"}class rs extends tr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class is extends tr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ss extends tr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Jh(n){return Ne(n)&&n.name==="AuthImplicitGrantRedirectError"}class vl extends tr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ia extends tr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function na(n){return Ne(n)&&n.name==="AuthRetryableFetchError"}class pl extends tr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Aa extends tr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),gl=` 	
\r=`.split(""),Xh=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<gl.length;e+=1)n[gl[e].charCodeAt(0)]=-2;for(let e=0;e<_s.length;e+=1)n[_s[e].charCodeAt(0)]=e;return n})();function _l(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(_s[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(_s[r]),e.queuedBits-=6}}function Cu(n,e,t){const r=Xh[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function ml(n){const e=[],t=u=>{e.push(String.fromCodePoint(u))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=u=>{ef(u,r,t)};for(let u=0;u<n.length;u+=1)Cu(n.charCodeAt(u),s,l);return e.join("")}function Qh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Zh(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Qh(r,e)}}function ef(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function tf(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)Cu(n.charCodeAt(s),t,r);return new Uint8Array(e)}function nf(n){const e=[];return Zh(n,t=>e.push(t)),new Uint8Array(e)}function rf(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>_l(s,t,r)),_l(null,t,r),e.join("")}function sf(n){return Math.round(Date.now()/1e3)+n}function af(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const vn=()=>typeof window<"u"&&typeof document<"u",lr={tested:!1,writable:!1},Tu=()=>{if(!vn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(lr.tested)return lr.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),lr.tested=!0,lr.writable=!0}catch{lr.tested=!0,lr.writable=!1}return lr.writable};function of(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,l)=>{e[l]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Pu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ti(async()=>{const{default:r}=await Promise.resolve().then(()=>ni);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},lf=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Br=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},ur=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},qn=async(n,e)=>{await n.removeItem(e)};class Ps{constructor(){this.promise=new Ps.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ps.promiseConstructor=Promise;function ra(n){const e=n.split(".");if(e.length!==3)throw new Aa("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!zh.test(e[r]))throw new Aa("JWT not in base64url format");return{header:JSON.parse(ml(e[0])),payload:JSON.parse(ml(e[1])),signature:tf(e[2]),raw:{header:e[0],payload:e[1]}}}async function uf(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function cf(n,e){return new Promise((r,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await n(l);if(!e(l,null,u)){r(u);return}}catch(u){if(!e(l,u)){s(u);return}}})()})}function df(n){return("0"+n.toString(16)).substr(-2)}function hf(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let l=0;l<56;l++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,df).join("")}async function ff(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function vf(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await ff(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Lr(n,e,t=!1){const r=hf();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Br(n,`${e}-code-verifier`,s);const l=await vf(r);return[l,r===l?"plain":"s256"]}const pf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gf(n){const e=n.headers.get(Sa);if(!e||!e.match(pf))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function _f(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function mf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const yf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Dr(n){if(!yf.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ia(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function yl(n){return JSON.parse(JSON.stringify(n))}var bf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const dr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),wf=[502,503,504];async function bl(n){var e;if(!lf(n))throw new Ia(dr(n),0);if(wf.includes(n.status))throw new Ia(dr(n),n.status);let t;try{t=await n.json()}catch(l){throw new Au(dr(l),l)}let r;const s=gf(n);if(s&&s.getTime()>=Iu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new pl(dr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new zn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new pl(dr(t),n.status,t.weak_password.reasons);throw new Gh(dr(t),n.status||500,r)}const kf=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function Ke(n,e,t,r){var s;const l=Object.assign({},r?.headers);l[Sa]||(l[Sa]=Iu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const u=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await Ef(n,e,t+h,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(f):{data:Object.assign({},f),error:null}}async function Ef(n,e,t,r,s,l){const u=kf(e,r,s,l);let h;try{h=await n(t,Object.assign({},u))}catch(f){throw console.error(f),new Ia(dr(f),0)}if(h.ok||await bl(h),r?.noResolveJson)return h;try{return await h.json()}catch(f){await bl(f)}}function Ln(n){var e;let t=null;Cf(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=sf(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function wl(n){const e=Ln(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Hn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Sf(n){return{data:n,error:null}}function If(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l}=n,u=bf(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:l},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function Af(n){return n}function Cf(n){return n.access_token&&n.refresh_token&&n.expires_in}const sa=["global","local","others"];var Tf=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Pf{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Pu(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=sa[0]){if(sa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${sa.join(", ")}`);try{return await Ke(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Ke(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Hn})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Tf(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await Ke(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:If,redirectTo:t?.redirectTo})}catch(t){if(Ne(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ke(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Hn})}catch(t){if(Ne(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,l,u,h,f;try{const _={nextPage:null,lastPage:0,total:0},m=await Ke(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:Af});if(m.error)throw m.error;const w=await m.json(),E=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,g=(f=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return g.length>0&&(g.forEach(A=>{const $=parseInt(A.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(A.split(";")[1].split("=")[1]);_[`${j}Page`]=$}),_.total=parseInt(E)),{data:Object.assign(Object.assign({},w),_),error:null}}catch(_){if(Ne(_))return{data:{users:[]},error:_};throw _}}async getUserById(e){Dr(e);try{return await Ke(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Hn})}catch(t){if(Ne(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Dr(e);try{return await Ke(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Hn})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Dr(e);try{return await Ke(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Hn})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Dr(e.userId);try{const{data:t,error:r}=await Ke(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(Ne(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Dr(e.userId),Dr(e.id);try{return{data:await Ke(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}}}function kl(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function xf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const $r={debug:!!(globalThis&&Tu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class jf extends xu{}async function Rf(n,e,t){$r.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),$r.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){$r.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{$r.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw $r.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new jf(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if($r.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}xf();const Of={url:Wh,storageKey:Vh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function El(n,e,t){return await t()}const Fr={};class ki{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ki.nextInstanceID,ki.nextInstanceID+=1,this.instanceID>0&&vn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Of),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Pf({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Pu(s.fetch),this.lock=s.lock||El,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:vn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Rf:this.lock=El,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Tu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=kl(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=kl(this.memoryStorage)),vn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Fr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Fr[this.storageKey]=Object.assign(Object.assign({},Fr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Fr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fr[this.storageKey]=Object.assign(Object.assign({},Fr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Su}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=of(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),vn()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),Jh(l)){const f=(e=l.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=s;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ne(t)?{error:t}:{error:new Au("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const l=await Ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ln}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,_=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:_,session:f},error:null}}catch(l){if(Ne(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,s;try{let l;if("email"in e){const{email:m,password:w,options:E}=e;let g=null,A=null;this.flowType==="pkce"&&([g,A]=await Lr(this.storage,this.storageKey)),l=await Ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:E?.emailRedirectTo,body:{email:m,password:w,data:(t=E?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:E?.captchaToken},code_challenge:g,code_challenge_method:A},xform:Ln})}else if("phone"in e){const{phone:m,password:w,options:E}=e;l=await Ke(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:w,data:(r=E?.data)!==null&&r!==void 0?r:{},channel:(s=E?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:E?.captchaToken}},xform:Ln})}else throw new is("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const f=u.session,_=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:_,session:f},error:null}}catch(l){if(Ne(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await Ke(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wl})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await Ke(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wl})}else throw new is("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new rs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(Ne(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,l,u,h,f,_,m,w,E,g;let A,$;if("message"in e)A=e.message,$=e.signature;else{const{chain:j,wallet:F,statement:W,options:U}=e;let z;if(vn())if(typeof F=="object")z=F;else{const L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))z=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof F!="object"||!U?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=F}const J=new URL((t=U?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const L=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},U?.signInWithSolana),{version:"1",domain:J.host,uri:J.href}),W?{statement:W}:null));let B;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")B=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)B=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)A=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),$=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");A=[`${J.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...W?["",W,""]:[""],"Version: 1",`URI: ${J.href}`,`Issued At: ${(s=(r=U?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=U?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${U.signInWithSolana.notBefore}`]:[],...!((u=U?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${U.signInWithSolana.expirationTime}`]:[],...!((h=U?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${U.signInWithSolana.chainId}`]:[],...!((f=U?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${U.signInWithSolana.nonce}`]:[],...!((_=U?.signInWithSolana)===null||_===void 0)&&_.requestId?[`Request ID: ${U.signInWithSolana.requestId}`]:[],...!((w=(m=U?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||w===void 0)&&w.length?["Resources",...U.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const L=await z.signMessage(new TextEncoder().encode(A),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");$=L}}try{const{data:j,error:F}=await Ke(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:A,signature:rf($)},!((E=e.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Ln});if(F)throw F;return!j||!j.session||!j.user?{data:{user:null,session:null},error:new rs}:(j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),{data:Object.assign({},j),error:F})}catch(j){if(Ne(j))return{data:{user:null,session:null},error:j};throw j}}async _exchangeCodeForSession(e){const t=await ur(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:l,error:u}=await Ke(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ln});if(await qn(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new rs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:u})}catch(l){if(Ne(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:l,nonce:u}=e,h=await Ke(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ln}),{data:f,error:_}=h;return _?{data:{user:null,session:null},error:_}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new rs}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:_})}catch(t){if(Ne(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,l,u;try{if("email"in e){const{email:h,options:f}=e;let _=null,m=null;this.flowType==="pkce"&&([_,m]=await Lr(this.storage,this.storageKey));const{error:w}=await Ke(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=f?.data)!==null&&t!==void 0?t:{},create_user:(r=f?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:_,code_challenge_method:m},redirectTo:f?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:h,options:f}=e,{data:_,error:m}=await Ke(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:_?.message_id},error:m}}throw new is("You must provide either an email or phone number.")}catch(h){if(Ne(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,r;try{let s,l;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:h}=await Ke(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Ln});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,_=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:_,session:f},error:null}}catch(s){if(Ne(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Lr(this.storage,this.storageKey)),await Ke(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:Sf})}catch(l){if(Ne(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new zn;const{error:s}=await Ke(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Ne(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:l}=e,{error:u}=await Ke(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:s,options:l}=e,{data:u,error:h}=await Ke(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new is("You must provide either an email or phone number and a type")}catch(t){if(Ne(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ur(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ta:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const u=await ur(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ia()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,_,m)=>(!u&&_==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,_,m))})}return{data:{session:e},error:null}}const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ke(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Hn}):await this._useSession(async t=>{var r,s,l;const{data:u,error:h}=t;if(h)throw h;return!(!((r=u.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new zn}:await Ke(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=u.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:Hn})})}catch(t){if(Ne(t))return Yh(t)&&(await this._removeSession(),await qn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:l}=r;if(l)throw l;if(!s.session)throw new zn;const u=s.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await Lr(this.storage,this.storageKey));const{data:_,error:m}=await Ke(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:Hn});if(m)throw m;return u.user=_.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zn;const t=Date.now()/1e3;let r=t,s=!0,l=null;const{payload:u}=ra(e.access_token);if(u.exp&&(r=u.exp,s=r<=t),s){const{session:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)throw f;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Ne(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new zn;const{session:s,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ne(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!vn())throw new ss("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ss(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new vl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ss("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new vl("No code detected.");const{data:W,error:U}=await this._exchangeCodeForSession(e.code);if(U)throw U;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:W.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:l,refresh_token:u,expires_in:h,expires_at:f,token_type:_}=e;if(!l||!h||!u||!_)throw new ss("No session defined in URL");const m=Math.round(Date.now()/1e3),w=parseInt(h);let E=m+w;f&&(E=parseInt(f));const g=E-m;g*1e3<=Nr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${w}s`);const A=E-w;m-A>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",A,E,m):m-A<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",A,E,m);const{data:$,error:j}=await this._getUser(l);if(j)throw j;const F={provider_token:r,provider_refresh_token:s,access_token:l,expires_in:w,expires_at:E,refresh_token:u,token_type:_,user:$.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:F,redirectType:e.type},error:null}}catch(r){if(Ne(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ur(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{error:l};const u=(r=s.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Kh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await qn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=af(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:l},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Lr(this.storage,this.storageKey,!0));try{return await Ke(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Ne(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async l=>{var u,h,f,_,m;const{data:w,error:E}=l;if(E)throw E;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await Ke(this.fetch,"GET",g,{headers:this.headers,jwt:(m=(_=w.session)===null||_===void 0?void 0:_.access_token)!==null&&m!==void 0?m:void 0})});if(s)throw s;return vn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Ne(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)throw u;return await Ke(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Ne(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await cf(async s=>(s>0&&await uf(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Ke(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ln})),(s,l)=>{const u=200*Math.pow(2,s);return l&&na(l)&&Date.now()+u-r<Nr})}catch(r){if(this._debug(t,"error",r),Ne(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),vn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await ur(this.storage,this.storageKey);if(s&&this.userStorage){let u=await ur(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:s.user},await Br(this.userStorage,this.storageKey+"-user",u)),s.user=(e=u?.user)!==null&&e!==void 0?e:ia()}else if(s&&!s.user&&!s.user){const u=await ur(this.storage,this.storageKey+"-user");u&&u?.user?(s.user=u.user,await qn(this.storage,this.storageKey+"-user"),await Br(this.storage,this.storageKey,s)):s.user=ia()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const l=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ta;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${ta}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:u}=await this._callRefreshToken(s.refresh_token);u&&(console.error(u),na(u)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(s.access_token);!h&&u?.user?(s.user=u.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(r,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new zn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ps;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new zn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(s,"error",l),Ne(l)){const u={session:null,error:l};return na(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(f){l.push(f)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Br(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const l=yl(s);await Br(this.storage,this.storageKey,l)}else{const s=yl(t);await Br(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await qn(this.storage,this.storageKey),await qn(this.storage,this.storageKey+"-code-verifier"),await qn(this.storage,this.storageKey+"-user"),this.userStorage&&await qn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Nr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Nr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Nr}ms, refresh threshold is ${Ea} ticks`),s<=Ea&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!vn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,u]=await Lr(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});s.push(h.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);s.push(l.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await Ke(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Ne(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:_}=await Ke(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return _?{data:null,error:_}:(e.factorType==="totp"&&(!((s=f?.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(t){if(Ne(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await Ke(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:l}=t;return l?{data:null,error:l}:await Ke(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=r.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:r,totp:s,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:l}=e;if(l)return{data:null,error:l};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ra(s.access_token);let h=null;u.aal&&(h=u.aal);let f=h;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");const m=u.amr||[];return{data:{currentLevel:h,nextLevel:f,currentAuthenticationMethods:m},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(h=>h.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(h=>h.kid===e),r&&this.jwks_cached_at+Hh>s)return r;const{data:l,error:u}=await Ke(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,r=l.keys.find(h=>h.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:A}=await this.getSession();if(A||!g.session)return{data:null,error:A};r=g.session.access_token}const{header:s,payload:l,signature:u,raw:{header:h,payload:f}}=ra(r);t?.allowExpired||_f(l.exp);const _=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!_){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:l,header:s,signature:u},error:null}}const m=mf(s.alg),w=await crypto.subtle.importKey("jwk",_,m,!0,["verify"]);if(!await crypto.subtle.verify(m,w,u,nf(`${h}.${f}`)))throw new Aa("Invalid JWT signature");return{data:{claims:l,header:s,signature:u},error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}}}ki.nextInstanceID=0;const Mf=ki;class Lf extends Mf{constructor(e){super(e)}}var Df=function(n,e,t,r){function s(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{_(r.next(m))}catch(w){u(w)}}function f(m){try{_(r.throw(m))}catch(w){u(w)}}function _(m){m.done?l(m.value):s(m.value).then(h,f)}_((r=r.apply(n,e||[])).next())})};class $f{constructor(e,t,r){var s,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Nh(e),f=new URL(h);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const _=`sb-${f.hostname.split(".")[0]}-auth-token`,m={db:Rh,realtime:Mh,auth:Object.assign(Object.assign({},Oh),{storageKey:_}),global:jh},w=Bh(r??{},m);this.storageKey=(s=w.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(l=w.global.headers)!==null&&l!==void 0?l:{},w.accessToken?(this.accessToken=w.accessToken,this.auth=new Proxy({},{get:(E,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=w.auth)!==null&&u!==void 0?u:{},this.headers,w.global.fetch),this.fetch=Fh(t,this._getAccessToken.bind(this),w.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},w.realtime)),this.rest=new Qd(new URL("rest/v1",f).href,{headers:this.headers,schema:w.db.schema,fetch:this.fetch}),this.storage=new Th(this.storageUrl.href,this.headers,this.fetch,r?.storage),w.accessToken||this._listenForAuthEvents()}get functions(){return new Nd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Df(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:l,flowType:u,lock:h,debug:f},_,m){const w={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Lf({url:this.authUrl.href,headers:Object.assign(Object.assign({},w),_),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:u,lock:h,debug:f,fetch:m,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ph(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ff=(n,e,t)=>new $f(n,e,t);function Uf(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Uf()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Nf="https://vycjpmuyscfygstjjied.supabase.co",Bf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",In=Ff(Nf,Bf,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),Jn={async loadStoriesList(){if(!R.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${R.selectedBucket}`);const n=`${R.selectedBucket}_story.json`,{data:e,error:t}=await In.storage.from(R.selectedBucket).list("",{search:n});console.log(`[ResourceStore] Проверка файла ${n}:`,{files:e,error:t}),!t&&e&&e.some(r=>r.name===n)?(R.storiesList=[n],console.log(`[ResourceStore] Найден файл: ${n}`)):(R.storiesList=[],console.warn(`[ResourceStore] Файл ${n} не найден`))},async loadStoredResources(){if(!R.selectedBucket){console.warn("No bucket selected");return}const{data:n}=await In.storage.from(R.selectedBucket).list();n&&(R.storedFiles=n.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(n){const e=n.target;if(!e.files||e.files.length===0)return;if(!R.selectedBucket){ot.setStatus("error","Не выбрана история");return}const t=e.files[0];ot.setStatus("loading","Загрузка файла...");const r=await t.arrayBuffer(),s=new Uint8Array(r),{error:l}=await In.storage.from(R.selectedBucket).upload(t.name,s,{upsert:!0,contentType:t.type});l?ot.setStatus("error","Ошибка загрузки"):(ot.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(n){if(!R.selectedBucket){ot.setStatus("error","Не выбрана история");return}const{error:e}=await In.storage.from(R.selectedBucket).remove([n]);e?ot.setStatus("error","Ошибка удаления файла"):(ot.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Wf(n){return n.dialogues&&n.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),n.chapters||(n.chapters=[{id:"main",title:"Основная история",description:""}],n.dialogues&&n.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),n.chapters&&n.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),n.items||(n.items=[]),n.meta||(n.meta={version:"3.1",title:n.title||"Untitled"}),n.miniGames&&Array.isArray(n.miniGames)&&(n.miniGames=n.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),n}function Vf(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const vr={async createNewStory(){if(!R.selectedBucket){ot.setStatus("error","Не выбрана история (bucket)");return}const n=prompt("Введите имя файла истории:","new_story.json");if(!n)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),s=new TextEncoder().encode(t),{error:l}=await In.storage.from(R.selectedBucket).upload(n,s,{contentType:"application/json"});l?ot.setStatus("error","Ошибка создания: "+l.message):(await Jn.loadStoriesList(),await this.loadStory(n))},async loadStory(n){if(!R.selectedBucket){ot.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${n} из bucket: ${R.selectedBucket}`),ot.setStatus("loading","Загрузка..."),R.currentFileName=n;try{const{data:e,error:t}=await In.storage.from(R.selectedBucket).download(n);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let r;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=In.storage.from(R.selectedBucket).getPublicUrl(n).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);r=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${r.length}`)}else r=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${r.length}`);let s=JSON.parse(r);console.log("[StoryStore] Данные распарсены:",{meta:s.meta,chaptersCount:s.chapters?.length,dialoguesCount:s.dialogues?.length,itemsCount:s.items?.length}),s=Wf(s),console.log("[StoryStore] Присваиваем данные в editor.data"),R.data=s,console.log("[StoryStore] editor.data обновлен:",{chapters:R.data.chapters?.length,dialogues:R.data.dialogues?.length}),R.data.chapters&&R.data.chapters.length>0&&(R.selectedChapterId=R.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${R.selectedChapterId}`)),R.data.dialogues&&R.data.dialogues.length>0&&(R.selectedDialogueId=R.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${R.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),ot.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),ot.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!R.data)return;if(!R.selectedBucket){ot.setStatus("error","Не выбрана история (bucket)");return}ot.setStatus("loading","Сохранение...");const n=JSON.stringify(R.data,null,2);console.log(`[StoryStore] Сохранение файла: ${R.currentFileName}, размер: ${n.length} байт`);const t=new TextEncoder().encode(n),{error:r}=await In.storage.from(R.selectedBucket).update(R.currentFileName,t,{contentType:"application/json"});if(r){console.error("[StoryStore] Ошибка сохранения (update):",r),console.log("[StoryStore] Пробуем upload вместо update");const s=await In.storage.from(R.selectedBucket).upload(R.currentFileName,t,{contentType:"application/json"});s.error?(console.error("[StoryStore] Ошибка сохранения (upload):",s.error),ot.setStatus("error","Ошибка сохранения: "+s.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),ot.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),ot.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!R.data)return;if(!R.selectedBucket){ot.setStatus("error","Не выбрана история (bucket)");return}const n=R.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${n}_copy_${e}.json`.trim();const r=prompt("Введите имя для копии:",t);if(!r)return;t=r.trim(),t.endsWith(".json")||(t+=".json"),ot.setStatus("loading","Создание копии...");const s=JSON.stringify(R.data,null,2),u=new TextEncoder().encode(s),{error:h}=await In.storage.from(R.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?ot.setStatus("error",`Ошибка копии: ${h.message}`):(await Jn.loadStoriesList(),ot.setStatus("success","Копия сохранена!"))},addChapter(){if(!R.data||!R.data.chapters)return;const n="ch_"+Date.now();R.data.chapters.push({id:n,title:"Новая глава",description:""}),R.selectedChapterId=n},addDialogue(){if(!R.data||!R.selectedChapterId)return;const n="d_"+Date.now();R.data.dialogues.push({id:n,chapterId:R.selectedChapterId,text:"Новый текст...",options:[]}),R.selectedDialogueId=n},deleteDialogue(n){confirm("Удалить диалог "+n+"?")&&R.data&&(R.data.dialogues=R.data.dialogues.filter(e=>e.id!==n),R.data.dialogues.forEach(e=>{e.nextDialogueId===n&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===n&&(t.nextDialogueId="")})}),R.selectedDialogueId===n&&(R.selectedDialogueId=null))},jumpTo(n){const e=R.data?.dialogues.find(t=>t.id===n);e&&(R.selectedChapterId=e.chapterId,R.selectedDialogueId=n)},getLinkType(n,e){return n.nextDialogueId===e?"Auto":"Option"}};var Xt=er(()=>Dt);function qf(){ot.selectEditingChapter(null)}var zf=se('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function Hf(n,e){Vt(e,!1);function t(){Xt().currentEditingChapter&&(ot.updateChapter(Xt().currentEditingChapter.id,{title:Xt().currentEditingChapter.title,description:Xt().currentEditingChapter.description}),ot.selectEditingChapter(null))}function r(){Xt().currentEditingChapter&&confirm(`Удалить главу "${Xt().currentEditingChapter.title}"?`)&&(ot.deleteChapter(Xt().currentEditingChapter.id),ot.selectEditingChapter(null))}Zn();var s=Kt(),l=At(s);{var u=h=>{var f=zf(),_=T(f),m=D(T(_),2),w=T(m);w.__click=r;var E=D(_,2),g=D(T(E),2),A=D(E,2),$=D(T(A),2),j=D(A,2),F=T(j);F.__click=[qf];var W=D(F,2);W.__click=t,$n(g,()=>Xt().currentEditingChapter.title,U=>Xt(Xt().currentEditingChapter.title=U)),$n($,()=>Xt().currentEditingChapter.description,U=>Xt(Xt().currentEditingChapter.description=U)),K(h,f)};Le(l,h=>{Xt().currentEditingChapter&&h(u)})}K(n,s),qt()}Yt(["click"]);var Qt=er(()=>R),Gf=(n,e,t)=>e(S(t).id),Kf=se('<div class="chapter-form-container svelte-xp6igx"><!></div>'),Yf=se('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),Jf=se('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),Xf=se("<div> </div>"),Qf=se('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function Zf(n,e){Vt(e,!1);function t(F){ot.selectEditingChapter(F)}Zn();var r=Qf(),s=T(r),l=T(s),u=D(T(l),2);u.__click=function(...F){vr.addChapter?.apply(this,F)};var h=D(l,2);wt(h,5,()=>Qt().data?.chapters||[],F=>F.id,(F,W)=>{var U=Yf(),z=At(U),J=T(z);let L;J.__click=()=>Qt(Qt().selectedChapterId=S(W).id);var B=T(J),le=T(B),te=D(J,2);te.__click=[Gf,t,W];var ye=D(z,2);{var X=Q=>{var ge=Kf(),Pe=T(ge);Hf(Pe,{}),K(Q,ge)};Le(ye,Q=>{Qt().editingChapterId===S(W).id&&Q(X)})}Ae(Q=>{L=mn(J,1,"chapter-item svelte-xp6igx",null,L,Q),Re(J,"aria-pressed",Qt().selectedChapterId===S(W).id),Te(le,S(W).title)},[()=>({active:Qt().selectedChapterId===S(W).id})]),K(F,U)});var f=D(s,2),_=T(f),m=T(_),w=T(m),E=D(m,2);E.__click=function(...F){vr.addDialogue?.apply(this,F)};var g=D(_,2);wt(g,5,()=>Dt.chapterDialogues,F=>F.id,(F,W)=>{var U=Jf();let z;U.__click=()=>Qt(Qt().selectedDialogueId=S(W).id);var J=T(U),L=T(J),B=D(J,2),le=T(B);Ae((te,ye)=>{z=mn(U,1,"dialogue-item svelte-xp6igx",null,z,te),Re(U,"aria-pressed",Qt().selectedDialogueId===S(W).id),Te(L,S(W).id),Te(le,`${ye??""}...`)},[()=>({active:Qt().selectedDialogueId===S(W).id}),()=>S(W).text.substring(0,25)]),K(F,U)});var A=D(f,2),$=T(A);{var j=F=>{var W=Xf(),U=T(W);Ae(()=>{mn(W,1,`alert ${Qt().statusMessage.type??""}`,"svelte-xp6igx"),Te(U,Qt().statusMessage.text)}),K(F,W)};Le($,F=>{Qt().statusMessage.text&&F(j)})}Ae(()=>{Te(w,`Сцены (${Dt.chapterDialogues.length??""})`),E.disabled=!Qt().selectedChapterId}),K(n,r),qt()}Yt(["click"]);var ev=se("<option> </option>"),tv=(n,e)=>{n.target.checked&&!e().miniGame&&(e().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""})},nv=se("<option> </option>"),rv=se("<option> </option>"),iv=se("<option> </option>"),sv=se('<div class="minigame-details svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option></select></div> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-92kmf5"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-92kmf5"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),av=(n,e)=>{const t=n.target.value;e({type:t})},ov=se("<option> </option>"),lv=(n,e)=>e({itemId:n.target.value}),uv=se("<option> </option>"),cv=se('<div class="form-group full-width svelte-92kmf5"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),dv=(n,e)=>e({statName:n.target.value}),hv=(n,e)=>e({statValue:parseInt(n.target.value)||0}),fv=se('<div class="form-group svelte-92kmf5"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-92kmf5"><label>Значение ></label> <input type="number" class="input"/></div>',1),vv=(n,e)=>e({flagName:n.target.value}),pv=se('<div class="form-group full-width svelte-92kmf5"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),gv=se('<div class="option-details svelte-92kmf5"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-92kmf5"><div class="section-header svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-92kmf5"><div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-92kmf5">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-92kmf5"><label class="checkbox-row svelte-92kmf5"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-92kmf5">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-92kmf5"><h5 class="svelte-92kmf5">Условие видимости</h5> <div class="form-row svelte-92kmf5"><div class="form-group svelte-92kmf5"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div></div></div>');function _v(n,e){Vt(e,!0);const t=Ts(e,"option",7);function r(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function s(){return r(),t().visibilityCondition}function l(oe){r(),t().visibilityCondition={...t().visibilityCondition,...oe}}var u=gv(),h=T(u),f=T(h),_=D(f,2),m=D(h,2),w=T(m),E=D(w,2),g=T(E);g.value=g.__value="";var A=D(g);wt(A,17,()=>e.dialogues,Ut,(oe,Fe)=>{var we=ev(),Ue=T(we),je={};Ae(ke=>{Te(Ue,`${S(Fe).id??""}: ${ke??""}...`),je!==(je=S(Fe).id)&&(we.value=(we.__value=S(Fe).id)??"")},[()=>S(Fe).text.substring(0,30)]),K(oe,we)});var $=D(m,2),j=T($),F=T(j),W=T(F);W.__change=[tv,t];var U=D(j,2);{var z=oe=>{var Fe=sv(),we=T(Fe),Ue=T(we),je=D(Ue,2),ke=T(je);ke.value=ke.__value="";var Ie=D(ke);Ie.value=Ie.__value="onet_monsters";var he=D(we,2),Be=T(he),xe=T(Be),ht=D(xe,2),ut=T(ht);ut.value=ut.__value="";var ct=D(ut);wt(ct,17,()=>e.dialogues,Ut,(b,I)=>{var M=nv(),V=T(M),ae={};Ae(be=>{Te(V,`${S(I).id??""}: ${be??""}...`),ae!==(ae=S(I).id)&&(M.value=(M.__value=S(I).id)??"")},[()=>S(I).text.substring(0,30)]),K(b,M)});var H=D(Be,2),Z=T(H),q=D(Z,2),ie=T(q);ie.value=ie.__value="";var Ee=D(ie);wt(Ee,17,()=>e.dialogues,Ut,(b,I)=>{var M=rv(),V=T(M),ae={};Ae(be=>{Te(V,`${S(I).id??""}: ${be??""}...`),ae!==(ae=S(I).id)&&(M.value=(M.__value=S(I).id)??"")},[()=>S(I).text.substring(0,30)]),K(b,M)});var De=D(he,2),Ce=T(De),p=D(Ce,2),o=T(p);o.value=o.__value="";var d=D(o);wt(d,17,()=>e.availableItems,Ut,(b,I)=>{var M=iv(),V=T(M),ae={};Ae(()=>{Te(V,S(I).name),ae!==(ae=S(I).id)&&(M.value=(M.__value=S(I).id)??"")}),K(b,M)}),Ae(()=>{Re(Ue,"for",`option-mg-id-${e.index??""}`),Re(je,"id",`option-mg-id-${e.index??""}`),Re(xe,"for",`option-mg-win-${e.index??""}`),Re(ht,"id",`option-mg-win-${e.index??""}`),Re(Z,"for",`option-mg-lose-${e.index??""}`),Re(q,"id",`option-mg-lose-${e.index??""}`),Re(Ce,"for",`option-mg-reward-${e.index??""}`),Re(p,"id",`option-mg-reward-${e.index??""}`)}),Cn(je,()=>t().miniGame.id,b=>t().miniGame.id=b),Cn(ht,()=>t().miniGame.onWinDialogueId,b=>t().miniGame.onWinDialogueId=b),Cn(q,()=>t().miniGame.onLoseDialogueId,b=>t().miniGame.onLoseDialogueId=b),Cn(p,()=>t().miniGame.rewardItem,b=>t().miniGame.rewardItem=b),K(oe,Fe)};Le(U,oe=>{t().miniGame&&oe(z)})}var J=D($,2),L=T(J),B=T(L),le=T(B),te=D(L,2),ye=T(te),X=T(ye),Q=D(J,2),ge=D(T(Q),2),Pe=T(ge),de=T(Pe),me=D(de,2);me.__change=[av,l],wt(me,21,()=>e.conditionTypes,Ut,(oe,Fe)=>{var we=ov(),Ue=T(we),je={};Ae(()=>{Te(Ue,S(Fe)),je!==(je=S(Fe))&&(we.value=(we.__value=S(Fe))??"")}),K(oe,we)});var ve;pa(me);var dt=D(Pe,2);{var Ye=oe=>{var Fe=cv(),we=T(Fe),Ue=D(we,2);Ue.__change=[lv,l];var je=T(Ue);je.value=je.__value="";var ke=D(je);wt(ke,17,()=>e.availableItems,Ut,(he,Be)=>{var xe=uv(),ht=T(xe),ut={};Ae(()=>{Te(ht,S(Be).name),ut!==(ut=S(Be).id)&&(xe.value=(xe.__value=S(Be).id)??"")}),K(he,xe)});var Ie;pa(Ue),Ae(he=>{Re(we,"for",`option-cond-item-${e.index??""}`),Re(Ue,"id",`option-cond-item-${e.index??""}`),Ie!==(Ie=he)&&(Ue.value=(Ue.__value=he)??"",vs(Ue,he))},[()=>s().itemId||""]),K(oe,Fe)};Le(dt,oe=>{s().type==="has_item"&&oe(Ye)})}var Ge=D(dt,2);{var pt=oe=>{var Fe=fv(),we=At(Fe),Ue=T(we),je=D(Ue,2);je.__input=[dv,l];var ke=D(we,2),Ie=T(ke),he=D(Ie,2);he.__input=[hv,l],Ae((Be,xe)=>{Re(Ue,"for",`option-cond-stat-${e.index??""}`),Re(je,"id",`option-cond-stat-${e.index??""}`),Ys(je,Be),Re(Ie,"for",`option-cond-stat-val-${e.index??""}`),Re(he,"id",`option-cond-stat-val-${e.index??""}`),Ys(he,xe)},[()=>s().statName||"",()=>s().statValue||""]),K(oe,Fe)};Le(Ge,oe=>{s().type==="stat_greater"&&oe(pt)})}var Ct=D(Ge,2);{var Oe=oe=>{var Fe=pv(),we=T(Fe),Ue=D(we,2);Ue.__input=[vv,l],Ae(je=>{Re(we,"for",`option-cond-flag-${e.index??""}`),Re(Ue,"id",`option-cond-flag-${e.index??""}`),Ys(Ue,je)},[()=>s().flagName||""]),K(oe,Fe)};Le(Ct,oe=>{s().type==="flag_true"&&oe(Oe)})}Ae(oe=>{Re(f,"for",`option-text-${e.index??""}`),Re(_,"id",`option-text-${e.index??""}`),Re(w,"for",`option-next-${e.index??""}`),Re(E,"id",`option-next-${e.index??""}`),Re(de,"for",`option-cond-type-${e.index??""}`),Re(me,"id",`option-cond-type-${e.index??""}`),ve!==(ve=oe)&&(me.value=(me.__value=oe)??"",vs(me,oe))},[()=>s().type]),$n(_,()=>t().text,oe=>t().text=oe),Cn(E,()=>t().nextDialogueId,oe=>t().nextDialogueId=oe),Js(W,()=>t().miniGame,oe=>t().miniGame=oe),Js(le,()=>t().enabled,oe=>t().enabled=oe),Js(X,()=>t().visible,oe=>t().visible=oe),K(n,u),qt()}Yt(["change","input"]);var _t=er(()=>R),it=er(()=>Dt),mv=se("<option> <!></option>"),yv=se("<option> </option>"),bv=se("<option> </option>"),wv=se("<option> </option>"),kv=se("<option> </option>"),Ev=se('<div class="option-content svelte-1de8com"><!></div>'),Sv=se('<div><div class="option-header-row svelte-1de8com"><div class="option-header svelte-1de8com" role="button" tabindex="0"><span class="status-icons svelte-1de8com"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Iv=se("<option> </option>"),Av=se('<div class="dialogue-form svelte-1de8com"><div class="form-group svelte-1de8com"><label for="dialogue-id" class="svelte-1de8com">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1de8com"/></div> <div class="form-group svelte-1de8com"><label for="dialogue-chapter" class="svelte-1de8com">Глава</label> <select id="dialogue-chapter" class="input select svelte-1de8com"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1de8com"><label for="dialogue-text" class="svelte-1de8com">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1de8com" rows="3"></textarea></div> <div class="media-section svelte-1de8com"><h4 class="svelte-1de8com">Медиа ресурсы</h4> <div class="form-group svelte-1de8com"><label for="dialogue-background" class="svelte-1de8com">Фон</label> <div class="input-group svelte-1de8com"><select id="dialogue-background" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1de8com">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1de8com"><label for="dialogue-character" class="svelte-1de8com">Персонаж</label> <div class="input-group svelte-1de8com"><select id="dialogue-character" class="input select svelte-1de8com"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1de8com"><div class="section-header svelte-1de8com"><h4 class="svelte-1de8com">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1de8com"><h4 class="svelte-1de8com">Авто-переход</h4> <select class="input select svelte-1de8com"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1de8com"><button class="btn danger">Удалить сцену</button></div></div>'),Cv=se('<div class="empty-state">Выберите сцену</div>');function Tv(n,e){Vt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function r(m){m.options||(m.options=[]);const w=Vf();m.options.push(w),_t(_t().editingOptionIndex=m.options.length-1)}function s(m){if(_t().editingOptionIndex===m)_t(_t().editingOptionIndex=null);else{_t(_t().editingOptionIndex=m);const w=it().currentDialogue?.options?.[m];w&&!w.visibilityCondition&&(w.visibilityCondition={type:"always"})}}function l(m,w){confirm("Удалить вариант ответа?")&&(m.options?.splice(w,1),_t().editingOptionIndex===w?_t(_t().editingOptionIndex=null):_t().editingOptionIndex&&_t().editingOptionIndex>w&&_t(_t().editingOptionIndex--))}Zn();var u=Kt(),h=At(u);{var f=m=>{var w=Av(),E=T(w),g=D(T(E),2);g.__change=ke=>_t(_t().selectedDialogueId=ke.target?.value);var A=D(E,2),$=D(T(A),2);Ae(()=>{it(),pn(()=>{_t()})}),$.__change=ke=>_t(_t().selectedChapterId=ke.target?.value);var j=T($);j.value=j.__value="";var F=D(j);wt(F,1,()=>_t().data.chapters||[],Ut,(ke,Ie)=>{var he=mv(),Be=T(he),xe=D(Be);{var ht=ct=>{var H=Zi();Ae(Z=>Te(H,`- ${Z??""}...`),[()=>S(Ie).description.substring(0,30)]),K(ct,H)};Le(xe,ct=>{S(Ie).description&&ct(ht)})}var ut={};Ae(()=>{Te(Be,`${S(Ie).title??""} `),ut!==(ut=S(Ie).id)&&(he.value=(he.__value=S(Ie).id)??"")}),K(ke,he)});var W=D(A,2),U=D(T(W),2),z=D(W,2),J=D(T(z),2),L=D(T(J),2),B=T(L);Ae(()=>{it(),pn(()=>{})});var le=T(B);le.value=le.__value="";var te=D(le);wt(te,1,()=>it().imageResources,Ut,(ke,Ie)=>{var he=yv(),Be=T(he),xe={};Ae(()=>{Te(Be,S(Ie).name),xe!==(xe=S(Ie).name)&&(he.value=(he.__value=S(Ie).name)??"")}),K(ke,he)});var ye=D(te);wt(ye,1,()=>it().riveResources,Ut,(ke,Ie)=>{var he=bv(),Be=T(he),xe={};Ae(()=>{Te(Be,`${S(Ie).name??""} (Rive)`),xe!==(xe=S(Ie).name)&&(he.value=(he.__value=S(Ie).name)??"")}),K(ke,he)});var X=D(B,2),Q=D(T(X));Q.__change=function(...ke){Jn.uploadNewFile?.apply(this,ke)};var ge=D(J,2),Pe=D(T(ge),2),de=T(Pe);Ae(()=>{it(),pn(()=>{})});var me=T(de);me.value=me.__value="";var ve=D(me);wt(ve,1,()=>it().imageResources,Ut,(ke,Ie)=>{var he=wv(),Be=T(he),xe={};Ae(()=>{Te(Be,S(Ie).name),xe!==(xe=S(Ie).name)&&(he.value=(he.__value=S(Ie).name)??"")}),K(ke,he)});var dt=D(ve);wt(dt,1,()=>it().riveResources,Ut,(ke,Ie)=>{var he=kv(),Be=T(he),xe={};Ae(()=>{Te(Be,`${S(Ie).name??""} (Rive)`),xe!==(xe=S(Ie).name)&&(he.value=(he.__value=S(Ie).name)??"")}),K(ke,he)});var Ye=D(z,2),Ge=T(Ye),pt=D(T(Ge),2);pt.__click=()=>r(it().currentDialogue);var Ct=D(Ge,2);wt(Ct,1,()=>it().currentDialogue.options||[],Ut,(ke,Ie,he)=>{var Be=Sv();let xe;var ht=T(Be),ut=T(ht);ut.__click=()=>s(he),ut.__keydown=o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s(he))},Re(ut,"aria-controls",`option-content-${he}`);var ct=T(ut),H=T(ct);{var Z=o=>{var d=Zi("👁️‍🗨️");K(o,d)},q=o=>{var d=Kt(),b=At(d);{var I=V=>{var ae=Zi("🔒");K(V,ae)},M=V=>{var ae=Zi("✅");K(V,ae)};Le(b,V=>{S(Ie).enabled?V(M,!1):V(I)},!0)}K(o,d)};Le(H,o=>{S(Ie).visible?o(q,!1):o(Z)})}var ie=D(ct,2),Ee=T(ie),De=D(ut,2);De.__click=()=>l(it().currentDialogue,he);var Ce=D(ht,2);{var p=o=>{var d=Ev();Re(d,"id",`option-content-${he}`);var b=T(d);_v(b,{get option(){return S(Ie)},index:he,get dialogues(){return _t().data.dialogues},get availableItems(){return it().availableItems},get conditionTypes(){return t}}),K(o,d)};Le(Ce,o=>{_t().editingOptionIndex===he&&o(p)})}Ae(o=>{xe=mn(Be,1,"option-card svelte-1de8com",null,xe,o),Re(ut,"aria-expanded",_t().editingOptionIndex===he),Te(Ee,`#${he+1} ${S(Ie).text??""}`)},[()=>({editing:_t().editingOptionIndex===he})]),K(ke,Be)});var Oe=D(Ye,2),oe=D(T(Oe),2);Ae(()=>{it(),pn(()=>{_t()})});var Fe=T(oe);Fe.value=Fe.__value="";var we=D(Fe);wt(we,1,()=>_t().data.dialogues,Ut,(ke,Ie)=>{var he=Iv(),Be=T(he),xe={};Ae(ht=>{Te(Be,`${S(Ie).id??""}: ${ht??""}...`),xe!==(xe=S(Ie).id)&&(he.value=(he.__value=S(Ie).id)??"")},[()=>S(Ie).text.substring(0,30)]),K(ke,he)});var Ue=D(Oe,2),je=T(Ue);je.__click=()=>vr.deleteDialogue(it().currentDialogue.id),$n(g,()=>it().currentDialogue.id,ke=>it(it().currentDialogue.id=ke)),Cn($,()=>it().currentDialogue.chapterId,ke=>it(it().currentDialogue.chapterId=ke)),$n(U,()=>it().currentDialogue.text,ke=>it(it().currentDialogue.text=ke)),Cn(B,()=>it().currentDialogue.backgroundImage,ke=>it(it().currentDialogue.backgroundImage=ke)),Cn(de,()=>it().currentDialogue.characterImage,ke=>it(it().currentDialogue.characterImage=ke)),Cn(oe,()=>it().currentDialogue.nextDialogueId,ke=>it(it().currentDialogue.nextDialogueId=ke)),K(m,w)},_=m=>{var w=Cv();K(m,w)};Le(h,m=>{it().currentDialogue?m(f):m(_,!1)})}K(n,u),qt()}Yt(["change","click","keydown"]);var $e=er(()=>R),Pv=se('<img class="icon-preview svelte-asgatj"/>'),xv=se('<div class="icon-placeholder svelte-asgatj">📦</div>'),jv=se("<option> </option>"),Rv=se('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Ov=se("<option> </option>"),Mv=se('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),Lv=se('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),Dv=se('<div class="items-list svelte-asgatj"></div>'),$v=se('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),Fv=se('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),Uv=se('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function Nv(n,e){Vt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function r(){if(!$e().data)return;$e().data.items||$e($e().data.items=[]);const j={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};$e().data.items.push(j),$e($e().editingItemIndex=$e().data.items.length-1)}function s(j){$e().editingItemIndex===j?$e($e().editingItemIndex=null):$e($e().editingItemIndex=j)}function l(j){confirm("Удалить предмет?")&&$e().data?.items&&($e().data.items.splice(j,1),$e($e().editingItemIndex=null))}function u(j){if(!$e().data?.items)return;const F=$e().data.items[j],W={...F,id:`${F.id}_copy_${Date.now()}`,name:`${F.name} (копия)`};$e().data.items.splice(j+1,0,W),$e($e().editingItemIndex=j+1)}function h(j){return t.find(F=>F.value===j)?.label||j}Zn();var f=Uv(),_=T(f);_.__click=()=>$e($e().showItems=!$e().showItems);var m=T(_),w=D(T(m)),E=D(m,2),g=T(E),A=D(_,2);{var $=j=>{var F=Fv(),W=T(F);{var U=L=>{var B=Dv();wt(B,7,()=>$e().data.items,le=>le.id,(le,te,ye)=>{var X=Lv();let Q;var ge=T(X);ge.__click=()=>s(S(ye));var Pe=T(ge),de=T(Pe),me=T(de);{var ve=ct=>{var H=Pv();Ae(()=>{Re(H,"src",`https://vycjpmuyscfygstjjied.supabase.co/${$e().selectedBucket}/${S(te).icon}`),Re(H,"alt",S(te).name)}),K(ct,H)},dt=ct=>{var H=xv();K(ct,H)};Le(me,ct=>{S(te).icon?ct(ve):ct(dt,!1)})}var Ye=D(de,2),Ge=T(Ye),pt=T(Ge),Ct=D(Ge,2),Oe=T(Ct),oe=T(Oe),Fe=D(Oe,2);let we;var Ue=T(Fe),je=D(Pe,2),ke=T(je),Ie=D(ge,2),he=T(Ie);he.__click=()=>u(S(ye));var Be=D(he,2);Be.__click=()=>s(S(ye));var xe=D(Be,2);xe.__click=()=>l(S(ye));var ht=D(Ie,2);{var ut=ct=>{var H=Mv(),Z=T(H),q=T(Z),ie=T(q),Ee=D(ie,2),De=D(q,2),Ce=T(De),p=D(Ce,2),o=D(De,2),d=T(o),b=D(d,2),I=D(o,2),M=T(I),V=D(M,2),ae=T(V),be=D(ae,2);be.__change=Je=>(S(te).icon=Je.target.value,pn(()=>$e()));var _e=T(be);_e.value=_e.__value="";var ze=D(_e);wt(ze,1,()=>$e().storedFiles.filter(Je=>Je.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Ut,(Je,Tt)=>{var Et=jv(),Nt=T(Et),Se={};Ae(()=>{Te(Nt,S(Tt).name),Se!==(Se=S(Tt).name)&&(Et.value=(Et.__value=S(Tt).name)??"")}),K(Je,Et)});var nt=D(be,2),It=D(T(nt));It.__change=function(...Je){Jn.uploadNewFile?.apply(this,Je)};var gt=D(V,2);{var en=Je=>{var Tt=Rv(),Et=T(Tt),Nt=D(Et,2),Se=T(Nt);Ae(()=>{Re(Et,"src",`https://vycjpmuyscfygstjjied.supabase.co/${$e().selectedBucket}/${S(te).icon}`),Te(Se,S(te).icon)}),K(Je,Tt)};Le(gt,Je=>{S(te).icon&&Je(en)})}var Jt=D(I,2),$t=T(Jt),jt=D($t,2);Ae(()=>{S(te),pn(()=>{S(ye)})}),wt(jt,5,()=>t,Ut,(Je,Tt)=>{var Et=Ov(),Nt=T(Et),Se={};Ae(()=>{Te(Nt,S(Tt).label),Se!==(Se=S(Tt).value)&&(Et.value=(Et.__value=S(Tt).value)??"")}),K(Je,Et)}),Ae(()=>{Re(ie,"for",`item-id-${S(ye)??""}`),Re(Ee,"id",`item-id-${S(ye)??""}`),Re(Ce,"for",`item-name-${S(ye)??""}`),Re(p,"id",`item-name-${S(ye)??""}`),Re(d,"for",`item-desc-${S(ye)??""}`),Re(b,"id",`item-desc-${S(ye)??""}`),Re(M,"for",`item-icon-${S(ye)??""}`),Re(ae,"id",`item-icon-${S(ye)??""}`),Re($t,"for",`item-type-${S(ye)??""}`),Re(jt,"id",`item-type-${S(ye)??""}`)}),$n(Ee,()=>S(te).id,Je=>(S(te).id=Je,pn(()=>$e()))),$n(p,()=>S(te).name,Je=>(S(te).name=Je,pn(()=>$e()))),$n(b,()=>S(te).description,Je=>(S(te).description=Je,pn(()=>$e()))),$n(ae,()=>S(te).icon,Je=>(S(te).icon=Je,pn(()=>$e()))),Cn(jt,()=>S(te).type,Je=>(S(te).type=Je,pn(()=>$e()))),K(ct,H)};Le(ht,ct=>{$e().editingItemIndex===S(ye)&&ct(ut)})}Ae((ct,H,Z)=>{Q=mn(X,1,"item-row svelte-asgatj",null,Q,ct),Re(ge,"aria-label",`Редактировать предмет ${S(te).name??""}`),Te(pt,S(te).name),Te(oe,S(te).id),we=mn(Fe,1,"item-type-badge svelte-asgatj",null,we,H),Te(Ue,Z),Te(ke,`${S(te).description??""} || `)},[()=>({editing:$e().editingItemIndex===S(ye)}),()=>({tool:S(te).type==="tool",key:S(te).type==="key",consumable:S(te).type==="consumable",quest:S(te).type==="quest",misc:S(te).type==="misc"}),()=>h(S(te).type)]),K(le,X)}),K(L,B)},z=L=>{var B=$v();K(L,B)};Le(W,L=>{$e().data?.items?.length?L(U):L(z,!1)})}var J=D(W,2);J.__click=r,K(j,F)};Le(A,j=>{$e().showItems&&j($)})}Ae(()=>{Re(_,"title",$e().showItems?"Скрыть предметы":"Показать предметы"),Re(_,"aria-expanded",$e().showItems),Te(w,` Предметы (${($e().data?.items?.length||0)??""})`),Te(g,$e().showItems?"▼":"▶")}),K(n,f),qt()}Yt(["click","change"]);Yt(["click"]);class Bv{#i=ft(Gt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return S(this.#i)}set player(e){Me(this.#i,e,!0)}#n=ft(null);get storyData(){return S(this.#n)}set storyData(e){Me(this.#n,e,!0)}#e=ft("0");get currentDialogueId(){return S(this.#e)}set currentDialogueId(e){Me(this.#e,e,!0)}#s=ft(!0);get isLoading(){return S(this.#s)}set isLoading(e){Me(this.#s,e,!0)}#a=ft("");get error(){return S(this.#a)}set error(e){Me(this.#a,e,!0)}#t=ft(null);get selectedStory(){return S(this.#t)}set selectedStory(e){Me(this.#t,e,!0)}#r=ft(Gt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return S(this.#r)}set availableStories(e){Me(this.#r,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();this.storyData=r,this.currentDialogueId=this.storyData.dialogues[0]?.id||"0"}catch(t){const r=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${r}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){return e.visibleIf&&e.visibleIf.hasItem?this.hasItem(e.visibleIf.hasItem):!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const bt=new Bv;var ls={exports:{}},Wv=ls.exports,Sl;function Vv(){return Sl||(Sl=1,(function(n,e){(function(r,s){n.exports=s()})(Wv,()=>(()=>{var t=[,((u,h,f)=>{f.r(h),f.d(h,{default:()=>m});var _=(()=>{var w=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(E={}){var g=E,A,$;g.ready=new Promise((i,a)=>{A=i,$=a});function j(){function i(C){const O=v;c=a=0,v=new Map,O.forEach(N=>{try{N(C)}catch(x){console.error(x)}}),this.pb(),y&&y.Tb()}let a=0,c=0,v=new Map,y=null,k=null;this.requestAnimationFrame=function(C){a||(a=requestAnimationFrame(i.bind(this)));const O=++c;return v.set(O,C),O},this.cancelAnimationFrame=function(C){v.delete(C),a&&v.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(C){k&&(document.body.remove(k),k=null),C||(k=document.createElement("div"),k.style.backgroundColor="black",k.style.position="fixed",k.style.right=0,k.style.top=0,k.style.color="white",k.style.padding="4px",k.innerHTML="RIVE FPS",C=function(O){k.innerHTML="RIVE FPS "+O.toFixed(1)},document.body.appendChild(k)),y=new function(){let O=0,N=0;this.Tb=function(){var x=performance.now();N?(++O,x-=N,1e3<x&&(C(1e3*O/x),O=N=0)):(N=x,O=0)}}},this.Ob=function(){k&&(document.body.remove(k),k=null),y=null},this.pb=function(){}}function F(i){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(v){return v=v+((1<<i)-1)>>i,a.has(v)&&clearTimeout(a.get(v)),a.set(v,setTimeout(function(){a.delete(v),a.length==0?c=-1/0:v==c&&(c=Math.max(...a.keys()),console.assert(c<v))},1e3)),c=Math.max(v,c),c<<i}}const W=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){W&&W();let i=g.decodeAudio;g.decodeAudio=function(y,k){y=i(y),k(y)};let a=g.decodeFont;g.decodeFont=function(y,k){y=a(y),k(y)};const c=g.FileAssetLoader;g.ptrToAsset=y=>{let k=g.ptrToFileAsset(y);return k.isImage?g.ptrToImageAsset(y):k.isFont?g.ptrToFontAsset(y):k.isAudio?g.ptrToAudioAsset(y):k},g.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:y}){this.__parent.__construct.call(this),this.Gb=y},loadContents:function(y,k){return y=g.ptrToAsset(y),this.Gb(y,k)}}),g.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(y){let k=g.ptrToAsset(y);return y=k.cdnUuid,y===""?!1:((function(C,O){var N=new XMLHttpRequest;N.responseType="arraybuffer",N.onreadystatechange=function(){N.readyState==4&&N.status==200&&O(N)},N.open("GET",C,!0),N.send(null)})(k.cdnBaseUrl+"/"+y,C=>{k.decode(new Uint8Array(C.response))}),!0)}}),g.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(y){this.lb.push(y)},loadContents:function(y,k){for(let C of this.lb)if(C.loadContents(y,k))return!0;return!1}});let v=g.computeAlignment;g.computeAlignment=function(y,k,C,O,N=1){return v.call(this,y,k,C,O,N)}};const U="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function i(){if(!a){let Ve=function(He,ue,yt){if(ue=Y.createShader(ue),Y.shaderSource(ue,yt),Y.compileShader(ue),yt=Y.getShaderInfoLog(ue),0<(yt||"").length)throw yt;Y.attachShader(He,ue)};var P=document.createElement("canvas"),ee={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let Y;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(Y=P.getContext("webgl",ee),c=1,!Y)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(Y=P.getContext("webgl2",ee))c=2;else if(Y=P.getContext("webgl",ee))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(Y=new Proxy(Y,{get(He,ue){if(He.isContextLost()){if(N||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",ue),N=!0),typeof He[ue]=="function")return function(){}}else return typeof He[ue]=="function"?function(...yt){return He[ue].apply(He,yt)}:He[ue]},set(He,ue,yt){if(He.isContextLost())N||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+ue),N=!0);else return He[ue]=yt,!0}}),v=Math.min(Y.getParameter(Y.MAX_RENDERBUFFER_SIZE),Y.getParameter(Y.MAX_TEXTURE_SIZE)),P=Y.createProgram(),Ve(P,Y.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ve(P,Y.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),Y.bindAttribLocation(P,0,"vertex"),Y.bindAttribLocation(P,1,"uv"),Y.linkProgram(P),ee=Y.getProgramInfoLog(P),0<(ee||"").trim().length)throw ee;y=Y.getUniformLocation(P,"mat"),k=Y.getUniformLocation(P,"translate"),Y.useProgram(P),Y.bindBuffer(Y.ARRAY_BUFFER,Y.createBuffer()),Y.enableVertexAttribArray(0),Y.enableVertexAttribArray(1),Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,Y.createBuffer()),Y.uniform1i(Y.getUniformLocation(P,"image"),0),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=Y}return!0}let a=null,c=0,v=0,y=null,k=null,C=0,O=0,N=!1;i(),this.hc=function(){return i(),v},this.Mb=function(P){a.deleteTexture&&a.deleteTexture(P)},this.Lb=function(P){if(!i())return null;const ee=a.createTexture();return ee?(a.bindTexture(a.TEXTURE_2D,ee),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,P),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),ee):null};const x=new F(8),ne=new F(8),re=new F(10),fe=new F(10);this.Qb=function(P,ee,Y,Ve,He){if(i()){var ue=x.push(P),yt=ne.push(ee);if(a.canvas){(a.canvas.width!=ue||a.canvas.height!=yt)&&(a.canvas.width=ue,a.canvas.height=yt),a.viewport(0,yt-ee,P,ee),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),Y.sort((Ze,kn)=>kn.xb-Ze.xb),ue=re.push(Ve),C!=ue&&(a.bufferData(a.ARRAY_BUFFER,8*ue,a.DYNAMIC_DRAW),C=ue),ue=0;for(var Ft of Y)a.bufferSubData(a.ARRAY_BUFFER,ue,Ft.Ua),ue+=4*Ft.Ua.length;console.assert(ue==4*Ve);for(var wn of Y)a.bufferSubData(a.ARRAY_BUFFER,ue,wn.Db),ue+=4*wn.Db.length;console.assert(ue==8*Ve),ue=fe.push(He),O!=ue&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*ue,a.DYNAMIC_DRAW),O=ue),Ft=0;for(var sr of Y)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Ft,sr.indices),Ft+=2*sr.indices.length;console.assert(Ft==2*He),sr=0,wn=!0,ue=Ft=0;for(const Ze of Y){Ze.image.Ka!=sr&&(a.bindTexture(a.TEXTURE_2D,Ze.image.Ja||null),sr=Ze.image.Ka),Ze.mc?(a.scissor(Ze.Za,yt-Ze.$a-Ze.kb,Ze.Ac,Ze.kb),wn=!0):wn&&(a.scissor(0,yt-ee,P,ee),wn=!1),Y=2/P;const kn=-2/ee;a.uniform4f(y,Ze.ha[0]*Y*Ze.Ba,Ze.ha[1]*kn*Ze.Ca,Ze.ha[2]*Y*Ze.Ba,Ze.ha[3]*kn*Ze.Ca),a.uniform2f(k,Ze.ha[4]*Y*Ze.Ba+Y*(Ze.Za-Ze.ic*Ze.Ba)-1,Ze.ha[5]*kn*Ze.Ca+kn*(Ze.$a-Ze.jc*Ze.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,ue),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,ue+4*Ve),a.drawElements(a.TRIANGLES,Ze.indices.length,a.UNSIGNED_SHORT,Ft),ue+=4*Ze.Ua.length,Ft+=2*Ze.indices.length}console.assert(ue==4*Ve),console.assert(Ft==2*He)}}},this.canvas=function(){return i()&&a.canvas}},J=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function i(G){switch(G){case x.srcOver:return"source-over";case x.screen:return"screen";case x.overlay:return"overlay";case x.darken:return"darken";case x.lighten:return"lighten";case x.colorDodge:return"color-dodge";case x.colorBurn:return"color-burn";case x.hardLight:return"hard-light";case x.softLight:return"soft-light";case x.difference:return"difference";case x.exclusion:return"exclusion";case x.multiply:return"multiply";case x.hue:return"hue";case x.saturation:return"saturation";case x.color:return"color";case x.luminosity:return"luminosity"}}function a(G){return"rgba("+((16711680&G)>>>16)+","+((65280&G)>>>8)+","+((255&G)>>>0)+","+((4278190080&G)>>>24)/255+")"}function c(){0<yt.length&&(z.Qb(ue.drawWidth(),ue.drawHeight(),yt,Ft,wn),yt=[],wn=Ft=0,ue.reset(512,512));for(const G of He){for(const ce of G.H)ce();G.H=[]}He.clear()}J&&J();var v=g.RenderPaintStyle;const y=g.RenderPath,k=g.RenderPaint,C=g.Renderer,O=g.StrokeCap,N=g.StrokeJoin,x=g.BlendMode,ne=v.fill,re=v.stroke,fe=g.FillRule.evenOdd;let P=1;var ee=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:G,xa:ce}={}){this.__parent.__construct.call(this),this.Ka=P,P=P+1&2147483647||1,this.la=G,this.xa=ce},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(G){var ce=this;ce.xa&&ce.xa(ce);var Xe=new Image;ce.Xa=URL.createObjectURL(new Blob([G],{type:"image/png"})),Xe.onload=function(){ce.Fb=Xe,ce.Ja=z.Lb(Xe),ce.size(Xe.width,Xe.height),ce.la&&ce.la(ce)},Xe.src=ce.Xa}}),Y=y.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(G,ce,Xe,et,qe,Qe,at){var lt=this.T,fn=lt.addPath;G=G.T;const Rt=new DOMMatrix;Rt.a=ce,Rt.b=Xe,Rt.c=et,Rt.d=qe,Rt.e=Qe,Rt.f=at,fn.call(lt,G,Rt)},fillRule:function(G){this.Wa=G},moveTo:function(G,ce){this.T.moveTo(G,ce)},lineTo:function(G,ce){this.T.lineTo(G,ce)},cubicTo:function(G,ce,Xe,et,qe,Qe){this.T.bezierCurveTo(G,ce,Xe,et,qe,Qe)},close:function(){this.T.closePath()}}),Ve=k.extend("CanvasRenderPaint",{color:function(G){this.Ya=a(G)},thickness:function(G){this.Ib=G},join:function(G){switch(G){case N.miter:this.Ia="miter";break;case N.round:this.Ia="round";break;case N.bevel:this.Ia="bevel"}},cap:function(G){switch(G){case O.butt:this.Ha="butt";break;case O.round:this.Ha="round";break;case O.square:this.Ha="square"}},style:function(G){this.Hb=G},blendMode:function(G){this.Eb=i(G)},clearGradient:function(){this.ja=null},linearGradient:function(G,ce,Xe,et){this.ja={zb:G,Ab:ce,cb:Xe,eb:et,Ra:[]}},radialGradient:function(G,ce,Xe,et){this.ja={zb:G,Ab:ce,cb:Xe,eb:et,Ra:[],ec:!0}},addStop:function(G,ce){this.ja.Ra.push({color:G,stop:ce})},completeGradient:function(){},draw:function(G,ce,Xe){let et=this.Hb;var qe=this.Ya,Qe=this.ja;if(G.globalCompositeOperation=this.Eb,Qe!=null){qe=Qe.zb;var at=Qe.Ab;const fn=Qe.cb;var lt=Qe.eb;const Rt=Qe.Ra;Qe.ec?(Qe=fn-qe,lt-=at,qe=G.createRadialGradient(qe,at,0,qe,at,Math.sqrt(Qe*Qe+lt*lt))):qe=G.createLinearGradient(qe,at,fn,lt);for(let an=0,Ot=Rt.length;an<Ot;an++)at=Rt[an],qe.addColorStop(at.stop,a(at.color));this.Ya=qe,this.ja=null}switch(et){case re:G.strokeStyle=qe,G.lineWidth=this.Ib,G.lineCap=this.Ha,G.lineJoin=this.Ia,G.stroke(ce);break;case ne:G.fillStyle=qe,G.fill(ce,Xe)}}});const He=new Set;let ue=null,yt=[],Ft=0,wn=0;var sr=g.CanvasRenderer=C.extend("Renderer",{__construct:function(G){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=G.getContext("2d"),this.Va=G,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const G=this.S.length-6;if(6>G)throw"restore() called without matching save().";this.S.splice(G),this.H.push(this.C.restore.bind(this.C))},transform:function(G,ce,Xe,et,qe,Qe){const at=this.S,lt=at.length-6;at.splice(lt,6,at[lt]*G+at[lt+2]*ce,at[lt+1]*G+at[lt+3]*ce,at[lt]*Xe+at[lt+2]*et,at[lt+1]*Xe+at[lt+3]*et,at[lt]*qe+at[lt+2]*Qe+at[lt+4],at[lt+1]*qe+at[lt+3]*Qe+at[lt+5]),this.H.push(this.C.transform.bind(this.C,G,ce,Xe,et,qe,Qe))},rotate:function(G){const ce=Math.sin(G);G=Math.cos(G),this.transform(G,ce,-ce,G,0,0)},_drawPath:function(G,ce){this.H.push(ce.draw.bind(ce,this.C,G.T,G.Wa===fe?"evenodd":"nonzero"))},_drawRiveImage:function(G,ce,Xe,et){var qe=G.Fb;if(qe){var Qe=this.C,at=i(Xe);this.H.push(function(){Qe.globalCompositeOperation=at,Qe.globalAlpha=et,Qe.drawImage(qe,0,0),Qe.globalAlpha=1})}},_getMatrix:function(G){const ce=this.S,Xe=ce.length-6;for(let et=0;6>et;++et)G[et]=ce[Xe+et]},_drawImageMesh:function(G,ce,Xe,et,qe,Qe,at,lt,fn,Rt,an){ce=this.C.canvas.width;var Ot=this.C.canvas.height;const Oo=Rt-lt,Mo=an-fn;lt=Math.max(lt,0),fn=Math.max(fn,0),Rt=Math.min(Rt,ce),an=Math.min(an,Ot);const hi=Rt-lt,fi=an-fn;if(console.assert(hi<=Math.min(Oo,ce)),console.assert(fi<=Math.min(Mo,Ot)),!(0>=hi||0>=fi)){Rt=hi<Oo||fi<Mo,ce=an=1;var ar=Math.ceil(hi*an),or=Math.ceil(fi*ce);Ot=z.hc(),ar>Ot&&(an*=Ot/ar,ar=Ot),or>Ot&&(ce*=Ot/or,or=Ot),ue||(ue=new g.DynamicRectanizer(Ot),ue.reset(512,512)),Ot=ue.addRect(ar,or),0>Ot&&(c(),He.add(this),Ot=ue.addRect(ar,or),console.assert(0<=Ot));var Lo=Ot&65535,Do=Ot>>16;yt.push({ha:this.S.slice(this.S.length-6),image:G,Za:Lo,$a:Do,ic:lt,jc:fn,Ac:ar,kb:or,Ba:an,Ca:ce,Ua:new Float32Array(qe),Db:new Float32Array(Qe),indices:new Uint16Array(at),mc:Rt,xb:G.Ka<<1|(Rt?1:0)}),Ft+=qe.length,wn+=at.length;var Cr=this.C,sc=i(Xe);this.H.push(function(){Cr.save(),Cr.resetTransform(),Cr.globalCompositeOperation=sc,Cr.globalAlpha=et;const $o=z.canvas();$o&&Cr.drawImage($o,Lo,Do,ar,or,lt,fn,hi,fi),Cr.restore()})}},_clipPath:function(G){this.H.push(this.C.clip.bind(this.C,G.T,G.Wa===fe?"evenodd":"nonzero"))},clear:function(){He.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(G,ce){this.transform(1,0,0,1,G,ce)}});g.makeRenderer=function(G){const ce=new sr(G),Xe=ce.C;return new Proxy(ce,{get(et,qe){if(typeof et[qe]=="function")return function(...Qe){return et[qe].apply(et,Qe)};if(typeof Xe[qe]=="function"){if(-1<U.indexOf(qe))throw Error("RiveException: Method call to '"+qe+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Qe){ce.H.push(Xe[qe].bind(Xe,...Qe))}}return et[qe]},set(et,qe,Qe){if(qe in Xe)return ce.H.push(()=>{Xe[qe]=Qe}),!0}})},g.decodeImage=function(G,ce){new ee({la:ce}).decode(G)},g.renderFactory={makeRenderPaint:function(){return new Ve},makeRenderPath:function(){return new Y},makeRenderImage:function(){let G=kn;return new ee({xa:()=>{G.total++},la:()=>{if(G.loaded++,G.loaded===G.total){const ce=G.ready;ce&&(ce(),G.ready=null)}}})}};let Ze=g.load,kn=null;g.load=function(G,ce,Xe=!0){const et=new g.FallbackFileAssetLoader;return ce!==void 0&&et.addLoader(ce),Xe&&(ce=new g.CDNFileAssetLoader,et.addLoader(ce)),new Promise(function(qe){let Qe=null;kn={total:0,loaded:0,ready:function(){qe(Qe)}},Qe=Ze(G,et),kn.total==0&&qe(Qe)})};let ic=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(G,ce,Xe,et,qe=1){ic.call(this,G,ce,Xe,et,qe)},v=new j,g.requestAnimationFrame=v.requestAnimationFrame.bind(v),g.cancelAnimationFrame=v.cancelAnimationFrame.bind(v),g.enableFPSCounter=v.Rb.bind(v),g.disableFPSCounter=v.Ob,v.pb=c,g.resolveAnimationFrame=c,g.cleanup=function(){ue&&ue.delete()}};var L=Object.assign({},g),B="./this.program",le=typeof window=="object",te=typeof importScripts=="function",ye="",X,Q;(le||te)&&(te?ye=self.location.href:typeof document<"u"&&document.currentScript&&(ye=document.currentScript.src),w&&(ye=w),ye.indexOf("blob:")!==0?ye=ye.substr(0,ye.replace(/[?#].*/,"").lastIndexOf("/")+1):ye="",te&&(Q=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),X=(i,a,c)=>{var v=new XMLHttpRequest;v.open("GET",i,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var ge=g.print||console.log.bind(console),Pe=g.printErr||console.error.bind(console);Object.assign(g,L),L=null,g.thisProgram&&(B=g.thisProgram);var de;g.wasmBinary&&(de=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&ut("no native wasm support detected");var me,ve,dt=!1,Ye,Ge,pt,Ct,Oe,oe,Fe,we;function Ue(){var i=me.buffer;g.HEAP8=Ye=new Int8Array(i),g.HEAP16=pt=new Int16Array(i),g.HEAP32=Oe=new Int32Array(i),g.HEAPU8=Ge=new Uint8Array(i),g.HEAPU16=Ct=new Uint16Array(i),g.HEAPU32=oe=new Uint32Array(i),g.HEAPF32=Fe=new Float32Array(i),g.HEAPF64=we=new Float64Array(i)}var je,ke=[],Ie=[],he=[];function Be(){var i=g.preRun.shift();ke.unshift(i)}var xe=0,ht=null;function ut(i){throw g.onAbort&&g.onAbort(i),i="Aborted("+i+")",Pe(i),dt=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),$(i),i}function ct(i){return i.startsWith("data:application/octet-stream;base64,")}var H;if(H="canvas_advanced.wasm",!ct(H)){var Z=H;H=g.locateFile?g.locateFile(Z,ye):ye+Z}function q(i){if(i==H&&de)return new Uint8Array(de);if(Q)return Q(i);throw"both async and sync fetching of the wasm failed"}function ie(i){if(!de&&(le||te)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+i+"'";return a.arrayBuffer()}).catch(()=>q(i));if(X)return new Promise((a,c)=>{X(i,v=>a(new Uint8Array(v)),c)})}return Promise.resolve().then(()=>q(i))}function Ee(i,a,c){return ie(i).then(v=>WebAssembly.instantiate(v,a)).then(v=>v).then(c,v=>{Pe("failed to asynchronously prepare wasm: "+v),ut(v)})}function De(i,a){var c=H;return de||typeof WebAssembly.instantiateStreaming!="function"||ct(c)||c.startsWith("file://")||typeof fetch!="function"?Ee(c,i,a):fetch(c,{credentials:"same-origin"}).then(v=>WebAssembly.instantiateStreaming(v,i).then(a,function(y){return Pe("wasm streaming compile failed: "+y),Pe("falling back to ArrayBuffer instantiation"),Ee(c,i,a)}))}var Ce,p,o={460492:(i,a,c,v,y)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=i,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=v,window.h.ga.yb=y;let k=window.h;k.D=[],k.yc=function(C){for(var O=0;O<k.D.length;++O)if(k.D[O]==null)return k.D[O]=C,O;return k.D.push(C),k.D.length-1},k.Cb=function(C){for(k.D[C]=null;0<k.D.length&&k.D[k.D.length-1]==null;)k.D.pop()},k.Sc=function(C){for(var O=0;O<k.D.length;++O)if(k.D[O]==C)return k.Cb(O)},k.ra=function(C){return k.D[C]},k.Ta=["touchend","click"],k.unlock=function(){for(var C=0;C<k.D.length;++C){var O=k.D[C];O!=null&&O.J!=null&&O.state===k.ga.yb&&O.J.resume().then(()=>{To(O.qb)},N=>{console.error("Failed to resume audiocontext",N)})}k.Ta.map(function(N){document.removeEventListener(N,k.unlock,!0)})},k.Ta.map(function(C){document.addEventListener(C,k.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(i){document.removeEventListener(i,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),a=i.sampleRate;return i.close(),a}catch{return 0}},463249:(i,a,c,v,y,k)=>{if(typeof window.h>"u")return-1;var C={},O={};return i==window.h.I.ya&&c!=0&&(O.sampleRate=c),C.J=new(window.AudioContext||window.webkitAudioContext)(O),C.J.suspend(),C.state=window.h.ga.stopped,c=0,i!=window.h.I.ya&&(c=a),C.Z=C.J.createScriptProcessor(v,c,a),C.Z.onaudioprocess=function(N){if((C.sa==null||C.sa.length==0)&&(C.sa=new Float32Array(Fe.buffer,y,v*a)),i==window.h.I.capture||i==window.h.I.La){for(var x=0;x<a;x+=1)for(var ne=N.inputBuffer.getChannelData(x),re=C.sa,fe=0;fe<v;fe+=1)re[fe*a+x]=ne[fe];Po(k,v,y)}if(i==window.h.I.ya||i==window.h.I.La)for(xo(k,v,y),x=0;x<N.outputBuffer.numberOfChannels;++x)for(ne=N.outputBuffer.getChannelData(x),re=C.sa,fe=0;fe<v;fe+=1)ne[fe]=re[fe*a+x];else for(x=0;x<N.outputBuffer.numberOfChannels;++x)N.outputBuffer.getChannelData(x).fill(0)},i!=window.h.I.capture&&i!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(N){C.Da=C.J.createMediaStreamSource(N),C.Da.connect(C.Z),C.Z.connect(C.J.destination)}).catch(function(N){console.log("Failed to get user media: "+N)}),i==window.h.I.ya&&C.Z.connect(C.J.destination),C.qb=k,window.h.yc(C)},466126:i=>window.h.ra(i).J.sampleRate,466199:i=>{i=window.h.ra(i),i.Z!==void 0&&(i.Z.onaudioprocess=function(){},i.Z.disconnect(),i.Z=void 0),i.Da!==void 0&&(i.Da.disconnect(),i.Da=void 0),i.J.close(),i.J=void 0,i.qb=void 0},466599:i=>{window.h.Cb(i)},466649:i=>{i=window.h.ra(i),i.J.resume(),i.state=window.h.ga.yb},466788:i=>{i=window.h.ra(i),i.J.suspend(),i.state=window.h.ga.stopped}},d=i=>{for(;0<i.length;)i.shift()(g)},b=(i,a)=>{for(var c=0,v=i.length-1;0<=v;v--){var y=i[v];y==="."?i.splice(v,1):y===".."?(i.splice(v,1),c++):c&&(i.splice(v,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},I=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=b(i.split("/").filter(v=>!!v),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},M=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&(a=a.substr(0,a.length-1)),i+a)},V=i=>{if(i==="/")return"/";i=I(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},ae=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);ut("initRandomDevice")},be=i=>(be=ae())(i);function _e(){for(var i="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";i=a+"/"+i,a=a.charAt(0)==="/"}return i=b(i.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+i||"."}var ze=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,nt=(i,a,c)=>{var v=a+c;for(c=a;i[c]&&!(c>=v);)++c;if(16<c-a&&i.buffer&&ze)return ze.decode(i.subarray(a,c));for(v="";a<c;){var y=i[a++];if(y&128){var k=i[a++]&63;if((y&224)==192)v+=String.fromCharCode((y&31)<<6|k);else{var C=i[a++]&63;y=(y&240)==224?(y&15)<<12|k<<6|C:(y&7)<<18|k<<12|C<<6|i[a++]&63,65536>y?v+=String.fromCharCode(y):(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else v+=String.fromCharCode(y)}return v},It=[],gt=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);127>=v?a++:2047>=v?a+=2:55296<=v&&57343>=v?(a+=4,++c):a+=3}return a},en=(i,a,c,v)=>{if(!(0<v))return 0;var y=c;v=c+v-1;for(var k=0;k<i.length;++k){var C=i.charCodeAt(k);if(55296<=C&&57343>=C){var O=i.charCodeAt(++k);C=65536+((C&1023)<<10)|O&1023}if(127>=C){if(c>=v)break;a[c++]=C}else{if(2047>=C){if(c+1>=v)break;a[c++]=192|C>>6}else{if(65535>=C){if(c+2>=v)break;a[c++]=224|C>>12}else{if(c+3>=v)break;a[c++]=240|C>>18,a[c++]=128|C>>12&63}a[c++]=128|C>>6&63}a[c++]=128|C&63}}return a[c]=0,c-y};function Jt(i,a){var c=Array(gt(i)+1);return i=en(i,c,0,c.length),a&&(c.length=i),c}var $t=[];function jt(i,a){$t[i]={input:[],F:[],V:a},js(i,Je)}var Je={open:function(i){var a=$t[i.node.za];if(!a)throw new pe(43);i.s=a,i.seekable=!1},close:function(i){i.s.V.qa(i.s)},qa:function(i){i.s.V.qa(i.s)},read:function(i,a,c,v){if(!i.s||!i.s.V.jb)throw new pe(60);for(var y=0,k=0;k<v;k++){try{var C=i.s.V.jb(i.s)}catch{throw new pe(29)}if(C===void 0&&y===0)throw new pe(6);if(C==null)break;y++,a[c+k]=C}return y&&(i.node.timestamp=Date.now()),y},write:function(i,a,c,v){if(!i.s||!i.s.V.Oa)throw new pe(60);try{for(var y=0;y<v;y++)i.s.V.Oa(i.s,a[c+y])}catch{throw new pe(29)}return v&&(i.node.timestamp=Date.now()),y}},Tt={jb:function(){e:{if(!It.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}It=Jt(i,!0)}i=It.shift()}return i},Oa:function(i,a){a===null||a===10?(ge(nt(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(ge(nt(i.F,0)),i.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},Et={Oa:function(i,a){a===null||a===10?(Pe(nt(i.F,0)),i.F=[]):a!=0&&i.F.push(a)},qa:function(i){i.F&&0<i.F.length&&(Pe(nt(i.F,0)),i.F=[])}};function Nt(i,a){var c=i.j?i.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.j,i.j=new Uint8Array(a),0<i.v&&i.j.set(c.subarray(0,i.v),0))}var Se={O:null,U(){return Se.createNode(null,"/",16895,0)},createNode(i,a,c,v){if((c&61440)===24576||(c&61440)===4096)throw new pe(63);return Se.O||(Se.O={dir:{node:{Y:Se.l.Y,P:Se.l.P,ka:Se.l.ka,va:Se.l.va,vb:Se.l.vb,Bb:Se.l.Bb,wb:Se.l.wb,tb:Se.l.tb,Ea:Se.l.Ea},stream:{ba:Se.m.ba}},file:{node:{Y:Se.l.Y,P:Se.l.P},stream:{ba:Se.m.ba,read:Se.m.read,write:Se.m.write,pa:Se.m.pa,mb:Se.m.mb,ob:Se.m.ob}},link:{node:{Y:Se.l.Y,P:Se.l.P,ma:Se.l.ma},stream:{}},ab:{node:{Y:Se.l.Y,P:Se.l.P},stream:Du}}),c=Ja(i,a,c,v),(c.mode&61440)===16384?(c.l=Se.O.dir.node,c.m=Se.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Se.O.file.node,c.m=Se.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Se.O.link.node,c.m=Se.O.link.stream):(c.mode&61440)===8192&&(c.l=Se.O.ab.node,c.m=Se.O.ab.stream),c.timestamp=Date.now(),i&&(i.j[a]=c,i.timestamp=c.timestamp),c},Kc(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{Y(i){var a={};return a.Jc=(i.mode&61440)===8192?i.id:1,a.Mc=i.id,a.mode=i.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=i.za,(i.mode&61440)===16384?a.size=4096:(i.mode&61440)===32768?a.size=i.v:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.Bc=new Date(i.timestamp),a.Nc=new Date(i.timestamp),a.Ic=new Date(i.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.v!=a))if(a==0)i.j=null,i.v=0;else{var c=i.j;i.j=new Uint8Array(a),c&&i.j.set(c.subarray(0,Math.min(a,i.v))),i.v=a}},ka(){throw xs[44]},va(i,a,c,v){return Se.createNode(i,a,c,v)},vb(i,a,c){if((i.mode&61440)===16384){try{var v=ji(a,c)}catch{}if(v)for(var y in v.j)throw new pe(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=c,a.j[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},Bb(i,a){delete i.j[a],i.timestamp=Date.now()},wb(i,a){var c=ji(i,a),v;for(v in c.j)throw new pe(55);delete i.j[a],i.timestamp=Date.now()},tb(i){var a=[".",".."],c;for(c in i.j)i.j.hasOwnProperty(c)&&a.push(c);return a},Ea(i,a,c){return i=Se.createNode(i,a,41471,0),i.link=c,i},ma(i){if((i.mode&61440)!==40960)throw new pe(28);return i.link}},m:{read(i,a,c,v,y){var k=i.node.j;if(y>=i.node.v)return 0;if(i=Math.min(i.node.v-y,v),8<i&&k.subarray)a.set(k.subarray(y,y+i),c);else for(v=0;v<i;v++)a[c+v]=k[y+v];return i},write(i,a,c,v,y,k){if(a.buffer===Ye.buffer&&(k=!1),!v)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.j||i.j.subarray)){if(k)return i.j=a.subarray(c,c+v),i.v=v;if(i.v===0&&y===0)return i.j=a.slice(c,c+v),i.v=v;if(y+v<=i.v)return i.j.set(a.subarray(c,c+v),y),v}if(Nt(i,y+v),i.j.subarray&&a.subarray)i.j.set(a.subarray(c,c+v),y);else for(k=0;k<v;k++)i.j[y+k]=a[c+k];return i.v=Math.max(i.v,y+v),v},ba(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.v),0>a)throw new pe(28);return a},pa(i,a,c){Nt(i.node,a+c),i.node.v=Math.max(i.node.v,a+c)},mb(i,a,c,v,y){if((i.node.mode&61440)!==32768)throw new pe(43);if(i=i.node.j,y&2||i.buffer!==Ye.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,ut(),a=void 0,!a)throw new pe(48);Ye.set(i,a)}else c=!1,a=i.byteOffset;return{o:a,M:c}},ob(i,a,c,v){return Se.m.write(i,a,0,v,c,!1),0}}};function rt(i,a){var c=0;return i&&(c|=365),a&&(c|=146),c}var yn=null,Ha={},xi=[],Mu=1,ri=null,Ga=!0,pe=null,xs={},nr=(i,a={})=>{if(i=_e(i),!i)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new pe(32);i=i.split("/").filter(C=>!!C);for(var c=yn,v="/",y=0;y<i.length;y++){var k=y===i.length-1;if(k&&a.parent)break;if(c=ji(c,i[y]),v=I(v+"/"+i[y]),c.wa&&(!k||k&&a.hb)&&(c=c.wa.root),!k||a.gb){for(k=0;(c.mode&61440)===40960;)if(c=$u(v),v=_e(M(v),c),c=nr(v,{Qa:a.Qa+1}).node,40<k++)throw new pe(32)}}return{path:v,node:c}},Ka=i=>{for(var a;;){if(i===i.parent)return i=i.U.nb,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}},Ya=(i,a)=>{for(var c=0,v=0;v<a.length;v++)c=(c<<5)-c+a.charCodeAt(v)|0;return(i+c>>>0)%ri.length},ji=(i,a)=>{var c;if(c=(c=Ri(i,"x"))?c:i.l.ka?0:2)throw new pe(c,i);for(c=ri[Ya(i.id,a)];c;c=c.lc){var v=c.name;if(c.parent.id===i.id&&v===a)return c}return i.l.ka(i,a)},Ja=(i,a,c,v)=>(i=new So(i,a,c,v),a=Ya(i.parent.id,i.name),i.lc=ri[a],ri[a]=i),Xa=i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},Ri=(i,a)=>{if(Ga)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},Qa=(i,a)=>{try{return ji(i,a),20}catch{}return Ri(i,"wx")},Lu=()=>{for(var i=0;4096>=i;i++)if(!xi[i])return i;throw new pe(33)},Wn=i=>{if(i=xi[i],!i)throw new pe(8);return i},Za=(i,a=-1)=>(si||(si=function(){this.h={}},si.prototype={},Object.defineProperties(si.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),i=Object.assign(new si,i),a==-1&&(a=Lu()),i.X=a,xi[a]=i),Du={open:i=>{i.m=Ha[i.node.za].m,i.m.open&&i.m.open(i)},ba:()=>{throw new pe(70)}},js=(i,a)=>{Ha[i]={m:a}},eo=(i,a)=>{var c=a==="/",v=!a;if(c&&yn)throw new pe(10);if(!c&&!v){var y=nr(a,{hb:!1});if(a=y.path,y=y.node,y.wa)throw new pe(10);if((y.mode&61440)!==16384)throw new pe(54)}a={type:i,Qc:{},nb:a,kc:[]},i=i.U(a),i.U=a,a.root=i,c?yn=i:y&&(y.wa=a,y.U&&y.U.kc.push(a))},cn=(i,a,c)=>{var v=nr(i,{parent:!0}).node;if(i=V(i),!i||i==="."||i==="..")throw new pe(28);var y=Qa(v,i);if(y)throw new pe(y);if(!v.l.va)throw new pe(63);return v.l.va(v,i,a,c)},Oi=(i,a,c)=>{typeof c>"u"&&(c=a,a=438),cn(i,a|8192,c)},Rs=(i,a)=>{if(!_e(i))throw new pe(44);var c=nr(a,{parent:!0}).node;if(!c)throw new pe(44);a=V(a);var v=Qa(c,a);if(v)throw new pe(v);if(!c.l.Ea)throw new pe(63);c.l.Ea(c,a,i)},$u=i=>{if(i=nr(i).node,!i)throw new pe(44);if(!i.l.ma)throw new pe(28);return _e(Ka(i.parent),i.l.ma(i))},Mi=(i,a,c)=>{if(i==="")throw new pe(44);if(typeof a=="string"){var v={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof v>"u")throw Error(`Unknown file open mode: ${a}`);a=v}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var y=i;else{i=I(i);try{y=nr(i,{gb:!(a&131072)}).node}catch{}}if(v=!1,a&64)if(y){if(a&128)throw new pe(20)}else y=cn(i,c,0),v=!0;if(!y)throw new pe(44);if((y.mode&61440)===8192&&(a&=-513),a&65536&&(y.mode&61440)!==16384)throw new pe(54);if(!v&&(c=y?(y.mode&61440)===40960?32:(y.mode&61440)===16384&&(Xa(a)!=="r"||a&512)?31:Ri(y,Xa(a)):44))throw new pe(c);if(a&512&&!v){if(c=y,c=typeof c=="string"?nr(c,{gb:!0}).node:c,!c.l.P)throw new pe(63);if((c.mode&61440)===16384)throw new pe(31);if((c.mode&61440)!==32768)throw new pe(28);if(v=Ri(c,"w"))throw new pe(v);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,y=Za({node:y,path:Ka(y),flags:a,seekable:!0,position:0,m:y.m,zc:[],error:!1}),y.m.open&&y.m.open(y),!g.logReadFiles||a&1||(Li||(Li={}),i in Li||(Li[i]=1)),y},to=(i,a,c)=>{if(i.X===null)throw new pe(8);if(!i.seekable||!i.m.ba)throw new pe(70);if(c!=0&&c!=1&&c!=2)throw new pe(28);i.position=i.m.ba(i,a,c),i.zc=[]},no=()=>{pe||(pe=function(i,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(i),this.message="FS error"},pe.prototype=Error(),pe.prototype.constructor=pe,[44].forEach(i=>{xs[i]=new pe(i),xs[i].stack="<generic error, no stack>"}))},ro,ii=(i,a,c)=>{i=I("/dev/"+i);var v=rt(!!a,!!c);Os||(Os=64);var y=Os++<<8|0;js(y,{open:k=>{k.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(k,C,O,N)=>{for(var x=0,ne=0;ne<N;ne++){try{var re=a()}catch{throw new pe(29)}if(re===void 0&&x===0)throw new pe(6);if(re==null)break;x++,C[O+ne]=re}return x&&(k.node.timestamp=Date.now()),x},write:(k,C,O,N)=>{for(var x=0;x<N;x++)try{c(C[O+x])}catch{throw new pe(29)}return N&&(k.node.timestamp=Date.now()),x}}),Oi(i,v,y)},Os,rr={},si,Li,ai=void 0;function xn(){return ai+=4,Oe[ai-4>>2]}function io(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return 48<=a&&57>=a?`_${i}`:i}function Di(i,a){return i=io(i),{[i]:function(){return a.apply(this,arguments)}}[i]}function so(){this.M=[void 0],this.ib=[]}var sn=new so,Sr=void 0;function We(i){throw new Sr(i)}var dn=i=>(i||We("Cannot use deleted val. handle = "+i),sn.get(i).value),hn=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return sn.pa({ub:1,value:i})}};function ao(i){var a=Error,c=Di(i,function(v){this.name=i,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var oo=void 0,lo=void 0;function kt(i){for(var a="";Ge[i];)a+=lo[Ge[i++]];return a}var oi=[];function Ms(){for(;oi.length;){var i=oi.pop();i.g.fa=!1,i.delete()}}var li=void 0,jn={};function Ls(i,a){for(a===void 0&&We("ptr should not be undefined");i.A;)a=i.na(a),i=i.A;return a}var ir={};function uo(i){i=jo(i);var a=kt(i);return Mn(i),a}function ui(i,a){var c=ir[i];return c===void 0&&We(a+" has unknown type "+uo(i)),c}function $i(){}var Ds=!1;function co(i){--i.count.value,i.count.value===0&&(i.G?i.L.W(i.G):i.u.i.W(i.o))}function ho(i,a,c){return a===c?i:c.A===void 0?null:(i=ho(i,a,c.A),i===null?null:c.Pb(i))}var fo={};function Fu(i,a){return a=Ls(i,a),jn[a]}var vo=void 0;function Fi(i){throw new vo(i)}function Ui(i,a){return a.u&&a.o||Fi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Fi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Ir(Object.create(i,{g:{value:a}}))}function Ir(i){return typeof FinalizationRegistry>"u"?(Ir=a=>a,i):(Ds=new FinalizationRegistry(a=>{co(a.g)}),Ir=a=>{var c=a.g;return c.G&&Ds.register(a,{g:c},a),a},$i=a=>{Ds.unregister(a)},Ir(i))}var Ni={};function ci(i){for(;i.length;){var a=i.pop();i.pop()(a)}}function di(i){return this.fromWireType(Oe[i>>2])}var Ar={},Bi={};function tn(i,a,c){function v(O){O=c(O),O.length!==i.length&&Fi("Mismatched type converter count");for(var N=0;N<i.length;++N)bn(i[N],O[N])}i.forEach(function(O){Bi[O]=a});var y=Array(a.length),k=[],C=0;a.forEach((O,N)=>{ir.hasOwnProperty(O)?y[N]=ir[O]:(k.push(O),Ar.hasOwnProperty(O)||(Ar[O]=[]),Ar[O].push(()=>{y[N]=ir[O],++C,C===k.length&&v(y)}))}),k.length===0&&v(y)}function Wi(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function Uu(i,a,c={}){var v=a.name;if(i||We(`type "${v}" must have a positive integer typeid pointer`),ir.hasOwnProperty(i)){if(c.$b)return;We(`Cannot register type '${v}' twice`)}ir[i]=a,delete Bi[i],Ar.hasOwnProperty(i)&&(a=Ar[i],delete Ar[i],a.forEach(y=>y()))}function bn(i,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Uu(i,a,c)}function $s(i){We(i.g.u.i.name+" instance already deleted")}function Vn(){}function Fs(i,a,c){if(i[a].B===void 0){var v=i[a];i[a]=function(){return i[a].B.hasOwnProperty(arguments.length)||We(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[a].B})!`),i[a].B[arguments.length].apply(this,arguments)},i[a].B=[],i[a].B[v.ea]=v}}function Us(i,a,c){g.hasOwnProperty(i)?((c===void 0||g[i].B!==void 0&&g[i].B[c]!==void 0)&&We(`Cannot register public name '${i}' twice`),Fs(g,i,i),g.hasOwnProperty(c)&&We(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),g[i].B[c]=a):(g[i]=a,c!==void 0&&(g[i].Pc=c))}function Nu(i,a,c,v,y,k,C,O){this.name=i,this.constructor=a,this.N=c,this.W=v,this.A=y,this.Ub=k,this.na=C,this.Pb=O,this.rb=[]}function Vi(i,a,c){for(;a!==c;)a.na||We(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),i=a.na(i),a=a.A;return i}function Bu(i,a){return a===null?(this.Na&&We(`null is not a valid ${this.name}`),0):(a.g||We(`Cannot pass "${Bs(a)}" as a ${this.name}`),a.g.o||We(`Cannot pass deleted object as a pointer of type ${this.name}`),Vi(a.g.o,a.g.u.i,this.i))}function Wu(i,a){if(a===null){if(this.Na&&We(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return i!==null&&i.push(this.W,c),c}return 0}if(a.g||We(`Cannot pass "${Bs(a)}" as a ${this.name}`),a.g.o||We(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&We(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Vi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&We("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:We(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var v=a.clone();c=this.oc(c,hn(function(){v.delete()})),i!==null&&i.push(this.W,c)}break;default:We("Unsupporting sharing policy")}return c}function Vu(i,a){return a===null?(this.Na&&We(`null is not a valid ${this.name}`),0):(a.g||We(`Cannot pass "${Bs(a)}" as a ${this.name}`),a.g.o||We(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&We(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Vi(a.g.o,a.g.u.i,this.i))}function Rn(i,a,c,v){this.name=i,this.i=a,this.Na=c,this.ta=v,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Wu:(this.toWireType=v?Bu:Vu,this.K=null)}function po(i,a,c){g.hasOwnProperty(i)||Fi("Replacing nonexistant public symbol"),g[i].B!==void 0&&c!==void 0?g[i].B[c]=a:(g[i]=a,g[i].ea=c)}var qi=[],go=i=>{var a=qi[i];return a||(i>=qi.length&&(qi.length=i+1),qi[i]=a=je.get(i)),a},qu=(i,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),i.includes("j")){var v=g["dynCall_"+i];v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)}else v=go(a).apply(null,c);return v}};function Bt(i,a){i=kt(i);var c=i.includes("j")?qu(i,a):go(a);return typeof c!="function"&&We(`unknown function pointer with signature ${i}: ${a}`),c}var _o=void 0;function On(i,a){function c(k){y[k]||ir[k]||(Bi[k]?Bi[k].forEach(c):(v.push(k),y[k]=!0))}var v=[],y={};throw a.forEach(c),new _o(`${i}: `+v.map(uo).join([", "]))}function zi(i,a,c,v,y){var k=a.length;2>k&&We("argTypes array size mismatch! Must at least get return value and 'this' types!");var C=a[1]!==null&&c!==null,O=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){O=!0;break}var N=a[0].name!=="void",x=k-2,ne=Array(x),re=[],fe=[];return function(){if(arguments.length!==x&&We(`function ${i} called with ${arguments.length} arguments, expected ${x} args!`),fe.length=0,re.length=C?2:1,re[0]=y,C){var P=a[1].toWireType(fe,this);re[1]=P}for(var ee=0;ee<x;++ee)ne[ee]=a[ee+2].toWireType(fe,arguments[ee]),re.push(ne[ee]);if(ee=v.apply(null,re),O)ci(fe);else for(var Y=C?1:2;Y<a.length;Y++){var Ve=Y===1?P:ne[Y-2];a[Y].K!==null&&a[Y].K(Ve)}return P=N?a[0].fromWireType(ee):void 0,P}}function Hi(i,a){for(var c=[],v=0;v<i;v++)c.push(oe[a+4*v>>2]);return c}function mo(i,a,c){return i instanceof Object||We(`${c} with invalid "this": ${i}`),i instanceof a.i.constructor||We(`${c} incompatible with "this" of type ${i.constructor.name}`),i.g.o||We(`cannot call emscripten binding method ${c} on deleted object`),Vi(i.g.o,i.g.u.i,a.i)}function Ns(i){i>=sn.h&&--sn.get(i).ub===0&&sn.Zb(i)}function zu(i,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?Ye:Ge)[v])};case 1:return function(v){return this.fromWireType((c?pt:Ct)[v>>1])};case 2:return function(v){return this.fromWireType((c?Oe:oe)[v>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function Bs(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Hu(i,a){switch(a){case 2:return function(c){return this.fromWireType(Fe[c>>2])};case 3:return function(c){return this.fromWireType(we[c>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Gu(i,a,c){switch(a){case 0:return c?function(v){return Ye[v]}:function(v){return Ge[v]};case 1:return c?function(v){return pt[v>>1]}:function(v){return Ct[v>>1]};case 2:return c?function(v){return Oe[v>>2]}:function(v){return oe[v>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var yo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Ku=(i,a)=>{for(var c=i>>1,v=c+a/2;!(c>=v)&&Ct[c];)++c;if(c<<=1,32<c-i&&yo)return yo.decode(Ge.subarray(i,c));for(c="",v=0;!(v>=a/2);++v){var y=pt[i+2*v>>1];if(y==0)break;c+=String.fromCharCode(y)}return c},Yu=(i,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*i.length?c/2:i.length;for(var y=0;y<c;++y)pt[a>>1]=i.charCodeAt(y),a+=2;return pt[a>>1]=0,a-v},Ju=i=>2*i.length,Xu=(i,a)=>{for(var c=0,v="";!(c>=a/4);){var y=Oe[i+4*c>>2];if(y==0)break;++c,65536<=y?(y-=65536,v+=String.fromCharCode(55296|y>>10,56320|y&1023)):v+=String.fromCharCode(y)}return v},Qu=(i,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var y=0;y<i.length;++y){var k=i.charCodeAt(y);if(55296<=k&&57343>=k){var C=i.charCodeAt(++y);k=65536+((k&1023)<<10)|C&1023}if(Oe[a>>2]=k,a+=4,a+4>c)break}return Oe[a>>2]=0,a-v},Zu=i=>{for(var a=0,c=0;c<i.length;++c){var v=i.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a},ec={};function Gi(i){var a=ec[i];return a===void 0?kt(i):a}var Ki=[];function tc(i){var a=Ki.length;return Ki.push(i),a}function nc(i,a){for(var c=Array(i),v=0;v<i;++v)c[v]=ui(oe[a+4*v>>2],"parameter "+v);return c}var bo=[],Ws=[],Vs={},wo=()=>{if(!qs){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:B||"./this.program"},a;for(a in Vs)Vs[a]===void 0?delete i[a]:i[a]=Vs[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);qs=c}return qs},qs,Yi=i=>i%4===0&&(i%100!==0||i%400===0),ko=[31,29,31,30,31,30,31,31,30,31,30,31],Eo=[31,28,31,30,31,30,31,31,30,31,30,31],rc=(i,a,c,v)=>{function y(P,ee,Y){for(P=typeof P=="number"?P.toString():P||"";P.length<ee;)P=Y[0]+P;return P}function k(P,ee){return y(P,ee,"0")}function C(P,ee){function Y(He){return 0>He?-1:0<He?1:0}var Ve;return(Ve=Y(P.getFullYear()-ee.getFullYear()))===0&&(Ve=Y(P.getMonth()-ee.getMonth()))===0&&(Ve=Y(P.getDate()-ee.getDate())),Ve}function O(P){switch(P.getDay()){case 0:return new Date(P.getFullYear()-1,11,29);case 1:return P;case 2:return new Date(P.getFullYear(),0,3);case 3:return new Date(P.getFullYear(),0,2);case 4:return new Date(P.getFullYear(),0,1);case 5:return new Date(P.getFullYear()-1,11,31);case 6:return new Date(P.getFullYear()-1,11,30)}}function N(P){var ee=P.ca;for(P=new Date(new Date(P.da+1900,0,1).getTime());0<ee;){var Y=P.getMonth(),Ve=(Yi(P.getFullYear())?ko:Eo)[Y];if(ee>Ve-P.getDate())ee-=Ve-P.getDate()+1,P.setDate(1),11>Y?P.setMonth(Y+1):(P.setMonth(0),P.setFullYear(P.getFullYear()+1));else{P.setDate(P.getDate()+ee);break}}return Y=new Date(P.getFullYear()+1,0,4),ee=O(new Date(P.getFullYear(),0,4)),Y=O(Y),0>=C(ee,P)?0>=C(Y,P)?P.getFullYear()+1:P.getFullYear():P.getFullYear()-1}var x=Oe[v+40>>2];v={wc:Oe[v>>2],vc:Oe[v+4>>2],Fa:Oe[v+8>>2],Sa:Oe[v+12>>2],Ga:Oe[v+16>>2],da:Oe[v+20>>2],R:Oe[v+24>>2],ca:Oe[v+28>>2],Rc:Oe[v+32>>2],uc:Oe[v+36>>2],xc:x&&x?nt(Ge,x):""},c=c?nt(Ge,c):"",x={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ne in x)c=c.replace(new RegExp(ne,"g"),x[ne]);var re="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),fe="January February March April May June July August September October November December".split(" ");x={"%a":P=>re[P.R].substring(0,3),"%A":P=>re[P.R],"%b":P=>fe[P.Ga].substring(0,3),"%B":P=>fe[P.Ga],"%C":P=>k((P.da+1900)/100|0,2),"%d":P=>k(P.Sa,2),"%e":P=>y(P.Sa,2," "),"%g":P=>N(P).toString().substring(2),"%G":P=>N(P),"%H":P=>k(P.Fa,2),"%I":P=>(P=P.Fa,P==0?P=12:12<P&&(P-=12),k(P,2)),"%j":P=>{for(var ee=0,Y=0;Y<=P.Ga-1;ee+=(Yi(P.da+1900)?ko:Eo)[Y++]);return k(P.Sa+ee,3)},"%m":P=>k(P.Ga+1,2),"%M":P=>k(P.vc,2),"%n":()=>`
`,"%p":P=>0<=P.Fa&&12>P.Fa?"AM":"PM","%S":P=>k(P.wc,2),"%t":()=>"	","%u":P=>P.R||7,"%U":P=>k(Math.floor((P.ca+7-P.R)/7),2),"%V":P=>{var ee=Math.floor((P.ca+7-(P.R+6)%7)/7);if(2>=(P.R+371-P.ca-2)%7&&ee++,ee)ee==53&&(Y=(P.R+371-P.ca)%7,Y==4||Y==3&&Yi(P.da)||(ee=1));else{ee=52;var Y=(P.R+7-P.ca-1)%7;(Y==4||Y==5&&Yi(P.da%400-1))&&ee++}return k(ee,2)},"%w":P=>P.R,"%W":P=>k(Math.floor((P.ca+7-(P.R+6)%7)/7),2),"%y":P=>(P.da+1900).toString().substring(2),"%Y":P=>P.da+1900,"%z":P=>{P=P.uc;var ee=0<=P;return P=Math.abs(P)/60,(ee?"+":"-")+("0000"+(P/60*100+P%60)).slice(-4)},"%Z":P=>P.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(ne in x)c.includes(ne)&&(c=c.replace(new RegExp(ne,"g"),x[ne](v)));return c=c.replace(/\0\0/g,"%"),ne=Jt(c,!1),ne.length>a?0:(Ye.set(ne,i),ne.length-1)};function So(i,a,c,v){i||(i=this),this.parent=i,this.U=i.U,this.wa=null,this.id=Mu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=v}Object.defineProperties(So.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),no(),ri=Array(4096),eo(Se,"/"),cn("/tmp",16895,0),cn("/home",16895,0),cn("/home/web_user",16895,0),(()=>{cn("/dev",16895,0),js(259,{read:()=>0,write:(v,y,k,C)=>C}),Oi("/dev/null",259),jt(1280,Tt),jt(1536,Et),Oi("/dev/tty",1280),Oi("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=be(i).byteLength),i[--a]);ii("random",c),ii("urandom",c),cn("/dev/shm",16895,0),cn("/dev/shm/tmp",16895,0)})(),(()=>{cn("/proc",16895,0);var i=cn("/proc/self",16895,0);cn("/proc/self/fd",16895,0),eo({U:()=>{var a=Ja(i,"fd",16895,73);return a.l={ka:(c,v)=>{var y=Wn(+v);return c={parent:null,U:{nb:"fake"},l:{ma:()=>y.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(so.prototype,{get(i){return this.M[i]},has(i){return this.M[i]!==void 0},pa(i){var a=this.ib.pop()||this.M.length;return this.M[a]=i,a},Zb(i){this.M[i]=void 0,this.ib.push(i)}}),Sr=g.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},sn.M.push({value:void 0},{value:null},{value:!0},{value:!1}),sn.h=sn.M.length,g.count_emval_handles=function(){for(var i=0,a=sn.h;a<sn.M.length;++a)sn.M[a]!==void 0&&++i;return i},oo=g.PureVirtualError=ao("PureVirtualError");for(var Io=Array(256),Ji=0;256>Ji;++Ji)Io[Ji]=String.fromCharCode(Ji);lo=Io,g.getInheritedInstanceCount=function(){return Object.keys(jn).length},g.getLiveInheritedInstances=function(){var i=[],a;for(a in jn)jn.hasOwnProperty(a)&&i.push(jn[a]);return i},g.flushPendingDeletes=Ms,g.setDelayFunction=function(i){li=i,oi.length&&li&&li(Ms)},vo=g.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},Vn.prototype.isAliasOf=function(i){if(!(this instanceof Vn&&i instanceof Vn))return!1;var a=this.g.u.i,c=this.g.o,v=i.g.u.i;for(i=i.g.o;a.A;)c=a.na(c),a=a.A;for(;v.A;)i=v.na(i),v=v.A;return a===v&&c===i},Vn.prototype.clone=function(){if(this.g.o||$s(this),this.g.ia)return this.g.count.value+=1,this;var i=Ir,a=Object,c=a.create,v=Object.getPrototypeOf(this),y=this.g;return i=i(c.call(a,v,{g:{value:{count:y.count,fa:y.fa,ia:y.ia,o:y.o,u:y.u,G:y.G,L:y.L}}})),i.g.count.value+=1,i.g.fa=!1,i},Vn.prototype.delete=function(){this.g.o||$s(this),this.g.fa&&!this.g.ia&&We("Object already scheduled for deletion"),$i(this),co(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Vn.prototype.isDeleted=function(){return!this.g.o},Vn.prototype.deleteLater=function(){return this.g.o||$s(this),this.g.fa&&!this.g.ia&&We("Object already scheduled for deletion"),oi.push(this),oi.length===1&&li&&li(Ms),this.g.fa=!0,this},Rn.prototype.Vb=function(i){return this.sb&&(i=this.sb(i)),i},Rn.prototype.bb=function(i){this.W&&this.W(i)},Rn.prototype.argPackAdvance=8,Rn.prototype.readValueFromPointer=di,Rn.prototype.deleteObject=function(i){i!==null&&i.delete()},Rn.prototype.fromWireType=function(i){function a(){return this.ua?Ui(this.i.N,{u:this.nc,o:c,L:this,G:i}):Ui(this.i.N,{u:this,o:i})}var c=this.Vb(i);if(!c)return this.bb(i),null;var v=Fu(this.i,c);if(v!==void 0)return v.g.count.value===0?(v.g.o=c,v.g.G=i,v.clone()):(v=v.clone(),this.bb(i),v);if(v=this.i.Ub(c),v=fo[v],!v)return a.call(this);v=this.ta?v.Kb:v.pointerType;var y=ho(c,this.i,v.i);return y===null?a.call(this):this.ua?Ui(v.i.N,{u:v,o:y,L:this,G:i}):Ui(v.i.N,{u:v,o:y})},_o=g.UnboundTypeError=ao("UnboundTypeError");var Ao={__syscall_fcntl64:function(i,a,c){ai=c;try{var v=Wn(i);switch(a){case 0:var y=xn();return 0>y?-28:Za(v,y).X;case 1:case 2:return 0;case 3:return v.flags;case 4:return y=xn(),v.flags|=y,0;case 5:return y=xn(),pt[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Oe[Co()>>2]=28,-1;default:return-28}}catch(k){if(typeof rr>"u"||k.name!=="ErrnoError")throw k;return-k.aa}},__syscall_ioctl:function(i,a,c){ai=c;try{var v=Wn(i);switch(a){case 21509:return v.s?0:-59;case 21505:if(!v.s)return-59;if(v.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var y=xn();Oe[y>>2]=25856,Oe[y+4>>2]=5,Oe[y+8>>2]=191,Oe[y+12>>2]=35387;for(var k=0;32>k;k++)Ye[y+k+17>>0]=a[k]||0}return 0;case 21510:case 21511:case 21512:return v.s?0:-59;case 21506:case 21507:case 21508:if(!v.s)return-59;if(v.s.V.cc)for(y=xn(),a=[],k=0;32>k;k++)a.push(Ye[y+k+17>>0]);return 0;case 21519:return v.s?(y=xn(),Oe[y>>2]=0):-59;case 21520:return v.s?-28:-59;case 21531:if(y=xn(),!v.m.ac)throw new pe(59);return v.m.ac(v,a,y);case 21523:return v.s?(v.s.V.dc&&(k=[24,80],y=xn(),pt[y>>1]=k[0],pt[y+2>>1]=k[1]),0):-59;case 21524:return v.s?0:-59;case 21515:return v.s?0:-59;default:return-28}}catch(C){if(typeof rr>"u"||C.name!=="ErrnoError")throw C;return-C.aa}},__syscall_openat:function(i,a,c,v){ai=v;try{a=a?nt(Ge,a):"";var y=a;if(y.charAt(0)==="/")a=y;else{var k=i===-100?"/":Wn(i).path;if(y.length==0)throw new pe(44);a=I(k+"/"+y)}var C=v?xn():0;return Mi(a,c,C).X}catch(O){if(typeof rr>"u"||O.name!=="ErrnoError")throw O;return-O.aa}},_embind_create_inheriting_constructor:function(i,a,c){i=kt(i),a=ui(a,"wrapper"),c=dn(c);var v=[].slice,y=a.i,k=y.N,C=y.A.N,O=y.A.constructor;i=Di(i,function(){y.A.rb.forEach((function(x){if(this[x]===C[x])throw new oo(`Pure virtual function ${x} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:k}),this.__construct.apply(this,v.call(arguments))}),k.__construct=function(){this===k&&We("Pass correct 'this' to __construct");var x=O.implement.apply(void 0,[this].concat(v.call(arguments)));$i(x);var ne=x.g;x.notifyOnDestruction(),ne.ia=!0,Object.defineProperties(this,{g:{value:ne}}),Ir(this),x=ne.o,x=Ls(y,x),jn.hasOwnProperty(x)?We(`Tried to register registered instance: ${x}`):jn[x]=this},k.__destruct=function(){this===k&&We("Pass correct 'this' to __destruct"),$i(this);var x=this.g.o;x=Ls(y,x),jn.hasOwnProperty(x)?delete jn[x]:We(`Tried to unregister unregistered instance: ${x}`)},i.prototype=Object.create(k);for(var N in c)i.prototype[N]=c[N];return hn(i)},_embind_finalize_value_object:function(i){var a=Ni[i];delete Ni[i];var c=a.Pa,v=a.W,y=a.fb,k=y.map(C=>C.Yb).concat(y.map(C=>C.rc));tn([i],k,C=>{var O={};return y.forEach((N,x)=>{var ne=C[x],re=N.Wb,fe=N.Xb,P=C[x+y.length],ee=N.qc,Y=N.sc;O[N.Sb]={read:Ve=>ne.fromWireType(re(fe,Ve)),write:(Ve,He)=>{var ue=[];ee(Y,Ve,P.toWireType(ue,He)),ci(ue)}}}),[{name:a.name,fromWireType:function(N){var x={},ne;for(ne in O)x[ne]=O[ne].read(N);return v(N),x},toWireType:function(N,x){for(var ne in O)if(!(ne in x))throw new TypeError(`Missing field: "${ne}"`);var re=c();for(ne in O)O[ne].write(re,x[ne]);return N!==null&&N.push(v,re),re},argPackAdvance:8,readValueFromPointer:di,K:v}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,a,c,v,y){var k=Wi(c);a=kt(a),bn(i,{name:a,fromWireType:function(C){return!!C},toWireType:function(C,O){return O?v:y},argPackAdvance:8,readValueFromPointer:function(C){if(c===1)var O=Ye;else if(c===2)O=pt;else if(c===4)O=Oe;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(O[C>>k])},K:null})},_embind_register_class:function(i,a,c,v,y,k,C,O,N,x,ne,re,fe){ne=kt(ne),k=Bt(y,k),O&&(O=Bt(C,O)),x&&(x=Bt(N,x)),fe=Bt(re,fe);var P=io(ne);Us(P,function(){On(`Cannot construct ${ne} due to unbound types`,[v])}),tn([i,a,c],v?[v]:[],function(ee){if(ee=ee[0],v)var Y=ee.i,Ve=Y.N;else Ve=Vn.prototype;ee=Di(P,function(){if(Object.getPrototypeOf(this)!==He)throw new Sr("Use 'new' to construct "+ne);if(ue.$===void 0)throw new Sr(ne+" has no accessible constructor");var Ft=ue.$[arguments.length];if(Ft===void 0)throw new Sr(`Tried to invoke ctor of ${ne} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(ue.$).toString()}) parameters instead!`);return Ft.apply(this,arguments)});var He=Object.create(Ve,{constructor:{value:ee}});ee.prototype=He;var ue=new Nu(ne,ee,He,fe,Y,k,O,x);ue.A&&(ue.A.oa===void 0&&(ue.A.oa=[]),ue.A.oa.push(ue)),Y=new Rn(ne,ue,!0,!1),Ve=new Rn(ne+"*",ue,!1,!1);var yt=new Rn(ne+" const*",ue,!1,!0);return fo[i]={pointerType:Ve,Kb:yt},po(P,ee),[Y,Ve,yt]})},_embind_register_class_class_function:function(i,a,c,v,y,k,C){var O=Hi(c,v);a=kt(a),k=Bt(y,k),tn([],[i],function(N){function x(){On(`Cannot call ${ne} due to unbound types`,O)}N=N[0];var ne=`${N.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var re=N.i.constructor;return re[a]===void 0?(x.ea=c-1,re[a]=x):(Fs(re,a,ne),re[a].B[c-1]=x),tn([],O,function(fe){if(fe=zi(ne,[fe[0],null].concat(fe.slice(1)),null,k,C),re[a].B===void 0?(fe.ea=c-1,re[a]=fe):re[a].B[c-1]=fe,N.i.oa)for(const P of N.i.oa)P.constructor.hasOwnProperty(a)||(P.constructor[a]=fe);return[]}),[]})},_embind_register_class_class_property:function(i,a,c,v,y,k,C,O){a=kt(a),k=Bt(y,k),tn([],[i],function(N){N=N[0];var x=`${N.name}.${a}`,ne={get(){On(`Cannot access ${x} due to unbound types`,[c])},enumerable:!0,configurable:!0};return ne.set=O?()=>{On(`Cannot access ${x} due to unbound types`,[c])}:()=>{We(`${x} is a read-only property`)},Object.defineProperty(N.i.constructor,a,ne),tn([],[c],function(re){re=re[0];var fe={get(){return re.fromWireType(k(v))},enumerable:!0};return O&&(O=Bt(C,O),fe.set=P=>{var ee=[];O(v,re.toWireType(ee,P)),ci(ee)}),Object.defineProperty(N.i.constructor,a,fe),[]}),[]})},_embind_register_class_constructor:function(i,a,c,v,y,k){var C=Hi(a,c);y=Bt(v,y),tn([],[i],function(O){O=O[0];var N=`constructor ${O.name}`;if(O.i.$===void 0&&(O.i.$=[]),O.i.$[a-1]!==void 0)throw new Sr(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${O.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return O.i.$[a-1]=()=>{On(`Cannot construct ${O.name} due to unbound types`,C)},tn([],C,function(x){return x.splice(1,0,null),O.i.$[a-1]=zi(N,x,null,y,k),[]}),[]})},_embind_register_class_function:function(i,a,c,v,y,k,C,O){var N=Hi(c,v);a=kt(a),k=Bt(y,k),tn([],[i],function(x){function ne(){On(`Cannot call ${re} due to unbound types`,N)}x=x[0];var re=`${x.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),O&&x.i.rb.push(a);var fe=x.i.N,P=fe[a];return P===void 0||P.B===void 0&&P.className!==x.name&&P.ea===c-2?(ne.ea=c-2,ne.className=x.name,fe[a]=ne):(Fs(fe,a,re),fe[a].B[c-2]=ne),tn([],N,function(ee){return ee=zi(re,ee,x,k,C),fe[a].B===void 0?(ee.ea=c-2,fe[a]=ee):fe[a].B[c-2]=ee,[]}),[]})},_embind_register_class_property:function(i,a,c,v,y,k,C,O,N,x){a=kt(a),y=Bt(v,y),tn([],[i],function(ne){ne=ne[0];var re=`${ne.name}.${a}`,fe={get(){On(`Cannot access ${re} due to unbound types`,[c,C])},enumerable:!0,configurable:!0};return fe.set=N?()=>{On(`Cannot access ${re} due to unbound types`,[c,C])}:()=>{We(re+" is a read-only property")},Object.defineProperty(ne.i.N,a,fe),tn([],N?[c,C]:[c],function(P){var ee=P[0],Y={get(){var He=mo(this,ne,re+" getter");return ee.fromWireType(y(k,He))},enumerable:!0};if(N){N=Bt(O,N);var Ve=P[1];Y.set=function(He){var ue=mo(this,ne,re+" setter"),yt=[];N(x,ue,Ve.toWireType(yt,He)),ci(yt)}}return Object.defineProperty(ne.i.N,a,Y),[]}),[]})},_embind_register_emval:function(i,a){a=kt(a),bn(i,{name:a,fromWireType:function(c){var v=dn(c);return Ns(c),v},toWireType:function(c,v){return hn(v)},argPackAdvance:8,readValueFromPointer:di,K:null})},_embind_register_enum:function(i,a,c,v){function y(){}c=Wi(c),a=kt(a),y.values={},bn(i,{name:a,constructor:y,fromWireType:function(k){return this.constructor.values[k]},toWireType:function(k,C){return C.value},argPackAdvance:8,readValueFromPointer:zu(a,c,v),K:null}),Us(a,y)},_embind_register_enum_value:function(i,a,c){var v=ui(i,"enum");a=kt(a),i=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:Di(`${v.name}_${a}`,function(){})}}),i.values[c]=v,i[a]=v},_embind_register_float:function(i,a,c){c=Wi(c),a=kt(a),bn(i,{name:a,fromWireType:function(v){return v},toWireType:function(v,y){return y},argPackAdvance:8,readValueFromPointer:Hu(a,c),K:null})},_embind_register_function:function(i,a,c,v,y,k){var C=Hi(a,c);i=kt(i),y=Bt(v,y),Us(i,function(){On(`Cannot call ${i} due to unbound types`,C)},a-1),tn([],C,function(O){return po(i,zi(i,[O[0],null].concat(O.slice(1)),null,y,k),a-1),[]})},_embind_register_integer:function(i,a,c,v,y){a=kt(a),y===-1&&(y=4294967295),y=Wi(c);var k=O=>O;if(v===0){var C=32-8*c;k=O=>O<<C>>>C}c=a.includes("unsigned")?function(O,N){return N>>>0}:function(O,N){return N},bn(i,{name:a,fromWireType:k,toWireType:c,argPackAdvance:8,readValueFromPointer:Gu(a,y,v!==0),K:null})},_embind_register_memory_view:function(i,a,c){function v(k){k>>=2;var C=oe;return new y(C.buffer,C[k+1],C[k])}var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=kt(c),bn(i,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{$b:!0})},_embind_register_std_string:function(i,a){a=kt(a);var c=a==="std::string";bn(i,{name:a,fromWireType:function(v){var y=oe[v>>2],k=v+4;if(c)for(var C=k,O=0;O<=y;++O){var N=k+O;if(O==y||Ge[N]==0){if(C=C?nt(Ge,C,N-C):"",x===void 0)var x=C;else x+="\0",x+=C;C=N+1}}else{for(x=Array(y),O=0;O<y;++O)x[O]=String.fromCharCode(Ge[k+O]);x=x.join("")}return Mn(v),x},toWireType:function(v,y){y instanceof ArrayBuffer&&(y=new Uint8Array(y));var k=typeof y=="string";k||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Int8Array||We("Cannot pass non-string to std::string");var C=c&&k?gt(y):y.length,O=zs(4+C+1),N=O+4;if(oe[O>>2]=C,c&&k)en(y,Ge,N,C+1);else if(k)for(k=0;k<C;++k){var x=y.charCodeAt(k);255<x&&(Mn(N),We("String has UTF-16 code units that do not fit in 8 bits")),Ge[N+k]=x}else for(k=0;k<C;++k)Ge[N+k]=y[k];return v!==null&&v.push(Mn,O),O},argPackAdvance:8,readValueFromPointer:di,K:function(v){Mn(v)}})},_embind_register_std_wstring:function(i,a,c){if(c=kt(c),a===2)var v=Ku,y=Yu,k=Ju,C=()=>Ct,O=1;else a===4&&(v=Xu,y=Qu,k=Zu,C=()=>oe,O=2);bn(i,{name:c,fromWireType:function(N){for(var x=oe[N>>2],ne=C(),re,fe=N+4,P=0;P<=x;++P){var ee=N+4+P*a;(P==x||ne[ee>>O]==0)&&(fe=v(fe,ee-fe),re===void 0?re=fe:(re+="\0",re+=fe),fe=ee+a)}return Mn(N),re},toWireType:function(N,x){typeof x!="string"&&We(`Cannot pass non-string to C++ string type ${c}`);var ne=k(x),re=zs(4+ne+a);return oe[re>>2]=ne>>O,y(x,re+4,ne+a),N!==null&&N.push(Mn,re),re},argPackAdvance:8,readValueFromPointer:di,K:function(N){Mn(N)}})},_embind_register_value_object:function(i,a,c,v,y,k){Ni[i]={name:kt(a),Pa:Bt(c,v),W:Bt(y,k),fb:[]}},_embind_register_value_object_field:function(i,a,c,v,y,k,C,O,N,x){Ni[i].fb.push({Sb:kt(a),Yb:c,Wb:Bt(v,y),Xb:k,rc:C,qc:Bt(O,N),sc:x})},_embind_register_void:function(i,a){a=kt(a),bn(i,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(i,a,c){i=dn(i),a=ui(a,"emval::as");var v=[],y=hn(v);return oe[c>>2]=y,a.toWireType(v,i)},_emval_call_method:function(i,a,c,v,y){i=Ki[i],a=dn(a),c=Gi(c);var k=[];return oe[v>>2]=hn(k),i(a,c,k,y)},_emval_call_void_method:function(i,a,c,v){i=Ki[i],a=dn(a),c=Gi(c),i(a,c,null,v)},_emval_decref:Ns,_emval_get_method_caller:function(i,a){var c=nc(i,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(C){return C.name}).join("_")+"$";var y=bo[a];if(y!==void 0)return y;var k=Array(i-1);return y=tc((C,O,N,x)=>{for(var ne=0,re=0;re<i-1;++re)k[re]=c[re+1].readValueFromPointer(x+ne),ne+=c[re+1].argPackAdvance;for(C=C[O].apply(C,k),re=0;re<i-1;++re)c[re+1].Nb&&c[re+1].Nb(k[re]);if(!v.fc)return v.toWireType(N,C)}),bo[a]=y},_emval_get_module_property:function(i){return i=Gi(i),hn(g[i])},_emval_get_property:function(i,a){return i=dn(i),a=dn(a),hn(i[a])},_emval_incref:function(i){4<i&&(sn.get(i).ub+=1)},_emval_new_array:function(){return hn([])},_emval_new_cstring:function(i){return hn(Gi(i))},_emval_new_object:function(){return hn({})},_emval_run_destructors:function(i){var a=dn(i);ci(a),Ns(i)},_emval_set_property:function(i,a,c){i=dn(i),a=dn(a),c=dn(c),i[a]=c},_emval_take_value:function(i,a){return i=ui(i,"_emval_take_value"),i=i.readValueFromPointer(a),hn(i)},abort:()=>{ut("")},emscripten_asm_const_int:(i,a,c)=>{Ws.length=0;var v;for(c>>=2;v=Ge[a++];)c+=v!=105&c,Ws.push(v==105?Oe[c]:we[c++>>1]),++c;return o[i].apply(null,Ws)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(i,a,c)=>Ge.copyWithin(i,a,a+c),emscripten_resize_heap:i=>{var a=Ge.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,i+100663296);var y=Math;v=Math.max(i,v);e:{y=y.min.call(y,2147483648,v+(65536-v%65536)%65536)-me.buffer.byteLength+65535>>>16;try{me.grow(y),Ue();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},environ_get:(i,a)=>{var c=0;return wo().forEach(function(v,y){var k=a+c;for(y=oe[i+4*y>>2]=k,k=0;k<v.length;++k)Ye[y++>>0]=v.charCodeAt(k);Ye[y>>0]=0,c+=v.length+1}),0},environ_sizes_get:(i,a)=>{var c=wo();oe[i>>2]=c.length;var v=0;return c.forEach(function(y){v+=y.length+1}),oe[a>>2]=v,0},fd_close:function(i){try{var a=Wn(i);if(a.X===null)throw new pe(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{xi[a.X]=null}return a.X=null,0}catch(c){if(typeof rr>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(i,a,c,v){try{e:{var y=Wn(i);i=a;for(var k,C=a=0;C<c;C++){var O=oe[i>>2],N=oe[i+4>>2];i+=8;var x=y,ne=O,re=N,fe=k,P=Ye;if(0>re||0>fe)throw new pe(28);if(x.X===null)throw new pe(8);if((x.flags&2097155)===1)throw new pe(8);if((x.node.mode&61440)===16384)throw new pe(31);if(!x.m.read)throw new pe(28);var ee=typeof fe<"u";if(!ee)fe=x.position;else if(!x.seekable)throw new pe(70);var Y=x.m.read(x,P,ne,re,fe);ee||(x.position+=Y);var Ve=Y;if(0>Ve){var He=-1;break e}if(a+=Ve,Ve<N)break;typeof k<"u"&&(k+=Ve)}He=a}return oe[v>>2]=He,0}catch(ue){if(typeof rr>"u"||ue.name!=="ErrnoError")throw ue;return ue.aa}},fd_seek:function(i,a,c,v,y){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var k=Wn(i);return to(k,a,v),p=[k.position>>>0,(Ce=k.position,1<=+Math.abs(Ce)?0<Ce?+Math.floor(Ce/4294967296)>>>0:~~+Math.ceil((Ce-+(~~Ce>>>0))/4294967296)>>>0:0)],Oe[y>>2]=p[0],Oe[y+4>>2]=p[1],k.Ma&&a===0&&v===0&&(k.Ma=null),0}catch(C){if(typeof rr>"u"||C.name!=="ErrnoError")throw C;return C.aa}},fd_write:function(i,a,c,v){try{e:{var y=Wn(i);i=a;for(var k,C=a=0;C<c;C++){var O=oe[i>>2],N=oe[i+4>>2];i+=8;var x=y,ne=O,re=N,fe=k,P=Ye;if(0>re||0>fe)throw new pe(28);if(x.X===null)throw new pe(8);if((x.flags&2097155)===0)throw new pe(8);if((x.node.mode&61440)===16384)throw new pe(31);if(!x.m.write)throw new pe(28);x.seekable&&x.flags&1024&&to(x,0,2);var ee=typeof fe<"u";if(!ee)fe=x.position;else if(!x.seekable)throw new pe(70);var Y=x.m.write(x,P,ne,re,fe,void 0);ee||(x.position+=Y);var Ve=Y;if(0>Ve){var He=-1;break e}a+=Ve,typeof k<"u"&&(k+=Ve)}He=a}return oe[v>>2]=He,0}catch(ue){if(typeof rr>"u"||ue.name!=="ErrnoError")throw ue;return ue.aa}},strftime_l:(i,a,c,v)=>rc(i,a,c,v)};(function(){function i(c){if(ve=c=c.exports,me=ve.memory,Ue(),je=ve.__indirect_function_table,Ie.unshift(ve.__wasm_call_ctors),xe--,g.monitorRunDependencies&&g.monitorRunDependencies(xe),xe==0&&ht){var v=ht;ht=null,v()}return c}var a={env:Ao,wasi_snapshot_preview1:Ao};if(xe++,g.monitorRunDependencies&&g.monitorRunDependencies(xe),g.instantiateWasm)try{return g.instantiateWasm(a,i)}catch(c){Pe("Module.instantiateWasm callback failed with error: "+c),$(c)}return De(a,function(c){i(c.instance)}).catch($),{}})();var Mn=i=>(Mn=ve.free)(i),zs=i=>(zs=ve.malloc)(i),Co=()=>(Co=ve.__errno_location)(),To=g._ma_device__on_notification_unlocked=i=>(To=g._ma_device__on_notification_unlocked=ve.ma_device__on_notification_unlocked)(i);g._ma_malloc_emscripten=(i,a)=>(g._ma_malloc_emscripten=ve.ma_malloc_emscripten)(i,a),g._ma_free_emscripten=(i,a)=>(g._ma_free_emscripten=ve.ma_free_emscripten)(i,a);var Po=g._ma_device_process_pcm_frames_capture__webaudio=(i,a,c)=>(Po=g._ma_device_process_pcm_frames_capture__webaudio=ve.ma_device_process_pcm_frames_capture__webaudio)(i,a,c),xo=g._ma_device_process_pcm_frames_playback__webaudio=(i,a,c)=>(xo=g._ma_device_process_pcm_frames_playback__webaudio=ve.ma_device_process_pcm_frames_playback__webaudio)(i,a,c),jo=i=>(jo=ve.__getTypeName)(i);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=ve._embind_initialize_bindings)(),g.dynCall_iiji=(i,a,c,v,y)=>(g.dynCall_iiji=ve.dynCall_iiji)(i,a,c,v,y),g.dynCall_jiji=(i,a,c,v,y)=>(g.dynCall_jiji=ve.dynCall_jiji)(i,a,c,v,y),g.dynCall_iiiji=(i,a,c,v,y,k)=>(g.dynCall_iiiji=ve.dynCall_iiiji)(i,a,c,v,y,k),g.dynCall_iij=(i,a,c,v)=>(g.dynCall_iij=ve.dynCall_iij)(i,a,c,v),g.dynCall_jii=(i,a,c)=>(g.dynCall_jii=ve.dynCall_jii)(i,a,c),g.dynCall_viijii=(i,a,c,v,y,k,C)=>(g.dynCall_viijii=ve.dynCall_viijii)(i,a,c,v,y,k,C),g.dynCall_iiiiij=(i,a,c,v,y,k,C)=>(g.dynCall_iiiiij=ve.dynCall_iiiiij)(i,a,c,v,y,k,C),g.dynCall_iiiiijj=(i,a,c,v,y,k,C,O,N)=>(g.dynCall_iiiiijj=ve.dynCall_iiiiijj)(i,a,c,v,y,k,C,O,N),g.dynCall_iiiiiijj=(i,a,c,v,y,k,C,O,N,x)=>(g.dynCall_iiiiiijj=ve.dynCall_iiiiiijj)(i,a,c,v,y,k,C,O,N,x);var Xi;ht=function i(){Xi||Ro(),Xi||(ht=i)};function Ro(){function i(){if(!Xi&&(Xi=!0,g.calledRun=!0,!dt)){if(g.noFSInit||ro||(ro=!0,no(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?ii("stdin",g.stdin):Rs("/dev/tty","/dev/stdin"),g.stdout?ii("stdout",null,g.stdout):Rs("/dev/tty","/dev/stdout"),g.stderr?ii("stderr",null,g.stderr):Rs("/dev/tty1","/dev/stderr"),Mi("/dev/stdin",0),Mi("/dev/stdout",1),Mi("/dev/stderr",1)),Ga=!1,d(Ie),A(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var a=g.postRun.shift();he.unshift(a)}d(he)}}if(!(0<xe)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Be();d(ke),0<xe||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),i()},1)):i())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Ro(),E.ready})})();const m=_}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>_.Animation});var _=f(4)}),((u,h,f)=>{f.r(h),f.d(h,{Animation:()=>_});var _=(function(){function m(w,E,g,A){this.animation=w,this.artboard=E,this.playing=A,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(w,E)}return Object.defineProperty(m.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"time",{get:function(){return this.instance.time},set:function(w){this.instance.time=w},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),m.prototype.advance=function(w){this.scrubTo===null?this.instance.advance(w):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},m.prototype.apply=function(w){this.instance.apply(w)},m.prototype.cleanup=function(){this.instance.delete()},m})()}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>w.AudioAssetWrapper,AudioWrapper:()=>w.AudioWrapper,BLANK_URL:()=>m.BLANK_URL,CustomFileAssetLoaderWrapper:()=>w.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>w.FileAssetWrapper,Finalizable:()=>w.Finalizable,FontAssetWrapper:()=>w.FontAssetWrapper,FontWrapper:()=>w.FontWrapper,ImageAssetWrapper:()=>w.ImageAssetWrapper,ImageWrapper:()=>w.ImageWrapper,finalizationRegistry:()=>w.finalizationRegistry,registerTouchInteractions:()=>_.registerTouchInteractions,sanitizeUrl:()=>m.sanitizeUrl});var _=f(6),m=f(7),w=f(8)}),((u,h,f)=>{f.r(h),f.d(h,{registerTouchInteractions:()=>w});var _=void 0,m=function(E,g){var A,$;return["touchstart","touchmove"].indexOf(E.type)>-1&&(!((A=E.touches)===null||A===void 0)&&A.length)?(g||E.preventDefault(),{clientX:E.touches[0].clientX,clientY:E.touches[0].clientY}):E.type==="touchend"&&(!(($=E.changedTouches)===null||$===void 0)&&$.length)?{clientX:E.changedTouches[0].clientX,clientY:E.changedTouches[0].clientY}:{clientX:E.clientX,clientY:E.clientY}},w=function(E){var g=E.canvas,A=E.artboard,$=E.stateMachines,j=$===void 0?[]:$,F=E.renderer,W=E.rive,U=E.fit,z=E.alignment,J=E.isTouchScrollEnabled,L=J===void 0?!1:J,B=E.layoutScaleFactor,le=B===void 0?1:B;if(!g||!j.length||!F||!W||!A||typeof window>"u")return null;var te=null,ye=!1,X=function(ge){if(ye&&ge instanceof MouseEvent){ge.type=="mouseup"&&(ye=!1);return}ye=L&&ge.type==="touchend"&&te==="touchstart",te=ge.type;var Pe=ge.currentTarget.getBoundingClientRect(),de=m(ge,L),me=de.clientX,ve=de.clientY;if(!(!me&&!ve)){var dt=me-Pe.left,Ye=ve-Pe.top,Ge=W.computeAlignment(U,z,{minX:0,minY:0,maxX:Pe.width,maxY:Pe.height},A.bounds,le),pt=new W.Mat2D;Ge.invert(pt);var Ct=new W.Vec2D(dt,Ye),Oe=W.mapXY(pt,Ct),oe=Oe.x(),Fe=Oe.y();switch(Oe.delete(),pt.delete(),Ct.delete(),Ge.delete(),ge.type){case"mouseout":for(var we=0,Ue=j;we<Ue.length;we++){var je=Ue[we];je.pointerMove(oe,Fe)}break;case"touchmove":case"mouseover":case"mousemove":{for(var ke=0,Ie=j;ke<Ie.length;ke++){var je=Ie[ke];je.pointerMove(oe,Fe)}break}case"touchstart":case"mousedown":{for(var he=0,Be=j;he<Be.length;he++){var je=Be[he];je.pointerDown(oe,Fe)}break}case"touchend":case"mouseup":{for(var xe=0,ht=j;xe<ht.length;xe++){var je=ht[xe];je.pointerUp(oe,Fe)}break}}}},Q=X.bind(_);return g.addEventListener("mouseover",Q),g.addEventListener("mouseout",Q),g.addEventListener("mousemove",Q),g.addEventListener("mousedown",Q),g.addEventListener("mouseup",Q),g.addEventListener("touchmove",Q,{passive:L}),g.addEventListener("touchstart",Q,{passive:L}),g.addEventListener("touchend",Q),function(){g.removeEventListener("mouseover",Q),g.removeEventListener("mouseout",Q),g.removeEventListener("mousemove",Q),g.removeEventListener("mousedown",Q),g.removeEventListener("mouseup",Q),g.removeEventListener("touchmove",Q),g.removeEventListener("touchstart",Q),g.removeEventListener("touchend",Q)}}}),((u,h,f)=>{f.r(h),f.d(h,{BLANK_URL:()=>$,sanitizeUrl:()=>W});var _=/^([^\w]*)(javascript|data|vbscript)/im,m=/&#(\w+)(^\w|;)?/g,w=/&(newline|tab);/gi,E=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,A=[".","/"],$="about:blank";function j(U){return A.indexOf(U[0])>-1}function F(U){var z=U.replace(E,"");return z.replace(m,function(J,L){return String.fromCharCode(L)})}function W(U){if(!U)return $;var z=F(U).replace(w,"").replace(E,"").trim();if(!z)return $;if(j(z))return z;var J=z.match(g);if(!J)return z;var L=J[0];return _.test(L)?$:z}}),((u,h,f)=>{f.r(h),f.d(h,{AudioAssetWrapper:()=>F,AudioWrapper:()=>E,CustomFileAssetLoaderWrapper:()=>A,FileAssetWrapper:()=>$,Finalizable:()=>m,FontAssetWrapper:()=>W,FontWrapper:()=>g,ImageAssetWrapper:()=>j,ImageWrapper:()=>w,finalizationRegistry:()=>J});var _=(function(){var L=function(B,le){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(te,ye){te.__proto__=ye}||function(te,ye){for(var X in ye)Object.prototype.hasOwnProperty.call(ye,X)&&(te[X]=ye[X])},L(B,le)};return function(B,le){if(typeof le!="function"&&le!==null)throw new TypeError("Class extends value "+String(le)+" is not a constructor or null");L(B,le);function te(){this.constructor=B}B.prototype=le===null?Object.create(le):(te.prototype=le.prototype,new te)}})(),m=(function(){function L(){this.selfUnref=!1}return L})(),w=(function(L){_(B,L);function B(le){var te=L.call(this)||this;return te._nativeImage=le,te}return Object.defineProperty(B.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},B})(m),E=(function(L){_(B,L);function B(le){var te=L.call(this)||this;return te._nativeAudio=le,te}return Object.defineProperty(B.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},B})(m),g=(function(L){_(B,L);function B(le){var te=L.call(this)||this;return te._nativeFont=le,te}return Object.defineProperty(B.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),B.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},B})(m),A=(function(){function L(B,le){this._assetLoaderCallback=le,this.assetLoader=new B.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return L.prototype.loadContents=function(B,le){var te;return B.isImage?te=new j(B):B.isAudio?te=new F(B):B.isFont&&(te=new W(B)),this._assetLoaderCallback(te,le)},L})(),$=(function(){function L(B){this._nativeFileAsset=B}return L.prototype.decode=function(B){this._nativeFileAsset.decode(B)},Object.defineProperty(L.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),L})(),j=(function(L){_(B,L);function B(){return L!==null&&L.apply(this,arguments)||this}return B.prototype.setRenderImage=function(le){this._nativeFileAsset.setRenderImage(le.nativeImage)},B})($),F=(function(L){_(B,L);function B(){return L!==null&&L.apply(this,arguments)||this}return B.prototype.setAudioSource=function(le){this._nativeFileAsset.setAudioSource(le.nativeAudio)},B})($),W=(function(L){_(B,L);function B(){return L!==null&&L.apply(this,arguments)||this}return B.prototype.setFont=function(le){this._nativeFileAsset.setFont(le.nativeFont)},B})($),U=(function(){function L(B){}return L.prototype.register=function(B){B.selfUnref=!0},L.prototype.unregister=function(B){},L})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:U,J=new z(function(L){L.unref()})})],r={};function s(u){var h=r[u];if(h!==void 0)return h.exports;var f=r[u]={exports:{}};return t[u](f,f.exports,s),f.exports}s.d=(u,h)=>{for(var f in h)s.o(h,f)&&!s.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},s.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{s.r(l),s.d(l,{Alignment:()=>W,DataEnum:()=>Fe,EventType:()=>X,Fit:()=>F,Layout:()=>U,LoopType:()=>Q,Rive:()=>Oe,RiveEventType:()=>B,RiveFile:()=>Ct,RuntimeLoader:()=>z,StateMachineInput:()=>L,StateMachineInputType:()=>J,Testing:()=>ie,ViewModel:()=>oe,ViewModelInstance:()=>Ue,ViewModelInstanceArtboard:()=>H,ViewModelInstanceAssetImage:()=>ct,ViewModelInstanceBoolean:()=>he,ViewModelInstanceColor:()=>ut,ViewModelInstanceEnum:()=>xe,ViewModelInstanceList:()=>ht,ViewModelInstanceNumber:()=>Ie,ViewModelInstanceString:()=>ke,ViewModelInstanceTrigger:()=>Be,ViewModelInstanceValue:()=>je,decodeAudio:()=>Ee,decodeFont:()=>Ce,decodeImage:()=>De});var u=s(1),h=s(2),f=s(3),_=s(5),m=(function(){var p=function(o,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,I){b.__proto__=I}||function(b,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(b[M]=I[M])},p(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(o,d);function b(){this.constructor=o}o.prototype=d===null?Object.create(d):(b.prototype=d.prototype,new b)}})(),w=function(){return w=Object.assign||function(p){for(var o,d=1,b=arguments.length;d<b;d++){o=arguments[d];for(var I in o)Object.prototype.hasOwnProperty.call(o,I)&&(p[I]=o[I])}return p},w.apply(this,arguments)},E=function(p,o,d,b){function I(M){return M instanceof d?M:new d(function(V){V(M)})}return new(d||(d=Promise))(function(M,V){function ae(ze){try{_e(b.next(ze))}catch(nt){V(nt)}}function be(ze){try{_e(b.throw(ze))}catch(nt){V(nt)}}function _e(ze){ze.done?M(ze.value):I(ze.value).then(ae,be)}_e((b=b.apply(p,o||[])).next())})},g=function(p,o){var d={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},b,I,M,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=ae(0),V.throw=ae(1),V.return=ae(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function ae(_e){return function(ze){return be([_e,ze])}}function be(_e){if(b)throw new TypeError("Generator is already executing.");for(;V&&(V=0,_e[0]&&(d=0)),d;)try{if(b=1,I&&(M=_e[0]&2?I.return:_e[0]?I.throw||((M=I.return)&&M.call(I),0):I.next)&&!(M=M.call(I,_e[1])).done)return M;switch(I=0,M&&(_e=[_e[0]&2,M.value]),_e[0]){case 0:case 1:M=_e;break;case 4:return d.label++,{value:_e[1],done:!1};case 5:d.label++,I=_e[1],_e=[0];continue;case 7:_e=d.ops.pop(),d.trys.pop();continue;default:if(M=d.trys,!(M=M.length>0&&M[M.length-1])&&(_e[0]===6||_e[0]===2)){d=0;continue}if(_e[0]===3&&(!M||_e[1]>M[0]&&_e[1]<M[3])){d.label=_e[1];break}if(_e[0]===6&&d.label<M[1]){d.label=M[1],M=_e;break}if(M&&d.label<M[2]){d.label=M[2],d.ops.push(_e);break}M[2]&&d.ops.pop(),d.trys.pop();continue}_e=o.call(p,d)}catch(ze){_e=[6,ze],I=0}finally{b=M=0}if(_e[0]&5)throw _e[1];return{value:_e[0]?_e[1]:void 0,done:!0}}},A=function(p,o,d){if(d||arguments.length===2)for(var b=0,I=o.length,M;b<I;b++)(M||!(b in o))&&(M||(M=Array.prototype.slice.call(o,0,b)),M[b]=o[b]);return p.concat(M||Array.prototype.slice.call(o))},$=(function(p){m(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),j=function(p){return p&&p.isHandledError?p.message:"Problem loading file; may be corrupt!"},F;(function(p){p.Cover="cover",p.Contain="contain",p.Fill="fill",p.FitWidth="fitWidth",p.FitHeight="fitHeight",p.None="none",p.ScaleDown="scaleDown",p.Layout="layout"})(F||(F={}));var W;(function(p){p.Center="center",p.TopLeft="topLeft",p.TopCenter="topCenter",p.TopRight="topRight",p.CenterLeft="centerLeft",p.CenterRight="centerRight",p.BottomLeft="bottomLeft",p.BottomCenter="bottomCenter",p.BottomRight="bottomRight"})(W||(W={}));var U=(function(){function p(o){var d,b,I,M,V,ae,be;this.fit=(d=o?.fit)!==null&&d!==void 0?d:F.Contain,this.alignment=(b=o?.alignment)!==null&&b!==void 0?b:W.Center,this.layoutScaleFactor=(I=o?.layoutScaleFactor)!==null&&I!==void 0?I:1,this.minX=(M=o?.minX)!==null&&M!==void 0?M:0,this.minY=(V=o?.minY)!==null&&V!==void 0?V:0,this.maxX=(ae=o?.maxX)!==null&&ae!==void 0?ae:0,this.maxY=(be=o?.maxY)!==null&&be!==void 0?be:0}return p.new=function(o){var d=o.fit,b=o.alignment,I=o.minX,M=o.minY,V=o.maxX,ae=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new p({fit:d,alignment:b,minX:I,minY:M,maxX:V,maxY:ae})},p.prototype.copyWith=function(o){var d=o.fit,b=o.alignment,I=o.layoutScaleFactor,M=o.minX,V=o.minY,ae=o.maxX,be=o.maxY;return new p({fit:d??this.fit,alignment:b??this.alignment,layoutScaleFactor:I??this.layoutScaleFactor,minX:M??this.minX,minY:V??this.minY,maxX:ae??this.maxX,maxY:be??this.maxY})},p.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===F.Cover?d=o.Fit.cover:this.fit===F.Contain?d=o.Fit.contain:this.fit===F.Fill?d=o.Fit.fill:this.fit===F.FitWidth?d=o.Fit.fitWidth:this.fit===F.FitHeight?d=o.Fit.fitHeight:this.fit===F.ScaleDown?d=o.Fit.scaleDown:this.fit===F.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},p.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===W.TopLeft?d=o.Alignment.topLeft:this.alignment===W.TopCenter?d=o.Alignment.topCenter:this.alignment===W.TopRight?d=o.Alignment.topRight:this.alignment===W.CenterLeft?d=o.Alignment.centerLeft:this.alignment===W.CenterRight?d=o.Alignment.centerRight:this.alignment===W.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===W.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===W.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},p})(),z=(function(){function p(){}return p.loadRuntime=function(){u.default({locateFile:function(){return p.wasmURL}}).then(function(o){var d;for(p.runtime=o;p.callBackQueue.length>0;)(d=p.callBackQueue.shift())===null||d===void 0||d(p.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var b="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(p.wasmURL.toLowerCase()!==b)console.warn("Failed to load WASM from ".concat(p.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),p.setWasmUrl(b),p.loadRuntime();else{var I=["Could not load Rive WASM file from ".concat(p.wasmURL," or ").concat(b,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(I)}})},p.getInstance=function(o){p.isLoading||(p.isLoading=!0,p.loadRuntime()),p.runtime?o(p.runtime):p.callBackQueue.push(o)},p.awaitInstance=function(){return new Promise(function(o){return p.getInstance(function(d){return o(d)})})},p.setWasmUrl=function(o){p.wasmURL=o},p.getWasmUrl=function(){return p.wasmURL},p.isLoading=!1,p.callBackQueue=[],p.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),p})(),J;(function(p){p[p.Number=56]="Number",p[p.Trigger=58]="Trigger",p[p.Boolean=59]="Boolean"})(J||(J={}));var L=(function(){function p(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(p.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),p.prototype.fire=function(){this.type===J.Trigger&&this.runtimeInput.fire()},p.prototype.delete=function(){this.runtimeInput=null},p})(),B;(function(p){p[p.General=128]="General",p[p.OpenUrl=131]="OpenUrl"})(B||(B={}));var le=(function(){function p(o){this.nativeArtboard=o}return p})(),te=(function(){function p(o,d,b,I){this.stateMachine=o,this.playing=b,this.artboard=I,this.inputs=[],this.instance=new d.StateMachineInstance(o,I),this.initInputs(d)}return Object.defineProperty(p.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),p.prototype.advance=function(o){this.instance.advance(o)},p.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},p.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},p.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},p.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var b=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(b,o))}},p.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new L(J.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new L(J.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new L(J.Trigger,o.asTrigger())},p.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},p.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},p})(),ye=(function(){function p(o,d,b,I,M){I===void 0&&(I=[]),M===void 0&&(M=[]),this.runtime=o,this.artboard=d,this.eventManager=b,this.animations=I,this.stateMachines=M}return p.prototype.add=function(o,d,b){if(b===void 0&&(b=!0),o=q(o),o.length===0)this.animations.forEach(function(gt){return gt.playing=d}),this.stateMachines.forEach(function(gt){return gt.playing=d});else for(var I=this.animations.map(function(gt){return gt.name}),M=this.stateMachines.map(function(gt){return gt.name}),V=0;V<o.length;V++){var ae=I.indexOf(o[V]),be=M.indexOf(o[V]);if(ae>=0||be>=0)ae>=0?this.animations[ae].playing=d:this.stateMachines[be].playing=d;else{var _e=this.artboard.animationByName(o[V]);if(_e){var ze=new f.Animation(_e,this.artboard,this.runtime,d);ze.advance(0),ze.apply(1),this.animations.push(ze)}else{var nt=this.artboard.stateMachineByName(o[V]);if(nt){var It=new te(nt,this.runtime,d,this.artboard);this.stateMachines.push(It)}}}}return b&&(d?this.eventManager.fire({type:X.Play,data:this.playing}):this.eventManager.fire({type:X.Pause,data:this.paused})),d?this.playing:this.paused},p.prototype.initLinearAnimations=function(o,d){for(var b=this.animations.map(function(be){return be.name}),I=0;I<o.length;I++){var M=b.indexOf(o[I]);if(M>=0)this.animations[M].playing=d;else{var V=this.artboard.animationByName(o[I]);if(V){var ae=new f.Animation(V,this.artboard,this.runtime,d);ae.advance(0),ae.apply(1),this.animations.push(ae)}else console.error("Animation with name ".concat(o[I]," not found."))}}},p.prototype.initStateMachines=function(o,d){for(var b=this.stateMachines.map(function(be){return be.name}),I=0;I<o.length;I++){var M=b.indexOf(o[I]);if(M>=0)this.stateMachines[M].playing=d;else{var V=this.artboard.stateMachineByName(o[I]);if(V){var ae=new te(V,this.runtime,d,this.artboard);this.stateMachines.push(ae),d||ae.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[I]," not found.")),this.initLinearAnimations([o[I]],d)}}},p.prototype.play=function(o){return this.add(o,!0)},p.prototype.pause=function(o){return this.add(o,!1)},p.prototype.scrub=function(o,d){var b=this.animations.filter(function(I){return o.includes(I.name)});return b.forEach(function(I){return I.scrubTo=d}),b.map(function(I){return I.name})},Object.defineProperty(p.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),p.prototype.stop=function(o){var d=this;o=q(o);var b=[];if(o.length===0)b=this.animations.map(function(V){return V.name}).concat(this.stateMachines.map(function(V){return V.name})),this.animations.forEach(function(V){return V.cleanup()}),this.stateMachines.forEach(function(V){return V.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var I=this.animations.filter(function(V){return o.includes(V.name)});I.forEach(function(V){V.cleanup(),d.animations.splice(d.animations.indexOf(V),1)});var M=this.stateMachines.filter(function(V){return o.includes(V.name)});M.forEach(function(V){V.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(V),1)}),b=I.map(function(V){return V.name}).concat(M.map(function(V){return V.name}))}return this.eventManager.fire({type:X.Stop,data:b}),b},Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),p.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var b;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([b=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([b=this.artboard.stateMachineByIndex(0).name],o,d)),b},p.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(I){return I.playing});o<d.length;o++){var b=d[o];b.loopValue===0&&b.loopCount?(b.loopCount=0,this.stop(b.name)):b.loopValue===1&&b.loopCount?(this.eventManager.fire({type:X.Loop,data:{animation:b.name,type:Q.Loop}}),b.loopCount=0):b.loopValue===2&&b.loopCount>1&&(this.eventManager.fire({type:X.Loop,data:{animation:b.name,type:Q.PingPong}}),b.loopCount=0)}},p.prototype.handleStateChanges=function(){for(var o=[],d=0,b=this.stateMachines.filter(function(M){return M.playing});d<b.length;d++){var I=b[d];o.push.apply(o,I.statesChanged)}o.length>0&&this.eventManager.fire({type:X.StateChange,data:o})},p.prototype.handleAdvancing=function(o){this.eventManager.fire({type:X.Advance,data:o})},p})(),X;(function(p){p.Load="load",p.LoadError="loaderror",p.Play="play",p.Pause="pause",p.Stop="stop",p.Loop="loop",p.Draw="draw",p.Advance="advance",p.StateChange="statechange",p.RiveEvent="riveevent",p.AudioStatusChange="audiostatuschange"})(X||(X={}));var Q;(function(p){p.OneShot="oneshot",p.Loop="loop",p.PingPong="pingpong"})(Q||(Q={}));var ge=(function(){function p(o){o===void 0&&(o=[]),this.listeners=o}return p.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},p.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},p.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var b=this.listeners[d];if(b.type===o.type&&b.callback===o.callback){this.listeners.splice(d,1);break}}},p.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(b){return b.type===o}).forEach(function(b){return d.remove(b)}):this.listeners.splice(0,this.listeners.length)},p.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(b){return b.callback(o)})},p})(),Pe=(function(){function p(o){this.eventManager=o,this.queue=[]}return p.prototype.add=function(o){this.queue.push(o)},p.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},p})(),de;(function(p){p[p.AVAILABLE=0]="AVAILABLE",p[p.UNAVAILABLE=1]="UNAVAILABLE"})(de||(de={}));var me=(function(p){m(o,p);function o(){var d=p!==null&&p.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=de.UNAVAILABLE,d}return o.prototype.delay=function(d){return E(this,void 0,void 0,function(){return g(this,function(b){return[2,new Promise(function(I){return setTimeout(I,d)})]})})},o.prototype.timeout=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return[2,new Promise(function(b,I){return setTimeout(I,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:X.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return this._enabled||(this._enabled=!0,this._status=de.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!(this._status===de.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==de.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,b=function(){return E(d,void 0,void 0,function(){return g(this,function(I){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",b,{once:!0})},o.prototype.establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===de.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(ge),ve=new me,dt=(function(){function p(){}return p.prototype.observe=function(){},p.prototype.unobserve=function(){},p.prototype.disconnect=function(){},p})(),Ye=globalThis.ResizeObserver||dt,Ge=(function(){function p(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var b=o._elementsMap.get(d.target);b!==null?b.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new Ye(this._onObserved)}return p.prototype.add=function(o,d){var b={onResize:d,element:o};return this._elementsMap.set(o,b),this._resizeObserver.observe(o),b},p.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},p})(),pt=new Ge,Ct=(function(){function p(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new ge,o.onLoad&&this.on(X.Load,o.onLoad),o.onLoadError&&this.on(X.LoadError,o.onLoadError)}return p.prototype.initData=function(){return E(this,void 0,void 0,function(){var o,d,b,I,M;return g(this,function(V){switch(V.label){case 0:return this.src?(o=this,[4,Z(this.src)]):[3,2];case 1:o.buffer=V.sent(),V.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(b=new _.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=b.assetLoader),I=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return I.file=V.sent(),this.destroyed?((M=this.file)===null||M===void 0||M.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:X.Load,data:this}):this.fireLoadError(p.fileLoadErrorMessage),[2])}})})},p.prototype.init=function(){return E(this,void 0,void 0,function(){var o,d;return g(this,function(b){switch(b.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(p.missingErrorMessage),[2];b.label=1;case 1:return b.trys.push([1,4,,5]),o=this,[4,z.awaitInstance()];case 2:return o.runtime=b.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return b.sent(),[3,5];case 4:return d=b.sent(),this.fireLoadError(d instanceof Error?d.message:p.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},p.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:X.LoadError,data:o}),new Error(o)},p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},p.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},p.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new le(d):null},p.missingErrorMessage="Rive source file or data buffer required",p.fileLoadErrorMessage="The file failed to load",p})(),Oe=(function(){function p(o){var d=this,b;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(I){var M=d._hasZeroSize!==I;d._hasZeroSize=I,I?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():M&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=pt.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(b=o.layout)!==null&&b!==void 0?b:new U,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new ge,o.onLoad&&this.on(X.Load,o.onLoad),o.onLoadError&&this.on(X.LoadError,o.onLoadError),o.onPlay&&this.on(X.Play,o.onPlay),o.onPause&&this.on(X.Pause,o.onPause),o.onStop&&this.on(X.Stop,o.onStop),o.onLoop&&this.on(X.Loop,o.onLoop),o.onStateChange&&this.on(X.StateChange,o.onStateChange),o.onAdvance&&this.on(X.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(X.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(X.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(X.Play,o.onplay),o.onpause&&!o.onPause&&this.on(X.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(X.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(X.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(X.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new Pe(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(p.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),p.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new p(o)},p.prototype.onSystemAudioChanged=function(){this.volume=this._volume},p.prototype.init=function(o){var d=this,b=o.src,I=o.buffer,M=o.riveFile,V=o.animations,ae=o.stateMachines,be=o.artboard,_e=o.autoplay,ze=_e===void 0?!1:_e,nt=o.useOffscreenRenderer,It=nt===void 0?!1:nt,gt=o.autoBind,en=gt===void 0?!1:gt;if(!this.destroyed){if(this.src=b,this.buffer=I,this.riveFile=M,!this.src&&!this.buffer&&!this.riveFile)throw new $(p.missingErrorMessage);var Jt=q(V),$t=q(ae);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(jt){d.destroyed||(d.runtime=jt,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,It),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(be,Jt,$t,ze,en).then(function(Je){if(Je)return d.setupRiveListeners()}).catch(function(Je){console.error(Je)}))}).catch(function(jt){console.error(jt)})}},p.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var b=(this.animator.stateMachines||[]).filter(function(M){return M.playing&&d.runtime.hasListeners(M.instance)}).map(function(M){return M.instance}),I=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(I=o.isTouchScrollEnabled),this.eventCleanup=(0,_.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:b,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:I,layoutScaleFactor:this._layout.layoutScaleFactor})}},p.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},p.prototype.initializeAudio=function(){var o=this,d;ve.status==de.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:X.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},ve.add(this._audioEventListener),ve.establishAudio())},p.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},p.prototype.initData=function(o,d,b,I,M){return E(this,void 0,void 0,function(){var V,ae,be,_e;return g(this,function(ze){switch(ze.label){case 0:return ze.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(V=new Ct({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=V,[4,V.init()]);case 1:if(ze.sent(),this.destroyed)return V.destroyIfUnused(),[2,!1];ze.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,b,I,M),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:X.Load,data:(_e=this.src)!==null&&_e!==void 0?_e:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return ae=ze.sent(),be=j(ae),console.warn(be),this.eventManager.fire({type:X.LoadError,data:be}),[2,Promise.reject(be)];case 4:return[2]}})})},p.prototype.initArtboard=function(o,d,b,I,M){if(this.file){var V=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!V){var ae="Invalid artboard name or no default artboard";console.warn(ae),this.eventManager.fire({type:X.LoadError,data:ae});return}if(this.artboard=V,V.volume=this._volume*ve.systemVolume,this.artboard.animationCount()<1){var ae="Artboard has no animations";throw this.eventManager.fire({type:X.LoadError,data:ae}),ae}this.animator=new ye(this.runtime,this.artboard,this.eventManager);var be;if(d.length>0||b.length>0?(be=d.concat(b),this.animator.initLinearAnimations(d,I),this.animator.initStateMachines(b,I)):be=[this.animator.atLeastOne(I,!1)],this.taskQueue.add({event:{type:I?X.Play:X.Pause,data:be}}),M){var _e=this.file.defaultArtboardViewModel(V);if(_e!==null){var ze=_e.defaultInstance();if(ze!==null){var nt=new Ue(ze,null);this.bindViewModelInstance(nt)}}}}},p.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},p.prototype.draw=function(o,d){var b;this.frameRequestId=null;var I=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var M=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var V=this.animator.animations.filter(function(yn){return yn.playing||yn.needsScrub}).sort(function(yn){return yn.needsScrub?-1:1}),ae=0,be=V;ae<be.length;ae++){var _e=be[ae];_e.advance(M),_e.instance.didLoop&&(_e.loopCount+=1),_e.apply(1)}for(var ze=this.animator.stateMachines.filter(function(yn){return yn.playing}),nt=0,It=ze;nt<It.length;nt++){var gt=It[nt],en=gt.reportedEventCount();if(en)for(var Jt=0;Jt<en;Jt++){var $t=gt.reportedEventAt(Jt);if($t)if($t.type===B.OpenUrl){if(this.eventManager.fire({type:X.RiveEvent,data:$t}),this.automaticallyHandleEvents){var jt=document.createElement("a"),Je=$t,Tt=Je.url,Et=Je.target,Nt=(0,_.sanitizeUrl)(Tt);Tt&&jt.setAttribute("href",Nt),Et&&jt.setAttribute("target",Et),Nt&&Nt!==_.BLANK_URL&&jt.click()}}else this.eventManager.fire({type:X.RiveEvent,data:$t})}gt.advanceAndApply(M)}this.animator.stateMachines.length==0&&this.artboard.advance(M);var Se=this.renderer;Se.clear(),Se.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Se),Se.restore(),Se.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(M),this.frameCount++;var rt=performance.now();for(this.frameTimes.push(rt),this.durations.push(rt-I);this.frameTimes[0]<=rt-1e3;)this.frameTimes.shift(),this.durations.shift();(b=this._viewModelInstance)===null||b===void 0||b.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},p.prototype.alignRenderer=function(){var o=this,d=o.renderer,b=o.runtime,I=o._layout,M=o.artboard;d.align(I.runtimeFit(b),I.runtimeAlignment(b),{minX:I.minX,minY:I.minY,maxX:I.maxX,maxY:I.maxY},M.bounds,this._devicePixelRatioUsed*I.layoutScaleFactor)},Object.defineProperty(p.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),p.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&pt.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ve.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},p.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},p.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},p.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var b=this.artboard.textRun(o);if(!b){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return b},p.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},p.prototype.setTextRunValue=function(o,d){var b=this.retrieveTextRun(o);b&&(b.text=d)},p.prototype.play=function(o,d){var b=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},p.prototype.pause=function(o){var d=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},p.prototype.scrub=function(o,d){var b=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return b.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},p.prototype.stop=function(o){var d=this;if(o=q(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},p.prototype.reset=function(o){var d,b,I=o?.artboard,M=q(o?.animations),V=q(o?.stateMachines),ae=(d=o?.autoplay)!==null&&d!==void 0?d:!1,be=(b=o?.autoBind)!==null&&b!==void 0?b:!1;this.cleanupInstances(),this.initArtboard(I,M,V,ae,be),this.taskQueue.process()},p.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(p.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),p.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},p.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),b=d.width,I=d.height,M=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=M,this.canvas.width=M*b,this.canvas.height=M*I,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===F.Layout){var V=this._layout.layoutScaleFactor;this.artboard.width=b/V,this.artboard.height=I/V}}},Object.defineProperty(p.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),p.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(b){return b.name===o});return d?.inputs}},p.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.inputByPath(o,d);if(!b){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b},p.prototype.setBooleanStateAtPath=function(o,d,b){var I=this.retrieveInputAtPath(o,b);I&&(I.type===J.Boolean?I.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(b,"' is not a boolean")))},p.prototype.setNumberStateAtPath=function(o,d,b){var I=this.retrieveInputAtPath(o,b);I&&(I.type===J.Number?I.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(b,"' is not a number")))},p.prototype.fireStateAtPath=function(o,d){var b=this.retrieveInputAtPath(o,d);b&&(b.type===J.Trigger?b.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},p.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var b=this.artboard.textByPath(o,d);if(!b){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b},p.prototype.getTextRunValueAtPath=function(o,d){var b=this.retrieveTextAtPath(o,d);if(!b){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return b.text},p.prototype.setTextRunValueAtPath=function(o,d,b){var I=this.retrieveTextAtPath(o,b);if(!I){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(b,"'"));return}I.text=d},Object.defineProperty(p.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),p.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},p.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},p.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},p.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},p.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},p.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},p.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},p.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},p.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(p.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var b=this.file.artboardByIndex(d),I={name:b.name,animations:[],stateMachines:[]},M=0;M<b.animationCount();M++){var V=b.animationByIndex(M);I.animations.push(V.name)}for(var ae=0;ae<b.stateMachineCount();ae++){for(var be=b.stateMachineByIndex(ae),_e=be.name,ze=new this.runtime.StateMachineInstance(be,b),nt=[],It=0;It<ze.inputCount();It++){var gt=ze.input(It);nt.push({name:gt.name,type:gt.type})}I.stateMachines.push({name:_e,inputs:nt})}o.artboards.push(I)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*ve.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),p.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(p.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),p.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(b){return b.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(p.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),p.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new oe(d):null},p.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new oe(d):null},p.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new Fe(d)})}return this._dataEnums},p.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new oe(o)}return null},p.prototype.getArtboard=function(o){var d,b;return(b=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&b!==void 0?b:null},p.missingErrorMessage="Rive source file or data buffer required",p.cleanupErrorMessage="Attempt to use file after calling cleanup.",p})(),oe=(function(){function p(o){this._viewModel=o}return Object.defineProperty(p.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),p.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new Ue(d,null):null},p.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new Ue(d,null):null},p.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new Ue(o,null):null},p.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new Ue(o,null):null},Object.defineProperty(p.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),p})(),Fe=(function(){function p(o){this._dataEnum=o}return Object.defineProperty(p.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),p})(),we;(function(p){p.Number="number",p.String="string",p.Boolean="boolean",p.Color="color",p.Trigger="trigger",p.Enum="enum",p.List="list",p.Image="image",p.Artboard="artboard"})(we||(we={}));var Ue=(function(){function p(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(p.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),p.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},p.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},p.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var b=this._parents[d];b.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},p.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},p.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(b){return b!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},p.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(b){b.addToViewModelCallbacks(d)}))},p.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(b){return b!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(b){b.removeFromViewModelCallbacks(d)}))},p.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},p.prototype.propertyFromPath=function(o,d){var b=o.split("/");return this.propertyFromPathSegments(b,0,d)},p.prototype.viewModelFromPathSegments=function(o,d){var b=this.internalViewModelInstance(o[d]);return b!==null?d==o.length-1?b:b.viewModelFromPathSegments(o,d++):null},p.prototype.propertyFromPathSegments=function(o,d,b){var I,M,V,ae,be,_e,ze,nt,It,gt,en,Jt,$t,jt,Je,Tt,Et,Nt;if(d<o.length-1){var Se=this.internalViewModelInstance(o[d]);return Se!==null?Se.propertyFromPathSegments(o,d+1,b):null}var rt=null;switch(b){case we.Number:if(rt=(M=(I=this._runtimeInstance)===null||I===void 0?void 0:I.number(o[d]))!==null&&M!==void 0?M:null,rt!==null)return new Ie(rt,this);break;case we.String:if(rt=(ae=(V=this._runtimeInstance)===null||V===void 0?void 0:V.string(o[d]))!==null&&ae!==void 0?ae:null,rt!==null)return new ke(rt,this);break;case we.Boolean:if(rt=(_e=(be=this._runtimeInstance)===null||be===void 0?void 0:be.boolean(o[d]))!==null&&_e!==void 0?_e:null,rt!==null)return new he(rt,this);break;case we.Color:if(rt=(nt=(ze=this._runtimeInstance)===null||ze===void 0?void 0:ze.color(o[d]))!==null&&nt!==void 0?nt:null,rt!==null)return new ut(rt,this);break;case we.Trigger:if(rt=(gt=(It=this._runtimeInstance)===null||It===void 0?void 0:It.trigger(o[d]))!==null&&gt!==void 0?gt:null,rt!==null)return new Be(rt,this);break;case we.Enum:if(rt=(Jt=(en=this._runtimeInstance)===null||en===void 0?void 0:en.enum(o[d]))!==null&&Jt!==void 0?Jt:null,rt!==null)return new xe(rt,this);break;case we.List:if(rt=(jt=($t=this._runtimeInstance)===null||$t===void 0?void 0:$t.list(o[d]))!==null&&jt!==void 0?jt:null,rt!==null)return new ht(rt,this);break;case we.Image:if(rt=(Tt=(Je=this._runtimeInstance)===null||Je===void 0?void 0:Je.image(o[d]))!==null&&Tt!==void 0?Tt:null,rt!==null)return new ct(rt,this);break;case we.Artboard:if(rt=(Nt=(Et=this._runtimeInstance)===null||Et===void 0?void 0:Et.artboard(o[d]))!==null&&Nt!==void 0?Nt:null,rt!==null)return new H(rt,this);break}return null},p.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var b=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(b!==null){var I=new p(b,this);return I.internalIncrementReferenceCount(),this._viewModelInstances.set(o,I),I}return null},p.prototype.number=function(o){var d=this.propertyFromPath(o,we.Number);return d},p.prototype.string=function(o){var d=this.propertyFromPath(o,we.String);return d},p.prototype.boolean=function(o){var d=this.propertyFromPath(o,we.Boolean);return d},p.prototype.color=function(o){var d=this.propertyFromPath(o,we.Color);return d},p.prototype.trigger=function(o){var d=this.propertyFromPath(o,we.Trigger);return d},p.prototype.enum=function(o){var d=this.propertyFromPath(o,we.Enum);return d},p.prototype.list=function(o){var d=this.propertyFromPath(o,we.List);return d},p.prototype.image=function(o){var d=this.propertyFromPath(o,we.Image);return d},p.prototype.artboard=function(o){var d=this.propertyFromPath(o,we.Artboard);return d},p.prototype.viewModel=function(o){var d=o.split("/"),b=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return b!=null?b.internalViewModelInstance(d[d.length-1]):null},p.prototype.internalReplaceViewModel=function(o,d){var b;if(d.runtimeInstance!==null){var I=((b=this._runtimeInstance)===null||b===void 0?void 0:b.replaceViewModel(o,d.runtimeInstance))||!1;if(I){d.internalIncrementReferenceCount();var M=this.internalViewModelInstance(o);M!==null&&(M.removeParent(this),this._children.includes(M)&&(this._children=this._children.filter(function(V){return V!==M})),M.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return I}return!1},p.prototype.replaceViewModel=function(o,d){var b,I=o.split("/"),M=I.length>1?this.viewModelFromPathSegments(I.slice(0,I.length-1),0):this;return(b=M?.internalReplaceViewModel(I[I.length-1],d))!==null&&b!==void 0?b:!1},p.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},p.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(p.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return w({},d)}))||[]},enumerable:!1,configurable:!0}),p.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},p.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(I){I.cleanup()}),this._viewModelInstances.clear();var d=A([],this._children,!0);this._children.length=0;var b=A([],this._parents,!0);this._parents.length=0,d.forEach(function(I){I.removeParent(o)}),b.forEach(function(I){I.removeFromViewModelCallbacks(o)})}},p})(),je=(function(){function p(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return p.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},p.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},p.prototype.internalHandleCallback=function(o){},p.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},p.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},p.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(p.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),p})(),ke=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(je),Ie=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(je),he=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(je),Be=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(je),xe=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(je),ht=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,b){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,b)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var b=this._viewModelInstanceValue.instanceAt(d);if(b!=null){var I=new Ue(b,this._parentViewModel);return I}return null},o.prototype.swap=function(d,b){this._viewModelInstanceValue.swap(d,b)},o.prototype.internalHandleCallback=function(d){d()},o})(je),ut=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,b,I){this._viewModelInstanceValue.rgb(d,b,I)},o.prototype.rgba=function(d,b,I,M){this._viewModelInstanceValue.argb(M,d,b,I)},o.prototype.argb=function(d,b,I,M){this._viewModelInstanceValue.argb(d,b,I,M)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(je),ct=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeImage)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(je),H=(function(p){m(o,p);function o(d,b){return p.call(this,d,b)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var b;this._viewModelInstanceValue.value((b=d?.nativeArtboard)!==null&&b!==void 0?b:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(je),Z=function(p){return E(void 0,void 0,void 0,function(){var o,d,b;return g(this,function(I){switch(I.label){case 0:return o=new Request(p),[4,fetch(o)];case 1:return d=I.sent(),[4,d.arrayBuffer()];case 2:return b=I.sent(),[2,b]}})})},q=function(p){return typeof p=="string"?[p]:p instanceof Array?p:[]},ie={EventManager:ge,TaskQueueManager:Pe},Ee=function(p){return E(void 0,void 0,void 0,function(){var o,d,b;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeAudio(p,M)})}),[4,o];case 1:return d=I.sent(),b=new _.AudioWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})},De=function(p){return E(void 0,void 0,void 0,function(){var o,d,b;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeImage(p,M)})}),[4,o];case 1:return d=I.sent(),b=new _.ImageWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})},Ce=function(p){return E(void 0,void 0,void 0,function(){var o,d,b;return g(this,function(I){switch(I.label){case 0:return o=new Promise(function(M){return z.getInstance(function(V){V.decodeFont(p,M)})}),[4,o];case 1:return d=I.sent(),b=new _.FontWrapper(d),_.finalizationRegistry.register(b,d),[2,b]}})})}})(),l})())})(ls)),ls.exports}var qv=Vv();const ju="dracula",ms="https://vycjpmuyscfygstjjied.supabase.co";var zv=se('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Il(n,e){Vt(e,!0);let t=Ts(e,"bucketName",3,ju),r=ft(void 0);Ci(()=>{if(!S(r))return;const u=new qv.Rive({src:`${ms}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:S(r),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var s=zv(),l=T(s);ps(l,u=>Me(r,u),()=>S(r)),K(n,s),qt()}function Hv(n,e,t,r,s,l){e()?t.onLose?t.onLose():r("lose"):s("Конец","Попытайте удачу снова!",[{text:"ОК",action:l}])}var Gv=se('<div class="info-item svelte-zdkig8"><button class="btn btn-danger svelte-zdkig8">🏳️ Сдаться</button></div>'),Kv=se('<div role="button" tabindex="0"> </div>'),Yv=_d('<polyline class="connection-line svelte-zdkig8" vector-effect="non-scaling-stroke"></polyline>'),Jv=se("<button> </button>"),Xv=se('<div id="modal-overlay"><div class="modal-content svelte-zdkig8"><div class="modal-title svelte-zdkig8"> </div> <div class="modal-text svelte-zdkig8"> </div> <div class="modal-buttons svelte-zdkig8"></div></div></div>'),Qv=se('<div class="body-wrapper svelte-zdkig8"><div id="game-info" class="svelte-zdkig8"><div class="info-item svelte-zdkig8"><span class="svelte-zdkig8">Осталось: <strong id="tiles-count" class="svelte-zdkig8"> </strong></span></div> <div class="info-item svelte-zdkig8"><button class="btn btn-secondary svelte-zdkig8">💡 Подсказка</button></div> <div class="info-item svelte-zdkig8"><button class="btn btn-secondary svelte-zdkig8">Новая игра</button></div> <!></div> <div id="game-container" class="svelte-zdkig8"><div id="grid" class="svelte-zdkig8"></div> <svg id="line-layer" class="svelte-zdkig8"><!></svg></div></div> <!>',1);function Zv(n,e){Vt(e,!0);let t=Ts(e,"integrated",3,!1);const r=Rd(),s=8,l=6,u=["🧛","🦇","👻","💀","🔥","🕷️","🕸️","🧟","🧙‍♀️","⚰️","🪦","🦴","🔮","🧪","👹","🌜","👽","🤡","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","👁️"];let h=ft(Gt([])),f=ft(Gt([])),_=ft(Gt({})),m=ft(Gt([])),w=ft(null),E=ft(!1),g=ft(!1),A=ft(Gt([])),$=ft(0),j=ft(Gt({show:!1,title:"",text:"",actions:[]})),F,W;Ci(()=>{J()});function U(){if(!S(f)||S(f).length===0)return 0;let H=0;for(let Z=0;Z<s;Z++)for(let q=0;q<l;q++)S(f)[Z]&&!S(f)[Z][q]&&H++;return H}let z=Ma(U);function J(){Me(h,[],!0),Me(f,[],!0),Me(w,null),Me(E,!1),Me(g,!1),Me(_,{},!0),Me(m,[],!0),Me(A,[],!0),ve();let H=[...new Set(u)];for(;H.length<s*l/2;)H=[...H,...H];let Z=H.sort(()=>.5-Math.random()).slice(0,s*l/2),q=[];Z.forEach(Ee=>q.push(Ee,Ee)),q.sort(()=>Math.random()-.5);let ie=0;for(let Ee=0;Ee<s;Ee++){let De=[],Ce=[];for(let p=0;p<l;p++)De.push(q[ie++]),Ce.push(!1);S(h).push(De),S(f).push(Ce)}setTimeout(te,500)}async function L(H,Z){if(S(E)||S(f)[H][Z]||S(g))return;if(S(m).length>0&&Me(m,[],!0),!S(w)){Me(w,{r:H,c:Z},!0);return}if(S(w).r===H&&S(w).c===Z){Me(w,null);return}const q=S(h)[S(w).r][S(w).c],ie=S(h)[H][Z];if(q===ie){const Ee=Pe(S(w).r,S(w).c,H,Z);if(Ee){Me(E,!0),await de(Ee),S(f)[S(w).r][S(w).c]=!0,S(f)[H][Z]=!0,Me(w,null),Me(E,!1),te();return}}Me(w,{r:H,c:Z},!0)}async function B(H,Z,q){(q.key==="Enter"||q.key===" ")&&(q.preventDefault(),await L(H,Z))}function le(){if(S(E)||S(g))return;let H=[];for(let q=0;q<s;q++)for(let ie=0;ie<l;ie++)S(f)[q][ie]||H.push({r:q,c:ie,icon:S(h)[q][ie]});let Z={};H.forEach(q=>{Z[q.icon]||(Z[q.icon]=[]),Z[q.icon].push(q)});for(let q in Z){let ie=Z[q];if(!(ie.length<2))for(let Ee=0;Ee<ie.length;Ee++)for(let De=Ee+1;De<ie.length;De++){let Ce=ie[Ee],p=ie[De];if(Pe(Ce.r,Ce.c,p.r,p.c)){Me(m,[Ce,p],!0),setTimeout(()=>Me(m,[],!0),1500);return}}}me("Нет ходов","Не нашлось пар для соединения.",[{text:"ОК",action:ve}])}function te(){if(S(z)===0){Me(g,!0),t()?e.onWin?e.onWin():r("win"):me("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:J}]);return}ye()||(t()?setTimeout(()=>X(),1e3):me("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ve(),X()}},{text:"Сдаться",action:()=>{me("Конец","Попытайте удачу снова!",[{text:"ОК",action:J}])}}]))}function ye(){let H=[];for(let q=0;q<s;q++)for(let ie=0;ie<l;ie++)S(f)[q][ie]||H.push({r:q,c:ie,icon:S(h)[q][ie]});let Z={};H.forEach(q=>{Z[q.icon]||(Z[q.icon]=[]),Z[q.icon].push(q)});for(let q in Z){let ie=Z[q];if(!(ie.length<2)){for(let Ee=0;Ee<ie.length;Ee++)for(let De=Ee+1;De<ie.length;De++)if(Pe(ie[Ee].r,ie[Ee].c,ie[De].r,ie[De].c))return!0}}return!1}function X(){let H=[],Z=[];for(let q=0;q<s;q++)for(let ie=0;ie<l;ie++)S(f)[q][ie]||(H.push(S(h)[q][ie]),Z.push({r:q,c:ie}));H.length!==0&&(H.sort(()=>Math.random()-.5),Z.forEach((q,ie)=>{S(h)[q.r][q.c]=H[ie],S(_)[`${q.r},${q.c}`]=!0}),setTimeout(()=>{Me(_,{},!0),ye()?Me(g,!1):X()},500))}function Q(H,Z){return H<0||H>=s||Z<0||Z>=l?!0:S(f)[H][Z]}function ge(H,Z,q,ie){if(H!==q&&Z!==ie)return!1;if(H===q){const Ee=Math.min(Z,ie),De=Math.max(Z,ie);for(let Ce=Ee+1;Ce<De;Ce++)if(!Q(H,Ce))return!1}else{const Ee=Math.min(H,q),De=Math.max(H,q);for(let Ce=Ee+1;Ce<De;Ce++)if(!Q(Ce,Z))return!1}return!0}function Pe(H,Z,q,ie){if(ge(H,Z,q,ie))return[{r:H,c:Z},{r:q,c:ie}];let Ee={r:H,c:ie};if(Q(Ee.r,Ee.c)&&ge(H,Z,Ee.r,Ee.c)&&ge(Ee.r,Ee.c,q,ie))return[{r:H,c:Z},Ee,{r:q,c:ie}];let De={r:q,c:Z};if(Q(De.r,De.c)&&ge(H,Z,De.r,De.c)&&ge(De.r,De.c,q,ie))return[{r:H,c:Z},De,{r:q,c:ie}];for(let Ce=-1;Ce<=s;Ce++){if(Ce===H||Ce===q)continue;let p={r:Ce,c:Z},o={r:Ce,c:ie};if(Q(p.r,p.c)&&Q(o.r,o.c)&&ge(H,Z,p.r,p.c)&&ge(p.r,p.c,o.r,o.c)&&ge(o.r,o.c,q,ie))return[{r:H,c:Z},p,o,{r:q,c:ie}]}for(let Ce=-1;Ce<=l;Ce++){if(Ce===Z||Ce===ie)continue;let p={r:H,c:Ce},o={r:q,c:Ce};if(Q(p.r,p.c)&&Q(o.r,o.c)&&ge(H,Z,p.r,p.c)&&ge(p.r,p.c,o.r,o.c)&&ge(o.r,o.c,q,ie))return[{r:H,c:Z},p,o,{r:q,c:ie}]}return null}async function de(H){if(await au(),!F||!W)return;const Z=F.getBoundingClientRect(),q=W.getBoundingClientRect(),ie=W.querySelector(".cell");if(!ie)return;const Ee=ie.offsetWidth,De=ie.offsetHeight,Ce=window.getComputedStyle(W),p=parseFloat(Ce.gap)||4,o=q.left-Z.left,d=q.top-Z.top,b=H.map(I=>{let M,V;if(I.r>=0&&I.r<s&&I.c>=0&&I.c<l){const be=W.children[I.r*l+I.c].getBoundingClientRect();M=be.left-Z.left+be.width/2,V=be.top-Z.top+be.height/2}else{const ae=I.c*(Ee+p)+Ee/2,be=I.r*(De+p)+De/2;M=o+ae,V=d+be}return`${M.toFixed(1)},${V.toFixed(1)}`}).join(" ");return Me(A,b,!0),Xc($),new Promise(I=>{setTimeout(()=>{Me(A,[],!0),I()},350)})}function me(H,Z,q){t()||Me(j,{show:!0,title:H,text:Z,actions:q},!0)}function ve(){S(j).show=!1}var dt=Qv(),Ye=At(dt),Ge=T(Ye),pt=T(Ge),Ct=T(pt),Oe=D(T(Ct)),oe=T(Oe),Fe=D(pt,2),we=T(Fe);we.__click=le;var Ue=D(Fe,2),je=T(Ue);je.__click=J;var ke=D(Ue,2);{var Ie=H=>{var Z=Gv(),q=T(Z);q.__click=[Hv,t,e,r,me,J],K(H,Z)};Le(ke,H=>{t()&&H(Ie)})}var he=D(Ge,2),Be=T(he);Ad(Be,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),wt(Be,21,()=>S(h),Ut,(H,Z,q)=>{var ie=Kt(),Ee=At(ie);wt(Ee,17,()=>S(Z),Ut,(De,Ce,p)=>{var o=Kv();let d;o.__click=()=>L(q,p),o.__keydown=I=>B(q,p,I);var b=T(o);Ae(I=>{d=mn(o,1,"cell svelte-zdkig8",null,d,I),Te(b,S(Ce))},[()=>({selected:S(w)?.r===q&&S(w)?.c===p,matched:S(f)[q][p],shuffling:S(_)[`${q},${p}`],"hint-glow":S(m).some(I=>I.r===q&&I.c===p)})]),K(De,o)}),K(H,ie)}),ps(Be,H=>W=H,()=>W);var xe=D(Be,2),ht=T(xe);va(ht,()=>S($),H=>{var Z=Kt(),q=At(Z);{var ie=Ee=>{var De=Yv();Ae(()=>Re(De,"points",S(A))),K(Ee,De)};Le(q,Ee=>{S(A)&&Ee(ie)})}K(H,Z)}),ps(he,H=>F=H,()=>F);var ut=D(Ye,2);{var ct=H=>{var Z=Xv();let q;var ie=T(Z),Ee=T(ie),De=T(Ee),Ce=D(Ee,2),p=T(Ce),o=D(Ce,2);wt(o,21,()=>S(j).actions,d=>d.text,(d,b)=>{var I=Jv();let M;I.__click=function(...ae){S(b).action?.apply(this,ae)};var V=T(I);Ae(ae=>{M=mn(I,1,"btn svelte-zdkig8",null,M,ae),Te(V,S(b).text)},[()=>({"btn-secondary":S(b).class==="btn-secondary"})]),K(d,I)}),Ae(d=>{q=mn(Z,1,"svelte-zdkig8",null,q,d),Te(De,S(j).title),Te(p,S(j).text)},[()=>({active:S(j).show})]),K(H,Z)};Le(ut,H=>{S(j).show&&H(ct)})}Ae(()=>Te(oe,S(z))),K(n,dt),qt()}Yt(["click","keydown"]);function ep(n,e){e.onLose()}var tp=se('<div class="loading svelte-1rtkeyj">Загрузка игры...</div>'),np=se('<div class="minigame-container svelte-1rtkeyj"><button class="exit-btn svelte-1rtkeyj">✕ Выйти из игры</button> <!></div>');function rp(n,e){Vt(e,!0);let t=ft(null),r;Ci(()=>{s()});function s(){switch(console.log(e.gameId),e.gameId){case"onet_monsters":Me(t,Zv,!0);break;default:console.error(`Unknown game ID: ${e.gameId}`),e.onLose()}}function l(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function u(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var h=np(),f=T(h);f.__click=[ep,e];var _=D(f,2);{var m=E=>{var g=Kt(),A=At(g);Ed(A,()=>S(t),($,j)=>{j($,{onwin:l,onlose:u})}),K(E,g)},w=E=>{var g=tp();K(E,g)};Le(_,E=>{S(t)?E(m):E(w,!1)})}ps(h,E=>r=E,()=>r),K(n,h),qt()}Yt(["click"]);function ip(n,e){S(e)?.nextDialogueId&&bt.goToDialogue(S(e).nextDialogueId)}var sp=se('<img alt="BG" class="background-image svelte-dd9wj5"/>'),ap=se('<div class="background-media svelte-dd9wj5"><!></div>'),op=se('<img alt="Char" class="character-image svelte-dd9wj5"/>'),lp=se('<div class="character-media svelte-dd9wj5"><!></div>'),up=(n,e,t)=>e(S(t)),cp=se('<button class="option-button svelte-dd9wj5"> </button>'),dp=se('<div class="options-container svelte-dd9wj5"></div>'),hp=se('<div class="next-container svelte-dd9wj5"><button class="next-button svelte-dd9wj5">Далее...</button></div>'),fp=se('<div class="dialogue-container svelte-dd9wj5"><!> <!> <!> <div class="dialogue-content svelte-dd9wj5"><div class="dialogue-text svelte-dd9wj5"> </div> <!></div></div>'),vp=se("<p> </p>");function Ru(n,e){Vt(e,!0);let t=Ts(e,"bucketName",3,ju);console.log(t());const r=Ma(()=>e.dialogue||bt.findDialogue(bt.currentDialogueId));let s=ft(null);Jr(()=>{S(r)?.onEnter&&bt.runActions(S(r).onEnter)});function l(g){if(g.actions&&bt.runActions(g.actions),g.miniGame){console.log("Запуск мини-игры:",g.miniGame.id),Me(s,{gameId:g.miniGame.id,onWinDialogueId:g.miniGame.onWinDialogueId,onLoseDialogueId:g.miniGame.onLoseDialogueId,rewardItem:g.miniGame.rewardItem},!0);return}g.nextDialogueId&&bt.goToDialogue(g.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),S(s)?.rewardItem&&bt.addItem(S(s).rewardItem),S(s)?.onWinDialogueId&&bt.goToDialogue(S(s).onWinDialogueId),Me(s,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),S(s)?.onLoseDialogueId&&bt.goToDialogue(S(s).onLoseDialogueId),Me(s,null)}function f(g){return g.visibleIf&&g.visibleIf.hasItem?bt.hasItem(g.visibleIf.hasItem):!0}var _=Kt(),m=At(_);{var w=g=>{var A=fp(),$=T(A);{var j=X=>{rp(X,{get gameId(){return S(s).gameId},onWin:u,onLose:h})};Le($,X=>{S(s)&&X(j)})}var F=D($,2);{var W=X=>{var Q=ap(),ge=T(Q);{var Pe=me=>{var ve=Kt(),dt=At(ve);va(dt,()=>S(r).backgroundImage,Ye=>{Il(Ye,{get fileName(){return S(r).backgroundImage},get bucketName(){return t()}})}),K(me,ve)},de=me=>{var ve=sp();Ae(()=>Re(ve,"src",`${ms}/storage/v1/object/public/${t()}/${S(r).backgroundImage}`)),K(me,ve)};Le(ge,me=>{S(r).backgroundImage.endsWith(".riv")?me(Pe):me(de,!1)})}K(X,Q)};Le(F,X=>{S(r).backgroundImage&&X(W)})}var U=D(F,2);{var z=X=>{var Q=lp(),ge=T(Q);{var Pe=me=>{var ve=Kt(),dt=At(ve);va(dt,()=>S(r).characterImage,Ye=>{Il(Ye,{get fileName(){return S(r).characterImage},get bucketName(){return t()}})}),K(me,ve)},de=me=>{var ve=op();Ae(()=>Re(ve,"src",`${ms}/storage/v1/object/public/${t()}/${S(r).characterImage}`)),K(me,ve)};Le(ge,me=>{S(r).characterImage.endsWith(".riv")?me(Pe):me(de,!1)})}K(X,Q)};Le(U,X=>{S(r).characterImage&&X(z)})}var J=D(U,2),L=T(J),B=T(L),le=D(L,2);{var te=X=>{var Q=dp();wt(Q,21,()=>S(r).options,ge=>ge.text,(ge,Pe)=>{var de=Kt(),me=At(de);{var ve=dt=>{var Ye=cp();Ye.__click=[up,l,Pe];var Ge=T(Ye);Ae(()=>Te(Ge,S(Pe).text)),K(dt,Ye)};Le(me,dt=>{f(S(Pe))&&dt(ve)})}K(ge,de)}),K(X,Q)},ye=X=>{var Q=Kt(),ge=At(Q);{var Pe=de=>{var me=hp(),ve=T(me);ve.__click=[ip,r],K(de,me)};Le(ge,de=>{S(r).nextDialogueId&&de(Pe)},!0)}K(X,Q)};Le(le,X=>{S(r).options&&S(r).options.length>0?X(te):X(ye,!1)})}Ae(()=>Te(B,S(r).text)),K(g,A)},E=g=>{var A=vp(),$=T(A);Ae(()=>Te($,`Диалог не найден (ID: ${bt.currentDialogueId??""})`)),K(g,A)};Le(m,g=>{S(r)?g(w):g(E,!1)})}K(n,_),qt()}Yt(["click"]);var aa=er(()=>R),pp=se('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),gp=se('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),_p=se('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),mp=se('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),yp=se('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),bp=se('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),wp=se('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function kp(n,e){Vt(e,!1);function t(){aa(aa().editingOptionIndex=null)}Zn();var r=wp(),s=T(r),l=D(T(s),2);l.__click=t;var u=D(s,2),h=T(u);{var f=m=>{var w=yp(),E=T(w);{let Q=ti(()=>aa().selectedBucket||void 0);Ru(E,{get dialogue(){return Dt.currentDialogue},index:0,get bucketName(){return S(Q)}})}var g=D(E,2),A=T(g),$=D(T(A),2),j=T($),F=D(A,2),W=D(T(F),2),U=T(W),z=D(F,2);{var J=Q=>{var ge=pp(),Pe=D(T(ge),2),de=T(Pe);Ae(()=>Te(de,Dt.currentDialogue.backgroundImage)),K(Q,ge)};Le(z,Q=>{Dt.currentDialogue.backgroundImage&&Q(J)})}var L=D(z,2);{var B=Q=>{var ge=gp(),Pe=D(T(ge),2),de=T(Pe);Ae(()=>Te(de,Dt.currentDialogue.characterImage)),K(Q,ge)};Le(L,Q=>{Dt.currentDialogue.characterImage&&Q(B)})}var le=D(g,2);{var te=Q=>{var ge=_p();K(Q,ge)};Le(le,Q=>{(!Dt.currentDialogue.options||Dt.currentDialogue.options.length===0)&&Q(te)})}var ye=D(le,2);{var X=Q=>{var ge=mp();K(Q,ge)};Le(ye,Q=>{Dt.currentDialogue.options?.some(ge=>!ge.nextDialogueId)&&Q(X)})}Ae(()=>{Te(j,Dt.currentDialogue.id),Te(U,Dt.currentChapter?.title||"Без главы")}),K(m,w)},_=m=>{var w=bp();K(m,w)};Le(h,m=>{Dt.currentDialogue?m(f):m(_,!1)})}K(n,r),qt()}Yt(["click"]);const Ep=["dracula","zombie","fairy_tale","minigames"];function Ou(){const n=Ep.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return ot.updateBucketsList(n),n}var cr=er(()=>R),Sp=se('<span class="selected-badge svelte-1cmn6ru">Выбрано</span>'),Ip=(n,e,t)=>e(S(t).name),Ap=se('<button class="btn small svelte-1cmn6ru">Выбрать</button>'),Cp=se('<div><div class="bucket-info svelte-1cmn6ru"><div class="story-icon svelte-1cmn6ru"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1cmn6ru"><!></div></div>'),Tp=se('<div class="story-selector svelte-1cmn6ru"><div class="selector-header svelte-1cmn6ru"><h2 class="svelte-1cmn6ru">Выберите историю</h2></div> <div class="buckets-list svelte-1cmn6ru"></div></div>');function Pp(n,e){Vt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};Ci(()=>{r()});function r(){Ou()}async function s(h){cr(cr().selectedBucket=h),cr(cr().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await Jn.loadStoriesList(),await Jn.loadStoredResources()}Zn();var l=Tp(),u=D(T(l),2);wt(u,5,()=>cr().availableBuckets,h=>h,(h,f)=>{const _=ti(()=>t[S(f).id]||{title:S(f),description:"Интерактивная история",icon:"📖"});var m=Cp();let w;var E=T(m),g=T(E),A=T(g),$=D(g,2),j=T($),F=T(j),W=D(j,2),U=T(W),z=D(E,2),J=T(z);{var L=le=>{var te=Sp();K(le,te)},B=le=>{var te=Ap();te.__click=[Ip,s,f],K(le,te)};Le(J,le=>{cr().selectedBucket===S(f).name?le(L):le(B,!1)})}Ae(le=>{w=mn(m,1,"bucket-card svelte-1cmn6ru",null,w,le),Te(A,S(_).icon),Te(F,S(_).title),Te(U,S(_).description)},[()=>({selected:cr().selectedBucket===S(f).name})]),K(h,m)}),K(n,l),qt()}Yt(["click"]);var xp=se("<span> </span>"),jp=se('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Rp=se('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Op=se('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Mp=se('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Lp(n,e){Vt(e,!0),Ci(async()=>{Ou(),R.availableBuckets.length>0&&!R.selectedBucket&&(R.selectedBucket=R.availableBuckets[0].name)}),Jr(async()=>{if(R.selectedBucket){console.log(`[Editor] Bucket выбран: ${R.selectedBucket}`),await Jn.loadStoredResources();const u=`${R.selectedBucket}_story.json`;R.currentFileName=u,await vr.loadStory(u)}});var t=Kt(),r=At(t);{var s=u=>{Pp(u,{})},l=u=>{var h=Mp(),f=T(h),_=T(f),m=T(_);m.__click=()=>R.selectedBucket=null;var w=D(m,2),E=T(w),g=D(_,2),A=T(g),$=T(A),j=D(A,2);{var F=de=>{var me=xp(),ve=T(me);Ae(()=>{mn(me,1,`status-message ${R.statusMessage.type??""}`,"svelte-1k4krym"),Te(ve,R.statusMessage.text)}),K(de,me)};Le(j,de=>{R.statusMessage.text&&de(F)})}var W=D(j,2);W.__click=function(...de){vr.saveCurrentStory?.apply(this,de)};var U=D(W,2);U.__click=function(...de){vr.saveStoryCopy?.apply(this,de)};var z=D(f,2),J=T(z);Zf(J,{});var L=D(J,2),B=T(L);{var le=de=>{var me=jp(),ve=T(me),dt=T(ve);Ae(()=>Te(dt,`Загружено: ${R.data.meta?.title??""} |
              Глав: ${(R.data.chapters?.length||0)??""} |
              Диалогов: ${(R.data.dialogues?.length||0)??""} |
              Предметов: ${(R.data.items?.length||0)??""}`)),K(de,me)},te=de=>{var me=Rp();K(de,me)};Le(B,de=>{R.data?de(le):de(te,!1)})}var ye=D(B,2);Nv(ye,{});var X=D(ye,2);{var Q=de=>{Tv(de,{get editor(){return R},get storyActions(){return vr},get resourceActions(){return Jn}})},ge=de=>{var me=Op();K(de,me)};Le(X,de=>{Dt.currentDialogue?de(Q):de(ge,!1)})}var Pe=D(L,2);kp(Pe,{}),Ae(()=>{Te(E,`Story Editor v3.1 - ${R.selectedBucket??""}`),Te($,R.currentFileName||"Нет файла")}),K(u,h)};Le(r,u=>{R.selectedBucket?u(l,!1):u(s)})}K(n,t),qt()}Yt(["click"]);var oa=er(()=>bt),Dp=(n,e,t)=>e(S(t)),$p=(n,e,t)=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e(S(t)))},Fp=se('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),Up=se('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function Np(n,e){Vt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function r(u){oa(oa().selectedStory=u)}Zn();var s=Up(),l=D(T(s),2);wt(l,5,()=>oa().availableStories,u=>u,(u,h)=>{const f=ti(()=>t[S(h)]||{title:S(h),description:"Интерактивная история",icon:"📖"});var _=Fp();_.__click=[Dp,r,h],_.__keydown=[$p,r,h];var m=T(_),w=T(m),E=D(m,2),g=T(E),A=T(g),$=D(g,2),j=T($);Ae(()=>{Te(w,S(f).icon),Te(A,S(f).title),Te(j,S(f).description)}),K(u,_)}),K(n,s),qt()}Yt(["click","keydown"]);var Bp=se('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),Wp=se('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),Vp=se('<div class="game-container svelte-14svm27"><button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),qp=se('<div class="app svelte-14svm27"><!></div>');function zp(n,e){Vt(e,!0),Jr(async()=>{if(bt.selectedStory){const u=`${bt.selectedStory}_story.json`,h=`${ms}/storage/v1/object/public/${bt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await bt.loadStory(h)}});var t=qp(),r=T(t);{var s=u=>{Np(u,{})},l=u=>{var h=Kt(),f=At(h);{var _=w=>{var E=Bp();K(w,E)},m=w=>{var E=Kt(),g=At(E);{var A=j=>{var F=Wp(),W=T(F),U=D(W);U.__click=()=>bt.selectedStory=null,Ae(()=>Te(W,`⚠️ ${bt.error??""} `)),K(j,F)},$=j=>{var F=Vp(),W=T(F);W.__click=()=>bt.selectedStory=null;var U=D(W,2),z=T(U);{var J=L=>{{let B=Ma(()=>bt.selectedStory||void 0);Ru(L,{get bucketName(){return S(B)}})}};Le(z,L=>{bt.storyData&&L(J)})}K(j,F)};Le(g,j=>{bt.error?j(A):j($,!1)},!0)}K(w,E)};Le(f,w=>{bt.isLoading?w(_):w(m,!1)},!0)}K(u,h)};Le(r,u=>{bt.selectedStory?u(l,!1):u(s)})}K(n,t),qt()}Yt(["click"]);var Hp=se('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),Gp=se('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function Kp(n,e){Vt(e,!1),Zn();var t=Kt(),r=At(t);{var s=u=>{var h=Hp(),f=At(h);f.__click=function(...m){ot.toggleEditor?.apply(this,m)};var _=D(f,2);Lp(_,{}),K(u,h)},l=u=>{var h=Gp(),f=At(h);f.__click=function(...m){ot.toggleEditor?.apply(this,m)};var _=D(f,2);zp(_,{}),K(u,h)};Le(r,u=>{R.showEditor?u(s):u(l,!1)})}K(n,t),qt()}Yt(["click"]);md(Kp,{target:document.getElementById("app")});
