(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const ql=!1;var Ts=Array.isArray,Ic=Array.prototype.indexOf,Ba=Array.from,ya=Object.defineProperty,ni=Object.getOwnPropertyDescriptor,Vl=Object.getOwnPropertyDescriptors,Ec=Object.prototype,Ac=Array.prototype,Wa=Object.getPrototypeOf,Zo=Object.isExtensible;const Cc=()=>{};function jc(r){return r()}function ks(r){for(var e=0;e<r.length;e++)r[e]()}function xc(){var r,e,t=new Promise((n,i)=>{r=n,e=i});return{promise:t,resolve:r,reject:e}}const vr=2,qa=4,Ps=8,fi=16,Jr=32,Rn=64,Gl=128,mr=256,Ss=512,rr=1024,yr=2048,ln=4096,xr=8192,On=16384,Va=32768,Rs=65536,el=1<<17,Tc=1<<18,Ui=1<<19,zl=1<<20,ba=1<<21,Ga=1<<22,Cn=1<<23,Hr=Symbol("$state"),Pc=Symbol("legacy props"),Rc=Symbol(""),za=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Oc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Mc(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Lc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Dc(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Fc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $c(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Uc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Nc(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Bc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function qc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Os=1,Ms=2,Hl=4,Vc=8,Gc=16,zc=1,Hc=2,Kc=4,Yc=8,Jc=16,Xc=1,Qc=2,Qt=Symbol(),Zc="http://www.w3.org/1999/xhtml";function ed(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let td=!1;function Kl(r){return r===this.v}function Yl(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function rd(r,e){return r!==e}function Jl(r){return!Yl(r,this.v)}let hi=!1,nd=!1;function id(){hi=!0}let Vt=null;function Is(r){Vt=r}function Rt(r,e=!1,t){Vt={p:Vt,c:null,e:null,s:r,x:null,l:hi&&!e?{s:null,u:null,$:[]}:null}}function Ot(r){var e=Vt,t=e.e;if(t!==null){e.e=null;for(var n of t)cu(n)}return Vt=e.p,{}}function vi(){return!hi||Vt!==null&&Vt.l===null}const sd=new WeakMap;function ad(r){var e=wt;if(e===null)return St.f|=Cn,r;if((e.f&Va)===0){if((e.f&Gl)===0)throw!e.parent&&r instanceof Error&&Xl(r),r;e.b.error(r)}else Ha(r,e)}function Ha(r,e){for(;e!==null;){if((e.f&Gl)!==0)try{e.b.error(r);return}catch(t){r=t}e=e.parent}throw r instanceof Error&&Xl(r),r}function Xl(r){const e=sd.get(r);e&&(ya(r,"message",{value:e.message}),ya(r,"stack",{value:e.stack}))}let Mi=[],wa=[];function Ql(){var r=Mi;Mi=[],ks(r)}function od(){var r=wa;wa=[],ks(r)}function Ka(r){Mi.length===0&&queueMicrotask(Ql),Mi.push(r)}function ld(){Mi.length>0&&Ql(),wa.length>0&&od()}function ud(){for(var r=wt.b;r!==null&&!r.has_pending_snippet();)r=r.parent;return r===null&&Oc(),r}function Ni(r){var e=vr|yr,t=St!==null&&(St.f&vr)!==0?St:null;return wt===null||t!==null&&(t.f&mr)!==0?e|=mr:wt.f|=Ui,{ctx:Vt,deps:null,effects:null,equals:Kl,f:e,fn:r,reactions:null,rv:0,v:Qt,wv:0,parent:t??wt,ac:null}}function cd(r,e){let t=wt;t===null&&Lc();var n=t.b,i=void 0,o=li(Qt),u=null,h=!St;return Id(()=>{try{var p=r();u&&Promise.resolve(p).catch(()=>{})}catch(g){p=Promise.reject(g)}var v=()=>p;i=u?.then(v,v)??Promise.resolve(p),u=i;var _=Ut,w=n.pending;h&&(n.update_pending_count(1),w||_.increment());const E=(g,b=void 0)=>{u=null,w||_.activate(),b?b!==za&&(o.f|=Cn,ui(o,b)):((o.f&Cn)!==0&&(o.f^=Cn),ui(o,g)),h&&(n.update_pending_count(-1),w||_.decrement()),tu()};if(i.then(E,g=>E(null,g||"unknown")),_)return()=>{queueMicrotask(()=>_.neuter())}}),new Promise(p=>{function v(_){function w(){_===i?p(o):v(i)}_.then(w,w)}v(i)})}function kt(r){const e=Ni(r);return _u(e),e}function Ls(r){const e=Ni(r);return e.equals=Jl,e}function Zl(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)Dr(e[t])}}function dd(r){for(var e=r.parent;e!==null;){if((e.f&vr)===0)return e;e=e.parent}return null}function Ya(r){var e,t=wt;on(dd(r));try{Zl(r),e=wu(r)}finally{on(t)}return e}function eu(r){var e=Ya(r);if(r.equals(e)||(r.v=e,r.wv=yu()),!Ln){var t=(nn||(r.f&mr)!==0)&&r.deps!==null?ln:rr;dr(r,t)}}function fd(r,e,t){const n=vi()?Ni:Ls;if(e.length===0){t(r.map(n));return}var i=Ut,o=wt,u=hd(),h=ud();Promise.all(e.map(p=>cd(p))).then(p=>{i?.activate(),u();try{t([...r.map(n),...p])}catch(v){(o.f&On)===0&&Ha(v,o)}i?.deactivate(),tu()}).catch(p=>{h.error(p)})}function hd(){var r=wt,e=St,t=Vt,n=Ut;return function(){on(r),Fr(e),Is(t),n?.activate()}}function tu(){on(null),Fr(null),Is(null)}const sa=new Set;let Ut=null,ys=null,tl=new Set,Es=[];function ru(){const r=Es.shift();Es.length>0&&queueMicrotask(ru),r()}let xn=[],Ds=null,ka=!1,bs=!1;class ai{current=new Map;#s=new Map;#n=new Set;#e=0;#a=null;#o=!1;#t=[];#i=[];#r=[];#l=[];#u=[];#d=[];#f=[];skipped_effects=new Set;process(e){xn=[],ys=null;for(const i of e)this.#v(i);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#r,n=this.#l;this.#r=[],this.#l=[],this.#u=[],ys=Ut,Ut=null,rl(t),rl(n),Ut===null?Ut=this:sa.delete(this),this.#a?.resolve()}else this.#c(this.#r),this.#c(this.#l),this.#c(this.#u);for(const i of this.#t)si(i);for(const i of this.#i)si(i);this.#t=[],this.#i=[]}#v(e){e.f^=rr;for(var t=e.first;t!==null;){var n=t.f,i=(n&(Jr|Rn))!==0,o=i&&(n&rr)!==0,u=o||(n&xr)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(i)t.f^=rr;else if((n&qa)!==0)this.#l.push(t);else if((n&rr)===0)if((n&Ga)!==0){var h=t.b?.pending?this.#i:this.#t;h.push(t)}else Bs(t)&&((t.f&fi)!==0&&this.#u.push(t),si(t));var p=t.first;if(p!==null){t=p;continue}}var v=t.parent;for(t=t.next;t===null&&v!==null;)t=v.next,v=v.parent}}#c(e){for(const t of e)((t.f&yr)!==0?this.#d:this.#f).push(t),dr(t,rr);e.length=0}capture(e,t){this.#s.has(e)||this.#s.set(e,t),this.current.set(e,e.v)}activate(){Ut=this}deactivate(){Ut=null,ys=null;for(const e of tl)if(tl.delete(e),e(),Ut!==null)break}neuter(){this.#o=!0}flush(){xn.length>0?nu():this.#h(),Ut===this&&(this.#e===0&&sa.delete(this),this.deactivate())}#h(){if(!this.#o)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)dr(e,yr),oi(e);for(const e of this.#f)dr(e,ln),oi(e);this.#r=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#a??=xc()).promise}static ensure(){if(Ut===null){const e=Ut=new ai;sa.add(Ut),bs||ai.enqueue(()=>{Ut===e&&e.flush()})}return Ut}static enqueue(e){Es.length===0&&queueMicrotask(ru),Es.unshift(e)}}function vd(r){var e=bs;bs=!0;try{for(var t;;){if(ld(),xn.length===0&&(Ut?.flush(),xn.length===0))return Ds=null,t;nu()}}finally{bs=e}}function nu(){var r=ii;ka=!0;try{var e=0;for(al(!0);xn.length>0;){var t=ai.ensure();if(e++>1e3){var n,i;pd()}t.process(xn),sn.clear()}}finally{ka=!1,al(r),Ds=null}}function pd(){try{Uc()}catch(r){Ha(r,Ds)}}let In=null;function rl(r){var e=r.length;if(e!==0){for(var t=0;t<e;){var n=r[t++];if((n.f&(On|xr))===0&&Bs(n)&&(In=[],si(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?vu(n):n.fn=null),In?.length>0)){sn.clear();for(const i of In)si(i);In=[]}}In=null}}function oi(r){for(var e=Ds=r;e.parent!==null;){e=e.parent;var t=e.f;if(ka&&e===wt&&(t&fi)!==0)return;if((t&(Rn|Jr))!==0){if((t&rr)===0)return;e.f^=rr}}xn.push(e)}const sn=new Map;function li(r,e){var t={f:0,v:r,reactions:null,equals:Kl,rv:0,wv:0};return t}function we(r,e){const t=li(r);return _u(t),t}function gd(r,e=!1,t=!0){const n=li(r);return e||(n.equals=Jl),hi&&t&&Vt!==null&&Vt.l!==null&&(Vt.l.s??=[]).push(n),n}function L(r,e,t=!1){St!==null&&(!Lr||(St.f&el)!==0)&&vi()&&(St.f&(vr|fi|Ga|el))!==0&&!Kr?.includes(r)&&qc();let n=t?ht(e):e;return ui(r,n)}function ui(r,e){if(!r.equals(e)){var t=r.v;Ln?sn.set(r,e):sn.set(r,t),r.v=e;var n=ai.ensure();n.capture(r,t),(r.f&vr)!==0&&((r.f&yr)!==0&&Ya(r),dr(r,(r.f&mr)===0?rr:ln)),r.wv=yu(),iu(r,yr),vi()&&wt!==null&&(wt.f&rr)!==0&&(wt.f&(Jr|Rn))===0&&(_r===null?jd([r]):_r.push(r))}return e}function an(r,e=1){var t=c(r),n=e===1?t++:t--;return L(r,t),n}function aa(r){L(r,r.v+1)}function iu(r,e){var t=r.reactions;if(t!==null)for(var n=vi(),i=t.length,o=0;o<i;o++){var u=t[o],h=u.f;if(!(!n&&u===wt)){var p=(h&yr)===0;p&&dr(u,e),(h&vr)!==0?iu(u,ln):p&&((h&fi)!==0&&In!==null&&In.push(u),oi(u))}}}function ht(r){if(typeof r!="object"||r===null||Hr in r)return r;const e=Wa(r);if(e!==Ec&&e!==Ac)return r;var t=new Map,n=Ts(r),i=we(0),o=jn,u=h=>{if(jn===o)return h();var p=St,v=jn;Fr(null),ll(o);var _=h();return Fr(p),ll(v),_};return n&&t.set("length",we(r.length)),new Proxy(r,{defineProperty(h,p,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&Bc();var _=t.get(p);return _===void 0?_=u(()=>{var w=we(v.value);return t.set(p,w),w}):L(_,v.value,!0),!0},deleteProperty(h,p){var v=t.get(p);if(v===void 0){if(p in h){const _=u(()=>we(Qt));t.set(p,_),aa(i)}}else L(v,Qt),aa(i);return!0},get(h,p,v){if(p===Hr)return r;var _=t.get(p),w=p in h;if(_===void 0&&(!w||ni(h,p)?.writable)&&(_=u(()=>{var g=ht(w?h[p]:Qt),b=we(g);return b}),t.set(p,_)),_!==void 0){var E=c(_);return E===Qt?void 0:E}return Reflect.get(h,p,v)},getOwnPropertyDescriptor(h,p){var v=Reflect.getOwnPropertyDescriptor(h,p);if(v&&"value"in v){var _=t.get(p);_&&(v.value=c(_))}else if(v===void 0){var w=t.get(p),E=w?.v;if(w!==void 0&&E!==Qt)return{enumerable:!0,configurable:!0,value:E,writable:!0}}return v},has(h,p){if(p===Hr)return!0;var v=t.get(p),_=v!==void 0&&v.v!==Qt||Reflect.has(h,p);if(v!==void 0||wt!==null&&(!_||ni(h,p)?.writable)){v===void 0&&(v=u(()=>{var E=_?ht(h[p]):Qt,g=we(E);return g}),t.set(p,v));var w=c(v);if(w===Qt)return!1}return _},set(h,p,v,_){var w=t.get(p),E=p in h;if(n&&p==="length")for(var g=v;g<w.v;g+=1){var b=t.get(g+"");b!==void 0?L(b,Qt):g in h&&(b=u(()=>we(Qt)),t.set(g+"",b))}if(w===void 0)(!E||ni(h,p)?.writable)&&(w=u(()=>we(void 0)),L(w,ht(v)),t.set(p,w));else{E=w.v!==Qt;var T=u(()=>ht(v));L(w,T)}var R=Reflect.getOwnPropertyDescriptor(h,p);if(R?.set&&R.set.call(_,v),!E){if(n&&typeof p=="string"){var N=t.get("length"),$=Number(p);Number.isInteger($)&&$>=N.v&&L(N,$+1)}aa(i)}return!0},ownKeys(h){c(i);var p=Reflect.ownKeys(h).filter(w=>{var E=t.get(w);return E===void 0||E.v!==Qt});for(var[v,_]of t)_.v!==Qt&&!(v in h)&&p.push(v);return p},setPrototypeOf(){Wc()}})}function nl(r){try{if(r!==null&&typeof r=="object"&&Hr in r)return r[Hr]}catch{}return r}function _d(r,e){return Object.is(nl(r),nl(e))}var il,su,au,ou;function md(){if(il===void 0){il=window,su=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;au=ni(e,"firstChild").get,ou=ni(e,"nextSibling").get,Zo(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),Zo(t)&&(t.__t=void 0)}}function Mn(r=""){return document.createTextNode(r)}function ci(r){return au.call(r)}function Fs(r){return ou.call(r)}function S(r,e){return ci(r)}function He(r,e){{var t=ci(r);return t instanceof Comment&&t.data===""?Fs(t):t}}function A(r,e=1,t=!1){let n=r;for(;e--;)n=Fs(n);return n}function yd(r){r.textContent=""}function Ja(){return!1}let sl=!1;function bd(){sl||(sl=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{if(!r.defaultPrevented)for(const e of r.target.elements)e.__on_r?.()})},{capture:!0}))}function $s(r){var e=St,t=wt;Fr(null),on(null);try{return r()}finally{Fr(e),on(t)}}function Xa(r,e,t,n=t){r.addEventListener(e,()=>$s(t));const i=r.__on_r;i?r.__on_r=()=>{i(),n(!0)}:r.__on_r=()=>n(!0),bd()}function lu(r){wt===null&&St===null&&$c(),St!==null&&(St.f&mr)!==0&&wt===null&&Fc(),Ln&&Dc()}function wd(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function $r(r,e,t,n=!0){var i=wt;i!==null&&(i.f&xr)!==0&&(r|=xr);var o={ctx:Vt,deps:null,nodes_start:null,nodes_end:null,f:r|yr,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{si(o),o.f|=Va}catch(p){throw Dr(o),p}else e!==null&&oi(o);if(n){var u=o;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Ui)===0&&(u=u.first),u!==null&&(u.parent=i,i!==null&&wd(u,i),St!==null&&(St.f&vr)!==0&&(r&Rn)===0)){var h=St;(h.effects??=[]).push(u)}}return o}function uu(r){const e=$r(Ps,null,!1);return dr(e,rr),e.teardown=r,e}function Tn(r){lu();var e=wt.f,t=!St&&(e&Jr)!==0&&(e&Va)===0;if(t){var n=Vt;(n.e??=[]).push(r)}else return cu(r)}function cu(r){return $r(qa|zl,r,!1)}function kd(r){return lu(),$r(Ps|zl,r,!0)}function Sd(r){ai.ensure();const e=$r(Rn|Ui,r,!0);return(t={})=>new Promise(n=>{t.outro?Ns(e,()=>{Dr(e),n(void 0)}):(Dr(e),n(void 0))})}function du(r){return $r(qa,r,!1)}function Id(r){return $r(Ga|Ui,r,!0)}function Qa(r,e=0){return $r(Ps|e,r,!0)}function be(r,e=[],t=[]){fd(e,t,n=>{$r(Ps,()=>r(...n.map(c)),!0)})}function Us(r,e=0){var t=$r(fi|e,r,!0);return t}function Pn(r,e=!0){return $r(Jr|Ui,r,!0,e)}function fu(r){var e=r.teardown;if(e!==null){const t=Ln,n=St;ol(!0),Fr(null);try{e.call(null)}finally{ol(t),Fr(n)}}}function hu(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){const i=t.ac;i!==null&&$s(()=>{i.abort(za)});var n=t.next;(t.f&Rn)!==0?t.parent=null:Dr(t,e),t=n}}function Ed(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Jr)===0&&Dr(e),e=t}}function Dr(r,e=!0){var t=!1;(e||(r.f&Tc)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(Ad(r.nodes_start,r.nodes_end),t=!0),hu(r,e&&!t),As(r,0),dr(r,On);var n=r.transitions;if(n!==null)for(const o of n)o.stop();fu(r);var i=r.parent;i!==null&&i.first!==null&&vu(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function Ad(r,e){for(;r!==null;){var t=r===e?null:Fs(r);r.remove(),r=t}}function vu(r){var e=r.parent,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Ns(r,e){var t=[];Za(r,t,!0),pu(t,()=>{Dr(r),e&&e()})}function pu(r,e){var t=r.length;if(t>0){var n=()=>--t||e();for(var i of r)i.out(n)}else e()}function Za(r,e,t){if((r.f&xr)===0){if(r.f^=xr,r.transitions!==null)for(const u of r.transitions)(u.is_global||t)&&e.push(u);for(var n=r.first;n!==null;){var i=n.next,o=(n.f&Rs)!==0||(n.f&Jr)!==0;Za(n,e,o?t:!1),n=i}}}function eo(r){gu(r,!0)}function gu(r,e){if((r.f&xr)!==0){r.f^=xr,(r.f&rr)===0&&(dr(r,yr),oi(r));for(var t=r.first;t!==null;){var n=t.next,i=(t.f&Rs)!==0||(t.f&Jr)!==0;gu(t,i?e:!1),t=n}if(r.transitions!==null)for(const o of r.transitions)(o.is_global||e)&&o.in()}}let ei=null;function Cd(r){var e=ei;try{if(ei=new Set,Dn(r),e!==null)for(var t of ei)e.add(t);return ei}finally{ei=e}}function Er(r){for(var e of Cd(r))ui(e,e.v)}let ii=!1;function al(r){ii=r}let Ln=!1;function ol(r){Ln=r}let St=null,Lr=!1;function Fr(r){St=r}let wt=null;function on(r){wt=r}let Kr=null;function _u(r){St!==null&&(Kr===null?Kr=[r]:Kr.push(r))}let sr=null,hr=0,_r=null;function jd(r){_r=r}let mu=1,Li=0,jn=Li;function ll(r){jn=r}let nn=!1;function yu(){return++mu}function Bs(r){var e=r.f;if((e&yr)!==0)return!0;if((e&ln)!==0){var t=r.deps,n=(e&mr)!==0;if(t!==null){var i,o,u=(e&Ss)!==0,h=n&&wt!==null&&!nn,p=t.length;if((u||h)&&(wt===null||(wt.f&On)===0)){var v=r,_=v.parent;for(i=0;i<p;i++)o=t[i],(u||!o?.reactions?.includes(v))&&(o.reactions??=[]).push(v);u&&(v.f^=Ss),h&&_!==null&&(_.f&mr)===0&&(v.f^=mr)}for(i=0;i<p;i++)if(o=t[i],Bs(o)&&eu(o),o.wv>r.wv)return!0}(!n||wt!==null&&!nn)&&dr(r,rr)}return!1}function bu(r,e,t=!0){var n=r.reactions;if(n!==null&&!Kr?.includes(r))for(var i=0;i<n.length;i++){var o=n[i];(o.f&vr)!==0?bu(o,e,!1):e===o&&(t?dr(o,yr):(o.f&rr)!==0&&dr(o,ln),oi(o))}}function wu(r){var e=sr,t=hr,n=_r,i=St,o=nn,u=Kr,h=Vt,p=Lr,v=jn,_=r.f;sr=null,hr=0,_r=null,nn=(_&mr)!==0&&(Lr||!ii||St===null),St=(_&(Jr|Rn))===0?r:null,Kr=null,Is(r.ctx),Lr=!1,jn=++Li,r.ac!==null&&($s(()=>{r.ac.abort(za)}),r.ac=null);try{r.f|=ba;var w=r.fn,E=w(),g=r.deps;if(sr!==null){var b;if(As(r,hr),g!==null&&hr>0)for(g.length=hr+sr.length,b=0;b<sr.length;b++)g[hr+b]=sr[b];else r.deps=g=sr;if(!nn||(_&vr)!==0&&r.reactions!==null)for(b=hr;b<g.length;b++)(g[b].reactions??=[]).push(r)}else g!==null&&hr<g.length&&(As(r,hr),g.length=hr);if(vi()&&_r!==null&&!Lr&&g!==null&&(r.f&(vr|ln|yr))===0)for(b=0;b<_r.length;b++)bu(_r[b],r);return i!==null&&i!==r&&(Li++,_r!==null&&(n===null?n=_r:n.push(..._r))),(r.f&Cn)!==0&&(r.f^=Cn),E}catch(T){return ad(T)}finally{r.f^=ba,sr=e,hr=t,_r=n,St=i,nn=o,Kr=u,Is(h),Lr=p,jn=v}}function xd(r,e){let t=e.reactions;if(t!==null){var n=Ic.call(t,r);if(n!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[n]=t[i],t.pop())}}t===null&&(e.f&vr)!==0&&(sr===null||!sr.includes(e))&&(dr(e,ln),(e.f&(mr|Ss))===0&&(e.f^=Ss),Zl(e),As(e,0))}function As(r,e){var t=r.deps;if(t!==null)for(var n=e;n<t.length;n++)xd(r,t[n])}function si(r){var e=r.f;if((e&On)===0){dr(r,rr);var t=wt,n=ii;wt=r,ii=!0;try{(e&fi)!==0?Ed(r):hu(r),fu(r);var i=wu(r);r.teardown=typeof i=="function"?i:null,r.wv=mu;var o;ql&&nd&&(r.f&yr)!==0&&r.deps}finally{ii=n,wt=t}}}async function ku(){await Promise.resolve(),vd()}function c(r){var e=r.f,t=(e&vr)!==0;if(ei?.add(r),St!==null&&!Lr){var n=wt!==null&&(wt.f&On)!==0;if(!n&&!Kr?.includes(r)){var i=St.deps;if((St.f&ba)!==0)r.rv<Li&&(r.rv=Li,sr===null&&i!==null&&i[hr]===r?hr++:sr===null?sr=[r]:(!nn||!sr.includes(r))&&sr.push(r));else{(St.deps??=[]).push(r);var o=r.reactions;o===null?r.reactions=[St]:o.includes(St)||o.push(St)}}}else if(t&&r.deps===null&&r.effects===null){var u=r,h=u.parent;h!==null&&(h.f&mr)===0&&(u.f^=mr)}if(Ln){if(sn.has(r))return sn.get(r);if(t){u=r;var p=u.v;return((u.f&rr)===0&&u.reactions!==null||Su(u))&&(p=Ya(u)),sn.set(u,p),p}}else t&&(u=r,Bs(u)&&eu(u));if((r.f&Cn)!==0)throw r.v;return r.v}function Su(r){if(r.v===Qt)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(sn.has(e)||(e.f&vr)!==0&&Su(e))return!0;return!1}function Dn(r){var e=Lr;try{return Lr=!0,r()}finally{Lr=e}}const Td=-7169;function dr(r,e){r.f=r.f&Td|e}function Pd(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Hr in r)Sa(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Hr in t&&Sa(t)}}}function Sa(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let n in r)try{Sa(r[n],e)}catch{}const t=Wa(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const n=Vl(t);for(let i in n){const o=n[i].get;if(o)try{o.call(r)}catch{}}}}}const Rd=["touchstart","touchmove"];function Od(r){return Rd.includes(r)}const Iu=new Set,Ia=new Set;function Md(r,e,t,n={}){function i(o){if(n.capture||ji.call(e,o),!o.cancelBubble)return $s(()=>t?.call(this,o))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Ka(()=>{e.addEventListener(r,i,n)}):e.addEventListener(r,i,n),i}function Cs(r,e,t,n,i){var o={capture:n,passive:i},u=Md(r,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&uu(()=>{e.removeEventListener(r,u,o)})}function Dt(r){for(var e=0;e<r.length;e++)Iu.add(r[e]);for(var t of Ia)t(r)}let ul=null;function ji(r){var e=this,t=e.ownerDocument,n=r.type,i=r.composedPath?.()||[],o=i[0]||r.target;ul=r;var u=0,h=ul===r&&r.__root;if(h){var p=i.indexOf(h);if(p!==-1&&(e===document||e===window)){r.__root=e;return}var v=i.indexOf(e);if(v===-1)return;p<=v&&(u=p)}if(o=i[u]||r.target,o!==e){ya(r,"currentTarget",{configurable:!0,get(){return o||t}});var _=St,w=wt;Fr(null),on(null);try{for(var E,g=[];o!==null;){var b=o.assignedSlot||o.parentNode||o.host||null;try{var T=o["__"+n];if(T!=null&&(!o.disabled||r.target===o))if(Ts(T)){var[R,...N]=T;R.apply(o,[r,...N])}else T.call(o,r)}catch($){E?g.push($):E=$}if(r.cancelBubble||b===e||b===null)break;o=b}if(E){for(let $ of g)queueMicrotask(()=>{throw $});throw E}}finally{r.__root=e,delete r.currentTarget,Fr(_),on(w)}}}function Eu(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function Di(r,e){var t=wt;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function V(r,e){var t=(e&Xc)!==0,n=(e&Qc)!==0,i,o=!r.startsWith("<!>");return()=>{i===void 0&&(i=Eu(o?r:"<!>"+r),t||(i=ci(i)));var u=n||su?document.importNode(i,!0):i.cloneNode(!0);if(t){var h=ci(u),p=u.lastChild;Di(h,p)}else Di(u,u);return u}}function Ld(r,e,t="svg"){var n=!r.startsWith("<!>"),i=`<${t}>${n?r:"<!>"+r}</${t}>`,o;return()=>{if(!o){var u=Eu(i),h=ci(u);o=ci(h)}var p=o.cloneNode(!0);return Di(p,p),p}}function Dd(r,e){return Ld(r,e,"svg")}function Ar(r=""){{var e=Mn(r+"");return Di(e,e),e}}function dt(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Mn();return r.append(e,t),Di(e,t),r}function O(r,e){r!==null&&r.before(e)}function pe(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function Fd(r,e){return $d(r,e)}const qn=new Map;function $d(r,{target:e,anchor:t,props:n={},events:i,context:o,intro:u=!0}){md();var h=new Set,p=w=>{for(var E=0;E<w.length;E++){var g=w[E];if(!h.has(g)){h.add(g);var b=Od(g);e.addEventListener(g,ji,{passive:b});var T=qn.get(g);T===void 0?(document.addEventListener(g,ji,{passive:b}),qn.set(g,1)):qn.set(g,T+1)}}};p(Ba(Iu)),Ia.add(p);var v=void 0,_=Sd(()=>{var w=t??e.appendChild(Mn());return Pn(()=>{if(o){Rt({});var E=Vt;E.c=o}i&&(n.$$events=i),v=r(w,n)||{},o&&Ot()}),()=>{for(var E of h){e.removeEventListener(E,ji);var g=qn.get(E);--g===0?(document.removeEventListener(E,ji),qn.delete(E)):qn.set(E,g)}Ia.delete(p),w!==t&&w.parentNode?.removeChild(w)}});return Ud.set(v,_),v}let Ud=new WeakMap;function ye(r,e,t=!1){var n=r,i=null,o=null,u=Qt,h=t?Rs:0,p=!1;const v=(g,b=!0)=>{p=!0,E(b,g)};var _=null;function w(){_!==null&&(_.lastChild.remove(),n.before(_),_=null);var g=u?i:o,b=u?o:i;g&&eo(g),b&&Ns(b,()=>{u?o=null:i=null})}const E=(g,b)=>{if(u!==(u=g)){var T=Ja(),R=n;if(T&&(_=document.createDocumentFragment(),_.append(R=Mn())),u?i??=b&&Pn(()=>b(R)):o??=b&&Pn(()=>b(R)),T){var N=Ut,$=u?i:o,F=u?o:i;$&&N.skipped_effects.delete($),F&&N.skipped_effects.add(F),N.add_callback(w)}else w()}};Us(()=>{p=!1,e(v),p||E(null,null)},h)}function Ea(r,e,t){var n=r,i=Qt,o,u,h=null,p=vi()?rd:Yl;function v(){o&&Ns(o),h!==null&&(h.lastChild.remove(),n.before(h),h=null),o=u}Us(()=>{if(p(i,i=e())){var _=n,w=Ja();w&&(h=document.createDocumentFragment(),h.append(_=Mn())),u=Pn(()=>t(_)),w?Ut.add_callback(v):v()}})}function Lt(r,e){return e}function Nd(r,e,t){for(var n=r.items,i=[],o=e.length,u=0;u<o;u++)Za(e[u].e,i,!0);var h=o>0&&i.length===0&&t!==null;if(h){var p=t.parentNode;yd(p),p.append(t),n.clear(),Or(r,e[0].prev,e[o-1].next)}pu(i,()=>{for(var v=0;v<o;v++){var _=e[v];h||(n.delete(_.k),Or(r,_.prev,_.next)),Dr(_.e,!h)}})}function rt(r,e,t,n,i,o=null){var u=r,h={flags:e,items:new Map,first:null},p=(e&Hl)!==0;if(p){var v=r;u=v.appendChild(Mn())}var _=null,w=!1,E=new Map,g=Ls(()=>{var N=t();return Ts(N)?N:N==null?[]:Ba(N)}),b,T;function R(){Bd(T,b,h,E,u,i,e,n,t),o!==null&&(b.length===0?_?eo(_):_=Pn(()=>o(u)):_!==null&&Ns(_,()=>{_=null}))}Us(()=>{T??=wt,b=c(g);var N=b.length;if(!(w&&N===0)){w=N===0;var $,F,z,K;if(Ja()){var C=new Set,x=Ut;for(F=0;F<N;F+=1){z=b[F],K=n(z,F);var J=h.items.get(K)??E.get(K);J?(e&(Os|Ms))!==0&&Au(J,z,F,e):($=Cu(null,h,null,null,z,K,F,i,e,t,!0),E.set(K,$)),C.add(K)}for(const[X,he]of h.items)C.has(X)||x.skipped_effects.add(he.e);x.add_callback(R)}else R();c(g)}})}function Bd(r,e,t,n,i,o,u,h,p){var v=(u&Vc)!==0,_=(u&(Os|Ms))!==0,w=e.length,E=t.items,g=t.first,b=g,T,R=null,N,$=[],F=[],z,K,C,x;if(v)for(x=0;x<w;x+=1)z=e[x],K=h(z,x),C=E.get(K),C!==void 0&&(C.a?.measure(),(N??=new Set).add(C));for(x=0;x<w;x+=1){if(z=e[x],K=h(z,x),C=E.get(K),C===void 0){var J=n.get(K);if(J!==void 0){n.delete(K),E.set(K,J);var X=R?R.next:b;Or(t,R,J),Or(t,J,X),oa(J,X,i),R=J}else{var he=b?b.e.nodes_start:i;R=Cu(he,t,R,R===null?t.first:R.next,z,K,x,o,u,p)}E.set(K,R),$=[],F=[],b=R.next;continue}if(_&&Au(C,z,x,u),(C.e.f&xr)!==0&&(eo(C.e),v&&(C.a?.unfix(),(N??=new Set).delete(C))),C!==b){if(T!==void 0&&T.has(C)){if($.length<F.length){var re=F[0],ne;R=re.prev;var me=$[0],te=$[$.length-1];for(ne=0;ne<$.length;ne+=1)oa($[ne],re,i);for(ne=0;ne<F.length;ne+=1)T.delete(F[ne]);Or(t,me.prev,te.next),Or(t,R,me),Or(t,te,re),b=re,R=te,x-=1,$=[],F=[]}else T.delete(C),oa(C,b,i),Or(t,C.prev,C.next),Or(t,C,R===null?t.first:R.next),Or(t,R,C),R=C;continue}for($=[],F=[];b!==null&&b.k!==K;)(b.e.f&xr)===0&&(T??=new Set).add(b),F.push(b),b=b.next;if(b===null)continue;C=b}$.push(C),R=C,b=C.next}if(b!==null||T!==void 0){for(var q=T===void 0?[]:Ba(T);b!==null;)(b.e.f&xr)===0&&q.push(b),b=b.next;var ee=q.length;if(ee>0){var P=(u&Hl)!==0&&w===0?i:null;if(v){for(x=0;x<ee;x+=1)q[x].a?.measure();for(x=0;x<ee;x+=1)q[x].a?.fix()}Nd(t,q,P)}}v&&Ka(()=>{if(N!==void 0)for(C of N)C.a?.apply()}),r.first=t.first&&t.first.e,r.last=R&&R.e;for(var D of n.values())Dr(D.e);n.clear()}function Au(r,e,t,n){(n&Os)!==0&&ui(r.v,e),(n&Ms)!==0?ui(r.i,t):r.i=t}function Cu(r,e,t,n,i,o,u,h,p,v,_){var w=(p&Os)!==0,E=(p&Gc)===0,g=w?E?gd(i,!1,!1):li(i):i,b=(p&Ms)===0?u:li(u),T={i:b,v:g,k:o,a:null,e:null,prev:t,next:n};try{if(r===null){var R=document.createDocumentFragment();R.append(r=Mn())}return T.e=Pn(()=>h(r,g,b,v),td),T.e.prev=t&&t.e,T.e.next=n&&n.e,t===null?_||(e.first=T):(t.next=T,t.e.next=T.e),n!==null&&(n.prev=T,n.e.prev=T.e),T}finally{}}function oa(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,o=r.e.nodes_start;o!==null&&o!==n;){var u=Fs(o);i.before(o),o=u}}function Or(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function to(r,e,...t){var n=r,i=Cc,o;Us(()=>{i!==(i=e())&&(o&&(Dr(o),o=null),o=Pn(()=>i(n,...t)))},Rs)}const cl=[...` 	
\r\f \v\uFEFF`];function Wd(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var i in t)if(t[i])n=n?n+" "+i:i;else if(n.length)for(var o=i.length,u=0;(u=n.indexOf(i,u))>=0;){var h=u+o;(u===0||cl.includes(n[u-1]))&&(h===n.length||cl.includes(n[h]))?n=(u===0?"":n.substring(0,u))+n.substring(h+1):u=h}}return n===""?null:n}function qd(r,e){return r==null?null:String(r)}function Nt(r,e,t,n,i,o){var u=r.__className;if(u!==t||u===void 0){var h=Wd(t,n,o);h==null?r.removeAttribute("class"):r.className=h,r.__className=t}else if(o&&i!==o)for(var p in o){var v=!!o[p];(i==null||v!==!!i[p])&&r.classList.toggle(p,v)}return o}function cr(r,e,t,n){var i=r.__style;if(i!==e){var o=qd(e);o==null?r.removeAttribute("style"):r.style.cssText=o,r.__style=e}return n}function tn(r,e,t=!1){if(r.multiple){if(e==null)return;if(!Ts(e))return ed();for(var n of r.options)n.selected=e.includes(Ti(n));return}for(n of r.options){var i=Ti(n);if(_d(i,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function kn(r){var e=new MutationObserver(()=>{tn(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),uu(()=>{e.disconnect()})}function An(r,e,t=e){var n=!0;Xa(r,"change",i=>{var o=i?"[selected]":":checked",u;if(r.multiple)u=[].map.call(r.querySelectorAll(o),Ti);else{var h=r.querySelector(o)??r.querySelector("option:not([disabled])");u=h&&Ti(h)}t(u)}),du(()=>{var i=e();if(tn(r,i,n),n&&i===void 0){var o=r.querySelector(":checked");o!==null&&(i=Ti(o),t(i))}r.__value=i,n=!1}),kn(r)}function Ti(r){return"__value"in r?r.__value:r.value}const Vd=Symbol("is custom element"),Gd=Symbol("is html");function la(r,e){var t=ro(r);t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function zd(r,e){var t=ro(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Ve(r,e,t,n){var i=ro(r);i[e]!==(i[e]=t)&&(e==="loading"&&(r[Rc]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Hd(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function ro(r){return r.__attributes??={[Vd]:r.nodeName.includes("-"),[Gd]:r.namespaceURI===Zc}}var dl=new Map;function Hd(r){var e=r.getAttribute("is")||r.nodeName,t=dl.get(e);if(t)return t;dl.set(e,t=[]);for(var n,i=r,o=Element.prototype;o!==i;){n=Vl(i);for(var u in n)n[u].set&&t.push(u);i=Wa(i)}return t}function nr(r,e,t=e){var n=new WeakSet;Xa(r,"input",async i=>{var o=i?r.defaultValue:r.value;if(o=ua(r)?ca(o):o,t(o),Ut!==null&&n.add(Ut),await ku(),o!==(o=e())){var u=r.selectionStart,h=r.selectionEnd;r.value=o??"",h!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(h,r.value.length))}}),Dn(e)==null&&r.value&&(t(ua(r)?ca(r.value):r.value),Ut!==null&&n.add(Ut)),Qa(()=>{var i=e();if(r===document.activeElement){var o=ys??Ut;if(n.has(o))return}ua(r)&&i===ca(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function fl(r,e,t=e){Xa(r,"change",n=>{var i=n?r.defaultChecked:r.checked;t(i)}),Dn(e)==null&&t(r.checked),Qa(()=>{var n=e();r.checked=!!n})}function ua(r){var e=r.type;return e==="number"||e==="range"}function ca(r){return r===""?null:+r}function hl(r,e){return r===e||r?.[Hr]===e}function Aa(r={},e,t,n){return du(()=>{var i,o;return Qa(()=>{i=o,o=[],Dn(()=>{r!==t(...o)&&(e(r,...o),i&&hl(t(...i),r)&&e(null,...i))})}),()=>{Ka(()=>{o&&hl(t(...o),r)&&e(null,...o)})}}),r}function Bi(r=!1){const e=Vt,t=e.l.u;if(!t)return;let n=()=>Pd(e.s);if(r){let i=0,o={};const u=Ni(()=>{let h=!1;const p=e.s;for(const v in p)p[v]!==o[v]&&(o[v]=p[v],h=!0);return h&&i++,i});n=()=>c(u)}t.b.length&&kd(()=>{vl(e,n),ks(t.b)}),Tn(()=>{const i=Dn(()=>t.m.map(jc));return()=>{for(const o of i)typeof o=="function"&&o()}}),t.a.length&&Tn(()=>{vl(e,n),ks(t.a)})}function vl(r,e){if(r.l.s)for(const t of r.l.s)c(t);e()}function pi(r){var e=li(0);return function(){return arguments.length===1?(L(e,c(e)+1),arguments[0]):(c(e),r())}}let hs=!1;function Kd(r){var e=hs;try{return hs=!1,[r(),hs]}finally{hs=e}}function Ye(r,e,t,n){var i=!hi||(t&Hc)!==0,o=(t&Yc)!==0,u=(t&Jc)!==0,h=n,p=!0,v=()=>(p&&(p=!1,h=u?Dn(n):n),h),_;if(o){var w=Hr in r||Pc in r;_=ni(r,e)?.set??(w&&e in r?F=>r[e]=F:void 0)}var E,g=!1;o?[E,g]=Kd(()=>r[e]):E=r[e],E===void 0&&n!==void 0&&(E=v(),_&&(i&&Nc(),_(E)));var b;if(i?b=()=>{var F=r[e];return F===void 0?v():(p=!0,F)}:b=()=>{var F=r[e];return F!==void 0&&(h=void 0),F===void 0?h:F},i&&(t&Kc)===0)return b;if(_){var T=r.$$legacy;return(function(F,z){return arguments.length>0?((!i||!z||T||g)&&_(z?b():F),F):b()})}var R=!1,N=((t&zc)!==0?Ni:Ls)(()=>(R=!1,b()));o&&c(N);var $=wt;return(function(F,z){if(arguments.length>0){const K=z?c(N):i&&o?ht(F):F;return L(N,K),R=!0,h!==void 0&&(h=K),F}return Ln&&R||($.f&On)!==0?N.v:c(N)})}function or(r){Vt===null&&Mc(),hi&&Vt.l!==null?Yd(Vt).m.push(r):Tn(()=>{const e=Dn(r);if(typeof e=="function")return e})}function Yd(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Jd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Jd);id();const W=ht({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,manualStorySelected:!1,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Zt={get currentDialogue(){return W.data?.dialogues.find(r=>r.id===W.selectedDialogueId)},get currentChapter(){return W.data?.chapters?.find(r=>r.id===W.selectedChapterId)},get currentEditingChapter(){return W.data?.chapters?.find(r=>r.id===W.editingChapterId)},get currentEditingOption(){return Zt.currentDialogue&&W.editingOptionIndex!==null?Zt.currentDialogue.options?.[W.editingOptionIndex]:void 0},get chapterDialogues(){return!W.data?.dialogues||!W.selectedChapterId?[]:W.data.dialogues.filter(r=>r.chapterId===W.selectedChapterId)},get imageResources(){return W.storedFiles.filter(r=>r.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return W.storedFiles.filter(r=>r.name.endsWith(".riv"))},get availableItems(){return W.data?.items||[]},get backlinks(){return!W.data||!W.selectedDialogueId?[]:W.data.dialogues.filter(r=>r.nextDialogueId===W.selectedDialogueId?!0:r.options?r.options.some(e=>e.nextDialogueId===W.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},Et={toggleEditor(){W.showEditor=!W.showEditor},toggleItemsPanel(){W.showItems=!W.showItems},setStatus(r,e){W.statusMessage={type:r,text:e}},clearStatus(){W.statusMessage={type:"",text:""}},selectBucket(r){W.selectedBucket=r,W.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},W.storedFiles=[],W.storiesList=[],W.selectedChapterId=null,W.selectedDialogueId=null},updateBucketsList(r){W.availableBuckets=r},selectChapter(r){W.selectedChapterId=r,W.selectedDialogueId=null},selectDialogue(r){W.selectedDialogueId=r},selectOption(r){W.editingOptionIndex=r},selectItem(r){W.editingItemIndex=r},updateStoryData(r){W.data=r},updateStoredFiles(r){W.storedFiles=r},updateStoriesList(r){W.storiesList=r},setCurrentFileName(r){W.currentFileName=r},addDialogue(r){W.data.dialogues=[...W.data.dialogues,r]},updateDialogue(r,e){W.data.dialogues=W.data.dialogues.map(t=>t.id===r?{...t,...e}:t)},deleteDialogue(r){W.data.dialogues=W.data.dialogues.filter(e=>e.id!==r),W.selectedDialogueId===r&&(W.selectedDialogueId=null)},addChapter(r){W.data.chapters=[...W.data.chapters||[],r]},updateChapter(r,e){W.data.chapters&&(W.data.chapters=W.data.chapters.map(t=>t.id===r?{...t,...e}:t))},selectEditingChapter(r){W.editingChapterId=r},deleteChapter(r){W.data.chapters&&(W.data.chapters=W.data.chapters.filter(e=>e.id!==r),W.selectedChapterId===r&&(W.selectedChapterId=null,W.selectedDialogueId=null))},addItem(r){W.data.items=[...W.data.items||[],r]},updateItem(r,e){W.data.items&&(W.data.items=W.data.items.map(t=>t.id===r?{...t,...e}:t))},deleteItem(r){W.data.items&&(W.data.items=W.data.items.filter(e=>e.id!==r))},reset(){W.showEditor=!1,W.showItems=!1,W.editingOptionIndex=null,W.editingItemIndex=null,W.selectedChapterId=null,W.selectedDialogueId=null,W.statusMessage={type:"",text:""}}},Xd="modulepreload",Qd=function(r,e){return new URL(r,e).href},pl={},Wi=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let v=function(_){return Promise.all(_.map(w=>Promise.resolve(w).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");i=v(t.map(_=>{if(_=Qd(_,n),_ in pl)return;pl[_]=!0;const w=_.endsWith(".css"),E=w?'[rel="stylesheet"]':"";if(!!n)for(let T=u.length-1;T>=0;T--){const R=u[T];if(R.href===_&&(!w||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${E}`))return;const b=document.createElement("link");if(b.rel=w?"stylesheet":Xd,w||(b.as="script"),b.crossOrigin="",b.href=_,p&&b.setAttribute("nonce",p),document.head.appendChild(b),w)return new Promise((T,R)=>{b.addEventListener("load",T),b.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${_}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},Zd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Wi(async()=>{const{default:n}=await Promise.resolve().then(()=>gi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class no extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class ef extends no{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class gl extends no{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class _l extends no{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ca;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Ca||(Ca={}));var tf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};class rf{constructor(e,{headers:t={},customFetch:n,region:i=Ca.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Zd(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return tf(this,void 0,void 0,function*(){try{const{headers:i,method:o,body:u}=t;let h={},{region:p}=t;p||(p=this.region);const v=new URL(`${this.url}/${e}`);p&&p!=="any"&&(h["x-region"]=p,v.searchParams.set("forceFunctionRegion",p));let _;u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(h["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(h["Content-Type"]="application/json",_=JSON.stringify(u)));const w=yield this.fetch(v.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),i),body:_}).catch(T=>{throw new ef(T)}),E=w.headers.get("x-relay-error");if(E&&E==="true")throw new gl(w);if(!w.ok)throw new _l(w);let g=((n=w.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),b;return g==="application/json"?b=yield w.json():g==="application/octet-stream"?b=yield w.blob():g==="text/event-stream"?b=w:g==="multipart/form-data"?b=yield w.formData():b=yield w.text(),{data:b,error:null,response:w}}catch(i){return{data:null,error:i,response:i instanceof _l||i instanceof gl?i.context:void 0}}})}}function nf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function sf(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Xt={},Vn={},Gn={},zn={},Hn={},Kn={},af=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},di=af();const of=di.fetch,ju=di.fetch.bind(di),xu=di.Headers,lf=di.Request,uf=di.Response,gi=Object.freeze(Object.defineProperty({__proto__:null,Headers:xu,Request:lf,Response:uf,default:ju,fetch:of},Symbol.toStringTag,{value:"Module"})),cf=sf(gi);var vs={},ml;function Tu(){if(ml)return vs;ml=1,Object.defineProperty(vs,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return vs.default=r,vs}var yl;function Pu(){if(yl)return Kn;yl=1;var r=Kn&&Kn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Kn,"__esModule",{value:!0});const e=r(cf),t=r(Tu());class n{constructor(o){var u,h;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(u=o.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=o.signal,this.isMaybeSingle=(h=o.isMaybeSingle)!==null&&h!==void 0?h:!1,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,u){return this.headers=new Headers(this.headers),this.headers.set(o,u),this}then(o,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let p=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async v=>{var _,w,E,g;let b=null,T=null,R=null,N=v.status,$=v.statusText;if(v.ok){if(this.method!=="HEAD"){const C=await v.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?T=C:T=JSON.parse(C))}const z=(w=this.headers.get("Prefer"))===null||w===void 0?void 0:w.match(/count=(exact|planned|estimated)/),K=(E=v.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");z&&K&&K.length>1&&(R=parseInt(K[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(T)&&(T.length>1?(b={code:"PGRST116",details:`Results contain ${T.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},T=null,R=null,N=406,$="Not Acceptable"):T.length===1?T=T[0]:T=null)}else{const z=await v.text();try{b=JSON.parse(z),Array.isArray(b)&&v.status===404&&(T=[],b=null,N=200,$="OK")}catch{v.status===404&&z===""?(N=204,$="No Content"):b={message:z}}if(b&&this.isMaybeSingle&&(!((g=b?.details)===null||g===void 0)&&g.includes("0 rows"))&&(b=null,N=200,$="OK"),b&&this.shouldThrowOnError)throw new t.default(b)}return{error:b,data:T,count:R,status:N,statusText:$}});return this.shouldThrowOnError||(p=p.catch(v=>{var _,w,E;return{error:{message:`${(_=v?.name)!==null&&_!==void 0?_:"FetchError"}: ${v?.message}`,details:`${(w=v?.stack)!==null&&w!==void 0?w:""}`,hint:"",code:`${(E=v?.code)!==null&&E!==void 0?E:""}`},data:null,count:null,status:0,statusText:""}})),p.then(o,u)}returns(){return this}overrideTypes(){return this}}return Kn.default=n,Kn}var bl;function Ru(){if(bl)return Hn;bl=1;var r=Hn&&Hn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hn,"__esModule",{value:!0});const e=r(Pu());class t extends e.default{select(i){let o=!1;const u=(i??"*").split("").map(h=>/\s/.test(h)&&!o?"":(h==='"'&&(o=!o),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:o=!0,nullsFirst:u,foreignTable:h,referencedTable:p=h}={}){const v=p?`${p}.order`:"order",_=this.url.searchParams.get(v);return this.url.searchParams.set(v,`${_?`${_},`:""}${i}.${o?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:o,referencedTable:u=o}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${i}`),this}range(i,o,{foreignTable:u,referencedTable:h=u}={}){const p=typeof h>"u"?"offset":`${h}.offset`,v=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(p,`${i}`),this.url.searchParams.set(v,`${o-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:o=!1,settings:u=!1,buffers:h=!1,wal:p=!1,format:v="text"}={}){var _;const w=[i?"analyze":null,o?"verbose":null,u?"settings":null,h?"buffers":null,p?"wal":null].filter(Boolean).join("|"),E=(_=this.headers.get("Accept"))!==null&&_!==void 0?_:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${v}; for="${E}"; options=${w};`),v==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Hn.default=t,Hn}var wl;function io(){if(wl)return zn;wl=1;var r=zn&&zn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(zn,"__esModule",{value:!0});const e=r(Ru());class t extends e.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}in(i,o){const u=Array.from(new Set(o)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:u,type:h}={}){let p="";h==="plain"?p="pl":h==="phrase"?p="ph":h==="websearch"&&(p="w");const v=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${p}fts${v}.${o}`),this}match(i){return Object.entries(i).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(i,o,u){return this.url.searchParams.append(i,`not.${o}.${u}`),this}or(i,{foreignTable:o,referencedTable:u=o}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${i})`),this}filter(i,o,u){return this.url.searchParams.append(i,`${o}.${u}`),this}}return zn.default=t,zn}var kl;function Ou(){if(kl)return Gn;kl=1;var r=Gn&&Gn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Gn,"__esModule",{value:!0});const e=r(io());class t{constructor(i,{headers:o={},schema:u,fetch:h}){this.url=i,this.headers=new Headers(o),this.schema=u,this.fetch=h}select(i,{head:o=!1,count:u}={}){const h=o?"HEAD":"GET";let p=!1;const v=(i??"*").split("").map(_=>/\s/.test(_)&&!p?"":(_==='"'&&(p=!p),_)).join("");return this.url.searchParams.set("select",v),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:o,defaultToNull:u=!0}={}){var h;const p="POST";if(o&&this.headers.append("Prefer",`count=${o}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const v=i.reduce((_,w)=>_.concat(Object.keys(w)),[]);if(v.length>0){const _=[...new Set(v)].map(w=>`"${w}"`);this.url.searchParams.set("columns",_.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(i,{onConflict:o,ignoreDuplicates:u=!1,count:h,defaultToNull:p=!0}={}){var v;const _="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),h&&this.headers.append("Prefer",`count=${h}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const w=i.reduce((E,g)=>E.concat(Object.keys(g)),[]);if(w.length>0){const E=[...new Set(w)].map(g=>`"${g}"`);this.url.searchParams.set("columns",E.join(","))}}return new e.default({method:_,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}update(i,{count:o}={}){var u;const h="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:i}={}){var o;const u="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return Gn.default=t,Gn}var Sl;function df(){if(Sl)return Vn;Sl=1;var r=Vn&&Vn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Vn,"__esModule",{value:!0});const e=r(Ou()),t=r(io());class n{constructor(o,{headers:u={},schema:h,fetch:p}={}){this.url=o,this.headers=new Headers(u),this.schemaName=h,this.fetch=p}from(o){const u=new URL(`${this.url}/${o}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,u={},{head:h=!1,get:p=!1,count:v}={}){var _;let w;const E=new URL(`${this.url}/rpc/${o}`);let g;h||p?(w=h?"HEAD":"GET",Object.entries(u).filter(([T,R])=>R!==void 0).map(([T,R])=>[T,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([T,R])=>{E.searchParams.append(T,R)})):(w="POST",g=u);const b=new Headers(this.headers);return v&&b.set("Prefer",`count=${v}`),new t.default({method:w,url:E,headers:b,schema:this.schemaName,body:g,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return Vn.default=n,Vn}var Il;function ff(){if(Il)return Xt;Il=1;var r=Xt&&Xt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.PostgrestError=Xt.PostgrestBuilder=Xt.PostgrestTransformBuilder=Xt.PostgrestFilterBuilder=Xt.PostgrestQueryBuilder=Xt.PostgrestClient=void 0;const e=r(df());Xt.PostgrestClient=e.default;const t=r(Ou());Xt.PostgrestQueryBuilder=t.default;const n=r(io());Xt.PostgrestFilterBuilder=n.default;const i=r(Ru());Xt.PostgrestTransformBuilder=i.default;const o=r(Pu());Xt.PostgrestBuilder=o.default;const u=r(Tu());return Xt.PostgrestError=u.default,Xt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:o.default,PostgrestError:u.default},Xt}var hf=ff();const vf=nf(hf),{PostgrestClient:pf,PostgrestQueryBuilder:ty,PostgrestFilterBuilder:ry,PostgrestTransformBuilder:ny,PostgrestBuilder:iy,PostgrestError:sy}=vf;class gf{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const _f="2.15.1",mf=`realtime-js/${_f}`,yf="1.0.0",ja=1e4,bf=1e3,wf=100;var Pi;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Pi||(Pi={}));var Ht;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ht||(Ht={}));var Cr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Cr||(Cr={}));var xa;(function(r){r.websocket="websocket"})(xa||(xa={}));var En;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(En||(En={}));class kf{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const i=t.getUint8(1),o=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=n.decode(e.slice(u,u+i));u=u+i;const p=n.decode(e.slice(u,u+o));u=u+o;const v=JSON.parse(n.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:p,payload:v}}}class Mu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ft;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Ft||(Ft={}));const El=(r,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((o,u)=>(o[u]=Sf(u,r,e,i),o),{})},Sf=(r,e,t,n)=>{const i=e.find(h=>h.name===r),o=i?.type,u=t[r];return o&&!n.includes(o)?Lu(o,u):Ta(u)},Lu=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Cf(e,t)}switch(r){case Ft.bool:return If(e);case Ft.float4:case Ft.float8:case Ft.int2:case Ft.int4:case Ft.int8:case Ft.numeric:case Ft.oid:return Ef(e);case Ft.json:case Ft.jsonb:return Af(e);case Ft.timestamp:return jf(e);case Ft.abstime:case Ft.date:case Ft.daterange:case Ft.int4range:case Ft.int8range:case Ft.money:case Ft.reltime:case Ft.text:case Ft.time:case Ft.timestamptz:case Ft.timetz:case Ft.tsrange:case Ft.tstzrange:return Ta(e);default:return Ta(e)}},Ta=r=>r,If=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Ef=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Af=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Cf=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let o;const u=r.slice(1,t);try{o=JSON.parse("["+u+"]")}catch{o=u?u.split(","):[]}return o.map(h=>Lu(e,h))}return r},jf=r=>typeof r=="string"?r.replace(" ","T"):r,Du=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class da{constructor(e,t,n={},i=ja){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Al;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Al||(Al={}));class Ri{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:o,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ri.syncState(this.state,i,o,u),this.pendingDiffs.forEach(p=>{this.state=Ri.syncDiff(this.state,p,o,u)}),this.pendingDiffs=[],h()}),this.channel._on(n.diff,{},i=>{const{onJoin:o,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ri.syncDiff(this.state,i,o,u),h())}),this.onJoin((i,o,u)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:o,newPresences:u})}),this.onLeave((i,o,u)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:o,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const o=this.cloneDeep(e),u=this.transformState(t),h={},p={};return this.map(o,(v,_)=>{u[v]||(p[v]=_)}),this.map(u,(v,_)=>{const w=o[v];if(w){const E=_.map(R=>R.presence_ref),g=w.map(R=>R.presence_ref),b=_.filter(R=>g.indexOf(R.presence_ref)<0),T=w.filter(R=>E.indexOf(R.presence_ref)<0);b.length>0&&(h[v]=b),T.length>0&&(p[v]=T)}else h[v]=_}),this.syncDiff(o,{joins:h,leaves:p},n,i)}static syncDiff(e,t,n,i){const{joins:o,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(o,(h,p)=>{var v;const _=(v=e[h])!==null&&v!==void 0?v:[];if(e[h]=this.cloneDeep(p),_.length>0){const w=e[h].map(g=>g.presence_ref),E=_.filter(g=>w.indexOf(g.presence_ref)<0);e[h].unshift(...E)}n(h,_,p)}),this.map(u,(h,p)=>{let v=e[h];if(!v)return;const _=p.map(w=>w.presence_ref);v=v.filter(w=>_.indexOf(w.presence_ref)<0),e[h]=v,i(h,v,p),v.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Cl;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Cl||(Cl={}));var Oi;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Oi||(Oi={}));var Gr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Gr||(Gr={}));class so{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Ht.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new da(this,Cr.join,this.params,this.timeout),this.rejoinTimer=new Mu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ht.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ht.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ht.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ht.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ht.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Cr.reply,{},(i,o)=>{this._trigger(this._replyEventName(o),i)}),this.presence=new Ri(this),this.broadcastEndpointURL=Du(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Ht.closed){const{config:{broadcast:o,presence:u,private:h}}=this.params,p=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(E=>E.filter))!==null&&i!==void 0?i:[],v=!!this.bindings[Oi.PRESENCE]&&this.bindings[Oi.PRESENCE].length>0,_={},w={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:v}),postgres_changes:p,private:h};this.socket.accessTokenValue&&(_.access_token=this.socket.accessTokenValue),this._onError(E=>e?.(Gr.CHANNEL_ERROR,E)),this._onClose(()=>e?.(Gr.CLOSED)),this.updateJoinPayload(Object.assign({config:w},_)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:E})=>{var g;if(this.socket.setAuth(),E===void 0){e?.(Gr.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,T=(g=b?.length)!==null&&g!==void 0?g:0,R=[];for(let N=0;N<T;N++){const $=b[N],{filter:{event:F,schema:z,table:K,filter:C}}=$,x=E&&E[N];if(x&&x.event===F&&x.schema===z&&x.table===K&&x.filter===C)R.push(Object.assign(Object.assign({},$),{id:x.id}));else{this.unsubscribe(),this.state=Ht.errored,e?.(Gr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,e&&e(Gr.SUBSCRIBED);return}}).receive("error",E=>{this.state=Ht.errored,e?.(Gr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(E).join(", ")||"error")))}).receive("timeout",()=>{e?.(Gr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Ht.joined&&e===Oi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:u}=e,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:u,private:this.private}]})};try{const v=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=v.body)===null||i===void 0?void 0:i.cancel()),v.ok?"ok":"error"}catch(v){return v.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var u,h,p;const v=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),v.receive("ok",()=>o("ok")),v.receive("error",()=>o("error")),v.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ht.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Cr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new da(this,Cr.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ht.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,o=setTimeout(()=>i.abort(),n),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(o),u}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new da(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>wf){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,o;const u=e.toLocaleLowerCase(),{close:h,error:p,leave:v,join:_}=Cr;if(n&&[h,p,v,_].indexOf(u)>=0&&n!==this._joinRef())return;let E=this._onMessage(u,t,n);if(t&&!E)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var b,T,R;return((b=g.filter)===null||b===void 0?void 0:b.event)==="*"||((R=(T=g.filter)===null||T===void 0?void 0:T.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===u}).map(g=>g.callback(E,n)):(o=this.bindings[u])===null||o===void 0||o.filter(g=>{var b,T,R,N,$,F;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in g){const z=g.id,K=(b=g.filter)===null||b===void 0?void 0:b.event;return z&&((T=t.ids)===null||T===void 0?void 0:T.includes(z))&&(K==="*"||K?.toLocaleLowerCase()===((R=t.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const z=($=(N=g?.filter)===null||N===void 0?void 0:N.event)===null||$===void 0?void 0:$.toLocaleLowerCase();return z==="*"||z===((F=t?.event)===null||F===void 0?void 0:F.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===u}).map(g=>{if(typeof E=="object"&&"ids"in E){const b=E.data,{schema:T,table:R,commit_timestamp:N,type:$,errors:F}=b;E=Object.assign(Object.assign({},{schema:T,table:R,commit_timestamp:N,eventType:$,new:{},old:{},errors:F}),this._getPayloadRecords(b))}g.callback(E,n)})}_isClosed(){return this.state===Ht.closed}_isJoined(){return this.state===Ht.joined}_isJoining(){return this.state===Ht.joining}_isLeaving(){return this.state===Ht.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),o={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(o):this.bindings[i]=[o],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var o;return!(((o=i.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&so.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Cr.close,{},e)}_onError(e){this._on(Cr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ht.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=El(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=El(e.columns,e.old_record)),t}}const jl=()=>{},ps={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},xf=[1e3,2e3,5e3,1e4],Tf=1e4,Pf=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Rf{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ja,this.transport=null,this.heartbeatIntervalMs=ps.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=jl,this.ref=0,this.reconnectTimer=null,this.logger=jl,this.conn=null,this.sendBuffer=[],this.serializer=new kf,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...u)=>Wi(async()=>{const{default:h}=await Promise.resolve().then(()=>gi);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...u)=>o(...u)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${xa.websocket}`,this.httpEndpoint=Du(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=gf.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:yf}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Pi.connecting:return En.Connecting;case Pi.open:return En.Open;case Pi.closing:return En.Closing;default:return En.Closed}}isConnected(){return this.connectionState()===En.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(o=>o.topic===n);if(i)return i;{const o=new so(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:n,payload:i,ref:o}=e,u=()=>{this.encode(e,h=>{var p;(p=this.conn)===null||p===void 0||p.send(h)})};this.log("push",`${t} ${n} (${o})`,i),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(bf,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ps.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:o,ref:u}=t,h=u?`(${u})`:"",p=o.status||"";this.log("receive",`${p} ${n} ${i} ${h}`.trim(),o),this.channels.filter(v=>v._isMember(n)).forEach(v=>v._trigger(i,o,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Cr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([Pf],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:mf};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(Cr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Mu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ps.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,o,u,h,p,v;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:ja,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:ps.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(_=>xf[_-1]||Tf),this.encode=(p=e?.encode)!==null&&p!==void 0?p:((_,w)=>w(JSON.stringify(_))),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class ao extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Kt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Of extends ao{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Pa extends ao{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Mf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};const Fu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Wi(async()=>{const{default:n}=await Promise.resolve().then(()=>gi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Lf=()=>Mf(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Wi(()=>Promise.resolve().then(()=>gi),void 0,import.meta.url)).Response:Response}),Ra=r=>{if(Array.isArray(r))return r.map(t=>Ra(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[i]=Ra(n)}),e},Df=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var Fn=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};const fa=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Ff=(r,e,t)=>Fn(void 0,void 0,void 0,function*(){const n=yield Lf();r instanceof n&&!t?.noResolveJson?r.json().then(i=>{const o=r.status||500,u=i?.statusCode||o+"";e(new Of(fa(i),o,u))}).catch(i=>{e(new Pa(fa(i),i))}):e(new Pa(fa(r),r))}),$f=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"||!n?i:(Df(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function qi(r,e,t,n,i,o){return Fn(this,void 0,void 0,function*(){return new Promise((u,h)=>{r(t,$f(e,n,i,o)).then(p=>{if(!p.ok)throw p;return n?.noResolveJson?p:p.json()}).then(p=>u(p)).catch(p=>Ff(p,h,n))})})}function js(r,e,t,n){return Fn(this,void 0,void 0,function*(){return qi(r,"GET",e,t,n)})}function Mr(r,e,t,n,i){return Fn(this,void 0,void 0,function*(){return qi(r,"POST",e,n,i,t)})}function Oa(r,e,t,n,i){return Fn(this,void 0,void 0,function*(){return qi(r,"PUT",e,n,i,t)})}function Uf(r,e,t,n){return Fn(this,void 0,void 0,function*(){return qi(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function $u(r,e,t,n,i){return Fn(this,void 0,void 0,function*(){return qi(r,"DELETE",e,n,i,t)})}var ir=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};const Nf={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Bf{constructor(e,t={},n,i){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Fu(i)}uploadOrUpdate(e,t,n,i){return ir(this,void 0,void 0,function*(){try{let o;const u=Object.assign(Object.assign({},xl),i);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const p=u.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",u.cacheControl),p&&o.append("metadata",this.encodeMetadata(p)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",u.cacheControl),p&&o.append("metadata",this.encodeMetadata(p))):(o=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,p&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(p)))),i?.headers&&(h=Object.assign(Object.assign({},h),i.headers));const v=this._removeEmptyFolders(t),_=this._getFinalPath(v),w=yield(e=="PUT"?Oa:Mr)(this.fetch,`${this.url}/object/${_}`,o,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:v,id:w.Id,fullPath:w.Key},error:null}}catch(o){if(Kt(o))return{data:null,error:o};throw o}})}upload(e,t,n){return ir(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return ir(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),u=this._getFinalPath(o),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let p;const v=Object.assign({upsert:xl.upsert},i),_=Object.assign(Object.assign({},this.headers),{"x-upsert":String(v.upsert)});typeof Blob<"u"&&n instanceof Blob?(p=new FormData,p.append("cacheControl",v.cacheControl),p.append("",n)):typeof FormData<"u"&&n instanceof FormData?(p=n,p.append("cacheControl",v.cacheControl)):(p=n,_["cache-control"]=`max-age=${v.cacheControl}`,_["content-type"]=v.contentType);const w=yield Oa(this.fetch,h.toString(),p,{headers:_});return{data:{path:o,fullPath:w.Key},error:null}}catch(p){if(Kt(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,t){return ir(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const o=yield Mr(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),u=new URL(this.url+o.url),h=u.searchParams.get("token");if(!h)throw new ao("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(n){if(Kt(n))return{data:null,error:n};throw n}})}update(e,t,n){return ir(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return ir(this,void 0,void 0,function*(){try{return{data:yield Mr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Kt(i))return{data:null,error:i};throw i}})}copy(e,t,n){return ir(this,void 0,void 0,function*(){try{return{data:{path:(yield Mr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Kt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return ir(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),o=yield Mr(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const u=n?.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${u}`)},{data:o,error:null}}catch(i){if(Kt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return ir(this,void 0,void 0,function*(){try{const i=yield Mr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${o}`):null})),error:null}}catch(i){if(Kt(i))return{data:null,error:i};throw i}})}download(e,t){return ir(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield js(this.fetch,`${this.url}/${i}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Kt(h))return{data:null,error:h};throw h}})}info(e){return ir(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield js(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ra(n),error:null}}catch(n){if(Kt(n))return{data:null,error:n};throw n}})}exists(e){return ir(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Uf(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Kt(n)&&n instanceof Pa){const i=n.originalError;if([400,404].includes(i?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),i=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&i.push(o);const h=typeof t?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(t?.transform||{});p!==""&&i.push(p);let v=i.join("&");return v!==""&&(v=`?${v}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${n}${v}`)}}}remove(e){return ir(this,void 0,void 0,function*(){try{return{data:yield $u(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Kt(t))return{data:null,error:t};throw t}})}list(e,t,n){return ir(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Nf),t),{prefix:e||""});return{data:yield Mr(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(Kt(i))return{data:null,error:i};throw i}})}listV2(e,t){return ir(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Mr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(Kt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Wf="2.11.0",qf={"X-Client-Info":`storage-js/${Wf}`};var Yn=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};class Vf{constructor(e,t={},n,i){const o=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},qf),t),this.fetch=Fu(n)}listBuckets(){return Yn(this,void 0,void 0,function*(){try{return{data:yield js(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Kt(e))return{data:null,error:e};throw e}})}getBucket(e){return Yn(this,void 0,void 0,function*(){try{return{data:yield js(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Kt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Yn(this,void 0,void 0,function*(){try{return{data:yield Mr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Kt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Yn(this,void 0,void 0,function*(){try{return{data:yield Oa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Kt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Yn(this,void 0,void 0,function*(){try{return{data:yield Mr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Kt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Yn(this,void 0,void 0,function*(){try{return{data:yield $u(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Kt(t))return{data:null,error:t};throw t}})}}class Gf extends Vf{constructor(e,t={},n,i){super(e,t,n,i)}from(e){return new Bf(this.url,this.headers,e,this.fetch)}}const zf="2.56.0";let xi="";typeof Deno<"u"?xi="deno":typeof document<"u"?xi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?xi="react-native":xi="node";const Hf={"X-Client-Info":`supabase-js-${xi}/${zf}`},Kf={headers:Hf},Yf={schema:"public"},Jf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Xf={};var Qf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};const Zf=r=>{let e;return r?e=r:typeof fetch>"u"?e=ju:e=fetch,(...t)=>e(...t)},eh=()=>typeof Headers>"u"?xu:Headers,th=(r,e,t)=>{const n=Zf(t),i=eh();return(o,u)=>Qf(void 0,void 0,void 0,function*(){var h;const p=(h=yield e())!==null&&h!==void 0?h:r;let v=new i(u?.headers);return v.has("apikey")||v.set("apikey",r),v.has("Authorization")||v.set("Authorization",`Bearer ${p}`),n(o,Object.assign(Object.assign({},u),{headers:v}))})};var rh=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};function nh(r){return r.endsWith("/")?r:r+"/"}function ih(r,e){var t,n;const{db:i,auth:o,realtime:u,global:h}=r,{db:p,auth:v,realtime:_,global:w}=e,E={db:Object.assign(Object.assign({},p),i),auth:Object.assign(Object.assign({},v),o),realtime:Object.assign(Object.assign({},_),u),storage:{},global:Object.assign(Object.assign(Object.assign({},w),h),{headers:Object.assign(Object.assign({},(t=w?.headers)!==null&&t!==void 0?t:{}),(n=h?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>rh(this,void 0,void 0,function*(){return""})};return r.accessToken?E.accessToken=r.accessToken:delete E.accessToken,E}const Uu="2.71.1",ti=30*1e3,Ma=3,ha=Ma*ti,sh="http://localhost:9999",ah="supabase.auth.token",oh={"X-Client-Info":`gotrue-js/${Uu}`},La="X-Supabase-Api-Version",Nu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},lh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,uh=600*1e3;class oo extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function nt(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class ch extends oo{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function dh(r){return nt(r)&&r.name==="AuthApiError"}class Bu extends oo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class un extends oo{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class en extends un{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fh(r){return nt(r)&&r.name==="AuthSessionMissingError"}class gs extends un{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _s extends un{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ms extends un{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function hh(r){return nt(r)&&r.name==="AuthImplicitGrantRedirectError"}class Tl extends un{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Da extends un{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function va(r){return nt(r)&&r.name==="AuthRetryableFetchError"}class Pl extends un{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Fa extends un{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const xs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rl=` 	
\r=`.split(""),vh=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Rl.length;e+=1)r[Rl[e].charCodeAt(0)]=-2;for(let e=0;e<xs.length;e+=1)r[xs[e].charCodeAt(0)]=e;return r})();function Ol(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(xs[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(xs[n]),e.queuedBits-=6}}function Wu(r,e,t){const n=vh[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Ml(r){const e=[],t=u=>{e.push(String.fromCodePoint(u))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},o=u=>{_h(u,n,t)};for(let u=0;u<r.length;u+=1)Wu(r.charCodeAt(u),i,o);return e.join("")}function ph(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function gh(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}ph(n,e)}}function _h(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function mh(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Wu(r.charCodeAt(i),t,n);return new Uint8Array(e)}function yh(r){const e=[];return gh(r,t=>e.push(t)),new Uint8Array(e)}function bh(r){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return r.forEach(i=>Ol(i,t,n)),Ol(null,t,n),e.join("")}function wh(r){return Math.round(Date.now()/1e3)+r}function kh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Ir=()=>typeof window<"u"&&typeof document<"u",bn={tested:!1,writable:!1},qu=()=>{if(!Ir())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(bn.tested)return bn.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),bn.tested=!0,bn.writable=!0}catch{bn.tested=!0,bn.writable=!1}return bn.writable};function Sh(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,o)=>{e[o]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const Vu=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Wi(async()=>{const{default:n}=await Promise.resolve().then(()=>gi);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Ih=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ri=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},wn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Zr=async(r,e)=>{await r.removeItem(e)};class Ws{constructor(){this.promise=new Ws.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ws.promiseConstructor=Promise;function pa(r){const e=r.split(".");if(e.length!==3)throw new Fa("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!lh.test(e[n]))throw new Fa("JWT not in base64url format");return{header:JSON.parse(Ml(e[0])),payload:JSON.parse(Ml(e[1])),signature:mh(e[2]),raw:{header:e[0],payload:e[1]}}}async function Eh(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Ah(r,e){return new Promise((n,i)=>{(async()=>{for(let o=0;o<1/0;o++)try{const u=await r(o);if(!e(o,null,u)){n(u);return}}catch(u){if(!e(o,u)){i(u);return}}})()})}function Ch(r){return("0"+r.toString(16)).substr(-2)}function jh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let o=0;o<56;o++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,Ch).join("")}async function xh(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(o=>String.fromCharCode(o)).join("")}async function Th(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await xh(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Jn(r,e,t=!1){const n=jh();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await ri(r,`${e}-code-verifier`,i);const o=await Th(n);return[o,n===o?"plain":"s256"]}const Ph=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Rh(r){const e=r.headers.get(La);if(!e||!e.match(Ph))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Oh(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Mh(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Lh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Xn(r){if(!Lh.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ga(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ll(r){return JSON.parse(JSON.stringify(r))}var Dh=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const Sn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Fh=[502,503,504];async function Dl(r){var e;if(!Ih(r))throw new Da(Sn(r),0);if(Fh.includes(r.status))throw new Da(Sn(r),r.status);let t;try{t=await r.json()}catch(o){throw new Bu(Sn(o),o)}let n;const i=Rh(r);if(i&&i.getTime()>=Nu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Pl(Sn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new en}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0))throw new Pl(Sn(t),r.status,t.weak_password.reasons);throw new ch(Sn(t),r.status||500,n)}const $h=(r,e,t,n)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function ft(r,e,t,n){var i;const o=Object.assign({},n?.headers);o[La]||(o[La]=Nu["2024-01-01"].name),n?.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const u=(i=n?.query)!==null&&i!==void 0?i:{};n?.redirectTo&&(u.redirect_to=n.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",p=await Uh(r,e,t+h,{headers:o,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(p):{data:Object.assign({},p),error:null}}async function Uh(r,e,t,n,i,o){const u=$h(e,n,i,o);let h;try{h=await r(t,Object.assign({},u))}catch(p){throw console.error(p),new Da(Sn(p),0)}if(h.ok||await Dl(h),n?.noResolveJson)return h;try{return await h.json()}catch(p){await Dl(p)}}function Vr(r){var e;let t=null;qh(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=wh(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function Fl(r){const e=Vr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function rn(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Nh(r){return{data:r,error:null}}function Bh(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:o}=r,u=Dh(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:o},p=Object.assign({},u);return{data:{properties:h,user:p},error:null}}function Wh(r){return r}function qh(r){return r.access_token&&r.refresh_token&&r.expires_in}const _a=["global","local","others"];var Vh=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Gh{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Vu(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=_a[0]){if(_a.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_a.join(", ")}`);try{return await ft(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(nt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await ft(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:rn})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Vh(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n?.newEmail,delete i.newEmail),await ft(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Bh,redirectTo:t?.redirectTo})}catch(t){if(nt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ft(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:rn})}catch(t){if(nt(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,o,u,h,p;try{const v={nextPage:null,lastPage:0,total:0},_=await ft(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(o=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:Wh});if(_.error)throw _.error;const w=await _.json(),E=(u=_.headers.get("x-total-count"))!==null&&u!==void 0?u:0,g=(p=(h=_.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&p!==void 0?p:[];return g.length>0&&(g.forEach(b=>{const T=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(b.split(";")[1].split("=")[1]);v[`${R}Page`]=T}),v.total=parseInt(E)),{data:Object.assign(Object.assign({},w),v),error:null}}catch(v){if(nt(v))return{data:{users:[]},error:v};throw v}}async getUserById(e){Xn(e);try{return await ft(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:rn})}catch(t){if(nt(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Xn(e);try{return await ft(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:rn})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Xn(e);try{return await ft(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:rn})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Xn(e.userId);try{const{data:t,error:n}=await ft(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(nt(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Xn(e.userId),Xn(e.id);try{return{data:await ft(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(nt(t))return{data:null,error:t};throw t}}}function $l(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function zh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Qn={debug:!!(globalThis&&qu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Gu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Hh extends Gu{}async function Kh(r,e,t){Qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Qn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){Qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Hh(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Qn.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}zh();const Yh={url:sh,storageKey:ah,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:oh,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ul(r,e,t){return await t()}const Zn={};class Fi{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Fi.nextInstanceID,Fi.nextInstanceID+=1,this.instanceID>0&&Ir()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Yh),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Gh({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Vu(i.fetch),this.lock=i.lock||Ul,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ir()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Kh:this.lock=Ul,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:qu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$l(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=$l(this.memoryStorage)),Ir()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Zn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Zn[this.storageKey]=Object.assign(Object.assign({},Zn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Zn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Zn[this.storageKey]=Object.assign(Object.assign({},Zn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Uu}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Sh(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Ir()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:o}=await this._getSessionFromURL(t,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),hh(o)){const p=(e=o.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:u,redirectType:h}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return nt(t)?{error:t}:{error:new Bu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const o=await ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Vr}),{data:u,error:h}=o;if(h||!u)return{data:{user:null,session:null},error:h};const p=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(o){if(nt(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,n,i;try{let o;if("email"in e){const{email:_,password:w,options:E}=e;let g=null,b=null;this.flowType==="pkce"&&([g,b]=await Jn(this.storage,this.storageKey)),o=await ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:E?.emailRedirectTo,body:{email:_,password:w,data:(t=E?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:E?.captchaToken},code_challenge:g,code_challenge_method:b},xform:Vr})}else if("phone"in e){const{phone:_,password:w,options:E}=e;o=await ft(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:_,password:w,data:(n=E?.data)!==null&&n!==void 0?n:{},channel:(i=E?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:E?.captchaToken}},xform:Vr})}else throw new _s("You must provide either an email or phone number and a password");const{data:u,error:h}=o;if(h||!u)return{data:{user:null,session:null},error:h};const p=u.session,v=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(o){if(nt(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:u,options:h}=e;t=await ft(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Fl})}else if("phone"in e){const{phone:o,password:u,options:h}=e;t=await ft(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Fl})}else throw new _s("You must provide either an email or phone number and a password");const{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new gs}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,i,o,u,h,p,v,_,w,E,g;let b,T;if("message"in e)b=e.message,T=e.signature;else{const{chain:R,wallet:N,statement:$,options:F}=e;let z;if(Ir())if(typeof N=="object")z=N;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))z=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!F?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=N}const K=new URL((t=F?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const C=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},F?.signInWithSolana),{version:"1",domain:K.host,uri:K.href}),$?{statement:$}:null));let x;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")x=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)x=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in x&&"signature"in x&&(typeof x.signedMessage=="string"||x.signedMessage instanceof Uint8Array)&&x.signature instanceof Uint8Array)b=typeof x.signedMessage=="string"?x.signedMessage:new TextDecoder().decode(x.signedMessage),T=x.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${K.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...$?["",$,""]:[""],"Version: 1",`URI: ${K.href}`,`Issued At: ${(i=(n=F?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((o=F?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${F.signInWithSolana.notBefore}`]:[],...!((u=F?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${F.signInWithSolana.expirationTime}`]:[],...!((h=F?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${F.signInWithSolana.chainId}`]:[],...!((p=F?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${F.signInWithSolana.nonce}`]:[],...!((v=F?.signInWithSolana)===null||v===void 0)&&v.requestId?[`Request ID: ${F.signInWithSolana.requestId}`]:[],...!((w=(_=F?.signInWithSolana)===null||_===void 0?void 0:_.resources)===null||w===void 0)&&w.length?["Resources",...F.signInWithSolana.resources.map(x=>`- ${x}`)]:[]].join(`
`);const C=await z.signMessage(new TextEncoder().encode(b),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=C}}try{const{data:R,error:N}=await ft(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:bh(T)},!((E=e.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Vr});if(N)throw N;return!R||!R.session||!R.user?{data:{user:null,session:null},error:new gs}:(R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),{data:Object.assign({},R),error:N})}catch(R){if(nt(R))return{data:{user:null,session:null},error:R};throw R}}async _exchangeCodeForSession(e){const t=await wn(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{const{data:o,error:u}=await ft(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Vr});if(await Zr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new gs}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:i??null}),error:u})}catch(o){if(nt(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:o,nonce:u}=e,h=await ft(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:o,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Vr}),{data:p,error:v}=h;return v?{data:{user:null,session:null},error:v}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new gs}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:v})}catch(t){if(nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,o,u;try{if("email"in e){const{email:h,options:p}=e;let v=null,_=null;this.flowType==="pkce"&&([v,_]=await Jn(this.storage,this.storageKey));const{error:w}=await ft(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=p?.data)!==null&&t!==void 0?t:{},create_user:(n=p?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:v,code_challenge_method:_},redirectTo:p?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:h,options:p}=e,{data:v,error:_}=await ft(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(i=p?.data)!==null&&i!==void 0?i:{},create_user:(o=p?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(u=p?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:v?.message_id},error:_}}throw new _s("You must provide either an email or phone number.")}catch(h){if(nt(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,n;try{let i,o;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:u,error:h}=await ft(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:i,xform:Vr});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const p=u.session,v=u.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:v,session:p},error:null}}catch(i){if(nt(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let o=null,u=null;return this.flowType==="pkce"&&([o,u]=await Jn(this.storage,this.storageKey)),await ft(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:u}),headers:this.headers,xform:Nh})}catch(o){if(nt(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new en;const{error:i}=await ft(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(nt(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:o}=e,{error:u}=await ft(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:n,type:i,options:o}=e,{data:u,error:h}=await ft(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new _s("You must provide either an email or phone number and a type")}catch(t){if(nt(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await wn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<ha:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const u=await wn(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=ga()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(p,v,_)=>(!u&&v==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(p,v,_))})}return{data:{session:e},error:null}}const{session:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ft(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:rn}):await this._useSession(async t=>{var n,i,o;const{data:u,error:h}=t;if(h)throw h;return!(!((n=u.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new en}:await ft(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&o!==void 0?o:void 0,xform:rn})})}catch(t){if(nt(t))return fh(t)&&(await this._removeSession(),await Zr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:o}=n;if(o)throw o;if(!i.session)throw new en;const u=i.session;let h=null,p=null;this.flowType==="pkce"&&e.email!=null&&([h,p]=await Jn(this.storage,this.storageKey));const{data:v,error:_}=await ft(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:p}),jwt:u.access_token,xform:rn});if(_)throw _;return u.user=v.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(n){if(nt(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new en;const t=Date.now()/1e3;let n=t,i=!0,o=null;const{payload:u}=pa(e.access_token);if(u.exp&&(n=u.exp,i=n<=t),i){const{session:h,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!h)return{data:{user:null,session:null},error:null};o=h}else{const{data:h,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(nt(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(n=u.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new en;const{session:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(nt(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ir())throw new ms("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ms(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Tl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ms("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Tl("No code detected.");const{data:$,error:F}=await this._exchangeCodeForSession(e.code);if(F)throw F;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:$.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:o,refresh_token:u,expires_in:h,expires_at:p,token_type:v}=e;if(!o||!h||!u||!v)throw new ms("No session defined in URL");const _=Math.round(Date.now()/1e3),w=parseInt(h);let E=_+w;p&&(E=parseInt(p));const g=E-_;g*1e3<=ti&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${w}s`);const b=E-w;_-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,E,_):_-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,E,_);const{data:T,error:R}=await this._getUser(o);if(R)throw R;const N={provider_token:n,provider_refresh_token:i,access_token:o,expires_in:w,expires_at:E,refresh_token:u,token_type:v,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:N,redirectType:e.type},error:null}}catch(n){if(nt(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await wn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:o}=t;if(o)return{error:o};const u=(n=i.session)===null||n===void 0?void 0:n.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(dh(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Zr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=kh(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:o},error:u}=t;if(u)throw u;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Jn(this.storage,this.storageKey,!0));try{return await ft(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(nt(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(nt(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:i}=await this._useSession(async o=>{var u,h,p,v,_;const{data:w,error:E}=o;if(E)throw E;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await ft(this.fetch,"GET",g,{headers:this.headers,jwt:(_=(v=w.session)===null||v===void 0?void 0:v.access_token)!==null&&_!==void 0?_:void 0})});if(i)throw i;return Ir()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(nt(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:o,error:u}=t;if(u)throw u;return await ft(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(nt(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Ah(async i=>(i>0&&await Eh(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await ft(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Vr})),(i,o)=>{const u=200*Math.pow(2,i);return o&&va(o)&&Date.now()+u-n<ti})}catch(n){if(this._debug(t,"error",n),nt(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Ir()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await wn(this.storage,this.storageKey);if(i&&this.userStorage){let u=await wn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},await ri(this.userStorage,this.storageKey+"-user",u)),i.user=(e=u?.user)!==null&&e!==void 0?e:ga()}else if(i&&!i.user&&!i.user){const u=await wn(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,await Zr(this.storage,this.storageKey+"-user"),await ri(this.storage,this.storageKey,i)):i.user=ga()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const o=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ha;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${ha}s`),o){if(this.autoRefreshToken&&i.refresh_token){const{error:u}=await this._callRefreshToken(i.refresh_token);u&&(console.error(u),va(u)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(i.access_token);!h&&u?.user?(i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(n,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new en;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ws;const{data:o,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!o.session)throw new en;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const h={session:o.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(o){if(this._debug(i,"error",o),nt(o)){const u={session:null,error:o};return va(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(p){o.push(p)}});if(await Promise.all(u),o.length>0){for(let h=0;h<o.length;h+=1)console.error(o[h]);throw o[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await ri(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const o=Ll(i);await ri(this.storage,this.storageKey,o)}else{const i=Ll(t);await ri(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Zr(this.storage,this.storageKey),await Zr(this.storage,this.storageKey+"-code-verifier"),await Zr(this.storage,this.storageKey+"-user"),this.userStorage&&await Zr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ir()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ti);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/ti);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ti}ms, refresh threshold is ${Ma} ticks`),i<=Ma&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Gu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ir()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,u]=await Jn(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(h.toString())}if(n?.queryParams){const o=new URLSearchParams(n.queryParams);i.push(o.toString())}return n?.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:o}=t;return o?{data:null,error:o}:await ft(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(nt(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:o,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:p,error:v}=await ft(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return v?{data:null,error:v}:(e.factorType==="totp"&&(!((i=p?.totp)===null||i===void 0)&&i.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),{data:p,error:null})})}catch(t){if(nt(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const{data:u,error:h}=await ft(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(nt(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:o}=t;return o?{data:null,error:o}:await ft(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(nt(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],i=n.filter(u=>u.factor_type==="totp"&&u.status==="verified"),o=n.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:n,totp:i,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:i},error:o}=e;if(o)return{data:null,error:o};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=pa(i.access_token);let h=null;u.aal&&(h=u.aal);let p=h;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(p="aal2");const _=u.amr||[];return{data:{currentLevel:h,nextLevel:p,currentAuthenticationMethods:_},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(h=>h.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(h=>h.kid===e),n&&this.jwks_cached_at+uh>i)return n;const{data:o,error:u}=await ft(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=i,n=o.keys.find(h=>h.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:g,error:b}=await this.getSession();if(b||!g.session)return{data:null,error:b};n=g.session.access_token}const{header:i,payload:o,signature:u,raw:{header:h,payload:p}}=pa(n);t?.allowExpired||Oh(o.exp);const v=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!v){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:o,header:i,signature:u},error:null}}const _=Mh(i.alg),w=await crypto.subtle.importKey("jwk",v,_,!0,["verify"]);if(!await crypto.subtle.verify(_,w,u,yh(`${h}.${p}`)))throw new Fa("Invalid JWT signature");return{data:{claims:o,header:i,signature:u},error:null}}catch(n){if(nt(n))return{data:null,error:n};throw n}}}Fi.nextInstanceID=0;const Jh=Fi;class Xh extends Jh{constructor(e){super(e)}}var Qh=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(_){try{v(n.next(_))}catch(w){u(w)}}function p(_){try{v(n.throw(_))}catch(w){u(w)}}function v(_){_.done?o(_.value):i(_.value).then(h,p)}v((n=n.apply(r,e||[])).next())})};class Zh{constructor(e,t,n){var i,o,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=nh(e),p=new URL(h);this.realtimeUrl=new URL("realtime/v1",p),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",p),this.storageUrl=new URL("storage/v1",p),this.functionsUrl=new URL("functions/v1",p);const v=`sb-${p.hostname.split(".")[0]}-auth-token`,_={db:Yf,realtime:Xf,auth:Object.assign(Object.assign({},Jf),{storageKey:v}),global:Kf},w=ih(n??{},_);this.storageKey=(i=w.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=w.global.headers)!==null&&o!==void 0?o:{},w.accessToken?(this.accessToken=w.accessToken,this.auth=new Proxy({},{get:(E,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=w.auth)!==null&&u!==void 0?u:{},this.headers,w.global.fetch),this.fetch=th(t,this._getAccessToken.bind(this),w.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},w.realtime)),this.rest=new pf(new URL("rest/v1",p).href,{headers:this.headers,schema:w.db.schema,fetch:this.fetch}),this.storage=new Gf(this.storageUrl.href,this.headers,this.fetch,n?.storage),w.accessToken||this._listenForAuthEvents()}get functions(){return new rf(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Qh(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,storageKey:o,flowType:u,lock:h,debug:p},v,_){const w={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Xh({url:this.authUrl.href,headers:Object.assign(Object.assign({},w),v),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,flowType:u,lock:h,debug:p,fetch:_,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Rf(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ev=(r,e,t)=>new Zh(r,e,t);function tv(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}tv()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const rv="https://vycjpmuyscfygstjjied.supabase.co",nv="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",iv=async(r,e)=>{const t=typeof r=="string"?r:r instanceof URL?r.href:r.url,n=e?.method||"GET";console.log(`[Supabase] ${n} ${t}`);const i=performance.now();try{const o=await fetch(r,e),u=(performance.now()-i).toFixed(2);return console.log(`[Supabase] ${n} ${t} - ${o.status} (${u}ms)`),o}catch(o){const u=(performance.now()-i).toFixed(2);throw console.error(`[Supabase] ${n} ${t} - ERROR (${u}ms)`,o),o}},xt=ev(rv,nv,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:iv,headers:{"Content-Type":"application/json"}}}),Yr={async loadStoriesList(){if(!W.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${W.selectedBucket}`);const r=`${W.selectedBucket}_story.json`,{data:e,error:t}=await xt.storage.from(W.selectedBucket).list("",{search:r});console.log(`[ResourceStore] Проверка файла ${r}:`,{files:e,error:t}),!t&&e&&e.some(n=>n.name===r)?(W.storiesList=[r],console.log(`[ResourceStore] Найден файл: ${r}`)):(W.storiesList=[],console.warn(`[ResourceStore] Файл ${r} не найден`))},async loadStoredResources(){if(!W.selectedBucket){console.warn("No bucket selected");return}const{data:r}=await xt.storage.from(W.selectedBucket).list();r&&(W.storedFiles=r.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(r){const e=r.target;if(!e.files||e.files.length===0)return;if(!W.selectedBucket){Et.setStatus("error","Не выбрана история");return}const t=e.files[0];Et.setStatus("loading","Загрузка файла...");const n=await t.arrayBuffer(),i=new Uint8Array(n),{error:o}=await xt.storage.from(W.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});o?Et.setStatus("error","Ошибка загрузки"):(Et.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(r){if(!W.selectedBucket){Et.setStatus("error","Не выбрана история");return}const{error:e}=await xt.storage.from(W.selectedBucket).remove([r]);e?Et.setStatus("error","Ошибка удаления файла"):(Et.setStatus("success","Файл удален"),await this.loadStoredResources())}};function sv(r){return r.dialogues&&r.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),r.chapters||(r.chapters=[{id:"main",title:"Основная история",description:""}],r.dialogues&&r.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),r.chapters&&r.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),r.items||(r.items=[]),r.meta||(r.meta={version:"3.1",title:r.title||"Untitled"}),r.miniGames&&Array.isArray(r.miniGames)&&(r.miniGames=r.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),r}function av(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const jr={async createNewStory(){if(!W.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}const r=prompt("Введите имя файла истории:","new_story.json");if(!r)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:o}=await xt.storage.from(W.selectedBucket).upload(r,i,{contentType:"application/json"});o?Et.setStatus("error","Ошибка создания: "+o.message):(await Yr.loadStoriesList(),await this.loadStory(r))},async loadStory(r){if(!W.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${r} из bucket: ${W.selectedBucket}`),Et.setStatus("loading","Загрузка..."),W.currentFileName=r;try{const{data:e,error:t}=await xt.storage.from(W.selectedBucket).download(r);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let n;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const o=xt.storage.from(W.selectedBucket).getPublicUrl(r).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${o}`);const u=await fetch(o);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);n=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${n.length}`)}else n=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${n.length}`);let i=JSON.parse(n);console.log("[StoryStore] Данные распарсены:",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=sv(i),console.log("[StoryStore] Присваиваем данные в editor.data"),W.data=i,console.log("[StoryStore] editor.data обновлен:",{chapters:W.data.chapters?.length,dialogues:W.data.dialogues?.length}),W.data.chapters&&W.data.chapters.length>0&&(W.selectedChapterId=W.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${W.selectedChapterId}`)),W.data.dialogues&&W.data.dialogues.length>0&&(W.selectedDialogueId=W.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${W.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),Et.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),Et.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!W.data)return;if(!W.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}Et.setStatus("loading","Сохранение...");const r=JSON.stringify(W.data,null,2);console.log(`[StoryStore] Сохранение файла: ${W.currentFileName}, размер: ${r.length} байт`);const t=new TextEncoder().encode(r),{error:n}=await xt.storage.from(W.selectedBucket).update(W.currentFileName,t,{contentType:"application/json"});if(n){console.error("[StoryStore] Ошибка сохранения (update):",n),console.log("[StoryStore] Пробуем upload вместо update");const i=await xt.storage.from(W.selectedBucket).upload(W.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore] Ошибка сохранения (upload):",i.error),Et.setStatus("error","Ошибка сохранения: "+i.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),Et.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),Et.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!W.data)return;if(!W.selectedBucket){Et.setStatus("error","Не выбрана история (bucket)");return}const r=W.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${r}_copy_${e}.json`.trim();const n=prompt("Введите имя для копии:",t);if(!n)return;t=n.trim(),t.endsWith(".json")||(t+=".json"),Et.setStatus("loading","Создание копии...");const i=JSON.stringify(W.data,null,2),u=new TextEncoder().encode(i),{error:h}=await xt.storage.from(W.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?Et.setStatus("error",`Ошибка копии: ${h.message}`):(await Yr.loadStoriesList(),Et.setStatus("success","Копия сохранена!"))},addChapter(){if(!W.data||!W.data.chapters)return;const r="ch_"+Date.now();W.data.chapters.push({id:r,title:"Новая глава",description:""}),W.selectedChapterId=r,console.log(`[StoryStore] Создана новая глава: ${r}`)},addDialogue(){if(!W.data||!W.selectedChapterId)return;const r="d_"+Date.now();W.data.dialogues.push({id:r,chapterId:W.selectedChapterId,text:"Новый текст...",options:[]}),W.selectedDialogueId=r},deleteDialogue(r){confirm("Удалить диалог "+r+"?")&&W.data&&(W.data.dialogues=W.data.dialogues.filter(e=>e.id!==r),W.data.dialogues.forEach(e=>{e.nextDialogueId===r&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===r&&(t.nextDialogueId="")})}),W.selectedDialogueId===r&&(W.selectedDialogueId=null))},jumpTo(r){const e=W.data?.dialogues.find(t=>t.id===r);e&&(W.selectedChapterId=e.chapterId,W.selectedDialogueId=r)},getLinkType(r,e){return r.nextDialogueId===e?"Auto":"Option"}};var lr=pi(()=>Zt);function ov(){Et.selectEditingChapter(null)}var lv=V('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function uv(r,e){Rt(e,!1);function t(){lr().currentEditingChapter&&(Et.updateChapter(lr().currentEditingChapter.id,{title:lr().currentEditingChapter.title,description:lr().currentEditingChapter.description}),Et.selectEditingChapter(null))}function n(){lr().currentEditingChapter&&confirm(`Удалить главу "${lr().currentEditingChapter.title}"?`)&&(Et.deleteChapter(lr().currentEditingChapter.id),Et.selectEditingChapter(null))}Bi();var i=dt(),o=He(i);{var u=h=>{var p=lv(),v=S(p),_=A(S(v),2),w=S(_);w.__click=n;var E=A(v,2),g=A(S(E),2),b=A(E,2),T=A(S(b),2),R=A(b,2),N=S(R);N.__click=[ov];var $=A(N,2);$.__click=t,nr(g,()=>lr().currentEditingChapter.title,F=>lr(lr().currentEditingChapter.title=F)),nr(T,()=>lr().currentEditingChapter.description,F=>lr(lr().currentEditingChapter.description=F)),O(h,p)};ye(o,h=>{lr().currentEditingChapter&&h(u)})}O(r,i),Ot()}Dt(["click"]);var ur=pi(()=>W),cv=(r,e,t)=>e(c(t).id),dv=V('<div class="chapter-form-container svelte-xp6igx"><!></div>'),fv=V('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),hv=V('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),vv=V("<div> </div>"),pv=V('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function gv(r,e){Rt(e,!1);function t(N){Et.selectEditingChapter(N)}Bi();var n=pv(),i=S(n),o=S(i),u=A(S(o),2);u.__click=function(...N){jr.addChapter?.apply(this,N)};var h=A(o,2);rt(h,5,()=>ur().data?.chapters||[],N=>N.id,(N,$)=>{var F=fv(),z=He(F),K=S(z);let C;K.__click=()=>ur(ur().selectedChapterId=c($).id);var x=S(K),J=S(x),X=A(K,2);X.__click=[cv,t,$];var he=A(z,2);{var re=ne=>{var me=dv(),te=S(me);uv(te,{}),O(ne,me)};ye(he,ne=>{ur().editingChapterId===c($).id&&ne(re)})}be(ne=>{C=Nt(K,1,"chapter-item svelte-xp6igx",null,C,ne),Ve(K,"aria-pressed",ur().selectedChapterId===c($).id),Ve(K,"title",c($).description||"Без описания"),pe(J,c($).title)},[()=>({active:ur().selectedChapterId===c($).id})]),O(N,F)});var p=A(i,2),v=S(p),_=S(v),w=S(_),E=A(_,2);E.__click=function(...N){jr.addDialogue?.apply(this,N)};var g=A(v,2);rt(g,5,()=>Zt.chapterDialogues,N=>N.id,(N,$)=>{var F=hv();let z;F.__click=()=>ur(ur().selectedDialogueId=c($).id);var K=S(F),C=S(K),x=A(K,2),J=S(x);be((X,he)=>{z=Nt(F,1,"dialogue-item svelte-xp6igx",null,z,X),Ve(F,"aria-pressed",ur().selectedDialogueId===c($).id),pe(C,c($).id),pe(J,`${he??""}...`)},[()=>({active:ur().selectedDialogueId===c($).id}),()=>c($).text.substring(0,25)]),O(N,F)});var b=A(p,2),T=S(b);{var R=N=>{var $=vv(),F=S($);be(()=>{Nt($,1,`alert ${ur().statusMessage.type??""}`,"svelte-xp6igx"),pe(F,ur().statusMessage.text)}),O(N,$)};ye(T,N=>{ur().statusMessage.text&&N(R)})}be(()=>{pe(w,`Сцены (${Zt.chapterDialogues.length??""})`),E.disabled=!ur().selectedChapterId}),O(r,n),Ot()}Dt(["click"]);var _v=V("<option> </option>"),mv=(r,e)=>{const t=r.target;e(t.checked)},yv=(r,e)=>{const t=r.target;e("id",t.value)},bv=(r,e)=>{const t=r.target;e("onWinDialogueId",t.value)},wv=V("<option> </option>"),kv=(r,e)=>{const t=r.target;e("onLoseDialogueId",t.value)},Sv=V("<option> </option>"),Iv=(r,e)=>{const t=r.target;e("rewardItem",t.value)},Ev=V("<option> </option>"),Av=V('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),Cv=(r,e)=>{const t=r.target;e(t.value)},jv=V("<option> </option>"),xv=(r,e)=>{const t=r.target;e({itemId:t.value})},Tv=V("<option> </option>"),Pv=V('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),Rv=(r,e)=>{const t=r.target;e({statName:t.value})},Ov=(r,e)=>{const t=r.target,n=parseInt(t.value);e({statValue:isNaN(n)?0:n})},Mv=V('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),Lv=(r,e)=>{const t=r.target;e({flagName:t.value})},Dv=V('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),Fv=V('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function $v(r,e){Rt(e,!0);const t=Ye(e,"option",7);function n(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return n(),t().visibilityCondition}function o(le){n();const de=t().visibilityCondition;Object.assign(de,le),t().visibilityCondition={...de}}function u(le){n();const de={type:le};switch(le){case"has_item":de.itemId=i().itemId||"";break;case"stat_greater":de.statName=i().statName||"",de.statValue=i().statValue||0;break;case"flag_true":de.flagName=i().flagName||"";break}t().visibilityCondition=de}const h=kt(()=>!!t().miniGame);function p(le){le?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function v(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function _(le,de){const ve=v();ve&&(ve[le]=de)}var w=Fv(),E=S(w),g=S(E),b=A(g,2),T=A(E,2),R=S(T),N=A(R,2),$=S(N);$.value=$.__value="";var F=A($);rt(F,17,()=>e.dialogues,le=>le.id,(le,de)=>{var ve=_v(),Ce=S(ve),Pe={};be(ce=>{pe(Ce,`${c(de).id??""}: ${ce??""}...`),Pe!==(Pe=c(de).id)&&(ve.value=(ve.__value=c(de).id)??"")},[()=>c(de).text.substring(0,30)]),O(le,ve)});var z=A(T,2),K=S(z),C=S(K),x=S(C);x.__change=[mv,p];var J=A(K,2);{var X=le=>{var de=Av(),ve=S(de),Ce=S(ve),Pe=A(Ce,2);Pe.__change=[yv,_];var ce=S(Pe);ce.value=ce.__value="";var Ie=A(ce);Ie.value=Ie.__value="onet_monsters";var je=A(Ie);je.value=je.__value="memo_monsters";var $e=A(je);$e.value=$e.__value="light_out";var qe=A($e);qe.value=qe.__value="flood_it";var Ge=A(qe);Ge.value=Ge.__value="broken_mirror";var Ke=A(Ge);Ke.value=Ke.__value="evolution2048";var _t=A(Ke);_t.value=_t.__value="cursed_crypts";var Xe=A(_t);Xe.value=Xe.__value="tower_of_souls";var y;kn(Pe);var l=A(ve,2),f=S(l),k=S(f),M=A(k,2);M.__change=[bv,_];var H=S(M);H.value=H.__value="";var fe=A(H);rt(fe,17,()=>e.dialogues,ut=>ut.id,(ut,vt)=>{var Re=wv(),Qe=S(Re),zt={};be($n=>{pe(Qe,`${c(vt).id??""}: ${$n??""}...`),zt!==(zt=c(vt).id)&&(Re.value=(Re.__value=c(vt).id)??"")},[()=>c(vt).text.substring(0,30)]),O(ut,Re)});var Me;kn(M);var We=A(f,2),Le=S(We),ze=A(Le,2);ze.__change=[kv,_];var et=S(ze);et.value=et.__value="";var At=A(et);rt(At,17,()=>e.dialogues,ut=>ut.id,(ut,vt)=>{var Re=Sv(),Qe=S(Re),zt={};be($n=>{pe(Qe,`${c(vt).id??""}: ${$n??""}...`),zt!==(zt=c(vt).id)&&(Re.value=(Re.__value=c(vt).id)??"")},[()=>c(vt).text.substring(0,30)]),O(ut,Re)});var mt;kn(ze);var Gt=A(l,2),Bt=S(Gt),Tt=A(Bt,2);Tt.__change=[Iv,_];var it=S(Tt);it.value=it.__value="";var Je=A(it);rt(Je,17,()=>e.availableItems,ut=>ut.id,(ut,vt)=>{var Re=Ev(),Qe=S(Re),zt={};be(()=>{pe(Qe,c(vt).name),zt!==(zt=c(vt).id)&&(Re.value=(Re.__value=c(vt).id)??"")}),O(ut,Re)});var Ct;kn(Tt),be((ut,vt,Re,Qe)=>{Ve(Ce,"for",`option-mg-id-${e.index??""}`),Ve(Pe,"id",`option-mg-id-${e.index??""}`),y!==(y=ut)&&(Pe.value=(Pe.__value=ut)??"",tn(Pe,ut)),Ve(k,"for",`option-mg-win-${e.index??""}`),Ve(M,"id",`option-mg-win-${e.index??""}`),Me!==(Me=vt)&&(M.value=(M.__value=vt)??"",tn(M,vt)),Ve(Le,"for",`option-mg-lose-${e.index??""}`),Ve(ze,"id",`option-mg-lose-${e.index??""}`),mt!==(mt=Re)&&(ze.value=(ze.__value=Re)??"",tn(ze,Re)),Ve(Bt,"for",`option-mg-reward-${e.index??""}`),Ve(Tt,"id",`option-mg-reward-${e.index??""}`),Ct!==(Ct=Qe)&&(Tt.value=(Tt.__value=Qe)??"",tn(Tt,Qe))},[()=>v().id,()=>v().onWinDialogueId,()=>v().onLoseDialogueId,()=>v().rewardItem||""]),O(le,de)};ye(J,le=>{v()&&le(X)})}var he=A(z,2),re=S(he),ne=S(re),me=S(ne),te=A(re,2),q=S(te),ee=S(q),P=A(he,2),D=A(S(P),2),Z=S(D),ie=S(Z),ge=A(ie,2);ge.__change=[Cv,u],rt(ge,20,()=>e.conditionTypes,le=>le,(le,de)=>{var ve=jv(),Ce=S(ve),Pe={};be(()=>{pe(Ce,de),Pe!==(Pe=de)&&(ve.value=(ve.__value=de)??"")}),O(le,ve)});var _e;kn(ge);var ke=A(Z,2);{var Ae=le=>{var de=Pv(),ve=S(de),Ce=A(ve,2);Ce.__change=[xv,o];var Pe=S(Ce);Pe.value=Pe.__value="";var ce=A(Pe);rt(ce,17,()=>e.availableItems,je=>je.id,(je,$e)=>{var qe=Tv(),Ge=S(qe),Ke={};be(()=>{pe(Ge,c($e).name),Ke!==(Ke=c($e).id)&&(qe.value=(qe.__value=c($e).id)??"")}),O(je,qe)});var Ie;kn(Ce),be(je=>{Ve(ve,"for",`option-cond-item-${e.index??""}`),Ve(Ce,"id",`option-cond-item-${e.index??""}`),Ie!==(Ie=je)&&(Ce.value=(Ce.__value=je)??"",tn(Ce,je))},[()=>i().itemId||""]),O(le,de)};ye(ke,le=>{i().type==="has_item"&&le(Ae)})}var Ne=A(ke,2);{var ae=le=>{var de=Mv(),ve=He(de),Ce=S(ve),Pe=A(Ce,2);Pe.__input=[Rv,o];var ce=A(ve,2),Ie=S(ce),je=A(Ie,2);je.__input=[Ov,o],be(($e,qe)=>{Ve(Ce,"for",`option-cond-stat-${e.index??""}`),Ve(Pe,"id",`option-cond-stat-${e.index??""}`),la(Pe,$e),Ve(Ie,"for",`option-cond-stat-val-${e.index??""}`),Ve(je,"id",`option-cond-stat-val-${e.index??""}`),la(je,qe)},[()=>i().statName||"",()=>i().statValue||0]),O(le,de)};ye(Ne,le=>{i().type==="stat_greater"&&le(ae)})}var se=A(Ne,2);{var Q=le=>{var de=Dv(),ve=S(de),Ce=A(ve,2);Ce.__input=[Lv,o],be(Pe=>{Ve(ve,"for",`option-cond-flag-${e.index??""}`),Ve(Ce,"id",`option-cond-flag-${e.index??""}`),la(Ce,Pe)},[()=>i().flagName||""]),O(le,de)};ye(se,le=>{i().type==="flag_true"&&le(Q)})}var ue=A(D,2);ye(ue,le=>{}),be(le=>{Ve(g,"for",`option-text-${e.index??""}`),Ve(b,"id",`option-text-${e.index??""}`),Ve(R,"for",`option-next-${e.index??""}`),Ve(N,"id",`option-next-${e.index??""}`),zd(x,c(h)),Ve(ie,"for",`option-cond-type-${e.index??""}`),Ve(ge,"id",`option-cond-type-${e.index??""}`),_e!==(_e=le)&&(ge.value=(ge.__value=le)??"",tn(ge,le))},[()=>i().type]),nr(b,()=>t().text,le=>t().text=le),An(N,()=>t().nextDialogueId,le=>t().nextDialogueId=le),fl(me,()=>t().enabled,le=>t().enabled=le),fl(ee,()=>t().visible,le=>t().visible=le),O(r,w),Ot()}Dt(["change","input"]);var Mt=pi(()=>W),lt=pi(()=>Zt),Uv=V("<option> <!></option>"),Nv=V("<option> </option>"),Bv=V("<option> </option>"),Wv=V("<option> </option>"),qv=V("<option> </option>"),Vv=V('<div class="option-content svelte-1e6637j"><!></div>'),Gv=V('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),zv=V('<div class="empty-links svelte-1e6637j">Нет связей</div>'),Hv=(r,e)=>jr.jumpTo(c(e).id),Kv=V('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),Yv=V('<div class="links-list svelte-1e6637j"></div>'),Jv=V('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),Xv=(r,e)=>jr.jumpTo(c(e).id),Qv=V('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),Zv=V('<div class="more-links svelte-1e6637j"> </div>'),ep=V('<div class="links-list svelte-1e6637j"><!> <!></div>'),tp=V("<option> </option>"),rp=V('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),np=V('<div class="empty-state">Выберите сцену</div>');function ip(r,e){Rt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function n(E){E.options||(E.options=[]);const g=av();E.options.push(g),Mt(Mt().editingOptionIndex=E.options.length-1)}function i(E){if(Mt().editingOptionIndex===E)Mt(Mt().editingOptionIndex=null);else{Mt(Mt().editingOptionIndex=E);const g=lt().currentDialogue?.options?.[E];g&&!g.visibilityCondition&&(g.visibilityCondition={type:"always"})}}function o(E,g){confirm("Удалить вариант ответа?")&&(E.options?.splice(g,1),Mt().editingOptionIndex===g?Mt(Mt().editingOptionIndex=null):Mt().editingOptionIndex&&Mt().editingOptionIndex>g&&Mt(Mt().editingOptionIndex--))}function u(E){if(!E||!Mt().data)return"Нет";const g=Mt().data.dialogues.find(b=>b.id===E);return g?g.text.substring(0,25)+"...":`❌ ${E}`}function h(){const E=[],g=lt().currentDialogue;return g&&(g.nextDialogueId&&E.push({type:"Auto",id:g.nextDialogueId,text:u(g.nextDialogueId)}),g.options?.forEach((b,T)=>{b.nextDialogueId&&E.push({type:`Опция #${T+1}`,id:b.nextDialogueId,text:u(b.nextDialogueId)})})),E}Bi();var p=dt(),v=He(p);{var _=E=>{var g=rp(),b=S(g),T=A(S(b),2);T.__change=l=>{const f=l.target;Mt(Mt().selectedDialogueId=f.value)};var R=A(b,2),N=A(S(R),2);be(()=>{lt(),Er(()=>{Mt()})}),N.__change=l=>{const f=l.target;Mt(Mt().selectedChapterId=f.value)};var $=S(N);$.value=$.__value="";var F=A($);rt(F,1,()=>Mt().data.chapters||[],Lt,(l,f)=>{var k=Uv(),M=S(k),H=A(M);{var fe=We=>{var Le=Ar();be(ze=>pe(Le,`- ${ze??""}...`),[()=>c(f).description.substring(0,30)]),O(We,Le)};ye(H,We=>{c(f).description&&We(fe)})}var Me={};be(()=>{pe(M,`${c(f).title??""} `),Me!==(Me=c(f).id)&&(k.value=(k.__value=c(f).id)??"")}),O(l,k)});var z=A(R,2),K=A(S(z),2),C=A(z,2),x=A(S(C),2),J=A(S(x),2),X=S(J);be(()=>{lt(),Er(()=>{})});var he=S(X);he.value=he.__value="";var re=A(he);rt(re,1,()=>lt().imageResources,Lt,(l,f)=>{var k=Nv(),M=S(k),H={};be(()=>{pe(M,c(f).name),H!==(H=c(f).name)&&(k.value=(k.__value=c(f).name)??"")}),O(l,k)});var ne=A(re);rt(ne,1,()=>lt().riveResources,Lt,(l,f)=>{var k=Bv(),M=S(k),H={};be(()=>{pe(M,`${c(f).name??""} (Rive)`),H!==(H=c(f).name)&&(k.value=(k.__value=c(f).name)??"")}),O(l,k)});var me=A(X,2),te=A(S(me));te.__change=function(...l){Yr.uploadNewFile?.apply(this,l)};var q=A(x,2),ee=A(S(q),2),P=S(ee);be(()=>{lt(),Er(()=>{})});var D=S(P);D.value=D.__value="";var Z=A(D);rt(Z,1,()=>lt().imageResources,Lt,(l,f)=>{var k=Wv(),M=S(k),H={};be(()=>{pe(M,c(f).name),H!==(H=c(f).name)&&(k.value=(k.__value=c(f).name)??"")}),O(l,k)});var ie=A(Z);rt(ie,1,()=>lt().riveResources,Lt,(l,f)=>{var k=qv(),M=S(k),H={};be(()=>{pe(M,`${c(f).name??""} (Rive)`),H!==(H=c(f).name)&&(k.value=(k.__value=c(f).name)??"")}),O(l,k)});var ge=A(C,2),_e=S(ge),ke=A(S(_e),2);ke.__click=()=>n(lt().currentDialogue);var Ae=A(_e,2);rt(Ae,1,()=>lt().currentDialogue.options||[],Lt,(l,f,k)=>{var M=Gv();let H;var fe=S(M),Me=S(fe);Me.__click=()=>i(k),Me.__keydown=it=>{(it.key==="Enter"||it.key===" ")&&(it.preventDefault(),i(k))},Ve(Me,"aria-controls",`option-content-${k}`);var We=S(Me),Le=S(We);{var ze=it=>{var Je=Ar("👁️‍🗨️");O(it,Je)},et=it=>{var Je=dt(),Ct=He(Je);{var ut=Re=>{var Qe=Ar("🔒");O(Re,Qe)},vt=Re=>{var Qe=Ar("✅");O(Re,Qe)};ye(Ct,Re=>{c(f).enabled?Re(vt,!1):Re(ut)},!0)}O(it,Je)};ye(Le,it=>{c(f).visible?it(et,!1):it(ze)})}var At=A(We,2),mt=S(At),Gt=A(Me,2);Gt.__click=()=>o(lt().currentDialogue,k);var Bt=A(fe,2);{var Tt=it=>{var Je=Vv();Ve(Je,"id",`option-content-${k}`);var Ct=S(Je);$v(Ct,{get option(){return c(f)},index:k,get dialogues(){return Mt().data.dialogues},get availableItems(){return lt().availableItems},get conditionTypes(){return t}}),O(it,Je)};ye(Bt,it=>{Mt().editingOptionIndex===k&&it(Tt)})}be(it=>{H=Nt(M,1,"option-card svelte-1e6637j",null,H,it),Ve(Me,"aria-expanded",Mt().editingOptionIndex===k),pe(mt,`#${k+1} ${c(f).text??""}`)},[()=>({editing:Mt().editingOptionIndex===k})]),O(l,M)});var Ne=A(ge,2),ae=S(Ne),se=S(ae),Q=S(se),ue=S(Q),le=A(Q,2);{var de=l=>{var f=zv();O(l,f)},ve=l=>{var f=Yv();rt(f,5,h,Lt,(k,M)=>{var H=Kv(),fe=S(H),Me=S(fe),We=A(fe,2),Le=S(We),ze=A(We,2);ze.__click=[Hv,M];var et=A(ze,2),At=S(et);be(()=>{pe(Me,`${c(M).type??""}:`),pe(Le,c(M).id),pe(At,c(M).text)}),O(k,H)}),O(l,f)};ye(le,l=>{h().length===0?l(de):l(ve,!1)})}var Ce=A(se,2),Pe=S(Ce),ce=S(Pe),Ie=A(Pe,2);{var je=l=>{var f=Jv();O(l,f)},$e=l=>{var f=ep(),k=S(f);rt(k,1,()=>lt().backlinks.slice(0,5),Lt,(fe,Me)=>{const We=Ls(()=>jr.getLinkType(c(Me),lt().currentDialogue.id));var Le=Qv(),ze=S(Le),et=S(ze),At=A(ze,2);let mt;var Gt=S(At),Bt=A(At,2);Bt.__click=[Xv,Me];var Tt=A(Bt,2),it=S(Tt);be((Je,Ct)=>{pe(et,c(Me).id),mt=Nt(At,1,"link-type-badge svelte-1e6637j",null,mt,Je),pe(Gt,c(We)),pe(it,`${Ct??""}...`)},[()=>({"link-auto":c(We)==="Auto","link-option":c(We)==="Option"}),()=>c(Me).text.substring(0,20)]),O(fe,Le)});var M=A(k,2);{var H=fe=>{var Me=Zv(),We=S(Me);be(()=>pe(We,`...ещё ${lt().backlinks.length-5}`)),O(fe,Me)};ye(M,fe=>{lt().backlinks.length>5&&fe(H)})}O(l,f)};ye(Ie,l=>{lt().backlinks.length===0?l(je):l($e,!1)})}var qe=A(Ne,2),Ge=A(S(qe),2);be(()=>{lt(),Er(()=>{Mt()})});var Ke=S(Ge);Ke.value=Ke.__value="";var _t=A(Ke);rt(_t,1,()=>Mt().data.dialogues,Lt,(l,f)=>{var k=tp(),M=S(k),H={};be(fe=>{pe(M,`${c(f).id??""}: ${fe??""}...`),H!==(H=c(f).id)&&(k.value=(k.__value=c(f).id)??"")},[()=>c(f).text.substring(0,30)]),O(l,k)});var Xe=A(qe,2),y=S(Xe);y.__click=()=>jr.deleteDialogue(lt().currentDialogue.id),be(l=>{pe(ue,`👉 Куда ведет (${l??""})`),pe(ce,`👈 Откуда ведут (${lt().backlinks.length??""})`)},[()=>h().length]),nr(T,()=>lt().currentDialogue.id,l=>lt(lt().currentDialogue.id=l)),An(N,()=>lt().currentDialogue.chapterId,l=>lt(lt().currentDialogue.chapterId=l)),nr(K,()=>lt().currentDialogue.text,l=>lt(lt().currentDialogue.text=l)),An(X,()=>lt().currentDialogue.backgroundImage,l=>lt(lt().currentDialogue.backgroundImage=l)),An(P,()=>lt().currentDialogue.characterImage,l=>lt(lt().currentDialogue.characterImage=l)),An(Ge,()=>lt().currentDialogue.nextDialogueId,l=>lt(lt().currentDialogue.nextDialogueId=l)),O(E,g)},w=E=>{var g=np();O(E,g)};ye(v,E=>{lt().currentDialogue?E(_):E(w,!1)})}O(r,p),Ot()}Dt(["change","click","keydown"]);var tt=pi(()=>W),sp=V('<img class="icon-preview svelte-asgatj"/>'),ap=V('<div class="icon-placeholder svelte-asgatj">📦</div>'),op=V("<option> </option>"),lp=V('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),up=V("<option> </option>"),cp=V('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),dp=V('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),fp=V('<div class="items-list svelte-asgatj"></div>'),hp=V('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),vp=V('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),pp=V('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function gp(r,e){Rt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function n(){if(!tt().data)return;tt().data.items||tt(tt().data.items=[]);const R={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};tt().data.items.push(R),tt(tt().editingItemIndex=tt().data.items.length-1)}function i(R){tt().editingItemIndex===R?tt(tt().editingItemIndex=null):tt(tt().editingItemIndex=R)}function o(R){confirm("Удалить предмет?")&&tt().data?.items&&(tt().data.items.splice(R,1),tt(tt().editingItemIndex=null))}function u(R){if(!tt().data?.items)return;const N=tt().data.items[R],$={...N,id:`${N.id}_copy_${Date.now()}`,name:`${N.name} (копия)`};tt().data.items.splice(R+1,0,$),tt(tt().editingItemIndex=R+1)}function h(R){return t.find(N=>N.value===R)?.label||R}Bi();var p=pp(),v=S(p);v.__click=()=>tt(tt().showItems=!tt().showItems);var _=S(v),w=A(S(_)),E=A(_,2),g=S(E),b=A(v,2);{var T=R=>{var N=vp(),$=S(N);{var F=C=>{var x=fp();rt(x,7,()=>tt().data.items,J=>J.id,(J,X,he)=>{var re=dp();let ne;var me=S(re);me.__click=()=>i(c(he));var te=S(me),q=S(te),ee=S(q);{var P=Ie=>{var je=sp();be(()=>{Ve(je,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${tt().selectedBucket}/${c(X).icon}`),Ve(je,"alt",c(X).name)}),O(Ie,je)},D=Ie=>{var je=ap();O(Ie,je)};ye(ee,Ie=>{c(X).icon?Ie(P):Ie(D,!1)})}var Z=A(q,2),ie=S(Z),ge=S(ie),_e=A(ie,2),ke=S(_e),Ae=S(ke),Ne=A(ke,2);let ae;var se=S(Ne),Q=A(te,2),ue=S(Q),le=A(me,2),de=S(le);de.__click=()=>u(c(he));var ve=A(de,2);ve.__click=()=>i(c(he));var Ce=A(ve,2);Ce.__click=()=>o(c(he));var Pe=A(le,2);{var ce=Ie=>{var je=cp(),$e=S(je),qe=S($e),Ge=S(qe),Ke=A(Ge,2),_t=A(qe,2),Xe=S(_t),y=A(Xe,2),l=A(_t,2),f=S(l),k=A(f,2),M=A(l,2),H=S(M),fe=A(H,2),Me=S(fe),We=A(Me,2);We.__change=Je=>{const Ct=Je.target;c(X).icon=Ct.value,Er(()=>tt())};var Le=S(We);Le.value=Le.__value="";var ze=A(Le);rt(ze,1,()=>tt().storedFiles.filter(Je=>Je.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),Lt,(Je,Ct)=>{var ut=op(),vt=S(ut),Re={};be(()=>{pe(vt,c(Ct).name),Re!==(Re=c(Ct).name)&&(ut.value=(ut.__value=c(Ct).name)??"")}),O(Je,ut)});var et=A(We,2),At=A(S(et));At.__change=function(...Je){Yr.uploadNewFile?.apply(this,Je)};var mt=A(fe,2);{var Gt=Je=>{var Ct=lp(),ut=S(Ct),vt=A(ut,2),Re=S(vt);be(()=>{Ve(ut,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${tt().selectedBucket}/${c(X).icon}`),pe(Re,c(X).icon)}),O(Je,Ct)};ye(mt,Je=>{c(X).icon&&Je(Gt)})}var Bt=A(M,2),Tt=S(Bt),it=A(Tt,2);be(()=>{c(X),Er(()=>{c(he)})}),rt(it,5,()=>t,Lt,(Je,Ct)=>{var ut=up(),vt=S(ut),Re={};be(()=>{pe(vt,c(Ct).label),Re!==(Re=c(Ct).value)&&(ut.value=(ut.__value=c(Ct).value)??"")}),O(Je,ut)}),be(()=>{Ve(Ge,"for",`item-id-${c(he)??""}`),Ve(Ke,"id",`item-id-${c(he)??""}`),Ve(Xe,"for",`item-name-${c(he)??""}`),Ve(y,"id",`item-name-${c(he)??""}`),Ve(f,"for",`item-desc-${c(he)??""}`),Ve(k,"id",`item-desc-${c(he)??""}`),Ve(H,"for",`item-icon-${c(he)??""}`),Ve(Me,"id",`item-icon-${c(he)??""}`),Ve(Tt,"for",`item-type-${c(he)??""}`),Ve(it,"id",`item-type-${c(he)??""}`)}),nr(Ke,()=>c(X).id,Je=>(c(X).id=Je,Er(()=>tt()))),nr(y,()=>c(X).name,Je=>(c(X).name=Je,Er(()=>tt()))),nr(k,()=>c(X).description,Je=>(c(X).description=Je,Er(()=>tt()))),nr(Me,()=>c(X).icon,Je=>(c(X).icon=Je,Er(()=>tt()))),An(it,()=>c(X).type,Je=>(c(X).type=Je,Er(()=>tt()))),O(Ie,je)};ye(Pe,Ie=>{tt().editingItemIndex===c(he)&&Ie(ce)})}be((Ie,je,$e)=>{ne=Nt(re,1,"item-row svelte-asgatj",null,ne,Ie),Ve(me,"aria-label",`Редактировать предмет ${c(X).name??""}`),pe(ge,c(X).name),pe(Ae,c(X).id),ae=Nt(Ne,1,"item-type-badge svelte-asgatj",null,ae,je),pe(se,$e),pe(ue,`${c(X).description??""} || `)},[()=>({editing:tt().editingItemIndex===c(he)}),()=>({tool:c(X).type==="tool",key:c(X).type==="key",consumable:c(X).type==="consumable",quest:c(X).type==="quest",misc:c(X).type==="misc"}),()=>h(c(X).type)]),O(J,re)}),O(C,x)},z=C=>{var x=hp();O(C,x)};ye($,C=>{tt().data?.items?.length?C(F):C(z,!1)})}var K=A($,2);K.__click=n,O(R,N)};ye(b,R=>{tt().showItems&&R(T)})}be(()=>{Ve(v,"title",tt().showItems?"Скрыть предметы":"Показать предметы"),Ve(v,"aria-expanded",tt().showItems),pe(w,` Предметы (${(tt().data?.items?.length||0)??""})`),pe(g,tt().showItems?"▼":"▶")}),O(r,p),Ot()}Dt(["click","change"]);Dt(["click"]);const Pt=ht({user:null,session:null,profile:null,loading:!0,initialized:!1}),_p=kt(()=>Pt.user),mp=kt(()=>Pt.session),zu=kt(()=>Pt.profile),yp=kt(()=>c(mp)!==null&&c(_p)!==null),bp=kt(()=>c(zu)?.is_author??!1),wp=kt(()=>c(zu)?.is_admin??!1);async function kp(){try{Pt.loading=!0;const{data:{session:r}}=await xt.auth.getSession();Pt.session=r,Pt.user=r?.user??null,r?.user&&await $a(r.user.id),xt.auth.onAuthStateChange(async(e,t)=>{console.log("[Auth] State change:",e,t?.user?.email),Pt.session=t,Pt.user=t?.user??null,t?.user?await $a(t.user.id):Pt.profile=null})}catch(r){console.error("[Auth] Init error:",r)}finally{Pt.loading=!1,Pt.initialized=!0}}async function $a(r){try{const{data:e,error:t}=await xt.from("profiles").select("*").eq("user_id",r).single();if(t){t.code==="PGRST116"?(console.log("[Auth] Profile not found, creating..."),await Sp(r)):console.error("[Auth] Error loading profile:",t);return}Pt.profile=e,console.log("[Auth] Profile loaded:",e)}catch(e){console.error("[Auth] Error in loadProfile:",e)}}async function Sp(r){try{const{data:e,error:t}=await xt.from("profiles").insert([{user_id:r,is_author:!1,is_admin:!1}]).select().single();if(t){console.error("[Auth] Error creating profile:",t);return}Pt.profile=e}catch(e){console.error("[Auth] Error in createProfile:",e)}}async function Ip(r,e){if(!r||!r.trim())return{success:!1,error:"Email не может быть пустым"};if(!e||!e.trim())return{success:!1,error:"Пароль не может быть пустым"};Pt.loading=!0;try{console.log("[Auth] Attempting sign in for:",r);const{data:t,error:n}=await xt.auth.signInWithPassword({email:r.trim().toLowerCase(),password:e.trim()});return n?(console.error("[Auth] Sign in error:",n),n.status===400||n.status===422?{success:!1,error:"Неверный email или пароль"}:n.message?.includes("Email not confirmed")?{success:!1,error:"Email не подтвержден. Проверьте почту."}:{success:!1,error:n.message}):(console.log("[Auth] Sign in successful:",t.user?.email),Pt.session=t.session,Pt.user=t.user,t.user&&await $a(t.user.id),{success:!0})}catch(t){return console.error("[Auth] Sign in exception:",t),{success:!1,error:"Произошла ошибка при входе"}}finally{Pt.loading=!1}}async function Ep(){Pt.loading=!0;try{const{error:r}=await xt.auth.signOut();r&&console.error("[Auth] Error signing out:",r),Pt.user=null,Pt.session=null,Pt.profile=null,console.log("[Auth] Signed out successfully")}finally{Pt.loading=!1}}async function Ap(r,e,t){Pt.loading=!0;try{const{data:n,error:i}=await xt.auth.signUp({email:r,password:e,options:{data:{username:t||r.split("@")[0]},emailRedirectTo:`${window.location.origin}/auth/callback`}});return i?i.status===429||i.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:i.message}:{success:!0,needsEmailConfirmation:n.user?.identities?.length===0||n.user?.email_confirmed_at===null}}catch(n){return{success:!1,error:n.message}}finally{Pt.loading=!1}}async function Cp(r){try{const e=`${window.location.origin}/reset-password`;console.log("[Auth] Sending reset email to:",r);const{data:t,error:n}=await xt.auth.resetPasswordForEmail(r,{redirectTo:e});return n?(console.error("[Auth] Reset password error:",n),n.status===429||n.message?.toLowerCase().includes("rate limit")?{success:!1,error:"Слишком много попыток. Пожалуйста, подождите час."}:{success:!1,error:n.message}):(console.log("[Auth] Reset email sent:",t),{success:!0})}catch(e){return console.error("[Auth] Reset password exception:",e),{success:!1,error:e.message}}}const ar={get user(){return Pt.user},get session(){return Pt.session},get profile(){return Pt.profile},get loading(){return Pt.loading},get initialized(){return Pt.initialized}},$i={get isAuthenticated(){return c(yp)},get isAuthor(){return c(bp)},get isAdmin(){return c(wp)}},qt=ht({stories:[],loading:!1,initialized:!1}),Ua=[{id:"dracula",created_at:new Date().toISOString(),title:"Дракула",author_id:null,json_url:"dracula_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"dracula"},{id:"zombie",created_at:new Date().toISOString(),title:"Выживание",author_id:null,json_url:"zombie_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"zombie"},{id:"fairy_tale",created_at:new Date().toISOString(),title:"Сказка",author_id:null,json_url:"fairy_tale_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"fairy_tale"},{id:"minigames",created_at:new Date().toISOString(),title:"Мини-игры",author_id:null,json_url:"minigames_story.json",preview_image_url:null,is_public:!0,allowed_players:[],bucket:"minigames"}];function jp(){if(console.log("[getPublicStories] initialized:",qt.initialized,"stories.length:",qt.stories.length),!qt.initialized||qt.stories.length===0)return console.log("[getPublicStories] Возвращаем fallback, count:",Ua.length),Ua;const r=qt.stories.filter(e=>e.is_public);return console.log("[getPublicStories] Публичных историй:",r.length),r}function Hu(){const r=ar.user?.id;if(!r){const t=jp(),n=t.length>0?t:Ua;return console.log("[getPlayerStories] Гость, результат:",n.length),n}const e=qt.stories.filter(t=>t.is_public||t.allowed_players&&t.allowed_players.includes(r));return console.log("[getPlayerStories] Авторизован, результат:",e.length),e}function Nl(){const r=ar.user?.id;return r&&ar.profile?.is_admin?qt.stories:qt.stories.filter(e=>e.author_id===r)}async function Vi(){console.log("[storiesStore] loadStories начало"),qt.loading=!0;try{if(console.log("[storiesStore] Загрузка историй из таблицы..."),!navigator.onLine){console.log("[storiesStore] Нет сети - используем fallback"),qt.stories=[],qt.loading=!1,qt.initialized=!0,console.log("[storiesStore] loadStories завершено (офлайн)");return}const{data:r,error:e}=await xt.from("stories").select("*").order("created_at",{ascending:!1});e?(console.error("[storiesStore] Error loading stories:",e),console.log("[storiesStore] Используем fallback истории"),qt.stories=[]):(console.log("[storiesStore] Загружено историй из БД:",r?.length||0),qt.stories=r||[])}catch(r){console.error("[storiesStore] Exception loading stories:",r),console.log("[storiesStore] Используем fallback истории"),qt.stories=[]}qt.loading=!1,qt.initialized=!0,console.log("[storiesStore] loadStories завершено. Историй в сторе:",qt.stories.length)}async function xp(r,e="stories"){if(!ar.user)return{success:!1,error:"Необходимо войти"};try{const t=`${r.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}.json`,i=JSON.stringify({meta:{version:"3.1",title:r},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало истории...",options:[]}],items:[],miniGames:[]},null,2),u=new TextEncoder().encode(i),{error:h}=await xt.storage.from(e).upload(t,u,{contentType:"application/json"});if(h)return{success:!1,error:h.message};const p=t,{data:v,error:_}=await xt.from("stories").insert({title:r,author_id:ar.user.id,json_url:p,bucket:e,is_public:!1,allowed_players:[]}).select().single();return _?{success:!1,error:_.message}:(await Vi(),{success:!0,story:v})}catch(t){return{success:!1,error:t.message}}}async function Tp(r,e){if(!ar.user)return{success:!1,error:"Необходимо войти"};try{const{error:t}=await xt.from("stories").update(e).eq("id",r).eq("author_id",ar.user.id);return t?{success:!1,error:t.message}:(await Vi(),{success:!0})}catch(t){return{success:!1,error:t.message}}}async function Pp(r){if(!ar.user)return{success:!1,error:"Необходимо войти"};try{const e=qt.stories.find(n=>n.id===r);if(!e)return{success:!1,error:"История не найдена"};if(e.json_url){const[n,...i]=e.json_url.split("/"),o=i.join("/");await xt.storage.from(n).remove([o])}const{error:t}=await xt.from("stories").delete().eq("id",r).eq("author_id",ar.user.id);return t?{success:!1,error:t.message}:(await Vi(),{success:!0})}catch(e){return{success:!1,error:e.message}}}async function Ku(r){try{const e=r.bucket||"stories",n=r.json_url.split("/").pop()||"story.json";console.log(`[storiesStore] Загрузка истории "${r.title}" из bucket: ${e}, файл: ${n}`);const{data:i,error:o}=await xt.storage.from(e).download(n);if(o){console.error("[storiesStore] Error downloading story:",o.message);const p=`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${e}/${n}`;console.log("[storiesStore] Пробуем fallback URL:",p);try{const v=await fetch(p);if(!v.ok)throw new Error(`HTTP ${v.status}`);const _=await v.json();return console.log("[storiesStore] Загружено через fallback URL"),_}catch(v){console.error("[storiesStore] Fallback also failed:",v);const _=`/stories/${n}`;console.log("[storiesStore] Пробуем локальный URL:",_);try{const w=await fetch(_);if(w.ok)return await w.json()}catch{console.error("[storiesStore] Локальный fallback тоже не работает")}return null}}const u=await i.text(),h=JSON.parse(u);return console.log("[storiesStore] История загружена успешно"),h}catch(e){return console.error("[storiesStore] Error loading story JSON:",e),null}}const zr=qt;class Rp{#s=we(ht({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return c(this.#s)}set player(e){L(this.#s,e,!0)}#n=we(null);get storyData(){return c(this.#n)}set storyData(e){L(this.#n,e,!0)}#e=we("0");get currentDialogueId(){return c(this.#e)}set currentDialogueId(e){L(this.#e,e,!0)}#a=we(!0);get isLoading(){return c(this.#a)}set isLoading(e){L(this.#a,e,!0)}#o=we("");get error(){return c(this.#o)}set error(e){L(this.#o,e,!0)}#t=we(null);get selectedStory(){return c(this.#t)}set selectedStory(e){L(this.#t,e,!0)}#i=we(null);get selectedStoryData(){return c(this.#i)}set selectedStoryData(e){L(this.#i,e,!0)}#r=we(null);get urlStoryId(){return c(this.#r)}set urlStoryId(e){L(this.#r,e,!0)}get availableStories(){return Hu()}async initStories(){console.log("[GameState] initStories начало");const t=new URLSearchParams(window.location.search).get("story");t&&(this.urlStoryId=t,console.log("[GameState] URL параметр story:",t)),zr.initialized?console.log("[GameState] Истории уже загружены"):(console.log("[GameState] Загружаем истории..."),await Vi(),console.log("[GameState] Истории загружены, initialized:",zr.initialized)),this.urlStoryId&&(console.log("[GameState] Выбираем историю:",this.urlStoryId),this.selectStoryById(this.urlStoryId)),console.log("[GameState] initStories завершено")}selectStoryById(e){console.log("[GameState] selectStoryById:",e),console.log("[GameState] storiesState.stories:",zr.stories.length),console.log("[GameState] storiesState.initialized:",zr.initialized);let t=zr.stories.find(n=>n.id===e);return console.log("[GameState] Найдена в БД:",t?.title),t||(t=[{id:"dracula",title:"Дракула",bucket:"dracula",json_url:"dracula_story.json"},{id:"zombie",title:"Выживание",bucket:"zombie",json_url:"zombie_story.json"},{id:"fairy_tale",title:"Сказка",bucket:"fairy_tale",json_url:"fairy_tale_story.json"},{id:"minigames",title:"Мини-игры",bucket:"minigames",json_url:"minigames_story.json"}].find(i=>i.id===e),console.log("[GameState] Найдена в fallback:",t?.title)),t?(this.selectedStory=t.id,this.selectedStoryData=t,console.log("[GameState] Выбрана история:",t.title),!0):(console.warn("[GameState] История не найдена:",e),!1)}getStoryById(e){return zr.stories.find(t=>t.id===e)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();this.storyData=n,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const n=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${n}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Ze=new Rp;var ws={exports:{}},Op=ws.exports,Bl;function Mp(){return Bl||(Bl=1,(function(r,e){(function(n,i){r.exports=i()})(Op,()=>(()=>{var t=[,((u,h,p)=>{p.r(h),p.d(h,{default:()=>_});var v=(()=>{var w=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(E={}){var g=E,b,T;g.ready=new Promise((s,a)=>{b=s,T=a});function R(){function s(U){const Y=m;d=a=0,m=new Map,Y.forEach(oe=>{try{oe(U)}catch(G){console.error(G)}}),this.pb(),I&&I.Tb()}let a=0,d=0,m=new Map,I=null,j=null;this.requestAnimationFrame=function(U){a||(a=requestAnimationFrame(s.bind(this)));const Y=++d;return m.set(Y,U),Y},this.cancelAnimationFrame=function(U){m.delete(U),a&&m.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(U){j&&(document.body.remove(j),j=null),U||(j=document.createElement("div"),j.style.backgroundColor="black",j.style.position="fixed",j.style.right=0,j.style.top=0,j.style.color="white",j.style.padding="4px",j.innerHTML="RIVE FPS",U=function(Y){j.innerHTML="RIVE FPS "+Y.toFixed(1)},document.body.appendChild(j)),I=new function(){let Y=0,oe=0;this.Tb=function(){var G=performance.now();oe?(++Y,G-=oe,1e3<G&&(U(1e3*Y/G),Y=oe=0)):(oe=G,Y=0)}}},this.Ob=function(){j&&(document.body.remove(j),j=null),I=null},this.pb=function(){}}function N(s){console.assert(!0);const a=new Map;let d=-1/0;this.push=function(m){return m=m+((1<<s)-1)>>s,a.has(m)&&clearTimeout(a.get(m)),a.set(m,setTimeout(function(){a.delete(m),a.length==0?d=-1/0:m==d&&(d=Math.max(...a.keys()),console.assert(d<m))},1e3)),d=Math.max(m,d),d<<s}}const $=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){$&&$();let s=g.decodeAudio;g.decodeAudio=function(I,j){I=s(I),j(I)};let a=g.decodeFont;g.decodeFont=function(I,j){I=a(I),j(I)};const d=g.FileAssetLoader;g.ptrToAsset=I=>{let j=g.ptrToFileAsset(I);return j.isImage?g.ptrToImageAsset(I):j.isFont?g.ptrToFontAsset(I):j.isAudio?g.ptrToAudioAsset(I):j},g.CustomFileAssetLoader=d.extend("CustomFileAssetLoader",{__construct:function({loadContents:I}){this.__parent.__construct.call(this),this.Gb=I},loadContents:function(I,j){return I=g.ptrToAsset(I),this.Gb(I,j)}}),g.CDNFileAssetLoader=d.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(I){let j=g.ptrToAsset(I);return I=j.cdnUuid,I===""?!1:((function(U,Y){var oe=new XMLHttpRequest;oe.responseType="arraybuffer",oe.onreadystatechange=function(){oe.readyState==4&&oe.status==200&&Y(oe)},oe.open("GET",U,!0),oe.send(null)})(j.cdnBaseUrl+"/"+I,U=>{j.decode(new Uint8Array(U.response))}),!0)}}),g.FallbackFileAssetLoader=d.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(I){this.lb.push(I)},loadContents:function(I,j){for(let U of this.lb)if(U.loadContents(I,j))return!0;return!1}});let m=g.computeAlignment;g.computeAlignment=function(I,j,U,Y,oe=1){return m.call(this,I,j,U,Y,oe)}};const F="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function s(){if(!a){let at=function(ct,De,$t){if(De=Ee.createShader(De),Ee.shaderSource(De,$t),Ee.compileShader(De),$t=Ee.getShaderInfoLog(De),0<($t||"").length)throw $t;Ee.attachShader(ct,De)};var B=document.createElement("canvas"),xe={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let Ee;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(Ee=B.getContext("webgl",xe),d=1,!Ee)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(Ee=B.getContext("webgl2",xe))d=2;else if(Ee=B.getContext("webgl",xe))d=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(Ee=new Proxy(Ee,{get(ct,De){if(ct.isContextLost()){if(oe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",De),oe=!0),typeof ct[De]=="function")return function(){}}else return typeof ct[De]=="function"?function(...$t){return ct[De].apply(ct,$t)}:ct[De]},set(ct,De,$t){if(ct.isContextLost())oe||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+De),oe=!0);else return ct[De]=$t,!0}}),m=Math.min(Ee.getParameter(Ee.MAX_RENDERBUFFER_SIZE),Ee.getParameter(Ee.MAX_TEXTURE_SIZE)),B=Ee.createProgram(),at(B,Ee.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),at(B,Ee.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),Ee.bindAttribLocation(B,0,"vertex"),Ee.bindAttribLocation(B,1,"uv"),Ee.linkProgram(B),xe=Ee.getProgramInfoLog(B),0<(xe||"").trim().length)throw xe;I=Ee.getUniformLocation(B,"mat"),j=Ee.getUniformLocation(B,"translate"),Ee.useProgram(B),Ee.bindBuffer(Ee.ARRAY_BUFFER,Ee.createBuffer()),Ee.enableVertexAttribArray(0),Ee.enableVertexAttribArray(1),Ee.bindBuffer(Ee.ELEMENT_ARRAY_BUFFER,Ee.createBuffer()),Ee.uniform1i(Ee.getUniformLocation(B,"image"),0),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=Ee}return!0}let a=null,d=0,m=0,I=null,j=null,U=0,Y=0,oe=!1;s(),this.hc=function(){return s(),m},this.Mb=function(B){a.deleteTexture&&a.deleteTexture(B)},this.Lb=function(B){if(!s())return null;const xe=a.createTexture();return xe?(a.bindTexture(a.TEXTURE_2D,xe),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,B),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),d==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),xe):null};const G=new N(8),Te=new N(8),Oe=new N(10),Ue=new N(10);this.Qb=function(B,xe,Ee,at,ct){if(s()){var De=G.push(B),$t=Te.push(xe);if(a.canvas){(a.canvas.width!=De||a.canvas.height!=$t)&&(a.canvas.width=De,a.canvas.height=$t),a.viewport(0,$t-xe,B,xe),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),Ee.sort((yt,Rr)=>Rr.xb-yt.xb),De=Oe.push(at),U!=De&&(a.bufferData(a.ARRAY_BUFFER,8*De,a.DYNAMIC_DRAW),U=De),De=0;for(var er of Ee)a.bufferSubData(a.ARRAY_BUFFER,De,er.Ua),De+=4*er.Ua.length;console.assert(De==4*at);for(var Pr of Ee)a.bufferSubData(a.ARRAY_BUFFER,De,Pr.Db),De+=4*Pr.Db.length;console.assert(De==8*at),De=Ue.push(ct),Y!=De&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*De,a.DYNAMIC_DRAW),Y=De),er=0;for(var _n of Ee)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,er,_n.indices),er+=2*_n.indices.length;console.assert(er==2*ct),_n=0,Pr=!0,De=er=0;for(const yt of Ee){yt.image.Ka!=_n&&(a.bindTexture(a.TEXTURE_2D,yt.image.Ja||null),_n=yt.image.Ka),yt.mc?(a.scissor(yt.Za,$t-yt.$a-yt.kb,yt.Ac,yt.kb),Pr=!0):Pr&&(a.scissor(0,$t-xe,B,xe),Pr=!1),Ee=2/B;const Rr=-2/xe;a.uniform4f(I,yt.ha[0]*Ee*yt.Ba,yt.ha[1]*Rr*yt.Ca,yt.ha[2]*Ee*yt.Ba,yt.ha[3]*Rr*yt.Ca),a.uniform2f(j,yt.ha[4]*Ee*yt.Ba+Ee*(yt.Za-yt.ic*yt.Ba)-1,yt.ha[5]*Rr*yt.Ca+Rr*(yt.$a-yt.jc*yt.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,De),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,De+4*at),a.drawElements(a.TRIANGLES,yt.indices.length,a.UNSIGNED_SHORT,er),De+=4*yt.Ua.length,er+=2*yt.indices.length}console.assert(De==4*at),console.assert(er==2*ct)}}},this.canvas=function(){return s()&&a.canvas}},K=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function s(Se){switch(Se){case G.srcOver:return"source-over";case G.screen:return"screen";case G.overlay:return"overlay";case G.darken:return"darken";case G.lighten:return"lighten";case G.colorDodge:return"color-dodge";case G.colorBurn:return"color-burn";case G.hardLight:return"hard-light";case G.softLight:return"soft-light";case G.difference:return"difference";case G.exclusion:return"exclusion";case G.multiply:return"multiply";case G.hue:return"hue";case G.saturation:return"saturation";case G.color:return"color";case G.luminosity:return"luminosity"}}function a(Se){return"rgba("+((16711680&Se)>>>16)+","+((65280&Se)>>>8)+","+((255&Se)>>>0)+","+((4278190080&Se)>>>24)/255+")"}function d(){0<$t.length&&(z.Qb(De.drawWidth(),De.drawHeight(),$t,er,Pr),$t=[],Pr=er=0,De.reset(512,512));for(const Se of ct){for(const Fe of Se.H)Fe();Se.H=[]}ct.clear()}K&&K();var m=g.RenderPaintStyle;const I=g.RenderPath,j=g.RenderPaint,U=g.Renderer,Y=g.StrokeCap,oe=g.StrokeJoin,G=g.BlendMode,Te=m.fill,Oe=m.stroke,Ue=g.FillRule.evenOdd;let B=1;var xe=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:Se,xa:Fe}={}){this.__parent.__construct.call(this),this.Ka=B,B=B+1&2147483647||1,this.la=Se,this.xa=Fe},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(Se){var Fe=this;Fe.xa&&Fe.xa(Fe);var pt=new Image;Fe.Xa=URL.createObjectURL(new Blob([Se],{type:"image/png"})),pt.onload=function(){Fe.Fb=pt,Fe.Ja=z.Lb(pt),Fe.size(pt.width,pt.height),Fe.la&&Fe.la(Fe)},pt.src=Fe.Xa}}),Ee=I.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(Se,Fe,pt,bt,ot,gt,It){var jt=this.T,Sr=jt.addPath;Se=Se.T;const Yt=new DOMMatrix;Yt.a=Fe,Yt.b=pt,Yt.c=bt,Yt.d=ot,Yt.e=gt,Yt.f=It,Sr.call(jt,Se,Yt)},fillRule:function(Se){this.Wa=Se},moveTo:function(Se,Fe){this.T.moveTo(Se,Fe)},lineTo:function(Se,Fe){this.T.lineTo(Se,Fe)},cubicTo:function(Se,Fe,pt,bt,ot,gt){this.T.bezierCurveTo(Se,Fe,pt,bt,ot,gt)},close:function(){this.T.closePath()}}),at=j.extend("CanvasRenderPaint",{color:function(Se){this.Ya=a(Se)},thickness:function(Se){this.Ib=Se},join:function(Se){switch(Se){case oe.miter:this.Ia="miter";break;case oe.round:this.Ia="round";break;case oe.bevel:this.Ia="bevel"}},cap:function(Se){switch(Se){case Y.butt:this.Ha="butt";break;case Y.round:this.Ha="round";break;case Y.square:this.Ha="square"}},style:function(Se){this.Hb=Se},blendMode:function(Se){this.Eb=s(Se)},clearGradient:function(){this.ja=null},linearGradient:function(Se,Fe,pt,bt){this.ja={zb:Se,Ab:Fe,cb:pt,eb:bt,Ra:[]}},radialGradient:function(Se,Fe,pt,bt){this.ja={zb:Se,Ab:Fe,cb:pt,eb:bt,Ra:[],ec:!0}},addStop:function(Se,Fe){this.ja.Ra.push({color:Se,stop:Fe})},completeGradient:function(){},draw:function(Se,Fe,pt){let bt=this.Hb;var ot=this.Ya,gt=this.ja;if(Se.globalCompositeOperation=this.Eb,gt!=null){ot=gt.zb;var It=gt.Ab;const Sr=gt.cb;var jt=gt.eb;const Yt=gt.Ra;gt.ec?(gt=Sr-ot,jt-=It,ot=Se.createRadialGradient(ot,It,0,ot,It,Math.sqrt(gt*gt+jt*jt))):ot=Se.createLinearGradient(ot,It,Sr,jt);for(let gr=0,Jt=Yt.length;gr<Jt;gr++)It=Yt[gr],ot.addColorStop(It.stop,a(It.color));this.Ya=ot,this.ja=null}switch(bt){case Oe:Se.strokeStyle=ot,Se.lineWidth=this.Ib,Se.lineCap=this.Ha,Se.lineJoin=this.Ia,Se.stroke(Fe);break;case Te:Se.fillStyle=ot,Se.fill(Fe,pt)}}});const ct=new Set;let De=null,$t=[],er=0,Pr=0;var _n=g.CanvasRenderer=U.extend("Renderer",{__construct:function(Se){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=Se.getContext("2d"),this.Va=Se,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const Se=this.S.length-6;if(6>Se)throw"restore() called without matching save().";this.S.splice(Se),this.H.push(this.C.restore.bind(this.C))},transform:function(Se,Fe,pt,bt,ot,gt){const It=this.S,jt=It.length-6;It.splice(jt,6,It[jt]*Se+It[jt+2]*Fe,It[jt+1]*Se+It[jt+3]*Fe,It[jt]*pt+It[jt+2]*bt,It[jt+1]*pt+It[jt+3]*bt,It[jt]*ot+It[jt+2]*gt+It[jt+4],It[jt+1]*ot+It[jt+3]*gt+It[jt+5]),this.H.push(this.C.transform.bind(this.C,Se,Fe,pt,bt,ot,gt))},rotate:function(Se){const Fe=Math.sin(Se);Se=Math.cos(Se),this.transform(Se,Fe,-Fe,Se,0,0)},_drawPath:function(Se,Fe){this.H.push(Fe.draw.bind(Fe,this.C,Se.T,Se.Wa===Ue?"evenodd":"nonzero"))},_drawRiveImage:function(Se,Fe,pt,bt){var ot=Se.Fb;if(ot){var gt=this.C,It=s(pt);this.H.push(function(){gt.globalCompositeOperation=It,gt.globalAlpha=bt,gt.drawImage(ot,0,0),gt.globalAlpha=1})}},_getMatrix:function(Se){const Fe=this.S,pt=Fe.length-6;for(let bt=0;6>bt;++bt)Se[bt]=Fe[pt+bt]},_drawImageMesh:function(Se,Fe,pt,bt,ot,gt,It,jt,Sr,Yt,gr){Fe=this.C.canvas.width;var Jt=this.C.canvas.height;const Ko=Yt-jt,Yo=gr-Sr;jt=Math.max(jt,0),Sr=Math.max(Sr,0),Yt=Math.min(Yt,Fe),gr=Math.min(gr,Jt);const Ai=Yt-jt,Ci=gr-Sr;if(console.assert(Ai<=Math.min(Ko,Fe)),console.assert(Ci<=Math.min(Yo,Jt)),!(0>=Ai||0>=Ci)){Yt=Ai<Ko||Ci<Yo,Fe=gr=1;var mn=Math.ceil(Ai*gr),yn=Math.ceil(Ci*Fe);Jt=z.hc(),mn>Jt&&(gr*=Jt/mn,mn=Jt),yn>Jt&&(Fe*=Jt/yn,yn=Jt),De||(De=new g.DynamicRectanizer(Jt),De.reset(512,512)),Jt=De.addRect(mn,yn),0>Jt&&(d(),ct.add(this),Jt=De.addRect(mn,yn),console.assert(0<=Jt));var Jo=Jt&65535,Xo=Jt>>16;$t.push({ha:this.S.slice(this.S.length-6),image:Se,Za:Jo,$a:Xo,ic:jt,jc:Sr,Ac:mn,kb:yn,Ba:gr,Ca:Fe,Ua:new Float32Array(ot),Db:new Float32Array(gt),indices:new Uint16Array(It),mc:Yt,xb:Se.Ka<<1|(Yt?1:0)}),er+=ot.length,Pr+=It.length;var Wn=this.C,Sc=s(pt);this.H.push(function(){Wn.save(),Wn.resetTransform(),Wn.globalCompositeOperation=Sc,Wn.globalAlpha=bt;const Qo=z.canvas();Qo&&Wn.drawImage(Qo,Jo,Xo,mn,yn,jt,Sr,Ai,Ci),Wn.restore()})}},_clipPath:function(Se){this.H.push(this.C.clip.bind(this.C,Se.T,Se.Wa===Ue?"evenodd":"nonzero"))},clear:function(){ct.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(Se,Fe){this.transform(1,0,0,1,Se,Fe)}});g.makeRenderer=function(Se){const Fe=new _n(Se),pt=Fe.C;return new Proxy(Fe,{get(bt,ot){if(typeof bt[ot]=="function")return function(...gt){return bt[ot].apply(bt,gt)};if(typeof pt[ot]=="function"){if(-1<F.indexOf(ot))throw Error("RiveException: Method call to '"+ot+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...gt){Fe.H.push(pt[ot].bind(pt,...gt))}}return bt[ot]},set(bt,ot,gt){if(ot in pt)return Fe.H.push(()=>{pt[ot]=gt}),!0}})},g.decodeImage=function(Se,Fe){new xe({la:Fe}).decode(Se)},g.renderFactory={makeRenderPaint:function(){return new at},makeRenderPath:function(){return new Ee},makeRenderImage:function(){let Se=Rr;return new xe({xa:()=>{Se.total++},la:()=>{if(Se.loaded++,Se.loaded===Se.total){const Fe=Se.ready;Fe&&(Fe(),Se.ready=null)}}})}};let yt=g.load,Rr=null;g.load=function(Se,Fe,pt=!0){const bt=new g.FallbackFileAssetLoader;return Fe!==void 0&&bt.addLoader(Fe),pt&&(Fe=new g.CDNFileAssetLoader,bt.addLoader(Fe)),new Promise(function(ot){let gt=null;Rr={total:0,loaded:0,ready:function(){ot(gt)}},gt=yt(Se,bt),Rr.total==0&&ot(gt)})};let kc=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(Se,Fe,pt,bt,ot=1){kc.call(this,Se,Fe,pt,bt,ot)},m=new R,g.requestAnimationFrame=m.requestAnimationFrame.bind(m),g.cancelAnimationFrame=m.cancelAnimationFrame.bind(m),g.enableFPSCounter=m.Rb.bind(m),g.disableFPSCounter=m.Ob,m.pb=d,g.resolveAnimationFrame=d,g.cleanup=function(){De&&De.delete()}};var C=Object.assign({},g),x="./this.program",J=typeof window=="object",X=typeof importScripts=="function",he="",re,ne;(J||X)&&(X?he=self.location.href:typeof document<"u"&&document.currentScript&&(he=document.currentScript.src),w&&(he=w),he.indexOf("blob:")!==0?he=he.substr(0,he.replace(/[?#].*/,"").lastIndexOf("/")+1):he="",X&&(ne=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),re=(s,a,d)=>{var m=new XMLHttpRequest;m.open("GET",s,!0),m.responseType="arraybuffer",m.onload=()=>{m.status==200||m.status==0&&m.response?a(m.response):d()},m.onerror=d,m.send(null)});var me=g.print||console.log.bind(console),te=g.printErr||console.error.bind(console);Object.assign(g,C),C=null,g.thisProgram&&(x=g.thisProgram);var q;g.wasmBinary&&(q=g.wasmBinary),g.noExitRuntime,typeof WebAssembly!="object"&&ce("no native wasm support detected");var ee,P,D=!1,Z,ie,ge,_e,ke,Ae,Ne,ae;function se(){var s=ee.buffer;g.HEAP8=Z=new Int8Array(s),g.HEAP16=ge=new Int16Array(s),g.HEAP32=ke=new Int32Array(s),g.HEAPU8=ie=new Uint8Array(s),g.HEAPU16=_e=new Uint16Array(s),g.HEAPU32=Ae=new Uint32Array(s),g.HEAPF32=Ne=new Float32Array(s),g.HEAPF64=ae=new Float64Array(s)}var Q,ue=[],le=[],de=[];function ve(){var s=g.preRun.shift();ue.unshift(s)}var Ce=0,Pe=null;function ce(s){throw g.onAbort&&g.onAbort(s),s="Aborted("+s+")",te(s),D=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),T(s),s}function Ie(s){return s.startsWith("data:application/octet-stream;base64,")}var je;if(je="canvas_advanced.wasm",!Ie(je)){var $e=je;je=g.locateFile?g.locateFile($e,he):he+$e}function qe(s){if(s==je&&q)return new Uint8Array(q);if(ne)return ne(s);throw"both async and sync fetching of the wasm failed"}function Ge(s){if(!q&&(J||X)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>qe(s));if(re)return new Promise((a,d)=>{re(s,m=>a(new Uint8Array(m)),d)})}return Promise.resolve().then(()=>qe(s))}function Ke(s,a,d){return Ge(s).then(m=>WebAssembly.instantiate(m,a)).then(m=>m).then(d,m=>{te("failed to asynchronously prepare wasm: "+m),ce(m)})}function _t(s,a){var d=je;return q||typeof WebAssembly.instantiateStreaming!="function"||Ie(d)||d.startsWith("file://")||typeof fetch!="function"?Ke(d,s,a):fetch(d,{credentials:"same-origin"}).then(m=>WebAssembly.instantiateStreaming(m,s).then(a,function(I){return te("wasm streaming compile failed: "+I),te("falling back to ArrayBuffer instantiation"),Ke(d,s,a)}))}var Xe,y,l={460492:(s,a,d,m,I)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=a,window.h.I.La=d,window.h.ga={},window.h.ga.stopped=m,window.h.ga.yb=I;let j=window.h;j.D=[],j.yc=function(U){for(var Y=0;Y<j.D.length;++Y)if(j.D[Y]==null)return j.D[Y]=U,Y;return j.D.push(U),j.D.length-1},j.Cb=function(U){for(j.D[U]=null;0<j.D.length&&j.D[j.D.length-1]==null;)j.D.pop()},j.Sc=function(U){for(var Y=0;Y<j.D.length;++Y)if(j.D[Y]==U)return j.Cb(Y)},j.ra=function(U){return j.D[U]},j.Ta=["touchend","click"],j.unlock=function(){for(var U=0;U<j.D.length;++U){var Y=j.D[U];Y!=null&&Y.J!=null&&Y.state===j.ga.yb&&Y.J.resume().then(()=>{qo(Y.qb)},oe=>{console.error("Failed to resume audiocontext",oe)})}j.Ta.map(function(oe){document.removeEventListener(oe,j.unlock,!0)})},j.Ta.map(function(U){document.addEventListener(U,j.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),a=s.sampleRate;return s.close(),a}catch{return 0}},463249:(s,a,d,m,I,j)=>{if(typeof window.h>"u")return-1;var U={},Y={};return s==window.h.I.ya&&d!=0&&(Y.sampleRate=d),U.J=new(window.AudioContext||window.webkitAudioContext)(Y),U.J.suspend(),U.state=window.h.ga.stopped,d=0,s!=window.h.I.ya&&(d=a),U.Z=U.J.createScriptProcessor(m,d,a),U.Z.onaudioprocess=function(oe){if((U.sa==null||U.sa.length==0)&&(U.sa=new Float32Array(Ne.buffer,I,m*a)),s==window.h.I.capture||s==window.h.I.La){for(var G=0;G<a;G+=1)for(var Te=oe.inputBuffer.getChannelData(G),Oe=U.sa,Ue=0;Ue<m;Ue+=1)Oe[Ue*a+G]=Te[Ue];Vo(j,m,I)}if(s==window.h.I.ya||s==window.h.I.La)for(Go(j,m,I),G=0;G<oe.outputBuffer.numberOfChannels;++G)for(Te=oe.outputBuffer.getChannelData(G),Oe=U.sa,Ue=0;Ue<m;Ue+=1)Te[Ue]=Oe[Ue*a+G];else for(G=0;G<oe.outputBuffer.numberOfChannels;++G)oe.outputBuffer.getChannelData(G).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(oe){U.Da=U.J.createMediaStreamSource(oe),U.Da.connect(U.Z),U.Z.connect(U.J.destination)}).catch(function(oe){console.log("Failed to get user media: "+oe)}),s==window.h.I.ya&&U.Z.connect(U.J.destination),U.qb=j,window.h.yc(U)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},f=s=>{for(;0<s.length;)s.shift()(g)},k=(s,a)=>{for(var d=0,m=s.length-1;0<=m;m--){var I=s[m];I==="."?s.splice(m,1):I===".."?(s.splice(m,1),d++):d&&(s.splice(m,1),d--)}if(a)for(;d;d--)s.unshift("..");return s},M=s=>{var a=s.charAt(0)==="/",d=s.substr(-1)==="/";return(s=k(s.split("/").filter(m=>!!m),!a).join("/"))||a||(s="."),s&&d&&(s+="/"),(a?"/":"")+s},H=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},fe=s=>{if(s==="/")return"/";s=M(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},Me=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);ce("initRandomDevice")},We=s=>(We=Me())(s);function Le(){for(var s="",a=!1,d=arguments.length-1;-1<=d&&!a;d--){if(a=0<=d?arguments[d]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=k(s.split("/").filter(m=>!!m),!a).join("/"),(a?"/":"")+s||"."}var ze=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,et=(s,a,d)=>{var m=a+d;for(d=a;s[d]&&!(d>=m);)++d;if(16<d-a&&s.buffer&&ze)return ze.decode(s.subarray(a,d));for(m="";a<d;){var I=s[a++];if(I&128){var j=s[a++]&63;if((I&224)==192)m+=String.fromCharCode((I&31)<<6|j);else{var U=s[a++]&63;I=(I&240)==224?(I&15)<<12|j<<6|U:(I&7)<<18|j<<12|U<<6|s[a++]&63,65536>I?m+=String.fromCharCode(I):(I-=65536,m+=String.fromCharCode(55296|I>>10,56320|I&1023))}}else m+=String.fromCharCode(I)}return m},At=[],mt=s=>{for(var a=0,d=0;d<s.length;++d){var m=s.charCodeAt(d);127>=m?a++:2047>=m?a+=2:55296<=m&&57343>=m?(a+=4,++d):a+=3}return a},Gt=(s,a,d,m)=>{if(!(0<m))return 0;var I=d;m=d+m-1;for(var j=0;j<s.length;++j){var U=s.charCodeAt(j);if(55296<=U&&57343>=U){var Y=s.charCodeAt(++j);U=65536+((U&1023)<<10)|Y&1023}if(127>=U){if(d>=m)break;a[d++]=U}else{if(2047>=U){if(d+1>=m)break;a[d++]=192|U>>6}else{if(65535>=U){if(d+2>=m)break;a[d++]=224|U>>12}else{if(d+3>=m)break;a[d++]=240|U>>18,a[d++]=128|U>>12&63}a[d++]=128|U>>6&63}a[d++]=128|U&63}}return a[d]=0,d-I};function Bt(s,a){var d=Array(mt(s)+1);return s=Gt(s,d,0,d.length),a&&(d.length=s),d}var Tt=[];function it(s,a){Tt[s]={input:[],F:[],V:a},Vs(s,Je)}var Je={open:function(s){var a=Tt[s.node.za];if(!a)throw new Be(43);s.s=a,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,a,d,m){if(!s.s||!s.s.V.jb)throw new Be(60);for(var I=0,j=0;j<m;j++){try{var U=s.s.V.jb(s.s)}catch{throw new Be(29)}if(U===void 0&&I===0)throw new Be(6);if(U==null)break;I++,a[d+j]=U}return I&&(s.node.timestamp=Date.now()),I},write:function(s,a,d,m){if(!s.s||!s.s.V.Oa)throw new Be(60);try{for(var I=0;I<m;I++)s.s.V.Oa(s.s,a[d+I])}catch{throw new Be(29)}return m&&(s.node.timestamp=Date.now()),I}},Ct={jb:function(){e:{if(!At.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}At=Bt(s,!0)}s=At.shift()}return s},Oa:function(s,a){a===null||a===10?(me(et(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(me(et(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},ut={Oa:function(s,a){a===null||a===10?(te(et(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(te(et(s.F,0)),s.F=[])}};function vt(s,a){var d=s.j?s.j.length:0;d>=a||(a=Math.max(a,d*(1048576>d?2:1.125)>>>0),d!=0&&(a=Math.max(a,256)),d=s.j,s.j=new Uint8Array(a),0<s.v&&s.j.set(d.subarray(0,s.v),0))}var Re={O:null,U(){return Re.createNode(null,"/",16895,0)},createNode(s,a,d,m){if((d&61440)===24576||(d&61440)===4096)throw new Be(63);return Re.O||(Re.O={dir:{node:{Y:Re.l.Y,P:Re.l.P,ka:Re.l.ka,va:Re.l.va,vb:Re.l.vb,Bb:Re.l.Bb,wb:Re.l.wb,tb:Re.l.tb,Ea:Re.l.Ea},stream:{ba:Re.m.ba}},file:{node:{Y:Re.l.Y,P:Re.l.P},stream:{ba:Re.m.ba,read:Re.m.read,write:Re.m.write,pa:Re.m.pa,mb:Re.m.mb,ob:Re.m.ob}},link:{node:{Y:Re.l.Y,P:Re.l.P,ma:Re.l.ma},stream:{}},ab:{node:{Y:Re.l.Y,P:Re.l.P},stream:ec}}),d=fo(s,a,d,m),(d.mode&61440)===16384?(d.l=Re.O.dir.node,d.m=Re.O.dir.stream,d.j={}):(d.mode&61440)===32768?(d.l=Re.O.file.node,d.m=Re.O.file.stream,d.v=0,d.j=null):(d.mode&61440)===40960?(d.l=Re.O.link.node,d.m=Re.O.link.stream):(d.mode&61440)===8192&&(d.l=Re.O.ab.node,d.m=Re.O.ab.stream),d.timestamp=Date.now(),s&&(s.j[a]=d,s.timestamp=d.timestamp),d},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var a={};return a.Jc=(s.mode&61440)===8192?s.id:1,a.Mc=s.id,a.mode=s.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=s.za,(s.mode&61440)===16384?a.size=4096:(s.mode&61440)===32768?a.size=s.v:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Bc=new Date(s.timestamp),a.Nc=new Date(s.timestamp),a.Ic=new Date(s.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.v!=a))if(a==0)s.j=null,s.v=0;else{var d=s.j;s.j=new Uint8Array(a),d&&s.j.set(d.subarray(0,Math.min(a,s.v))),s.v=a}},ka(){throw qs[44]},va(s,a,d,m){return Re.createNode(s,a,d,m)},vb(s,a,d){if((s.mode&61440)===16384){try{var m=zi(a,d)}catch{}if(m)for(var I in m.j)throw new Be(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=d,a.j[d]=s,a.timestamp=s.parent.timestamp,s.parent=a},Bb(s,a){delete s.j[a],s.timestamp=Date.now()},wb(s,a){var d=zi(s,a),m;for(m in d.j)throw new Be(55);delete s.j[a],s.timestamp=Date.now()},tb(s){var a=[".",".."],d;for(d in s.j)s.j.hasOwnProperty(d)&&a.push(d);return a},Ea(s,a,d){return s=Re.createNode(s,a,41471,0),s.link=d,s},ma(s){if((s.mode&61440)!==40960)throw new Be(28);return s.link}},m:{read(s,a,d,m,I){var j=s.node.j;if(I>=s.node.v)return 0;if(s=Math.min(s.node.v-I,m),8<s&&j.subarray)a.set(j.subarray(I,I+s),d);else for(m=0;m<s;m++)a[d+m]=j[I+m];return s},write(s,a,d,m,I,j){if(a.buffer===Z.buffer&&(j=!1),!m)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.j||s.j.subarray)){if(j)return s.j=a.subarray(d,d+m),s.v=m;if(s.v===0&&I===0)return s.j=a.slice(d,d+m),s.v=m;if(I+m<=s.v)return s.j.set(a.subarray(d,d+m),I),m}if(vt(s,I+m),s.j.subarray&&a.subarray)s.j.set(a.subarray(d,d+m),I);else for(j=0;j<m;j++)s.j[I+j]=a[d+j];return s.v=Math.max(s.v,I+m),m},ba(s,a,d){if(d===1?a+=s.position:d===2&&(s.node.mode&61440)===32768&&(a+=s.node.v),0>a)throw new Be(28);return a},pa(s,a,d){vt(s.node,a+d),s.node.v=Math.max(s.node.v,a+d)},mb(s,a,d,m,I){if((s.node.mode&61440)!==32768)throw new Be(43);if(s=s.node.j,I&2||s.buffer!==Z.buffer){if((0<d||d+a<s.length)&&(s.subarray?s=s.subarray(d,d+a):s=Array.prototype.slice.call(s,d,d+a)),d=!0,ce(),a=void 0,!a)throw new Be(48);Z.set(s,a)}else d=!1,a=s.byteOffset;return{o:a,M:d}},ob(s,a,d,m){return Re.m.write(s,a,0,m,d,!1),0}}};function Qe(s,a){var d=0;return s&&(d|=365),a&&(d|=146),d}var zt=null,$n={},Gi=[],Qu=1,_i=null,lo=!0,Be=null,qs={},vn=(s,a={})=>{if(s=Le(s),!s)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new Be(32);s=s.split("/").filter(U=>!!U);for(var d=zt,m="/",I=0;I<s.length;I++){var j=I===s.length-1;if(j&&a.parent)break;if(d=zi(d,s[I]),m=M(m+"/"+s[I]),d.wa&&(!j||j&&a.hb)&&(d=d.wa.root),!j||a.gb){for(j=0;(d.mode&61440)===40960;)if(d=tc(m),m=Le(H(m),d),d=vn(m,{Qa:a.Qa+1}).node,40<j++)throw new Be(32)}}return{path:m,node:d}},uo=s=>{for(var a;;){if(s===s.parent)return s=s.U.nb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}},co=(s,a)=>{for(var d=0,m=0;m<a.length;m++)d=(d<<5)-d+a.charCodeAt(m)|0;return(s+d>>>0)%_i.length},zi=(s,a)=>{var d;if(d=(d=Hi(s,"x"))?d:s.l.ka?0:2)throw new Be(d,s);for(d=_i[co(s.id,a)];d;d=d.lc){var m=d.name;if(d.parent.id===s.id&&m===a)return d}return s.l.ka(s,a)},fo=(s,a,d,m)=>(s=new Uo(s,a,d,m),a=co(s.parent.id,s.name),s.lc=_i[a],_i[a]=s),ho=s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},Hi=(s,a)=>{if(lo)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},vo=(s,a)=>{try{return zi(s,a),20}catch{}return Hi(s,"wx")},Zu=()=>{for(var s=0;4096>=s;s++)if(!Gi[s])return s;throw new Be(33)},Xr=s=>{if(s=Gi[s],!s)throw new Be(8);return s},po=(s,a=-1)=>(yi||(yi=function(){this.h={}},yi.prototype={},Object.defineProperties(yi.prototype,{object:{get(){return this.node},set(d){this.node=d}},flags:{get(){return this.h.flags},set(d){this.h.flags=d}},position:{get(){return this.h.position},set(d){this.h.position=d}}})),s=Object.assign(new yi,s),a==-1&&(a=Zu()),s.X=a,Gi[a]=s),ec={open:s=>{s.m=$n[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new Be(70)}},Vs=(s,a)=>{$n[s]={m:a}},go=(s,a)=>{var d=a==="/",m=!a;if(d&&zt)throw new Be(10);if(!d&&!m){var I=vn(a,{hb:!1});if(a=I.path,I=I.node,I.wa)throw new Be(10);if((I.mode&61440)!==16384)throw new Be(54)}a={type:s,Qc:{},nb:a,kc:[]},s=s.U(a),s.U=a,a.root=s,d?zt=s:I&&(I.wa=a,I.U&&I.U.kc.push(a))},br=(s,a,d)=>{var m=vn(s,{parent:!0}).node;if(s=fe(s),!s||s==="."||s==="..")throw new Be(28);var I=vo(m,s);if(I)throw new Be(I);if(!m.l.va)throw new Be(63);return m.l.va(m,s,a,d)},Ki=(s,a,d)=>{typeof d>"u"&&(d=a,a=438),br(s,a|8192,d)},Gs=(s,a)=>{if(!Le(s))throw new Be(44);var d=vn(a,{parent:!0}).node;if(!d)throw new Be(44);a=fe(a);var m=vo(d,a);if(m)throw new Be(m);if(!d.l.Ea)throw new Be(63);d.l.Ea(d,a,s)},tc=s=>{if(s=vn(s).node,!s)throw new Be(44);if(!s.l.ma)throw new Be(28);return Le(uo(s.parent),s.l.ma(s))},Yi=(s,a,d)=>{if(s==="")throw new Be(44);if(typeof a=="string"){var m={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof m>"u")throw Error(`Unknown file open mode: ${a}`);a=m}if(d=a&64?(typeof d>"u"?438:d)&4095|32768:0,typeof s=="object")var I=s;else{s=M(s);try{I=vn(s,{gb:!(a&131072)}).node}catch{}}if(m=!1,a&64)if(I){if(a&128)throw new Be(20)}else I=br(s,d,0),m=!0;if(!I)throw new Be(44);if((I.mode&61440)===8192&&(a&=-513),a&65536&&(I.mode&61440)!==16384)throw new Be(54);if(!m&&(d=I?(I.mode&61440)===40960?32:(I.mode&61440)===16384&&(ho(a)!=="r"||a&512)?31:Hi(I,ho(a)):44))throw new Be(d);if(a&512&&!m){if(d=I,d=typeof d=="string"?vn(d,{gb:!0}).node:d,!d.l.P)throw new Be(63);if((d.mode&61440)===16384)throw new Be(31);if((d.mode&61440)!==32768)throw new Be(28);if(m=Hi(d,"w"))throw new Be(m);d.l.P(d,{size:0,timestamp:Date.now()})}return a&=-131713,I=po({node:I,path:uo(I),flags:a,seekable:!0,position:0,m:I.m,zc:[],error:!1}),I.m.open&&I.m.open(I),!g.logReadFiles||a&1||(Ji||(Ji={}),s in Ji||(Ji[s]=1)),I},_o=(s,a,d)=>{if(s.X===null)throw new Be(8);if(!s.seekable||!s.m.ba)throw new Be(70);if(d!=0&&d!=1&&d!=2)throw new Be(28);s.position=s.m.ba(s,a,d),s.zc=[]},mo=()=>{Be||(Be=function(s,a){this.name="ErrnoError",this.node=a,this.pc=function(d){this.aa=d},this.pc(s),this.message="FS error"},Be.prototype=Error(),Be.prototype.constructor=Be,[44].forEach(s=>{qs[s]=new Be(s),qs[s].stack="<generic error, no stack>"}))},yo,mi=(s,a,d)=>{s=M("/dev/"+s);var m=Qe(!!a,!!d);zs||(zs=64);var I=zs++<<8|0;Vs(I,{open:j=>{j.seekable=!1},close:()=>{d&&d.buffer&&d.buffer.length&&d(10)},read:(j,U,Y,oe)=>{for(var G=0,Te=0;Te<oe;Te++){try{var Oe=a()}catch{throw new Be(29)}if(Oe===void 0&&G===0)throw new Be(6);if(Oe==null)break;G++,U[Y+Te]=Oe}return G&&(j.node.timestamp=Date.now()),G},write:(j,U,Y,oe)=>{for(var G=0;G<oe;G++)try{d(U[Y+G])}catch{throw new Be(29)}return oe&&(j.node.timestamp=Date.now()),G}}),Ki(s,m,I)},zs,pn={},yi,Ji,bi=void 0;function Ur(){return bi+=4,ke[bi-4>>2]}function bo(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?`_${s}`:s}function Xi(s,a){return s=bo(s),{[s]:function(){return a.apply(this,arguments)}}[s]}function wo(){this.M=[void 0],this.ib=[]}var pr=new wo,Un=void 0;function st(s){throw new Un(s)}var wr=s=>(s||st("Cannot use deleted val. handle = "+s),pr.get(s).value),kr=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return pr.pa({ub:1,value:s})}};function ko(s){var a=Error,d=Xi(s,function(m){this.name=s,this.message=m,m=Error(m).stack,m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},d}var So=void 0,Io=void 0;function Wt(s){for(var a="";ie[s];)a+=Io[ie[s++]];return a}var wi=[];function Hs(){for(;wi.length;){var s=wi.pop();s.g.fa=!1,s.delete()}}var ki=void 0,Nr={};function Ks(s,a){for(a===void 0&&st("ptr should not be undefined");s.A;)a=s.na(a),s=s.A;return a}var gn={};function Eo(s){s=zo(s);var a=Wt(s);return qr(s),a}function Si(s,a){var d=gn[s];return d===void 0&&st(a+" has unknown type "+Eo(s)),d}function Qi(){}var Ys=!1;function Ao(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function Co(s,a,d){return a===d?s:d.A===void 0?null:(s=Co(s,a,d.A),s===null?null:d.Pb(s))}var jo={};function rc(s,a){return a=Ks(s,a),Nr[a]}var xo=void 0;function Zi(s){throw new xo(s)}function es(s,a){return a.u&&a.o||Zi("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Zi("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Nn(Object.create(s,{g:{value:a}}))}function Nn(s){return typeof FinalizationRegistry>"u"?(Nn=a=>a,s):(Ys=new FinalizationRegistry(a=>{Ao(a.g)}),Nn=a=>{var d=a.g;return d.G&&Ys.register(a,{g:d},a),a},Qi=a=>{Ys.unregister(a)},Nn(s))}var ts={};function Ii(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function Ei(s){return this.fromWireType(ke[s>>2])}var Bn={},rs={};function fr(s,a,d){function m(Y){Y=d(Y),Y.length!==s.length&&Zi("Mismatched type converter count");for(var oe=0;oe<s.length;++oe)Tr(s[oe],Y[oe])}s.forEach(function(Y){rs[Y]=a});var I=Array(a.length),j=[],U=0;a.forEach((Y,oe)=>{gn.hasOwnProperty(Y)?I[oe]=gn[Y]:(j.push(Y),Bn.hasOwnProperty(Y)||(Bn[Y]=[]),Bn[Y].push(()=>{I[oe]=gn[Y],++U,U===j.length&&m(I)}))}),j.length===0&&m(I)}function ns(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function nc(s,a,d={}){var m=a.name;if(s||st(`type "${m}" must have a positive integer typeid pointer`),gn.hasOwnProperty(s)){if(d.$b)return;st(`Cannot register type '${m}' twice`)}gn[s]=a,delete rs[s],Bn.hasOwnProperty(s)&&(a=Bn[s],delete Bn[s],a.forEach(I=>I()))}function Tr(s,a,d={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");nc(s,a,d)}function Js(s){st(s.g.u.i.name+" instance already deleted")}function Qr(){}function Xs(s,a,d){if(s[a].B===void 0){var m=s[a];s[a]=function(){return s[a].B.hasOwnProperty(arguments.length)||st(`Function '${d}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[a].B})!`),s[a].B[arguments.length].apply(this,arguments)},s[a].B=[],s[a].B[m.ea]=m}}function Qs(s,a,d){g.hasOwnProperty(s)?((d===void 0||g[s].B!==void 0&&g[s].B[d]!==void 0)&&st(`Cannot register public name '${s}' twice`),Xs(g,s,s),g.hasOwnProperty(d)&&st(`Cannot register multiple overloads of a function with the same number of arguments (${d})!`),g[s].B[d]=a):(g[s]=a,d!==void 0&&(g[s].Pc=d))}function ic(s,a,d,m,I,j,U,Y){this.name=s,this.constructor=a,this.N=d,this.W=m,this.A=I,this.Ub=j,this.na=U,this.Pb=Y,this.rb=[]}function is(s,a,d){for(;a!==d;)a.na||st(`Expected null or instance of ${d.name}, got an instance of ${a.name}`),s=a.na(s),a=a.A;return s}function sc(s,a){return a===null?(this.Na&&st(`null is not a valid ${this.name}`),0):(a.g||st(`Cannot pass "${ea(a)}" as a ${this.name}`),a.g.o||st(`Cannot pass deleted object as a pointer of type ${this.name}`),is(a.g.o,a.g.u.i,this.i))}function ac(s,a){if(a===null){if(this.Na&&st(`null is not a valid ${this.name}`),this.ua){var d=this.Pa();return s!==null&&s.push(this.W,d),d}return 0}if(a.g||st(`Cannot pass "${ea(a)}" as a ${this.name}`),a.g.o||st(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&st(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),d=is(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&st("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?d=a.g.G:st(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:d=a.g.G;break;case 2:if(a.g.L===this)d=a.g.G;else{var m=a.clone();d=this.oc(d,kr(function(){m.delete()})),s!==null&&s.push(this.W,d)}break;default:st("Unsupporting sharing policy")}return d}function oc(s,a){return a===null?(this.Na&&st(`null is not a valid ${this.name}`),0):(a.g||st(`Cannot pass "${ea(a)}" as a ${this.name}`),a.g.o||st(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&st(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),is(a.g.o,a.g.u.i,this.i))}function Br(s,a,d,m){this.name=s,this.i=a,this.Na=d,this.ta=m,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=ac:(this.toWireType=m?sc:oc,this.K=null)}function To(s,a,d){g.hasOwnProperty(s)||Zi("Replacing nonexistant public symbol"),g[s].B!==void 0&&d!==void 0?g[s].B[d]=a:(g[s]=a,g[s].ea=d)}var ss=[],Po=s=>{var a=ss[s];return a||(s>=ss.length&&(ss.length=s+1),ss[s]=a=Q.get(s)),a},lc=(s,a)=>{var d=[];return function(){if(d.length=0,Object.assign(d,arguments),s.includes("j")){var m=g["dynCall_"+s];m=d&&d.length?m.apply(null,[a].concat(d)):m.call(null,a)}else m=Po(a).apply(null,d);return m}};function tr(s,a){s=Wt(s);var d=s.includes("j")?lc(s,a):Po(a);return typeof d!="function"&&st(`unknown function pointer with signature ${s}: ${a}`),d}var Ro=void 0;function Wr(s,a){function d(j){I[j]||gn[j]||(rs[j]?rs[j].forEach(d):(m.push(j),I[j]=!0))}var m=[],I={};throw a.forEach(d),new Ro(`${s}: `+m.map(Eo).join([", "]))}function as(s,a,d,m,I){var j=a.length;2>j&&st("argTypes array size mismatch! Must at least get return value and 'this' types!");var U=a[1]!==null&&d!==null,Y=!1;for(d=1;d<a.length;++d)if(a[d]!==null&&a[d].K===void 0){Y=!0;break}var oe=a[0].name!=="void",G=j-2,Te=Array(G),Oe=[],Ue=[];return function(){if(arguments.length!==G&&st(`function ${s} called with ${arguments.length} arguments, expected ${G} args!`),Ue.length=0,Oe.length=U?2:1,Oe[0]=I,U){var B=a[1].toWireType(Ue,this);Oe[1]=B}for(var xe=0;xe<G;++xe)Te[xe]=a[xe+2].toWireType(Ue,arguments[xe]),Oe.push(Te[xe]);if(xe=m.apply(null,Oe),Y)Ii(Ue);else for(var Ee=U?1:2;Ee<a.length;Ee++){var at=Ee===1?B:Te[Ee-2];a[Ee].K!==null&&a[Ee].K(at)}return B=oe?a[0].fromWireType(xe):void 0,B}}function os(s,a){for(var d=[],m=0;m<s;m++)d.push(Ae[a+4*m>>2]);return d}function Oo(s,a,d){return s instanceof Object||st(`${d} with invalid "this": ${s}`),s instanceof a.i.constructor||st(`${d} incompatible with "this" of type ${s.constructor.name}`),s.g.o||st(`cannot call emscripten binding method ${d} on deleted object`),is(s.g.o,s.g.u.i,a.i)}function Zs(s){s>=pr.h&&--pr.get(s).ub===0&&pr.Zb(s)}function uc(s,a,d){switch(a){case 0:return function(m){return this.fromWireType((d?Z:ie)[m])};case 1:return function(m){return this.fromWireType((d?ge:_e)[m>>1])};case 2:return function(m){return this.fromWireType((d?ke:Ae)[m>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function ea(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function cc(s,a){switch(a){case 2:return function(d){return this.fromWireType(Ne[d>>2])};case 3:return function(d){return this.fromWireType(ae[d>>3])};default:throw new TypeError("Unknown float type: "+s)}}function dc(s,a,d){switch(a){case 0:return d?function(m){return Z[m]}:function(m){return ie[m]};case 1:return d?function(m){return ge[m>>1]}:function(m){return _e[m>>1]};case 2:return d?function(m){return ke[m>>2]}:function(m){return Ae[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Mo=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,fc=(s,a)=>{for(var d=s>>1,m=d+a/2;!(d>=m)&&_e[d];)++d;if(d<<=1,32<d-s&&Mo)return Mo.decode(ie.subarray(s,d));for(d="",m=0;!(m>=a/2);++m){var I=ge[s+2*m>>1];if(I==0)break;d+=String.fromCharCode(I)}return d},hc=(s,a,d)=>{if(d===void 0&&(d=2147483647),2>d)return 0;d-=2;var m=a;d=d<2*s.length?d/2:s.length;for(var I=0;I<d;++I)ge[a>>1]=s.charCodeAt(I),a+=2;return ge[a>>1]=0,a-m},vc=s=>2*s.length,pc=(s,a)=>{for(var d=0,m="";!(d>=a/4);){var I=ke[s+4*d>>2];if(I==0)break;++d,65536<=I?(I-=65536,m+=String.fromCharCode(55296|I>>10,56320|I&1023)):m+=String.fromCharCode(I)}return m},gc=(s,a,d)=>{if(d===void 0&&(d=2147483647),4>d)return 0;var m=a;d=m+d-4;for(var I=0;I<s.length;++I){var j=s.charCodeAt(I);if(55296<=j&&57343>=j){var U=s.charCodeAt(++I);j=65536+((j&1023)<<10)|U&1023}if(ke[a>>2]=j,a+=4,a+4>d)break}return ke[a>>2]=0,a-m},_c=s=>{for(var a=0,d=0;d<s.length;++d){var m=s.charCodeAt(d);55296<=m&&57343>=m&&++d,a+=4}return a},mc={};function ls(s){var a=mc[s];return a===void 0?Wt(s):a}var us=[];function yc(s){var a=us.length;return us.push(s),a}function bc(s,a){for(var d=Array(s),m=0;m<s;++m)d[m]=Si(Ae[a+4*m>>2],"parameter "+m);return d}var Lo=[],ta=[],ra={},Do=()=>{if(!na){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:x||"./this.program"},a;for(a in ra)ra[a]===void 0?delete s[a]:s[a]=ra[a];var d=[];for(a in s)d.push(`${a}=${s[a]}`);na=d}return na},na,cs=s=>s%4===0&&(s%100!==0||s%400===0),Fo=[31,29,31,30,31,30,31,31,30,31,30,31],$o=[31,28,31,30,31,30,31,31,30,31,30,31],wc=(s,a,d,m)=>{function I(B,xe,Ee){for(B=typeof B=="number"?B.toString():B||"";B.length<xe;)B=Ee[0]+B;return B}function j(B,xe){return I(B,xe,"0")}function U(B,xe){function Ee(ct){return 0>ct?-1:0<ct?1:0}var at;return(at=Ee(B.getFullYear()-xe.getFullYear()))===0&&(at=Ee(B.getMonth()-xe.getMonth()))===0&&(at=Ee(B.getDate()-xe.getDate())),at}function Y(B){switch(B.getDay()){case 0:return new Date(B.getFullYear()-1,11,29);case 1:return B;case 2:return new Date(B.getFullYear(),0,3);case 3:return new Date(B.getFullYear(),0,2);case 4:return new Date(B.getFullYear(),0,1);case 5:return new Date(B.getFullYear()-1,11,31);case 6:return new Date(B.getFullYear()-1,11,30)}}function oe(B){var xe=B.ca;for(B=new Date(new Date(B.da+1900,0,1).getTime());0<xe;){var Ee=B.getMonth(),at=(cs(B.getFullYear())?Fo:$o)[Ee];if(xe>at-B.getDate())xe-=at-B.getDate()+1,B.setDate(1),11>Ee?B.setMonth(Ee+1):(B.setMonth(0),B.setFullYear(B.getFullYear()+1));else{B.setDate(B.getDate()+xe);break}}return Ee=new Date(B.getFullYear()+1,0,4),xe=Y(new Date(B.getFullYear(),0,4)),Ee=Y(Ee),0>=U(xe,B)?0>=U(Ee,B)?B.getFullYear()+1:B.getFullYear():B.getFullYear()-1}var G=ke[m+40>>2];m={wc:ke[m>>2],vc:ke[m+4>>2],Fa:ke[m+8>>2],Sa:ke[m+12>>2],Ga:ke[m+16>>2],da:ke[m+20>>2],R:ke[m+24>>2],ca:ke[m+28>>2],Rc:ke[m+32>>2],uc:ke[m+36>>2],xc:G&&G?et(ie,G):""},d=d?et(ie,d):"",G={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Te in G)d=d.replace(new RegExp(Te,"g"),G[Te]);var Oe="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ue="January February March April May June July August September October November December".split(" ");G={"%a":B=>Oe[B.R].substring(0,3),"%A":B=>Oe[B.R],"%b":B=>Ue[B.Ga].substring(0,3),"%B":B=>Ue[B.Ga],"%C":B=>j((B.da+1900)/100|0,2),"%d":B=>j(B.Sa,2),"%e":B=>I(B.Sa,2," "),"%g":B=>oe(B).toString().substring(2),"%G":B=>oe(B),"%H":B=>j(B.Fa,2),"%I":B=>(B=B.Fa,B==0?B=12:12<B&&(B-=12),j(B,2)),"%j":B=>{for(var xe=0,Ee=0;Ee<=B.Ga-1;xe+=(cs(B.da+1900)?Fo:$o)[Ee++]);return j(B.Sa+xe,3)},"%m":B=>j(B.Ga+1,2),"%M":B=>j(B.vc,2),"%n":()=>`
`,"%p":B=>0<=B.Fa&&12>B.Fa?"AM":"PM","%S":B=>j(B.wc,2),"%t":()=>"	","%u":B=>B.R||7,"%U":B=>j(Math.floor((B.ca+7-B.R)/7),2),"%V":B=>{var xe=Math.floor((B.ca+7-(B.R+6)%7)/7);if(2>=(B.R+371-B.ca-2)%7&&xe++,xe)xe==53&&(Ee=(B.R+371-B.ca)%7,Ee==4||Ee==3&&cs(B.da)||(xe=1));else{xe=52;var Ee=(B.R+7-B.ca-1)%7;(Ee==4||Ee==5&&cs(B.da%400-1))&&xe++}return j(xe,2)},"%w":B=>B.R,"%W":B=>j(Math.floor((B.ca+7-(B.R+6)%7)/7),2),"%y":B=>(B.da+1900).toString().substring(2),"%Y":B=>B.da+1900,"%z":B=>{B=B.uc;var xe=0<=B;return B=Math.abs(B)/60,(xe?"+":"-")+("0000"+(B/60*100+B%60)).slice(-4)},"%Z":B=>B.xc,"%%":()=>"%"},d=d.replace(/%%/g,"\0\0");for(Te in G)d.includes(Te)&&(d=d.replace(new RegExp(Te,"g"),G[Te](m)));return d=d.replace(/\0\0/g,"%"),Te=Bt(d,!1),Te.length>a?0:(Z.set(Te,s),Te.length-1)};function Uo(s,a,d,m){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Qu++,this.name=a,this.mode=d,this.l={},this.m={},this.za=m}Object.defineProperties(Uo.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),mo(),_i=Array(4096),go(Re,"/"),br("/tmp",16895,0),br("/home",16895,0),br("/home/web_user",16895,0),(()=>{br("/dev",16895,0),Vs(259,{read:()=>0,write:(m,I,j,U)=>U}),Ki("/dev/null",259),it(1280,Ct),it(1536,ut),Ki("/dev/tty",1280),Ki("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,d=()=>(a===0&&(a=We(s).byteLength),s[--a]);mi("random",d),mi("urandom",d),br("/dev/shm",16895,0),br("/dev/shm/tmp",16895,0)})(),(()=>{br("/proc",16895,0);var s=br("/proc/self",16895,0);br("/proc/self/fd",16895,0),go({U:()=>{var a=fo(s,"fd",16895,73);return a.l={ka:(d,m)=>{var I=Xr(+m);return d={parent:null,U:{nb:"fake"},l:{ma:()=>I.path}},d.parent=d}},a}},"/proc/self/fd")})(),Object.assign(wo.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var a=this.ib.pop()||this.M.length;return this.M[a]=s,a},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Un=g.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},pr.M.push({value:void 0},{value:null},{value:!0},{value:!1}),pr.h=pr.M.length,g.count_emval_handles=function(){for(var s=0,a=pr.h;a<pr.M.length;++a)pr.M[a]!==void 0&&++s;return s},So=g.PureVirtualError=ko("PureVirtualError");for(var No=Array(256),ds=0;256>ds;++ds)No[ds]=String.fromCharCode(ds);Io=No,g.getInheritedInstanceCount=function(){return Object.keys(Nr).length},g.getLiveInheritedInstances=function(){var s=[],a;for(a in Nr)Nr.hasOwnProperty(a)&&s.push(Nr[a]);return s},g.flushPendingDeletes=Hs,g.setDelayFunction=function(s){ki=s,wi.length&&ki&&ki(Hs)},xo=g.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},Qr.prototype.isAliasOf=function(s){if(!(this instanceof Qr&&s instanceof Qr))return!1;var a=this.g.u.i,d=this.g.o,m=s.g.u.i;for(s=s.g.o;a.A;)d=a.na(d),a=a.A;for(;m.A;)s=m.na(s),m=m.A;return a===m&&d===s},Qr.prototype.clone=function(){if(this.g.o||Js(this),this.g.ia)return this.g.count.value+=1,this;var s=Nn,a=Object,d=a.create,m=Object.getPrototypeOf(this),I=this.g;return s=s(d.call(a,m,{g:{value:{count:I.count,fa:I.fa,ia:I.ia,o:I.o,u:I.u,G:I.G,L:I.L}}})),s.g.count.value+=1,s.g.fa=!1,s},Qr.prototype.delete=function(){this.g.o||Js(this),this.g.fa&&!this.g.ia&&st("Object already scheduled for deletion"),Qi(this),Ao(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Qr.prototype.isDeleted=function(){return!this.g.o},Qr.prototype.deleteLater=function(){return this.g.o||Js(this),this.g.fa&&!this.g.ia&&st("Object already scheduled for deletion"),wi.push(this),wi.length===1&&ki&&ki(Hs),this.g.fa=!0,this},Br.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Br.prototype.bb=function(s){this.W&&this.W(s)},Br.prototype.argPackAdvance=8,Br.prototype.readValueFromPointer=Ei,Br.prototype.deleteObject=function(s){s!==null&&s.delete()},Br.prototype.fromWireType=function(s){function a(){return this.ua?es(this.i.N,{u:this.nc,o:d,L:this,G:s}):es(this.i.N,{u:this,o:s})}var d=this.Vb(s);if(!d)return this.bb(s),null;var m=rc(this.i,d);if(m!==void 0)return m.g.count.value===0?(m.g.o=d,m.g.G=s,m.clone()):(m=m.clone(),this.bb(s),m);if(m=this.i.Ub(d),m=jo[m],!m)return a.call(this);m=this.ta?m.Kb:m.pointerType;var I=Co(d,this.i,m.i);return I===null?a.call(this):this.ua?es(m.i.N,{u:m,o:I,L:this,G:s}):es(m.i.N,{u:m,o:I})},Ro=g.UnboundTypeError=ko("UnboundTypeError");var Bo={__syscall_fcntl64:function(s,a,d){bi=d;try{var m=Xr(s);switch(a){case 0:var I=Ur();return 0>I?-28:po(m,I).X;case 1:case 2:return 0;case 3:return m.flags;case 4:return I=Ur(),m.flags|=I,0;case 5:return I=Ur(),ge[I+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ke[Wo()>>2]=28,-1;default:return-28}}catch(j){if(typeof pn>"u"||j.name!=="ErrnoError")throw j;return-j.aa}},__syscall_ioctl:function(s,a,d){bi=d;try{var m=Xr(s);switch(a){case 21509:return m.s?0:-59;case 21505:if(!m.s)return-59;if(m.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var I=Ur();ke[I>>2]=25856,ke[I+4>>2]=5,ke[I+8>>2]=191,ke[I+12>>2]=35387;for(var j=0;32>j;j++)Z[I+j+17>>0]=a[j]||0}return 0;case 21510:case 21511:case 21512:return m.s?0:-59;case 21506:case 21507:case 21508:if(!m.s)return-59;if(m.s.V.cc)for(I=Ur(),a=[],j=0;32>j;j++)a.push(Z[I+j+17>>0]);return 0;case 21519:return m.s?(I=Ur(),ke[I>>2]=0):-59;case 21520:return m.s?-28:-59;case 21531:if(I=Ur(),!m.m.ac)throw new Be(59);return m.m.ac(m,a,I);case 21523:return m.s?(m.s.V.dc&&(j=[24,80],I=Ur(),ge[I>>1]=j[0],ge[I+2>>1]=j[1]),0):-59;case 21524:return m.s?0:-59;case 21515:return m.s?0:-59;default:return-28}}catch(U){if(typeof pn>"u"||U.name!=="ErrnoError")throw U;return-U.aa}},__syscall_openat:function(s,a,d,m){bi=m;try{a=a?et(ie,a):"";var I=a;if(I.charAt(0)==="/")a=I;else{var j=s===-100?"/":Xr(s).path;if(I.length==0)throw new Be(44);a=M(j+"/"+I)}var U=m?Ur():0;return Yi(a,d,U).X}catch(Y){if(typeof pn>"u"||Y.name!=="ErrnoError")throw Y;return-Y.aa}},_embind_create_inheriting_constructor:function(s,a,d){s=Wt(s),a=Si(a,"wrapper"),d=wr(d);var m=[].slice,I=a.i,j=I.N,U=I.A.N,Y=I.A.constructor;s=Xi(s,function(){I.A.rb.forEach((function(G){if(this[G]===U[G])throw new So(`Pure virtual function ${G} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:j}),this.__construct.apply(this,m.call(arguments))}),j.__construct=function(){this===j&&st("Pass correct 'this' to __construct");var G=Y.implement.apply(void 0,[this].concat(m.call(arguments)));Qi(G);var Te=G.g;G.notifyOnDestruction(),Te.ia=!0,Object.defineProperties(this,{g:{value:Te}}),Nn(this),G=Te.o,G=Ks(I,G),Nr.hasOwnProperty(G)?st(`Tried to register registered instance: ${G}`):Nr[G]=this},j.__destruct=function(){this===j&&st("Pass correct 'this' to __destruct"),Qi(this);var G=this.g.o;G=Ks(I,G),Nr.hasOwnProperty(G)?delete Nr[G]:st(`Tried to unregister unregistered instance: ${G}`)},s.prototype=Object.create(j);for(var oe in d)s.prototype[oe]=d[oe];return kr(s)},_embind_finalize_value_object:function(s){var a=ts[s];delete ts[s];var d=a.Pa,m=a.W,I=a.fb,j=I.map(U=>U.Yb).concat(I.map(U=>U.rc));fr([s],j,U=>{var Y={};return I.forEach((oe,G)=>{var Te=U[G],Oe=oe.Wb,Ue=oe.Xb,B=U[G+I.length],xe=oe.qc,Ee=oe.sc;Y[oe.Sb]={read:at=>Te.fromWireType(Oe(Ue,at)),write:(at,ct)=>{var De=[];xe(Ee,at,B.toWireType(De,ct)),Ii(De)}}}),[{name:a.name,fromWireType:function(oe){var G={},Te;for(Te in Y)G[Te]=Y[Te].read(oe);return m(oe),G},toWireType:function(oe,G){for(var Te in Y)if(!(Te in G))throw new TypeError(`Missing field: "${Te}"`);var Oe=d();for(Te in Y)Y[Te].write(Oe,G[Te]);return oe!==null&&oe.push(m,Oe),Oe},argPackAdvance:8,readValueFromPointer:Ei,K:m}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,a,d,m,I){var j=ns(d);a=Wt(a),Tr(s,{name:a,fromWireType:function(U){return!!U},toWireType:function(U,Y){return Y?m:I},argPackAdvance:8,readValueFromPointer:function(U){if(d===1)var Y=Z;else if(d===2)Y=ge;else if(d===4)Y=ke;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(Y[U>>j])},K:null})},_embind_register_class:function(s,a,d,m,I,j,U,Y,oe,G,Te,Oe,Ue){Te=Wt(Te),j=tr(I,j),Y&&(Y=tr(U,Y)),G&&(G=tr(oe,G)),Ue=tr(Oe,Ue);var B=bo(Te);Qs(B,function(){Wr(`Cannot construct ${Te} due to unbound types`,[m])}),fr([s,a,d],m?[m]:[],function(xe){if(xe=xe[0],m)var Ee=xe.i,at=Ee.N;else at=Qr.prototype;xe=Xi(B,function(){if(Object.getPrototypeOf(this)!==ct)throw new Un("Use 'new' to construct "+Te);if(De.$===void 0)throw new Un(Te+" has no accessible constructor");var er=De.$[arguments.length];if(er===void 0)throw new Un(`Tried to invoke ctor of ${Te} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(De.$).toString()}) parameters instead!`);return er.apply(this,arguments)});var ct=Object.create(at,{constructor:{value:xe}});xe.prototype=ct;var De=new ic(Te,xe,ct,Ue,Ee,j,Y,G);De.A&&(De.A.oa===void 0&&(De.A.oa=[]),De.A.oa.push(De)),Ee=new Br(Te,De,!0,!1),at=new Br(Te+"*",De,!1,!1);var $t=new Br(Te+" const*",De,!1,!0);return jo[s]={pointerType:at,Kb:$t},To(B,xe),[Ee,at,$t]})},_embind_register_class_class_function:function(s,a,d,m,I,j,U){var Y=os(d,m);a=Wt(a),j=tr(I,j),fr([],[s],function(oe){function G(){Wr(`Cannot call ${Te} due to unbound types`,Y)}oe=oe[0];var Te=`${oe.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var Oe=oe.i.constructor;return Oe[a]===void 0?(G.ea=d-1,Oe[a]=G):(Xs(Oe,a,Te),Oe[a].B[d-1]=G),fr([],Y,function(Ue){if(Ue=as(Te,[Ue[0],null].concat(Ue.slice(1)),null,j,U),Oe[a].B===void 0?(Ue.ea=d-1,Oe[a]=Ue):Oe[a].B[d-1]=Ue,oe.i.oa)for(const B of oe.i.oa)B.constructor.hasOwnProperty(a)||(B.constructor[a]=Ue);return[]}),[]})},_embind_register_class_class_property:function(s,a,d,m,I,j,U,Y){a=Wt(a),j=tr(I,j),fr([],[s],function(oe){oe=oe[0];var G=`${oe.name}.${a}`,Te={get(){Wr(`Cannot access ${G} due to unbound types`,[d])},enumerable:!0,configurable:!0};return Te.set=Y?()=>{Wr(`Cannot access ${G} due to unbound types`,[d])}:()=>{st(`${G} is a read-only property`)},Object.defineProperty(oe.i.constructor,a,Te),fr([],[d],function(Oe){Oe=Oe[0];var Ue={get(){return Oe.fromWireType(j(m))},enumerable:!0};return Y&&(Y=tr(U,Y),Ue.set=B=>{var xe=[];Y(m,Oe.toWireType(xe,B)),Ii(xe)}),Object.defineProperty(oe.i.constructor,a,Ue),[]}),[]})},_embind_register_class_constructor:function(s,a,d,m,I,j){var U=os(a,d);I=tr(m,I),fr([],[s],function(Y){Y=Y[0];var oe=`constructor ${Y.name}`;if(Y.i.$===void 0&&(Y.i.$=[]),Y.i.$[a-1]!==void 0)throw new Un(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${Y.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Y.i.$[a-1]=()=>{Wr(`Cannot construct ${Y.name} due to unbound types`,U)},fr([],U,function(G){return G.splice(1,0,null),Y.i.$[a-1]=as(oe,G,null,I,j),[]}),[]})},_embind_register_class_function:function(s,a,d,m,I,j,U,Y){var oe=os(d,m);a=Wt(a),j=tr(I,j),fr([],[s],function(G){function Te(){Wr(`Cannot call ${Oe} due to unbound types`,oe)}G=G[0];var Oe=`${G.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),Y&&G.i.rb.push(a);var Ue=G.i.N,B=Ue[a];return B===void 0||B.B===void 0&&B.className!==G.name&&B.ea===d-2?(Te.ea=d-2,Te.className=G.name,Ue[a]=Te):(Xs(Ue,a,Oe),Ue[a].B[d-2]=Te),fr([],oe,function(xe){return xe=as(Oe,xe,G,j,U),Ue[a].B===void 0?(xe.ea=d-2,Ue[a]=xe):Ue[a].B[d-2]=xe,[]}),[]})},_embind_register_class_property:function(s,a,d,m,I,j,U,Y,oe,G){a=Wt(a),I=tr(m,I),fr([],[s],function(Te){Te=Te[0];var Oe=`${Te.name}.${a}`,Ue={get(){Wr(`Cannot access ${Oe} due to unbound types`,[d,U])},enumerable:!0,configurable:!0};return Ue.set=oe?()=>{Wr(`Cannot access ${Oe} due to unbound types`,[d,U])}:()=>{st(Oe+" is a read-only property")},Object.defineProperty(Te.i.N,a,Ue),fr([],oe?[d,U]:[d],function(B){var xe=B[0],Ee={get(){var ct=Oo(this,Te,Oe+" getter");return xe.fromWireType(I(j,ct))},enumerable:!0};if(oe){oe=tr(Y,oe);var at=B[1];Ee.set=function(ct){var De=Oo(this,Te,Oe+" setter"),$t=[];oe(G,De,at.toWireType($t,ct)),Ii($t)}}return Object.defineProperty(Te.i.N,a,Ee),[]}),[]})},_embind_register_emval:function(s,a){a=Wt(a),Tr(s,{name:a,fromWireType:function(d){var m=wr(d);return Zs(d),m},toWireType:function(d,m){return kr(m)},argPackAdvance:8,readValueFromPointer:Ei,K:null})},_embind_register_enum:function(s,a,d,m){function I(){}d=ns(d),a=Wt(a),I.values={},Tr(s,{name:a,constructor:I,fromWireType:function(j){return this.constructor.values[j]},toWireType:function(j,U){return U.value},argPackAdvance:8,readValueFromPointer:uc(a,d,m),K:null}),Qs(a,I)},_embind_register_enum_value:function(s,a,d){var m=Si(s,"enum");a=Wt(a),s=m.constructor,m=Object.create(m.constructor.prototype,{value:{value:d},constructor:{value:Xi(`${m.name}_${a}`,function(){})}}),s.values[d]=m,s[a]=m},_embind_register_float:function(s,a,d){d=ns(d),a=Wt(a),Tr(s,{name:a,fromWireType:function(m){return m},toWireType:function(m,I){return I},argPackAdvance:8,readValueFromPointer:cc(a,d),K:null})},_embind_register_function:function(s,a,d,m,I,j){var U=os(a,d);s=Wt(s),I=tr(m,I),Qs(s,function(){Wr(`Cannot call ${s} due to unbound types`,U)},a-1),fr([],U,function(Y){return To(s,as(s,[Y[0],null].concat(Y.slice(1)),null,I,j),a-1),[]})},_embind_register_integer:function(s,a,d,m,I){a=Wt(a),I===-1&&(I=4294967295),I=ns(d);var j=Y=>Y;if(m===0){var U=32-8*d;j=Y=>Y<<U>>>U}d=a.includes("unsigned")?function(Y,oe){return oe>>>0}:function(Y,oe){return oe},Tr(s,{name:a,fromWireType:j,toWireType:d,argPackAdvance:8,readValueFromPointer:dc(a,I,m!==0),K:null})},_embind_register_memory_view:function(s,a,d){function m(j){j>>=2;var U=Ae;return new I(U.buffer,U[j+1],U[j])}var I=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];d=Wt(d),Tr(s,{name:d,fromWireType:m,argPackAdvance:8,readValueFromPointer:m},{$b:!0})},_embind_register_std_string:function(s,a){a=Wt(a);var d=a==="std::string";Tr(s,{name:a,fromWireType:function(m){var I=Ae[m>>2],j=m+4;if(d)for(var U=j,Y=0;Y<=I;++Y){var oe=j+Y;if(Y==I||ie[oe]==0){if(U=U?et(ie,U,oe-U):"",G===void 0)var G=U;else G+="\0",G+=U;U=oe+1}}else{for(G=Array(I),Y=0;Y<I;++Y)G[Y]=String.fromCharCode(ie[j+Y]);G=G.join("")}return qr(m),G},toWireType:function(m,I){I instanceof ArrayBuffer&&(I=new Uint8Array(I));var j=typeof I=="string";j||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int8Array||st("Cannot pass non-string to std::string");var U=d&&j?mt(I):I.length,Y=ia(4+U+1),oe=Y+4;if(Ae[Y>>2]=U,d&&j)Gt(I,ie,oe,U+1);else if(j)for(j=0;j<U;++j){var G=I.charCodeAt(j);255<G&&(qr(oe),st("String has UTF-16 code units that do not fit in 8 bits")),ie[oe+j]=G}else for(j=0;j<U;++j)ie[oe+j]=I[j];return m!==null&&m.push(qr,Y),Y},argPackAdvance:8,readValueFromPointer:Ei,K:function(m){qr(m)}})},_embind_register_std_wstring:function(s,a,d){if(d=Wt(d),a===2)var m=fc,I=hc,j=vc,U=()=>_e,Y=1;else a===4&&(m=pc,I=gc,j=_c,U=()=>Ae,Y=2);Tr(s,{name:d,fromWireType:function(oe){for(var G=Ae[oe>>2],Te=U(),Oe,Ue=oe+4,B=0;B<=G;++B){var xe=oe+4+B*a;(B==G||Te[xe>>Y]==0)&&(Ue=m(Ue,xe-Ue),Oe===void 0?Oe=Ue:(Oe+="\0",Oe+=Ue),Ue=xe+a)}return qr(oe),Oe},toWireType:function(oe,G){typeof G!="string"&&st(`Cannot pass non-string to C++ string type ${d}`);var Te=j(G),Oe=ia(4+Te+a);return Ae[Oe>>2]=Te>>Y,I(G,Oe+4,Te+a),oe!==null&&oe.push(qr,Oe),Oe},argPackAdvance:8,readValueFromPointer:Ei,K:function(oe){qr(oe)}})},_embind_register_value_object:function(s,a,d,m,I,j){ts[s]={name:Wt(a),Pa:tr(d,m),W:tr(I,j),fb:[]}},_embind_register_value_object_field:function(s,a,d,m,I,j,U,Y,oe,G){ts[s].fb.push({Sb:Wt(a),Yb:d,Wb:tr(m,I),Xb:j,rc:U,qc:tr(Y,oe),sc:G})},_embind_register_void:function(s,a){a=Wt(a),Tr(s,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,a,d){s=wr(s),a=Si(a,"emval::as");var m=[],I=kr(m);return Ae[d>>2]=I,a.toWireType(m,s)},_emval_call_method:function(s,a,d,m,I){s=us[s],a=wr(a),d=ls(d);var j=[];return Ae[m>>2]=kr(j),s(a,d,j,I)},_emval_call_void_method:function(s,a,d,m){s=us[s],a=wr(a),d=ls(d),s(a,d,null,m)},_emval_decref:Zs,_emval_get_method_caller:function(s,a){var d=bc(s,a),m=d[0];a=m.name+"_$"+d.slice(1).map(function(U){return U.name}).join("_")+"$";var I=Lo[a];if(I!==void 0)return I;var j=Array(s-1);return I=yc((U,Y,oe,G)=>{for(var Te=0,Oe=0;Oe<s-1;++Oe)j[Oe]=d[Oe+1].readValueFromPointer(G+Te),Te+=d[Oe+1].argPackAdvance;for(U=U[Y].apply(U,j),Oe=0;Oe<s-1;++Oe)d[Oe+1].Nb&&d[Oe+1].Nb(j[Oe]);if(!m.fc)return m.toWireType(oe,U)}),Lo[a]=I},_emval_get_module_property:function(s){return s=ls(s),kr(g[s])},_emval_get_property:function(s,a){return s=wr(s),a=wr(a),kr(s[a])},_emval_incref:function(s){4<s&&(pr.get(s).ub+=1)},_emval_new_array:function(){return kr([])},_emval_new_cstring:function(s){return kr(ls(s))},_emval_new_object:function(){return kr({})},_emval_run_destructors:function(s){var a=wr(s);Ii(a),Zs(s)},_emval_set_property:function(s,a,d){s=wr(s),a=wr(a),d=wr(d),s[a]=d},_emval_take_value:function(s,a){return s=Si(s,"_emval_take_value"),s=s.readValueFromPointer(a),kr(s)},abort:()=>{ce("")},emscripten_asm_const_int:(s,a,d)=>{ta.length=0;var m;for(d>>=2;m=ie[a++];)d+=m!=105&d,ta.push(m==105?ke[d]:ae[d++>>1]),++d;return l[s].apply(null,ta)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,a,d)=>ie.copyWithin(s,a,a+d),emscripten_resize_heap:s=>{var a=ie.length;if(s>>>=0,2147483648<s)return!1;for(var d=1;4>=d;d*=2){var m=a*(1+.2/d);m=Math.min(m,s+100663296);var I=Math;m=Math.max(s,m);e:{I=I.min.call(I,2147483648,m+(65536-m%65536)%65536)-ee.buffer.byteLength+65535>>>16;try{ee.grow(I),se();var j=1;break e}catch{}j=void 0}if(j)return!0}return!1},environ_get:(s,a)=>{var d=0;return Do().forEach(function(m,I){var j=a+d;for(I=Ae[s+4*I>>2]=j,j=0;j<m.length;++j)Z[I++>>0]=m.charCodeAt(j);Z[I>>0]=0,d+=m.length+1}),0},environ_sizes_get:(s,a)=>{var d=Do();Ae[s>>2]=d.length;var m=0;return d.forEach(function(I){m+=I.length+1}),Ae[a>>2]=m,0},fd_close:function(s){try{var a=Xr(s);if(a.X===null)throw new Be(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(d){throw d}finally{Gi[a.X]=null}return a.X=null,0}catch(d){if(typeof pn>"u"||d.name!=="ErrnoError")throw d;return d.aa}},fd_read:function(s,a,d,m){try{e:{var I=Xr(s);s=a;for(var j,U=a=0;U<d;U++){var Y=Ae[s>>2],oe=Ae[s+4>>2];s+=8;var G=I,Te=Y,Oe=oe,Ue=j,B=Z;if(0>Oe||0>Ue)throw new Be(28);if(G.X===null)throw new Be(8);if((G.flags&2097155)===1)throw new Be(8);if((G.node.mode&61440)===16384)throw new Be(31);if(!G.m.read)throw new Be(28);var xe=typeof Ue<"u";if(!xe)Ue=G.position;else if(!G.seekable)throw new Be(70);var Ee=G.m.read(G,B,Te,Oe,Ue);xe||(G.position+=Ee);var at=Ee;if(0>at){var ct=-1;break e}if(a+=at,at<oe)break;typeof j<"u"&&(j+=at)}ct=a}return Ae[m>>2]=ct,0}catch(De){if(typeof pn>"u"||De.name!=="ErrnoError")throw De;return De.aa}},fd_seek:function(s,a,d,m,I){a=d+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*d:NaN;try{if(isNaN(a))return 61;var j=Xr(s);return _o(j,a,m),y=[j.position>>>0,(Xe=j.position,1<=+Math.abs(Xe)?0<Xe?+Math.floor(Xe/4294967296)>>>0:~~+Math.ceil((Xe-+(~~Xe>>>0))/4294967296)>>>0:0)],ke[I>>2]=y[0],ke[I+4>>2]=y[1],j.Ma&&a===0&&m===0&&(j.Ma=null),0}catch(U){if(typeof pn>"u"||U.name!=="ErrnoError")throw U;return U.aa}},fd_write:function(s,a,d,m){try{e:{var I=Xr(s);s=a;for(var j,U=a=0;U<d;U++){var Y=Ae[s>>2],oe=Ae[s+4>>2];s+=8;var G=I,Te=Y,Oe=oe,Ue=j,B=Z;if(0>Oe||0>Ue)throw new Be(28);if(G.X===null)throw new Be(8);if((G.flags&2097155)===0)throw new Be(8);if((G.node.mode&61440)===16384)throw new Be(31);if(!G.m.write)throw new Be(28);G.seekable&&G.flags&1024&&_o(G,0,2);var xe=typeof Ue<"u";if(!xe)Ue=G.position;else if(!G.seekable)throw new Be(70);var Ee=G.m.write(G,B,Te,Oe,Ue,void 0);xe||(G.position+=Ee);var at=Ee;if(0>at){var ct=-1;break e}a+=at,typeof j<"u"&&(j+=at)}ct=a}return Ae[m>>2]=ct,0}catch(De){if(typeof pn>"u"||De.name!=="ErrnoError")throw De;return De.aa}},strftime_l:(s,a,d,m)=>wc(s,a,d,m)};(function(){function s(d){if(P=d=d.exports,ee=P.memory,se(),Q=P.__indirect_function_table,le.unshift(P.__wasm_call_ctors),Ce--,g.monitorRunDependencies&&g.monitorRunDependencies(Ce),Ce==0&&Pe){var m=Pe;Pe=null,m()}return d}var a={env:Bo,wasi_snapshot_preview1:Bo};if(Ce++,g.monitorRunDependencies&&g.monitorRunDependencies(Ce),g.instantiateWasm)try{return g.instantiateWasm(a,s)}catch(d){te("Module.instantiateWasm callback failed with error: "+d),T(d)}return _t(a,function(d){s(d.instance)}).catch(T),{}})();var qr=s=>(qr=P.free)(s),ia=s=>(ia=P.malloc)(s),Wo=()=>(Wo=P.__errno_location)(),qo=g._ma_device__on_notification_unlocked=s=>(qo=g._ma_device__on_notification_unlocked=P.ma_device__on_notification_unlocked)(s);g._ma_malloc_emscripten=(s,a)=>(g._ma_malloc_emscripten=P.ma_malloc_emscripten)(s,a),g._ma_free_emscripten=(s,a)=>(g._ma_free_emscripten=P.ma_free_emscripten)(s,a);var Vo=g._ma_device_process_pcm_frames_capture__webaudio=(s,a,d)=>(Vo=g._ma_device_process_pcm_frames_capture__webaudio=P.ma_device_process_pcm_frames_capture__webaudio)(s,a,d),Go=g._ma_device_process_pcm_frames_playback__webaudio=(s,a,d)=>(Go=g._ma_device_process_pcm_frames_playback__webaudio=P.ma_device_process_pcm_frames_playback__webaudio)(s,a,d),zo=s=>(zo=P.__getTypeName)(s);g.__embind_initialize_bindings=()=>(g.__embind_initialize_bindings=P._embind_initialize_bindings)(),g.dynCall_iiji=(s,a,d,m,I)=>(g.dynCall_iiji=P.dynCall_iiji)(s,a,d,m,I),g.dynCall_jiji=(s,a,d,m,I)=>(g.dynCall_jiji=P.dynCall_jiji)(s,a,d,m,I),g.dynCall_iiiji=(s,a,d,m,I,j)=>(g.dynCall_iiiji=P.dynCall_iiiji)(s,a,d,m,I,j),g.dynCall_iij=(s,a,d,m)=>(g.dynCall_iij=P.dynCall_iij)(s,a,d,m),g.dynCall_jii=(s,a,d)=>(g.dynCall_jii=P.dynCall_jii)(s,a,d),g.dynCall_viijii=(s,a,d,m,I,j,U)=>(g.dynCall_viijii=P.dynCall_viijii)(s,a,d,m,I,j,U),g.dynCall_iiiiij=(s,a,d,m,I,j,U)=>(g.dynCall_iiiiij=P.dynCall_iiiiij)(s,a,d,m,I,j,U),g.dynCall_iiiiijj=(s,a,d,m,I,j,U,Y,oe)=>(g.dynCall_iiiiijj=P.dynCall_iiiiijj)(s,a,d,m,I,j,U,Y,oe),g.dynCall_iiiiiijj=(s,a,d,m,I,j,U,Y,oe,G)=>(g.dynCall_iiiiiijj=P.dynCall_iiiiiijj)(s,a,d,m,I,j,U,Y,oe,G);var fs;Pe=function s(){fs||Ho(),fs||(Pe=s)};function Ho(){function s(){if(!fs&&(fs=!0,g.calledRun=!0,!D)){if(g.noFSInit||yo||(yo=!0,mo(),g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?mi("stdin",g.stdin):Gs("/dev/tty","/dev/stdin"),g.stdout?mi("stdout",null,g.stdout):Gs("/dev/tty","/dev/stdout"),g.stderr?mi("stderr",null,g.stderr):Gs("/dev/tty1","/dev/stderr"),Yi("/dev/stdin",0),Yi("/dev/stdout",1),Yi("/dev/stderr",1)),lo=!1,f(le),b(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var a=g.postRun.shift();de.unshift(a)}f(de)}}if(!(0<Ce)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)ve();f(ue),0<Ce||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),s()},1)):s())}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Ho(),E.ready})})();const _=v}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,p)=>{p.r(h),p.d(h,{Animation:()=>v.Animation});var v=p(4)}),((u,h,p)=>{p.r(h),p.d(h,{Animation:()=>v});var v=(function(){function _(w,E,g,b){this.animation=w,this.artboard=E,this.playing=b,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(w,E)}return Object.defineProperty(_.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"time",{get:function(){return this.instance.time},set:function(w){this.instance.time=w},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),_.prototype.advance=function(w){this.scrubTo===null?this.instance.advance(w):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},_.prototype.apply=function(w){this.instance.apply(w)},_.prototype.cleanup=function(){this.instance.delete()},_})()}),((u,h,p)=>{p.r(h),p.d(h,{AudioAssetWrapper:()=>w.AudioAssetWrapper,AudioWrapper:()=>w.AudioWrapper,BLANK_URL:()=>_.BLANK_URL,CustomFileAssetLoaderWrapper:()=>w.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>w.FileAssetWrapper,Finalizable:()=>w.Finalizable,FontAssetWrapper:()=>w.FontAssetWrapper,FontWrapper:()=>w.FontWrapper,ImageAssetWrapper:()=>w.ImageAssetWrapper,ImageWrapper:()=>w.ImageWrapper,finalizationRegistry:()=>w.finalizationRegistry,registerTouchInteractions:()=>v.registerTouchInteractions,sanitizeUrl:()=>_.sanitizeUrl});var v=p(6),_=p(7),w=p(8)}),((u,h,p)=>{p.r(h),p.d(h,{registerTouchInteractions:()=>w});var v=void 0,_=function(E,g){var b,T;return["touchstart","touchmove"].indexOf(E.type)>-1&&(!((b=E.touches)===null||b===void 0)&&b.length)?(g||E.preventDefault(),{clientX:E.touches[0].clientX,clientY:E.touches[0].clientY}):E.type==="touchend"&&(!((T=E.changedTouches)===null||T===void 0)&&T.length)?{clientX:E.changedTouches[0].clientX,clientY:E.changedTouches[0].clientY}:{clientX:E.clientX,clientY:E.clientY}},w=function(E){var g=E.canvas,b=E.artboard,T=E.stateMachines,R=T===void 0?[]:T,N=E.renderer,$=E.rive,F=E.fit,z=E.alignment,K=E.isTouchScrollEnabled,C=K===void 0?!1:K,x=E.layoutScaleFactor,J=x===void 0?1:x;if(!g||!R.length||!N||!$||!b||typeof window>"u")return null;var X=null,he=!1,re=function(me){if(he&&me instanceof MouseEvent){me.type=="mouseup"&&(he=!1);return}he=C&&me.type==="touchend"&&X==="touchstart",X=me.type;var te=me.currentTarget.getBoundingClientRect(),q=_(me,C),ee=q.clientX,P=q.clientY;if(!(!ee&&!P)){var D=ee-te.left,Z=P-te.top,ie=$.computeAlignment(F,z,{minX:0,minY:0,maxX:te.width,maxY:te.height},b.bounds,J),ge=new $.Mat2D;ie.invert(ge);var _e=new $.Vec2D(D,Z),ke=$.mapXY(ge,_e),Ae=ke.x(),Ne=ke.y();switch(ke.delete(),ge.delete(),_e.delete(),ie.delete(),me.type){case"mouseout":for(var ae=0,se=R;ae<se.length;ae++){var Q=se[ae];Q.pointerMove(Ae,Ne)}break;case"touchmove":case"mouseover":case"mousemove":{for(var ue=0,le=R;ue<le.length;ue++){var Q=le[ue];Q.pointerMove(Ae,Ne)}break}case"touchstart":case"mousedown":{for(var de=0,ve=R;de<ve.length;de++){var Q=ve[de];Q.pointerDown(Ae,Ne)}break}case"touchend":case"mouseup":{for(var Ce=0,Pe=R;Ce<Pe.length;Ce++){var Q=Pe[Ce];Q.pointerUp(Ae,Ne)}break}}}},ne=re.bind(v);return g.addEventListener("mouseover",ne),g.addEventListener("mouseout",ne),g.addEventListener("mousemove",ne),g.addEventListener("mousedown",ne),g.addEventListener("mouseup",ne),g.addEventListener("touchmove",ne,{passive:C}),g.addEventListener("touchstart",ne,{passive:C}),g.addEventListener("touchend",ne),function(){g.removeEventListener("mouseover",ne),g.removeEventListener("mouseout",ne),g.removeEventListener("mousemove",ne),g.removeEventListener("mousedown",ne),g.removeEventListener("mouseup",ne),g.removeEventListener("touchmove",ne),g.removeEventListener("touchstart",ne),g.removeEventListener("touchend",ne)}}}),((u,h,p)=>{p.r(h),p.d(h,{BLANK_URL:()=>T,sanitizeUrl:()=>$});var v=/^([^\w]*)(javascript|data|vbscript)/im,_=/&#(\w+)(^\w|;)?/g,w=/&(newline|tab);/gi,E=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,b=[".","/"],T="about:blank";function R(F){return b.indexOf(F[0])>-1}function N(F){var z=F.replace(E,"");return z.replace(_,function(K,C){return String.fromCharCode(C)})}function $(F){if(!F)return T;var z=N(F).replace(w,"").replace(E,"").trim();if(!z)return T;if(R(z))return z;var K=z.match(g);if(!K)return z;var C=K[0];return v.test(C)?T:z}}),((u,h,p)=>{p.r(h),p.d(h,{AudioAssetWrapper:()=>N,AudioWrapper:()=>E,CustomFileAssetLoaderWrapper:()=>b,FileAssetWrapper:()=>T,Finalizable:()=>_,FontAssetWrapper:()=>$,FontWrapper:()=>g,ImageAssetWrapper:()=>R,ImageWrapper:()=>w,finalizationRegistry:()=>K});var v=(function(){var C=function(x,J){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,he){X.__proto__=he}||function(X,he){for(var re in he)Object.prototype.hasOwnProperty.call(he,re)&&(X[re]=he[re])},C(x,J)};return function(x,J){if(typeof J!="function"&&J!==null)throw new TypeError("Class extends value "+String(J)+" is not a constructor or null");C(x,J);function X(){this.constructor=x}x.prototype=J===null?Object.create(J):(X.prototype=J.prototype,new X)}})(),_=(function(){function C(){this.selfUnref=!1}return C})(),w=(function(C){v(x,C);function x(J){var X=C.call(this)||this;return X._nativeImage=J,X}return Object.defineProperty(x.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},x})(_),E=(function(C){v(x,C);function x(J){var X=C.call(this)||this;return X._nativeAudio=J,X}return Object.defineProperty(x.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},x})(_),g=(function(C){v(x,C);function x(J){var X=C.call(this)||this;return X._nativeFont=J,X}return Object.defineProperty(x.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),x.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},x})(_),b=(function(){function C(x,J){this._assetLoaderCallback=J,this.assetLoader=new x.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return C.prototype.loadContents=function(x,J){var X;return x.isImage?X=new R(x):x.isAudio?X=new N(x):x.isFont&&(X=new $(x)),this._assetLoaderCallback(X,J)},C})(),T=(function(){function C(x){this._nativeFileAsset=x}return C.prototype.decode=function(x){this._nativeFileAsset.decode(x)},Object.defineProperty(C.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),C})(),R=(function(C){v(x,C);function x(){return C!==null&&C.apply(this,arguments)||this}return x.prototype.setRenderImage=function(J){this._nativeFileAsset.setRenderImage(J.nativeImage)},x})(T),N=(function(C){v(x,C);function x(){return C!==null&&C.apply(this,arguments)||this}return x.prototype.setAudioSource=function(J){this._nativeFileAsset.setAudioSource(J.nativeAudio)},x})(T),$=(function(C){v(x,C);function x(){return C!==null&&C.apply(this,arguments)||this}return x.prototype.setFont=function(J){this._nativeFileAsset.setFont(J.nativeFont)},x})(T),F=(function(){function C(x){}return C.prototype.register=function(x){x.selfUnref=!0},C.prototype.unregister=function(x){},C})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:F,K=new z(function(C){C.unref()})})],n={};function i(u){var h=n[u];if(h!==void 0)return h.exports;var p=n[u]={exports:{}};return t[u](p,p.exports,i),p.exports}i.d=(u,h)=>{for(var p in h)i.o(h,p)&&!i.o(u,p)&&Object.defineProperty(u,p,{enumerable:!0,get:h[p]})},i.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),i.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var o={};return(()=>{i.r(o),i.d(o,{Alignment:()=>$,DataEnum:()=>Ne,EventType:()=>re,Fit:()=>N,Layout:()=>F,LoopType:()=>ne,Rive:()=>ke,RiveEventType:()=>x,RiveFile:()=>_e,RuntimeLoader:()=>z,StateMachineInput:()=>C,StateMachineInputType:()=>K,Testing:()=>Ge,ViewModel:()=>Ae,ViewModelInstance:()=>se,ViewModelInstanceArtboard:()=>je,ViewModelInstanceAssetImage:()=>Ie,ViewModelInstanceBoolean:()=>de,ViewModelInstanceColor:()=>ce,ViewModelInstanceEnum:()=>Ce,ViewModelInstanceList:()=>Pe,ViewModelInstanceNumber:()=>le,ViewModelInstanceString:()=>ue,ViewModelInstanceTrigger:()=>ve,ViewModelInstanceValue:()=>Q,decodeAudio:()=>Ke,decodeFont:()=>Xe,decodeImage:()=>_t});var u=i(1),h=i(2),p=i(3),v=i(5),_=(function(){var y=function(l,f){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,M){k.__proto__=M}||function(k,M){for(var H in M)Object.prototype.hasOwnProperty.call(M,H)&&(k[H]=M[H])},y(l,f)};return function(l,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");y(l,f);function k(){this.constructor=l}l.prototype=f===null?Object.create(f):(k.prototype=f.prototype,new k)}})(),w=function(){return w=Object.assign||function(y){for(var l,f=1,k=arguments.length;f<k;f++){l=arguments[f];for(var M in l)Object.prototype.hasOwnProperty.call(l,M)&&(y[M]=l[M])}return y},w.apply(this,arguments)},E=function(y,l,f,k){function M(H){return H instanceof f?H:new f(function(fe){fe(H)})}return new(f||(f=Promise))(function(H,fe){function Me(ze){try{Le(k.next(ze))}catch(et){fe(et)}}function We(ze){try{Le(k.throw(ze))}catch(et){fe(et)}}function Le(ze){ze.done?H(ze.value):M(ze.value).then(Me,We)}Le((k=k.apply(y,l||[])).next())})},g=function(y,l){var f={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},k,M,H,fe=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return fe.next=Me(0),fe.throw=Me(1),fe.return=Me(2),typeof Symbol=="function"&&(fe[Symbol.iterator]=function(){return this}),fe;function Me(Le){return function(ze){return We([Le,ze])}}function We(Le){if(k)throw new TypeError("Generator is already executing.");for(;fe&&(fe=0,Le[0]&&(f=0)),f;)try{if(k=1,M&&(H=Le[0]&2?M.return:Le[0]?M.throw||((H=M.return)&&H.call(M),0):M.next)&&!(H=H.call(M,Le[1])).done)return H;switch(M=0,H&&(Le=[Le[0]&2,H.value]),Le[0]){case 0:case 1:H=Le;break;case 4:return f.label++,{value:Le[1],done:!1};case 5:f.label++,M=Le[1],Le=[0];continue;case 7:Le=f.ops.pop(),f.trys.pop();continue;default:if(H=f.trys,!(H=H.length>0&&H[H.length-1])&&(Le[0]===6||Le[0]===2)){f=0;continue}if(Le[0]===3&&(!H||Le[1]>H[0]&&Le[1]<H[3])){f.label=Le[1];break}if(Le[0]===6&&f.label<H[1]){f.label=H[1],H=Le;break}if(H&&f.label<H[2]){f.label=H[2],f.ops.push(Le);break}H[2]&&f.ops.pop(),f.trys.pop();continue}Le=l.call(y,f)}catch(ze){Le=[6,ze],M=0}finally{k=H=0}if(Le[0]&5)throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}},b=function(y,l,f){if(f||arguments.length===2)for(var k=0,M=l.length,H;k<M;k++)(H||!(k in l))&&(H||(H=Array.prototype.slice.call(l,0,k)),H[k]=l[k]);return y.concat(H||Array.prototype.slice.call(l))},T=(function(y){_(l,y);function l(){var f=y!==null&&y.apply(this,arguments)||this;return f.isHandledError=!0,f}return l})(Error),R=function(y){return y&&y.isHandledError?y.message:"Problem loading file; may be corrupt!"},N;(function(y){y.Cover="cover",y.Contain="contain",y.Fill="fill",y.FitWidth="fitWidth",y.FitHeight="fitHeight",y.None="none",y.ScaleDown="scaleDown",y.Layout="layout"})(N||(N={}));var $;(function(y){y.Center="center",y.TopLeft="topLeft",y.TopCenter="topCenter",y.TopRight="topRight",y.CenterLeft="centerLeft",y.CenterRight="centerRight",y.BottomLeft="bottomLeft",y.BottomCenter="bottomCenter",y.BottomRight="bottomRight"})($||($={}));var F=(function(){function y(l){var f,k,M,H,fe,Me,We;this.fit=(f=l?.fit)!==null&&f!==void 0?f:N.Contain,this.alignment=(k=l?.alignment)!==null&&k!==void 0?k:$.Center,this.layoutScaleFactor=(M=l?.layoutScaleFactor)!==null&&M!==void 0?M:1,this.minX=(H=l?.minX)!==null&&H!==void 0?H:0,this.minY=(fe=l?.minY)!==null&&fe!==void 0?fe:0,this.maxX=(Me=l?.maxX)!==null&&Me!==void 0?Me:0,this.maxY=(We=l?.maxY)!==null&&We!==void 0?We:0}return y.new=function(l){var f=l.fit,k=l.alignment,M=l.minX,H=l.minY,fe=l.maxX,Me=l.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new y({fit:f,alignment:k,minX:M,minY:H,maxX:fe,maxY:Me})},y.prototype.copyWith=function(l){var f=l.fit,k=l.alignment,M=l.layoutScaleFactor,H=l.minX,fe=l.minY,Me=l.maxX,We=l.maxY;return new y({fit:f??this.fit,alignment:k??this.alignment,layoutScaleFactor:M??this.layoutScaleFactor,minX:H??this.minX,minY:fe??this.minY,maxX:Me??this.maxX,maxY:We??this.maxY})},y.prototype.runtimeFit=function(l){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var f;return this.fit===N.Cover?f=l.Fit.cover:this.fit===N.Contain?f=l.Fit.contain:this.fit===N.Fill?f=l.Fit.fill:this.fit===N.FitWidth?f=l.Fit.fitWidth:this.fit===N.FitHeight?f=l.Fit.fitHeight:this.fit===N.ScaleDown?f=l.Fit.scaleDown:this.fit===N.Layout?f=l.Fit.layout:f=l.Fit.none,this.cachedRuntimeFit=f,f},y.prototype.runtimeAlignment=function(l){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var f;return this.alignment===$.TopLeft?f=l.Alignment.topLeft:this.alignment===$.TopCenter?f=l.Alignment.topCenter:this.alignment===$.TopRight?f=l.Alignment.topRight:this.alignment===$.CenterLeft?f=l.Alignment.centerLeft:this.alignment===$.CenterRight?f=l.Alignment.centerRight:this.alignment===$.BottomLeft?f=l.Alignment.bottomLeft:this.alignment===$.BottomCenter?f=l.Alignment.bottomCenter:this.alignment===$.BottomRight?f=l.Alignment.bottomRight:f=l.Alignment.center,this.cachedRuntimeAlignment=f,f},y})(),z=(function(){function y(){}return y.loadRuntime=function(){u.default({locateFile:function(){return y.wasmURL}}).then(function(l){var f;for(y.runtime=l;y.callBackQueue.length>0;)(f=y.callBackQueue.shift())===null||f===void 0||f(y.runtime)}).catch(function(l){var f={message:l?.message||"Unknown error",type:l?.name||"Error",wasmError:l instanceof WebAssembly.CompileError||l instanceof WebAssembly.RuntimeError,originalError:l};console.debug("Rive WASM load error details:",f);var k="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(y.wasmURL.toLowerCase()!==k)console.warn("Failed to load WASM from ".concat(y.wasmURL," (").concat(f.message,"), trying jsdelivr as a backup")),y.setWasmUrl(k),y.loadRuntime();else{var M=["Could not load Rive WASM file from ".concat(y.wasmURL," or ").concat(k,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(f.type),"- Message: ".concat(f.message),"- WebAssembly-specific error: ".concat(f.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(M)}})},y.getInstance=function(l){y.isLoading||(y.isLoading=!0,y.loadRuntime()),y.runtime?l(y.runtime):y.callBackQueue.push(l)},y.awaitInstance=function(){return new Promise(function(l){return y.getInstance(function(f){return l(f)})})},y.setWasmUrl=function(l){y.wasmURL=l},y.getWasmUrl=function(){return y.wasmURL},y.isLoading=!1,y.callBackQueue=[],y.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),y})(),K;(function(y){y[y.Number=56]="Number",y[y.Trigger=58]="Trigger",y[y.Boolean=59]="Boolean"})(K||(K={}));var C=(function(){function y(l,f){this.type=l,this.runtimeInput=f}return Object.defineProperty(y.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(l){this.runtimeInput.value=l},enumerable:!1,configurable:!0}),y.prototype.fire=function(){this.type===K.Trigger&&this.runtimeInput.fire()},y.prototype.delete=function(){this.runtimeInput=null},y})(),x;(function(y){y[y.General=128]="General",y[y.OpenUrl=131]="OpenUrl"})(x||(x={}));var J=(function(){function y(l){this.nativeArtboard=l}return y})(),X=(function(){function y(l,f,k,M){this.stateMachine=l,this.playing=k,this.artboard=M,this.inputs=[],this.instance=new f.StateMachineInstance(l,M),this.initInputs(f)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"statesChanged",{get:function(){for(var l=[],f=0;f<this.instance.stateChangedCount();f++)l.push(this.instance.stateChangedNameByIndex(f));return l},enumerable:!1,configurable:!0}),y.prototype.advance=function(l){this.instance.advance(l)},y.prototype.advanceAndApply=function(l){this.instance.advanceAndApply(l)},y.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},y.prototype.reportedEventAt=function(l){return this.instance.reportedEventAt(l)},y.prototype.initInputs=function(l){for(var f=0;f<this.instance.inputCount();f++){var k=this.instance.input(f);this.inputs.push(this.mapRuntimeInput(k,l))}},y.prototype.mapRuntimeInput=function(l,f){if(l.type===f.SMIInput.bool)return new C(K.Boolean,l.asBool());if(l.type===f.SMIInput.number)return new C(K.Number,l.asNumber());if(l.type===f.SMIInput.trigger)return new C(K.Trigger,l.asTrigger())},y.prototype.cleanup=function(){this.inputs.forEach(function(l){l.delete()}),this.inputs.length=0,this.instance.delete()},y.prototype.bindViewModelInstance=function(l){l.runtimeInstance!=null&&this.instance.bindViewModelInstance(l.runtimeInstance)},y})(),he=(function(){function y(l,f,k,M,H){M===void 0&&(M=[]),H===void 0&&(H=[]),this.runtime=l,this.artboard=f,this.eventManager=k,this.animations=M,this.stateMachines=H}return y.prototype.add=function(l,f,k){if(k===void 0&&(k=!0),l=qe(l),l.length===0)this.animations.forEach(function(mt){return mt.playing=f}),this.stateMachines.forEach(function(mt){return mt.playing=f});else for(var M=this.animations.map(function(mt){return mt.name}),H=this.stateMachines.map(function(mt){return mt.name}),fe=0;fe<l.length;fe++){var Me=M.indexOf(l[fe]),We=H.indexOf(l[fe]);if(Me>=0||We>=0)Me>=0?this.animations[Me].playing=f:this.stateMachines[We].playing=f;else{var Le=this.artboard.animationByName(l[fe]);if(Le){var ze=new p.Animation(Le,this.artboard,this.runtime,f);ze.advance(0),ze.apply(1),this.animations.push(ze)}else{var et=this.artboard.stateMachineByName(l[fe]);if(et){var At=new X(et,this.runtime,f,this.artboard);this.stateMachines.push(At)}}}}return k&&(f?this.eventManager.fire({type:re.Play,data:this.playing}):this.eventManager.fire({type:re.Pause,data:this.paused})),f?this.playing:this.paused},y.prototype.initLinearAnimations=function(l,f){for(var k=this.animations.map(function(We){return We.name}),M=0;M<l.length;M++){var H=k.indexOf(l[M]);if(H>=0)this.animations[H].playing=f;else{var fe=this.artboard.animationByName(l[M]);if(fe){var Me=new p.Animation(fe,this.artboard,this.runtime,f);Me.advance(0),Me.apply(1),this.animations.push(Me)}else console.error("Animation with name ".concat(l[M]," not found."))}}},y.prototype.initStateMachines=function(l,f){for(var k=this.stateMachines.map(function(We){return We.name}),M=0;M<l.length;M++){var H=k.indexOf(l[M]);if(H>=0)this.stateMachines[H].playing=f;else{var fe=this.artboard.stateMachineByName(l[M]);if(fe){var Me=new X(fe,this.runtime,f,this.artboard);this.stateMachines.push(Me),f||Me.advanceAndApply(0)}else console.warn("State Machine with name ".concat(l[M]," not found.")),this.initLinearAnimations([l[M]],f)}}},y.prototype.play=function(l){return this.add(l,!0)},y.prototype.pause=function(l){return this.add(l,!1)},y.prototype.scrub=function(l,f){var k=this.animations.filter(function(M){return l.includes(M.name)});return k.forEach(function(M){return M.scrubTo=f}),k.map(function(M){return M.name})},Object.defineProperty(y.prototype,"playing",{get:function(){return this.animations.filter(function(l){return l.playing}).map(function(l){return l.name}).concat(this.stateMachines.filter(function(l){return l.playing}).map(function(l){return l.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"paused",{get:function(){return this.animations.filter(function(l){return!l.playing}).map(function(l){return l.name}).concat(this.stateMachines.filter(function(l){return!l.playing}).map(function(l){return l.name}))},enumerable:!1,configurable:!0}),y.prototype.stop=function(l){var f=this;l=qe(l);var k=[];if(l.length===0)k=this.animations.map(function(fe){return fe.name}).concat(this.stateMachines.map(function(fe){return fe.name})),this.animations.forEach(function(fe){return fe.cleanup()}),this.stateMachines.forEach(function(fe){return fe.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var M=this.animations.filter(function(fe){return l.includes(fe.name)});M.forEach(function(fe){fe.cleanup(),f.animations.splice(f.animations.indexOf(fe),1)});var H=this.stateMachines.filter(function(fe){return l.includes(fe.name)});H.forEach(function(fe){fe.cleanup(),f.stateMachines.splice(f.stateMachines.indexOf(fe),1)}),k=M.map(function(fe){return fe.name}).concat(H.map(function(fe){return fe.name}))}return this.eventManager.fire({type:re.Stop,data:k}),k},Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(l,f){return l||f.playing},!1)||this.stateMachines.reduce(function(l,f){return l||f.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),y.prototype.atLeastOne=function(l,f){f===void 0&&(f=!0);var k;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([k=this.artboard.animationByIndex(0).name],l,f):this.artboard.stateMachineCount()>0&&this.add([k=this.artboard.stateMachineByIndex(0).name],l,f)),k},y.prototype.handleLooping=function(){for(var l=0,f=this.animations.filter(function(M){return M.playing});l<f.length;l++){var k=f[l];k.loopValue===0&&k.loopCount?(k.loopCount=0,this.stop(k.name)):k.loopValue===1&&k.loopCount?(this.eventManager.fire({type:re.Loop,data:{animation:k.name,type:ne.Loop}}),k.loopCount=0):k.loopValue===2&&k.loopCount>1&&(this.eventManager.fire({type:re.Loop,data:{animation:k.name,type:ne.PingPong}}),k.loopCount=0)}},y.prototype.handleStateChanges=function(){for(var l=[],f=0,k=this.stateMachines.filter(function(H){return H.playing});f<k.length;f++){var M=k[f];l.push.apply(l,M.statesChanged)}l.length>0&&this.eventManager.fire({type:re.StateChange,data:l})},y.prototype.handleAdvancing=function(l){this.eventManager.fire({type:re.Advance,data:l})},y})(),re;(function(y){y.Load="load",y.LoadError="loaderror",y.Play="play",y.Pause="pause",y.Stop="stop",y.Loop="loop",y.Draw="draw",y.Advance="advance",y.StateChange="statechange",y.RiveEvent="riveevent",y.AudioStatusChange="audiostatuschange"})(re||(re={}));var ne;(function(y){y.OneShot="oneshot",y.Loop="loop",y.PingPong="pingpong"})(ne||(ne={}));var me=(function(){function y(l){l===void 0&&(l=[]),this.listeners=l}return y.prototype.getListeners=function(l){return this.listeners.filter(function(f){return f.type===l})},y.prototype.add=function(l){this.listeners.includes(l)||this.listeners.push(l)},y.prototype.remove=function(l){for(var f=0;f<this.listeners.length;f++){var k=this.listeners[f];if(k.type===l.type&&k.callback===l.callback){this.listeners.splice(f,1);break}}},y.prototype.removeAll=function(l){var f=this;l?this.listeners.filter(function(k){return k.type===l}).forEach(function(k){return f.remove(k)}):this.listeners.splice(0,this.listeners.length)},y.prototype.fire=function(l){var f=this.getListeners(l.type);f.forEach(function(k){return k.callback(l)})},y})(),te=(function(){function y(l){this.eventManager=l,this.queue=[]}return y.prototype.add=function(l){this.queue.push(l)},y.prototype.process=function(){for(;this.queue.length>0;){var l=this.queue.shift();l?.action&&l.action(),l?.event&&this.eventManager.fire(l.event)}},y})(),q;(function(y){y[y.AVAILABLE=0]="AVAILABLE",y[y.UNAVAILABLE=1]="UNAVAILABLE"})(q||(q={}));var ee=(function(y){_(l,y);function l(){var f=y!==null&&y.apply(this,arguments)||this;return f._started=!1,f._enabled=!1,f._status=q.UNAVAILABLE,f}return l.prototype.delay=function(f){return E(this,void 0,void 0,function(){return g(this,function(k){return[2,new Promise(function(M){return setTimeout(M,f)})]})})},l.prototype.timeout=function(){return E(this,void 0,void 0,function(){return g(this,function(f){return[2,new Promise(function(k,M){return setTimeout(M,50)})]})})},l.prototype.reportToListeners=function(){this.fire({type:re.AudioStatusChange}),this.removeAll()},l.prototype.enableAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(f){return this._enabled||(this._enabled=!0,this._status=q.AVAILABLE,this.reportToListeners()),[2]})})},l.prototype.testAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(f){switch(f.label){case 0:if(!(this._status===q.UNAVAILABLE&&this._audioContext!==null))return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return f.sent(),this.enableAudio(),[3,4];case 3:return f.sent(),[3,4];case 4:return[2]}})})},l.prototype._establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(f){switch(f.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),f.label=2;case 2:return this._status!==q.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return f.sent(),[4,this.delay(1e3)];case 4:return f.sent(),[3,2];case 5:return[2]}})})},l.prototype.listenForUserAction=function(){var f=this,k=function(){return E(f,void 0,void 0,function(){return g(this,function(M){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",k,{once:!0})},l.prototype.establishAudio=function(){return E(this,void 0,void 0,function(){return g(this,function(f){return this._establishAudio(),[2]})})},Object.defineProperty(l.prototype,"systemVolume",{get:function(){return this._status===q.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),l})(me),P=new ee,D=(function(){function y(){}return y.prototype.observe=function(){},y.prototype.unobserve=function(){},y.prototype.disconnect=function(){},y})(),Z=globalThis.ResizeObserver||D,ie=(function(){function y(){var l=this;this._elementsMap=new Map,this._onObservedEntry=function(f){var k=l._elementsMap.get(f.target);k!==null?k.onResize(f.target.clientWidth==0||f.target.clientHeight==0):l._resizeObserver.unobserve(f.target)},this._onObserved=function(f){f.forEach(l._onObservedEntry)},this._resizeObserver=new Z(this._onObserved)}return y.prototype.add=function(l,f){var k={onResize:f,element:l};return this._elementsMap.set(l,k),this._resizeObserver.observe(l),k},y.prototype.remove=function(l){this._resizeObserver.unobserve(l.element),this._elementsMap.delete(l.element)},y})(),ge=new ie,_e=(function(){function y(l){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=l.src,this.buffer=l.buffer,l.assetLoader&&(this.assetLoader=l.assetLoader),this.enableRiveAssetCDN=typeof l.enableRiveAssetCDN=="boolean"?l.enableRiveAssetCDN:!0,this.eventManager=new me,l.onLoad&&this.on(re.Load,l.onLoad),l.onLoadError&&this.on(re.LoadError,l.onLoadError)}return y.prototype.initData=function(){return E(this,void 0,void 0,function(){var l,f,k,M,H;return g(this,function(fe){switch(fe.label){case 0:return this.src?(l=this,[4,$e(this.src)]):[3,2];case 1:l.buffer=fe.sent(),fe.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(k=new v.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),f=k.assetLoader),M=this,[4,this.runtime.load(new Uint8Array(this.buffer),f,this.enableRiveAssetCDN)]);case 3:return M.file=fe.sent(),this.destroyed?((H=this.file)===null||H===void 0||H.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:re.Load,data:this}):this.fireLoadError(y.fileLoadErrorMessage),[2])}})})},y.prototype.init=function(){return E(this,void 0,void 0,function(){var l,f;return g(this,function(k){switch(k.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(y.missingErrorMessage),[2];k.label=1;case 1:return k.trys.push([1,4,,5]),l=this,[4,z.awaitInstance()];case 2:return l.runtime=k.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return k.sent(),[3,5];case 4:return f=k.sent(),this.fireLoadError(f instanceof Error?f.message:y.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},y.prototype.fireLoadError=function(l){throw this.eventManager.fire({type:re.LoadError,data:l}),new Error(l)},y.prototype.on=function(l,f){this.eventManager.add({type:l,callback:f})},y.prototype.off=function(l,f){this.eventManager.remove({type:l,callback:f})},y.prototype.cleanup=function(){var l;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(l=this.file)===null||l===void 0||l.delete(),this.file=null,this.destroyed=!0)},y.prototype.removeAllRiveEventListeners=function(l){this.eventManager.removeAll(l)},y.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},y.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},y.prototype.getArtboard=function(l){var f=this.file.artboardByName(l);return f!=null?new J(f):null},y.missingErrorMessage="Rive source file or data buffer required",y.fileLoadErrorMessage="The file failed to load",y})(),ke=(function(){function y(l){var f=this,k;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(M){var H=f._hasZeroSize!==M;f._hasZeroSize=M,M?(!f._layout.maxX||!f._layout.maxY)&&f.resizeToCanvas():H&&f.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=l.canvas,l.canvas.constructor===HTMLCanvasElement&&(this._observed=ge.add(this.canvas,this.onCanvasResize)),this.src=l.src,this.buffer=l.buffer,this.riveFile=l.riveFile,this.layout=(k=l.layout)!==null&&k!==void 0?k:new F,this.shouldDisableRiveListeners=!!l.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!l.isTouchScrollEnabled,this.automaticallyHandleEvents=!!l.automaticallyHandleEvents,this.enableRiveAssetCDN=l.enableRiveAssetCDN===void 0?!0:l.enableRiveAssetCDN,this.eventManager=new me,l.onLoad&&this.on(re.Load,l.onLoad),l.onLoadError&&this.on(re.LoadError,l.onLoadError),l.onPlay&&this.on(re.Play,l.onPlay),l.onPause&&this.on(re.Pause,l.onPause),l.onStop&&this.on(re.Stop,l.onStop),l.onLoop&&this.on(re.Loop,l.onLoop),l.onStateChange&&this.on(re.StateChange,l.onStateChange),l.onAdvance&&this.on(re.Advance,l.onAdvance),l.onload&&!l.onLoad&&this.on(re.Load,l.onload),l.onloaderror&&!l.onLoadError&&this.on(re.LoadError,l.onloaderror),l.onplay&&!l.onPlay&&this.on(re.Play,l.onplay),l.onpause&&!l.onPause&&this.on(re.Pause,l.onpause),l.onstop&&!l.onStop&&this.on(re.Stop,l.onstop),l.onloop&&!l.onLoop&&this.on(re.Loop,l.onloop),l.onstatechange&&!l.onStateChange&&this.on(re.StateChange,l.onstatechange),l.assetLoader&&(this.assetLoader=l.assetLoader),this.taskQueue=new te(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:l.autoplay,autoBind:l.autoBind,animations:l.animations,stateMachines:l.stateMachines,artboard:l.artboard,useOffscreenRenderer:l.useOffscreenRenderer})}return Object.defineProperty(y.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),y.new=function(l){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new y(l)},y.prototype.onSystemAudioChanged=function(){this.volume=this._volume},y.prototype.init=function(l){var f=this,k=l.src,M=l.buffer,H=l.riveFile,fe=l.animations,Me=l.stateMachines,We=l.artboard,Le=l.autoplay,ze=Le===void 0?!1:Le,et=l.useOffscreenRenderer,At=et===void 0?!1:et,mt=l.autoBind,Gt=mt===void 0?!1:mt;if(!this.destroyed){if(this.src=k,this.buffer=M,this.riveFile=H,!this.src&&!this.buffer&&!this.riveFile)throw new T(y.missingErrorMessage);var Bt=qe(fe),Tt=qe(Me);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(it){f.destroyed||(f.runtime=it,f.removeRiveListeners(),f.deleteRiveRenderer(),f.renderer=f.runtime.makeRenderer(f.canvas,At),f.canvas.width||f.canvas.height||f.resizeDrawingSurfaceToCanvas(),f.initData(We,Bt,Tt,ze,Gt).then(function(Je){if(Je)return f.setupRiveListeners()}).catch(function(Je){console.error(Je)}))}).catch(function(it){console.error(it)})}},y.prototype.setupRiveListeners=function(l){var f=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var k=(this.animator.stateMachines||[]).filter(function(H){return H.playing&&f.runtime.hasListeners(H.instance)}).map(function(H){return H.instance}),M=this.isTouchScrollEnabled;l&&"isTouchScrollEnabled"in l&&(M=l.isTouchScrollEnabled),this.eventCleanup=(0,v.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:k,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:M,layoutScaleFactor:this._layout.layoutScaleFactor})}},y.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},y.prototype.initializeAudio=function(){var l=this,f;P.status==q.UNAVAILABLE&&!((f=this.artboard)===null||f===void 0)&&f.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:re.AudioStatusChange,callback:function(){return l.onSystemAudioChanged()}},P.add(this._audioEventListener),P.establishAudio())},y.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},y.prototype.initData=function(l,f,k,M,H){return E(this,void 0,void 0,function(){var fe,Me,We,Le;return g(this,function(ze){switch(ze.label){case 0:return ze.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(fe=new _e({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=fe,[4,fe.init()]);case 1:if(ze.sent(),this.destroyed)return fe.destroyIfUnused(),[2,!1];ze.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(l,f,k,M,H),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:re.Load,data:(Le=this.src)!==null&&Le!==void 0?Le:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Me=ze.sent(),We=R(Me),console.warn(We),this.eventManager.fire({type:re.LoadError,data:We}),[2,Promise.reject(We)];case 4:return[2]}})})},y.prototype.initArtboard=function(l,f,k,M,H){if(this.file){var fe=l?this.file.artboardByName(l):this.file.defaultArtboard();if(!fe){var Me="Invalid artboard name or no default artboard";console.warn(Me),this.eventManager.fire({type:re.LoadError,data:Me});return}if(this.artboard=fe,fe.volume=this._volume*P.systemVolume,this.artboard.animationCount()<1){var Me="Artboard has no animations";throw this.eventManager.fire({type:re.LoadError,data:Me}),Me}this.animator=new he(this.runtime,this.artboard,this.eventManager);var We;if(f.length>0||k.length>0?(We=f.concat(k),this.animator.initLinearAnimations(f,M),this.animator.initStateMachines(k,M)):We=[this.animator.atLeastOne(M,!1)],this.taskQueue.add({event:{type:M?re.Play:re.Pause,data:We}}),H){var Le=this.file.defaultArtboardViewModel(fe);if(Le!==null){var ze=Le.defaultInstance();if(ze!==null){var et=new se(ze,null);this.bindViewModelInstance(et)}}}}},y.prototype.drawFrame=function(){var l,f;!((l=document?.timeline)===null||l===void 0)&&l.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(f=this.runtime)===null||f===void 0||f.resolveAnimationFrame()):this.startRendering()},y.prototype.draw=function(l,f){var k;this.frameRequestId=null;var M=performance.now();this.lastRenderTime||(this.lastRenderTime=l),this.renderSecondTimer+=l-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,f?.());var H=(l-this.lastRenderTime)/1e3;this.lastRenderTime=l;for(var fe=this.animator.animations.filter(function(zt){return zt.playing||zt.needsScrub}).sort(function(zt){return zt.needsScrub?-1:1}),Me=0,We=fe;Me<We.length;Me++){var Le=We[Me];Le.advance(H),Le.instance.didLoop&&(Le.loopCount+=1),Le.apply(1)}for(var ze=this.animator.stateMachines.filter(function(zt){return zt.playing}),et=0,At=ze;et<At.length;et++){var mt=At[et],Gt=mt.reportedEventCount();if(Gt)for(var Bt=0;Bt<Gt;Bt++){var Tt=mt.reportedEventAt(Bt);if(Tt)if(Tt.type===x.OpenUrl){if(this.eventManager.fire({type:re.RiveEvent,data:Tt}),this.automaticallyHandleEvents){var it=document.createElement("a"),Je=Tt,Ct=Je.url,ut=Je.target,vt=(0,v.sanitizeUrl)(Ct);Ct&&it.setAttribute("href",vt),ut&&it.setAttribute("target",ut),vt&&vt!==v.BLANK_URL&&it.click()}}else this.eventManager.fire({type:re.RiveEvent,data:Tt})}mt.advanceAndApply(H)}this.animator.stateMachines.length==0&&this.artboard.advance(H);var Re=this.renderer;Re.clear(),Re.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Re),Re.restore(),Re.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(H),this.frameCount++;var Qe=performance.now();for(this.frameTimes.push(Qe),this.durations.push(Qe-M);this.frameTimes[0]<=Qe-1e3;)this.frameTimes.shift(),this.durations.shift();(k=this._viewModelInstance)===null||k===void 0||k.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},y.prototype.alignRenderer=function(){var l=this,f=l.renderer,k=l.runtime,M=l._layout,H=l.artboard;f.align(M.runtimeFit(k),M.runtimeAlignment(k),{minX:M.minX,minY:M.minY,maxX:M.maxX,maxY:M.maxY},H.bounds,this._devicePixelRatioUsed*M.layoutScaleFactor)},Object.defineProperty(y.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(l,f){return l+f},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),y.prototype.cleanup=function(){var l,f;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ge.remove(this._observed),this.removeRiveListeners(),this.file&&((l=this.riveFile)===null||l===void 0||l.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(P.remove(this._audioEventListener),this._audioEventListener=null),(f=this._viewModelInstance)===null||f===void 0||f.cleanup(),this._viewModelInstance=null,this._dataEnums=null},y.prototype.deleteRiveRenderer=function(){var l;(l=this.renderer)===null||l===void 0||l.delete(),this.renderer=null},y.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},y.prototype.retrieveTextRun=function(l){var f;if(!l){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var k=this.artboard.textRun(l);if(!k){console.warn("Could not access a text run with name '".concat(l,"' in the '").concat((f=this.artboard)===null||f===void 0?void 0:f.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return k},y.prototype.getTextRunValue=function(l){var f=this.retrieveTextRun(l);return f?f.text:void 0},y.prototype.setTextRunValue=function(l,f){var k=this.retrieveTextRun(l);k&&(k.text=f)},y.prototype.play=function(l,f){var k=this;if(l=qe(l),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.play(l,f)}});return}this.animator.play(l),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},y.prototype.pause=function(l){var f=this;if(l=qe(l),!this.readyForPlaying){this.taskQueue.add({action:function(){return f.pause(l)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(l)},y.prototype.scrub=function(l,f){var k=this;if(l=qe(l),!this.readyForPlaying){this.taskQueue.add({action:function(){return k.scrub(l,f)}});return}this.animator.scrub(l,f||0),this.drawFrame()},y.prototype.stop=function(l){var f=this;if(l=qe(l),!this.readyForPlaying){this.taskQueue.add({action:function(){return f.stop(l)}});return}this.animator&&this.animator.stop(l),this.eventCleanup&&this.eventCleanup()},y.prototype.reset=function(l){var f,k,M=l?.artboard,H=qe(l?.animations),fe=qe(l?.stateMachines),Me=(f=l?.autoplay)!==null&&f!==void 0?f:!1,We=(k=l?.autoBind)!==null&&k!==void 0?k:!1;this.cleanupInstances(),this.initArtboard(M,H,fe,Me,We),this.taskQueue.process()},y.prototype.load=function(l){this.file=null,this.stop(),this.init(l)},Object.defineProperty(y.prototype,"layout",{get:function(){return this._layout},set:function(l){this._layout=l,(!l.maxX||!l.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),y.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},y.prototype.resizeDrawingSurfaceToCanvas=function(l){if(this.canvas instanceof HTMLCanvasElement&&window){var f=this.canvas.getBoundingClientRect(),k=f.width,M=f.height,H=l||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=H,this.canvas.width=H*k,this.canvas.height=H*M,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===N.Layout){var fe=this._layout.layoutScaleFactor;this.artboard.width=k/fe,this.artboard.height=M/fe}}},Object.defineProperty(y.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var l=[],f=0;f<this.artboard.animationCount();f++)l.push(this.artboard.animationByIndex(f).name);return l},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var l=[],f=0;f<this.artboard.stateMachineCount();f++)l.push(this.artboard.stateMachineByIndex(f).name);return l},enumerable:!1,configurable:!0}),y.prototype.stateMachineInputs=function(l){if(this.loaded){var f=this.animator.stateMachines.find(function(k){return k.name===l});return f?.inputs}},y.prototype.retrieveInputAtPath=function(l,f){if(!l){console.warn("No input name provided for path '".concat(f,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(l,"', at path: '").concat(f,"', but the Artboard is null"));return}var k=this.artboard.inputByPath(l,f);if(!k){console.warn("Could not access an input with name: '".concat(l,"', at path:'").concat(f,"'"));return}return k},y.prototype.setBooleanStateAtPath=function(l,f,k){var M=this.retrieveInputAtPath(l,k);M&&(M.type===K.Boolean?M.asBool().value=f:console.warn("Input with name: '".concat(l,"', at path:'").concat(k,"' is not a boolean")))},y.prototype.setNumberStateAtPath=function(l,f,k){var M=this.retrieveInputAtPath(l,k);M&&(M.type===K.Number?M.asNumber().value=f:console.warn("Input with name: '".concat(l,"', at path:'").concat(k,"' is not a number")))},y.prototype.fireStateAtPath=function(l,f){var k=this.retrieveInputAtPath(l,f);k&&(k.type===K.Trigger?k.asTrigger().fire():console.warn("Input with name: '".concat(l,"', at path:'").concat(f,"' is not a trigger")))},y.prototype.retrieveTextAtPath=function(l,f){if(!l){console.warn("No text name provided for path '".concat(f,"'"));return}if(!f){console.warn("No path provided for text '".concat(l,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(l,"', at path: '").concat(f,"', but the Artboard is null"));return}var k=this.artboard.textByPath(l,f);if(!k){console.warn("Could not access text with name: '".concat(l,"', at path:'").concat(f,"'"));return}return k},y.prototype.getTextRunValueAtPath=function(l,f){var k=this.retrieveTextAtPath(l,f);if(!k){console.warn("Could not get text with name: '".concat(l,"', at path:'").concat(f,"'"));return}return k.text},y.prototype.setTextRunValueAtPath=function(l,f,k){var M=this.retrieveTextAtPath(l,k);if(!M){console.warn("Could not set text with name: '".concat(l,"', at path:'").concat(k,"'"));return}M.text=f},Object.defineProperty(y.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(l){return l.playing}).map(function(l){return l.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(l){return l.playing}).map(function(l){return l.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(l){return!l.playing}).map(function(l){return l.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(l){return!l.playing}).map(function(l){return l.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),y.prototype.on=function(l,f){this.eventManager.add({type:l,callback:f})},y.prototype.off=function(l,f){this.eventManager.remove({type:l,callback:f})},y.prototype.unsubscribe=function(l,f){console.warn("This function is deprecated: please use `off()` instead."),this.off(l,f)},y.prototype.removeAllRiveEventListeners=function(l){this.eventManager.removeAll(l)},y.prototype.unsubscribeAll=function(l){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(l)},y.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},y.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},y.prototype.enableFPSCounter=function(l){this.runtime.enableFPSCounter(l)},y.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(y.prototype,"contents",{get:function(){if(this.loaded){for(var l={artboards:[]},f=0;f<this.file.artboardCount();f++){for(var k=this.file.artboardByIndex(f),M={name:k.name,animations:[],stateMachines:[]},H=0;H<k.animationCount();H++){var fe=k.animationByIndex(H);M.animations.push(fe.name)}for(var Me=0;Me<k.stateMachineCount();Me++){for(var We=k.stateMachineByIndex(Me),Le=We.name,ze=new this.runtime.StateMachineInstance(We,k),et=[],At=0;At<ze.inputCount();At++){var mt=ze.input(At);et.push({name:mt.name,type:mt.type})}M.stateMachines.push({name:Le,inputs:et})}l.artboards.push(M)}return l}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(l){this._volume=l,this.artboard&&(this.artboard.volume=l*P.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardWidth",{get:function(){var l;return this.artboard?this.artboard.width:(l=this._artboardWidth)!==null&&l!==void 0?l:0},set:function(l){this._artboardWidth=l,this.artboard&&(this.artboard.width=l)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardHeight",{get:function(){var l;return this.artboard?this.artboard.height:(l=this._artboardHeight)!==null&&l!==void 0?l:0},set:function(l){this._artboardHeight=l,this.artboard&&(this.artboard.height=l)},enumerable:!1,configurable:!0}),y.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(y.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(l){this._devicePixelRatioUsed=l},enumerable:!1,configurable:!0}),y.prototype.bindViewModelInstance=function(l){var f;this.artboard&&!this.destroyed&&l&&l.runtimeInstance&&(l.internalIncrementReferenceCount(),(f=this._viewModelInstance)===null||f===void 0||f.cleanup(),this._viewModelInstance=l,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(k){return k.bindViewModelInstance(l)}):this.artboard.bindViewModelInstance(l.runtimeInstance))},Object.defineProperty(y.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),y.prototype.viewModelByIndex=function(l){var f=this.file.viewModelByIndex(l);return f!==null?new Ae(f):null},y.prototype.viewModelByName=function(l){var f=this.file.viewModelByName(l);return f!==null?new Ae(f):null},y.prototype.enums=function(){if(this._dataEnums===null){var l=this.file.enums();this._dataEnums=l.map(function(f){return new Ne(f)})}return this._dataEnums},y.prototype.defaultViewModel=function(){if(this.artboard){var l=this.file.defaultArtboardViewModel(this.artboard);if(l)return new Ae(l)}return null},y.prototype.getArtboard=function(l){var f,k;return(k=(f=this.riveFile)===null||f===void 0?void 0:f.getArtboard(l))!==null&&k!==void 0?k:null},y.missingErrorMessage="Rive source file or data buffer required",y.cleanupErrorMessage="Attempt to use file after calling cleanup.",y})(),Ae=(function(){function y(l){this._viewModel=l}return Object.defineProperty(y.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),y.prototype.instanceByIndex=function(l){var f=this._viewModel.instanceByIndex(l);return f!==null?new se(f,null):null},y.prototype.instanceByName=function(l){var f=this._viewModel.instanceByName(l);return f!==null?new se(f,null):null},y.prototype.defaultInstance=function(){var l=this._viewModel.defaultInstance();return l!==null?new se(l,null):null},y.prototype.instance=function(){var l=this._viewModel.instance();return l!==null?new se(l,null):null},Object.defineProperty(y.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),y})(),Ne=(function(){function y(l){this._dataEnum=l}return Object.defineProperty(y.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),y})(),ae;(function(y){y.Number="number",y.String="string",y.Boolean="boolean",y.Color="color",y.Trigger="trigger",y.Enum="enum",y.List="list",y.Image="image",y.Artboard="artboard"})(ae||(ae={}));var se=(function(){function y(l,f){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=l,f!==null&&this._parents.push(f)}return Object.defineProperty(y.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),y.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(l){l.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(l){l.clearChanges()})),this._children.forEach(function(l){return l.handleCallbacks()})},y.prototype.addParent=function(l){this._parents.includes(l)||(this._parents.push(l),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&l.addToViewModelCallbacks(this))},y.prototype.removeParent=function(l){var f=this._parents.indexOf(l);if(f!==-1){var k=this._parents[f];k.removeFromViewModelCallbacks(this),this._parents.splice(f,1)}},y.prototype.addToPropertyCallbacks=function(l){var f=this;this._propertiesWithCallbacks.includes(l)||(this._propertiesWithCallbacks.push(l),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(k){k.addToViewModelCallbacks(f)}))},y.prototype.removeFromPropertyCallbacks=function(l){var f=this;this._propertiesWithCallbacks.includes(l)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(k){return k!==l}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(f)}))},y.prototype.addToViewModelCallbacks=function(l){var f=this;this._children.includes(l)||(this._children.push(l),this._parents.forEach(function(k){k.addToViewModelCallbacks(f)}))},y.prototype.removeFromViewModelCallbacks=function(l){var f=this;this._children.includes(l)&&(this._children=this._children.filter(function(k){return k!==l}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(k){k.removeFromViewModelCallbacks(f)}))},y.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(l){l.clearCallbacks()})},y.prototype.propertyFromPath=function(l,f){var k=l.split("/");return this.propertyFromPathSegments(k,0,f)},y.prototype.viewModelFromPathSegments=function(l,f){var k=this.internalViewModelInstance(l[f]);return k!==null?f==l.length-1?k:k.viewModelFromPathSegments(l,f++):null},y.prototype.propertyFromPathSegments=function(l,f,k){var M,H,fe,Me,We,Le,ze,et,At,mt,Gt,Bt,Tt,it,Je,Ct,ut,vt;if(f<l.length-1){var Re=this.internalViewModelInstance(l[f]);return Re!==null?Re.propertyFromPathSegments(l,f+1,k):null}var Qe=null;switch(k){case ae.Number:if(Qe=(H=(M=this._runtimeInstance)===null||M===void 0?void 0:M.number(l[f]))!==null&&H!==void 0?H:null,Qe!==null)return new le(Qe,this);break;case ae.String:if(Qe=(Me=(fe=this._runtimeInstance)===null||fe===void 0?void 0:fe.string(l[f]))!==null&&Me!==void 0?Me:null,Qe!==null)return new ue(Qe,this);break;case ae.Boolean:if(Qe=(Le=(We=this._runtimeInstance)===null||We===void 0?void 0:We.boolean(l[f]))!==null&&Le!==void 0?Le:null,Qe!==null)return new de(Qe,this);break;case ae.Color:if(Qe=(et=(ze=this._runtimeInstance)===null||ze===void 0?void 0:ze.color(l[f]))!==null&&et!==void 0?et:null,Qe!==null)return new ce(Qe,this);break;case ae.Trigger:if(Qe=(mt=(At=this._runtimeInstance)===null||At===void 0?void 0:At.trigger(l[f]))!==null&&mt!==void 0?mt:null,Qe!==null)return new ve(Qe,this);break;case ae.Enum:if(Qe=(Bt=(Gt=this._runtimeInstance)===null||Gt===void 0?void 0:Gt.enum(l[f]))!==null&&Bt!==void 0?Bt:null,Qe!==null)return new Ce(Qe,this);break;case ae.List:if(Qe=(it=(Tt=this._runtimeInstance)===null||Tt===void 0?void 0:Tt.list(l[f]))!==null&&it!==void 0?it:null,Qe!==null)return new Pe(Qe,this);break;case ae.Image:if(Qe=(Ct=(Je=this._runtimeInstance)===null||Je===void 0?void 0:Je.image(l[f]))!==null&&Ct!==void 0?Ct:null,Qe!==null)return new Ie(Qe,this);break;case ae.Artboard:if(Qe=(vt=(ut=this._runtimeInstance)===null||ut===void 0?void 0:ut.artboard(l[f]))!==null&&vt!==void 0?vt:null,Qe!==null)return new je(Qe,this);break}return null},y.prototype.internalViewModelInstance=function(l){var f;if(this._viewModelInstances.has(l))return this._viewModelInstances.get(l);var k=(f=this._runtimeInstance)===null||f===void 0?void 0:f.viewModel(l);if(k!==null){var M=new y(k,this);return M.internalIncrementReferenceCount(),this._viewModelInstances.set(l,M),M}return null},y.prototype.number=function(l){var f=this.propertyFromPath(l,ae.Number);return f},y.prototype.string=function(l){var f=this.propertyFromPath(l,ae.String);return f},y.prototype.boolean=function(l){var f=this.propertyFromPath(l,ae.Boolean);return f},y.prototype.color=function(l){var f=this.propertyFromPath(l,ae.Color);return f},y.prototype.trigger=function(l){var f=this.propertyFromPath(l,ae.Trigger);return f},y.prototype.enum=function(l){var f=this.propertyFromPath(l,ae.Enum);return f},y.prototype.list=function(l){var f=this.propertyFromPath(l,ae.List);return f},y.prototype.image=function(l){var f=this.propertyFromPath(l,ae.Image);return f},y.prototype.artboard=function(l){var f=this.propertyFromPath(l,ae.Artboard);return f},y.prototype.viewModel=function(l){var f=l.split("/"),k=f.length>1?this.viewModelFromPathSegments(f.slice(0,f.length-1),0):this;return k!=null?k.internalViewModelInstance(f[f.length-1]):null},y.prototype.internalReplaceViewModel=function(l,f){var k;if(f.runtimeInstance!==null){var M=((k=this._runtimeInstance)===null||k===void 0?void 0:k.replaceViewModel(l,f.runtimeInstance))||!1;if(M){f.internalIncrementReferenceCount();var H=this.internalViewModelInstance(l);H!==null&&(H.removeParent(this),this._children.includes(H)&&(this._children=this._children.filter(function(fe){return fe!==H})),H.cleanup()),this._viewModelInstances.set(l,f),f.addParent(this)}return M}return!1},y.prototype.replaceViewModel=function(l,f){var k,M=l.split("/"),H=M.length>1?this.viewModelFromPathSegments(M.slice(0,M.length-1),0):this;return(k=H?.internalReplaceViewModel(M[M.length-1],f))!==null&&k!==void 0?k:!1},y.prototype.incrementReferenceCount=function(){var l;this._referenceCount++,(l=this._runtimeInstance)===null||l===void 0||l.incrementReferenceCount()},y.prototype.decrementReferenceCount=function(){var l;this._referenceCount--,(l=this._runtimeInstance)===null||l===void 0||l.decrementReferenceCount()},Object.defineProperty(y.prototype,"properties",{get:function(){var l;return((l=this._runtimeInstance)===null||l===void 0?void 0:l.getProperties().map(function(f){return w({},f)}))||[]},enumerable:!1,configurable:!0}),y.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},y.prototype.cleanup=function(){var l=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(M){M.cleanup()}),this._viewModelInstances.clear();var f=b([],this._children,!0);this._children.length=0;var k=b([],this._parents,!0);this._parents.length=0,f.forEach(function(M){M.removeParent(l)}),k.forEach(function(M){M.removeFromViewModelCallbacks(l)})}},y})(),Q=(function(){function y(l,f){this.callbacks=[],this._viewModelInstanceValue=l,this._parentViewModel=f}return y.prototype.on=function(l){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(l)||(this.callbacks.push(l),this._parentViewModel.addToPropertyCallbacks(this))},y.prototype.off=function(l){l?this.callbacks=this.callbacks.filter(function(f){return f!==l}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},y.prototype.internalHandleCallback=function(l){},y.prototype.handleCallbacks=function(){var l=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(f){l.internalHandleCallback(f)})},y.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},y.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),y})(),ue=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f(this.value)},l})(Q),le=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f(this.value)},l})(Q),de=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f(this.value)},l})(Q),ve=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return l.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},l.prototype.internalHandleCallback=function(f){f()},l})(Q),Ce=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(f){this._viewModelInstanceValue.valueIndex=f},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f(this.value)},l})(Q),Pe=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),l.prototype.addInstance=function(f){f.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(f.runtimeInstance),f.addParent(this._parentViewModel))},l.prototype.addInstanceAt=function(f,k){return f.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(f.runtimeInstance,k)?(f.addParent(this._parentViewModel),!0):!1},l.prototype.removeInstance=function(f){f.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(f.runtimeInstance),f.removeParent(this._parentViewModel))},l.prototype.removeInstanceAt=function(f){this._viewModelInstanceValue.removeInstanceAt(f)},l.prototype.instanceAt=function(f){var k=this._viewModelInstanceValue.instanceAt(f);if(k!=null){var M=new se(k,this._parentViewModel);return M}return null},l.prototype.swap=function(f,k){this._viewModelInstanceValue.swap(f,k)},l.prototype.internalHandleCallback=function(f){f()},l})(Q),ce=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(f){this._viewModelInstanceValue.value=f},enumerable:!1,configurable:!0}),l.prototype.rgb=function(f,k,M){this._viewModelInstanceValue.rgb(f,k,M)},l.prototype.rgba=function(f,k,M,H){this._viewModelInstanceValue.argb(H,f,k,M)},l.prototype.argb=function(f,k,M,H){this._viewModelInstanceValue.argb(f,k,M,H)},l.prototype.alpha=function(f){this._viewModelInstanceValue.alpha(f)},l.prototype.opacity=function(f){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,f))*255))},l.prototype.internalHandleCallback=function(f){f(this.value)},l})(Q),Ie=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{set:function(f){var k;this._viewModelInstanceValue.value((k=f?.nativeImage)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f()},l})(Q),je=(function(y){_(l,y);function l(f,k){return y.call(this,f,k)||this}return Object.defineProperty(l.prototype,"value",{set:function(f){var k;this._viewModelInstanceValue.value((k=f?.nativeArtboard)!==null&&k!==void 0?k:null)},enumerable:!1,configurable:!0}),l.prototype.internalHandleCallback=function(f){f()},l})(Q),$e=function(y){return E(void 0,void 0,void 0,function(){var l,f,k;return g(this,function(M){switch(M.label){case 0:return l=new Request(y),[4,fetch(l)];case 1:return f=M.sent(),[4,f.arrayBuffer()];case 2:return k=M.sent(),[2,k]}})})},qe=function(y){return typeof y=="string"?[y]:y instanceof Array?y:[]},Ge={EventManager:me,TaskQueueManager:te},Ke=function(y){return E(void 0,void 0,void 0,function(){var l,f,k;return g(this,function(M){switch(M.label){case 0:return l=new Promise(function(H){return z.getInstance(function(fe){fe.decodeAudio(y,H)})}),[4,l];case 1:return f=M.sent(),k=new v.AudioWrapper(f),v.finalizationRegistry.register(k,f),[2,k]}})})},_t=function(y){return E(void 0,void 0,void 0,function(){var l,f,k;return g(this,function(M){switch(M.label){case 0:return l=new Promise(function(H){return z.getInstance(function(fe){fe.decodeImage(y,H)})}),[4,l];case 1:return f=M.sent(),k=new v.ImageWrapper(f),v.finalizationRegistry.register(k,f),[2,k]}})})},Xe=function(y){return E(void 0,void 0,void 0,function(){var l,f,k;return g(this,function(M){switch(M.label){case 0:return l=new Promise(function(H){return z.getInstance(function(fe){fe.decodeFont(y,H)})}),[4,l];case 1:return f=M.sent(),k=new v.FontWrapper(f),v.finalizationRegistry.register(k,f),[2,k]}})})}})(),o})())})(ws)),ws.exports}var Lp=Mp();const Yu="dracula",Na="https://vycjpmuyscfygstjjied.supabase.co";var Dp=V('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Wl(r,e){Rt(e,!0);let t=Ye(e,"bucketName",3,Yu),n=we(null);or(()=>{if(!c(n))return;const u=new Lp.Rive({src:`${Na}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:c(n),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var i=Dp(),o=S(i);Aa(o,u=>L(n,u),()=>c(n)),O(r,i),Ot()}var Fp=V('<div class="body-wrapper svelte-njwbfg"><!></div>');function cn(r,e){var t=Fp(),n=S(t);to(n,()=>e.children),O(r,t)}var $p=V('<button class="btn btn-info svelte-aplqg7">❓ Правила</button>'),Up=V('<button class="btn btn-secondary svelte-aplqg7">🔄 Заново</button>'),Np=V('<button class="btn btn-danger svelte-aplqg7">🏳️ Сдаться</button>'),Bp=V('<div id="game-header" class="svelte-aplqg7"><!> <!> <!> <!></div>');function dn(r,e){let t=Ye(e,"showGiveUp",3,!1),n=Ye(e,"extraContent",3,null),i=Ye(e,"onShowRules",3,null);var o=Bp(),u=S(o);{var h=b=>{var T=$p();T.__click=function(...R){i()?.apply(this,R)},O(b,T)};ye(u,b=>{i()&&b(h)})}var p=A(u,2);{var v=b=>{var T=Up();T.__click=function(...R){e.onRestart?.apply(this,R)},O(b,T)};ye(p,b=>{e.onRestart&&b(v)})}var _=A(p,2);{var w=b=>{var T=dt(),R=He(T);to(R,n),O(b,T)};ye(_,b=>{n()&&b(w)})}var E=A(_,2);{var g=b=>{var T=Np();T.__click=function(...R){e.onGiveUp?.apply(this,R)},O(b,T)};ye(E,b=>{t()&&e.onGiveUp&&b(g)})}O(r,o)}Dt(["click"]);var Wp=V('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),qp=V('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function Vp(r,e){Rt(e,!0);let t=Ye(e,"rewardItem",3,null),n=Ye(e,"items",19,()=>[]),i=Ye(e,"bucketName",3,"dracula"),o=Ye(e,"label",3,"Награда");function u(){if(!t()||!n()||n().length===0)return null;const g=typeof t()=="string"?t():t().id;return n().find(b=>b.id===g)||null}let h=kt(u),p=kt(()=>typeof t()=="object"&&t().name?t().name:null);function v(g){const b=g.target;b.style.display="none"}var _=dt(),w=He(_);{var E=g=>{var b=qp(),T=S(b);{var R=C=>{var x=Wp(),J=S(x);be(()=>{Ve(J,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${i()}/${c(h)?.icon||(typeof t()=="object"?t().icon:"")}`),Ve(J,"alt",c(h)?.name||c(p)||"Награда")}),Cs("error",J,v),O(C,x)};ye(T,C=>{(c(h)?.icon||typeof t()=="object"&&t().icon)&&C(R)})}var N=A(T,2),$=S(N),F=S($),z=A($,2),K=S(z);be(()=>{pe(F,`${o()??""}:`),pe(K,c(h)?.name||c(p)||"Неизвестный предмет")}),O(g,b)};ye(w,g=>{(c(h)||c(p))&&g(E)})}O(r,_),Ot()}var Gp=V('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function fn(r,e){let t=Ye(e,"rewardItem",3,null),n=Ye(e,"items",19,()=>[]),i=Ye(e,"bucketName",3,"dracula");var o=Gp(),u=S(o);Vp(u,{get rewardItem(){return t()},get items(){return n()},get bucketName(){return i()}});var h=A(u,2);{var p=v=>{var _=dt(),w=He(_);to(w,()=>e.children),O(v,_)};ye(h,v=>{e.children&&v(p)})}O(r,o)}var zp=V("<button> </button>"),Hp=V('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function hn(r,e){Rt(e,!0);let t=Ye(e,"modal",7);var n=dt(),i=He(n);{var o=u=>{var h=Hp();let p;var v=S(h),_=S(v),w=S(_),E=A(_,2),g=S(E),b=A(E,2);rt(b,21,()=>t().actions,T=>T.text,(T,R)=>{var N=zp();let $;N.__click=function(...z){c(R).action?.apply(this,z)};var F=S(N);be(z=>{$=Nt(N,1,"btn",null,$,z),pe(F,c(R).text)},[()=>({"btn-secondary":c(R).class==="btn-secondary"})]),O(T,N)}),be(T=>{p=Nt(h,1,"svelte-s62q14",null,p,T),pe(w,t().title),pe(g,t().text)},[()=>({active:t().show})]),O(u,h)};ye(i,u=>{t().show&&u(o)})}O(r,n),Ot()}Dt(["click"]);var Kp=V('<div role="button" tabindex="0"> </div>'),Yp=Dd('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),Jp=V('<span class="cooldown-timer svelte-d67gs4"> </span>'),Xp=V('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),Qp=V('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function Zp(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=8,h=6,p=5,v=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let _=we(ht([])),w=we(ht([])),E=we(ht({})),g=we(ht([])),b=we(null),T=we(!1),R=we(!1),N=we(""),$=we(0),F=we(0),z=we(ht({show:!1,title:"",text:"",actions:[]})),K,C;or(()=>{he()});function x(){if(!c(w)||c(w).length===0)return 0;let ae=0;for(let se=0;se<u;se++)for(let Q=0;Q<h;Q++)c(w)[se]&&!c(w)[se][Q]&&ae++;return ae}let J=kt(x),X=kt(()=>c(F)<1);function he(){L(_,[],!0),L(w,[],!0),L(b,null),L(T,!1),L(R,!1),L(E,{},!0),L(g,[],!0),L(N,""),L(F,0),ke();let ae=[...new Set(v)];for(;ae.length<u*h/2;)ae=[...ae,...ae];let se=ae.sort(()=>.5-Math.random()).slice(0,u*h/2),Q=[];se.forEach(le=>Q.push(le,le)),Q.sort(()=>Math.random()-.5);let ue=0;for(let le=0;le<u;le++){let de=[],ve=[];for(let Ce=0;Ce<h;Ce++)de.push(Q[ue++]),ve.push(!1);c(_).push(de),c(w).push(ve)}setTimeout(q,500)}async function re(ae,se){if(c(T)||c(w)[ae][se]||c(R))return;if(c(g).length>0&&L(g,[],!0),!c(b)){L(b,{r:ae,c:se},!0);return}if(c(b).r===ae&&c(b).c===se){L(b,null);return}const Q=c(_)[c(b).r][c(b).c],ue=c(_)[ae][se];if(Q===ue){const le=ie(c(b).r,c(b).c,ae,se);if(le){L(T,!0),await ge(le),c(w)[c(b).r][c(b).c]=!0,c(w)[ae][se]=!0,L(b,null),L(T,!1),me(),q();return}}L(b,{r:ae,c:se},!0)}async function ne(ae,se,Q){(Q.key==="Enter"||Q.key===" ")&&(Q.preventDefault(),await re(ae,se))}function me(){L(F,p);const ae=setInterval(()=>{an(F,-1),c(F)<=0&&clearInterval(ae)},1e3)}function te(){if(c(T)||c(R)||!c(X))return;let ae=[];for(let Q=0;Q<u;Q++)for(let ue=0;ue<h;ue++)c(w)[Q][ue]||ae.push({r:Q,c:ue,icon:c(_)[Q][ue]});let se={};ae.forEach(Q=>{se[Q.icon]||(se[Q.icon]=[]),se[Q.icon].push(Q)});for(const Q in se){const ue=se[Q];if(!(ue.length<2))for(let le=0;le<ue.length;le++)for(let de=le+1;de<ue.length;de++){const ve=ue[le],Ce=ue[de];if(ie(ve.r,ve.c,Ce.r,Ce.c)){L(g,[ve,Ce],!0),setTimeout(()=>L(g,[],!0),1500);return}}}}function q(){if(c(J)===0){L(R,!0),t()?(_e("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{ke(),e.onWin?.()},3e3)):_e("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:he}]);return}ee()||(t()?setTimeout(()=>P(),1e3):_e("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{ke(),P()}},{text:"Сдаться",action:()=>{_e("Конец","Попытайте удачу снова!",[{text:"ОК",action:he}])}}]))}function ee(){let ae=[];for(let Q=0;Q<u;Q++)for(let ue=0;ue<h;ue++)c(w)[Q][ue]||ae.push({r:Q,c:ue,icon:c(_)[Q][ue]});let se={};ae.forEach(Q=>{se[Q.icon]||(se[Q.icon]=[]),se[Q.icon].push(Q)});for(const Q in se){const ue=se[Q];if(!(ue.length<2)){for(let le=0;le<ue.length;le++)for(let de=le+1;de<ue.length;de++)if(ie(ue[le].r,ue[le].c,ue[de].r,ue[de].c))return!0}}return!1}function P(){let ae=[],se=[];for(let Q=0;Q<u;Q++)for(let ue=0;ue<h;ue++)c(w)[Q][ue]||(ae.push(c(_)[Q][ue]),se.push({r:Q,c:ue}));ae.length!==0&&(ae.sort(()=>Math.random()-.5),se.forEach((Q,ue)=>{c(_)[Q.r][Q.c]=ae[ue],c(E)[`${Q.r},${Q.c}`]=!0}),setTimeout(()=>{L(E,{},!0),ee()?L(R,!1):P()},500))}function D(ae,se){return ae<0||ae>=u||se<0||se>=h?!0:c(w)[ae][se]}function Z(ae,se,Q,ue){if(ae!==Q&&se!==ue)return!1;if(ae===Q){const le=Math.min(se,ue),de=Math.max(se,ue);for(let ve=le+1;ve<de;ve++)if(!D(ae,ve))return!1}else{const le=Math.min(ae,Q),de=Math.max(ae,Q);for(let ve=le+1;ve<de;ve++)if(!D(ve,se))return!1}return!0}function ie(ae,se,Q,ue){if(Z(ae,se,Q,ue))return[{r:ae,c:se},{r:Q,c:ue}];const le={r:ae,c:ue};if(D(le.r,le.c)&&Z(ae,se,le.r,le.c)&&Z(le.r,le.c,Q,ue))return[{r:ae,c:se},le,{r:Q,c:ue}];const de={r:Q,c:se};if(D(de.r,de.c)&&Z(ae,se,de.r,de.c)&&Z(de.r,de.c,Q,ue))return[{r:ae,c:se},de,{r:Q,c:ue}];for(let ve=-1;ve<=u;ve++){if(ve===ae||ve===Q)continue;const Ce={r:ve,c:se},Pe={r:ve,c:ue};if(D(Ce.r,Ce.c)&&D(Pe.r,Pe.c)&&Z(ae,se,Ce.r,Ce.c)&&Z(Ce.r,Ce.c,Pe.r,Pe.c)&&Z(Pe.r,Pe.c,Q,ue))return[{r:ae,c:se},Ce,Pe,{r:Q,c:ue}]}for(let ve=-1;ve<=h;ve++){if(ve===se||ve===ue)continue;const Ce={r:ae,c:ve},Pe={r:Q,c:ve};if(D(Ce.r,Ce.c)&&D(Pe.r,Pe.c)&&Z(ae,se,Ce.r,Ce.c)&&Z(Ce.r,Ce.c,Pe.r,Pe.c)&&Z(Pe.r,Pe.c,Q,ue))return[{r:ae,c:se},Ce,Pe,{r:Q,c:ue}]}return null}async function ge(ae){if(await ku(),!K||!C)return;const se=K.getBoundingClientRect(),Q=C.getBoundingClientRect(),ue=C.querySelector(".cell:not(.matched)");if(!ue)return;const le=ue.offsetWidth,de=ue.offsetHeight,ve=window.getComputedStyle(C),Ce=parseFloat(ve.gap)||4,Pe=Q.left-se.left,ce=Q.top-se.top,Ie=ae.map(je=>{let $e,qe;if(je.r>=0&&je.r<u&&je.c>=0&&je.c<h){const Ke=C.children[je.r*h+je.c].getBoundingClientRect();$e=Ke.left-se.left+Ke.width/2,qe=Ke.top-se.top+Ke.height/2}else{const Ge=je.c*(le+Ce)+le/2,Ke=je.r*(de+Ce)+de/2;$e=Pe+Ge,qe=ce+Ke}return`${$e.toFixed(1)},${qe.toFixed(1)}`}).join(" ");return L(N,Ie,!0),an($),new Promise(je=>{setTimeout(()=>{L(N,""),je()},350)})}function _e(ae,se,Q){L(z,{show:!0,title:ae,text:se,actions:Q},!0)}function ke(){c(z).show=!1}function Ae(){_e("📖 Правила",`Соеди монстров:

🎯 Цель: Удалить все пары одинаковых монстров.

🔗 Соедини две одинаковые фигуры линией.

📐 Линия может иметь не более 2 поворотов (изгибов).

🚫 Линия не должна проходить через другие фигуры.

💡 Если ходов нет — игра сама перемешает доску.

💡 Кнопка 💡 покажет доступную пару (с перезарядкой).`,[{text:"Понятно",action:ke}])}function Ne(){t()?(_e("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ke(),e.onLose?.()},3e3)):_e("Конец","Попытайте удачу снова!",[{text:"ОК",action:he}])}cn(r,{children:(ae,se)=>{var Q=Qp(),ue=He(Q);{let Ie=kt(()=>t()?Ne:void 0);dn(ue,{onRestart:he,get onGiveUp(){return c(Ie)},get showGiveUp(){return t()},onShowRules:Ae})}var le=A(ue,2),de=S(le);cr(de,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),rt(de,21,()=>c(_),Lt,(Ie,je,$e)=>{var qe=dt(),Ge=He(qe);rt(Ge,17,()=>c(je),Lt,(Ke,_t,Xe)=>{var y=Kp();let l;y.__click=()=>re($e,Xe),y.__keydown=k=>ne($e,Xe,k);var f=S(y);be(k=>{l=Nt(y,1,"cell svelte-d67gs4",null,l,k),pe(f,c(_t))},[()=>({selected:c(b)?.r===$e&&c(b)?.c===Xe,matched:c(w)[$e][Xe],shuffling:c(E)[`${$e},${Xe}`],"hint-glow":c(g).some(k=>k.r===$e&&k.c===Xe)})]),O(Ke,y)}),O(Ie,qe)}),Aa(de,Ie=>C=Ie,()=>C);var ve=A(de,2),Ce=S(ve);Ea(Ce,()=>c($),Ie=>{var je=dt(),$e=He(je);{var qe=Ge=>{var Ke=Yp();be(()=>Ve(Ke,"points",c(N))),O(Ge,Ke)};ye($e,Ge=>{c(N)&&Ge(qe)})}O(Ie,je)}),Aa(le,Ie=>K=Ie,()=>K);var Pe=A(le,2);fn(Pe,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(Ie,je)=>{var $e=Xp(),qe=S($e),Ge=A(S(qe)),Ke=S(Ge),_t=A(qe,2);let Xe;_t.__click=te;var y=A(S(_t));{var l=f=>{var k=Jp(),M=S(k);be(()=>pe(M,`(${c(F)??""})`)),O(f,k)};ye(y,f=>{c(F)>0&&f(l)})}be(f=>{pe(Ke,c(J)),Xe=Nt(_t,1,"btn btn-secondary svelte-d67gs4",null,Xe,f),_t.disabled=!c(X)},[()=>({disabled:!c(X),"cooldown-active":c(F)>0})]),O(Ie,$e)},$$slots:{default:!0}});var ce=A(Pe,2);hn(ce,{get modal(){return c(z)}}),O(ae,Q)}}),Ot()}Dt(["click","keydown"]);function eg(r,e,t,n,i,o,u,h,p,v){if(!(c(e)||c(t)||!c(n)))for(let _=0;_<i;_++)for(let w=0;w<o;w++){if(c(u)[_]?.[w]||c(h)[_]?.[w])continue;let E=c(p)[_][w];for(let g=0;g<i;g++)for(let b=0;b<o;b++)if(!(_===g&&w===b)&&!(c(u)[g]?.[b]||c(h)[g]?.[b])&&c(p)[g][b]===E){L(v,[{r:_,c:w},{r:g,c:b}],!0),setTimeout(()=>L(v,[],!0),1500);return}}}var tg=V('<button type="button"><div class="card-inner svelte-k8c0r2"><div class="card-front svelte-k8c0r2"> </div> <div class="card-back svelte-k8c0r2">?</div></div></button>'),rg=V('<span class="cooldown-timer svelte-k8c0r2"> </span>'),ng=V('<div class="footer-stats svelte-k8c0r2"><span class="tiles-counter svelte-k8c0r2">Осталось: <strong class="svelte-k8c0r2"> </strong></span> <button>💡 <!></button></div>'),ig=V('<!> <div id="game-container" class="svelte-k8c0r2"><div id="grid" class="svelte-k8c0r2"></div></div> <!> <!>',1);function sg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=4,h=4,p=5,v=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let _=we(ht([])),w=we(ht([])),E=we(ht([])),g=we(ht([])),b=we(null),T=we(!1),R=we(!1),N=we(0),$=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>{C()});function F(){let te=0;for(let q=0;q<u;q++)for(let ee=0;ee<h;ee++)c(w)[q]?.[ee]||te++;return te}let z=kt(F),K=kt(()=>c(N)<1);function C(){L(_,[],!0),L(w,[],!0),L(E,[],!0),L(b,null),L(T,!1),L(R,!1),L(g,[],!0),L(N,0),ne();let te=[...new Set(v)];for(;te.length<u*h/2;)te=[...te,...te];let q=te.sort(()=>.5-Math.random()).slice(0,u*h/2),ee=[];q.forEach(D=>ee.push(D,D)),ee.sort(()=>Math.random()-.5);let P=0;for(let D=0;D<u;D++){let Z=[],ie=[],ge=[];for(let _e=0;_e<h;_e++)Z.push(ee[P++]),ie.push(!1),ge.push(!1);c(_).push(Z),c(w).push(ie),c(E).push(ge)}}async function x(te,q){if(!(c(T)||c(w)[te]?.[q]||c(R))){if(c(b)&&c(b).r===te&&c(b).c===q){c(E)[te][q]=!1,L(b,null);return}if(!c(E)[te]?.[q])if(c(g).length>0&&L(g,[],!0),c(E)[te][q]=!0,!c(b))L(b,{r:te,c:q},!0);else{L(T,!0);const ee={r:te,c:q},P=c(_)[c(b).r][c(b).c],D=c(_)[ee.r][ee.c];P===D?setTimeout(()=>{c(w)[c(b).r][c(b).c]=!0,c(w)[ee.r][ee.c]=!0,c(E)[c(b).r][c(b).c]=!1,c(E)[ee.r][ee.c]=!1,L(b,null),L(T,!1),J(),X()},600):setTimeout(()=>{c(E)[c(b).r][c(b).c]=!1,c(E)[ee.r][ee.c]=!1,L(b,null),L(T,!1)},1e3)}}}function J(){L(N,p);const te=setInterval(()=>{an(N,-1),c(N)<=0&&clearInterval(te)},1e3)}function X(){c(z)===0&&(L(R,!0),t()?(re("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{ne(),e.onWin?.()},3e3)):re("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:C}]))}function he(){t()?(re("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ne(),e.onLose?.()},3e3)):re("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:C}])}function re(te,q,ee){L($,{show:!0,title:te,text:q,actions:ee},!0)}function ne(){c($).show=!1}function me(){re("📖 Правила",`Память с монстрами:

🎯 Цель: Найти все пары одинаковых карт.

🔍 Кликни на карту, чтобы открыть её.

🔗 Найди вторую карту с таким же изображением.

💡 Если карты совпали — они исчезают.

❌ Если не совпали — обе закроются.

💡 Подсказка (кнопка 💡) покажет одну пару, но имеет перезарядку.`,[{text:"Понятно",action:ne}])}cn(r,{children:(te,q)=>{var ee=ig(),P=He(ee);{let _e=kt(()=>t()?he:void 0);dn(P,{onRestart:C,get onGiveUp(){return c(_e)},get showGiveUp(){return t()},onShowRules:me})}var D=A(P,2),Z=S(D);cr(Z,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),rt(Z,21,()=>c(_),Lt,(_e,ke,Ae)=>{var Ne=dt(),ae=He(Ne);rt(ae,17,()=>c(ke),Lt,(se,Q,ue)=>{var le=tg();let de;le.__click=()=>x(Ae,ue),Ve(le,"aria-label",`Ячейка ${Ae}, ${ue}`);var ve=S(le),Ce=S(ve),Pe=S(Ce);be(ce=>{de=Nt(le,1,"cell svelte-k8c0r2",null,de,ce),pe(Pe,c(Q))},[()=>({flipped:c(E)[Ae]?.[ue],matched:c(w)[Ae]?.[ue],selected:c(b)?.r===Ae&&c(b)?.c===ue,"hint-glow":c(g).some(ce=>ce.r===Ae&&ce.c===ue)})]),O(se,le)}),O(_e,Ne)});var ie=A(D,2);fn(ie,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(_e,ke)=>{var Ae=ng(),Ne=S(Ae),ae=A(S(Ne)),se=S(ae),Q=A(Ne,2);let ue;Q.__click=[eg,T,R,K,u,h,w,E,_,g];var le=A(S(Q));{var de=ve=>{var Ce=rg(),Pe=S(Ce);be(()=>pe(Pe,`(${c(N)??""})`)),O(ve,Ce)};ye(le,ve=>{c(N)>0&&ve(de)})}be(ve=>{pe(se,c(z)),ue=Nt(Q,1,"btn btn-secondary svelte-k8c0r2",null,ue,ve),Q.disabled=!c(K)},[()=>({disabled:!c(K),"cooldown-active":c(N)>0})]),O(_e,Ae)},$$slots:{default:!0}});var ge=A(ie,2);hn(ge,{get modal(){return c($)}}),O(te,ee)}}),Ot()}Dt(["click"]);var ag=V('<div class="flame svelte-1v5x2m5"></div>'),og=V('<button type="button"><div class="candle svelte-1v5x2m5"><!></div></button>'),lg=V('<div class="footer-stats svelte-1v5x2m5"><span class="moves-counter svelte-1v5x2m5">Ходов: <strong class="svelte-1v5x2m5"> </strong></span></div>'),ug=V('<!> <div id="game-container" class="svelte-1v5x2m5"><div id="grid" class="svelte-1v5x2m5"></div></div> <!> <!>',1);function cg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=5,h=5,p=15;let v=we(ht([])),_=we(0),w=we(!1),E=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>b());let g=kt(()=>c(v).flat().every(C=>!C));function b(){L(v,Array(u).fill(null).map(()=>Array(h).fill(!1)),!0),L(_,0),L(w,!1),z();for(let C=0;C<p;C++){const x=Math.floor(Math.random()*u),J=Math.floor(Math.random()*h);T(x,J,!0)}}function T(C,x,J=!1){c(v)[C][x]=!c(v)[C][x],C>0&&(c(v)[C-1][x]=!c(v)[C-1][x]),C<u-1&&(c(v)[C+1][x]=!c(v)[C+1][x]),x>0&&(c(v)[C][x-1]=!c(v)[C][x-1]),x<h-1&&(c(v)[C][x+1]=!c(v)[C][x+1]),J||(an(_),N())}function R(C,x){c(w)||T(C,x)}function N(){c(g)&&(L(w,!0),t()?(F("🕯️ Тьма наступила",`Вы погасили все свечи за ${c(_)} ходов!`,[]),setTimeout(()=>{z(),e.onWin?.()},3e3)):F("🕯️ Тьма наступила",`Вы погасили все свечи за ${c(_)} ходов!`,[{text:"Играть снова",action:b}]))}function $(){t()?(F("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):F("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:b}])}function F(C,x,J){L(E,{show:!0,title:C,text:x,actions:J},!0)}function z(){c(E).show=!1}function K(){F("📖 Правила",`Погаси свечи:

🎯 Цель: Погасить все свечи на поле.

💡 Клик на свечу переключает её и соседние свечи (вверх, вниз, влево, вправо).

🔢 Зажжённая свеча гаснет, а потухшая — зажигается.

🧠 Подумай хорошенько — каждый ход влияет на соседние свечи!

🏆 Чем меньше ходов — тем лучше.`,[{text:"Понятно",action:z}])}cn(r,{children:(C,x)=>{var J=ug(),X=He(J);{let te=kt(()=>t()?$:void 0);dn(X,{onRestart:b,get onGiveUp(){return c(te)},get showGiveUp(){return t()},onShowRules:K})}var he=A(X,2),re=S(he);cr(re,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),rt(re,21,()=>c(v),Lt,(te,q,ee)=>{var P=dt(),D=He(P);rt(D,17,()=>c(q),Lt,(Z,ie,ge)=>{var _e=og();let ke;_e.__click=()=>R(ee,ge),Ve(_e,"aria-label",`Свеча ${ee}, ${ge}`);var Ae=S(_e),Ne=S(Ae);{var ae=se=>{var Q=ag();O(se,Q)};ye(Ne,se=>{c(ie)&&se(ae)})}be(se=>ke=Nt(_e,1,"cell svelte-1v5x2m5",null,ke,se),[()=>({lit:c(ie)})]),O(Z,_e)}),O(te,P)});var ne=A(he,2);fn(ne,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(te,q)=>{var ee=lg(),P=S(ee),D=A(S(P)),Z=S(D);be(()=>pe(Z,c(_))),O(te,ee)},$$slots:{default:!0}});var me=A(ne,2);hn(me,{get modal(){return c(E)}}),O(C,J)}}),Ot()}Dt(["click"]);var dg=V('<div class="cell svelte-53kujm"> </div>'),fg=V('<button class="color-btn svelte-53kujm"> </button>'),hg=V('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),vg=V('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function pg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=12,h=25,p=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let v=we(ht([])),_=we(0),w=we(!1),E=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>b());let g=kt(()=>()=>{const C=c(v)[0][0];return c(v).every(x=>x.every(J=>J===C))});function b(){L(v,[],!0),L(_,0),L(w,!1),z();for(let C=0;C<u;C++){let x=[];for(let J=0;J<u;J++)x.push(Math.floor(Math.random()*p.length));c(v).push(x)}}function T(C,x,J,X){C<0||C>=u||x<0||x>=u||c(v)[C][x]===J&&(c(v)[C][x]=X,T(C-1,x,J,X),T(C+1,x,J,X),T(C,x-1,J,X),T(C,x+1,J,X))}function R(C){if(c(w)||c(_)>=h)return;const x=c(v)[0][0];C!==x&&(T(0,0,x,C),an(_),N())}function N(){c(g)()?(L(w,!0),t()?(F("🎉 Победа!",`Вы захватили мир за ${c(_)} ходов!`,[]),setTimeout(()=>{z(),e.onWin?.()},3e3)):F("🎉 Победа!",`Вы захватили мир за ${c(_)} ходов!`,[{text:"Играть снова",action:b}])):c(_)>=h&&(L(w,!0),t()?(F("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):F("💀 Поражение","Ходы закончились!",[{text:"Заново",action:b}]))}function $(){t()?(F("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):F("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:b}])}function F(C,x,J){L(E,{show:!0,title:C,text:x,actions:J},!0)}function z(){c(E).show=!1}function K(){F("📖 Правила",`Заливка мира:

🎯 Цель: Залить всё поле одним цветом.

🔴 Нажми на цвет внизу — он начнёт заливать поле с левого верхнего угла.

🔗 Цвет распространяется по соседним клеткам того же цвета.

⏰ У тебя есть всего 25 ходов!

💡 Планируй заранее — выбирай цтобы захватить как можно больше клеток.`,[{text:"Понятно",action:z}])}cn(r,{children:(C,x)=>{var J=vg(),X=He(J);{let q=kt(()=>t()?$:void 0);dn(X,{onRestart:b,get onGiveUp(){return c(q)},get showGiveUp(){return t()},onShowRules:K})}var he=A(X,2),re=S(he);cr(re,"grid-template-columns: repeat(12, 1fr);"),rt(re,21,()=>c(v),Lt,(q,ee)=>{var P=dt(),D=He(P);rt(D,17,()=>c(ee),Lt,(Z,ie)=>{var ge=dg(),_e=S(ge);be(()=>{cr(ge,`background-color: ${p[c(ie)].value??""};`),pe(_e,p[c(ie)].icon)}),O(Z,ge)}),O(q,P)});var ne=A(he,2);rt(ne,21,()=>p,Lt,(q,ee,P)=>{var D=fg();D.__click=()=>R(P);var Z=S(D);be(()=>{cr(D,`background-color: ${c(ee).value??""};`),D.disabled=c(w)||c(_)>=h,pe(Z,c(ee).icon)}),O(q,D)});var me=A(ne,2);fn(me,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(q,ee)=>{var P=hg(),D=S(P),Z=A(S(D)),ie=S(Z),ge=A(Z);ge.nodeValue=" / 25",be(()=>pe(ie,c(_))),O(q,P)},$$slots:{default:!0}});var te=A(me,2);hn(te,{get modal(){return c(E)}}),O(C,J)}}),Ot()}Dt(["click"]);var gg=V('<button type="button"> </button>'),_g=V('<div class="footer-stats svelte-fn2aic"><span class="moves-counter svelte-fn2aic">Ходов: <strong class="svelte-fn2aic"> </strong></span></div>'),mg=V('<!> <div id="game-container" class="svelte-fn2aic"><div id="grid" class="svelte-fn2aic"></div></div> <!> <!>',1);function yg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=4;let h=we(ht([])),p=we(0),v=we(!1),_=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>E());let w=kt(()=>()=>{let K=1;for(let C=0;C<u;C++)for(let x=0;x<u;x++)if(C===u-1&&x===u-1){if(c(h)[C][x]!==null)return!1}else{if(c(h)[C][x]!==K)return!1;K++}return!0});function E(){L(h,[],!0),L(p,0),L(v,!1),F();let K=[];for(let x=1;x<u*u;x++)K.push(x);K.push(null);do K=K.sort(()=>Math.random()-.5);while(!g(K));let C=0;for(let x=0;x<u;x++){let J=[];for(let X=0;X<u;X++)J.push(K[C++]);c(h).push(J)}}function g(K){let C=0;for(let J=0;J<K.length;J++)for(let X=J+1;X<K.length;X++)K[J]&&K[X]&&K[J]>K[X]&&C++;let x=0;for(let J=0;J<K.length;J++)if(K[J]===null){x=Math.floor(J/u);break}return C%2===(u-x)%2}function b(){for(let K=0;K<u;K++)for(let C=0;C<u;C++)if(c(h)[K][C]===null)return{r:K,c:C};return null}function T(K,C){if(c(v))return;const x=b();if(!x)return;const J=Math.abs(K-x.r),X=Math.abs(C-x.c);(J===1&&X===0||J===0&&X===1)&&(c(h)[x.r][x.c]=c(h)[K][C],c(h)[K][C]=null,an(p),R())}function R(){c(w)()&&(L(v,!0),t()?($("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${c(p)} ходов!`,[]),setTimeout(()=>{F(),e.onWin?.()},3e3)):$("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${c(p)} ходов!`,[{text:"Играть снова",action:E}]))}function N(){t()?($("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{F(),e.onLose?.()},3e3)):$("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:E}])}function $(K,C,x){L(_,{show:!0,title:K,text:C,actions:x},!0)}function F(){c(_).show=!1}function z(){$("📖 Правила",`Пятнашки (Осколки зеркала):

🎯 Цель: Собрать числа по порядку от 1 до 15.

🔄 Клик на плитку перемещает её на пустое место (рядом).

🧠 Подумай над ходами — плитки можно двигать только по одной!

🏆 Собери головоломку за меньшее количество ходов.`,[{text:"Понятно",action:F}])}cn(r,{children:(K,C)=>{var x=mg(),J=He(x);{let me=kt(()=>t()?N:void 0);dn(J,{onRestart:E,get onGiveUp(){return c(me)},get showGiveUp(){return t()},onShowRules:z})}var X=A(J,2),he=S(X);cr(he,"grid-template-columns: repeat(4, 1fr);"),rt(he,21,()=>c(h),Lt,(me,te,q)=>{var ee=dt(),P=He(ee);rt(P,17,()=>c(te),Lt,(D,Z,ie)=>{var ge=gg();let _e;ge.__click=()=>T(q,ie);var ke=S(ge);be(Ae=>{_e=Nt(ge,1,"cell svelte-fn2aic",null,_e,Ae),ge.disabled=c(Z)===null,Ve(ge,"aria-label",c(Z)===null?"Пустая ячейка":`Ячейка ${c(Z)}`),pe(ke,c(Z))},[()=>({empty:c(Z)===null})]),O(D,ge)}),O(me,ee)});var re=A(X,2);fn(re,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(me,te)=>{var q=_g(),ee=S(q),P=A(S(ee)),D=S(P);be(()=>pe(D,c(p))),O(me,q)},$$slots:{default:!0}});var ne=A(re,2);hn(ne,{get modal(){return c(_)}}),O(K,x)}}),Ot()}Dt(["click"]);function bg(r,e,t){L(e,r.touches[0].clientX,!0),L(t,r.touches[0].clientY,!0)}var wg=V("<div> </div>"),kg=V('<div class="footer-stats svelte-1o3nb6j"><span class="score-counter svelte-1o3nb6j">Очки: <strong class="svelte-1o3nb6j"> </strong></span></div>'),Sg=V('<!> <div id="game-container" class="svelte-1o3nb6j"><div id="grid" class="svelte-1o3nb6j"></div></div> <!> <!>',1);function Ig(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=4,h=2048,p={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},v={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let _=we(ht([])),w=we(0),E=we(!1),g=we(!1),b=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>(T(),window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)));function T(){L(_,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),L(w,0),L(E,!1),L(g,!1),q(),R(),R()}function R(){let P=[];for(let D=0;D<u;D++)for(let Z=0;Z<u;Z++)c(_)[D][Z]===0&&P.push({r:D,c:Z});if(P.length>0){const{r:D,c:Z}=P[Math.floor(Math.random()*P.length)];c(_)[D][Z]=Math.random()<.9?2:4}}function N(P){if(c(E))return;let D=!1;switch(P.key){case"ArrowUp":D=K();break;case"ArrowDown":D=C();break;case"ArrowLeft":D=F();break;case"ArrowRight":D=z();break}D&&(P.preventDefault(),R(),he())}function $(P){let D=P.filter(ie=>ie!==0),Z=!1;for(let ie=0;ie<D.length-1;ie++)D[ie]===D[ie+1]&&(D[ie]*=2,L(w,c(w)+D[ie]),D.splice(ie+1,1),Z=!0);for(;D.length<u;)D.push(0);return{newRow:D,moved:Z||P.join(",")!==D.join(",")}}function F(){let P=!1;for(let D=0;D<u;D++){const{newRow:Z,moved:ie}=$(c(_)[D]);c(_)[D]=Z,ie&&(P=!0)}return P}function z(){let P=!1;for(let D=0;D<u;D++){const{newRow:Z,moved:ie}=$([...c(_)[D]].reverse());c(_)[D]=Z.reverse(),ie&&(P=!0)}return P}function K(){let P=!1;for(let D=0;D<u;D++){let Z=[];for(let _e=0;_e<u;_e++)Z.push(c(_)[_e][D]);const{newRow:ie,moved:ge}=$(Z);for(let _e=0;_e<u;_e++)c(_)[_e][D]=ie[_e];ge&&(P=!0)}return P}function C(){let P=!1;for(let D=0;D<u;D++){let Z=[];for(let _e=0;_e<u;_e++)Z.push(c(_)[_e][D]);const{newRow:ie,moved:ge}=$(Z.reverse());Z=ie.reverse();for(let _e=0;_e<u;_e++)c(_)[_e][D]=Z[_e];ge&&(P=!0)}return P}let x=we(0),J=we(0);function X(P){if(c(E))return;const D=P.changedTouches[0].clientX,Z=P.changedTouches[0].clientY,ie=D-c(x),ge=Z-c(J);if(Math.abs(ie)<30&&Math.abs(ge)<30)return;let _e=!1;Math.abs(ie)>Math.abs(ge)?_e=ie>0?z():F():_e=ge>0?C():K(),_e&&(P.preventDefault(),R(),he())}function he(){if(!c(g)){for(let P=0;P<u;P++)for(let D=0;D<u;D++)if(c(_)[P][D]>=h){L(g,!0),t()?(te("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{q(),e.onWin?.()},3e3)):te("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:q},{text:"Новая игра",action:T,class:"btn-secondary"}]);return}}re()&&!ne()&&(L(E,!0),t()?(te("💀 Конец",`Игра окончена. Очки: ${c(w)}`,[]),setTimeout(()=>{q(),e.onLose?.()},3e3)):te("💀 Конец",`Игра окончена. Очки: ${c(w)}`,[{text:"Новая игра",action:T}]))}function re(){for(let P=0;P<u;P++)for(let D=0;D<u;D++)if(c(_)[P][D]===0)return!1;return!0}function ne(){for(let P=0;P<u;P++)for(let D=0;D<u;D++)if(D<u-1&&c(_)[P][D]===c(_)[P][D+1]||P<u-1&&c(_)[P][D]===c(_)[P+1][D])return!0;return!1}function me(){t()?(te("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{q(),e.onLose?.()},3e3)):te("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:T}])}function te(P,D,Z){L(b,{show:!0,title:P,text:D,actions:Z},!0)}function q(){c(b).show=!1}function ee(){te("📖 Правила",`Эволюция 2048:

🎯 Цель: Создать существо уровня 2048 (Король).

⬅️➡️⬆️⬇️ Свайп или стрелки перемещают всех существ в одну сторону.

🔗 Одинаковые существа эволюционируют при столкновении:
🦇→👻→💀→🧟→🧛→🧙→👹→🐉→🔥→⚡→👑

💥 Новое существо появляется после каждого хода.

🏆 Победишь, когда получишь короля!`,[{text:"Понятно",action:q}])}cn(r,{children:(P,D)=>{var Z=Sg(),ie=He(Z);{let Ne=kt(()=>t()?me:void 0);dn(ie,{onRestart:T,get onGiveUp(){return c(Ne)},get showGiveUp(){return t()},onShowRules:ee})}var ge=A(ie,2);ge.__touchstart=[bg,x,J],ge.__touchend=X;var _e=S(ge);rt(_e,21,()=>c(_),Lt,(Ne,ae)=>{var se=dt(),Q=He(se);rt(Q,17,()=>c(ae),Lt,(ue,le)=>{var de=wg();Nt(de,1,"cell svelte-1o3nb6j",null,{},{"cell-{cell}":le-{}});var ve=S(de);be(()=>{cr(de,`background-color: ${v[c(le)]||"#2a2a40"};`),pe(ve,c(le)>0?p[c(le)]||c(le):"")}),O(ue,de)}),O(Ne,se)});var ke=A(ge,2);fn(ke,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(Ne,ae)=>{var se=kg(),Q=S(se),ue=A(S(Q)),le=S(ue);be(()=>pe(le,c(w))),O(Ne,se)},$$slots:{default:!0}});var Ae=A(ke,2);hn(Ae,{get modal(){return c(b)}}),O(P,Z)}}),Ot()}Dt(["touchstart","touchend"]);var Eg=V('<button type="button"><span class="cell-content svelte-1p9db1h"> </span></button>'),Ag=V('<div class="footer-stats svelte-1p9db1h"><span class="mines-counter svelte-1p9db1h"></span> <span class="flag-counter svelte-1p9db1h"> </span></div>'),Cg=V('<!> <div id="game-container" class="svelte-1p9db1h"><div id="grid" class="svelte-1p9db1h"></div></div> <!> <!>',1);function jg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=8,h=8,p=10;let v=we(ht([])),_=we(!1),w=we(!1),E=we(!0),g=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>N());let b=kt(()=>c(v).filter(q=>q.revealed).length),T=u*h,R=kt(()=>c(w)||c(b)===T-p);function N(){L(v,Array(T).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),L(_,!1),L(w,!1),L(E,!0),re()}function $(q){let ee=0;for(;ee<p;){const P=Math.floor(Math.random()*T);P!==q&&!c(v)[P].isMine&&(c(v)[P].isMine=!0,ee++)}for(let P=0;P<T;P++)c(v)[P].isMine||(c(v)[P].adjacentMines=F(P))}function F(q){const ee=Math.floor(q/h),P=q%h;let D=0;for(let Z=-1;Z<=1;Z++)for(let ie=-1;ie<=1;ie++){if(Z===0&&ie===0)continue;const ge=ee+Z,_e=P+ie;if(ge>=0&&ge<u&&_e>=0&&_e<h){const ke=ge*h+_e;c(v)[ke].isMine&&D++}}return D}function z(q){if(!(c(_)||c(v)[q].revealed||c(v)[q].flagged)){if(c(E)&&($(q),L(E,!1)),c(v)[q].isMine){x(),L(_,!0),L(w,!1),t()?(he("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{re(),e.onLose?.()},3e3)):he("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:N}]);return}C(q),J()}}function K(q,ee){ee.preventDefault(),!(c(_)||c(v)[q].revealed)&&(c(v)[q].flagged=!c(v)[q].flagged)}function C(q){if(!(q<0||q>=T)&&!(c(v)[q].revealed||c(v)[q].flagged)&&(c(v)[q].revealed=!0,c(v)[q].adjacentMines===0&&!c(v)[q].isMine)){const ee=Math.floor(q/h),P=q%h;for(let D=-1;D<=1;D++)for(let Z=-1;Z<=1;Z++){if(D===0&&Z===0)continue;const ie=ee+D,ge=P+Z;ie>=0&&ie<u&&ge>=0&&ge<h&&C(ie*h+ge)}}}function x(){for(let q=0;q<T;q++)c(v)[q].isMine&&(c(v)[q].revealed=!0)}function J(){c(R)&&(L(w,!0),L(_,!0),t()?(he("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{re(),e.onWin?.()},3e3)):he("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:N}]))}function X(){t()?(he("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{re(),e.onLose?.()},3e3)):he("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:N}])}function he(q,ee,P){L(g,{show:!0,title:q,text:ee,actions:P},!0)}function re(){c(g).show=!1}function ne(q){return q.revealed?q.isMine?"💀":q.adjacentMines===0?"":q.adjacentMines.toString():q.flagged?"🕯":""}function me(q){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][q]||"#ececec"}function te(){he("📖 Правила",`Сапёр (Проклятые склепы):

🎯 Цель: Открыть все ячейки, где нет мин.

🔢 Цифры показывают, сколько мин рядом с ячейкой (от 1 до 8).

🕯 Правый клик ставит флаг (пометить мину).

💡 Первое нажатие всегда безопасно — мины расставляются после первого клика.

💀 Если наткнёшься на мину — проигрыш.`,[{text:"Понятно",action:re}])}cn(r,{children:(q,ee)=>{var P=Cg(),D=He(P);{let ke=kt(()=>t()?X:void 0);dn(D,{onRestart:N,get onGiveUp(){return c(ke)},get showGiveUp(){return t()},onShowRules:te})}var Z=A(D,2),ie=S(Z);cr(ie,"grid-template-columns: repeat(8, 1fr);"),rt(ie,21,()=>c(v),Lt,(ke,Ae,Ne)=>{var ae=Eg();let se;ae.__click=()=>z(Ne),ae.__contextmenu=le=>K(Ne,le);var Q=S(ae),ue=S(Q);be((le,de,ve)=>{se=Nt(ae,1,"cell svelte-1p9db1h",null,se,le),Ve(ae,"aria-label",c(Ae).revealed?c(Ae).isMine?"Мина":`Ячейка с ${c(Ae).adjacentMines} минами`:c(Ae).flagged?"Флаг":"Неизвестно"),cr(Q,`color: ${de??""}`),pe(ue,ve)},[()=>({revealed:c(Ae).revealed,mine:c(Ae).isMine&&c(Ae).revealed,flagged:c(Ae).flagged}),()=>c(Ae).revealed&&!c(Ae).isMine?me(c(Ae).adjacentMines):"",()=>ne(c(Ae))]),O(ke,ae)});var ge=A(Z,2);fn(ge,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(ke,Ae)=>{var Ne=Ag(),ae=S(Ne);ae.textContent="💀 10";var se=A(ae,2),Q=S(se);be(ue=>pe(Q,`🕯 ${ue??""}`),[()=>c(v).filter(ue=>ue.flagged).length]),O(ke,Ne)},$$slots:{default:!0}});var _e=A(ge,2);hn(_e,{get modal(){return c(g)}}),O(q,P)}}),Ot()}Dt(["click","contextmenu"]);function xg(r,e,t,n){if(c(e).length>0){const i=c(e).pop();i.faceUp=!0,c(t).push(i)}else c(t).length>0&&(L(e,c(t).reverse().map(i=>({...i,faceUp:!1})),!0),L(t,[],!0));an(n)}function Tg(r,e,t){c(e).length!==0&&L(t,{pile:-2,index:c(e).length-1},!0)}var Pg=V('<div class="card back svelte-fcha4g"></div>'),Rg=V('<div class="card empty svelte-fcha4g">🔄</div>'),Og=V('<div><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),Mg=V('<div class="card front svelte-fcha4g"><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),Lg=V('<div class="card empty svelte-fcha4g">👻</div>'),Dg=V('<button type="button" class="pile foundation svelte-fcha4g"><!></button>'),Fg=V('<span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span>',1),$g=V('<button type="button"><!></button>'),Ug=V('<div class="tableau svelte-fcha4g" role="button" tabindex="0"></div>'),Ng=V('<div class="footer-stats svelte-fcha4g"><span class="moves-counter svelte-fcha4g">Ходов: <strong class="svelte-fcha4g"> </strong></span></div>'),Bg=V('<!> <div id="game-container" class="svelte-fcha4g"><div class="top-row svelte-fcha4g"><button type="button" class="pile stock svelte-fcha4g" aria-label="Колода"><!></button> <button type="button" class="pile waste svelte-fcha4g" aria-label="Сброс"><!></button> <div class="foundations svelte-fcha4g"></div></div> <div class="tableaus svelte-fcha4g"></div></div> <!> <!>',1);function Wg(r,e){Rt(e,!0);let t=Ye(e,"integrated",3,!1),n=Ye(e,"rewardItem",3,null),i=Ye(e,"items",19,()=>[]),o=Ye(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],h={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},p=[1,2,3,4,5,6,7,8,9,10,11,12,13],v={1:"A",11:"J",12:"Q",13:"K"};let _=we(ht([])),w=we(ht([])),E=we(ht([[],[],[],[]])),g=we(ht([[],[],[],[],[],[],[]])),b=we(null),T=we(!1),R=we(0),N=we(ht({show:!1,title:"",text:"",actions:[]}));or(()=>F());let $=kt(()=>c(E).every(te=>te.length===13));function F(){let te=[];for(const ee of u)for(const P of p)te.push({suit:ee,rank:P,faceUp:!1});te=te.sort(()=>Math.random()-.5),L(_,[],!0),L(w,[],!0),L(E,[[],[],[],[]],!0),L(g,[[],[],[],[],[],[],[]],!0);let q=0;for(let ee=0;ee<7;ee++)for(let P=ee;P<7;P++){const D=te[q++];D.faceUp=ee===P,c(g)[P].push(D)}for(;q<te.length;)c(_).push(te[q++]);L(b,null),L(R,0),L(T,!1),he()}function z(te,q){const ee=c(g)[te];if(c(b)){const{pile:P,index:D}=c(b);let Z;P===-2?Z=[c(w)[D]]:Z=c(g)[P].slice(D);const ie=Z[0];if(ee.length===0){if(ie.rank===13){C(P,D,te,-1),L(b,null);return}}else{const ge=ee[ee.length-1];if((ie.suit==="hearts"||ie.suit==="diamonds")!=(ge.suit==="hearts"||ge.suit==="diamonds")&&ie.rank===ge.rank-1){C(P,D,te,-1),L(b,null);return}}if(Z.length===1)for(let ge=0;ge<4;ge++){const _e=c(E)[ge];if(_e.length===0){if(ie.rank===1){C(P,D,-1,ge),L(b,null);return}}else{const ke=_e[_e.length-1];if(ie.suit===ke.suit&&ie.rank===ke.rank+1){C(P,D,-1,ge),L(b,null);return}}}L(b,null)}else q>=0&&ee[q]?.faceUp&&L(b,{pile:te,index:q},!0)}function K(te){if(!c(b))return;const{pile:q,index:ee}=c(b);let P;q===-2?P=c(w)[ee]:P=c(g)[q][ee];const D=c(E)[te];if(D.length===0)P.rank===1&&q>=-1&&(q===-2?[c(w)[ee]]:c(g)[q].slice(ee)).length===1&&C(q,ee,-1,te);else{const Z=D[D.length-1];P.suit===Z.suit&&P.rank===Z.rank+1&&(q===-2?[c(w)[ee]]:c(g)[q].slice(ee)).length===1&&C(q,ee,-1,te)}L(b,null)}function C(te,q,ee,P){let D;te===-2?D=[c(w).pop()]:(D=c(g)[te].splice(q),c(g)[te].length>0&&(c(g)[te][c(g)[te].length-1].faceUp=!0)),ee>=0?c(g)[ee].push(...D):P>=0&&c(E)[P].push(...D),an(R),x()}function x(){c($)&&(L(T,!0),t()?(X("🎉 Победа!",`Вы собрали все души за ${c(R)} ходов!`,[]),setTimeout(()=>{he(),e.onWin?.()},3e3)):X("🎉 Победа!",`Вы собрали все души за ${c(R)} ходов!`,[{text:"Играть снова",action:F}]))}function J(){t()?(X("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{he(),e.onLose?.()},3e3)):X("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:F}])}function X(te,q,ee){L(N,{show:!0,title:te,text:q,actions:ee},!0)}function he(){c(N).show=!1}function re(){X("📖 Правила",`Пасьянс (Башня душ):

🎯 Цель: Собрать все карты в фундаменты (справа) по мастям от туза до короля.

🃏 Кликни на колоду (слева) чтобы взять карту.

📋 Возьми карту из сброса и положи в столбец по убыванию (красная на чёрную).

🔄 Карты в столбце можно перемещать друг на друга по убыванию и чередованию цветов.

💡 Короля можно положить на пустой столбец.

🏆 Собери все 4 масти от туза до короля!`,[{text:"Понятно",action:he}])}function ne(te){return v[te]||te.toString()}function me(te){return te==="hearts"||te==="diamonds"?"#e94560":"#ececec"}cn(r,{children:(te,q)=>{var ee=Bg(),P=He(ee);{let de=kt(()=>t()?J:void 0);dn(P,{onRestart:F,get onGiveUp(){return c(de)},get showGiveUp(){return t()},onShowRules:re})}var D=A(P,2),Z=S(D),ie=S(Z);ie.__click=[xg,_,w,R];var ge=S(ie);{var _e=de=>{var ve=Pg();O(de,ve)},ke=de=>{var ve=Rg();O(de,ve)};ye(ge,de=>{c(_).length>0?de(_e):de(ke,!1)})}var Ae=A(ie,2);Ae.__click=[Tg,w,b];var Ne=S(Ae);{var ae=de=>{var ve=Og();let Ce;var Pe=S(ve),ce=S(Pe),Ie=A(Pe,2),je=S(Ie);be(($e,qe,Ge)=>{Ce=Nt(ve,1,"card front svelte-fcha4g",null,Ce,$e),pe(ce,qe),cr(Ie,`color: ${Ge??""}`),pe(je,h[c(w)[c(w).length-1].suit])},[()=>({selected:c(b)?.pile===-2}),()=>ne(c(w)[c(w).length-1].rank),()=>me(c(w)[c(w).length-1].suit)]),O(de,ve)};ye(Ne,de=>{c(w).length>0&&de(ae)})}var se=A(Ae,2);rt(se,21,()=>c(E),Lt,(de,ve,Ce)=>{var Pe=Dg();Pe.__click=()=>K(Ce),Ve(Pe,"aria-label",`Фундамент ${Ce+1}`);var ce=S(Pe);{var Ie=$e=>{var qe=Mg(),Ge=S(qe),Ke=S(Ge),_t=A(Ge,2),Xe=S(_t);be((y,l)=>{pe(Ke,y),cr(_t,`color: ${l??""}`),pe(Xe,h[c(ve)[c(ve).length-1].suit])},[()=>ne(c(ve)[c(ve).length-1].rank),()=>me(c(ve)[c(ve).length-1].suit)]),O($e,qe)},je=$e=>{var qe=Lg();O($e,qe)};ye(ce,$e=>{c(ve).length>0?$e(Ie):$e(je,!1)})}O(de,Pe)});var Q=A(Z,2);rt(Q,21,()=>c(g),Lt,(de,ve,Ce)=>{var Pe=Ug();Pe.__click=()=>z(Ce,-1),Pe.__keydown=ce=>{(ce.key==="Enter"||ce.key===" ")&&(ce.preventDefault(),z(Ce,-1))},Ve(Pe,"aria-label",`Столбец ${Ce+1}`),rt(Pe,21,()=>c(ve),Lt,(ce,Ie,je)=>{var $e=$g();let qe;$e.__click=_t=>{_t.stopPropagation(),z(Ce,je)},cr($e,`margin-top: ${je>0?"-80%":"0"}; z-index: ${je};`);var Ge=S($e);{var Ke=_t=>{var Xe=Fg(),y=He(Xe),l=S(y),f=A(y,2),k=S(f);be((M,H)=>{pe(l,M),cr(f,`color: ${H??""}`),pe(k,h[c(Ie).suit])},[()=>ne(c(Ie).rank),()=>me(c(Ie).suit)]),O(_t,Xe)};ye(Ge,_t=>{c(Ie).faceUp&&_t(Ke)})}be((_t,Xe)=>{qe=Nt($e,1,"card svelte-fcha4g",null,qe,_t),Ve($e,"aria-label",Xe)},[()=>({front:c(Ie).faceUp,back:!c(Ie).faceUp,selected:c(b)?.pile===Ce&&c(b)?.index===je}),()=>c(Ie).faceUp?`${ne(c(Ie).rank)} ${h[c(Ie).suit]}`:"Лицевая сторона карты"]),O(ce,$e)}),O(de,Pe)});var ue=A(D,2);fn(ue,{get rewardItem(){return n()},get items(){return i()},get bucketName(){return o()},children:(de,ve)=>{var Ce=Ng(),Pe=S(Ce),ce=A(S(Pe)),Ie=S(ce);be(()=>pe(Ie,c(R))),O(de,Ce)},$$slots:{default:!0}});var le=A(ue,2);hn(le,{get modal(){return c(N)}}),O(te,ee)}}),Ot()}Dt(["click","keydown"]);var qg=V('<div class="loading svelte-15dde84">Загрузка игры...</div>'),Vg=V('<div class="minigame-container svelte-15dde84"><!></div>');function Gg(r,e){Rt(e,!0);let t=Ye(e,"bucketName",3,"dracula");function n(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function i(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var o=Vg(),u=S(o);{var h=v=>{Zp(v,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=v=>{var _=dt(),w=He(_);{var E=b=>{sg(b,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},g=b=>{var T=dt(),R=He(T);{var N=F=>{cg(F,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},$=F=>{var z=dt(),K=He(z);{var C=J=>{pg(J,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},x=J=>{var X=dt(),he=He(X);{var re=me=>{yg(me,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},ne=me=>{var te=dt(),q=He(te);{var ee=D=>{Ig(D,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},P=D=>{var Z=dt(),ie=He(Z);{var ge=ke=>{jg(ke,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},_e=ke=>{var Ae=dt(),Ne=He(Ae);{var ae=Q=>{Wg(Q,{onWin:n,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},se=Q=>{var ue=qg();O(Q,ue)};ye(Ne,Q=>{e.gameId==="tower_of_souls"?Q(ae):Q(se,!1)},!0)}O(ke,Ae)};ye(ie,ke=>{e.gameId==="cursed_crypts"?ke(ge):ke(_e,!1)},!0)}O(D,Z)};ye(q,D=>{e.gameId==="evolution2048"?D(ee):D(P,!1)},!0)}O(me,te)};ye(he,me=>{e.gameId==="broken_mirror"?me(re):me(ne,!1)},!0)}O(J,X)};ye(K,J=>{e.gameId==="flood_it"?J(C):J(x,!1)},!0)}O(F,z)};ye(R,F=>{e.gameId==="light_out"?F(N):F($,!1)},!0)}O(b,T)};ye(w,b=>{e.gameId==="memo_monsters"?b(E):b(g,!1)},!0)}O(v,_)};ye(u,v=>{e.gameId==="onet_monsters"?v(h):v(p,!1)})}O(r,o),Ot()}function zg(r,e){c(e)?.nextDialogueId&&Ze.goToDialogue(c(e).nextDialogueId)}var Hg=V('<img alt="BG" class="background-image svelte-fl90wm"/>'),Kg=V('<div class="background-media svelte-fl90wm"><!></div>'),Yg=V('<img alt="Char" class="character-image svelte-fl90wm"/>'),Jg=V('<div class="character-media svelte-fl90wm"><!></div>'),Xg=(r,e,t)=>e(c(t)),Qg=V("<button> </button>"),Zg=V('<div class="options-container svelte-fl90wm"></div>'),e_=V('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),t_=V('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),r_=V("<p> </p>");function Ju(r,e){Rt(e,!0);let t=Ye(e,"bucketName",3,Yu);console.log(t());const n=kt(()=>e.dialogue||Ze.findDialogue(Ze.currentDialogueId));let i=we(null);Tn(()=>{c(n)?.onEnter&&Ze.runActions(c(n).onEnter)});function o(b){if(b.actions&&Ze.runActions(b.actions),b.miniGame){console.log("Запуск мини-игры:",b.miniGame.id),L(i,{gameId:b.miniGame.id,onWinDialogueId:b.miniGame.onWinDialogueId,onLoseDialogueId:b.miniGame.onLoseDialogueId,rewardItem:b.miniGame.rewardItem},!0);return}b.nextDialogueId&&Ze.goToDialogue(b.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),c(i)?.rewardItem&&Ze.addItem(c(i).rewardItem),c(i)?.onWinDialogueId&&Ze.goToDialogue(c(i).onWinDialogueId),L(i,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),c(i)?.onLoseDialogueId&&Ze.goToDialogue(c(i).onLoseDialogueId),L(i,null)}function p(b){return b.visible===!1?!1:Ze.checkVisibilityCondition(b)}function v(b){return b.enabled!==!1}var _=dt(),w=He(_);{var E=b=>{var T=t_(),R=S(T);{var N=ne=>{{let me=kt(()=>Ze.storyData?.items);Gg(ne,{get gameId(){return c(i).gameId},onWin:u,onLose:h,get rewardItem(){return c(i).rewardItem},get items(){return c(me)},get bucketName(){return t()}})}};ye(R,ne=>{c(i)&&ne(N)})}var $=A(R,2);{var F=ne=>{var me=Kg(),te=S(me);{var q=P=>{var D=dt(),Z=He(D);Ea(Z,()=>c(n).backgroundImage,ie=>{Wl(ie,{get fileName(){return c(n).backgroundImage},get bucketName(){return t()}})}),O(P,D)},ee=P=>{var D=Hg();be(()=>Ve(D,"src",`${Na}/storage/v1/object/public/${t()}/${c(n).backgroundImage}`)),O(P,D)};ye(te,P=>{c(n).backgroundImage.endsWith(".riv")?P(q):P(ee,!1)})}O(ne,me)};ye($,ne=>{c(n).backgroundImage&&ne(F)})}var z=A($,2);{var K=ne=>{var me=Jg(),te=S(me);{var q=P=>{var D=dt(),Z=He(D);Ea(Z,()=>c(n).characterImage,ie=>{Wl(ie,{get fileName(){return c(n).characterImage},get bucketName(){return t()}})}),O(P,D)},ee=P=>{var D=Yg();be(()=>Ve(D,"src",`${Na}/storage/v1/object/public/${t()}/${c(n).characterImage}`)),O(P,D)};ye(te,P=>{c(n).characterImage.endsWith(".riv")?P(q):P(ee,!1)})}O(ne,me)};ye(z,ne=>{c(n).characterImage&&ne(K)})}var C=A(z,2),x=S(C),J=S(x),X=A(x,2);{var he=ne=>{var me=Zg();rt(me,21,()=>c(n).options,te=>te.text,(te,q)=>{var ee=dt(),P=He(ee);{var D=Z=>{var ie=Qg();let ge;ie.__click=[Xg,o,q];var _e=S(ie);be((ke,Ae)=>{ge=Nt(ie,1,"option-button svelte-fl90wm",null,ge,ke),ie.disabled=Ae,pe(_e,c(q).text)},[()=>({disabled:!v(c(q))}),()=>!v(c(q))]),O(Z,ie)};ye(P,Z=>{p(c(q))&&Z(D)})}O(te,ee)}),O(ne,me)},re=ne=>{var me=dt(),te=He(me);{var q=ee=>{var P=e_(),D=S(P);D.__click=[zg,n],O(ee,P)};ye(te,ee=>{c(n).nextDialogueId&&ee(q)},!0)}O(ne,me)};ye(X,ne=>{c(n).options&&c(n).options.length>0?ne(he):ne(re,!1)})}be(()=>pe(J,c(n).text)),O(b,T)},g=b=>{var T=r_(),R=S(T);be(()=>pe(R,`Диалог не найден (ID: ${Ze.currentDialogueId??""})`)),O(b,T)};ye(w,b=>{c(n)?b(E):b(g,!1)})}O(r,_),Ot()}Dt(["click"]);var ma=pi(()=>W),n_=V('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),i_=V('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),s_=V('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),a_=V('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),o_=V('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),l_=V('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),u_=V('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function c_(r,e){Rt(e,!1);function t(){ma(ma().editingOptionIndex=null)}Bi();var n=u_(),i=S(n),o=A(S(i),2);o.__click=t;var u=A(i,2),h=S(u);{var p=_=>{var w=o_(),E=S(w);Ju(E,{get dialogue(){return Zt.currentDialogue},index:0,get bucketName(){return ma().selectedBucket}});var g=A(E,2),b=S(g),T=A(S(b),2),R=S(T),N=A(b,2),$=A(S(N),2),F=S($),z=A(N,2);{var K=ne=>{var me=n_(),te=A(S(me),2),q=S(te);be(()=>pe(q,Zt.currentDialogue.backgroundImage)),O(ne,me)};ye(z,ne=>{Zt.currentDialogue.backgroundImage&&ne(K)})}var C=A(z,2);{var x=ne=>{var me=i_(),te=A(S(me),2),q=S(te);be(()=>pe(q,Zt.currentDialogue.characterImage)),O(ne,me)};ye(C,ne=>{Zt.currentDialogue.characterImage&&ne(x)})}var J=A(g,2);{var X=ne=>{var me=s_();O(ne,me)};ye(J,ne=>{(!Zt.currentDialogue.options||Zt.currentDialogue.options.length===0)&&ne(X)})}var he=A(J,2);{var re=ne=>{var me=a_();O(ne,me)};ye(he,ne=>{Zt.currentDialogue.options?.some(me=>!me.nextDialogueId)&&ne(re)})}be(()=>{pe(R,Zt.currentDialogue.id),pe(F,Zt.currentChapter?.title||"Без главы")}),O(_,w)},v=_=>{var w=l_();O(_,w)};ye(h,_=>{Zt.currentDialogue?_(p):_(v,!1)})}O(r,n),Ot()}Dt(["click"]);const d_=["dracula","zombie","fairy_tale","minigames"];function Xu(){const r=d_.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return Et.updateBucketsList(r),r}async function f_(r,e,t,n,i,o){if(!c(e).trim())return;L(t,!0);const u=await xp(c(e).trim(),c(n));u.success&&u.story?(L(i,!1),L(e,""),L(n,"stories"),await o(u.story)):alert(u.error||"Ошибка создания истории"),L(t,!1)}var h_=(r,e)=>L(e,!0),v_=(r,e,t)=>e(c(t)),p_=(r,e,t)=>e(c(t)),g_=(r,e,t)=>e(c(t)),__=V('<div class="story-card author-card svelte-1tegylr"><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <span> </span></div> <div class="story-actions svelte-1tegylr"><button class="btn small svelte-1tegylr">Открыть</button> <button class="btn small svelte-1tegylr"> </button> <button class="btn small danger svelte-1tegylr">✕</button></div></div>'),m_=V('<div class="stories-section svelte-1tegylr"><div class="stories-grid svelte-1tegylr"></div></div>'),y_=V('<p class="empty-text svelte-1tegylr">У вас пока нет историй. Создайте первую!</p>'),b_=V("<p>Загрузка историй...</p>"),w_=V('<span class="selected-badge svelte-1tegylr">Выбрано</span>'),k_=(r,e,t)=>e(c(t).name),S_=V('<button class="btn small svelte-1tegylr">Выбрать</button>'),I_=V('<div><div class="story-icon svelte-1tegylr"> </div> <div class="story-content svelte-1tegylr"><h4 class="svelte-1tegylr"> </h4> <p class="svelte-1tegylr"> </p></div> <div class="story-actions svelte-1tegylr"><!></div></div>'),E_=V('<div class="selector-header svelte-1tegylr"><h2 class="svelte-1tegylr">📝 Мои истории</h2> <button class="btn btn-primary svelte-1tegylr">+ Создать историю</button></div> <!> <div class="stories-section svelte-1tegylr"><h3 class="svelte-1tegylr">📚 Архивные истории</h3> <div class="stories-grid svelte-1tegylr"></div></div>',1),A_=V('<div class="access-denied svelte-1tegylr"><h2 class="svelte-1tegylr">🔒 Доступ запрещён</h2> <p class="svelte-1tegylr">Редактирование историй доступно только авторам и администраторам.</p> <p class="svelte-1tegylr">Станьте автором, чтобы создавать и редактировать истории.</p></div>'),C_=(r,e)=>L(e,!1),j_=r=>r.stopPropagation(),x_=(r,e)=>L(e,!1),T_=V('<div class="modal-overlay svelte-1tegylr" role="dialog"><div class="modal svelte-1tegylr"><h3 class="svelte-1tegylr">Создать новую историю</h3> <div class="form-group svelte-1tegylr"><label for="story-title" class="svelte-1tegylr">Название истории</label> <input type="text" id="story-title" placeholder="Например: Приключения в замке" class="input svelte-1tegylr"/></div> <div class="form-group svelte-1tegylr"><label for="story-bucket" class="svelte-1tegylr">Bucket для ресурсов</label> <select id="story-bucket" class="input svelte-1tegylr"><option>stories (по умолчанию)</option><option>dracula</option><option>zombie</option><option>fairy_tale</option><option>minigames</option></select> <small class="hint svelte-1tegylr">Выберите bucket в котором будут храниться ресурсы истории</small></div> <div class="modal-actions svelte-1tegylr"><button class="btn svelte-1tegylr">Отмена</button> <button class="btn primary svelte-1tegylr"> </button></div></div></div>'),P_=V('<div class="story-selector svelte-1tegylr"><!></div> <!>',1);function R_(r,e){Rt(e,!0);let t=we(!1),n=we(""),i=we("stories"),o=we(!1);const u={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр",icon:"🎮"}};or(async()=>{await Vi(),Xu()});async function h($){W.selectedBucket=$,W.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},await Yr.loadStoriesList(),await Yr.loadStoredResources()}async function p($){W.manualStorySelected=!0;const F=$.bucket||"stories";W.selectedBucket=F,W.currentFileName=$.json_url,await Yr.loadStoredResources(),await jr.loadStory(W.currentFileName)}async function v($){await Tp($.id,{is_public:!$.is_public})}async function _($){confirm(`Удалить историю "${$.title}"?`)&&await Pp($.id)}var w=P_(),E=He(w),g=S(E);{var b=$=>{var F=E_(),z=He(F),K=A(S(z),2);K.__click=[h_,t];var C=A(z,2);{var x=re=>{var ne=dt(),me=He(ne);{var te=ee=>{var P=m_(),D=S(P);rt(D,21,Nl,Z=>Z.id,(Z,ie)=>{var ge=__(),_e=S(ge),ke=S(_e),Ae=A(_e,2),Ne=S(Ae),ae=S(Ne),se=A(Ne,2);let Q;var ue=S(se),le=A(Ae,2),de=S(le);de.__click=[v_,p,ie];var ve=A(de,2);ve.__click=[p_,v,ie];var Ce=S(ve),Pe=A(ve,2);Pe.__click=[g_,_,ie],be(ce=>{pe(ke,c(ie).preview_image_url?"🖼️":"📖"),pe(ae,c(ie).title),Q=Nt(se,1,"story-status svelte-1tegylr",null,Q,ce),pe(ue,c(ie).is_public?"🌍 Публичная":"🔒 Приватная"),pe(Ce,c(ie).is_public?"Скрыть":"Опубликовать")},[()=>({public:c(ie).is_public})]),O(Z,ge)}),O(ee,P)},q=ee=>{var P=y_();O(ee,P)};ye(me,ee=>{Nl().length>0?ee(te):ee(q,!1)})}O(re,ne)},J=re=>{var ne=b_();O(re,ne)};ye(C,re=>{zr.initialized?re(x):re(J,!1)})}var X=A(C,2),he=A(S(X),2);rt(he,21,()=>W.availableBuckets,re=>re.name,(re,ne)=>{const me=kt(()=>u[c(ne).id]||{title:c(ne).name,description:"История",icon:"📖"});var te=I_();let q;var ee=S(te),P=S(ee),D=A(ee,2),Z=S(D),ie=S(Z),ge=A(Z,2),_e=S(ge),ke=A(D,2),Ae=S(ke);{var Ne=se=>{var Q=w_();O(se,Q)},ae=se=>{var Q=S_();Q.__click=[k_,h,ne],O(se,Q)};ye(Ae,se=>{W.selectedBucket===c(ne).name?se(Ne):se(ae,!1)})}be(se=>{q=Nt(te,1,"story-card svelte-1tegylr",null,q,se),pe(P,c(me).icon),pe(ie,c(me).title),pe(_e,c(me).description)},[()=>({selected:W.selectedBucket===c(ne).name})]),O(re,te)}),O($,F)},T=$=>{var F=A_();O($,F)};ye(g,$=>{$i.isAuthor||$i.isAdmin?$(b):$(T,!1)})}var R=A(E,2);{var N=$=>{var F=T_();F.__click=[C_,t];var z=S(F);z.__click=[j_];var K=A(S(z),2),C=A(S(K),2),x=A(K,2),J=A(S(x),2),X=S(J);X.value=X.__value="stories";var he=A(X);he.value=he.__value="dracula";var re=A(he);re.value=re.__value="zombie";var ne=A(re);ne.value=ne.__value="fairy_tale";var me=A(ne);me.value=me.__value="minigames";var te=A(x,2),q=S(te);q.__click=[x_,t];var ee=A(q,2);ee.__click=[f_,n,o,i,t,p];var P=S(ee);be(D=>{ee.disabled=D,pe(P,c(o)?"Создание...":"Создать")},[()=>c(o)||!c(n).trim()]),nr(C,()=>c(n),D=>L(n,D)),An(J,()=>c(i),D=>L(i,D)),O($,F)};ye(R,$=>{c(t)&&$(N)})}O(r,w),Ot()}Dt(["click"]);var O_=V("<span> </span>"),M_=V('<div class="debug-info svelte-1o87bfp"><small> </small></div>'),L_=V('<div class="debug-info warning svelte-1o87bfp"><small>⚠️ Данные не загружены</small></div>'),D_=V('<div class="empty-state svelte-1o87bfp">Выберите сцену</div>'),F_=V('<div class="editor-container svelte-1o87bfp"><header class="toolbar svelte-1o87bfp"><div class="logo svelte-1o87bfp"><h2 class="svelte-1o87bfp"> </h2></div> <div class="stories-control svelte-1o87bfp"><span class="story-file-name svelte-1o87bfp"> </span> <!> <button class="btn success small svelte-1o87bfp">💾 Сохранить</button> <button class="btn small svelte-1o87bfp">📋 Копия</button></div></header> <div class="main-workspace svelte-1o87bfp"><!> <main class="editor-area svelte-1o87bfp"><!> <!> <!></main> <!></div> <button class="btn-back-to-game svelte-1o87bfp" title="Выбрать другую историю">📚 Выбрать историю</button></div>');function $_(r,e){Rt(e,!0);async function t(p){console.log(`[Editor] Загрузка для bucket: ${p}`);try{const v=Yr.loadStoredResources(),_=new Promise((b,T)=>setTimeout(()=>T(new Error("Timeout loading resources")),15e3));await Promise.race([v,_]);const w=`${p}_story.json`;W.currentFileName=w;const E=jr.loadStory(w),g=new Promise((b,T)=>setTimeout(()=>T(new Error("Timeout loading story")),15e3));await Promise.race([E,g]),console.log(`[Editor] История загружена: ${w}`)}catch(v){console.error("[Editor] Ошибка загрузки истории:",v)}}or(async()=>{Xu(),W.availableBuckets.length>0&&!W.selectedBucket&&(W.selectedBucket=W.availableBuckets[0].name,await t(W.selectedBucket))}),Tn(()=>{W.selectedBucket&&!W.manualStorySelected&&t(W.selectedBucket)});function n(){W.manualStorySelected=!1,W.selectedBucket=null,W.currentFileName="",W.data=null}var i=dt(),o=He(i);{var u=p=>{R_(p,{})},h=p=>{var v=F_(),_=S(v),w=S(_),E=S(w),g=S(E),b=A(w,2),T=S(b),R=S(T),N=A(T,2);{var $=P=>{var D=O_(),Z=S(D);be(()=>{Nt(D,1,`status-message ${W.statusMessage.type??""}`,"svelte-1o87bfp"),pe(Z,W.statusMessage.text)}),O(P,D)};ye(N,P=>{W.statusMessage.text&&P($)})}var F=A(N,2);F.__click=function(...P){jr.saveCurrentStory?.apply(this,P)};var z=A(F,2);z.__click=function(...P){jr.saveStoryCopy?.apply(this,P)};var K=A(_,2),C=S(K);gv(C,{});var x=A(C,2),J=S(x);{var X=P=>{var D=M_(),Z=S(D),ie=S(Z);be(()=>pe(ie,`Загружено: ${W.data.meta?.title??""} |
              Глав: ${(W.data.chapters?.length||0)??""} |
              Диалогов: ${(W.data.dialogues?.length||0)??""} |
              Предметов: ${(W.data.items?.length||0)??""}`)),O(P,D)},he=P=>{var D=L_();O(P,D)};ye(J,P=>{W.data?P(X):P(he,!1)})}var re=A(J,2);gp(re,{});var ne=A(re,2);{var me=P=>{ip(P,{get editor(){return W},get storyActions(){return jr},get resourceActions(){return Yr}})},te=P=>{var D=D_();O(P,D)};ye(ne,P=>{Zt.currentDialogue?P(me):P(te,!1)})}var q=A(x,2);c_(q,{});var ee=A(K,2);ee.__click=n,be(()=>{pe(g,`Story Editor v3.1 - ${W.selectedBucket??""}`),pe(R,W.currentFileName||"Нет файла")}),O(p,v)};ye(o,p=>{W.selectedBucket?p(h,!1):p(u)})}O(r,i),Ot()}Dt(["click"]);var U_=V('<div class="loading svelte-1qisd0r">Загрузка историй...</div>'),N_=V('<div class="empty-state svelte-1qisd0r"><p class="svelte-1qisd0r">Историй пока нет</p> <p class="hint svelte-1qisd0r">Создайте свою историю в редакторе!</p></div>'),B_=(r,e,t)=>e(c(t)),W_=(r,e,t)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e(c(t)))},q_=V('<div class="story-card svelte-1qisd0r" role="button" tabindex="0"><div class="story-icon svelte-1qisd0r"> </div> <div class="story-content svelte-1qisd0r"><h3 class="story-title svelte-1qisd0r"> </h3> <p class="story-description svelte-1qisd0r"> </p></div> <div class="story-arrow svelte-1qisd0r">→</div></div>'),V_=V('<div class="stories-grid svelte-1qisd0r"></div>'),G_=V('<div class="selector-header svelte-1qisd0r"><h1 class="svelte-1qisd0r">🎭 Визуальные новеллы</h1> <p class="svelte-1qisd0r">Выберите историю для прохождения</p></div> <!> <div class="selector-footer svelte-1qisd0r"><p class="hint svelte-1qisd0r">💡 Совет: Вы можете создать свою историю в редакторе</p></div>',1),z_=V('<div class="story-selector svelte-1qisd0r"><!></div>');function H_(r,e){Rt(e,!0);let t=we(!0),n=we(!1);or(async()=>{if(console.log("[StorySelector] Инициализация..."),await Ze.initStories(),console.log("[StorySelector] Истории загружены:",{initialized:zr.initialized,count:zr.stories.length,available:Hu().length,urlStoryId:Ze.urlStoryId}),Ze.urlStoryId&&Ze.selectedStoryData&&!c(n)){L(n,!0);const _=await Ku(Ze.selectedStoryData);_&&(Ze.storyData=_,Ze.currentDialogueId=_.dialogues?.[0]?.id||"0",Ze.isLoading=!1)}L(t,!1)});const i={dracula:"🧛",zombie:"🧟",fairy_tale:"🧚",minigames:"🎮"};function o(_){Ze.selectedStory=_.id,Ze.selectedStoryData=_}var u=z_(),h=S(u);{var p=_=>{var w=U_();O(_,w)},v=_=>{var w=G_(),E=A(He(w),2);{var g=T=>{var R=N_();O(T,R)},b=T=>{var R=V_();rt(R,21,()=>Ze.availableStories,N=>N.id,(N,$)=>{const F=kt(()=>i[c($).title.toLowerCase()]||"📖");var z=q_();z.__click=[B_,o,$],z.__keydown=[W_,o,$];var K=S(z),C=S(K),x=A(K,2),J=S(x),X=S(J),he=A(J,2),re=S(he);be(()=>{pe(C,c(F)),pe(X,c($).title),pe(re,c($).preview_image_url?"Нажмите для начала":"Интерактивная история")}),O(N,z)}),O(T,R)};ye(E,T=>{Ze.availableStories.length===0?T(g):T(b,!1)})}O(_,w)};ye(h,_=>{c(t)?_(p):_(v,!1)})}O(r,u),Ot()}Dt(["click","keydown"]);var K_=V('<span class="inventory-badge svelte-166jaas"> </span>'),Y_=(r,e)=>r.key==="Escape"&&e(),J_=r=>r.stopPropagation(),X_=r=>r.stopPropagation(),Q_=(r,e,t)=>e(c(t)),Z_=V('<button type="button" class="item-card svelte-166jaas"><div class="item-icon svelte-166jaas"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-166jaas"><span class="item-name svelte-166jaas"> </span> <span class="item-type svelte-166jaas"> </span></div></button>'),em=V('<div class="items-grid svelte-166jaas"></div>'),tm=V('<div class="empty-inventory svelte-166jaas"><span class="empty-icon svelte-166jaas">🎒</span> <p class="svelte-166jaas">Инвентарь пуст</p> <p class="empty-hint svelte-166jaas">Получайте предметы в ходе игры</p></div>'),rm=V('<div class="inventory-overlay svelte-166jaas" role="dialog" tabindex="-1"><div class="inventory-modal svelte-166jaas" role="dialog" aria-label="Окно инвентаря" tabindex="-1"><div class="inventory-header svelte-166jaas"><h2 class="svelte-166jaas">Инвентарь</h2> <button class="close-button svelte-166jaas">✕</button></div> <div class="stats-section svelte-166jaas"><h3 class="svelte-166jaas">Характеристики</h3> <div class="stats-grid svelte-166jaas"><div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">📚</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Знания</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">💪</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Смелость</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">✨</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Харизма</span> <span class="stat-value svelte-166jaas"> </span></div></div></div></div> <div class="items-section svelte-166jaas"><h3 class="svelte-166jaas"> </h3> <!></div></div></div>'),nm=V('<div class="inventory-wrapper svelte-166jaas"><button class="inventory-button svelte-166jaas">🎒 <!></button> <!></div>');function im(r,e){Rt(e,!0);let t=we(!1);const n=kt(()=>Ze.getInventoryItems()),i=kt(()=>Ze.player.stats);function o(){L(t,!c(t))}function u(g){console.log("Выбран предмет:",g.name)}var h=nm(),p=S(h);p.__click=o;var v=A(S(p));{var _=g=>{var b=K_(),T=S(b);be(()=>pe(T,c(n).length)),O(g,b)};ye(v,g=>{c(n).length>0&&g(_)})}var w=A(p,2);{var E=g=>{var b=rm();b.__click=o,b.__keydown=[Y_,o];var T=S(b);T.__click=[J_],T.__keydown=[X_];var R=S(T),N=A(S(R),2);N.__click=o;var $=A(R,2),F=A(S($),2),z=S(F),K=A(S(z),2),C=A(S(K),2),x=S(C),J=A(z,2),X=A(S(J),2),he=A(S(X),2),re=S(he),ne=A(J,2),me=A(S(ne),2),te=A(S(me),2),q=S(te),ee=A($,2),P=S(ee),D=S(P),Z=A(P,2);{var ie=_e=>{var ke=em();rt(ke,21,()=>c(n),Ae=>Ae.id,(Ae,Ne)=>{var ae=Z_();ae.__click=[Q_,u,Ne];var se=S(ae),Q=S(se),ue=A(se,2),le=S(ue),de=S(le),ve=A(le,2),Ce=S(ve);be(()=>{Ve(ae,"aria-label",`Предмет: ${c(Ne).name}`),Ve(Q,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Ze.selectedStory}/${c(Ne).icon}`),Ve(Q,"alt",c(Ne).icon),pe(de,c(Ne).name),pe(Ce,c(Ne).type)}),O(Ae,ae)}),O(_e,ke)},ge=_e=>{var ke=tm();O(_e,ke)};ye(Z,_e=>{c(n).length>0?_e(ie):_e(ge,!1)})}be(()=>{pe(x,c(i).knowledge),pe(re,c(i).courage),pe(q,c(i).charisma),pe(D,`Предметы (${c(n).length??""})`)}),O(g,b)};ye(w,g=>{c(t)&&g(E)})}be(()=>Ve(p,"title",`Инвентарь (${c(n).length??""})`)),O(r,h),Ot()}Dt(["click","keydown"]);function sm(r,e){if(!c(e)){alert("Редактирование недоступно без интернета");return}Et.toggleEditor()}var am=V('<div class="loading svelte-wkbazt"><p>🔄 Загрузка истории...</p></div>'),om=V('<div class="error svelte-wkbazt"> <button class="btn-back svelte-wkbazt">← Вернуться к выбору</button></div>'),lm=V('<button class="btn-edit desktop-only svelte-wkbazt" title="Редактор историй">✏️ Редактор</button>'),um=V('<div class="game-container svelte-wkbazt"><!> <button class="btn-change-story svelte-wkbazt" title="Сменить историю">📚</button> <!> <div class="dialogues-container svelte-wkbazt"><!></div></div>'),cm=V('<div class="app svelte-wkbazt"><!></div>');function dm(r,e){Rt(e,!0);let t=we(!0),n=we(!1);or(async()=>{L(t,navigator.onLine,!0);const p=()=>{L(t,!0)},v=()=>{L(t,!1)};return window.addEventListener("online",p),window.addEventListener("offline",v),await Ze.initStories(),L(n,!0),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",v)}}),Tn(async()=>{if(c(n)&&Ze.selectedStory&&Ze.selectedStoryData){const p=Ze.selectedStoryData;console.log("[Main] Загрузка истории:",p.title);const v=await Ku(p);v?(Ze.storyData=v,Ze.currentDialogueId=v.dialogues?.[0]?.id||"0",Ze.isLoading=!1,console.log("[Main] История загружена, диалогов:",v.dialogues?.length)):(Ze.error="Не удалось загрузить историю",Ze.isLoading=!1)}});var i=cm(),o=S(i);{var u=p=>{H_(p,{})},h=p=>{var v=dt(),_=He(v);{var w=g=>{var b=am();O(g,b)},E=g=>{var b=dt(),T=He(b);{var R=$=>{var F=om(),z=S(F),K=A(z);K.__click=()=>Ze.selectedStory=null,be(()=>pe(z,`⚠️ ${Ze.error??""} `)),O($,F)},N=$=>{var F=um(),z=S(F);im(z,{});var K=A(z,2);K.__click=()=>{Ze.selectedStory=null,Ze.selectedStoryData=null,Ze.storyData=null};var C=A(K,2);{var x=re=>{var ne=lm();ne.__click=[sm,t],O(re,ne)};ye(C,re=>{ar.user&&c(t)&&re(x)})}var J=A(C,2),X=S(J);{var he=re=>{{let ne=kt(()=>Ze.selectedStoryData?.bucket||"stories");Ju(re,{get bucketName(){return c(ne)}})}};ye(X,re=>{Ze.storyData&&re(he)})}O($,F)};ye(T,$=>{Ze.error?$(R):$(N,!1)},!0)}O(g,b)};ye(_,g=>{Ze.isLoading?g(w):g(E,!1)},!0)}O(p,v)};ye(o,p=>{Ze.selectedStory?p(h,!1):p(u)})}O(r,i),Ot()}Dt(["click"]);var fm=(r,e)=>r.key==="Escape"&&e.onClose?.(),hm=r=>r.stopPropagation(),vm=r=>r.stopPropagation(),pm=V('<div class="alert error svelte-961h07"><strong>⚠️</strong> </div>'),gm=V('<div class="alert success svelte-961h07"><strong>✅</strong> </div>'),_m=V('<div class="form-group svelte-961h07"><label for="username" class="svelte-961h07">Имя пользователя</label> <input type="text" id="username" placeholder="Придумайте имя" required class="svelte-961h07"/></div>'),mm=(r,e,t)=>e(c(t)),ym=V('<span class="field-error svelte-961h07"> </span>'),bm=(r,e,t)=>e(c(t)),wm=V('<span class="field-error svelte-961h07"> </span>'),km=V('<small class="hint svelte-961h07">Минимум 6 символов</small>'),Sm=V('<div class="form-group svelte-961h07"><label for="password" class="svelte-961h07">Пароль</label> <input type="password" id="password" placeholder="Введите пароль" required minlength="6"/> <!> <!></div>'),Im=(r,e)=>e("reset"),Em=(r,e)=>e("register"),Am=V('<button type="button" class="link-btn svelte-961h07">Забыли пароль?</button> <button type="button" class="link-btn svelte-961h07">Нет аккаунта? Регистрация</button>',1),Cm=(r,e)=>e("login"),jm=V('<button type="button" class="link-btn svelte-961h07">Уже есть аккаунт? Войти</button>'),xm=(r,e)=>e("login"),Tm=V('<button type="button" class="link-btn svelte-961h07">Вспомнили пароль? Войти</button>'),Pm=V('<div class="debug-info svelte-961h07"><details><summary class="svelte-961h07">🔧 Отладка</summary> <p> </p> <p> </p> <p>Статус: Попробуйте:</p> <ul class="svelte-961h07"><li>Проверить подтвержден ли email в Supabase Dashboard</li> <li>Сбросить пароль через "Забыли пароль?"</li> <li>Проверить консоль браузера (F12)</li></ul></details></div>'),Rm=V('<div class="auth-modal-overlay svelte-961h07" role="dialog" aria-modal="true" tabindex="-1"><div class="auth-modal svelte-961h07" role="document"><button class="close-btn svelte-961h07" aria-label="Закрыть">×</button> <h2 class="svelte-961h07"><!></h2> <!> <!> <form><!> <div class="form-group svelte-961h07"><label for="email" class="svelte-961h07">Email</label> <input type="email" id="email" placeholder="your@email.com" required/> <!></div> <!> <button type="submit" class="btn-primary svelte-961h07"><!></button></form> <div class="auth-links svelte-961h07"><!></div> <!></div></div>');function Om(r,e){Rt(e,!0);let t=Ye(e,"initialMode",3,"login"),n=we(ht(t())),i=we(""),o=we(""),u=we(""),h=we(""),p=we(""),v=we(!1),_=we(""),w=we("");function E(ce){L(n,ce,!0),L(h,""),L(p,""),L(_,""),L(w,"")}function g(ce){const je=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ce);return L(_,je?"":"Введите корректный email",!0),je}function b(ce){const Ie=ce.length>=6;return L(w,Ie?"":"Пароль должен быть не менее 6 символов",!0),Ie}async function T(){if(!(!g(c(i))||!b(c(o)))){L(h,""),L(p,""),L(v,!0);try{const ce=await Ip(c(i),c(o));ce.success?e.onClose?.():(L(h,ce.error||"Ошибка входа",!0),c(h).includes("подтвержден")&&setTimeout(()=>{confirm("Отправить письмо с подтверждением повторно?")&&R()},100))}finally{L(v,!1)}}}async function R(){L(v,!0);try{const{error:ce}=await xt.auth.resend({type:"signup",email:c(i)});ce?L(h,"Ошибка при отправке: "+ce.message):L(p,"Письмо с подтверждением отправлено повторно!")}catch(ce){L(h,ce.message,!0)}finally{L(v,!1)}}async function N(){if(!(!g(c(i))||!b(c(o)))){if(!c(u).trim()){L(h,"Введите имя пользователя");return}L(h,""),L(p,""),L(v,!0);try{const ce=await Ap(c(i),c(o),c(u));ce.success?ce.needsEmailConfirmation?L(p,"✅ Регистрация почти завершена! Проверьте почту и подтвердите email."):(L(p,"Регистрация успешна!"),setTimeout(()=>e.onClose?.(),2e3)):L(h,ce.error||"Ошибка регистрации",!0)}finally{L(v,!1)}}}async function $(){if(g(c(i))){L(h,""),L(p,""),L(v,!0);try{const ce=await Cp(c(i));ce.success?L(p,"📧 Инструкции по сбросу пароля отправлены на почту!"):L(h,ce.error||"Ошибка сброса пароля",!0)}finally{L(v,!1)}}}async function F(){c(n)==="login"?await T():c(n)==="register"?await N():c(n)==="reset"&&await $()}var z=Rm();z.__click=function(...ce){e.onClose?.apply(this,ce)},z.__keydown=[fm,e];var K=S(z);K.__click=[hm],K.__keydown=[vm];var C=S(K);C.__click=function(...ce){e.onClose?.apply(this,ce)};var x=A(C,2),J=S(x);{var X=ce=>{var Ie=Ar("Вход");O(ce,Ie)},he=ce=>{var Ie=dt(),je=He(Ie);{var $e=Ge=>{var Ke=Ar("Регистрация");O(Ge,Ke)},qe=Ge=>{var Ke=Ar("Сброс пароля");O(Ge,Ke)};ye(je,Ge=>{c(n)==="register"?Ge($e):Ge(qe,!1)},!0)}O(ce,Ie)};ye(J,ce=>{c(n)==="login"?ce(X):ce(he,!1)})}var re=A(x,2);{var ne=ce=>{var Ie=pm(),je=A(S(Ie));be(()=>pe(je,` ${c(h)??""}`)),O(ce,Ie)};ye(re,ce=>{c(h)&&ce(ne)})}var me=A(re,2);{var te=ce=>{var Ie=gm(),je=A(S(Ie));be(()=>pe(je,` ${c(p)??""}`)),O(ce,Ie)};ye(me,ce=>{c(p)&&ce(te)})}var q=A(me,2),ee=S(q);{var P=ce=>{var Ie=_m(),je=A(S(Ie),2);be(()=>je.disabled=c(v)),nr(je,()=>c(u),$e=>L(u,$e)),O(ce,Ie)};ye(ee,ce=>{c(n)==="register"&&ce(P)})}var D=A(ee,2),Z=A(S(D),2);Z.__input=[mm,g,i];let ie;var ge=A(Z,2);{var _e=ce=>{var Ie=ym(),je=S(Ie);be(()=>pe(je,c(_))),O(ce,Ie)};ye(ge,ce=>{c(_)&&ce(_e)})}var ke=A(D,2);{var Ae=ce=>{var Ie=Sm(),je=A(S(Ie),2);je.__input=[bm,b,o];let $e;var qe=A(je,2);{var Ge=Xe=>{var y=wm(),l=S(y);be(()=>pe(l,c(w))),O(Xe,y)};ye(qe,Xe=>{c(w)&&Xe(Ge)})}var Ke=A(qe,2);{var _t=Xe=>{var y=km();O(Xe,y)};ye(Ke,Xe=>{c(n)==="register"&&Xe(_t)})}be(Xe=>{je.disabled=c(v),$e=Nt(je,1,"svelte-961h07",null,$e,Xe)},[()=>({error:c(w)})]),nr(je,()=>c(o),Xe=>L(o,Xe)),O(ce,Ie)};ye(ke,ce=>{c(n)!=="reset"&&ce(Ae)})}var Ne=A(ke,2),ae=S(Ne);{var se=ce=>{var Ie=Ar("Загрузка...");O(ce,Ie)},Q=ce=>{var Ie=dt(),je=He(Ie);{var $e=Ge=>{var Ke=Ar("Войти");O(Ge,Ke)},qe=Ge=>{var Ke=dt(),_t=He(Ke);{var Xe=l=>{var f=Ar("Зарегистрироваться");O(l,f)},y=l=>{var f=Ar("Отправить");O(l,f)};ye(_t,l=>{c(n)==="register"?l(Xe):l(y,!1)},!0)}O(Ge,Ke)};ye(je,Ge=>{c(n)==="login"?Ge($e):Ge(qe,!1)},!0)}O(ce,Ie)};ye(ae,ce=>{c(v)?ce(se):ce(Q,!1)})}var ue=A(q,2),le=S(ue);{var de=ce=>{var Ie=Am(),je=He(Ie);je.__click=[Im,E];var $e=A(je,2);$e.__click=[Em,E],be(()=>{je.disabled=c(v),$e.disabled=c(v)}),O(ce,Ie)},ve=ce=>{var Ie=dt(),je=He(Ie);{var $e=Ge=>{var Ke=jm();Ke.__click=[Cm,E],be(()=>Ke.disabled=c(v)),O(Ge,Ke)},qe=Ge=>{var Ke=Tm();Ke.__click=[xm,E],be(()=>Ke.disabled=c(v)),O(Ge,Ke)};ye(je,Ge=>{c(n)==="register"?Ge($e):Ge(qe,!1)},!0)}O(ce,Ie)};ye(le,ce=>{c(n)==="login"?ce(de):ce(ve,!1)})}var Ce=A(ue,2);{var Pe=ce=>{var Ie=Pm(),je=S(Ie),$e=A(S(je),2),qe=S($e),Ge=A($e,2),Ke=S(Ge);be(()=>{pe(qe,`Email: ${c(i)??""}`),pe(Ke,`Длина пароля: ${c(o).length??""}`)}),O(ce,Ie)};ye(Ce,ce=>{c(n)==="login"&&c(h)&&ce(Pe)})}be(ce=>{Z.disabled=c(v),ie=Nt(Z,1,"svelte-961h07",null,ie,ce),Ne.disabled=c(v)||c(n)==="login"&&(!c(i)||!c(o))||c(n)==="register"&&(!c(i)||!c(o)||!c(u))||c(n)==="reset"&&!c(i)},[()=>({error:c(_)})]),Cs("submit",q,ce=>{ce.preventDefault(),F()}),nr(Z,()=>c(i),ce=>L(i,ce)),O(r,z),Ot()}Dt(["click","keydown","input"]);var Mm=V('<span class="author-badge svelte-18xh1i2">Автор</span>'),Lm=V('<div class="user-info svelte-18xh1i2"><span class="user-email svelte-18xh1i2"> </span> <!> <button>Выйти</button></div>'),Dm=(r,e)=>L(e,!0),Fm=V("<button>Войти</button>"),$m=V('<div class="user-menu svelte-18xh1i2"><!> <!></div>');function Um(r,e){Rt(e,!0);let t=we(!1);var n=$m(),i=S(n);{var o=v=>{var _=Lm(),w=S(_),E=S(w),g=A(w,2);{var b=R=>{var N=Mm();O(R,N)};ye(g,R=>{$i.isAuthor&&R(b)})}var T=A(g,2);T.__click=function(...R){Ep?.apply(this,R)},be(()=>pe(E,ar.user?.email)),O(v,_)},u=v=>{var _=Fm();_.__click=[Dm,t],O(v,_)};ye(i,v=>{$i.isAuthenticated?v(o):v(u,!1)})}var h=A(i,2);{var p=v=>{Om(v,{onClose:()=>L(t,!1)})};ye(h,v=>{c(t)&&v(p)})}O(r,n),Ot()}Dt(["click"]);var Nm=V('<div class="success-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">✅</span> <p class="svelte-1kxwu1f"> </p> <p class="redirect svelte-1kxwu1f">Перенаправление...</p></div>'),Bm=V('<div class="error-message svelte-1kxwu1f"><span class="icon svelte-1kxwu1f">⚠️</span> <p> </p> <p class="hint svelte-1kxwu1f">Срок действия ссылки истёк. Запросите новую ссылку для сброса пароля.</p> <button class="btn secondary svelte-1kxwu1f">Вернуться</button></div>'),Wm=V('<div class="error-message svelte-1kxwu1f"> </div>'),qm=V('<div class="success-message-small svelte-1kxwu1f"> </div>'),Vm=V('<p class="description svelte-1kxwu1f">Для сброса пароля введите ваш email. Мы отправим вам ссылку для создания нового пароля.</p> <!> <!> <form><div class="form-group svelte-1kxwu1f"><label for="reset-email" class="svelte-1kxwu1f">Ваш email</label> <input type="email" id="reset-email" placeholder="your@email.com" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form> <div class="links"><button class="btn-link svelte-1kxwu1f">← На главную</button></div>',1),Gm=V('<div class="error-message svelte-1kxwu1f"> </div>'),zm=V('<p class="description svelte-1kxwu1f">Введите новый пароль для вашего аккаунта.</p> <!> <form><div class="form-group svelte-1kxwu1f"><label for="new-password" class="svelte-1kxwu1f">Новый пароль</label> <input type="password" id="new-password" placeholder="Минимум 6 символов" minlength="6" required class="svelte-1kxwu1f"/></div> <div class="form-group svelte-1kxwu1f"><label for="confirm-password" class="svelte-1kxwu1f">Подтвердите пароль</label> <input type="password" id="confirm-password" placeholder="Повторите пароль" minlength="6" required class="svelte-1kxwu1f"/></div> <button type="submit" class="btn-submit svelte-1kxwu1f"> </button></form>',1),Hm=V('<div class="reset-password-overlay svelte-1kxwu1f"><div class="reset-card svelte-1kxwu1f"><button class="close-btn svelte-1kxwu1f" aria-label="Закрыть">×</button> <h1 class="svelte-1kxwu1f">🔐 Сброс пароля</h1> <!></div></div>');function Km(r,e){Rt(e,!0);let t=Ye(e,"initialError",3,""),n=Ye(e,"initialToken",3,""),i=we(""),o=we(""),u=we(""),h=we(!1),p=we(""),v=we(ht(t())),_=we(!1),w=we(!1),E=we(!1);async function g(){if(c(E))return!0;try{console.log("[ResetPassword] Setting session from token");const{data:{session:C},error:x}=await xt.auth.getSession();if(x)return console.error("[ResetPassword] Session error:",x),!1;if(C)return console.log("[ResetPassword] Session already exists"),L(E,!0),!0;if(n()){console.log("[ResetPassword] Token provided, waiting for session..."),await new Promise(X=>setTimeout(X,1e3));const{data:{session:J}}=await xt.auth.getSession();if(J)return L(E,!0),!0}return!1}catch(C){return console.error("[ResetPassword] Error setting session:",C),!1}}or(async()=>{if(console.log("[ResetPassword] Mounted with:",{hasToken:!!n(),hasError:!!t(),path:window.location.pathname,hash:window.location.hash,search:window.location.search}),n()||window.location.pathname==="/reset-password"){const C=await g();L(w,C,!0),!C&&!t()&&L(v,"Ссылка для сброса пароля недействительна или истекла. Запросите новую.")}else t()&&(L(w,!1),L(v,t()))});async function b(){if(c(u)){L(h,!0),L(v,""),L(p,""),console.log("[ResetPassword] Sending reset to:",c(u));try{const{data:C,error:x}=await xt.auth.resetPasswordForEmail(c(u),{redirectTo:`${window.location.origin}/reset-password`});console.log("[ResetPassword] Response:",{data:C,error:x}),x?x.message?.toLowerCase().includes("rate limit")||x.message?.toLowerCase().includes("too many")?L(v,"Лимит отправки писем исчерпан. Пожалуйста, подождите час."):x.message?.includes("User not found")?L(v,"Пользователь с таким email не найден"):L(v,x.message,!0):L(p,"Ссылка для сброса пароля отправлена! Проверьте почту (и папку спам).")}catch(C){console.error("[ResetPassword] Exception:",C),L(v,C.message||"Ошибка отправки",!0)}L(h,!1)}}async function T(){if(L(v,""),L(p,""),c(i).length<6){L(v,"Пароль должен быть не менее 6 символов");return}if(c(i)!==c(o)){L(v,"Пароли не совпадают");return}L(h,!0);try{if(!await g()){L(v,"Сессия не найдена. Пожалуйста, запросите новую ссылку для сброса пароля.");return}const{error:x}=await xt.auth.updateUser({password:c(i)});x?(console.error("[ResetPassword] Update error:",x),L(v,x.message,!0)):(L(_,!0),L(p,"Пароль успешно изменён!"),setTimeout(()=>{window.location.hash="",e.onClose?.()},3e3))}catch(C){console.error("[ResetPassword] Exception:",C),L(v,C.message||"Ошибка при сбросе пароля",!0)}finally{L(h,!1)}}var R=Hm(),N=S(R),$=S(N);$.__click=function(...C){e.onClose?.apply(this,C)};var F=A($,4);{var z=C=>{var x=Nm(),J=A(S(x),2),X=S(J);be(()=>pe(X,c(p))),O(C,x)},K=C=>{var x=dt(),J=He(x);{var X=re=>{var ne=Bm(),me=A(S(ne),2),te=S(me),q=A(me,4);q.__click=function(...ee){e.onClose?.apply(this,ee)},be(()=>pe(te,c(v))),O(re,ne)},he=re=>{var ne=dt(),me=He(ne);{var te=ee=>{var P=Vm(),D=A(He(P),2);{var Z=ue=>{var le=Wm(),de=S(le);be(()=>pe(de,c(v))),O(ue,le)};ye(D,ue=>{c(v)&&ue(Z)})}var ie=A(D,2);{var ge=ue=>{var le=qm(),de=S(le);be(()=>pe(de,c(p))),O(ue,le)};ye(ie,ue=>{c(p)&&ue(ge)})}var _e=A(ie,2),ke=S(_e),Ae=A(S(ke),2),Ne=A(ke,2),ae=S(Ne),se=A(_e,2),Q=S(se);Q.__click=function(...ue){e.onClose?.apply(this,ue)},be(()=>{Ne.disabled=c(h)||!c(u),pe(ae,c(h)?"Отправка...":"Отправить ссылку")}),Cs("submit",_e,ue=>{ue.preventDefault(),b()}),nr(Ae,()=>c(u),ue=>L(u,ue)),O(ee,P)},q=ee=>{var P=zm(),D=A(He(P),2);{var Z=se=>{var Q=Gm(),ue=S(Q);be(()=>pe(ue,c(v))),O(se,Q)};ye(D,se=>{c(v)&&se(Z)})}var ie=A(D,2),ge=S(ie),_e=A(S(ge),2),ke=A(ge,2),Ae=A(S(ke),2),Ne=A(ke,2),ae=S(Ne);be(()=>{Ne.disabled=c(h)||!c(w),pe(ae,c(h)?"Сохранение...":"Сохранить новый пароль")}),Cs("submit",ie,se=>{se.preventDefault(),T()}),nr(_e,()=>c(i),se=>L(i,se)),nr(Ae,()=>c(o),se=>L(o,se)),O(ee,P)};ye(me,ee=>{c(w)?ee(q,!1):ee(te)},!0)}O(re,ne)};ye(J,re=>{!c(w)&&c(v)?re(X):re(he,!1)},!0)}O(C,x)};ye(F,C=>{c(_)?C(z):C(K,!1)})}O(r,R),Ot()}Dt(["click"]);var Ym=V('<div class="loading-screen svelte-h938fa"><div class="loader svelte-h938fa"></div> <p>Загрузка...</p></div>'),Jm=V('<button class="btn-back-to-game svelte-h938fa" title="Назад к игре">← Назад к игре</button> <!>',1),Xm=V("<!> <!>",1),Qm=V("<!> <!>",1);function Zm(r,e){Rt(e,!0);let t=we(!1),n=we(!1),i=we(""),o=we("");Tn(()=>{ar.initialized&&console.log("[App] Auth state changed:",{user:ar.user?.email,isAuthenticated:$i.isAuthenticated,session:!!ar.session,loading:ar.loading})});async function u(){const g=window.location.hash,b=window.location.search;if(console.log("[App] Checking auth callback:",{hash:g,search:b}),g.includes("type=recovery")||b.includes("type=recovery")){console.log("[App] Recovery flow detected");let T="";g.includes("access_token=")?T=new URLSearchParams(g.substring(1)).get("access_token")||"":b.includes("token=")&&(T=new URLSearchParams(b).get("token")||""),T&&(L(o,T,!0),L(n,!0),window.history.replaceState({},"","/reset-password"))}else if(b.includes("error=")){const T=new URLSearchParams(b);L(i,T.get("error_description")||T.get("error")||"Unknown error",!0),L(n,!0),window.history.replaceState({},"","/reset-password")}else window.location.pathname==="/reset-password"&&L(n,!0)}or(async()=>{console.log("[App] Mounted");try{await u();const g=kp(),b=new Promise((T,R)=>setTimeout(()=>R(new Error("Timeout auth")),1e4));await Promise.race([g,b]),console.log("[App] Auth initialized successfully")}catch(g){console.error("[App] Auth init error:",g)}finally{L(t,!0),console.log("[App] App ready")}});function h(){L(n,!1),L(i,""),L(o,""),window.history.replaceState({},"","/")}var p=Qm(),v=He(p);{var _=g=>{var b=Ym();O(g,b)},w=g=>{var b=dt(),T=He(b);{var R=$=>{Km($,{onClose:h,get initialError(){return c(i)},get initialToken(){return c(o)}})},N=$=>{var F=dt(),z=He(F);{var K=x=>{var J=Jm(),X=He(J);X.__click=function(...re){Et.toggleEditor?.apply(this,re)};var he=A(X,2);$_(he,{}),O(x,J)},C=x=>{var J=Xm(),X=He(J);Um(X,{});var he=A(X,2);dm(he,{}),O(x,J)};ye(z,x=>{W.showEditor?x(K):x(C,!1)},!0)}O($,F)};ye(T,$=>{c(n)?$(R):$(N,!1)},!0)}O(g,b)};ye(v,g=>{c(t)?g(w,!1):g(_)})}var E=A(v,2);ye(E,g=>{}),O(r,p),Ot()}Dt(["click"]);Fd(Zm,{target:document.getElementById("app")});
