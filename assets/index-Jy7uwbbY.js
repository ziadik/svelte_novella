(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const Ll=!1;var As=Array.isArray,hc=Array.prototype.indexOf,Ma=Array.from,pa=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,Dl=Object.getOwnPropertyDescriptors,vc=Object.prototype,pc=Array.prototype,La=Object.getPrototypeOf,Ho=Object.isExtensible;const gc=()=>{};function _c(n){return n()}function ms(n){for(var e=0;e<n.length;e++)n[e]()}function mc(){var n,e,t=new Promise((r,i)=>{n=r,e=i});return{promise:t,resolve:n,reject:e}}const un=2,Da=4,Cs=8,ci=16,Gn=32,jr=64,Fl=128,hn=256,ys=512,Zt=1024,vn=2048,rr=4096,kn=8192,Tr=16384,Fa=32768,js=65536,zo=1<<17,yc=1<<18,Di=1<<19,$l=1<<20,ga=1<<21,$a=1<<22,Sr=1<<23,Vn=Symbol("$state"),bc=Symbol("legacy props"),wc=Symbol(""),Ua=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function kc(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ic(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Sc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ec(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ac(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Cc(n){throw new Error("https://svelte.dev/e/effect_orphan")}function jc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Tc(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function xc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Rc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Pc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Ts=1,xs=2,Ul=4,Oc=8,Mc=16,Lc=1,Dc=2,Fc=4,$c=8,Uc=16,Nc=1,Bc=2,Yt=Symbol(),Wc="http://www.w3.org/1999/xhtml";function Vc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let qc=!1;function Nl(n){return n===this.v}function Bl(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Gc(n,e){return n!==e}function Wl(n){return!Bl(n,this.v)}let di=!1,Hc=!1;function zc(){di=!0}let Bt=null;function bs(n){Bt=n}function Pt(n,e=!1,t){Bt={p:Bt,c:null,e:null,s:n,x:null,l:di&&!e?{s:null,u:null,$:[]}:null}}function Ot(n){var e=Bt,t=e.e;if(t!==null){e.e=null;for(var r of t)nu(r)}return Bt=e.p,{}}function fi(){return!di||Bt!==null&&Bt.l===null}const Kc=new WeakMap;function Yc(n){var e=gt;if(e===null)return yt.f|=Sr,n;if((e.f&Fa)===0){if((e.f&Fl)===0)throw!e.parent&&n instanceof Error&&Vl(n),n;e.b.error(n)}else Na(n,e)}function Na(n,e){for(;e!==null;){if((e.f&Fl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Vl(n),n}function Vl(n){const e=Kc.get(n);e&&(pa(n,"message",{value:e.message}),pa(n,"stack",{value:e.stack}))}let Pi=[],_a=[];function ql(){var n=Pi;Pi=[],ms(n)}function Jc(){var n=_a;_a=[],ms(n)}function Ba(n){Pi.length===0&&queueMicrotask(ql),Pi.push(n)}function Xc(){Pi.length>0&&ql(),_a.length>0&&Jc()}function Qc(){for(var n=gt.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&kc(),n}function Fi(n){var e=un|vn,t=yt!==null&&(yt.f&un)!==0?yt:null;return gt===null||t!==null&&(t.f&hn)!==0?e|=hn:gt.f|=Di,{ctx:Bt,deps:null,effects:null,equals:Nl,f:e,fn:n,reactions:null,rv:0,v:Yt,wv:0,parent:t??gt,ac:null}}function Zc(n,e){let t=gt;t===null&&Sc();var r=t.b,i=void 0,l=si(Yt),u=null,h=!yt;return hd(()=>{try{var v=n();u&&Promise.resolve(v).catch(()=>{})}catch(p){v=Promise.reject(p)}var g=()=>v;i=u?.then(g,g)??Promise.resolve(v),u=i;var m=Lt,k=r.pending;h&&(r.update_pending_count(1),k||m.increment());const S=(p,b=void 0)=>{u=null,k||m.activate(),b?b!==Ua&&(l.f|=Sr,ai(l,b)):((l.f&Sr)!==0&&(l.f^=Sr),ai(l,p)),h&&(r.update_pending_count(-1),k||m.decrement()),zl()};if(i.then(S,p=>S(null,p||"unknown")),m)return()=>{queueMicrotask(()=>m.neuter())}}),new Promise(v=>{function g(m){function k(){m===i?v(l):g(i)}m.then(k,k)}g(i)})}function Dt(n){const e=Fi(n);return uu(e),e}function hi(n){const e=Fi(n);return e.equals=Wl,e}function Gl(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Pn(e[t])}}function ed(n){for(var e=n.parent;e!==null;){if((e.f&un)===0)return e;e=e.parent}return null}function Wa(n){var e,t=gt;tr(ed(n));try{Gl(n),e=hu(n)}finally{tr(t)}return e}function Hl(n){var e=Wa(n);if(n.equals(e)||(n.v=e,n.wv=du()),!Rr){var t=(Qn||(n.f&hn)!==0)&&n.deps!==null?rr:Zt;an(n,t)}}function td(n,e,t){const r=fi()?Fi:hi;if(e.length===0){t(n.map(r));return}var i=Lt,l=gt,u=nd(),h=Qc();Promise.all(e.map(v=>Zc(v))).then(v=>{i?.activate(),u();try{t([...n.map(r),...v])}catch(g){(l.f&Tr)===0&&Na(g,l)}i?.deactivate(),zl()}).catch(v=>{h.error(v)})}function nd(){var n=gt,e=yt,t=Bt,r=Lt;return function(){tr(n),On(e),bs(t),r?.activate()}}function zl(){tr(null),On(null),bs(null)}const ea=new Set;let Lt=null,ps=null,Ko=new Set,ws=[];function Kl(){const n=ws.shift();ws.length>0&&queueMicrotask(Kl),n()}let Ar=[],Rs=null,ma=!1,gs=!1;class ri{current=new Map;#i=new Map;#n=new Set;#e=0;#s=null;#a=!1;#t=[];#r=[];#l=[];#o=[];#u=[];#d=[];#f=[];skipped_effects=new Set;process(e){Ar=[],ps=null;for(const i of e)this.#v(i);if(this.#t.length===0&&this.#e===0){this.#h();var t=this.#l,r=this.#o;this.#l=[],this.#o=[],this.#u=[],ps=Lt,Lt=null,Yo(t),Yo(r),Lt===null?Lt=this:ea.delete(this),this.#s?.resolve()}else this.#c(this.#l),this.#c(this.#o),this.#c(this.#u);for(const i of this.#t)ni(i);for(const i of this.#r)ni(i);this.#t=[],this.#r=[]}#v(e){e.f^=Zt;for(var t=e.first;t!==null;){var r=t.f,i=(r&(Gn|jr))!==0,l=i&&(r&Zt)!==0,u=l||(r&kn)!==0||this.skipped_effects.has(t);if(!u&&t.fn!==null){if(i)t.f^=Zt;else if((r&Da)!==0)this.#o.push(t);else if((r&Zt)===0)if((r&$a)!==0){var h=t.b?.pending?this.#r:this.#t;h.push(t)}else Ds(t)&&((t.f&ci)!==0&&this.#u.push(t),ni(t));var v=t.first;if(v!==null){t=v;continue}}var g=t.parent;for(t=t.next;t===null&&g!==null;)t=g.next,g=g.parent}}#c(e){for(const t of e)((t.f&vn)!==0?this.#d:this.#f).push(t),an(t,Zt);e.length=0}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.current.set(e,e.v)}activate(){Lt=this}deactivate(){Lt=null,ps=null;for(const e of Ko)if(Ko.delete(e),e(),Lt!==null)break}neuter(){this.#a=!0}flush(){Ar.length>0?Yl():this.#h(),Lt===this&&(this.#e===0&&ea.delete(this),this.deactivate())}#h(){if(!this.#a)for(const e of this.#n)e();this.#n.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#d)an(e,vn),ii(e);for(const e of this.#f)an(e,rr),ii(e);this.#l=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(e){this.#n.add(e)}settled(){return(this.#s??=mc()).promise}static ensure(){if(Lt===null){const e=Lt=new ri;ea.add(Lt),gs||ri.enqueue(()=>{Lt===e&&e.flush()})}return Lt}static enqueue(e){ws.length===0&&queueMicrotask(Kl),ws.unshift(e)}}function rd(n){var e=gs;gs=!0;try{for(var t;;){if(Xc(),Ar.length===0&&(Lt?.flush(),Ar.length===0))return Rs=null,t;Yl()}}finally{gs=e}}function Yl(){var n=ti;ma=!0;try{var e=0;for(Zo(!0);Ar.length>0;){var t=ri.ensure();if(e++>1e3){var r,i;id()}t.process(Ar),Zn.clear()}}finally{ma=!1,Zo(n),Rs=null}}function id(){try{jc()}catch(n){Na(n,Rs)}}let kr=null;function Yo(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(Tr|kn))===0&&Ds(r)&&(kr=[],ni(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?au(r):r.fn=null),kr?.length>0)){Zn.clear();for(const i of kr)ni(i);kr=[]}}kr=null}}function ii(n){for(var e=Rs=n;e.parent!==null;){e=e.parent;var t=e.f;if(ma&&e===gt&&(t&ci)!==0)return;if((t&(jr|Gn))!==0){if((t&Zt)===0)return;e.f^=Zt}}Ar.push(e)}const Zn=new Map;function si(n,e){var t={f:0,v:n,reactions:null,equals:Nl,rv:0,wv:0};return t}function Me(n,e){const t=si(n);return uu(t),t}function sd(n,e=!1,t=!0){const r=si(n);return e||(r.equals=Wl),di&&t&&Bt!==null&&Bt.l!==null&&(Bt.l.s??=[]).push(r),r}function ie(n,e,t=!1){yt!==null&&(!xn||(yt.f&zo)!==0)&&fi()&&(yt.f&(un|ci|$a|zo))!==0&&!qn?.includes(n)&&Pc();let r=t?pt(e):e;return ai(n,r)}function ai(n,e){if(!n.equals(e)){var t=n.v;Rr?Zn.set(n,e):Zn.set(n,t),n.v=e;var r=ri.ensure();r.capture(n,t),(n.f&un)!==0&&((n.f&vn)!==0&&Wa(n),an(n,(n.f&hn)===0?Zt:rr)),n.wv=du(),Jl(n,vn),fi()&&gt!==null&&(gt.f&Zt)!==0&&(gt.f&(Gn|jr))===0&&(fn===null?_d([n]):fn.push(n))}return e}function er(n,e=1){var t=f(n),r=e===1?t++:t--;return ie(n,t),r}function ta(n){ie(n,n.v+1)}function Jl(n,e){var t=n.reactions;if(t!==null)for(var r=fi(),i=t.length,l=0;l<i;l++){var u=t[l],h=u.f;if(!(!r&&u===gt)){var v=(h&vn)===0;v&&an(u,e),(h&un)!==0?Jl(u,rr):v&&((h&ci)!==0&&kr!==null&&kr.push(u),ii(u))}}}function pt(n){if(typeof n!="object"||n===null||Vn in n)return n;const e=La(n);if(e!==vc&&e!==pc)return n;var t=new Map,r=As(n),i=Me(0),l=Er,u=h=>{if(Er===l)return h();var v=yt,g=Er;On(null),tl(l);var m=h();return On(v),tl(g),m};return r&&t.set("length",Me(n.length)),new Proxy(n,{defineProperty(h,v,g){(!("value"in g)||g.configurable===!1||g.enumerable===!1||g.writable===!1)&&xc();var m=t.get(v);return m===void 0?m=u(()=>{var k=Me(g.value);return t.set(v,k),k}):ie(m,g.value,!0),!0},deleteProperty(h,v){var g=t.get(v);if(g===void 0){if(v in h){const m=u(()=>Me(Yt));t.set(v,m),ta(i)}}else ie(g,Yt),ta(i);return!0},get(h,v,g){if(v===Vn)return n;var m=t.get(v),k=v in h;if(m===void 0&&(!k||ei(h,v)?.writable)&&(m=u(()=>{var p=pt(k?h[v]:Yt),b=Me(p);return b}),t.set(v,m)),m!==void 0){var S=f(m);return S===Yt?void 0:S}return Reflect.get(h,v,g)},getOwnPropertyDescriptor(h,v){var g=Reflect.getOwnPropertyDescriptor(h,v);if(g&&"value"in g){var m=t.get(v);m&&(g.value=f(m))}else if(g===void 0){var k=t.get(v),S=k?.v;if(k!==void 0&&S!==Yt)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return g},has(h,v){if(v===Vn)return!0;var g=t.get(v),m=g!==void 0&&g.v!==Yt||Reflect.has(h,v);if(g!==void 0||gt!==null&&(!m||ei(h,v)?.writable)){g===void 0&&(g=u(()=>{var S=m?pt(h[v]):Yt,p=Me(S);return p}),t.set(v,g));var k=f(g);if(k===Yt)return!1}return m},set(h,v,g,m){var k=t.get(v),S=v in h;if(r&&v==="length")for(var p=g;p<k.v;p+=1){var b=t.get(p+"");b!==void 0?ie(b,Yt):p in h&&(b=u(()=>Me(Yt)),t.set(p+"",b))}if(k===void 0)(!S||ei(h,v)?.writable)&&(k=u(()=>Me(void 0)),ie(k,pt(g)),t.set(v,k));else{S=k.v!==Yt;var R=u(()=>pt(g));ie(k,R)}var P=Reflect.getOwnPropertyDescriptor(h,v);if(P?.set&&P.set.call(m,g),!S){if(r&&typeof v=="string"){var U=t.get("length"),q=Number(v);Number.isInteger(q)&&q>=U.v&&ie(U,q+1)}ta(i)}return!0},ownKeys(h){f(i);var v=Reflect.ownKeys(h).filter(k=>{var S=t.get(k);return S===void 0||S.v!==Yt});for(var[g,m]of t)m.v!==Yt&&!(g in h)&&v.push(g);return v},setPrototypeOf(){Rc()}})}function Jo(n){try{if(n!==null&&typeof n=="object"&&Vn in n)return n[Vn]}catch{}return n}function ad(n,e){return Object.is(Jo(n),Jo(e))}var Xo,Xl,Ql,Zl;function od(){if(Xo===void 0){Xo=window,Xl=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Ql=ei(e,"firstChild").get,Zl=ei(e,"nextSibling").get,Ho(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Ho(t)&&(t.__t=void 0)}}function xr(n=""){return document.createTextNode(n)}function oi(n){return Ql.call(n)}function Ps(n){return Zl.call(n)}function E(n,e){return oi(n)}function Xe(n,e){{var t=oi(n);return t instanceof Comment&&t.data===""?Ps(t):t}}function j(n,e=1,t=!1){let r=n;for(;e--;)r=Ps(r);return r}function ld(n){n.textContent=""}function Va(){return!1}let Qo=!1;function ud(){Qo||(Qo=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function Os(n){var e=yt,t=gt;On(null),tr(null);try{return n()}finally{On(e),tr(t)}}function qa(n,e,t,r=t){n.addEventListener(e,()=>Os(t));const i=n.__on_r;i?n.__on_r=()=>{i(),r(!0)}:n.__on_r=()=>r(!0),ud()}function eu(n){gt===null&&yt===null&&Cc(),yt!==null&&(yt.f&hn)!==0&&gt===null&&Ac(),Rr&&Ec()}function cd(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Mn(n,e,t,r=!0){var i=gt;i!==null&&(i.f&kn)!==0&&(n|=kn);var l={ctx:Bt,deps:null,nodes_start:null,nodes_end:null,f:n|vn,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{ni(l),l.f|=Fa}catch(v){throw Pn(l),v}else e!==null&&ii(l);if(r){var u=l;if(t&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Di)===0&&(u=u.first),u!==null&&(u.parent=i,i!==null&&cd(u,i),yt!==null&&(yt.f&un)!==0&&(n&jr)===0)){var h=yt;(h.effects??=[]).push(u)}}return l}function tu(n){const e=Mn(Cs,null,!1);return an(e,Zt),e.teardown=n,e}function li(n){eu();var e=gt.f,t=!yt&&(e&Gn)!==0&&(e&Fa)===0;if(t){var r=Bt;(r.e??=[]).push(n)}else return nu(n)}function nu(n){return Mn(Da|$l,n,!1)}function dd(n){return eu(),Mn(Cs|$l,n,!0)}function fd(n){ri.ensure();const e=Mn(jr|Di,n,!0);return(t={})=>new Promise(r=>{t.outro?Ls(e,()=>{Pn(e),r(void 0)}):(Pn(e),r(void 0))})}function ru(n){return Mn(Da,n,!1)}function hd(n){return Mn($a|Di,n,!0)}function Ga(n,e=0){return Mn(Cs|e,n,!0)}function Se(n,e=[],t=[]){td(e,t,r=>{Mn(Cs,()=>n(...r.map(f)),!0)})}function Ms(n,e=0){var t=Mn(ci|e,n,!0);return t}function Cr(n,e=!0){return Mn(Gn|Di,n,!0,e)}function iu(n){var e=n.teardown;if(e!==null){const t=Rr,r=yt;el(!0),On(null);try{e.call(null)}finally{el(t),On(r)}}}function su(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const i=t.ac;i!==null&&Os(()=>{i.abort(Ua)});var r=t.next;(t.f&jr)!==0?t.parent=null:Pn(t,e),t=r}}function vd(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Gn)===0&&Pn(e),e=t}}function Pn(n,e=!0){var t=!1;(e||(n.f&yc)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(pd(n.nodes_start,n.nodes_end),t=!0),su(n,e&&!t),ks(n,0),an(n,Tr);var r=n.transitions;if(r!==null)for(const l of r)l.stop();iu(n);var i=n.parent;i!==null&&i.first!==null&&au(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function pd(n,e){for(;n!==null;){var t=n===e?null:Ps(n);n.remove(),n=t}}function au(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ls(n,e){var t=[];Ha(n,t,!0),ou(t,()=>{Pn(n),e&&e()})}function ou(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var i of n)i.out(r)}else e()}function Ha(n,e,t){if((n.f&kn)===0){if(n.f^=kn,n.transitions!==null)for(const u of n.transitions)(u.is_global||t)&&e.push(u);for(var r=n.first;r!==null;){var i=r.next,l=(r.f&js)!==0||(r.f&Gn)!==0;Ha(r,e,l?t:!1),r=i}}}function za(n){lu(n,!0)}function lu(n,e){if((n.f&kn)!==0){n.f^=kn,(n.f&Zt)===0&&(an(n,vn),ii(n));for(var t=n.first;t!==null;){var r=t.next,i=(t.f&js)!==0||(t.f&Gn)!==0;lu(t,i?e:!1),t=r}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||e)&&l.in()}}let Jr=null;function gd(n){var e=Jr;try{if(Jr=new Set,Pr(n),e!==null)for(var t of Jr)e.add(t);return Jr}finally{Jr=e}}function bn(n){for(var e of gd(n))ai(e,e.v)}let ti=!1;function Zo(n){ti=n}let Rr=!1;function el(n){Rr=n}let yt=null,xn=!1;function On(n){yt=n}let gt=null;function tr(n){gt=n}let qn=null;function uu(n){yt!==null&&(qn===null?qn=[n]:qn.push(n))}let tn=null,ln=0,fn=null;function _d(n){fn=n}let cu=1,Oi=0,Er=Oi;function tl(n){Er=n}let Qn=!1;function du(){return++cu}function Ds(n){var e=n.f;if((e&vn)!==0)return!0;if((e&rr)!==0){var t=n.deps,r=(e&hn)!==0;if(t!==null){var i,l,u=(e&ys)!==0,h=r&&gt!==null&&!Qn,v=t.length;if((u||h)&&(gt===null||(gt.f&Tr)===0)){var g=n,m=g.parent;for(i=0;i<v;i++)l=t[i],(u||!l?.reactions?.includes(g))&&(l.reactions??=[]).push(g);u&&(g.f^=ys),h&&m!==null&&(m.f&hn)===0&&(g.f^=hn)}for(i=0;i<v;i++)if(l=t[i],Ds(l)&&Hl(l),l.wv>n.wv)return!0}(!r||gt!==null&&!Qn)&&an(n,Zt)}return!1}function fu(n,e,t=!0){var r=n.reactions;if(r!==null&&!qn?.includes(n))for(var i=0;i<r.length;i++){var l=r[i];(l.f&un)!==0?fu(l,e,!1):e===l&&(t?an(l,vn):(l.f&Zt)!==0&&an(l,rr),ii(l))}}function hu(n){var e=tn,t=ln,r=fn,i=yt,l=Qn,u=qn,h=Bt,v=xn,g=Er,m=n.f;tn=null,ln=0,fn=null,Qn=(m&hn)!==0&&(xn||!ti||yt===null),yt=(m&(Gn|jr))===0?n:null,qn=null,bs(n.ctx),xn=!1,Er=++Oi,n.ac!==null&&(Os(()=>{n.ac.abort(Ua)}),n.ac=null);try{n.f|=ga;var k=n.fn,S=k(),p=n.deps;if(tn!==null){var b;if(ks(n,ln),p!==null&&ln>0)for(p.length=ln+tn.length,b=0;b<tn.length;b++)p[ln+b]=tn[b];else n.deps=p=tn;if(!Qn||(m&un)!==0&&n.reactions!==null)for(b=ln;b<p.length;b++)(p[b].reactions??=[]).push(n)}else p!==null&&ln<p.length&&(ks(n,ln),p.length=ln);if(fi()&&fn!==null&&!xn&&p!==null&&(n.f&(un|rr|vn))===0)for(b=0;b<fn.length;b++)fu(fn[b],n);return i!==null&&i!==n&&(Oi++,fn!==null&&(r===null?r=fn:r.push(...fn))),(n.f&Sr)!==0&&(n.f^=Sr),S}catch(R){return Yc(R)}finally{n.f^=ga,tn=e,ln=t,fn=r,yt=i,Qn=l,qn=u,bs(h),xn=v,Er=g}}function md(n,e){let t=e.reactions;if(t!==null){var r=hc.call(t,n);if(r!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[r]=t[i],t.pop())}}t===null&&(e.f&un)!==0&&(tn===null||!tn.includes(e))&&(an(e,rr),(e.f&(hn|ys))===0&&(e.f^=ys),Gl(e),ks(e,0))}function ks(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)md(n,t[r])}function ni(n){var e=n.f;if((e&Tr)===0){an(n,Zt);var t=gt,r=ti;gt=n,ti=!0;try{(e&ci)!==0?vd(n):su(n),iu(n);var i=hu(n);n.teardown=typeof i=="function"?i:null,n.wv=cu;var l;Ll&&Hc&&(n.f&vn)!==0&&n.deps}finally{ti=r,gt=t}}}async function vu(){await Promise.resolve(),rd()}function f(n){var e=n.f,t=(e&un)!==0;if(Jr?.add(n),yt!==null&&!xn){var r=gt!==null&&(gt.f&Tr)!==0;if(!r&&!qn?.includes(n)){var i=yt.deps;if((yt.f&ga)!==0)n.rv<Oi&&(n.rv=Oi,tn===null&&i!==null&&i[ln]===n?ln++:tn===null?tn=[n]:(!Qn||!tn.includes(n))&&tn.push(n));else{(yt.deps??=[]).push(n);var l=n.reactions;l===null?n.reactions=[yt]:l.includes(yt)||l.push(yt)}}}else if(t&&n.deps===null&&n.effects===null){var u=n,h=u.parent;h!==null&&(h.f&hn)===0&&(u.f^=hn)}if(Rr){if(Zn.has(n))return Zn.get(n);if(t){u=n;var v=u.v;return((u.f&Zt)===0&&u.reactions!==null||pu(u))&&(v=Wa(u)),Zn.set(u,v),v}}else t&&(u=n,Ds(u)&&Hl(u));if((n.f&Sr)!==0)throw n.v;return n.v}function pu(n){if(n.v===Yt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Zn.has(e)||(e.f&un)!==0&&pu(e))return!0;return!1}function Pr(n){var e=xn;try{return xn=!0,n()}finally{xn=e}}const yd=-7169;function an(n,e){n.f=n.f&yd|e}function bd(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Vn in n)ya(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Vn in t&&ya(t)}}}function ya(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{ya(n[r],e)}catch{}const t=La(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Dl(t);for(let i in r){const l=r[i].get;if(l)try{l.call(n)}catch{}}}}}const wd=["touchstart","touchmove"];function kd(n){return wd.includes(n)}const gu=new Set,ba=new Set;function Id(n,e,t,r={}){function i(l){if(r.capture||Ai.call(e,l),!l.cancelBubble)return Os(()=>t?.call(this,l))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Ba(()=>{e.addEventListener(n,i,r)}):e.addEventListener(n,i,r),i}function Sd(n,e,t,r,i){var l={capture:r,passive:i},u=Id(n,e,t,l);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&tu(()=>{e.removeEventListener(n,u,l)})}function Ft(n){for(var e=0;e<n.length;e++)gu.add(n[e]);for(var t of ba)t(n)}let nl=null;function Ai(n){var e=this,t=e.ownerDocument,r=n.type,i=n.composedPath?.()||[],l=i[0]||n.target;nl=n;var u=0,h=nl===n&&n.__root;if(h){var v=i.indexOf(h);if(v!==-1&&(e===document||e===window)){n.__root=e;return}var g=i.indexOf(e);if(g===-1)return;v<=g&&(u=v)}if(l=i[u]||n.target,l!==e){pa(n,"currentTarget",{configurable:!0,get(){return l||t}});var m=yt,k=gt;On(null),tr(null);try{for(var S,p=[];l!==null;){var b=l.assignedSlot||l.parentNode||l.host||null;try{var R=l["__"+r];if(R!=null&&(!l.disabled||n.target===l))if(As(R)){var[P,...U]=R;P.apply(l,[n,...U])}else R.call(l,n)}catch(q){S?p.push(q):S=q}if(n.cancelBubble||b===e||b===null)break;l=b}if(S){for(let q of p)queueMicrotask(()=>{throw q});throw S}}finally{n.__root=e,delete n.currentTarget,On(m),tr(k)}}}function _u(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Mi(n,e){var t=gt;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function Q(n,e){var t=(e&Nc)!==0,r=(e&Bc)!==0,i,l=!n.startsWith("<!>");return()=>{i===void 0&&(i=_u(l?n:"<!>"+n),t||(i=oi(i)));var u=r||Xl?document.importNode(i,!0):i.cloneNode(!0);if(t){var h=oi(u),v=u.lastChild;Mi(h,v)}else Mi(u,u);return u}}function Ed(n,e,t="svg"){var r=!n.startsWith("<!>"),i=`<${t}>${r?n:"<!>"+n}</${t}>`,l;return()=>{if(!l){var u=_u(i),h=oi(u);l=oi(h)}var v=l.cloneNode(!0);return Mi(v,v),v}}function Ad(n,e){return Ed(n,e,"svg")}function ls(n=""){{var e=xr(n+"");return Mi(e,e),e}}function At(){var n=document.createDocumentFragment(),e=document.createComment(""),t=xr();return n.append(e,t),Mi(e,t),n}function W(n,e){n!==null&&n.before(e)}function be(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Cd(n,e){return jd(n,e)}const Ur=new Map;function jd(n,{target:e,anchor:t,props:r={},events:i,context:l,intro:u=!0}){od();var h=new Set,v=k=>{for(var S=0;S<k.length;S++){var p=k[S];if(!h.has(p)){h.add(p);var b=kd(p);e.addEventListener(p,Ai,{passive:b});var R=Ur.get(p);R===void 0?(document.addEventListener(p,Ai,{passive:b}),Ur.set(p,1)):Ur.set(p,R+1)}}};v(Ma(gu)),ba.add(v);var g=void 0,m=fd(()=>{var k=t??e.appendChild(xr());return Cr(()=>{if(l){Pt({});var S=Bt;S.c=l}i&&(r.$$events=i),g=n(k,r)||{},l&&Ot()}),()=>{for(var S of h){e.removeEventListener(S,Ai);var p=Ur.get(S);--p===0?(document.removeEventListener(S,Ai),Ur.delete(S)):Ur.set(S,p)}ba.delete(v),k!==t&&k.parentNode?.removeChild(k)}});return Td.set(g,m),g}let Td=new WeakMap;function Oe(n,e,t=!1){var r=n,i=null,l=null,u=Yt,h=t?js:0,v=!1;const g=(p,b=!0)=>{v=!0,S(b,p)};var m=null;function k(){m!==null&&(m.lastChild.remove(),r.before(m),m=null);var p=u?i:l,b=u?l:i;p&&za(p),b&&Ls(b,()=>{u?l=null:i=null})}const S=(p,b)=>{if(u!==(u=p)){var R=Va(),P=r;if(R&&(m=document.createDocumentFragment(),m.append(P=xr())),u?i??=b&&Cr(()=>b(P)):l??=b&&Cr(()=>b(P)),R){var U=Lt,q=u?i:l,L=u?l:i;q&&U.skipped_effects.delete(q),L&&U.skipped_effects.add(L),U.add_callback(k)}else k()}};Ms(()=>{v=!1,e(g),v||S(null,null)},h)}function wa(n,e,t){var r=n,i=Yt,l,u,h=null,v=fi()?Gc:Bl;function g(){l&&Ls(l),h!==null&&(h.lastChild.remove(),r.before(h),h=null),l=u}Ms(()=>{if(v(i,i=e())){var m=r,k=Va();k&&(h=document.createDocumentFragment(),h.append(m=xr())),u=Cr(()=>t(m)),k?Lt.add_callback(g):g()}})}function xt(n,e){return e}function xd(n,e,t){for(var r=n.items,i=[],l=e.length,u=0;u<l;u++)Ha(e[u].e,i,!0);var h=l>0&&i.length===0&&t!==null;if(h){var v=t.parentNode;ld(v),v.append(t),r.clear(),Cn(n,e[0].prev,e[l-1].next)}ou(i,()=>{for(var g=0;g<l;g++){var m=e[g];h||(r.delete(m.k),Cn(n,m.prev,m.next)),Pn(m.e,!h)}})}function Ze(n,e,t,r,i,l=null){var u=n,h={flags:e,items:new Map,first:null},v=(e&Ul)!==0;if(v){var g=n;u=g.appendChild(xr())}var m=null,k=!1,S=new Map,p=hi(()=>{var U=t();return As(U)?U:U==null?[]:Ma(U)}),b,R;function P(){Rd(R,b,h,S,u,i,e,r,t),l!==null&&(b.length===0?m?za(m):m=Cr(()=>l(u)):m!==null&&Ls(m,()=>{m=null}))}Ms(()=>{R??=gt,b=f(p);var U=b.length;if(!(k&&U===0)){k=U===0;var q,L,z,H;if(Va()){var C=new Set,T=Lt;for(L=0;L<U;L+=1){z=b[L],H=r(z,L);var K=h.items.get(H)??S.get(H);K?(e&(Ts|xs))!==0&&mu(K,z,L,e):(q=yu(null,h,null,null,z,H,L,i,e,t,!0),S.set(H,q)),C.add(H)}for(const[X,ve]of h.items)C.has(X)||T.skipped_effects.add(ve.e);T.add_callback(P)}else P();f(p)}})}function Rd(n,e,t,r,i,l,u,h,v){var g=(u&Oc)!==0,m=(u&(Ts|xs))!==0,k=e.length,S=t.items,p=t.first,b=p,R,P=null,U,q=[],L=[],z,H,C,T;if(g)for(T=0;T<k;T+=1)z=e[T],H=h(z,T),C=S.get(H),C!==void 0&&(C.a?.measure(),(U??=new Set).add(C));for(T=0;T<k;T+=1){if(z=e[T],H=h(z,T),C=S.get(H),C===void 0){var K=r.get(H);if(K!==void 0){r.delete(H),S.set(H,K);var X=P?P.next:b;Cn(t,P,K),Cn(t,K,X),na(K,X,i),P=K}else{var ve=b?b.e.nodes_start:i;P=yu(ve,t,P,P===null?t.first:P.next,z,H,T,l,u,v)}S.set(H,P),q=[],L=[],b=P.next;continue}if(m&&mu(C,z,T,u),(C.e.f&kn)!==0&&(za(C.e),g&&(C.a?.unfix(),(U??=new Set).delete(C))),C!==b){if(R!==void 0&&R.has(C)){if(q.length<L.length){var de=L[0],oe;P=de.prev;var me=q[0],ee=q[q.length-1];for(oe=0;oe<q.length;oe+=1)na(q[oe],de,i);for(oe=0;oe<L.length;oe+=1)R.delete(L[oe]);Cn(t,me.prev,ee.next),Cn(t,P,me),Cn(t,ee,de),b=de,P=ee,T-=1,q=[],L=[]}else R.delete(C),na(C,b,i),Cn(t,C.prev,C.next),Cn(t,C,P===null?t.first:P.next),Cn(t,P,C),P=C;continue}for(q=[],L=[];b!==null&&b.k!==H;)(b.e.f&kn)===0&&(R??=new Set).add(b),L.push(b),b=b.next;if(b===null)continue;C=b}q.push(C),P=C,b=C.next}if(b!==null||R!==void 0){for(var D=R===void 0?[]:Ma(R);b!==null;)(b.e.f&kn)===0&&D.push(b),b=b.next;var Z=D.length;if(Z>0){var M=(u&Ul)!==0&&k===0?i:null;if(g){for(T=0;T<Z;T+=1)D[T].a?.measure();for(T=0;T<Z;T+=1)D[T].a?.fix()}xd(t,D,M)}}g&&Ba(()=>{if(U!==void 0)for(C of U)C.a?.apply()}),n.first=t.first&&t.first.e,n.last=P&&P.e;for(var $ of r.values())Pn($.e);r.clear()}function mu(n,e,t,r){(r&Ts)!==0&&ai(n.v,e),(r&xs)!==0?ai(n.i,t):n.i=t}function yu(n,e,t,r,i,l,u,h,v,g,m){var k=(v&Ts)!==0,S=(v&Mc)===0,p=k?S?sd(i,!1,!1):si(i):i,b=(v&xs)===0?u:si(u),R={i:b,v:p,k:l,a:null,e:null,prev:t,next:r};try{if(n===null){var P=document.createDocumentFragment();P.append(n=xr())}return R.e=Cr(()=>h(n,p,b,g),qc),R.e.prev=t&&t.e,R.e.next=r&&r.e,t===null?m||(e.first=R):(t.next=R,t.e.next=R.e),r!==null&&(r.prev=R,r.e.prev=R.e),R}finally{}}function na(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=n.e.nodes_start;l!==null&&l!==r;){var u=Ps(l);i.before(l),l=u}}function Cn(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ka(n,e,...t){var r=n,i=gc,l;Ms(()=>{i!==(i=e())&&(l&&(Pn(l),l=null),l=Cr(()=>i(r,...t)))},js)}const rl=[...` 	
\r\f \v\uFEFF`];function Pd(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var i in t)if(t[i])r=r?r+" "+i:i;else if(r.length)for(var l=i.length,u=0;(u=r.indexOf(i,u))>=0;){var h=u+l;(u===0||rl.includes(r[u-1]))&&(h===r.length||rl.includes(r[h]))?r=(u===0?"":r.substring(0,u))+r.substring(h+1):u=h}}return r===""?null:r}function Od(n,e){return n==null?null:String(n)}function Nt(n,e,t,r,i,l){var u=n.__className;if(u!==t||u===void 0){var h=Pd(t,r,l);h==null?n.removeAttribute("class"):n.className=h,n.__className=t}else if(l&&i!==l)for(var v in l){var g=!!l[v];(i==null||g!==!!i[v])&&n.classList.toggle(v,g)}return l}function sn(n,e,t,r){var i=n.__style;if(i!==e){var l=Od(e);l==null?n.removeAttribute("style"):n.style.cssText=l,n.__style=e}return r}function Jn(n,e,t=!1){if(n.multiple){if(e==null)return;if(!As(e))return Vc();for(var r of n.options)r.selected=e.includes(ji(r));return}for(r of n.options){var i=ji(r);if(ad(i,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function br(n){var e=new MutationObserver(()=>{Jn(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),tu(()=>{e.disconnect()})}function Zr(n,e,t=e){var r=!0;qa(n,"change",i=>{var l=i?"[selected]":":checked",u;if(n.multiple)u=[].map.call(n.querySelectorAll(l),ji);else{var h=n.querySelector(l)??n.querySelector("option:not([disabled])");u=h&&ji(h)}t(u)}),ru(()=>{var i=e();if(Jn(n,i,r),r&&i===void 0){var l=n.querySelector(":checked");l!==null&&(i=ji(l),t(i))}n.__value=i,r=!1}),br(n)}function ji(n){return"__value"in n?n.__value:n.value}const Md=Symbol("is custom element"),Ld=Symbol("is html");function ra(n,e){var t=Ya(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Dd(n,e){var t=Ya(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Ne(n,e,t,r){var i=Ya(n);i[e]!==(i[e]=t)&&(e==="loading"&&(n[wc]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Fd(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Ya(n){return n.__attributes??={[Md]:n.nodeName.includes("-"),[Ld]:n.namespaceURI===Wc}}var il=new Map;function Fd(n){var e=n.getAttribute("is")||n.nodeName,t=il.get(e);if(t)return t;il.set(e,t=[]);for(var r,i=n,l=Element.prototype;l!==i;){r=Dl(i);for(var u in r)r[u].set&&t.push(u);i=La(i)}return t}function Wn(n,e,t=e){var r=new WeakSet;qa(n,"input",async i=>{var l=i?n.defaultValue:n.value;if(l=ia(n)?sa(l):l,t(l),Lt!==null&&r.add(Lt),await vu(),l!==(l=e())){var u=n.selectionStart,h=n.selectionEnd;n.value=l??"",h!==null&&(n.selectionStart=u,n.selectionEnd=Math.min(h,n.value.length))}}),Pr(e)==null&&n.value&&(t(ia(n)?sa(n.value):n.value),Lt!==null&&r.add(Lt)),Ga(()=>{var i=e();if(n===document.activeElement){var l=ps??Lt;if(r.has(l))return}ia(n)&&i===sa(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function sl(n,e,t=e){qa(n,"change",r=>{var i=r?n.defaultChecked:n.checked;t(i)}),Pr(e)==null&&t(n.checked),Ga(()=>{var r=e();n.checked=!!r})}function ia(n){var e=n.type;return e==="number"||e==="range"}function sa(n){return n===""?null:+n}function al(n,e){return n===e||n?.[Vn]===e}function ka(n={},e,t,r){return ru(()=>{var i,l;return Ga(()=>{i=l,l=[],Pr(()=>{n!==t(...l)&&(e(n,...l),i&&al(t(...i),n)&&e(null,...i))})}),()=>{Ba(()=>{l&&al(t(...l),n)&&e(null,...l)})}}),n}function ir(n=!1){const e=Bt,t=e.l.u;if(!t)return;let r=()=>bd(e.s);if(n){let i=0,l={};const u=Fi(()=>{let h=!1;const v=e.s;for(const g in v)v[g]!==l[g]&&(l[g]=v[g],h=!0);return h&&i++,i});r=()=>f(u)}t.b.length&&dd(()=>{ol(e,r),ms(t.b)}),li(()=>{const i=Pr(()=>t.m.map(_c));return()=>{for(const l of i)typeof l=="function"&&l()}}),t.a.length&&li(()=>{ol(e,r),ms(t.a)})}function ol(n,e){if(n.l.s)for(const t of n.l.s)f(t);e()}function sr(n){var e=si(0);return function(){return arguments.length===1?(ie(e,f(e)+1),arguments[0]):(f(e),n())}}let us=!1;function $d(n){var e=us;try{return us=!1,[n(),us]}finally{us=e}}function ze(n,e,t,r){var i=!di||(t&Dc)!==0,l=(t&$c)!==0,u=(t&Uc)!==0,h=r,v=!0,g=()=>(v&&(v=!1,h=u?Pr(r):r),h),m;if(l){var k=Vn in n||bc in n;m=ei(n,e)?.set??(k&&e in n?L=>n[e]=L:void 0)}var S,p=!1;l?[S,p]=$d(()=>n[e]):S=n[e],S===void 0&&r!==void 0&&(S=g(),m&&(i&&Tc(),m(S)));var b;if(i?b=()=>{var L=n[e];return L===void 0?g():(v=!0,L)}:b=()=>{var L=n[e];return L!==void 0&&(h=void 0),L===void 0?h:L},i&&(t&Fc)===0)return b;if(m){var R=n.$$legacy;return(function(L,z){return arguments.length>0?((!i||!z||R||p)&&m(z?b():L),L):b()})}var P=!1,U=((t&Lc)!==0?Fi:hi)(()=>(P=!1,b()));l&&f(U);var q=gt;return(function(L,z){if(arguments.length>0){const H=z?f(U):i&&l?pt(L):L;return ie(U,H),P=!0,h!==void 0&&(h=H),L}return Rr&&P||(q.f&Tr)!==0?U.v:f(U)})}function In(n){Bt===null&&Ic(),di&&Bt.l!==null?Ud(Bt).m.push(n):li(()=>{const e=Pr(n);if(typeof e=="function")return e})}function Ud(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const Nd="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Nd);zc();const B=pt({showEditor:!1,showItems:!1,editingOptionIndex:null,editingItemIndex:null,editingChapterId:null,selectedChapterId:null,selectedDialogueId:null,selectedBucket:null,availableBuckets:[],data:{meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},storedFiles:[],storiesList:[],currentFileName:"dracula_story.json",statusMessage:{type:"",text:""}}),Jt={get currentDialogue(){return B.data?.dialogues.find(n=>n.id===B.selectedDialogueId)},get currentChapter(){return B.data?.chapters?.find(n=>n.id===B.selectedChapterId)},get currentEditingChapter(){return B.data?.chapters?.find(n=>n.id===B.editingChapterId)},get currentEditingOption(){return Jt.currentDialogue&&B.editingOptionIndex!==null?Jt.currentDialogue.options?.[B.editingOptionIndex]:void 0},get chapterDialogues(){return!B.data?.dialogues||!B.selectedChapterId?[]:B.data.dialogues.filter(n=>n.chapterId===B.selectedChapterId)},get imageResources(){return B.storedFiles.filter(n=>n.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i))},get riveResources(){return B.storedFiles.filter(n=>n.name.endsWith(".riv"))},get availableItems(){return B.data?.items||[]},get backlinks(){return!B.data||!B.selectedDialogueId?[]:B.data.dialogues.filter(n=>n.nextDialogueId===B.selectedDialogueId?!0:n.options?n.options.some(e=>e.nextDialogueId===B.selectedDialogueId):!1)},get hasUnsavedChanges(){return!1}},wt={toggleEditor(){B.showEditor=!B.showEditor},toggleItemsPanel(){B.showItems=!B.showItems},setStatus(n,e){B.statusMessage={type:n,text:e}},clearStatus(){B.statusMessage={type:"",text:""}},selectBucket(n){B.selectedBucket=n,B.data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]},B.storedFiles=[],B.storiesList=[],B.selectedChapterId=null,B.selectedDialogueId=null},updateBucketsList(n){B.availableBuckets=n},selectChapter(n){B.selectedChapterId=n,B.selectedDialogueId=null},selectDialogue(n){B.selectedDialogueId=n},selectOption(n){B.editingOptionIndex=n},selectItem(n){B.editingItemIndex=n},updateStoryData(n){B.data=n},updateStoredFiles(n){B.storedFiles=n},updateStoriesList(n){B.storiesList=n},setCurrentFileName(n){B.currentFileName=n},addDialogue(n){B.data.dialogues=[...B.data.dialogues,n]},updateDialogue(n,e){B.data.dialogues=B.data.dialogues.map(t=>t.id===n?{...t,...e}:t)},deleteDialogue(n){B.data.dialogues=B.data.dialogues.filter(e=>e.id!==n),B.selectedDialogueId===n&&(B.selectedDialogueId=null)},addChapter(n){B.data.chapters=[...B.data.chapters||[],n]},updateChapter(n,e){B.data.chapters&&(B.data.chapters=B.data.chapters.map(t=>t.id===n?{...t,...e}:t))},selectEditingChapter(n){B.editingChapterId=n},deleteChapter(n){B.data.chapters&&(B.data.chapters=B.data.chapters.filter(e=>e.id!==n),B.selectedChapterId===n&&(B.selectedChapterId=null,B.selectedDialogueId=null))},addItem(n){B.data.items=[...B.data.items||[],n]},updateItem(n,e){B.data.items&&(B.data.items=B.data.items.map(t=>t.id===n?{...t,...e}:t))},deleteItem(n){B.data.items&&(B.data.items=B.data.items.filter(e=>e.id!==n))},reset(){B.showEditor=!1,B.showItems=!1,B.editingOptionIndex=null,B.editingItemIndex=null,B.selectedChapterId=null,B.selectedDialogueId=null,B.statusMessage={type:"",text:""}}},Bd="modulepreload",Wd=function(n,e){return new URL(n,e).href},ll={},$i=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let g=function(m){return Promise.all(m.map(k=>Promise.resolve(k).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),v=h?.nonce||h?.getAttribute("nonce");i=g(t.map(m=>{if(m=Wd(m,r),m in ll)return;ll[m]=!0;const k=m.endsWith(".css"),S=k?'[rel="stylesheet"]':"";if(!!r)for(let R=u.length-1;R>=0;R--){const P=u[R];if(P.href===m&&(!k||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${S}`))return;const b=document.createElement("link");if(b.rel=k?"stylesheet":Bd,k||(b.as="script"),b.crossOrigin="",b.href=m,v&&b.setAttribute("nonce",v),document.head.appendChild(b),k)return new Promise((R,P)=>{b.addEventListener("load",R),b.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&l(h.reason);return e().catch(l)})},Vd=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ja extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class qd extends Ja{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ul extends Ja{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class cl extends Ja{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ia;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Ia||(Ia={}));var Gd=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};class Hd{constructor(e,{headers:t={},customFetch:r,region:i=Ia.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Vd(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Gd(this,void 0,void 0,function*(){try{const{headers:i,method:l,body:u}=t;let h={},{region:v}=t;v||(v=this.region);const g=new URL(`${this.url}/${e}`);v&&v!=="any"&&(h["x-region"]=v,g.searchParams.set("forceFunctionRegion",v));let m;u&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",m=u):typeof u=="string"?(h["Content-Type"]="text/plain",m=u):typeof FormData<"u"&&u instanceof FormData?m=u:(h["Content-Type"]="application/json",m=JSON.stringify(u)));const k=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),i),body:m}).catch(R=>{throw new qd(R)}),S=k.headers.get("x-relay-error");if(S&&S==="true")throw new ul(k);if(!k.ok)throw new cl(k);let p=((r=k.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),b;return p==="application/json"?b=yield k.json():p==="application/octet-stream"?b=yield k.blob():p==="text/event-stream"?b=k:p==="multipart/form-data"?b=yield k.formData():b=yield k.text(),{data:b,error:null,response:k}}catch(i){return{data:null,error:i,response:i instanceof cl||i instanceof ul?i.context:void 0}}})}}function zd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Kd(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Kt={},Nr={},Br={},Wr={},Vr={},qr={},Yd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ui=Yd();const Jd=ui.fetch,bu=ui.fetch.bind(ui),wu=ui.Headers,Xd=ui.Request,Qd=ui.Response,vi=Object.freeze(Object.defineProperty({__proto__:null,Headers:wu,Request:Xd,Response:Qd,default:bu,fetch:Jd},Symbol.toStringTag,{value:"Module"})),Zd=Kd(vi);var cs={},dl;function ku(){if(dl)return cs;dl=1,Object.defineProperty(cs,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return cs.default=n,cs}var fl;function Iu(){if(fl)return qr;fl=1;var n=qr&&qr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qr,"__esModule",{value:!0});const e=n(Zd),t=n(ku());class r{constructor(l){var u,h;this.shouldThrowOnError=!1,this.method=l.method,this.url=l.url,this.headers=new Headers(l.headers),this.schema=l.schema,this.body=l.body,this.shouldThrowOnError=(u=l.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=l.signal,this.isMaybeSingle=(h=l.isMaybeSingle)!==null&&h!==void 0?h:!1,l.fetch?this.fetch=l.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(l,u){return this.headers=new Headers(this.headers),this.headers.set(l,u),this}then(l,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let v=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var m,k,S,p;let b=null,R=null,P=null,U=g.status,q=g.statusText;if(g.ok){if(this.method!=="HEAD"){const C=await g.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?R=C:R=JSON.parse(C))}const z=(k=this.headers.get("Prefer"))===null||k===void 0?void 0:k.match(/count=(exact|planned|estimated)/),H=(S=g.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");z&&H&&H.length>1&&(P=parseInt(H[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(R)&&(R.length>1?(b={code:"PGRST116",details:`Results contain ${R.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},R=null,P=null,U=406,q="Not Acceptable"):R.length===1?R=R[0]:R=null)}else{const z=await g.text();try{b=JSON.parse(z),Array.isArray(b)&&g.status===404&&(R=[],b=null,U=200,q="OK")}catch{g.status===404&&z===""?(U=204,q="No Content"):b={message:z}}if(b&&this.isMaybeSingle&&(!((p=b?.details)===null||p===void 0)&&p.includes("0 rows"))&&(b=null,U=200,q="OK"),b&&this.shouldThrowOnError)throw new t.default(b)}return{error:b,data:R,count:P,status:U,statusText:q}});return this.shouldThrowOnError||(v=v.catch(g=>{var m,k,S;return{error:{message:`${(m=g?.name)!==null&&m!==void 0?m:"FetchError"}: ${g?.message}`,details:`${(k=g?.stack)!==null&&k!==void 0?k:""}`,hint:"",code:`${(S=g?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),v.then(l,u)}returns(){return this}overrideTypes(){return this}}return qr.default=r,qr}var hl;function Su(){if(hl)return Vr;hl=1;var n=Vr&&Vr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Vr,"__esModule",{value:!0});const e=n(Iu());class t extends e.default{select(i){let l=!1;const u=(i??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:l=!0,nullsFirst:u,foreignTable:h,referencedTable:v=h}={}){const g=v?`${v}.order`:"order",m=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${m?`${m},`:""}${i}.${l?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:l,referencedTable:u=l}={}){const h=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(h,`${i}`),this}range(i,l,{foreignTable:u,referencedTable:h=u}={}){const v=typeof h>"u"?"offset":`${h}.offset`,g=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(v,`${i}`),this.url.searchParams.set(g,`${l-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:l=!1,settings:u=!1,buffers:h=!1,wal:v=!1,format:g="text"}={}){var m;const k=[i?"analyze":null,l?"verbose":null,u?"settings":null,h?"buffers":null,v?"wal":null].filter(Boolean).join("|"),S=(m=this.headers.get("Accept"))!==null&&m!==void 0?m:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${g}; for="${S}"; options=${k};`),g==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Vr.default=t,Vr}var vl;function Xa(){if(vl)return Wr;vl=1;var n=Wr&&Wr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});const e=n(Su());class t extends e.default{eq(i,l){return this.url.searchParams.append(i,`eq.${l}`),this}neq(i,l){return this.url.searchParams.append(i,`neq.${l}`),this}gt(i,l){return this.url.searchParams.append(i,`gt.${l}`),this}gte(i,l){return this.url.searchParams.append(i,`gte.${l}`),this}lt(i,l){return this.url.searchParams.append(i,`lt.${l}`),this}lte(i,l){return this.url.searchParams.append(i,`lte.${l}`),this}like(i,l){return this.url.searchParams.append(i,`like.${l}`),this}likeAllOf(i,l){return this.url.searchParams.append(i,`like(all).{${l.join(",")}}`),this}likeAnyOf(i,l){return this.url.searchParams.append(i,`like(any).{${l.join(",")}}`),this}ilike(i,l){return this.url.searchParams.append(i,`ilike.${l}`),this}ilikeAllOf(i,l){return this.url.searchParams.append(i,`ilike(all).{${l.join(",")}}`),this}ilikeAnyOf(i,l){return this.url.searchParams.append(i,`ilike(any).{${l.join(",")}}`),this}is(i,l){return this.url.searchParams.append(i,`is.${l}`),this}in(i,l){const u=Array.from(new Set(l)).map(h=>typeof h=="string"&&new RegExp("[,()]").test(h)?`"${h}"`:`${h}`).join(",");return this.url.searchParams.append(i,`in.(${u})`),this}contains(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cs.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cs.{${l.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(l)}`),this}containedBy(i,l){return typeof l=="string"?this.url.searchParams.append(i,`cd.${l}`):Array.isArray(l)?this.url.searchParams.append(i,`cd.{${l.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(l)}`),this}rangeGt(i,l){return this.url.searchParams.append(i,`sr.${l}`),this}rangeGte(i,l){return this.url.searchParams.append(i,`nxl.${l}`),this}rangeLt(i,l){return this.url.searchParams.append(i,`sl.${l}`),this}rangeLte(i,l){return this.url.searchParams.append(i,`nxr.${l}`),this}rangeAdjacent(i,l){return this.url.searchParams.append(i,`adj.${l}`),this}overlaps(i,l){return typeof l=="string"?this.url.searchParams.append(i,`ov.${l}`):this.url.searchParams.append(i,`ov.{${l.join(",")}}`),this}textSearch(i,l,{config:u,type:h}={}){let v="";h==="plain"?v="pl":h==="phrase"?v="ph":h==="websearch"&&(v="w");const g=u===void 0?"":`(${u})`;return this.url.searchParams.append(i,`${v}fts${g}.${l}`),this}match(i){return Object.entries(i).forEach(([l,u])=>{this.url.searchParams.append(l,`eq.${u}`)}),this}not(i,l,u){return this.url.searchParams.append(i,`not.${l}.${u}`),this}or(i,{foreignTable:l,referencedTable:u=l}={}){const h=u?`${u}.or`:"or";return this.url.searchParams.append(h,`(${i})`),this}filter(i,l,u){return this.url.searchParams.append(i,`${l}.${u}`),this}}return Wr.default=t,Wr}var pl;function Eu(){if(pl)return Br;pl=1;var n=Br&&Br.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Br,"__esModule",{value:!0});const e=n(Xa());class t{constructor(i,{headers:l={},schema:u,fetch:h}){this.url=i,this.headers=new Headers(l),this.schema=u,this.fetch=h}select(i,{head:l=!1,count:u}={}){const h=l?"HEAD":"GET";let v=!1;const g=(i??"*").split("").map(m=>/\s/.test(m)&&!v?"":(m==='"'&&(v=!v),m)).join("");return this.url.searchParams.set("select",g),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:l,defaultToNull:u=!0}={}){var h;const v="POST";if(l&&this.headers.append("Prefer",`count=${l}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const g=i.reduce((m,k)=>m.concat(Object.keys(k)),[]);if(g.length>0){const m=[...new Set(g)].map(k=>`"${k}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:v,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}upsert(i,{onConflict:l,ignoreDuplicates:u=!1,count:h,defaultToNull:v=!0}={}){var g;const m="POST";if(this.headers.append("Prefer",`resolution=${u?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),h&&this.headers.append("Prefer",`count=${h}`),v||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const k=i.reduce((S,p)=>S.concat(Object.keys(p)),[]);if(k.length>0){const S=[...new Set(k)].map(p=>`"${p}"`);this.url.searchParams.set("columns",S.join(","))}}return new e.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}update(i,{count:l}={}){var u;const h="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}delete({count:i}={}){var l;const u="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return Br.default=t,Br}var gl;function ef(){if(gl)return Nr;gl=1;var n=Nr&&Nr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Nr,"__esModule",{value:!0});const e=n(Eu()),t=n(Xa());class r{constructor(l,{headers:u={},schema:h,fetch:v}={}){this.url=l,this.headers=new Headers(u),this.schemaName=h,this.fetch=v}from(l){const u=new URL(`${this.url}/${l}`);return new e.default(u,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new r(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,u={},{head:h=!1,get:v=!1,count:g}={}){var m;let k;const S=new URL(`${this.url}/rpc/${l}`);let p;h||v?(k=h?"HEAD":"GET",Object.entries(u).filter(([R,P])=>P!==void 0).map(([R,P])=>[R,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([R,P])=>{S.searchParams.append(R,P)})):(k="POST",p=u);const b=new Headers(this.headers);return g&&b.set("Prefer",`count=${g}`),new t.default({method:k,url:S,headers:b,schema:this.schemaName,body:p,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}}return Nr.default=r,Nr}var _l;function tf(){if(_l)return Kt;_l=1;var n=Kt&&Kt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PostgrestError=Kt.PostgrestBuilder=Kt.PostgrestTransformBuilder=Kt.PostgrestFilterBuilder=Kt.PostgrestQueryBuilder=Kt.PostgrestClient=void 0;const e=n(ef());Kt.PostgrestClient=e.default;const t=n(Eu());Kt.PostgrestQueryBuilder=t.default;const r=n(Xa());Kt.PostgrestFilterBuilder=r.default;const i=n(Su());Kt.PostgrestTransformBuilder=i.default;const l=n(Iu());Kt.PostgrestBuilder=l.default;const u=n(ku());return Kt.PostgrestError=u.default,Kt.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:l.default,PostgrestError:u.default},Kt}var nf=tf();const rf=zd(nf),{PostgrestClient:sf,PostgrestQueryBuilder:I_,PostgrestFilterBuilder:S_,PostgrestTransformBuilder:E_,PostgrestBuilder:A_,PostgrestError:C_}=rf;class af{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const of="2.15.1",lf=`realtime-js/${of}`,uf="1.0.0",Sa=1e4,cf=1e3,df=100;var Ti;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ti||(Ti={}));var qt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(qt||(qt={}));var wn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(wn||(wn={}));var Ea;(function(n){n.websocket="websocket"})(Ea||(Ea={}));var Ir;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ir||(Ir={}));class ff{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),l=t.getUint8(2);let u=this.HEADER_LENGTH+2;const h=r.decode(e.slice(u,u+i));u=u+i;const v=r.decode(e.slice(u,u+l));u=u+l;const g=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:h,event:v,payload:g}}}class Au{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Rt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Rt||(Rt={}));const ml=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((l,u)=>(l[u]=hf(u,n,e,i),l),{})},hf=(n,e,t,r)=>{const i=e.find(h=>h.name===n),l=i?.type,u=t[n];return l&&!r.includes(l)?Cu(l,u):Aa(u)},Cu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _f(e,t)}switch(n){case Rt.bool:return vf(e);case Rt.float4:case Rt.float8:case Rt.int2:case Rt.int4:case Rt.int8:case Rt.numeric:case Rt.oid:return pf(e);case Rt.json:case Rt.jsonb:return gf(e);case Rt.timestamp:return mf(e);case Rt.abstime:case Rt.date:case Rt.daterange:case Rt.int4range:case Rt.int8range:case Rt.money:case Rt.reltime:case Rt.text:case Rt.time:case Rt.timestamptz:case Rt.timetz:case Rt.tsrange:case Rt.tstzrange:return Aa(e);default:return Aa(e)}},Aa=n=>n,vf=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},pf=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},gf=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_f=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let l;const u=n.slice(1,t);try{l=JSON.parse("["+u+"]")}catch{l=u?u.split(","):[]}return l.map(h=>Cu(e,h))}return n},mf=n=>typeof n=="string"?n.replace(" ","T"):n,ju=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class aa{constructor(e,t,r={},i=Sa){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var yl;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(yl||(yl={}));class xi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xi.syncState(this.state,i,l,u),this.pendingDiffs.forEach(v=>{this.state=xi.syncDiff(this.state,v,l,u)}),this.pendingDiffs=[],h()}),this.channel._on(r.diff,{},i=>{const{onJoin:l,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=xi.syncDiff(this.state,i,l,u),h())}),this.onJoin((i,l,u)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:l,newPresences:u})}),this.onLeave((i,l,u)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:l,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const l=this.cloneDeep(e),u=this.transformState(t),h={},v={};return this.map(l,(g,m)=>{u[g]||(v[g]=m)}),this.map(u,(g,m)=>{const k=l[g];if(k){const S=m.map(P=>P.presence_ref),p=k.map(P=>P.presence_ref),b=m.filter(P=>p.indexOf(P.presence_ref)<0),R=k.filter(P=>S.indexOf(P.presence_ref)<0);b.length>0&&(h[g]=b),R.length>0&&(v[g]=R)}else h[g]=m}),this.syncDiff(l,{joins:h,leaves:v},r,i)}static syncDiff(e,t,r,i){const{joins:l,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(l,(h,v)=>{var g;const m=(g=e[h])!==null&&g!==void 0?g:[];if(e[h]=this.cloneDeep(v),m.length>0){const k=e[h].map(p=>p.presence_ref),S=m.filter(p=>k.indexOf(p.presence_ref)<0);e[h].unshift(...S)}r(h,m,v)}),this.map(u,(h,v)=>{let g=e[h];if(!g)return;const m=v.map(k=>k.presence_ref);g=g.filter(k=>m.indexOf(k.presence_ref)<0),e[h]=g,i(h,g,v),g.length===0&&delete e[h]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bl;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(bl||(bl={}));var Ri;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ri||(Ri={}));var Bn;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Bn||(Bn={}));class Qa{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new aa(this,wn.join,this.params,this.timeout),this.rejoinTimer=new Au(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wn.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new xi(this),this.broadcastEndpointURL=ju(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.state==qt.closed){const{config:{broadcast:l,presence:u,private:h}}=this.params,v=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(S=>S.filter))!==null&&i!==void 0?i:[],g=!!this.bindings[Ri.PRESENCE]&&this.bindings[Ri.PRESENCE].length>0,m={},k={broadcast:l,presence:Object.assign(Object.assign({},u),{enabled:g}),postgres_changes:v,private:h};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(S=>e?.(Bn.CHANNEL_ERROR,S)),this._onClose(()=>e?.(Bn.CLOSED)),this.updateJoinPayload(Object.assign({config:k},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var p;if(this.socket.setAuth(),S===void 0){e?.(Bn.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,R=(p=b?.length)!==null&&p!==void 0?p:0,P=[];for(let U=0;U<R;U++){const q=b[U],{filter:{event:L,schema:z,table:H,filter:C}}=q,T=S&&S[U];if(T&&T.event===L&&T.schema===z&&T.table===H&&T.filter===C)P.push(Object.assign(Object.assign({},q),{id:T.id}));else{this.unsubscribe(),this.state=qt.errored,e?.(Bn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e(Bn.SUBSCRIBED);return}}).receive("error",S=>{this.state=qt.errored,e?.(Bn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e?.(Bn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===qt.joined&&e===Ri.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:l,payload:u}=e,v={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:u,private:this.private}]})};try{const g=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=g.body)===null||i===void 0?void 0:i.cancel()),g.ok?"ok":"error"}catch(g){return g.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var u,h,v;const g=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((v=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||v===void 0)&&v.ack)&&l("ok"),g.receive("ok",()=>l("ok")),g.receive("error",()=>l("error")),g.receive("timeout",()=>l("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new aa(this,wn.leave,{},e),r.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qt.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const i=new AbortController,l=setTimeout(()=>i.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(l),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new aa(this,e,t,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>df){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,l;const u=e.toLocaleLowerCase(),{close:h,error:v,leave:g,join:m}=wn;if(r&&[h,v,g,m].indexOf(u)>=0&&r!==this._joinRef())return;let S=this._onMessage(u,t,r);if(t&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var b,R,P;return((b=p.filter)===null||b===void 0?void 0:b.event)==="*"||((P=(R=p.filter)===null||R===void 0?void 0:R.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===u}).map(p=>p.callback(S,r)):(l=this.bindings[u])===null||l===void 0||l.filter(p=>{var b,R,P,U,q,L;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in p){const z=p.id,H=(b=p.filter)===null||b===void 0?void 0:b.event;return z&&((R=t.ids)===null||R===void 0?void 0:R.includes(z))&&(H==="*"||H?.toLocaleLowerCase()===((P=t.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const z=(q=(U=p?.filter)===null||U===void 0?void 0:U.event)===null||q===void 0?void 0:q.toLocaleLowerCase();return z==="*"||z===((L=t?.event)===null||L===void 0?void 0:L.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===u}).map(p=>{if(typeof S=="object"&&"ids"in S){const b=S.data,{schema:R,table:P,commit_timestamp:U,type:q,errors:L}=b;S=Object.assign(Object.assign({},{schema:R,table:P,commit_timestamp:U,eventType:q,new:{},old:{},errors:L}),this._getPayloadRecords(b))}p.callback(S,r)})}_isClosed(){return this.state===qt.closed}_isJoined(){return this.state===qt.joined}_isJoining(){return this.state===qt.joining}_isLeaving(){return this.state===qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),l={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(l):this.bindings[i]=[l],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var l;return!(((l=i.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===r&&Qa.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(wn.close,{},e)}_onError(e){this._on(wn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ml(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ml(e.columns,e.old_record)),t}}const wl=()=>{},ds={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},yf=[1e3,2e3,5e3,1e4],bf=1e4,wf=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class kf{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Sa,this.transport=null,this.heartbeatIntervalMs=ds.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=wl,this.ref=0,this.reconnectTimer=null,this.logger=wl,this.conn=null,this.sendBuffer=[],this.serializer=new ff,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...u)=>$i(async()=>{const{default:h}=await Promise.resolve().then(()=>vi);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...u)).catch(h=>{throw new Error(`Failed to load @supabase/node-fetch: ${h.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):l=fetch,(...u)=>l(...u)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ea.websocket}`,this.httpEndpoint=ju(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=af.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:uf}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ti.connecting:return Ir.Connecting;case Ti.open:return Ir.Open;case Ti.closing:return Ir.Closing;default:return Ir.Closed}}isConnected(){return this.connectionState()===Ir.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(l=>l.topic===r);if(i)return i;{const l=new Qa(`realtime:${e}`,t,this);return this.channels.push(l),l}}push(e){const{topic:t,event:r,payload:i,ref:l}=e,u=()=>{this.encode(e,h=>{var v;(v=this.conn)===null||v===void 0||v.send(h)})};this.log("push",`${t} ${r} (${l})`,i),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(cf,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ds.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:l,ref:u}=t,h=u?`(${u})`:"",v=l.status||"";this.log("receive",`${v} ${r} ${i} ${h}`.trim(),l),this.channels.filter(g=>g._isMember(r)).forEach(g=>g._trigger(i,l,u)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(wn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([wf],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const i={access_token:t,version:lf};t&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(wn.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Au(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ds.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,i,l,u,h,v,g;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Sa,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:ds.HEARTBEAT_INTERVAL,this.worker=(l=e?.worker)!==null&&l!==void 0?l:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(m=>yf[m-1]||bf),this.encode=(v=e?.encode)!==null&&v!==void 0?v:((m,k)=>k(JSON.stringify(m))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class Za extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Gt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class If extends Za{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ca extends Za{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Sf=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};const Tu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ef=()=>Sf(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $i(()=>Promise.resolve().then(()=>vi),void 0,import.meta.url)).Response:Response}),ja=n=>{if(Array.isArray(n))return n.map(t=>ja(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));e[i]=ja(r)}),e},Af=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Or=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};const oa=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Cf=(n,e,t)=>Or(void 0,void 0,void 0,function*(){const r=yield Ef();n instanceof r&&!t?.noResolveJson?n.json().then(i=>{const l=n.status||500,u=i?.statusCode||l+"";e(new If(oa(i),l,u))}).catch(i=>{e(new Ca(oa(i),i))}):e(new Ca(oa(n),n))}),jf=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"||!r?i:(Af(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(r)):i.body=r,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function Ui(n,e,t,r,i,l){return Or(this,void 0,void 0,function*(){return new Promise((u,h)=>{n(t,jf(e,r,i,l)).then(v=>{if(!v.ok)throw v;return r?.noResolveJson?v:v.json()}).then(v=>u(v)).catch(v=>Cf(v,h,r))})})}function Is(n,e,t,r){return Or(this,void 0,void 0,function*(){return Ui(n,"GET",e,t,r)})}function jn(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"POST",e,r,i,t)})}function Ta(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"PUT",e,r,i,t)})}function Tf(n,e,t,r){return Or(this,void 0,void 0,function*(){return Ui(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function xu(n,e,t,r,i){return Or(this,void 0,void 0,function*(){return Ui(n,"DELETE",e,r,i,t)})}var en=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};const xf={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Rf{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Tu(i)}uploadOrUpdate(e,t,r,i){return en(this,void 0,void 0,function*(){try{let l;const u=Object.assign(Object.assign({},kl),i);let h=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const v=u.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl),v&&l.append("metadata",this.encodeMetadata(v))):(l=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,v&&(h["x-metadata"]=this.toBase64(this.encodeMetadata(v)))),i?.headers&&(h=Object.assign(Object.assign({},h),i.headers));const g=this._removeEmptyFolders(t),m=this._getFinalPath(g),k=yield(e=="PUT"?Ta:jn)(this.fetch,`${this.url}/object/${m}`,l,Object.assign({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{data:{path:g,id:k.Id,fullPath:k.Key},error:null}}catch(l){if(Gt(l))return{data:null,error:l};throw l}})}upload(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return en(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),h=new URL(this.url+`/object/upload/sign/${u}`);h.searchParams.set("token",t);try{let v;const g=Object.assign({upsert:kl.upsert},i),m=Object.assign(Object.assign({},this.headers),{"x-upsert":String(g.upsert)});typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",g.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",g.cacheControl)):(v=r,m["cache-control"]=`max-age=${g.cacheControl}`,m["content-type"]=g.contentType);const k=yield Ta(this.fetch,h.toString(),v,{headers:m});return{data:{path:l,fullPath:k.Key},error:null}}catch(v){if(Gt(v))return{data:null,error:v};throw v}})}createSignedUploadUrl(e,t){return en(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const l=yield jn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),u=new URL(this.url+l.url),h=u.searchParams.get("token");if(!h)throw new Za("No token returned by API");return{data:{signedUrl:u.toString(),path:e,token:h},error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}update(e,t,r){return en(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return en(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}copy(e,t,r){return en(this,void 0,void 0,function*(){try{return{data:{path:(yield jn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return en(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),l=yield jn(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${u}`)},{data:l,error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return en(this,void 0,void 0,function*(){try{const i=yield jn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),l=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${l}`):null})),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}download(e,t){return en(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),u=l?`?${l}`:"";try{const h=this._getFinalPath(e);return{data:yield(yield Is(this.fetch,`${this.url}/${i}/${h}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(h){if(Gt(h))return{data:null,error:h};throw h}})}info(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Is(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ja(r),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}exists(e){return en(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Tf(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Gt(r)&&r instanceof Ca){const i=r.originalError;if([400,404].includes(i?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],l=t?.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&i.push(l);const h=typeof t?.transform<"u"?"render/image":"object",v=this.transformOptsToQueryString(t?.transform||{});v!==""&&i.push(v);let g=i.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${h}/public/${r}${g}`)}}}remove(e){return en(this,void 0,void 0,function*(){try{return{data:yield xu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}list(e,t,r){return en(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},xf),t),{prefix:e||""});return{data:yield jn(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(Gt(i))return{data:null,error:i};throw i}})}listV2(e,t){return en(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield jn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Pf="2.11.0",Of={"X-Client-Info":`storage-js/${Pf}`};var Gr=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};class Mf{constructor(e,t={},r,i){const l=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href,this.headers=Object.assign(Object.assign({},Of),t),this.fetch=Tu(r)}listBuckets(){return Gr(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Gt(e))return{data:null,error:e};throw e}})}getBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Gr(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Gr(this,void 0,void 0,function*(){try{return{data:yield Ta(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Gt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Gr(this,void 0,void 0,function*(){try{return{data:yield xu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Gt(t))return{data:null,error:t};throw t}})}}class Lf extends Mf{constructor(e,t={},r,i){super(e,t,r,i)}from(e){return new Rf(this.url,this.headers,e,this.fetch)}}const Df="2.56.0";let Ci="";typeof Deno<"u"?Ci="deno":typeof document<"u"?Ci="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ci="react-native":Ci="node";const Ff={"X-Client-Info":`supabase-js-${Ci}/${Df}`},$f={headers:Ff},Uf={schema:"public"},Nf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Bf={};var Wf=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};const Vf=n=>{let e;return n?e=n:typeof fetch>"u"?e=bu:e=fetch,(...t)=>e(...t)},qf=()=>typeof Headers>"u"?wu:Headers,Gf=(n,e,t)=>{const r=Vf(t),i=qf();return(l,u)=>Wf(void 0,void 0,void 0,function*(){var h;const v=(h=yield e())!==null&&h!==void 0?h:n;let g=new i(u?.headers);return g.has("apikey")||g.set("apikey",n),g.has("Authorization")||g.set("Authorization",`Bearer ${v}`),r(l,Object.assign(Object.assign({},u),{headers:g}))})};var Hf=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};function zf(n){return n.endsWith("/")?n:n+"/"}function Kf(n,e){var t,r;const{db:i,auth:l,realtime:u,global:h}=n,{db:v,auth:g,realtime:m,global:k}=e,S={db:Object.assign(Object.assign({},v),i),auth:Object.assign(Object.assign({},g),l),realtime:Object.assign(Object.assign({},m),u),storage:{},global:Object.assign(Object.assign(Object.assign({},k),h),{headers:Object.assign(Object.assign({},(t=k?.headers)!==null&&t!==void 0?t:{}),(r=h?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Hf(this,void 0,void 0,function*(){return""})};return n.accessToken?S.accessToken=n.accessToken:delete S.accessToken,S}const Ru="2.71.1",Xr=30*1e3,xa=3,la=xa*Xr,Yf="http://localhost:9999",Jf="supabase.auth.token",Xf={"X-Client-Info":`gotrue-js/${Ru}`},Ra="X-Supabase-Api-Version",Pu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Qf=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Zf=600*1e3;class eo extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Qe(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class eh extends eo{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function th(n){return Qe(n)&&n.name==="AuthApiError"}class Ou extends eo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ar extends eo{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class Yn extends ar{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function nh(n){return Qe(n)&&n.name==="AuthSessionMissingError"}class fs extends ar{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class hs extends ar{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vs extends ar{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function rh(n){return Qe(n)&&n.name==="AuthImplicitGrantRedirectError"}class Il extends ar{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Pa extends ar{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ua(n){return Qe(n)&&n.name==="AuthRetryableFetchError"}class Sl extends ar{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Oa extends ar{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),El=` 	
\r=`.split(""),ih=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<El.length;e+=1)n[El[e].charCodeAt(0)]=-2;for(let e=0;e<Ss.length;e+=1)n[Ss[e].charCodeAt(0)]=e;return n})();function Al(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ss[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Ss[r]),e.queuedBits-=6}}function Mu(n,e,t){const r=ih[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Cl(n){const e=[],t=u=>{e.push(String.fromCodePoint(u))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},l=u=>{oh(u,r,t)};for(let u=0;u<n.length;u+=1)Mu(n.charCodeAt(u),i,l);return e.join("")}function sh(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function ah(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}sh(r,e)}}function oh(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function lh(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)Mu(n.charCodeAt(i),t,r);return new Uint8Array(e)}function uh(n){const e=[];return ah(n,t=>e.push(t)),new Uint8Array(e)}function ch(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return n.forEach(i=>Al(i,t,r)),Al(null,t,r),e.join("")}function dh(n){return Math.round(Date.now()/1e3)+n}function fh(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const yn=()=>typeof window<"u"&&typeof document<"u",_r={tested:!1,writable:!1},Lu=()=>{if(!yn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_r.tested)return _r.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),_r.tested=!0,_r.writable=!0}catch{_r.tested=!0,_r.writable=!1}return _r.writable};function hh(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,l)=>{e[l]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const Du=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>$i(async()=>{const{default:r}=await Promise.resolve().then(()=>vi);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},vh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Qr=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},mr=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Kn=async(n,e)=>{await n.removeItem(e)};class Fs{constructor(){this.promise=new Fs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Fs.promiseConstructor=Promise;function ca(n){const e=n.split(".");if(e.length!==3)throw new Oa("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Qf.test(e[r]))throw new Oa("JWT not in base64url format");return{header:JSON.parse(Cl(e[0])),payload:JSON.parse(Cl(e[1])),signature:lh(e[2]),raw:{header:e[0],payload:e[1]}}}async function ph(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function gh(n,e){return new Promise((r,i)=>{(async()=>{for(let l=0;l<1/0;l++)try{const u=await n(l);if(!e(l,null,u)){r(u);return}}catch(u){if(!e(l,u)){i(u);return}}})()})}function _h(n){return("0"+n.toString(16)).substr(-2)}function mh(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let l=0;l<56;l++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,_h).join("")}async function yh(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(l=>String.fromCharCode(l)).join("")}async function bh(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await yh(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hr(n,e,t=!1){const r=mh();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await Qr(n,`${e}-code-verifier`,i);const l=await bh(r);return[l,r===l?"plain":"s256"]}const wh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kh(n){const e=n.headers.get(Ra);if(!e||!e.match(wh))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ih(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Sh(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Eh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function zr(n){if(!Eh.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function da(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function jl(n){return JSON.parse(JSON.stringify(n))}var Ah=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const wr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ch=[502,503,504];async function Tl(n){var e;if(!vh(n))throw new Pa(wr(n),0);if(Ch.includes(n.status))throw new Pa(wr(n),n.status);let t;try{t=await n.json()}catch(l){throw new Ou(wr(l),l)}let r;const i=kh(n);if(i&&i.getTime()>=Pu["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Sl(wr(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Yn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((l,u)=>l&&typeof u=="string",!0))throw new Sl(wr(t),n.status,t.weak_password.reasons);throw new eh(wr(t),n.status||500,r)}const jh=(n,e,t,r)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function ot(n,e,t,r){var i;const l=Object.assign({},r?.headers);l[Ra]||(l[Ra]=Pu["2024-01-01"].name),r?.jwt&&(l.Authorization=`Bearer ${r.jwt}`);const u=(i=r?.query)!==null&&i!==void 0?i:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",v=await Th(n,e,t+h,{headers:l,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(v):{data:Object.assign({},v),error:null}}async function Th(n,e,t,r,i,l){const u=jh(e,r,i,l);let h;try{h=await n(t,Object.assign({},u))}catch(v){throw console.error(v),new Pa(wr(v),0)}if(h.ok||await Tl(h),r?.noResolveJson)return h;try{return await h.json()}catch(v){await Tl(v)}}function Nn(n){var e;let t=null;Oh(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=dh(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function xl(n){const e=Nn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Xn(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function xh(n){return{data:n,error:null}}function Rh(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:l}=n,u=Ah(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:l},v=Object.assign({},u);return{data:{properties:h,user:v},error:null}}function Ph(n){return n}function Oh(n){return n.access_token&&n.refresh_token&&n.expires_in}const fa=["global","local","others"];var Mh=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class Lh{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Du(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=fa[0]){if(fa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fa.join(", ")}`);try{return await ot(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ot(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Xn})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Mh(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r?.newEmail,delete i.newEmail),await ot(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Rh,redirectTo:t?.redirectTo})}catch(t){if(Qe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ot(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Xn})}catch(t){if(Qe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,l,u,h,v;try{const g={nextPage:null,lastPage:0,total:0},m=await ot(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(l=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:Ph});if(m.error)throw m.error;const k=await m.json(),S=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,p=(v=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&v!==void 0?v:[];return p.length>0&&(p.forEach(b=>{const R=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(b.split(";")[1].split("=")[1]);g[`${P}Page`]=R}),g.total=parseInt(S)),{data:Object.assign(Object.assign({},k),g),error:null}}catch(g){if(Qe(g))return{data:{users:[]},error:g};throw g}}async getUserById(e){zr(e);try{return await ot(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Xn})}catch(t){if(Qe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){zr(e);try{return await ot(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Xn})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){zr(e);try{return await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Xn})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){zr(e.userId);try{const{data:t,error:r}=await ot(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){zr(e.userId),zr(e.id);try{return{data:await ot(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}}function Rl(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Dh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Kr={debug:!!(globalThis&&Lu()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Fu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Fh extends Fu{}async function $h(n,e,t){Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Kr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Fh(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Kr.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Dh();const Uh={url:Yf,storageKey:Jf,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Pl(n,e,t){return await t()}const Yr={};class Li{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Li.nextInstanceID,Li.nextInstanceID+=1,this.instanceID>0&&yn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Uh),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Lh({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Du(i.fetch),this.lock=i.lock||Pl,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:yn()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=$h:this.lock=Pl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Lu()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Rl(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Rl(this.memoryStorage)),yn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Yr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ru}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=hh(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),yn()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:l}=await this._getSessionFromURL(t,r);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),rh(l)){const v=(e=l.details)===null||e===void 0?void 0:e.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:u,redirectType:h}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Qe(t)?{error:t}:{error:new Ou("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Nn}),{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Qe(l))return{data:{user:null,session:null},error:l};throw l}}async signUp(e){var t,r,i;try{let l;if("email"in e){const{email:m,password:k,options:S}=e;let p=null,b=null;this.flowType==="pkce"&&([p,b]=await Hr(this.storage,this.storageKey)),l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S?.emailRedirectTo,body:{email:m,password:k,data:(t=S?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:S?.captchaToken},code_challenge:p,code_challenge_method:b},xform:Nn})}else if("phone"in e){const{phone:m,password:k,options:S}=e;l=await ot(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:k,data:(r=S?.data)!==null&&r!==void 0?r:{},channel:(i=S?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Nn})}else throw new hs("You must provide either an email or phone number and a password");const{data:u,error:h}=l;if(h||!u)return{data:{user:null,session:null},error:h};const v=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(l){if(Qe(l))return{data:{user:null,session:null},error:l};throw l}}async signInWithPassword(e){try{let t;if("email"in e){const{email:l,password:u,options:h}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:xl})}else if("phone"in e){const{phone:l,password:u,options:h}=e;t=await ot(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:xl})}else throw new hs("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new fs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,l;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(l=e.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,i,l,u,h,v,g,m,k,S,p;let b,R;if("message"in e)b=e.message,R=e.signature;else{const{chain:P,wallet:U,statement:q,options:L}=e;let z;if(yn())if(typeof U=="object")z=U;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))z=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=U}const H=new URL((t=L?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in z&&z.signIn){const C=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},L?.signInWithSolana),{version:"1",domain:H.host,uri:H.href}),q?{statement:q}:null));let T;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")T=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)T=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)b=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),R=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${H.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${H.href}`,`Issued At: ${(i=(r=L?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((l=L?.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${L.signInWithSolana.notBefore}`]:[],...!((u=L?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${L.signInWithSolana.expirationTime}`]:[],...!((h=L?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${L.signInWithSolana.chainId}`]:[],...!((v=L?.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${L.signInWithSolana.nonce}`]:[],...!((g=L?.signInWithSolana)===null||g===void 0)&&g.requestId?[`Request ID: ${L.signInWithSolana.requestId}`]:[],...!((k=(m=L?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||k===void 0)&&k.length?["Resources",...L.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const C=await z.signMessage(new TextEncoder().encode(b),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");R=C}}try{const{data:P,error:U}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:ch(R)},!((S=e.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Nn});if(U)throw U;return!P||!P.session||!P.user?{data:{user:null,session:null},error:new fs}:(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),{data:Object.assign({},P),error:U})}catch(P){if(Qe(P))return{data:{user:null,session:null},error:P};throw P}}async _exchangeCodeForSession(e){const t=await mr(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:l,error:u}=await ot(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Nn});if(await Kn(this.storage,`${this.storageKey}-code-verifier`),u)throw u;return!l||!l.session||!l.user?{data:{user:null,session:null,redirectType:null},error:new fs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:Object.assign(Object.assign({},l),{redirectType:i??null}),error:u})}catch(l){if(Qe(l))return{data:{user:null,session:null,redirectType:null},error:l};throw l}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:l,nonce:u}=e,h=await ot(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:l,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Nn}),{data:v,error:g}=h;return g?{data:{user:null,session:null},error:g}:!v||!v.session||!v.user?{data:{user:null,session:null},error:new fs}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:v,error:g})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,l,u;try{if("email"in e){const{email:h,options:v}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await Hr(this.storage,this.storageKey));const{error:k}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(t=v?.data)!==null&&t!==void 0?t:{},create_user:(r=v?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:g,code_challenge_method:m},redirectTo:v?.emailRedirectTo});return{data:{user:null,session:null},error:k}}if("phone"in e){const{phone:h,options:v}=e,{data:g,error:m}=await ot(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(i=v?.data)!==null&&i!==void 0?i:{},create_user:(l=v?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:v?.captchaToken},channel:(u=v?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:g?.message_id},error:m}}throw new hs("You must provide either an email or phone number.")}catch(h){if(Qe(h))return{data:{user:null,session:null},error:h};throw h}}async verifyOtp(e){var t,r;try{let i,l;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,l=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:h}=await ot(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:l}}),redirectTo:i,xform:Nn});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const v=u.session,g=u.user;return v?.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),{data:{user:g,session:v},error:null}}catch(i){if(Qe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let l=null,u=null;return this.flowType==="pkce"&&([l,u]=await Hr(this.storage,this.storageKey)),await ot(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:u}),headers:this.headers,xform:xh})}catch(l){if(Qe(l))return{data:null,error:l};throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Yn;const{error:i}=await ot(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Qe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:l}=e,{error:u}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:i,options:l}=e,{data:u,error:h}=await ot(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:l?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new hs("You must provide either an email or phone number and a type")}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await mr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<la:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const u=await mr(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=da()}if(this.storage.isServer&&e.user){let u=this.suppressGetSessionWarning;e=new Proxy(e,{get:(v,g,m)=>(!u&&g==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),u=!0,this.suppressGetSessionWarning=!0),Reflect.get(v,g,m))})}return{data:{session:e},error:null}}const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{session:null},error:l}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Xn}):await this._useSession(async t=>{var r,i,l;const{data:u,error:h}=t;if(h)throw h;return!(!((r=u.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yn}:await ot(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&l!==void 0?l:void 0,xform:Xn})})}catch(t){if(Qe(t))return nh(t)&&(await this._removeSession(),await Kn(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:l}=r;if(l)throw l;if(!i.session)throw new Yn;const u=i.session;let h=null,v=null;this.flowType==="pkce"&&e.email!=null&&([h,v]=await Hr(this.storage,this.storageKey));const{data:g,error:m}=await ot(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:v}),jwt:u.access_token,xform:Xn});if(m)throw m;return u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yn;const t=Date.now()/1e3;let r=t,i=!0,l=null;const{payload:u}=ca(e.access_token);if(u.exp&&(r=u.exp,i=r<=t),i){const{session:h,error:v}=await this._callRefreshToken(e.refresh_token);if(v)return{data:{user:null,session:null},error:v};if(!h)return{data:{user:null,session:null},error:null};l=h}else{const{data:h,error:v}=await this._getUser(e.access_token);if(v)throw v;l={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return{data:{user:l.user,session:l},error:null}}catch(t){if(Qe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:h}=t;if(h)throw h;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Yn;const{session:i,error:l}=await this._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Qe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!yn())throw new vs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Il("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Il("No code detected.");const{data:q,error:L}=await this._exchangeCodeForSession(e.code);if(L)throw L;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:l,refresh_token:u,expires_in:h,expires_at:v,token_type:g}=e;if(!l||!h||!u||!g)throw new vs("No session defined in URL");const m=Math.round(Date.now()/1e3),k=parseInt(h);let S=m+k;v&&(S=parseInt(v));const p=S-m;p*1e3<=Xr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${k}s`);const b=S-k;m-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,S,m):m-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,S,m);const{data:R,error:P}=await this._getUser(l);if(P)throw P;const U={provider_token:r,provider_refresh_token:i,access_token:l,expires_in:k,expires_at:S,refresh_token:u,token_type:g,user:R.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:U,redirectType:e.type},error:null}}catch(r){if(Qe(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:l}=t;if(l)return{error:l};const u=(r=i.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(th(h)&&(h.status===404||h.status===401||h.status===403)))return{error:h}}return e!=="others"&&(await this._removeSession(),await Kn(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=fh(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:l},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Hr(this.storage,this.storageKey,!0));try{return await ot(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(l){if(Qe(l))return{data:null,error:l};throw l}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async l=>{var u,h,v,g,m;const{data:k,error:S}=l;if(S)throw S;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(v=e.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await ot(this.fetch,"GET",p,{headers:this.headers,jwt:(m=(g=k.session)===null||g===void 0?void 0:g.access_token)!==null&&m!==void 0?m:void 0})});if(i)throw i;return yn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Qe(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:l,error:u}=t;if(u)throw u;return await ot(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await gh(async i=>(i>0&&await ph(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await ot(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Nn})),(i,l)=>{const u=200*Math.pow(2,i);return l&&ua(l)&&Date.now()+u-r<Xr})}catch(r){if(this._debug(t,"error",r),Qe(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),yn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await mr(this.storage,this.storageKey);if(i&&this.userStorage){let u=await mr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},await Qr(this.userStorage,this.storageKey+"-user",u)),i.user=(e=u?.user)!==null&&e!==void 0?e:da()}else if(i&&!i.user&&!i.user){const u=await mr(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,await Kn(this.storage,this.storageKey+"-user"),await Qr(this.storage,this.storageKey,i)):i.user=da()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const l=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<la;if(this._debug(r,`session has${l?"":" not"} expired with margin of ${la}s`),l){if(this.autoRefreshToken&&i.refresh_token){const{error:u}=await this._callRefreshToken(i.refresh_token);u&&(console.error(u),ua(u)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(i.access_token);!h&&u?.user?(i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(r,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Yn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Fs;const{data:l,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!l.session)throw new Yn;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const h={session:l.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(l){if(this._debug(i,"error",l),Qe(l)){const u={session:null,error:l};return ua(l)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(l),l}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const l=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,t)}catch(v){l.push(v)}});if(await Promise.all(u),l.length>0){for(let h=0;h<l.length;h+=1)console.error(l[h]);throw l[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Qr(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const l=jl(i);await Qr(this.storage,this.storageKey,l)}else{const i=jl(t);await Qr(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Kn(this.storage,this.storageKey),await Kn(this.storage,this.storageKey+"-code-verifier"),await Kn(this.storage,this.storageKey+"-user"),this.userStorage&&await Kn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&yn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Xr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Xr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Xr}ms, refresh threshold is ${xa} ticks`),i<=xa&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Fu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!yn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[l,u]=await Hr(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(h.toString())}if(r?.queryParams){const l=new URLSearchParams(r.queryParams);i.push(l.toString())}return r?.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:l,error:u}=t;if(u)return{data:null,error:u};const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:v,error:g}=await ot(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(r=l?.session)===null||r===void 0?void 0:r.access_token});return g?{data:null,error:g}:(e.factorType==="totp"&&(!((i=v?.totp)===null||i===void 0)&&i.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),{data:v,error:null})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;if(l)return{data:null,error:l};const{data:u,error:h}=await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:h})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:l}=t;return l?{data:null,error:l}:await ot(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Qe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],i=r.filter(u=>u.factor_type==="totp"&&u.status==="verified"),l=r.filter(u=>u.factor_type==="phone"&&u.status==="verified");return{data:{all:r,totp:i,phone:l},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:l}=e;if(l)return{data:null,error:l};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ca(i.access_token);let h=null;u.aal&&(h=u.aal);let v=h;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(k=>k.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(v="aal2");const m=u.amr||[];return{data:{currentLevel:h,nextLevel:v,currentAuthenticationMethods:m},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(h=>h.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(h=>h.kid===e),r&&this.jwks_cached_at+Zf>i)return r;const{data:l,error:u}=await ot(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=i,r=l.keys.find(h=>h.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:p,error:b}=await this.getSession();if(b||!p.session)return{data:null,error:b};r=p.session.access_token}const{header:i,payload:l,signature:u,raw:{header:h,payload:v}}=ca(r);t?.allowExpired||Ih(l.exp);const g=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!g){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:l,header:i,signature:u},error:null}}const m=Sh(i.alg),k=await crypto.subtle.importKey("jwk",g,m,!0,["verify"]);if(!await crypto.subtle.verify(m,k,u,uh(`${h}.${v}`)))throw new Oa("Invalid JWT signature");return{data:{claims:l,header:i,signature:u},error:null}}catch(r){if(Qe(r))return{data:null,error:r};throw r}}}Li.nextInstanceID=0;const Nh=Li;class Bh extends Nh{constructor(e){super(e)}}var Wh=function(n,e,t,r){function i(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function h(m){try{g(r.next(m))}catch(k){u(k)}}function v(m){try{g(r.throw(m))}catch(k){u(k)}}function g(m){m.done?l(m.value):i(m.value).then(h,v)}g((r=r.apply(n,e||[])).next())})};class Vh{constructor(e,t,r){var i,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=zf(e),v=new URL(h);this.realtimeUrl=new URL("realtime/v1",v),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",v),this.storageUrl=new URL("storage/v1",v),this.functionsUrl=new URL("functions/v1",v);const g=`sb-${v.hostname.split(".")[0]}-auth-token`,m={db:Uf,realtime:Bf,auth:Object.assign(Object.assign({},Nf),{storageKey:g}),global:$f},k=Kf(r??{},m);this.storageKey=(i=k.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(l=k.global.headers)!==null&&l!==void 0?l:{},k.accessToken?(this.accessToken=k.accessToken,this.auth=new Proxy({},{get:(S,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((u=k.auth)!==null&&u!==void 0?u:{},this.headers,k.global.fetch),this.fetch=Gf(t,this._getAccessToken.bind(this),k.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},k.realtime)),this.rest=new sf(new URL("rest/v1",v).href,{headers:this.headers,schema:k.db.schema,fetch:this.fetch}),this.storage=new Lf(this.storageUrl.href,this.headers,this.fetch,r?.storage),k.accessToken||this._listenForAuthEvents()}get functions(){return new Hd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Wh(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:l,flowType:u,lock:h,debug:v},g,m){const k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Bh({url:this.authUrl.href,headers:Object.assign(Object.assign({},k),g),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:u,lock:h,debug:v,fetch:m,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new kf(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const qh=(n,e,t)=>new Vh(n,e,t);function Gh(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Gh()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Hh="https://vycjpmuyscfygstjjied.supabase.co",zh="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",Tn=qh(Hh,zh,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"Content-Type":"application/json"}}}),nr={async loadStoriesList(){if(!B.selectedBucket){console.warn("[ResourceStore] No bucket selected");return}console.log(`[ResourceStore] Формирование имени файла для bucket: ${B.selectedBucket}`);const n=`${B.selectedBucket}_story.json`,{data:e,error:t}=await Tn.storage.from(B.selectedBucket).list("",{search:n});console.log(`[ResourceStore] Проверка файла ${n}:`,{files:e,error:t}),!t&&e&&e.some(r=>r.name===n)?(B.storiesList=[n],console.log(`[ResourceStore] Найден файл: ${n}`)):(B.storiesList=[],console.warn(`[ResourceStore] Файл ${n} не найден`))},async loadStoredResources(){if(!B.selectedBucket){console.warn("No bucket selected");return}const{data:n}=await Tn.storage.from(B.selectedBucket).list();n&&(B.storedFiles=n.filter(e=>e.name!==".emptyFolderPlaceholder"&&!e.name.endsWith(".json")))},async uploadNewFile(n){const e=n.target;if(!e.files||e.files.length===0)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история");return}const t=e.files[0];wt.setStatus("loading","Загрузка файла...");const r=await t.arrayBuffer(),i=new Uint8Array(r),{error:l}=await Tn.storage.from(B.selectedBucket).upload(t.name,i,{upsert:!0,contentType:t.type});l?wt.setStatus("error","Ошибка загрузки"):(wt.setStatus("success","Файл загружен"),await this.loadStoredResources())},async deleteFile(n){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история");return}const{error:e}=await Tn.storage.from(B.selectedBucket).remove([n]);e?wt.setStatus("error","Ошибка удаления файла"):(wt.setStatus("success","Файл удален"),await this.loadStoredResources())}};function Kh(n){return n.dialogues&&n.dialogues.forEach(e=>{e.options&&e.options.forEach(t=>{typeof t.miniGame=="boolean"&&(t.miniGame===!0?t.miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t.miniGame),typeof t.enabled>"u"&&(t.enabled=!0),typeof t.visible>"u"&&(t.visible=!0),t.visibleIf&&!t.visibilityCondition&&(t.visibleIf.hasItem&&(t.visibilityCondition={type:"has_item",itemId:t.visibleIf.hasItem}),delete t.visibleIf),t.visibilityCondition||(t.visibilityCondition={type:"always"})})}),n.chapters||(n.chapters=[{id:"main",title:"Основная история",description:""}],n.dialogues&&n.dialogues.forEach(e=>{e.chapterId||(e.chapterId="main")})),n.chapters&&n.chapters.forEach(e=>{typeof e.description>"u"&&(e.description="")}),n.items||(n.items=[]),n.meta||(n.meta={version:"3.1",title:n.title||"Untitled"}),n.miniGames&&Array.isArray(n.miniGames)&&(n.miniGames=n.miniGames.map(e=>e.id&&!e.onWinDialogueId?{...e,onWinDialogueId:e.winTarget||"",onLoseDialogueId:e.loseTarget||""}:e)),n}function Yh(){return{text:"Новый вариант",enabled:!0,visible:!0,visibilityCondition:{type:"always"}}}const Rn={async createNewStory(){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}const n=prompt("Введите имя файла истории:","new_story.json");if(!n)return;const t=JSON.stringify({meta:{version:"3.1",title:"New Story"},chapters:[{id:"ch1",title:"Глава 1",description:""}],dialogues:[{id:"start",chapterId:"ch1",text:"Начало...",options:[]}]},null,2),i=new TextEncoder().encode(t),{error:l}=await Tn.storage.from(B.selectedBucket).upload(n,i,{contentType:"application/json"});l?wt.setStatus("error","Ошибка создания: "+l.message):(await nr.loadStoriesList(),await this.loadStory(n))},async loadStory(n){if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}console.log(`[StoryStore] Загрузка истории: ${n} из bucket: ${B.selectedBucket}`),wt.setStatus("loading","Загрузка..."),B.currentFileName=n;try{const{data:e,error:t}=await Tn.storage.from(B.selectedBucket).download(n);console.log("[StoryStore] Результат загрузки (download):",{hasData:!!e,error:t});let r;if(t){console.warn("[StoryStore] Ошибка download, пробуем публичный URL:",t);const l=Tn.storage.from(B.selectedBucket).getPublicUrl(n).data.publicUrl;console.log(`[StoryStore] Публичный URL: ${l}`);const u=await fetch(l);if(!u.ok)throw new Error(`Не удалось загрузить файл: ${u.statusText}`);r=await u.text(),console.log(`[StoryStore] Данные загружены через публичный URL, длина: ${r.length}`)}else r=await e.text(),console.log(`[StoryStore] Данные загружены через download, длина: ${r.length}`);let i=JSON.parse(r);console.log("[StoryStore] Данные распарсены:",{meta:i.meta,chaptersCount:i.chapters?.length,dialoguesCount:i.dialogues?.length,itemsCount:i.items?.length}),i=Kh(i),console.log("[StoryStore] Присваиваем данные в editor.data"),B.data=i,console.log("[StoryStore] editor.data обновлен:",{chapters:B.data.chapters?.length,dialogues:B.data.dialogues?.length}),B.data.chapters&&B.data.chapters.length>0&&(B.selectedChapterId=B.data.chapters[0].id,console.log(`[StoryStore] Выбрана глава: ${B.selectedChapterId}`)),B.data.dialogues&&B.data.dialogues.length>0&&(B.selectedDialogueId=B.data.dialogues[0].id,console.log(`[StoryStore] Выбран диалог: ${B.selectedDialogueId}`)),console.log("[StoryStore] Загрузка завершена успешно"),wt.setStatus("success","Загружено!")}catch(e){console.error("[StoryStore] Ошибка загрузки:",e),wt.setStatus("error","Ошибка загрузки: "+e.message)}},async saveCurrentStory(){if(!B.data)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}wt.setStatus("loading","Сохранение...");const n=JSON.stringify(B.data,null,2);console.log(`[StoryStore] Сохранение файла: ${B.currentFileName}, размер: ${n.length} байт`);const t=new TextEncoder().encode(n),{error:r}=await Tn.storage.from(B.selectedBucket).update(B.currentFileName,t,{contentType:"application/json"});if(r){console.error("[StoryStore] Ошибка сохранения (update):",r),console.log("[StoryStore] Пробуем upload вместо update");const i=await Tn.storage.from(B.selectedBucket).upload(B.currentFileName,t,{contentType:"application/json"});i.error?(console.error("[StoryStore] Ошибка сохранения (upload):",i.error),wt.setStatus("error","Ошибка сохранения: "+i.error.message)):(console.log("[StoryStore] Файл успешно сохранен через upload"),wt.setStatus("success","Сохранено!"))}else console.log("[StoryStore] Файл успешно сохранен через update"),wt.setStatus("success","Сохранено!")},async saveStoryCopy(){if(!B.data)return;if(!B.selectedBucket){wt.setStatus("error","Не выбрана история (bucket)");return}const n=B.currentFileName.replace(".json",""),e=new Date().getTime();let t=`${n}_copy_${e}.json`.trim();const r=prompt("Введите имя для копии:",t);if(!r)return;t=r.trim(),t.endsWith(".json")||(t+=".json"),wt.setStatus("loading","Создание копии...");const i=JSON.stringify(B.data,null,2),u=new TextEncoder().encode(i),{error:h}=await Tn.storage.from(B.selectedBucket).upload(t,u,{upsert:!0,contentType:"application/json"});h?wt.setStatus("error",`Ошибка копии: ${h.message}`):(await nr.loadStoriesList(),wt.setStatus("success","Копия сохранена!"))},addChapter(){if(!B.data||!B.data.chapters)return;const n="ch_"+Date.now();B.data.chapters.push({id:n,title:"Новая глава",description:""}),B.selectedChapterId=n,console.log(`[StoryStore] Создана новая глава: ${n}`)},addDialogue(){if(!B.data||!B.selectedChapterId)return;const n="d_"+Date.now();B.data.dialogues.push({id:n,chapterId:B.selectedChapterId,text:"Новый текст...",options:[]}),B.selectedDialogueId=n},deleteDialogue(n){confirm("Удалить диалог "+n+"?")&&B.data&&(B.data.dialogues=B.data.dialogues.filter(e=>e.id!==n),B.data.dialogues.forEach(e=>{e.nextDialogueId===n&&(e.nextDialogueId=""),e.options&&e.options.forEach(t=>{t.nextDialogueId===n&&(t.nextDialogueId="")})}),B.selectedDialogueId===n&&(B.selectedDialogueId=null))},jumpTo(n){const e=B.data?.dialogues.find(t=>t.id===n);e&&(B.selectedChapterId=e.chapterId,B.selectedDialogueId=n)},getLinkType(n,e){return n.nextDialogueId===e?"Auto":"Option"}};var nn=sr(()=>Jt);function Jh(){wt.selectEditingChapter(null)}var Xh=Q('<div class="chapter-form svelte-qdj6mq"><div class="form-header svelte-qdj6mq"><h4 class="svelte-qdj6mq">Редактирование главы</h4> <div class="header-actions svelte-qdj6mq"><button class="btn-icon danger svelte-qdj6mq" title="Удалить главу">×</button></div></div> <div class="form-group svelte-qdj6mq"><label for="chapter-title" class="svelte-qdj6mq">Название главы</label> <input type="text" id="chapter-title" class="input svelte-qdj6mq" placeholder="Название главы"/></div> <div class="form-group svelte-qdj6mq"><label for="chapter-description" class="svelte-qdj6mq">Описание главы</label> <textarea id="chapter-description" class="textarea svelte-qdj6mq" rows="4" placeholder="Описание главы..."></textarea></div> <div class="form-actions svelte-qdj6mq"><button class="btn svelte-qdj6mq">Отмена</button> <button class="btn primary svelte-qdj6mq">Сохранить</button></div></div>');function Qh(n,e){Pt(e,!1);function t(){nn().currentEditingChapter&&(wt.updateChapter(nn().currentEditingChapter.id,{title:nn().currentEditingChapter.title,description:nn().currentEditingChapter.description}),wt.selectEditingChapter(null))}function r(){nn().currentEditingChapter&&confirm(`Удалить главу "${nn().currentEditingChapter.title}"?`)&&(wt.deleteChapter(nn().currentEditingChapter.id),wt.selectEditingChapter(null))}ir();var i=At(),l=Xe(i);{var u=h=>{var v=Xh(),g=E(v),m=j(E(g),2),k=E(m);k.__click=r;var S=j(g,2),p=j(E(S),2),b=j(S,2),R=j(E(b),2),P=j(b,2),U=E(P);U.__click=[Jh];var q=j(U,2);q.__click=t,Wn(p,()=>nn().currentEditingChapter.title,L=>nn(nn().currentEditingChapter.title=L)),Wn(R,()=>nn().currentEditingChapter.description,L=>nn(nn().currentEditingChapter.description=L)),W(h,v)};Oe(l,h=>{nn().currentEditingChapter&&h(u)})}W(n,i),Ot()}Ft(["click"]);var rn=sr(()=>B),Zh=(n,e,t)=>e(f(t).id),ev=Q('<div class="chapter-form-container svelte-xp6igx"><!></div>'),tv=Q('<div class="chapter-row svelte-xp6igx"><button type="button"><span class="chapter-title svelte-xp6igx"> </span></button> <button type="button" class="edit-chapter-btn svelte-xp6igx" title="Редактировать главу">✏️</button></div> <!>',1),nv=Q('<button type="button"><span class="id-badge svelte-xp6igx"> </span> <span class="preview-text svelte-xp6igx"> </span></button>'),rv=Q("<div> </div>"),iv=Q('<aside class="sidebar svelte-xp6igx"><div class="sidebar-section svelte-xp6igx"><div class="section-header"><h3>Главы</h3> <button class="btn-icon">+</button></div> <div class="chapter-list svelte-xp6igx"></div></div> <div class="sidebar-section flex-1 svelte-xp6igx"><div class="section-header"><h3> </h3> <button class="btn-icon">+</button></div> <div class="dialogue-list svelte-xp6igx"></div></div> <div class="status-box svelte-xp6igx"><!></div></aside>');function sv(n,e){Pt(e,!1);function t(U){wt.selectEditingChapter(U)}ir();var r=iv(),i=E(r),l=E(i),u=j(E(l),2);u.__click=function(...U){Rn.addChapter?.apply(this,U)};var h=j(l,2);Ze(h,5,()=>rn().data?.chapters||[],U=>U.id,(U,q)=>{var L=tv(),z=Xe(L),H=E(z);let C;H.__click=()=>rn(rn().selectedChapterId=f(q).id);var T=E(H),K=E(T),X=j(H,2);X.__click=[Zh,t,q];var ve=j(z,2);{var de=oe=>{var me=ev(),ee=E(me);Qh(ee,{}),W(oe,me)};Oe(ve,oe=>{rn().editingChapterId===f(q).id&&oe(de)})}Se(oe=>{C=Nt(H,1,"chapter-item svelte-xp6igx",null,C,oe),Ne(H,"aria-pressed",rn().selectedChapterId===f(q).id),Ne(H,"title",f(q).description||"Без описания"),be(K,f(q).title)},[()=>({active:rn().selectedChapterId===f(q).id})]),W(U,L)});var v=j(i,2),g=E(v),m=E(g),k=E(m),S=j(m,2);S.__click=function(...U){Rn.addDialogue?.apply(this,U)};var p=j(g,2);Ze(p,5,()=>Jt.chapterDialogues,U=>U.id,(U,q)=>{var L=nv();let z;L.__click=()=>rn(rn().selectedDialogueId=f(q).id);var H=E(L),C=E(H),T=j(H,2),K=E(T);Se((X,ve)=>{z=Nt(L,1,"dialogue-item svelte-xp6igx",null,z,X),Ne(L,"aria-pressed",rn().selectedDialogueId===f(q).id),be(C,f(q).id),be(K,`${ve??""}...`)},[()=>({active:rn().selectedDialogueId===f(q).id}),()=>f(q).text.substring(0,25)]),W(U,L)});var b=j(v,2),R=E(b);{var P=U=>{var q=rv(),L=E(q);Se(()=>{Nt(q,1,`alert ${rn().statusMessage.type??""}`,"svelte-xp6igx"),be(L,rn().statusMessage.text)}),W(U,q)};Oe(R,U=>{rn().statusMessage.text&&U(P)})}Se(()=>{be(k,`Сцены (${Jt.chapterDialogues.length??""})`),S.disabled=!rn().selectedChapterId}),W(n,r),Ot()}Ft(["click"]);var av=Q("<option> </option>"),ov=(n,e)=>{const t=n.target;e(t.checked)},lv=(n,e)=>{const t=n.target;e("id",t.value)},uv=(n,e)=>{const t=n.target;e("onWinDialogueId",t.value)},cv=Q("<option> </option>"),dv=(n,e)=>{const t=n.target;e("onLoseDialogueId",t.value)},fv=Q("<option> </option>"),hv=(n,e)=>{const t=n.target;e("rewardItem",t.value)},vv=Q("<option> </option>"),pv=Q('<div class="minigame-details svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>ID игры</label> <select class="input select"><option>-- Выберите игру --</option><option>Onet: Monsters (поиск пар)</option><option>Memo: Monsters (поиск пар)</option><option>LightOut: Свечи в склепе (Выключи свет)</option><option>Flood It: Мора Красной Смерти</option><option>Boken Mirror: Пятнашки</option><option>Evolution 2048</option><option>Проклятый Сапер</option><option>Три пика</option></select></div> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Диалог при победе</label> <select class="input select"><option>-- Выберите --</option><!></select></div> <div class="form-group svelte-14qgggj"><label>Диалог при поражении</label> <select class="input select"><option>-- Выберите --</option><!></select></div></div> <div class="form-group svelte-14qgggj"><label>Награда (предмет)</label> <select class="input select"><option>-- Без награды --</option><!></select></div></div>'),gv=(n,e)=>{const t=n.target;e(t.value)},_v=Q("<option> </option>"),mv=(n,e)=>{const t=n.target;e({itemId:t.value})},yv=Q("<option> </option>"),bv=Q('<div class="form-group full-width svelte-14qgggj"><label>Предмет</label> <select class="input select"><option>-- Выберите предмет --</option><!></select></div>'),wv=(n,e)=>{const t=n.target;e({statName:t.value})},kv=(n,e)=>{const t=n.target,r=parseInt(t.value);e({statValue:isNaN(r)?0:r})},Iv=Q('<div class="form-group svelte-14qgggj"><label>Стата</label> <input type="text" class="input" placeholder="knowledge"/></div> <div class="form-group svelte-14qgggj"><label>Значение ></label> <input type="number" class="input"/></div>',1),Sv=(n,e)=>{const t=n.target;e({flagName:t.value})},Ev=Q('<div class="form-group full-width svelte-14qgggj"><label>Имя флага</label> <input type="text" class="input" placeholder="metDracula"/></div>'),Av=Q('<div class="option-details svelte-14qgggj"><div class="form-group"><label>Текст кнопки</label> <input type="text" class="input"/></div> <div class="form-group"><label>Переход</label> <select class="input select"><option>-- Конец ветки --</option><!></select></div> <div class="minigame-section svelte-14qgggj"><div class="section-header svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Запустить мини-игру</label></div> <!></div> <div class="options-settings-grid svelte-14qgggj"><div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Включено (Enable)</label> <p class="setting-desc svelte-14qgggj">Если выключено, кнопка серая и не кликабельна.</p></div> <div class="setting-col svelte-14qgggj"><label class="checkbox-row svelte-14qgggj"><input type="checkbox"/> Видимо (Visible)</label> <p class="setting-desc svelte-14qgggj">Если скрыто, кнопки нет в списке.</p></div></div> <div class="trigger-section svelte-14qgggj"><h5 class="svelte-14qgggj">Условие видимости</h5> <div class="form-row svelte-14qgggj"><div class="form-group svelte-14qgggj"><label>Тип условия</label> <select class="input select"></select></div> <!> <!> <!></div> <!></div></div>');function Cv(n,e){Pt(e,!0);const t=ze(e,"option",7);function r(){t().visibilityCondition||(t().visibilityCondition={type:"always"})}function i(){return r(),t().visibilityCondition}function l(re){r();const ue=t().visibilityCondition;Object.assign(ue,re),t().visibilityCondition={...ue}}function u(re){r();const ue={type:re};switch(re){case"has_item":ue.itemId=i().itemId||"";break;case"stat_greater":ue.statName=i().statName||"",ue.statValue=i().statValue||0;break;case"flag_true":ue.flagName=i().flagName||"";break}t().visibilityCondition=ue}const h=Dt(()=>!!t().miniGame);function v(re){re?t().miniGame={id:"",onWinDialogueId:"",onLoseDialogueId:""}:delete t().miniGame}function g(){return!t().miniGame||typeof t().miniGame=="boolean"?null:t().miniGame}function m(re,ue){const fe=g();fe&&(fe[re]=ue)}var k=Av(),S=E(k),p=E(S),b=j(p,2),R=j(S,2),P=E(R),U=j(P,2),q=E(U);q.value=q.__value="";var L=j(q);Ze(L,17,()=>e.dialogues,re=>re.id,(re,ue)=>{var fe=av(),ye=E(fe),Ae={};Se(Ke=>{be(ye,`${f(ue).id??""}: ${Ke??""}...`),Ae!==(Ae=f(ue).id)&&(fe.value=(fe.__value=f(ue).id)??"")},[()=>f(ue).text.substring(0,30)]),W(re,fe)});var z=j(R,2),H=E(z),C=E(H),T=E(C);T.__change=[ov,v];var K=j(H,2);{var X=re=>{var ue=pv(),fe=E(ue),ye=E(fe),Ae=j(ye,2);Ae.__change=[lv,m];var Ke=E(Ae);Ke.value=Ke.__value="";var Ue=j(Ke);Ue.value=Ue.__value="onet_monsters";var $e=j(Ue);$e.value=$e.__value="memo_monsters";var Ve=j($e);Ve.value=Ve.__value="light_out";var qe=j(Ve);qe.value=qe.__value="flood_it";var _t=j(qe);_t.value=_t.__value="broken_mirror";var lt=j(_t);lt.value=lt.__value="evolution2048";var kt=j(lt);kt.value=kt.__value="cursed_crypts";var mt=j(kt);mt.value=mt.__value="tower_of_souls";var y;br(Ae);var o=j(fe,2),d=E(o),w=E(d),x=j(w,2);x.__change=[uv,m];var V=E(x);V.value=V.__value="";var se=j(V);Ze(se,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Ce=cv(),He=E(Ce),Vt={};Se(Mr=>{be(He,`${f(ut).id??""}: ${Mr??""}...`),Vt!==(Vt=f(ut).id)&&(Ce.value=(Ce.__value=f(ut).id)??"")},[()=>f(ut).text.substring(0,30)]),W(st,Ce)});var Te;br(x);var Fe=j(d,2),xe=E(Fe),Be=j(xe,2);Be.__change=[dv,m];var Ye=E(Be);Ye.value=Ye.__value="";var It=j(Ye);Ze(It,17,()=>e.dialogues,st=>st.id,(st,ut)=>{var Ce=fv(),He=E(Ce),Vt={};Se(Mr=>{be(He,`${f(ut).id??""}: ${Mr??""}...`),Vt!==(Vt=f(ut).id)&&(Ce.value=(Ce.__value=f(ut).id)??"")},[()=>f(ut).text.substring(0,30)]),W(st,Ce)});var ft;br(Be);var Wt=j(o,2),$t=E(Wt),Ct=j($t,2);Ct.__change=[hv,m];var et=E(Ct);et.value=et.__value="";var Ge=j(et);Ze(Ge,17,()=>e.availableItems,st=>st.id,(st,ut)=>{var Ce=vv(),He=E(Ce),Vt={};Se(()=>{be(He,f(ut).name),Vt!==(Vt=f(ut).id)&&(Ce.value=(Ce.__value=f(ut).id)??"")}),W(st,Ce)});var St;br(Ct),Se((st,ut,Ce,He)=>{Ne(ye,"for",`option-mg-id-${e.index??""}`),Ne(Ae,"id",`option-mg-id-${e.index??""}`),y!==(y=st)&&(Ae.value=(Ae.__value=st)??"",Jn(Ae,st)),Ne(w,"for",`option-mg-win-${e.index??""}`),Ne(x,"id",`option-mg-win-${e.index??""}`),Te!==(Te=ut)&&(x.value=(x.__value=ut)??"",Jn(x,ut)),Ne(xe,"for",`option-mg-lose-${e.index??""}`),Ne(Be,"id",`option-mg-lose-${e.index??""}`),ft!==(ft=Ce)&&(Be.value=(Be.__value=Ce)??"",Jn(Be,Ce)),Ne($t,"for",`option-mg-reward-${e.index??""}`),Ne(Ct,"id",`option-mg-reward-${e.index??""}`),St!==(St=He)&&(Ct.value=(Ct.__value=He)??"",Jn(Ct,He))},[()=>g().id,()=>g().onWinDialogueId,()=>g().onLoseDialogueId,()=>g().rewardItem||""]),W(re,ue)};Oe(K,re=>{g()&&re(X)})}var ve=j(z,2),de=E(ve),oe=E(de),me=E(oe),ee=j(de,2),D=E(ee),Z=E(D),M=j(ve,2),$=j(E(M),2),te=E($),ae=E(te),ge=j(ae,2);ge.__change=[gv,u],Ze(ge,20,()=>e.conditionTypes,re=>re,(re,ue)=>{var fe=_v(),ye=E(fe),Ae={};Se(()=>{be(ye,ue),Ae!==(Ae=ue)&&(fe.value=(fe.__value=ue)??"")}),W(re,fe)});var _e;br(ge);var Ie=j(te,2);{var Ee=re=>{var ue=bv(),fe=E(ue),ye=j(fe,2);ye.__change=[mv,l];var Ae=E(ye);Ae.value=Ae.__value="";var Ke=j(Ae);Ze(Ke,17,()=>e.availableItems,$e=>$e.id,($e,Ve)=>{var qe=yv(),_t=E(qe),lt={};Se(()=>{be(_t,f(Ve).name),lt!==(lt=f(Ve).id)&&(qe.value=(qe.__value=f(Ve).id)??"")}),W($e,qe)});var Ue;br(ye),Se($e=>{Ne(fe,"for",`option-cond-item-${e.index??""}`),Ne(ye,"id",`option-cond-item-${e.index??""}`),Ue!==(Ue=$e)&&(ye.value=(ye.__value=$e)??"",Jn(ye,$e))},[()=>i().itemId||""]),W(re,ue)};Oe(Ie,re=>{i().type==="has_item"&&re(Ee)})}var We=j(Ie,2);{var ne=re=>{var ue=Iv(),fe=Xe(ue),ye=E(fe),Ae=j(ye,2);Ae.__input=[wv,l];var Ke=j(fe,2),Ue=E(Ke),$e=j(Ue,2);$e.__input=[kv,l],Se((Ve,qe)=>{Ne(ye,"for",`option-cond-stat-${e.index??""}`),Ne(Ae,"id",`option-cond-stat-${e.index??""}`),ra(Ae,Ve),Ne(Ue,"for",`option-cond-stat-val-${e.index??""}`),Ne($e,"id",`option-cond-stat-val-${e.index??""}`),ra($e,qe)},[()=>i().statName||"",()=>i().statValue||0]),W(re,ue)};Oe(We,re=>{i().type==="stat_greater"&&re(ne)})}var le=j(We,2);{var Y=re=>{var ue=Ev(),fe=E(ue),ye=j(fe,2);ye.__input=[Sv,l],Se(Ae=>{Ne(fe,"for",`option-cond-flag-${e.index??""}`),Ne(ye,"id",`option-cond-flag-${e.index??""}`),ra(ye,Ae)},[()=>i().flagName||""]),W(re,ue)};Oe(le,re=>{i().type==="flag_true"&&re(Y)})}var ce=j($,2);Oe(ce,re=>{}),Se(re=>{Ne(p,"for",`option-text-${e.index??""}`),Ne(b,"id",`option-text-${e.index??""}`),Ne(P,"for",`option-next-${e.index??""}`),Ne(U,"id",`option-next-${e.index??""}`),Dd(T,f(h)),Ne(ae,"for",`option-cond-type-${e.index??""}`),Ne(ge,"id",`option-cond-type-${e.index??""}`),_e!==(_e=re)&&(ge.value=(ge.__value=re)??"",Jn(ge,re))},[()=>i().type]),Wn(b,()=>t().text,re=>t().text=re),Zr(U,()=>t().nextDialogueId,re=>t().nextDialogueId=re),sl(me,()=>t().enabled,re=>t().enabled=re),sl(Z,()=>t().visible,re=>t().visible=re),W(n,k),Ot()}Ft(["change","input"]);var jt=sr(()=>B),it=sr(()=>Jt),jv=Q("<option> <!></option>"),Tv=Q("<option> </option>"),xv=Q("<option> </option>"),Rv=Q("<option> </option>"),Pv=Q("<option> </option>"),Ov=Q('<div class="option-content svelte-1e6637j"><!></div>'),Mv=Q('<div><div class="option-header-row svelte-1e6637j"><div class="option-header svelte-1e6637j" role="button" tabindex="0"><span class="status-icons svelte-1e6637j"><!></span> <span> </span></div> <button type="button" class="btn-icon danger" aria-label="Удалить вариант">×</button></div> <!></div>'),Lv=Q('<div class="empty-links svelte-1e6637j">Нет связей</div>'),Dv=(n,e)=>Rn.jumpTo(f(e).id),Fv=Q('<div class="link-item svelte-1e6637j"><span class="link-type svelte-1e6637j"> </span> <span class="link-id svelte-1e6637j"> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">→</button> <span class="link-text svelte-1e6637j"> </span></div>'),$v=Q('<div class="links-list svelte-1e6637j"></div>'),Uv=Q('<div class="empty-links svelte-1e6637j">Никто не ссылается</div>'),Nv=(n,e)=>Rn.jumpTo(f(e).id),Bv=Q('<div class="link-item svelte-1e6637j"><span class="link-id svelte-1e6637j"> </span> <span> </span> <button class="btn-jump svelte-1e6637j" title="Перейти к диалогу">←</button> <span class="link-text svelte-1e6637j"> </span></div>'),Wv=Q('<div class="more-links svelte-1e6637j"> </div>'),Vv=Q('<div class="links-list svelte-1e6637j"><!> <!></div>'),qv=Q("<option> </option>"),Gv=Q('<div class="dialogue-form svelte-1e6637j"><div class="form-group svelte-1e6637j"><label for="dialogue-id" class="svelte-1e6637j">ID диалога</label> <input type="text" id="dialogue-id" class="input svelte-1e6637j"/></div> <div class="form-group svelte-1e6637j"><label for="dialogue-chapter" class="svelte-1e6637j">Глава</label> <select id="dialogue-chapter" class="input select svelte-1e6637j"><option>-- Не выбрано --</option><!></select></div> <div class="form-group svelte-1e6637j"><label for="dialogue-text" class="svelte-1e6637j">Текст</label> <textarea id="dialogue-text" class="textarea svelte-1e6637j" rows="3"></textarea></div> <div class="media-section svelte-1e6637j"><h4 class="svelte-1e6637j">Медиа ресурсы</h4> <div class="form-group svelte-1e6637j"><label for="dialogue-background" class="svelte-1e6637j">Фон</label> <div class="input-group svelte-1e6637j"><select id="dialogue-background" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select> <label class="btn-file svelte-1e6637j">Загрузить <input type="file" accept="image/*,.riv" hidden/></label></div></div> <div class="form-group svelte-1e6637j"><label for="dialogue-character" class="svelte-1e6637j">Персонаж</label> <div class="input-group svelte-1e6637j"><select id="dialogue-character" class="input select svelte-1e6637j"><option>-- Нет --</option><!><!></select></div></div></div> <div class="options-section svelte-1e6637j"><div class="section-header svelte-1e6637j"><h4 class="svelte-1e6637j">Варианты ответов</h4> <button class="btn small">+ Добавить</button></div> <!></div> <div class="links-section svelte-1e6637j"><div class="links-grid svelte-1e6637j"><div class="link-block svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div> <div class="link-block secondary svelte-1e6637j"><h5 class="svelte-1e6637j"> </h5> <!></div></div></div> <div class="links-section svelte-1e6637j"><h4 class="svelte-1e6637j">Авто-переход</h4> <select class="input select svelte-1e6637j"><option>-- Нет --</option><!></select></div> <div class="form-actions svelte-1e6637j"><button class="btn danger">Удалить сцену</button></div></div>'),Hv=Q('<div class="empty-state">Выберите сцену</div>');function zv(n,e){Pt(e,!1);const t=["always","has_item","stat_greater","flag_true"];function r(S){S.options||(S.options=[]);const p=Yh();S.options.push(p),jt(jt().editingOptionIndex=S.options.length-1)}function i(S){if(jt().editingOptionIndex===S)jt(jt().editingOptionIndex=null);else{jt(jt().editingOptionIndex=S);const p=it().currentDialogue?.options?.[S];p&&!p.visibilityCondition&&(p.visibilityCondition={type:"always"})}}function l(S,p){confirm("Удалить вариант ответа?")&&(S.options?.splice(p,1),jt().editingOptionIndex===p?jt(jt().editingOptionIndex=null):jt().editingOptionIndex&&jt().editingOptionIndex>p&&jt(jt().editingOptionIndex--))}function u(S){if(!S||!jt().data)return"Нет";const p=jt().data.dialogues.find(b=>b.id===S);return p?p.text.substring(0,25)+"...":`❌ ${S}`}function h(){const S=[],p=it().currentDialogue;return p&&(p.nextDialogueId&&S.push({type:"Auto",id:p.nextDialogueId,text:u(p.nextDialogueId)}),p.options?.forEach((b,R)=>{b.nextDialogueId&&S.push({type:`Опция #${R+1}`,id:b.nextDialogueId,text:u(b.nextDialogueId)})})),S}ir();var v=At(),g=Xe(v);{var m=S=>{var p=Gv(),b=E(p),R=j(E(b),2);R.__change=o=>{const d=o.target;jt(jt().selectedDialogueId=d.value)};var P=j(b,2),U=j(E(P),2);Se(()=>{it(),bn(()=>{jt()})}),U.__change=o=>{const d=o.target;jt(jt().selectedChapterId=d.value)};var q=E(U);q.value=q.__value="";var L=j(q);Ze(L,1,()=>jt().data.chapters||[],xt,(o,d)=>{var w=jv(),x=E(w),V=j(x);{var se=Fe=>{var xe=ls();Se(Be=>be(xe,`- ${Be??""}...`),[()=>f(d).description.substring(0,30)]),W(Fe,xe)};Oe(V,Fe=>{f(d).description&&Fe(se)})}var Te={};Se(()=>{be(x,`${f(d).title??""} `),Te!==(Te=f(d).id)&&(w.value=(w.__value=f(d).id)??"")}),W(o,w)});var z=j(P,2),H=j(E(z),2),C=j(z,2),T=j(E(C),2),K=j(E(T),2),X=E(K);Se(()=>{it(),bn(()=>{})});var ve=E(X);ve.value=ve.__value="";var de=j(ve);Ze(de,1,()=>it().imageResources,xt,(o,d)=>{var w=Tv(),x=E(w),V={};Se(()=>{be(x,f(d).name),V!==(V=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var oe=j(de);Ze(oe,1,()=>it().riveResources,xt,(o,d)=>{var w=xv(),x=E(w),V={};Se(()=>{be(x,`${f(d).name??""} (Rive)`),V!==(V=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var me=j(X,2),ee=j(E(me));ee.__change=function(...o){nr.uploadNewFile?.apply(this,o)};var D=j(T,2),Z=j(E(D),2),M=E(Z);Se(()=>{it(),bn(()=>{})});var $=E(M);$.value=$.__value="";var te=j($);Ze(te,1,()=>it().imageResources,xt,(o,d)=>{var w=Rv(),x=E(w),V={};Se(()=>{be(x,f(d).name),V!==(V=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var ae=j(te);Ze(ae,1,()=>it().riveResources,xt,(o,d)=>{var w=Pv(),x=E(w),V={};Se(()=>{be(x,`${f(d).name??""} (Rive)`),V!==(V=f(d).name)&&(w.value=(w.__value=f(d).name)??"")}),W(o,w)});var ge=j(C,2),_e=E(ge),Ie=j(E(_e),2);Ie.__click=()=>r(it().currentDialogue);var Ee=j(_e,2);Ze(Ee,1,()=>it().currentDialogue.options||[],xt,(o,d,w)=>{var x=Mv();let V;var se=E(x),Te=E(se);Te.__click=()=>i(w),Te.__keydown=et=>{(et.key==="Enter"||et.key===" ")&&(et.preventDefault(),i(w))},Ne(Te,"aria-controls",`option-content-${w}`);var Fe=E(Te),xe=E(Fe);{var Be=et=>{var Ge=ls("👁️‍🗨️");W(et,Ge)},Ye=et=>{var Ge=At(),St=Xe(Ge);{var st=Ce=>{var He=ls("🔒");W(Ce,He)},ut=Ce=>{var He=ls("✅");W(Ce,He)};Oe(St,Ce=>{f(d).enabled?Ce(ut,!1):Ce(st)},!0)}W(et,Ge)};Oe(xe,et=>{f(d).visible?et(Ye,!1):et(Be)})}var It=j(Fe,2),ft=E(It),Wt=j(Te,2);Wt.__click=()=>l(it().currentDialogue,w);var $t=j(se,2);{var Ct=et=>{var Ge=Ov();Ne(Ge,"id",`option-content-${w}`);var St=E(Ge);Cv(St,{get option(){return f(d)},index:w,get dialogues(){return jt().data.dialogues},get availableItems(){return it().availableItems},get conditionTypes(){return t}}),W(et,Ge)};Oe($t,et=>{jt().editingOptionIndex===w&&et(Ct)})}Se(et=>{V=Nt(x,1,"option-card svelte-1e6637j",null,V,et),Ne(Te,"aria-expanded",jt().editingOptionIndex===w),be(ft,`#${w+1} ${f(d).text??""}`)},[()=>({editing:jt().editingOptionIndex===w})]),W(o,x)});var We=j(ge,2),ne=E(We),le=E(ne),Y=E(le),ce=E(Y),re=j(Y,2);{var ue=o=>{var d=Lv();W(o,d)},fe=o=>{var d=$v();Ze(d,5,h,xt,(w,x)=>{var V=Fv(),se=E(V),Te=E(se),Fe=j(se,2),xe=E(Fe),Be=j(Fe,2);Be.__click=[Dv,x];var Ye=j(Be,2),It=E(Ye);Se(()=>{be(Te,`${f(x).type??""}:`),be(xe,f(x).id),be(It,f(x).text)}),W(w,V)}),W(o,d)};Oe(re,o=>{h().length===0?o(ue):o(fe,!1)})}var ye=j(le,2),Ae=E(ye),Ke=E(Ae),Ue=j(Ae,2);{var $e=o=>{var d=Uv();W(o,d)},Ve=o=>{var d=Vv(),w=E(d);Ze(w,1,()=>it().backlinks.slice(0,5),xt,(se,Te)=>{const Fe=hi(()=>Rn.getLinkType(f(Te),it().currentDialogue.id));var xe=Bv(),Be=E(xe),Ye=E(Be),It=j(Be,2);let ft;var Wt=E(It),$t=j(It,2);$t.__click=[Nv,Te];var Ct=j($t,2),et=E(Ct);Se((Ge,St)=>{be(Ye,f(Te).id),ft=Nt(It,1,"link-type-badge svelte-1e6637j",null,ft,Ge),be(Wt,f(Fe)),be(et,`${St??""}...`)},[()=>({"link-auto":f(Fe)==="Auto","link-option":f(Fe)==="Option"}),()=>f(Te).text.substring(0,20)]),W(se,xe)});var x=j(w,2);{var V=se=>{var Te=Wv(),Fe=E(Te);Se(()=>be(Fe,`...ещё ${it().backlinks.length-5}`)),W(se,Te)};Oe(x,se=>{it().backlinks.length>5&&se(V)})}W(o,d)};Oe(Ue,o=>{it().backlinks.length===0?o($e):o(Ve,!1)})}var qe=j(We,2),_t=j(E(qe),2);Se(()=>{it(),bn(()=>{jt()})});var lt=E(_t);lt.value=lt.__value="";var kt=j(lt);Ze(kt,1,()=>jt().data.dialogues,xt,(o,d)=>{var w=qv(),x=E(w),V={};Se(se=>{be(x,`${f(d).id??""}: ${se??""}...`),V!==(V=f(d).id)&&(w.value=(w.__value=f(d).id)??"")},[()=>f(d).text.substring(0,30)]),W(o,w)});var mt=j(qe,2),y=E(mt);y.__click=()=>Rn.deleteDialogue(it().currentDialogue.id),Se(o=>{be(ce,`👉 Куда ведет (${o??""})`),be(Ke,`👈 Откуда ведут (${it().backlinks.length??""})`)},[()=>h().length]),Wn(R,()=>it().currentDialogue.id,o=>it(it().currentDialogue.id=o)),Zr(U,()=>it().currentDialogue.chapterId,o=>it(it().currentDialogue.chapterId=o)),Wn(H,()=>it().currentDialogue.text,o=>it(it().currentDialogue.text=o)),Zr(X,()=>it().currentDialogue.backgroundImage,o=>it(it().currentDialogue.backgroundImage=o)),Zr(M,()=>it().currentDialogue.characterImage,o=>it(it().currentDialogue.characterImage=o)),Zr(_t,()=>it().currentDialogue.nextDialogueId,o=>it(it().currentDialogue.nextDialogueId=o)),W(S,p)},k=S=>{var p=Hv();W(S,p)};Oe(g,S=>{it().currentDialogue?S(m):S(k,!1)})}W(n,v),Ot()}Ft(["change","click","keydown"]);var Je=sr(()=>B),Kv=Q('<img class="icon-preview svelte-asgatj"/>'),Yv=Q('<div class="icon-placeholder svelte-asgatj">📦</div>'),Jv=Q("<option> </option>"),Xv=Q('<div class="icon-preview-small svelte-asgatj"><img alt="Preview" class="preview-image svelte-asgatj"/> <span class="preview-name svelte-asgatj"> </span></div>'),Qv=Q("<option> </option>"),Zv=Q('<div class="item-edit-form svelte-asgatj"><div class="edit-grid svelte-asgatj"><div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">ID предмета</label> <input type="text" class="input svelte-asgatj" placeholder="item_unique_id"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Название</label> <input type="text" class="input svelte-asgatj" placeholder="Название предмета"/></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Описание</label> <textarea class="textarea svelte-asgatj" rows="2" placeholder="Описание предмета..."></textarea></div> <div class="form-group full-width-edit svelte-asgatj"><label class="svelte-asgatj">Иконка</label> <div class="input-group svelte-asgatj"><input type="text" class="input svelte-asgatj" placeholder="icon.png"/> <select class="input select svelte-asgatj"><option>-- Выбрать из загруженных --</option><!></select> <label class="btn-file svelte-asgatj">Загрузить <input type="file" accept="image/*" hidden/></label></div> <!></div> <div class="form-group svelte-asgatj"><label class="svelte-asgatj">Тип</label> <select class="item-type-select svelte-asgatj"></select></div></div></div>'),ep=Q('<div><button type="button" class="item-info svelte-asgatj"><div class="item-header svelte-asgatj"><div class="item-icon svelte-asgatj"><!></div> <div class="item-details svelte-asgatj"><div class="item-name svelte-asgatj"> </div> <div class="item-meta svelte-asgatj"><span class="item-id svelte-asgatj"> </span> <span> </span></div></div></div> <div class="item-description svelte-asgatj"> <em>Нет описания</em></div></button> <div class="item-actions svelte-asgatj"><button class="btn-icon svelte-asgatj" title="Дублировать">⎘</button> <button class="btn-icon svelte-asgatj" title="Редактировать">✎️</button> <button class="btn-icon danger svelte-asgatj" title="Удалить">×</button></div> <!></div>'),tp=Q('<div class="items-list svelte-asgatj"></div>'),np=Q('<div class="empty-items svelte-asgatj"><div class="empty-icon svelte-asgatj">📦</div> <div class="empty-text svelte-asgatj">Нет предметов</div> <div class="empty-subtext svelte-asgatj">Добавьте предметы для использования в условиях</div></div>'),rp=Q('<div id="items-container" class="items-container svelte-asgatj"><!> <button class="btn primary full-width svelte-asgatj">+ Добавить предмет</button></div>'),ip=Q('<div class="items-manager svelte-asgatj"><button type="button" class="section-header svelte-asgatj" aria-controls="items-container"><h4 class="svelte-asgatj"><span class="icon svelte-asgatj">📦</span> </h4> <span class="toggle-icon svelte-asgatj"> </span></button> <!></div>');function sp(n,e){Pt(e,!1);const t=[{value:"tool",label:"Инструмент"},{value:"key",label:"Ключ"},{value:"consumable",label:"Расходуемый"},{value:"quest",label:"Квестовый"},{value:"misc",label:"Разное"}];function r(){if(!Je().data)return;Je().data.items||Je(Je().data.items=[]);const P={id:`item_${Date.now()}`,name:"Новый предмет",description:"Описание предмета",icon:"icon_default.png",type:"misc"};Je().data.items.push(P),Je(Je().editingItemIndex=Je().data.items.length-1)}function i(P){Je().editingItemIndex===P?Je(Je().editingItemIndex=null):Je(Je().editingItemIndex=P)}function l(P){confirm("Удалить предмет?")&&Je().data?.items&&(Je().data.items.splice(P,1),Je(Je().editingItemIndex=null))}function u(P){if(!Je().data?.items)return;const U=Je().data.items[P],q={...U,id:`${U.id}_copy_${Date.now()}`,name:`${U.name} (копия)`};Je().data.items.splice(P+1,0,q),Je(Je().editingItemIndex=P+1)}function h(P){return t.find(U=>U.value===P)?.label||P}ir();var v=ip(),g=E(v);g.__click=()=>Je(Je().showItems=!Je().showItems);var m=E(g),k=j(E(m)),S=j(m,2),p=E(S),b=j(g,2);{var R=P=>{var U=rp(),q=E(U);{var L=C=>{var T=tp();Ze(T,7,()=>Je().data.items,K=>K.id,(K,X,ve)=>{var de=ep();let oe;var me=E(de);me.__click=()=>i(f(ve));var ee=E(me),D=E(ee),Z=E(D);{var M=Ue=>{var $e=Kv();Se(()=>{Ne($e,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Je().selectedBucket}/${f(X).icon}`),Ne($e,"alt",f(X).name)}),W(Ue,$e)},$=Ue=>{var $e=Yv();W(Ue,$e)};Oe(Z,Ue=>{f(X).icon?Ue(M):Ue($,!1)})}var te=j(D,2),ae=E(te),ge=E(ae),_e=j(ae,2),Ie=E(_e),Ee=E(Ie),We=j(Ie,2);let ne;var le=E(We),Y=j(ee,2),ce=E(Y),re=j(me,2),ue=E(re);ue.__click=()=>u(f(ve));var fe=j(ue,2);fe.__click=()=>i(f(ve));var ye=j(fe,2);ye.__click=()=>l(f(ve));var Ae=j(re,2);{var Ke=Ue=>{var $e=Zv(),Ve=E($e),qe=E(Ve),_t=E(qe),lt=j(_t,2),kt=j(qe,2),mt=E(kt),y=j(mt,2),o=j(kt,2),d=E(o),w=j(d,2),x=j(o,2),V=E(x),se=j(V,2),Te=E(se),Fe=j(Te,2);Fe.__change=Ge=>{const St=Ge.target;f(X).icon=St.value,bn(()=>Je())};var xe=E(Fe);xe.value=xe.__value="";var Be=j(xe);Ze(Be,1,()=>Je().storedFiles.filter(Ge=>Ge.name.match(/\.(png|jpg|jpeg|webp|gif|svg)$/i)),xt,(Ge,St)=>{var st=Jv(),ut=E(st),Ce={};Se(()=>{be(ut,f(St).name),Ce!==(Ce=f(St).name)&&(st.value=(st.__value=f(St).name)??"")}),W(Ge,st)});var Ye=j(Fe,2),It=j(E(Ye));It.__change=function(...Ge){nr.uploadNewFile?.apply(this,Ge)};var ft=j(se,2);{var Wt=Ge=>{var St=Xv(),st=E(St),ut=j(st,2),Ce=E(ut);Se(()=>{Ne(st,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Je().selectedBucket}/${f(X).icon}`),be(Ce,f(X).icon)}),W(Ge,St)};Oe(ft,Ge=>{f(X).icon&&Ge(Wt)})}var $t=j(x,2),Ct=E($t),et=j(Ct,2);Se(()=>{f(X),bn(()=>{f(ve)})}),Ze(et,5,()=>t,xt,(Ge,St)=>{var st=Qv(),ut=E(st),Ce={};Se(()=>{be(ut,f(St).label),Ce!==(Ce=f(St).value)&&(st.value=(st.__value=f(St).value)??"")}),W(Ge,st)}),Se(()=>{Ne(_t,"for",`item-id-${f(ve)??""}`),Ne(lt,"id",`item-id-${f(ve)??""}`),Ne(mt,"for",`item-name-${f(ve)??""}`),Ne(y,"id",`item-name-${f(ve)??""}`),Ne(d,"for",`item-desc-${f(ve)??""}`),Ne(w,"id",`item-desc-${f(ve)??""}`),Ne(V,"for",`item-icon-${f(ve)??""}`),Ne(Te,"id",`item-icon-${f(ve)??""}`),Ne(Ct,"for",`item-type-${f(ve)??""}`),Ne(et,"id",`item-type-${f(ve)??""}`)}),Wn(lt,()=>f(X).id,Ge=>(f(X).id=Ge,bn(()=>Je()))),Wn(y,()=>f(X).name,Ge=>(f(X).name=Ge,bn(()=>Je()))),Wn(w,()=>f(X).description,Ge=>(f(X).description=Ge,bn(()=>Je()))),Wn(Te,()=>f(X).icon,Ge=>(f(X).icon=Ge,bn(()=>Je()))),Zr(et,()=>f(X).type,Ge=>(f(X).type=Ge,bn(()=>Je()))),W(Ue,$e)};Oe(Ae,Ue=>{Je().editingItemIndex===f(ve)&&Ue(Ke)})}Se((Ue,$e,Ve)=>{oe=Nt(de,1,"item-row svelte-asgatj",null,oe,Ue),Ne(me,"aria-label",`Редактировать предмет ${f(X).name??""}`),be(ge,f(X).name),be(Ee,f(X).id),ne=Nt(We,1,"item-type-badge svelte-asgatj",null,ne,$e),be(le,Ve),be(ce,`${f(X).description??""} || `)},[()=>({editing:Je().editingItemIndex===f(ve)}),()=>({tool:f(X).type==="tool",key:f(X).type==="key",consumable:f(X).type==="consumable",quest:f(X).type==="quest",misc:f(X).type==="misc"}),()=>h(f(X).type)]),W(K,de)}),W(C,T)},z=C=>{var T=np();W(C,T)};Oe(q,C=>{Je().data?.items?.length?C(L):C(z,!1)})}var H=j(q,2);H.__click=r,W(P,U)};Oe(b,P=>{Je().showItems&&P(R)})}Se(()=>{Ne(g,"title",Je().showItems?"Скрыть предметы":"Показать предметы"),Ne(g,"aria-expanded",Je().showItems),be(k,` Предметы (${(Je().data?.items?.length||0)??""})`),be(p,Je().showItems?"▼":"▶")}),W(n,v),Ot()}Ft(["click","change"]);Ft(["click"]);class ap{#i=Me(pt({inventory:[],stats:{knowledge:0,courage:0,charisma:0}}));get player(){return f(this.#i)}set player(e){ie(this.#i,e,!0)}#n=Me(null);get storyData(){return f(this.#n)}set storyData(e){ie(this.#n,e,!0)}#e=Me("0");get currentDialogueId(){return f(this.#e)}set currentDialogueId(e){ie(this.#e,e,!0)}#s=Me(!0);get isLoading(){return f(this.#s)}set isLoading(e){ie(this.#s,e,!0)}#a=Me("");get error(){return f(this.#a)}set error(e){ie(this.#a,e,!0)}#t=Me(null);get selectedStory(){return f(this.#t)}set selectedStory(e){ie(this.#t,e,!0)}#r=Me(pt(["dracula","zombie","fairy_tale","minigames"]));get availableStories(){return f(this.#r)}set availableStories(e){ie(this.#r,e,!0)}get currentDialogue(){return this.findDialogue(this.currentDialogueId)}async loadStory(e){this.isLoading=!0,this.error="";try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();this.storyData=r,this.currentDialogueId=this.storyData?.dialogues?.[0]?.id||"0"}catch(t){const r=t instanceof Error?t.message:"Неизвестная ошибка";this.error=`Ошибка загрузки: ${r}`,console.error("Ошибка загрузки истории:",t)}finally{this.isLoading=!1}}findDialogue(e){return this.storyData?.dialogues.find(t=>t.id===e)}getItem(e){return this.storyData?.items.find(t=>t.id===e)}hasItem(e){return this.player.inventory.includes(e)}addItem(e){this.player.inventory.includes(e)||(this.player.inventory=[...this.player.inventory,e])}removeItem(e){this.player.inventory=this.player.inventory.filter(t=>t!==e)}changeStat(e,t){e in this.player.stats&&(this.player.stats[e]+=t)}getStat(e){return this.player.stats[e]??0}checkVisibilityCondition(e){if(e.visibleIf&&e.visibleIf.hasItem)return this.hasItem(e.visibleIf.hasItem);if(e.visibilityCondition)switch(e.visibilityCondition.type){case"always":return!0;case"has_item":return e.visibilityCondition.itemId?this.hasItem(e.visibilityCondition.itemId):!0;case"stat_greater":return e.visibilityCondition.statName&&e.visibilityCondition.statValue!==void 0?this.getStat(e.visibilityCondition.statName)>e.visibilityCondition.statValue:!0;case"flag_true":return!0;default:return!0}return!0}runActions(e){e&&e.forEach(t=>{switch(t.type){case"add_item":t.id&&this.addItem(t.id);break;case"remove_item":t.id&&this.removeItem(t.id);break;case"stat_change":t.stat&&t.value!==void 0&&this.changeStat(t.stat,t.value);break;case"set_flag":console.log(`Set flag: ${t.flagName} = ${t.value}`);break;default:console.warn("Неизвестный тип действия:",t.type)}})}goToDialogue(e){this.currentDialogueId=e}reset(){this.player.inventory=[],this.player.stats={knowledge:0,courage:0,charisma:0},this.currentDialogueId=this.storyData?.dialogues[0]?.id||"0",this.error=""}getInventoryItems(){return this.player.inventory.map(e=>this.getItem(e)).filter(e=>e!==void 0)}}const Tt=new ap;var _s={exports:{}},op=_s.exports,Ol;function lp(){return Ol||(Ol=1,(function(n,e){(function(r,i){n.exports=i()})(op,()=>(()=>{var t=[,((u,h,v)=>{v.r(h),v.d(h,{default:()=>m});var g=(()=>{var k=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return(function(S={}){var p=S,b,R;p.ready=new Promise((s,a)=>{b=s,R=a});function P(){function s(O){const G=_;c=a=0,_=new Map,G.forEach(J=>{try{J(O)}catch(N){console.error(N)}}),this.pb(),I&&I.Tb()}let a=0,c=0,_=new Map,I=null,A=null;this.requestAnimationFrame=function(O){a||(a=requestAnimationFrame(s.bind(this)));const G=++c;return _.set(G,O),G},this.cancelAnimationFrame=function(O){_.delete(O),a&&_.size==0&&(cancelAnimationFrame(a),a=0)},this.Rb=function(O){A&&(document.body.remove(A),A=null),O||(A=document.createElement("div"),A.style.backgroundColor="black",A.style.position="fixed",A.style.right=0,A.style.top=0,A.style.color="white",A.style.padding="4px",A.innerHTML="RIVE FPS",O=function(G){A.innerHTML="RIVE FPS "+G.toFixed(1)},document.body.appendChild(A)),I=new function(){let G=0,J=0;this.Tb=function(){var N=performance.now();J?(++G,N-=J,1e3<N&&(O(1e3*G/N),G=J=0)):(J=N,G=0)}}},this.Ob=function(){A&&(document.body.remove(A),A=null),I=null},this.pb=function(){}}function U(s){console.assert(!0);const a=new Map;let c=-1/0;this.push=function(_){return _=_+((1<<s)-1)>>s,a.has(_)&&clearTimeout(a.get(_)),a.set(_,setTimeout(function(){a.delete(_),a.length==0?c=-1/0:_==c&&(c=Math.max(...a.keys()),console.assert(c<_))},1e3)),c=Math.max(_,c),c<<s}}const q=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){q&&q();let s=p.decodeAudio;p.decodeAudio=function(I,A){I=s(I),A(I)};let a=p.decodeFont;p.decodeFont=function(I,A){I=a(I),A(I)};const c=p.FileAssetLoader;p.ptrToAsset=I=>{let A=p.ptrToFileAsset(I);return A.isImage?p.ptrToImageAsset(I):A.isFont?p.ptrToFontAsset(I):A.isAudio?p.ptrToAudioAsset(I):A},p.CustomFileAssetLoader=c.extend("CustomFileAssetLoader",{__construct:function({loadContents:I}){this.__parent.__construct.call(this),this.Gb=I},loadContents:function(I,A){return I=p.ptrToAsset(I),this.Gb(I,A)}}),p.CDNFileAssetLoader=c.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(I){let A=p.ptrToAsset(I);return I=A.cdnUuid,I===""?!1:((function(O,G){var J=new XMLHttpRequest;J.responseType="arraybuffer",J.onreadystatechange=function(){J.readyState==4&&J.status==200&&G(J)},J.open("GET",O,!0),J.send(null)})(A.cdnBaseUrl+"/"+I,O=>{A.decode(new Uint8Array(O.response))}),!0)}}),p.FallbackFileAssetLoader=c.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.lb=[]},addLoader:function(I){this.lb.push(I)},loadContents:function(I,A){for(let O of this.lb)if(O.loadContents(I,A))return!0;return!1}});let _=p.computeAlignment;p.computeAlignment=function(I,A,O,G,J=1){return _.call(this,I,A,O,G,J)}};const L="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),z=new function(){function s(){if(!a){let nt=function(at,Re,Mt){if(Re=pe.createShader(Re),pe.shaderSource(Re,Mt),pe.compileShader(Re),Mt=pe.getShaderInfoLog(Re),0<(Mt||"").length)throw Mt;pe.attachShader(at,Re)};var F=document.createElement("canvas"),we={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let pe;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(pe=F.getContext("webgl",we),c=1,!pe)return console.log("No WebGL support. Image mesh will not be drawn."),!1}else if(pe=F.getContext("webgl2",we))c=2;else if(pe=F.getContext("webgl",we))c=1;else return console.log("No WebGL support. Image mesh will not be drawn."),!1;if(pe=new Proxy(pe,{get(at,Re){if(at.isContextLost()){if(J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",Re),J=!0),typeof at[Re]=="function")return function(){}}else return typeof at[Re]=="function"?function(...Mt){return at[Re].apply(at,Mt)}:at[Re]},set(at,Re,Mt){if(at.isContextLost())J||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+Re),J=!0);else return at[Re]=Mt,!0}}),_=Math.min(pe.getParameter(pe.MAX_RENDERBUFFER_SIZE),pe.getParameter(pe.MAX_TEXTURE_SIZE)),F=pe.createProgram(),nt(F,pe.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),nt(F,pe.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),pe.bindAttribLocation(F,0,"vertex"),pe.bindAttribLocation(F,1,"uv"),pe.linkProgram(F),we=pe.getProgramInfoLog(F),0<(we||"").trim().length)throw we;I=pe.getUniformLocation(F,"mat"),A=pe.getUniformLocation(F,"translate"),pe.useProgram(F),pe.bindBuffer(pe.ARRAY_BUFFER,pe.createBuffer()),pe.enableVertexAttribArray(0),pe.enableVertexAttribArray(1),pe.bindBuffer(pe.ELEMENT_ARRAY_BUFFER,pe.createBuffer()),pe.uniform1i(pe.getUniformLocation(F,"image"),0),pe.pixelStorei(pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a=pe}return!0}let a=null,c=0,_=0,I=null,A=null,O=0,G=0,J=!1;s(),this.hc=function(){return s(),_},this.Mb=function(F){a.deleteTexture&&a.deleteTexture(F)},this.Lb=function(F){if(!s())return null;const we=a.createTexture();return we?(a.bindTexture(a.TEXTURE_2D,we),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,F),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),c==2?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),we):null};const N=new U(8),ke=new U(8),je=new U(10),Le=new U(10);this.Qb=function(F,we,pe,nt,at){if(s()){var Re=N.push(F),Mt=ke.push(we);if(a.canvas){(a.canvas.width!=Re||a.canvas.height!=Mt)&&(a.canvas.width=Re,a.canvas.height=Mt),a.viewport(0,Mt-we,F,we),a.disable(a.SCISSOR_TEST),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.SCISSOR_TEST),pe.sort((ht,An)=>An.xb-ht.xb),Re=je.push(nt),O!=Re&&(a.bufferData(a.ARRAY_BUFFER,8*Re,a.DYNAMIC_DRAW),O=Re),Re=0;for(var Xt of pe)a.bufferSubData(a.ARRAY_BUFFER,Re,Xt.Ua),Re+=4*Xt.Ua.length;console.assert(Re==4*nt);for(var En of pe)a.bufferSubData(a.ARRAY_BUFFER,Re,En.Db),Re+=4*En.Db.length;console.assert(Re==8*nt),Re=Le.push(at),G!=Re&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,2*Re,a.DYNAMIC_DRAW),G=Re),Xt=0;for(var vr of pe)a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,Xt,vr.indices),Xt+=2*vr.indices.length;console.assert(Xt==2*at),vr=0,En=!0,Re=Xt=0;for(const ht of pe){ht.image.Ka!=vr&&(a.bindTexture(a.TEXTURE_2D,ht.image.Ja||null),vr=ht.image.Ka),ht.mc?(a.scissor(ht.Za,Mt-ht.$a-ht.kb,ht.Ac,ht.kb),En=!0):En&&(a.scissor(0,Mt-we,F,we),En=!1),pe=2/F;const An=-2/we;a.uniform4f(I,ht.ha[0]*pe*ht.Ba,ht.ha[1]*An*ht.Ca,ht.ha[2]*pe*ht.Ba,ht.ha[3]*An*ht.Ca),a.uniform2f(A,ht.ha[4]*pe*ht.Ba+pe*(ht.Za-ht.ic*ht.Ba)-1,ht.ha[5]*An*ht.Ca+An*(ht.$a-ht.jc*ht.Ca)+1),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,Re),a.vertexAttribPointer(1,2,a.FLOAT,!1,0,Re+4*nt),a.drawElements(a.TRIANGLES,ht.indices.length,a.UNSIGNED_SHORT,Xt),Re+=4*ht.Ua.length,Xt+=2*ht.indices.length}console.assert(Re==4*nt),console.assert(Xt==2*at)}}},this.canvas=function(){return s()&&a.canvas}},H=p.onRuntimeInitialized;p.onRuntimeInitialized=function(){function s(he){switch(he){case N.srcOver:return"source-over";case N.screen:return"screen";case N.overlay:return"overlay";case N.darken:return"darken";case N.lighten:return"lighten";case N.colorDodge:return"color-dodge";case N.colorBurn:return"color-burn";case N.hardLight:return"hard-light";case N.softLight:return"soft-light";case N.difference:return"difference";case N.exclusion:return"exclusion";case N.multiply:return"multiply";case N.hue:return"hue";case N.saturation:return"saturation";case N.color:return"color";case N.luminosity:return"luminosity"}}function a(he){return"rgba("+((16711680&he)>>>16)+","+((65280&he)>>>8)+","+((255&he)>>>0)+","+((4278190080&he)>>>24)/255+")"}function c(){0<Mt.length&&(z.Qb(Re.drawWidth(),Re.drawHeight(),Mt,Xt,En),Mt=[],En=Xt=0,Re.reset(512,512));for(const he of at){for(const Pe of he.H)Pe();he.H=[]}at.clear()}H&&H();var _=p.RenderPaintStyle;const I=p.RenderPath,A=p.RenderPaint,O=p.Renderer,G=p.StrokeCap,J=p.StrokeJoin,N=p.BlendMode,ke=_.fill,je=_.stroke,Le=p.FillRule.evenOdd;let F=1;var we=p.RenderImage.extend("CanvasRenderImage",{__construct:function({la:he,xa:Pe}={}){this.__parent.__construct.call(this),this.Ka=F,F=F+1&2147483647||1,this.la=he,this.xa=Pe},__destruct:function(){this.Ja&&(z.Mb(this.Ja),URL.revokeObjectURL(this.Xa)),this.__parent.__destruct.call(this)},decode:function(he){var Pe=this;Pe.xa&&Pe.xa(Pe);var ct=new Image;Pe.Xa=URL.createObjectURL(new Blob([he],{type:"image/png"})),ct.onload=function(){Pe.Fb=ct,Pe.Ja=z.Lb(ct),Pe.size(ct.width,ct.height),Pe.la&&Pe.la(Pe)},ct.src=Pe.Xa}}),pe=I.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.T=new Path2D},rewind:function(){this.T=new Path2D},addPath:function(he,Pe,ct,vt,rt,dt,bt){var Et=this.T,mn=Et.addPath;he=he.T;const Ht=new DOMMatrix;Ht.a=Pe,Ht.b=ct,Ht.c=vt,Ht.d=rt,Ht.e=dt,Ht.f=bt,mn.call(Et,he,Ht)},fillRule:function(he){this.Wa=he},moveTo:function(he,Pe){this.T.moveTo(he,Pe)},lineTo:function(he,Pe){this.T.lineTo(he,Pe)},cubicTo:function(he,Pe,ct,vt,rt,dt){this.T.bezierCurveTo(he,Pe,ct,vt,rt,dt)},close:function(){this.T.closePath()}}),nt=A.extend("CanvasRenderPaint",{color:function(he){this.Ya=a(he)},thickness:function(he){this.Ib=he},join:function(he){switch(he){case J.miter:this.Ia="miter";break;case J.round:this.Ia="round";break;case J.bevel:this.Ia="bevel"}},cap:function(he){switch(he){case G.butt:this.Ha="butt";break;case G.round:this.Ha="round";break;case G.square:this.Ha="square"}},style:function(he){this.Hb=he},blendMode:function(he){this.Eb=s(he)},clearGradient:function(){this.ja=null},linearGradient:function(he,Pe,ct,vt){this.ja={zb:he,Ab:Pe,cb:ct,eb:vt,Ra:[]}},radialGradient:function(he,Pe,ct,vt){this.ja={zb:he,Ab:Pe,cb:ct,eb:vt,Ra:[],ec:!0}},addStop:function(he,Pe){this.ja.Ra.push({color:he,stop:Pe})},completeGradient:function(){},draw:function(he,Pe,ct){let vt=this.Hb;var rt=this.Ya,dt=this.ja;if(he.globalCompositeOperation=this.Eb,dt!=null){rt=dt.zb;var bt=dt.Ab;const mn=dt.cb;var Et=dt.eb;const Ht=dt.Ra;dt.ec?(dt=mn-rt,Et-=bt,rt=he.createRadialGradient(rt,bt,0,rt,bt,Math.sqrt(dt*dt+Et*Et))):rt=he.createLinearGradient(rt,bt,mn,Et);for(let dn=0,zt=Ht.length;dn<zt;dn++)bt=Ht[dn],rt.addColorStop(bt.stop,a(bt.color));this.Ya=rt,this.ja=null}switch(vt){case je:he.strokeStyle=rt,he.lineWidth=this.Ib,he.lineCap=this.Ha,he.lineJoin=this.Ia,he.stroke(Pe);break;case ke:he.fillStyle=rt,he.fill(Pe,ct)}}});const at=new Set;let Re=null,Mt=[],Xt=0,En=0;var vr=p.CanvasRenderer=O.extend("Renderer",{__construct:function(he){this.__parent.__construct.call(this),this.S=[1,0,0,1,0,0],this.C=he.getContext("2d"),this.Va=he,this.H=[]},save:function(){this.S.push(...this.S.slice(this.S.length-6)),this.H.push(this.C.save.bind(this.C))},restore:function(){const he=this.S.length-6;if(6>he)throw"restore() called without matching save().";this.S.splice(he),this.H.push(this.C.restore.bind(this.C))},transform:function(he,Pe,ct,vt,rt,dt){const bt=this.S,Et=bt.length-6;bt.splice(Et,6,bt[Et]*he+bt[Et+2]*Pe,bt[Et+1]*he+bt[Et+3]*Pe,bt[Et]*ct+bt[Et+2]*vt,bt[Et+1]*ct+bt[Et+3]*vt,bt[Et]*rt+bt[Et+2]*dt+bt[Et+4],bt[Et+1]*rt+bt[Et+3]*dt+bt[Et+5]),this.H.push(this.C.transform.bind(this.C,he,Pe,ct,vt,rt,dt))},rotate:function(he){const Pe=Math.sin(he);he=Math.cos(he),this.transform(he,Pe,-Pe,he,0,0)},_drawPath:function(he,Pe){this.H.push(Pe.draw.bind(Pe,this.C,he.T,he.Wa===Le?"evenodd":"nonzero"))},_drawRiveImage:function(he,Pe,ct,vt){var rt=he.Fb;if(rt){var dt=this.C,bt=s(ct);this.H.push(function(){dt.globalCompositeOperation=bt,dt.globalAlpha=vt,dt.drawImage(rt,0,0),dt.globalAlpha=1})}},_getMatrix:function(he){const Pe=this.S,ct=Pe.length-6;for(let vt=0;6>vt;++vt)he[vt]=Pe[ct+vt]},_drawImageMesh:function(he,Pe,ct,vt,rt,dt,bt,Et,mn,Ht,dn){Pe=this.C.canvas.width;var zt=this.C.canvas.height;const Bo=Ht-Et,Wo=dn-mn;Et=Math.max(Et,0),mn=Math.max(mn,0),Ht=Math.min(Ht,Pe),dn=Math.min(dn,zt);const Si=Ht-Et,Ei=dn-mn;if(console.assert(Si<=Math.min(Bo,Pe)),console.assert(Ei<=Math.min(Wo,zt)),!(0>=Si||0>=Ei)){Ht=Si<Bo||Ei<Wo,Pe=dn=1;var pr=Math.ceil(Si*dn),gr=Math.ceil(Ei*Pe);zt=z.hc(),pr>zt&&(dn*=zt/pr,pr=zt),gr>zt&&(Pe*=zt/gr,gr=zt),Re||(Re=new p.DynamicRectanizer(zt),Re.reset(512,512)),zt=Re.addRect(pr,gr),0>zt&&(c(),at.add(this),zt=Re.addRect(pr,gr),console.assert(0<=zt));var Vo=zt&65535,qo=zt>>16;Mt.push({ha:this.S.slice(this.S.length-6),image:he,Za:Vo,$a:qo,ic:Et,jc:mn,Ac:pr,kb:gr,Ba:dn,Ca:Pe,Ua:new Float32Array(rt),Db:new Float32Array(dt),indices:new Uint16Array(bt),mc:Ht,xb:he.Ka<<1|(Ht?1:0)}),Xt+=rt.length,En+=bt.length;var $r=this.C,fc=s(ct);this.H.push(function(){$r.save(),$r.resetTransform(),$r.globalCompositeOperation=fc,$r.globalAlpha=vt;const Go=z.canvas();Go&&$r.drawImage(Go,Vo,qo,pr,gr,Et,mn,Si,Ei),$r.restore()})}},_clipPath:function(he){this.H.push(this.C.clip.bind(this.C,he.T,he.Wa===Le?"evenodd":"nonzero"))},clear:function(){at.add(this),this.H.push(this.C.clearRect.bind(this.C,0,0,this.Va.width,this.Va.height))},flush:function(){},translate:function(he,Pe){this.transform(1,0,0,1,he,Pe)}});p.makeRenderer=function(he){const Pe=new vr(he),ct=Pe.C;return new Proxy(Pe,{get(vt,rt){if(typeof vt[rt]=="function")return function(...dt){return vt[rt].apply(vt,dt)};if(typeof ct[rt]=="function"){if(-1<L.indexOf(rt))throw Error("RiveException: Method call to '"+rt+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...dt){Pe.H.push(ct[rt].bind(ct,...dt))}}return vt[rt]},set(vt,rt,dt){if(rt in ct)return Pe.H.push(()=>{ct[rt]=dt}),!0}})},p.decodeImage=function(he,Pe){new we({la:Pe}).decode(he)},p.renderFactory={makeRenderPaint:function(){return new nt},makeRenderPath:function(){return new pe},makeRenderImage:function(){let he=An;return new we({xa:()=>{he.total++},la:()=>{if(he.loaded++,he.loaded===he.total){const Pe=he.ready;Pe&&(Pe(),he.ready=null)}}})}};let ht=p.load,An=null;p.load=function(he,Pe,ct=!0){const vt=new p.FallbackFileAssetLoader;return Pe!==void 0&&vt.addLoader(Pe),ct&&(Pe=new p.CDNFileAssetLoader,vt.addLoader(Pe)),new Promise(function(rt){let dt=null;An={total:0,loaded:0,ready:function(){rt(dt)}},dt=ht(he,vt),An.total==0&&rt(dt)})};let dc=p.RendererWrapper.prototype.align;p.RendererWrapper.prototype.align=function(he,Pe,ct,vt,rt=1){dc.call(this,he,Pe,ct,vt,rt)},_=new P,p.requestAnimationFrame=_.requestAnimationFrame.bind(_),p.cancelAnimationFrame=_.cancelAnimationFrame.bind(_),p.enableFPSCounter=_.Rb.bind(_),p.disableFPSCounter=_.Ob,_.pb=c,p.resolveAnimationFrame=c,p.cleanup=function(){Re&&Re.delete()}};var C=Object.assign({},p),T="./this.program",K=typeof window=="object",X=typeof importScripts=="function",ve="",de,oe;(K||X)&&(X?ve=self.location.href:typeof document<"u"&&document.currentScript&&(ve=document.currentScript.src),k&&(ve=k),ve.indexOf("blob:")!==0?ve=ve.substr(0,ve.replace(/[?#].*/,"").lastIndexOf("/")+1):ve="",X&&(oe=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),de=(s,a,c)=>{var _=new XMLHttpRequest;_.open("GET",s,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?a(_.response):c()},_.onerror=c,_.send(null)});var me=p.print||console.log.bind(console),ee=p.printErr||console.error.bind(console);Object.assign(p,C),C=null,p.thisProgram&&(T=p.thisProgram);var D;p.wasmBinary&&(D=p.wasmBinary),p.noExitRuntime,typeof WebAssembly!="object"&&Ke("no native wasm support detected");var Z,M,$=!1,te,ae,ge,_e,Ie,Ee,We,ne;function le(){var s=Z.buffer;p.HEAP8=te=new Int8Array(s),p.HEAP16=ge=new Int16Array(s),p.HEAP32=Ie=new Int32Array(s),p.HEAPU8=ae=new Uint8Array(s),p.HEAPU16=_e=new Uint16Array(s),p.HEAPU32=Ee=new Uint32Array(s),p.HEAPF32=We=new Float32Array(s),p.HEAPF64=ne=new Float64Array(s)}var Y,ce=[],re=[],ue=[];function fe(){var s=p.preRun.shift();ce.unshift(s)}var ye=0,Ae=null;function Ke(s){throw p.onAbort&&p.onAbort(s),s="Aborted("+s+")",ee(s),$=!0,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),R(s),s}function Ue(s){return s.startsWith("data:application/octet-stream;base64,")}var $e;if($e="canvas_advanced.wasm",!Ue($e)){var Ve=$e;$e=p.locateFile?p.locateFile(Ve,ve):ve+Ve}function qe(s){if(s==$e&&D)return new Uint8Array(D);if(oe)return oe(s);throw"both async and sync fetching of the wasm failed"}function _t(s){if(!D&&(K||X)){if(typeof fetch=="function"&&!s.startsWith("file://"))return fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>qe(s));if(de)return new Promise((a,c)=>{de(s,_=>a(new Uint8Array(_)),c)})}return Promise.resolve().then(()=>qe(s))}function lt(s,a,c){return _t(s).then(_=>WebAssembly.instantiate(_,a)).then(_=>_).then(c,_=>{ee("failed to asynchronously prepare wasm: "+_),Ke(_)})}function kt(s,a){var c=$e;return D||typeof WebAssembly.instantiateStreaming!="function"||Ue(c)||c.startsWith("file://")||typeof fetch!="function"?lt(c,s,a):fetch(c,{credentials:"same-origin"}).then(_=>WebAssembly.instantiateStreaming(_,s).then(a,function(I){return ee("wasm streaming compile failed: "+I),ee("falling back to ArrayBuffer instantiation"),lt(c,s,a)}))}var mt,y,o={460492:(s,a,c,_,I)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Aa:0},window.h.I={},window.h.I.ya=s,window.h.I.capture=a,window.h.I.La=c,window.h.ga={},window.h.ga.stopped=_,window.h.ga.yb=I;let A=window.h;A.D=[],A.yc=function(O){for(var G=0;G<A.D.length;++G)if(A.D[G]==null)return A.D[G]=O,G;return A.D.push(O),A.D.length-1},A.Cb=function(O){for(A.D[O]=null;0<A.D.length&&A.D[A.D.length-1]==null;)A.D.pop()},A.Sc=function(O){for(var G=0;G<A.D.length;++G)if(A.D[G]==O)return A.Cb(G)},A.ra=function(O){return A.D[O]},A.Ta=["touchend","click"],A.unlock=function(){for(var O=0;O<A.D.length;++O){var G=A.D[O];G!=null&&G.J!=null&&G.state===A.ga.yb&&G.J.resume().then(()=>{Do(G.qb)},J=>{console.error("Failed to resume audiocontext",J)})}A.Ta.map(function(J){document.removeEventListener(J,A.unlock,!0)})},A.Ta.map(function(O){document.addEventListener(O,A.unlock,!0)})}return window.h.Aa+=1,1},462670:()=>{typeof window.h<"u"&&(window.h.Ta.map(function(s){document.removeEventListener(s,window.h.unlock,!0)}),--window.h.Aa,window.h.Aa===0&&delete window.h)},462974:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,463078:()=>{try{var s=new(window.AudioContext||window.webkitAudioContext),a=s.sampleRate;return s.close(),a}catch{return 0}},463249:(s,a,c,_,I,A)=>{if(typeof window.h>"u")return-1;var O={},G={};return s==window.h.I.ya&&c!=0&&(G.sampleRate=c),O.J=new(window.AudioContext||window.webkitAudioContext)(G),O.J.suspend(),O.state=window.h.ga.stopped,c=0,s!=window.h.I.ya&&(c=a),O.Z=O.J.createScriptProcessor(_,c,a),O.Z.onaudioprocess=function(J){if((O.sa==null||O.sa.length==0)&&(O.sa=new Float32Array(We.buffer,I,_*a)),s==window.h.I.capture||s==window.h.I.La){for(var N=0;N<a;N+=1)for(var ke=J.inputBuffer.getChannelData(N),je=O.sa,Le=0;Le<_;Le+=1)je[Le*a+N]=ke[Le];Fo(A,_,I)}if(s==window.h.I.ya||s==window.h.I.La)for($o(A,_,I),N=0;N<J.outputBuffer.numberOfChannels;++N)for(ke=J.outputBuffer.getChannelData(N),je=O.sa,Le=0;Le<_;Le+=1)ke[Le]=je[Le*a+N];else for(N=0;N<J.outputBuffer.numberOfChannels;++N)J.outputBuffer.getChannelData(N).fill(0)},s!=window.h.I.capture&&s!=window.h.I.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(J){O.Da=O.J.createMediaStreamSource(J),O.Da.connect(O.Z),O.Z.connect(O.J.destination)}).catch(function(J){console.log("Failed to get user media: "+J)}),s==window.h.I.ya&&O.Z.connect(O.J.destination),O.qb=A,window.h.yc(O)},466126:s=>window.h.ra(s).J.sampleRate,466199:s=>{s=window.h.ra(s),s.Z!==void 0&&(s.Z.onaudioprocess=function(){},s.Z.disconnect(),s.Z=void 0),s.Da!==void 0&&(s.Da.disconnect(),s.Da=void 0),s.J.close(),s.J=void 0,s.qb=void 0},466599:s=>{window.h.Cb(s)},466649:s=>{s=window.h.ra(s),s.J.resume(),s.state=window.h.ga.yb},466788:s=>{s=window.h.ra(s),s.J.suspend(),s.state=window.h.ga.stopped}},d=s=>{for(;0<s.length;)s.shift()(p)},w=(s,a)=>{for(var c=0,_=s.length-1;0<=_;_--){var I=s[_];I==="."?s.splice(_,1):I===".."?(s.splice(_,1),c++):c&&(s.splice(_,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},x=s=>{var a=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=w(s.split("/").filter(_=>!!_),!a).join("/"))||a||(s="."),s&&c&&(s+="/"),(a?"/":"")+s},V=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},se=s=>{if(s==="/")return"/";s=x(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},Te=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);Ke("initRandomDevice")},Fe=s=>(Fe=Te())(s);function xe(){for(var s="",a=!1,c=arguments.length-1;-1<=c&&!a;c--){if(a=0<=c?arguments[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=w(s.split("/").filter(_=>!!_),!a).join("/"),(a?"/":"")+s||"."}var Be=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ye=(s,a,c)=>{var _=a+c;for(c=a;s[c]&&!(c>=_);)++c;if(16<c-a&&s.buffer&&Be)return Be.decode(s.subarray(a,c));for(_="";a<c;){var I=s[a++];if(I&128){var A=s[a++]&63;if((I&224)==192)_+=String.fromCharCode((I&31)<<6|A);else{var O=s[a++]&63;I=(I&240)==224?(I&15)<<12|A<<6|O:(I&7)<<18|A<<12|O<<6|s[a++]&63,65536>I?_+=String.fromCharCode(I):(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023))}}else _+=String.fromCharCode(I)}return _},It=[],ft=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);127>=_?a++:2047>=_?a+=2:55296<=_&&57343>=_?(a+=4,++c):a+=3}return a},Wt=(s,a,c,_)=>{if(!(0<_))return 0;var I=c;_=c+_-1;for(var A=0;A<s.length;++A){var O=s.charCodeAt(A);if(55296<=O&&57343>=O){var G=s.charCodeAt(++A);O=65536+((O&1023)<<10)|G&1023}if(127>=O){if(c>=_)break;a[c++]=O}else{if(2047>=O){if(c+1>=_)break;a[c++]=192|O>>6}else{if(65535>=O){if(c+2>=_)break;a[c++]=224|O>>12}else{if(c+3>=_)break;a[c++]=240|O>>18,a[c++]=128|O>>12&63}a[c++]=128|O>>6&63}a[c++]=128|O&63}}return a[c]=0,c-I};function $t(s,a){var c=Array(ft(s)+1);return s=Wt(s,c,0,c.length),a&&(c.length=s),c}var Ct=[];function et(s,a){Ct[s]={input:[],F:[],V:a},Us(s,Ge)}var Ge={open:function(s){var a=Ct[s.node.za];if(!a)throw new De(43);s.s=a,s.seekable=!1},close:function(s){s.s.V.qa(s.s)},qa:function(s){s.s.V.qa(s.s)},read:function(s,a,c,_){if(!s.s||!s.s.V.jb)throw new De(60);for(var I=0,A=0;A<_;A++){try{var O=s.s.V.jb(s.s)}catch{throw new De(29)}if(O===void 0&&I===0)throw new De(6);if(O==null)break;I++,a[c+A]=O}return I&&(s.node.timestamp=Date.now()),I},write:function(s,a,c,_){if(!s.s||!s.s.V.Oa)throw new De(60);try{for(var I=0;I<_;I++)s.s.V.Oa(s.s,a[c+I])}catch{throw new De(29)}return _&&(s.node.timestamp=Date.now()),I}},St={jb:function(){e:{if(!It.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){s=null;break e}It=$t(s,!0)}s=It.shift()}return s},Oa:function(s,a){a===null||a===10?(me(Ye(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(me(Ye(s.F,0)),s.F=[])},bc:function(){return{Fc:25856,Hc:5,Ec:191,Gc:35387,Dc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},cc:function(){return 0},dc:function(){return[24,80]}},st={Oa:function(s,a){a===null||a===10?(ee(Ye(s.F,0)),s.F=[]):a!=0&&s.F.push(a)},qa:function(s){s.F&&0<s.F.length&&(ee(Ye(s.F,0)),s.F=[])}};function ut(s,a){var c=s.j?s.j.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=s.j,s.j=new Uint8Array(a),0<s.v&&s.j.set(c.subarray(0,s.v),0))}var Ce={O:null,U(){return Ce.createNode(null,"/",16895,0)},createNode(s,a,c,_){if((c&61440)===24576||(c&61440)===4096)throw new De(63);return Ce.O||(Ce.O={dir:{node:{Y:Ce.l.Y,P:Ce.l.P,ka:Ce.l.ka,va:Ce.l.va,vb:Ce.l.vb,Bb:Ce.l.Bb,wb:Ce.l.wb,tb:Ce.l.tb,Ea:Ce.l.Ea},stream:{ba:Ce.m.ba}},file:{node:{Y:Ce.l.Y,P:Ce.l.P},stream:{ba:Ce.m.ba,read:Ce.m.read,write:Ce.m.write,pa:Ce.m.pa,mb:Ce.m.mb,ob:Ce.m.ob}},link:{node:{Y:Ce.l.Y,P:Ce.l.P,ma:Ce.l.ma},stream:{}},ab:{node:{Y:Ce.l.Y,P:Ce.l.P},stream:Vu}}),c=io(s,a,c,_),(c.mode&61440)===16384?(c.l=Ce.O.dir.node,c.m=Ce.O.dir.stream,c.j={}):(c.mode&61440)===32768?(c.l=Ce.O.file.node,c.m=Ce.O.file.stream,c.v=0,c.j=null):(c.mode&61440)===40960?(c.l=Ce.O.link.node,c.m=Ce.O.link.stream):(c.mode&61440)===8192&&(c.l=Ce.O.ab.node,c.m=Ce.O.ab.stream),c.timestamp=Date.now(),s&&(s.j[a]=c,s.timestamp=c.timestamp),c},Kc(s){return s.j?s.j.subarray?s.j.subarray(0,s.v):new Uint8Array(s.j):new Uint8Array(0)},l:{Y(s){var a={};return a.Jc=(s.mode&61440)===8192?s.id:1,a.Mc=s.id,a.mode=s.mode,a.Oc=1,a.uid=0,a.Lc=0,a.za=s.za,(s.mode&61440)===16384?a.size=4096:(s.mode&61440)===32768?a.size=s.v:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Bc=new Date(s.timestamp),a.Nc=new Date(s.timestamp),a.Ic=new Date(s.timestamp),a.Jb=4096,a.Cc=Math.ceil(a.size/a.Jb),a},P(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.v!=a))if(a==0)s.j=null,s.v=0;else{var c=s.j;s.j=new Uint8Array(a),c&&s.j.set(c.subarray(0,Math.min(a,s.v))),s.v=a}},ka(){throw $s[44]},va(s,a,c,_){return Ce.createNode(s,a,c,_)},vb(s,a,c){if((s.mode&61440)===16384){try{var _=Bi(a,c)}catch{}if(_)for(var I in _.j)throw new De(55)}delete s.parent.j[s.name],s.parent.timestamp=Date.now(),s.name=c,a.j[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},Bb(s,a){delete s.j[a],s.timestamp=Date.now()},wb(s,a){var c=Bi(s,a),_;for(_ in c.j)throw new De(55);delete s.j[a],s.timestamp=Date.now()},tb(s){var a=[".",".."],c;for(c in s.j)s.j.hasOwnProperty(c)&&a.push(c);return a},Ea(s,a,c){return s=Ce.createNode(s,a,41471,0),s.link=c,s},ma(s){if((s.mode&61440)!==40960)throw new De(28);return s.link}},m:{read(s,a,c,_,I){var A=s.node.j;if(I>=s.node.v)return 0;if(s=Math.min(s.node.v-I,_),8<s&&A.subarray)a.set(A.subarray(I,I+s),c);else for(_=0;_<s;_++)a[c+_]=A[I+_];return s},write(s,a,c,_,I,A){if(a.buffer===te.buffer&&(A=!1),!_)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.j||s.j.subarray)){if(A)return s.j=a.subarray(c,c+_),s.v=_;if(s.v===0&&I===0)return s.j=a.slice(c,c+_),s.v=_;if(I+_<=s.v)return s.j.set(a.subarray(c,c+_),I),_}if(ut(s,I+_),s.j.subarray&&a.subarray)s.j.set(a.subarray(c,c+_),I);else for(A=0;A<_;A++)s.j[I+A]=a[c+A];return s.v=Math.max(s.v,I+_),_},ba(s,a,c){if(c===1?a+=s.position:c===2&&(s.node.mode&61440)===32768&&(a+=s.node.v),0>a)throw new De(28);return a},pa(s,a,c){ut(s.node,a+c),s.node.v=Math.max(s.node.v,a+c)},mb(s,a,c,_,I){if((s.node.mode&61440)!==32768)throw new De(43);if(s=s.node.j,I&2||s.buffer!==te.buffer){if((0<c||c+a<s.length)&&(s.subarray?s=s.subarray(c,c+a):s=Array.prototype.slice.call(s,c,c+a)),c=!0,Ke(),a=void 0,!a)throw new De(48);te.set(s,a)}else c=!1,a=s.byteOffset;return{o:a,M:c}},ob(s,a,c,_){return Ce.m.write(s,a,0,_,c,!1),0}}};function He(s,a){var c=0;return s&&(c|=365),a&&(c|=146),c}var Vt=null,Mr={},Ni=[],Bu=1,pi=null,to=!0,De=null,$s={},dr=(s,a={})=>{if(s=xe(s),!s)return{path:"",node:null};if(a=Object.assign({hb:!0,Qa:0},a),8<a.Qa)throw new De(32);s=s.split("/").filter(O=>!!O);for(var c=Vt,_="/",I=0;I<s.length;I++){var A=I===s.length-1;if(A&&a.parent)break;if(c=Bi(c,s[I]),_=x(_+"/"+s[I]),c.wa&&(!A||A&&a.hb)&&(c=c.wa.root),!A||a.gb){for(A=0;(c.mode&61440)===40960;)if(c=qu(_),_=xe(V(_),c),c=dr(_,{Qa:a.Qa+1}).node,40<A++)throw new De(32)}}return{path:_,node:c}},no=s=>{for(var a;;){if(s===s.parent)return s=s.U.nb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}},ro=(s,a)=>{for(var c=0,_=0;_<a.length;_++)c=(c<<5)-c+a.charCodeAt(_)|0;return(s+c>>>0)%pi.length},Bi=(s,a)=>{var c;if(c=(c=Wi(s,"x"))?c:s.l.ka?0:2)throw new De(c,s);for(c=pi[ro(s.id,a)];c;c=c.lc){var _=c.name;if(c.parent.id===s.id&&_===a)return c}return s.l.ka(s,a)},io=(s,a,c,_)=>(s=new Po(s,a,c,_),a=ro(s.parent.id,s.name),s.lc=pi[a],pi[a]=s),so=s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},Wi=(s,a)=>{if(to)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0},ao=(s,a)=>{try{return Bi(s,a),20}catch{}return Wi(s,"wx")},Wu=()=>{for(var s=0;4096>=s;s++)if(!Ni[s])return s;throw new De(33)},Hn=s=>{if(s=Ni[s],!s)throw new De(8);return s},oo=(s,a=-1)=>(_i||(_i=function(){this.h={}},_i.prototype={},Object.defineProperties(_i.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.h.flags},set(c){this.h.flags=c}},position:{get(){return this.h.position},set(c){this.h.position=c}}})),s=Object.assign(new _i,s),a==-1&&(a=Wu()),s.X=a,Ni[a]=s),Vu={open:s=>{s.m=Mr[s.node.za].m,s.m.open&&s.m.open(s)},ba:()=>{throw new De(70)}},Us=(s,a)=>{Mr[s]={m:a}},lo=(s,a)=>{var c=a==="/",_=!a;if(c&&Vt)throw new De(10);if(!c&&!_){var I=dr(a,{hb:!1});if(a=I.path,I=I.node,I.wa)throw new De(10);if((I.mode&61440)!==16384)throw new De(54)}a={type:s,Qc:{},nb:a,kc:[]},s=s.U(a),s.U=a,a.root=s,c?Vt=s:I&&(I.wa=a,I.U&&I.U.kc.push(a))},pn=(s,a,c)=>{var _=dr(s,{parent:!0}).node;if(s=se(s),!s||s==="."||s==="..")throw new De(28);var I=ao(_,s);if(I)throw new De(I);if(!_.l.va)throw new De(63);return _.l.va(_,s,a,c)},Vi=(s,a,c)=>{typeof c>"u"&&(c=a,a=438),pn(s,a|8192,c)},Ns=(s,a)=>{if(!xe(s))throw new De(44);var c=dr(a,{parent:!0}).node;if(!c)throw new De(44);a=se(a);var _=ao(c,a);if(_)throw new De(_);if(!c.l.Ea)throw new De(63);c.l.Ea(c,a,s)},qu=s=>{if(s=dr(s).node,!s)throw new De(44);if(!s.l.ma)throw new De(28);return xe(no(s.parent),s.l.ma(s))},qi=(s,a,c)=>{if(s==="")throw new De(44);if(typeof a=="string"){var _={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof _>"u")throw Error(`Unknown file open mode: ${a}`);a=_}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var I=s;else{s=x(s);try{I=dr(s,{gb:!(a&131072)}).node}catch{}}if(_=!1,a&64)if(I){if(a&128)throw new De(20)}else I=pn(s,c,0),_=!0;if(!I)throw new De(44);if((I.mode&61440)===8192&&(a&=-513),a&65536&&(I.mode&61440)!==16384)throw new De(54);if(!_&&(c=I?(I.mode&61440)===40960?32:(I.mode&61440)===16384&&(so(a)!=="r"||a&512)?31:Wi(I,so(a)):44))throw new De(c);if(a&512&&!_){if(c=I,c=typeof c=="string"?dr(c,{gb:!0}).node:c,!c.l.P)throw new De(63);if((c.mode&61440)===16384)throw new De(31);if((c.mode&61440)!==32768)throw new De(28);if(_=Wi(c,"w"))throw new De(_);c.l.P(c,{size:0,timestamp:Date.now()})}return a&=-131713,I=oo({node:I,path:no(I),flags:a,seekable:!0,position:0,m:I.m,zc:[],error:!1}),I.m.open&&I.m.open(I),!p.logReadFiles||a&1||(Gi||(Gi={}),s in Gi||(Gi[s]=1)),I},uo=(s,a,c)=>{if(s.X===null)throw new De(8);if(!s.seekable||!s.m.ba)throw new De(70);if(c!=0&&c!=1&&c!=2)throw new De(28);s.position=s.m.ba(s,a,c),s.zc=[]},co=()=>{De||(De=function(s,a){this.name="ErrnoError",this.node=a,this.pc=function(c){this.aa=c},this.pc(s),this.message="FS error"},De.prototype=Error(),De.prototype.constructor=De,[44].forEach(s=>{$s[s]=new De(s),$s[s].stack="<generic error, no stack>"}))},fo,gi=(s,a,c)=>{s=x("/dev/"+s);var _=He(!!a,!!c);Bs||(Bs=64);var I=Bs++<<8|0;Us(I,{open:A=>{A.seekable=!1},close:()=>{c&&c.buffer&&c.buffer.length&&c(10)},read:(A,O,G,J)=>{for(var N=0,ke=0;ke<J;ke++){try{var je=a()}catch{throw new De(29)}if(je===void 0&&N===0)throw new De(6);if(je==null)break;N++,O[G+ke]=je}return N&&(A.node.timestamp=Date.now()),N},write:(A,O,G,J)=>{for(var N=0;N<J;N++)try{c(O[G+N])}catch{throw new De(29)}return J&&(A.node.timestamp=Date.now()),N}}),Vi(s,_,I)},Bs,fr={},_i,Gi,mi=void 0;function Ln(){return mi+=4,Ie[mi-4>>2]}function ho(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?`_${s}`:s}function Hi(s,a){return s=ho(s),{[s]:function(){return a.apply(this,arguments)}}[s]}function vo(){this.M=[void 0],this.ib=[]}var cn=new vo,Lr=void 0;function tt(s){throw new Lr(s)}var gn=s=>(s||tt("Cannot use deleted val. handle = "+s),cn.get(s).value),_n=s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return cn.pa({ub:1,value:s})}};function po(s){var a=Error,c=Hi(s,function(_){this.name=s,this.message=_,_=Error(_).stack,_!==void 0&&(this.stack=this.toString()+`
`+_.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},c}var go=void 0,_o=void 0;function Ut(s){for(var a="";ae[s];)a+=_o[ae[s++]];return a}var yi=[];function Ws(){for(;yi.length;){var s=yi.pop();s.g.fa=!1,s.delete()}}var bi=void 0,Dn={};function Vs(s,a){for(a===void 0&&tt("ptr should not be undefined");s.A;)a=s.na(a),s=s.A;return a}var hr={};function mo(s){s=Uo(s);var a=Ut(s);return Un(s),a}function wi(s,a){var c=hr[s];return c===void 0&&tt(a+" has unknown type "+mo(s)),c}function zi(){}var qs=!1;function yo(s){--s.count.value,s.count.value===0&&(s.G?s.L.W(s.G):s.u.i.W(s.o))}function bo(s,a,c){return a===c?s:c.A===void 0?null:(s=bo(s,a,c.A),s===null?null:c.Pb(s))}var wo={};function Gu(s,a){return a=Vs(s,a),Dn[a]}var ko=void 0;function Ki(s){throw new ko(s)}function Yi(s,a){return a.u&&a.o||Ki("makeClassHandle requires ptr and ptrType"),!!a.L!=!!a.G&&Ki("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Dr(Object.create(s,{g:{value:a}}))}function Dr(s){return typeof FinalizationRegistry>"u"?(Dr=a=>a,s):(qs=new FinalizationRegistry(a=>{yo(a.g)}),Dr=a=>{var c=a.g;return c.G&&qs.register(a,{g:c},a),a},zi=a=>{qs.unregister(a)},Dr(s))}var Ji={};function ki(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function Ii(s){return this.fromWireType(Ie[s>>2])}var Fr={},Xi={};function on(s,a,c){function _(G){G=c(G),G.length!==s.length&&Ki("Mismatched type converter count");for(var J=0;J<s.length;++J)Sn(s[J],G[J])}s.forEach(function(G){Xi[G]=a});var I=Array(a.length),A=[],O=0;a.forEach((G,J)=>{hr.hasOwnProperty(G)?I[J]=hr[G]:(A.push(G),Fr.hasOwnProperty(G)||(Fr[G]=[]),Fr[G].push(()=>{I[J]=hr[G],++O,O===A.length&&_(I)}))}),A.length===0&&_(I)}function Qi(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${s}`)}}function Hu(s,a,c={}){var _=a.name;if(s||tt(`type "${_}" must have a positive integer typeid pointer`),hr.hasOwnProperty(s)){if(c.$b)return;tt(`Cannot register type '${_}' twice`)}hr[s]=a,delete Xi[s],Fr.hasOwnProperty(s)&&(a=Fr[s],delete Fr[s],a.forEach(I=>I()))}function Sn(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");Hu(s,a,c)}function Gs(s){tt(s.g.u.i.name+" instance already deleted")}function zn(){}function Hs(s,a,c){if(s[a].B===void 0){var _=s[a];s[a]=function(){return s[a].B.hasOwnProperty(arguments.length)||tt(`Function '${c}' called with an invalid number of arguments (${arguments.length}) - expects one of (${s[a].B})!`),s[a].B[arguments.length].apply(this,arguments)},s[a].B=[],s[a].B[_.ea]=_}}function zs(s,a,c){p.hasOwnProperty(s)?((c===void 0||p[s].B!==void 0&&p[s].B[c]!==void 0)&&tt(`Cannot register public name '${s}' twice`),Hs(p,s,s),p.hasOwnProperty(c)&&tt(`Cannot register multiple overloads of a function with the same number of arguments (${c})!`),p[s].B[c]=a):(p[s]=a,c!==void 0&&(p[s].Pc=c))}function zu(s,a,c,_,I,A,O,G){this.name=s,this.constructor=a,this.N=c,this.W=_,this.A=I,this.Ub=A,this.na=O,this.Pb=G,this.rb=[]}function Zi(s,a,c){for(;a!==c;)a.na||tt(`Expected null or instance of ${c.name}, got an instance of ${a.name}`),s=a.na(s),a=a.A;return s}function Ku(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Yu(s,a){if(a===null){if(this.Na&&tt(`null is not a valid ${this.name}`),this.ua){var c=this.Pa();return s!==null&&s.push(this.W,c),c}return 0}if(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.ta&&a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`),c=Zi(a.g.o,a.g.u.i,this.i),this.ua)switch(a.g.G===void 0&&tt("Passing raw pointer to smart pointer is illegal"),this.tc){case 0:a.g.L===this?c=a.g.G:tt(`Cannot convert argument of type ${a.g.L?a.g.L.name:a.g.u.name} to parameter type ${this.name}`);break;case 1:c=a.g.G;break;case 2:if(a.g.L===this)c=a.g.G;else{var _=a.clone();c=this.oc(c,_n(function(){_.delete()})),s!==null&&s.push(this.W,c)}break;default:tt("Unsupporting sharing policy")}return c}function Ju(s,a){return a===null?(this.Na&&tt(`null is not a valid ${this.name}`),0):(a.g||tt(`Cannot pass "${Ys(a)}" as a ${this.name}`),a.g.o||tt(`Cannot pass deleted object as a pointer of type ${this.name}`),a.g.u.ta&&tt(`Cannot convert argument of type ${a.g.u.name} to parameter type ${this.name}`),Zi(a.g.o,a.g.u.i,this.i))}function Fn(s,a,c,_){this.name=s,this.i=a,this.Na=c,this.ta=_,this.ua=!1,this.W=this.oc=this.Pa=this.sb=this.tc=this.nc=void 0,a.A!==void 0?this.toWireType=Yu:(this.toWireType=_?Ku:Ju,this.K=null)}function Io(s,a,c){p.hasOwnProperty(s)||Ki("Replacing nonexistant public symbol"),p[s].B!==void 0&&c!==void 0?p[s].B[c]=a:(p[s]=a,p[s].ea=c)}var es=[],So=s=>{var a=es[s];return a||(s>=es.length&&(es.length=s+1),es[s]=a=Y.get(s)),a},Xu=(s,a)=>{var c=[];return function(){if(c.length=0,Object.assign(c,arguments),s.includes("j")){var _=p["dynCall_"+s];_=c&&c.length?_.apply(null,[a].concat(c)):_.call(null,a)}else _=So(a).apply(null,c);return _}};function Qt(s,a){s=Ut(s);var c=s.includes("j")?Xu(s,a):So(a);return typeof c!="function"&&tt(`unknown function pointer with signature ${s}: ${a}`),c}var Eo=void 0;function $n(s,a){function c(A){I[A]||hr[A]||(Xi[A]?Xi[A].forEach(c):(_.push(A),I[A]=!0))}var _=[],I={};throw a.forEach(c),new Eo(`${s}: `+_.map(mo).join([", "]))}function ts(s,a,c,_,I){var A=a.length;2>A&&tt("argTypes array size mismatch! Must at least get return value and 'this' types!");var O=a[1]!==null&&c!==null,G=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].K===void 0){G=!0;break}var J=a[0].name!=="void",N=A-2,ke=Array(N),je=[],Le=[];return function(){if(arguments.length!==N&&tt(`function ${s} called with ${arguments.length} arguments, expected ${N} args!`),Le.length=0,je.length=O?2:1,je[0]=I,O){var F=a[1].toWireType(Le,this);je[1]=F}for(var we=0;we<N;++we)ke[we]=a[we+2].toWireType(Le,arguments[we]),je.push(ke[we]);if(we=_.apply(null,je),G)ki(Le);else for(var pe=O?1:2;pe<a.length;pe++){var nt=pe===1?F:ke[pe-2];a[pe].K!==null&&a[pe].K(nt)}return F=J?a[0].fromWireType(we):void 0,F}}function ns(s,a){for(var c=[],_=0;_<s;_++)c.push(Ee[a+4*_>>2]);return c}function Ao(s,a,c){return s instanceof Object||tt(`${c} with invalid "this": ${s}`),s instanceof a.i.constructor||tt(`${c} incompatible with "this" of type ${s.constructor.name}`),s.g.o||tt(`cannot call emscripten binding method ${c} on deleted object`),Zi(s.g.o,s.g.u.i,a.i)}function Ks(s){s>=cn.h&&--cn.get(s).ub===0&&cn.Zb(s)}function Qu(s,a,c){switch(a){case 0:return function(_){return this.fromWireType((c?te:ae)[_])};case 1:return function(_){return this.fromWireType((c?ge:_e)[_>>1])};case 2:return function(_){return this.fromWireType((c?Ie:Ee)[_>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Ys(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Zu(s,a){switch(a){case 2:return function(c){return this.fromWireType(We[c>>2])};case 3:return function(c){return this.fromWireType(ne[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function ec(s,a,c){switch(a){case 0:return c?function(_){return te[_]}:function(_){return ae[_]};case 1:return c?function(_){return ge[_>>1]}:function(_){return _e[_>>1]};case 2:return c?function(_){return Ie[_>>2]}:function(_){return Ee[_>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Co=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,tc=(s,a)=>{for(var c=s>>1,_=c+a/2;!(c>=_)&&_e[c];)++c;if(c<<=1,32<c-s&&Co)return Co.decode(ae.subarray(s,c));for(c="",_=0;!(_>=a/2);++_){var I=ge[s+2*_>>1];if(I==0)break;c+=String.fromCharCode(I)}return c},nc=(s,a,c)=>{if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var _=a;c=c<2*s.length?c/2:s.length;for(var I=0;I<c;++I)ge[a>>1]=s.charCodeAt(I),a+=2;return ge[a>>1]=0,a-_},rc=s=>2*s.length,ic=(s,a)=>{for(var c=0,_="";!(c>=a/4);){var I=Ie[s+4*c>>2];if(I==0)break;++c,65536<=I?(I-=65536,_+=String.fromCharCode(55296|I>>10,56320|I&1023)):_+=String.fromCharCode(I)}return _},sc=(s,a,c)=>{if(c===void 0&&(c=2147483647),4>c)return 0;var _=a;c=_+c-4;for(var I=0;I<s.length;++I){var A=s.charCodeAt(I);if(55296<=A&&57343>=A){var O=s.charCodeAt(++I);A=65536+((A&1023)<<10)|O&1023}if(Ie[a>>2]=A,a+=4,a+4>c)break}return Ie[a>>2]=0,a-_},ac=s=>{for(var a=0,c=0;c<s.length;++c){var _=s.charCodeAt(c);55296<=_&&57343>=_&&++c,a+=4}return a},oc={};function rs(s){var a=oc[s];return a===void 0?Ut(s):a}var is=[];function lc(s){var a=is.length;return is.push(s),a}function uc(s,a){for(var c=Array(s),_=0;_<s;++_)c[_]=wi(Ee[a+4*_>>2],"parameter "+_);return c}var jo=[],Js=[],Xs={},To=()=>{if(!Qs){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:T||"./this.program"},a;for(a in Xs)Xs[a]===void 0?delete s[a]:s[a]=Xs[a];var c=[];for(a in s)c.push(`${a}=${s[a]}`);Qs=c}return Qs},Qs,ss=s=>s%4===0&&(s%100!==0||s%400===0),xo=[31,29,31,30,31,30,31,31,30,31,30,31],Ro=[31,28,31,30,31,30,31,31,30,31,30,31],cc=(s,a,c,_)=>{function I(F,we,pe){for(F=typeof F=="number"?F.toString():F||"";F.length<we;)F=pe[0]+F;return F}function A(F,we){return I(F,we,"0")}function O(F,we){function pe(at){return 0>at?-1:0<at?1:0}var nt;return(nt=pe(F.getFullYear()-we.getFullYear()))===0&&(nt=pe(F.getMonth()-we.getMonth()))===0&&(nt=pe(F.getDate()-we.getDate())),nt}function G(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function J(F){var we=F.ca;for(F=new Date(new Date(F.da+1900,0,1).getTime());0<we;){var pe=F.getMonth(),nt=(ss(F.getFullYear())?xo:Ro)[pe];if(we>nt-F.getDate())we-=nt-F.getDate()+1,F.setDate(1),11>pe?F.setMonth(pe+1):(F.setMonth(0),F.setFullYear(F.getFullYear()+1));else{F.setDate(F.getDate()+we);break}}return pe=new Date(F.getFullYear()+1,0,4),we=G(new Date(F.getFullYear(),0,4)),pe=G(pe),0>=O(we,F)?0>=O(pe,F)?F.getFullYear()+1:F.getFullYear():F.getFullYear()-1}var N=Ie[_+40>>2];_={wc:Ie[_>>2],vc:Ie[_+4>>2],Fa:Ie[_+8>>2],Sa:Ie[_+12>>2],Ga:Ie[_+16>>2],da:Ie[_+20>>2],R:Ie[_+24>>2],ca:Ie[_+28>>2],Rc:Ie[_+32>>2],uc:Ie[_+36>>2],xc:N&&N?Ye(ae,N):""},c=c?Ye(ae,c):"",N={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ke in N)c=c.replace(new RegExp(ke,"g"),N[ke]);var je="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Le="January February March April May June July August September October November December".split(" ");N={"%a":F=>je[F.R].substring(0,3),"%A":F=>je[F.R],"%b":F=>Le[F.Ga].substring(0,3),"%B":F=>Le[F.Ga],"%C":F=>A((F.da+1900)/100|0,2),"%d":F=>A(F.Sa,2),"%e":F=>I(F.Sa,2," "),"%g":F=>J(F).toString().substring(2),"%G":F=>J(F),"%H":F=>A(F.Fa,2),"%I":F=>(F=F.Fa,F==0?F=12:12<F&&(F-=12),A(F,2)),"%j":F=>{for(var we=0,pe=0;pe<=F.Ga-1;we+=(ss(F.da+1900)?xo:Ro)[pe++]);return A(F.Sa+we,3)},"%m":F=>A(F.Ga+1,2),"%M":F=>A(F.vc,2),"%n":()=>`
`,"%p":F=>0<=F.Fa&&12>F.Fa?"AM":"PM","%S":F=>A(F.wc,2),"%t":()=>"	","%u":F=>F.R||7,"%U":F=>A(Math.floor((F.ca+7-F.R)/7),2),"%V":F=>{var we=Math.floor((F.ca+7-(F.R+6)%7)/7);if(2>=(F.R+371-F.ca-2)%7&&we++,we)we==53&&(pe=(F.R+371-F.ca)%7,pe==4||pe==3&&ss(F.da)||(we=1));else{we=52;var pe=(F.R+7-F.ca-1)%7;(pe==4||pe==5&&ss(F.da%400-1))&&we++}return A(we,2)},"%w":F=>F.R,"%W":F=>A(Math.floor((F.ca+7-(F.R+6)%7)/7),2),"%y":F=>(F.da+1900).toString().substring(2),"%Y":F=>F.da+1900,"%z":F=>{F=F.uc;var we=0<=F;return F=Math.abs(F)/60,(we?"+":"-")+("0000"+(F/60*100+F%60)).slice(-4)},"%Z":F=>F.xc,"%%":()=>"%"},c=c.replace(/%%/g,"\0\0");for(ke in N)c.includes(ke)&&(c=c.replace(new RegExp(ke,"g"),N[ke](_)));return c=c.replace(/\0\0/g,"%"),ke=$t(c,!1),ke.length>a?0:(te.set(ke,s),ke.length-1)};function Po(s,a,c,_){s||(s=this),this.parent=s,this.U=s.U,this.wa=null,this.id=Bu++,this.name=a,this.mode=c,this.l={},this.m={},this.za=_}Object.defineProperties(Po.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),co(),pi=Array(4096),lo(Ce,"/"),pn("/tmp",16895,0),pn("/home",16895,0),pn("/home/web_user",16895,0),(()=>{pn("/dev",16895,0),Us(259,{read:()=>0,write:(_,I,A,O)=>O}),Vi("/dev/null",259),et(1280,St),et(1536,st),Vi("/dev/tty",1280),Vi("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=Fe(s).byteLength),s[--a]);gi("random",c),gi("urandom",c),pn("/dev/shm",16895,0),pn("/dev/shm/tmp",16895,0)})(),(()=>{pn("/proc",16895,0);var s=pn("/proc/self",16895,0);pn("/proc/self/fd",16895,0),lo({U:()=>{var a=io(s,"fd",16895,73);return a.l={ka:(c,_)=>{var I=Hn(+_);return c={parent:null,U:{nb:"fake"},l:{ma:()=>I.path}},c.parent=c}},a}},"/proc/self/fd")})(),Object.assign(vo.prototype,{get(s){return this.M[s]},has(s){return this.M[s]!==void 0},pa(s){var a=this.ib.pop()||this.M.length;return this.M[a]=s,a},Zb(s){this.M[s]=void 0,this.ib.push(s)}}),Lr=p.BindingError=class extends Error{constructor(s){super(s),this.name="BindingError"}},cn.M.push({value:void 0},{value:null},{value:!0},{value:!1}),cn.h=cn.M.length,p.count_emval_handles=function(){for(var s=0,a=cn.h;a<cn.M.length;++a)cn.M[a]!==void 0&&++s;return s},go=p.PureVirtualError=po("PureVirtualError");for(var Oo=Array(256),as=0;256>as;++as)Oo[as]=String.fromCharCode(as);_o=Oo,p.getInheritedInstanceCount=function(){return Object.keys(Dn).length},p.getLiveInheritedInstances=function(){var s=[],a;for(a in Dn)Dn.hasOwnProperty(a)&&s.push(Dn[a]);return s},p.flushPendingDeletes=Ws,p.setDelayFunction=function(s){bi=s,yi.length&&bi&&bi(Ws)},ko=p.InternalError=class extends Error{constructor(s){super(s),this.name="InternalError"}},zn.prototype.isAliasOf=function(s){if(!(this instanceof zn&&s instanceof zn))return!1;var a=this.g.u.i,c=this.g.o,_=s.g.u.i;for(s=s.g.o;a.A;)c=a.na(c),a=a.A;for(;_.A;)s=_.na(s),_=_.A;return a===_&&c===s},zn.prototype.clone=function(){if(this.g.o||Gs(this),this.g.ia)return this.g.count.value+=1,this;var s=Dr,a=Object,c=a.create,_=Object.getPrototypeOf(this),I=this.g;return s=s(c.call(a,_,{g:{value:{count:I.count,fa:I.fa,ia:I.ia,o:I.o,u:I.u,G:I.G,L:I.L}}})),s.g.count.value+=1,s.g.fa=!1,s},zn.prototype.delete=function(){this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),zi(this),yo(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},zn.prototype.isDeleted=function(){return!this.g.o},zn.prototype.deleteLater=function(){return this.g.o||Gs(this),this.g.fa&&!this.g.ia&&tt("Object already scheduled for deletion"),yi.push(this),yi.length===1&&bi&&bi(Ws),this.g.fa=!0,this},Fn.prototype.Vb=function(s){return this.sb&&(s=this.sb(s)),s},Fn.prototype.bb=function(s){this.W&&this.W(s)},Fn.prototype.argPackAdvance=8,Fn.prototype.readValueFromPointer=Ii,Fn.prototype.deleteObject=function(s){s!==null&&s.delete()},Fn.prototype.fromWireType=function(s){function a(){return this.ua?Yi(this.i.N,{u:this.nc,o:c,L:this,G:s}):Yi(this.i.N,{u:this,o:s})}var c=this.Vb(s);if(!c)return this.bb(s),null;var _=Gu(this.i,c);if(_!==void 0)return _.g.count.value===0?(_.g.o=c,_.g.G=s,_.clone()):(_=_.clone(),this.bb(s),_);if(_=this.i.Ub(c),_=wo[_],!_)return a.call(this);_=this.ta?_.Kb:_.pointerType;var I=bo(c,this.i,_.i);return I===null?a.call(this):this.ua?Yi(_.i.N,{u:_,o:I,L:this,G:s}):Yi(_.i.N,{u:_,o:I})},Eo=p.UnboundTypeError=po("UnboundTypeError");var Mo={__syscall_fcntl64:function(s,a,c){mi=c;try{var _=Hn(s);switch(a){case 0:var I=Ln();return 0>I?-28:oo(_,I).X;case 1:case 2:return 0;case 3:return _.flags;case 4:return I=Ln(),_.flags|=I,0;case 5:return I=Ln(),ge[I+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Ie[Lo()>>2]=28,-1;default:return-28}}catch(A){if(typeof fr>"u"||A.name!=="ErrnoError")throw A;return-A.aa}},__syscall_ioctl:function(s,a,c){mi=c;try{var _=Hn(s);switch(a){case 21509:return _.s?0:-59;case 21505:if(!_.s)return-59;if(_.s.V.bc){a=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var I=Ln();Ie[I>>2]=25856,Ie[I+4>>2]=5,Ie[I+8>>2]=191,Ie[I+12>>2]=35387;for(var A=0;32>A;A++)te[I+A+17>>0]=a[A]||0}return 0;case 21510:case 21511:case 21512:return _.s?0:-59;case 21506:case 21507:case 21508:if(!_.s)return-59;if(_.s.V.cc)for(I=Ln(),a=[],A=0;32>A;A++)a.push(te[I+A+17>>0]);return 0;case 21519:return _.s?(I=Ln(),Ie[I>>2]=0):-59;case 21520:return _.s?-28:-59;case 21531:if(I=Ln(),!_.m.ac)throw new De(59);return _.m.ac(_,a,I);case 21523:return _.s?(_.s.V.dc&&(A=[24,80],I=Ln(),ge[I>>1]=A[0],ge[I+2>>1]=A[1]),0):-59;case 21524:return _.s?0:-59;case 21515:return _.s?0:-59;default:return-28}}catch(O){if(typeof fr>"u"||O.name!=="ErrnoError")throw O;return-O.aa}},__syscall_openat:function(s,a,c,_){mi=_;try{a=a?Ye(ae,a):"";var I=a;if(I.charAt(0)==="/")a=I;else{var A=s===-100?"/":Hn(s).path;if(I.length==0)throw new De(44);a=x(A+"/"+I)}var O=_?Ln():0;return qi(a,c,O).X}catch(G){if(typeof fr>"u"||G.name!=="ErrnoError")throw G;return-G.aa}},_embind_create_inheriting_constructor:function(s,a,c){s=Ut(s),a=wi(a,"wrapper"),c=gn(c);var _=[].slice,I=a.i,A=I.N,O=I.A.N,G=I.A.constructor;s=Hi(s,function(){I.A.rb.forEach((function(N){if(this[N]===O[N])throw new go(`Pure virtual function ${N} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:A}),this.__construct.apply(this,_.call(arguments))}),A.__construct=function(){this===A&&tt("Pass correct 'this' to __construct");var N=G.implement.apply(void 0,[this].concat(_.call(arguments)));zi(N);var ke=N.g;N.notifyOnDestruction(),ke.ia=!0,Object.defineProperties(this,{g:{value:ke}}),Dr(this),N=ke.o,N=Vs(I,N),Dn.hasOwnProperty(N)?tt(`Tried to register registered instance: ${N}`):Dn[N]=this},A.__destruct=function(){this===A&&tt("Pass correct 'this' to __destruct"),zi(this);var N=this.g.o;N=Vs(I,N),Dn.hasOwnProperty(N)?delete Dn[N]:tt(`Tried to unregister unregistered instance: ${N}`)},s.prototype=Object.create(A);for(var J in c)s.prototype[J]=c[J];return _n(s)},_embind_finalize_value_object:function(s){var a=Ji[s];delete Ji[s];var c=a.Pa,_=a.W,I=a.fb,A=I.map(O=>O.Yb).concat(I.map(O=>O.rc));on([s],A,O=>{var G={};return I.forEach((J,N)=>{var ke=O[N],je=J.Wb,Le=J.Xb,F=O[N+I.length],we=J.qc,pe=J.sc;G[J.Sb]={read:nt=>ke.fromWireType(je(Le,nt)),write:(nt,at)=>{var Re=[];we(pe,nt,F.toWireType(Re,at)),ki(Re)}}}),[{name:a.name,fromWireType:function(J){var N={},ke;for(ke in G)N[ke]=G[ke].read(J);return _(J),N},toWireType:function(J,N){for(var ke in G)if(!(ke in N))throw new TypeError(`Missing field: "${ke}"`);var je=c();for(ke in G)G[ke].write(je,N[ke]);return J!==null&&J.push(_,je),je},argPackAdvance:8,readValueFromPointer:Ii,K:_}]})},_embind_register_bigint:function(){},_embind_register_bool:function(s,a,c,_,I){var A=Qi(c);a=Ut(a),Sn(s,{name:a,fromWireType:function(O){return!!O},toWireType:function(O,G){return G?_:I},argPackAdvance:8,readValueFromPointer:function(O){if(c===1)var G=te;else if(c===2)G=ge;else if(c===4)G=Ie;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(G[O>>A])},K:null})},_embind_register_class:function(s,a,c,_,I,A,O,G,J,N,ke,je,Le){ke=Ut(ke),A=Qt(I,A),G&&(G=Qt(O,G)),N&&(N=Qt(J,N)),Le=Qt(je,Le);var F=ho(ke);zs(F,function(){$n(`Cannot construct ${ke} due to unbound types`,[_])}),on([s,a,c],_?[_]:[],function(we){if(we=we[0],_)var pe=we.i,nt=pe.N;else nt=zn.prototype;we=Hi(F,function(){if(Object.getPrototypeOf(this)!==at)throw new Lr("Use 'new' to construct "+ke);if(Re.$===void 0)throw new Lr(ke+" has no accessible constructor");var Xt=Re.$[arguments.length];if(Xt===void 0)throw new Lr(`Tried to invoke ctor of ${ke} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Re.$).toString()}) parameters instead!`);return Xt.apply(this,arguments)});var at=Object.create(nt,{constructor:{value:we}});we.prototype=at;var Re=new zu(ke,we,at,Le,pe,A,G,N);Re.A&&(Re.A.oa===void 0&&(Re.A.oa=[]),Re.A.oa.push(Re)),pe=new Fn(ke,Re,!0,!1),nt=new Fn(ke+"*",Re,!1,!1);var Mt=new Fn(ke+" const*",Re,!1,!0);return wo[s]={pointerType:nt,Kb:Mt},Io(F,we),[pe,nt,Mt]})},_embind_register_class_class_function:function(s,a,c,_,I,A,O){var G=ns(c,_);a=Ut(a),A=Qt(I,A),on([],[s],function(J){function N(){$n(`Cannot call ${ke} due to unbound types`,G)}J=J[0];var ke=`${J.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var je=J.i.constructor;return je[a]===void 0?(N.ea=c-1,je[a]=N):(Hs(je,a,ke),je[a].B[c-1]=N),on([],G,function(Le){if(Le=ts(ke,[Le[0],null].concat(Le.slice(1)),null,A,O),je[a].B===void 0?(Le.ea=c-1,je[a]=Le):je[a].B[c-1]=Le,J.i.oa)for(const F of J.i.oa)F.constructor.hasOwnProperty(a)||(F.constructor[a]=Le);return[]}),[]})},_embind_register_class_class_property:function(s,a,c,_,I,A,O,G){a=Ut(a),A=Qt(I,A),on([],[s],function(J){J=J[0];var N=`${J.name}.${a}`,ke={get(){$n(`Cannot access ${N} due to unbound types`,[c])},enumerable:!0,configurable:!0};return ke.set=G?()=>{$n(`Cannot access ${N} due to unbound types`,[c])}:()=>{tt(`${N} is a read-only property`)},Object.defineProperty(J.i.constructor,a,ke),on([],[c],function(je){je=je[0];var Le={get(){return je.fromWireType(A(_))},enumerable:!0};return G&&(G=Qt(O,G),Le.set=F=>{var we=[];G(_,je.toWireType(we,F)),ki(we)}),Object.defineProperty(J.i.constructor,a,Le),[]}),[]})},_embind_register_class_constructor:function(s,a,c,_,I,A){var O=ns(a,c);I=Qt(_,I),on([],[s],function(G){G=G[0];var J=`constructor ${G.name}`;if(G.i.$===void 0&&(G.i.$=[]),G.i.$[a-1]!==void 0)throw new Lr(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${G.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return G.i.$[a-1]=()=>{$n(`Cannot construct ${G.name} due to unbound types`,O)},on([],O,function(N){return N.splice(1,0,null),G.i.$[a-1]=ts(J,N,null,I,A),[]}),[]})},_embind_register_class_function:function(s,a,c,_,I,A,O,G){var J=ns(c,_);a=Ut(a),A=Qt(I,A),on([],[s],function(N){function ke(){$n(`Cannot call ${je} due to unbound types`,J)}N=N[0];var je=`${N.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),G&&N.i.rb.push(a);var Le=N.i.N,F=Le[a];return F===void 0||F.B===void 0&&F.className!==N.name&&F.ea===c-2?(ke.ea=c-2,ke.className=N.name,Le[a]=ke):(Hs(Le,a,je),Le[a].B[c-2]=ke),on([],J,function(we){return we=ts(je,we,N,A,O),Le[a].B===void 0?(we.ea=c-2,Le[a]=we):Le[a].B[c-2]=we,[]}),[]})},_embind_register_class_property:function(s,a,c,_,I,A,O,G,J,N){a=Ut(a),I=Qt(_,I),on([],[s],function(ke){ke=ke[0];var je=`${ke.name}.${a}`,Le={get(){$n(`Cannot access ${je} due to unbound types`,[c,O])},enumerable:!0,configurable:!0};return Le.set=J?()=>{$n(`Cannot access ${je} due to unbound types`,[c,O])}:()=>{tt(je+" is a read-only property")},Object.defineProperty(ke.i.N,a,Le),on([],J?[c,O]:[c],function(F){var we=F[0],pe={get(){var at=Ao(this,ke,je+" getter");return we.fromWireType(I(A,at))},enumerable:!0};if(J){J=Qt(G,J);var nt=F[1];pe.set=function(at){var Re=Ao(this,ke,je+" setter"),Mt=[];J(N,Re,nt.toWireType(Mt,at)),ki(Mt)}}return Object.defineProperty(ke.i.N,a,pe),[]}),[]})},_embind_register_emval:function(s,a){a=Ut(a),Sn(s,{name:a,fromWireType:function(c){var _=gn(c);return Ks(c),_},toWireType:function(c,_){return _n(_)},argPackAdvance:8,readValueFromPointer:Ii,K:null})},_embind_register_enum:function(s,a,c,_){function I(){}c=Qi(c),a=Ut(a),I.values={},Sn(s,{name:a,constructor:I,fromWireType:function(A){return this.constructor.values[A]},toWireType:function(A,O){return O.value},argPackAdvance:8,readValueFromPointer:Qu(a,c,_),K:null}),zs(a,I)},_embind_register_enum_value:function(s,a,c){var _=wi(s,"enum");a=Ut(a),s=_.constructor,_=Object.create(_.constructor.prototype,{value:{value:c},constructor:{value:Hi(`${_.name}_${a}`,function(){})}}),s.values[c]=_,s[a]=_},_embind_register_float:function(s,a,c){c=Qi(c),a=Ut(a),Sn(s,{name:a,fromWireType:function(_){return _},toWireType:function(_,I){return I},argPackAdvance:8,readValueFromPointer:Zu(a,c),K:null})},_embind_register_function:function(s,a,c,_,I,A){var O=ns(a,c);s=Ut(s),I=Qt(_,I),zs(s,function(){$n(`Cannot call ${s} due to unbound types`,O)},a-1),on([],O,function(G){return Io(s,ts(s,[G[0],null].concat(G.slice(1)),null,I,A),a-1),[]})},_embind_register_integer:function(s,a,c,_,I){a=Ut(a),I===-1&&(I=4294967295),I=Qi(c);var A=G=>G;if(_===0){var O=32-8*c;A=G=>G<<O>>>O}c=a.includes("unsigned")?function(G,J){return J>>>0}:function(G,J){return J},Sn(s,{name:a,fromWireType:A,toWireType:c,argPackAdvance:8,readValueFromPointer:ec(a,I,_!==0),K:null})},_embind_register_memory_view:function(s,a,c){function _(A){A>>=2;var O=Ee;return new I(O.buffer,O[A+1],O[A])}var I=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=Ut(c),Sn(s,{name:c,fromWireType:_,argPackAdvance:8,readValueFromPointer:_},{$b:!0})},_embind_register_std_string:function(s,a){a=Ut(a);var c=a==="std::string";Sn(s,{name:a,fromWireType:function(_){var I=Ee[_>>2],A=_+4;if(c)for(var O=A,G=0;G<=I;++G){var J=A+G;if(G==I||ae[J]==0){if(O=O?Ye(ae,O,J-O):"",N===void 0)var N=O;else N+="\0",N+=O;O=J+1}}else{for(N=Array(I),G=0;G<I;++G)N[G]=String.fromCharCode(ae[A+G]);N=N.join("")}return Un(_),N},toWireType:function(_,I){I instanceof ArrayBuffer&&(I=new Uint8Array(I));var A=typeof I=="string";A||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int8Array||tt("Cannot pass non-string to std::string");var O=c&&A?ft(I):I.length,G=Zs(4+O+1),J=G+4;if(Ee[G>>2]=O,c&&A)Wt(I,ae,J,O+1);else if(A)for(A=0;A<O;++A){var N=I.charCodeAt(A);255<N&&(Un(J),tt("String has UTF-16 code units that do not fit in 8 bits")),ae[J+A]=N}else for(A=0;A<O;++A)ae[J+A]=I[A];return _!==null&&_.push(Un,G),G},argPackAdvance:8,readValueFromPointer:Ii,K:function(_){Un(_)}})},_embind_register_std_wstring:function(s,a,c){if(c=Ut(c),a===2)var _=tc,I=nc,A=rc,O=()=>_e,G=1;else a===4&&(_=ic,I=sc,A=ac,O=()=>Ee,G=2);Sn(s,{name:c,fromWireType:function(J){for(var N=Ee[J>>2],ke=O(),je,Le=J+4,F=0;F<=N;++F){var we=J+4+F*a;(F==N||ke[we>>G]==0)&&(Le=_(Le,we-Le),je===void 0?je=Le:(je+="\0",je+=Le),Le=we+a)}return Un(J),je},toWireType:function(J,N){typeof N!="string"&&tt(`Cannot pass non-string to C++ string type ${c}`);var ke=A(N),je=Zs(4+ke+a);return Ee[je>>2]=ke>>G,I(N,je+4,ke+a),J!==null&&J.push(Un,je),je},argPackAdvance:8,readValueFromPointer:Ii,K:function(J){Un(J)}})},_embind_register_value_object:function(s,a,c,_,I,A){Ji[s]={name:Ut(a),Pa:Qt(c,_),W:Qt(I,A),fb:[]}},_embind_register_value_object_field:function(s,a,c,_,I,A,O,G,J,N){Ji[s].fb.push({Sb:Ut(a),Yb:c,Wb:Qt(_,I),Xb:A,rc:O,qc:Qt(G,J),sc:N})},_embind_register_void:function(s,a){a=Ut(a),Sn(s,{fc:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emval_as:function(s,a,c){s=gn(s),a=wi(a,"emval::as");var _=[],I=_n(_);return Ee[c>>2]=I,a.toWireType(_,s)},_emval_call_method:function(s,a,c,_,I){s=is[s],a=gn(a),c=rs(c);var A=[];return Ee[_>>2]=_n(A),s(a,c,A,I)},_emval_call_void_method:function(s,a,c,_){s=is[s],a=gn(a),c=rs(c),s(a,c,null,_)},_emval_decref:Ks,_emval_get_method_caller:function(s,a){var c=uc(s,a),_=c[0];a=_.name+"_$"+c.slice(1).map(function(O){return O.name}).join("_")+"$";var I=jo[a];if(I!==void 0)return I;var A=Array(s-1);return I=lc((O,G,J,N)=>{for(var ke=0,je=0;je<s-1;++je)A[je]=c[je+1].readValueFromPointer(N+ke),ke+=c[je+1].argPackAdvance;for(O=O[G].apply(O,A),je=0;je<s-1;++je)c[je+1].Nb&&c[je+1].Nb(A[je]);if(!_.fc)return _.toWireType(J,O)}),jo[a]=I},_emval_get_module_property:function(s){return s=rs(s),_n(p[s])},_emval_get_property:function(s,a){return s=gn(s),a=gn(a),_n(s[a])},_emval_incref:function(s){4<s&&(cn.get(s).ub+=1)},_emval_new_array:function(){return _n([])},_emval_new_cstring:function(s){return _n(rs(s))},_emval_new_object:function(){return _n({})},_emval_run_destructors:function(s){var a=gn(s);ki(a),Ks(s)},_emval_set_property:function(s,a,c){s=gn(s),a=gn(a),c=gn(c),s[a]=c},_emval_take_value:function(s,a){return s=wi(s,"_emval_take_value"),s=s.readValueFromPointer(a),_n(s)},abort:()=>{Ke("")},emscripten_asm_const_int:(s,a,c)=>{Js.length=0;var _;for(c>>=2;_=ae[a++];)c+=_!=105&c,Js.push(_==105?Ie[c]:ne[c++>>1]),++c;return o[s].apply(null,Js)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_memcpy_big:(s,a,c)=>ae.copyWithin(s,a,a+c),emscripten_resize_heap:s=>{var a=ae.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var _=a*(1+.2/c);_=Math.min(_,s+100663296);var I=Math;_=Math.max(s,_);e:{I=I.min.call(I,2147483648,_+(65536-_%65536)%65536)-Z.buffer.byteLength+65535>>>16;try{Z.grow(I),le();var A=1;break e}catch{}A=void 0}if(A)return!0}return!1},environ_get:(s,a)=>{var c=0;return To().forEach(function(_,I){var A=a+c;for(I=Ee[s+4*I>>2]=A,A=0;A<_.length;++A)te[I++>>0]=_.charCodeAt(A);te[I>>0]=0,c+=_.length+1}),0},environ_sizes_get:(s,a)=>{var c=To();Ee[s>>2]=c.length;var _=0;return c.forEach(function(I){_+=I.length+1}),Ee[a>>2]=_,0},fd_close:function(s){try{var a=Hn(s);if(a.X===null)throw new De(8);a.Ma&&(a.Ma=null);try{a.m.close&&a.m.close(a)}catch(c){throw c}finally{Ni[a.X]=null}return a.X=null,0}catch(c){if(typeof fr>"u"||c.name!=="ErrnoError")throw c;return c.aa}},fd_read:function(s,a,c,_){try{e:{var I=Hn(s);s=a;for(var A,O=a=0;O<c;O++){var G=Ee[s>>2],J=Ee[s+4>>2];s+=8;var N=I,ke=G,je=J,Le=A,F=te;if(0>je||0>Le)throw new De(28);if(N.X===null)throw new De(8);if((N.flags&2097155)===1)throw new De(8);if((N.node.mode&61440)===16384)throw new De(31);if(!N.m.read)throw new De(28);var we=typeof Le<"u";if(!we)Le=N.position;else if(!N.seekable)throw new De(70);var pe=N.m.read(N,F,ke,je,Le);we||(N.position+=pe);var nt=pe;if(0>nt){var at=-1;break e}if(a+=nt,nt<J)break;typeof A<"u"&&(A+=nt)}at=a}return Ee[_>>2]=at,0}catch(Re){if(typeof fr>"u"||Re.name!=="ErrnoError")throw Re;return Re.aa}},fd_seek:function(s,a,c,_,I){a=c+2097152>>>0<4194305-!!a?(a>>>0)+4294967296*c:NaN;try{if(isNaN(a))return 61;var A=Hn(s);return uo(A,a,_),y=[A.position>>>0,(mt=A.position,1<=+Math.abs(mt)?0<mt?+Math.floor(mt/4294967296)>>>0:~~+Math.ceil((mt-+(~~mt>>>0))/4294967296)>>>0:0)],Ie[I>>2]=y[0],Ie[I+4>>2]=y[1],A.Ma&&a===0&&_===0&&(A.Ma=null),0}catch(O){if(typeof fr>"u"||O.name!=="ErrnoError")throw O;return O.aa}},fd_write:function(s,a,c,_){try{e:{var I=Hn(s);s=a;for(var A,O=a=0;O<c;O++){var G=Ee[s>>2],J=Ee[s+4>>2];s+=8;var N=I,ke=G,je=J,Le=A,F=te;if(0>je||0>Le)throw new De(28);if(N.X===null)throw new De(8);if((N.flags&2097155)===0)throw new De(8);if((N.node.mode&61440)===16384)throw new De(31);if(!N.m.write)throw new De(28);N.seekable&&N.flags&1024&&uo(N,0,2);var we=typeof Le<"u";if(!we)Le=N.position;else if(!N.seekable)throw new De(70);var pe=N.m.write(N,F,ke,je,Le,void 0);we||(N.position+=pe);var nt=pe;if(0>nt){var at=-1;break e}a+=nt,typeof A<"u"&&(A+=nt)}at=a}return Ee[_>>2]=at,0}catch(Re){if(typeof fr>"u"||Re.name!=="ErrnoError")throw Re;return Re.aa}},strftime_l:(s,a,c,_)=>cc(s,a,c,_)};(function(){function s(c){if(M=c=c.exports,Z=M.memory,le(),Y=M.__indirect_function_table,re.unshift(M.__wasm_call_ctors),ye--,p.monitorRunDependencies&&p.monitorRunDependencies(ye),ye==0&&Ae){var _=Ae;Ae=null,_()}return c}var a={env:Mo,wasi_snapshot_preview1:Mo};if(ye++,p.monitorRunDependencies&&p.monitorRunDependencies(ye),p.instantiateWasm)try{return p.instantiateWasm(a,s)}catch(c){ee("Module.instantiateWasm callback failed with error: "+c),R(c)}return kt(a,function(c){s(c.instance)}).catch(R),{}})();var Un=s=>(Un=M.free)(s),Zs=s=>(Zs=M.malloc)(s),Lo=()=>(Lo=M.__errno_location)(),Do=p._ma_device__on_notification_unlocked=s=>(Do=p._ma_device__on_notification_unlocked=M.ma_device__on_notification_unlocked)(s);p._ma_malloc_emscripten=(s,a)=>(p._ma_malloc_emscripten=M.ma_malloc_emscripten)(s,a),p._ma_free_emscripten=(s,a)=>(p._ma_free_emscripten=M.ma_free_emscripten)(s,a);var Fo=p._ma_device_process_pcm_frames_capture__webaudio=(s,a,c)=>(Fo=p._ma_device_process_pcm_frames_capture__webaudio=M.ma_device_process_pcm_frames_capture__webaudio)(s,a,c),$o=p._ma_device_process_pcm_frames_playback__webaudio=(s,a,c)=>($o=p._ma_device_process_pcm_frames_playback__webaudio=M.ma_device_process_pcm_frames_playback__webaudio)(s,a,c),Uo=s=>(Uo=M.__getTypeName)(s);p.__embind_initialize_bindings=()=>(p.__embind_initialize_bindings=M._embind_initialize_bindings)(),p.dynCall_iiji=(s,a,c,_,I)=>(p.dynCall_iiji=M.dynCall_iiji)(s,a,c,_,I),p.dynCall_jiji=(s,a,c,_,I)=>(p.dynCall_jiji=M.dynCall_jiji)(s,a,c,_,I),p.dynCall_iiiji=(s,a,c,_,I,A)=>(p.dynCall_iiiji=M.dynCall_iiiji)(s,a,c,_,I,A),p.dynCall_iij=(s,a,c,_)=>(p.dynCall_iij=M.dynCall_iij)(s,a,c,_),p.dynCall_jii=(s,a,c)=>(p.dynCall_jii=M.dynCall_jii)(s,a,c),p.dynCall_viijii=(s,a,c,_,I,A,O)=>(p.dynCall_viijii=M.dynCall_viijii)(s,a,c,_,I,A,O),p.dynCall_iiiiij=(s,a,c,_,I,A,O)=>(p.dynCall_iiiiij=M.dynCall_iiiiij)(s,a,c,_,I,A,O),p.dynCall_iiiiijj=(s,a,c,_,I,A,O,G,J)=>(p.dynCall_iiiiijj=M.dynCall_iiiiijj)(s,a,c,_,I,A,O,G,J),p.dynCall_iiiiiijj=(s,a,c,_,I,A,O,G,J,N)=>(p.dynCall_iiiiiijj=M.dynCall_iiiiiijj)(s,a,c,_,I,A,O,G,J,N);var os;Ae=function s(){os||No(),os||(Ae=s)};function No(){function s(){if(!os&&(os=!0,p.calledRun=!0,!$)){if(p.noFSInit||fo||(fo=!0,co(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?gi("stdin",p.stdin):Ns("/dev/tty","/dev/stdin"),p.stdout?gi("stdout",null,p.stdout):Ns("/dev/tty","/dev/stdout"),p.stderr?gi("stderr",null,p.stderr):Ns("/dev/tty1","/dev/stderr"),qi("/dev/stdin",0),qi("/dev/stdout",1),qi("/dev/stderr",1)),to=!1,d(re),b(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;){var a=p.postRun.shift();ue.unshift(a)}d(ue)}}if(!(0<ye)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)fe();d(ce),0<ye||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),s()},1)):s())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();return No(),S.ready})})();const m=g}),(u=>{u.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.31.2","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>g.Animation});var g=v(4)}),((u,h,v)=>{v.r(h),v.d(h,{Animation:()=>g});var g=(function(){function m(k,S,p,b){this.animation=k,this.artboard=S,this.playing=b,this.loopCount=0,this.scrubTo=null,this.instance=new p.LinearAnimationInstance(k,S)}return Object.defineProperty(m.prototype,"name",{get:function(){return this.animation.name},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"time",{get:function(){return this.instance.time},set:function(k){this.instance.time=k},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:!1,configurable:!0}),m.prototype.advance=function(k){this.scrubTo===null?this.instance.advance(k):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null)},m.prototype.apply=function(k){this.instance.apply(k)},m.prototype.cleanup=function(){this.instance.delete()},m})()}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>k.AudioAssetWrapper,AudioWrapper:()=>k.AudioWrapper,BLANK_URL:()=>m.BLANK_URL,CustomFileAssetLoaderWrapper:()=>k.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>k.FileAssetWrapper,Finalizable:()=>k.Finalizable,FontAssetWrapper:()=>k.FontAssetWrapper,FontWrapper:()=>k.FontWrapper,ImageAssetWrapper:()=>k.ImageAssetWrapper,ImageWrapper:()=>k.ImageWrapper,finalizationRegistry:()=>k.finalizationRegistry,registerTouchInteractions:()=>g.registerTouchInteractions,sanitizeUrl:()=>m.sanitizeUrl});var g=v(6),m=v(7),k=v(8)}),((u,h,v)=>{v.r(h),v.d(h,{registerTouchInteractions:()=>k});var g=void 0,m=function(S,p){var b,R;return["touchstart","touchmove"].indexOf(S.type)>-1&&(!((b=S.touches)===null||b===void 0)&&b.length)?(p||S.preventDefault(),{clientX:S.touches[0].clientX,clientY:S.touches[0].clientY}):S.type==="touchend"&&(!((R=S.changedTouches)===null||R===void 0)&&R.length)?{clientX:S.changedTouches[0].clientX,clientY:S.changedTouches[0].clientY}:{clientX:S.clientX,clientY:S.clientY}},k=function(S){var p=S.canvas,b=S.artboard,R=S.stateMachines,P=R===void 0?[]:R,U=S.renderer,q=S.rive,L=S.fit,z=S.alignment,H=S.isTouchScrollEnabled,C=H===void 0?!1:H,T=S.layoutScaleFactor,K=T===void 0?1:T;if(!p||!P.length||!U||!q||!b||typeof window>"u")return null;var X=null,ve=!1,de=function(me){if(ve&&me instanceof MouseEvent){me.type=="mouseup"&&(ve=!1);return}ve=C&&me.type==="touchend"&&X==="touchstart",X=me.type;var ee=me.currentTarget.getBoundingClientRect(),D=m(me,C),Z=D.clientX,M=D.clientY;if(!(!Z&&!M)){var $=Z-ee.left,te=M-ee.top,ae=q.computeAlignment(L,z,{minX:0,minY:0,maxX:ee.width,maxY:ee.height},b.bounds,K),ge=new q.Mat2D;ae.invert(ge);var _e=new q.Vec2D($,te),Ie=q.mapXY(ge,_e),Ee=Ie.x(),We=Ie.y();switch(Ie.delete(),ge.delete(),_e.delete(),ae.delete(),me.type){case"mouseout":for(var ne=0,le=P;ne<le.length;ne++){var Y=le[ne];Y.pointerMove(Ee,We)}break;case"touchmove":case"mouseover":case"mousemove":{for(var ce=0,re=P;ce<re.length;ce++){var Y=re[ce];Y.pointerMove(Ee,We)}break}case"touchstart":case"mousedown":{for(var ue=0,fe=P;ue<fe.length;ue++){var Y=fe[ue];Y.pointerDown(Ee,We)}break}case"touchend":case"mouseup":{for(var ye=0,Ae=P;ye<Ae.length;ye++){var Y=Ae[ye];Y.pointerUp(Ee,We)}break}}}},oe=de.bind(g);return p.addEventListener("mouseover",oe),p.addEventListener("mouseout",oe),p.addEventListener("mousemove",oe),p.addEventListener("mousedown",oe),p.addEventListener("mouseup",oe),p.addEventListener("touchmove",oe,{passive:C}),p.addEventListener("touchstart",oe,{passive:C}),p.addEventListener("touchend",oe),function(){p.removeEventListener("mouseover",oe),p.removeEventListener("mouseout",oe),p.removeEventListener("mousemove",oe),p.removeEventListener("mousedown",oe),p.removeEventListener("mouseup",oe),p.removeEventListener("touchmove",oe),p.removeEventListener("touchstart",oe),p.removeEventListener("touchend",oe)}}}),((u,h,v)=>{v.r(h),v.d(h,{BLANK_URL:()=>R,sanitizeUrl:()=>q});var g=/^([^\w]*)(javascript|data|vbscript)/im,m=/&#(\w+)(^\w|;)?/g,k=/&(newline|tab);/gi,S=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,p=/^.+(:|&colon;)/gim,b=[".","/"],R="about:blank";function P(L){return b.indexOf(L[0])>-1}function U(L){var z=L.replace(S,"");return z.replace(m,function(H,C){return String.fromCharCode(C)})}function q(L){if(!L)return R;var z=U(L).replace(k,"").replace(S,"").trim();if(!z)return R;if(P(z))return z;var H=z.match(p);if(!H)return z;var C=H[0];return g.test(C)?R:z}}),((u,h,v)=>{v.r(h),v.d(h,{AudioAssetWrapper:()=>U,AudioWrapper:()=>S,CustomFileAssetLoaderWrapper:()=>b,FileAssetWrapper:()=>R,Finalizable:()=>m,FontAssetWrapper:()=>q,FontWrapper:()=>p,ImageAssetWrapper:()=>P,ImageWrapper:()=>k,finalizationRegistry:()=>H});var g=(function(){var C=function(T,K){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,ve){X.__proto__=ve}||function(X,ve){for(var de in ve)Object.prototype.hasOwnProperty.call(ve,de)&&(X[de]=ve[de])},C(T,K)};return function(T,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");C(T,K);function X(){this.constructor=T}T.prototype=K===null?Object.create(K):(X.prototype=K.prototype,new X)}})(),m=(function(){function C(){this.selfUnref=!1}return C})(),k=(function(C){g(T,C);function T(K){var X=C.call(this)||this;return X._nativeImage=K,X}return Object.defineProperty(T.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref()},T})(m),S=(function(C){g(T,C);function T(K){var X=C.call(this)||this;return X._nativeAudio=K,X}return Object.defineProperty(T.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref()},T})(m),p=(function(C){g(T,C);function T(K){var X=C.call(this)||this;return X._nativeFont=K,X}return Object.defineProperty(T.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:!1,configurable:!0}),T.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref()},T})(m),b=(function(){function C(T,K){this._assetLoaderCallback=K,this.assetLoader=new T.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)})}return C.prototype.loadContents=function(T,K){var X;return T.isImage?X=new P(T):T.isAudio?X=new U(T):T.isFont&&(X=new q(T)),this._assetLoaderCallback(X,K)},C})(),R=(function(){function C(T){this._nativeFileAsset=T}return C.prototype.decode=function(T){this._nativeFileAsset.decode(T)},Object.defineProperty(C.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:!1,configurable:!0}),C})(),P=(function(C){g(T,C);function T(){return C!==null&&C.apply(this,arguments)||this}return T.prototype.setRenderImage=function(K){this._nativeFileAsset.setRenderImage(K.nativeImage)},T})(R),U=(function(C){g(T,C);function T(){return C!==null&&C.apply(this,arguments)||this}return T.prototype.setAudioSource=function(K){this._nativeFileAsset.setAudioSource(K.nativeAudio)},T})(R),q=(function(C){g(T,C);function T(){return C!==null&&C.apply(this,arguments)||this}return T.prototype.setFont=function(K){this._nativeFileAsset.setFont(K.nativeFont)},T})(R),L=(function(){function C(T){}return C.prototype.register=function(T){T.selfUnref=!0},C.prototype.unregister=function(T){},C})(),z=typeof FinalizationRegistry<"u"?FinalizationRegistry:L,H=new z(function(C){C.unref()})})],r={};function i(u){var h=r[u];if(h!==void 0)return h.exports;var v=r[u]={exports:{}};return t[u](v,v.exports,i),v.exports}i.d=(u,h)=>{for(var v in h)i.o(h,v)&&!i.o(u,v)&&Object.defineProperty(u,v,{enumerable:!0,get:h[v]})},i.o=(u,h)=>Object.prototype.hasOwnProperty.call(u,h),i.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})};var l={};return(()=>{i.r(l),i.d(l,{Alignment:()=>q,DataEnum:()=>We,EventType:()=>de,Fit:()=>U,Layout:()=>L,LoopType:()=>oe,Rive:()=>Ie,RiveEventType:()=>T,RiveFile:()=>_e,RuntimeLoader:()=>z,StateMachineInput:()=>C,StateMachineInputType:()=>H,Testing:()=>_t,ViewModel:()=>Ee,ViewModelInstance:()=>le,ViewModelInstanceArtboard:()=>$e,ViewModelInstanceAssetImage:()=>Ue,ViewModelInstanceBoolean:()=>ue,ViewModelInstanceColor:()=>Ke,ViewModelInstanceEnum:()=>ye,ViewModelInstanceList:()=>Ae,ViewModelInstanceNumber:()=>re,ViewModelInstanceString:()=>ce,ViewModelInstanceTrigger:()=>fe,ViewModelInstanceValue:()=>Y,decodeAudio:()=>lt,decodeFont:()=>mt,decodeImage:()=>kt});var u=i(1),h=i(2),v=i(3),g=i(5),m=(function(){var y=function(o,d){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,x){w.__proto__=x}||function(w,x){for(var V in x)Object.prototype.hasOwnProperty.call(x,V)&&(w[V]=x[V])},y(o,d)};return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");y(o,d);function w(){this.constructor=o}o.prototype=d===null?Object.create(d):(w.prototype=d.prototype,new w)}})(),k=function(){return k=Object.assign||function(y){for(var o,d=1,w=arguments.length;d<w;d++){o=arguments[d];for(var x in o)Object.prototype.hasOwnProperty.call(o,x)&&(y[x]=o[x])}return y},k.apply(this,arguments)},S=function(y,o,d,w){function x(V){return V instanceof d?V:new d(function(se){se(V)})}return new(d||(d=Promise))(function(V,se){function Te(Be){try{xe(w.next(Be))}catch(Ye){se(Ye)}}function Fe(Be){try{xe(w.throw(Be))}catch(Ye){se(Ye)}}function xe(Be){Be.done?V(Be.value):x(Be.value).then(Te,Fe)}xe((w=w.apply(y,o||[])).next())})},p=function(y,o){var d={label:0,sent:function(){if(V[0]&1)throw V[1];return V[1]},trys:[],ops:[]},w,x,V,se=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return se.next=Te(0),se.throw=Te(1),se.return=Te(2),typeof Symbol=="function"&&(se[Symbol.iterator]=function(){return this}),se;function Te(xe){return function(Be){return Fe([xe,Be])}}function Fe(xe){if(w)throw new TypeError("Generator is already executing.");for(;se&&(se=0,xe[0]&&(d=0)),d;)try{if(w=1,x&&(V=xe[0]&2?x.return:xe[0]?x.throw||((V=x.return)&&V.call(x),0):x.next)&&!(V=V.call(x,xe[1])).done)return V;switch(x=0,V&&(xe=[xe[0]&2,V.value]),xe[0]){case 0:case 1:V=xe;break;case 4:return d.label++,{value:xe[1],done:!1};case 5:d.label++,x=xe[1],xe=[0];continue;case 7:xe=d.ops.pop(),d.trys.pop();continue;default:if(V=d.trys,!(V=V.length>0&&V[V.length-1])&&(xe[0]===6||xe[0]===2)){d=0;continue}if(xe[0]===3&&(!V||xe[1]>V[0]&&xe[1]<V[3])){d.label=xe[1];break}if(xe[0]===6&&d.label<V[1]){d.label=V[1],V=xe;break}if(V&&d.label<V[2]){d.label=V[2],d.ops.push(xe);break}V[2]&&d.ops.pop(),d.trys.pop();continue}xe=o.call(y,d)}catch(Be){xe=[6,Be],x=0}finally{w=V=0}if(xe[0]&5)throw xe[1];return{value:xe[0]?xe[1]:void 0,done:!0}}},b=function(y,o,d){if(d||arguments.length===2)for(var w=0,x=o.length,V;w<x;w++)(V||!(w in o))&&(V||(V=Array.prototype.slice.call(o,0,w)),V[w]=o[w]);return y.concat(V||Array.prototype.slice.call(o))},R=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d.isHandledError=!0,d}return o})(Error),P=function(y){return y&&y.isHandledError?y.message:"Problem loading file; may be corrupt!"},U;(function(y){y.Cover="cover",y.Contain="contain",y.Fill="fill",y.FitWidth="fitWidth",y.FitHeight="fitHeight",y.None="none",y.ScaleDown="scaleDown",y.Layout="layout"})(U||(U={}));var q;(function(y){y.Center="center",y.TopLeft="topLeft",y.TopCenter="topCenter",y.TopRight="topRight",y.CenterLeft="centerLeft",y.CenterRight="centerRight",y.BottomLeft="bottomLeft",y.BottomCenter="bottomCenter",y.BottomRight="bottomRight"})(q||(q={}));var L=(function(){function y(o){var d,w,x,V,se,Te,Fe;this.fit=(d=o?.fit)!==null&&d!==void 0?d:U.Contain,this.alignment=(w=o?.alignment)!==null&&w!==void 0?w:q.Center,this.layoutScaleFactor=(x=o?.layoutScaleFactor)!==null&&x!==void 0?x:1,this.minX=(V=o?.minX)!==null&&V!==void 0?V:0,this.minY=(se=o?.minY)!==null&&se!==void 0?se:0,this.maxX=(Te=o?.maxX)!==null&&Te!==void 0?Te:0,this.maxY=(Fe=o?.maxY)!==null&&Fe!==void 0?Fe:0}return y.new=function(o){var d=o.fit,w=o.alignment,x=o.minX,V=o.minY,se=o.maxX,Te=o.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new y({fit:d,alignment:w,minX:x,minY:V,maxX:se,maxY:Te})},y.prototype.copyWith=function(o){var d=o.fit,w=o.alignment,x=o.layoutScaleFactor,V=o.minX,se=o.minY,Te=o.maxX,Fe=o.maxY;return new y({fit:d??this.fit,alignment:w??this.alignment,layoutScaleFactor:x??this.layoutScaleFactor,minX:V??this.minX,minY:se??this.minY,maxX:Te??this.maxX,maxY:Fe??this.maxY})},y.prototype.runtimeFit=function(o){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var d;return this.fit===U.Cover?d=o.Fit.cover:this.fit===U.Contain?d=o.Fit.contain:this.fit===U.Fill?d=o.Fit.fill:this.fit===U.FitWidth?d=o.Fit.fitWidth:this.fit===U.FitHeight?d=o.Fit.fitHeight:this.fit===U.ScaleDown?d=o.Fit.scaleDown:this.fit===U.Layout?d=o.Fit.layout:d=o.Fit.none,this.cachedRuntimeFit=d,d},y.prototype.runtimeAlignment=function(o){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var d;return this.alignment===q.TopLeft?d=o.Alignment.topLeft:this.alignment===q.TopCenter?d=o.Alignment.topCenter:this.alignment===q.TopRight?d=o.Alignment.topRight:this.alignment===q.CenterLeft?d=o.Alignment.centerLeft:this.alignment===q.CenterRight?d=o.Alignment.centerRight:this.alignment===q.BottomLeft?d=o.Alignment.bottomLeft:this.alignment===q.BottomCenter?d=o.Alignment.bottomCenter:this.alignment===q.BottomRight?d=o.Alignment.bottomRight:d=o.Alignment.center,this.cachedRuntimeAlignment=d,d},y})(),z=(function(){function y(){}return y.loadRuntime=function(){u.default({locateFile:function(){return y.wasmURL}}).then(function(o){var d;for(y.runtime=o;y.callBackQueue.length>0;)(d=y.callBackQueue.shift())===null||d===void 0||d(y.runtime)}).catch(function(o){var d={message:o?.message||"Unknown error",type:o?.name||"Error",wasmError:o instanceof WebAssembly.CompileError||o instanceof WebAssembly.RuntimeError,originalError:o};console.debug("Rive WASM load error details:",d);var w="https://cdn.jsdelivr.net/npm/".concat(h.name,"@").concat(h.version,"/rive_fallback.wasm");if(y.wasmURL.toLowerCase()!==w)console.warn("Failed to load WASM from ".concat(y.wasmURL," (").concat(d.message,"), trying jsdelivr as a backup")),y.setWasmUrl(w),y.loadRuntime();else{var x=["Could not load Rive WASM file from ".concat(y.wasmURL," or ").concat(w,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(d.type),"- Message: ".concat(d.message),"- WebAssembly-specific error: ".concat(d.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(x)}})},y.getInstance=function(o){y.isLoading||(y.isLoading=!0,y.loadRuntime()),y.runtime?o(y.runtime):y.callBackQueue.push(o)},y.awaitInstance=function(){return new Promise(function(o){return y.getInstance(function(d){return o(d)})})},y.setWasmUrl=function(o){y.wasmURL=o},y.getWasmUrl=function(){return y.wasmURL},y.isLoading=!1,y.callBackQueue=[],y.wasmURL="https://unpkg.com/".concat(h.name,"@").concat(h.version,"/rive.wasm"),y})(),H;(function(y){y[y.Number=56]="Number",y[y.Trigger=58]="Trigger",y[y.Boolean=59]="Boolean"})(H||(H={}));var C=(function(){function y(o,d){this.type=o,this.runtimeInput=d}return Object.defineProperty(y.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(o){this.runtimeInput.value=o},enumerable:!1,configurable:!0}),y.prototype.fire=function(){this.type===H.Trigger&&this.runtimeInput.fire()},y.prototype.delete=function(){this.runtimeInput=null},y})(),T;(function(y){y[y.General=128]="General",y[y.OpenUrl=131]="OpenUrl"})(T||(T={}));var K=(function(){function y(o){this.nativeArtboard=o}return y})(),X=(function(){function y(o,d,w,x){this.stateMachine=o,this.playing=w,this.artboard=x,this.inputs=[],this.instance=new d.StateMachineInstance(o,x),this.initInputs(d)}return Object.defineProperty(y.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"statesChanged",{get:function(){for(var o=[],d=0;d<this.instance.stateChangedCount();d++)o.push(this.instance.stateChangedNameByIndex(d));return o},enumerable:!1,configurable:!0}),y.prototype.advance=function(o){this.instance.advance(o)},y.prototype.advanceAndApply=function(o){this.instance.advanceAndApply(o)},y.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},y.prototype.reportedEventAt=function(o){return this.instance.reportedEventAt(o)},y.prototype.initInputs=function(o){for(var d=0;d<this.instance.inputCount();d++){var w=this.instance.input(d);this.inputs.push(this.mapRuntimeInput(w,o))}},y.prototype.mapRuntimeInput=function(o,d){if(o.type===d.SMIInput.bool)return new C(H.Boolean,o.asBool());if(o.type===d.SMIInput.number)return new C(H.Number,o.asNumber());if(o.type===d.SMIInput.trigger)return new C(H.Trigger,o.asTrigger())},y.prototype.cleanup=function(){this.inputs.forEach(function(o){o.delete()}),this.inputs.length=0,this.instance.delete()},y.prototype.bindViewModelInstance=function(o){o.runtimeInstance!=null&&this.instance.bindViewModelInstance(o.runtimeInstance)},y})(),ve=(function(){function y(o,d,w,x,V){x===void 0&&(x=[]),V===void 0&&(V=[]),this.runtime=o,this.artboard=d,this.eventManager=w,this.animations=x,this.stateMachines=V}return y.prototype.add=function(o,d,w){if(w===void 0&&(w=!0),o=qe(o),o.length===0)this.animations.forEach(function(ft){return ft.playing=d}),this.stateMachines.forEach(function(ft){return ft.playing=d});else for(var x=this.animations.map(function(ft){return ft.name}),V=this.stateMachines.map(function(ft){return ft.name}),se=0;se<o.length;se++){var Te=x.indexOf(o[se]),Fe=V.indexOf(o[se]);if(Te>=0||Fe>=0)Te>=0?this.animations[Te].playing=d:this.stateMachines[Fe].playing=d;else{var xe=this.artboard.animationByName(o[se]);if(xe){var Be=new v.Animation(xe,this.artboard,this.runtime,d);Be.advance(0),Be.apply(1),this.animations.push(Be)}else{var Ye=this.artboard.stateMachineByName(o[se]);if(Ye){var It=new X(Ye,this.runtime,d,this.artboard);this.stateMachines.push(It)}}}}return w&&(d?this.eventManager.fire({type:de.Play,data:this.playing}):this.eventManager.fire({type:de.Pause,data:this.paused})),d?this.playing:this.paused},y.prototype.initLinearAnimations=function(o,d){for(var w=this.animations.map(function(Fe){return Fe.name}),x=0;x<o.length;x++){var V=w.indexOf(o[x]);if(V>=0)this.animations[V].playing=d;else{var se=this.artboard.animationByName(o[x]);if(se){var Te=new v.Animation(se,this.artboard,this.runtime,d);Te.advance(0),Te.apply(1),this.animations.push(Te)}else console.error("Animation with name ".concat(o[x]," not found."))}}},y.prototype.initStateMachines=function(o,d){for(var w=this.stateMachines.map(function(Fe){return Fe.name}),x=0;x<o.length;x++){var V=w.indexOf(o[x]);if(V>=0)this.stateMachines[V].playing=d;else{var se=this.artboard.stateMachineByName(o[x]);if(se){var Te=new X(se,this.runtime,d,this.artboard);this.stateMachines.push(Te),d||Te.advanceAndApply(0)}else console.warn("State Machine with name ".concat(o[x]," not found.")),this.initLinearAnimations([o[x]],d)}}},y.prototype.play=function(o){return this.add(o,!0)},y.prototype.pause=function(o){return this.add(o,!1)},y.prototype.scrub=function(o,d){var w=this.animations.filter(function(x){return o.includes(x.name)});return w.forEach(function(x){return x.scrubTo=d}),w.map(function(x){return x.name})},Object.defineProperty(y.prototype,"playing",{get:function(){return this.animations.filter(function(o){return o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"paused",{get:function(){return this.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}).concat(this.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}))},enumerable:!1,configurable:!0}),y.prototype.stop=function(o){var d=this;o=qe(o);var w=[];if(o.length===0)w=this.animations.map(function(se){return se.name}).concat(this.stateMachines.map(function(se){return se.name})),this.animations.forEach(function(se){return se.cleanup()}),this.stateMachines.forEach(function(se){return se.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else{var x=this.animations.filter(function(se){return o.includes(se.name)});x.forEach(function(se){se.cleanup(),d.animations.splice(d.animations.indexOf(se),1)});var V=this.stateMachines.filter(function(se){return o.includes(se.name)});V.forEach(function(se){se.cleanup(),d.stateMachines.splice(d.stateMachines.indexOf(se),1)}),w=x.map(function(se){return se.name}).concat(V.map(function(se){return se.name}))}return this.eventManager.fire({type:de.Stop,data:w}),w},Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(o,d){return o||d.playing},!1)||this.stateMachines.reduce(function(o,d){return o||d.playing},!1)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return!this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:!1,configurable:!0}),y.prototype.atLeastOne=function(o,d){d===void 0&&(d=!0);var w;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([w=this.artboard.animationByIndex(0).name],o,d):this.artboard.stateMachineCount()>0&&this.add([w=this.artboard.stateMachineByIndex(0).name],o,d)),w},y.prototype.handleLooping=function(){for(var o=0,d=this.animations.filter(function(x){return x.playing});o<d.length;o++){var w=d[o];w.loopValue===0&&w.loopCount?(w.loopCount=0,this.stop(w.name)):w.loopValue===1&&w.loopCount?(this.eventManager.fire({type:de.Loop,data:{animation:w.name,type:oe.Loop}}),w.loopCount=0):w.loopValue===2&&w.loopCount>1&&(this.eventManager.fire({type:de.Loop,data:{animation:w.name,type:oe.PingPong}}),w.loopCount=0)}},y.prototype.handleStateChanges=function(){for(var o=[],d=0,w=this.stateMachines.filter(function(V){return V.playing});d<w.length;d++){var x=w[d];o.push.apply(o,x.statesChanged)}o.length>0&&this.eventManager.fire({type:de.StateChange,data:o})},y.prototype.handleAdvancing=function(o){this.eventManager.fire({type:de.Advance,data:o})},y})(),de;(function(y){y.Load="load",y.LoadError="loaderror",y.Play="play",y.Pause="pause",y.Stop="stop",y.Loop="loop",y.Draw="draw",y.Advance="advance",y.StateChange="statechange",y.RiveEvent="riveevent",y.AudioStatusChange="audiostatuschange"})(de||(de={}));var oe;(function(y){y.OneShot="oneshot",y.Loop="loop",y.PingPong="pingpong"})(oe||(oe={}));var me=(function(){function y(o){o===void 0&&(o=[]),this.listeners=o}return y.prototype.getListeners=function(o){return this.listeners.filter(function(d){return d.type===o})},y.prototype.add=function(o){this.listeners.includes(o)||this.listeners.push(o)},y.prototype.remove=function(o){for(var d=0;d<this.listeners.length;d++){var w=this.listeners[d];if(w.type===o.type&&w.callback===o.callback){this.listeners.splice(d,1);break}}},y.prototype.removeAll=function(o){var d=this;o?this.listeners.filter(function(w){return w.type===o}).forEach(function(w){return d.remove(w)}):this.listeners.splice(0,this.listeners.length)},y.prototype.fire=function(o){var d=this.getListeners(o.type);d.forEach(function(w){return w.callback(o)})},y})(),ee=(function(){function y(o){this.eventManager=o,this.queue=[]}return y.prototype.add=function(o){this.queue.push(o)},y.prototype.process=function(){for(;this.queue.length>0;){var o=this.queue.shift();o?.action&&o.action(),o?.event&&this.eventManager.fire(o.event)}},y})(),D;(function(y){y[y.AVAILABLE=0]="AVAILABLE",y[y.UNAVAILABLE=1]="UNAVAILABLE"})(D||(D={}));var Z=(function(y){m(o,y);function o(){var d=y!==null&&y.apply(this,arguments)||this;return d._started=!1,d._enabled=!1,d._status=D.UNAVAILABLE,d}return o.prototype.delay=function(d){return S(this,void 0,void 0,function(){return p(this,function(w){return[2,new Promise(function(x){return setTimeout(x,d)})]})})},o.prototype.timeout=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return[2,new Promise(function(w,x){return setTimeout(x,50)})]})})},o.prototype.reportToListeners=function(){this.fire({type:de.AudioStatusChange}),this.removeAll()},o.prototype.enableAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._enabled||(this._enabled=!0,this._status=D.AVAILABLE,this.reportToListeners()),[2]})})},o.prototype.testAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:if(!(this._status===D.UNAVAILABLE&&this._audioContext!==null))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return d.sent(),this.enableAudio(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})},o.prototype._establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){switch(d.label){case 0:return this._started?[3,5]:(this._started=!0,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),d.label=2;case 2:return this._status!==D.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return d.sent(),[4,this.delay(1e3)];case 4:return d.sent(),[3,2];case 5:return[2]}})})},o.prototype.listenForUserAction=function(){var d=this,w=function(){return S(d,void 0,void 0,function(){return p(this,function(x){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",w,{once:!0})},o.prototype.establishAudio=function(){return S(this,void 0,void 0,function(){return p(this,function(d){return this._establishAudio(),[2]})})},Object.defineProperty(o.prototype,"systemVolume",{get:function(){return this._status===D.UNAVAILABLE?(this.testAudio(),0):1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),o})(me),M=new Z,$=(function(){function y(){}return y.prototype.observe=function(){},y.prototype.unobserve=function(){},y.prototype.disconnect=function(){},y})(),te=globalThis.ResizeObserver||$,ae=(function(){function y(){var o=this;this._elementsMap=new Map,this._onObservedEntry=function(d){var w=o._elementsMap.get(d.target);w!==null?w.onResize(d.target.clientWidth==0||d.target.clientHeight==0):o._resizeObserver.unobserve(d.target)},this._onObserved=function(d){d.forEach(o._onObservedEntry)},this._resizeObserver=new te(this._onObserved)}return y.prototype.add=function(o,d){var w={onResize:d,element:o};return this._elementsMap.set(o,w),this._resizeObserver.observe(o),w},y.prototype.remove=function(o){this._resizeObserver.unobserve(o.element),this._elementsMap.delete(o.element)},y})(),ge=new ae,_e=(function(){function y(o){this.enableRiveAssetCDN=!0,this.referenceCount=0,this.destroyed=!1,this.src=o.src,this.buffer=o.buffer,o.assetLoader&&(this.assetLoader=o.assetLoader),this.enableRiveAssetCDN=typeof o.enableRiveAssetCDN=="boolean"?o.enableRiveAssetCDN:!0,this.eventManager=new me,o.onLoad&&this.on(de.Load,o.onLoad),o.onLoadError&&this.on(de.LoadError,o.onLoadError)}return y.prototype.initData=function(){return S(this,void 0,void 0,function(){var o,d,w,x,V;return p(this,function(se){switch(se.label){case 0:return this.src?(o=this,[4,Ve(this.src)]):[3,2];case 1:o.buffer=se.sent(),se.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(w=new g.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),d=w.assetLoader),x=this,[4,this.runtime.load(new Uint8Array(this.buffer),d,this.enableRiveAssetCDN)]);case 3:return x.file=se.sent(),this.destroyed?((V=this.file)===null||V===void 0||V.delete(),this.file=null,[2]):(this.file!==null?this.eventManager.fire({type:de.Load,data:this}):this.fireLoadError(y.fileLoadErrorMessage),[2])}})})},y.prototype.init=function(){return S(this,void 0,void 0,function(){var o,d;return p(this,function(w){switch(w.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(y.missingErrorMessage),[2];w.label=1;case 1:return w.trys.push([1,4,,5]),o=this,[4,z.awaitInstance()];case 2:return o.runtime=w.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return w.sent(),[3,5];case 4:return d=w.sent(),this.fireLoadError(d instanceof Error?d.message:y.fileLoadErrorMessage),[3,5];case 5:return[2]}})})},y.prototype.fireLoadError=function(o){throw this.eventManager.fire({type:de.LoadError,data:o}),new Error(o)},y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.cleanup=function(){var o;this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),(o=this.file)===null||o===void 0||o.delete(),this.file=null,this.destroyed=!0)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},y.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup()},y.prototype.getArtboard=function(o){var d=this.file.artboardByName(o);return d!=null?new K(d):null},y.missingErrorMessage="Rive source file or data buffer required",y.fileLoadErrorMessage="The file failed to load",y})(),Ie=(function(){function y(o){var d=this,w;this.loaded=!1,this.destroyed=!1,this._observed=null,this.readyForPlaying=!1,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=!1,this.automaticallyHandleEvents=!1,this.enableRiveAssetCDN=!0,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=!1,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=!1,this.onCanvasResize=function(x){var V=d._hasZeroSize!==x;d._hasZeroSize=x,x?(!d._layout.maxX||!d._layout.maxY)&&d.resizeToCanvas():V&&d.resizeDrawingSurfaceToCanvas()},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=o.canvas,o.canvas.constructor===HTMLCanvasElement&&(this._observed=ge.add(this.canvas,this.onCanvasResize)),this.src=o.src,this.buffer=o.buffer,this.riveFile=o.riveFile,this.layout=(w=o.layout)!==null&&w!==void 0?w:new L,this.shouldDisableRiveListeners=!!o.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!o.isTouchScrollEnabled,this.automaticallyHandleEvents=!!o.automaticallyHandleEvents,this.enableRiveAssetCDN=o.enableRiveAssetCDN===void 0?!0:o.enableRiveAssetCDN,this.eventManager=new me,o.onLoad&&this.on(de.Load,o.onLoad),o.onLoadError&&this.on(de.LoadError,o.onLoadError),o.onPlay&&this.on(de.Play,o.onPlay),o.onPause&&this.on(de.Pause,o.onPause),o.onStop&&this.on(de.Stop,o.onStop),o.onLoop&&this.on(de.Loop,o.onLoop),o.onStateChange&&this.on(de.StateChange,o.onStateChange),o.onAdvance&&this.on(de.Advance,o.onAdvance),o.onload&&!o.onLoad&&this.on(de.Load,o.onload),o.onloaderror&&!o.onLoadError&&this.on(de.LoadError,o.onloaderror),o.onplay&&!o.onPlay&&this.on(de.Play,o.onplay),o.onpause&&!o.onPause&&this.on(de.Pause,o.onpause),o.onstop&&!o.onStop&&this.on(de.Stop,o.onstop),o.onloop&&!o.onLoop&&this.on(de.Loop,o.onloop),o.onstatechange&&!o.onStateChange&&this.on(de.StateChange,o.onstatechange),o.assetLoader&&(this.assetLoader=o.assetLoader),this.taskQueue=new ee(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:o.autoplay,autoBind:o.autoBind,animations:o.animations,stateMachines:o.stateMachines,artboard:o.artboard,useOffscreenRenderer:o.useOffscreenRenderer})}return Object.defineProperty(y.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:!1,configurable:!0}),y.new=function(o){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new y(o)},y.prototype.onSystemAudioChanged=function(){this.volume=this._volume},y.prototype.init=function(o){var d=this,w=o.src,x=o.buffer,V=o.riveFile,se=o.animations,Te=o.stateMachines,Fe=o.artboard,xe=o.autoplay,Be=xe===void 0?!1:xe,Ye=o.useOffscreenRenderer,It=Ye===void 0?!1:Ye,ft=o.autoBind,Wt=ft===void 0?!1:ft;if(!this.destroyed){if(this.src=w,this.buffer=x,this.riveFile=V,!this.src&&!this.buffer&&!this.riveFile)throw new R(y.missingErrorMessage);var $t=qe(se),Ct=qe(Te);this.loaded=!1,this.readyForPlaying=!1,z.awaitInstance().then(function(et){d.destroyed||(d.runtime=et,d.removeRiveListeners(),d.deleteRiveRenderer(),d.renderer=d.runtime.makeRenderer(d.canvas,It),d.canvas.width||d.canvas.height||d.resizeDrawingSurfaceToCanvas(),d.initData(Fe,$t,Ct,Be,Wt).then(function(Ge){if(Ge)return d.setupRiveListeners()}).catch(function(Ge){console.error(Ge)}))}).catch(function(et){console.error(et)})}},y.prototype.setupRiveListeners=function(o){var d=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var w=(this.animator.stateMachines||[]).filter(function(V){return V.playing&&d.runtime.hasListeners(V.instance)}).map(function(V){return V.instance}),x=this.isTouchScrollEnabled;o&&"isTouchScrollEnabled"in o&&(x=o.isTouchScrollEnabled),this.eventCleanup=(0,g.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:w,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:x,layoutScaleFactor:this._layout.layoutScaleFactor})}},y.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null)},y.prototype.initializeAudio=function(){var o=this,d;M.status==D.UNAVAILABLE&&!((d=this.artboard)===null||d===void 0)&&d.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:de.AudioStatusChange,callback:function(){return o.onSystemAudioChanged()}},M.add(this._audioEventListener),M.establishAudio())},y.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height)},y.prototype.initData=function(o,d,w,x,V){return S(this,void 0,void 0,function(){var se,Te,Fe,xe;return p(this,function(Be){switch(Be.label){case 0:return Be.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(se=new _e({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=se,[4,se.init()]);case 1:if(Be.sent(),this.destroyed)return se.destroyIfUnused(),[2,!1];Be.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(o,d,w,x,V),this.initArtboardSize(),this.initializeAudio(),this.loaded=!0,this.eventManager.fire({type:de.Load,data:(xe=this.src)!==null&&xe!==void 0?xe:"buffer"}),this.readyForPlaying=!0,this.taskQueue.process(),this.drawFrame(),[2,!0];case 3:return Te=Be.sent(),Fe=P(Te),console.warn(Fe),this.eventManager.fire({type:de.LoadError,data:Fe}),[2,Promise.reject(Fe)];case 4:return[2]}})})},y.prototype.initArtboard=function(o,d,w,x,V){if(this.file){var se=o?this.file.artboardByName(o):this.file.defaultArtboard();if(!se){var Te="Invalid artboard name or no default artboard";console.warn(Te),this.eventManager.fire({type:de.LoadError,data:Te});return}if(this.artboard=se,se.volume=this._volume*M.systemVolume,this.artboard.animationCount()<1){var Te="Artboard has no animations";throw this.eventManager.fire({type:de.LoadError,data:Te}),Te}this.animator=new ve(this.runtime,this.artboard,this.eventManager);var Fe;if(d.length>0||w.length>0?(Fe=d.concat(w),this.animator.initLinearAnimations(d,x),this.animator.initStateMachines(w,x)):Fe=[this.animator.atLeastOne(x,!1)],this.taskQueue.add({event:{type:x?de.Play:de.Pause,data:Fe}}),V){var xe=this.file.defaultArtboardViewModel(se);if(xe!==null){var Be=xe.defaultInstance();if(Be!==null){var Ye=new le(Be,null);this.bindViewModelInstance(Ye)}}}}},y.prototype.drawFrame=function(){var o,d;!((o=document?.timeline)===null||o===void 0)&&o.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(d=this.runtime)===null||d===void 0||d.resolveAnimationFrame()):this.startRendering()},y.prototype.draw=function(o,d){var w;this.frameRequestId=null;var x=performance.now();this.lastRenderTime||(this.lastRenderTime=o),this.renderSecondTimer+=o-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,d?.());var V=(o-this.lastRenderTime)/1e3;this.lastRenderTime=o;for(var se=this.animator.animations.filter(function(Vt){return Vt.playing||Vt.needsScrub}).sort(function(Vt){return Vt.needsScrub?-1:1}),Te=0,Fe=se;Te<Fe.length;Te++){var xe=Fe[Te];xe.advance(V),xe.instance.didLoop&&(xe.loopCount+=1),xe.apply(1)}for(var Be=this.animator.stateMachines.filter(function(Vt){return Vt.playing}),Ye=0,It=Be;Ye<It.length;Ye++){var ft=It[Ye],Wt=ft.reportedEventCount();if(Wt)for(var $t=0;$t<Wt;$t++){var Ct=ft.reportedEventAt($t);if(Ct)if(Ct.type===T.OpenUrl){if(this.eventManager.fire({type:de.RiveEvent,data:Ct}),this.automaticallyHandleEvents){var et=document.createElement("a"),Ge=Ct,St=Ge.url,st=Ge.target,ut=(0,g.sanitizeUrl)(St);St&&et.setAttribute("href",ut),st&&et.setAttribute("target",st),ut&&ut!==g.BLANK_URL&&et.click()}}else this.eventManager.fire({type:de.RiveEvent,data:Ct})}ft.advanceAndApply(V)}this.animator.stateMachines.length==0&&this.artboard.advance(V);var Ce=this.renderer;Ce.clear(),Ce.save(),this.alignRenderer(),this._hasZeroSize||this.artboard.draw(Ce),Ce.restore(),Ce.flush(),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(V),this.frameCount++;var He=performance.now();for(this.frameTimes.push(He),this.durations.push(He-x);this.frameTimes[0]<=He-1e3;)this.frameTimes.shift(),this.durations.shift();(w=this._viewModelInstance)===null||w===void 0||w.handleCallbacks(),this.animator.isPlaying?this.startRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0)},y.prototype.alignRenderer=function(){var o=this,d=o.renderer,w=o.runtime,x=o._layout,V=o.artboard;d.align(x.runtimeFit(w),x.runtimeAlignment(w),{minX:x.minX,minY:x.minY,maxX:x.maxX,maxY:x.maxY},V.bounds,this._devicePixelRatioUsed*x.layoutScaleFactor)},Object.defineProperty(y.prototype,"fps",{get:function(){return this.durations.length},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(o,d){return o+d},0)/this.durations.length).toFixed(4)},enumerable:!1,configurable:!0}),y.prototype.cleanup=function(){var o,d;this.destroyed=!0,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&ge.remove(this._observed),this.removeRiveListeners(),this.file&&((o=this.riveFile)===null||o===void 0||o.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(M.remove(this._audioEventListener),this._audioEventListener=null),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=null,this._dataEnums=null},y.prototype.deleteRiveRenderer=function(){var o;(o=this.renderer)===null||o===void 0||o.delete(),this.renderer=null},y.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null)},y.prototype.retrieveTextRun=function(o){var d;if(!o){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var w=this.artboard.textRun(o);if(!w){console.warn("Could not access a text run with name '".concat(o,"' in the '").concat((d=this.artboard)===null||d===void 0?void 0:d.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return w},y.prototype.getTextRunValue=function(o){var d=this.retrieveTextRun(o);return d?d.text:void 0},y.prototype.setTextRunValue=function(o,d){var w=this.retrieveTextRun(o);w&&(w.text=d)},y.prototype.play=function(o,d){var w=this;if(o=qe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.play(o,d)}});return}this.animator.play(o),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering()},y.prototype.pause=function(o){var d=this;if(o=qe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.pause(o)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(o)},y.prototype.scrub=function(o,d){var w=this;if(o=qe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return w.scrub(o,d)}});return}this.animator.scrub(o,d||0),this.drawFrame()},y.prototype.stop=function(o){var d=this;if(o=qe(o),!this.readyForPlaying){this.taskQueue.add({action:function(){return d.stop(o)}});return}this.animator&&this.animator.stop(o),this.eventCleanup&&this.eventCleanup()},y.prototype.reset=function(o){var d,w,x=o?.artboard,V=qe(o?.animations),se=qe(o?.stateMachines),Te=(d=o?.autoplay)!==null&&d!==void 0?d:!1,Fe=(w=o?.autoBind)!==null&&w!==void 0?w:!1;this.cleanupInstances(),this.initArtboard(x,V,se,Te,Fe),this.taskQueue.process()},y.prototype.load=function(o){this.file=null,this.stop(),this.init(o)},Object.defineProperty(y.prototype,"layout",{get:function(){return this._layout},set:function(o){this._layout=o,(!o.maxX||!o.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame()},enumerable:!1,configurable:!0}),y.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height})},y.prototype.resizeDrawingSurfaceToCanvas=function(o){if(this.canvas instanceof HTMLCanvasElement&&window){var d=this.canvas.getBoundingClientRect(),w=d.width,x=d.height,V=o||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=V,this.canvas.width=V*w,this.canvas.height=V*x,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===U.Layout){var se=this._layout.layoutScaleFactor;this.artboard.width=w/se,this.artboard.height=x/se}}},Object.defineProperty(y.prototype,"source",{get:function(){return this.src},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.animationCount();d++)o.push(this.artboard.animationByIndex(d).name);return o},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return[];for(var o=[],d=0;d<this.artboard.stateMachineCount();d++)o.push(this.artboard.stateMachineByIndex(d).name);return o},enumerable:!1,configurable:!0}),y.prototype.stateMachineInputs=function(o){if(this.loaded){var d=this.animator.stateMachines.find(function(w){return w.name===o});return d?.inputs}},y.prototype.retrieveInputAtPath=function(o,d){if(!o){console.warn("No input name provided for path '".concat(d,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.inputByPath(o,d);if(!w){console.warn("Could not access an input with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},y.prototype.setBooleanStateAtPath=function(o,d,w){var x=this.retrieveInputAtPath(o,w);x&&(x.type===H.Boolean?x.asBool().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a boolean")))},y.prototype.setNumberStateAtPath=function(o,d,w){var x=this.retrieveInputAtPath(o,w);x&&(x.type===H.Number?x.asNumber().value=d:console.warn("Input with name: '".concat(o,"', at path:'").concat(w,"' is not a number")))},y.prototype.fireStateAtPath=function(o,d){var w=this.retrieveInputAtPath(o,d);w&&(w.type===H.Trigger?w.asTrigger().fire():console.warn("Input with name: '".concat(o,"', at path:'").concat(d,"' is not a trigger")))},y.prototype.retrieveTextAtPath=function(o,d){if(!o){console.warn("No text name provided for path '".concat(d,"'"));return}if(!d){console.warn("No path provided for text '".concat(o,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(o,"', at path: '").concat(d,"', but the Artboard is null"));return}var w=this.artboard.textByPath(o,d);if(!w){console.warn("Could not access text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w},y.prototype.getTextRunValueAtPath=function(o,d){var w=this.retrieveTextAtPath(o,d);if(!w){console.warn("Could not get text with name: '".concat(o,"', at path:'").concat(d,"'"));return}return w.text},y.prototype.setTextRunValueAtPath=function(o,d,w){var x=this.retrieveTextAtPath(o,w);if(!x){console.warn("Could not set text with name: '".concat(o,"', at path:'").concat(w,"'"));return}x.text=d},Object.defineProperty(y.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(o){return!o.playing}).map(function(o){return o.name}):[]},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"isStopped",{get:function(){return this.animator.isStopped},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:!1,configurable:!0}),y.prototype.on=function(o,d){this.eventManager.add({type:o,callback:d})},y.prototype.off=function(o,d){this.eventManager.remove({type:o,callback:d})},y.prototype.unsubscribe=function(o,d){console.warn("This function is deprecated: please use `off()` instead."),this.off(o,d)},y.prototype.removeAllRiveEventListeners=function(o){this.eventManager.removeAll(o)},y.prototype.unsubscribeAll=function(o){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(o)},y.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)},y.prototype.startRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw))},y.prototype.enableFPSCounter=function(o){this.runtime.enableFPSCounter(o)},y.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter()},Object.defineProperty(y.prototype,"contents",{get:function(){if(this.loaded){for(var o={artboards:[]},d=0;d<this.file.artboardCount();d++){for(var w=this.file.artboardByIndex(d),x={name:w.name,animations:[],stateMachines:[]},V=0;V<w.animationCount();V++){var se=w.animationByIndex(V);x.animations.push(se.name)}for(var Te=0;Te<w.stateMachineCount();Te++){for(var Fe=w.stateMachineByIndex(Te),xe=Fe.name,Be=new this.runtime.StateMachineInstance(Fe,w),Ye=[],It=0;It<Be.inputCount();It++){var ft=Be.input(It);Ye.push({name:ft.name,type:ft.type})}x.stateMachines.push({name:xe,inputs:Ye})}o.artboards.push(x)}return o}},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(o){this._volume=o,this.artboard&&(this.artboard.volume=o*M.systemVolume)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardWidth",{get:function(){var o;return this.artboard?this.artboard.width:(o=this._artboardWidth)!==null&&o!==void 0?o:0},set:function(o){this._artboardWidth=o,this.artboard&&(this.artboard.width=o)},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"artboardHeight",{get:function(){var o;return this.artboard?this.artboard.height:(o=this._artboardHeight)!==null&&o!==void 0?o:0},set:function(o){this._artboardHeight=o,this.artboard&&(this.artboard.height=o)},enumerable:!1,configurable:!0}),y.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0)},Object.defineProperty(y.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(o){this._devicePixelRatioUsed=o},enumerable:!1,configurable:!0}),y.prototype.bindViewModelInstance=function(o){var d;this.artboard&&!this.destroyed&&o&&o.runtimeInstance&&(o.internalIncrementReferenceCount(),(d=this._viewModelInstance)===null||d===void 0||d.cleanup(),this._viewModelInstance=o,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(w){return w.bindViewModelInstance(o)}):this.artboard.bindViewModelInstance(o.runtimeInstance))},Object.defineProperty(y.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:!1,configurable:!0}),y.prototype.viewModelByIndex=function(o){var d=this.file.viewModelByIndex(o);return d!==null?new Ee(d):null},y.prototype.viewModelByName=function(o){var d=this.file.viewModelByName(o);return d!==null?new Ee(d):null},y.prototype.enums=function(){if(this._dataEnums===null){var o=this.file.enums();this._dataEnums=o.map(function(d){return new We(d)})}return this._dataEnums},y.prototype.defaultViewModel=function(){if(this.artboard){var o=this.file.defaultArtboardViewModel(this.artboard);if(o)return new Ee(o)}return null},y.prototype.getArtboard=function(o){var d,w;return(w=(d=this.riveFile)===null||d===void 0?void 0:d.getArtboard(o))!==null&&w!==void 0?w:null},y.missingErrorMessage="Rive source file or data buffer required",y.cleanupErrorMessage="Attempt to use file after calling cleanup.",y})(),Ee=(function(){function y(o){this._viewModel=o}return Object.defineProperty(y.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModel.name},enumerable:!1,configurable:!0}),y.prototype.instanceByIndex=function(o){var d=this._viewModel.instanceByIndex(o);return d!==null?new le(d,null):null},y.prototype.instanceByName=function(o){var d=this._viewModel.instanceByName(o);return d!==null?new le(d,null):null},y.prototype.defaultInstance=function(){var o=this._viewModel.defaultInstance();return o!==null?new le(o,null):null},y.prototype.instance=function(){var o=this._viewModel.instance();return o!==null?new le(o,null):null},Object.defineProperty(y.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:!1,configurable:!0}),y})(),We=(function(){function y(o){this._dataEnum=o}return Object.defineProperty(y.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:!1,configurable:!0}),y})(),ne;(function(y){y.Number="number",y.String="string",y.Boolean="boolean",y.Color="color",y.Trigger="trigger",y.Enum="enum",y.List="list",y.Image="image",y.Artboard="artboard"})(ne||(ne={}));var le=(function(){function y(o,d){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this._runtimeInstance=o,d!==null&&this._parents.push(d)}return Object.defineProperty(y.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:!1,configurable:!0}),y.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(o){o.handleCallbacks()}),this._propertiesWithCallbacks.forEach(function(o){o.clearChanges()})),this._children.forEach(function(o){return o.handleCallbacks()})},y.prototype.addParent=function(o){this._parents.includes(o)||(this._parents.push(o),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&o.addToViewModelCallbacks(this))},y.prototype.removeParent=function(o){var d=this._parents.indexOf(o);if(d!==-1){var w=this._parents[d];w.removeFromViewModelCallbacks(this),this._parents.splice(d,1)}},y.prototype.addToPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)||(this._propertiesWithCallbacks.push(o),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},y.prototype.removeFromPropertyCallbacks=function(o){var d=this;this._propertiesWithCallbacks.includes(o)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},y.prototype.addToViewModelCallbacks=function(o){var d=this;this._children.includes(o)||(this._children.push(o),this._parents.forEach(function(w){w.addToViewModelCallbacks(d)}))},y.prototype.removeFromViewModelCallbacks=function(o){var d=this;this._children.includes(o)&&(this._children=this._children.filter(function(w){return w!==o}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(w){w.removeFromViewModelCallbacks(d)}))},y.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(o){o.clearCallbacks()})},y.prototype.propertyFromPath=function(o,d){var w=o.split("/");return this.propertyFromPathSegments(w,0,d)},y.prototype.viewModelFromPathSegments=function(o,d){var w=this.internalViewModelInstance(o[d]);return w!==null?d==o.length-1?w:w.viewModelFromPathSegments(o,d++):null},y.prototype.propertyFromPathSegments=function(o,d,w){var x,V,se,Te,Fe,xe,Be,Ye,It,ft,Wt,$t,Ct,et,Ge,St,st,ut;if(d<o.length-1){var Ce=this.internalViewModelInstance(o[d]);return Ce!==null?Ce.propertyFromPathSegments(o,d+1,w):null}var He=null;switch(w){case ne.Number:if(He=(V=(x=this._runtimeInstance)===null||x===void 0?void 0:x.number(o[d]))!==null&&V!==void 0?V:null,He!==null)return new re(He,this);break;case ne.String:if(He=(Te=(se=this._runtimeInstance)===null||se===void 0?void 0:se.string(o[d]))!==null&&Te!==void 0?Te:null,He!==null)return new ce(He,this);break;case ne.Boolean:if(He=(xe=(Fe=this._runtimeInstance)===null||Fe===void 0?void 0:Fe.boolean(o[d]))!==null&&xe!==void 0?xe:null,He!==null)return new ue(He,this);break;case ne.Color:if(He=(Ye=(Be=this._runtimeInstance)===null||Be===void 0?void 0:Be.color(o[d]))!==null&&Ye!==void 0?Ye:null,He!==null)return new Ke(He,this);break;case ne.Trigger:if(He=(ft=(It=this._runtimeInstance)===null||It===void 0?void 0:It.trigger(o[d]))!==null&&ft!==void 0?ft:null,He!==null)return new fe(He,this);break;case ne.Enum:if(He=($t=(Wt=this._runtimeInstance)===null||Wt===void 0?void 0:Wt.enum(o[d]))!==null&&$t!==void 0?$t:null,He!==null)return new ye(He,this);break;case ne.List:if(He=(et=(Ct=this._runtimeInstance)===null||Ct===void 0?void 0:Ct.list(o[d]))!==null&&et!==void 0?et:null,He!==null)return new Ae(He,this);break;case ne.Image:if(He=(St=(Ge=this._runtimeInstance)===null||Ge===void 0?void 0:Ge.image(o[d]))!==null&&St!==void 0?St:null,He!==null)return new Ue(He,this);break;case ne.Artboard:if(He=(ut=(st=this._runtimeInstance)===null||st===void 0?void 0:st.artboard(o[d]))!==null&&ut!==void 0?ut:null,He!==null)return new $e(He,this);break}return null},y.prototype.internalViewModelInstance=function(o){var d;if(this._viewModelInstances.has(o))return this._viewModelInstances.get(o);var w=(d=this._runtimeInstance)===null||d===void 0?void 0:d.viewModel(o);if(w!==null){var x=new y(w,this);return x.internalIncrementReferenceCount(),this._viewModelInstances.set(o,x),x}return null},y.prototype.number=function(o){var d=this.propertyFromPath(o,ne.Number);return d},y.prototype.string=function(o){var d=this.propertyFromPath(o,ne.String);return d},y.prototype.boolean=function(o){var d=this.propertyFromPath(o,ne.Boolean);return d},y.prototype.color=function(o){var d=this.propertyFromPath(o,ne.Color);return d},y.prototype.trigger=function(o){var d=this.propertyFromPath(o,ne.Trigger);return d},y.prototype.enum=function(o){var d=this.propertyFromPath(o,ne.Enum);return d},y.prototype.list=function(o){var d=this.propertyFromPath(o,ne.List);return d},y.prototype.image=function(o){var d=this.propertyFromPath(o,ne.Image);return d},y.prototype.artboard=function(o){var d=this.propertyFromPath(o,ne.Artboard);return d},y.prototype.viewModel=function(o){var d=o.split("/"),w=d.length>1?this.viewModelFromPathSegments(d.slice(0,d.length-1),0):this;return w!=null?w.internalViewModelInstance(d[d.length-1]):null},y.prototype.internalReplaceViewModel=function(o,d){var w;if(d.runtimeInstance!==null){var x=((w=this._runtimeInstance)===null||w===void 0?void 0:w.replaceViewModel(o,d.runtimeInstance))||!1;if(x){d.internalIncrementReferenceCount();var V=this.internalViewModelInstance(o);V!==null&&(V.removeParent(this),this._children.includes(V)&&(this._children=this._children.filter(function(se){return se!==V})),V.cleanup()),this._viewModelInstances.set(o,d),d.addParent(this)}return x}return!1},y.prototype.replaceViewModel=function(o,d){var w,x=o.split("/"),V=x.length>1?this.viewModelFromPathSegments(x.slice(0,x.length-1),0):this;return(w=V?.internalReplaceViewModel(x[x.length-1],d))!==null&&w!==void 0?w:!1},y.prototype.incrementReferenceCount=function(){var o;this._referenceCount++,(o=this._runtimeInstance)===null||o===void 0||o.incrementReferenceCount()},y.prototype.decrementReferenceCount=function(){var o;this._referenceCount--,(o=this._runtimeInstance)===null||o===void 0||o.decrementReferenceCount()},Object.defineProperty(y.prototype,"properties",{get:function(){var o;return((o=this._runtimeInstance)===null||o===void 0?void 0:o.getProperties().map(function(d){return k({},d)}))||[]},enumerable:!1,configurable:!0}),y.prototype.internalIncrementReferenceCount=function(){this._referenceCount++},y.prototype.cleanup=function(){var o=this;if(this._referenceCount--,this._referenceCount<=0){this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(x){x.cleanup()}),this._viewModelInstances.clear();var d=b([],this._children,!0);this._children.length=0;var w=b([],this._parents,!0);this._parents.length=0,d.forEach(function(x){x.removeParent(o)}),w.forEach(function(x){x.removeFromViewModelCallbacks(o)})}},y})(),Y=(function(){function y(o,d){this.callbacks=[],this._viewModelInstanceValue=o,this._parentViewModel=d}return y.prototype.on=function(o){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(o)||(this.callbacks.push(o),this._parentViewModel.addToPropertyCallbacks(this))},y.prototype.off=function(o){o?this.callbacks=this.callbacks.filter(function(d){return d!==o}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this)},y.prototype.internalHandleCallback=function(o){},y.prototype.handleCallbacks=function(){var o=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(d){o.internalHandleCallback(d)})},y.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges()},y.prototype.clearCallbacks=function(){this.callbacks.length=0},Object.defineProperty(y.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:!1,configurable:!0}),y})(),ce=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Y),re=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Y),ue=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Y),fe=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return o.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},o.prototype.internalHandleCallback=function(d){d()},o})(Y),ye=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(d){this._viewModelInstanceValue.valueIndex=d},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Y),Ae=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:!1,configurable:!0}),o.prototype.addInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(d.runtimeInstance),d.addParent(this._parentViewModel))},o.prototype.addInstanceAt=function(d,w){return d.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(d.runtimeInstance,w)?(d.addParent(this._parentViewModel),!0):!1},o.prototype.removeInstance=function(d){d.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(d.runtimeInstance),d.removeParent(this._parentViewModel))},o.prototype.removeInstanceAt=function(d){this._viewModelInstanceValue.removeInstanceAt(d)},o.prototype.instanceAt=function(d){var w=this._viewModelInstanceValue.instanceAt(d);if(w!=null){var x=new le(w,this._parentViewModel);return x}return null},o.prototype.swap=function(d,w){this._viewModelInstanceValue.swap(d,w)},o.prototype.internalHandleCallback=function(d){d()},o})(Y),Ke=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(d){this._viewModelInstanceValue.value=d},enumerable:!1,configurable:!0}),o.prototype.rgb=function(d,w,x){this._viewModelInstanceValue.rgb(d,w,x)},o.prototype.rgba=function(d,w,x,V){this._viewModelInstanceValue.argb(V,d,w,x)},o.prototype.argb=function(d,w,x,V){this._viewModelInstanceValue.argb(d,w,x,V)},o.prototype.alpha=function(d){this._viewModelInstanceValue.alpha(d)},o.prototype.opacity=function(d){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,d))*255))},o.prototype.internalHandleCallback=function(d){d(this.value)},o})(Y),Ue=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeImage)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Y),$e=(function(y){m(o,y);function o(d,w){return y.call(this,d,w)||this}return Object.defineProperty(o.prototype,"value",{set:function(d){var w;this._viewModelInstanceValue.value((w=d?.nativeArtboard)!==null&&w!==void 0?w:null)},enumerable:!1,configurable:!0}),o.prototype.internalHandleCallback=function(d){d()},o})(Y),Ve=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(x){switch(x.label){case 0:return o=new Request(y),[4,fetch(o)];case 1:return d=x.sent(),[4,d.arrayBuffer()];case 2:return w=x.sent(),[2,w]}})})},qe=function(y){return typeof y=="string"?[y]:y instanceof Array?y:[]},_t={EventManager:me,TaskQueueManager:ee},lt=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(x){switch(x.label){case 0:return o=new Promise(function(V){return z.getInstance(function(se){se.decodeAudio(y,V)})}),[4,o];case 1:return d=x.sent(),w=new g.AudioWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})},kt=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(x){switch(x.label){case 0:return o=new Promise(function(V){return z.getInstance(function(se){se.decodeImage(y,V)})}),[4,o];case 1:return d=x.sent(),w=new g.ImageWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})},mt=function(y){return S(void 0,void 0,void 0,function(){var o,d,w;return p(this,function(x){switch(x.label){case 0:return o=new Promise(function(V){return z.getInstance(function(se){se.decodeFont(y,V)})}),[4,o];case 1:return d=x.sent(),w=new g.FontWrapper(d),g.finalizationRegistry.register(w,d),[2,w]}})})}})(),l})())})(_s)),_s.exports}var up=lp();const $u="dracula",Es="https://vycjpmuyscfygstjjied.supabase.co";var cp=Q('<div class="rive-wrapper svelte-nkuq4r"><canvas width="250" height="500" class="svelte-nkuq4r"></canvas></div>');function Ml(n,e){Pt(e,!0);let t=ze(e,"bucketName",3,$u),r=Me(null);In(()=>{if(!f(r))return;const u=new up.Rive({src:`${Es}/storage/v1/object/public/${t()}/${e.fileName}`,canvas:f(r),autoplay:!0,stateMachines:"SM1"});return()=>{u.cleanup()}});var i=cp(),l=E(i);ka(l,u=>ie(r,u),()=>f(r)),W(n,i),Ot()}var dp=Q('<div class="body-wrapper svelte-njwbfg"><!></div>');function or(n,e){var t=dp(),r=E(t);Ka(r,()=>e.children),W(n,t)}var fp=Q('<button class="btn btn-info svelte-aplqg7">❓ Правила</button>'),hp=Q('<button class="btn btn-secondary svelte-aplqg7">🔄 Заново</button>'),vp=Q('<button class="btn btn-danger svelte-aplqg7">🏳️ Сдаться</button>'),pp=Q('<div id="game-header" class="svelte-aplqg7"><!> <!> <!> <!></div>');function lr(n,e){let t=ze(e,"showGiveUp",3,!1),r=ze(e,"extraContent",3,null),i=ze(e,"onShowRules",3,null);var l=pp(),u=E(l);{var h=b=>{var R=fp();R.__click=function(...P){i()?.apply(this,P)},W(b,R)};Oe(u,b=>{i()&&b(h)})}var v=j(u,2);{var g=b=>{var R=hp();R.__click=function(...P){e.onRestart?.apply(this,P)},W(b,R)};Oe(v,b=>{e.onRestart&&b(g)})}var m=j(v,2);{var k=b=>{var R=At(),P=Xe(R);Ka(P,r),W(b,R)};Oe(m,b=>{r()&&b(k)})}var S=j(m,2);{var p=b=>{var R=vp();R.__click=function(...P){e.onGiveUp?.apply(this,P)},W(b,R)};Oe(S,b=>{t()&&e.onGiveUp&&b(p)})}W(n,l)}Ft(["click"]);var gp=Q('<div class="item-icon reward-glow svelte-1g9s15m"><img class="icon-preview svelte-1g9s15m" height="64px"/></div>'),_p=Q('<div id="reward-panel" class="svelte-1g9s15m"><!> <div class="reward-info svelte-1g9s15m"><div class="reward-label svelte-1g9s15m"> </div> <div class="reward-name svelte-1g9s15m"> </div></div></div>');function mp(n,e){Pt(e,!0);let t=ze(e,"rewardItem",3,null),r=ze(e,"items",19,()=>[]),i=ze(e,"bucketName",3,"dracula"),l=ze(e,"label",3,"Награда");function u(){if(!t()||!r()||r().length===0)return null;const p=typeof t()=="string"?t():t().id;return r().find(b=>b.id===p)||null}let h=Dt(u),v=Dt(()=>typeof t()=="object"&&t().name?t().name:null);function g(p){const b=p.target;b.style.display="none"}var m=At(),k=Xe(m);{var S=p=>{var b=_p(),R=E(b);{var P=C=>{var T=gp(),K=E(T);Se(()=>{Ne(K,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${i()}/${f(h)?.icon||(typeof t()=="object"?t().icon:"")}`),Ne(K,"alt",f(h)?.name||f(v)||"Награда")}),Sd("error",K,g),W(C,T)};Oe(R,C=>{(f(h)?.icon||typeof t()=="object"&&t().icon)&&C(P)})}var U=j(R,2),q=E(U),L=E(q),z=j(q,2),H=E(z);Se(()=>{be(L,`${l()??""}:`),be(H,f(h)?.name||f(v)||"Неизвестный предмет")}),W(p,b)};Oe(k,p=>{(f(h)||f(v))&&p(S)})}W(n,m),Ot()}var yp=Q('<div id="game-footer" class="svelte-1izvgt7"><!> <!></div>');function ur(n,e){let t=ze(e,"rewardItem",3,null),r=ze(e,"items",19,()=>[]),i=ze(e,"bucketName",3,"dracula");var l=yp(),u=E(l);mp(u,{get rewardItem(){return t()},get items(){return r()},get bucketName(){return i()}});var h=j(u,2);{var v=g=>{var m=At(),k=Xe(m);Ka(k,()=>e.children),W(g,m)};Oe(h,g=>{e.children&&g(v)})}W(n,l)}var bp=Q("<button> </button>"),wp=Q('<div id="modal-overlay"><div class="modal-content svelte-s62q14"><div class="modal-title svelte-s62q14"> </div> <div class="modal-text svelte-s62q14"> </div> <div class="modal-buttons svelte-s62q14"></div></div></div>');function cr(n,e){Pt(e,!0);let t=ze(e,"modal",7);var r=At(),i=Xe(r);{var l=u=>{var h=wp();let v;var g=E(h),m=E(g),k=E(m),S=j(m,2),p=E(S),b=j(S,2);Ze(b,21,()=>t().actions,R=>R.text,(R,P)=>{var U=bp();let q;U.__click=function(...z){f(P).action?.apply(this,z)};var L=E(U);Se(z=>{q=Nt(U,1,"btn",null,q,z),be(L,f(P).text)},[()=>({"btn-secondary":f(P).class==="btn-secondary"})]),W(R,U)}),Se(R=>{v=Nt(h,1,"svelte-s62q14",null,v,R),be(k,t().title),be(p,t().text)},[()=>({active:t().show})]),W(u,h)};Oe(i,u=>{t().show&&u(l)})}W(n,r),Ot()}Ft(["click"]);var kp=Q('<div role="button" tabindex="0"> </div>'),Ip=Ad('<polyline class="connection-line svelte-d67gs4" vector-effect="non-scaling-stroke"></polyline>'),Sp=Q('<span class="cooldown-timer svelte-d67gs4"> </span>'),Ep=Q('<div class="footer-stats svelte-d67gs4"><span class="tiles-counter svelte-d67gs4">Осталось: <strong class="svelte-d67gs4"> </strong></span> <button>💡 <!></button></div>'),Ap=Q('<!> <div id="game-container" class="svelte-d67gs4"><div id="grid" class="svelte-d67gs4"></div> <svg id="line-layer" class="svelte-d67gs4"><!></svg></div> <!> <!>',1);function Cp(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=8,h=6,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","🧟‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗","🌛","🖤","🗡️","🧛‍♀️","🗝️","🕯️","🌑","☠️","🧿","🌞"];let m=Me(pt([])),k=Me(pt([])),S=Me(pt({})),p=Me(pt([])),b=Me(null),R=Me(!1),P=Me(!1),U=Me(""),q=Me(0),L=Me(0),z=Me(pt({show:!1,title:"",text:"",actions:[]})),H,C;In(()=>{ve()});function T(){if(!f(k)||f(k).length===0)return 0;let ne=0;for(let le=0;le<u;le++)for(let Y=0;Y<h;Y++)f(k)[le]&&!f(k)[le][Y]&&ne++;return ne}let K=Dt(T),X=Dt(()=>f(L)<1);function ve(){ie(m,[],!0),ie(k,[],!0),ie(b,null),ie(R,!1),ie(P,!1),ie(S,{},!0),ie(p,[],!0),ie(U,""),ie(L,0),Ie();let ne=[...new Set(g)];for(;ne.length<u*h/2;)ne=[...ne,...ne];let le=ne.sort(()=>.5-Math.random()).slice(0,u*h/2),Y=[];le.forEach(re=>Y.push(re,re)),Y.sort(()=>Math.random()-.5);let ce=0;for(let re=0;re<u;re++){let ue=[],fe=[];for(let ye=0;ye<h;ye++)ue.push(Y[ce++]),fe.push(!1);f(m).push(ue),f(k).push(fe)}setTimeout(D,500)}async function de(ne,le){if(f(R)||f(k)[ne][le]||f(P))return;if(f(p).length>0&&ie(p,[],!0),!f(b)){ie(b,{r:ne,c:le},!0);return}if(f(b).r===ne&&f(b).c===le){ie(b,null);return}const Y=f(m)[f(b).r][f(b).c],ce=f(m)[ne][le];if(Y===ce){const re=ae(f(b).r,f(b).c,ne,le);if(re){ie(R,!0),await ge(re),f(k)[f(b).r][f(b).c]=!0,f(k)[ne][le]=!0,ie(b,null),ie(R,!1),me(),D();return}}ie(b,{r:ne,c:le},!0)}async function oe(ne,le,Y){(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),await de(ne,le))}function me(){ie(L,v);const ne=setInterval(()=>{er(L,-1),f(L)<=0&&clearInterval(ne)},1e3)}function ee(){if(f(R)||f(P)||!f(X))return;let ne=[];for(let Y=0;Y<u;Y++)for(let ce=0;ce<h;ce++)f(k)[Y][ce]||ne.push({r:Y,c:ce,icon:f(m)[Y][ce]});let le={};ne.forEach(Y=>{le[Y.icon]||(le[Y.icon]=[]),le[Y.icon].push(Y)});for(const Y in le){const ce=le[Y];if(!(ce.length<2))for(let re=0;re<ce.length;re++)for(let ue=re+1;ue<ce.length;ue++){const fe=ce[re],ye=ce[ue];if(ae(fe.r,fe.c,ye.r,ye.c)){ie(p,[fe,ye],!0),setTimeout(()=>ie(p,[],!0),1500);return}}}}function D(){if(f(K)===0){ie(P,!0),t()?(_e("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{Ie(),e.onWin?.()},3e3)):_e("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:ve}]);return}Z()||(t()?setTimeout(()=>M(),1e3):_e("😨 Тупик!","Ходов больше нет. Перемешать?",[{text:"Перемешать",action:()=>{Ie(),M()}},{text:"Сдаться",action:()=>{_e("Конец","Попытайте удачу снова!",[{text:"ОК",action:ve}])}}]))}function Z(){let ne=[];for(let Y=0;Y<u;Y++)for(let ce=0;ce<h;ce++)f(k)[Y][ce]||ne.push({r:Y,c:ce,icon:f(m)[Y][ce]});let le={};ne.forEach(Y=>{le[Y.icon]||(le[Y.icon]=[]),le[Y.icon].push(Y)});for(const Y in le){const ce=le[Y];if(!(ce.length<2)){for(let re=0;re<ce.length;re++)for(let ue=re+1;ue<ce.length;ue++)if(ae(ce[re].r,ce[re].c,ce[ue].r,ce[ue].c))return!0}}return!1}function M(){let ne=[],le=[];for(let Y=0;Y<u;Y++)for(let ce=0;ce<h;ce++)f(k)[Y][ce]||(ne.push(f(m)[Y][ce]),le.push({r:Y,c:ce}));ne.length!==0&&(ne.sort(()=>Math.random()-.5),le.forEach((Y,ce)=>{f(m)[Y.r][Y.c]=ne[ce],f(S)[`${Y.r},${Y.c}`]=!0}),setTimeout(()=>{ie(S,{},!0),Z()?ie(P,!1):M()},500))}function $(ne,le){return ne<0||ne>=u||le<0||le>=h?!0:f(k)[ne][le]}function te(ne,le,Y,ce){if(ne!==Y&&le!==ce)return!1;if(ne===Y){const re=Math.min(le,ce),ue=Math.max(le,ce);for(let fe=re+1;fe<ue;fe++)if(!$(ne,fe))return!1}else{const re=Math.min(ne,Y),ue=Math.max(ne,Y);for(let fe=re+1;fe<ue;fe++)if(!$(fe,le))return!1}return!0}function ae(ne,le,Y,ce){if(te(ne,le,Y,ce))return[{r:ne,c:le},{r:Y,c:ce}];const re={r:ne,c:ce};if($(re.r,re.c)&&te(ne,le,re.r,re.c)&&te(re.r,re.c,Y,ce))return[{r:ne,c:le},re,{r:Y,c:ce}];const ue={r:Y,c:le};if($(ue.r,ue.c)&&te(ne,le,ue.r,ue.c)&&te(ue.r,ue.c,Y,ce))return[{r:ne,c:le},ue,{r:Y,c:ce}];for(let fe=-1;fe<=u;fe++){if(fe===ne||fe===Y)continue;const ye={r:fe,c:le},Ae={r:fe,c:ce};if($(ye.r,ye.c)&&$(Ae.r,Ae.c)&&te(ne,le,ye.r,ye.c)&&te(ye.r,ye.c,Ae.r,Ae.c)&&te(Ae.r,Ae.c,Y,ce))return[{r:ne,c:le},ye,Ae,{r:Y,c:ce}]}for(let fe=-1;fe<=h;fe++){if(fe===le||fe===ce)continue;const ye={r:ne,c:fe},Ae={r:Y,c:fe};if($(ye.r,ye.c)&&$(Ae.r,Ae.c)&&te(ne,le,ye.r,ye.c)&&te(ye.r,ye.c,Ae.r,Ae.c)&&te(Ae.r,Ae.c,Y,ce))return[{r:ne,c:le},ye,Ae,{r:Y,c:ce}]}return null}async function ge(ne){if(await vu(),!H||!C)return;const le=H.getBoundingClientRect(),Y=C.getBoundingClientRect(),ce=C.querySelector(".cell:not(.matched)");if(!ce)return;const re=ce.offsetWidth,ue=ce.offsetHeight,fe=window.getComputedStyle(C),ye=parseFloat(fe.gap)||4,Ae=Y.left-le.left,Ke=Y.top-le.top,Ue=ne.map($e=>{let Ve,qe;if($e.r>=0&&$e.r<u&&$e.c>=0&&$e.c<h){const lt=C.children[$e.r*h+$e.c].getBoundingClientRect();Ve=lt.left-le.left+lt.width/2,qe=lt.top-le.top+lt.height/2}else{const _t=$e.c*(re+ye)+re/2,lt=$e.r*(ue+ye)+ue/2;Ve=Ae+_t,qe=Ke+lt}return`${Ve.toFixed(1)},${qe.toFixed(1)}`}).join(" ");return ie(U,Ue,!0),er(q),new Promise($e=>{setTimeout(()=>{ie(U,""),$e()},350)})}function _e(ne,le,Y){ie(z,{show:!0,title:ne,text:le,actions:Y},!0)}function Ie(){f(z).show=!1}function Ee(){_e("📖 Правила",`Соеди монстров:

🎯 Цель: Удалить все пары одинаковых монстров.

🔗 Соедини две одинаковые фигуры линией.

📐 Линия может иметь не более 2 поворотов (изгибов).

🚫 Линия не должна проходить через другие фигуры.

💡 Если ходов нет — игра сама перемешает доску.

💡 Кнопка 💡 покажет доступную пару (с перезарядкой).`,[{text:"Понятно",action:Ie}])}function We(){t()?(_e("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{Ie(),e.onLose?.()},3e3)):_e("Конец","Попытайте удачу снова!",[{text:"ОК",action:ve}])}or(n,{children:(ne,le)=>{var Y=Ap(),ce=Xe(Y);{let Ue=Dt(()=>t()?We:void 0);lr(ce,{onRestart:ve,get onGiveUp(){return f(Ue)},get showGiveUp(){return t()},onShowRules:Ee})}var re=j(ce,2),ue=E(re);sn(ue,"grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(8, 1fr);"),Ze(ue,21,()=>f(m),xt,(Ue,$e,Ve)=>{var qe=At(),_t=Xe(qe);Ze(_t,17,()=>f($e),xt,(lt,kt,mt)=>{var y=kp();let o;y.__click=()=>de(Ve,mt),y.__keydown=w=>oe(Ve,mt,w);var d=E(y);Se(w=>{o=Nt(y,1,"cell svelte-d67gs4",null,o,w),be(d,f(kt))},[()=>({selected:f(b)?.r===Ve&&f(b)?.c===mt,matched:f(k)[Ve][mt],shuffling:f(S)[`${Ve},${mt}`],"hint-glow":f(p).some(w=>w.r===Ve&&w.c===mt)})]),W(lt,y)}),W(Ue,qe)}),ka(ue,Ue=>C=Ue,()=>C);var fe=j(ue,2),ye=E(fe);wa(ye,()=>f(q),Ue=>{var $e=At(),Ve=Xe($e);{var qe=_t=>{var lt=Ip();Se(()=>Ne(lt,"points",f(U))),W(_t,lt)};Oe(Ve,_t=>{f(U)&&_t(qe)})}W(Ue,$e)}),ka(re,Ue=>H=Ue,()=>H);var Ae=j(re,2);ur(Ae,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Ue,$e)=>{var Ve=Ep(),qe=E(Ve),_t=j(E(qe)),lt=E(_t),kt=j(qe,2);let mt;kt.__click=ee;var y=j(E(kt));{var o=d=>{var w=Sp(),x=E(w);Se(()=>be(x,`(${f(L)??""})`)),W(d,w)};Oe(y,d=>{f(L)>0&&d(o)})}Se(d=>{be(lt,f(K)),mt=Nt(kt,1,"btn btn-secondary svelte-d67gs4",null,mt,d),kt.disabled=!f(X)},[()=>({disabled:!f(X),"cooldown-active":f(L)>0})]),W(Ue,Ve)},$$slots:{default:!0}});var Ke=j(Ae,2);cr(Ke,{get modal(){return f(z)}}),W(ne,Y)}}),Ot()}Ft(["click","keydown"]);function jp(n,e,t,r,i,l,u,h,v,g){if(!(f(e)||f(t)||!f(r)))for(let m=0;m<i;m++)for(let k=0;k<l;k++){if(f(u)[m]?.[k]||f(h)[m]?.[k])continue;let S=f(v)[m][k];for(let p=0;p<i;p++)for(let b=0;b<l;b++)if(!(m===p&&k===b)&&!(f(u)[p]?.[b]||f(h)[p]?.[b])&&f(v)[p][b]===S){ie(g,[{r:m,c:k},{r:p,c:b}],!0),setTimeout(()=>ie(g,[],!0),1500);return}}}var Tp=Q('<button type="button"><div class="card-inner svelte-k8c0r2"><div class="card-front svelte-k8c0r2"> </div> <div class="card-back svelte-k8c0r2">?</div></div></button>'),xp=Q('<span class="cooldown-timer svelte-k8c0r2"> </span>'),Rp=Q('<div class="footer-stats svelte-k8c0r2"><span class="tiles-counter svelte-k8c0r2">Осталось: <strong class="svelte-k8c0r2"> </strong></span> <button>💡 <!></button></div>'),Pp=Q('<!> <div id="game-container" class="svelte-k8c0r2"><div id="grid" class="svelte-k8c0r2"></div></div> <!> <!>',1);function Op(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4,h=4,v=5,g=["🦄","🧙","👻","💀","🔥","🕷️","🕸️","🧟","‍♀️","⚰️","🐸","🦴","🔮","🧪","👹","🌜","🍭","💗"];let m=Me(pt([])),k=Me(pt([])),S=Me(pt([])),p=Me(pt([])),b=Me(null),R=Me(!1),P=Me(!1),U=Me(0),q=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>{C()});function L(){let ee=0;for(let D=0;D<u;D++)for(let Z=0;Z<h;Z++)f(k)[D]?.[Z]||ee++;return ee}let z=Dt(L),H=Dt(()=>f(U)<1);function C(){ie(m,[],!0),ie(k,[],!0),ie(S,[],!0),ie(b,null),ie(R,!1),ie(P,!1),ie(p,[],!0),ie(U,0),oe();let ee=[...new Set(g)];for(;ee.length<u*h/2;)ee=[...ee,...ee];let D=ee.sort(()=>.5-Math.random()).slice(0,u*h/2),Z=[];D.forEach($=>Z.push($,$)),Z.sort(()=>Math.random()-.5);let M=0;for(let $=0;$<u;$++){let te=[],ae=[],ge=[];for(let _e=0;_e<h;_e++)te.push(Z[M++]),ae.push(!1),ge.push(!1);f(m).push(te),f(k).push(ae),f(S).push(ge)}}async function T(ee,D){if(!(f(R)||f(k)[ee]?.[D]||f(P))){if(f(b)&&f(b).r===ee&&f(b).c===D){f(S)[ee][D]=!1,ie(b,null);return}if(!f(S)[ee]?.[D])if(f(p).length>0&&ie(p,[],!0),f(S)[ee][D]=!0,!f(b))ie(b,{r:ee,c:D},!0);else{ie(R,!0);const Z={r:ee,c:D},M=f(m)[f(b).r][f(b).c],$=f(m)[Z.r][Z.c];M===$?setTimeout(()=>{f(k)[f(b).r][f(b).c]=!0,f(k)[Z.r][Z.c]=!0,f(S)[f(b).r][f(b).c]=!1,f(S)[Z.r][Z.c]=!1,ie(b,null),ie(R,!1),K(),X()},600):setTimeout(()=>{f(S)[f(b).r][f(b).c]=!1,f(S)[Z.r][Z.c]=!1,ie(b,null),ie(R,!1)},1e3)}}}function K(){ie(U,v);const ee=setInterval(()=>{er(U,-1),f(U)<=0&&clearInterval(ee)},1e3)}function X(){f(z)===0&&(ie(P,!0),t()?(de("🎉 Победа!","Все монстры пойманы!",[]),setTimeout(()=>{oe(),e.onWin?.()},3e3)):de("🎉 Победа!","Все монстры пойманы!",[{text:"Играть снова",action:C}]))}function ve(){t()?(de("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{oe(),e.onLose?.()},3e3)):de("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:C}])}function de(ee,D,Z){ie(q,{show:!0,title:ee,text:D,actions:Z},!0)}function oe(){f(q).show=!1}function me(){de("📖 Правила",`Память с монстрами:

🎯 Цель: Найти все пары одинаковых карт.

🔍 Кликни на карту, чтобы открыть её.

🔗 Найди вторую карту с таким же изображением.

💡 Если карты совпали — они исчезают.

❌ Если не совпали — обе закроются.

💡 Подсказка (кнопка 💡) покажет одну пару, но имеет перезарядку.`,[{text:"Понятно",action:oe}])}or(n,{children:(ee,D)=>{var Z=Pp(),M=Xe(Z);{let _e=Dt(()=>t()?ve:void 0);lr(M,{onRestart:C,get onGiveUp(){return f(_e)},get showGiveUp(){return t()},onShowRules:me})}var $=j(M,2),te=E($);sn(te,"grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);"),Ze(te,21,()=>f(m),xt,(_e,Ie,Ee)=>{var We=At(),ne=Xe(We);Ze(ne,17,()=>f(Ie),xt,(le,Y,ce)=>{var re=Tp();let ue;re.__click=()=>T(Ee,ce),Ne(re,"aria-label",`Ячейка ${Ee}, ${ce}`);var fe=E(re),ye=E(fe),Ae=E(ye);Se(Ke=>{ue=Nt(re,1,"cell svelte-k8c0r2",null,ue,Ke),be(Ae,f(Y))},[()=>({flipped:f(S)[Ee]?.[ce],matched:f(k)[Ee]?.[ce],selected:f(b)?.r===Ee&&f(b)?.c===ce,"hint-glow":f(p).some(Ke=>Ke.r===Ee&&Ke.c===ce)})]),W(le,re)}),W(_e,We)});var ae=j($,2);ur(ae,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(_e,Ie)=>{var Ee=Rp(),We=E(Ee),ne=j(E(We)),le=E(ne),Y=j(We,2);let ce;Y.__click=[jp,R,P,H,u,h,k,S,m,p];var re=j(E(Y));{var ue=fe=>{var ye=xp(),Ae=E(ye);Se(()=>be(Ae,`(${f(U)??""})`)),W(fe,ye)};Oe(re,fe=>{f(U)>0&&fe(ue)})}Se(fe=>{be(le,f(z)),ce=Nt(Y,1,"btn btn-secondary svelte-k8c0r2",null,ce,fe),Y.disabled=!f(H)},[()=>({disabled:!f(H),"cooldown-active":f(U)>0})]),W(_e,Ee)},$$slots:{default:!0}});var ge=j(ae,2);cr(ge,{get modal(){return f(q)}}),W(ee,Z)}}),Ot()}Ft(["click"]);var Mp=Q('<div class="flame svelte-1v5x2m5"></div>'),Lp=Q('<button type="button"><div class="candle svelte-1v5x2m5"><!></div></button>'),Dp=Q('<div class="footer-stats svelte-1v5x2m5"><span class="moves-counter svelte-1v5x2m5">Ходов: <strong class="svelte-1v5x2m5"> </strong></span></div>'),Fp=Q('<!> <div id="game-container" class="svelte-1v5x2m5"><div id="grid" class="svelte-1v5x2m5"></div></div> <!> <!>',1);function $p(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=5,h=5,v=15;let g=Me(pt([])),m=Me(0),k=Me(!1),S=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>b());let p=Dt(()=>f(g).flat().every(C=>!C));function b(){ie(g,Array(u).fill(null).map(()=>Array(h).fill(!1)),!0),ie(m,0),ie(k,!1),z();for(let C=0;C<v;C++){const T=Math.floor(Math.random()*u),K=Math.floor(Math.random()*h);R(T,K,!0)}}function R(C,T,K=!1){f(g)[C][T]=!f(g)[C][T],C>0&&(f(g)[C-1][T]=!f(g)[C-1][T]),C<u-1&&(f(g)[C+1][T]=!f(g)[C+1][T]),T>0&&(f(g)[C][T-1]=!f(g)[C][T-1]),T<h-1&&(f(g)[C][T+1]=!f(g)[C][T+1]),K||(er(m),U())}function P(C,T){f(k)||R(C,T)}function U(){f(p)&&(ie(k,!0),t()?(L("🕯️ Тьма наступила",`Вы погасили все свечи за ${f(m)} ходов!`,[]),setTimeout(()=>{z(),e.onWin?.()},3e3)):L("🕯️ Тьма наступила",`Вы погасили все свечи за ${f(m)} ходов!`,[{text:"Играть снова",action:b}]))}function q(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:b}])}function L(C,T,K){ie(S,{show:!0,title:C,text:T,actions:K},!0)}function z(){f(S).show=!1}function H(){L("📖 Правила",`Погаси свечи:

🎯 Цель: Погасить все свечи на поле.

💡 Клик на свечу переключает её и соседние свечи (вверх, вниз, влево, вправо).

🔢 Зажжённая свеча гаснет, а потухшая — зажигается.

🧠 Подумай хорошенько — каждый ход влияет на соседние свечи!

🏆 Чем меньше ходов — тем лучше.`,[{text:"Понятно",action:z}])}or(n,{children:(C,T)=>{var K=Fp(),X=Xe(K);{let ee=Dt(()=>t()?q:void 0);lr(X,{onRestart:b,get onGiveUp(){return f(ee)},get showGiveUp(){return t()},onShowRules:H})}var ve=j(X,2),de=E(ve);sn(de,"grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr);"),Ze(de,21,()=>f(g),xt,(ee,D,Z)=>{var M=At(),$=Xe(M);Ze($,17,()=>f(D),xt,(te,ae,ge)=>{var _e=Lp();let Ie;_e.__click=()=>P(Z,ge),Ne(_e,"aria-label",`Свеча ${Z}, ${ge}`);var Ee=E(_e),We=E(Ee);{var ne=le=>{var Y=Mp();W(le,Y)};Oe(We,le=>{f(ae)&&le(ne)})}Se(le=>Ie=Nt(_e,1,"cell svelte-1v5x2m5",null,Ie,le),[()=>({lit:f(ae)})]),W(te,_e)}),W(ee,M)});var oe=j(ve,2);ur(oe,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(ee,D)=>{var Z=Dp(),M=E(Z),$=j(E(M)),te=E($);Se(()=>be(te,f(m))),W(ee,Z)},$$slots:{default:!0}});var me=j(oe,2);cr(me,{get modal(){return f(S)}}),W(C,K)}}),Ot()}Ft(["click"]);var Up=Q('<div class="cell svelte-53kujm"> </div>'),Np=Q('<button class="color-btn svelte-53kujm"> </button>'),Bp=Q('<div class="footer-stats svelte-53kujm"><span class="moves-counter svelte-53kujm">Ходов: <strong class="svelte-53kujm"> </strong> </span></div>'),Wp=Q('<!> <div id="game-container" class="svelte-53kujm"><div id="grid" class="svelte-53kujm"></div></div> <div class="color-picker svelte-53kujm"></div> <!> <!>',1);function Vp(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=12,h=25,v=[{name:"unicorn",value:"#e94560",icon:"🦄"},{name:"wizard",value:"#6c5ce7",icon:"🧙"},{name:"ghost",value:"#0984e3",icon:"👻"},{name:"skull",value:"#00b894",icon:"💀"},{name:"fire",value:"#fdcb6e",icon:"🔥"},{name:"spider",value:"#ffeaa7",icon:"🕷️"}];let g=Me(pt([])),m=Me(0),k=Me(!1),S=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>b());let p=Dt(()=>()=>{const C=f(g)[0][0];return f(g).every(T=>T.every(K=>K===C))});function b(){ie(g,[],!0),ie(m,0),ie(k,!1),z();for(let C=0;C<u;C++){let T=[];for(let K=0;K<u;K++)T.push(Math.floor(Math.random()*v.length));f(g).push(T)}}function R(C,T,K,X){C<0||C>=u||T<0||T>=u||f(g)[C][T]===K&&(f(g)[C][T]=X,R(C-1,T,K,X),R(C+1,T,K,X),R(C,T-1,K,X),R(C,T+1,K,X))}function P(C){if(f(k)||f(m)>=h)return;const T=f(g)[0][0];C!==T&&(R(0,0,T,C),er(m),U())}function U(){f(p)()?(ie(k,!0),t()?(L("🎉 Победа!",`Вы захватили мир за ${f(m)} ходов!`,[]),setTimeout(()=>{z(),e.onWin?.()},3e3)):L("🎉 Победа!",`Вы захватили мир за ${f(m)} ходов!`,[{text:"Играть снова",action:b}])):f(m)>=h&&(ie(k,!0),t()?(L("💀 Поражение","Ходы закончились!",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):L("💀 Поражение","Ходы закончились!",[{text:"Заново",action:b}]))}function q(){t()?(L("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{z(),e.onLose?.()},3e3)):L("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:b}])}function L(C,T,K){ie(S,{show:!0,title:C,text:T,actions:K},!0)}function z(){f(S).show=!1}function H(){L("📖 Правила",`Заливка мира:

🎯 Цель: Залить всё поле одним цветом.

🔴 Нажми на цвет внизу — он начнёт заливать поле с левого верхнего угла.

🔗 Цвет распространяется по соседним клеткам того же цвета.

⏰ У тебя есть всего 25 ходов!

💡 Планируй заранее — выбирай цтобы захватить как можно больше клеток.`,[{text:"Понятно",action:z}])}or(n,{children:(C,T)=>{var K=Wp(),X=Xe(K);{let D=Dt(()=>t()?q:void 0);lr(X,{onRestart:b,get onGiveUp(){return f(D)},get showGiveUp(){return t()},onShowRules:H})}var ve=j(X,2),de=E(ve);sn(de,"grid-template-columns: repeat(12, 1fr);"),Ze(de,21,()=>f(g),xt,(D,Z)=>{var M=At(),$=Xe(M);Ze($,17,()=>f(Z),xt,(te,ae)=>{var ge=Up(),_e=E(ge);Se(()=>{sn(ge,`background-color: ${v[f(ae)].value??""};`),be(_e,v[f(ae)].icon)}),W(te,ge)}),W(D,M)});var oe=j(ve,2);Ze(oe,21,()=>v,xt,(D,Z,M)=>{var $=Np();$.__click=()=>P(M);var te=E($);Se(()=>{sn($,`background-color: ${f(Z).value??""};`),$.disabled=f(k)||f(m)>=h,be(te,f(Z).icon)}),W(D,$)});var me=j(oe,2);ur(me,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(D,Z)=>{var M=Bp(),$=E(M),te=j(E($)),ae=E(te),ge=j(te);ge.nodeValue=" / 25",Se(()=>be(ae,f(m))),W(D,M)},$$slots:{default:!0}});var ee=j(me,2);cr(ee,{get modal(){return f(S)}}),W(C,K)}}),Ot()}Ft(["click"]);var qp=Q('<button type="button"> </button>'),Gp=Q('<div class="footer-stats svelte-fn2aic"><span class="moves-counter svelte-fn2aic">Ходов: <strong class="svelte-fn2aic"> </strong></span></div>'),Hp=Q('<!> <div id="game-container" class="svelte-fn2aic"><div id="grid" class="svelte-fn2aic"></div></div> <!> <!>',1);function zp(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4;let h=Me(pt([])),v=Me(0),g=Me(!1),m=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>S());let k=Dt(()=>()=>{let H=1;for(let C=0;C<u;C++)for(let T=0;T<u;T++)if(C===u-1&&T===u-1){if(f(h)[C][T]!==null)return!1}else{if(f(h)[C][T]!==H)return!1;H++}return!0});function S(){ie(h,[],!0),ie(v,0),ie(g,!1),L();let H=[];for(let T=1;T<u*u;T++)H.push(T);H.push(null);do H=H.sort(()=>Math.random()-.5);while(!p(H));let C=0;for(let T=0;T<u;T++){let K=[];for(let X=0;X<u;X++)K.push(H[C++]);f(h).push(K)}}function p(H){let C=0;for(let K=0;K<H.length;K++)for(let X=K+1;X<H.length;X++)H[K]&&H[X]&&H[K]>H[X]&&C++;let T=0;for(let K=0;K<H.length;K++)if(H[K]===null){T=Math.floor(K/u);break}return C%2===(u-T)%2}function b(){for(let H=0;H<u;H++)for(let C=0;C<u;C++)if(f(h)[H][C]===null)return{r:H,c:C};return null}function R(H,C){if(f(g))return;const T=b();if(!T)return;const K=Math.abs(H-T.r),X=Math.abs(C-T.c);(K===1&&X===0||K===0&&X===1)&&(f(h)[T.r][T.c]=f(h)[H][C],f(h)[H][C]=null,er(v),P())}function P(){f(k)()&&(ie(g,!0),t()?(q("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${f(v)} ходов!`,[]),setTimeout(()=>{L(),e.onWin?.()},3e3)):q("🪞 Зеркало восстановлено!",`Вы собрали осколки за ${f(v)} ходов!`,[{text:"Играть снова",action:S}]))}function U(){t()?(q("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{L(),e.onLose?.()},3e3)):q("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:S}])}function q(H,C,T){ie(m,{show:!0,title:H,text:C,actions:T},!0)}function L(){f(m).show=!1}function z(){q("📖 Правила",`Пятнашки (Осколки зеркала):

🎯 Цель: Собрать числа по порядку от 1 до 15.

🔄 Клик на плитку перемещает её на пустое место (рядом).

🧠 Подумай над ходами — плитки можно двигать только по одной!

🏆 Собери головоломку за меньшее количество ходов.`,[{text:"Понятно",action:L}])}or(n,{children:(H,C)=>{var T=Hp(),K=Xe(T);{let me=Dt(()=>t()?U:void 0);lr(K,{onRestart:S,get onGiveUp(){return f(me)},get showGiveUp(){return t()},onShowRules:z})}var X=j(K,2),ve=E(X);sn(ve,"grid-template-columns: repeat(4, 1fr);"),Ze(ve,21,()=>f(h),xt,(me,ee,D)=>{var Z=At(),M=Xe(Z);Ze(M,17,()=>f(ee),xt,($,te,ae)=>{var ge=qp();let _e;ge.__click=()=>R(D,ae);var Ie=E(ge);Se(Ee=>{_e=Nt(ge,1,"cell svelte-fn2aic",null,_e,Ee),ge.disabled=f(te)===null,Ne(ge,"aria-label",f(te)===null?"Пустая ячейка":`Ячейка ${f(te)}`),be(Ie,f(te))},[()=>({empty:f(te)===null})]),W($,ge)}),W(me,Z)});var de=j(X,2);ur(de,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(me,ee)=>{var D=Gp(),Z=E(D),M=j(E(Z)),$=E(M);Se(()=>be($,f(v))),W(me,D)},$$slots:{default:!0}});var oe=j(de,2);cr(oe,{get modal(){return f(m)}}),W(H,T)}}),Ot()}Ft(["click"]);function Kp(n,e,t){ie(e,n.touches[0].clientX,!0),ie(t,n.touches[0].clientY,!0)}var Yp=Q("<div> </div>"),Jp=Q('<div class="footer-stats svelte-1o3nb6j"><span class="score-counter svelte-1o3nb6j">Очки: <strong class="svelte-1o3nb6j"> </strong></span></div>'),Xp=Q('<!> <div id="game-container" class="svelte-1o3nb6j"><div id="grid" class="svelte-1o3nb6j"></div></div> <!> <!>',1);function Qp(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=4,h=2048,v={2:"🦇",4:"👻",8:"💀",16:"🧟",32:"🧛",64:"🧙",128:"👹",256:"🐉",512:"🔥",1024:"⚡",2048:"👑"},g={2:"#3d3b5c",4:"#4e4c75",8:"#e94560",16:"#6c5ce7",32:"#a29bfe",64:"#fdcb6e",128:"#00b894",256:"#e17055",512:"#fd79a8",1024:"#00cec9",2048:"#ffd700"};let m=Me(pt([])),k=Me(0),S=Me(!1),p=Me(!1),b=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>(R(),window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)));function R(){ie(m,Array(u).fill(null).map(()=>Array(u).fill(0)),!0),ie(k,0),ie(S,!1),ie(p,!1),D(),P(),P()}function P(){let M=[];for(let $=0;$<u;$++)for(let te=0;te<u;te++)f(m)[$][te]===0&&M.push({r:$,c:te});if(M.length>0){const{r:$,c:te}=M[Math.floor(Math.random()*M.length)];f(m)[$][te]=Math.random()<.9?2:4}}function U(M){if(f(S))return;let $=!1;switch(M.key){case"ArrowUp":$=H();break;case"ArrowDown":$=C();break;case"ArrowLeft":$=L();break;case"ArrowRight":$=z();break}$&&(M.preventDefault(),P(),ve())}function q(M){let $=M.filter(ae=>ae!==0),te=!1;for(let ae=0;ae<$.length-1;ae++)$[ae]===$[ae+1]&&($[ae]*=2,ie(k,f(k)+$[ae]),$.splice(ae+1,1),te=!0);for(;$.length<u;)$.push(0);return{newRow:$,moved:te||M.join(",")!==$.join(",")}}function L(){let M=!1;for(let $=0;$<u;$++){const{newRow:te,moved:ae}=q(f(m)[$]);f(m)[$]=te,ae&&(M=!0)}return M}function z(){let M=!1;for(let $=0;$<u;$++){const{newRow:te,moved:ae}=q([...f(m)[$]].reverse());f(m)[$]=te.reverse(),ae&&(M=!0)}return M}function H(){let M=!1;for(let $=0;$<u;$++){let te=[];for(let _e=0;_e<u;_e++)te.push(f(m)[_e][$]);const{newRow:ae,moved:ge}=q(te);for(let _e=0;_e<u;_e++)f(m)[_e][$]=ae[_e];ge&&(M=!0)}return M}function C(){let M=!1;for(let $=0;$<u;$++){let te=[];for(let _e=0;_e<u;_e++)te.push(f(m)[_e][$]);const{newRow:ae,moved:ge}=q(te.reverse());te=ae.reverse();for(let _e=0;_e<u;_e++)f(m)[_e][$]=te[_e];ge&&(M=!0)}return M}let T=Me(0),K=Me(0);function X(M){if(f(S))return;const $=M.changedTouches[0].clientX,te=M.changedTouches[0].clientY,ae=$-f(T),ge=te-f(K);if(Math.abs(ae)<30&&Math.abs(ge)<30)return;let _e=!1;Math.abs(ae)>Math.abs(ge)?_e=ae>0?z():L():_e=ge>0?C():H(),_e&&(M.preventDefault(),P(),ve())}function ve(){if(!f(p)){for(let M=0;M<u;M++)for(let $=0;$<u;$++)if(f(m)[M][$]>=h){ie(p,!0),t()?(ee("👑 Победа!","Вы создали короля монстров!",[]),setTimeout(()=>{D(),e.onWin?.()},3e3)):ee("👑 Победа!","Вы создали короля монстров!",[{text:"Продолжить",action:D},{text:"Новая игра",action:R,class:"btn-secondary"}]);return}}de()&&!oe()&&(ie(S,!0),t()?(ee("💀 Конец",`Игра окончена. Очки: ${f(k)}`,[]),setTimeout(()=>{D(),e.onLose?.()},3e3)):ee("💀 Конец",`Игра окончена. Очки: ${f(k)}`,[{text:"Новая игра",action:R}]))}function de(){for(let M=0;M<u;M++)for(let $=0;$<u;$++)if(f(m)[M][$]===0)return!1;return!0}function oe(){for(let M=0;M<u;M++)for(let $=0;$<u;$++)if($<u-1&&f(m)[M][$]===f(m)[M][$+1]||M<u-1&&f(m)[M][$]===f(m)[M+1][$])return!0;return!1}function me(){t()?(ee("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{D(),e.onLose?.()},3e3)):ee("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:R}])}function ee(M,$,te){ie(b,{show:!0,title:M,text:$,actions:te},!0)}function D(){f(b).show=!1}function Z(){ee("📖 Правила",`Эволюция 2048:

🎯 Цель: Создать существо уровня 2048 (Король).

⬅️➡️⬆️⬇️ Свайп или стрелки перемещают всех существ в одну сторону.

🔗 Одинаковые существа эволюционируют при столкновении:
🦇→👻→💀→🧟→🧛→🧙→👹→🐉→🔥→⚡→👑

💥 Новое существо появляется после каждого хода.

🏆 Победишь, когда получишь короля!`,[{text:"Понятно",action:D}])}or(n,{children:(M,$)=>{var te=Xp(),ae=Xe(te);{let We=Dt(()=>t()?me:void 0);lr(ae,{onRestart:R,get onGiveUp(){return f(We)},get showGiveUp(){return t()},onShowRules:Z})}var ge=j(ae,2);ge.__touchstart=[Kp,T,K],ge.__touchend=X;var _e=E(ge);Ze(_e,21,()=>f(m),xt,(We,ne)=>{var le=At(),Y=Xe(le);Ze(Y,17,()=>f(ne),xt,(ce,re)=>{var ue=Yp();Nt(ue,1,"cell svelte-1o3nb6j",null,{},{"cell-{cell}":re-{}});var fe=E(ue);Se(()=>{sn(ue,`background-color: ${g[f(re)]||"#2a2a40"};`),be(fe,f(re)>0?v[f(re)]||f(re):"")}),W(ce,ue)}),W(We,le)});var Ie=j(ge,2);ur(Ie,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(We,ne)=>{var le=Jp(),Y=E(le),ce=j(E(Y)),re=E(ce);Se(()=>be(re,f(k))),W(We,le)},$$slots:{default:!0}});var Ee=j(Ie,2);cr(Ee,{get modal(){return f(b)}}),W(M,te)}}),Ot()}Ft(["touchstart","touchend"]);var Zp=Q('<button type="button"><span class="cell-content svelte-1p9db1h"> </span></button>'),eg=Q('<div class="footer-stats svelte-1p9db1h"><span class="mines-counter svelte-1p9db1h"></span> <span class="flag-counter svelte-1p9db1h"> </span></div>'),tg=Q('<!> <div id="game-container" class="svelte-1p9db1h"><div id="grid" class="svelte-1p9db1h"></div></div> <!> <!>',1);function ng(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=8,h=8,v=10;let g=Me(pt([])),m=Me(!1),k=Me(!1),S=Me(!0),p=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>U());let b=Dt(()=>f(g).filter(D=>D.revealed).length),R=u*h,P=Dt(()=>f(k)||f(b)===R-v);function U(){ie(g,Array(R).fill(null).map(()=>({isMine:!1,revealed:!1,flagged:!1,adjacentMines:0})),!0),ie(m,!1),ie(k,!1),ie(S,!0),de()}function q(D){let Z=0;for(;Z<v;){const M=Math.floor(Math.random()*R);M!==D&&!f(g)[M].isMine&&(f(g)[M].isMine=!0,Z++)}for(let M=0;M<R;M++)f(g)[M].isMine||(f(g)[M].adjacentMines=L(M))}function L(D){const Z=Math.floor(D/h),M=D%h;let $=0;for(let te=-1;te<=1;te++)for(let ae=-1;ae<=1;ae++){if(te===0&&ae===0)continue;const ge=Z+te,_e=M+ae;if(ge>=0&&ge<u&&_e>=0&&_e<h){const Ie=ge*h+_e;f(g)[Ie].isMine&&$++}}return $}function z(D){if(!(f(m)||f(g)[D].revealed||f(g)[D].flagged)){if(f(S)&&(q(D),ie(S,!1)),f(g)[D].isMine){T(),ie(m,!0),ie(k,!1),t()?(ve("💥 БУМ!","Вы наткнулись на проклятую мину!",[]),setTimeout(()=>{de(),e.onLose?.()},3e3)):ve("💥 БУМ!","Вы наткнулись на проклятую мину!",[{text:"Попробовать снова",action:U}]);return}C(D),K()}}function H(D,Z){Z.preventDefault(),!(f(m)||f(g)[D].revealed)&&(f(g)[D].flagged=!f(g)[D].flagged)}function C(D){if(!(D<0||D>=R)&&!(f(g)[D].revealed||f(g)[D].flagged)&&(f(g)[D].revealed=!0,f(g)[D].adjacentMines===0&&!f(g)[D].isMine)){const Z=Math.floor(D/h),M=D%h;for(let $=-1;$<=1;$++)for(let te=-1;te<=1;te++){if($===0&&te===0)continue;const ae=Z+$,ge=M+te;ae>=0&&ae<u&&ge>=0&&ge<h&&C(ae*h+ge)}}}function T(){for(let D=0;D<R;D++)f(g)[D].isMine&&(f(g)[D].revealed=!0)}function K(){f(P)&&(ie(k,!0),ie(m,!0),t()?(ve("🎉 Победа!","Вы нашли все проклятые мины!",[]),setTimeout(()=>{de(),e.onWin?.()},3e3)):ve("🎉 Победа!","Вы нашли все проклятые мины!",[{text:"Играть снова",action:U}]))}function X(){t()?(ve("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{de(),e.onLose?.()},3e3)):ve("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:U}])}function ve(D,Z,M){ie(p,{show:!0,title:D,text:Z,actions:M},!0)}function de(){f(p).show=!1}function oe(D){return D.revealed?D.isMine?"💀":D.adjacentMines===0?"":D.adjacentMines.toString():D.flagged?"🕯":""}function me(D){return["","#00b894","#0984e3","#e94560","#6c5ce7","#fdcb6e","#00cec9","#d63031","#2d3436"][D]||"#ececec"}function ee(){ve("📖 Правила",`Сапёр (Проклятые склепы):

🎯 Цель: Открыть все ячейки, где нет мин.

🔢 Цифры показывают, сколько мин рядом с ячейкой (от 1 до 8).

🕯 Правый клик ставит флаг (пометить мину).

💡 Первое нажатие всегда безопасно — мины расставляются после первого клика.

💀 Если наткнёшься на мину — проигрыш.`,[{text:"Понятно",action:de}])}or(n,{children:(D,Z)=>{var M=tg(),$=Xe(M);{let Ie=Dt(()=>t()?X:void 0);lr($,{onRestart:U,get onGiveUp(){return f(Ie)},get showGiveUp(){return t()},onShowRules:ee})}var te=j($,2),ae=E(te);sn(ae,"grid-template-columns: repeat(8, 1fr);"),Ze(ae,21,()=>f(g),xt,(Ie,Ee,We)=>{var ne=Zp();let le;ne.__click=()=>z(We),ne.__contextmenu=re=>H(We,re);var Y=E(ne),ce=E(Y);Se((re,ue,fe)=>{le=Nt(ne,1,"cell svelte-1p9db1h",null,le,re),Ne(ne,"aria-label",f(Ee).revealed?f(Ee).isMine?"Мина":`Ячейка с ${f(Ee).adjacentMines} минами`:f(Ee).flagged?"Флаг":"Неизвестно"),sn(Y,`color: ${ue??""}`),be(ce,fe)},[()=>({revealed:f(Ee).revealed,mine:f(Ee).isMine&&f(Ee).revealed,flagged:f(Ee).flagged}),()=>f(Ee).revealed&&!f(Ee).isMine?me(f(Ee).adjacentMines):"",()=>oe(f(Ee))]),W(Ie,ne)});var ge=j(te,2);ur(ge,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(Ie,Ee)=>{var We=eg(),ne=E(We);ne.textContent="💀 10";var le=j(ne,2),Y=E(le);Se(ce=>be(Y,`🕯 ${ce??""}`),[()=>f(g).filter(ce=>ce.flagged).length]),W(Ie,We)},$$slots:{default:!0}});var _e=j(ge,2);cr(_e,{get modal(){return f(p)}}),W(D,M)}}),Ot()}Ft(["click","contextmenu"]);function rg(n,e,t,r){if(f(e).length>0){const i=f(e).pop();i.faceUp=!0,f(t).push(i)}else f(t).length>0&&(ie(e,f(t).reverse().map(i=>({...i,faceUp:!1})),!0),ie(t,[],!0));er(r)}function ig(n,e,t){f(e).length!==0&&ie(t,{pile:-2,index:f(e).length-1},!0)}var sg=Q('<div class="card back svelte-fcha4g"></div>'),ag=Q('<div class="card empty svelte-fcha4g">🔄</div>'),og=Q('<div><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),lg=Q('<div class="card front svelte-fcha4g"><span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span></div>'),ug=Q('<div class="card empty svelte-fcha4g">👻</div>'),cg=Q('<button type="button" class="pile foundation svelte-fcha4g"><!></button>'),dg=Q('<span class="rank svelte-fcha4g"> </span> <span class="suit svelte-fcha4g"> </span>',1),fg=Q('<button type="button"><!></button>'),hg=Q('<div class="tableau svelte-fcha4g" role="button" tabindex="0"></div>'),vg=Q('<div class="footer-stats svelte-fcha4g"><span class="moves-counter svelte-fcha4g">Ходов: <strong class="svelte-fcha4g"> </strong></span></div>'),pg=Q('<!> <div id="game-container" class="svelte-fcha4g"><div class="top-row svelte-fcha4g"><button type="button" class="pile stock svelte-fcha4g" aria-label="Колода"><!></button> <button type="button" class="pile waste svelte-fcha4g" aria-label="Сброс"><!></button> <div class="foundations svelte-fcha4g"></div></div> <div class="tableaus svelte-fcha4g"></div></div> <!> <!>',1);function gg(n,e){Pt(e,!0);let t=ze(e,"integrated",3,!1),r=ze(e,"rewardItem",3,null),i=ze(e,"items",19,()=>[]),l=ze(e,"bucketName",3,"dracula");const u=["hearts","diamonds","clubs","spades"],h={hearts:"♥",diamonds:"♦",clubs:"♣",spades:"♠"},v=[1,2,3,4,5,6,7,8,9,10,11,12,13],g={1:"A",11:"J",12:"Q",13:"K"};let m=Me(pt([])),k=Me(pt([])),S=Me(pt([[],[],[],[]])),p=Me(pt([[],[],[],[],[],[],[]])),b=Me(null),R=Me(!1),P=Me(0),U=Me(pt({show:!1,title:"",text:"",actions:[]}));In(()=>L());let q=Dt(()=>f(S).every(ee=>ee.length===13));function L(){let ee=[];for(const Z of u)for(const M of v)ee.push({suit:Z,rank:M,faceUp:!1});ee=ee.sort(()=>Math.random()-.5),ie(m,[],!0),ie(k,[],!0),ie(S,[[],[],[],[]],!0),ie(p,[[],[],[],[],[],[],[]],!0);let D=0;for(let Z=0;Z<7;Z++)for(let M=Z;M<7;M++){const $=ee[D++];$.faceUp=Z===M,f(p)[M].push($)}for(;D<ee.length;)f(m).push(ee[D++]);ie(b,null),ie(P,0),ie(R,!1),ve()}function z(ee,D){const Z=f(p)[ee];if(f(b)){const{pile:M,index:$}=f(b);let te;M===-2?te=[f(k)[$]]:te=f(p)[M].slice($);const ae=te[0];if(Z.length===0){if(ae.rank===13){C(M,$,ee,-1),ie(b,null);return}}else{const ge=Z[Z.length-1];if((ae.suit==="hearts"||ae.suit==="diamonds")!=(ge.suit==="hearts"||ge.suit==="diamonds")&&ae.rank===ge.rank-1){C(M,$,ee,-1),ie(b,null);return}}if(te.length===1)for(let ge=0;ge<4;ge++){const _e=f(S)[ge];if(_e.length===0){if(ae.rank===1){C(M,$,-1,ge),ie(b,null);return}}else{const Ie=_e[_e.length-1];if(ae.suit===Ie.suit&&ae.rank===Ie.rank+1){C(M,$,-1,ge),ie(b,null);return}}}ie(b,null)}else D>=0&&Z[D]?.faceUp&&ie(b,{pile:ee,index:D},!0)}function H(ee){if(!f(b))return;const{pile:D,index:Z}=f(b);let M;D===-2?M=f(k)[Z]:M=f(p)[D][Z];const $=f(S)[ee];if($.length===0)M.rank===1&&D>=-1&&(D===-2?[f(k)[Z]]:f(p)[D].slice(Z)).length===1&&C(D,Z,-1,ee);else{const te=$[$.length-1];M.suit===te.suit&&M.rank===te.rank+1&&(D===-2?[f(k)[Z]]:f(p)[D].slice(Z)).length===1&&C(D,Z,-1,ee)}ie(b,null)}function C(ee,D,Z,M){let $;ee===-2?$=[f(k).pop()]:($=f(p)[ee].splice(D),f(p)[ee].length>0&&(f(p)[ee][f(p)[ee].length-1].faceUp=!0)),Z>=0?f(p)[Z].push(...$):M>=0&&f(S)[M].push(...$),er(P),T()}function T(){f(q)&&(ie(R,!0),t()?(X("🎉 Победа!",`Вы собрали все души за ${f(P)} ходов!`,[]),setTimeout(()=>{ve(),e.onWin?.()},3e3)):X("🎉 Победа!",`Вы собрали все души за ${f(P)} ходов!`,[{text:"Играть снова",action:L}]))}function K(){t()?(X("💀 Сдаюсь","Вы сдались...",[]),setTimeout(()=>{ve(),e.onLose?.()},3e3)):X("Конец","Попробуйте ещё раз!",[{text:"Новая игра",action:L}])}function X(ee,D,Z){ie(U,{show:!0,title:ee,text:D,actions:Z},!0)}function ve(){f(U).show=!1}function de(){X("📖 Правила",`Пасьянс (Башня душ):

🎯 Цель: Собрать все карты в фундаменты (справа) по мастям от туза до короля.

🃏 Кликни на колоду (слева) чтобы взять карту.

📋 Возьми карту из сброса и положи в столбец по убыванию (красная на чёрную).

🔄 Карты в столбце можно перемещать друг на друга по убыванию и чередованию цветов.

💡 Короля можно положить на пустой столбец.

🏆 Собери все 4 масти от туза до короля!`,[{text:"Понятно",action:ve}])}function oe(ee){return g[ee]||ee.toString()}function me(ee){return ee==="hearts"||ee==="diamonds"?"#e94560":"#ececec"}or(n,{children:(ee,D)=>{var Z=pg(),M=Xe(Z);{let ue=Dt(()=>t()?K:void 0);lr(M,{onRestart:L,get onGiveUp(){return f(ue)},get showGiveUp(){return t()},onShowRules:de})}var $=j(M,2),te=E($),ae=E(te);ae.__click=[rg,m,k,P];var ge=E(ae);{var _e=ue=>{var fe=sg();W(ue,fe)},Ie=ue=>{var fe=ag();W(ue,fe)};Oe(ge,ue=>{f(m).length>0?ue(_e):ue(Ie,!1)})}var Ee=j(ae,2);Ee.__click=[ig,k,b];var We=E(Ee);{var ne=ue=>{var fe=og();let ye;var Ae=E(fe),Ke=E(Ae),Ue=j(Ae,2),$e=E(Ue);Se((Ve,qe,_t)=>{ye=Nt(fe,1,"card front svelte-fcha4g",null,ye,Ve),be(Ke,qe),sn(Ue,`color: ${_t??""}`),be($e,h[f(k)[f(k).length-1].suit])},[()=>({selected:f(b)?.pile===-2}),()=>oe(f(k)[f(k).length-1].rank),()=>me(f(k)[f(k).length-1].suit)]),W(ue,fe)};Oe(We,ue=>{f(k).length>0&&ue(ne)})}var le=j(Ee,2);Ze(le,21,()=>f(S),xt,(ue,fe,ye)=>{var Ae=cg();Ae.__click=()=>H(ye),Ne(Ae,"aria-label",`Фундамент ${ye+1}`);var Ke=E(Ae);{var Ue=Ve=>{var qe=lg(),_t=E(qe),lt=E(_t),kt=j(_t,2),mt=E(kt);Se((y,o)=>{be(lt,y),sn(kt,`color: ${o??""}`),be(mt,h[f(fe)[f(fe).length-1].suit])},[()=>oe(f(fe)[f(fe).length-1].rank),()=>me(f(fe)[f(fe).length-1].suit)]),W(Ve,qe)},$e=Ve=>{var qe=ug();W(Ve,qe)};Oe(Ke,Ve=>{f(fe).length>0?Ve(Ue):Ve($e,!1)})}W(ue,Ae)});var Y=j(te,2);Ze(Y,21,()=>f(p),xt,(ue,fe,ye)=>{var Ae=hg();Ae.__click=()=>z(ye,-1),Ae.__keydown=Ke=>{(Ke.key==="Enter"||Ke.key===" ")&&(Ke.preventDefault(),z(ye,-1))},Ne(Ae,"aria-label",`Столбец ${ye+1}`),Ze(Ae,21,()=>f(fe),xt,(Ke,Ue,$e)=>{var Ve=fg();let qe;Ve.__click=kt=>{kt.stopPropagation(),z(ye,$e)},sn(Ve,`margin-top: ${$e>0?"-80%":"0"}; z-index: ${$e};`);var _t=E(Ve);{var lt=kt=>{var mt=dg(),y=Xe(mt),o=E(y),d=j(y,2),w=E(d);Se((x,V)=>{be(o,x),sn(d,`color: ${V??""}`),be(w,h[f(Ue).suit])},[()=>oe(f(Ue).rank),()=>me(f(Ue).suit)]),W(kt,mt)};Oe(_t,kt=>{f(Ue).faceUp&&kt(lt)})}Se((kt,mt)=>{qe=Nt(Ve,1,"card svelte-fcha4g",null,qe,kt),Ne(Ve,"aria-label",mt)},[()=>({front:f(Ue).faceUp,back:!f(Ue).faceUp,selected:f(b)?.pile===ye&&f(b)?.index===$e}),()=>f(Ue).faceUp?`${oe(f(Ue).rank)} ${h[f(Ue).suit]}`:"Лицевая сторона карты"]),W(Ke,Ve)}),W(ue,Ae)});var ce=j($,2);ur(ce,{get rewardItem(){return r()},get items(){return i()},get bucketName(){return l()},children:(ue,fe)=>{var ye=vg(),Ae=E(ye),Ke=j(E(Ae)),Ue=E(Ke);Se(()=>be(Ue,f(P))),W(ue,ye)},$$slots:{default:!0}});var re=j(ce,2);cr(re,{get modal(){return f(U)}}),W(ee,Z)}}),Ot()}Ft(["click","keydown"]);var _g=Q('<div class="loading svelte-15dde84">Загрузка игры...</div>'),mg=Q('<div class="minigame-container svelte-15dde84"><!></div>');function yg(n,e){Pt(e,!0);let t=ze(e,"bucketName",3,"dracula");function r(){console.log("[MinigameLauncher] Game won!"),e.onWin()}function i(){console.log("[MinigameLauncher] Game lost!"),e.onLose()}var l=mg(),u=E(l);{var h=g=>{Cp(g,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},v=g=>{var m=At(),k=Xe(m);{var S=b=>{Op(b,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},p=b=>{var R=At(),P=Xe(R);{var U=L=>{$p(L,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},q=L=>{var z=At(),H=Xe(z);{var C=K=>{Vp(K,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},T=K=>{var X=At(),ve=Xe(X);{var de=me=>{zp(me,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},oe=me=>{var ee=At(),D=Xe(ee);{var Z=$=>{Qp($,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},M=$=>{var te=At(),ae=Xe(te);{var ge=Ie=>{ng(Ie,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},_e=Ie=>{var Ee=At(),We=Xe(Ee);{var ne=Y=>{gg(Y,{onWin:r,onLose:i,integrated:!0,get rewardItem(){return e.rewardItem},get items(){return e.items},get bucketName(){return t()}})},le=Y=>{var ce=_g();W(Y,ce)};Oe(We,Y=>{e.gameId==="tower_of_souls"?Y(ne):Y(le,!1)},!0)}W(Ie,Ee)};Oe(ae,Ie=>{e.gameId==="cursed_crypts"?Ie(ge):Ie(_e,!1)},!0)}W($,te)};Oe(D,$=>{e.gameId==="evolution2048"?$(Z):$(M,!1)},!0)}W(me,ee)};Oe(ve,me=>{e.gameId==="broken_mirror"?me(de):me(oe,!1)},!0)}W(K,X)};Oe(H,K=>{e.gameId==="flood_it"?K(C):K(T,!1)},!0)}W(L,z)};Oe(P,L=>{e.gameId==="light_out"?L(U):L(q,!1)},!0)}W(b,R)};Oe(k,b=>{e.gameId==="memo_monsters"?b(S):b(p,!1)},!0)}W(g,m)};Oe(u,g=>{e.gameId==="onet_monsters"?g(h):g(v,!1)})}W(n,l),Ot()}function bg(n,e){f(e)?.nextDialogueId&&Tt.goToDialogue(f(e).nextDialogueId)}var wg=Q('<img alt="BG" class="background-image svelte-fl90wm"/>'),kg=Q('<div class="background-media svelte-fl90wm"><!></div>'),Ig=Q('<img alt="Char" class="character-image svelte-fl90wm"/>'),Sg=Q('<div class="character-media svelte-fl90wm"><!></div>'),Eg=(n,e,t)=>e(f(t)),Ag=Q("<button> </button>"),Cg=Q('<div class="options-container svelte-fl90wm"></div>'),jg=Q('<div class="next-container svelte-fl90wm"><button class="next-button svelte-fl90wm">Далее...</button></div>'),Tg=Q('<div class="dialogue-container svelte-fl90wm"><!> <!> <!> <div class="dialogue-content svelte-fl90wm"><div class="dialogue-text svelte-fl90wm"> </div> <!></div></div>'),xg=Q("<p> </p>");function Uu(n,e){Pt(e,!0);let t=ze(e,"bucketName",3,$u);console.log(t());const r=Dt(()=>e.dialogue||Tt.findDialogue(Tt.currentDialogueId));let i=Me(null);li(()=>{f(r)?.onEnter&&Tt.runActions(f(r).onEnter)});function l(b){if(b.actions&&Tt.runActions(b.actions),b.miniGame){console.log("Запуск мини-игры:",b.miniGame.id),ie(i,{gameId:b.miniGame.id,onWinDialogueId:b.miniGame.onWinDialogueId,onLoseDialogueId:b.miniGame.onLoseDialogueId,rewardItem:b.miniGame.rewardItem},!0);return}b.nextDialogueId&&Tt.goToDialogue(b.nextDialogueId)}function u(){console.log("[DialogueCard] Mini-game won!"),f(i)?.rewardItem&&Tt.addItem(f(i).rewardItem),f(i)?.onWinDialogueId&&Tt.goToDialogue(f(i).onWinDialogueId),ie(i,null)}function h(){console.log("[DialogueCard] Mini-game lost!"),f(i)?.onLoseDialogueId&&Tt.goToDialogue(f(i).onLoseDialogueId),ie(i,null)}function v(b){return b.visible===!1?!1:Tt.checkVisibilityCondition(b)}function g(b){return b.enabled!==!1}var m=At(),k=Xe(m);{var S=b=>{var R=Tg(),P=E(R);{var U=oe=>{{let me=Dt(()=>Tt.storyData?.items);yg(oe,{get gameId(){return f(i).gameId},onWin:u,onLose:h,get rewardItem(){return f(i).rewardItem},get items(){return f(me)},get bucketName(){return t()}})}};Oe(P,oe=>{f(i)&&oe(U)})}var q=j(P,2);{var L=oe=>{var me=kg(),ee=E(me);{var D=M=>{var $=At(),te=Xe($);wa(te,()=>f(r).backgroundImage,ae=>{Ml(ae,{get fileName(){return f(r).backgroundImage},get bucketName(){return t()}})}),W(M,$)},Z=M=>{var $=wg();Se(()=>Ne($,"src",`${Es}/storage/v1/object/public/${t()}/${f(r).backgroundImage}`)),W(M,$)};Oe(ee,M=>{f(r).backgroundImage.endsWith(".riv")?M(D):M(Z,!1)})}W(oe,me)};Oe(q,oe=>{f(r).backgroundImage&&oe(L)})}var z=j(q,2);{var H=oe=>{var me=Sg(),ee=E(me);{var D=M=>{var $=At(),te=Xe($);wa(te,()=>f(r).characterImage,ae=>{Ml(ae,{get fileName(){return f(r).characterImage},get bucketName(){return t()}})}),W(M,$)},Z=M=>{var $=Ig();Se(()=>Ne($,"src",`${Es}/storage/v1/object/public/${t()}/${f(r).characterImage}`)),W(M,$)};Oe(ee,M=>{f(r).characterImage.endsWith(".riv")?M(D):M(Z,!1)})}W(oe,me)};Oe(z,oe=>{f(r).characterImage&&oe(H)})}var C=j(z,2),T=E(C),K=E(T),X=j(T,2);{var ve=oe=>{var me=Cg();Ze(me,21,()=>f(r).options,ee=>ee.text,(ee,D)=>{var Z=At(),M=Xe(Z);{var $=te=>{var ae=Ag();let ge;ae.__click=[Eg,l,D];var _e=E(ae);Se((Ie,Ee)=>{ge=Nt(ae,1,"option-button svelte-fl90wm",null,ge,Ie),ae.disabled=Ee,be(_e,f(D).text)},[()=>({disabled:!g(f(D))}),()=>!g(f(D))]),W(te,ae)};Oe(M,te=>{v(f(D))&&te($)})}W(ee,Z)}),W(oe,me)},de=oe=>{var me=At(),ee=Xe(me);{var D=Z=>{var M=jg(),$=E(M);$.__click=[bg,r],W(Z,M)};Oe(ee,Z=>{f(r).nextDialogueId&&Z(D)},!0)}W(oe,me)};Oe(X,oe=>{f(r).options&&f(r).options.length>0?oe(ve):oe(de,!1)})}Se(()=>be(K,f(r).text)),W(b,R)},p=b=>{var R=xg(),P=E(R);Se(()=>be(P,`Диалог не найден (ID: ${Tt.currentDialogueId??""})`)),W(b,R)};Oe(k,b=>{f(r)?b(S):b(p,!1)})}W(n,m),Ot()}Ft(["click"]);var ha=sr(()=>B),Rg=Q('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Фон:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Pg=Q('<div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Персонаж:</span> <span class="info-value svelte-1u0yr0g"> </span></div>'),Og=Q('<div class="preview-warning svelte-1u0yr0g">⚠️ Нет вариантов ответов</div>'),Mg=Q('<div class="preview-warning svelte-1u0yr0g">⚠️ Некоторые варианты не ведут дальше</div>'),Lg=Q('<div class="preview-container svelte-1u0yr0g"><!> <div class="preview-info svelte-1u0yr0g"><div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">ID:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <div class="info-row svelte-1u0yr0g"><span class="info-label svelte-1u0yr0g">Глава:</span> <span class="info-value svelte-1u0yr0g"> </span></div> <!> <!></div> <!> <!></div>'),Dg=Q('<div class="empty-preview svelte-1u0yr0g"><div class="empty-icon svelte-1u0yr0g">👈</div> <div class="empty-text svelte-1u0yr0g">Выберите сцену для предпросмотра</div></div>'),Fg=Q('<aside class="preview-panel svelte-1u0yr0g"><div class="preview-header svelte-1u0yr0g"><h3 class="svelte-1u0yr0g">Предпросмотр</h3> <button class="btn-link small svelte-1u0yr0g">Сбросить редакт. опций</button></div> <div class="preview-wrapper svelte-1u0yr0g"><!></div></aside>');function $g(n,e){Pt(e,!1);function t(){ha(ha().editingOptionIndex=null)}ir();var r=Fg(),i=E(r),l=j(E(i),2);l.__click=t;var u=j(i,2),h=E(u);{var v=m=>{var k=Lg(),S=E(k);Uu(S,{get dialogue(){return Jt.currentDialogue},index:0,get bucketName(){return ha().selectedBucket}});var p=j(S,2),b=E(p),R=j(E(b),2),P=E(R),U=j(b,2),q=j(E(U),2),L=E(q),z=j(U,2);{var H=oe=>{var me=Rg(),ee=j(E(me),2),D=E(ee);Se(()=>be(D,Jt.currentDialogue.backgroundImage)),W(oe,me)};Oe(z,oe=>{Jt.currentDialogue.backgroundImage&&oe(H)})}var C=j(z,2);{var T=oe=>{var me=Pg(),ee=j(E(me),2),D=E(ee);Se(()=>be(D,Jt.currentDialogue.characterImage)),W(oe,me)};Oe(C,oe=>{Jt.currentDialogue.characterImage&&oe(T)})}var K=j(p,2);{var X=oe=>{var me=Og();W(oe,me)};Oe(K,oe=>{(!Jt.currentDialogue.options||Jt.currentDialogue.options.length===0)&&oe(X)})}var ve=j(K,2);{var de=oe=>{var me=Mg();W(oe,me)};Oe(ve,oe=>{Jt.currentDialogue.options?.some(me=>!me.nextDialogueId)&&oe(de)})}Se(()=>{be(P,Jt.currentDialogue.id),be(L,Jt.currentChapter?.title||"Без главы")}),W(m,k)},g=m=>{var k=Dg();W(m,k)};Oe(h,m=>{Jt.currentDialogue?m(v):m(g,!1)})}W(n,r),Ot()}Ft(["click"]);const Ug=["dracula","zombie","fairy_tale","minigames"];function Nu(){const n=Ug.map(e=>({id:e,name:e,public:!1,file_count:0,created_at:new Date().toISOString()}));return wt.updateBucketsList(n),n}var yr=sr(()=>B),Ng=Q('<span class="selected-badge svelte-1h9p6cz">Выбрано</span>'),Bg=(n,e,t)=>e(f(t).name),Wg=Q('<button class="btn small svelte-1h9p6cz">Выбрать</button>'),Vg=Q('<div><div class="bucket-info svelte-1h9p6cz"><div class="story-icon svelte-1h9p6cz"> </div> <div class="story-content"><h3 class="story-title"> </h3> <p class="story-description"> </p></div> <div class="story-arrow">→</div></div> <div class="bucket-actions svelte-1h9p6cz"><!></div></div>'),qg=Q('<div class="story-selector svelte-1h9p6cz"><div class="selector-header svelte-1h9p6cz"><h2 class="svelte-1h9p6cz">Выберите историю</h2></div> <div class="buckets-list svelte-1h9p6cz"></div></div>');function Gg(n,e){Pt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};In(()=>{r()});function r(){Nu()}async function i(h){yr(yr().selectedBucket=h),yr(yr().data={meta:{version:"3.1",title:"Новая история"},dialogues:[],chapters:[],items:[],miniGames:[]}),await nr.loadStoriesList(),await nr.loadStoredResources()}ir();var l=qg(),u=j(E(l),2);Ze(u,5,()=>yr().availableBuckets,h=>h,(h,v)=>{const g=hi(()=>t[f(v).id]||{title:f(v),description:"Интерактивная история",icon:"📖"});var m=Vg();let k;var S=E(m),p=E(S),b=E(p),R=j(p,2),P=E(R),U=E(P),q=j(P,2),L=E(q),z=j(S,2),H=E(z);{var C=K=>{var X=Ng();W(K,X)},T=K=>{var X=Wg();X.__click=[Bg,i,v],W(K,X)};Oe(H,K=>{yr().selectedBucket===f(v).name?K(C):K(T,!1)})}Se(K=>{k=Nt(m,1,"bucket-card svelte-1h9p6cz",null,k,K),be(b,f(g).icon),be(U,f(g).title),be(L,f(g).description)},[()=>({selected:yr().selectedBucket===f(v).name})]),W(h,m)}),W(n,l),Ot()}Ft(["click"]);var Hg=Q("<span> </span>"),zg=Q('<div class="debug-info svelte-1k4krym"><small> </small></div>'),Kg=Q('<div class="debug-info warning svelte-1k4krym"><small>⚠️ Данные не загружены</small></div>'),Yg=Q('<div class="empty-state svelte-1k4krym">Выберите сцену</div>'),Jg=Q('<div class="editor-container svelte-1k4krym"><header class="toolbar svelte-1k4krym"><div class="logo svelte-1k4krym"><button class="btn-link svelte-1k4krym">← Сменить историю</button> <h2 class="svelte-1k4krym"> </h2></div> <div class="stories-control svelte-1k4krym"><span class="story-file-name svelte-1k4krym"> </span> <!> <button class="btn success small svelte-1k4krym">💾 Сохранить</button> <button class="btn small svelte-1k4krym">📋 Копия</button></div></header> <div class="main-workspace svelte-1k4krym"><!> <main class="editor-area svelte-1k4krym"><!> <!> <!></main> <!></div></div>');function Xg(n,e){Pt(e,!0),In(async()=>{Nu(),B.availableBuckets.length>0&&!B.selectedBucket&&(B.selectedBucket=B.availableBuckets[0].name)}),li(()=>{B.selectedBucket&&(console.log(`[Editor] Bucket выбран: ${B.selectedBucket}`),nr.loadStoredResources().then(()=>{const u=`${B.selectedBucket}_story.json`;return B.currentFileName=u,Rn.loadStory(u)}).catch(u=>{console.error("[Editor] Ошибка загрузки истории:",u)}))});var t=At(),r=Xe(t);{var i=u=>{Gg(u,{})},l=u=>{var h=Jg(),v=E(h),g=E(v),m=E(g);m.__click=()=>B.selectedBucket=null;var k=j(m,2),S=E(k),p=j(g,2),b=E(p),R=E(b),P=j(b,2);{var U=D=>{var Z=Hg(),M=E(Z);Se(()=>{Nt(Z,1,`status-message ${B.statusMessage.type??""}`,"svelte-1k4krym"),be(M,B.statusMessage.text)}),W(D,Z)};Oe(P,D=>{B.statusMessage.text&&D(U)})}var q=j(P,2);q.__click=function(...D){Rn.saveCurrentStory?.apply(this,D)};var L=j(q,2);L.__click=function(...D){Rn.saveStoryCopy?.apply(this,D)};var z=j(v,2),H=E(z);sv(H,{});var C=j(H,2),T=E(C);{var K=D=>{var Z=zg(),M=E(Z),$=E(M);Se(()=>be($,`Загружено: ${B.data.meta?.title??""} |
              Глав: ${(B.data.chapters?.length||0)??""} |
              Диалогов: ${(B.data.dialogues?.length||0)??""} |
              Предметов: ${(B.data.items?.length||0)??""}`)),W(D,Z)},X=D=>{var Z=Kg();W(D,Z)};Oe(T,D=>{B.data?D(K):D(X,!1)})}var ve=j(T,2);sp(ve,{});var de=j(ve,2);{var oe=D=>{zv(D,{get editor(){return B},get storyActions(){return Rn},get resourceActions(){return nr}})},me=D=>{var Z=Yg();W(D,Z)};Oe(de,D=>{Jt.currentDialogue?D(oe):D(me,!1)})}var ee=j(C,2);$g(ee,{}),Se(()=>{be(S,`Story Editor v3.1 - ${B.selectedBucket??""}`),be(R,B.currentFileName||"Нет файла")}),W(u,h)};Oe(r,u=>{B.selectedBucket?u(l,!1):u(i)})}W(n,t),Ot()}Ft(["click"]);var va=sr(()=>Tt),Qg=(n,e,t)=>e(f(t)),Zg=(n,e,t)=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e(f(t)))},e_=Q('<div class="story-card svelte-b9w39k" role="button" tabindex="0"><div class="story-icon svelte-b9w39k"> </div> <div class="story-content svelte-b9w39k"><h3 class="story-title svelte-b9w39k"> </h3> <p class="story-description svelte-b9w39k"> </p></div> <div class="story-arrow svelte-b9w39k">→</div></div>'),t_=Q('<div class="story-selector svelte-b9w39k"><div class="selector-header svelte-b9w39k"><h1 class="svelte-b9w39k">🎭 Визуальные новеллы</h1> <p class="svelte-b9w39k">Выберите историю для прохождения</p></div> <div class="stories-grid svelte-b9w39k"></div> <div class="selector-footer svelte-b9w39k"><p class="hint svelte-b9w39k">💡 Совет: Вы можете создать свою историю в редакторе</p></div></div>');function n_(n,e){Pt(e,!1);const t={dracula:{title:"Дракула",description:"Тёмная готическая история о вампире и его жертве",icon:"🧛"},zombie:{title:"Выживание",description:"Постапокалиптическая история о зомби",icon:"🧟"},fairy_tale:{title:"Сказка",description:"Волшебная история с феями и драконами",icon:"🧚"},minigames:{title:"Мини-игры",description:"Демонстрация мини-игр в визуальной новелле",icon:"🎮"}};function r(u){va(va().selectedStory=u)}ir();var i=t_(),l=j(E(i),2);Ze(l,5,()=>va().availableStories,u=>u,(u,h)=>{const v=hi(()=>t[f(h)]||{title:f(h),description:"Интерактивная история",icon:"📖"});var g=e_();g.__click=[Qg,r,h],g.__keydown=[Zg,r,h];var m=E(g),k=E(m),S=j(m,2),p=E(S),b=E(p),R=j(p,2),P=E(R);Se(()=>{be(k,f(v).icon),be(b,f(v).title),be(P,f(v).description)}),W(u,g)}),W(n,i),Ot()}Ft(["click","keydown"]);var r_=Q('<span class="inventory-badge svelte-166jaas"> </span>'),i_=(n,e)=>n.key==="Escape"&&e(),s_=n=>n.stopPropagation(),a_=n=>n.stopPropagation(),o_=(n,e,t)=>e(f(t)),l_=Q('<button type="button" class="item-card svelte-166jaas"><div class="item-icon svelte-166jaas"><img class="icon-preview" height="64px"/></div> <div class="item-info svelte-166jaas"><span class="item-name svelte-166jaas"> </span> <span class="item-type svelte-166jaas"> </span></div></button>'),u_=Q('<div class="items-grid svelte-166jaas"></div>'),c_=Q('<div class="empty-inventory svelte-166jaas"><span class="empty-icon svelte-166jaas">🎒</span> <p class="svelte-166jaas">Инвентарь пуст</p> <p class="empty-hint svelte-166jaas">Получайте предметы в ходе игры</p></div>'),d_=Q('<div class="inventory-overlay svelte-166jaas" role="dialog" tabindex="-1"><div class="inventory-modal svelte-166jaas" role="dialog" aria-label="Окно инвентаря" tabindex="-1"><div class="inventory-header svelte-166jaas"><h2 class="svelte-166jaas">Инвентарь</h2> <button class="close-button svelte-166jaas">✕</button></div> <div class="stats-section svelte-166jaas"><h3 class="svelte-166jaas">Характеристики</h3> <div class="stats-grid svelte-166jaas"><div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">📚</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Знания</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">💪</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Смелость</span> <span class="stat-value svelte-166jaas"> </span></div></div> <div class="stat-item svelte-166jaas"><span class="stat-icon svelte-166jaas">✨</span> <div class="stat-info svelte-166jaas"><span class="stat-name svelte-166jaas">Харизма</span> <span class="stat-value svelte-166jaas"> </span></div></div></div></div> <div class="items-section svelte-166jaas"><h3 class="svelte-166jaas"> </h3> <!></div></div></div>'),f_=Q('<div class="inventory-wrapper svelte-166jaas"><button class="inventory-button svelte-166jaas">🎒 <!></button> <!></div>');function h_(n,e){Pt(e,!0);let t=Me(!1);const r=Dt(()=>Tt.getInventoryItems()),i=Dt(()=>Tt.player.stats);function l(){ie(t,!f(t))}function u(p){console.log("Выбран предмет:",p.name)}var h=f_(),v=E(h);v.__click=l;var g=j(E(v));{var m=p=>{var b=r_(),R=E(b);Se(()=>be(R,f(r).length)),W(p,b)};Oe(g,p=>{f(r).length>0&&p(m)})}var k=j(v,2);{var S=p=>{var b=d_();b.__click=l,b.__keydown=[i_,l];var R=E(b);R.__click=[s_],R.__keydown=[a_];var P=E(R),U=j(E(P),2);U.__click=l;var q=j(P,2),L=j(E(q),2),z=E(L),H=j(E(z),2),C=j(E(H),2),T=E(C),K=j(z,2),X=j(E(K),2),ve=j(E(X),2),de=E(ve),oe=j(K,2),me=j(E(oe),2),ee=j(E(me),2),D=E(ee),Z=j(q,2),M=E(Z),$=E(M),te=j(M,2);{var ae=_e=>{var Ie=u_();Ze(Ie,21,()=>f(r),Ee=>Ee.id,(Ee,We)=>{var ne=l_();ne.__click=[o_,u,We];var le=E(ne),Y=E(le),ce=j(le,2),re=E(ce),ue=E(re),fe=j(re,2),ye=E(fe);Se(()=>{Ne(ne,"aria-label",`Предмет: ${f(We).name}`),Ne(Y,"src",`https://vycjpmuyscfygstjjied.supabase.co/storage/v1/object/public/${Tt.selectedStory}/${f(We).icon}`),Ne(Y,"alt",f(We).icon),be(ue,f(We).name),be(ye,f(We).type)}),W(Ee,ne)}),W(_e,Ie)},ge=_e=>{var Ie=c_();W(_e,Ie)};Oe(te,_e=>{f(r).length>0?_e(ae):_e(ge,!1)})}Se(()=>{be(T,f(i).knowledge),be(de,f(i).courage),be(D,f(i).charisma),be($,`Предметы (${f(r).length??""})`)}),W(p,b)};Oe(k,p=>{f(t)&&p(S)})}Se(()=>Ne(v,"title",`Инвентарь (${f(r).length??""})`)),W(n,h),Ot()}Ft(["click","keydown"]);var v_=Q('<div class="loading svelte-14svm27"><p>🔄 Загрузка истории...</p></div>'),p_=Q('<div class="error svelte-14svm27"> <button class="btn-back svelte-14svm27">← Вернуться к выбору</button></div>'),g_=Q('<div class="game-container svelte-14svm27"><!> <button class="btn-change-story svelte-14svm27" title="Сменить историю">📚</button> <div class="dialogues-container svelte-14svm27"><!></div></div>'),__=Q('<div class="app svelte-14svm27"><!></div>');function m_(n,e){Pt(e,!0),li(async()=>{if(Tt.selectedStory){const u=`${Tt.selectedStory}_story.json`,h=`${Es}/storage/v1/object/public/${Tt.selectedStory}/${u}`;console.log("Загружаем историю из:",h),await Tt.loadStory(h)}});var t=__(),r=E(t);{var i=u=>{n_(u,{})},l=u=>{var h=At(),v=Xe(h);{var g=k=>{var S=v_();W(k,S)},m=k=>{var S=At(),p=Xe(S);{var b=P=>{var U=p_(),q=E(U),L=j(q);L.__click=()=>Tt.selectedStory=null,Se(()=>be(q,`⚠️ ${Tt.error??""} `)),W(P,U)},R=P=>{var U=g_(),q=E(U);h_(q,{});var L=j(q,2);L.__click=()=>Tt.selectedStory=null;var z=j(L,2),H=E(z);{var C=T=>{Uu(T,{get bucketName(){return Tt.selectedStory}})};Oe(H,T=>{Tt.storyData&&T(C)})}W(P,U)};Oe(p,P=>{Tt.error?P(b):P(R,!1)},!0)}W(k,S)};Oe(v,k=>{Tt.isLoading?k(g):k(m,!1)},!0)}W(u,h)};Oe(r,u=>{Tt.selectedStory?u(l,!1):u(i)})}W(n,t),Ot()}Ft(["click"]);var y_=Q('<button style="position:fixed; top:10px; right:500px; z-index:9999;">Закрыть редактор</button> <!>',1),b_=Q('<button id="content" style="position:fixed; bottom:10px; right:10px; z-index:9999;" class="svelte-1s2gs9v">Редактор</button> <!>',1);function w_(n,e){Pt(e,!1),ir();var t=At(),r=Xe(t);{var i=u=>{var h=y_(),v=Xe(h);v.__click=function(...m){wt.toggleEditor?.apply(this,m)};var g=j(v,2);Xg(g,{}),W(u,h)},l=u=>{var h=b_(),v=Xe(h);v.__click=function(...m){wt.toggleEditor?.apply(this,m)};var g=j(v,2);m_(g,{}),W(u,h)};Oe(r,u=>{B.showEditor?u(i):u(l,!1)})}W(n,t),Ot()}Ft(["click"]);Cd(w_,{target:document.getElementById("app")});
